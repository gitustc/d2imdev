cscope 15 $HOME/d2imdev/ds1/new -q 0000012687 0002538646
	@ccan/ccan/alignof/alignof.h

2 #i‚de‡
CCAN_ALIGNOF_H


3 
	#CCAN_ALIGNOF_H


	)

4 
	~"c⁄fig.h
"

12 #i‡
HAVE_ALIGNOF


14 
	#ALIGNOF
(
t
Ë
	`__Æignof__
—)

	)

17 
	#ALIGNOF
(
t
Ë((*)(&((°ru˘ { 
c
;Å 
_h
; } *)0)->_hË- (*)0)

	)

	@ccan/ccan/alignof/test/run.c

1 
	~<cˇn/Æignof/Æignof.h
>

2 
	~<°dlib.h
>

3 
	~<°ddef.h
>

4 
	~<cˇn/èp/èp.h
>

14 
	slŸs_of_ty≥s


16 
	mc
;

17 
	ms
;

18 
	mc2
;

19 
	mi
;

20 
	mc3
;

21 
	mf
;

22 
	mc4
;

23 
	md
;

24 
	mc5
;

27 
	$maö
(
¨gc
, *
¨gv
[])

29 
lŸs_of_ty≥s
ÜŸs_of_ty≥s, *
Õ
 = 
	`mÆloc
((*lp));

30 
c
;

31 
s
;

32 
c2
;

33 
i
;

34 
c3
;

35 
f
;

36 
c4
;

37 
d
;

40 
c
 = 
c2
 = 
c3
 = 
c4
 = 0;

42 
	`∂™_ã°s
(15);

43 
	`ok1
(()&
c
 % 
	`ALIGNOF
() == 0);

44 
	`ok1
(()&
s
 % 
	`ALIGNOF
() == 0);

45 
	`ok1
(()&
i
 % 
	`ALIGNOF
() == 0);

46 
	`ok1
(()&
f
 % 
	`ALIGNOF
() == 0);

47 
	`ok1
(()&
d
 % 
	`ALIGNOF
() == 0);

49 
	`ok1
(()&
lŸs_of_ty≥s
.
c
 % 
	`ALIGNOF
() == 0);

50 
	`ok1
(()&
lŸs_of_ty≥s
.
s
 % 
	`ALIGNOF
() == 0);

51 
	`ok1
(()&
lŸs_of_ty≥s
.
i
 % 
	`ALIGNOF
() == 0);

52 
	`ok1
(()&
lŸs_of_ty≥s
.
f
 % 
	`ALIGNOF
() == 0);

53 
	`ok1
(
	`off£tof
(
lŸs_of_ty≥s
, 
d
Ë% 
	`ALIGNOF
() == 0);

55 
	`ok1
(()&
Õ
->
c
 % 
	`ALIGNOF
() == 0);

56 
	`ok1
(()&
Õ
->
s
 % 
	`ALIGNOF
() == 0);

57 
	`ok1
(()&
Õ
->
i
 % 
	`ALIGNOF
() == 0);

58 
	`ok1
(()&
Õ
->
f
 % 
	`ALIGNOF
() == 0);

59 
	`ok1
(()&
Õ
->
d
 % 
	`ALIGNOF
() == 0);

60 
	`exô
(
	`exô_°©us
());

61 
	}
}

	@ccan/ccan/antithread/alloc/alloc.c

2 
	~<uni°d.h
>

3 
	~<°döt.h
>

4 
	~<°rög.h
>

5 
	~<limôs.h
>

6 
	~<as£π.h
>

7 
	~<°dlib.h
>

8 
	~"Æloc.h
"

9 
	~"bô›s.h
"

10 
	~"töy.h
"

11 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

12 
	~<cˇn/likñy/likñy.h
>

13 
	~<cˇn/Æignof/Æignof.h
>

14 
	~<cˇn/sh‹t_ty≥s/sh‹t_ty≥s.h
>

15 
	~<cˇn/compûî/compûî.h
>

16 
	~"c⁄fig.h
"

40 
	#MAX_LARGE_PAGES
 (256UL)

	)

43 
	#BITS_FROM_SMALL_TO_LARGE_PAGE
 5

	)

45 
	#MAX_SMALL_PAGES
 (
MAX_LARGE_PAGES
 << 
BITS_FROM_SMALL_TO_LARGE_PAGE
)

	)

49 
	#MIN_USEFUL_SIZE
 (
MAX_SMALL_PAGES
 * 128)

	)

52 
	#INTER_BUCKET_SPACE
 4

	)

54 
	#SMALL_PAGES_PER_LARGE_PAGE
 (1 << 
BITS_FROM_SMALL_TO_LARGE_PAGE
)

	)

57 
	#MAX_SIZE
 (1 << 30)

	)

60 
	#MAX_PAGE_OBJECT_ORDER
 3

	)

62 
	#BITS_PER_LONG
 ((Ë* 
CHAR_BIT
)

	)

64 
	sbuckë_°©e
 {

65 
u32
 
	mñemíts_≥r_∑ge
;

66 
u16
 
	m∑ge_li°
;

67 
u16
 
	mfuŒ_li°
;

70 
	shódî
 {

72 
	m∑gesize
[
MAX_LARGE_PAGES
 / 
BITS_PER_LONG
];

75 
u16
 
	msmÆl_‰ì_li°
;

76 
u16
 
	mœrge_‰ì_li°
;

79 
	mhuge
;

82 
buckë_°©e
 
	mbs
[1];

85 
	shuge_Æloc
 {

86 
	m√xt
, 
	m¥ev
;

87 
	moff
, 
	mÀn
;

90 
	s∑ge_hódî
 {

91 
u16
 
	m√xt
, 
	m¥ev
;

93 
	mñemíts_u£d
 : 25;

94 
	mbuckë
 : 7;

95 
	mu£d
[1];

110 
	$buckë_to_size
(
buckë
)

112 
ba£
 = 1UL << (
buckë
 / 
INTER_BUCKET_SPACE
);

113  
ba£
 + ((
buckë
 % 
INTER_BUCKET_SPACE
)

114 << (
buckë
 / 
INTER_BUCKET_SPACE
))

115 / 
INTER_BUCKET_SPACE
;

116 
	}
}

126 
	$size_to_buckë
(
size
)

128 
ba£
 = 
	`aÊs
(
size
/2);

129 
ovîshoŸ
;

131 
ovîshoŸ
 = 
size
 - (1UL << 
ba£
);

132  
ba£
 * 
INTER_BUCKET_SPACE


133 + ((
ovîshoŸ
 * 
INTER_BUCKET_SPACE
 + (1UL << 
ba£
)-1) >> base);

134 
	}
}

136 
	$smÆl_∑ge_bôs
(
poﬁsize
)

138  
	`aÊs
(
poﬁsize
 / 
MAX_SMALL_PAGES
 - 1);

139 
	}
}

141 
∑ge_hódî
 *
	$‰om_pgnum
(
hódî
 *
hód
,

142 
pgnum
,

143 
•_bôs
)

145  (
∑ge_hódî
 *)((*)
hód
 + (
pgnum
 << 
•_bôs
));

146 
	}
}

148 
u16
 
	$to_pgnum
(
hódî
 *
hód
, *
p
, 
•_bôs
)

150  ((*)
p
 - (*)
hód
Ë>> 
•_bôs
;

151 
	}
}

153 
size_t
 
	$u£d_size
(
num_ñemíts
)

155  
	`Æign_up
(
num_ñemíts
, 
BITS_PER_LONG
Ë/ 
CHAR_BIT
;

156 
	}
}

163 
	$∑ge_hódî_size
(
Æign_bôs
,

164 
num_ñemíts
)

166 
size
;

168 
size
 = (
∑ge_hódî
)

169 - (((
∑ge_hódî
 *)0)->
u£d
)

170 + 
	`u£d_size
(
num_ñemíts
);

171  
	`Æign_up
(
size
, 1UL << 
Æign_bôs
);

172 
	}
}

174 
	$add_to_li°
(
hódî
 *
hód
,

175 
u16
 *
li°
, 
∑ge_hódî
 *
ph
, 
•_bôs
)

177 
h
 = *
li°
, 
off£t
 = 
	`to_pgnum
(
hód
, 
ph
, 
•_bôs
);

179 
ph
->
√xt
 = 
h
;

180 i‡(
h
) {

181 
∑ge_hódî
 *
¥ev
 = 
	`‰om_pgnum
(
hód
, 
h
, 
•_bôs
);

182 
	`as£π
(
¥ev
->prev == 0);

183 
¥ev
->¥ev = 
off£t
;

185 *
li°
 = 
off£t
;

186 
ph
->
¥ev
 = 0;

187 
	}
}

189 
	$dñ_‰om_li°
(
hódî
 *
hód
,

190 
u16
 *
li°
, 
∑ge_hódî
 *
ph
, 
•_bôs
)

193 i‡(
ph
->
¥ev
 == 0) {

194 *
li°
 = 
ph
->
√xt
;

196 
∑ge_hódî
 *
¥ev
 = 
	`‰om_pgnum
(
hód
, 
ph
->¥ev, 
•_bôs
);

197 
¥ev
->
√xt
 = 
ph
->next;

199 i‡(
ph
->
√xt
 != 0) {

200 
∑ge_hódî
 *
√xt
 = 
	`‰om_pgnum
(
hód
, 
ph
->√xt, 
•_bôs
);

201 
√xt
->
¥ev
 = 
ph
->prev;

203 
	}
}

205 
u16
 
	$p›_‰om_li°
(
hódî
 *
hód
,

206 
u16
 *
li°
,

207 
•_bôs
)

209 
u16
 
h
 = *
li°
;

210 
∑ge_hódî
 *
ph
 = 
	`‰om_pgnum
(
hód
, 
h
, 
•_bôs
);

212 i‡(
	`likñy
(
h
)) {

213 *
li°
 = 
ph
->
√xt
;

214 i‡(*
li°
)

215 
	`‰om_pgnum
(
hód
, *
li°
, 
•_bôs
)->
¥ev
 = 0;

217  
h
;

218 
	}
}

220 
	$add_to_huge_li°
(
hódî
 *
hód
, 
huge_Æloc
 *
ha
)

222 
h
 = 
hód
->
huge
;

223 
off£t
 = (*)
ha
 - (*)
hód
;

225 
ha
->
√xt
 = 
h
;

226 i‡(
h
) {

227 
huge_Æloc
 *
¥ev
 = (*)((*)
hód
 + 
h
);

228 
	`as£π
(
¥ev
->prev == 0);

229 
¥ev
->¥ev = 
off£t
;

231 
hód
->
huge
 = 
off£t
;

232 
ha
->
¥ev
 = 0;

233 
	}
}

235 
	$dñ_‰om_huge
(
hódî
 *
hód
, 
huge_Æloc
 *
ha
)

238 i‡(
ha
->
¥ev
 == 0) {

239 
hód
->
huge
 = 
ha
->
√xt
;

241 
huge_Æloc
 *
¥ev
 = (*)((*)
hód
 + 
ha
->prev);

242 
¥ev
->
√xt
 = 
ha
->next;

244 i‡(
ha
->
√xt
 != 0) {

245 
huge_Æloc
 *
√xt
 = (*)((*)
hód
 + 
ha
->next);

246 
√xt
->
¥ev
 = 
ha
->prev;

248 
	}
}

250 
	$add_smÆl_∑ge_to_‰ìli°
(
hódî
 *
hód
,

251 
∑ge_hódî
 *
ph
,

252 
•_bôs
)

254 
	`add_to_li°
(
hód
, &hód->
smÆl_‰ì_li°
, 
ph
, 
•_bôs
);

255 
	}
}

257 
	$add_œrge_∑ge_to_‰ìli°
(
hódî
 *
hód
,

258 
∑ge_hódî
 *
ph
,

259 
•_bôs
)

261 
	`add_to_li°
(
hód
, &hód->
œrge_‰ì_li°
, 
ph
, 
•_bôs
);

262 
	}
}

264 
	$add_to_buckë_li°
(
hódî
 *
hód
,

265 
buckë_°©e
 *
bs
,

266 
∑ge_hódî
 *
ph
,

267 
•_bôs
)

269 
	`add_to_li°
(
hód
, &
bs
->
∑ge_li°
, 
ph
, 
•_bôs
);

270 
	}
}

272 
	$dñ_‰om_buckë_li°
(
hódî
 *
hód
,

273 
buckë_°©e
 *
bs
,

274 
∑ge_hódî
 *
ph
,

275 
•_bôs
)

277 
	`dñ_‰om_li°
(
hód
, &
bs
->
∑ge_li°
, 
ph
, 
•_bôs
);

278 
	}
}

280 
	$dñ_‰om_buckë_fuŒ_li°
(
hódî
 *
hód
,

281 
buckë_°©e
 *
bs
,

282 
∑ge_hódî
 *
ph
,

283 
•_bôs
)

285 
	`dñ_‰om_li°
(
hód
, &
bs
->
fuŒ_li°
, 
ph
, 
•_bôs
);

286 
	}
}

288 
	$add_to_buckë_fuŒ_li°
(
hódî
 *
hód
,

289 
buckë_°©e
 *
bs
,

290 
∑ge_hódî
 *
ph
,

291 
•_bôs
)

293 
	`add_to_li°
(
hód
, &
bs
->
fuŒ_li°
, 
ph
, 
•_bôs
);

294 
	}
}

296 
	$˛ór_bô
(
bôm≠
[], 
off
)

298 
bôm≠
[
off
 / 
BITS_PER_LONG
] &= ~(1UL << (off % BITS_PER_LONG));

299 
	}
}

301 
boﬁ
 
	$ã°_bô
(c⁄° 
bôm≠
[], 
off
)

303  
bôm≠
[
off
 / 
BITS_PER_LONG
] & (1UL << (off % BITS_PER_LONG));

304 
	}
}

306 
	$£t_bô
(
bôm≠
[], 
off
)

308 
bôm≠
[
off
 / 
BITS_PER_LONG
] |= (1UL << (off % BITS_PER_LONG));

309 
	}
}

312 
	$föd_‰ì_bô
(c⁄° 
bôm≠
[])

314 
i
;

316 
i
 = 0; 
bôm≠
[i] == -1UL; i++);

317  (
i
*
BITS_PER_LONG
Ë+ 
	`aff¶
(~
bôm≠
[i]) - 1;

318 
	}
}

321 
	$ñemíts_≥r_∑ge
(
Æign_bôs
,

322 
esize
,

323 
psize
)

325 
num
, 
ovîhód
;

328 
ovîhód
 = 
	`Æign_up
((
∑ge_hódî
), 1UL << 
Æign_bôs
);

329 
num
 = (
psize
 - 
ovîhód
Ë/ 
esize
;

331 
	`∑ge_hódî_size
(
Æign_bôs
, 
num
Ë+ 
esize
 *Çum > 
psize
)

332 
num
--;

333  
num
;

334 
	}
}

336 
boﬁ
 
	$œrge_∑ge_buckë
(
buckë
, 
•_bôs
)

338 
max_smÆlsize
;

341 
max_smÆlsize
 = (1UL << 
•_bôs
Ë>> 
MAX_PAGE_OBJECT_ORDER
;

343  
	`buckë_to_size
(
buckë
Ë> 
max_smÆlsize
;

344 
	}
}

346 
	$max_buckë
(
Õ_bôs
)

348  (
Õ_bôs
 - 
MAX_PAGE_OBJECT_ORDER
Ë* 
INTER_BUCKET_SPACE
;

349 
	}
}

351 
	$Æloc_öô
(*
poﬁ
, 
poﬁsize
)

353 
hódî
 *
hód
 = 
poﬁ
;

354 
∑ge_hódî
 *
ph
;

355 
Õ_bôs
, 
•_bôs
, 
num_buckës
;

356 
hódî_size
, 
i
;

358 i‡(
poﬁsize
 < 
MIN_USEFUL_SIZE
) {

359 
	`töy_Æloc_öô
(
poﬁ
, 
poﬁsize
);

364 
	`BUILD_ASSERT
(
MAX_SMALL_PAGES
 < 65536);

366 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

367 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

369 
num_buckës
 = 
	`max_buckë
(
Õ_bôs
);

371 
hód
 = 
poﬁ
;

372 
hódî_size
 = (*
hód
Ë+ (hód->
bs
Ë* (
num_buckës
-1);

374 
	`mem£t
(
hód
, 0, 
hódî_size
);

375 
i
 = 0; i < 
num_buckës
; i++) {

376 
∑gesize
;

378 i‡(
	`œrge_∑ge_buckë
(
i
, 
•_bôs
))

379 
∑gesize
 = 1UL << 
Õ_bôs
;

381 
∑gesize
 = 1UL << 
•_bôs
;

383 
hód
->
bs
[
i
].
ñemíts_≥r_∑ge


384 
	`ñemíts_≥r_∑ge
(
i
 / 
INTER_BUCKET_SPACE
,

385 
	`buckë_to_size
(
i
),

386 
∑gesize
);

390 
	`mem£t
(
hód
->
∑gesize
, 0xFF, (head->pagesize));

394 
	`as£π
(
hódî_size
 < (1UL << 
Õ_bôs
));

395 
	`˛ór_bô
(
hód
->
∑gesize
, 0);

398 
i
 = 
	`Æign_up
(
hódî_size
, (1UL << 
•_bôs
)) >> sp_bits;

399 
i
 < 
SMALL_PAGES_PER_LARGE_PAGE
;

400 
i
++) {

401 
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

402 
ph
->
ñemíts_u£d
 = 0;

403 
	`add_smÆl_∑ge_to_‰ìli°
(
hód
, 
ph
, 
•_bôs
);

407 
i
 = 
SMALL_PAGES_PER_LARGE_PAGE
;

408 (
i
 << 
•_bôs
Ë+ (1UL << 
Õ_bôs
Ë<
poﬁsize
) {

409 
	`as£π
(
i
 < 
MAX_SMALL_PAGES
);

410 
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

411 
ph
->
ñemíts_u£d
 = 0;

412 
	`add_œrge_∑ge_to_‰ìli°
(
hód
, 
ph
, 
•_bôs
);

413 
i
 +
SMALL_PAGES_PER_LARGE_PAGE
;

415 
	}
}

418 
	$dñ_œrge_‰om_smÆl_‰ì_li°
(
hódî
 *
hód
,

419 
∑ge_hódî
 *
ph
,

420 
•_bôs
)

422 
i
;

424 
i
 = 0; i < 
SMALL_PAGES_PER_LARGE_PAGE
; i++) {

425 
	`dñ_‰om_li°
(
hód
, &hód->
smÆl_‰ì_li°
,

426 (
∑ge_hódî
 *)((*)
ph


427 + (
i
 << 
•_bôs
)),

428 
•_bôs
);

430 
	}
}

432 
boﬁ
 
	$Æl_em±y
(
hódî
 *
hód
,

433 
pgnum
,

434 
•_bôs
)

436 
i
;

438 
i
 = 0; i < 
SMALL_PAGES_PER_LARGE_PAGE
; i++) {

439 
∑ge_hódî
 *
ph
 = 
	`‰om_pgnum
(
hód
, 
pgnum
 + 
i
, 
•_bôs
);

440 i‡(
ph
->
ñemíts_u£d
)

441  
Ál£
;

443  
åue
;

444 
	}
}

446 
	$ªcomböe_smÆl_∑ges
(
hódî
 *
hód
, 
poﬁsize
,

447 
•_bôs
)

449 
i
;

450 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

453 
i
 = 
SMALL_PAGES_PER_LARGE_PAGE
;

454 
i
 < (
poﬁsize
 >> 
Õ_bôs
Ë<< 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

455 
i
 +
SMALL_PAGES_PER_LARGE_PAGE
) {

457 i‡(
	`ã°_bô
(
hód
->
∑gesize
, 
i
 / 
SMALL_PAGES_PER_LARGE_PAGE
))

459 i‡(
	`Æl_em±y
(
hód
, 
i
, 
•_bôs
)) {

460 
∑ge_hódî
 *
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

461 
	`£t_bô
(
hód
->
∑gesize
,

462 
i
 / 
SMALL_PAGES_PER_LARGE_PAGE
);

463 
	`dñ_œrge_‰om_smÆl_‰ì_li°
(
hód
, 
ph
, 
•_bôs
);

464 
	`add_œrge_∑ge_to_‰ìli°
(
hód
, 
ph
, 
•_bôs
);

467 
	}
}

469 
u16
 
	$gë_œrge_∑ge
(
hódî
 *
hód
, 
poﬁsize
,

470 
•_bôs
)

472 
∑ge
;

474 
∑ge
 = 
	`p›_‰om_li°
(
hód
, &hód->
œrge_‰ì_li°
, 
•_bôs
);

475 i‡(
	`likñy
(
∑ge
))

476  
∑ge
;

478 
	`ªcomböe_smÆl_∑ges
(
hód
, 
poﬁsize
, 
•_bôs
);

480  
	`p›_‰om_li°
(
hód
, &hód->
œrge_‰ì_li°
, 
•_bôs
);

481 
	}
}

484 
	$bªak_up_œrge_∑ge
(
hódî
 *
hód
,

485 
•_bôs
,

486 
u16
 
Õage
)

488 
i
;

490 
	`˛ór_bô
(
hód
->
∑gesize
, 
Õage
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
);

492 
i
 = 1; i < 
SMALL_PAGES_PER_LARGE_PAGE
; i++) {

493 
∑ge_hódî
 *
ph
 = 
	`‰om_pgnum
(
hód
, 
Õage
 + 
i
, 
•_bôs
);

495 
ph
->
ñemíts_u£d
 = 0;

496 
	`add_smÆl_∑ge_to_‰ìli°
(
hód
, 
ph
, 
•_bôs
);

499  
Õage
;

500 
	}
}

502 
u16
 
	$gë_smÆl_∑ge
(
hódî
 *
hód
, 
poﬁsize
,

503 
•_bôs
)

505 
u16
 
ªt
;

507 
ªt
 = 
	`p›_‰om_li°
(
hód
, &hód->
smÆl_‰ì_li°
, 
•_bôs
);

508 i‡(
	`likñy
(
ªt
))

509  
ªt
;

510 
ªt
 = 
	`gë_œrge_∑ge
(
hód
, 
poﬁsize
, 
•_bôs
);

511 i‡(
	`likñy
(
ªt
))

512 
ªt
 = 
	`bªak_up_œrge_∑ge
(
hód
, 
•_bôs
,Ñet);

513  
ªt
;

514 
	}
}

516 
boﬁ
 
	$huge_Æloˇãd
(
hódî
 *
hód
, 
off£t
)

518 
i
;

519 
huge_Æloc
 *
ha
;

521 
i
 = 
hód
->
huge
; i; i = 
ha
->
√xt
) {

522 
ha
 = (*)((*)
hód
 + 
i
);

523 i‡(
ha
->
off
 <
off£t
 && ha->of‡+ ha->
Àn
 > offset)

524  
åue
;

526  
Ál£
;

527 
	}
}

530 
COLD
 *
	$huge_Æloc
(*
poﬁ
, 
poﬁsize
,

531 
size
, 
Æign
)

533 
hódî
 *
hód
 = 
poﬁ
;

534 
huge_Æloc
 *
ha
;

535 
i
, 
•_bôs
, 
Õ_bôs
, 
num
, 
hódî_size
;

537 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

538 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

541 
ha
 = 
	`Æloc_gë
(
poﬁ
, 
poﬁsize
, (*ha), 
	`ALIGNOF
(*ha));

542 i‡(!
ha
)

543  
NULL
;

546 
hódî_size
 = (*
hód
Ë+ (hód->
bs
Ë* (
	`max_buckë
(
Õ_bôs
)-1);

548 
num
 = 0;

549 
i
 = (
hódî_size
 + (1UL << 
•_bôs
) - 1) >> sp_bits;

550 
i
 << 
•_bôs
 < 
poﬁsize
;

551 
i
++) {

552 
∑ge_hódî
 *
pg
;

553 
off
 = (
i
 << 
•_bôs
);

556 i‡(
	`ã°_bô
(
hód
->
∑gesize
, 
i
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
)) {

557 
i
 +(1UL << 
BITS_FROM_SMALL_TO_LARGE_PAGE
)-1;

562 i‡(!
num
 && 
off
 % 
Æign
 != 0)

566 i‡(
	`huge_Æloˇãd
(
hód
, 
off
)) {

567 
num
 = 0;

571 
pg
 = (
∑ge_hódî
 *)((*)
hód
 + 
off
);

572 i‡(
pg
->
ñemíts_u£d
) {

573 
num
 = 0;

577 
num
++;

578 i‡(
num
 << 
•_bôs
 >
size
) {

579 
pgnum
;

582 
pgnum
 = 
i
;Ögnum > i - 
num
;Ögnum--) {

583 
pg
 = 
	`‰om_pgnum
(
hód
, 
pgnum
, 
•_bôs
);

584 
	`dñ_‰om_li°
(
hód
,

585 &
hód
->
smÆl_‰ì_li°
,

586 
pg
, 
•_bôs
);

588 
ha
->
off
 = (
i
 - 
num
 + 1Ë<< 
•_bôs
;

589 
ha
->
Àn
 = 
num
 << 
•_bôs
;

590 
d⁄e
;

595 
	`ªcomböe_smÆl_∑ges
(
hód
, 
poﬁsize
, 
•_bôs
);

597 
num
 = 0;

598 
i
 = (
hódî_size
 + (1UL << 
Õ_bôs
) - 1) >>Üp_bits;

599 (
i
 << 
Õ_bôs
Ë< 
poﬁsize
; i++) {

600 
∑ge_hódî
 *
pg
;

601 
off
 = (
i
 << 
Õ_bôs
);

604 i‡(!
	`ã°_bô
(
hód
->
∑gesize
, 
i
))

608 i‡(!
num
 && 
off
 % 
Æign
 != 0)

612 i‡(
	`huge_Æloˇãd
(
hód
, 
off
)) {

613 
num
 = 0;

617 
pg
 = (
∑ge_hódî
 *)((*)
hód
 + 
off
);

618 i‡(
pg
->
ñemíts_u£d
) {

619 
num
 = 0;

623 
num
++;

624 i‡(
num
 << 
Õ_bôs
 >
size
) {

625 
pgnum
;

628 
pgnum
 = 
i
;Ögnum > i - 
num
;Ögnum--) {

629 
pg
 = 
	`‰om_pgnum
(
hód
, 
pgnum
, 
Õ_bôs
);

630 
	`dñ_‰om_li°
(
hód
,

631 &
hód
->
œrge_‰ì_li°
,

632 
pg
, 
•_bôs
);

634 
ha
->
off
 = (
i
 - 
num
 + 1Ë<< 
Õ_bôs
;

635 
ha
->
Àn
 = 
num
 << 
Õ_bôs
;

636 
d⁄e
;

641 
	`Æloc_‰ì
(
poﬁ
, 
poﬁsize
, 
ha
);

642  
NULL
;

644 
d⁄e
:

645 
	`add_to_huge_li°
(
poﬁ
, 
ha
);

646  (*)
poﬁ
 + 
ha
->
off
;

647 
	}
}

649 
COLD
 

650 
	$huge_‰ì
(
hódî
 *
hód
, 
poﬁsize
, *
‰ì
)

652 
i
, 
off
, 
pgnum
, 
‰ì_off
 = (*)
‰ì
 - (*)
hód
;

653 
•_bôs
, 
Õ_bôs
;

654 
huge_Æloc
 *
ha
;

656 
i
 = 
hód
->
huge
; i; i = 
ha
->
√xt
) {

657 
ha
 = (*)((*)
hód
 + 
i
);

658 i‡(
‰ì_off
 =
ha
->
off
)

661 
	`as£π
(
i
);

664 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

665 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

666 
pgnum
 = 
‰ì_off
 >> 
•_bôs
;

668 i‡(
	`ã°_bô
(
hód
->
∑gesize
, 
pgnum
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
)) {

669 
off
 = 
ha
->off;

670 
off
 < 
ha
->of‡+ ha->
Àn
;

671 
off
 +1UL << 
Õ_bôs
) {

672 
	`add_œrge_∑ge_to_‰ìli°
(
hód
,

673 (*)((*)
hód
 + 
off
),

674 
•_bôs
);

677 
off
 = 
ha
->off;

678 
off
 < 
ha
->of‡+ ha->
Àn
;

679 
off
 +1UL << 
•_bôs
) {

680 
	`add_smÆl_∑ge_to_‰ìli°
(
hód
,

681 (*)((*)
hód
 + 
off
),

682 
•_bôs
);

685 
	`dñ_‰om_huge
(
hód
, 
ha
);

686 
	`Æloc_‰ì
(
hód
, 
poﬁsize
, 
ha
);

687 
	}
}

689 
COLD
 
	$huge_size
(
hódî
 *
hód
, *
p
)

691 
i
, 
off
 = (*)
p
 - (*)
hód
;

692 
huge_Æloc
 *
ha
;

694 
i
 = 
hód
->
huge
; i; i = 
ha
->
√xt
) {

695 
ha
 = (*)((*)
hód
 + 
i
);

696 i‡(
off
 =
ha
->off) {

697  
ha
->
Àn
;

700 
	`ab‹t
();

701 
	}
}

703 *
	$Æloc_gë
(*
poﬁ
, 
poﬁsize
,

704 
size
, 
Æign
)

706 
hódî
 *
hód
 = 
poﬁ
;

707 
buckë
;

708 
i
;

709 
buckë_°©e
 *
bs
;

710 
∑ge_hódî
 *
ph
;

711 
•_bôs
;

713 i‡(
poﬁsize
 < 
MIN_USEFUL_SIZE
) {

714  
	`töy_Æloc_gë
(
poﬁ
, 
poﬁsize
, 
size
, 
Æign
);

717 
size
 = 
	`Æign_up
(size, 
Æign
);

718 i‡(
	`u∆ikñy
(!
size
))

719 
size
 = 1;

720 
buckë
 = 
	`size_to_buckë
(
size
);

722 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

724 i‡(
buckë
 >
	`max_buckë
(
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
)) {

725  
	`huge_Æloc
(
poﬁ
, 
poﬁsize
, 
size
, 
Æign
);

728 
bs
 = &
hód
->bs[
buckë
];

730 i‡(!
bs
->
∑ge_li°
) {

731 
∑ge_hódî
 *
ph
;

733 i‡(
	`œrge_∑ge_buckë
(
buckë
, 
•_bôs
))

734 
bs
->
∑ge_li°
 = 
	`gë_œrge_∑ge
(
hód
, 
poﬁsize
,

735 
•_bôs
);

737 
bs
->
∑ge_li°
 = 
	`gë_smÆl_∑ge
(
hód
, 
poﬁsize
,

738 
•_bôs
);

740 i‡(
	`u∆ikñy
(!
bs
->
∑ge_li°
))

741  
NULL
;

742 
ph
 = 
	`‰om_pgnum
(
hód
, 
bs
->
∑ge_li°
, 
•_bôs
);

743 
ph
->
buckë
 = bucket;

744 
ph
->
ñemíts_u£d
 = 0;

745 
ph
->
√xt
 = 0;

746 
	`mem£t
(
ph
->
u£d
, 0, 
	`u£d_size
(
bs
->
ñemíts_≥r_∑ge
));

749 
ph
 = 
	`‰om_pgnum
(
hód
, 
bs
->
∑ge_li°
, 
•_bôs
);

751 
i
 = 
	`föd_‰ì_bô
(
ph
->
u£d
);

752 
	`£t_bô
(
ph
->
u£d
, 
i
);

753 
ph
->
ñemíts_u£d
++;

756 i‡(
	`u∆ikñy
(
ph
->
ñemíts_u£d
 =
bs
->
ñemíts_≥r_∑ge
)) {

757 
	`dñ_‰om_buckë_li°
(
hód
, 
bs
, 
ph
, 
•_bôs
);

758 
	`add_to_buckë_fuŒ_li°
(
hód
, 
bs
, 
ph
, 
•_bôs
);

761  (*)
ph
 + 
	`∑ge_hódî_size
’h->
buckë
 / 
INTER_BUCKET_SPACE
,

762 
bs
->
ñemíts_≥r_∑ge
)

763 + 
i
 * 
	`buckë_to_size
(
buckë
);

764 
	}
}

766 
	$Æloc_‰ì
(*
poﬁ
, 
poﬁsize
, *
‰ì
)

768 
hódî
 *
hód
 = 
poﬁ
;

769 
buckë_°©e
 *
bs
;

770 
•_bôs
;

771 
i
, 
pgnum
, 
pgoff£t
, 
off£t
 = (*)
‰ì
 - (*)
poﬁ
;

772 
boﬁ
 
smÆÕage
;

773 
∑ge_hódî
 *
ph
;

775 i‡(
poﬁsize
 < 
MIN_USEFUL_SIZE
) {

776 
	`töy_Æloc_‰ì
(
poﬁ
, 
poﬁsize
, 
‰ì
);

781 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

782 
pgnum
 = 
off£t
 >> 
•_bôs
;

785 i‡(
	`ã°_bô
(
hód
->
∑gesize
, 
pgnum
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
)) {

786 
smÆÕage
 = 
Ál£
;

787 
pgnum
 &~(
SMALL_PAGES_PER_LARGE_PAGE
 - 1);

789 
smÆÕage
 = 
åue
;

792 
ph
 = 
	`‰om_pgnum
(
hód
, 
pgnum
, 
•_bôs
);

793 i‡((*)
ph
 =
‰ì
) {

794 
	`huge_‰ì
(
hód
, 
poﬁsize
, 
‰ì
);

798 
bs
 = &
hód
->bs[
ph
->
buckë
];

799 
pgoff£t
 = 
off£t
 - (
pgnum
 << 
•_bôs
)

800 - 
	`∑ge_hódî_size
(
ph
->
buckë
 / 
INTER_BUCKET_SPACE
,

801 
bs
->
ñemíts_≥r_∑ge
);

803 i‡(
	`u∆ikñy
(
ph
->
ñemíts_u£d
 =
bs
->
ñemíts_≥r_∑ge
)) {

804 
	`dñ_‰om_buckë_fuŒ_li°
(
hód
, 
bs
, 
ph
, 
•_bôs
);

805 
	`add_to_buckë_li°
(
hód
, 
bs
, 
ph
, 
•_bôs
);

809 
i
 = 
pgoff£t
 / 
	`buckë_to_size
(
ph
->
buckë
);

810 
	`˛ór_bô
(
ph
->
u£d
, 
i
);

811 
ph
->
ñemíts_u£d
--;

813 i‡(
	`u∆ikñy
(
ph
->
ñemíts_u£d
 == 0)) {

814 
bs
 = &
hód
->bs[
ph
->
buckë
];

815 
	`dñ_‰om_buckë_li°
(
hód
, 
bs
, 
ph
, 
•_bôs
);

816 i‡(
smÆÕage
)

817 
	`add_smÆl_∑ge_to_‰ìli°
(
hód
, 
ph
, 
•_bôs
);

819 
	`add_œrge_∑ge_to_‰ìli°
(
hód
, 
ph
, 
•_bôs
);

821 
	}
}

823 
	$Æloc_size
(*
poﬁ
, 
poﬁsize
, *
p
)

825 
hódî
 *
hód
 = 
poﬁ
;

826 
pgnum
, 
•_bôs
;

827 
off£t
 = (*)
p
 - (*)
poﬁ
;

828 
∑ge_hódî
 *
ph
;

830 i‡(
poﬁsize
 < 
MIN_USEFUL_SIZE
)

831  
	`töy_Æloc_size
(
poﬁ
, 
poﬁsize
, 
p
);

834 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

835 
pgnum
 = 
off£t
 >> 
•_bôs
;

838 i‡(
	`ã°_bô
(
hód
->
∑gesize
, 
pgnum
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
))

839 
pgnum
 &~(
SMALL_PAGES_PER_LARGE_PAGE
 - 1);

842 
ph
 = 
	`‰om_pgnum
(
hód
, 
pgnum
, 
•_bôs
);

843 i‡((*)
ph
 =
p
)

844  
	`huge_size
(
hód
, 
p
);

846  
	`buckë_to_size
(
ph
->
buckë
);

847 
	}
}

850 
boﬁ
 
	$check_Áû
()

852  
Ál£
;

853 
	}
}

855 
	$cou¡_bôs
(c⁄° 
bôm≠
[],

856 
limô
)

858 
i
, 
cou¡
 = 0;

860 
limô
 >
BITS_PER_LONG
) {

861 
cou¡
 +
	`p›cou¡
(
bôm≠
[0]);

862 
bôm≠
++;

863 
limô
 -
BITS_PER_LONG
;

866 
i
 = 0; i < 
limô
; i++)

867 i‡(
	`ã°_bô
(
bôm≠
, 
i
))

868 
cou¡
++;

869  
cou¡
;

870 
	}
}

872 
boﬁ
 
	$out_of_bounds
(
pgnum
,

873 
•_bôs
,

874 
∑gesize
,

875 
poﬁsize
)

877 i‡(((
pgnum
 << 
•_bôs
) >> sp_bits) !=Ögnum)

878  
åue
;

880 i‡((
pgnum
 << 
•_bôs
Ë> 
poﬁsize
)

881  
åue
;

883  ((
pgnum
 << 
•_bôs
Ë+ 
∑gesize
 > 
poﬁsize
);

884 
	}
}

886 
boﬁ
 
	$check_buckë
(
hódî
 *
hód
,

887 
poﬁsize
,

888 
∑ges
[],

889 
buckë_°©e
 *
bs
,

890 
bödex
)

892 
boﬁ
 
Õ_buckë
;

893 
∑ge_hódî
 *
ph
;

894 
èkí
, 
i
, 
¥ev
, 
∑gesize
, 
•_bôs
, 
Õ_bôs
;

896 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

897 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

899 
Õ_buckë
 = 
	`œrge_∑ge_buckë
(
bödex
, 
•_bôs
);

901 
∑gesize
 = 1UL << (
Õ_buckë
 ? 
Õ_bôs
 : 
•_bôs
);

904 
èkí
 = 
	`∑ge_hódî_size
(
bödex
 / 
INTER_BUCKET_SPACE
,

905 
bs
->
ñemíts_≥r_∑ge
);

906 
èkí
 +
	`buckë_to_size
(
bödex
Ë* 
bs
->
ñemíts_≥r_∑ge
;

907 i‡(
èkí
 > 
∑gesize
)

908  
	`check_Áû
();

911 
èkí
 = 
	`∑ge_hódî_size
(
bödex
 / 
INTER_BUCKET_SPACE
,

912 
bs
->
ñemíts_≥r_∑ge
 + 1);

913 
èkí
 +
	`buckë_to_size
(
bödex
Ë* (
bs
->
ñemíts_≥r_∑ge
 + 1);

914 i‡(
èkí
 <
∑gesize
)

915  
	`check_Áû
();

918 
¥ev
 = 0;

919 
i
 = 
bs
->
∑ge_li°
; i; i = 
ph
->
√xt
) {

921 i‡(
	`out_of_bounds
(
i
, 
•_bôs
, 
∑gesize
, 
poﬁsize
))

922  
	`check_Áû
();

924 i‡(!!
	`ã°_bô
(
hód
->
∑gesize
, 
i
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
)

925 !
Õ_buckë
)

926  
	`check_Áû
();

928 i‡(
Õ_buckë
 && (
i
 % 
SMALL_PAGES_PER_LARGE_PAGE
) != 0)

929  
	`check_Áû
();

930 
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

932 i‡(
ph
->
¥ev
 !=Örev)

933  
	`check_Áû
();

935 i‡(
	`ã°_bô
(
∑ges
, 
i
))

936  
	`check_Áû
();

937 
	`£t_bô
(
∑ges
, 
i
);

939 i‡(
ph
->
ñemíts_u£d
 == 0)

940  
	`check_Áû
();

941 i‡(
ph
->
ñemíts_u£d
 >
bs
->
ñemíts_≥r_∑ge
)

942  
	`check_Áû
();

944 i‡(
ph
->
ñemíts_u£d
 !
	`cou¡_bôs
’h->
u£d
,

945 
bs
->
ñemíts_≥r_∑ge
))

946  
	`check_Áû
();

948 i‡(
ph
->
buckë
 !
bödex
)

949  
	`check_Áû
();

950 
¥ev
 = 
i
;

954 
¥ev
 = 0;

955 
i
 = 
bs
->
fuŒ_li°
; i; i = 
ph
->
√xt
) {

957 i‡(
	`out_of_bounds
(
i
, 
•_bôs
, 
∑gesize
, 
poﬁsize
))

958  
	`check_Áû
();

960 i‡(!!
	`ã°_bô
(
hód
->
∑gesize
, 
i
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
)

961 !
Õ_buckë
)

963 i‡(
Õ_buckë
 && (
i
 % 
SMALL_PAGES_PER_LARGE_PAGE
) != 0)

964  
	`check_Áû
();

965 
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

967 i‡(
ph
->
¥ev
 !=Örev)

968  
	`check_Áû
();

970 i‡(
	`ã°_bô
(
∑ges
, 
i
))

971  
	`check_Áû
();

972 
	`£t_bô
(
∑ges
, 
i
);

974 i‡(
ph
->
ñemíts_u£d
 !
bs
->
ñemíts_≥r_∑ge
)

975  
	`check_Áû
();

977 i‡(
ph
->
ñemíts_u£d
 !
	`cou¡_bôs
’h->
u£d
,

978 
bs
->
ñemíts_≥r_∑ge
))

979  
	`check_Áû
();

981 i‡(
ph
->
buckë
 !
bödex
)

982  
	`check_Áû
();

983 
¥ev
 = 
i
;

985  
åue
;

986 
	}
}

988 
boﬁ
 
	$Æloc_check
(*
poﬁ
, 
poﬁsize
)

990 
hódî
 *
hód
 = 
poﬁ
;

991 
¥ev
, 
i
, 
Õ_bôs
, 
•_bôs
, 
hódî_size
, 
num_buckës
;

992 
∑ge_hódî
 *
ph
;

993 
huge_Æloc
 *
ha
;

994 
∑ges
[
MAX_SMALL_PAGES
 / 
BITS_PER_LONG
] = { 0 };

996 i‡(
poﬁsize
 < 
MIN_USEFUL_SIZE
)

997  
	`töy_Æloc_check
(
poﬁ
, 
poﬁsize
);

999 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

1000 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

1002 
num_buckës
 = 
	`max_buckë
(
Õ_bôs
);

1004 
hódî_size
 = (*
hód
Ë+ (hód->
bs
Ë* (
num_buckës
-1);

1007 
i
 = 0; i < 
hódî_size
; i +(1UL << 
•_bôs
))

1008 
	`£t_bô
(
∑ges
, 
i
 >> 
•_bôs
);

1011 
¥ev
 = 0;

1012 
i
 = 
hód
->
smÆl_‰ì_li°
; i; i = 
ph
->
√xt
) {

1014 i‡(
	`out_of_bounds
(
i
, 
•_bôs
, 1UL << sp_bôs, 
poﬁsize
))

1015  
	`check_Áû
();

1017 i‡(
	`ã°_bô
(
hód
->
∑gesize
, 
i
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
))

1018  
	`check_Áû
();

1019 
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

1021 i‡(
ph
->
¥ev
 !=Örev)

1022  
	`check_Áû
();

1024 i‡(
	`ã°_bô
(
∑ges
, 
i
))

1025  
	`check_Áû
();

1026 
	`£t_bô
(
∑ges
, 
i
);

1027 
¥ev
 = 
i
;

1031 
¥ev
 = 0;

1032 
i
 = 
hód
->
œrge_‰ì_li°
; i; i = 
ph
->
√xt
) {

1034 i‡(
	`out_of_bounds
(
i
, 
•_bôs
, 1UL << 
Õ_bôs
, 
poﬁsize
))

1035  
	`check_Áû
();

1037 i‡(!
	`ã°_bô
(
hód
->
∑gesize
, 
i
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
))

1038  
	`check_Áû
();

1040 i‡((
i
 % 
SMALL_PAGES_PER_LARGE_PAGE
) != 0)

1041  
	`check_Áû
();

1042 
ph
 = 
	`‰om_pgnum
(
hód
, 
i
, 
•_bôs
);

1044 i‡(
ph
->
¥ev
 !=Örev)

1045  
	`check_Áû
();

1047 i‡(
	`ã°_bô
(
∑ges
, 
i
))

1048  
	`check_Áû
();

1049 
	`£t_bô
(
∑ges
, 
i
);

1050 
¥ev
 = 
i
;

1054 
i
 = 0; i < 
	`max_buckë
(
Õ_bôs
); i++) {

1055 
buckë_°©e
 *
bs
 = &
hód
->bs[
i
];

1057 i‡(!
	`check_buckë
(
hód
, 
poﬁsize
, 
∑ges
, 
bs
, 
i
))

1058  
Ál£
;

1062 
¥ev
 = 0;

1063 
i
 = 
hód
->
huge
; i; i = 
ha
->
√xt
) {

1064 
pgbôs
, 
j
;

1067 i‡(
i
 >
poﬁsize
 || i + (*
ha
) >Öoolsize)

1068  
	`check_Áû
();

1069 
ha
 = (*)((*)
hód
 + 
i
);

1072 i‡(
ha
->
off
 > 
poﬁsize
 || ha->of‡+ ha->
Àn
 >Öoolsize)

1073  
	`check_Áû
();

1076 
pgbôs
 = 
	`ã°_bô
(
hód
->
∑gesize
, 
ha
->
off
 >> 
Õ_bôs
)

1077 ? 
Õ_bôs
 : 
•_bôs
;

1080 i‡((
ha
->
off
 % (1UL << 
pgbôs
)) != 0)

1081  
	`check_Áû
();

1084 i‡((
ha
->
Àn
 % (1UL << 
pgbôs
)) != 0)

1085  
	`check_Áû
();

1088 i‡(
ha
->
¥ev
 !=Örev)

1089  
	`check_Áû
();

1091 
j
 = 
ha
->
off
; j < ha->of‡+ ha->
Àn
; j +(1UL<<
•_bôs
)) {

1093 i‡(
	`ã°_bô
(
∑ges
, 
j
 >> 
•_bôs
))

1094  
	`check_Áû
();

1095 
	`£t_bô
(
∑ges
, 
j
 >> 
•_bôs
);

1098 
¥ev
 = 
i
;

1102 
i
 = 0; i < 
poﬁsize
 >> 
•_bôs
; i++) {

1103 i‡(!
	`ã°_bô
(
∑ges
, 
i
))

1104  
	`check_Áû
();

1105 i‡(
	`ã°_bô
(
hód
->
∑gesize
,

1106 
i
 >> 
BITS_FROM_SMALL_TO_LARGE_PAGE
)) {

1108 
i
 +
SMALL_PAGES_PER_LARGE_PAGE
 - 1;

1112  
åue
;

1113 
	}
}

1115 
	$¥öt_ovîhód
(
FILE
 *
out
, c⁄° *
desc
,

1116 
byãs
,

1117 
poﬁsize
)

1119 
	`Ârötf
(
out
, "Overhead (%s): %lu bytes (%.3g%%)\n",

1120 
desc
, 
byãs
, 100.0 * byã†/ 
poﬁsize
);

1121  
byãs
;

1122 
	}
}

1124 
	$cou¡_li°
(
hódî
 *
hód
,

1125 
u16
 
pgnum
,

1126 
•_bôs
,

1127 *
tŸÆ_ñems
)

1129 
∑ge_hódî
 *
p
;

1130 
ªt
 = 0;

1132 
pgnum
) {

1133 
p
 = 
	`‰om_pgnum
(
hód
, 
pgnum
, 
•_bôs
);

1134 i‡(
tŸÆ_ñems
)

1135 (*
tŸÆ_ñems
Ë+
p
->
ñemíts_u£d
;

1136 
ªt
++;

1137 
pgnum
 = 
p
->
√xt
;

1139  
ªt
;

1140 
	}
}

1142 
	$visuÆize_buckë
(
FILE
 *
out
, 
hódî
 *
hód
,

1143 
buckë
,

1144 
poﬁsize
,

1145 
•_bôs
)

1147 
num_fuŒ
, 
num_∑πül
, 
num_∑ges
, 
∑ge_size
,

1148 
ñems
, 
hdr_mö
, 
hdr_size
, 
ñems_≥r_∑ge
, 
ovîhód
 = 0;

1150 
ñems_≥r_∑ge
 = 
hód
->
bs
[
buckë
].
ñemíts_≥r_∑ge
;

1153 
hdr_mö
 = (
∑ge_hódî
)

1154 - (((
∑ge_hódî
 *)0)->
u£d
)

1155 + 
	`Æign_up
(
ñems_≥r_∑ge
, 
CHAR_BIT
) / CHAR_BIT;

1156 
hdr_size
 = 
	`∑ge_hódî_size
(
buckë
 / 
INTER_BUCKET_SPACE
,

1157 
ñems_≥r_∑ge
);

1159 
ñems
 = 0;

1160 
num_fuŒ
 = 
	`cou¡_li°
(
hód
, hód->
bs
[
buckë
].
fuŒ_li°
, 
•_bôs
,

1161 &
ñems
);

1162 
num_∑πül
 = 
	`cou¡_li°
(
hód
, hód->
bs
[
buckë
].
∑ge_li°
, 
•_bôs
,

1163 &
ñems
);

1164 
num_∑ges
 = 
num_fuŒ
 + 
num_∑πül
;

1165 i‡(!
num_∑ges
)

1168 
	`Ârötf
(
out
, "Bucket %u (%lu bytes):"

1170 
buckë
, 
	`buckë_to_size
(buckë), 
num_fuŒ
, 
num_∑πül
, 
ñems
);

1172 
ovîhód
 +
	`¥öt_ovîhód
(
out
, "page headers",

1173 
hdr_mö
 * 
num_∑ges
, 
poﬁsize
);

1175 
ovîhód
 +
	`¥öt_ovîhód
(
out
, "pageÖost-headerálignments",

1176 (
hdr_size
 - 
hdr_mö
Ë* 
num_∑ges
, 
poﬁsize
);

1178 
∑ge_size
 = (1UL << 
•_bôs
);

1179 i‡(
	`œrge_∑ge_buckë
(
buckë
, 
•_bôs
))

1180 
∑ge_size
 <<
BITS_FROM_SMALL_TO_LARGE_PAGE
;

1182 
ovîhód
 +
	`¥öt_ovîhód
(
out
, "pageÅails",

1183 (
∑ge_size
 - (
hdr_size


1184 + (
ñems_≥r_∑ge


1185 * 
	`buckë_to_size
(
buckë
))))

1186 * 
num_∑ges
, 
poﬁsize
);

1187  
ovîhód
;

1188 
	}
}

1190 
	$Æloc_visuÆize
(
FILE
 *
out
, *
poﬁ
, 
poﬁsize
)

1192 
hódî
 *
hód
 = 
poﬁ
;

1193 
i
, 
Õ_bôs
, 
•_bôs
, 
hódî_size
, 
num_buckës
, 
cou¡
,

1194 
ovîhód
 = 0;

1196 
	`Ârötf
(
out
, "Poﬁ %∞sizê%lu: (%†Æloˇt‹)\n", 
poﬁ
, 
poﬁsize
,

1197 
poﬁsize
 < 
MIN_USEFUL_SIZE
 ? "tiny" : "standard");

1199 i‡(
poﬁsize
 < 
MIN_USEFUL_SIZE
) {

1200 
	`töy_Æloc_visuÆize
(
out
, 
poﬁ
, 
poﬁsize
);

1204 
•_bôs
 = 
	`smÆl_∑ge_bôs
(
poﬁsize
);

1205 
Õ_bôs
 = 
•_bôs
 + 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

1207 
num_buckës
 = 
	`max_buckë
(
Õ_bôs
);

1208 
hódî_size
 = (*
hód
Ë+ (hód->
bs
Ë* (
num_buckës
-1);

1210 
	`Ârötf
(
out
, "LargeÖage size %lu, smallÖage size %lu.\n",

1211 1UL << 
Õ_bôs
, 1UL << 
•_bôs
);

1212 
ovîhód
 +
	`¥öt_ovîhód
(
out
, "unusedÖoolÅail",

1213 
poﬁsize
 % (1UL << 
Õ_bôs
),Öoolsize);

1214 
	`Ârötf
(
out
, "Main header %lu bytes (%lu smallÖages).\n",

1215 
hódî_size
, 
	`Æign_up
(hódî_size, 1UL << 
•_bôs
) >> sp_bits);

1216 
ovîhód
 +
	`¥öt_ovîhód
(
out
, "partial headerÖage",

1217 
	`Æign_up
(
hódî_size
, 1UL << 
•_bôs
)

1218 - 
hódî_size
, 
poﬁsize
);

1220 
i
 = 
	`cou¡_bôs
(
hód
->
∑gesize
, 
poﬁsize
 >> 
Õ_bôs
);

1222 
cou¡
 = 
i
 - 
	`cou¡_li°
(
hód
, hód->
œrge_‰ì_li°
, 
•_bôs
, 
NULL
);

1223 
	`Ârötf
(
out
, "%lu/%luÜargeÖages used (%.3g%%)\n",

1224 
cou¡
, 
i
, count ? 100.0 * count / i : 0.0);

1227 
i
 = ((
poﬁsize
 >> 
Õ_bôs
Ë- iË<< 
BITS_FROM_SMALL_TO_LARGE_PAGE
;

1229 
cou¡
 = 
i
 - 
	`cou¡_li°
(
hód
, hód->
smÆl_‰ì_li°
, 
•_bôs
, 
NULL
);

1230 
	`Ârötf
(
out
, "%lu/%lu smallÖages used (%.3g%%)\n",

1231 
cou¡
, 
i
, count ? 100.0 * count / i : 0.0);

1234 
	`Ârötf
(
out
, "%lu buckës:\n", 
num_buckës
);

1235 
i
 = 0; i < 
num_buckës
; i++)

1236 
ovîhód
 +
	`visuÆize_buckë
(
out
, 
hód
, 
i
, 
poﬁsize
, 
•_bôs
);

1238 
	`¥öt_ovîhód
(
out
, "tŸÆ", 
ovîhód
, 
poﬁsize
);

1239 
	}
}

	@ccan/ccan/antithread/alloc/alloc.h

2 #i‚de‡
ALLOC_H


3 
	#ALLOC_H


	)

4 
	~<°dio.h
>

5 
	~<°dboﬁ.h
>

27 
Æloc_öô
(*
poﬁ
, 
poﬁsize
);

53 *
Æloc_gë
(*
poﬁ
, 
poﬁsize
,

54 
size
, 
Æign
);

69 
Æloc_‰ì
(*
poﬁ
, 
poﬁsize
, *
‰ì
);

86 
Æloc_size
(*
poﬁ
, 
poﬁsize
, *
p
);

107 
boﬁ
 
Æloc_check
(*
poﬁ
, 
poﬁsize
);

129 
Æloc_visuÆize
(
FILE
 *
out
, *
poﬁ
, 
poﬁsize
);

	@ccan/ccan/antithread/alloc/bitops.c

2 
	~"bô›s.h
"

3 
	~"c⁄fig.h
"

4 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

5 
	~<cˇn/sh‹t_ty≥s/sh‹t_ty≥s.h
>

6 
	~<cˇn/ûog/ûog.h
>

7 
	~<limôs.h
>

9 
	$aÊs
(
vÆ
)

11 
	`BUILD_ASSERT
((
vÆ
Ë=(
u32
Ë|| (vÆË=(
u64
));

12 i‡((
vÆ
Ë=(
u32
))

13  
	`ûog32
(
vÆ
);

15  
	`ûog64
(
vÆ
);

16 
	}
}

19 
	$aff¶
(
vÆ
)

21 #i‡
HAVE_BUILTIN_FFSL


23  
	`__buûtö_ff¶
(
vÆ
);

25 
r
 = 1;

27 i‡(!
vÆ
)

29 i‡((Ë=(
u64
)) {

30 i‡(!(
vÆ
 & 0xffffffff)) {

33 
u64
 
tmp
 = 
vÆ
;

34 
tmp
 >>= 32;

35 
vÆ
 = 
tmp
;

36 
r
 += 32;

39 i‡(!(
vÆ
 & 0xffff)) {

40 
vÆ
 >>= 16;

41 
r
 += 16;

43 i‡(!(
vÆ
 & 0xff)) {

44 
vÆ
 >>= 8;

45 
r
 += 8;

47 i‡(!(
vÆ
 & 0xf)) {

48 
vÆ
 >>= 4;

49 
r
 += 4;

51 i‡(!(
vÆ
 & 3)) {

52 
vÆ
 >>= 2;

53 
r
 += 2;

55 i‡(!(
vÆ
 & 1)) {

56 
vÆ
 >>= 1;

57 
r
 += 1;

59  
r
;

61 
	}
}

63 
	$p›cou¡
(
vÆ
)

65 #i‡
HAVE_BUILTIN_POPCOUNTL


66  
	`__buûtö_p›cou¡l
(
vÆ
);

68 i‡((Ë=(
u64
)) {

69 
u64
 
v
 = 
vÆ
;

70 
v
 = (v & 0x5555555555555555ULL)

71 + ((
v
 >> 1) & 0x5555555555555555ULL);

72 
v
 = (v & 0x3333333333333333ULL)

73 + ((
v
 >> 2) & 0x3333333333333333ULL);

74 
v
 = (v & 0x0F0F0F0F0F0F0F0FULL)

75 + ((
v
 >> 4) & 0x0F0F0F0F0F0F0F0FULL);

76 
v
 = (v & 0x00FF00FF00FF00FFULL)

77 + ((
v
 >> 8) & 0x00FF00FF00FF00FFULL);

78 
v
 = (v & 0x0000FFFF0000FFFFULL)

79 + ((
v
 >> 16) & 0x0000FFFF0000FFFFULL);

80 
v
 = (v & 0x00000000FFFFFFFFULL)

81 + ((
v
 >> 32) & 0x00000000FFFFFFFFULL);

82  
v
;

84 
vÆ
 = (val & 0x55555555ULL) + ((val >> 1) & 0x55555555ULL);

85 
vÆ
 = (val & 0x33333333ULL) + ((val >> 2) & 0x33333333ULL);

86 
vÆ
 = (val & 0x0F0F0F0FULL) + ((val >> 4) & 0x0F0F0F0FULL);

87 
vÆ
 = (val & 0x00FF00FFULL) + ((val >> 8) & 0x00FF00FFULL);

88 
vÆ
 = (val & 0x0000FFFFULL) + ((val >> 16) & 0x0000FFFFULL);

89  
vÆ
;

91 
	}
}

93 
	$Æign_up
(
x
, 
Æign
)

95  (
x
 + 
Æign
 - 1) & ~(align - 1);

96 
	}
}

	@ccan/ccan/antithread/alloc/bitops.h

2 #i‚de‡
CCAN_ALLOC_BITOPS_H


3 
	#CCAN_ALLOC_BITOPS_H


	)

4 
aÊs
(
vÆ
);

5 
aff¶
(
vÆ
);

6 
p›cou¡
(
vÆ
);

7 
Æign_up
(
x
, 
Æign
);

	@ccan/ccan/antithread/alloc/test/run-corrupt.c

2 
	~<cˇn/™tôhªad/Æloc/Æloc.c
>

3 
	~<cˇn/™tôhªad/Æloc/bô›s.c
>

4 
	~<cˇn/™tôhªad/Æloc/töy.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<°dlib.h
>

8 
	$maö
(
¨gc
, *
¨gv
[])

10 *
mem
;

12 
	`∂™_ã°s
(7);

14 
mem
 = 
	`mÆloc
(1179648);

15 
	`Æloc_öô
(
mem
, 1179648);

16 
	`ok1
(
	`Æloc_check
(
mem
, 1179648));

17 
	`ok1
(
	`Æloc_gë
(
mem
, 1179648, 48, 16));

18 
	`ok1
(
	`Æloc_check
(
mem
, 1179648));

19 
	`ok1
(
	`Æloc_gë
(
mem
, 1179648, 53, 16));

20 
	`ok1
(
	`Æloc_check
(
mem
, 1179648));

21 
	`ok1
(
	`Æloc_gë
(
mem
, 1179648, 53, 16));

22 
	`ok1
(
	`Æloc_check
(
mem
, 1179648));

23 
	`‰ì
(
mem
);

25  
	`exô_°©us
();

26 
	}
}

	@ccan/ccan/antithread/alloc/test/run-testsize.c

1 
	~<cˇn/™tôhªad/Æloc/Æloc.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/™tôhªad/Æloc/Æloc.c
>

4 
	~<cˇn/™tôhªad/Æloc/bô›s.c
>

5 
	~<cˇn/™tôhªad/Æloc/töy.c
>

6 
	~<°dlib.h
>

7 
	~<°dboﬁ.h
>

8 
	~<îr.h
>

10 
	$övît_byãs
(*
p
, 
size
)

12 
i
;

14 
i
 = 0; i < 
size
; i++)

15 
p
[
i
] ^= 0xFF;

16 
	}
}

18 
boﬁ
 
	$sizes_ok
(*
mem
, 
poﬁsize
, *
p
[], 
num
)

20 
i
;

22 
i
 = 0; i < 
num
; i++)

23 i‡(
p
[
i
] && 
	`Æloc_size
(
mem
, 
poﬁsize
,Ö[i]) < i)

24  
Ál£
;

25  
åue
;

26 
	}
}

28 
	$ã°_poﬁ
(
poﬁ_size
)

30 
i
, 
num
;

31 *
mem
;

32 **
p
;

33 
boﬁ
 
Êù
 = 
Ál£
;

35 
p
 = 
	`ˇŒoc
(
poﬁ_size
, (*));

36 
mem
 = 
	`mÆloc
(
poﬁ_size
);

38 
	`Æloc_öô
(
mem
, 
poﬁ_size
);

41 
i
 = 0; i < 
poﬁ_size
; i = i * 3 / 2 + 1) {

42 
p
[
i
] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, i, 1);

43 i‡(!
p
[
i
])

45 
	`övît_byãs
(
p
[
i
], 
	`Æloc_size
(
mem
, 
poﬁ_size
,Ö[i]));

47 
	`ok1
(
i
 < 
poﬁ_size
);

48 
num
 = 
i
;

49 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

50 
	`ok1
(
	`sizes_ok
(
mem
, 
poﬁ_size
, 
p
, 
num
));

53 
i
 = 0; i < 
num
; i = i * 3 / 2 + 1) {

54 
Êù
 = !flip;

55 i‡(
Êù
) {

56 
	`övît_byãs
(
p
[
i
], 
	`Æloc_size
(
mem
,
poﬁ_size
,p[i]));

59 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[
i
]);

60 
p
[
i
] = 
NULL
;

62 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

63 
	`ok1
(
	`sizes_ok
(
mem
, 
poﬁ_size
, 
p
, 
num
));

64 
	`‰ì
(
p
);

65 
	`‰ì
(
mem
);

66 
	}
}

68 
	$maö
(
¨gc
, *
¨gv
[])

70 
	`∂™_ã°s
(10);

73 
	`ã°_poﬁ
(
MIN_USEFUL_SIZE
 * 2);

76 
	`ã°_poﬁ
(
MIN_USEFUL_SIZE
 / 2);

78  
	`exô_°©us
();

79 
	}
}

	@ccan/ccan/antithread/alloc/test/run-tiny-encode.c

1 
	~<cˇn/èp/èp.h
>

2 
	~"c⁄fig.h
"

3 
	~<cˇn/™tôhªad/Æloc/töy.c
>

4 
	~<cˇn/™tôhªad/Æloc/bô›s.c
>

5 
	~<°dlib.h
>

6 
	~<îr.h
>

9 
	#ARR_SIZE
 10

	)

11 
	$maö
()

13 
¨øy
[
ARR_SIZE
];

14 
i
, 
¥ev
;

16 
	`∂™_ã°s
(405);

18 
¥ev
 = 0;

20 
i
 = 1; i < 0x8000000; i *= 2) {

21 
	`ok1
(
	`ícode_Àngth
(
i
-1Ë>
¥ev
);

22 
	`ok1
(
	`ícode_Àngth
(
i
) >=Éncode_length(i-1));

23 
	`ok1
(
	`ícode_Àngth
(
i
+1) >=Éncode_length(i));

24 
¥ev
 = 
	`ícode_Àngth
(
i
);

28 
i
 = 1; i < 0x8000000; i *= 2) {

29 
	`ok1
(
	`ícode_Àngth
(
i
-1Ë=
	`ícode
(ò- 1 + 
MIN_BLOCK_SIZE
,

30 
Ál£
, 
¨øy
));

31 
	`ok1
(
	`ícode_Àngth
(
i
Ë=
	`ícode
(ò+ 
MIN_BLOCK_SIZE
,

32 
Ál£
, 
¨øy
));

33 
	`ok1
(
	`ícode_Àngth
(
i
+1Ë=
	`ícode
(ò+ 1 + 
MIN_BLOCK_SIZE
,

34 
Ál£
, 
¨øy
));

38 
i
 = 1; i < 0x8000000; i *= 2) {

39 
hdæí
, 
Àn
;

40 
boﬁ
 
‰ì
;

42 
hdæí
 = 
	`ícode
(
i
 - 1 + 
MIN_BLOCK_SIZE
, 
Ál£
, 
¨øy
);

43 
	`ok1
(
	`decode
(&
Àn
, &
‰ì
, 
¨øy
Ë=
hdæí
);

44 
	`ok1
(
Àn
 =
i
 - 1 + 
MIN_BLOCK_SIZE
);

45 
	`ok1
(
‰ì
 =
Ál£
);

47 
hdæí
 = 
	`ícode
(
i
 + 
MIN_BLOCK_SIZE
, 
åue
, 
¨øy
);

48 
	`ok1
(
	`decode
(&
Àn
, &
‰ì
, 
¨øy
Ë=
hdæí
);

49 
	`ok1
(
Àn
 =
i
 + 
MIN_BLOCK_SIZE
);

50 
	`ok1
(
‰ì
 =
åue
);

52 
hdæí
 = 
	`ícode
(
i
 + 1 + 
MIN_BLOCK_SIZE
, 
åue
, 
¨øy
);

53 
	`ok1
(
	`decode
(&
Àn
, &
‰ì
, 
¨øy
Ë=
hdæí
);

54 
	`ok1
(
Àn
 =
i
 + 1 + 
MIN_BLOCK_SIZE
);

55 
	`ok1
(
‰ì
 =
åue
);

58  
	`exô_°©us
();

59 
	}
}

	@ccan/ccan/antithread/alloc/test/run.c

1 
	~<cˇn/™tôhªad/Æloc/Æloc.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/™tôhªad/Æloc/Æloc.c
>

4 
	~<cˇn/™tôhªad/Æloc/bô›s.c
>

5 
	~<cˇn/™tôhªad/Æloc/töy.c
>

6 
	~<°dlib.h
>

7 
	~<îr.h
>

9 
	#s‹t
(
p
, 
num
, 
cmp
) \

10 
	`qs‹t
((
p
), (
num
), (*p), ((*)(c⁄° *, c⁄° *))
cmp
)

	)

12 
	$addr_cmp
(**
a
, **
b
)

14  (*)(*
a
Ë- (*)(*
b
);

15 
	}
}

17 
boﬁ
 
	$unique
(*
p
[], 
num
)

19 
i
;

21 
i
 = 1; i < 
num
; i++)

22 i‡(
p
[
i
] ==Ö[i-1])

23  
Ál£
;

24  
åue
;

25 
	}
}

27 
boﬁ
 
	$‰ì_evîy_£c⁄d_⁄e
(*
mem
, 
num
,

28 
poﬁ_size
, *
p
[])

30 
i
;

33 
i
 = 0; i < 
num
; i += 2) {

34 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[
i
]);

36 i‡(!
	`Æloc_check
(
mem
, 
poﬁ_size
))

37  
Ál£
;

38 
i
 = 1; i < 
num
; i += 2) {

39 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[
i
]);

41 i‡(!
	`Æloc_check
(
mem
, 
poﬁ_size
))

42  
Ál£
;

43  
åue
;

44 
	}
}

46 
	$ã°
(
poﬁ_size
)

48 *
mem
;

49 
i
, 
num
, 
max_size
;

50 **
p
 = 
	`ˇŒoc
(
poﬁ_size
, (*p));

51 
Æloc_limô
 = 
poﬁ_size
 / 2;

53 
mem
 = 
	`mÆloc
(
poﬁ_size
);

56 
	`Æloc_öô
(
mem
, 0);

57 
	`ok1
(
	`Æloc_check
(
mem
, 0));

58 
	`ok1
(
	`Æloc_gë
(
mem
, 0, 1, 1Ë=
NULL
);

59 
	`ok1
(
	`Æloc_gë
(
mem
, 0, 128, 1Ë=
NULL
);

60 
	`ok1
(
	`Æloc_gë
(
mem
, 0, 0, 1Ë=
NULL
);

63 
	`Æloc_‰ì
(
mem
, 0, 
NULL
);

65 
	`Æloc_öô
(
mem
, 
poﬁ_size
);

66 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

68 
max_size
 = 
poﬁ_size
 + 1; max_size; max_size--) {

69 
p
[0] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 
max_size
, 1);

70 i‡(
p
[0])

73 
	`ok1
(
max_size
 < 
poﬁ_size
);

74 
	`ok1
(
max_size
 > 0);

75 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

76 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[0]Ë>
max_size
);

79 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[0]);

80 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

82 
p
[0] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 
max_size
, 1);

83 
	`ok1
(
p
[0]);

84 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[0]Ë>
max_size
);

85 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

86 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[0]);

87 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

90 
i
 = 0; i < 
poﬁ_size
; i++) {

91 
p
[
i
] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 1, 1);

92 i‡(!
p
[
i
])

99 
	`Æloc_visuÆize
(
°dîr
, 
mem
, 
poﬁ_size
);

102 
num
 = 
i
;

104 
	`ok1
(
num
 !
poﬁ_size
);

105 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

108 
	`s‹t
(
p
, 
num
, 
addr_cmp
);

111 
	`ok1
(
	`unique
(
p
, 
num
));

113 
	`ok1
(
	`‰ì_evîy_£c⁄d_⁄e
(
mem
, 
num
, 
poﬁ_size
, 
p
));

114 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

117 
p
[0] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 
max_size
, 1);

118 
	`ok1
(
p
[0]);

119 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

120 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[0]Ë>
max_size
);

123 
	`Æloc_öô
(
mem
, 
poﬁ_size
);

124 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

125 
p
[0] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 
max_size
, 1);

126 
	`ok1
(
p
[0]);

127 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[0]Ë>
max_size
);

128 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

129 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[0]);

130 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

133 
i
 = 0; (1 << iË< 
Æloc_limô
; i++) {

134 
p
[
i
] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, i, 1 << i);

135 
	`ok1
(
p
[
i
]);

136 
	`ok1
(((*)
p
[
i
] - (*)
mem
) % (1 << i) == 0);

137 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

138 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[
i
]) >= i);

141 
i
 = 0; (1 << iË< 
Æloc_limô
; i++) {

142 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[
i
]);

143 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

147 
i
 = 0; (1 << iË< 
Æloc_limô
; i++) {

148 
p
[0] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 1, 1 << 
i
);

149 
	`ok1
(
p
[0]);

150 
	`ok1
(((*)
p
[0] - (*)
mem
Ë% (1 << 
i
) == 0);

151 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

152 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[0]) >= 1);

153 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[0]);

154 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

158 
p
[0] = 
	`Æloc_gë
(
mem
, 
poﬁ_size
, 0, 
Æloc_limô
);

159 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

160 
	`ok1
(
	`Æloc_size
(
mem
, 
poﬁ_size
, 
p
[0]) <Öool_size);

161 
	`Æloc_‰ì
(
mem
, 
poﬁ_size
, 
p
[0]);

162 
	`ok1
(
	`Æloc_check
(
mem
, 
poﬁ_size
));

164 
	`‰ì
(
mem
);

165 
	`‰ì
(
p
);

166 
	}
}

168 
	$maö
(
¨gc
, *
¨gv
[])

170 
	`∂™_ã°s
(440);

173 
	`ã°
(
MIN_USEFUL_SIZE
 * 2);

176 
	`ã°
(
MIN_USEFUL_SIZE
 / 2);

178  
	`exô_°©us
();

179 
	}
}

	@ccan/ccan/antithread/alloc/tiny.c

2 
	~"töy.h
"

3 
	~"bô›s.h
"

4 
	~<as£π.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

9 
	#MIN_BLOCK_SIZE
 2

	)

12 
	#TERM_BIT
 0x80

	)

14 
	#SINGLE_BYTE
 0x40

	)

16 
	#FREE_BIT
 0x20

	)

18 
	#MAX_FREE_CACHED_SIZE
 256

	)

21 
	$ícode_Àngth
(
vÆ
)

23 
bôs
 = 
	`aÊs
(
vÆ
);

25 i‡(
bôs
 <= 5)

28  2 + (
bôs
 - 5) / 7;

29 
	}
}

32 
	$ícode_Àn_wôh_hódî
(
Àn
)

34 
hdæí
 = 1;

36 
	`as£π
(
Àn
);

37 
	`ícode_Àngth
(
Àn
 + 
hdæí
 - 
MIN_BLOCK_SIZE
) != hdrlen)

38 
hdæí
 = 
	`ícode_Àngth
(
Àn
 + hdæí - 
MIN_BLOCK_SIZE
);

40  
hdæí
;

41 
	}
}

45 
	$ícode
(
Àn
, 
boﬁ
 
‰ì
, 
¨r
[])

47 
hdæí
 = 1;

50 
	`as£π
(
Àn
 >
MIN_BLOCK_SIZE
);

51 
Àn
 -
MIN_BLOCK_SIZE
;

54 
¨r
[0] = 
TERM_BIT
 | (
‰ì
 ? 
FREE_BIT
 : 0);

56 
¨r
[0] |(
Àn
 & 0x1F);

57 
Àn
 >>= 5;

60 i‡(!
Àn
) {

61 
¨r
[0] |
SINGLE_BYTE
;

62  
hdæí
;

66 
Àn
 >= (1 << 6)) {

68 
¨r
[
hdæí
++] = (
Àn
 & 0x7F);

69 
Àn
 >>= 7;

71 
¨r
[
hdæí
++] = (
Àn
 | 
TERM_BIT
);

72  
hdæí
;

73 
	}
}

76 
	$decode
(*
Àn
, 
boﬁ
 *
‰ì
, c⁄° *
¨r
)

78 
hdæí
 = 0, 
bôs
 = 5;

81 *
‰ì
 = (
¨r
[
hdæí
] & 
FREE_BIT
);

83 *
Àn
 = (
¨r
[
hdæí
] & 0x1f);

84 i‡(!(
¨r
[
hdæí
++] & 
SINGLE_BYTE
)) {

86 !(
¨r
[
hdæí
] & 
TERM_BIT
)) {

88 *
Àn
 |(
¨r
[
hdæí
] & 0x7fULË<< 
bôs
;

89 
hdæí
++;

90 
bôs
 += 7;

93 *
Àn
 |(
¨r
[
hdæí
] & 0x3fULË<< 
bôs
;

94 
hdæí
++;

97 *
Àn
 +
MIN_BLOCK_SIZE
;

98  
hdæí
;

99 
	}
}

102 
	$‰ì_¨øy_size
(
poﬁsize
)

104  
poﬁsize
 / 1024;

105 
	}
}

110 
	$‰ì_¨øy_off
(
size
)

112 
off
;

114 i‡(
size
 <= 4)

115 
off
 = 
size
 - 1;

116 i‡(
size
 <= 16)

117 
off
 = 
size
 / 2 + 1;

119 
off
 = 
size
 / 4 + 5;

121 
off
 *= 3;

122  
off
;

123 
	}
}

125 
	$töy_Æloc_öô
(*
poﬁ
, 
poﬁsize
)

128 
¨rsize
 = 
	`‰ì_¨øy_size
(
poﬁsize
);

131 i‡(
poﬁsize
 < 
MIN_BLOCK_SIZE
)

134 
	`mem£t
(
poﬁ
, 0, 
¨rsize
);

135 
	`ícode
(
poﬁsize
 - 
¨rsize
, 
åue
, (*)
poﬁ
 +árrsize);

136 
	}
}

139 
boﬁ
 
	$åy_cﬂÀs˚
(*
poﬁ
, 
poﬁsize
)

141 
Àn
, 
¥ev_off
 = 0, 
¥ev_Àn
 = 0, 
off
;

142 
boﬁ
 
‰ì
, 
¥ev_‰ì
 = 
Ál£
, 
cﬂÀs˚d
 = false;

144 
off
 = 
	`‰ì_¨øy_size
(
poﬁsize
);

146 
	`decode
(&
Àn
, &
‰ì
, 
poﬁ
 + 
off
);

147 i‡(
‰ì
 && 
¥ev_‰ì
) {

148 
¥ev_Àn
 +
Àn
;

149 
	`ícode
(
¥ev_Àn
, 
åue
, 
poﬁ
 + 
¥ev_off
);

150 
cﬂÀs˚d
 = 
åue
;

152 
¥ev_‰ì
 = 
‰ì
;

153 
¥ev_off
 = 
off
;

154 
¥ev_Àn
 = 
Àn
;

156 
off
 +
Àn
;

157 } 
off
 < 
poﬁsize
);

160 i‡(
cﬂÀs˚d
)

161 
	`mem£t
(
poﬁ
, 0, 
	`‰ì_¨øy_size
(
poﬁsize
));

163  
cﬂÀs˚d
;

164 
	}
}

166 
boﬁ
 
	$l⁄g_íough
(
off£t
, 
Àn
,

167 
size
, 
Æign
)

169 
íd
 = 
off£t
 + 
Àn
;

171 
off£t
 +
	`ícode_Àn_wôh_hódî
(
Àn
);

172 
off£t
 = 
	`Æign_up
(off£t, 
Æign
);

173  
off£t
 + 
size
 <
íd
;

174 
	}
}

176 
	$add_to_‰ì_¨øy
(*
¨r
,

177 
poﬁsize
,

178 
size
,

179 
off
)

181 
Á_off
;

183 i‡(
size
 >
MAX_FREE_CACHED_SIZE
)

186 
Á_off
 = 
	`‰ì_¨øy_off
(
size
);

187 
Á_off
 + 3 < 
	`‰ì_¨øy_size
(
poﬁsize
);

188 
Á_off
 +
	`‰ì_¨øy_off
(
MAX_FREE_CACHED_SIZE
)) {

189 i‡(!
¨r
[
Á_off
] && !arr[fa_off+1] && !arr[fa_off+2]) {

190 
¨r
[
Á_off
] = (
off
 >> 16);

191 
¨r
[
Á_off
+1] = (
off
 >> 8);

192 
¨r
[
Á_off
+2] = 
off
;

196 
	}
}

198 *
	$töy_Æloc_gë
(*
poﬁ
, 
poﬁsize
,

199 
size
, 
Æign
)

201 
¨rsize
 = 
	`‰ì_¨øy_size
(
poﬁsize
);

202 
Àn
, 
off
, 
a˘uÆ
, 
hdr
, 
‰ì_buckë
;

203 
Á_off
;

204 *
¨r
 = 
poﬁ
;

205 
boﬁ
 
‰ì
, 
cﬂÀs˚d
 = 
Ál£
;

208 i‡(
poﬁsize
 < 
MIN_BLOCK_SIZE
)

209  
NULL
;

212 i‡(!
size
)

213 
size
 = 1;

216 
‰ì_buckë
 = 
	`‰ì_¨øy_off
(
size
);

217 
‰ì_buckë
 < 
	`‰ì_¨øy_off
(
MAX_FREE_CACHED_SIZE
);

218 
‰ì_buckë
 += 3) {

219 
Á_off
 = 
‰ì_buckë
;

220 
Á_off
 + 3 < 
	`‰ì_¨øy_size
(
poﬁsize
);

221 
Á_off
 +
	`‰ì_¨øy_off
(
MAX_FREE_CACHED_SIZE
)) {

222 
off
 = (()
¨r
[
Á_off
]) << 16

223 | (()
¨r
[
Á_off
+1]) << 8

224 | (()
¨r
[
Á_off
+2]);

225 i‡(!
off
)

228 
	`decode
(&
Àn
, &
‰ì
, 
¨r
 + 
off
);

229 i‡(
	`l⁄g_íough
(
off
, 
Àn
, 
size
, 
Æign
)) {

231 
	`mem£t
(&
¨r
[
Á_off
], 0, 3);

232 
found
;

237 
agaö
:

238 
off
 = 
¨rsize
;

240 
	`decode
(&
Àn
, &
‰ì
, 
¨r
 + 
off
);

241 !
‰ì
 || !
	`l⁄g_íough
(
off
, 
Àn
, 
size
, 
Æign
)) {

243 i‡(
‰ì
 && 
cﬂÀs˚d
)

244 
	`add_to_‰ì_¨øy
(
¨r
, 
poﬁsize
, 
Àn
, 
off
);

246 
off
 +
Àn
;

248 i‡(
off
 =
poﬁsize
) {

249 i‡(!
cﬂÀs˚d
 && 
	`åy_cﬂÀs˚
(
poﬁ
, 
poﬁsize
)) {

250 
cﬂÀs˚d
 = 
åue
;

251 
agaö
;

253  
NULL
;

255 
	`decode
(&
Àn
, &
‰ì
, 
¨r
 + 
off
);

258 
found
:

260 
a˘uÆ
 = ((
off
 + 
Àn
 - 
size
Ë& ~(
Æign
 - 1));

261 
hdr
 = 
a˘uÆ
 - 
	`ícode_Àn_wôh_hódî
(
off
 + 
Àn
 -áctual);

265 i‡(
hdr
 - 
off
 >
MIN_BLOCK_SIZE
) {

266 
	`ícode
(
hdr
 - 
off
, 
åue
, 
¨r
 + off);

267 
	`add_to_‰ì_¨øy
(
¨r
, 
poﬁsize
, 
hdr
 - 
off
, off);

269 
hdr
 = 
off
;

274 
	`mem£t
(
¨r
 + 
hdr
, 0, 
a˘uÆ
 - hdr);

277 
	`ícode
(
off
 + 
Àn
 - 
hdr
, 
Ál£
, 
¨r
 + hdr);

279  
¨r
 + 
a˘uÆ
;

280 
	}
}

282 *
	$to_hdr
(*
p
)

284 *
hdr
 = 
p
;

287 !*(--
hdr
));

288 
	`as£π
(*
hdr
 & 
TERM_BIT
);

291 i‡(!(*
hdr
 & 
SINGLE_BYTE
)) {

292 !(*(--
hdr
Ë& 
TERM_BIT
));

294  
hdr
;

295 
	}
}

297 
	$töy_Æloc_‰ì
(*
poﬁ
, 
poﬁsize
, *
‰ìp
)

299 
Àn
;

300 *
¨r
 = 
poﬁ
;

301 *
hdr
;

302 
boﬁ
 
‰ì
;

305 i‡(
poﬁsize
 < 
MIN_BLOCK_SIZE
)

308 
hdr
 = 
	`to_hdr
(
‰ìp
);

310 
	`decode
(&
Àn
, &
‰ì
, 
hdr
);

311 
	`as£π
(!
‰ì
);

312 
hdr
[0] |
FREE_BIT
;

315 
	`add_to_‰ì_¨øy
(
poﬁ
, 
poﬁsize
, 
Àn
, 
hdr
 - 
¨r
);

316 
	}
}

318 
	$töy_Æloc_size
(*
poﬁ
, 
poﬁsize
, *
p
)

320 *
hdr
 = 
	`to_hdr
(
p
);

321 
Àn
, 
hdæí
;

322 
boﬁ
 
‰ì
;

324 
hdæí
 = 
	`decode
(&
Àn
, &
‰ì
, 
hdr
);

325  
Àn
 - 
hdæí
;

326 
	}
}

329 
boﬁ
 
	$töy_check_Áû
()

331  
Ál£
;

332 
	}
}

334 
boﬁ
 
	$check_decode
(c⁄° *
¨r
, 
Àn
)

336 
i
;

338 i‡(
Àn
 == 0)

339  
	`töy_check_Áû
();

340 i‡(!(
¨r
[0] & 
TERM_BIT
))

341  
	`töy_check_Áû
();

342 i‡(
¨r
[0] & 
SINGLE_BYTE
)

343  
åue
;

344 
i
 = 1; i < 
Àn
; i++) {

345 i‡(
¨r
[
i
] & 
TERM_BIT
)

346  
åue
;

348  
	`töy_check_Áû
();

349 
	}
}

351 
boﬁ
 
	$töy_Æloc_check
(*
poﬁ
, 
poﬁsize
)

353 
¨rsize
 = 
	`‰ì_¨øy_size
(
poﬁsize
);

354 *
¨r
 = 
poﬁ
;

355 
Àn
, 
off
, 
hdæí
;

356 
i
, 
‰ì¨r
[
¨rsize
], 
num_‰ì¨r
 = 0;

357 
boﬁ
 
‰ì
;

359 i‡(
poﬁsize
 < 
MIN_BLOCK_SIZE
)

360  
åue
;

362 
i
 = 0; i + 3 < 
	`‰ì_¨øy_size
(
poﬁsize
); i += 3) {

363 
off
 = (()
¨r
[
i
]) << 16

364 | (()
¨r
[
i
+1]) << 8

365 | (()
¨r
[
i
+2]);

366 i‡(!
off
)

369 i‡(
off
 >
poﬁsize
)

370  
	`töy_check_Áû
();

371 
‰ì¨r
[
num_‰ì¨r
++] = 
off
;

374 
off
 = 
¨rsize
; of‡< 
poﬁsize
; of‡+
Àn
) {

376 i‡(!
	`check_decode
(
¨r
 + 
off
, 
poﬁsize
 - off))

377  
Ál£
;

378 
hdæí
 = 
	`decode
(&
Àn
, &
‰ì
, 
¨r
 + 
off
);

379 i‡(
off
 + 
Àn
 > 
poﬁsize
)

380  
	`töy_check_Áû
();

381 i‡(
hdæí
 !
	`ícode_Àngth
(
Àn
 - 
MIN_BLOCK_SIZE
))

382  
	`töy_check_Áû
();

383 
i
 = 0; i < 
num_‰ì¨r
; i++) {

384 i‡(
‰ì¨r
[
i
] =
off
) {

385 i‡(!
‰ì
)

386  
	`töy_check_Áû
();

387 
	`memmove
(&
‰ì¨r
[
i
], &freearr[i+1],

388 (
num_‰ì¨r
-- - (
i
 + 1))

389 * (
‰ì¨r
[
i
]));

396 i‡(
num_‰ì¨r
)

397  
	`töy_check_Áû
();

400 
i
 = 0; i + 3 < 
	`‰ì_¨øy_size
(
poﬁsize
); i += 3) {

401 
Á_off
;

403 
off
 = (()
¨r
[
i
]) << 16

404 | (()
¨r
[
i
+1]) << 8

405 | (()
¨r
[
i
+2]);

406 i‡(!
off
)

409 
	`decode
(&
Àn
, &
‰ì
, 
¨r
 + 
off
);

412 i‡(
Àn
 >
MAX_FREE_CACHED_SIZE
)

413  
	`töy_check_Áû
();

415 
Á_off
 = 
	`‰ì_¨øy_off
(
Àn
);

416 
Á_off
 + 3 < 
	`‰ì_¨øy_size
(
poﬁsize
);

417 
Á_off
 +
	`‰ì_¨øy_off
(
MAX_FREE_CACHED_SIZE
)) {

418 i‡(
Á_off
 =
i
)

421 i‡(
Á_off
 !
i
)

422  
	`töy_check_Áû
();

425  
åue
;

426 
	}
}

429 
	$töy_Æloc_visuÆize
(
FILE
 *
out
, *
poﬁ
, 
poﬁsize
)

431 
	}
}

	@ccan/ccan/antithread/alloc/tiny.h

2 #i‚de‡
CCAN_TINY_H


3 
	#CCAN_TINY_H


	)

4 
	~<°dboﬁ.h
>

5 
	~<°dio.h
>

7 
töy_Æloc_öô
(*
poﬁ
, 
poﬁsize
);

8 *
töy_Æloc_gë
(*
poﬁ
, 
poﬁsize
,

9 
size
, 
Æign
);

10 
töy_Æloc_‰ì
(*
poﬁ
, 
poﬁsize
, *
‰ì
);

11 
töy_Æloc_size
(*
poﬁ
, 
poﬁsize
, *
p
);

12 
boﬁ
 
töy_Æloc_check
(*
poﬁ
, 
poﬁsize
);

13 
töy_Æloc_visuÆize
(
FILE
 *
out
, *
poﬁ
, 
poﬁsize
);

	@ccan/ccan/antithread/antithread.c

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

4 
	~<f˙é.h
>

5 
	~<°dboﬁ.h
>

6 
	~<°rög.h
>

7 
	~<sys/mm™.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/waô.h
>

10 
	~<sig«l.h
>

11 
	~<î∫o.h
>

12 
	~<as£π.h
>

13 
	~"™tôhªad.h
"

14 
	~<cˇn/îr/îr.h
>

15 
	~<cˇn/n€º/n€º.h
>

16 
	~<cˇn/èŒoc/èŒoc.h
>

17 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

18 
	~<cˇn/™tôhªad/Æloc/Æloc.h
>

19 
	~<cˇn/li°/li°.h
>

26 
LIST_HEAD
(
poﬁs
);

30 
	s©_poﬁ_c⁄ã¡s
 {

31 
li°_node
 
	mli°
;

32 *
	mpoﬁ
;

33 
	mpoﬁsize
;

34 
	mfd
;

35 
	m∑ª¡_rfd
, 
	m∑ª¡_wfd
;

36 
©_poﬁ
 *
	m©p
;

39 
	s©_poﬁ
 {

40 
©_poﬁ_c⁄ã¡s
 *
	mp
;

41 c⁄° *
	m˘x
;

44 
	s©hªad
 {

45 
pid_t
 
	mpid
;

46 
	mrfd
, 
	mwfd
;

50 
	$lock
(
fd
, 
off
)

52 
Êock
 
Ê
;

54 
Ê
.
l_ty≥
 = 
F_WRLCK
;

55 
Ê
.
l_whí˚
 = 
SEEK_SET
;

56 
Ê
.
l_°¨t
 = 
off
;

57 
Ê
.
l_Àn
 = 1;

59 
	`f˙é
(
fd
, 
F_SETLKW
, &
Ê
) < 0) {

60 i‡(
î∫o
 !
EINTR
)

61 
	`îr
(1, "FailureÜockingántithread file");

63 
	}
}

65 
	$u∆ock
(
fd
, 
off
)

67 
Êock
 
Ê
;

68 
£ºno
 = 
î∫o
;

70 
Ê
.
l_ty≥
 = 
F_UNLCK
;

71 
Ê
.
l_whí˚
 = 
SEEK_SET
;

72 
Ê
.
l_°¨t
 = 
off
;

73 
Ê
.
l_Àn
 = 1;

75 
	`f˙é
(
fd
, 
F_SETLK
, &
Ê
);

76 
î∫o
 = 
£ºno
;

77 
	}
}

80 
©_poﬁ_c⁄ã¡s
 *
	$föd_poﬁ
(c⁄° *
±r
)

82 
©_poﬁ_c⁄ã¡s
 *
p
;

84 
	`li°_f‹_óch
(&
poﬁs
, 
p
, 
li°
) {

86 i‡(
±r
 =
p
->
©p
)

87  
p
;

89 i‡((*)
±r
 >(*)
p
->
poﬁ


90 && (*)
±r
 < (*)
p
->
poﬁ
 +Ö->
poﬁsize
)

91  
p
;

93 
	`ab‹t
();

94 
	}
}

96 
	$de°roy_poﬁ
(
©_poﬁ_c⁄ã¡s
 *
p
)

98 
	`li°_dñ
(&
p
->
li°
);

99 
	`munm≠
(
p
->
poﬁ
,Ö->
poﬁsize
);

100 
	`˛o£
(
p
->
fd
);

101 
	`˛o£
(
p
->
∑ª¡_rfd
);

102 
	`˛o£
(
p
->
∑ª¡_wfd
);

104 
	}
}

106 *
	$©_ªÆloc
(c⁄° *
∑ª¡
, *
±r
, 
size_t
 
size
)

108 
©_poﬁ_c⁄ã¡s
 *
p
 = 
	`föd_poﬁ
(
∑ª¡
);

110 *
√w
;

112 i‡(
size
 == 0) {

113 
	`Æloc_‰ì
(
p
->
poﬁ
,Ö->
poﬁsize
, 
±r
);

114 
√w
 = 
NULL
;

115 } i‡(
±r
 =
NULL
) {

117 
√w
 = 
	`Æloc_gë
(
p
->
poﬁ
,Ö->
poﬁsize
, 
size
, 16);

119 i‡(
size
 <
	`Æloc_size
(
p
->
poﬁ
,Ö->
poﬁsize
, 
±r
))

120 
√w
 = 
±r
;

122 
√w
 = 
	`Æloc_gë
(
p
->
poﬁ
,Ö->
poﬁsize
, 
size
, 16);

123 i‡(
√w
) {

124 
	`mem˝y
(
√w
, 
±r
,

125 
	`Æloc_size
(
p
->
poﬁ
,Ö->
poﬁsize
, 
±r
));

126 
	`Æloc_‰ì
(
p
->
poﬁ
,Ö->
poﬁsize
, 
±r
);

131  
√w
;

132 
	}
}

134 
©_poﬁ_c⁄ã¡s
 *
	glocked
;

135 
	$èŒoc_lock
(c⁄° *
±r
)

137 
©_poﬁ_c⁄ã¡s
 *
p
 = 
	`föd_poﬁ
(
±r
);

139 
	`lock
(
p
->
fd
, 0);

140 
	`as£π
(!
locked
);

141 
locked
 = 
p
;

142 
	}
}

144 
	$èŒoc_u∆ock
()

146 
©_poﬁ_c⁄ã¡s
 *
p
 = 
locked
;

148 
locked
 = 
NULL
;

149 
	`u∆ock
(
p
->
fd
, 0);

150 
	}
}

153 
	#PADDING
 (16 * 1024 * 1024)

	)

156 
©_poﬁ
 *
	$©_poﬁ
(
size
)

158 
fd
;

159 
©_poﬁ
 *
©p
;

160 
©_poﬁ_c⁄ã¡s
 *
p
;

161 
FILE
 *
f
;

164 
size
 +32 * 
	`gë∑gesize
();

167 
size
 = (sizê+ 
	`gë∑gesize
()-1) & ~(getpagesize()-1);

169 
f
 = 
	`tmpfûe
();

170 i‡(!
f
)

171  
NULL
;

173 
fd
 = 
	`dup
(
	`fûío
(
f
));

174 
	`f˛o£_n€º
(
f
);

176 i‡(
fd
 < 0)

177  
NULL
;

179 i‡(
	`·runˇã
(
fd
, 
size
 + 
PADDING
) != 0)

180 
Áû_˛o£
;

182 
©p
 = 
	`èŒoc
(
NULL
, 
©_poﬁ
);

183 i‡(!
©p
)

184 
Áû_˛o£
;

186 
©p
->
p
 =Ö = 
	`èŒoc
(
NULL
, 
©_poﬁ_c⁄ã¡s
);

187 i‡(!
p
)

188 
Áû_‰ì
;

191 
p
->
poﬁ
 = 
	`mm≠
(
NULL
, 
size
+
PADDING
, 
PROT_READ
|
PROT_WRITE
, 
MAP_SHARED
, 
fd
,

193 i‡(
p
->
poﬁ
 =
MAP_FAILED
)

194 
Áû_‰ì
;

197 
	`munm≠
(
p
->
poﬁ
, 
size
+
PADDING
);

198 
p
->
poﬁ
 = 
	`mm≠
((*Ì->poﬁ + 
PADDING
/2, 
size
, 
PROT_READ
|
PROT_WRITE
,

199 
MAP_SHARED
, 
fd
, 0);

200 i‡(
p
->
poﬁ
 =
MAP_FAILED
)

201 
Áû_‰ì
;

203 
p
->
fd
 = fd;

204 
p
->
poﬁsize
 = 
size
;

205 
p
->
∑ª¡_rfd
 =Ö->
∑ª¡_wfd
 = -1;

206 
p
->
©p
 =átp;

207 
	`Æloc_öô
(
p
->
poﬁ
,Ö->
poﬁsize
);

208 
	`li°_add
(&
poﬁs
, &
p
->
li°
);

209 
	`èŒoc_£t_de°ru˘‹
(
p
, 
de°roy_poﬁ
);

211 
©p
->
˘x
 = 
	`èŒoc_add_exã∫Æ
(atp,

212 
©_ªÆloc
, 
èŒoc_lock
, 
èŒoc_u∆ock
);

213 i‡(!
©p
->
˘x
)

214 
Áû_‰ì
;

215  
©p
;

217 
Áû_‰ì
:

218 
	`èŒoc_‰ì
(
©p
);

219 
Áû_˛o£
:

220 
	`˛o£_n€º
(
fd
);

221  
NULL
;

222 
	}
}

225 c⁄° *
	$©_poﬁ_˘x
(
©_poﬁ
 *
©p
)

227  
©p
->
˘x
;

228 
	}
}

230 
	$ˇ¡_de°roy_£lf
(
©hªad
 *
©
)

234 
	`ab‹t
();

236 
	}
}

238 
	$de°roy_©
(
©hªad
 *
©
)

241 
	`kûl
(
©
->
pid
, 
SIGTERM
);

243 
	`˛o£
(
©
->
rfd
);

244 
	`˛o£
(
©
->
wfd
);

247 i‡(
	`waôpid
(
©
->
pid
, 
NULL
, 0) !=át->pid)

248 
	`îr
(1, "Waôög f‹áthªad %∞’id %u)", 
©
,át->
pid
);

251 
	}
}

254 
©hªad
 *
	$f‹k_thªad
(
©_poﬁ
 *
©p
)

256 
p2c
[2], 
c2p
[2];

257 
©hªad
 *
©
;

258 
©_poﬁ_c⁄ã¡s
 *
poﬁ
 = 
©p
->
p
;

261 i‡(
poﬁ
->
∑ª¡_rfd
 != -1)

262 
	`îrx
(1, "Can't createántithread onÅhisÖool: we're one");

265 
©
 = 
	`èŒoc_°ól
(
©p
, 
	`èŒoc
(
NULL
, 
©hªad
));

267 i‡(
	`pùe
(
p2c
) != 0)

268 
‰ì
;

270 i‡(
	`pùe
(
c2p
) != 0)

271 
˛o£_p2c
;

273 
©
->
pid
 = 
	`f‹k
();

274 i‡(
©
->
pid
 == -1)

275 
˛o£_c2p
;

277 i‡(
©
->
pid
 == 0) {

279 
	`˛o£
(
c2p
[0]);

280 
	`˛o£
(
p2c
[1]);

281 
poﬁ
->
∑ª¡_rfd
 = 
p2c
[0];

282 
poﬁ
->
∑ª¡_wfd
 = 
c2p
[1];

283 
	`èŒoc_£t_de°ru˘‹
(
©
, 
ˇ¡_de°roy_£lf
);

286 
	`˛o£
(
c2p
[1]);

287 
	`˛o£
(
p2c
[0]);

288 
©
->
rfd
 = 
c2p
[0];

289 
©
->
wfd
 = 
p2c
[1];

290 
	`èŒoc_£t_de°ru˘‹
(
©
, 
de°roy_©
);

293  
©
;

294 
˛o£_c2p
:

295 
	`˛o£_n€º
(
c2p
[0]);

296 
	`˛o£_n€º
(
c2p
[1]);

297 
˛o£_p2c
:

298 
	`˛o£_n€º
(
p2c
[0]);

299 
	`˛o£_n€º
(
p2c
[1]);

300 
‰ì
:

301 
	`èŒoc_‰ì
(
©
);

302  
NULL
;

303 
	}
}

306 
©hªad
 *
_©_run
(
©_poﬁ
 *
©p
,

307 *(*
‚
)(
©_poﬁ
 *, *),

308 *
obj
)

310 
©hªad
 *
	g©
;

312 
	g©
 = 
f‹k_thªad
(
©p
);

313 i‡(!
	g©
)

314  
	gNULL
;

316 i‡(
	g©
->
	gpid
 == 0) {

318 
©_ãŒ_∑ª¡
(
©p
, 
‚
◊ç, 
obj
));

319 
exô
(0);

322  
	g©
;

325 
	$num_¨gs
(*c⁄° 
¨gv
[])

327 
i
;

329 
i
 = 0; 
¨gv
[i]; i++);

330  
i
;

331 
	}
}

334 
©hªad
 *
	$©_•awn
(
©_poﬁ
 *
©p
, *
¨g
, *
cmdlöe
[])

336 
©hªad
 *
©
;

337 
îr
;

339 
©
 = 
	`f‹k_thªad
(
©p
);

340 i‡(!
©
)

341  
NULL
;

343 i‡(
©
->
pid
 == 0) {

345 *
¨gv
[
	`num_¨gs
(
cmdlöe
) + 2];

346 
¨gv
[0] = 
cmdlöe
[0];

347 
¨gv
[1] = 
	`èŒoc_a•rötf
(
NULL
, "AT:%p/%lu/%i/%i/%i/%p",

348 
©p
->
p
->
poﬁ
,áç->p->
poﬁsize
,

349 
©p
->
p
->
fd
,áç->p->
∑ª¡_rfd
,

350 
©p
->
p
->
∑ª¡_wfd
, 
¨g
);

352 
	`mem˝y
(&
¨gv
[2], &
cmdlöe
[1], 
	`num_¨gs
(cmdline)*(*));

353 
	`execvp
(
¨gv
[0],árgv);

355 
îr
 = 
î∫o
;

356 
	`wrôe_Æl
(
©p
->
p
->
∑ª¡_wfd
, &
îr
, (err));

357 
	`exô
(1);

361 i‡(
	`ªad
(
©
->
rfd
, &
îr
, (err)) != (err)) {

362 
î∫o
 = 
ECHILD
;

363 
	`èŒoc_‰ì
(
©
);

364  
NULL
;

366 i‡(
îr
 != 0) {

367 
î∫o
 = 
îr
;

368 
	`èŒoc_‰ì
(
©
);

369  
NULL
;

371  
©
;

372 
	}
}

375 
	$©_fd
(
©hªad
 *
©
)

377  
©
->
rfd
;

378 
	}
}

381 *
	$©_ªad
(
©hªad
 *
©
)

383 *
ªt
;

385 
	`ªad
(
©
->
rfd
, &
ªt
, (ret))) {

387 
	`îr
(1, "Ródög fromáthªad %∞’id %u)", 
©
,át->
pid
);

390  
NULL
;

391 (
ªt
):

392  
ªt
;

395 
	`îr
(1, "Sh‹àªad fromáthªad %∞’id %u)", 
©
,át->
pid
);

397 
	}
}

400 
	$©_ãŒ
(
©hªad
 *
©
, c⁄° *
°©us
)

402 i‡(
	`wrôe
(
©
->
wfd
, &
°©us
, (status)) != (status))

403 
	`îr
(1, "Faûuª wrôögÅÿ©hªad %∞’id %u)", 
©
,át->
pid
);

404 
	}
}

407 
©_poﬁ
 *
	$©_gë_poﬁ
(*
¨gc
, *
¨gv
[], **
¨g
)

409 
©_poﬁ
 *
©p
 = 
	`èŒoc
(
NULL
, at_pool);

410 
©_poﬁ_c⁄ã¡s
 *
p
;

411 *
m≠
;

412 
îr
;

414 i‡(!
¨gv
[1]) {

415 
î∫o
 = 
EINVAL
;

416 
Áû
;

420 i‡(
¨g
 =
NULL
)

421 
¨g
 = &
m≠
;

423 
p
 = 
©p
->∞
	`èŒoc
◊ç, 
©_poﬁ_c⁄ã¡s
);

425 i‡(
	`ssˇnf
(
¨gv
[1], "AT:%p/%lu/%i/%i/%i/%p",

426 &
p
->
poﬁ
, &p->
poﬁsize
, &p->
fd
,

427 &
p
->
∑ª¡_rfd
, &p->
∑ª¡_wfd
, 
¨g
) != 6) {

428 
î∫o
 = 
EINVAL
;

429 
Áû
;

434 
m≠
 = 
	`mm≠
(
p
->
poﬁ
,Ö->
poﬁsize
, 
PROT_READ
|
PROT_WRITE
, 
MAP_SHARED
,

435 
p
->
fd
, 0);

436 i‡(
m≠
 !
p
->
poﬁ
) {

437 
	`Ârötf
(
°dîr
, "Mapping %lu bytes @%p gave %p\n",

438 
p
->
poﬁsize
,Ö->
poﬁ
, 
m≠
);

439 
î∫o
 = 
ENOMEM
;

440 
Áû
;

443 
	`li°_add
(&
poﬁs
, &
p
->
li°
);

444 
	`èŒoc_£t_de°ru˘‹
(
p
, 
de°roy_poﬁ
);

445 
p
->
©p
 =átp;

447 
©p
->
˘x
 = 
	`èŒoc_add_exã∫Æ
(atp,

448 
©_ªÆloc
, 
èŒoc_lock
, 
èŒoc_u∆ock
);

449 i‡(!
©p
->
˘x
)

450 
Áû
;

453 
îr
 = 0;

454 i‡(
	`wrôe
(
p
->
∑ª¡_wfd
, &
îr
, (err)) != (err)) {

455 
î∫o
 = 
EBADF
;

456 
Áû
;

460 
	`memmove
(&
¨gv
[1], &¨gv[2], --(*
¨gc
));

462  
©p
;

464 
Áû
:

465 
	`èŒoc_‰ì
(
©p
);

466  
NULL
;

467 
	}
}

470 
	$©_ãŒ_∑ª¡
(
©_poﬁ
 *
©p
, c⁄° *
°©us
)

472 i‡(
©p
->
p
->
∑ª¡_wfd
 == -1)

473 
	`îrx
(1, "ThisÖrocess isÇotánántithread ofÅhisÖool");

475 i‡(
	`wrôe
(
©p
->
p
->
∑ª¡_wfd
, &
°©us
, (status))!=(status))

476 
	`îr
(1, "Failure writingÅoÖarent");

477 
	}
}

480 *
	$©_ªad_∑ª¡
(
©_poﬁ
 *
©p
)

482 *
ªt
;

484 i‡(
©p
->
p
->
∑ª¡_rfd
 == -1)

485 
	`îrx
(1, "ThisÖrocess isÇotánántithread ofÅhisÖool");

487 
	`ªad
(
©p
->
p
->
∑ª¡_rfd
, &
ªt
, (ret))) {

489 
	`îr
(1, "Reading fromÖarent");

492  
NULL
;

493 (
ªt
):

494  
ªt
;

497 
	`îr
(1, "ShortÑead fromÖarent");

499 
	}
}

502 
	$©_∑ª¡_fd
(
©_poﬁ
 *
©p
)

504 i‡(
©p
->
p
->
∑ª¡_rfd
 == -1)

505 
	`îrx
(1, "ThisÖrocess isÇotánántithread ofÅhisÖool");

507  
©p
->
p
->
∑ª¡_rfd
;

508 
	}
}

511 
	$©_lock
(*
obj
)

513 
©_poﬁ
 *
©p
 = 
	`èŒoc_föd_∑ª¡_byty≥
(
obj
, at_pool);

515 *
l
;

518 
l
 = 
	`èŒoc_lock_±r
(
obj
);

521 
	`lock
(
©p
->
p
->
fd
, (*)
obj
 - (*Ôç->p->
poﬁ
);

524 i‡(*
l
)

525 
	`îrx
(1, "Obje˘ %∞wa†ÆªadyÜocked (somëhög dõd?)", 
obj
);

526 *
l
 = 1;

528 
	}
}

530 
	$©_u∆ock
(*
obj
)

532 
©_poﬁ
 *
©p
 = 
	`èŒoc_föd_∑ª¡_byty≥
(
obj
, at_pool);

534 *
l
;

536 
l
 = 
	`èŒoc_lock_±r
(
obj
);

537 i‡(!*
l
)

538 
	`îrx
(1, "Obje˘ %∞wa†Æªady u∆ocked", 
obj
);

539 *
l
 = 0;

541 
	`u∆ock
(
©p
->
p
->
fd
, (*)
obj
 - (*Ôç->p->
poﬁ
);

542 
	}
}

544 
	$©_lock_Æl
(
©_poﬁ
 *
©p
)

546 
	`lock
(
©p
->
p
->
fd
, 0);

547 
	}
}

549 
	$©_u∆ock_Æl
(
©_poﬁ
 *
©p
)

551 
	`u∆ock
(
©p
->
p
->
fd
, 0);

552 
	}
}

	@ccan/ccan/antithread/antithread.h

2 #i‚de‡
ANTITHREAD_H


3 
	#ANTITHREAD_H


	)

4 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

6 
	g©_poﬁ
;

7 
	g©hªad
;

12 
©_poﬁ
 *©_poﬁ(
size
);

15 c⁄° *
©_poﬁ_˘x
(
©_poﬁ
 *
©p
);

18 
	#©_run
(
poﬁ
, 
‚
, 
¨g
) \

19 
	`_©_run
(
poﬁ
, \

20 
	`ty≥ß„_cb_¥órgs
(*, *, (
‚
), (
¨g
), 
©_poﬁ
 *), \

21 (
¨g
))

	)

25 
©hªad
 *
©_•awn
(
©_poﬁ
 *
poﬁ
, *
¨g
, *
cmdlöe
[]);

28 
©_fd
(
©hªad
 *
©
);

31 *
©_ªad
(
©hªad
 *
©
);

34 
©_ãŒ
(
©hªad
 *
©
, c⁄° *
°©us
);

38 
©_poﬁ
 *
©_gë_poﬁ
(*
¨gc
, *
¨gv
[], **
¨g
);

41 
©_ãŒ_∑ª¡
(
©_poﬁ
 *
poﬁ
, c⁄° *
°©us
);

44 *
©_ªad_∑ª¡
(
©_poﬁ
 *
poﬁ
);

47 
©_∑ª¡_fd
(
©_poﬁ
 *
poﬁ
);

50 
©_lock
(*
obj
);

51 
©_u∆ock
(*
obj
);

53 
©_lock_Æl
(
©_poﬁ
 *
poﬁ
);

54 
©_u∆ock_Æl
(
©_poﬁ
 *
poﬁ
);

57 
©hªad
 *
_©_run
(
©_poﬁ
 *
poﬁ
,

58 *(*
‚
)(
©_poﬁ
 *, *
¨g
),

59 *
¨g
);

	@ccan/ccan/antithread/examples/arabella.c

5 
	~<°dio.h
>

6 
	~<j≥glib.h
>

7 
	~<cˇn/èŒoc/èŒoc.h
>

8 
	~<îr.h
>

9 
	~<as£π.h
>

10 
	~<limôs.h
>

11 
	~<°rög.h
>

12 
	~<°döt.h
>

13 
	~<m©h.h
>

14 
	~<sys/£À˘.h
>

15 
	~<cˇn/°r/°r.h
>

16 
	~<cˇn/™tôhªad/™tôhªad.h
>

17 
	~<sys/ty≥s.h
>

18 
	~<uni°d.h
>

24 
	#POPULATION_SIZE
 1000

	)

27 
	#PLATEAU_GENS
 200

	)

30 
	simage
 {

31 
	mheight
, 
	mwidth
;

32 
	m°ride
;

34 *
	mbuf„r
;

38 
	sdøwög
 {

39 
åüngÀ
 *
	måi
;

40 
	mnum_åis
;

41 
	msc‹e
;

45 
	såüngÀ
 {

47 
	mx
, 
	my
;

48 } 
	mco‹d
[3];

51 
	mcﬁ‹
[4];

52 
	mmu…
;

53 
uöt16_t
 
	madd
[3];

57 *
	$image_©
(
image
 *image,

58 
x
, 
y
)

60  
image
->
buf„r
 + 
y
 * image->
°ride
 + 
x
 * 3;

61 
	}
}

64 
	$add_dŸ
(*
buf
,

65 
mu…
, c⁄° 
uöt16_t
 
add
[])

67 
c
;

69 
c
 = 0; c < 3; c++)

70 
buf
[
c
] = (buf[c] * 
mu…
 + 
add
[c]) / 256;

71 
	}
}

75 
	$add_Ê©_åüngÀ
(
image
 *image,

76 
x0
, 
y0
, 
x1
, 
y1
, 
x2
, 
y2
,

77 
mu…
, c⁄° 
uöt16_t
 
add
[])

79 *
buf
;

80 
i
, 
j
;

83 
dx0
 = ()(
x2
 - 
x0
Ë/ (
y2
 - 
y0
);

84 
dx1
 = ()(
x2
 - 
x1
Ë/ (
y2
 - 
y1
);

86 
yR™ge
 = 0;

88 
lx
 = (Ë
x0
, 
rx
 = (Ë
x1
;

90 i‡(
y0
 < 
y2
) {

91 
yR™ge
 = 
y2
 - 
y0
;

92 
buf
 = 
	`image_©
(
image
, 0, 
y0
);

94 
yR™ge
 = 
y0
 - 
y2
;

95 
buf
 = 
	`image_©
(
image
, 0, 
y2
);

96 
lx
 = 
rx
 = ()
x2
;

99 
i
=0; i < 
yR™ge
; ++i) {

100 
j
=()(
lx
); j<()((
rx
) + 1.0f); ++j)

101 
	`add_dŸ
(
buf
 + 3 * 
j
, 
mu…
, 
add
);

103 
lx
 +
dx0
;

104 
rx
 +
dx1
;

105 
buf
 +
image
->
°ride
;

107 
	}
}

109 
	$sw≠
(*
a
, *
b
)

111 
tmp
 = *
a
;

112 *
a
 = *
b
;

113 *
b
 = 
tmp
;

114 
	}
}

116 
	$∑öt_åüngÀ
(
image
 *image, c⁄° 
åüngÀ
 *
åi
)

118 
i0
 = 0, 
i1
 = 1, 
i2
 = 2;

119 
x0
, 
y0
, 
x1
, 
y1
, 
x2
, 
y2
;

123 i‡(
åi
->
co‹d
[
i0
].
y
 >Åri->co‹d[
i1
].yË
	`sw≠
(&i0, &i1);

124 i‡(
åi
->
co‹d
[
i0
].
y
 >Åri->co‹d[
i2
].yË
	`sw≠
(&i0, &i2);

125 i‡(
åi
->
co‹d
[
i1
].
y
 >Åri->co‹d[
i2
].yË
	`sw≠
(&i1, &i2);

127 
x0
 = 
åi
->
co‹d
[
i0
].
x
, 
y0
 =Åri->co‹d[i0].
y
;

128 
x1
 = 
åi
->
co‹d
[
i1
].
x
, 
y1
 =Åri->co‹d[i1].
y
;

129 
x2
 = 
åi
->
co‹d
[
i2
].
x
, 
y2
 =Åri->co‹d[i2].
y
;

132 i‡(
y1
 =
y2
) {

133 i‡(
x1
 > 
x2
Ë
	`sw≠
(&x1, &x2);

134 
	`add_Ê©_åüngÀ
(
image
, 
x1
, 
y1
, 
x2
, 
y2
, 
x0
, 
y0
,

135 
åi
->
mu…
,Åri->
add
);

136 } i‡(
y0
 =
y1
) {

137 i‡(
x0
 > 
x1
Ë
	`sw≠
(&x0, &x1);

138 
	`add_Ê©_åüngÀ
(
image
, 
x0
, 
y0
, 
x1
, 
y1
, 
x2
, 
y2
,

139 
åi
->
mu…
,Åri->
add
);

142 
tmp_x
 = 
x0
 + ()(0.5‡+ ()(
y1
-
y0
Ë* ()(
x2
-x0Ë/ ()(
y2
-y0));

144 i‡(
x1
 > 
tmp_x
Ë
	`sw≠
(&x1, &tmp_x);

145 
	`add_Ê©_åüngÀ
(
image
, 
x1
, 
y1
, 
tmp_x
, y1, 
x0
, 
y0
,

146 
åi
->
mu…
,Åri->
add
);

147 
	`add_Ê©_åüngÀ
(
image
, 
x1
, 
y1
, 
tmp_x
, y1, 
x2
, 
y2
,

148 
åi
->
mu…
,Åri->
add
);

150 
	}
}

153 
image
 *
	$√w_image
(c⁄° *
˘x
,

154 
width
, 
height
, 
°ride
)

156 
image
 *imagê
	`èŒoc
(
˘x
, image);

158 
image
->
width
 = width;

159 
image
->
height
 = height;

160 
image
->
°ride
 = stride;

161 
image
->
buf„r
 = 
	`èŒoc_zîo_¨øy
(image, ,

162 
°ride
 * 
height
);

163  
image
;

164 
	}
}

167 
	$wrôe_j≥g_fûe
(c⁄° 
image
 *image,

168 c⁄° *
fûíame
, 
quÆôy
)

170 
j≥g_com¥ess_°ru˘
 
cöfo
;

171 
j≥g_îr‹_mgr
 
jîr
;

172 
FILE
 *
outfûe
;

173 
JSAMPROW
 
row_poöãr
[1];

174 
row_°ride
;

176 
cöfo
.
îr
 = 
	`j≥g_°d_îr‹
(&
jîr
);

177 
	`j≥g_¸óã_com¥ess
(&
cöfo
);

179 i‡((
outfûe
 = 
	`f›í
(
fûíame
, "wb")Ë=
NULL
)

180 
	`îr
(1, "ˇn'à›í %s", 
fûíame
);

182 
	`j≥g_°dio_de°
(&
cöfo
, 
outfûe
);

184 
cöfo
.
image_width
 = 
image
->
width
;

185 
cöfo
.
image_height
 = 
image
->
height
;

186 
cöfo
.
öput_comp⁄íts
 = 3;

187 
cöfo
.
ö_cﬁ‹_•a˚
 = 
JCS_RGB
;

188 
	`j≥g_£t_deÁu…s
(&
cöfo
);

189 
	`j≥g_£t_quÆôy
(&
cöfo
, 
quÆôy
, 
TRUE
);

191 
	`j≥g_°¨t_com¥ess
(&
cöfo
, 
TRUE
);

192 
row_°ride
 = 
image
->
width
 * 3;

194 
cöfo
.
√xt_sˇ∆öe
 < cöfo.
image_height
) {

195 
row_poöãr
[0] = 
image
->
buf„r
 + 
cöfo
.
√xt_sˇ∆öe
*
row_°ride
;

196 (Ë
	`j≥g_wrôe_sˇ∆öes
(&
cöfo
, 
row_poöãr
, 1);

199 
	`j≥g_föish_com¥ess
(&
cöfo
);

200 
	`f˛o£
(
outfûe
);

202 
	`j≥g_de°roy_com¥ess
(&
cöfo
);

203 
	}
}

205 
image
 *
	$ªad_j≥g_fûe
(c⁄° *
˘x
, c⁄° *
fûíame
)

207 
j≥g_decom¥ess_°ru˘
 
cöfo
;

208 
image
 *image;

209 
j≥g_îr‹_mgr
 
jîr
;

210 
FILE
 *
öfûe
;

211 
row_°ride
;

213 i‡((
öfûe
 = 
	`f›í
(
fûíame
, "rb")Ë=
NULL
)

214 
	`îr
(1, "ˇn'à›í %s", 
fûíame
);

216 
cöfo
.
îr
 = 
	`j≥g_°d_îr‹
(&
jîr
);

218 
	`j≥g_¸óã_decom¥ess
(&
cöfo
);

220 
	`j≥g_°dio_§c
(&
cöfo
, 
öfûe
);

222 
	`j≥g_ªad_hódî
(&
cöfo
, 
TRUE
);

224 
	`j≥g_°¨t_decom¥ess
(&
cöfo
);

225 
row_°ride
 = 
cöfo
.
ouçut_width
 * cöfo.
ouçut_comp⁄íts
;

227 
image
 = 
	`√w_image
(
˘x
,

228 
cöfo
.
ouçut_width
, cöfo.
ouçut_height
, 
row_°ride
);

229 
cöfo
.
ouçut_sˇ∆öe
 < cöfo.
ouçut_height
) {

230 
JSAMPROW
 
row
 = &
image
->
buf„r
[
cöfo
.
ouçut_sˇ∆öe
*
row_°ride
];

231 
	`j≥g_ªad_sˇ∆öes
(&
cöfo
, &
row
, 1);

234 (Ë
	`j≥g_föish_decom¥ess
(&
cöfo
);

235 
	`j≥g_de°roy_decom¥ess
(&
cöfo
);

236 
	`f˛o£
(
öfûe
);

237  
image
;

238 
	}
}

241 
	$com∑ª_images
(c⁄° 
image
 *
a
,

242 c⁄° 
image
 *
b
)

244 
ªsu…
 = 0;

245 
i
;

248 
	`as£π
(
a
->
height
 *á->
°ride
 < 
ULONG_MAX
 / 8);

250 
i
 = 0; i < 
a
->
height
 *á->
°ride
; i++) {

251 i‡(
a
->
buf„r
[
i
] > 
b
->buffer[i])

252 
ªsu…
 +
a
->
buf„r
[
i
] - 
b
->buffer[i];

254 
ªsu…
 +
b
->
buf„r
[
i
] - 
a
->buffer[i];

256  
ªsu…
;

257 
	}
}

260 
	$ˇlc_mu…ùlõrs
(
åüngÀ
 *
åi
)

263 
åi
->
mu…
 = (255 -Åri->
cﬁ‹
[3]);

265 
åi
->
add
[0] = (åi->
cﬁ‹
[0] *Åri->color[3]);

266 
åi
->
add
[1] = (åi->
cﬁ‹
[1] *Åri->color[3]);

267 
åi
->
add
[2] = (åi->
cﬁ‹
[2] *Åri->color[3]);

268 
	}
}

271 
image
 *
	$image_of_døwög
(c⁄° *
˘x
,

272 c⁄° 
døwög
 *drawing,

273 c⁄° 
image
 *
ma°î
)

275 
image
 *image;

276 
i
;

278 
image
 = 
	`√w_image
(
˘x
, 
ma°î
->
width
, ma°î->
height
, ma°î->
°ride
);

280 
i
 = 0; i < 
døwög
->
num_åis
; i++)

281 
	`∑öt_åüngÀ
(
image
, &
døwög
->
åi
[
i
]);

282  
image
;

283 
	}
}

286 
	$sc‹e_døwög
(
døwög
 *drawing,

287 c⁄° 
image
 *
ma°î
)

289 
image
 *image;

293 
image
 = 
	`image_of_døwög
(
NULL
, 
døwög
, 
ma°î
);

294 
døwög
->
sc‹e
 = 
	`com∑ª_images
(
image
, 
ma°î
);

295 
	`èŒoc_‰ì
(
image
);

296 
	}
}

302 
døwög
 *
	$√w_døwög
(c⁄° *
˘x
, 
num_åis
)

304 
døwög
 *døwög = 
	`èŒoc_zîo
(
˘x
, drawing);

305 
døwög
->
num_åis
 =Çum_tris;

306 
døwög
->
åi
 = 
	`èŒoc_¨øy
(døwög, 
åüngÀ
, 
num_åis
);

307  
døwög
;

308 
	}
}

311 
	$muèã_døwög
(
døwög
 *drawing,

312 c⁄° 
image
 *
ma°î
)

314 
i
, 
r
 = 
	`øndom
();

315 
åüngÀ
 *
åi
 = &
døwög
->åi[
r
 % døwög->
num_åis
];

317 
r
 /
døwög
->
num_åis
;

318 
r
 %= 12;

319 i‡(
r
 < 6) {

321 i‡(
r
 % 2)

322 
åi
->
co‹d
[
r
/2].
x
 = 
	`øndom
(Ë% 
ma°î
->
width
;

324 
åi
->
co‹d
[
r
/2].
y
 = 
	`øndom
(Ë% 
ma°î
->
height
;

325 } i‡(
r
 < 10) {

327 
åi
->
cﬁ‹
[
r
 - 6] = 
	`øndom
() % 256;

328 } i‡(
r
 == 10) {

330 
i
 = 0; i < 3; i++) {

331 
åi
->
co‹d
[
i
].
x
 = 
	`øndom
(Ë% 
ma°î
->
width
;

332 
åi
->
co‹d
[
i
].
y
 = 
	`øndom
(Ë% 
ma°î
->
height
;

336 
i
 = 0; i < 4; i++)

337 
åi
->
cﬁ‹
[
i
] = 
	`øndom
() % 256;

339 
	`ˇlc_mu…ùlõrs
(
åi
);

340 
	}
}

343 
døwög
 *
	$bªed_døwög
(c⁄° *
˘x
,

344 c⁄° 
døwög
 *
a
,

345 c⁄° 
døwög
 *
b
,

346 c⁄° 
image
 *
ma°î
)

348 
i
;

349 
døwög
 *drawing;

350 
r
 = 
	`øndom
(), 
øndmax
 = 
RAND_MAX
;

352 
	`as£π
(
a
->
num_åis
 =
b
->num_tris);

353 
døwög
 = 
	`√w_døwög
(
˘x
, 
a
->
num_åis
);

355 
i
 = 0; i < 
a
->
num_åis
; i++) {

356 
r
 & 1) {

359 
døwög
->
åi
[
i
] = 
a
->tri[i];

363 
døwög
->
åi
[
i
] = 
b
->tri[i];

366 
r
 >>= 1;

367 
øndmax
 >>= 1;

368 i‡(
øndmax
 == 0) {

369 
r
 = 
	`øndom
();

370 
øndmax
 = 
RAND_MAX
;

373 
	`muèã_døwög
(
døwög
, 
ma°î
);

374 
	`sc‹e_døwög
(
døwög
, 
ma°î
);

375  
døwög
;

376 
	}
}

380 *
	$bªedî
(
©_poﬁ
 *
©p
, 
image
 *
ma°î
)

382 c⁄° 
døwög
 *
a
, *
b
;

387 (
a
 = 
	`©_ªad_∑ª¡
(
©p
)Ë!
NULL
) {

388 
døwög
 *
chûd
;

389 
b
 = 
	`©_ªad_∑ª¡
(
©p
);

391 
chûd
 = 
	`bªed_døwög
(
	`©_poﬁ_˘x
(
©p
), 
a
, 
b
, 
ma°î
);

392 
	`©_ãŒ_∑ª¡
(
©p
, 
chûd
);

395  
NULL
;

396 
	}
}

405 
	s©hªad_w‹k
 {

406 
©hªad
 *
	m©
;

407 
	m≥ndög
;

411 
	$g©hî_ªsu…s
(
©hªad_w‹k
 *
©hªads
,

412 
num_thªads
,

413 
døwög
 **drawing,

414 
num
,

415 
boﬁ
 
block
)

417 
i
, 
maxfd
 = 0, 
d⁄e
 = 0;

418 
timevÆ
 
zîo
 = { .
tv_£c
 = 0, .
tv_u£c
 = 0 };

421 
i
 = 0; i < 
num_thªads
; i++) {

422 i‡(
	`©_fd
(
©hªads
[
i
].
©
Ë> 
maxfd
)

423 
maxfd
 = 
	`©_fd
(
©hªads
[
i
].
©
);

427 
fd_£t
 
£t
;

428 
	`FD_ZERO
(&
£t
);

429 
i
 = 0; i < 
num_thªads
; i++)

430 
	`FD_SET
(
	`©_fd
(
©hªads
[
i
].
©
), &
£t
);

432 i‡(
	`£À˘
(
maxfd
+1, &
£t
, 
NULL
, NULL, 
block
 ? NULL : &
zîo
) < 0)

433 
	`îr
(1, "Selecting onántithreadÑesults");

435 
i
 = 0; i < 
num_thªads
; i++) {

436 i‡(!
	`FD_ISSET
(
	`©_fd
(
©hªads
[
i
].
©
), &
£t
))

438 *
døwög
 = 
	`©_ªad
(
©hªads
[
i
].
©
);

439 i‡(!*
døwög
)

440 
	`îr
(1, "Eº‹ wôhÅhªad %u", 
i
);

441 
døwög
++;

442 
num
--;

443 
©hªads
[
i
].
≥ndög
--;

444 
d⁄e
++;

446 } 
block
 && 
num
);

448  
d⁄e
;

449 
	}
}

452 
	$ãŒ_some_bªedî
(
©hªad_w‹k
 *
©hªads
,

453 
num_thªads
,

454 c⁄° 
døwög
 *
a
, c⁄° døwög *
b
)

456 
i
, 
be°
 = 0;

459 
i
 = 1; i < 
num_thªads
; i++) {

460 i‡(
©hªads
[
i
].
≥ndög
 <áthªads[
be°
].pending)

461 
be°
 = 
i
;

464 
	`©_ãŒ
(
©hªads
[
be°
].
©
, 
a
);

465 
	`©_ãŒ
(
©hªads
[
be°
].
©
, 
b
);

466 
©hªads
[
be°
].
≥ndög
++;

467 
	}
}

470 c⁄° *
	$öôül_øndom_cﬁ‹
(c⁄° 
image
 *
ma°î
)

472  
ma°î
->
buf„r
 + (
	`øndom
(Ë% (ma°î->
height
 * ma°î->
width
))*3;

473 
	}
}

476 
døwög
 *
	$øndom_døwög
(c⁄° *
˘x
,

477 c⁄° 
image
 *
ma°î
,

478 
num_åis
)

480 
døwög
 *døwög = 
	`√w_døwög
(
˘x
, 
num_åis
);

481 
i
;

483 
i
 = 0; i < 
døwög
->
num_åis
; i++) {

484 
c
;

485 
åüngÀ
 *
åi
 = &
døwög
->åi[
i
];

486 
c
 = 0; c < 3; c++) {

487 
åi
->
co‹d
[
c
].
x
 = 
	`øndom
(Ë% 
ma°î
->
width
;

488 
åi
->
co‹d
[
c
].
y
 = 
	`øndom
(Ë% 
ma°î
->
height
;

490 
	`mem˝y
(
åi
->
cﬁ‹
, 
	`öôül_øndom_cﬁ‹
(
ma°î
), 3);

491 
åi
->
cﬁ‹
[3] = (
	`øndom
() % 255) + 1;

492 
	`ˇlc_mu…ùlõrs
(
åi
);

494 
	`sc‹e_døwög
(
døwög
, 
ma°î
);

495  
døwög
;

496 
	}
}

499 
døwög
 *
	$ªad_døwög
(c⁄° *
˘x
, 
FILE
 *
ö
,

500 c⁄° 
image
 *
ma°î
,

501 *
gíî©i⁄
)

503 
døwög
 *drawing;

504 
i
;

506 i‡(
	`fsˇnf
(
ö
, "%uÅrüngÀs, gíî©i⁄ %u:\n", &
i
, 
gíî©i⁄
) != 2)

507 
	`îrx
(1, "Reading saved state");

508 
døwög
 = 
	`√w_døwög
(
˘x
, 
i
);

509 
i
 = 0; i < 
døwög
->
num_åis
; i++) {

510 
cﬁ‹
[4];

511 i‡(
	`fsˇnf
(
ö
, "%u,%u,%u,%u,%u,%u,%u,%u,%u,%u\n",

512 &
døwög
->
åi
[
i
].
co‹d
[0].
x
,

513 &
døwög
->
åi
[
i
].
co‹d
[0].
y
,

514 &
døwög
->
åi
[
i
].
co‹d
[1].
x
,

515 &
døwög
->
åi
[
i
].
co‹d
[1].
y
,

516 &
døwög
->
åi
[
i
].
co‹d
[2].
x
,

517 &
døwög
->
åi
[
i
].
co‹d
[2].
y
,

518 &
cﬁ‹
[0], &color[1], &color[2], &color[3]) != 10)

519 
	`îrx
(1, "Reading saved state");

520 
døwög
->
åi
[
i
].
cﬁ‹
[0] = color[0];

521 
døwög
->
åi
[
i
].
cﬁ‹
[1] = color[1];

522 
døwög
->
åi
[
i
].
cﬁ‹
[2] = color[2];

523 
døwög
->
åi
[
i
].
cﬁ‹
[3] = color[3];

524 
	`ˇlc_mu…ùlõrs
(&
døwög
->
åi
[
i
]);

526 
	`sc‹e_døwög
(
døwög
, 
ma°î
);

527  
døwög
;

528 
	}
}

531 
	$com∑ª_døwög_sc‹es
(c⁄° *
_a
, c⁄° *
_b
)

533 
døwög
 **
a
 = (*)
_a
, **
b
 = (*)
_b
;

535  (*
a
)->
sc‹e
 - (*
b
)->score;

536 
	}
}

539 
	$dump_døwögs
(
døwög
 **døwög, c⁄° *
ouäame
,

540 
gíî©i⁄
)

542 
FILE
 *
out
;

543 
i
, 
j
;

544 *
tmpout
 = 
	`èŒoc_a•rötf
(
NULL
, "%s.tmp", 
ouäame
);

546 
out
 = 
	`f›í
(
tmpout
, "w");

547 i‡(!
out
)

548 
	`îr
(1, "O≥nög %s", 
tmpout
);

549 
	`Ârötf
(
out
, "POPULATION_SIZE=%u\n", 
POPULATION_SIZE
);

550 
i
 = 0; i < 
POPULATION_SIZE
; i++) {

551 
	`Ârötf
(
out
, "%uÅriangles, generation %u:\n",

552 
døwög
[
i
]->
num_åis
, 
gíî©i⁄
);

553 
j
 = 0; j < 
døwög
[
i
]->
num_åis
; j++) {

554 
	`Ârötf
(
out
, "%u,%u,%u,%u,%u,%u,%u,%u,%u,%u\n",

555 
døwög
[
i
]->
åi
[
j
].
co‹d
[0].
x
,

556 
døwög
[
i
]->
åi
[
j
].
co‹d
[0].
y
,

557 
døwög
[
i
]->
åi
[
j
].
co‹d
[1].
x
,

558 
døwög
[
i
]->
åi
[
j
].
co‹d
[1].
y
,

559 
døwög
[
i
]->
åi
[
j
].
co‹d
[2].
x
,

560 
døwög
[
i
]->
åi
[
j
].
co‹d
[2].
y
,

561 
døwög
[
i
]->
åi
[
j
].
cﬁ‹
[0],

562 
døwög
[
i
]->
åi
[
j
].
cﬁ‹
[1],

563 
døwög
[
i
]->
åi
[
j
].
cﬁ‹
[2],

564 
døwög
[
i
]->
åi
[
j
].
cﬁ‹
[3]);

567 i‡(
	`f˛o£
(
out
) != 0)

568 
	`îr
(1, "Faûuª closög %s", 
tmpout
);

570 i‡(
	`ª«me
(
tmpout
, 
ouäame
) != 0)

571 
	`îr
(1, "Ríamög %†ovî %s", 
tmpout
, 
ouäame
);

572 
	`èŒoc_‰ì
(
tmpout
);

573 
	}
}

576 
	$dump_°©e
(
døwög
 *døwög[
POPULATION_SIZE
],

577 c⁄° 
image
 *
ma°î
,

578 c⁄° *
ouçic
,

579 c⁄° *
out°©e
,

580 
gí
)

582 *
out
 = 
	`èŒoc_a•rötf
(
NULL
, "%s.%08u.jpg", 
ouçic
, 
gí
);

583 
image
 *image;

584 
	`¥ötf
("Dumpög gí %uÅÿ%†& %s\n", 
gí
, 
out
, 
out°©e
);

585 
	`dump_døwögs
(
døwög
, 
out°©e
, 
gí
);

586 
image
 = 
	`image_of_døwög
(
out
, 
døwög
[0], 
ma°î
);

587 
	`wrôe_j≥g_fûe
(
image
, 
out
, 80);

588 
	`èŒoc_‰ì
(
out
);

589 
	}
}

594 
døwög
 *
	$£À˘_good_døwög
(
døwög
 *drawing[],

595 
p›uœti⁄
)

597 i‡(
p›uœti⁄
 == 1)

598  
døwög
[0];

599 i‡(
	`øndom
() % 32)

600  
	`£À˘_good_døwög
(
døwög
, 
p›uœti⁄
/2);

601  
	`£À˘_good_døwög
(
døwög
 + 
p›uœti⁄
/2,Öopulation/2);

602 
	}
}

604 
	$ußge
()

606 
	`îrx
(1, "usage: <infile> <outfile> <statefile> <numtriangles> <numcpus> [<instatefile>]");

607 
	}
}

609 
	$maö
(
¨gc
, *
¨gv
[])

611 
image
 *
ma°î
;

612 
gí
, 
sö˚_¥ev_be°
, 
num_thªads
, 
i
;

613 
døwög
 *døwög[
POPULATION_SIZE
];

614 
¥ev_be°
, 
poﬁsize
;

615 
©_poﬁ
 *
©p
;

616 
©hªad_w‹k
 *
©hªads
;

618 i‡(
¨gc
 != 6 &&árgc != 7)

619 
	`ußge
();

625 
poﬁsize
 = (
POPULATION_SIZE
 + POPULATION_SIZE/4Ë* ((
døwög
Ë+ 
	`©oi
(
¨gv
[4]Ë* (
åüngÀ
)) * 2 + 1000 * 1000 * 3;

626 
©p
 = 
	`©_poﬁ
(
poﬁsize
);

627 i‡(!
©p
)

628 
	`îr
(1, "Cª©ögÖoﬁ o‡%lu byãs", 
poﬁsize
);

631 
	`èŒoc_°ól
(
	`èŒoc_auto‰ì_c⁄ãxt
(), 
©p
);

634 
ma°î
 = 
	`ªad_j≥g_fûe
(
	`©_poﬁ_˘x
(
©p
), 
¨gv
[1]);

636 i‡(
¨gc
 == 6) {

637 
	`¥ötf
("Creating initialÖopulation");

638 
	`fÊush
(
°dout
);

639 
i
 = 0; i < 
POPULATION_SIZE
; i++) {

640 
døwög
[
i
] = 
	`øndom_døwög
(
	`©_poﬁ_˘x
(
©p
),

641 
ma°î
, 
	`©oi
(
¨gv
[4]));

642 
	`¥ötf
(".");

643 
	`fÊush
(
°dout
);

645 
	`¥ötf
("\n");

646 
gí
 = 0;

648 
FILE
 *
°©e
;

649 
hódî
[100];

650 
°©e
 = 
	`f›í
(
¨gv
[6], "r");

651 i‡(!
°©e
)

652 
	`îr
(1, "O≥nög %s", 
¨gv
[6]);

653 
	`fÊush
(
°dout
);

654 
	`fgës
(
hódî
, 100, 
°©e
);

655 
	`¥ötf
("Lﬂdög inôü»p›uœti⁄ from %s: %s", 
¨gv
[6],

656 
hódî
);

657 
i
 = 0; i < 
POPULATION_SIZE
; i++) {

658 
døwög
[
i
] = 
	`ªad_døwög
(
	`©_poﬁ_˘x
(
©p
),

659 
°©e
, 
ma°î
, &
gí
);

660 
gí
++;

661 
	`¥ötf
(".");

662 
	`fÊush
(
°dout
);

666 
num_thªads
 = 
	`©oi
(
¨gv
[5]);

667 i‡(!
num_thªads
)

668 
	`ußge
();

671 
©hªads
 = 
	`èŒoc_¨øy
(
©p
, 
©hªad_w‹k
, 
num_thªads
);

672 
i
 = 0; i < 
num_thªads
; i++) {

673 
©hªads
[
i
].
≥ndög
 = 0;

674 
©hªads
[
i
].
©
 = 
	`©_run
(
©p
, 
bªedî
, 
ma°î
);

675 i‡(!
©hªads
[
i
].
©
)

676 
	`îr
(1, "Cª©ögá¡ôhªad %u", 
i
);

679 
sö˚_¥ev_be°
 = 0;

681 
¥ev_be°
 = 
ma°î
->
height
 * ma°î->
°ride
 * 256;

683 
sö˚_¥ev_be°
 < 
PLATEAU_GENS
) {

684 
j
, 
d⁄e
 = 0;

685 
døwög
 *
√w
[
POPULATION_SIZE
/4];

687 
	`qs‹t
(
døwög
, 
POPULATION_SIZE
, (drawing[0]),

688 
com∑ª_døwög_sc‹es
);

690 
	`¥ötf
("Best %lu, worst %lu\n",

691 
døwög
[0]->
sc‹e
, døwög[
POPULATION_SIZE
-1]->score);

695 
j
 = 0; j < 
POPULATION_SIZE
 / 4; j++) {

696 
døwög
 *
be°1
, *
be°2
;

698 
be°1
 = 
	`£À˘_good_døwög
(
døwög
, 
POPULATION_SIZE
);

699 
be°2
 = 
	`£À˘_good_døwög
(
døwög
, 
POPULATION_SIZE
);

701 
	`ãŒ_some_bªedî
(
©hªads
, 
num_thªads
, 
be°1
, 
be°2
);

705 
d⁄e
 +
	`g©hî_ªsu…s
(
©hªads
, 
num_thªads
,

706 
√w
 + 
d⁄e
, 
j
 - d⁄e, 
Ál£
);

710 
	`g©hî_ªsu…s
(
©hªads
, 
num_thªads
, 
√w
+
d⁄e
, 
j
-d⁄e, 
åue
);

713 
j
 = 
POPULATION_SIZE
 * 3 / 4; j < POPULATION_SIZE; j++) {

714 
	`èŒoc_‰ì
(
døwög
[
j
]);

715 
døwög
[
j
] = 
√w
[j - 
POPULATION_SIZE
 * 3 / 4];

719 i‡(
døwög
[0]->
sc‹e
 < 
¥ev_be°
 * 0.99) {

720 #i‚de‡
BENCHMARK


721 
	`dump_°©e
(
døwög
, 
ma°î
, 
¨gv
[2],árgv[3], 
gí
);

723 
¥ev_be°
 = 
døwög
[0]->
sc‹e
;

724 
sö˚_¥ev_be°
 = 0;

726 
sö˚_¥ev_be°
++;

728 #ifde‡
BENCHMARK


729 i‡(
gí
 == 100)

730 
	`exô
(0);

732 
gí
++;

736 
	`¥ötf
("No improvement over %lu for %u gens\n",

737 
¥ev_be°
, 
sö˚_¥ev_be°
);

738 
	`dump_°©e
(
døwög
, 
ma°î
, 
¨gv
[2],árgv[3], 
gí
);

740 
	}
}

	@ccan/ccan/antithread/examples/dns_lookup.c

2 
	~<cˇn/™tôhªad/™tôhªad.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èŒoc/èŒoc.h
>

5 
	~<îr.h
>

6 
	~<sys/£À˘.h
>

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<√tdb.h
>

11 
	slookup_™swî
 {

12 
boﬁ
 
	mok
;

14 
ho°ít
 
	mhít
;

15 
	mhî∫o
;

20 
ölöe
 
	$cou¡_íåõs
(**
íåõs
)

22 
i
;

24 
i
 = 0; 
íåõs
[i]; i++);

25  
i
+1;

26 
	}
}

30 
	$c›y_™swî
(
lookup_™swî
 *
™s
, c⁄° 
ho°ít
 *
ho°
)

32 
i
;

34 
™s
->
hít
.
h_«me
 = 
	`èŒoc_°rdup
◊ns, 
ho°
->h_name);

35 
™s
->
hít
.
h_Æü£s
 = 
	`èŒoc_¨øy
(ans, *,

36 
	`cou¡_íåõs
(
ho°
->
h_Æü£s
));

37 
i
 = 0; 
ho°
->
h_Æü£s
[i]; i++)

38 
™s
->
hít
.
h_Æü£s
[
i
] = 
	`èŒoc_°rdup
(ans->hent.h_aliases,

39 
ho°
->
h_Æü£s
[
i
]);

40 
™s
->
hít
.
h_Æü£s
[
i
] = 
NULL
;

41 
™s
->
hít
.
h_addπy≥
 = 
ho°
->h_addrtype;

42 
™s
->
hít
.
h_Àngth
 = 
ho°
->h_length;

43 
™s
->
hít
.
h_addr_li°
 = 
	`èŒoc_¨øy
(ans, *,

44 
	`cou¡_íåõs
(
ho°
->
h_addr_li°
));

45 
i
 = 0; 
ho°
->
h_addr_li°
[i]; i++)

46 
™s
->
hít
.
h_addr_li°
[
i
] = 
	`èŒoc_memdup
(ans->hent.h_addr_list,

47 
ho°
->
h_addr_li°
[
i
],

48 
™s
->
hít
.
h_Àngth
);

49 
	}
}

51 *
	$lookup_dns
(
©_poﬁ
 *
©p
, *
«me
)

53 
lookup_™swî
 *
™s
;

54 
ho°ít
 *
ho°
;

56 
ho°
 = 
	`gëho°by«me
(
«me
);

58 
™s
 = 
	`èŒoc
(
	`©_poﬁ_˘x
(
©p
), 
lookup_™swî
);

59 i‡(!
ho°
) {

60 
™s
->
ok
 = 
Ál£
;

61 
™s
->
hî∫o
 = 
h_î∫o
;

63 
™s
->
ok
 = 
åue
;

64 
	`c›y_™swî
(
™s
, 
ho°
);

67  
™s
;

68 
	}
}

70 
	$ªp‹t_™swî
(c⁄° *
«me
, c⁄° 
lookup_™swî
 *
™s
)

72 
i
;

74 i‡(!
™s
->
ok
) {

75 
	`¥ötf
("%s: %s\n", 
«me
, 
	`h°ªº‹
(
™s
->
hî∫o
));

79 
	`¥ötf
("%s: ", 
«me
);

80 
i
 = 0; 
™s
->
hít
.
h_Æü£s
[i]; i++)

81 
	`¥ötf
("%c%s", 
i
 =0 ? '[' : ' ', 
™s
->
hít
.
h_Æü£s
[i]);

82 i‡(
i
)

83 
	`¥ötf
("]");

84 
	`¥ötf
("%#x", 
™s
->
hít
.
h_addπy≥
);

85 
i
 = 0; 
™s
->
hít
.
h_addr_li°
[i]; i++) {

86 
j
;

87 
	`¥ötf
(" ");

88 
j
 = 0; j < 
™s
->
hít
.
h_Àngth
; j++)

89 
	`¥ötf
("%02x", 
™s
->
hít
.
h_addr_li°
[
i
][
j
]);

91 
	`¥ötf
("\n");

92 
	}
}

94 
	$maö
(
¨gc
, *
¨gv
[])

96 
©_poﬁ
 *
©p
;

97 
©hªad
 **
©
;

98 
i
;

100 i‡(
¨gc
 < 2)

101 
	`îrx
(1, "Usage: dns_lookup [--sync]Çame...");

104 
©p
 = 
	`©_poﬁ
(
¨gc
 * 1024*1024);

105 i‡(!
©p
)

106 
	`îr
(1, "Can't createÖool");

109 
	`èŒoc_°ól
(
	`èŒoc_auto‰ì_c⁄ãxt
(), 
©p
);

111 i‡(
	`°ªq
(
¨gv
[1], "--sync")) {

112 
i
 = 2; i < 
¨gc
; i++) {

113 
lookup_™swî
 *
™s
 = 
	`lookup_dns
(
©p
, 
¨gv
[
i
]);

114 
	`ªp‹t_™swî
(
¨gv
[
i
], 
™s
);

115 
	`èŒoc_‰ì
(
™s
);

120 
©
 = 
	`èŒoc_¨øy
(
©p
, 
©hªad
 *, 
¨gc
);

122 
i
 = 1; i < 
¨gc
; i++) {

123 
©
[
i
] = 
	`©_run
(
©p
, 
lookup_dns
, 
¨gv
[i]);

124 i‡(!
©
[
i
])

125 
	`îr
(1, "Can't spawn child");

128 
i
 = 1; i < 
¨gc
; i++) {

129 
lookup_™swî
 *
™s
 = 
	`©_ªad
(
©
[
i
]);

130 i‡(!
™s
)

131 
	`w¨n
("Chûd dõd o¿'%s'", 
¨gv
[
i
]);

133 
	`ªp‹t_™swî
(
¨gv
[
i
], 
™s
);

134 
	`èŒoc_‰ì
(
™s
);

138 
	}
}

	@ccan/ccan/antithread/examples/md5_finder.h

1 #i‚de‡
MD5_FINDER_H


2 
	#MD5_FINDER_H


	)

3 
	~<°döt.h
>

4 
	~<°dboﬁ.h
>

6 
	#MD5_HASH_WORDS
 4

	)

8 
	#u32
 
uöt32_t


	)

9 
	#u64
 
uöt64_t


	)

10 
	#u8
 
uöt8_t


	)

12 
	smd5_£¨ch
 {

13 
u32
 
	mmask
[
MD5_HASH_WORDS
];

14 
u32
 
	mmd5
[
MD5_HASH_WORDS
];

15 
boﬁ
 
	msuc˚ss
;

16 
	mnum_åõs
;

17 
	mnum_byãs
;

18 
u8
 *
	m∑âîn
;

22 
	#INITIAL_POINTER
 ((*)1)

	)

	@ccan/ccan/antithread/test/run-lock.c

1 
	~<cˇn/™tôhªad/™tôhªad.c
>

2 
	~<as£π.h
>

3 
	~<uni°d.h
>

4 
	~<cˇn/èp/èp.h
>

6 
	#NUM_RUNS
 100

	)

8 *
	$ã°
(
©_poﬁ
 *
©p
, *
vÆ
)

10 
i
;

12 i‡(
	`©_ªad_∑ª¡
(
©p
Ë!
ã°
) {

13 
	`düg
("Woah,át_read said bad");

14  
NULL
;

18 
i
 = 0; i < 
NUM_RUNS
; i++) {

19 
	`©_lock
(
vÆ
);

20 (*(vﬁ©ûê*)
vÆ
)++;

21 
	`u¶ìp
(
i
 * 100);

22 
	`©_u∆ock
(
vÆ
);

23 
	`u¶ìp
(
i
 * 100);

26  
vÆ
;

27 
	}
};

29 
	$maö
(
¨gc
, *
¨gv
[])

31 
©_poﬁ
 *
©p
;

32 
©hªad
 *
©
;

33 *
vÆ
, 
i
;

35 
	`∂™_ã°s
(3);

37 
©p
 = 
	`©_poﬁ
(1*1024*1024);

38 
	`as£π
(
©p
);

39 
vÆ
 = 
	`èŒoc_zîo
(
	`©_poﬁ_˘x
(
©p
), );

40 
©
 = 
	`©_run
(
©p
, 
ã°
, 
vÆ
);

41 
	`as£π
(
©
);

43 
	`ok1
(*
vÆ
 == 0);

45 
	`©_ãŒ
(
©
, 
ã°
);

48 
i
 = 0; i < 
NUM_RUNS
; i++) {

49 
	`©_lock
(
vÆ
);

50 (*(vﬁ©ûê*)
vÆ
)++;

51 
	`u¶ìp
(
i
 * 100);

52 
	`©_u∆ock
(
vÆ
);

53 
	`u¶ìp
(
i
 * 100);

55 
	`ok1
(
	`©_ªad
(
©
Ë=
vÆ
);

56 
	`èŒoc_‰ì
(
©
);

58 
	`ok1
(*
vÆ
 =
NUM_RUNS
*2);

60  
	`exô_°©us
();

61 
	}
}

	@ccan/ccan/antithread/test/run-simple.c

1 
	~<cˇn/™tôhªad/™tôhªad.c
>

2 
	~<as£π.h
>

3 
	~<cˇn/èp/èp.h
>

5 *
	$ã°
(
©_poﬁ
 *
©p
, *
pid
)

7 *
pid
 = 
	`gëpid
();

8  
NULL
;

9 
	}
};

11 
	$maö
(
¨gc
, *
¨gv
[])

13 
©_poﬁ
 *
©p
;

14 
©hªad
 *
©
;

15 *
pid
;

17 
	`∂™_ã°s
(4);

19 
©p
 = 
	`©_poﬁ
(1*1024*1024);

20 
	`as£π
(
©p
);

21 
pid
 = 
	`èŒoc
(
	`©_poﬁ_˘x
(
©p
), );

22 
	`as£π
(
pid
);

23 
	`ok1
((*)
pid
 >(*)
©p
->
p
->
poﬁ


24 && (*)
pid
 < (*)
©p
->
p
->
poﬁ
 +áç->p->
poﬁsize
);

25 
©
 = 
	`©_run
(
©p
, 
ã°
, 
pid
);

26 
	`as£π
(
©
);

28 
	`ok1
(
	`©_ªad
(
©
Ë=
NULL
);

29 
	`èŒoc_‰ì
(
©
);

31 
	`ok1
(*
pid
 != 0);

32 
	`ok1
(*
pid
 !
	`gëpid
());

34  
	`exô_°©us
();

35 
	}
}

	@ccan/ccan/antithread/test/run-spawn-NULL.c

1 
	~<cˇn/™tôhªad/™tôhªad.c
>

2 
	~<as£π.h
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 
©_poﬁ
 *
©p
;

8 
©hªad
 *
©
;

9 
îr
;

11 
©p
 = 
	`©_gë_poﬁ
(&
¨gc
, 
¨gv
, 
NULL
);

12 i‡(
©p
) {

13 
	`©_ãŒ_∑ª¡
(
©p
, (*)1UL);

14 
	`exô
(0);

16 
	`as£π
(!
¨gv
[1]);

18 
îr
 = 
î∫o
;

19 
	`∂™_ã°s
(3);

20 
	`ok1
(
îr
 =
EINVAL
);

22 
©p
 = 
	`©_poﬁ
(1*1024*1024);

23 
	`as£π
(
©p
);

26 
©
 = 
	`©_•awn
(
©p
, 
NULL
, 
¨gv
);

27 
	`ok1
(
©
);

30 
	`ok1
(
	`©_ªad
(
©
) == (*)1);

31 
	`èŒoc_‰ì
(
©
);

33  
	`exô_°©us
();

34 
	}
}

	@ccan/ccan/antithread/test/run-spawn.c

1 
	~<cˇn/™tôhªad/™tôhªad.c
>

2 
	~<as£π.h
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 
©_poﬁ
 *
©p
;

8 
©hªad
 *
©
;

9 
îr
, *
pid
;

10 *
¨g
;

11 *
bad_¨gs
[] = { (*)"/", 
NULL
 };

13 
©p
 = 
	`©_gë_poﬁ
(&
¨gc
, 
¨gv
, &
¨g
);

14 i‡(
©p
) {

15 *(*)
¨g
 = 
	`gëpid
();

16 
	`©_ãŒ_∑ª¡
(
©p
, 
¨g
);

17 
	`exô
(0);

19 
	`as£π
(!
¨gv
[1]);

21 
îr
 = 
î∫o
;

22 
	`∂™_ã°s
(7);

23 
	`ok1
(
îr
 =
EINVAL
);

25 
©p
 = 
	`©_poﬁ
(1*1024*1024);

26 
	`as£π
(
©p
);

27 
pid
 = 
	`èŒoc
(
	`©_poﬁ_˘x
(
©p
), );

28 
	`as£π
(
pid
);

29 
	`ok1
((*)
pid
 >(*)
©p
->
p
->
poﬁ


30 && (*)
pid
 < (*)
©p
->
p
->
poﬁ
 +áç->p->
poﬁsize
);

33 
©
 = 
	`©_•awn
(
©p
, 
pid
, 
bad_¨gs
);

34 
	`ok1
(
©
 =
NULL
);

37 
©
 = 
	`©_•awn
(
©p
, 
pid
, 
¨gv
);

38 
	`ok1
(
©
);

41 
	`ok1
(
	`©_ªad
(
©
Ë=
pid
);

42 
	`èŒoc_‰ì
(
©
);

44 
	`ok1
(*
pid
 != 0);

45 
	`ok1
(*
pid
 !
	`gëpid
());

47  
	`exô_°©us
();

48 
	}
}

	@ccan/ccan/antithread/test/run-tell.c

1 
	~<cˇn/™tôhªad/™tôhªad.c
>

2 
	~<as£π.h
>

3 
	~<cˇn/èp/èp.h
>

5 *
	$ã°
(
©_poﬁ
 *
©p
, *
unu£d
)

7 *
p
;

8 
p
 = 
	`©_ªad_∑ª¡
(
©p
);

9 
	`©_ãŒ_∑ª¡
(
©p
, 
p
 + 1);

10  
NULL
;

11 
	}
};

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
©_poﬁ
 *
©p
;

16 
©hªad
 *
©
;

18 
	`∂™_ã°s
(1);

20 
©p
 = 
	`©_poﬁ
(1*1024*1024);

21 
	`as£π
(
©p
);

22 
©
 = 
	`©_run
(
©p
, 
ã°
, 
NULL
);

23 
	`as£π
(
©
);

25 
	`©_ãŒ
(
©
, 
¨gv
[0]);

26 
	`ok1
(
	`©_ªad
(
©
Ë=
¨gv
[0] + 1);

27 
	`èŒoc_‰ì
(
©
);

29  
	`exô_°©us
();

30 
	}
}

	@ccan/ccan/antithread/test/run-tell_parent.c

1 
	~<cˇn/™tôhªad/™tôhªad.c
>

2 
	~<as£π.h
>

3 
	~<cˇn/èp/èp.h
>

5 *
	$ã°
(
©_poﬁ
 *
©p
, *
pid
)

7 *
pid
 = 
	`gëpid
();

8 
	`©_ãŒ_∑ª¡
(
©p
, 
ã°
);

9  
NULL
;

10 
	}
};

12 
	$maö
(
¨gc
, *
¨gv
[])

14 
©_poﬁ
 *
©p
;

15 
©hªad
 *
©
;

16 *
pid
;

18 
	`∂™_ã°s
(4);

20 
©p
 = 
	`©_poﬁ
(1*1024*1024);

21 
	`as£π
(
©p
);

22 
pid
 = 
	`èŒoc
(
	`©_poﬁ_˘x
(
©p
), );

23 
	`as£π
(
pid
);

24 
	`ok1
((*)
pid
 >(*)
©p
->
p
->
poﬁ


25 && (*)
pid
 < (*)
©p
->
p
->
poﬁ
 +áç->p->
poﬁsize
);

26 
©
 = 
	`©_run
(
©p
, 
ã°
, 
pid
);

27 
	`as£π
(
©
);

29 
	`ok1
(
	`©_ªad
(
©
Ë=
ã°
);

30 
	`èŒoc_‰ì
(
©
);

32 
	`ok1
(*
pid
 != 0);

33 
	`ok1
(*
pid
 !
	`gëpid
());

35  
	`exô_°©us
();

36 
	}
}

	@ccan/ccan/array_size/array_size.h

2 #i‚de‡
CCAN_ARRAY_SIZE_H


3 
	#CCAN_ARRAY_SIZE_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

15 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ (◊º)[0]Ë+ 
	`_¨øy_size_chk
◊º))

	)

17 #i‡
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 && 
HAVE_TYPEOF


20 
	#_¨øy_size_chk
(
¨r
) \

21 
	`BUILD_ASSERT_OR_ZERO
(!
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`ty≥of
(
¨r
), \

22 
	`ty≥of
(&(
¨r
)[0])))

	)

24 
	#_¨øy_size_chk
(
¨r
Ë0

	)

	@ccan/ccan/array_size/test/compile_fail-function-param.c

1 
	~<cˇn/¨øy_size/¨øy_size.h
>

2 
	~<°dlib.h
>

4 
	sfoo
 {

5 
	ma
, 
	mb
;

8 
check_∑ømëî
(c⁄° 
foo
 
¨øy
[4]);

9 
	$check_∑ømëî
(c⁄° 
foo
 
¨øy
[4])

11 #ifde‡
FAIL


12  (
	`ARRAY_SIZE
(
¨øy
) == 4);

13 #i‡!
HAVE_TYPEOF
 || !
HAVE_BUILTIN_TYPES_COMPATIBLE_P


17  (
¨øy
Ë=4 * (
foo
);

19 
	}
}

21 
	$maö
(
¨gc
, *
¨gv
[])

23  
	`check_∑ømëî
(
NULL
);

24 
	}
}

	@ccan/ccan/array_size/test/compile_fail.c

1 
	~<cˇn/¨øy_size/¨øy_size.h
>

3 
	$maö
(
¨gc
, *
¨gv
[8])

5 
¨øy
[100];

6 #ifde‡
FAIL


7  
	`ARRAY_SIZE
(
¨gv
Ë+ ARRAY_SIZE(
¨øy
);

8 #i‡!
HAVE_TYPEOF
 || !
HAVE_BUILTIN_TYPES_COMPATIBLE_P


12  
	`ARRAY_SIZE
(
¨øy
);

14 
	}
}

	@ccan/ccan/array_size/test/run.c

1 
	~<cˇn/¨øy_size/¨øy_size.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	g¨øy1
[1];

5 
	g¨øy2
[2];

6 
	g¨øy3
[3][5];

7 
	sfoo
 {

8 
	ma
, 
	mb
;

9 
	m°rög
[100];

11 
foo
 
	g¨øy4
[4];

14 
	g¨øy1_size
 = 
ARRAY_SIZE
(
¨øy1
);

15 
	g¨øy2_size
 = 
ARRAY_SIZE
(
¨øy2
);

16 
	g¨øy3_size
 = 
ARRAY_SIZE
(
¨øy3
);

17 
	g¨øy4_size
 = 
ARRAY_SIZE
(
¨øy4
);

19 
	$maö
(
¨gc
, *
¨gv
[])

21 
	`∂™_ã°s
(8);

22 
	`ok1
(
¨øy1_size
 == 1);

23 
	`ok1
(
¨øy2_size
 == 2);

24 
	`ok1
(
¨øy3_size
 == 3);

25 
	`ok1
(
¨øy4_size
 == 4);

27 
	`ok1
(
	`ARRAY_SIZE
(
¨øy1
) == 1);

28 
	`ok1
(
	`ARRAY_SIZE
(
¨øy2
) == 2);

29 
	`ok1
(
	`ARRAY_SIZE
(
¨øy3
) == 3);

30 
	`ok1
(
	`ARRAY_SIZE
(
¨øy4
) == 4);

32  
	`exô_°©us
();

33 
	}
}

	@ccan/ccan/asearch/asearch.h

2 #i‚de‡
CCAN_ASEARCH_H


3 
	#CCAN_ASEARCH_H


	)

4 
	~<°dlib.h
>

5 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

24 #i‡
HAVE_TYPEOF


25 
	#a£¨ch
(
key
, 
ba£
, 
num
, 
cmp
) \

26 ((
	`__ty≥of__
(*(
ba£
))*)(
	`b£¨ch
((
key
), (ba£), (
num
), (*(base)), \

27 
	`ty≥ß„_cb_ˇ°
((*)(const *, const *), \

28 (*)(c⁄° 
	`__ty≥of__
(*(
key
)) *, \

29 c⁄° 
	`__ty≥of__
(*(
ba£
)) *), \

30 (
cmp
)))))

	)

33 
	#a£¨ch
(
key
, 
ba£
, 
num
, 
cmp
) \

34 (
	`b£¨ch
((
key
), (
ba£
), (
num
), (*(base)), \

35 ((*)(c⁄° *, c⁄° *))(
cmp
)))

	)

	@ccan/ccan/asearch/test/compile_fail-return-value-const.c

1 
	~<cˇn/a£¨ch/a£¨ch.h
>

2 
	~<cˇn/¨øy_size/¨øy_size.h
>

3 
	~<°rög.h
>

5 
	$cmp
(c⁄° *
key
, c⁄° *c⁄° *
ñem
)

7  
	`°rcmp
(
key
, *
ñem
);

8 
	}
}

10 
	$maö
()

12 c⁄° 
key
[] = "key";

13 c⁄° *
ñems
[] = { "a", "big", "list", "of", "things" };

15 #ifde‡
FAIL


16 **
p
;

17 #i‡!
HAVE_TYPEOF


21 c⁄° **
p
;

23 
p
 = 
	`a£¨ch
(
key
, 
ñems
, 
	`ARRAY_SIZE
”Àms), 
cmp
);

24  
p
 ? 0 : 1;

25 
	}
}

	@ccan/ccan/asearch/test/compile_fail-return-value.c

1 
	~<cˇn/a£¨ch/a£¨ch.h
>

3 
	$cmp
(c⁄° *
key
, *c⁄° *
ñem
)

6 
	}
}

8 
	$maö
(
¨gc
, **
¨gv
)

10 c⁄° 
key
[] = "key";

12 #ifde‡
FAIL


13 **
p
;

14 #i‡!
HAVE_TYPEOF


18 **
p
;

20 
p
 = 
	`a£¨ch
(
key
, 
¨gv
+1, 
¨gc
-1, 
cmp
);

21  
p
 ? 0 : 1;

22 
	}
}

	@ccan/ccan/asearch/test/run-strings.c

1 
	~<cˇn/a£¨ch/a£¨ch.h
>

2 
	~<cˇn/¨øy_size/¨øy_size.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

6 
	$cmp
(c⁄° *
key
, c⁄° *c⁄° *
ñem
)

8  *
key
 - 
	`©oi
(*
ñem
);

9 
	}
}

11 
	$maö
()

13 c⁄° *
¨gs
[] = { "1", "4", "7", "9" };

14 
key
 = 7;

15 c⁄° **
p
;

17 
	`∂™_ã°s
(1);

18 
p
 = 
	`a£¨ch
(&
key
, 
¨gs
, 
	`ARRAY_SIZE
◊rgs), 
cmp
);

19 
	`ok1
(
p
 =&
¨gs
[2]);

21  
	`exô_°©us
();

22 
	}
}

	@ccan/ccan/asearch/test/run.c

1 
	~<cˇn/a£¨ch/a£¨ch.h
>

2 
	~<cˇn/¨øy_size/¨øy_size.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<limôs.h
>

6 
	$ã°_cmp
(c⁄° *
key
, c⁄° *
ñt
)

8 i‡(*
key
 < *
ñt
)

10 i‡(*
key
 > *
ñt
)

13 
	}
}

15 
	$maö
()

17 c⁄° 
¨r
[] = { 
INT_MIN
, 0, 1, 2, 3, 4, 5, 6, 
INT_MAX
 };

18 
°¨t
, 
num
, 
i
, 
tŸÆ
 = 0;

19 
key
;

21 
	`∂™_ã°s
(285);

23 
°¨t
 = 0; sèπ < 
	`ARRAY_SIZE
(
¨r
); start++) {

24 
num
 = 0;Çum < 
	`ARRAY_SIZE
(
¨r
Ë- 
°¨t
;Çum++) {

25 
key
 = 7;

26 
	`ok1
(
	`a£¨ch
(&
key
, &
¨r
[
°¨t
], 
num
, 
ã°_cmp
Ë=
NULL
);

27 
tŸÆ
++;

28 
i
 = 
°¨t
; i < sèπ+
num
; i++) {

29 c⁄° *
ªt
;

30 
key
 = 
¨r
[
i
];

31 
ªt
 = 
	`a£¨ch
(&
key
, &
¨r
[
°¨t
], 
num
, 
ã°_cmp
);

32 
	`ok1
(
ªt
);

33 
	`ok1
(
ªt
 && *ªà=
key
);

34 
tŸÆ
++;

38 
	`düg
("Te°ed %u sórches\n", 
tŸÆ
);

39  
	`exô_°©us
();

40 
	}
}

	@ccan/ccan/asort/asort.c

1 
	~<cˇn/as‹t/as‹t.h
>

2 
	~<°dlib.h
>

4 #i‡!
HAVE_QSORT_R_PRIVATE_LAST


31 
	~<limôs.h
>

32 
	~<°dlib.h
>

33 
	~<°rög.h
>

36 
	#SWAP
(
a
, 
b
, 
size
) \

39 
size_t
 
__size
 = (
size
); \

40 *
__a
 = (
a
), *
__b
 = (
b
); \

43 
__tmp
 = *
__a
; \

44 *
__a
++ = *
__b
; \

45 *
__b
++ = 
__tmp
; \

46 } --
__size
 > 0); \

47 } 0)

	)

51 
	#MAX_THRESH
 4

	)

56 *
	mlo
;

57 *
	mhi
;

58 } 
	t°ack_node
;

65 
	#STACK_SIZE
 (
CHAR_BIT
 * (
size_t
))

	)

66 
	#PUSH
(
low
, 
high
Ë((Ë((
t›
->
lo
 = (low)), (t›->
hi
 = (high)), ++t›))

	)

67 
	#POP
(
low
, 
high
Ë((Ë(--
t›
, (low =Å›->
lo
), (high =Å›->
hi
)))

	)

68 
	#STACK_NOT_EMPTY
 (
°ack
 < 
t›
)

	)

96 
_as‹t
 (*c⁄° 
pba£
, 
size_t
 
tŸÆ_ñems
, size_à
size
,

97 (*
cmp
)(c⁄° *, c⁄° *, *
¨g
),

98 *
¨g
)

100 *
ba£_±r
 = (*Ë
pba£
;

102 c⁄° 
size_t
 
max_thªsh
 = 
MAX_THRESH
 * 
size
;

104 i‡(
tŸÆ_ñems
 == 0)

108 i‡(
tŸÆ_ñems
 > 
MAX_THRESH
)

110 *
lo
 = 
ba£_±r
;

111 *
hi
 = &
lo
[
size
 * (
tŸÆ_ñems
 - 1)];

112 
°ack_node
 
°ack
[
STACK_SIZE
];

113 
°ack_node
 *
t›
 = 
°ack
;

115 
	`PUSH
 (
NULL
, NULL);

117 
STACK_NOT_EMPTY
)

119 *
À·_±r
;

120 *
right_±r
;

128 *
mid
 = 
lo
 + 
size
 * ((
hi
 -Üo) / size >> 1);

130 i‡((*
cmp
Ë((*Ë
mid
, (*Ë
lo
, 
¨g
) < 0)

131 
	`SWAP
 (
mid
, 
lo
, 
size
);

132 i‡((*
cmp
Ë((*Ë
hi
, (*Ë
mid
, 
¨g
) < 0)

133 
	`SWAP
 (
mid
, 
hi
, 
size
);

135 
jump_ovî
;

136 i‡((*
cmp
Ë((*Ë
mid
, (*Ë
lo
, 
¨g
) < 0)

137 
	`SWAP
 (
mid
, 
lo
, 
size
);

138 
jump_ovî
:;

140 
À·_±r
 = 
lo
 + 
size
;

141 
right_±r
 = 
hi
 - 
size
;

148 (*
cmp
Ë((*Ë
À·_±r
, (*Ë
mid
, 
¨g
) < 0)

149 
À·_±r
 +
size
;

151 (*
cmp
Ë((*Ë
mid
, (*Ë
right_±r
, 
¨g
) < 0)

152 
right_±r
 -
size
;

154 i‡(
À·_±r
 < 
right_±r
)

156 
	`SWAP
 (
À·_±r
, 
right_±r
, 
size
);

157 i‡(
mid
 =
À·_±r
)

158 
mid
 = 
right_±r
;

159 i‡(
mid
 =
right_±r
)

160 
mid
 = 
À·_±r
;

161 
À·_±r
 +
size
;

162 
right_±r
 -
size
;

164 i‡(
À·_±r
 =
right_±r
)

166 
À·_±r
 +
size
;

167 
right_±r
 -
size
;

171 
À·_±r
 <
right_±r
);

178 i‡((
size_t
Ë(
right_±r
 - 
lo
Ë<
max_thªsh
)

180 i‡((
size_t
Ë(
hi
 - 
À·_±r
Ë<
max_thªsh
)

182 
	`POP
 (
lo
, 
hi
);

185 
lo
 = 
À·_±r
;

187 i‡((
size_t
Ë(
hi
 - 
À·_±r
Ë<
max_thªsh
)

189 
hi
 = 
right_±r
;

190 i‡((
right_±r
 - 
lo
Ë> (
hi
 - 
À·_±r
))

193 
	`PUSH
 (
lo
, 
right_±r
);

194 
lo
 = 
À·_±r
;

199 
	`PUSH
 (
À·_±r
, 
hi
);

200 
hi
 = 
right_±r
;

211 
	#mö
(
x
, 
y
Ë((xË< (yË? (xË: (y))

	)

214 *c⁄° 
íd_±r
 = &
ba£_±r
[
size
 * (
tŸÆ_ñems
 - 1)];

215 *
tmp_±r
 = 
ba£_±r
;

216 *
thªsh
 = 
	`mö
(
íd_±r
, 
ba£_±r
 + 
max_thªsh
);

217 *
run_±r
;

223 
run_±r
 = 
tmp_±r
 + 
size
;Ñun_±∏<
thªsh
;Ñun_ptr += size)

224 i‡((*
cmp
Ë((*Ë
run_±r
, (*Ë
tmp_±r
, 
¨g
) < 0)

225 
tmp_±r
 = 
run_±r
;

227 i‡(
tmp_±r
 !
ba£_±r
)

228 
	`SWAP
 (
tmp_±r
, 
ba£_±r
, 
size
);

232 
run_±r
 = 
ba£_±r
 + 
size
;

233 (
run_±r
 +
size
Ë<
íd_±r
)

235 
tmp_±r
 = 
run_±r
 - 
size
;

236 (*
cmp
Ë((*Ë
run_±r
, (*Ë
tmp_±r
, 
¨g
) < 0)

237 
tmp_±r
 -
size
;

239 
tmp_±r
 +
size
;

240 i‡(
tmp_±r
 !
run_±r
)

242 *
åav
;

244 
åav
 = 
run_±r
 + 
size
;

245 --
åav
 >
run_±r
)

247 
c
 = *
åav
;

248 *
hi
, *
lo
;

250 
hi
 = 
lo
 = 
åav
; (lÿ-
size
Ë>
tmp_±r
; hi =Üo)

251 *
hi
 = *
lo
;

252 *
hi
 = 
c
;

257 
	}
}

	@ccan/ccan/asort/asort.h

2 #i‚de‡
CCAN_ASORT_H


3 
	#CCAN_ASORT_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

6 
	~<°dlib.h
>

21 
	#as‹t
(
ba£
, 
num
, 
cmp
, 
˘x
) \

22 
	`_as‹t
((
ba£
), (
num
), (*(base)), \

23 
	`ty≥ß„_cb_ˇ°
((*)(const *, const *, *), \

24 (*)(c⁄° 
	`__ty≥of__
(*(
ba£
)) *, \

25 c⁄° 
	`__ty≥of__
(*(
ba£
)) *, \

26 
	`__ty≥of__
(
˘x
)), \

27 (
cmp
)), \

28 (
˘x
))

	)

30 #i‡
HAVE_QSORT_R_PRIVATE_LAST


31 
	#_as‹t
(
b
, 
n
, 
s
, 
cmp
, 
˘x
Ë
	`qs‹t_r
(b,Ç, s, cmp, ctx)

	)

33 
_as‹t
(*
ba£
, 
size_t
 
nmemb
, size_à
size
,

34 (*
com∑r
)(const *, const *, *),

35 *
˘x
);

	@ccan/ccan/asort/test/compile_fail-context-type.c

1 
	~<cˇn/as‹t/as‹t.h
>

2 
	~<cˇn/as‹t/as‹t.c
>

4 
	$cmp
(*c⁄° *
a
, *c⁄° *
b
, *
Êag
)

7 
	}
}

9 
	$maö
(
¨gc
, **
¨gv
)

11 #ifde‡
FAIL


12 #i‡
HAVE_TYPEOF
 && 
HAVE_BUILTIN_CHOOSE_EXPR
 && 
HAVE_BUILTIN_TYPES_COMPATIBLE_P


13 
Êag
;

18 
Êag
;

20 
	`as‹t
(
¨gv
+1, 
¨gc
-1, 
cmp
, &
Êag
);

22 
	}
}

	@ccan/ccan/asort/test/run.c

1 
	~<cˇn/as‹t/as‹t.h
>

2 
	~<cˇn/as‹t/as‹t.c
>

3 
	~<cˇn/¨øy_size/¨øy_size.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<limôs.h
>

6 
	~<°dboﬁ.h
>

8 
	$ã°_cmp
(c⁄° *
key
, c⁄° *
ñt
, *
Êag
)

10 i‡(*
key
 < *
ñt
)

11  -1 * *
Êag
;

12 i‡(*
key
 > *
ñt
)

13  1 * *
Êag
;

16 
	}
}

18 
boﬁ
 
	$is_s‹ãd
(c⁄° 
¨r
[], 
size
)

20 
i
;

22 
i
 = 1; i < 
size
; i++)

23 i‡(
¨r
[
i
] <árr[i-1])

24  
Ál£
;

25  
åue
;

26 
	}
}

28 
boﬁ
 
	$is_ªvî£_s‹ãd
(c⁄° 
¨r
[], 
size
)

30 
i
;

32 
i
 = 1; i < 
size
; i++)

33 i‡(
¨r
[
i
] >árr[i-1])

34  
Ál£
;

35  
åue
;

36 
	}
}

38 
	$psuedo_øndom_¨øy
(
¨r
[], 
size
)

40 
i
;

42 
i
 = 0; i < 
size
; i++)

43 
¨r
[
i
] = i * (
INT_MAX
 / 4 - 7);

44 
	}
}

46 
	#TEST_SIZE
 100

	)

48 
	$maö
()

50 
tm∑º
[
TEST_SIZE
];

51 
mu…ùlõr
 = 1;

53 
	`∂™_ã°s
(4);

55 
	`psuedo_øndom_¨øy
(
tm∑º
, 
TEST_SIZE
);

56 
	`ok1
(!
	`is_s‹ãd
(
tm∑º
, 
TEST_SIZE
));

57 
	`ok1
(!
	`is_ªvî£_s‹ãd
(
tm∑º
, 
TEST_SIZE
));

59 
	`as‹t
(
tm∑º
, 
TEST_SIZE
, 
ã°_cmp
, &
mu…ùlõr
);

60 
	`ok1
(
	`is_s‹ãd
(
tm∑º
, 
TEST_SIZE
));

62 
	`psuedo_øndom_¨øy
(
tm∑º
, 
TEST_SIZE
);

63 
mu…ùlõr
 = -1;

64 
	`as‹t
(
tm∑º
, 
TEST_SIZE
, 
ã°_cmp
, &
mu…ùlõr
);

65 
	`ok1
(
	`is_ªvî£_s‹ãd
(
tm∑º
, 
TEST_SIZE
));

67  
	`exô_°©us
();

68 
	}
}

	@ccan/ccan/asprintf/asprintf.c

2 
	~<cˇn/a•rötf/a•rötf.h
>

3 
	~<°d¨g.h
>

4 
	~<°dio.h
>

6 *
	$PRINTF_FMT
(1, 2Ë
	$afmt
(c⁄° *
fmt
, ...)

8 
va_li°
 
≠
;

9 *
±r
;

11 
	`va_°¨t
(
≠
, 
fmt
);

13 i‡(
	`va•rötf
(&
±r
, 
fmt
, 
≠
) < 0)

14 
±r
 = 
NULL
;

15 
	`va_íd
(
≠
);

16  
±r
;

17 
	}
}

19 #i‡!
HAVE_ASPRINTF


20 
	~<°d¨g.h
>

21 
	~<°dlib.h
>

23 
	$va•rötf
(**
°Ω
, c⁄° *
fmt
, 
va_li°
 
≠
)

25 
Àn
;

26 
va_li°
 
≠_c›y
;

29 
	`va_c›y
(
≠_c›y
, 
≠
);

30 
Àn
 = 
	`v¢¥ötf
(
NULL
, 0, 
fmt
, 
≠_c›y
);

31 
	`va_íd
(
≠_c›y
);

35 i‡(
Àn
 < 0)

38 *
°Ω
 = 
	`mÆloc
(
Àn
+1);

39 i‡(!*
°Ω
)

42  
	`v•rötf
(*
°Ω
, 
fmt
, 
≠
);

43 
	}
}

45 
	$a•rötf
(**
°Ω
, c⁄° *
fmt
, ...)

47 
va_li°
 
≠
;

48 
Àn
;

50 
	`va_°¨t
(
≠
, 
fmt
);

51 
Àn
 = 
	`va•rötf
(
°Ω
, 
fmt
, 
≠
);

52 
	`va_íd
(
≠
);

54  
Àn
;

55 
	}
}

	@ccan/ccan/asprintf/asprintf.h

2 #i‚de‡
CCAN_ASPRINTF_H


3 
	#CCAN_ASPRINTF_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/compûî/compûî.h
>

13 *
	$PRINTF_FMT
(1, 2Ë
	`afmt
(c⁄° *
fmt
, ...);

15 #i‡
HAVE_ASPRINTF


16 
	~<°dio.h
>

18 
	~<°d¨g.h
>

37 
	$PRINTF_FMT
(2, 3Ë
	`a•rötf
(**
°Ω
, c⁄° *
fmt
, ...);

47 
	`va•rötf
(**
°Ω
, c⁄° *
fmt
, 
va_li°
 
≠
);

	@ccan/ccan/asprintf/test/run.c

1 
	~<cˇn/a•rötf/a•rötf.h
>

4 
	~<°d¨g.h
>

6 #i‡
HAVE_ASPRINTF


7 
	#va•rötf
 
my_va•rötf


	)

8 
my_va•rötf
(**
°Ω
, c⁄° *
fmt
, 
va_li°
 
≠
);

10 
	~<°dio.h
>

11 
	#v¢¥ötf
 
my_v¢¥ötf


	)

12 
my_v¢¥ötf
(*
°r
, 
size_t
 
size
, c⁄° *
f‹m©
, 
va_li°
 
≠
);

15 
	~<cˇn/a•rötf/a•rötf.c
>

16 
	~<cˇn/èp/èp.h
>

17 
	~<°rög.h
>

18 
	~<°dlib.h
>

19 
	~<°dboﬁ.h
>

21 
boﬁ
 
	gÁû
;

23 #i‡
HAVE_ASPRINTF


24 #unde‡
va•rötf


25 
	$my_va•rötf
(**
°Ω
, c⁄° *
fmt
, 
va_li°
 
≠
)

27 i‡(
Áû
) {

29 *
°Ω
 = (*)()1;

32  
	`va•rötf
(
°Ω
, 
fmt
, 
≠
);

33 
	}
}

35 #unde‡
v¢¥ötf


36 
	$my_v¢¥ötf
(*
°r
, 
size_t
 
size
, c⁄° *
f‹m©
, 
va_li°
 
≠
)

38 i‡(
Áû
) {

41  
	`v¢¥ötf
(
°r
, 
size
, 
f‹m©
, 
≠
);

42 
	}
}

45 
	$maö
()

47 *
p
, 
nul
 = '\0';

48 
ªt
;

51 
	`∂™_ã°s
(8);

53 
Áû
 = 
Ál£
;

54 
p
 = 
	`afmt
("Te° %u%ˇ·î-nul", 1, 
nul
);

55 
	`ok1
(
p
);

56 
	`ok1
(
	`°æí
(
p
) == strlen("Test 1"));

57 
	`ok1
(
	`memcmp
(
p
, "Test 1\0after-nul\0", 17) == 0);

58 
	`‰ì
(
p
);

60 
ªt
 = 
	`a•rötf
(&
p
, "Te° %u%ˇ·î-nul", 1, 
nul
);

61 
	`ok1
(
ªt
 == 16);

62 
	`ok1
(
p
);

63 
	`ok1
(
	`°æí
(
p
) == strlen("Test 1"));

64 
	`ok1
(
	`memcmp
(
p
, "Test 1\0after-nul\0", 17) == 0);

65 
	`‰ì
(
p
);

67 
Áû
 = 
åue
;

68 
p
 = 
	`afmt
("Te° %u%ˇ·î-nul", 1, 
nul
);

69 
	`ok1
(
p
 =
NULL
);

72  
	`exô_°©us
();

73 
	}
}

	@ccan/ccan/autodata/autodata.c

2 
	~"autod©a.h
"

3 
	~<°döt.h
>

4 
	~<uni°d.h
>

5 
	~<°rög.h
>

7 #i‡
HAVE_SECTION_START_STOP


8 *
	$autod©a_gë_£˘i⁄
(*
°¨t
, *
°›
, 
size_t
 *
nump
)

10 *
nump
 = (**)(
°›
Ë- (**)(
°¨t
);

11  
°¨t
;

12 
	}
}

14 
	$autod©a_‰ì
(*
èbÀ
)

16 
	}
}

18 
	~<cˇn/±r_vÆid/±r_vÆid.h
>

20 *
	$autod©a_make_èbÀ
(c⁄° *
exam∂e
, c⁄° *
«me
, 
size_t
 *
nump
)

22 c⁄° *
°¨t
, *
íd
, *
èg
;

23 
±r_vÆid_b©ch
 
b©ch
;

24 c⁄° *c⁄° 
magic
 = (*)
AUTODATA_MAGIC
;

25 **
èbÀ
 = 
NULL
;

26 
fú°_magic
;

28 i‡(!
	`±r_vÆid_b©ch_°¨t
(&
b©ch
))

29  
NULL
;

32 
°¨t
 = (*)((
öçå_t
)
exam∂e
 & ~(
	`gë∑gesize
() - 1));

33 
	`±r_vÆid_b©ch
(&
b©ch
, 
°¨t
-
	`gë∑gesize
(), 1, (*),

34 
Ál£
);

35 
°¨t
 -
	`gë∑gesize
());

37 
íd
 = (*)((
öçå_t
)
exam∂e
 & ~(
	`gë∑gesize
() - 1));

38 
	`±r_vÆid_b©ch
(&
b©ch
, 
íd
, 1, (*), 
Ál£
);

39 
íd
 +
	`gë∑gesize
());

41 *
nump
 = 0;

42 
fú°_magic
 = *(*)&
magic
;

43 
èg
 = 
	`memchr
(
°¨t
, 
fú°_magic
, 
íd
 - start);

44 
èg
;

45 
èg
 = 
	`memchr
—ag+1, 
fú°_magic
, 
íd
 - (tag + 1))) {

46 *
ad©a
[4];

49 i‡(
èg
 + (
ad©a
Ë> 
íd
)

52 
	`mem˝y
(
ad©a
, 
èg
, (adata));

55 i‡(
ad©a
[0] !(*)
AUTODATA_MAGIC
 ||ád©a[1] !
èg
)

59 i‡(!
	`±r_vÆid_b©ch_°rög
(&
b©ch
, 
ad©a
[3])

60 || 
	`°rcmp
(
«me
, 
ad©a
[3]) != 0)

63 i‡(!
	`±r_vÆid_b©ch_ªad
(&
b©ch
, (*)
ad©a
[2]))

66 
èbÀ
 = 
	`ªÆloc
—abÀ, (*Ë* (*
nump
 + 1));

67 i‡(!
èbÀ
)

69 
èbÀ
[*
nump
] = 
ad©a
[2];

70 (*
nump
)++;

72 
	`±r_vÆid_b©ch_íd
(&
b©ch
);

73  
èbÀ
;

74 
	}
}

76 
	$autod©a_‰ì
(*
èbÀ
)

78 
	`‰ì
(
èbÀ
);

79 
	}
}

	@ccan/ccan/autodata/autodata.h

2 #i‚de‡
CCAN_AUTODATA_H


3 
	#CCAN_AUTODATA_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/compûî/compûî.h
>

6 
	~<°dlib.h
>

8 #i‡
HAVE_SECTION_START_STOP


24 
	#AUTODATA_TYPE
(
«me
, 
ty≥
) \

25 
ty≥
 
	tautod©a_
##
	t«me
##
	t_
; \

26 
ty≥
 *
__°¨t_xautod©a_
##
«me
[], *
__°›_xautod©a_
##«me[]

	)

43 
	#AUTODATA
(
«me
, 
±r
) \

44 c⁄° 
autod©a_
##
«me
##
_
 *
NEEDED
 \

45 
	`__©åibuã__
((
	`£˘i⁄
("xautodata_" #name))) \

46 
	`AUTODATA_VAR_
(
«me
, 
__LINE__
Ë(
±r
);

	)

69 
	#autod©a_gë
(
«me
, 
nump
) \

70 ((
autod©a_
##
«me
##
_
 **) \

71 
	`autod©a_gë_£˘i⁄
(
__°¨t_xautod©a_
##
«me
, \

72 
__°›_xautod©a_
##
«me
, (
nump
)))

	)

79 
autod©a_‰ì
(*
p
);

82 
	#AUTODATA_VAR__
(
«me
, 
löe
Ë
autod©a_
##«me##
_
##
	)
line

83 
	#AUTODATA_VAR_
(
«me
, 
löe
Ë
	`AUTODATA_VAR__
“ame,Üöe)

	)

85 #i‡
HAVE_SECTION_START_STOP


86 *
autod©a_gë_£˘i⁄
(*
°¨t
, *
°›
, 
size_t
 *
nump
);

88 
	#AUTODATA_TYPE
(
«me
, 
ty≥
) \

89 
ty≥
 
	tautod©a_
##
	t«me
##
	t_
; \

90 c⁄° *
autod©a_
##
«me
##
_ex
 = &autod©a_##«me##
	)
_ex

92 
	#AUTODATA_MAGIC
 (()0xFEEDA10DA7AF00D5ULL)

	)

93 
	#AUTODATA
(
«me
, 
±r
) \

94 c⁄° 
autod©a_
##
«me
##
_
 *
NEEDED
 \

95 
	`AUTODATA_VAR_
(
«me
, 
__LINE__
)[4] = \

96 { (*)
AUTODATA_MAGIC
, \

97 (*)&
	`AUTODATA_VAR_
(
«me
, 
__LINE__
), \

98 (
±r
), \

99 (*)#«mê}

	)

101 
	#autod©a_gë
(
«me
, 
nump
) \

102 ((
autod©a_
##
«me
##
_
 **) \

103 
	`autod©a_make_èbÀ
(&
autod©a_
##
«me
##
_ex
, #«me, (
nump
)))

	)

105 *
autod©a_make_èbÀ
(c⁄° *
exam∂e
, c⁄° *
«me
, 
size_t
 *
nump
);

	@ccan/ccan/autodata/test/helper.c

2 
	~<cˇn/autod©a/autod©a.h
>

4 
AUTODATA_TYPE
(
auto°rögs
, );

6 
AUTODATA
(
auto°rögs
, "helper");

	@ccan/ccan/autodata/test/run-fools.c

1 
	~<cˇn/autod©a/autod©a.h
>

3 
	~<cˇn/autod©a/autod©a.c
>

4 
	~<cˇn/èp/èp.h
>

6 
AUTODATA_TYPE
(
auto°rögs
, );

8 
AUTODATA
(
auto°rögs
, "genuine");

10 #i‡!
HAVE_SECTION_START_STOP


13 c⁄° *
NEEDED
 
	gÁke_Æpha
[] = { (*)
AUTODATA_MAGIC
 };

16 c⁄° *
NEEDED
 
	gÁke1
[] = { (*)(
AUTODATA_MAGIC
 ^ 0x10000),

17 (*)&
Áke1
,

22 c⁄° *
NEEDED
 
	gÁke2
[] = { (*)
AUTODATA_MAGIC
,

23 (*)&
Áke1
,

28 c⁄° *
NEEDED
 
	gÁke3
[] = { (*)
AUTODATA_MAGIC
,

29 (*)&
Áke3
,

34 c⁄° *
NEEDED
 
	gÁke4
[] = { (*)
AUTODATA_MAGIC
,

40 c⁄° *
NEEDED
 
	gÁke5
[] = { (*)
AUTODATA_MAGIC
,

41 (*)&
Áke5
,

46 c⁄° *
NEEDED
 
	gÁke6
[] = { (*)
AUTODATA_MAGIC
,

47 (*)&
Áke6
,

51 c⁄° *
NEEDED
 
	gÁke_omega
[] = { (*)
AUTODATA_MAGIC
 };

54 
	$maö
()

56 **
èbÀ
;

57 
size_t
 
num
;

60 
	`∂™_ã°s
(2);

62 
èbÀ
 = 
	`autod©a_gë
(
auto°rögs
, &
num
);

63 
	`ok1
(
num
 == 2);

64 
	`ok1
((!
	`°rcmp
(
èbÀ
[0], "genuine") && !strcmp(table[1], "helper"))

65 || (!
	`°rcmp
(
èbÀ
[1], "genuine") && !strcmp(table[0], "helper")));

67 
	`autod©a_‰ì
(
èbÀ
);

70  
	`exô_°©us
();

71 
	}
}

	@ccan/ccan/autodata/test/run.c

1 
	~<cˇn/autod©a/autod©a.h
>

3 
	~<cˇn/autod©a/autod©a.c
>

4 
	~<cˇn/èp/èp.h
>

6 
AUTODATA_TYPE
(
auto°rögs
, );

8 
AUTODATA
(
auto°rögs
, "hello");

9 
AUTODATA
(
auto°rögs
, "world");

11 
	$maö
()

13 **
èbÀ
;

14 
size_t
 
num
;

15 
i
, 
hñlo
 = -1, 
w‹ld
 = -1, 
hñ≥r
 = -1;

18 
	`∂™_ã°s
(4);

20 
èbÀ
 = 
	`autod©a_gë
(
auto°rögs
, &
num
);

21 
	`ok1
(
num
 == 3);

23 
i
 = 0; i < 
num
; i++) {

24 i‡(
	`°rcmp
(
èbÀ
[
i
], "hello") == 0)

25 
hñlo
 = 
i
;

26 i‡(
	`°rcmp
(
èbÀ
[
i
], "world") == 0)

27 
w‹ld
 = 
i
;

28 i‡(
	`°rcmp
(
èbÀ
[
i
], "helper") == 0)

29 
hñ≥r
 = 
i
;

31 
	`Áû
("Unknow¿íåy %s", 
èbÀ
[
i
]);

33 
	`ok1
(
hñlo
 != -1);

34 
	`ok1
(
w‹ld
 != -1);

35 
	`ok1
(
hñ≥r
 != -1);

37 
	`autod©a_‰ì
(
èbÀ
);

40  
	`exô_°©us
();

41 
	}
}

	@ccan/ccan/avl/avl.c

23 
	~"avl.h
"

25 
	~<as£π.h
>

26 
	~<°dlib.h
>

28 
AvlNode
 *
mkNode
(c⁄° *
key
, c⁄° *
vÆue
);

29 
‰ìNode
(
AvlNode
 *
node
);

31 
AvlNode
 *
lookup
(c⁄° 
AVL
 *
avl
, AvlNodê*
node
, c⁄° *
key
);

33 
boﬁ
 
ö£π
(
AVL
 *
avl
, 
AvlNode
 **
p
, c⁄° *
key
, c⁄° *
vÆue
);

34 
boﬁ
 
ªmove
(
AVL
 *
avl
, 
AvlNode
 **
p
, c⁄° *
key
, AvlNodê**
ªt
);

35 
boﬁ
 
ªmoveExåemum
(
AvlNode
 **
p
, 
side
, AvlNodê**
ªt
);

37 
sway
(
AvlNode
 **
p
, sway);

38 
bÆ™˚
(
AvlNode
 **
p
, 
side
);

40 
boﬁ
 
checkBÆ™˚s
(
AvlNode
 *
node
, *
height
);

41 
boﬁ
 
checkOrdî
(
AVL
 *
avl
);

42 
size_t
 
cou¡Node
(
AvlNode
 *
node
);

53 
	#bÆ
(
side
Ë((sideË=0 ? -1 : 1)

	)

54 
	#side
(
bÆ
Ë((bÆË=1 ? 1 : 0)

	)

56 
	$sign
(
cmp
)

58 i‡(
cmp
 < 0)

60 i‡(
cmp
 == 0)

63 
	}
}

65 
AVL
 *
	$avl_√w
(
AvlCom∑ª
 
com∑ª
)

67 
AVL
 *
avl
 = 
	`mÆloc
((*avl));

69 
	`as£π
(
avl
 !
NULL
);

71 
avl
->
com∑ª
 = compare;

72 
avl
->
roŸ
 = 
NULL
;

73 
avl
->
cou¡
 = 0;

74  
avl
;

75 
	}
}

77 
	$avl_‰ì
(
AVL
 *
avl
)

79 
	`‰ìNode
(
avl
->
roŸ
);

80 
	`‰ì
(
avl
);

81 
	}
}

83 *
	$avl_lookup
(c⁄° 
AVL
 *
avl
, c⁄° *
key
)

85 
AvlNode
 *
found
 = 
	`lookup
(
avl
,ávl->
roŸ
, 
key
);

86  
found
 ? (*Ëfound->
vÆue
 : 
NULL
;

87 
	}
}

89 
AvlNode
 *
	$avl_lookup_node
(c⁄° 
AVL
 *
avl
, c⁄° *
key
)

91  
	`lookup
(
avl
,ávl->
roŸ
, 
key
);

92 
	}
}

94 
size_t
 
	$avl_cou¡
(c⁄° 
AVL
 *
avl
)

96  
avl
->
cou¡
;

97 
	}
}

99 
boﬁ
 
	$avl_ö£π
(
AVL
 *
avl
, c⁄° *
key
, c⁄° *
vÆue
)

101 
size_t
 
ﬁd_cou¡
 = 
avl
->
cou¡
;

102 
	`ö£π
(
avl
, &avl->
roŸ
, 
key
, 
vÆue
);

103  
avl
->
cou¡
 !
ﬁd_cou¡
;

104 
	}
}

106 
boﬁ
 
	$avl_ªmove
(
AVL
 *
avl
, c⁄° *
key
)

108 
AvlNode
 *
node
 = 
NULL
;

110 
	`ªmove
(
avl
, &avl->
roŸ
, 
key
, &
node
);

112 i‡(
node
 =
NULL
) {

113  
Ál£
;

115 
	`‰ì
(
node
);

116  
åue
;

118 
	}
}

120 
AvlNode
 *
	$mkNode
(c⁄° *
key
, c⁄° *
vÆue
)

122 
AvlNode
 *
node
 = 
	`mÆloc
((*node));

124 
	`as£π
(
node
 !
NULL
);

126 
node
->
key
 = key;

127 
node
->
vÆue
 = value;

128 
node
->
Ã
[0] = 
NULL
;

129 
node
->
Ã
[1] = 
NULL
;

130 
node
->
bÆ™˚
 = 0;

131  
node
;

132 
	}
}

134 
	$‰ìNode
(
AvlNode
 *
node
)

136 i‡(
node
) {

137 
	`‰ìNode
(
node
->
Ã
[0]);

138 
	`‰ìNode
(
node
->
Ã
[1]);

139 
	`‰ì
(
node
);

141 
	}
}

143 
AvlNode
 *
	$lookup
(c⁄° 
AVL
 *
avl
, 
AvlNode
 *
node
, c⁄° *
key
)

145 
cmp
;

147 i‡(
node
 =
NULL
)

148  
NULL
;

150 
cmp
 = 
avl
->
	`com∑ª
(
key
, 
node
->key);

152 i‡(
cmp
 < 0)

153  
	`lookup
(
avl
, 
node
->
Ã
[0], 
key
);

154 i‡(
cmp
 > 0)

155  
	`lookup
(
avl
, 
node
->
Ã
[1], 
key
);

156  
node
;

157 
	}
}

164 
boﬁ
 
	$ö£π
(
AVL
 *
avl
, 
AvlNode
 **
p
, c⁄° *
key
, c⁄° *
vÆue
)

166 i‡(*
p
 =
NULL
) {

167 *
p
 = 
	`mkNode
(
key
, 
vÆue
);

168 
avl
->
cou¡
++;

169  
åue
;

171 
AvlNode
 *
node
 = *
p
;

172 
cmp
 = 
	`sign
(
avl
->
	`com∑ª
(
key
, 
node
->key));

174 i‡(
cmp
 == 0) {

175 
node
->
key
 = key;

176 
node
->
vÆue
 = value;

177  
Ál£
;

180 i‡(!
	`ö£π
(
avl
, &
node
->
Ã
[
	`side
(
cmp
)], 
key
, 
vÆue
))

181  
Ál£
;

184  
	`sway
(
p
, 
cmp
) != 0;

186 
	}
}

195 
boﬁ
 
	$ªmove
(
AVL
 *
avl
, 
AvlNode
 **
p
, c⁄° *
key
, AvlNodê**
ªt
)

197 i‡(*
p
 =
NULL
) {

198  
Ál£
;

200 
AvlNode
 *
node
 = *
p
;

201 
cmp
 = 
	`sign
(
avl
->
	`com∑ª
(
key
, 
node
->key));

203 i‡(
cmp
 == 0) {

204 *
ªt
 = 
node
;

205 
avl
->
cou¡
--;

207 i‡(
node
->
Ã
[0] !
NULL
 &&Çode->lr[1] != NULL) {

208 
AvlNode
 *
ª∂a˚mít
;

209 
side
;

210 
boﬁ
 
shrunk
;

214 
side
 = 
node
->
bÆ™˚
 <= 0 ? 0 : 1;

216 
shrunk
 = 
	`ªmoveExåemum
(&
node
->
Ã
[
side
], 1 - side, &
ª∂a˚mít
);

218 
ª∂a˚mít
->
Ã
[0] = 
node
->lr[0];

219 
ª∂a˚mít
->
Ã
[1] = 
node
->lr[1];

220 
ª∂a˚mít
->
bÆ™˚
 = 
node
->balance;

221 *
p
 = 
ª∂a˚mít
;

223 i‡(!
shrunk
)

224  
Ál£
;

226 
ª∂a˚mít
->
bÆ™˚
 -
	`bÆ
(
side
);

229  
ª∂a˚mít
->
bÆ™˚
 == 0;

232 i‡(
node
->
Ã
[0] !
NULL
)

233 *
p
 = 
node
->
Ã
[0];

235 *
p
 = 
node
->
Ã
[1];

237  
åue
;

240 i‡(!
	`ªmove
(
avl
, &
node
->
Ã
[
	`side
(
cmp
)], 
key
, 
ªt
))

241  
Ál£
;

244  
	`sway
(
p
, -
cmp
) == 0;

247 
	}
}

258 
boﬁ
 
	$ªmoveExåemum
(
AvlNode
 **
p
, 
side
, AvlNodê**
ªt
)

260 
AvlNode
 *
node
 = *
p
;

262 i‡(
node
->
Ã
[
side
] =
NULL
) {

263 *
ªt
 = 
node
;

264 *
p
 = 
node
->
Ã
[1 - 
side
];

265  
åue
;

268 i‡(!
	`ªmoveExåemum
(&
node
->
Ã
[
side
], side, 
ªt
))

269  
Ál£
;

272  
	`sway
(
p
, -
	`bÆ
(
side
)) == 0;

273 
	}
}

284 
	$sway
(
AvlNode
 **
p
, 
sway
)

286 i‡((*
p
)->
bÆ™˚
 !
sway
)

287 (*
p
)->
bÆ™˚
 +
sway
;

289 
	`bÆ™˚
(
p
, 
	`side
(
sway
));

291  (*
p
)->
bÆ™˚
;

292 
	}
}

300 
	$bÆ™˚
(
AvlNode
 **
p
, 
side
)

302 
AvlNode
 *
node
 = *
p
,

303 *
chûd
 = 
node
->
Ã
[
side
];

304 
›posôe
 = 1 - 
side
;

305 
bÆ
 = 
	`bÆ
(
side
);

307 i‡(
chûd
->
bÆ™˚
 !-
bÆ
) {

309 
node
->
Ã
[
side
] = 
chûd
->Ã[
›posôe
];

310 
chûd
->
Ã
[
›posôe
] = 
node
;

311 *
p
 = 
chûd
;

313 
chûd
->
bÆ™˚
 -
bÆ
;

314 
node
->
bÆ™˚
 = -
chûd
->balance;

318 
AvlNode
 *
gøndchûd
 = 
chûd
->
Ã
[
›posôe
];

320 
node
->
Ã
[
side
] = 
gøndchûd
->Ã[
›posôe
];

321 
chûd
->
Ã
[
›posôe
] = 
gøndchûd
->Ã[
side
];

322 
gøndchûd
->
Ã
[
side
] = 
chûd
;

323 
gøndchûd
->
Ã
[
›posôe
] = 
node
;

324 *
p
 = 
gøndchûd
;

326 
node
->
bÆ™˚
 = 0;

327 
chûd
->
bÆ™˚
 = 0;

329 i‡(
gøndchûd
->
bÆ™˚
 =
bÆ
)

330 
node
->
bÆ™˚
 = -
bÆ
;

331 i‡(
gøndchûd
->
bÆ™˚
 =-
bÆ
)

332 
chûd
->
bÆ™˚
 = 
bÆ
;

334 
gøndchûd
->
bÆ™˚
 = 0;

336 
	}
}

341 
boﬁ
 
	$avl_check_öv¨ü¡s
(
AVL
 *
avl
)

343 
dummy
;

345  
	`checkBÆ™˚s
(
avl
->
roŸ
, &
dummy
)

346 && 
	`checkOrdî
(
avl
)

347 && 
	`cou¡Node
(
avl
->
roŸ
Ë=avl->
cou¡
;

348 
	}
}

350 
boﬁ
 
	$checkBÆ™˚s
(
AvlNode
 *
node
, *
height
)

352 i‡(
node
) {

353 
h0
, 
h1
;

355 i‡(!
	`checkBÆ™˚s
(
node
->
Ã
[0], &
h0
))

356  
Ál£
;

357 i‡(!
	`checkBÆ™˚s
(
node
->
Ã
[1], &
h1
))

358  
Ál£
;

360 i‡(
node
->
bÆ™˚
 !
h1
 - 
h0
 ||Çode->balance < -1 ||Çode->balance > 1)

361  
Ál£
;

363 *
height
 = (
h0
 > 
h1
 ? h0 : h1) + 1;

364  
åue
;

366 *
height
 = 0;

367  
åue
;

369 
	}
}

371 
boﬁ
 
	$checkOrdî
(
AVL
 *
avl
)

373 
AvlIãr
 
i
;

374 c⁄° *
œ°
 = 
NULL
;

375 
boﬁ
 
œ°_£t
 = 
Ál£
;

377 
	`avl_f‹óch
(
i
, 
avl
) {

378 i‡(
œ°_£t
 && 
avl
->
	`com∑ª
(
œ°
, 
i
.
key
) >= 0)

379  
Ál£
;

380 
œ°
 = 
i
.
key
;

381 
œ°_£t
 = 
åue
;

384  
åue
;

385 
	}
}

387 
size_t
 
	$cou¡Node
(
AvlNode
 *
node
)

389 i‡(
node
)

390  1 + 
	`cou¡Node
(
node
->
Ã
[0]) + countNode(node->lr[1]);

393 
	}
}

398 
	$avl_ôî_begö
(
AvlIãr
 *
ôî
, 
AVL
 *
avl
, 
AvlDúe˘i⁄
 
dú
)

400 
AvlNode
 *
node
 = 
avl
->
roŸ
;

402 
ôî
->
°ack_ödex
 = 0;

403 
ôî
->
dúe˘i⁄
 = 
dú
;

405 i‡(
node
 =
NULL
) {

406 
ôî
->
key
 = 
NULL
;

407 
ôî
->
vÆue
 = 
NULL
;

408 
ôî
->
node
 = 
NULL
;

412 
node
->
Ã
[
dú
] !
NULL
) {

413 
ôî
->
°ack
[ôî->
°ack_ödex
++] = 
node
;

414 
node
 =Çode->
Ã
[
dú
];

417 
ôî
->
key
 = (*Ë
node
->key;

418 
ôî
->
vÆue
 = (*Ë
node
->value;

419 
ôî
->
node
 =Çode;

420 
	}
}

422 
	$avl_ôî_√xt
(
AvlIãr
 *
ôî
)

424 
AvlNode
 *
node
 = 
ôî
->node;

425 
AvlDúe˘i⁄
 
dú
 = 
ôî
->
dúe˘i⁄
;

427 i‡(
node
 =
NULL
)

430 
node
 =Çode->
Ã
[1 - 
dú
];

431 i‡(
node
 !
NULL
) {

432 
node
->
Ã
[
dú
] !
NULL
) {

433 
ôî
->
°ack
[ôî->
°ack_ödex
++] = 
node
;

434 
node
 =Çode->
Ã
[
dú
];

436 } i‡(
ôî
->
°ack_ödex
 > 0) {

437 
node
 = 
ôî
->
°ack
[--ôî->
°ack_ödex
];

439 
ôî
->
key
 = 
NULL
;

440 
ôî
->
vÆue
 = 
NULL
;

441 
ôî
->
node
 = 
NULL
;

445 
ôî
->
node
 =Çode;

446 
ôî
->
key
 = (*Ë
node
->key;

447 
ôî
->
vÆue
 = (*Ë
node
->value;

448 
	}
}

	@ccan/ccan/avl/avl.h

23 #i‚de‡
CCAN_AVL_H


24 
	#CCAN_AVL_H


	)

26 
	~<°dboﬁ.h
>

27 
	~<°ddef.h
>

29 
AVL
 
	tAVL
;

30 
AvlNode
 
	tAvlNode
;

31 
AvlIãr
 
	tAvlIãr
;

33 (*
	tAvlCom∑ª
)(const *, const *);

35 
AVL
 *
	`avl_√w
(
AvlCom∑ª
 
com∑ª
);

38 
	`avl_‰ì
(
AVL
 *
avl
);

41 *
	`avl_lookup
(c⁄° 
AVL
 *
avl
, c⁄° *
key
);

44 
	#avl_membî
(
avl
, 
key
Ë(!!
	`avl_lookup_node
◊vl, key))

	)

47 
size_t
 
	`avl_cou¡
(c⁄° 
AVL
 *
avl
);

50 
boﬁ
 
	`avl_ö£π
(
AVL
 *
avl
, c⁄° *
key
, c⁄° *
vÆue
);

57 
boﬁ
 
	`avl_ªmove
(
AVL
 *
avl
, c⁄° *
key
);

64 
boﬁ
 
	`avl_check_öv¨ü¡s
(
AVL
 *
avl
);

70 
	#avl_f‹óch
(
ôî
, 
avl
Ë
	`avl_åavî£
(ôî,ávl, 
FORWARD
)

	)

82 
	#avl_f‹óch_ªvî£
(
ôî
, 
avl
Ë
	`avl_åavî£
(ôî,ávl, 
BACKWARD
)

	)

85 
	eAvlDúe˘i⁄
 {
FORWARD
 = 0, 
BACKWARD
 = 1} 
	tAvlDúe˘i⁄
;

87 
	sAvlIãr
 {

88 *
key
;

89 *
vÆue
;

90 
AvlNode
 *
node
;

93 
AvlNode
 *
°ack
[100];

94 
°ack_ödex
;

95 
AvlDúe˘i⁄
 
dúe˘i⁄
;

98 
	`avl_ôî_begö
(
AvlIãr
 *
ôî
, 
AVL
 *
avl
, 
AvlDúe˘i⁄
 
dú
);

99 
	`avl_ôî_√xt
(
AvlIãr
 *
ôî
);

100 
	#avl_åavî£
(
ôî
, 
avl
, 
dúe˘i⁄
) \

101 
	`avl_ôî_begö
(&(
ôî
), 
avl
, 
dúe˘i⁄
); \

102 (
ôî
).
node
 !
NULL
; \

103 
	`avl_ôî_√xt
(&
ôî
))

	)

108 
	sAVL
 {

109 
AvlCom∑ª
 
com∑ª
;

110 
AvlNode
 *
roŸ
;

111 
size_t
 
cou¡
;

114 
	sAvlNode
 {

115 c⁄° *
key
;

116 c⁄° *
vÆue
;

118 
AvlNode
 *
Ã
[2];

119 
bÆ™˚
;

122 
AvlNode
 *
	`avl_lookup_node
(c⁄° 
AVL
 *
avl
, c⁄° *
key
);

	@ccan/ccan/avl/test/run.c

23 
	~<cˇn/avl/avl.h
>

25 
	#ªmove
 
ªmove_


	)

26 
	~<cˇn/avl/avl.c
>

27 #unde‡
ªmove


29 
	~<cˇn/èp/èp.h
>

31 
	~<°döt.h
>

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<°rög.h
>

36 
	#ANIMATE_RANDOM_ACCESS
 0

	)

38 #i‡
ANIMATE_RANDOM_ACCESS


40 
	~<sys/time.h
>

42 
öt64_t
 
	tm£c_t
;

44 
m£c_t
 
	$time_ms
()

46 
timevÆ
 
tv
;

47 
	`gëtimeofday
(&
tv
, 
NULL
);

48  (
m£c_t
)
tv
.
tv_£c
 * 1000 +Åv.
tv_u£c
 / 1000;

49 
	}
}

53 
uöt32_t
 
	gønd32_°©e
 = 0;

63 
uöt32_t
 
	$ønd32
()

65 
ønd32_°©e
 *(
uöt32_t
)0x7FF8A3ED;

66 
ønd32_°©e
 +(
uöt32_t
)0x2AA01D31;

67  
ønd32_°©e
;

68 
	}
}

70 
	$s¸ambÀ
(*
ba£
, 
size_t
 
nmemb
, size_à
size
)

72 *
i
 = 
ba£
;

73 *
o
;

74 
size_t
 
sd
;

75 ;
nmemb
>1;nmemb--) {

76 
o
 = 
i
 + 
size
*(
	`ønd32
()%
nmemb
);

77 
sd
=
size
;sd--;) {

78 
tmp
 = *
o
;

79 *
o
++ = *
i
;

80 *
i
++ = 
tmp
;

83 
	}
}

86 
size_t
 
	msuc˚ss
;

87 
size_t
 
	m∑s£d_öv¨ü¡s_checks
;

89 
size_t
 
	mex˚ss
;

90 
size_t
 
	mdu∂iˇã
;

91 
size_t
 
	mmissög
;

92 
size_t
 
	möc‹ª˘
;

93 
size_t
 
	mÁûed
;

94 
size_t
 
	mÁûed_öv¨ü¡s_checks
;

95 } 
	g°©s
;

97 
	$˛ór_°©s
()

99 
	`mem£t
(&
°©s
, 0, (stats));

100 
	}
}

102 
boﬁ
 
	$¥öt_°©s
(c⁄° *
suc˚ss_œbñ
, 
size_t
 
ex≥˘ed_suc˚ss
)

104 
Áûed
 = 0;

106 
	`¥ötf
(" %s: \t%zu\n", 
suc˚ss_œbñ
, 
°©s
.
suc˚ss
);

107 i‡(
°©s
.
suc˚ss
 !
ex≥˘ed_suc˚ss
)

108 
Áûed
 = 1;

110 i‡(
°©s
.
∑s£d_öv¨ü¡s_checks
)

111 
	`¥ötf
(" Pas£d inv¨ü¡†checks: %zu\n", 
°©s
.
∑s£d_öv¨ü¡s_checks
);

113 i‡(
°©s
.
ex˚ss
)

114 
Áûed
 = 1, 
	`¥ötf
(" Ex˚ss: \t%zu\n", 
°©s
.
ex˚ss
);

115 i‡(
°©s
.
du∂iˇã
)

116 
Áûed
 = 1, 
	`¥ötf
(" Du∂iˇã: \t%zu\n", 
°©s
.
du∂iˇã
);

117 i‡(
°©s
.
missög
)

118 
Áûed
 = 1, 
	`¥ötf
(" Missög: \t%zu\n", 
°©s
.
missög
);

119 i‡(
°©s
.
öc‹ª˘
)

120 
Áûed
 = 1, 
	`¥ötf
(" Inc‹ª˘: \t%zu\n", 
°©s
.
öc‹ª˘
);

121 i‡(
°©s
.
Áûed
)

122 
Áûed
 = 1, 
	`¥ötf
(" Faûed: \t%zu\n", 
°©s
.failed);

123 i‡(
°©s
.
Áûed_öv¨ü¡s_checks
)

124 
Áûed
 = 1, 
	`¥ötf
(" Faûed inv¨ü¡†checks: %zu\n", 
°©s
.
Áûed_öv¨ü¡s_checks
);

126  !
Áûed
;

127 
	}
}

129 
	sã°_ôem
 {

130 
uöt32_t
 
	mkey
;

131 
uöt32_t
 
	mvÆue
;

132 
size_t
 
	mö£π_id
;

135 
	$com∑ª_uöt32_t
(c⁄° *
≠
, c⁄° *
bp
)

137 
uöt32_t
 
a
 = *(c⁄° uöt32_à*)
≠
;

138 
uöt32_t
 
b
 = *(c⁄° uöt32_à*)
bp
;

140 i‡(
a
 < 
b
)

142 i‡(
a
 > 
b
)

145 
	}
}

147 
	$com∑ª_ã°_ôem
(c⁄° *
≠
, c⁄° *
bp
)

149 c⁄° 
ã°_ôem
 *
a
 = *(**)
≠
, *
b
 = *(**)
bp
;

151 i‡(
a
->
key
 < 
b
->key)

153 i‡(
a
->
key
 > 
b
->key)

156 i‡(
a
->
ö£π_id
 < 
b
->insert_id)

158 i‡(
a
->
ö£π_id
 > 
b
->insert_id)

162 
	}
}

164 
boﬁ
 
	$ã°_ö£π_ôem
(
AVL
 *
avl
, 
ã°_ôem
 *
ôem
)

166 
	`avl_ö£π
(
avl
, &
ôem
->
key
, &ôem->
vÆue
);

167  
åue
;

168 
	}
}

170 
boﬁ
 
	$ã°_lookup_ôem
(c⁄° 
AVL
 *
avl
, c⁄° 
ã°_ôem
 *
ôem
)

172  
	`avl_membî
(
avl
, &
ôem
->
key
Ë&& 
	`avl_lookup
◊vl, &ôem->keyË=&ôem->
vÆue
;

173 
	}
}

175 
boﬁ
 
	$ã°_ªmove_ôem
(
AVL
 *
avl
, 
ã°_ôem
 *
ôem
)

177  
	`avl_ªmove
(
avl
, &
ôem
->
key
);

178 
	}
}

180 
	$ã°_f‹óch
(
AVL
 *
avl
, 
ã°_ôem
 **
ã°_ôems
, 
cou¡
)

182 
AvlIãr
 
ôî
;

183 
i
;

185 
i
 = 0;

186 
	`avl_f‹óch
(
ôî
, 
avl
) {

187 i‡(
i
 >
cou¡
) {

188 
°©s
.
ex˚ss
++;

191 i‡(
ôî
.
key
 =&
ã°_ôems
[
i
]->key && iãr.
vÆue
 == &test_items[i]->value)

192 
°©s
.
suc˚ss
++;

194 
°©s
.
öc‹ª˘
++;

195 
i
++;

197 
	}
}

199 
	$ã°_f‹óch_ªvî£
(
AVL
 *
avl
, 
ã°_ôem
 **
ã°_ôems
, 
cou¡
)

201 
AvlIãr
 
ôî
;

202 
i
;

204 
i
 = 
cou¡
 - 1;

205 
	`avl_f‹óch_ªvî£
(
ôî
, 
avl
) {

206 i‡(
i
 < 0) {

207 
°©s
.
ex˚ss
++;

210 i‡(
ôî
.
key
 =&
ã°_ôems
[
i
]->key && iãr.
vÆue
 == &test_items[i]->value)

211 
°©s
.
suc˚ss
++;

213 
°©s
.
öc‹ª˘
++;

214 
i
--;

216 
	}
}

218 
	$bíchm¨k
(
size_t
 
max_≥r_åül
, size_à
round_cou¡
, 
boﬁ
 
øndom_cou¡s
, 
ˇrdöÆôy
)

220 
ã°_ôem
 **test_item;

221 
ã°_ôem
 *
ã°_ôem_¨øy
;

222 
size_t
 
i
, 
o
, 
cou¡
;

223 
size_t
 
round
 = 0;

225 
ã°_ôem
 = 
	`mÆloc
(
max_≥r_åül
 * (*test_item));

226 
ã°_ôem_¨øy
 = 
	`mÆloc
(
max_≥r_åül
 * (*test_item_array));

228 i‡(!
ã°_ôem
 || !
ã°_ôem_¨øy
) {

229 
	`Áû
("NotÉnough memory for %zu keysÖerÅrial\n",

230 
max_≥r_åül
);

235 
i
=0; i<
max_≥r_åül
; i++)

236 
ã°_ôem
[
i
] = &
ã°_ôem_¨øy
[i];

242 
round
 = 1; 
round_cou¡
==0 ||Ñound <=Ñound_count;Ñound++) {

243 
AVL
 *
avl
;

245 i‡(
ˇrdöÆôy
)

246 
	`¥ötf
("Round %zu (ˇrdöÆôy = %d)\n", 
round
, 
ˇrdöÆôy
);

248 
	`¥ötf
("Round %zu\n", 
round
);

250 i‡(
øndom_cou¡s
)

251 
cou¡
 = 
	`ønd32
(Ë% (
max_≥r_åül
+1);

253 
cou¡
 = 
max_≥r_åül
;

260 
i
=0; i<
cou¡
; i++) {

261 
ã°_ôem
[
i
]->
key
 = 
	`ønd32
();

262 
ã°_ôem
[
i
]->
vÆue
 = 
	`ønd32
();

264 i‡(
ˇrdöÆôy
)

265 
ã°_ôem
[
i
]->
key
 %
ˇrdöÆôy
;

267 
	`s¸ambÀ
(
ã°_ôem
, 
cou¡
, (*test_item));

269 
avl
 = 
	`avl_√w
(
com∑ª_uöt32_t
);

271 
	`˛ór_°©s
();

272 
	`¥ötf
(" In£πög %zu iãms...\n", 
cou¡
);

273 
i
=0; i<
cou¡
; i++) {

274 i‡(
	`ã°_ö£π_ôem
(
avl
, 
ã°_ôem
[
i
])) {

275 
°©s
.
suc˚ss
++;

276 
ã°_ôem
[
i
]->
ö£π_id
 = i;

278 
	`¥ötf
("öv¨ü¡†check faûedáàö£πi⁄ %zu\n", 
i
);

279 
°©s
.
Áûed
++;

283 i‡(
cou¡
 / 10 > 0 && 
i
 % (count / 10) == 0) {

284 i‡(
	`avl_check_öv¨ü¡s
(
avl
))

285 
°©s
.
∑s£d_öv¨ü¡s_checks
++;

287 
°©s
.
Áûed_öv¨ü¡s_checks
++;

290 
	`ok1
(
	`¥öt_°©s
("In£πed", 
cou¡
));

291 
	`ok1
(
	`avl_check_öv¨ü¡s
(
avl
));

294 
	`qs‹t
(
ã°_ôem
, 
cou¡
, (*ã°_ôem), 
com∑ª_ã°_ôem
);

295 
i
 = 0, 
o
 = 0; i < 
cou¡
;) {

296 
uöt32_t
 
k
 = 
ã°_ôem
[
i
]->
key
;

297 dÿ
i
++; ò< 
cou¡
 && 
ã°_ôem
[i]->
key
 =
k
);

298 
ã°_ôem
[
o
++] =Åe°_ôem[
i
-1];

300 
cou¡
 = 
o
;

301 
	`ok1
(
	`avl_cou¡
(
avl
Ë=
cou¡
);

303 
	`s¸ambÀ
(
ã°_ôem
, 
cou¡
, (*test_item));

305 
	`¥ötf
(" Födög %zu iãms...\n", 
cou¡
);

306 
	`˛ór_°©s
();

307 
i
=0; i<
cou¡
; i++) {

308 i‡(!
	`ã°_lookup_ôem
(
avl
, 
ã°_ôem
[
i
]))

309 
°©s
.
missög
++;

311 
°©s
.
suc˚ss
++;

313 
	`ok1
(
	`¥öt_°©s
("Rërõved", 
cou¡
));

315 
	`qs‹t
(
ã°_ôem
, 
cou¡
, (*ã°_ôem), 
com∑ª_ã°_ôem
);

317 
	`¥ötf
(" Tøvîsög f‹w¨dÅhrough %zu iãms...\n", 
cou¡
);

318 
	`˛ór_°©s
();

319 
	`ã°_f‹óch
(
avl
, 
ã°_ôem
, 
cou¡
);

320 
	`ok1
(
	`¥öt_°©s
("Tøvî£d", 
cou¡
));

322 
	`¥ötf
(" Tøvîsög backw¨dÅhrough %zu iãms...\n", 
cou¡
);

323 
	`˛ór_°©s
();

324 
	`ã°_f‹óch_ªvî£
(
avl
, 
ã°_ôem
, 
cou¡
);

325 
	`ok1
(
	`¥öt_°©s
("Tøvî£d", 
cou¡
));

327 
	`s¸ambÀ
(
ã°_ôem
, 
cou¡
, (*test_item));

329 
	`¥ötf
(" Dñëög %zu iãms...\n", 
cou¡
);

330 
	`˛ór_°©s
();

331 
i
=0; i<
cou¡
; i++) {

332 i‡(
	`ã°_ªmove_ôem
(
avl
, 
ã°_ôem
[
i
]))

333 
°©s
.
suc˚ss
++;

335 
°©s
.
missög
++;

338 i‡(
cou¡
 / 10 > 0 && 
i
 % (count / 10) == 0) {

339 i‡(
	`avl_check_öv¨ü¡s
(
avl
))

340 
°©s
.
∑s£d_öv¨ü¡s_checks
++;

342 
°©s
.
Áûed_öv¨ü¡s_checks
++;

345 
	`ok1
(
	`¥öt_°©s
("Dñëed", 
cou¡
));

346 
	`ok1
(
	`avl_cou¡
(
avl
) == 0);

347 
	`ok1
(
	`avl_check_öv¨ü¡s
(
avl
));

349 
	`avl_‰ì
(
avl
);

352 
	`‰ì
(
ã°_ôem
);

353 
	`‰ì
(
ã°_ôem_¨øy
);

354 
	}
}

356 
	$com∑ª_±r
(c⁄° *
a
, c⁄° *
b
)

358 i‡(
a
 < 
b
)

360 i‡(
a
 > 
b
)

363 
	}
}

365 
	sÁû_tŸÆ
 {

366 
öt64_t
 
	mÁû
;

367 
öt64_t
 
	mtŸÆ
;

370 
boﬁ
 
	$¥öt_∑ss_Áû
(
Áû_tŸÆ
 *
pf
, c⁄° *
œbñ
)

372 
Áû
 = 
pf
->fail,

373 
tŸÆ
 = 
pf
->total;

375 
	`¥ötf
("%s:\t%Œd / %Œd\n", 
œbñ
, 
tŸÆ
 - 
Áû
,Åotal);

377  
Áû
 == 0;

378 
	}
}

380 
	$ã°_øndom_ac˚ss
(
uöt32_t
 
max
, 
öt64_t
 
›s
)

382 *
ö_åì
;

383 
AVL
 *
avl
;

384 
öt64_t
 
i
;

386 
Áû_tŸÆ


387 
ö£πs
, 
lookups
, 
ªmoves
, 
checks
;

388 } 
s
;

390 #i‡
ANIMATE_RANDOM_ACCESS


391 
m£c_t
 
œ°_upd©e
, 
now
;

392 
m£c_t
 
öãrvÆ
 = 100;

395 
	`mem£t
(&
s
, 0, (s));

397 
ö_åì
 = 
	`mÆloc
(
max
);

398 
	`mem£t
(
ö_åì
, 0, 
max
);

400 
avl
 = 
	`avl_√w
(
com∑ª_±r
);

402 #i‡
ANIMATE_RANDOM_ACCESS


403 
now
 = 
	`time_ms
();

404 
œ°_upd©e
 = 
now
 - 
öãrvÆ
;

407 
i
 = 0; i < 
›s
; i++) {

408 *
ôem
 = &
ö_åì
[
	`ønd32
(Ë% 
max
];

409 *
found
;

410 
boﬁ
 
ö£πed
, 
ªmoved
;

412 #i‡
ANIMATE_RANDOM_ACCESS


413 
now
 = 
	`time_ms
();

414 i‡(
now
 >
œ°_upd©e
 + 
öãrvÆ
) {

415 
œ°_upd©e
 = 
now
;

416 
	`¥ötf
("\r%.2f%%\t%zu / %zu\033[K", ()
i
 * 100 / 
›s
, 
	`avl_cou¡
(
avl
), 
max
);

417 
	`fÊush
(
°dout
);

421 
	`ønd32
() % 3) {

423 
ö£πed
 = 
	`avl_ö£π
(
avl
, 
ôem
, item);

425 i‡((*
ôem
 =0 && !
ö£πed
) ||

426 (*
ôem
 =1 && 
ö£πed
))

427 
s
.
ö£πs
.
Áû
++;

429 i‡(
ö£πed
)

430 *
ôem
 = 1;

432 
s
.
ö£πs
.
tŸÆ
++;

436 
found
 = 
	`avl_lookup
(
avl
, 
ôem
);

438 i‡((*
ôem
 =0 && 
found
 !
NULL
) ||

439 (*
ôem
 =1 && 
found
 != item) ||

440 (
	`avl_membî
(
avl
, 
ôem
Ë!!!
found
))

441 
s
.
lookups
.
Áû
++;

443 
s
.
lookups
.
tŸÆ
++;

447 
ªmoved
 = 
	`avl_ªmove
(
avl
, 
ôem
);

449 i‡((*
ôem
 =0 && 
ªmoved
) ||

450 (*
ôem
 =1 && !
ªmoved
))

451 
s
.
ªmoves
.
Áû
++;

453 i‡(
ªmoved
)

454 *
ôem
 = 0;

456 
s
.
ªmoves
.
tŸÆ
++;

461 i‡(
›s
 / 10 > 0 && 
i
 % (ops / 10) == 0) {

462 i‡(!
	`avl_check_öv¨ü¡s
(
avl
))

463 
s
.
checks
.
Áû
++;

464 
s
.
checks
.
tŸÆ
++;

468 #i‡
ANIMATE_RANDOM_ACCESS


469 
	`¥ötf
("\r\033[K");

472 
	`avl_‰ì
(
avl
);

473 
	`‰ì
(
ö_åì
);

475 
	`ok1
(
	`¥öt_∑ss_Áû
(&
s
.
ö£πs
, "Inserts"));

476 
	`ok1
(
	`¥öt_∑ss_Áû
(&
s
.
lookups
, "Lookups"));

477 
	`ok1
(
	`¥öt_∑ss_Áû
(&
s
.
ªmoves
, "Removes"));

478 
	`ok1
(
	`¥öt_∑ss_Áû
(&
s
.
checks
, "Invariants checks"));

479 
	}
}

481 
	$maö
()

483 
	`∂™_ã°s
(18 * 3 + 4);

485 
	`bíchm¨k
(100000, 2, 
Ál£
, 0);

486 
	`bíchm¨k
(100000, 2, 
Ál£
, 12345);

487 
	`bíchm¨k
(100000, 2, 
Ál£
, 100001);

489 
	`¥ötf
("RunningÑandomáccessÅest\n");

490 
	`ã°_øndom_ac˚ss
(12345, 1234567);

492  
	`exô_°©us
();

493 
	}
}

	@ccan/ccan/bdelta/bdelta.c

23 
	~"bdñè.h
"

25 
	~<as£π.h
>

26 
	~<limôs.h
>

27 
	~<°döt.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

34 *
	mcur
;

35 *
	míd
;

36 *
	m°¨t
;

37 } 
	tSB
;

40 
	#sb_size
(
sb
Ë((
size_t
)((sb)->
cur
 - (sb)->
°¨t
))

	)

41 
	#sb_avaû
(
sb
Ë((
size_t
)((sb)->
íd
 - (sb)->
cur
))

	)

44 
	#sb_√ed
(
sb
, 
√ed
) do { \

45 i‡(
	`sb_avaû
(
sb
Ë< (
√ed
)) \

46 i‡(
	`sb_grow
(
sb
, 
√ed
) != 0) \

47 
out_of_mem‹y
; \

48 } 0)

	)

50 
	$sb_öô
(
SB
 *
sb
)

52 
sb
->
°¨t
 = 
	`mÆloc
(17);

53 i‡(
sb
->
°¨t
 =
NULL
)

55 
sb
->
cur
 = sb->
°¨t
;

56 
sb
->
íd
 = sb->
°¨t
 + 16;

58 
	}
}

60 
	$sb_grow
(
SB
 *
sb
, 
size_t
 
√ed
)

62 
size_t
 
Àngth
 = 
sb
->
cur
 - sb->
°¨t
;

63 
size_t
 
Æloc
 = 
sb
->
íd
 - sb->
°¨t
;

64 *
tmp
;

67 
Æloc
 *= 2;

68 } 
Æloc
 < 
Àngth
 + 
√ed
);

70 
tmp
 = 
	`ªÆloc
(
sb
->
°¨t
, 
Æloc
 + 1);

71 i‡(
tmp
 =
NULL
)

73 
sb
->
°¨t
 = 
tmp
;

74 
sb
->
cur
 = 
tmp
 + 
Àngth
;

75 
sb
->
íd
 = 
tmp
 + 
Æloc
;

77 
	}
}

79 
	$sb_putc
(
SB
 *
sb
, 
c
)

81 
	`sb_√ed
(
sb
, 1);

82 *
sb
->
cur
++ = 
c
;

85 
out_of_mem‹y
:

87 
	}
}

89 
	$sb_wrôe
(
SB
 *
sb
, c⁄° *
d©a
, 
size_t
 
size
)

91 
	`sb_√ed
(
sb
, 
size
);

92 
	`mem˝y
(
sb
->
cur
, 
d©a
, 
size
);

93 
sb
->
cur
 +
size
;

96 
out_of_mem‹y
:

98 
	}
}

100 
	$sb_ªtu∫
(
SB
 *
sb
, **
d©a_out
, 
size_t
 *
Àngth_out
)

102 *
sb
->
cur
 = 0;

103 i‡(
d©a_out
)

104 *
d©a_out
 = 
sb
->
°¨t
;

106 
	`‰ì
(
sb
->
°¨t
);

107 i‡(
Àngth_out
)

108 *
Àngth_out
 = 
sb
->
cur
 - sb->
°¨t
;

109 
	}
}

111 
	$sb_disˇrd
(
SB
 *
sb
, **
d©a_out
, 
size_t
 *
Àngth_out
)

113 
	`‰ì
(
sb
->
°¨t
);

114 i‡(
d©a_out
)

115 *
d©a_out
 = 
NULL
;

116 i‡(
Àngth_out
)

117 *
Àngth_out
 = 0;

118 
	}
}

152 
	#PT_LITERAL
 10

	)

153 
	#PT_CSI32
 11

	)

155 
	#OP_COPY
 1

	)

156 
	#OP_SKIP
 2

	)

157 
	#OP_INSERT
 3

	)

159 
	$byãs_√eded_f‹_size
(
uöt32_t
 
size
)

161 i‡(
size
 == 1)

163 i‡(
size
 <= 0xFF)

165 i‡(
size
 <= 0xFFFF)

167 i‡(
size
 <= 0xFFFFFF)

171 
	}
}

179 
BDELTAcode
 
	$csi32_emô_›
(
SB
 *
∑tch_out
, 
›
, 
uöt32_t
 
size
, c⁄° **
√w_
)

181 
i
;

182 
size_∑øm_Àngth
;

183 
size_t
 
√ed
;

184 
uöt32_t
 
tmp
;

186 
	`as£π
(
›
 >= 1 && op <= 3);

188 i‡(
size
 == 0)

189  
BDELTA_OK
;

190 
size_∑øm_Àngth
 = 
	`byãs_√eded_f‹_size
(
size
);

192 
√ed
 = 1 + 
size_∑øm_Àngth
;

193 i‡(
›
 =
OP_INSERT
)

194 
√ed
 +
size
;

195 
	`sb_√ed
(
∑tch_out
, 
√ed
);

197 *
∑tch_out
->
cur
++ = ()
›
 | 
size_∑øm_Àngth
 << 2;

198 
i
 = 
size_∑øm_Àngth
, 
tmp
 = 
size
; i-- > 0;Åmp >>= 8)

199 
∑tch_out
->
cur
[
i
] = 
tmp
 & 0xFF;

200 
∑tch_out
->
cur
 +
size_∑øm_Àngth
;

202 
›
) {

203 
OP_COPY
:

204 *
√w_
 +
size
;

206 
OP_SKIP
:

208 
OP_INSERT
:

209 
	`mem˝y
(
∑tch_out
->
cur
, *
√w_
, 
size
);

210 
∑tch_out
->
cur
 +
size
;

211 *
√w_
 +
size
;

214 
	`as£π
(0);

217  
BDELTA_OK
;

219 
out_of_mem‹y
:

220  
BDELTA_MEMORY
;

221 
	}
}

227 
	$csi32_∑r£_›
(

228 c⁄° **
•
, c⁄° *
e
,

229 *
›_out
, 
uöt32_t
 *
size_out
)

231 c⁄° *
s
 = *
•
;

232 
›
;

233 
i
;

234 
size_∑øm_Àngth
;

235 
uöt32_t
 
size
;

237 i‡(
s
 >
e
)

239 
›
 = *
s
 & 3;

240 
size_∑øm_Àngth
 = *
s
 >> 2;

241 
s
++;

242 i‡(
›
 =0 || 
size_∑øm_Àngth
 > 4)

245 i‡(
size_∑øm_Àngth
 == 0) {

246 
size
 = 1;

248 i‡((
size_t
)(
e
 - 
s
Ë< 
size_∑øm_Àngth
)

250 
size
 = 0;

251 
i
 = 0; i < 
size_∑øm_Àngth
; i++) {

252 
size
 <<= 8;

253 
size
 |*
s
++ & 0xFF;

258 i‡(
›
 =
OP_INSERT
 && (
size_t
)(
e
 - 
s
Ë< 
size
)

261 *
›_out
 = 
›
;

262 *
size_out
 = 
size
;

263 *
•
 = 
s
;

265 
	}
}

320 
uöt32_t
 *
	md©a
;

321 
	msﬁuti⁄_d
;

322 
	msﬁuti⁄_k
;

323 
uöt32_t
 *
	msﬁuti⁄_±r
;

324 } 
	tTrüngÀ
;

333 
BDELTAcode
 
	$buûd_åüngÀ
(

334 c⁄° *
ﬁd
, 
uöt32_t
 
ﬁd_size
,

335 c⁄° *
√w_
, 
uöt32_t
 
√w_size
,

336 
d_max
,

337 
TrüngÀ
 *
åüngÀ_out
)

339 
d
, 
k
;

340 
uöt32_t
 
x
, 
y
;

341 
uöt32_t
 *
d©a
;

342 
uöt32_t
 *
v¥ev
;

343 
uöt32_t
 *
v
;

344 
uöt32_t
 *
vcur
;

345 
size_t
 
d©a_Æloc
 = 16;

347 
	`mem£t
(
åüngÀ_out
, 0, (*triangle_out));

349 
d©a
 = 
	`mÆloc
(
d©a_Æloc
 * (*data));

350 i‡(
d©a
 =
NULL
)

351  
BDELTA_MEMORY
;

354 i‡(
d_max
 < 0)

355 
d_max
 = 
ﬁd_size
 + 
√w_size
;

361 
x
 = 0; x < 
ﬁd_size
 && x < 
√w_size
 && 
ﬁd
[x] =
√w_
[x]; )

362 
x
++;

363 *
d©a
 = 
x
;

364 i‡(
x
 >
ﬁd_size
 && x >
√w_size
) {

366 
	`as£π
(
x
 =
ﬁd_size
 && x =
√w_size
);

367 
åüngÀ_out
->
d©a
 = data;

368 
åüngÀ_out
->
sﬁuti⁄_d
 = 0;

369 
åüngÀ_out
->
sﬁuti⁄_k
 = 0;

370 
åüngÀ_out
->
sﬁuti⁄_±r
 = 
d©a
;

371  
BDELTA_OK
;

373 
v¥ev
 = 
d©a
;

374 
vcur
 = 
v
 = 
d©a
 + 1;

391 
d
 = 1; d <
d_max
; d++, 
v¥ev
 = 
vcur
, vcu∏
v
) {

393 i‡((
size_t
)(
v
 - 
d©a
 + 
d
 + 1Ë> 
d©a_Æloc
) {

394 
size_t
 
v¥ev_idx
 = 
v¥ev
 - 
d©a
;

395 
size_t
 
v_idx
 = 
v
 - 
d©a
;

396 
size_t
 
vcur_idx
 = 
vcur
 - 
d©a
;

397 
uöt32_t
 *
tmp
;

400 
d©a_Æloc
 *= 2;

401 } (
size_t
)(
v
 - 
d©a
 + 
d
 + 1Ë> 
d©a_Æloc
);

403 
tmp
 = 
	`ªÆloc
(
d©a
, 
d©a_Æloc
 * (*data));

404 i‡(
tmp
 =
NULL
) {

405 
	`‰ì
(
d©a
);

406  
BDELTA_MEMORY
;

408 
d©a
 = 
tmp
;

411 
v¥ev
 = 
d©a
 + 
v¥ev_idx
;

412 
v
 = 
d©a
 + 
v_idx
;

413 
vcur
 = 
d©a
 + 
vcur_idx
;

416 
k
 = -
d
; k <d; k +2, 
v¥ev
++) {

417 i‡(
k
 =-
d
 || (k !d && 
v¥ev
[-1] < vprev[0]))

418 
x
 = 
v¥ev
[0];

420 
x
 = 
v¥ev
[-1] + 1;

421 
y
 = 
x
 - 
k
;

422 
x
 < 
ﬁd_size
 && 
y
 < 
√w_size
 && 
ﬁd
[x] =
√w_
[y])

423 
x
++, 
y
++;

424 *
v
++ = 
x
;

425 i‡(
x
 >
ﬁd_size
 && 
y
 >
√w_size
) {

427 
	`as£π
(
x
 =
ﬁd_size
 && 
y
 =
√w_size
);

428 
åüngÀ_out
->
d©a
 = data;

429 
åüngÀ_out
->
sﬁuti⁄_d
 = 
d
;

430 
åüngÀ_out
->
sﬁuti⁄_k
 = 
k
;

431 
åüngÀ_out
->
sﬁuti⁄_±r
 = 
v
 - 1;

432  
BDELTA_OK
;

437 
	`‰ì
(
d©a
);

438  
BDELTA_INTERNAL_DMAX_EXCEEDED
;

439 
	}
}

453 sig√d *
	$˛imb_åüngÀ
(c⁄° 
TrüngÀ
 *
åüngÀ
)

455 sig√d *
des˚¡
;

456 
d
, 
k
;

457 
uöt32_t
 *
p
;

459 
	`as£π
(
åüngÀ
->
sﬁuti⁄_d
 >= 0);

461 
des˚¡
 = 
	`mÆloc
(
åüngÀ
->
sﬁuti⁄_d
 + 1);

462 i‡(
des˚¡
 =
NULL
)

463  
NULL
;

464 
d
 = 
åüngÀ
->
sﬁuti⁄_d
;

465 
k
 = 
åüngÀ
->
sﬁuti⁄_k
;

466 
p
 = 
åüngÀ
->
sﬁuti⁄_±r
;

467 
des˚¡
[
d
] = 0;

469 
d
 > 0) {

470 i‡(
k
 =-
d
 || (k !d && *(
p
-d-1) < *(p-d))) {

472 
k
++;

473 
p
 =Ö - 
d
;

474 
des˚¡
[--
d
] = -1;

477 
k
--;

478 
p
 =Ö - 
d
 - 1;

479 
des˚¡
[--
d
] = 1;

483  
des˚¡
;

484 
	}
}

500 
BDELTAcode
 
	$des˚¡_to_∑tch
(

501 c⁄° sig√d *
des˚¡
,

502 c⁄° 
TrüngÀ
 *
åüngÀ
,

503 c⁄° *
√w_
, 
uöt32_t
 
√w_size
,

504 
SB
 *
∑tch_out
)

506 c⁄° *
√w_íd
 = 
√w_
 + 
√w_size
;

507 
uöt32_t
 *
p
 = 
åüngÀ
->
d©a
;

508 
uöt32_t
 *
p2
;

509 
d
 = 0;

510 
k
 = 0;

511 
≥ndög_›
 = 0;

512 
cuºít_›
;

513 
uöt32_t
 
≥ndög_Àngth
 = 0;

514 
uöt32_t
 
c›y_Àngth
;

516 i‡(
	`sb_putc
(
∑tch_out
, 
PT_CSI32
) != 0)

517  
BDELTA_MEMORY
;

519 i‡(*
p
 > 0) {

520 i‡(
	`csi32_emô_›
(
∑tch_out
, 
OP_COPY
, *
p
, &
√w_
Ë!
BDELTA_OK
)

521  
BDELTA_MEMORY
;

524 ; *
des˚¡
 !0; des˚¡++, 
p
 = 
p2
) {

525 i‡(*
des˚¡
 < 0) {

527 
d
++;

528 
k
--;

529 
p2
 = 
p
 + 
d
;

530 
cuºít_›
 = 
OP_INSERT
;

531 
	`as£π
(*
p2
 >*
p
);

532 
c›y_Àngth
 = *
p2
 - *
p
;

535 
d
++;

536 
k
++;

537 
p2
 = 
p
 + 
d
 + 1;

538 
cuºít_›
 = 
OP_SKIP
;

539 
	`as£π
(*
p2
 > *
p
);

540 
c›y_Àngth
 = *
p2
 - *
p
 - 1;

543 i‡(
≥ndög_›
 =
cuºít_›
) {

544 
≥ndög_Àngth
++;

546 i‡(
≥ndög_›
 != 0) {

547 i‡(
	`csi32_emô_›
(
∑tch_out
, 
≥ndög_›
, 
≥ndög_Àngth
, &
√w_
Ë!
BDELTA_OK
)

548  
BDELTA_MEMORY
;

550 
≥ndög_›
 = 
cuºít_›
;

551 
≥ndög_Àngth
 = 1;

554 i‡(
c›y_Àngth
 > 0) {

555 i‡(
	`csi32_emô_›
(
∑tch_out
, 
≥ndög_›
, 
≥ndög_Àngth
, &
√w_
Ë!
BDELTA_OK
)

556  
BDELTA_MEMORY
;

557 
≥ndög_›
 = 0;

558 i‡(
	`csi32_emô_›
(
∑tch_out
, 
OP_COPY
, 
c›y_Àngth
, &
√w_
Ë!
BDELTA_OK
)

559  
BDELTA_MEMORY
;

562 
	`as£π
(
d
 =
åüngÀ
->
sﬁuti⁄_d
);

563 
	`as£π
(
k
 =
åüngÀ
->
sﬁuti⁄_k
);

564 
	`as£π
(
p
 =
åüngÀ
->
sﬁuti⁄_±r
);

567 i‡(
≥ndög_›
 !0 &&Öídög_› !
OP_SKIP
) {

568 i‡(
	`csi32_emô_›
(
∑tch_out
, 
≥ndög_›
, 
≥ndög_Àngth
, &
√w_
Ë!
BDELTA_OK
)

569  
BDELTA_MEMORY
;

572 
	`as£π
(
√w_
 =
√w_íd
);

573  
BDELTA_OK
;

574 
	}
}

588 
BDELTAcode
 
	$diff_myîs
(

589 c⁄° *
ﬁd
, 
size_t
 
ﬁd_size
,

590 c⁄° *
√w_
, 
size_t
 
√w_size
,

591 
SB
 *
∑tch_out
)

593 
TrüngÀ
 
åüngÀ
;

594 sig√d *
des˚¡
;

595 
BDELTAcode
 
rc
;

598 i‡(
ﬁd_size
 >
UINT32_MAX
 ||

599 
√w_size
 >
UINT32_MAX
 - 
ﬁd_size
 ||

600 
ﬁd_size
 >()
INT_MAX
 ||

601 
√w_size
 >()
INT_MAX
 - 
ﬁd_size
)

602  
BDELTA_INTERNAL_INPUTS_TOO_LARGE
;

604 
rc
 = 
	`buûd_åüngÀ
(
ﬁd
, 
ﬁd_size
, 
√w_
, 
√w_size
, 1000, &
åüngÀ
);

605 i‡(
rc
 !
BDELTA_OK
)

606  
rc
;

608 
des˚¡
 = 
	`˛imb_åüngÀ
(&
åüngÀ
);

609 i‡(
des˚¡
 =
NULL
)

610 
oom1
;

612 i‡(
	`des˚¡_to_∑tch
(
des˚¡
, &
åüngÀ
, 
√w_
, 
√w_size
, 
∑tch_out
Ë!
BDELTA_OK
)

613 
oom2
;

615 
	`‰ì
(
des˚¡
);

616 
	`‰ì
(
åüngÀ
.
d©a
);

617  
BDELTA_OK
;

619 
oom2
:

620 
	`‰ì
(
des˚¡
);

621 
oom1
:

622 
	`‰ì
(
åüngÀ
.
d©a
);

623  
BDELTA_MEMORY
;

624 
	}
}

626 
BDELTAcode
 
	$bdñè_diff
(

627 c⁄° *
ﬁd
, 
size_t
 
ﬁd_size
,

628 c⁄° *
√w_
, 
size_t
 
√w_size
,

629 **
∑tch_out
, 
size_t
 *
∑tch_size_out
)

631 
SB
 
∑tch
;

633 i‡(
	`sb_öô
(&
∑tch
) != 0)

634 
out_of_mem‹y
;

636 i‡(
√w_size
 == 0)

637 
emô_√w_lôîÆly
;

639 i‡(
	`diff_myîs
(
ﬁd
, 
ﬁd_size
, 
√w_
, 
√w_size
, &
∑tch
Ë!
BDELTA_OK
)

640 
emô_√w_lôîÆly
;

642 i‡(
	`sb_size
(&
∑tch
Ë> 
√w_size
) {

647 
emô_√w_lôîÆly
;

656 *
ªsu…
;

657 
size_t
 
ªsu…_size
;

658 
BDELTAcode
 
rc
;

659 
c‹ª˘
;

661 
rc
 = 
	`bdñè_∑tch
(

662 
ﬁd
, 
ﬁd_size
,

663 
∑tch
.
°¨t
,Ö©ch.
cur
 -Öatch.start,

664 &
ªsu…
, &
ªsu…_size


667 
rc
) {

668 
BDELTA_OK
:

669 
c‹ª˘
 = (
ªsu…_size
 =
√w_size
 &&

670 
	`memcmp
(
ªsu…
, 
√w_
, 
√w_size
) == 0);

671 
	`‰ì
(
ªsu…
);

674 
BDELTA_MEMORY
:

675 
out_of_mem‹y
;

678 
c‹ª˘
 = 0;

682 i‡(!
c‹ª˘
) {

683 
	`as£π
(0);

684 
emô_√w_lôîÆly
;

688 
	`sb_ªtu∫
(&
∑tch
, 
∑tch_out
, 
∑tch_size_out
);

689  
BDELTA_OK
;

691 
emô_√w_lôîÆly
:

692 i‡(
∑tch
.
cur
 !∑tch.
°¨t
) {

693 
	`‰ì
(
∑tch
.
°¨t
);

694 i‡(
	`sb_öô
(&
∑tch
) != 0)

695 
out_of_mem‹y
;

697 i‡(
	`sb_putc
(&
∑tch
, 
PT_LITERAL
Ë!0 || 
	`sb_wrôe
(&∑tch, 
√w_
, 
√w_size
) != 0)

698 
out_of_mem‹y
;

699 
	`sb_ªtu∫
(&
∑tch
, 
∑tch_out
, 
∑tch_size_out
);

700  
BDELTA_OK
;

702 
out_of_mem‹y
:

703 
	`sb_disˇrd
(&
∑tch
, 
∑tch_out
, 
∑tch_size_out
);

704  
BDELTA_MEMORY
;

705 
	}
}

715 
BDELTAcode
 
	$∑tch_csi32
(

716 c⁄° *
o
, c⁄° *
€
,

717 c⁄° *
p
, c⁄° *
≥
,

718 
SB
 *
√w_out
)

720 
›
;

721 
uöt32_t
 
size
;

723 
	`csi32_∑r£_›
(&
p
, 
≥
, &
›
, &
size
)) {

724 i‡((
›
 =
OP_COPY
 || o∞=
OP_SKIP
Ë&& (
size_t
)(
€
 - 
o
Ë< 
size
) {

726  
BDELTA_PATCH_MISMATCH
;

728 i‡(
›
 =
OP_COPY
 || o∞=
OP_INSERT
)

729 
	`sb_√ed
(
√w_out
, 
size
);

731 
›
) {

732 
OP_COPY
:

733 
	`mem˝y
(
√w_out
->
cur
, 
o
, 
size
);

734 
√w_out
->
cur
 +
size
;

735 
o
 +
size
;

738 
OP_SKIP
:

739 
o
 +
size
;

742 
OP_INSERT
:

743 
	`mem˝y
(
√w_out
->
cur
, 
p
, 
size
);

744 
√w_out
->
cur
 +
size
;

745 
p
 +
size
;

749 
	`as£π
(0);

752 i‡(
p
 !
≥
)

753  
BDELTA_PATCH_INVALID
;

755  
BDELTA_OK
;

757 
out_of_mem‹y
:

758  
BDELTA_MEMORY
;

759 
	}
}

761 
BDELTAcode
 
	$bdñè_∑tch
(

762 c⁄° *
ﬁd
, 
size_t
 
ﬁd_size
,

763 c⁄° *
∑tch
, 
size_t
 
∑tch_size
,

764 **
√w_out
, 
size_t
 *
√w_size_out
)

766 c⁄° *
o
 = 
ﬁd
;

767 c⁄° *
€
 = 
o
 + 
ﬁd_size
;

768 c⁄° *
p
 = 
∑tch
;

769 c⁄° *
≥
 = 
p
 + 
∑tch_size
;

770 
SB
 
ªsu…
;

771 
BDELTAcode
 
rc
;

773 i‡(
	`sb_öô
(&
ªsu…
) != 0) {

774 
rc
 = 
BDELTA_MEMORY
;

775 
disˇrd
;

778 i‡(
p
 >
≥
) {

779 
rc
 = 
BDELTA_PATCH_INVALID
;

780 
disˇrd
;

783 *
p
++) {

784 
PT_LITERAL
:

785 i‡(
	`sb_wrôe
(&
ªsu…
, 
p
, 
≥
 -Ö) != 0) {

786 
rc
 = 
BDELTA_MEMORY
;

787 
disˇrd
;

791 
PT_CSI32
:

792 
rc
 = 
	`∑tch_csi32
(
o
, 
€
, 
p
, 
≥
, &
ªsu…
);

793 i‡(
rc
 !
BDELTA_OK
)

794 
disˇrd
;

798 
rc
 = 
BDELTA_PATCH_INVALID
;

799 
disˇrd
;

802 
	`sb_ªtu∫
(&
ªsu…
, 
√w_out
, 
√w_size_out
);

803  
BDELTA_OK
;

805 
disˇrd
:

806 
	`sb_disˇrd
(&
ªsu…
, 
√w_out
, 
√w_size_out
);

807  
rc
;

808 
	}
}

810 c⁄° *
	$bdñè_°ªº‹
(
BDELTAcode
 
code
)

812 
code
) {

813 
BDELTA_OK
:

815 
BDELTA_MEMORY
:

817 
BDELTA_PATCH_INVALID
:

819 
BDELTA_PATCH_MISMATCH
:

822 
BDELTA_INTERNAL_DMAX_EXCEEDED
:

824 
BDELTA_INTERNAL_INPUTS_TOO_LARGE
:

830 
	}
}

832 
	$bdñè_≥º‹
(c⁄° *
s
, 
BDELTAcode
 
code
)

834 i‡(
s
 !
NULL
 && *s != '\0')

835 
	`Ârötf
(
°dîr
, "%s: %s\n", 
s
, 
	`bdñè_°ªº‹
(
code
));

837 
	`Ârötf
(
°dîr
, "%s\n", 
	`bdñè_°ªº‹
(
code
));

838 
	}
}

	@ccan/ccan/bdelta/bdelta.h

23 #i‚de‡
CCAN_BDELTA_H


24 
	#CCAN_BDELTA_H


	)

26 
	~<°ddef.h
>

29 
	mBDELTA_OK
 = 0,

31 
	mBDELTA_MEMORY
 = 1,

32 
	mBDELTA_PATCH_INVALID
 = 2,

33 
	mBDELTA_PATCH_MISMATCH
 = 3,

36 
	mBDELTA_INTERNAL_DMAX_EXCEEDED
 = -10,

37 
	mBDELTA_INTERNAL_INPUTS_TOO_LARGE
 = -11,

38 } 
	tBDELTAcode
;

64 
BDELTAcode
 
bdñè_diff
(

65 c⁄° *
ﬁd
, 
size_t
 
ﬁd_size
,

66 c⁄° *
√w_
, 
size_t
 
√w_size
,

67 **
∑tch_out
, 
size_t
 *
∑tch_size_out


94 
BDELTAcode
 
bdñè_∑tch
(

95 c⁄° *
ﬁd
, 
size_t
 
ﬁd_size
,

96 c⁄° *
∑tch
, 
size_t
 
∑tch_size
,

97 **
√w_out
, 
size_t
 *
√w_size_out


103 c⁄° *
bdñè_°ªº‹
(
BDELTAcode
 
code
);

110 
bdñè_≥º‹
(c⁄° *
s
, 
BDELTAcode
 
code
);

	@ccan/ccan/bdelta/test/common.h

1 
	~<cˇn/bdñè/bdñè.h
>

2 
	~<cˇn/bdñè/bdñè.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	~<°döt.h
>

6 
	~<°dlib.h
>

7 
	~<°rög.h
>

15 
uöt32_t
 
	$ønd32
()

24 
	`as£π
(
RAND_MAX
 == 2147483647);

25  ((
	`øndom
() & 0xFFFF) << 16) | (random() & 0xFFFF);

27 
uöt32_t
 
ønd32_°©e
 = 0;

28 
ønd32_°©e
 *(
uöt32_t
)0x7FF8A3ED;

29 
ønd32_°©e
 +(
uöt32_t
)0x2AA01D31;

30  
ønd32_°©e
;

32 
	}
}

34 
	#RSTRING_OK
 0

	)

35 
	#RSTRING_MEMORY
 1

	)

36 
	#RSTRING_ZERO_CARDINALITY
 2

	)

37 
	#RSTRING_RANGE_OVERLAP
 3

	)

39 
	sr°rög_byã_ønge
 {

40 
	mˇrdöÆôy
;

41 
	mmu…ùlõr
;

42 
	moff£t
;

45 
	$check_ønge
(c⁄° 
r°rög_byã_ønge
 *
ønge
)

47 
i
;

48 
c
;

49 
£t
[256];

51 i‡(
ønge
 =
NULL
)

52  
RSTRING_OK
;

54 i‡(
ønge
->
ˇrdöÆôy
 == 0)

55  
RSTRING_ZERO_CARDINALITY
;

57 
	`mem£t
(
£t
, 0, (set));

59 
c
 = 
ønge
->
off£t
 & 0xFF;

60 
i
 = 0; i < 
ønge
->
ˇrdöÆôy
; i++) {

61 i‡(
£t
[
c
])

62  
RSTRING_RANGE_OVERLAP
;

63 
£t
[
c
] = 1;

64 
c
 +
ønge
->
mu…ùlõr
;

65 
c
 &= 0xFF;

68  
RSTRING_OK
;

69 
	}
}

75 
uöt8_t
 *
	$øndom_°rög_öto
(
uöt8_t
 *
°r
, 
uöt32_t
 
size
, c⁄° 
r°rög_byã_ønge
 *
ønge
)

77 
uöt32_t
 
i
;

78 
uöt32_t
 
r
;

80 i‡(
ønge
 =
NULL
) {

81 
i
 = 0; 
size
 - i >= 4; ) {

82 
r
 = 
	`ønd32
();

83 
°r
[
i
++] = 
r
 & 0xFF;

84 
r
 >>= 8;

85 
°r
[
i
++] = 
r
 & 0xFF;

86 
r
 >>= 8;

87 
°r
[
i
++] = 
r
 & 0xFF;

88 
r
 >>= 8;

89 
°r
[
i
++] = 
r
 & 0xFF;

92 i‡(
i
 < 
size
) {

93 
r
 = 
	`ønd32
();

95 
°r
[
i
++] = 
r
 & 0xFF;

96 
r
 >>= 8;

97 } 
i
 < 
size
);

100 
i
 = 0; i < 
size
; )

101 
°r
[
i
++] = ((
	`ønd32
(Ë% 
ønge
->
ˇrdöÆôy
Ë*Ñ™ge->
mu…ùlõr
 +Ñ™ge->
off£t
) & 0xFF;

104  
°r
;

105 
	}
}

110 
uöt8_t
 *
	$øndom_°rög
(
uöt32_t
 
size
, c⁄° 
r°rög_byã_ønge
 *
ønge
)

112 
uöt8_t
 *
°r
;

114 i‡(
	`check_ønge
(
ønge
Ë!
RSTRING_OK
) {

115 
	`Ârötf
(
°dîr
, "Invalid byteÑange forÑandom string generation\n");

116 
	`exô
(
EXIT_FAILURE
);

119 
°r
 = 
	`mÆloc
(
size
);

120 i‡(
°r
 =
NULL
)

121  
NULL
;

123  
	`øndom_°rög_öto
(
°r
, 
size
, 
ønge
);

124 
	}
}

135 
	$øndom_°rög_∑ú
(

136 
uöt32_t
 
ﬁd_size
, uöt32_à
diff_size
, c⁄° 
r°rög_byã_ønge
 *
ønge
,

137 
uöt8_t
 **
ﬁd_out
, uöt8_à**
√w_out
, 
uöt32_t
 *
√w_size_out
)

139 
uöt8_t
 *
ﬁd
;

140 
uöt8_t
 *
√w_
;

141 
uöt8_t
 *
≈å
;

142 
uöt32_t
 
√w_size
;

143 
uöt32_t
 
i
;

144 
uöt32_t
 
j
;

147 
uöt32_t
 *
ö£πi⁄s
;

156 *
ch™ges
;

159 
uöt8_t
 *
√w_byãs
;

160 
uöt8_t
 *
√w_byãs_±r
;

161 
uöt32_t
 
√w_byãs_size
;

163 
ﬁd
 = 
	`øndom_°rög
(
ﬁd_size
, 
ønge
);

164 i‡(
ﬁd
 =
NULL
)

165 
oom0
;

167 
ö£πi⁄s
 = 
	`ˇŒoc
(
ﬁd_size
 + 1, (*insertions));

168 i‡(
ö£πi⁄s
 =
NULL
)

169 
oom1
;

171 
ch™ges
 = 
	`ˇŒoc
(
ﬁd_size
, (*changes));

172 i‡(
ch™ges
 =
NULL
)

173 
oom2
;

179 
√w_size
 = 
ﬁd_size
;

180 
√w_byãs_size
 = 0;

181 
i
 = 0; i < 
diff_size
; i++) {

182 
uöt32_t
 
pos
;

184 
	`ønd32
() % 3) {

186 
pos
 = 
	`ønd32
(Ë% (
ﬁd_size
 + 1);

187 
ö£πi⁄s
[
pos
]++;

188 
√w_size
++;

189 
√w_byãs_size
++;

193 
pos
 = 
	`ønd32
(Ë% 
ﬁd_size
;

194 i‡(
ch™ges
[
pos
]) {

204 
i
--;

206 
ch™ges
[
pos
] = 1;

207 
√w_size
--;

212 
pos
 = 
	`ønd32
(Ë% 
ﬁd_size
;

213 i‡(
ch™ges
[
pos
]) {

218 
i
--;

220 
ch™ges
[
pos
] = 2;

221 
√w_byãs_size
++;

227 
√w_byãs
 = 
	`mÆloc
(
√w_byãs_size
);

228 i‡(
√w_byãs
 =
NULL
)

229 
oom3
;

230 
	`øndom_°rög_öto
(
√w_byãs
, 
√w_byãs_size
, 
ønge
);

232 
√w_
 = 
	`mÆloc
(
√w_size
);

233 i‡(
√w_
 =
NULL
)

234 
oom4
;

237 
≈å
 = 
√w_
;

238 
√w_byãs_±r
 = 
√w_byãs
;

239 
i
 = 0; i < 
ﬁd_size
; i++) {

240 
j
 = 0; j < 
ö£πi⁄s
[
i
]; j++)

241 *
≈å
++ = *
√w_byãs_±r
++;

243 
ch™ges
[
i
]) {

245 *
≈å
++ = 
ﬁd
[
i
];

252 *
≈å
++ = *
√w_byãs_±r
++;

256 
j
 = 0; j < 
ö£πi⁄s
[
i
]; j++)

257 *
≈å
++ = *
√w_byãs_±r
++;

258 
	`as£π
((
size_t
)(
≈å
 - 
√w_
Ë=
√w_size
);

259 
	`as£π
((
size_t
)(
√w_byãs_±r
 - 
√w_byãs
Ë=
√w_byãs_size
);

261 
	`‰ì
(
√w_byãs
);

262 
	`‰ì
(
ch™ges
);

263 
	`‰ì
(
ö£πi⁄s
);

265 i‡(
ﬁd_out
)

266 *
ﬁd_out
 = 
ﬁd
;

268 
	`‰ì
(
ﬁd
);

269 i‡(
√w_out
)

270 *
√w_out
 = 
√w_
;

272 
	`‰ì
(
√w_
);

273 i‡(
√w_size_out
)

274 *
√w_size_out
 = 
√w_size
;

276  
RSTRING_OK
;

278 
oom4
:

279 
	`‰ì
(
√w_byãs
);

280 
oom3
:

281 
	`‰ì
(
ch™ges
);

282 
oom2
:

283 
	`‰ì
(
ö£πi⁄s
);

284 
oom1
:

285 
	`‰ì
(
ﬁd
);

286 
oom0
:

287 i‡(
ﬁd_out
)

288 *
ﬁd_out
 = 
NULL
;

289 i‡(
√w_out
)

290 *
√w_out
 = 
NULL
;

291 i‡(
√w_size_out
)

292 *
√w_size_out
 = 0;

293  
RSTRING_MEMORY
;

294 
	}
}

	@ccan/ccan/bdelta/test/run-medium.c

1 
	~"comm⁄.h
"

8 
	$ã°_øndom
(

9 
uöt32_t
 
ﬁd_size
, uöt32_à
diff_size
,

10 
ˇrdöÆôy
, 
mu…ùlõr
, 
off£t
)

12 
r°rög_byã_ønge
 
ønge
;

13 
uöt8_t
 *
ﬁd
;

14 
uöt8_t
 *
√w_
;

15 
uöt32_t
 
√w_size
;

16 
BDELTAcode
 
rc
;

18 
ønge
.
ˇrdöÆôy
 = cardinality;

19 
ønge
.
mu…ùlõr
 = multiplier;

20 
ønge
.
off£t
 = offset;

22 i‡(
	`øndom_°rög_∑ú
(
ﬁd_size
, 
diff_size
, 
ˇrdöÆôy
 =0 ? 
NULL
 : &
ønge
,

23 &
ﬁd
, &
√w_
, &
√w_size
Ë!
RSTRING_OK
)

25 
	`Ârötf
(
°dîr
, "Error generatingÑandom stringÖair\n");

26 
	`exô
(
EXIT_FAILURE
);

29 
rc
 = 
	`bdñè_diff
(
ﬁd
, 
ﬁd_size
, 
√w_
, 
√w_size
, 
NULL
, NULL);

30 i‡(
rc
 !
BDELTA_OK
) {

31 
	`bdñè_≥º‹
("bdñè_diff", 
rc
);

35 
	`‰ì
(
√w_
);

36 
	`‰ì
(
ﬁd
);

38 
	}
}

40 
	$maö
()

42 
i
;

43 
cou¡
 = 25;

45 
	`∂™_ã°s
(
cou¡
 * 14);

47 
i
 = 0; i < 
cou¡
; i++)

48 
	`ok1
(
	`ã°_øndom
(100, 10, 0, 0, 0));

49 
i
 = 0; i < 
cou¡
; i++)

50 
	`ok1
(
	`ã°_øndom
(100, 
	`ønd32
() % 200, 0, 0, 0));

51 
i
 = 0; i < 
cou¡
; i++)

52 
	`ok1
(
	`ã°_øndom
(1000, 
	`ønd32
() % 200, 0, 0, 0));

53 
i
 = 0; i < 
cou¡
; i++)

54 
	`ok1
(
	`ã°_øndom
(1000, 
	`ønd32
() % 2000, 0, 0, 0));

55 
i
 = 0; i < 
cou¡
; i++)

56 
	`ok1
(
	`ã°_øndom
(10000, 
	`ønd32
() % 200, 0, 0, 0));

57 
i
 = 0; i < 
cou¡
; i++)

58 
	`ok1
(
	`ã°_øndom
(10000, 
	`ønd32
() % 2000, 0, 0, 0));

59 
i
 = 0; i < 
cou¡
; i++)

60 
	`ok1
(
	`ã°_øndom
(
	`ønd32
() % 20000,Ñand32() % 20000, 0, 0, 0));

63 
i
 = 0; i < 
cou¡
; i++)

64 
	`ok1
(
	`ã°_øndom
(100, 10, 
	`ønd32
(Ë% 20 + 1, 1, 
i
));

65 
i
 = 0; i < 
cou¡
; i++)

66 
	`ok1
(
	`ã°_øndom
(100, 
	`ønd32
(Ë% 200,Ñ™d32(Ë% 20 + 1, 1, 
i
));

67 
i
 = 0; i < 
cou¡
; i++)

68 
	`ok1
(
	`ã°_øndom
(1000, 
	`ønd32
(Ë% 200,Ñ™d32(Ë% 20 + 1, 1, 
i
));

69 
i
 = 0; i < 
cou¡
; i++)

70 
	`ok1
(
	`ã°_øndom
(1000, 
	`ønd32
(Ë% 2000,Ñ™d32(Ë% 20 + 1, 1, 
i
));

71 
i
 = 0; i < 
cou¡
; i++)

72 
	`ok1
(
	`ã°_øndom
(10000, 
	`ønd32
(Ë% 200,Ñ™d32(Ë% 20 + 1, 1, 
i
));

73 
i
 = 0; i < 
cou¡
; i++)

74 
	`ok1
(
	`ã°_øndom
(10000, 
	`ønd32
(Ë% 2000,Ñ™d32(Ë% 20 + 1, 1, 
i
));

75 
i
 = 0; i < 
cou¡
; i++)

76 
	`ok1
(
	`ã°_øndom
(
	`ønd32
(Ë% 20000,Ñ™d32(Ë% 20000,Ñ™d32(Ë% 20 + 1, 1, 
i
));

78  
	`exô_°©us
();

79 
	}
}

	@ccan/ccan/bdelta/test/run-myers.c

1 
	~"comm⁄.h
"

3 
	#is_digô
(
c
Ë((cË>'0' && (cË<'9')

	)

5 
uöt32_t
 
	$∑r£_öt
(c⁄° **
•
)

7 c⁄° *
s
 = *
•
;

8 
uöt32_t
 
n
 = 0;

10 
	`is_digô
(*
s
)) {

11 
n
 *= 10;

12 
n
 +*
s
++ - '0';

15 *
•
 = 
s
;

16  
n
;

17 
	}
}

19 c⁄° *
	$›_«me
(
›
)

21 
›
) {

22 
OP_COPY
:

24 
OP_SKIP
:

26 
OP_INSERT
:

32 
	}
}

34 c⁄° *
	$vîify_csi32
(

35 c⁄° *
∑tch_°¨t
, c⁄° *
∑tch_íd
,

36 c⁄° *
ex≥˘ed
)

38 c⁄° *
p
 = 
∑tch_°¨t
;

40 i‡(
p
 >
∑tch_íd
)

42 i‡(*
p
++ !
PT_CSI32
)

46 
∑tch_›
;

47 
uöt32_t
 
∑tch_size
;

48 
ex≥˘ed_›
;

49 
uöt32_t
 
ex≥˘ed_size
;

51 *
ex≥˘ed
 == ' ')

52 
ex≥˘ed
++;

53 i‡(*
ex≥˘ed
 == '\0')

56 i‡(!
	`csi32_∑r£_›
(&
p
, 
∑tch_íd
, &
∑tch_›
, &
∑tch_size
)) {

57 i‡(
p
 =
∑tch_íd
)

63 *
ex≥˘ed
) {

65 
ex≥˘ed_›
 = 
OP_COPY
;

68 
ex≥˘ed_›
 = 
OP_SKIP
;

71 
ex≥˘ed_›
 = 
OP_INSERT
;

75 
	`düg
("vîify_csi32: U√x≥˘ed ch¨a˘î %c", *
ex≥˘ed
);

78 
ex≥˘ed
++;

80 *
ex≥˘ed
 == ' ')

81 
ex≥˘ed
++;

83 i‡(
∑tch_›
 !
ex≥˘ed_›
) {

84 
	`düg
("verify_csi32: Expected %s, butÇext op is %s %lu",

85 
	`›_«me
(
ex≥˘ed_›
), op_«me(
∑tch_›
), ()
∑tch_size
);

89 i‡(
ex≥˘ed_›
 =
OP_COPY
 ||Éx≥˘ed_› =
OP_SKIP
) {

90 i‡(!
	`is_digô
(*
ex≥˘ed
)) {

91 
	`düg
("verify_csi32: Expected sizeáfter %s instruction",

92 
	`›_«me
(
ex≥˘ed_›
));

95 
ex≥˘ed_size
 = 
	`∑r£_öt
(&
ex≥˘ed
);

97 i‡(
∑tch_size
 !
ex≥˘ed_size
) {

98 
	`düg
("verify_csi32: Expected %s %lu, butÖatch says %s %lu",

99 
	`›_«me
(
ex≥˘ed_›
), ()
ex≥˘ed_size
,

100 
	`›_«me
(
ex≥˘ed_›
), ()
∑tch_size
);

104 i‡(*
ex≥˘ed
++ != '\'') {

105 
	`düg
("verify_csi32: Expected single-quoted stringáfter insert instruction");

109 
ex≥˘ed_size
 = 0; ;Éxpected_size++) {

110 
c
;

112 i‡(*
ex≥˘ed
 == '\'' && *(expected + 1) == '\'') {

113 
c
 = '\'';

114 
ex≥˘ed
 += 2;

115 } i‡(*
ex≥˘ed
 == '\'') {

116 
ex≥˘ed
++;

118 } i‡(*
ex≥˘ed
 == '\0') {

119 
	`düg
("verify_csi32: MissingÉnd quote");

122 
c
 = *
ex≥˘ed
++;

125 i‡(!(
p
 < 
∑tch_íd
 && *p++ =
c
))

129 i‡(
∑tch_size
 !
ex≥˘ed_size
)

134 i‡(
p
 !
∑tch_íd
)

137  
NULL
;

138 
	}
}

140 
	$ã°_myîs
(c⁄° *
ﬁd
, c⁄° *
√w_
, c⁄° *
ex≥˘ed_dif„ªn˚
)

142 
SB
 
∑tch
;

143 
BDELTAcode
 
rc
;

144 c⁄° *
vîify_msg
;

146 i‡(
	`sb_öô
(&
∑tch
) != 0) {

147 
	`Áû
("Out of memory");

151 
rc
 = 
	`diff_myîs
(
ﬁd
, 
	`°æí
(ﬁd), 
√w_
, såÀn“ew_), &
∑tch
);

152 i‡(
rc
 !
BDELTA_OK
) {

153 
	`Áû
("ã°_myîs(%s, %s, %s): diff_myî†Áûed: %s", 
ﬁd
, 
√w_
, 
ex≥˘ed_dif„ªn˚
, 
	`bdñè_°ªº‹
(
rc
));

154 
	`sb_disˇrd
(&
∑tch
, 
NULL
, NULL);

158 
vîify_msg
 = 
	`vîify_csi32
(
∑tch
.
°¨t
,Ö©ch.
cur
, 
ex≥˘ed_dif„ªn˚
);

159 
	`sb_disˇrd
(&
∑tch
, 
NULL
, NULL);

161 i‡(
vîify_msg
 !
NULL
) {

162 
	`Áû
("ã°_myîs(%s, %s, %s): %s", 
ﬁd
, 
√w_
, 
ex≥˘ed_dif„ªn˚
, 
vîify_msg
);

166 
	`∑ss
("ã°_myîs(%s, %s, %s)", 
ﬁd
, 
√w_
, 
ex≥˘ed_dif„ªn˚
);

167 
	}
}

169 
	$maö
()

171 (Ë
øndom_°rög_∑ú
;

173 
	`∂™_ã°s
(17);

175 
	`ã°_myîs
("abcabba", "cbabac", "s2 c1 i'b' c2 s1 c1 i'c'");

176 
	`ã°_myîs
("abcdefg", "abcdefg", "c7");

177 
	`ã°_myîs
("abcdefg", "abcde", "c5");

178 
	`ã°_myîs
("abcdefg", "abcdefga", "c7 i'a'");

179 
	`ã°_myîs
("abbbbbb", "bbbbbb", "s1 c6");

180 
	`ã°_myîs
("abbbbbb", "bbbbbbb", "s1 c6 i'b'");

181 
	`ã°_myîs
("bbbbbb", "abbbbbb", "i'a' c6");

182 
	`ã°_myîs
("bbbbbbb", "abbbbbb", "i'a' c6");

183 
	`ã°_myîs
("bbbbbb", "abbbbbbb", "i'a' c6 i'b'");

185 
	`ã°_myîs
("ac", "ba", "i'b' c1");

186 
	`ã°_myîs
("ac", "bc", "s1 i'b' c1");

187 
	`ã°_myîs
("abcd", "cabd", "i'c' c2 s1 c1");

188 
	`ã°_myîs
("", "abc", "i'abc'");

189 
	`ã°_myîs
("abc", "", "");

190 
	`ã°_myîs
("abcd", "d", "s3 c1");

191 
	`ã°_myîs
("", "", "");

199 
	`ã°_myîs
("aaaaaaa", "bbbbbbb", "s7 i'bbbbbbb'");

201  
	`exô_°©us
();

202 
	}
}

	@ccan/ccan/bdelta/test/run-trivial.c

1 
	~<cˇn/bdñè/bdñè.h
>

2 
	~<cˇn/bdñè/bdñè.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$ã°_åivül
(c⁄° *
ﬁd
, c⁄° *
√w_
)

7 *
∑tch
;

8 
size_t
 
∑tch_size
;

9 
BDELTAcode
 
rc
;

11 *
√w2
;

12 
size_t
 
√w2_size
;

14 
rc
 = 
	`bdñè_diff
(
ﬁd
, 
	`°æí
(ﬁd), 
√w_
, såÀn“ew_), &
∑tch
, &
∑tch_size
);

15 i‡(
rc
 !
BDELTA_OK
) {

16 
	`bdñè_≥º‹
("bdñè_diff", 
rc
);

20 i‡(
∑tch_size
 > 
	`°æí
(
√w_
) + 1) {

21 
	`Ârötf
(
°dîr
, "bdelta_diffÖroducedáÖatchÜargerÅhaná simpleÜiteralÉmittingÅheÇew string.\n");

25 
rc
 = 
	`bdñè_∑tch
(
ﬁd
, 
	`°æí
(ﬁd), 
∑tch
, 
∑tch_size
, &
√w2
, &
√w2_size
);

26 i‡(
rc
 !
BDELTA_OK
) {

27 
	`bdñè_≥º‹
("bdñè_∑tch", 
rc
);

31 i‡(
√w2_size
 !
	`°æí
(
√w_
Ë|| 
	`°rcmp
(
√w2
,Çew_) != 0) {

32 
	`Ârötf
(
°dîr
, "patch(old, diff(old,Çew)) !=Çew\n");

37 
rc
 = 
	`bdñè_diff
(
ﬁd
, 
	`°æí
(ﬁd), 
√w_
, såÀn“ew_), 
NULL
, NULL);

38 i‡(
rc
 !
BDELTA_OK
) {

39 
	`bdñè_≥º‹
("bdñè_dif‡(£c⁄dÅime)", 
rc
);

43 
	`‰ì
(
√w2
);

44 
	`‰ì
(
∑tch
);

46 
	}
}

48 
	$maö
()

50 
	`∂™_ã°s
(13);

52 
	`ok1
(
	`ã°_åivül
("abcabba", "cbabac"));

53 
	`ok1
(
	`ã°_åivül
("aaabbbcdaabcc", "aaabbcdaabeca"));

54 
	`ok1
(
	`ã°_åivül
("aaaaaaaa", "bbbbbbbb"));

55 
	`ok1
(
	`ã°_åivül
("aaaaaaaa", ""));

56 
	`ok1
(
	`ã°_åivül
("", "bbbbbbbb"));

57 
	`ok1
(
	`ã°_åivül
("", ""));

58 
	`ok1
(
	`ã°_åivül
("aaaaaaaa", "aaaaaaaabbbbbbbb"));

59 
	`ok1
(
	`ã°_åivül
("aaaaaaaa", "bbbbbbbbaaaaaaaa"));

60 
	`ok1
(
	`ã°_åivül
("aaaaaaaabbbbbbbb", "aaaaaaaa"));

61 
	`ok1
(
	`ã°_åivül
("aaaaaaaabbbbbbbb", "bbbbbbbb"));

62 
	`ok1
(
	`ã°_åivül
("aaaaaaaabbbbbbbb", "bbbbbbbb"));

63 
	`ok1
(
	`ã°_åivül
("abababababababab", "babababababababa"));

64 
	`ok1
(
	`ã°_åivül
("aababcabcdabcde", "aababcabcdabcde"));

66  
	`exô_°©us
();

67 
	}
}

	@ccan/ccan/bitmap/bitmap.h

2 #i‚de‡
CCAN_BITMAP_H_


3 
	#CCAN_BITMAP_H_


	)

5 
	~<°dboﬁ.h
>

6 
	~<°dlib.h
>

7 
	~<°rög.h
>

8 
	~<limôs.h
>

10 
	~<cˇn/ídün/ídün.h
>

12 
	tbôm≠_w‹d
;

14 
	#BITMAP_WORD_BITS
 ((
bôm≠_w‹d
Ë* 
CHAR_BIT
)

	)

15 
	#BITMAP_NWORDS
(
_n
) \

16 (((
_n
Ë+ 
BITMAP_WORD_BITS
 - 1Ë/ BITMAP_WORD_BITS)

	)

22 
bôm≠_w‹d
 
	mw
;

23 } 
	tbôm≠
;

25 
	#BITMAP_DECLARE
(
_«me
, 
_nbôs
) \

26 
	`bôm≠
 (
_«me
)[
	`BITMAP_NWORDS
(
_nbôs
)]

	)

28 
ölöe
 
size_t
 
	$bôm≠_sizeof
(
nbôs
)

30  
	`BITMAP_NWORDS
(
nbôs
Ë* (
bôm≠_w‹d
);

31 
	}
}

33 
ölöe
 
bôm≠
 *
	$bôm≠_Æloc
(
nbôs
)

35  
	`mÆloc
(
	`bôm≠_sizeof
(
nbôs
));

36 
	}
}

38 
ölöe
 
bôm≠_w‹d
 
	$bôm≠_bsw≠
(
bôm≠_w‹d
 
w
)

40 i‡(
BITMAP_WORD_BITS
 == 32)

41  
	`˝u_to_be32
(
w
);

42 i‡(
BITMAP_WORD_BITS
 == 64)

43  
	`˝u_to_be64
(
w
);

44 
	}
}

46 
	#BITMAP_WORD
(
_bm
, 
_n
Ë((_bm)[(_nË/ 
BITMAP_WORD_BITS
].
w
)

	)

47 
	#BITMAP_WORDBIT
(
_n
) \

48 (
	`bôm≠_bsw≠
(1UL << (
BITMAP_WORD_BITS
 - ((
_n
Ë% BITMAP_WORD_BITSË- 1)))

	)

50 
	#BITMAP_HEADWORDS
(
_nbôs
) \

51 ((
_nbôs
Ë/ 
BITMAP_WORD_BITS
)

	)

52 
	#BITMAP_HEADBYTES
(
_nbôs
) \

53 (
	`BITMAP_HEADWORDS
(
_nbôs
Ë* (
bôm≠_w‹d
))

	)

55 
	#BITMAP_TAILWORD
(
_bm
, 
_nbôs
) \

56 ((
_bm
)[
	`BITMAP_HEADWORDS
(
_nbôs
)].
w
)

	)

57 
	#BITMAP_HASTAIL
(
_nbôs
Ë(((_nbôsË% 
BITMAP_WORD_BITS
Ë!0)

	)

58 
	#BITMAP_TAILBITS
(
_nbôs
) \

59 (
	`bôm≠_bsw≠
(~(-1UL >> ((
_nbôs
Ë% 
BITMAP_WORD_BITS
))))

	)

60 
	#BITMAP_TAIL
(
_bm
, 
_nbôs
) \

61 (
	`BITMAP_TAILWORD
(
_bm
, 
_nbôs
Ë& 
	`BITMAP_TAILBITS
(_nbôs))

	)

63 
ölöe
 
	$bôm≠_£t_bô
(
bôm≠
 *bôm≠, 
n
)

65 
	`BITMAP_WORD
(
bôm≠
, 
n
Ë|
	`BITMAP_WORDBIT
(n);

66 
	}
}

68 
ölöe
 
	$bôm≠_˛ór_bô
(
bôm≠
 *bôm≠, 
n
)

70 
	`BITMAP_WORD
(
bôm≠
, 
n
Ë&~
	`BITMAP_WORDBIT
(n);

71 
	}
}

73 
ölöe
 
	$bôm≠_ch™ge_bô
(
bôm≠
 *bôm≠, 
n
)

75 
	`BITMAP_WORD
(
bôm≠
, 
n
Ë^
	`BITMAP_WORDBIT
(n);

76 
	}
}

78 
ölöe
 
boﬁ
 
	$bôm≠_ã°_bô
(
bôm≠
 *bôm≠, 
n
)

80  !!(
	`BITMAP_WORD
(
bôm≠
, 
n
Ë& 
	`BITMAP_WORDBIT
(n));

81 
	}
}

84 
ölöe
 
	$bôm≠_zîo
(
bôm≠
 *bôm≠, 
nbôs
)

86 
	`mem£t
(
bôm≠
, 0, 
	`bôm≠_sizeof
(
nbôs
));

87 
	}
}

89 
ölöe
 
	$bôm≠_fûl
(
bôm≠
 *bôm≠, 
nbôs
)

91 
	`mem£t
(
bôm≠
, 0xff, 
	`bôm≠_sizeof
(
nbôs
));

92 
	}
}

94 
ölöe
 
	$bôm≠_c›y
(
bôm≠
 *
d°
, bôm≠ *
§c
, 
nbôs
)

96 
	`mem˝y
(
d°
, 
§c
, 
	`bôm≠_sizeof
(
nbôs
));

97 
	}
}

99 
	#BITMAP_DEF_BINOP
(
_«me
, 
_›
) \

100 
ölöe
 
bôm≠_
##
	`_«me
(
bôm≠
 *
d°
, bôm≠ *
§c1
, bôm≠ *
§c2
, \

101 
nbôs
) \

103 
i
 = 0; \

104 
i
 = 0; i < 
	`BITMAP_NWORDS
(
nbôs
); i++) { \

105 
d°
[
i
].
w
 = 
§c1
[i].w 
_›
 
§c2
[i].w; \

107 }

	)

109 
	$BITMAP_DEF_BINOP
(
™d
, &)

110 
	`BITMAP_DEF_BINOP
(
‹
, |)

111 
	`BITMAP_DEF_BINOP
(
x‹
, ^)

112 
	`BITMAP_DEF_BINOP
(
™dnŸ
, & ~)

114 #unde‡
BITMAP_DEF_BINOP


116 
ölöe
 
	$bôm≠_com∂emít
(
bôm≠
 *
d°
, bôm≠ *
§c
, 
nbôs
)

118 
i
;

120 
i
 = 0; i < 
	`BITMAP_NWORDS
(
nbôs
); i++)

121 
d°
[
i
].
w
 = ~
§c
[i].w;

122 
	}
}

124 
ölöe
 
boﬁ
 
	$bôm≠_equÆ
(
bôm≠
 *
§c1
, bôm≠ *
§c2
, 
nbôs
)

126  (
	`memcmp
(
§c1
, 
§c2
, 
	`BITMAP_HEADBYTES
(
nbôs
)) == 0)

127 && (!
	`BITMAP_HASTAIL
(
nbôs
)

128 || (
	`BITMAP_TAIL
(
§c1
, 
nbôs
Ë=BITMAP_TAIL(
§c2
,Çbits)));

129 
	}
}

131 
ölöe
 
boﬁ
 
	$bôm≠_öãr£˘s
(
bôm≠
 *
§c1
, bôm≠ *
§c2
, 
nbôs
)

133 
i
;

135 
i
 = 0; i < 
	`BITMAP_HEADWORDS
(
nbôs
); i++) {

136 i‡(
§c1
[
i
].
w
 & 
§c2
[i].w)

137  
åue
;

139 i‡(
	`BITMAP_HASTAIL
(
nbôs
) &&

140 (
	`BITMAP_TAIL
(
§c1
, 
nbôs
Ë& BITMAP_TAIL(
§c2
,Çbits)))

141  
åue
;

142  
Ál£
;

143 
	}
}

145 
ölöe
 
boﬁ
 
	$bôm≠_sub£t
(
bôm≠
 *
§c1
, bôm≠ *
§c2
, 
nbôs
)

147 
i
;

149 
i
 = 0; i < 
	`BITMAP_HEADWORDS
(
nbôs
); i++) {

150 i‡(
§c1
[
i
].
w
 & ~
§c2
[i].w)

151  
Ál£
;

153 i‡(
	`BITMAP_HASTAIL
(
nbôs
) &&

154 (
	`BITMAP_TAIL
(
§c1
, 
nbôs
Ë& ~BITMAP_TAIL(
§c2
,Çbits)))

155  
Ál£
;

156  
åue
;

157 
	}
}

159 
ölöe
 
boﬁ
 
	$bôm≠_fuŒ
(
bôm≠
 *bôm≠, 
nbôs
)

161 
i
;

163 
i
 = 0; i < 
	`BITMAP_HEADWORDS
(
nbôs
); i++) {

164 i‡(
bôm≠
[
i
].
w
 != -1UL)

165  
Ál£
;

167 i‡(
	`BITMAP_HASTAIL
(
nbôs
) &&

168 (
	`BITMAP_TAIL
(
bôm≠
, 
nbôs
Ë!
	`BITMAP_TAILBITS
(nbits)))

169  
Ál£
;

171  
åue
;

172 
	}
}

174 
ölöe
 
boﬁ
 
	$bôm≠_em±y
(
bôm≠
 *bôm≠, 
nbôs
)

176 
i
;

178 
i
 = 0; i < 
	`BITMAP_HEADWORDS
(
nbôs
); i++) {

179 i‡(
bôm≠
[
i
].
w
 != 0)

180  
Ál£
;

182 i‡(
	`BITMAP_HASTAIL
(
nbôs
Ë&& (
	`BITMAP_TAIL
(
bôm≠
,Çbits) != 0))

183  
Ál£
;

185  
åue
;

186 
	}
}

	@ccan/ccan/bitmap/test/run.c

1 
	~<cˇn/bôm≠/bôm≠.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/¨øy_size/¨øy_size.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

6 
	gbôm≠_sizes
[] = {

12 
	#NSIZES
 
	`ARRAY_SIZE
(
bôm≠_sizes
)

	)

13 
	#NTESTS
 9

	)

15 
	$ã°_sizes
(
nbôs
, 
boﬁ
 
dy«Œoc
)

17 
	`BITMAP_DECLARE
(
sbôm≠
, 
nbôs
);

18 
uöt32_t
 
m¨kî
;

19 
bôm≠
 *bitmap;

20 
i
, 
j
;

21 
boﬁ
 
wr⁄g
;

23 i‡(
dy«Œoc
) {

24 
bôm≠
 = 
	`bôm≠_Æloc
(
nbôs
);

25 
	`ok1
(
bôm≠
 !
NULL
);

27 
bôm≠
 = 
sbôm≠
;

28 
m¨kî
 = 0xdeadbeef;

31 
	`bôm≠_zîo
(
bôm≠
, 
nbôs
);

32 
wr⁄g
 = 
Ál£
;

33 
i
 = 0; i < 
nbôs
; i++) {

34 
wr⁄g
 = wr⁄g || 
	`bôm≠_ã°_bô
(
bôm≠
, 
i
);

36 
	`ok1
(!
wr⁄g
);

38 
	`bôm≠_fûl
(
bôm≠
, 
nbôs
);

39 
wr⁄g
 = 
Ál£
;

40 
i
 = 0; i < 
nbôs
; i++) {

41 
wr⁄g
 = wr⁄g || !
	`bôm≠_ã°_bô
(
bôm≠
, 
i
);

43 
	`ok1
(!
wr⁄g
);

45 
wr⁄g
 = 
Ál£
;

46 
i
 = 0; i < 
nbôs
; i++) {

47 
	`bôm≠_zîo
(
bôm≠
, 
nbôs
);

48 
	`bôm≠_£t_bô
(
bôm≠
, 
i
);

49 
j
 = 0; j < 
nbôs
; j++) {

50 
boﬁ
 
vÆ
 = (
i
 =
j
);

52 
wr⁄g
 = wr⁄g || (
	`bôm≠_ã°_bô
(
bôm≠
, 
j
Ë!
vÆ
);

55 
	`ok1
(!
wr⁄g
);

57 
wr⁄g
 = 
Ál£
;

58 
i
 = 0; i < 
nbôs
; i++) {

59 
	`bôm≠_fûl
(
bôm≠
, 
nbôs
);

60 
	`bôm≠_˛ór_bô
(
bôm≠
, 
i
);

61 
j
 = 0; j < 
nbôs
; j++) {

62 
boﬁ
 
vÆ
 = !(
i
 =
j
);

64 
wr⁄g
 = wr⁄g || (
	`bôm≠_ã°_bô
(
bôm≠
, 
j
Ë!
vÆ
);

67 
	`ok1
(!
wr⁄g
);

69 
	`bôm≠_zîo
(
bôm≠
, 
nbôs
);

70 
	`ok1
(
	`bôm≠_em±y
(
bôm≠
, 
nbôs
));

72 
wr⁄g
 = 
Ál£
;

73 
i
 = 0; i < 
nbôs
; i++) {

74 
	`bôm≠_zîo
(
bôm≠
, 
nbôs
);

75 
	`bôm≠_£t_bô
(
bôm≠
, 
i
);

76 
wr⁄g
 = wr⁄g || 
	`bôm≠_em±y
(
bôm≠
, 
nbôs
);

78 
	`ok1
(!
wr⁄g
);

80 
	`bôm≠_fûl
(
bôm≠
, 
nbôs
);

81 
	`ok1
(
	`bôm≠_fuŒ
(
bôm≠
, 
nbôs
));

83 
wr⁄g
 = 
Ál£
;

84 
i
 = 0; i < 
nbôs
; i++) {

85 
	`bôm≠_fûl
(
bôm≠
, 
nbôs
);

86 
	`bôm≠_˛ór_bô
(
bôm≠
, 
i
);

87 
wr⁄g
 = wr⁄g || 
	`bôm≠_fuŒ
(
bôm≠
, 
nbôs
);

89 
	`ok1
(!
wr⁄g
);

91 i‡(
dy«Œoc
) {

92 
	`‰ì
(
bôm≠
);

94 
	`ok1
(
m¨kî
 == 0xdeadbeef);

96 
	}
}

98 
	$maö
()

100 
i
;

101 
boﬁ
 
dy«Œoc
;

104 
	`∂™_ã°s
(
NSIZES
 * 
NTESTS
 * 2);

106 
i
 = 0; i < 
NSIZES
; i++) {

107 
	`f‹óch_öt
(
dy«Œoc
, 
Ál£
, 
åue
) {

108 
	`düg
("Testing %d-bit bitmap (%sállocation)",

109 
bôm≠_sizes
[
i
], 
dy«Œoc
 ? "dynamic" : "static");

110 
	`ã°_sizes
(
bôm≠_sizes
[
i
], 
dy«Œoc
);

115  
	`exô_°©us
();

116 
	}
}

	@ccan/ccan/block_pool/block_pool.c

23 
	~"block_poﬁ.h
"

24 
	~<°dlib.h
>

25 
	~<°dio.h
>

26 
	~<°rög.h
>

29 
	#BLOCK_SIZE
 4096

	)

31 
	sblock
 {

32 
size_t
 
	mªmaöög
;

33 
size_t
 
	msize
;

34 *
	md©a
;

37 
	sblock_poﬁ
 {

38 
size_t
 
	mcou¡
;

39 
size_t
 
	mÆloc
;

40 
block
 *
	mblock
;

46 
	$de°ru˘‹
(
block_poﬁ
 *
bp
) {

47 
block
 *block = 
bp
->block;

48 
size_t
 
d
 = 
bp
->
cou¡
;

50 ;
d
--;
block
++)

51 
	`‰ì
(
block
->
d©a
);

52 
	`‰ì
(
bp
->
block
);

55 
	}
}

57 
block_poﬁ
 *
	$block_poﬁ_√w
(*
˘x
) {

58 
block_poﬁ
 *
bp
 = 
	`èŒoc
(
˘x
, block_pool);

59 
	`èŒoc_£t_de°ru˘‹
(
bp
, 
de°ru˘‹
);

61 
bp
->
cou¡
 = 0;

62 
bp
->
Æloc
 = 7;

63 
bp
->
block
 = 
	`mÆloc
(bp->
Æloc
 * (block));

65  
bp
;

66 
	}
}

68 *
	$√w_block
(
block
 *
b
, 
size_t
 
√eded
) {

69 
b
->
size
 = (
√eded
+(
BLOCK_SIZE
-1)) & ~(BLOCK_SIZE-1);

70 
b
->
ªmaöög
 = b->
size
 - 
√eded
;

71 
b
->
d©a
 = 
	`mÆloc
(b->
size
);

72  
b
->
d©a
;

73 
	}
}

76 *
	$√w_block_töy
(
block
 *
b
, 
size_t
 
√eded
) {

77 i‡(
√eded
 < 256)

78 
b
->
size
 = 256;

80 
b
->
size
 = (
√eded
+(
BLOCK_SIZE
-1)) & ~(BLOCK_SIZE-1);

81 
b
->
ªmaöög
 = b->
size
 - 
√eded
;

82 
b
->
d©a
 = 
	`mÆloc
(b->
size
);

83  
b
->
d©a
;

84 
	}
}

86 *
	$åy_block
(
block
 *
b
, 
size_t
 
size
, size_à
Æign
) {

87 
size_t
 
off£t
 = 
b
->
size
 - b->
ªmaöög
;

88 
off£t
 = (off£t+
Æign
) & ~align;

90 i‡(
b
->
size
-
off£t
 >= size) {

92 *
ªt
 = 
b
->
d©a
 + 
off£t
;

93 
b
->
ªmaöög
 = b->
size
-
off£t
-size;

95  
ªt
;

98  
NULL
;

99 
	}
}

101 
	#L
(
node
Ë“ode+node+1)

	)

102 
	#R
(
node
Ë“ode+node+2)

	)

103 
	#P
(
node
Ë(“ode-1)>>1)

	)

105 
	#V
(
node
Ë(
bp
->
block
[node].
ªmaöög
)

	)

107 
	$≥rcﬁ©e_down
(
block_poﬁ
 *
bp
, 
size_t
 
node
) {

108 
size_t
 
chûd
 = 
	`L
(
node
);

109 
block
 
tmp
;

112 i‡(
chûd
 >
bp
->
cou¡
)

114 i‡(
chûd
+1 < 
bp
->
cou¡
 && 
	`V
(child+1) > V(child))

115 
chûd
++;

117 i‡(
	`V
(
chûd
Ë<V(
node
))

120 
tmp
 = 
bp
->
block
[
node
];

121 
bp
->
block
[
node
] = bp->block[
chûd
];

122 
bp
->
block
[
chûd
] = 
tmp
;

124 
	`≥rcﬁ©e_down
(
bp
, 
chûd
);

125 
	}
}

128 
	$≥rcﬁ©e_up
(
block_poﬁ
 *
bp
, 
size_t
 
node
) {

129 
size_t
 
∑ª¡
 = 
	`P
(
node
);

130 
block
 
tmp
;

132 i‡(
node
<3 || 
	`V
(
∑ª¡
) >= V(node))

135 
tmp
 = 
bp
->
block
[
node
];

136 
bp
->
block
[
node
] = bp->block[
∑ª¡
];

137 
bp
->
block
[
∑ª¡
] = 
tmp
;

139 
	`≥rcﬁ©e_up
(
bp
, 
∑ª¡
);

140 
	}
}

142 *
	$block_poﬁ_Æloc_Æign
(
block_poﬁ
 *
bp
, 
size_t
 
size
, size_à
Æign
) {

143 *
ªt
;

145 i‡(
Æign
)

146 
Æign
--;

149 i‡(!
bp
->
cou¡
) {

150 
bp
->
cou¡
 = 1;

151  
	`√w_block_töy
(
bp
->
block
, 
size
);

155 
ªt
 = 
	`åy_block
(
bp
->
block
, 
size
, 
Æign
);

156 i‡(
ªt
)

157  
ªt
;

160 
	`≥rcﬁ©e_down
(
bp
, 0);

161 
ªt
 = 
	`åy_block
(
bp
->
block
, 
size
, 
Æign
);

162 i‡(
ªt
)

163  
ªt
;

166 i‡(
bp
->
cou¡
 >bp->
Æloc
) {

168 
bp
->
Æloc
 += bp->alloc;

169 
bp
->
Æloc
++;

170 
bp
->
block
 = 
	`ªÆloc
(bp->block, bp->
Æloc
 * (block));

172 
ªt
 = 
	`√w_block
(
bp
->
block
+(bp->
cou¡
++), 
size
);

175 
	`≥rcﬁ©e_up
(
bp
, bp->
cou¡
-1);

177  
ªt
;

178 
	}
}

180 #unde‡
L


181 #unde‡
R


182 #unde‡
P


183 #unde‡
V


185 *
	$block_poﬁ_°rdup
(
block_poﬁ
 *
bp
, c⁄° *
°r
) {

186 
size_t
 
size
 = 
	`°æí
(
°r
)+1;

187 *
ªt
 = 
	`block_poﬁ_Æloc_Æign
(
bp
, 
size
, 1);

189 
	`mem˝y
(
ªt
, 
°r
, 
size
);

190  
ªt
;

191 
	}
}

	@ccan/ccan/block_pool/block_pool.h

23 #i‚de‡
CCAN_BLOCK_POOL


24 
	#CCAN_BLOCK_POOL


	)

26 
	~<cˇn/èŒoc/èŒoc.h
>

27 
	~<°rög.h
>

29 
	gblock_poﬁ
;

33 
block_poﬁ
 *
block_poﬁ_√w
(*
˘x
);

38 *
block_poﬁ_Æloc_Æign
(
block_poﬁ
 *
bp
, 
size_t
 
size
, size_à
Æign
);

43 
ölöe
 *
	$block_poﬁ_Æloc
(
block_poﬁ
 *
bp
, 
size_t
 
size
) {

44 
size_t
 
Æign
 = 
size
 & -size;

45 i‡(
Æign
 > 16)

46 
Æign
 = 16;

47  
	`block_poﬁ_Æloc_Æign
(
bp
, 
size
, 
Æign
);

48 
	}
}

50 
ölöe
 
	$block_poﬁ_‰ì
(
block_poﬁ
 *
bp
) {

51 
	`èŒoc_‰ì
(
bp
);

52 
	}
}

55 *
block_poﬁ_°rdup
(
block_poﬁ
 *
bp
, c⁄° *
°r
);

57 
ölöe
 *
	$block_poﬁ_memdup
(
block_poﬁ
 *
bp
, c⁄° *
§c
, 
size_t
 
size
) {

58 *
ªt
 = 
	`block_poﬁ_Æloc
(
bp
, 
size
);

59 
	`mem˝y
(
ªt
, 
§c
, 
size
);

60  
ªt
;

61 
	}
}

	@ccan/ccan/block_pool/test/run.c

1 
	~<cˇn/block_poﬁ/block_poﬁ.h
>

2 
	~<cˇn/block_poﬁ/block_poﬁ.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	sÆloc_ªc‹d
 {

6 
size_t
 
	msize
;

7 *
	m±r
;

10 
	$com∑r_Æloc_ªc‹d_by_±r
(c⁄° *
≠
, c⁄° *
bp
) {

11 c⁄° 
Æloc_ªc‹d
 *
a
=
≠
, *
b
=
bp
;

13 i‡(
a
->
±r
 < 
b
->ptr)

15 i‡(
a
->
±r
 > 
b
->ptr)

19 
	}
}

21 
size_t
 
	$øndom_block_size
() {

22 
sˇÀ
 = 
	`øndom
() % 11;

23 
sˇÀ
) {

28 4:  
	`øndom
() % 25;

31 7:  
	`øndom
() % 100;

33 9:  
	`øndom
() % 1000;

34 10:  
	`øndom
() % 10000;

36 
	`Ârötf
(
°dîr
, "øndom(Ë%% 3Ñëu∫ed %d somehow!\n", 
sˇÀ
);

37 
	`exô
(
EXIT_FAILURE
);

39 
	}
}

41 
	#L
(
node
Ë“ode+node+1)

	)

42 
	#R
(
node
Ë“ode+node+2)

	)

43 
	#P
(
node
Ë(“ode-1)>>1)

	)

45 
	#V
(
node
Ë(
bp
->
block
[node].
ªmaöög
)

	)

50 
	$check_hóp
(
block_poﬁ
 *
bp
, 
size_t
 
node
) {

51 i‡(
node
 < 
bp
->
cou¡
) {

52 i‡(
node
) {

53 i‡(
	`L
(
node
Ë< 
bp
->
cou¡
 && 
	`V
(L(node)) > V(node))

55 i‡(
	`R
(
node
Ë< 
bp
->
cou¡
 && 
	`V
(R(node)) > V(node))

58  
	`check_hóp
(
bp
, 
	`L
(
node
)Ë&& check_hóp(bp, 
	`R
(node));

61 
	}
}

63 #unde‡
L


64 #unde‡
R


65 #unde‡
P


66 #unde‡
V


72 
	$ã°_block_poﬁ
(
size_t
 
blocks_to_åy
, 
FILE
 *
out
, 
vîify_hóp
) {

73 
block_poﬁ
 *
bp
 = 
	`block_poﬁ_√w
(
NULL
);

74 
Æloc_ªc‹d
 *
ªc‹d
 = 
	`mÆloc
((*ªc‹dË* 
blocks_to_åy
);

75 
size_t
 
i
;

76 
size_t
 
byãs_Æloˇãd
 = 0;

77 
	#¥öt
(...) do { \

78 i‡(
out
) \

79 
	`¥ötf
(
__VA_ARGS__
); \

80 } 0)

	)

82 
	`¥öt
("AŒoˇtög %zu blocks...\n", 
blocks_to_åy
);

84 
i
=0; i<
blocks_to_åy
; i++) {

85 
ªc‹d
[
i
].
size
 = 
	`øndom_block_size
();

86 
ªc‹d
[
i
].
±r
 = 
	`block_poﬁ_Æloc
(
bp
,Ñec‹d[i].
size
);

88 
byãs_Æloˇãd
 +
ªc‹d
[
i
].
size
;

90 
	`mem£t
(
ªc‹d
[
i
].
±r
, 0x55,Ñec‹d[i].
size
);

92 i‡(
vîify_hóp
 && !
	`check_hóp
(
bp
, 0)) {

93 
	`¥öt
("BlockÖoﬁ'†max-hó∞i†wr⁄g (Æloˇti⁄ %zu)\n", 
i
);

98 
	`¥öt
("Finishedállocating\n"

102 
blocks_to_åy
, 
byãs_Æloˇãd
, 
bp
->
cou¡
);

104 
	`qs‹t
(
ªc‹d
, 
blocks_to_åy
,

105 (*
ªc‹d
), 
com∑r_Æloc_ªc‹d_by_±r
);

107 
	`¥öt
("Making sure blockÑangesáre unique...\n");

109 
i
=1; i<
blocks_to_åy
; i++) {

110 
Æloc_ªc‹d
 *
a
 = &
ªc‹d
[
i
-1];

111 
Æloc_ªc‹d
 *
b
 = &
ªc‹d
[
i
];

115 i‡(
a
->
±r
 > 
b
->ptr) {

116 
Æloc_ªc‹d
 *
tmp
 = 
a
;

117 
a
 = 
b
;

118 
b
 = 
tmp
;

121 i‡(
a
->
±r
 <
b
->±∏&&á->±r+a->
size
 <= b->ptr)

124 
	`¥öt
("AŒoˇti⁄†%zuánd %zu ovîœp\n", 
i
-1, i);

128 
	`¥öt
("Checking heap structure...\n");

129 i‡(!
	`check_hóp
(
bp
, 0)) {

130 
	`¥öt
("BlockÖool's max-heap is wrong\n");

134 
	`block_poﬁ_‰ì
(
bp
);

135 
	`‰ì
(
ªc‹d
);

139 #unde‡
¥öt


140 
	}
}

143 
	$maö
()

145 
	`∂™_ã°s
(1);

148 
	`ok1
(
	`ã°_block_poﬁ
(10000, 
NULL
, 1));

150  
	`exô_°©us
();

151 
	}
}

	@ccan/ccan/breakpoint/breakpoint.c

6 
	~<cˇn/bªakpoöt/bªakpoöt.h
>

8 
boﬁ
 
	gbªakpoöt_öôülized
;

9 
boﬁ
 
	gbªakpoöt_undî_debug
;

12 
	$å≠
(
signum
)

14 
bªakpoöt_öôülized
 = 
åue
;

15 
	}
}

17 
	$bªakpoöt_öô
()

19 
siga˘i⁄
 
ﬁd
, 
√w
;

21 
√w
.
ß_h™dÀr
 = 
å≠
;

22 
√w
.
ß_Êags
 = 0;

23 
	`sigem±y£t
(&
√w
.
ß_mask
);

24 
	`siga˘i⁄
(
SIGTRAP
, &
√w
, &
ﬁd
);

25 
	`kûl
(
	`gëpid
(), 
SIGTRAP
);

26 
	`siga˘i⁄
(
SIGTRAP
, &
ﬁd
, 
NULL
);

28 i‡(!
bªakpoöt_öôülized
) {

29 
bªakpoöt_öôülized
 = 
åue
;

30 
bªakpoöt_undî_debug
 = 
åue
;

32 
	}
}

	@ccan/ccan/breakpoint/breakpoint.h

2 #i‚de‡
CCAN_BREAKPOINT_H


3 
	#CCAN_BREAKPOINT_H


	)

4 
	~<cˇn/compûî/compûî.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<uni°d.h
>

7 
	~<sig«l.h
>

8 
	~<°dboﬁ.h
>

10 
	$bªakpoöt_öô
(Ë
COLD
;

11 
boﬁ
 
bªakpoöt_öôülized
;

12 
boﬁ
 
bªakpoöt_undî_debug
;

17 
ölöe
 
	$bªakpoöt
()

19 i‡(!
bªakpoöt_öôülized
)

20 
	`bªakpoöt_öô
();

21 i‡(
bªakpoöt_undî_debug
)

22 
	`kûl
(
	`gëpid
(), 
SIGTRAP
);

23 
	}
}

	@ccan/ccan/breakpoint/test/run.c

1 
	~<cˇn/bªakpoöt/bªakpoöt.h
>

2 
	~<cˇn/bªakpoöt/bªakpoöt.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

8 
	`∂™_ã°s
(2);

10 
	`bªakpoöt
();

12 
	`ok1
(
bªakpoöt_öôülized
);

13 
	`ok1
(!
bªakpoöt_undî_debug
);

16  
	`exô_°©us
();

17 
	}
}

	@ccan/ccan/btree/btree.c

23 
	~"båì.h
"

25 
	~<as£π.h
>

26 
	~<°dlib.h
>

27 
	~<°dio.h
>

29 
	#MAX
 (
BTREE_ITEM_MAX
)

	)

30 
	#MIN
 (
BTREE_ITEM_MAX
 >> 1)

	)

32 
båì_node
 *
node_Æloc
(
öã∫Æ
);

33 
node_dñëe
(
båì_node
 *
node
, 
båì
 *btree);

35 
bønch_begö
(
båì_ôî©‹
 
ôî
);

36 
bønch_íd
(
båì_ôî©‹
 
ôî
);

37 
begö_íd_Ã
(
båì_ôî©‹
 
ôî
, 
båì_node
 *
node
, 
Ã
);

46 
	#as˚nd
(
ôî
Ë((ôî)->
node
->
∑ª¡
 \

47 ? (
ôî
)->
k
 = (ôî)->
node
->k, (ôî)->nodê(ôî)->node->
∑ª¡
, 1 \

48 : 0)

	)

50 
node_ö£π
(c⁄° *
x
, 
båì_node
 *
xr
,

51 
båì_node
 *
p
, 
k
);

52 
node_•lô
(c⁄° **
x
, 
båì_node
 **
xr
,

53 
båì_node
 *
p
, 
k
);

55 
node_ªmove_Àaf_ôem
(
båì_node
 *
node
, 
k
);

56 
node_ª°‹e
(
båì_node
 *
node
, 
k
);

58 
node_wÆk_backw¨d
(c⁄° 
båì_node
 *
node
,

59 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
);

60 
node_wÆk_f‹w¨d
(c⁄° 
båì_node
 *
node
,

61 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
);

66 
båì
 *
	$båì_√w
(
båì_£¨ch_t
 
£¨ch
)

68 
båì
 *båì = 
	`ˇŒoc
(1, (btree));

69 
båì_node
 *
node
 = 
	`node_Æloc
(0);

70 
node
->
∑ª¡
 = 
NULL
;

71 
node
->
cou¡
 = 0;

72 
node
->
dïth
 = 0;

73 
båì
->
roŸ
 = 
node
;

74 
båì
->
£¨ch
 = search;

75 
båì
->
mu…i
 = 
Ál£
;

76  
båì
;

77 
	}
}

79 
	$båì_dñëe
(
båì
 *btree)

81 
	`node_dñëe
(
båì
->
roŸ
, btree);

82 
	`‰ì
(
båì
);

83 
	}
}

85 
boﬁ
 
	$båì_ö£π
(
båì
 *båì, c⁄° *
ôem
)

87 
båì_ôî©‹
 
ôî
;

89 i‡(
	`båì_föd_œ°
(
båì
, 
ôem
, 
ôî
Ë&& !båì->
mu…i
)

90  
Ál£
;

92 
	`båì_ö£π_©
(
ôî
, 
ôem
);

93  
åue
;

94 
	}
}

96 
boﬁ
 
	$båì_ªmove
(
båì
 *båì, c⁄° *
key
)

98 
båì_ôî©‹
 
ôî
;

99 
boﬁ
 
suc˚ss
 = 
Ál£
;

100 
boﬁ
 
mu…i
 = 
båì
->multi;

103 i‡(
	`båì_föd_fú°
(
båì
, 
key
, 
ôî
)) {

104 
	`båì_ªmove_©
(
ôî
);

105 
suc˚ss
 = 
åue
;

107 } 
mu…i
);

109  
suc˚ss
;

110 
	}
}

112 *
	$båì_lookup
(
båì
 *båì, c⁄° *
key
)

114 
båì_ôî©‹
 
ôî
;

116 i‡(
	`båì_föd_fú°
(
båì
, 
key
, 
ôî
))

117  
ôî
->
ôem
;

119  
NULL
;

120 
	}
}

122 
	$båì_begö_íd_Ã
(c⁄° 
båì
 *båì, 
båì_ôî©‹
 
ôî
, 
Ã
)

124 
båì_node
 *
node
;

126 
ôî
->
båì
 = (btree *)btree;

127 
	`begö_íd_Ã
(
ôî
, 
båì
->
roŸ
, 
Ã
);

130 
node
 = 
ôî
->node;

131 i‡(
node
->
cou¡
) {

132 
ôî
->
ôem
 = (*)
node
->ôem[ôî->
k
 - 
Ã
];

137 
	}
}

139 
	$båì_dîef
(
båì_ôî©‹
 
ôî
)

141 i‡(
ôî
->
k
 >ôî->
node
->
cou¡
) {

142 
båì_ôî©‹_s
 
tmp
 = *
ôî
;

144 i‡(!
	`as˚nd
(
ôî
)) {

145 *
ôî
 = 
tmp
;

148 } 
ôî
->
k
 >ôî->
node
->
cou¡
);

151 
ôî
->
ôem
 = (*)ôî->
node
->ôem[ôî->
k
];

153 
	}
}

155 
	$båì_¥ev
(
båì_ôî©‹
 
ôî
)

157 i‡(
ôî
->
node
->
dïth
) {

158 
	`bønch_íd
(
ôî
);

159 } i‡(
ôî
->
k
 == 0) {

160 
båì_ôî©‹_s
 
tmp
 = *
ôî
;

162 i‡(!
	`as˚nd
(
ôî
)) {

163 *
ôî
 = 
tmp
;

166 } 
ôî
->
k
 == 0);

169 
ôî
->
ôem
 = (*)ôî->
node
->ôem[--ôî->
k
];

171 
	}
}

173 
	$båì_√xt
(
båì_ôî©‹
 
ôî
)

175 
ªt
 = 
	`båì_dîef
(
ôî
);

176 i‡(
ªt
) {

177 
ôî
->
k
++;

178 i‡(
ôî
->
node
->
dïth
)

179 
	`bønch_begö
(
ôî
);

181  
ªt
;

182 
	}
}

184 
	$båì_föd_Ã
(c⁄° 
båì
 *båì, c⁄° *
key
,

185 
båì_ôî©‹
 
ôî
, 
Ã
)

187 
båì_node
 *
node
 = 
båì
->
roŸ
;

188 
k
;

189 
dïth
;

190 
found
 = 0;

192 
ôî
->
båì
 = (btree *)btree;

193 
ôî
->
ôem
 = 
NULL
;

195 
dïth
 = 
node
->depth;

197 
f
 = 0;

198 
k
 = 
båì
->
	`£¨ch
(
key
, 
node
->
ôem
,Çode->
cou¡
, 
Ã
, &
f
);

200 i‡(
f
) {

201 
ôî
->
ôem
 = (*)
node
->ôem[
k
 - 
Ã
];

202 
found
 = 1;

204 i‡(!
dïth
--)

207 
node
 =Çode->
bønch
[
k
];

210 
ôî
->
node
 =Çode;

211 
ôî
->
k
 = k;

213  
found
;

214 
	}
}

216 
	$båì_wÆk_backw¨d
(c⁄° 
båì
 *btree,

217 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
)

219  
	`node_wÆk_backw¨d
(
båì
->
roŸ
, 
a˘i⁄
, 
˘x
);

220 
	}
}

222 
	$båì_wÆk_f‹w¨d
(c⁄° 
båì
 *btree,

223 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
)

225  
	`node_wÆk_f‹w¨d
(
båì
->
roŸ
, 
a˘i⁄
, 
˘x
);

226 
	}
}

228 
	$båì_ö£π_©
(
båì_ôî©‹
 
ôî
, c⁄° *
ôem
)

230 c⁄° *
x
 = 
ôem
;

231 
båì_node
 *
xr
 = 
NULL
;

232 
båì_node
 *
p
;

233 
båì
 *båì = 
ôî
->btree;

236 
ôî
->
ôem
 = (*)item;

243 i‡(
ôî
->
node
->
dïth
)

244 
	`bønch_íd
(
ôî
);

251 i‡(
ôî
->
node
->
cou¡
 < 
MAX
) {

252 
	`node_ö£π
(
x
, 
xr
, 
ôî
->
node
, iãr->
k
);

253 
föished
;

256 
	`node_•lô
(&
x
, &
xr
, 
ôî
->
node
, iãr->
k
);

258 i‡(!
	`as˚nd
(
ôî
))

261 i‡(
ôî
->
node
->
cou¡
 < 
MAX
) {

262 
	`node_ö£π
(
x
, 
xr
, 
ôî
->
node
, iãr->
k
);

263 
föished
;

272 
	`as£π
(
ôî
->
node
 =
båì
->
roŸ
);

273 
p
 = 
	`node_Æloc
(1);

274 
p
->
∑ª¡
 = 
NULL
;

275 
p
->
cou¡
 = 1;

276 
p
->
dïth
 = 
båì
->
roŸ
->depth + 1;

277 
p
->
ôem
[0] = 
x
;

278 
p
->
bønch
[0] = 
båì
->
roŸ
;

279 
båì
->
roŸ
->
∑ª¡
 = 
p
;

280 
båì
->
roŸ
->
k
 = 0;

281 
p
->
bønch
[1] = 
xr
;

282 
xr
->
∑ª¡
 = 
p
;

283 
xr
->
k
 = 1;

284 
båì
->
roŸ
 = 
p
;

287 
föished
:

288 
båì
->
cou¡
++;

289 
ôî
->
node
 = 
NULL
;

290 
	}
}

292 
	$båì_ªmove_©
(
båì_ôî©‹
 
ôî
)

294 
båì
 *båì = 
ôî
->btree;

295 
båì_node
 *
roŸ
;

297 i‡(!
	`båì_dîef
(
ôî
))

300 i‡(!
ôî
->
node
->
dïth
) {

301 
	`node_ªmove_Àaf_ôem
(
ôî
->
node
, iãr->
k
);

302 i‡(
ôî
->
node
->
cou¡
 >
MIN
 || !ôî->node->
∑ª¡
)

303 
föished
;

312 c⁄° **
x
 = &
ôî
->
node
->
ôem
[ôî->
k
];

315 
ôî
->
k
++;

316 
	`bønch_begö
(
ôî
);

319 *
x
 = 
ôî
->
node
->
ôem
[0];

322 
	`node_ªmove_Àaf_ôem
(
ôî
->
node
, 0);

330 i‡(
ôî
->
node
->
cou¡
 >
MIN
)

331 
föished
;

332 i‡(!
	`as˚nd
(
ôî
))

334 
	`node_ª°‹e
(
ôî
->
node
, iãr->
k
);

341 
roŸ
 = 
ôî
->
node
;

342 
	`as£π
(
roŸ
 =
båì
->root);

343 
	`as£π
(
roŸ
->
dïth
 > 0);

344 i‡(
roŸ
->
cou¡
 == 0) {

345 
båì
->
roŸ
 =ÑoŸ->
bønch
[0];

346 
båì
->
roŸ
->
∑ª¡
 = 
NULL
;

347 
	`‰ì
(
roŸ
);

350 
föished
:

351 
båì
->
cou¡
--;

352 
ôî
->
node
 = 
NULL
;

354 
	}
}

362 
	$ñev©e
(
båì_ôî©‹
 
a
, båì_ôî©‹ 
b
)

364 
a
->
node
->
dïth
 < 
b
->node->depth)

365 
	`as˚nd
(
a
);

367 i‡(
a
->
k
 =
b
->k)

370 
	}
}

372 
	$båì_cmp_ôîs
(c⁄° 
båì_ôî©‹
 
ôî_a
, c⁄° båì_ôî©‹ 
ôî_b
)

374 
båì_ôî©‹
 
a
 = {*
ôî_a
}, 
b
 = {*
ôî_b
};

375 
ad
, 
bd
;

377 
ad
 = 
	`båì_dîef
(
a
);

378 
bd
 = 
	`båì_dîef
(
b
);

381 i‡(!
ad
)

382  
bd
 ? 1 : 0;

383 i‡(!
bd
)

384  
ad
 ? -1 : 0;

387 i‡(
a
->
node
->
dïth
 < 
b
->node->depth) {

388 i‡(
	`ñev©e
(
a
, 
b
))

390 } i‡(
a
->
node
->
dïth
 > 
b
->node->depth) {

391 i‡(
	`ñev©e
(
b
, 
a
))

396 
a
->
node
 !
b
->node) {

397 
	`as˚nd
(
a
);

398 
	`as˚nd
(
b
);

402 i‡(
a
->
k
 < 
b
->k)

404 i‡(
a
->
k
 > 
b
->k)

408 
	}
}

412 
	gbåì_£¨ch_im∂emít


414 
	gbåì_°rcmp
,

416 
	gc
 = 
°rcmp
(
a
, 
b
),

417 
	gc
 == 0,

418 
	gc
 < 0

424 
båì_node
 *
	$node_Æloc
(
öã∫Æ
)

426 
båì_node
 *
node
;

427 
size_t
 
isize
 = 
öã∫Æ


428 ? (
båì_node
*Ë* (
BTREE_ITEM_MAX
+1)

430 
node
 = 
	`mÆloc
((
båì_node
Ë+ 
isize
);

431  
node
;

432 
	}
}

434 
	$node_dñëe
(
båì_node
 *
node
, 
båì
 *btree)

436 
i
, 
cou¡
 = 
node
->count;

438 i‡(!
node
->
dïth
) {

439 i‡(
båì
->
de°roy
) {

440 
i
=0; i<
cou¡
; i++)

441 
båì
->
	`de°roy
((*)
node
->
ôem
[
i
], båì->
de°roy_˘x
);

444 
i
=0; i<
cou¡
; i++) {

445 
	`node_dñëe
(
node
->
bønch
[
i
], 
båì
);

446 i‡(
båì
->
de°roy
)

447 
båì
->
	`de°roy
((*)
node
->
ôem
[
i
], båì->
de°roy_˘x
);

449 
	`node_dñëe
(
node
->
bønch
[
cou¡
], 
båì
);

452 
	`‰ì
(
node
);

453 
	}
}

456 
	$bønch_begö
(
båì_ôî©‹
 
ôî
)

458 
båì_node
 *
node
 = 
ôî
->node->
bønch
[ôî->
k
];

459 
dïth
 = 
node
->depth;

460 
dïth
--)

461 
node
 =Çode->
bønch
[0];

462 
ôî
->
node
 =Çode;

463 
ôî
->
k
 = 0;

464 
	}
}

467 
	$bønch_íd
(
båì_ôî©‹
 
ôî
)

469 
båì_node
 *
node
 = 
ôî
->node->
bønch
[ôî->
k
];

470 
dïth
 = 
node
->depth;

471 
dïth
--)

472 
node
 =Çode->
bønch
[node->
cou¡
];

473 
ôî
->
node
 =Çode;

474 
ôî
->
k
 = 
node
->
cou¡
;

475 
	}
}

478 
	$begö_íd_Ã
(
båì_ôî©‹
 
ôî
, 
båì_node
 *
node
, 
Ã
)

480 
ôî
->
node
 =Çode;

481 
ôî
->
k
 = 
Ã
 ? 
node
->
cou¡
 : 0;

482 i‡(
node
->
dïth
)

483 (
Ã
 ? 
bønch_íd
 : 
bønch_begö
)(
ôî
);

484 
	}
}

492 
	$node_ö£π
(c⁄° *
x
, 
båì_node
 *
xr
,

493 
båì_node
 *
p
, 
k
)

495 
i
;

497 
i
 = 
p
->
cou¡
; i-- > 
k
;)

498 
p
->
ôem
[
i
+1] =Ö->item[i];

499 
p
->
ôem
[
k
] = 
x
;

501 i‡(
p
->
dïth
) {

502 
k
++;

503 
i
 = 
p
->
cou¡
+1; i-- > 
k
;) {

504 
p
->
bønch
[
i
+1] =Ö->branch[i];

505 
p
->
bønch
[
i
+1]->
k
 = i+1;

507 
p
->
bønch
[
k
] = 
xr
;

508 
xr
->
∑ª¡
 = 
p
;

509 
xr
->
k
 = k;

512 
p
->
cou¡
++;

513 
	}
}

522 
	$node_•lô
(c⁄° **
x
, 
båì_node
 **
xr
,

523 
båì_node
 *
p
, 
k
)

525 
i
, 
•lô
;

526 
båì_node
 *
l
 = 
p
, *
r
;

534 i‡(
k
 <
MIN
)

535 
•lô
 = 
MIN
;

537 
•lô
 = 
MIN
 + 1;

543 
r
 = 
	`node_Æloc
(
l
->
dïth
);

546 
r
->
∑ª¡
 = 
l
->parent;

547 
r
->
dïth
 = 
l
->depth;

555 
i
 = 
•lô
; i < 
MAX
; i++)

556 
r
->
ôem
[
i
-
•lô
] = 
l
->item[i];

557 i‡(
r
->
dïth
) {

558 
i
 = 
•lô
+1; i <
MAX
; i++) {

559 
r
->
bønch
[
i
-
•lô
] = 
l
->branch[i];

560 
r
->
bønch
[
i
-
•lô
]->
∑ª¡
 =Ñ;

561 
r
->
bønch
[
i
-
•lô
]->
k
 = i-split;

566 
l
->
cou¡
 = 
•lô
;

567 
r
->
cou¡
 = 
MAX
 - 
•lô
;

575 i‡(
k
 <
MIN
)

576 
	`node_ö£π
(*
x
, *
xr
, 
l
, 
k
);

578 
	`node_ö£π
(*
x
, *
xr
, 
r
, 
k
 - 
•lô
);

584 i‡(
r
->
dïth
) {

585 
r
->
bønch
[0] = 
l
->bønch[l->
cou¡
];

586 
r
->
bønch
[0]->
∑ª¡
 =Ñ;

587 
r
->
bønch
[0]->
k
 = 0;

594 *
x
 = 
l
->
ôem
[--l->
cou¡
];

595 *
xr
 = 
r
;

596 
	}
}

604 
	$node_ªmove_Àaf_ôem
(
båì_node
 *
node
, 
k
)

606 
i
;

607 
i
 = 
k
+1; i < 
node
->
cou¡
; i++)

608 
node
->
ôem
[
i
-1] =Çode->item[i];

609 
node
->
cou¡
--;

610 
	}
}

612 
move_À·
(
båì_node
 *
node
, 
k
);

613 
move_right
(
båì_node
 *
node
, 
k
);

614 
comböe
(
båì_node
 *
node
, 
k
);

621 
	$node_ª°‹e
(
båì_node
 *
node
, 
k
)

623 i‡(
k
 == 0) {

624 i‡(
node
->
bønch
[1]->
cou¡
 > 
MIN
)

625 
	`move_À·
(
node
, 0);

627 
	`comböe
(
node
, 0);

628 } i‡(
k
 =
node
->
cou¡
) {

629 i‡(
node
->
bønch
[
k
-1]->
cou¡
 > 
MIN
)

630 
	`move_right
(
node
, 
k
-1);

632 
	`comböe
(
node
, 
k
-1);

633 } i‡(
node
->
bønch
[
k
-1]->
cou¡
 > 
MIN
) {

634 
	`move_right
(
node
, 
k
-1);

635 } i‡(
node
->
bønch
[
k
+1]->
cou¡
 > 
MIN
) {

636 
	`move_À·
(
node
, 
k
);

638 
	`comböe
(
node
, 
k
-1);

640 
	}
}

642 
	$move_À·
(
båì_node
 *
node
, 
k
)

644 
båì_node
 *
l
 = 
node
->
bønch
[
k
], *
r
 =Çode->bønch[k+1], *
mv
;

645 
i
;

647 
l
->
ôem
[l->
cou¡
] = 
node
->ôem[
k
];

648 
node
->
ôem
[
k
] = 
r
->item[0];

649 
i
 = 1; i < 
r
->
cou¡
; i++)

650 
r
->
ôem
[
i
-1] =Ñ->item[i];

652 i‡(
r
->
dïth
) {

653 
mv
 = 
r
->
bønch
[0];

654 
l
->
bønch
[l->
cou¡
+1] = 
mv
;

655 
mv
->
∑ª¡
 = 
l
;

656 
mv
->
k
 = 
l
->
cou¡
+1;

658 
i
 = 1; i <
r
->
cou¡
; i++) {

659 
r
->
bønch
[
i
-1] =Ñ->branch[i];

660 
r
->
bønch
[
i
-1]->
k
 = i-1;

664 
l
->
cou¡
++;

665 
r
->
cou¡
--;

666 
	}
}

668 
	$move_right
(
båì_node
 *
node
, 
k
)

670 
båì_node
 *
l
 = 
node
->
bønch
[
k
], *
r
 =Çode->branch[k+1];

671 
i
;

673 
i
 = 
r
->
cou¡
; i--;)

674 
r
->
ôem
[
i
+1] =Ñ->item[i];

675 
r
->
ôem
[0] = 
node
->ôem[
k
];

676 
node
->
ôem
[
k
] = 
l
->ôem[l->
cou¡
-1];

678 i‡(
r
->
dïth
) {

679 
i
 = 
r
->
cou¡
+1; i--;) {

680 
r
->
bønch
[
i
+1] =Ñ->branch[i];

681 
r
->
bønch
[
i
+1]->
k
 = i+1;

683 
r
->
bønch
[0] = 
l
->bønch[l->
cou¡
];

684 
r
->
bønch
[0]->
∑ª¡
 =Ñ;

685 
r
->
bønch
[0]->
k
 = 0;

688 
l
->
cou¡
--;

689 
r
->
cou¡
++;

690 
	}
}

693 
	$comböe
(
båì_node
 *
node
, 
k
)

695 
båì_node
 *
l
 = 
node
->
bønch
[
k
], *
r
 =Çode->bønch[k+1], *
mv
;

696 c⁄° **
o
 = &
l
->
ôem
[l->
cou¡
];

697 
i
;

700 *
o
++ = 
node
->
ôem
[
k
];

701 
i
=0; i<
r
->
cou¡
; i++)

702 *
o
++ = 
r
->
ôem
[
i
];

705 i‡(
r
->
dïth
) {

706 
i
=0; i<=
r
->
cou¡
; i++) {

707 
mv
 = 
r
->
bønch
[
i
];

708 
l
->
bønch
[l->
cou¡
 + 
i
 + 1] = 
mv
;

709 
mv
->
∑ª¡
 = 
l
;

710 
mv
->
k
 = 
l
->
cou¡
 + 
i
 + 1;

715 
i
 = 
k
+1; i < 
node
->
cou¡
; i++) {

716 
node
->
ôem
[
i
-1] =Çode->item[i];

717 
node
->
bønch
[
i
] =Çode->branch[i+1];

718 
node
->
bønch
[
i
]->
k
 = i;

722 
l
->
cou¡
 +
r
->count + 1;

723 
node
->
cou¡
--;

724 
	`‰ì
(
r
);

725 
	}
}

727 
	$node_wÆk_backw¨d
(c⁄° 
båì_node
 *
node
,

728 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
)

730 
i
, 
cou¡
 = 
node
->count;

732 i‡(!
node
->
dïth
) {

733 
i
=
cou¡
; i--;)

734 i‡(!
	`a˘i⁄
((*)
node
->
ôem
[
i
], 
˘x
))

737 i‡(!
	`node_wÆk_backw¨d
(
node
->
bønch
[
cou¡
], 
a˘i⁄
, 
˘x
))

739 
i
=
cou¡
; i--;) {

740 i‡(!
	`a˘i⁄
((*)
node
->
ôem
[
i
], 
˘x
))

742 i‡(!
	`node_wÆk_backw¨d
(
node
->
bønch
[
i
], 
a˘i⁄
, 
˘x
))

748 
	}
}

750 
	$node_wÆk_f‹w¨d
(c⁄° 
båì_node
 *
node
,

751 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
)

753 
i
, 
cou¡
 = 
node
->count;

755 i‡(!
node
->
dïth
) {

756 
i
=0; i<
cou¡
; i++)

757 i‡(!
	`a˘i⁄
((*)
node
->
ôem
[
i
], 
˘x
))

760 
i
=0; i<
cou¡
; i++) {

761 i‡(!
	`node_wÆk_f‹w¨d
(
node
->
bønch
[
i
], 
a˘i⁄
, 
˘x
))

763 i‡(!
	`a˘i⁄
((*)
node
->
ôem
[
i
], 
˘x
))

766 i‡(!
	`node_wÆk_f‹w¨d
(
node
->
bønch
[
cou¡
], 
a˘i⁄
, 
˘x
))

771 
	}
}

	@ccan/ccan/btree/btree.h

23 #i‚de‡
CCAN_BTREE_H


24 
	#CCAN_BTREE_H


	)

36 
	~<°dboﬁ.h
>

37 
	~<°döt.h
>

38 
	~<°rög.h
>

44 
	#BTREE_ITEM_MAX
 20

	)

46 
	sbåì_node
 {

47 
båì_node
 *
	m∑ª¡
;

50 
	mcou¡
;

53 
	mdïth
;

56 
	mk
;

58 c⁄° *
	môem
[
BTREE_ITEM_MAX
];

64 
båì_node
 *
	mbønch
[];

67 
	sbåì_ôî©‹_s
 {

68 
båì
 *
	mbåì
;

69 
båì_node
 *
	mnode
;

70 
	mk
;

76 *
	môem
;

77 } 
	tbåì_ôî©‹
[1];

83 
	tbåì_£¨ch_¥Ÿo
(

84 c⁄° *
	tkey
,

85 c⁄° * c⁄° *
	tba£
,

86 
	tcou¡
,

87 
	tÃ
,

88 *
	tfound


90 
båì_£¨ch_¥Ÿo
 *
	tbåì_£¨ch_t
;

92 
båì_£¨ch_¥Ÿo
 
	gbåì_°rcmp
;

103 (*
	tbåì_a˘i⁄_t
)(*
	tôem
, *
	t˘x
);

105 
	sbåì
 {

106 
båì_node
 *
roŸ
;

107 
size_t
 
cou¡
;

109 
båì_£¨ch_t
 
£¨ch
;

110 
boﬁ
 
mu…i
;

121 
båì_a˘i⁄_t
 
de°roy
;

122 *
de°roy_˘x
;

125 
båì
 *
	`båì_√w
(
båì_£¨ch_t
 
£¨ch
);

126 
	`båì_dñëe
(
båì
 *btree);

136 
boﬁ
 
	`båì_ö£π
(
båì
 *båì, c⁄° *
ôem
);

144 
boﬁ
 
	`båì_ªmove
(
båì
 *båì, c⁄° *
key
);

150 *
	`båì_lookup
(
båì
 *båì, c⁄° *
key
);

154 
	`båì_begö_íd_Ã
(c⁄° 
båì
 *båì, 
båì_ôî©‹
 
ôî
, 
Ã
);

155 
	`båì_föd_Ã
(c⁄° 
båì
 *båì, c⁄° *
key
,

156 
båì_ôî©‹
 
ôî
, 
Ã
);

158 
	`båì_wÆk_backw¨d
(c⁄° 
båì
 *btree,

159 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
);

160 
	`båì_wÆk_f‹w¨d
(c⁄° 
båì
 *btree,

161 
båì_a˘i⁄_t
 
a˘i⁄
, *
˘x
);

163 
	#båì_begö
(
båì
, 
ôî
Ë
	`båì_begö_íd_Ã
(båì, iãr, 0)

	)

164 
	#båì_íd
(
båì
, 
ôî
Ë
	`båì_begö_íd_Ã
(båì, iãr, 1)

	)

166 
	`båì_¥ev
(
båì_ôî©‹
 
ôî
);

167 
	`båì_√xt
(
båì_ôî©‹
 
ôî
);

169 
	#båì_wÆk
(
båì
, 
a˘i⁄
, 
˘x
Ë
	`båì_wÆk_f‹w¨d
(båì,á˘i⁄, ctx)

	)

179 
	#båì_föd_fú°
(
båì
, 
key
, 
ôî
Ë
	`båì_föd_Ã
(båì, key, iãr, 0)

	)

189 
	#båì_föd_œ°
(
båì
, 
key
, 
ôî
Ë
	`båì_föd_Ã
(båì, key, iãr, 1)

	)

192 
	#båì_föd
(
båì
, 
key
, 
ôî
Ë
	`båì_föd_fú°
(båì, key, iãr)

	)

201 
	`båì_dîef
(
båì_ôî©‹
 
ôî
);

210 
	`båì_ö£π_©
(
båì_ôî©‹
 
ôî
, c⁄° *
ôem
);

221 
	`båì_ªmove_©
(
båì_ôî©‹
 
ôî
);

229 
	`båì_cmp_ôîs
(c⁄° 
båì_ôî©‹
 
ôî_a
, c⁄° båì_ôî©‹ 
ôî_b
);

231 
	#båì_£¨ch_im∂emít
(
«me
, 
ty≥
, 
£tup
, 
equÆs
, 
Às°h™
) \

232 
	`«me
(c⁄° *
__key
, \

233 c⁄° * c⁄° *
__ba£
, 
__cou¡
, \

234 
__Ã
, *
__found
) \

236 
__°¨t
 = 0; \

237 
__cou¡
) { \

238 
__middÀ
 = 
__cou¡
 >> 1; \

239 
ty≥
 
a
 = (ty≥)
__key
; \

240 
ty≥
 
b
 = (ty≥)
__ba£
[
__°¨t
 + 
__middÀ
]; \

242 
£tup
; \

243 i‡(
equÆs
) \

244 
__equÆs
; \

245 i‡(
Às°h™
) \

246 
__Às°h™
; \

248 
__gª©îth™
: \

249 
__°¨t
 +
__middÀ
 + 1; \

250 
__cou¡
 -
__middÀ
 + 1; \

252 
__equÆs
: \

253 *
__found
 = 1; \

254 i‡(
__Ã
) \

255 
__gª©îth™
; \

257 
__Às°h™
: \

258 
__cou¡
 = 
__middÀ
; \

261  
__°¨t
; \

262 
	}

	)
}

	@ccan/ccan/btree/test/run-benchmark.c

2 
	~<cˇn/båì/båì.h
>

4 
	~<cˇn/båì/båì.c
>

5 
	~<cˇn/èp/èp.h
>

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<°rög.h
>

11 
uöt32_t
 
	gønd32_°©e
 = 0;

17 
uöt32_t
 
	$ønd32
()

19 
ønd32_°©e
 *(
uöt32_t
)0x7FF8A3ED;

20 
ønd32_°©e
 +(
uöt32_t
)0x2AA01D31;

21  
ønd32_°©e
;

22 
	}
}

24 
	$s¸ambÀ
(*
ba£
, 
size_t
 
nmemb
, size_à
size
)

26 *
i
 = 
ba£
;

27 *
o
;

28 
size_t
 
sd
;

29 ;
nmemb
>1;nmemb--) {

30 
o
 = 
i
 + 
size
*(
	`ønd32
()%
nmemb
);

31 
sd
=
size
;sd--;) {

32 
tmp
 = *
o
;

33 *
o
++ = *
i
;

34 *
i
++ = 
tmp
;

37 
	}
}

39 
	sã°_ôem
 {

40 
size_t
 
	mkey
;

41 
uöt32_t
 
	mvÆue
;

45 
båì_£¨ch_im∂emít
 (

46 
‹dî_by_key
,

47 c⁄° 
ã°_ôem
 *,

49 
a
 =
b
,

50 
a
 < 
b


54 
	$com∑ª_ã°_ôem
(c⁄° *
≠
, c⁄° *
bp
)

56 c⁄° 
ã°_ôem
 *
a
 = *(c⁄° ã°_ôem * c⁄°*)
≠
;

57 c⁄° 
ã°_ôem
 *
b
 = *(c⁄° ã°_ôem * c⁄°*)
bp
;

58 i‡(
a
 =
b
)

60 i‡(
a
 < 
b
)

63 
	}
}

69 
	$check_ôî
(
båì_ôî©‹
 
ôî_‹ig
, c⁄° *
ôem
, 
Ã
)

71 
båì_ôî©‹
 
ôî
 = {*
ôî_‹ig
};

72 i‡(
ôî
->
ôem
 != item)

74 i‡(
Ã
) {

75 i‡(!
	`båì_¥ev
(
ôî
))

78 i‡(!
	`båì_dîef
(
ôî
))

81 i‡(
ôî
->
ôem
 != item)

83 i‡(
ôî
->
node
->
ôem
[ôî->
k
] != iter->item)

87 
	}
}

94 
	$ö£π_ã°_ôem
(
båì
 *båì, 
ã°_ôem
 *
ôem
)

96 
båì_ôî©‹
 
ôî
;

97 
Ã
;

100 
Ã
 = 
	`ønd32
() & 1;

101 i‡(
	`båì_föd_Ã
(
båì
, 
ôem
, 
ôî
, 
Ã
)) {

102 i‡(!
	`check_ôî
(
ôî
, 
ôem
, 
Ã
))

107 
	`båì_ö£π_©
(
ôî
, 
ôem
);

109 i‡(
ôî
->
ôem
 != item)

113 
	}
}

120 
	$ªmove_ã°_ôem
(
båì
 *båì, 
ã°_ôem
 *
ôem
)

122 
båì_ôî©‹
 
ôî
;

124 i‡(!
	`båì_föd
(
båì
, 
ôem
, 
ôî
))

127 i‡(!
	`check_ôî
(
ôî
, 
ôem
, 0))

130 
	`båì_ªmove_©
(
ôî
);

132 i‡(
ôî
->
ôem
 != item)

136 
	}
}

139 
size_t
 
	msuc˚ss
;

141 
size_t
 
	mex˚ss
;

142 
size_t
 
	mdu∂iˇã
;

143 
size_t
 
	mmissög
;

144 
size_t
 
	möc‹ª˘
;

145 
size_t
 
	mÁûed
;

147 
size_t
 
	mbad_ôî_föd
;

148 
size_t
 
	mbad_ôî_ö£π
;

149 
size_t
 
	mbad_ôî_ªmove
;

150 
size_t
 
	mbad_ôî_√xt
;

151 } 
	g°©s
;

153 
	$˛ór_°©s
() {

154 
	`mem£t
(&
°©s
, 0, (stats));

155 
	}
}

157 
	$¥öt_°©s
(c⁄° *
suc˚ss_œbñ
, 
size_t
 
ex≥˘ed_suc˚ss
) {

158 
Áûed
 = 0;

160 
	`¥ötf
(" %s: \t%zu\n", 
suc˚ss_œbñ
, 
°©s
.
suc˚ss
);

161 i‡(
°©s
.
suc˚ss
 !
ex≥˘ed_suc˚ss
)

162 
Áûed
 = 1;

164 i‡(
°©s
.
ex˚ss
)

165 
Áûed
 = 1, 
	`¥ötf
(" Ex˚ss: \t%zu\n", 
°©s
.
ex˚ss
);

166 i‡(
°©s
.
du∂iˇã
)

167 
Áûed
 = 1, 
	`¥ötf
(" Du∂iˇã: \t%zu\n", 
°©s
.
du∂iˇã
);

168 i‡(
°©s
.
missög
)

169 
Áûed
 = 1, 
	`¥ötf
(" Missög: \t%zu\n", 
°©s
.
missög
);

170 i‡(
°©s
.
öc‹ª˘
)

171 
Áûed
 = 1, 
	`¥ötf
(" Inc‹ª˘: \t%zu\n", 
°©s
.
öc‹ª˘
);

172 i‡(
°©s
.
Áûed
)

173 
Áûed
 = 1, 
	`¥ötf
(" Faûed: \t%zu\n", 
°©s
.failed);

175 i‡(
°©s
.
bad_ôî_föd
 || sèts.
bad_ôî_ö£π
 ||

176 
°©s
.
bad_ôî_ªmove
 || sèts.
bad_ôî_√xt
) {

177 
Áûed
 = 1;

178 
	`¥ötf
(" Bad iterators yielded by:\n");

179 i‡(
°©s
.
bad_ôî_föd
)

180 
	`¥ötf
(" båì_föd_Ã(): %zu\n", 
°©s
.
bad_ôî_föd
);

181 i‡(
°©s
.
bad_ôî_ö£π
)

182 
	`¥ötf
(" båì_ö£π_©(): %zu\n", 
°©s
.
bad_ôî_ö£π
);

183 i‡(
°©s
.
bad_ôî_ªmove
)

184 
	`¥ötf
(" båì_ªmove_©(): %zu\n", 
°©s
.
bad_ôî_ªmove
);

185 i‡(
°©s
.
bad_ôî_√xt
)

186 
	`¥ötf
(" båì_√xt(): %zu\n", 
°©s
.
bad_ôî_√xt
);

189  !
Áûed
;

190 
	}
}

192 
	$bíchm¨k
(
size_t
 
max_≥r_åül
, size_à
round_cou¡
, 
øndom_cou¡s
)

194 
ã°_ôem
 **test_item;

195 
ã°_ôem
 *
ã°_ôem_¨øy
;

196 
size_t
 
i
, 
cou¡
;

197 
size_t
 
round
 = 0;

199 
ã°_ôem
 = 
	`mÆloc
(
max_≥r_åül
 * (*test_item));

200 
ã°_ôem_¨øy
 = 
	`mÆloc
(
max_≥r_åül
 * (*test_item_array));

202 i‡(!
ã°_ôem
 || !
ã°_ôem_¨øy
) {

203 
	`Áû
("NotÉnough memory for %zu keysÖerÅrial\n",

204 
max_≥r_åül
);

209 
i
=0; i<
max_≥r_åül
; i++)

210 
ã°_ôem
[
i
] = &
ã°_ôem_¨øy
[i];

216 
round
 = 1; 
round_cou¡
==0 ||Ñound <=Ñound_count;Ñound++) {

217 
båì
 *btree;

218 
båì_ôî©‹
 
ôî
;

220 
	`¥ötf
("Round %zu\n", 
round
);

222 i‡(
øndom_cou¡s
)

223 
cou¡
 = 
	`ønd32
(Ë% (
max_≥r_åül
+1);

225 
cou¡
 = 
max_≥r_åül
;

232 
i
=0; i<
cou¡
; i++) {

233 
ã°_ôem
[
i
]->
key
 = i;

234 
ã°_ôem
[
i
]->
vÆue
 = 
	`ønd32
();

236 
	`s¸ambÀ
(
ã°_ôem
, 
cou¡
, (*test_item));

238 
båì
 = 
	`båì_√w
(
‹dî_by_key
);

240 
	`˛ór_°©s
();

241 
	`¥ötf
(" In£πög %zu iãms...\n", 
cou¡
);

242 
i
=0; i<
cou¡
; i++) {

243 
	`ö£π_ã°_ôem
(
båì
, 
ã°_ôem
[
i
])) {

244 1: 
°©s
.
suc˚ss
++; ;

245 0: 
°©s
.
du∂iˇã
++; ;

246 -1: 
°©s
.
bad_ôî_föd
++; ;

247 -2: 
°©s
.
bad_ôî_ö£π
++; ;

248 : 
°©s
.
Áûed
++; ;

251 
	`ok1
(
	`¥öt_°©s
("In£πed", 
cou¡
));

253 
	`s¸ambÀ
(
ã°_ôem
, 
cou¡
, (*test_item));

255 
	`¥ötf
(" Födög %zu iãms...\n", 
cou¡
);

256 
	`˛ór_°©s
();

257 
i
=0; i<
cou¡
; i++) {

258 
Ã
 = 
	`ønd32
() & 1;

260 i‡(!
	`båì_föd_Ã
(
båì
, 
ã°_ôem
[
i
], 
ôî
, 
Ã
)) {

261 
°©s
.
missög
++;

265 i‡(!
	`check_ôî
(
ôî
, 
ã°_ôem
[
i
], 
Ã
)) {

266 
°©s
.
bad_ôî_föd
++;

270 
°©s
.
suc˚ss
++;

272 
	`ok1
(
	`¥öt_°©s
("Rërõved", 
cou¡
));

274 
	`qs‹t
(
ã°_ôem
, 
cou¡
, (*ã°_ôem), 
com∑ª_ã°_ôem
);

276 
	`¥ötf
(" Tøvîsög f‹w¨dÅhrough %zu iãms...\n", 
cou¡
);

277 
	`˛ór_°©s
();

278 
i
 = 0;

279 
	`båì_begö
(
båì
, 
ôî
); 
	`båì_√xt
(iter);) {

280 i‡(
i
 >
cou¡
) {

281 
°©s
.
ex˚ss
++;

285 i‡(
ôî
->
ôem
 =
ã°_ôem
[
i
])

286 
°©s
.
suc˚ss
++;

288 
°©s
.
öc‹ª˘
++;

290 
i
++;

292 
	`ok1
(
	`¥öt_°©s
("Rërõved", 
cou¡
));

294 
	`¥ötf
(" Tøvîsög backw¨dÅhrough %zu iãms...\n", 
cou¡
);

295 
	`˛ór_°©s
();

296 
i
 = 
cou¡
;

297 
	`båì_íd
(
båì
, 
ôî
); 
	`båì_¥ev
(iter);) {

298 i‡(!
i
) {

299 
°©s
.
ex˚ss
++;

302 
i
--;

304 i‡(
ôî
->
ôem
 =
ã°_ôem
[
i
])

305 
°©s
.
suc˚ss
++;

307 
°©s
.
öc‹ª˘
++;

309 
	`ok1
(
	`¥öt_°©s
("Rërõved", 
cou¡
));

311 
	`ok1
(
båì
->
cou¡
 == count);

314 
	`s¸ambÀ
(
ã°_ôem
, 
cou¡
, (*test_item));

316 
	`¥ötf
(" Dñëög %zu iãms...\n", 
cou¡
);

317 
	`˛ór_°©s
();

318 
i
=0; i<
cou¡
; i++) {

319 
s
 = 
	`ªmove_ã°_ôem
(
båì
, 
ã°_ôem
[
i
]);

320 i‡(
s
 != 1)

321 
	`¥ötf
("remove_test_item failed\n");

322 
s
) {

323 1: 
°©s
.
suc˚ss
++; ;

324 0: 
°©s
.
missög
++; ;

325 -1: 
°©s
.
bad_ôî_föd
++; ;

326 -2: 
°©s
.
bad_ôî_ªmove
++; ;

327 : 
°©s
.
Áûed
++; ;

330 
	`ok1
(
båì
->
cou¡
 == 0);

331 
	`ok1
(
	`¥öt_°©s
("Dñëed", 
cou¡
));

332 
	`ok1
(
båì
->
roŸ
->
dïth
 =0 && båì->roŸ->
cou¡
 == 0);

334 
	`båì_dñëe
(
båì
);

337 
	`‰ì
(
ã°_ôem
);

338 
	`‰ì
(
ã°_ôem_¨øy
);

339 
	}
}

341 
	$maö
()

343 
	`∂™_ã°s
(32);

345 
	`bíchm¨k
(300000, 4, 0);

347  
	`exô_°©us
();

348 
	}
}

	@ccan/ccan/btree/test/run-random-access.c

2 
	~<cˇn/båì/båì.h
>

4 
	~<cˇn/båì/båì.c
>

5 
	~<cˇn/èp/èp.h
>

7 
	~<°döt.h
>

8 
	~<°dio.h
>

9 
	~<°dlib.h
>

10 
	~<°rög.h
>

12 
uöt32_t
 
	gønd32_°©e
 = 0;

18 
uöt32_t
 
	$ønd32
()

20 
ønd32_°©e
 *(
uöt32_t
)0x7FF8A3ED;

21 
ønd32_°©e
 +(
uöt32_t
)0x2AA01D31;

22  
ønd32_°©e
;

23 
	}
}

30 
	gmu…i
 = 0;

34 
size_t
 
	msuc˚ss
;

35 
size_t
 
	mÁûuª
;

36 } 
	mö£π
, 
	mªmove
, 
	mföd
, 
	måavî£
;

37 } 
	g°©s
;

39 
	$check_°©s
() {

41 
°©s
.
ö£π
.
Áûuª
 == 0 &&

42 
°©s
.
ªmove
.
Áûuª
 == 0 &&

43 
°©s
.
föd
.
Áûuª
 == 0 &&

44 
°©s
.
åavî£
.
Áûuª
 == 0;

45 
	}
}

47 
	$¥öt_°©s
() {

48 
	`¥ötf
("Insert: %zu succeeded, %zu failed\n",

49 
°©s
.
ö£π
.
suc˚ss
, sèts.ö£π.
Áûuª
);

51 
	`¥ötf
("Remove: %zu succeeded, %zu failed\n",

52 
°©s
.
ªmove
.
suc˚ss
, sèts.ªmove.
Áûuª
);

54 
	`¥ötf
("Find: %zu succeeded, %zu failed\n",

55 
°©s
.
föd
.
suc˚ss
, sèts.föd.
Áûuª
);

57 
	`¥ötf
("Traverse: %zu succeeded, %zu failed\n",

58 
°©s
.
åavî£
.
suc˚ss
, sèts.åavî£.
Áûuª
);

60  
	`check_°©s
();

61 
	}
}

63 
	$˛ór_°©s
()

65 
	`mem£t
(&
°©s
, 0, (stats));

66 
	}
}

68 
	$ã°_node_c⁄si°ícy
(
båì_node
 *
node
, båì_nodê*
∑ª¡
, 
size_t
 *
cou¡
)

70 
i
, 
j
, 
e
 = 
node
->
cou¡
;

73 i‡(
node
->
∑ª¡
 !=Öarent)

75 i‡(
∑ª¡
) {

76 i‡(
node
->
dïth
 !
∑ª¡
->depth - 1)

78 i‡(
node
 !
∑ª¡
->
bønch
[node->
k
])

83 i‡(
e
 == 0)

86 i‡(
node
->
dïth
) {

88 
i
=0; i<=
e
; i++) {

89 i‡(
node
->
bønch
[
i
] =
NULL
)

91 
j
=
i
+1; j<=
e
; j++)

92 i‡(
node
->
bønch
[
i
] =node->bønch[
j
])

97 
i
=0; i<=
e
; i++) {

98 i‡(!
	`ã°_node_c⁄si°ícy
(
node
->
bønch
[
i
],Çode, 
cou¡
))

103 *
cou¡
 +
node
->count;

105 
	}
}

107 
	$ã°_c⁄si°ícy
(c⁄° 
båì
 *btree)

109 
size_t
 
cou¡
 = 0;

110 i‡(!
båì
->
roŸ
)

112 i‡(
båì
->
roŸ
->
cou¡
 == 0) {

113 i‡(
båì
->
cou¡
 != 0)

117 i‡(
båì
->
cou¡
 == 0)

119 i‡(!
	`ã°_node_c⁄si°ícy
(
båì
->
roŸ
, 
NULL
, &
cou¡
))

121 i‡(
båì
->
cou¡
 != count)

124 
	}
}

126 
	$ã°_åavî£
(
båì
 *båì, 
size_t
 
key
[], size_à
cou¡
)

128 
båì_ôî©‹
 
ôî
;

129 
size_t
 
i
, 
j
;

131 i‡(!
	`ã°_c⁄si°ícy
(
båì
))

135 
i
 = 0;

136 
	`båì_begö
(
båì
, 
ôî
);

138 
i
 < 
cou¡
 && 
key
[i] == 0)

139 
i
++;

140 i‡(
i
 >
cou¡
) {

141 i‡(
	`båì_√xt
(
ôî
))

145 
j
 = 0; j < 
key
[
i
] && 
	`båì_√xt
(
ôî
); j++) {

146 i‡(
ôî
->
ôem
 !&
key
[
i
])

149 i‡(
j
 !
key
[
i
])

151 
i
++;

155 
i
 = 
cou¡
;

156 
	`båì_íd
(
båì
, 
ôî
);

158 
i
 > 0 && 
key
[i-1] == 0)

159 
i
--;

160 i‡(
i
 <= 0) {

161 i‡(
	`båì_¥ev
(
ôî
))

165 
j
 = 0; j < 
key
[
i
-1] && 
	`båì_¥ev
(
ôî
); j++) {

166 i‡(
ôî
->
ôem
 !&
key
[
i
-1])

169 i‡(
j
 !
key
[
i
-1])

171 
i
--;

175 
	}
}

181 
	$föd
(
båì
 *båì, 
size_t
 
key
[], size_à
k
)

183 
båì_ôî©‹
 
ôî
, 
tmp
;

184 
size_t
 
cou¡
;

185 
found
;

187 
	`mem£t
(
ôî
, 0, (iter));

188 
	`mem£t
(
tmp
, 0, (tmp));

190 
found
 = 
	`båì_föd_fú°
(
båì
, &
key
[
k
], 
ôî
);

191 i‡(
ôî
->
båì
 != btree)

193 i‡(
found
 !!!
key
[
k
])

195 i‡(
key
[
k
] && 
ôî
->
ôem
 != &key[k])

199 i‡(
	`båì_föd
(
båì
, &
key
[
k
], 
tmp
Ë!
found
)

201 i‡(
	`memcmp
(
ôî
, 
tmp
, (*iter)))

205 *
tmp
 = *
ôî
;

206 i‡(
	`båì_¥ev
(
tmp
)) {

207 i‡(
tmp
->
ôem
 =&
key
[
k
])

212 
cou¡
=0; 
	`båì_dîef
(
ôî
Ë&& iãr->
ôem
 =&
key
[
k
]; cou¡++, 
	`båì_√xt
(iter))

214 i‡(
cou¡
 !
key
[
k
])

218 *
tmp
 = *
ôî
;

219 i‡(
	`båì_dîef
(
tmp
)) {

220 i‡(
tmp
->
ôem
 =&
key
[
k
])

225 
	`båì_föd_œ°
(
båì
, &
key
[
k
], 
tmp
);

226 i‡(
tmp
->
båì
 != btree)

228 i‡(
	`båì_cmp_ôîs
(
ôî
, 
tmp
))

232 
cou¡
=0; 
	`båì_¥ev
(
ôî
); count++) {

233 i‡(
ôî
->
ôem
 !&
key
[
k
]) {

234 
	`båì_√xt
(
ôî
);

238 i‡(
cou¡
 !
key
[
k
])

242 
	`båì_föd_fú°
(
båì
, &
key
[
k
], 
tmp
);

243 i‡(
tmp
->
båì
 != btree)

245 i‡(
	`båì_cmp_ôîs
(
ôî
, 
tmp
))

249 
	}
}

251 
	$ã°_föd
(
båì
 *båì, 
size_t
 
key
[], size_à
cou¡
)

253 
size_t
 
k
 = 
	`ønd32
(Ë% 
cou¡
;

254  
	`föd
(
båì
, 
key
, 
k
);

255 
	}
}

257 
	$ã°_ªmove
(
båì
 *båì, 
size_t
 
key
[], size_à
cou¡
)

259 
size_t
 
¥ev_cou¡
 = 
båì
->
cou¡
;

260 
size_t
 
k
 = 
	`ønd32
(Ë% 
cou¡
;

261 
båì_ôî©‹
 
ôî
;

263 i‡(!
	`föd
(
båì
, 
key
, 
k
))

266 
	`båì_föd
(
båì
, &
key
[
k
], 
ôî
);

269 i‡(
key
[
k
]) {

270 i‡(
	`båì_ªmove_©
(
ôî
) != 1)

272 i‡(
båì
->
cou¡
 !
¥ev_cou¡
 - 1)

274 
key
[
k
]--;

276 i‡(!
	`föd
(
båì
, 
key
, 
k
))

281 
	}
}

283 
	$ã°_ö£π
(
båì
 *båì, 
size_t
 
key
[], size_à
cou¡
)

285 
size_t
 
k
 = 
	`ønd32
(Ë% 
cou¡
;

286 
båì_ôî©‹
 
ôî
;

287 
size_t
 
¥ev_cou¡
 = 
båì
->
cou¡
;

288 
found
;

290 i‡(!
	`föd
(
båì
, 
key
, 
k
))

294 
found
 = 
	`båì_föd_fú°
(
båì
, &
key
[
k
], 
ôî
);

295 i‡(
key
[
k
]) {

296 i‡(!
found
 || 
ôî
->
ôem
 !&
key
[
k
])

298 i‡(!
	`båì_dîef
(
ôî
))

300 i‡(
ôî
->
k
 >ôî->
node
->
cou¡
 || iãr->node->
ôem
[ôî->k] !&
key
[k])

303 i‡(
found
)

308 i‡(!
key
[
k
] || 
mu…i
) {

309 
	`båì_ö£π_©
(
ôî
, &
key
[
k
]);

310 
key
[
k
]++;

311 i‡(
båì
->
cou¡
 !
¥ev_cou¡
 + 1)

316 i‡(
ôî
->
ôem
 !&
key
[
k
])

319 i‡(!
	`föd
(
båì
, 
key
, 
k
))

323 
found
 = 
	`båì_föd_fú°
(
båì
, &
key
[
k
], 
ôî
);

324 i‡(!
found
 || 
ôî
->
ôem
 !&
key
[
k
])

328 
	}
}

330 
båì_£¨ch_im∂emít
(
‹dî_by_±r
, 
size_t
*, , 
a
 =
b
,á < b)

332 
	$°ªss
(
size_t
 
cou¡
, size_à
åüls
)

334 
båì
 *båì = 
	`båì_√w
(
‹dî_by_±r
);

335 
size_t
 *
key
 = 
	`ˇŒoc
(
cou¡
, (*key));

336 
size_t
 
i
;

338 
	`˛ór_°©s
();

340 
i
=0; i<
åüls
; i++) {

341 
n
 = 
	`ønd32
() % 65536;

342 
rib
 = 
båì
->
cou¡
 * 43688 / count;

344 i‡(
n
 >= 65534) {

345 i‡(
	`ã°_åavî£
(
båì
, 
key
, 
cou¡
))

346 
°©s
.
åavî£
.
suc˚ss
++;

348 
°©s
.
åavî£
.
Áûuª
++;

349 } i‡(
n
 >= 46388) {

350 i‡(
	`ã°_föd
(
båì
, 
key
, 
cou¡
))

351 
°©s
.
föd
.
suc˚ss
++;

353 
°©s
.
föd
.
Áûuª
++;

354 } i‡(
n
 < 
rib
) {

355 i‡(
	`ã°_ªmove
(
båì
, 
key
, 
cou¡
))

356 
°©s
.
ªmove
.
suc˚ss
++;

358 
°©s
.
ªmove
.
Áûuª
++;

360 i‡(
	`ã°_ö£π
(
båì
, 
key
, 
cou¡
))

361 
°©s
.
ö£π
.
suc˚ss
++;

363 
°©s
.
ö£π
.
Áûuª
++;

367 
	`‰ì
(
key
);

368 
	`båì_dñëe
(
båì
);

370 
	`¥öt_°©s
();

371 
	`ok1
(
	`check_°©s
());

372 
	}
}

374 
	$maö
()

376 
	`∂™_ã°s
(2);

378 
mu…i
 = 0;

379 
	`¥ötf
("Ru¬ög wôh mu…ò%d\n", 
mu…i
);

380 
	`°ªss
(100000, 500000);

382 
mu…i
 = 1;

383 
	`¥ötf
("Ru¬ög wôh mu…ò%d\n", 
mu…i
);

384 
	`°ªss
(100000, 500000);

386  
	`exô_°©us
();

387 
	}
}

	@ccan/ccan/btree/test/run-search-implement.c

2 
	~<cˇn/båì/båì.h
>

4 
	~<cˇn/båì/båì.c
>

5 
	~<cˇn/èp/èp.h
>

7 
	~<°rög.h
>

9 #i‚de‡
ARRAY_SIZE


10 
	#ARRAY_SIZE
(
¨øy
Ë(◊ºayË/ (*◊ºay)))

	)

13 
	sfoo
 {

14 c⁄° *
	m°rög
;

15 
	mnumbî
;

18 
foo
 
	gfoo_°ru˘s
[] = {

26 
foo
 *
	gfoo_ba£
[
ARRAY_SIZE
(
foo_°ru˘s
)];

27 c⁄° 
	gfoo_cou¡
 = 
ARRAY_SIZE
(
foo_°ru˘s
);

29 
	$öô_foo_poöãrs
()

31 
i
;

33 
i
 = 0; i < 
foo_cou¡
; i++)

34 
foo_ba£
[
i
] = &
foo_°ru˘s
[i];

35 
	}
}

38 
båì_£¨ch_¥Ÿo
 
	g‹dî_by_°rög
, 
	g‹dî_by_numbî
;

40 
	$ã°_‹dî_by_°rög
()

43 c⁄° *
key
;

44 
Ã
;

45 
ex≥˘_off£t
;

46 
ex≥˘_found
;

47 } 
ã°
[] = {

60 
size_t
 
i
;

61 
i
=0; i<
	`ARRAY_SIZE
(
ã°
); i++) {

62 
foo
 foÿ{
ã°
[
i
].
key
, 0};

63 
off£t
;

64 
found
 = 0;

66 
off£t
 = 
	`‹dî_by_°rög
(&
foo
, (*)
foo_ba£
, 
foo_cou¡
,

67 
ã°
[
i
].
Ã
, &
found
);

69 
	`ok1
(
off£t
 =
ã°
[
i
].
ex≥˘_off£t
 && 
found
 =ã°[i].
ex≥˘_found
);

71 
	}
}

73 
	$ã°_em±y
()

75 
off£t
;

76 
found
;

77 
foo
 
key
 = {"apple", -1};

79 
off£t
 = 
	`‹dî_by_°rög
(&
key
, 
NULL
, 0, 0, &
found
);

80 
	`ok1
(
off£t
 == 0);

82 
off£t
 = 
	`‹dî_by_°rög
(&
key
, 
NULL
, 0, 1, &
found
);

83 
	`ok1
(
off£t
 == 0);

85 
off£t
 = 
	`‹dî_by_numbî
(&
key
, 
NULL
, 0, 0, &
found
);

86 
	`ok1
(
off£t
 == 0);

88 
off£t
 = 
	`‹dî_by_numbî
(&
key
, 
NULL
, 0, 1, &
found
);

89 
	`ok1
(
off£t
 == 0);

90 
	}
}

92 
	$ã°_‹dî_by_numbî
()

95 
key
;

96 
Ã
;

97 
ex≥˘_off£t
;

98 
ex≥˘_found
;

99 } 
ã°
[] = {

122 
size_t
 
i
;

123 
i
=0; i<
	`ARRAY_SIZE
(
ã°
); i++) {

124 
foo
 foÿ{"", 
ã°
[
i
].
key
};

125 
off£t
;

126 
found
 = 0;

128 
off£t
 = 
	`‹dî_by_numbî
(&
foo
, (*)
foo_ba£
, 
foo_cou¡
,

129 
ã°
[
i
].
Ã
, &
found
);

131 
	`ok1
(
off£t
 =
ã°
[
i
].
ex≥˘_off£t
 && 
found
 =ã°[i].
ex≥˘_found
);

133 
	}
}

135 
	$maö
()

137 
	`∂™_ã°s
(34);

138 
	`öô_foo_poöãrs
();

140 
	`ã°_‹dî_by_°rög
();

141 
	`ã°_‹dî_by_numbî
();

142 
	`ã°_em±y
();

144  
	`exô_°©us
();

145 
	}
}

147 
båì_£¨ch_im∂emít
 (

148 
‹dî_by_°rög
,

149 c⁄° 
foo
 *,

150 
c
 = 
°rcmp
(
a
->
°rög
, 
b
->string),

151 
c
 == 0,

152 
c
 < 0

155 
båì_£¨ch_im∂emít
 (

156 
‹dî_by_numbî
,

157 c⁄° 
foo
 *,

159 
a
->
numbî
 =
b
->number,

160 
a
->
numbî
 < 
b
->number

	@ccan/ccan/btree/test/run-trivial.c

2 
	~<cˇn/båì/båì.h
>

4 
	~<cˇn/båì/båì.c
>

5 
	~<cˇn/èp/èp.h
>

7 
	~<°rög.h
>

9 
	sã°_ôem
 {

10 
	mkey
;

11 
	mvÆue
;

14 
båì_£¨ch_im∂emít
(

15 
‹dî_by_key
,

16 
ã°_ôem
 *,

18 
a
->
key
 =
b
->key,

19 
a
->
key
 < 
b
->key

22 
	$ö£π_ã°_ôem
(
båì
 *båì, 
key
, 
vÆue
)

24 
ã°_ôem
 
key_ôem
 = {
key
, -101};

25 
ã°_ôem
 *
ôem
;

26 
båì_ôî©‹
 
ôî
;

28 i‡(
	`båì_föd_fú°
(
båì
, &
key_ôem
, 
ôî
)) {

30 
ôem
 = 
ôî
->item;

31 
ôem
->
vÆue
 = value;

35 
ôem
 = 
	`mÆloc
((*item));

36 
ôem
->
key
 = key;

37 
ôem
->
vÆue
 = value;

39 
	`båì_ö£π_©
(
ôî
, 
ôem
);

42 
	}
}

44 
	$lookup_ã°_ôem
(c⁄° 
båì
 *båì, 
key
)

46 
ã°_ôem
 
key_ôem
 = {
key
, -102};

47 
ã°_ôem
 *
ôem
;

48 
båì_ôî©‹
 
ôî
;

50 i‡(!
	`båì_föd_fú°
(
båì
, &
key_ôem
, 
ôî
))

53 
ôem
 = 
ôî
->item;

54  
ôem
->
vÆue
;

55 
	}
}

57 
	$de°roy_ã°_ôem
(*
ôem
, *
˘x
) {

58 (Ë
˘x
;

59 
	`‰ì
(
ôem
);

61 
	}
}

63 
	sã°_ö£π_íåy
 {

64 
	mkey
;

65 
	mvÆue
;

66 
	mex≥˘ed_ªtu∫
;

69 
	sã°_åavî£_íåy
 {

70 
	mkey
;

71 
	mvÆue
;

74 
	$¥öt_ödít
(
ödít
) {

75 
ödít
--)

76 
	`Âuts
("\t", 
°dout
);

77 
	}
}

79 
	$båì_node_åa˚
(
båì_node
 *
node
, 
ödít
)

81 
i
;

82 
i
=0; i<
node
->
cou¡
; i++) {

83 i‡(
node
->
dïth
)

84 
	`båì_node_åa˚
(
node
->
bønch
[
i
], 
ödít
+1);

85 
	`¥öt_ödít
(
ödít
);

86 
	`puts
(
node
->
ôem
[
i
]);

88 i‡(
node
->
dïth
)

89 
	`båì_node_åa˚
(
node
->
bønch
[node->
cou¡
], 
ödít
+1);

90 
	}
}

92 
	$båì_åa˚
(
båì
 *btree)

94 
	`båì_node_åa˚
(
båì
->
roŸ
, 0);

95 
	}
}

97 
	$ã°_ö£π
(
båì
 *btree)

99 
ã°_ö£π_íåy
 
ít
[] = {

107 
size_t
 
i
, 
cou¡
 = (
ít
) / (*ent);

109 
i
 = 0; i < 
cou¡
; i++) {

110 
ªt
 = 
	`ö£π_ã°_ôem
(
båì
, 
ít
[
i
].
key
,É¡[i].
vÆue
);

111 
	`ok1
(
ªt
 =
ít
[
i
].
ex≥˘ed_ªtu∫
);

113 
	}
}

115 
	$ã°_föd_åavî£
(
båì
 *btree)

117 
ã°_åavî£_íåy
 
ít
[] = {

121 
size_t
 
i
, 
cou¡
 = (
ít
) / (*ent);

122 
båì_ôî©‹
 
ôî
;

124 
i
 = 0;

125 
	`båì_begö
(
båì
, 
ôî
); 
	`båì_√xt
(iter);) {

126 
ã°_ôem
 *
ôem
 = 
ôî
->item;

128 i‡(
i
 >
cou¡
) {

129 
	`Áû
("Too many items in btreeáccordingÅo forwardÅraversal");

133 
	`ok1
(
	`lookup_ã°_ôem
(
båì
, 
ôem
->
key
Ë=ôem->
vÆue
);

134 
	`ok1
(
ôem
->
key
 =
ít
[
i
].key && iãm->
vÆue
 ==Ént[i].value);

136 
i
++;

139 i‡(
i
 !
cou¡
)

140 
	`Áû
("NotÉnough items in btreeáccordingÅo forwardÅraversal");

142 
i
 = 
cou¡
;

143 
	`båì_íd
(
båì
, 
ôî
); 
	`båì_¥ev
(iter);) {

144 
ã°_ôem
 *
ôem
 = 
ôî
->item;

146 i‡(!
i
--) {

147 
	`Áû
("Too many items in btreeáccordingÅo backwardÅraversal");

151 
	`ok1
(
	`lookup_ã°_ôem
(
båì
, 
ôem
->
key
Ë=ôem->
vÆue
);

152 
	`ok1
(
ôem
->
key
 =
ít
[
i
].key && iãm->
vÆue
 ==Ént[i].value);

155 i‡(
i
 != 0)

156 
	`Áû
("NotÉnough items in btreeáccordingÅo backwardÅraversal");

157 
	}
}

159 
båì_£¨ch_¥Ÿo
 
	g‹dî_by_°rög
;

161 
båì_£¨ch_im∂emít
(

162 
‹dî_by_°rög
,

164 
c
 = 
°rcmp
(
a
, 
b
),

165 
c
 == 0,

166 
c
 < 0

170 
	$com∑ª_by_°rög
(c⁄° *
≠
, c⁄° *
bp
)

172 c⁄° * c⁄° *
a
 = 
≠
;

173 c⁄° * c⁄° *
b
 = 
bp
;

174  
	`°rcmp
(*
a
, *
b
);

175 
	}
}

177 
	$ã°_åavî£
(
båì
 *båì, c⁄° *
s‹ãd
[], 
size_t
 
cou¡
)

179 
båì_ôî©‹
 
ôî
, 
ôî2
;

180 
size_t
 
i
;

182 
i
 = 0;

183 
	`båì_begö
(
båì
, 
ôî
); 
	`båì_√xt
(iter);) {

184 i‡(
i
 >
cou¡
) {

185 
	`Áû
("Too many items in btreeáccordingÅo forwardÅraversal");

189 
	`ok1
(
ôî
->
ôem
 =
s‹ãd
[
i
]);

191 
	`båì_föd_fú°
(
båì
, 
s‹ãd
[
i
], 
ôî2
);

192 
	`ok1
(
ôî2
->
ôem
 =
s‹ãd
[
i
]);

194 
i
++;

197 i‡(
i
 !
cou¡
)

198 
	`Áû
("NotÉnough items in btreeáccordingÅo forwardÅraversal");

200 
i
 = 
cou¡
;

201 
	`båì_íd
(
båì
, 
ôî
); 
	`båì_¥ev
(iter);) {

202 i‡(!
i
--) {

203 
	`Áû
("Too many items in btreeáccordingÅo backwardÅraversal");

207 
	`ok1
(
ôî
->
ôem
 =
s‹ãd
[
i
]);

209 
	`båì_föd_fú°
(
båì
, 
s‹ãd
[
i
], 
ôî2
);

210 
	`ok1
(
ôî2
->
ôem
 =
s‹ãd
[
i
]);

213 i‡(
i
 != 0)

214 
	`Áû
("NotÉnough items in btreeáccordingÅo backwardÅraversal");

215 
	}
}

222 
	$ã°_ªmove
(
båì
 *båì, 
båì_ôem
 
ôems
[], 
size_t
 *
cou¡
, c⁄° *
key
)

224 
size_t
 
i
;

226 
i
 = *
cou¡
; i--;) {

227 i‡(!
	`°rcmp
(
ôems
[
i
].
key
, key)) {

229 
	`memmove
(&
ôems
[
i
], &ôems[i+1], (*
cou¡
-(i+1))*(*items));

230 (*
cou¡
)--;

237  
	`båì_ªmove
(
båì
, 
key
) && !btree_remove(btree, key);

243  !
	`båì_ªmove
(
båì
, 
key
) && !btree_remove(btree, key);

244 
	}
}

247 
	$ã°_£¨ch_im∂emít
()

249 
båì
 *båì = 
	`båì_√w
(
‹dî_by_°rög
);

250 
size_t
 
i
;

252 c⁄° *
uns‹ãd
[] = {

292 
size_t
 
cou¡
 = (
uns‹ãd
) / (*unsorted);

293 c⁄° *
s‹ãd
[
cou¡
];

295 
	`mem˝y
(
s‹ãd
, 
uns‹ãd
, (sorted));

296 
	`qs‹t
(
s‹ãd
, 
cou¡
, (*s‹ãd), 
com∑ª_by_°rög
);

298 
i
=0; i<
cou¡
; i++) {

299 
båì_ôî©‹
 
ôî
;

301 i‡(
	`båì_föd_fú°
(
båì
, 
uns‹ãd
[
i
], 
ôî
))

302 
	`Áû
("btree_insertÅhinksÅheÅestárray has duplicates, but it doesn't");

304 
	`båì_ö£π_©
(
ôî
, 
uns‹ãd
[
i
]);

306 
	`båì_åa˚
(
båì
);

308 
	`ã°_åavî£
(
båì
, 
s‹ãd
, 
cou¡
);

339 
	`båì_dñëe
(
båì
);

340 
	}
}

342 
	$maö
()

344 
båì
 *btree;

346 
	`∂™_ã°s
(224);

348 
båì
 = 
	`båì_√w
(
‹dî_by_key
);

349 
båì
->
de°roy
 = 
de°roy_ã°_ôem
;

350 
	`ã°_ö£π
(
båì
);

351 
	`ã°_föd_åavî£
(
båì
);

352 
	`båì_dñëe
(
båì
);

354 
	`ã°_£¨ch_im∂emít
();

356  
	`exô_°©us
();

357 
	}
}

	@ccan/ccan/build_assert/build_assert.h

2 #i‚de‡
CCAN_BUILD_ASSERT_H


3 
	#CCAN_BUILD_ASSERT_H


	)

22 
	#BUILD_ASSERT
(
c⁄d
) \

23 dÿ{ (Ë([1 - 2*!(
c⁄d
)]); } 0)

	)

37 
	#BUILD_ASSERT_OR_ZERO
(
c⁄d
) \

38 (([1 - 2*!(
c⁄d
)]Ë- 1)

	)

	@ccan/ccan/build_assert/test/compile_fail-expr.c

1 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

3 
	$maö
(
¨gc
, *
¨gv
[])

5 #ifde‡
FAIL


6  
	`BUILD_ASSERT_OR_ZERO
(1 == 0);

10 
	}
}

	@ccan/ccan/build_assert/test/compile_fail.c

1 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

3 
	$maö
(
¨gc
, *
¨gv
[])

5 #ifde‡
FAIL


6 
	`BUILD_ASSERT
(1 == 0);

9 
	}
}

	@ccan/ccan/build_assert/test/compile_ok.c

1 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

3 
	$maö
(
¨gc
, *
¨gv
[])

5 
	`BUILD_ASSERT
(1 == 1);

7 
	}
}

	@ccan/ccan/build_assert/test/run-BUILD_ASSERT_OR_ZERO.c

1 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 
	`∂™_ã°s
(1);

7 
	`ok1
(
	`BUILD_ASSERT_OR_ZERO
(1 == 1) == 0);

8  
	`exô_°©us
();

9 
	}
}

	@ccan/ccan/bytestring/bytestring.h

2 #i‚de‡
CCAN_BYTESTRING_H_


3 
	#CCAN_BYTESTRING_H_


	)

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

7 
	~<°dboﬁ.h
>

9 
	~<cˇn/¨øy_size/¨øy_size.h
>

11 
	sbyã°rög
 {

12 c⁄° *
	m±r
;

13 
size_t
 
	mÀn
;

28 
ölöe
 
byã°rög
 
	$byã°rög
(c⁄° *
p
, 
size_t
 
l
)

30 
byã°rög
 
bs
 = {

31 .
±r
 = 
p
,

32 .
Àn
 = 
l
,

35  
bs
;

36 
	}
}

38 
	#byã°rög_NULL
 
	`byã°rög
(
NULL
, 0)

	)

50 
	#BYTESTRING
(
s
Ë(
	`byã°rög
((s), 
	`ARRAY_SIZE
(sË- 1))

	)

63 
ölöe
 
byã°rög
 
	$byã°rög_‰om_°rög
(c⁄° *
s
)

65 i‡(!
s
)

66  
byã°rög_NULL
;

67  
	`byã°rög
(
s
, 
	`°æí
(s));

68 
	}
}

77 
ölöe
 
boﬁ
 
	$byã°rög_eq
(
byã°rög
 
a
, byã°rög 
b
)

79  (
a
.
Àn
 =
b
.len)

80 && (
	`memcmp
(
a
.
±r
, 
b
.±r,á.
Àn
) == 0);

81 
	}
}

	@ccan/ccan/bytestring/test/compile_fail-BYTESTRING-2.c

1 
	~<°dio.h
>

3 
	~<cˇn/byã°rög/byã°rög.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 
byã°rög
 
bs
;

8 c⁄° *
x
 = "abcde";

10 #ifde‡
FAIL


11 
bs
 = 
	`BYTESTRING
(
x
);

13 
	`¥ötf
("%zd %s\n", 
bs
.
Àn
, 
x
);

15 
	}
}

	@ccan/ccan/bytestring/test/compile_fail-BYTESTRING.c

1 
	~<°dio.h
>

3 
	~<cˇn/byã°rög/byã°rög.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 
byã°rög
 
bs
;

9 
bs
 = 
	`BYTESTRING
(

10 #ifde‡
FAIL


11 
¨gv
[0]

16 
	`¥ötf
("%zd\n", 
bs
.
Àn
);

18 
	}
}

	@ccan/ccan/bytestring/test/run.c

1 
	~<cˇn/byã°rög/byã°rög.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	#TEST_STRING
 "ã° såög"

	)

5 
	#TEST_STRING_2
 "abc\0def"

	)

7 c⁄° 
	g°r1
[] = 
TEST_STRING
;

8 c⁄° *
	g°r2
 = 
TEST_STRING
;

10 
	$maö
()

12 
byã°rög
 
bs
, 
bs1
, 
bs2
, 
bs3
, 
bs4
, 
bs5
;

15 
	`∂™_ã°s
(9);

17 
bs
 = 
	`byã°rög
(
°r1
, (str1) - 1);

18 
	`ok1
(
bs
.
±r
 =
°r1
);

19 
	`ok1
(
bs
.
Àn
 =((
°r1
) - 1));

21 
bs1
 = 
	`BYTESTRING
(
TEST_STRING
);

22 
	`ok1
(
	`byã°rög_eq
(
bs
, 
bs1
));

24 
bs2
 = 
	`BYTESTRING
(
TEST_STRING_2
);

25 
	`ok1
(
bs2
.
Àn
 == 7);

27 
bs3
 = 
	`byã°rög_‰om_°rög
(
°r2
);

28 
	`ok1
(
	`byã°rög_eq
(
bs3
, 
bs
));

30 
bs4
 = 
	`byã°rög_‰om_°rög
(
TEST_STRING_2
);

31 
	`ok1
(
bs4
.
Àn
 == 3);

33 
bs5
 = 
	`byã°rög_‰om_°rög
(
NULL
);

34 
	`ok1
(
bs5
.
Àn
 == 0);

35 
	`ok1
(
bs5
.
±r
 =
NULL
);

36 
	`ok1
(
	`byã°rög_eq
(
bs5
, 
byã°rög_NULL
));

39  
	`exô_°©us
();

40 
	}
}

	@ccan/ccan/cast/cast.h

2 #i‚de‡
CCAN_CAST_H


3 
	#CCAN_CAST_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°döt.h
>

6 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

17 
	#ˇ°_sig√d
(
ty≥
, 
ex¥
) \

18 (0 ? 
	`BUILD_ASSERT_OR_ZERO
(
	`ˇ°_sign_com∑tibÀ
(
ty≥
, (
ex¥
))) : \

19 (
ty≥
)(
ex¥
))

	)

46 
	#ˇ°_c⁄°
(
ty≥
, 
ex¥
) \

47 (0 ? 
	`BUILD_ASSERT_OR_ZERO
(
	`ˇ°_c⁄°_com∑t1
((
ex¥
), 
ty≥
)) : \

48 (
ty≥
)(
öçå_t
)(
ex¥
))

	)

58 
	#ˇ°_c⁄°2
(
ty≥
, 
ex¥
) \

59 (0 ? 
	`BUILD_ASSERT_OR_ZERO
(
	`ˇ°_c⁄°_com∑t2
((
ex¥
), 
ty≥
)) : \

60 (
ty≥
)(
öçå_t
)(
ex¥
))

	)

70 
	#ˇ°_c⁄°3
(
ty≥
, 
ex¥
) \

71 (0 ? 
	`BUILD_ASSERT_OR_ZERO
(
	`ˇ°_c⁄°_com∑t3
((
ex¥
), 
ty≥
)) : \

72 (
ty≥
)(
öçå_t
)(
ex¥
))

	)

84 #i‡
HAVE_COMPOUND_LITERALS


85 
	#ˇ°_°©ic
(
ty≥
, 
ex¥
) \

86 ((°ru˘ { 
ty≥
 
x
; }){(
ex¥
)}.x)

	)

88 
	#ˇ°_°©ic
(
ty≥
, 
ex¥
) \

89 ((
ty≥
)(
ex¥
))

	)

93 #i‡
HAVE_BUILTIN_CHOOSE_EXPR
 && 
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 && 
HAVE_TYPEOF


94 
	#ˇ°_sign_com∑tibÀ
(
t
, 
e
) \

95 
	`__buûtö_choo£_ex¥
( \

96 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
t
), *) || \

97 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
t
), signed *) || \

98 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
t
), *), \

100 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), *) || \

101 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), signed *) || \

102 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), *), \

104 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), const *) || \

105 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), const signed *) || \

106 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), const *) ||\

107 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), *) || \

108 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), signed *) || \

109 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
e
), *) \

110 )

	)

112 
	#ˇ°_c⁄°_°rù1
(
ex¥
) \

113 
	`__ty≥of__
(*(uni⁄ { 
z
; __ty≥of__(
ex¥
Ë
x
; }){0}.x)

	)

114 
	#ˇ°_c⁄°_°rù2
(
ex¥
) \

115 
	`__ty≥of__
(**(uni⁄ { 
z
; __ty≥of__(
ex¥
Ë
x
; }){0}.x)

	)

116 
	#ˇ°_c⁄°_°rù3
(
ex¥
) \

117 
	`__ty≥of__
(***(uni⁄ { 
z
; __ty≥of__(
ex¥
Ë
x
; }){0}.x)

	)

118 
	#ˇ°_c⁄°_com∑t1
(
ex¥
, 
ty≥
) \

119 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`ˇ°_c⁄°_°rù1
(
ex¥
), \

120 
	`ˇ°_c⁄°_°rù1
(
ty≥
))

	)

121 
	#ˇ°_c⁄°_com∑t2
(
ex¥
, 
ty≥
) \

122 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`ˇ°_c⁄°_°rù2
(
ex¥
), \

123 
	`ˇ°_c⁄°_°rù2
(
ty≥
))

	)

124 
	#ˇ°_c⁄°_com∑t3
(
ex¥
, 
ty≥
) \

125 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`ˇ°_c⁄°_°rù3
(
ex¥
), \

126 
	`ˇ°_c⁄°_°rù3
(
ty≥
))

	)

128 
	#ˇ°_sign_com∑tibÀ
(
ty≥
, 
ex¥
) \

129 ((*(
ty≥
)0Ë=1 && (*(
ex¥
)Ë=1)

	)

130 
	#ˇ°_c⁄°_com∑t1
(
ex¥
, 
ty≥
Ë(1)

	)

131 
	#ˇ°_c⁄°_com∑t2
(
ex¥
, 
ty≥
Ë(1)

	)

132 
	#ˇ°_c⁄°_com∑t3
(
ex¥
, 
ty≥
Ë(1)

	)

	@ccan/ccan/cast/test/compile_fail-cast_const.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

5 
	sch¨_°ru˘
 {

6 
	mc
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 *
uc
;

13 #ifde‡
FAIL


14 
ch¨_°ru˘


18 *
p
 = 
NULL
;

20 
uc
 = 
	`ˇ°_c⁄°
(*, 
p
);

21 (Ë
uc
;

23 
	}
}

25 #ifde‡
FAIL


26 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


	@ccan/ccan/cast/test/compile_fail-cast_const2.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

5 
	sch¨_°ru˘
 {

6 
	mc
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 **
uc
;

13 #ifde‡
FAIL


14 
ch¨_°ru˘


18 **
p
 = 
NULL
;

20 
uc
 = 
	`ˇ°_c⁄°2
(**, 
p
);

21 (Ë
uc
;

23 
	}
}

25 #ifde‡
FAIL


26 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


	@ccan/ccan/cast/test/compile_fail-cast_const3.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

5 
	sch¨_°ru˘
 {

6 
	mc
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 ***
uc
;

13 #ifde‡
FAIL


14 
ch¨_°ru˘


18 ***
p
 = 
NULL
;

20 
uc
 = 
	`ˇ°_c⁄°3
(***, 
p
);

21 (Ë
uc
;

23 
	}
}

25 #ifde‡
FAIL


26 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


	@ccan/ccan/cast/test/compile_fail-cast_signed-const.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 *
uc
;

7 #ifde‡
FAIL


11 *
p
 = 
NULL
;

13 
uc
 = 
	`ˇ°_sig√d
(*, 
p
);

14 (Ë
uc
;

16 
	}
}

18 #ifde‡
FAIL


19 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


	@ccan/ccan/cast/test/compile_fail-cast_signed-sizesame.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

5 
	sch¨_°ru˘
 {

6 
	mc
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 *
uc
;

12 #ifde‡
FAIL


13 
ch¨_°ru˘


17 *
p
 = 
NULL
;

19 
uc
 = 
	`ˇ°_sig√d
(*, 
p
);

21 (Ë
uc
;

23 
	}
}

25 #ifde‡
FAIL


26 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


	@ccan/ccan/cast/test/compile_fail-cast_signed.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 *
uc
;

7 #ifde‡
FAIL


12 *
p
 = 
NULL
;

14 
uc
 = 
	`ˇ°_sig√d
(*, 
p
);

15 (Ë
uc
;

17 
	}
}

	@ccan/ccan/cast/test/compile_fail-cast_static-2.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 *
c
;

7 #ifde‡
FAIL


12 *
p
 = 0;

14 
c
 = 
	`ˇ°_°©ic
(*, 
p
);

15 (Ë
c
;

17 
	}
}

19 #ifde‡
FAIL


20 #i‡!
HAVE_COMPOUND_LITERALS


	@ccan/ccan/cast/test/compile_fail-cast_static-3.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 *
c
;

7 #ifde‡
FAIL


10 *
p
 = 0;

12 
c
 = 
	`ˇ°_°©ic
(*, 
p
);

13 (Ë
c
;

15 
	}
}

17 #ifde‡
FAIL


18 #i‡!
HAVE_COMPOUND_LITERALS


	@ccan/ccan/cast/test/compile_fail-cast_static.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

2 
	~<°dlib.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 
c
;

7 #ifde‡
FAIL


12 
x
 = 0;

14 
c
 = 
	`ˇ°_°©ic
(, 
x
);

15 (Ë
c
;

17 
	}
}

19 #ifde‡
FAIL


20 #i‡!
HAVE_COMPOUND_LITERALS


	@ccan/ccan/cast/test/compile_ok-cast_void.c

1 
	~<cˇn/ˇ°/ˇ°.h
>

3 *
	$ªmove_void
(c⁄° *
p
)

5  
	`ˇ°_c⁄°
(*, 
p
);

6 
	}
}

8 
	$maö
()

10 *
p
 = 
	`ªmove_void
("foo");

11  !
p
;

12 
	}
}

	@ccan/ccan/cast/test/compile_ok-static.c

3 
	~<cˇn/ˇ°/ˇ°.h
>

5 *
	gp
 = 
ˇ°_c⁄°
(*, (const *)"hello");

7 
	$maö
(
¨gc
, *
¨gv
[])

9  
p
[0] =
¨gv
[0][0];

10 
	}
}

	@ccan/ccan/ccan_tokenizer/ccan_tokenizer.c

28 
	~"cˇn_tokíizî.h
"

30 
	~<cˇn/èŒoc/èŒoc.h
>

32 
	~<as£π.h
>

37 
di˘_íåy
 
	gc_di˘i⁄¨y
[] = {

43 {
PTR_OP
,"->"},

47 {
INC_OP
,"++"}, {
DEC_OP
,"--"},

58 {
LEFT_OP
,"<<"}, {
RIGHT_OP
,">>"},

62 {
LE_OP
,"<="}, {
GE_OP
,">="},

65 {
EQ_OP
,"=="}, {
NE_OP
,"!="},

75 {
AND_OP
,"&&"},

77 {
OR_OP
,"||"},

84 {
MUL_ASSIGN
,"*="}, {
DIV_ASSIGN
,"/="}, {
MOD_ASSIGN
,"%="},

85 {
ADD_ASSIGN
,"+="}, {
SUB_ASSIGN
,"-="},

86 {
AND_ASSIGN
,"&="}, {
XOR_ASSIGN
,"^="}, {
OR_ASSIGN
,"|="},

87 {
LEFT_ASSIGN
,"<<="}, {
RIGHT_ASSIGN
,">>="},

96 {
ELLIPSIS
,"..."},

98 {
DOUBLE_POUND
,"##"},

106 {
_BOOL
, "_Bool"},

107 {
_COMPLEX
, "_Complex"},

108 {
_IMAGINARY
, "_Imaginary"},

109 {
BREAK
, "break"},

110 {
CASE
, "case"},

111 {
CHAR
, "char"},

112 {
CONST
, "const"},

113 {
CONTINUE
, "continue"},

114 {
DEFAULT
, "default"},

115 {
DO
, "do"},

116 {
DOUBLE
, "double"},

117 {
ELSE
, "else"},

118 {
ENUM
, "enum"},

119 {
EXTERN
, "extern"},

120 {
FLOAT
, "float"},

121 {
FOR
, "for"},

122 {
GOTO
, "goto"},

123 {
IF
, "if"},

124 {
INLINE
, "inline"},

125 {
INT
, "int"},

126 {
LONG
, "long"},

127 {
REGISTER
, "register"},

128 {
RESTRICT
, "restrict"},

129 {
RETURN
, "return"},

130 {
SHORT
, "short"},

131 {
SIGNED
, "signed"},

132 {
SIZEOF
, "sizeof"},

133 {
STATIC
, "static"},

134 {
STRUCT
, "struct"},

135 {
SWITCH
, "switch"},

136 {
TYPEDEF
, "typedef"},

137 {
UNION
, "union"},

138 {
UNSIGNED
, "unsigned"},

139 {
VOID
, "void"},

140 {
VOLATILE
, "volatile"},

141 {
WHILE
, "while"},

144 {
VA_ARGS
, "__VA_ARGS__"},

145 {
DEFINE
, "define"},

146 {
ELIF
, "elif"},

148 {
ENDIF
, "endif"},

149 {
ERROR
, "error"},

151 {
IFDEF
, "ifdef"},

152 {
IFNDEF
, "ifndef"},

153 {
INCLUDE
, "include"},

154 {
LINE
, "line"},

155 {
PRAGMA
, "pragma"},

156 {
UNDEF
, "undef"},

157 {
WARNING
, "warning"},

162 
tokíizî
 *
	$tokíizî_√w
(*
˘x
) {

163 
tokíizî
 *
t
 = 
	`èŒoc
(
˘x
, tokenizer);

164 
t
->
˘x
 = ctx;

165 
	`queue_öô
(
t
->
mq
,Å);

166 
t
->
di˘
 = 
	`di˘_buûd
—, 
c_di˘i⁄¨y
, (c_dictionary)/(*c_dictionary));

168  
t
;

169 
	}
}

173 
èŒoc_d¨øy_de°ru˘‹
(*
±r
);

181 *
	$èŒoc_d¨øy
(c⁄° *
c⁄ãxt
)

183 *
ªt
 = 
	`èŒoc
(
c⁄ãxt
, 
	`d¨øy
());

184 
	`d¨øy_öô
(*(
	`d¨øy
()*)
ªt
);

185 
	`èŒoc_£t_de°ru˘‹
(
ªt
, 
èŒoc_d¨øy_de°ru˘‹
);

186  
ªt
;

187 
	}
}

189 
	$èŒoc_d¨øy_de°ru˘‹
(*
±r
)

191 
	`d¨øy
(Ë*
¨r
 = 
±r
;

192 
	`‰ì
(
¨r
->
ôem
);

194 
	}
}

196 
	#MESSAGE_PATH
 "tokíize/"

	)

198 
	$unbªak_back¶ash_brokí_löes
(
tokí_li°
 *
é
, 
tok_mesßge_queue
 *
mq
) {

199 c⁄° *
s
 = 
é
->
‹ig
, *
e
 = s+é->
‹ig_size
;

200 
d¨øy_ch¨
 *
txt
 = 
	`èŒoc_d¨øy
(
é
);

201 
	`d¨øy
(c⁄° *Ë*
ﬁöes
 = 
	`èŒoc_d¨øy
(
é
);

202 
	`d¨øy
(c⁄° *Ë*
éöes
 = 
	`èŒoc_d¨øy
(
é
);

205 c⁄° *
löe_°¨t
 = 
s
, *
löe_íd
;

206 c⁄° *
 w
;

207 
size_t
 
°¨t_off£t
 = 
txt
->
size
;

210 
s
<
e
 && !
	`¸ëu∫
(*s)) s++;

211 
löe_íd
 = 
s
;

212 
 w
 = 
s
;

213 
 w
>
löe_°¨t
 && 
	`c•a˚
(lnw[-1]))Ünw--;

214 i‡(
s
<
e
 && 
	`¸ëu∫
(*s)) {

215 
s
++;

217 i‡(
s
<
e
 && *s=='\n'+'\r'-s[-1])

218 
s
++;

222 i‡(
 w
>
löe_°¨t
 &&Ünw[-1]=='\\' && 
löe_íd
<
e
) {

223 
	`d¨øy_≠≥nd_ôems
(*
txt
, 
löe_°¨t
, 
 w
-1-line_start);

224 i‡(
 w
<
e
 && 
	`c•a˚
(*lnw)) {

225 
	`tok_msg_w¨n
(
•a˚s_a·î_back¶ash_bªak
, 
 w
,

229 
	`d¨øy_≠≥nd_ôems
(*
txt
, 
löe_°¨t
, 
s
-line_start);

232 
	`d¨øy_≠≥nd
(*
ﬁöes
, 
löe_°¨t
);

233 
	`d¨øy_≠≥nd
(*
éöes
, (c⁄° *)
°¨t_off£t
);

237 } 
s
<
e
);

240 
	`d¨øy_ªÆloc
(*
txt
,Åxt->
size
+1);

241 
txt
->
ôem
[txt->
size
] = 0;

245 c⁄° **
i
;

246 
	`d¨øy_f‹óch
(
i
, *
éöes
)

247 *
i
 = 
txt
->
ôem
 + (
size_t
)(*i);

250 
é
->
ﬁöes
 = olöes->
ôem
;

251 
é
->
ﬁöes_size
 = 
ﬁöes
->
size
;

252 
é
->
txt
 =Åxt->
ôem
;

253 
é
->
txt_size
 = 
txt
->
size
;

254 
é
->
éöes
 =Ålöes->
ôem
;

255 
é
->
éöes_size
 = 
éöes
->
size
;

256 
	}
}

258 
	$n‹mÆ_keyw‹d
(
tokí
 *
tok
) {

259 i‡(
tok
->
ty≥
==
TOK_KEYWORD
 &&

260 (
	`›kw_is_dúe˘ive_⁄ly
(
tok
->
›kw
Ë||Åok->›kw==
VA_ARGS
))

261 
tok
->
ty≥
 = 
TOK_IDENTIFIER
;

262 
	}
}

264 
	$deföe_∑rmli°_has_ñlùsis
(
tokí
 *
°¨t
, tokí *
íd
) {

265 
íd
>
°¨t
 && 
	`tokí_is_ign‹ed
(end-1))Énd--;

266  (
íd
-->
°¨t
 &&Énd->
ty≥
==
TOK_OPERATOR
 &&Énd->
›kw
==
ELLIPSIS
);

267 
	}
}

271 
	$this_is_a_deföe
(
tokí
 *
°¨t
, tokí *
íd
) {

272 
tokí
 *
i
 = 
°¨t
, *
∂_°¨t
;

275 
i
<
íd
 && 
	`tokí_is_ign‹ed
(i)) i++;

276 i‡(
i
 >
íd
)

279 
	`n‹mÆ_keyw‹d
(
i
++);

282 i‡(!(
i
<
íd
 && i->
ty≥
==
TOK_OPERATOR
 && i->
›kw
=='('))

283 
nŸ_va_¨gs
;

284 
∂_°¨t
 = ++
i
;

285 
i
<
íd
 && !(i->
ty≥
==
TOK_OPERATOR
 && i->
›kw
==')'))

286 
	`n‹mÆ_keyw‹d
(
i
++);

287 i‡(!
	`deföe_∑rmli°_has_ñlùsis
(
∂_°¨t
, 
i
++))

288 
nŸ_va_¨gs
;

292 ; 
i
<
íd
; i++) {

293 i‡(
i
->
ty≥
==
TOK_KEYWORD
 && 
	`›kw_is_dúe˘ive_⁄ly
(i->
›kw
))

294 
i
->
ty≥
 = 
TOK_IDENTIFIER
;

297 
nŸ_va_¨gs
:

298 
i
 < 
íd
)

299 
	`n‹mÆ_keyw‹d
(
i
++);

300 
	}
}

303 
	$föÆize_löe
(
tokí
 *
°¨t
, tokí *
íd
) {

304 
tokí
 *
i
 = 
°¨t
, *
j
;

306 
	`as£π
(
°¨t
<
íd
 && sèπ->
ty≥
==
TOK_STARTLINE
);

307 
i
++;

309 
i
<
íd
 && 
	`tokí_is_ign‹ed
(i)) i++;

311 i‡(
i
<
íd
 && i->
ty≥
==
TOK_OPERATOR
 && i->
›kw
=='#') {

313 
i
->
ty≥
 = 
TOK_LEADING_POUND
;

316 
j
=
°¨t
; j<
íd
; j++)

317 
j
->
Êags
.
µ
 = 1;

320 
i
++; i<
íd
; i++) {

321 i‡(!
	`tokí_is_ign‹ed
(
i
)) {

322 
i
->
Êags
.
µ_dúe˘ive
 = 1;

323 i‡(
i
->
ty≥
==
TOK_KEYWORD
 && !
	`›kw_is_dúe˘ive
(i->
›kw
))

324 
i
->
ty≥
 = 
TOK_IDENTIFIER
;

327 i‡(
i
->
ty≥
==
TOK_KEYWORD
 && i->
›kw
==
DEFINE
) {

328 
j
=
i
+1; j<
íd
; j++)

329 
	`this_is_a_deföe
(
i
+1, 
íd
);

331 ++
i
 < 
íd
)

332 
	`n‹mÆ_keyw‹d
(
i
);

339 
i
 < 
íd
)

340 
	`n‹mÆ_keyw‹d
(
i
++);

342 
	}
}

346 
	$föÆize
(
tokí_li°
 *
é
, 
tokí
 *
°¨t
, tokí *
íd
) {

347 c⁄° * c⁄° *
lss
 = 
é
->
éöes
;

348 c⁄° * c⁄° *
l£
 = 
lss
 + 
é
->
éöes_size
;

349 
tokí
 *
i
;

350 
tokí
 *
°¨éöe
 = 
NULL
;

352 
	`as£π
(
°¨t
 < 
íd
);

354 
é
->
fú°
 = 
°¨t
;

355 
é
->
œ°
 = 
íd
-1;

357 
i
=
°¨t
; ; i++) {

359 i‡(
i
 >
íd
 || i->
ty≥
 =
TOK_STARTLINE
) {

360 i‡(
°¨éöe
)

361 
	`föÆize_löe
(
°¨éöe
, 
i
);

362 
°¨éöe
 = 
i
;

365 i‡(
i
 >
íd
) {

366 
íd
[-1].
‹ig_size
 = 
é
->
‹ig
+tl->orig_size -Énd[-1].orig;

371 
i
->
¥ev
 = i>
°¨t
 ? i-1 : 
NULL
;

372 
i
->
√xt
 = i+1<
íd
 ? i+1 : 
NULL
;

375 
lss
+1<
l£
 && 
i
->
txt
 >=Üss[1] && i->txt >Üss[0])

376 
lss
++;

379 
i
->
löe
 = 
lss
 - 
é
->
éöes
;

380 
i
->
cﬁ
 = i->
txt
 - *
lss
;

381 
i
->
‹ig
 = 
é
->
ﬁöes
[i->
löe
] + i->
cﬁ
;

382 i‡(
i
 > 
°¨t
)

383 
i
[-1].
‹ig_size
 = i->
‹ig
 - i[-1].orig;

385 
	`as£π
(
i
->
löe
 < 
é
->
ﬁöes_size
);

388 
	`mem£t
(&
i
->
Êags
, 0, (i->flags));

390 
	}
}

392 
	#add
(...) do { \

393 
tokí
 
tok
 = {
__VA_ARGS__
}; \

394 
tok
.
txt
 = 
‹ig
; \

395 
tok
.
txt_size
 = 
s
-
‹ig
; \

396 
	`d¨øy_≠≥nd
(*
¨r
, 
tok
); \

397 } 0)

	)

399 
	#c°øy
(
c
Ë(
	`cc⁄åﬁ
(cË|| 
	`˚xãnded
(cË|| (c)=='@' || (c)=='`' || (c)=='\\')

	)

400 
	#cidít
(
c
Ë(
	`˛ëãr
(cË|| 
	`cdigô
(cË|| c=='_' || c=='$')

	)

403 
di˘
 *
	gtokíizî_di˘
 = 
NULL
;

405 
	$‰ì_tokíizî_di˘
() {

406 
	`èŒoc_‰ì
(
tokíizî_di˘
);

407 
	}
}

409 
tokí_li°
 *
	$tokíize
(c⁄° *
tc⁄ãxt
, c⁄° *
‹ig
, 
size_t
 
‹ig_size
,

410 
tok_mesßge_queue
 *
mq
) {

411 
tokí_li°
 *
é
 = 
	`èŒoc
(
tc⁄ãxt
, token_list);

412 c⁄° *
s
, *
e
;

413 
size_t
 
°øy_cou¡
=0, 
¸_cou¡
=0;

414 
	`d¨øy
(
tokí
Ë*
¨r
 = 
	`èŒoc_d¨øy
(
é
);

415 
⁄ly_pound_ö˛ude
 = 0;

417 i‡(!
tokíizî_di˘
) {

418 
tokíizî_di˘
 = 
	`di˘_buûd
(
NULL
, 
c_di˘i⁄¨y
,

419 (
c_di˘i⁄¨y
)/(*c_dictionary));

420 
	`©exô
(
‰ì_tokíizî_di˘
);

423 
é
->
‹ig
 = orig;

424 
é
->
‹ig_size
 = orig_size;

425 
	`unbªak_back¶ash_brokí_löes
(
é
, 
mq
);

426 
é
->
fûíame
 = 
NULL
;

428 
s
 = 
é
->
txt
;

429 
e
 = 
s
 + 
é
->
txt_size
;

431 
	`d¨øy_≠≥nds_t
(*
¨r
, 
tokí
, {

432 .
ty≥
 = 
TOK_STARTLINE
,

433 .
txt
 = 
s
,

434 .
txt_size
 = 0

437 
s
<
e
) {

438 c⁄° *
‹ig
 = 
s
;

439 
c
 = *
s
++;

440 
added_somëhög
 = 1;

442 i‡(
	`c°øy
(
c
)) {

443 
°øy_cou¡
++;

444 
s
<
e
 && 
	`c°øy
(*s)) {

445 
s
++;

446 
°øy_cou¡
++;

448 
	`add
(.
ty≥
 = 
TOK_STRAY
);

452 
	`tok_msg_îr‹
(
°øy_£gmít
, 
‹ig
,

453 "%zu såay ch¨a˘îs", 
s
-
‹ig
);

455 } i‡(
	`¸ëu∫
(
c
)) {

457 i‡(
s
<
e
 && *s=='\n'+'\r'-
c
) {

458 
s
++;

459 
¸_cou¡
++;

460 } i‡(
c
=='\r')

461 
¸_cou¡
++;

463 
	`add
(.
ty≥
 = 
TOK_WHITE
);

464 
‹ig
 = 
s
;

467 i‡(
s
<
e
)

468 
	`add
(.
ty≥
 = 
TOK_STARTLINE
);

470 
⁄ly_pound_ö˛ude
 = 0;

472 } i‡(
	`c•a˚
(
c
)) {

474 
s
<
e
 && 
	`c•a˚
(*s)) s++;

475 
	`add
(.
ty≥
 = 
TOK_WHITE
);

476 
added_somëhög
 = 0;

478 } i‡(
	`cdigô
(
c
Ë|| (c=='.' && 
s
<
e
 && cdigit(*s))) {

479 
tokí
 
tok
;

480 
s
 = 
	`ªad_˙umbî
(&
tok
, s-1, 
e
, 
mq
);

481 
tok
.
txt
 = 
‹ig
;

482 
tok
.
txt_size
 = 
s
-
‹ig
;

483 
	`d¨øy_≠≥nd
(*
¨r
, 
tok
);

485 } i‡(
	`csymbﬁ
(
c
Ë|| 
	`cidít
(c)) {

486 i‡(
⁄ly_pound_ö˛ude
 && (
c
=='"' || c=='<')) {

487 *
ö˛ude
;

488 
íd
 = 
c
=='"' ? '"' : '>';

489 
ty≥
 = 
c
=='"' ? 
TOK_STRING_IQUOTE
 : 
TOK_STRING_IANGLE
;

491 
s
<
e
 && !
	`¸ëu∫
(*sË&& *s!=
íd
) s++;

492 
ö˛ude
 = 
	`èŒoc_°∫dup
(
é
, 
‹ig
+1, 
s
-(orig+1));

494 i‡(
s
<
e
 && *s==
íd
) {

495 
s
++;

497 
	`tok_msg_îr‹
(
ö˛ude_missög_ãrmö©‹
, 
‹ig
,

498 "MissögÅîmö©ög %¯ch¨a˘î", 
íd
);

501 
	`add
(.
ty≥
 =Åype,

502 {.
ö˛ude
 = include});

504 } i‡(
c
=='\'' || c=='\"') {

505 
d¨øy_ch¨
 *
°rög
 = 
	`èŒoc_d¨øy
(
é
);

506 
s
 = 
	`ªad_c°rög
(
°rög
, s, 
e
, 
c
, 
mq
);

507 i‡(
s
<
e
) s++;

508 
	`add
(.
ty≥
 = 
c
=='\'' ? 
TOK_CHAR
 : 
TOK_STRING
,

509 {.
°rög
 = string});

511 i‡(
c
=='\'' && 
°rög
->
size
==0) {

512 
	`tok_msg_îr‹
(
em±y_ch¨_c⁄°™t
, 
‹ig
,

516 } i‡(
c
=='/' && 
s
<
e
 && (*s=='*' || *s=='/')) {

517 i‡(*
s
++ == '*') {

518 c⁄° *
commít_°¨t
 = 
s
-2;

519 ;;
s
++) {

520 i‡(
s
+1 >
e
) {

521 
s
 = 
e
;

522 
	`tok_msg_îr‹
(
u¡îmö©ed_commít
, 
commít_°¨t
,

526 i‡(
s
[0]=='*' && s[1]=='/') {

527 
s
 += 2;

531 
	`add
(.
ty≥
 = 
TOK_CCOMMENT
);

533 
s
<
e
 && !
	`¸ëu∫
(*s)) s++;

534 
	`add
(.
ty≥
 = 
TOK_CPPCOMMENT
);

536 
added_somëhög
 = 0;

539 
di˘_íåy
 *
ít
;

540 c⁄° *
idít_e
 = --
s
;

541 
idít_e
<
e
 && 
	`cidít
(*ident_e) ) ident_e++;

543 
ít
 = 
	`di˘_lookup
(
tokíizî_di˘
, &
s
, 
e
);

544 i‡(
	`cidít
(
c
)) {

545 i‡(
ít
 && 
s
==
idít_e
) {

546 
	`add
(.
ty≥
 = 
TOK_KEYWORD
,

547 {.
›kw
 = 
ít
->
id
});

548 i‡(
ít
->
id
 =
INCLUDE
) {

550 
tokí
 *
ts
 = 
¨r
->
ôem
;

551 
tokí
 *
ç
 = 
ts
+
¨r
->
size
-1;

552 
ç
>
ts
 && 
	`tokí_is_ign‹ed
(tp-1))

553 
ç
--;

554 i‡(
ç
>
ts
 && 
	`tokí_is_›
(tp-1, '#')) {

555 
ç
--;

556 
ç
>
ts
 && 
	`tokí_is_ign‹ed
(tp-1))

557 
ç
--;

558 i‡(
ç
>
ts
 &&Åp[-1].
ty≥
==
TOK_STARTLINE
) {

559 
⁄ly_pound_ö˛ude
 = 1;

565 
s
 = 
idít_e
;

566 
	`add
(.
ty≥
 = 
TOK_IDENTIFIER
);

568 } i‡(
ít
) {

569 
	`add
(.
ty≥
 = 
TOK_OPERATOR
,

570 {.
›kw
 = 
ít
->
id
});

572 
	`tok_msg_bug
(
uƒecognized_symbﬁ
, 
s
,

573 "Uƒecognized symbﬁ \'%c\'", 
c
);

574 
s
++;

575 
	`add
(.
ty≥
 = 
TOK_STRAY
);

580 i‡(
added_somëhög
)

581 
⁄ly_pound_ö˛ude
 = 0;

588 i‡(
¸_cou¡
) {

589 
	`tok_msg_w¨n
(
n⁄°™d¨d_√wlöes
, 
NULL
,

593 
	`föÆize
(
é
, 
¨r
->
ôem
,áº->ôem+¨r->
size
);

595  
é
;

596 
	}
}

598 
size_t
 
	$tokí_li°_cou¡
(c⁄° 
tokí_li°
 *
é
) {

599 
size_t
 
ªt
 = 0;

600 c⁄° 
tokí
 *
i
;

602 
i
=
é
->
fú°
; i; i=i->
√xt
)

603 
ªt
++;

605  
ªt
;

606 
	}
}

608 
size_t
 
	$föd_löe
(c⁄° *
±r
, c⁄° * c⁄° *
löes
, 
size_t
 
löe_cou¡
) {

609 c⁄° * c⁄° *
‹ig
 = 
löes
;

610 c⁄° * c⁄° *
‹ig_e
 = 
löes
+
löe_cou¡
;

612 
löe_cou¡
 > 1) {

613 
size_t
 
middÀ
 = 
löe_cou¡
>>1;

614 i‡(
±r
 < 
löes
[
middÀ
])

615 
löe_cou¡
 = 
middÀ
;

617 
löes
 +
middÀ
;

618 
löe_cou¡
 -
middÀ
;

623 
löes
+1 < 
‹ig_e
 &&Üines[0]==lines[1])

624 
löes
++;

630  
löes
 - 
‹ig
;

631 
	}
}

633 
	$tok_poöt_lookup
(
tok_poöt
 *
out
, c⁄° *
±r
,

634 c⁄° 
tokí_li°
 *
é
) {

635 
size_t
 
löe_cou¡
 = 
é
->
ﬁöes_size
;

637 
	`mem£t
(
out
, 0, (*out));

638 i‡(!
é
)

641 i‡(
±r
 >
é
->
txt
 &&Öå <é->txt+é->
txt_size
) {

642 
out
->
txt
 = 
±r
;

643 
out
->
löe
 = 
	`föd_löe
(
±r
, 
é
->
éöes
, 
löe_cou¡
);

644 i‡(
out
->
löe
 < 
löe_cou¡
) {

645 
out
->
cﬁ
 = 
±r
 - 
é
->
éöes
[out->
löe
];

646 
out
->
‹ig
 = 
é
->
ﬁöes
[out->
löe
] + out->
cﬁ
;

648 
out
->
cﬁ
 = 0;

649 
out
->
‹ig
 = 
é
->‹ig +Ål->
‹ig_size
;

652 } i‡(
±r
 >
é
->
‹ig
 &&Öå <é->‹ig+é->
‹ig_size
) {

653 
out
->
‹ig
 = 
±r
;

654 
out
->
löe
 = 
	`föd_löe
(
±r
, 
é
->
ﬁöes
, 
löe_cou¡
);

655 i‡(
out
->
löe
 < 
löe_cou¡
) {

656 c⁄° *
éöe_°¨t
 = 
é
->
éöes
[
out
->
löe
];

657 c⁄° *
éöe_íd
 = 
out
->
löe
+1 < 
löe_cou¡
 ?

658 
é
->
éöes
[
out
->
löe
+1] :

659 
é
->
txt
 +Ål->
txt_size
;

661 
out
->
cﬁ
 = 
±r
 - 
é
->
ﬁöes
[out->
löe
];

662 
out
->
txt
 = 
éöe_°¨t
 + out->
cﬁ
;

664 i‡(
out
->
txt
 > 
éöe_íd
)

665 
out
->
txt
 = 
éöe_íd
;

667 
out
->
cﬁ
 = 0;

668 
out
->
txt
 = 
é
->txà+Ål->
txt_size
;

674 
	}
}

676 *
	$esˇ≥_°rög
(
d¨øy_ch¨
 *
buf
, c⁄° *
°r
, 
size_t
 
size
) {

677 c⁄° *
s
 = 
°r
, *
e
 = s+
size
;

678 
	`d¨øy_‰om_lô
(*
buf
, "");

680 ;
s
<
e
;s++) {

681 
buf„r
[8];

682 c⁄° *
esc
 = 
buf„r
;

683 
c
 = ()*
s
;

684 i‡(
	`cc⁄åﬁ
(
c
))

685 
	`•rötf
(
buf„r
, "\\x%02X", 
c
);

686 
c
) {

687 '\t': 
esc
 = "\\t"; ;

688 '\n': 
esc
 = "\\n"; ;

689 '\v': 
esc
 = "\\v"; ;

690 '\f': 
esc
 = "\\f"; ;

691 '\r': 
esc
 = "\\r"; ;

692 '"': 
esc
 = "\\\""; ;

693 '\\': 
esc
 = "\\\\"; ;

695 
buf„r
[0] = 
c
;

696 
buf„r
[1] = 0;

698 
	`d¨øy_≠≥nd_°rög
(*
buf
, 
esc
);

701  
buf
->
ôem
;

702 
	}
}

704 
	$txt_‹ig_m©ches
(c⁄° *
txt
, 
size_t
 
txt_size
, c⁄° *
‹ig
, size_à
‹ig_size
) {

705 c⁄° *
ts
 = 
txt
, *
ã
 =Ås+
txt_size
;

706 c⁄° *
os
 = 
‹ig
, *
€
 = os+
‹ig_size
;

709 c⁄° *
ob
 = 
os
;

710 c⁄° *
obe
;

711 
size_t
 
size
;

713 
ob
<
€
 && *ob!='\\') ob++;

714 
obe
 = 
ob
;

715 i‡(
obe
 < 
€
) {

716 
obe
++;

717 
obe
<
€
 && 
	`c•a˚
(*obe)) obe++;

718 i‡(
obe
<
€
 && 
	`¸ëu∫
(*obe)) {

719 
obe
++;

720 i‡(
obe
<
€
 && *obe == '\n'+'\r'-obe[-1])

721 
obe
++;

723 
ob
 = 
obe
;

726 
size
 = 
ob
-
os
;

728 i‡(
ts
+
size
 > 
ã
 || 
	`memcmp
—s, 
os
, size))

730 
ts
 +
size
;

731 
os
 = 
obe
;

732 } 
ts
<
ã
);

734 i‡(
ts
 !
ã
 || 
os
 !
€
)

738 
	}
}

740 
	$is_back¶ash_bªak
(c⁄° **
íd
, c⁄° *
s
, c⁄° *
e
) {

741 i‡(
s
<
e
 && *s == '\\') {

742 
s
++;

743 
s
<
e
 && 
	`c•a˚
(*s)) s++;

744 i‡(
s
<
e
 && 
	`¸ëu∫
(*s)) {

745 
s
++;

746 i‡(
s
<
e
 && *s=='\n'+'\r'-s[-1])

747 
s
++;

748 *
íd
 = 
s
;

754 
	}
}

756 
	#Áûed
(
fmt
, ...Ëdÿ{
	`Ârötf
(
îr
, fmà"\n", ##
__VA_ARGS__
);  0; } 0)

	)

759 
	$tokí_li°_ßnôy_check_öôül
(c⁄° 
tokí_li°
 *
é
, 
FILE
 *
îr
) {

760 
tokí
 *
fú°
 = 
é
->first;

761 
tokí
 *
œ°
 = 
é
->last;

762 
tokí
 *
i
;

763 c⁄° *
txt
=
é
->txt, *
‹ig
=tl->orig;

764 c⁄° *
txt_e
 = 
txt
+
é
->
txt_size
, *
‹ig_e
 = 
‹ig
+é->
‹ig_size
;

766 i‡((*)
fú°
 > (*)
œ°
 ||

767 (
size_t
)((*)
œ°
 - (*)
fú°
Ë% (
tokí
))

768 
	`Áûed
("TokenÜistÖointers don'tÜookÑight");

772 i‡(
œ°
!=
fú°
 &&Üa°->
ty≥
==
TOK_STARTLINE
)

775 
i
=
fú°
; i; i=i->
√xt
) {

777 i‡(
i
 !
fú°
 && i->
¥ev
 != i-1)

778 
	`Áûed
("list.prev is incorrect");

779 i‡(
i
 !
œ°
 && i->
√xt
 != i+1)

780 
	`Áûed
("list.next is incorrect");

783 i‡(
i
->
txt
 !=Åxt)

784 
	`Áûed
("txt doesÇot fillÅheÅokenÜist");

785 
txt
 +
i
->
txt_size
;

786 i‡(
txt
 > 
txt_e
)

787 
	`Áûed
("txt is out of bounds");

790 i‡(
i
->
‹ig
 != orig)

791 
	`Áûed
("orig doesÇot fillÅheÅokenÜist");

792 
‹ig
 +
i
->
‹ig_size
;

793 i‡(
‹ig
 > 
‹ig_e
)

794 
	`Áûed
("orig is out of bounds");

797 i‡(
txt
 !
txt_e
)

799 i‡(
‹ig
 !
‹ig_e
)

803 
	}
}

805 
	$tokí_li°_ßnôy_check
(c⁄° 
tokí_li°
 *
é
, 
FILE
 *
îr
) {

806 
tokí
 *
fú°
 = 
é
->first;

807 
tokí
 *
œ°
 = 
é
->last;

808 
tokí
 *
i
;

809 
öôül
 = 1;

811 i‡(
é
->
fú°
 =
NULL
 ||Ål->
œ°
 == NULL)

812 
	`Áûed
("TokenÜist is completelyÉmpty");

814 i‡(
fú°
->
ty≥
!=
TOK_STARTLINE
 ||

815 
fú°
->
txt
!=
é
->txà|| fú°->
txt_size
!=0 ||

816 
fú°
->
‹ig
!=
é
->‹ig || fú°->
‹ig_size
!=0 ||

817 
fú°
->
löe
!=0 || fú°->
cﬁ
!=0)

818 
	`Áûed
("TokenÜist doesÇot start withá valid TOK_STARTLINE");

820 i‡(
fú°
->
¥ev
!=
NULL
 || 
œ°
->
√xt
!=NULL)

821 
	`Áûed
("TokenÉdgeÜinksáreÇot NULL");

823 
i
=
fú°
; i; i=i->
√xt
) {

825 i‡(
é
->
éöes
[
i
->
löe
] + i->
cﬁ
 !i->
txt
)

826 
	`Áûed
("line,col is wrongágainstÅxt");

827 i‡(
é
->
ﬁöes
[
i
->
löe
] + i->
cﬁ
 !i->
‹ig
)

828 
	`Áûed
("line,col is wrongágainst orig");

831 i‡(
i
->
ty≥
!=
TOK_STARTLINE
 && (i->
txt_size
==0 || i->
‹ig_size
==0 || i->txt_size > i->orig_size) )

832 
	`Áûed
("Token isÉmpty");

833 i‡(
i
->
ty≥
==
TOK_STARTLINE
 && (i->
txt_size
!=0 || i->
‹ig_size
!=0) )

834 
	`Áûed
("TOK_STARTLINE isÇon-empty");

837 i‡(
i
->
ty≥
==
TOK_WHITE
) {

838 c⁄° *
s
 = 
i
->
txt
, *
e
 = s+i->
txt_size
;

839 
s
<
e
 && 
	`cwhôe
(*s)) s++;

840 i‡(
s
 !
e
)

841 
	`Áûed
("TOK_WHITE doesÇot contain only white characters");

845 i‡(!
	`txt_‹ig_m©ches
(
i
->
txt
, i->
txt_size
, i->
‹ig
, i->
‹ig_size
)) {

846 
d¨øy_ch¨
 
buf
 = 
	`d¨øy_√w
();

847 
	`Ârötf
(
îr
,

850 
	`esˇ≥_°rög
(&
buf
, 
i
->
txt
, i->
txt_size
) );

851 
	`Ârötf
(
îr
, "\torig = \"%s\"\n",

852 
	`esˇ≥_°rög
(&
buf
, 
i
->
‹ig
, i->
‹ig_size
) );

854 
	`d¨øy_‰ì
(
buf
);

860 
tok_poöt
Åok_point;

861 c⁄° *
t
=
i
->
txt
, *
o
=i->
‹ig
, *
e
=o+i->
‹ig_size
, *
p
;

862 
size_t
 
löe
=
i
->löe, 
cﬁ
=i->col;

864 
	#check
(
±r
) do { \

865 i‡(
	`tok_poöt_lookup
(&
tok_poöt
, 
±r
, 
é
)) { \

866 i‡(
tok_poöt
.
txt
 !
t
 ||Åok_poöt.
‹ig
 !
o
) \

867 
	`Áûed
("tok_point_lookup onÅxtÑeported incorrectÅxt/orig (orig is %d, should be %d)", \

868 ()(
tok_poöt
.
‹ig
-
i
->‹ig), ()(
o
-i->orig)); \

869 i‡(
tok_poöt
.
löe
 !löê||Åok_poöt.
cﬁ
 != col) \

870 
	`Áûed
("tok_point_lookup onÅxtÑeported incorrectÜine/col (off by %d, %d)", \

871 ()(
tok_poöt
.
löe
-löe), ()—ok_poöt.
cﬁ
-col)); \

872 } i‡(
öôül
) {\

873 
	`Áûed
("tok_point_lookup failed on initialÅokenÜist"); \

875 } 0)

	)

878 
	`is_back¶ash_bªak
(&
p
, 
o
, 
e
)) {

879 
o
<
p
) {

880 
	`check
(
o
);

881 
o
++;

882 
cﬁ
++;

884 
cﬁ
 = 0;

885 
löe
++;

887 i‡(
o
 >
e
)

890 i‡(
	`¸ëu∫
(*
o
)) {

891 
p
 = 
o
+1;

892 i‡(
p
<
e
 && *p=='\n'+'\r'-p[-1])

893 
p
++;

894 
o
<
p
) {

895 
	`check
(
o
);

896 
	`check
(
t
);

897 
t
++, 
o
++, 
cﬁ
++;

899 
löe
++;

900 
cﬁ
 = 0;

902 
	`check
(
o
);

903 
	`check
(
t
);

904 
o
++, 
t
++, 
cﬁ
++;

906 } 
o
<
e
 && *o!='\\');

909 #unde‡
check


915 c⁄° *
s
 = 
é
->
‹ig
, *
e
 = s+é->
‹ig_size
;

916 
size_t
 
i
, 
löe_cou¡
 = 
é
->
ﬁöes_size
;

919 i‡(
é
->
ﬁöes_size
 !é->
éöes_size
)

922 
i
=0; 
s
<
e
; i++) {

923 c⁄° *
löe_°¨t
 = 
s
, *
löe_íd
;

924 
size_t
 
éöe_size
, 
ﬁöe_size
;

925 c⁄° *
p
;

927 i‡(
i
+1 < 
löe_cou¡
)

928 
éöe_size
 = 
é
->
éöes
[
i
+1] -Ål->tlines[i];

930 
éöe_size
 = 
é
->
txt
+é->
txt_size
 -Ål->
éöes
[
i
];

932 
s
<
e
 && !
	`¸ëu∫
(*s)) s++;

933 
löe_íd
 = 
s
;

934 i‡(
s
<
e
) {

935 
s
++;

936 i‡(
s
<
e
 && *s=='\n'+'\r'-s[-1])

937 
s
++;

940 
ﬁöe_size
 = 
s
-
löe_°¨t
;

943 i‡(
löe_°¨t
 !
é
->
ﬁöes
[
i
])

947 
p
 = 
é
->
éöes
[
i
];

948 i‡(
p
 < 
é
->
txt
 ||Ö+
éöe_size
 >Ål->txt+é->
txt_size
)

952 i‡(
ﬁöe_size
 < 
éöe_size
)

956 i‡(
ﬁöe_size
 > 
éöe_size
) {

957 
p
 = 
löe_°¨t
+
éöe_size
;

958 i‡(*
p
++ != '\\')

960 
p
<
e
 && 
	`c•a˚
(*p))Ö++;

961 i‡(
p
 !
löe_íd
)

966 i‡–
	`memcmp
(

967 
é
->
ﬁöes
[
i
],

968 
é
->
éöes
[
i
],

969 
éöe_size
) )

974 i‡(
öôül
 && !
	`tokí_li°_ßnôy_check_öôül
(
é
, 
îr
))

975 
	`Áûed
("Initial sanity checks failed. HasÅheÜist been modifiedáfter it wasÑeturned fromÅokenize() ?");

978 
	}
}

980 #unde‡
Áûed


982 *
	$•röt_tokí_Êags
(
buf
[3], 
tokí_Êags
 
Êags
) {

983 
buf
[0] = 
Êags
.
µ
 ? 'p' : '-';

984 
buf
[1] = 
Êags
.
µ_dúe˘ive
 ? 'D' : '-';

985 
buf
[2] = 0;

986  
buf
;

987 
	}
}

989 
	$tokí_li°_dump
(c⁄° 
tokí_li°
 *
é
, 
FILE
 *
f
) {

990 
tokí
 *
tok
;

991 
d¨øy_ch¨
 
buf
 = 
	`d¨øy_√w
();

992 
size_t
 
i
 = 0;

993 
buf2
[8];

994 c⁄° *
tokí_ty≥_°r
[] = {

1012 
tok
=
é
->
fú°
;Åok;ÅokÒok->
√xt
) {

1013 
	`Ârötf
(
f
, "%lu\t%s\t%s\t\"%s\"", ()(
i
++),

1014 
tokí_ty≥_°r
[
tok
->
ty≥
],

1015 
	`•röt_tokí_Êags
(
buf2
, 
tok
->
Êags
),

1016 
	`esˇ≥_°rög
(&
buf
, 
tok
->
txt
,Åok->
txt_size
));

1018 
	`Ârötf
(
f
, "\t\"%s\"\n", 
	`esˇ≥_°rög
(&
buf
, 
tok
->
‹ig
,Åok->
‹ig_size
));

1020 
	`Ârötf
(
f
, "\n");

1024 
	`d¨øy_‰ì
(
buf
);

1025 
	}
}

1027 
	$tok_mesßge_¥öt
(
tok_mesßge
 *
m
, 
tokí_li°
 *
é
) {

1028 
tok_poöt
 
±
;

1029 
ªsﬁved
 = 
	`tok_poöt_lookup
(&
±
, 
m
->
loˇti⁄
, 
é
);

1031 i‡(
é
->
fûíame
) {

1032 
	`¥ötf
("%s:%s", 
é
->
fûíame
, 
ªsﬁved
 ? "" : " ");

1035 i‡(
ªsﬁved
) {

1036 
	`¥ötf
("%zu:%zu %s: %s\n",

1037 
±
.
löe
+1,Öt.
cﬁ
+1,

1038 
m
->
Àvñ
==
TM_DEBUG
 ? "debug" :

1039 
m
->
Àvñ
==
TM_INFO
 ? "info" :

1040 
m
->
Àvñ
==
TM_WARN
 ? "warning" :

1041 
m
->
Àvñ
==
TM_ERROR
 ? "error" :

1042 
m
->
Àvñ
==
TM_BUG
 ? "BUG" :

1044 
m
->
mesßge
);

1046 
	`¥ötf
("%s: %s\n",

1047 
m
->
Àvñ
==
TM_DEBUG
 ? "debug" :

1048 
m
->
Àvñ
==
TM_INFO
 ? "info" :

1049 
m
->
Àvñ
==
TM_WARN
 ? "warning" :

1050 
m
->
Àvñ
==
TM_ERROR
 ? "error" :

1051 
m
->
Àvñ
==
TM_BUG
 ? "BUG" :

1053 
m
->
mesßge
);

1055 
	}
}

1057 
	$tok_mesßge_dump
(
tok_mesßge
 *
m
) {

1058 
	`¥ötf
("%s: %s: %s\n",

1059 
m
->
Àvñ
==
TM_DEBUG
 ? "debug" :

1060 
m
->
Àvñ
==
TM_INFO
 ? "info" :

1061 
m
->
Àvñ
==
TM_WARN
 ? "warning" :

1062 
m
->
Àvñ
==
TM_ERROR
 ? "error" :

1063 
m
->
Àvñ
==
TM_BUG
 ? "BUG" :

1064 "???", 
m
->
∑th
, m->
mesßge
);

1065 
	}
}

1067 
	$tok_mesßge_add
(
tok_mesßge_queue
 *
mq
, 
tok_mesßge_Àvñ
 
Àvñ
,

1068 c⁄° *
∑th
, c⁄° *
loc
, c⁄° *
fmt
, ...) {

1069 
tok_mesßge
 
msg
 = {.
Àvñ
ˆevñ, .
∑th
ı©h, .
loˇti⁄
=
loc
};

1070 
va_li°
 
≠
;

1072 i‡(!
mq
)

1075 
	`va_°¨t
(
≠
, 
fmt
);

1076 
msg
.
mesßge
 = 
	`èŒoc_va•rötf
(
mq
->
ôem
, 
fmt
, 
≠
);

1077 
	`va_íd
(
≠
);

1079 
	`íqueue
(*
mq
, 
msg
);

1080 
	}
}

1082 
	$tok_mesßge_queue_dump
(c⁄° 
tok_mesßge_queue
 *
mq
) {

1083 
size_t
 
i
;

1084 
i
=0; i<
	`queue_cou¡
(*
mq
); i++)

1085 
	`tok_mesßge_dump
(&
	`queue_ôem
(*
mq
, 
i
));

1086 
	}
}

1089 #unde‡
add


1090 #unde‡
c°øy


1091 #unde‡
cidít


	@ccan/ccan/ccan_tokenizer/ccan_tokenizer.h

28 #i‚de‡
CCAN_TOKENIZER_H


29 
	#CCAN_TOKENIZER_H


	)

31 
	~<cˇn/d¨øy/d¨øy.h
>

32 
	~"ch¨Êag.h
"

33 
	~"di˘.h
"

34 
	~"queue.h
"

35 
	~<°döt.h
>

36 
	~<î∫o.h
>

40 
	etokí_ty≥
 {

41 
	mTOK_INTEGER
,

42 
	mTOK_FLOATING
,

43 
	mTOK_OPERATOR
,

45 
	#tokí_ty≥_is_idítifõr
(
ty≥
Ë(—y≥)>=
TOK_KEYWORD
 && (ty≥)<=
TOK_IDENTIFIER
)

	)

46 
	mTOK_KEYWORD
,

47 
	mTOK_IDENTIFIER
,

49 
	mTOK_CHAR
,

50 
	mTOK_STRING
,

51 
	mTOK_LEADING_POUND
,

52 
	mTOK_STRING_IQUOTE
,

53 
	mTOK_STRING_IANGLE
,

55 
	#tokí_ty≥_is_ign‹ed
(
ty≥
Ë(—y≥)>=
TOK_CCOMMENT
 && (ty≥)<=
TOK_WHITE
)

	)

56 
	#tokí_ty≥_is_commít
(
ty≥
Ë(—y≥)>=
TOK_CCOMMENT
 && (ty≥)<=
TOK_CPPCOMMENT
)

	)

57 
	mTOK_CCOMMENT
,

58 
	mTOK_CPPCOMMENT
,

59 
	mTOK_WHITE
,

61 
	mTOK_STARTLINE
,

62 
	mTOK_STRAY
,

65 
	etok_suffix
 {

66 
	mTOK_NOSUFFIX
 = 0,

68 
	mTOK_U
 = 1,

69 
	mTOK_L
 = 2,

70 
	mTOK_LL
 = 4,

71 
	mTOK_F
 = 8,

72 
	mTOK_I
 = 16,

74 
	mTOK_UL
 = 
TOK_U
 | 
TOK_L
,

75 
	mTOK_ULL
 = 
TOK_U
 | 
TOK_LL
,

78 
	mTOK_IMAG_U
 = 
TOK_I
 | 
TOK_U
,

79 
	mTOK_IMAG_L
 = 
TOK_I
 | 
TOK_L
,

80 
	mTOK_IMAG_LL
 = 
TOK_I
 | 
TOK_LL
,

81 
	mTOK_IMAG_F
 = 
TOK_I
 | 
TOK_F
,

83 
	mTOK_IMAG_UL
 = 
TOK_I
 | 
TOK_UL
,

84 
	mTOK_IMAG_ULL
 = 
TOK_I
 | 
TOK_ULL
,

87 
	stok_öãgî
 {

88 
uöt64_t
 
	mv
;

89 
	mba£
;

90 
tok_suffix
 
	msuffix
;

93 
	stok_Êﬂtög
 {

94 
	mv
;

95 
tok_suffix
 
	msuffix
;

100 
	etok_›kw
 {

102 
	mPTR_OP
=128, 
	mINC_OP
, 
	mDEC_OP
, 
	mLEFT_OP
, 
	mRIGHT_OP
, 
	mLE_OP
, 
	mGE_OP
, 
	mEQ_OP
, 
	mNE_OP
,

103 
	mAND_OP
, 
	mOR_OP
,

104 
	mMUL_ASSIGN
, 
	mDIV_ASSIGN
, 
	mMOD_ASSIGN
,

105 
	mADD_ASSIGN
, 
	mSUB_ASSIGN
,

106 
	mAND_ASSIGN
, 
	mXOR_ASSIGN
, 
	mOR_ASSIGN
,

107 
	mLEFT_ASSIGN
, 
	mRIGHT_ASSIGN
,

108 
	mELLIPSIS
,

109 
	mDOUBLE_POUND
,

112 
	m_BOOL
,

113 
	m_COMPLEX
,

114 
	m_IMAGINARY
,

115 
	mBREAK
,

116 
	mCASE
,

117 
	mCHAR
,

118 
	mCONST
,

119 
	mCONTINUE
,

120 
	mDEFAULT
,

121 
	mDO
,

122 
	mDOUBLE
,

123 
	mELSE
,

124 
	mENUM
,

125 
	mEXTERN
,

126 
	mFLOAT
,

127 
	mFOR
,

128 
	mGOTO
,

129 
	mIF
,

130 
	mINLINE
,

131 
	mINT
,

132 
	mLONG
,

133 
	mREGISTER
,

134 
	mRESTRICT
,

135 
	mRETURN
,

136 
	mSHORT
,

137 
	mSIGNED
,

138 
	mSIZEOF
,

139 
	mSTATIC
,

140 
	mSTRUCT
,

141 
	mSWITCH
,

142 
	mTYPEDEF
,

143 
	mUNION
,

144 
	mUNSIGNED
,

145 
	mVOID
,

146 
	mVOLATILE
,

147 
	mWHILE
,

150 
	mVA_ARGS
,

151 
	#›kw_is_dúe˘ive_⁄ly
(
›kw
Ë((›kw)>=
DEFINE
 && (›kw)<=
WARNING
)

	)

152 
	#›kw_is_dúe˘ive
(
›kw
Ë(
	`›kw_is_dúe˘ive_⁄ly
(›kwË|| (›kw)==
ELSE
 || (›kw)==
IF
)

	)

153 
	mDEFINE
,

154 
	mELIF
,

156 
	mENDIF
,

157 
	mERROR
,

159 
	mIFDEF
,

160 
	mIFNDEF
,

161 
	mINCLUDE
,

162 
	mLINE
,

163 
	mPRAGMA
,

164 
	mUNDEF
,

165 
	mWARNING
,

168 
	stokí_Êags
 {

170 
	mµ
:1,

171 
	mµ_dúe˘ive
:1;

174 
	stokí
 {

175 
tokí
 *
	m¥ev
, *
	m√xt
;

177 
tokí_Êags
 
	mÊags
;

178 
	mty≥
;

180 
tok_öãgî
 
	möãgî
;

181 
tok_Êﬂtög
 
	mÊﬂtög
;

182 
	m›kw
;

183 
d¨øy_ch¨
 *
	m°rög
;

184 *
	mö˛ude
;

188 c⁄° *
	mtxt
;

189 
size_t
 
	mtxt_size
;

192 c⁄° *
	m‹ig
;

193 
size_t
 
	m‹ig_size
;

196 
size_t
 
	mlöe
, 
	mcﬁ
;

200 
ölöe
 
	$tokí_is_idítifõr
(c⁄° 
tokí
 *
tok
) {

201  
	`tokí_ty≥_is_idítifõr
(
tok
->
ty≥
);

202 
	}
}

204 
ölöe
 
	$tokí_is_ign‹ed
(c⁄° 
tokí
 *
tok
) {

205  
	`tokí_ty≥_is_ign‹ed
(
tok
->
ty≥
);

206 
	}
}

208 
ölöe
 
	$tokí_is_›
(c⁄° 
tokí
 *
tok
, 
›kw
) {

209  
tok
->
ty≥
==
TOK_OPERATOR
 &&Åok->
›kw
==opkw;

210 
	}
}

212 
ölöe
 
	$tokí_is_kw
(c⁄° 
tokí
 *
tok
, 
›kw
) {

213  
tok
->
ty≥
==
TOK_KEYWORD
 &&Åok->
›kw
==opkw;

214 
	}
}

216 
ölöe
 
	$tokí_txt_is
(c⁄° 
tokí
 *
tok
, c⁄° *
°r
) {

217 
size_t
 
Àn
 = 
	`°æí
(
°r
);

218  
tok
->
txt_size
==
Àn
 && !
	`memcmp
—ok->
txt
, 
°r
,Üen);

219 
	}
}

221 
	stokí_li°
 {

222 
tokí
 *
	mfú°
, *
	mœ°
;

225 c⁄° *
	m‹ig
;

226 
size_t
 
	m‹ig_size
;

229 c⁄° * c⁄° *
	mﬁöes
;

230 
size_t
 
	mﬁöes_size
;

233 c⁄° *
	mtxt
;

234 
size_t
 
	mtxt_size
;

237 c⁄° * c⁄° *
	méöes
;

238 
size_t
 
	méöes_size
;

241 c⁄° *
	mfûíame
;

244 
di˘
 *
tokíizî_di˘
;

246 
	$queue
(
	ttok_mesßge
Ë
	ttok_mesßge_queue
;

249 
tokí_li°
 *
	`tokíize
(c⁄° *
tc⁄ãxt
, c⁄° *
‹ig
, 
size_t
 
‹ig_size
, 
tok_mesßge_queue
 *
mq
);

251 
size_t
 
	`tokí_li°_cou¡
(c⁄° 
tokí_li°
 *
é
);

254 
	`tokí_li°_ßnôy_check
(c⁄° 
tokí_li°
 *
é
, 
FILE
 *
îr
);

255 
	`tokí_li°_dump
(c⁄° 
tokí_li°
 *
é
, 
FILE
 *
f
);

260 
	stok_poöt
 {

261 c⁄° *
txt
, *
‹ig
;

262 
size_t
 
löe
, 
cﬁ
;

266 
	`tok_poöt_lookup
(
tok_poöt
 *
out
, c⁄° *
±r
,

267 c⁄° 
tokí_li°
 *
é
);

272 
	etok_mesßge_Àvñ
 {
TM_DEBUG
, 
TM_INFO
, 
TM_WARN
, 
TM_ERROR
, 
TM_BUG
};

274 
	stok_mesßge
 {

275 
tok_mesßge_Àvñ
 
Àvñ
;

276 c⁄° *
∑th
;

279 c⁄° *
mesßge
;

282 c⁄° *
loˇti⁄
;

286 
	#tok_msg_debug
(
«me
, 
loc
, 
fmt
, ...Ë
	`tok_mesßge_add
(
mq
, 
TM_DEBUG
, 
MESSAGE_PATH
 #«me,Üoc, fmt, ##
__VA_ARGS__
)

	)

287 
	#tok_msg_öfo
(
«me
, 
loc
, 
fmt
, ...Ë
	`tok_mesßge_add
(
mq
, 
TM_INFO
, 
MESSAGE_PATH
 #«me,Üoc, fmt, ##
__VA_ARGS__
)

	)

288 
	#tok_msg_w¨n
(
«me
, 
loc
, 
fmt
, ...Ë
	`tok_mesßge_add
(
mq
, 
TM_WARN
, 
MESSAGE_PATH
 #«me,Üoc, fmt, ##
__VA_ARGS__
)

	)

289 
	#tok_msg_îr‹
(
«me
, 
loc
, 
fmt
, ...Ë
	`tok_mesßge_add
(
mq
, 
TM_ERROR
, 
MESSAGE_PATH
 #«me,Üoc, fmt, ##
__VA_ARGS__
)

	)

290 
	#tok_msg_bug
(
«me
, 
loc
, 
fmt
, ...Ë
	`tok_mesßge_add
(
mq
, 
TM_BUG
, 
MESSAGE_PATH
 #«me,Üoc, fmt, ##
__VA_ARGS__
)

	)

292 
	`tok_mesßge_add
(
tok_mesßge_queue
 *
mq
, 
tok_mesßge_Àvñ
 
Àvñ
,

293 c⁄° *
∑th
, c⁄° *
loc
, c⁄° *
fmt
, ...);

295 
	`tok_mesßge_¥öt
(
tok_mesßge
 *
m
, 
tokí_li°
 *
é
);

297 
	`tok_mesßge_dump
(
tok_mesßge
 *
m
);

298 
	`tok_mesßge_queue_dump
(c⁄° 
tok_mesßge_queue
 *
mq
);

303 *
	`ªad_c°rög
(
d¨øy_ch¨
 *
out
, c⁄° *
s
, c⁄° *
e
, 
quŸeCh¨
, 
tok_mesßge_queue
 *
mq
);

304 *
	`ªad_˙umbî
(
tokí
 *
tok
, c⁄° *
s
, c⁄° *
e
, 
tok_mesßge_queue
 *
mq
);

307 
	tªadui_ba£
;

309 
	#READUI_ALLOWHIGHERDIGITS
 256

	)

310 
	#READUI_ALLOWCAPLETTERS
 512

	)

311 
	#READUI_ALLOWLCASELETTERS
 1024

	)

312 
	#READUI_ALLOWLETTERS
 (
READUI_ALLOWCAPLETTERS
 | 
READUI_ALLOWLCASELETTERS
)

	)

314 
	#READUI_DEC
 ((
ªadui_ba£
)(10))

	)

315 
	#READUI_HEX
 ((
ªadui_ba£
)(16 | 
READUI_ALLOWLETTERS
))

	)

316 
	#READUI_OCT
 ((
ªadui_ba£
)(8))

	)

317 
	#READUI_BIN
 ((
ªadui_ba£
)(2))

	)

319 
uöt64_t
 
	`ªadui
(c⁄° **
•
, c⁄° *
e
, 
ªadui_ba£
 
ba£
);

	@ccan/ccan/ccan_tokenizer/charflag.c

1 
	~"ch¨Êag.h
"

3 
	#C
 
CF_CONTROL


	)

4 
	#S
 
CF_SPACE


	)

5 
	#R
 
CF_RETURN


	)

6 
	#D
 
CF_DIGIT


	)

7 
	#L
 
CF_LETTER


	)

8 
	#H
 
CF_HEX


	)

9 
	#Y
 
CF_SYMBOL


	)

11 
	gch¨Êag
[256] = {

12 
C
,C,C,C,C,C,C,C,C,

13 
S
,

14 
R
,

15 
S
,

16 
S
,

17 
R
,

18 
C
,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,

19 
S
,

20 
Y
,

21 
Y
,

22 
Y
,

23 
Y
,

24 
Y
,

25 
Y
,

26 
Y
,

27 
Y
,

28 
Y
,

29 
Y
,

30 
Y
,

31 
Y
,

32 
Y
,

33 
Y
,

34 
Y
,

35 
D
|
H
,

36 
D
|
H
,

37 
D
|
H
,

38 
D
|
H
,

39 
D
|
H
,

40 
D
|
H
,

41 
D
|
H
,

42 
D
|
H
,

43 
D
|
H
,

44 
D
|
H
,

45 
Y
,

46 
Y
,

47 
Y
,

48 
Y
,

49 
Y
,

50 
Y
,

51 
Y
,

52 
L
|
H
,

53 
L
|
H
,

54 
L
|
H
,

55 
L
|
H
,

56 
L
|
H
,

57 
L
|
H
,

58 
L
,

59 
L
,

60 
L
,

61 
L
,

62 
L
,

63 
L
,

64 
L
,

65 
L
,

66 
L
,

67 
L
,

68 
L
,

69 
L
,

70 
L
,

71 
L
,

72 
L
,

73 
L
,

74 
L
,

75 
L
,

76 
L
,

77 
L
,

78 
Y
,

79 
Y
,

80 
Y
,

81 
Y
,

82 
Y
,

83 
Y
,

84 
L
|
H
,

85 
L
|
H
,

86 
L
|
H
,

87 
L
|
H
,

88 
L
|
H
,

89 
L
|
H
,

90 
L
,

91 
L
,

92 
L
,

93 
L
,

94 
L
,

95 
L
,

96 
L
,

97 
L
,

98 
L
,

99 
L
,

100 
L
,

101 
L
,

102 
L
,

103 
L
,

104 
L
,

105 
L
,

106 
L
,

107 
L
,

108 
L
,

109 
L
,

110 
Y
,

111 
Y
,

112 
Y
,

113 
Y
,

114 
C
,

125 #unde‡
C


126 #unde‡
S


127 #unde‡
R


128 #unde‡
D


129 #unde‡
L


130 #unde‡
H


131 #unde‡
Y


	@ccan/ccan/ccan_tokenizer/charflag.h

1 #i‚de‡
CCAN_CHARFLAG_H


2 
	#CCAN_CHARFLAG_H


	)

6 
	#cc⁄åﬁ
(
c
Ë(
	`ch¨Êag
(cË& 
CF_CONTROL
)

7 
	#c•a˚
(
c
Ë(
	`ch¨Êag
(cË& 
CF_SPACE
)

8 
	#¸ëu∫
(
c
Ë(
	`ch¨Êag
(cË& 
CF_RETURN
)

9 
	#cwhôe
(
c
Ë(
	`ch¨Êag
(cË& 
CF_WHITE
)

10 
	#cdigô
(
c
Ë(
	`ch¨Êag
(cË& 
CF_DIGIT
)

11 
	#˛ëãr
(
c
Ë(
	`ch¨Êag
(cË& 
CF_LETTER
)

12 
	#chex
(
c
Ë(
	`ch¨Êag
(cË& 
CF_HEX
)

13 
	#csymbﬁ
(
c
Ë(
	`ch¨Êag
(cË& 
CF_SYMBOL
)

	)

16 
	#˚xãnded
(
c
Ë(
	`ch¨Êag
(c) == 0)

17 

	)

24 
ch¨Êag
[256];

25 
	#ch¨Êag
(
c
Ë(
ch¨Êag
[()()(c)])

	)

27 
	#CF_CONTROL
 ((Ë1)

	)

28 
	#CF_SPACE
 ((Ë2)

	)

29 
	#CF_RETURN
 ((Ë4)

	)

30 
	#CF_DIGIT
 ((Ë8)

	)

31 
	#CF_LETTER
 ((Ë16)

	)

32 
	#CF_HEX
 ((Ë32)

	)

33 
	#CF_SYMBOL
 ((Ë64)

	)

35 
	#CF_WHITE
 (
CF_SPACE
|
CF_RETURN
)

	)

	@ccan/ccan/ccan_tokenizer/dict.c

1 
	~"di˘.h
"

2 
	~<°rög.h
>

3 
	~<°dlib.h
>

4 
	~<as£π.h
>

7 
	$com∑r_di˘_íåy
(c⁄° *
≠
, c⁄° *
bp
) {

8 c⁄° 
di˘_íåy
 *
a
=
≠
, *
b
=
bp
;

9 
fú°_a
 = ()
a
->
°r
[0];

10 
fú°_b
 = ()
b
->
°r
[0];

11 i‡(
fú°_a
 < 
fú°_b
)

13 i‡(
fú°_a
 > 
fú°_b
)

16 
size_t
 
Àn_a
 = 
	`°æí
(
a
->
°r
);

17 
size_t
 
Àn_b
 = 
	`°æí
(
b
->
°r
);

18 i‡(
Àn_a
 > 
Àn_b
)

20 i‡(
Àn_a
 < 
Àn_b
)

25 
	}
}

27 
di˘
 *
	$di˘_buûd
(*
˘x
, c⁄° 
di˘_íåy
 *
íåõs
, 
size_t
 
cou¡
) {

28 
di˘
 *di˘ = 
	`èŒoc_zîo
(
˘x
, dict);

29 
di˘_íåy
 *
ít
;

30 
i
;

32 i‡(!
cou¡
)

33  
di˘
;

35 
ít
 = 
	`èŒoc_¨øy
(
di˘
, 
di˘_íåy
, 
cou¡
);

36 
	`mem˝y
(
ít
, 
íåõs
, 
cou¡
*(
di˘_íåy
));

37 
	`qs‹t
(
ít
, 
cou¡
, (*ít), 
com∑r_di˘_íåy
);

39 i‡(
ít
->
°r
[0]==0) {

40 
di˘
->
zîo
 = 
ít
;

41 
ít
++, 
cou¡
--;

43 i‡(
cou¡
 && 
ít
->
°r
[0]==0) {

44 
	`Ârötf
(
°dîr
, "dict_entryárray contains multipleÉmpty strings\n");

45 
	`exô
(
EXIT_FAILURE
);

49 
i
=1; i<256; i++) {

50 i‡(!
cou¡
)

52 i‡(
ít
->
°r
[0] =()
i
)

53 
di˘
->
by_fú°_Àâî
[
i
-1] = 
ít
;

54 
cou¡
 && 
ít
->
°r
[0] =()
i
)

55 
ít
++, 
cou¡
--;

58  
di˘
;

59 
	}
}

61 
di˘_íåy
 *
	$di˘_lookup
(
di˘
 *di˘, c⁄° **
•
, c⁄° *
e
) {

62 
di˘_íåy
 *
de
;

63 
fú°
;

64 i‡(*
•
 >
e
)

65  
NULL
;

66 
fú°
 = ()**
•
 & 0xFF;

68 i‡(!
fú°
) {

69 i‡(
di˘
->
zîo
)

70 (*
•
)++;

71  
di˘
->
zîo
;

74 
de
 = 
di˘
->
by_fú°_Àâî
[
fú°
-1];

75 i‡(!
de
)

76  
NULL
;

78 ;
de
->
°r
[0]==()
fú°
; de++) {

79 c⁄° *
s
 = *
•
;

80 c⁄° *
ds
 = 
de
->
°r
;

81 ;;
s
++,
ds
++) {

82 i‡(!*
ds
) {

83 *
•
 = 
s
;

84  
de
;

86 i‡(
s
>=
e
 || *s!=*
ds
)

91  
NULL
;

92 
	}
}

	@ccan/ccan/ccan_tokenizer/dict.h

1 #i‚de‡
CCAN_TOKENIZER_DICT_H


2 
	#CCAN_TOKENIZER_DICT_H


	)

4 
	~<°döt.h
>

5 
	~<cˇn/èŒoc/èŒoc.h
>

8 
	sdi˘_íåy
 {

9 
	mid
;

10 c⁄° *
	m°r
;

13 
	sdi˘
 {

14 
di˘_íåy
 *
	mzîo
;

15 
di˘_íåy
 *
	mby_fú°_Àâî
[256];

18 
di˘
 *
di˘_buûd
(*
˘x
, c⁄° 
di˘_íåy
 *
íåõs
, 
size_t
 
cou¡
);

19 
di˘_íåy
 *
di˘_lookup
(
di˘
 *di˘, c⁄° **
•
, c⁄° *
e
);

	@ccan/ccan/ccan_tokenizer/queue.c

28 
	~"queue.h
"

29 
	~<cˇn/èŒoc/èŒoc.h
>

30 
	~<°rög.h
>

32 
	$queue_íqueue_hñ≥r
(*
qp
, 
size_t
 
ôemSize
) {

33 
	`queue
(Ë*
q
 = 
qp
;

34 
size_t
 
ﬁdsize
 = 
q
->
Êag
+1;

35 
q
->
Êag
 +
ﬁdsize
;

36 
q
->
ôem
 = 
	`èŒoc_ªÆloc_size
(
NULL
, q->ôem, (q->
Êag
+1)*
ôemSize
);

37 
	`mem˝y
(
q
->
ôem
+(q->
hód
+
ﬁdsize
)*
ôemSize
, q->item+q->head*itemSize, (oldsize-q->head)*itemSize);

38 
q
->
hód
 +
ﬁdsize
;

39 
	}
}

41 
	$queue_Æüs_hñ≥r
(c⁄° *
a
, c⁄° *
b
) {

42 ()
a
, ()
b
;

44 
	}
}

	@ccan/ccan/ccan_tokenizer/queue.h

28 #i‚de‡
CCAN_QUEUE_H


29 
	#CCAN_QUEUE_H


	)

31 
	~<°döt.h
>

32 
	~<cˇn/èŒoc/èŒoc.h
>

34 #i‚de‡
HAVE_ATTRIBUTE_MAY_ALIAS


35 
	#HAVE_ATTRIBUTE_MAY_ALIAS
 1

	)

38 #i‡
HAVE_ATTRIBUTE_MAY_ALIAS
==1

39 
	#queue_Æüs
(
±r
Ë

	)

40 
	#queue
(
ty≥
Ë°ru˘ {
size_t
 
hód
, 
èû
, 
Êag
;Åy≥ *
ôem
;} 
	`__©åibuã__
((
__may_Æüs__
))

	)

42 
	#queue_Æüs
(
±r
Ë
	`qs‹t
’å, 0, 1, 
queue_Æüs_hñ≥r
)

43 
	#queue
(
ty≥
Ë°ru˘ {
size_t
 
hód
, 
èû
, 
Êag
;Åy≥ *
ôem
;}

	)

46 
queue_Æüs_hñ≥r
(c⁄° *
a
, c⁄° *
b
);

48 
	#queue_öô
(
queue
, 
˘x
Ëdÿ{(queue).
hód
 = (queue).
èû
 = 0; (queue).
Êag
 = 3; (queue).
ôem
 = 
	`èŒoc_size
(˘x, (*(queue).ôem)*4);} 0)

	)

49 
	#queue_‰ì
(
queue
Ëdÿ{
	`èŒoc_‰ì
((queue).
ôem
);} 0)

	)

51 
	#queue_cou¡
(
queue
Ë(((queue).
èû
-(queue).
hód
Ë& (queue).
Êag
)

	)

52 
	#íqueue
(
queue
, ...) \

54 (
queue
).
ôem
[(queue).
èû
++] = (
__VA_ARGS__
); \

55 (
queue
).
èû
 &(queue).
Êag
; \

56 i‡((
queue
).
èû
 =(queue).
hód
) { \

57 
	`queue_íqueue_hñ≥r
(&(
queue
), (*(queue).
ôem
)); \

58 
	`queue_Æüs
(&(
queue
)); \

60 } 0)

	)

61 
	#dequeue_check
(
queue
Ë((queue).
hód
 !(queue).
èû
 ? 
	`dequeue
(queueË: 
NULL
)

	)

62 
	#dequeue
(
queue
Ë((queue).
ôem
[
	`queue_dequeue_hñ≥r
(&(queue).
hód
, (queue).
Êag
)])

	)

65 
	#queue_√xt
(
queue
Ë((queue).
ôem
[(queue).
hód
])

	)

66 
	#queue_ôem
(
queue
, 
pos
Ë((queue).
ôem
[((queue).
hód
+’os)Ë& (queue).
Êag
])

	)

67 
	#queue_skù
(
queue
Ëdÿ{(queue).
hód
++; (queue).hód &(queue).
Êag
;} 0)

	)

69 
queue_íqueue_hñ≥r
(*
qp
, 
size_t
 
ôemSize
);

71 
ölöe
 
size_t
 
	$queue_dequeue_hñ≥r
(
size_t
 *
hód
, size_à
Êag
) {

72 
size_t
 
ªt
 = (*
hód
)++;

73 *
hód
 &
Êag
;

74  
ªt
;

75 
	}
}

	@ccan/ccan/ccan_tokenizer/read_cnumber.c

3 
	#_ISOC99_SOURCE


	)

4 
	~<°dlib.h
>

5 #unde‡
_ISOC99_SOURCE


7 
	~"cˇn_tokíizî.h
"

9 #i‚de‡
ULLONG_MAX


10 
	#ULLONG_MAX
 18446744073709551615ULL

	)

13 c⁄° *
	$skùnum
(c⁄° *
s
, c⁄° *
e
, 
ªadui_ba£
 
ba£
) {

14 ;
s
<
e
;s++) {

15 
c
 = ()*
s
;

17 i‡(
	`cdigô
(
c
)) {

18 i‡–
c
-'0' >(
ba£
 & 0xFF) &&

19 !(
ba£
 & 
READUI_ALLOWHIGHERDIGITS
) )

21 } i‡(
c
>='A' && c<='Z') {

22 i‡(!(
ba£
 & 
READUI_ALLOWCAPLETTERS
))

24 i‡–
c
-'A'+10 >(
ba£
 & 0xFF) &&

25 !(
ba£
 & 
READUI_ALLOWHIGHERDIGITS
))

27 } i‡(
c
>='a' && c<='z') {

28 i‡(!(
ba£
 & 
READUI_ALLOWLCASELETTERS
))

30 i‡–
c
-'a'+10 >(
ba£
 & 0xFF) &&

31 !(
ba£
 & 
READUI_ALLOWHIGHERDIGITS
))

37  
s
;

38 
	}
}

40 
uöt64_t
 
	$ªadui_vÆid
(c⁄° *
s
, c⁄° *
e
, 
ªadui_ba£
 
ba£
) {

41 
uöt64_t
 
ªt
 = 0;

42 
uöt64_t
 
mu…ùlõr
 = 1;

43 
uöt64_t
 
digô_vÆue
;

46 
	#mu…ùly
(
de°
, 
§c
) do { \

47 
uöt32_t
 
a0
 = (
uöt64_t
)(
de°
) & 0xFFFFFFFF; \

48 
uöt32_t
 
a1
 = (
uöt64_t
)(
de°
) >> 32; \

49 
uöt32_t
 
b0
 = (
uöt64_t
)(
§c
) & 0xFFFFFFFF; \

50 
uöt32_t
 
b1
 = (
uöt64_t
)(
§c
) >> 32; \

51 
uöt64_t
 
a
, 
b
; \

53 i‡(
a1
 && 
b1
) \

54 
ovîÊowed
; \

55 
a
 = (
uöt64_t
)
a1
*
b0
 + (uöt64_t)
a0
*
b1
; \

56 i‡(
a
 > 0xFFFFFFFF) \

57 
ovîÊowed
; \

58 
a
 <<= 32; \

59 
b
 = (
uöt64_t
)
a0
*
b0
; \

61 i‡(
a
+
b
 <á) \

62 
ovîÊowed
; \

63 (
de°
Ë
a
+
b
; \

64 } 0)

	)

66 i‡(
s
 >
e
 || ((
ba£
&0xFF) < 1)) {

67 
î∫o
 = 
EINVAL
;

71 
s
<
e
 && *s=='0') s++;

73 i‡(
e
 > 
s
) {

75 
c
 = *--
e
;

78 i‡(
c
 >= 'a')

79 
c
 -= 'a'-10;

80 i‡(
c
 >= 'A')

81 
c
 -= 'A'-10;

83 
c
 -= '0';

84 
digô_vÆue
 = 
c
;

87 
	`mu…ùly
(
digô_vÆue
, 
mu…ùlõr
);

89 i‡(
ªt
+
digô_vÆue
 <Ñet)

90 
ovîÊowed
;

91 
ªt
 +
digô_vÆue
;

93 i‡(
e
 <
s
)

96 
	`mu…ùly
(
mu…ùlõr
, 
ba£
 & 0xFF);

99 
î∫o
 = 0;

100  
ªt
;

102 
ovîÊowed
:

103 
î∫o
 = 
ERANGE
;

104  
ULLONG_MAX
;

106 #unde‡
mu…ùly


107 
	}
}

109 
uöt64_t
 
	$ªadui
(c⁄° **
•
, c⁄° *
e
, 
ªadui_ba£
 
ba£
) {

110 c⁄° *
s
 = *
•
;

112 
s
<
e
 && 
	`cwhôe
(*s)) s++;

113 
e
 = 
	`skùnum
(
s
,É, 
ba£
);

115 *
•
 = 
e
;

116  
	`ªadui_vÆid
(
s
, 
e
, 
ba£
);

117 
	}
}

120 
	#MESSAGE_PATH
 "tokíize/ªad_˙umbî/"

	)

122 
	ssˇn_numbî
 {

127 c⁄° *
	m¥efix
;

128 c⁄° *
	mdigôs
;

129 c⁄° *
	mexp⁄ít
;

130 c⁄° *
	msuffix
;

131 c⁄° *
	míd
;

132 
size_t
 
	mdŸs_found
;

141 
tokí_ty≥
 
	$sˇn_numbî
(
sˇn_numbî
 *
¢
,

142 c⁄° *
s
, c⁄° *
e
) {

143 
tokí_ty≥
 
ty≥
;

145 
¢
->
dŸs_found
 = 0;

147 
¢
->
¥efix
 = 
s
;

148 
¢
->
digôs
 = 
s
;

149 i‡(
s
+3<=
e
 && s[0]=='0') {

150 i‡(
s
[1]=='X' || s[1]=='x') {

152 
s
 += 2;

153 
¢
->
digôs
 = 
s
;

154 ;
s
<
e
;s++) {

155 i‡(*
s
 == '.')

156 
¢
->
dŸs_found
++;

157 i‡(!
	`chex
(*
s
))

160 
d⁄e_sˇ¬ög_digôs
;

161 } i‡(
s
[1]=='B' || s[1]=='b') {

163 
s
 += 2;

164 i‡(*
s
!='0' && *s!='1')

165 
s
 -= 2;

166 
¢
->
digôs
 = 
s
;

171 ;
s
<
e
;s++) {

172 i‡(*
s
 == '.')

173 
¢
->
dŸs_found
++;

174 i‡(!
	`cdigô
(*
s
))

178 
d⁄e_sˇ¬ög_digôs
:

180 
¢
->
exp⁄ít
 = 
s
;

181 i‡(
s
<
e
 && (

182 (
¢
->
¥efix
==¢->
digôs
 && (*
s
=='E' || *s=='e')) ||

183 (
¢
->
¥efix
 < sn->
digôs
 && (*
s
=='P' || *s=='p'))

185 
s
++;

186 i‡(
s
<
e
 && (*s=='+' || *s=='-'))

187 
s
++;

188 
s
<
e
 && 
	`cdigô
(*s)) s++;

191 
¢
->
suffix
 = 
s
;

192 
s
<
e
 && (
	`cdigô
(*sË|| 
	`˛ëãr
(*s) ||

193 *
s
=='.' || *s=='_' || *s=='$')) s++;

195 
¢
->
íd
 = 
s
;

198 
ty≥
 = 
TOK_INTEGER
;

199 i‡(
¢
->
dŸs_found
)

200 
ty≥
 = 
TOK_FLOATING
;

201 i‡(
¢
->
exp⁄ít
 < sn->
suffix
)

202 
ty≥
 = 
TOK_FLOATING
;

205 i‡(
ty≥
==
TOK_INTEGER
 && 
¢
->
¥efix
==¢->
digôs
 &&

206 
¢
->
digôs
 < 
s
 && sn->digits[0]=='0')

207 
¢
->
digôs
++;

209  
ty≥
;

210 
	}
}

212 
tok_suffix
 
	$ªad_numbî_suffix
(c⁄° *
s
, c⁄° *
e
,

213 
tokí_ty≥
 
ty≥
, 
tok_mesßge_queue
 *
mq
) {

214 c⁄° *
‹ig_s
 = 
s
;

215 
tok_suffix
 
sfx
 = 0;

218 
s
<
e
) {

219 
tok_suffix
 
sfx_¥ev
 = 
sfx
;

220 
c
 = *
s
++;

221 i‡(
c
>='a' && c<='z')

222 
c
 -= 'a'-'A';

224 i‡(
c
=='L') {

225 i‡(
s
<
e
 && (*s=='L' || *s=='l')) {

226 
s
++;

227 
sfx
 |
TOK_LL
;

230 i‡(
sfx
 & 
TOK_L
)

231 
övÆid
;

233 
sfx
 |
TOK_L
;

236 i‡(
c
=='U')

237 
sfx
 |
TOK_U
;

238 i‡(
c
=='F')

239 
sfx
 |
TOK_F
;

240 i‡(
c
=='I')

241 
sfx
 |
TOK_I
;

243 
övÆid
;

245 i‡(
sfx
 =
sfx_¥ev
)

246 
övÆid
;

250 i‡(
ty≥
==
TOK_INTEGER
 && (
sfx
 & 
TOK_F
)) {

251 
	`tok_msg_îr‹
(
suffix_Êﬂt_⁄ly
, 
‹ig_s
,

253 
sfx
 = 
TOK_NOSUFFIX
;

255 i‡(
ty≥
==
TOK_FLOATING
 && (
sfx
 & (
TOK_U
 | 
TOK_LL
))) {

256 
	`tok_msg_îr‹
(
suffix_öãgî_⁄ly
, 
‹ig_s
,

258 
sfx
 = 
TOK_NOSUFFIX
;

261  
sfx
;

263 
övÆid
:

264 i‡(
ty≥
==
TOK_INTEGER
)

265 
	`tok_msg_îr‹
(
öãgî_suffix_övÆid
, 
‹ig_s
,

268 
	`tok_msg_îr‹
(
Êﬂtög_suffix_övÆid
, 
‹ig_s
,

270  
TOK_NOSUFFIX
;

271 
	}
}

273 
	$ªad_öãgî
(
tok_öãgî
 *
out
, c⁄° 
sˇn_numbî
 *
¢
,

274 
tok_mesßge_queue
 *
mq
) {

284 
ªadui_ba£
 
ba£
 = 
READUI_DEC
;

285 c⁄° *
tok°¨t
 = 
¢
->
¥efix
;

286 c⁄° *
s
 = 
¢
->
digôs
, *
e
 = sn->
exp⁄ít
;

288 i‡(
¢
->
¥efix
+1 < sn->
digôs
) {

289 i‡(
¢
->
¥efix
[1]=='X' || sn->prefix[1]=='x')

290 
ba£
 = 
READUI_HEX
;

292 
ba£
 = 
READUI_OCT
;

293 } i‡(
¢
->
¥efix
 < sn->
digôs
) {

294 
ba£
 = 
READUI_OCT
;

297 i‡(
s
>=
e
 && 
ba£
==
READUI_OCT
) {

299 
out
->
v
 = 0;

300 
out
->
ba£
 = 8;

301 
suffix
;

304 
out
->
v
 = 
	`ªadui
(&
s
, 
¢
->
exp⁄ít
, 
ba£
);

305 
out
->
ba£
 = base & 0xFF;

307 i‡(
s
 !
e
 || 
î∫o
 =
EINVAL
) {

308 
	`tok_msg_îr‹
(
öãgî_övÆid_digôs
, 
tok°¨t
,

310 } i‡(
î∫o
) {

311 i‡(
î∫o
 =
ERANGE
) {

312 
	`tok_msg_îr‹
(
öãgî_out_of_ønge
, 
tok°¨t
,

315 
	`tok_msg_bug
(
ªadui_unknown
, 
tok°¨t
,

320 
suffix
:

321 
out
->
suffix
 =

322 
	`ªad_numbî_suffix
(
¢
->
suffix
, sn->
íd
, 
TOK_INTEGER
, 
mq
);

325 
	}
}

327 
	$ªad_Êﬂtög
(
tok_Êﬂtög
 *
out
, c⁄° 
sˇn_numbî
 *
¢
,

328 
tok_mesßge_queue
 *
mq
) {

340 c⁄° *
tok°¨t
 = 
¢
->
¥efix
;

341 c⁄° *
s
 = 
¢
->
¥efix
, *
e
 = sn->
suffix
;

342 
b‹row
 = *
¢
->
íd
;

345 
out
->
v
 = 0.0;

346 
out
->
suffix
 = 
TOK_NOSUFFIX
;

348 i‡(
¢
->
¥efix
 < sn->
digôs
) {

349 i‡(
¢
->
¥efix
[1]=='B' || sn->prefix[1]=='b') {

350 
	`tok_msg_îr‹
(
bö¨y_Êﬂt
, 
tok°¨t
,

354 i‡(
¢
->
exp⁄ít
 >¢->
suffix
) {

355 
	`tok_msg_îr‹
(
hex_Êﬂt_no_exp⁄ít
, 
tok°¨t
,

369 *(*)
¢
->
íd
 = 0;

370 
î∫o
 = 0;

371 
out
->
v
 = 
	`°πﬁd
(
s
, (**)&s);

373 *(*)
¢
->
íd
 = 
b‹row
;

375 i‡(
î∫o
) {

378 i‡(
î∫o
 =
ERANGE
 ||Éºnÿ=
EDOM
) {

379 
	`tok_msg_îr‹
(
Êﬂtög_out_of_ønge
, 
tok°¨t
,

382 
	`tok_msg_bug
(
°πﬁd_unknown
, 
tok°¨t
,

387 i‡(
s
 !
e
) {

388 
	`tok_msg_îr‹
(
Êﬂtög_övÆid_digôs
, 
tok°¨t
,

392 
out
->
suffix
 =

393 
	`ªad_numbî_suffix
(
¢
->
suffix
, sn->
íd
, 
TOK_FLOATING
, 
mq
);

394 
	}
}

396 *
	$ªad_˙umbî
(
tokí
 *
tok
, c⁄° *
s
, c⁄° *
e
, 
tok_mesßge_queue
 *
mq
) {

397 
sˇn_numbî
 
¢
;

399 
tok
->
ty≥
 = 
	`sˇn_numbî
(&
¢
, 
s
, 
e
);

400 i‡(
tok
->
ty≥
 =
TOK_INTEGER
)

401 
	`ªad_öãgî
(&
tok
->
öãgî
, &
¢
, 
mq
);

403 
	`ªad_Êﬂtög
(&
tok
->
Êﬂtög
, &
¢
, 
mq
);

405  (*)
¢
.
íd
;

406 
	}
}

408 #unde‡
MESSAGE_PATH


	@ccan/ccan/ccan_tokenizer/read_cstring.c

1 
	~"cˇn_tokíizî.h
"

3 *
	$°rdup_∫g
(c⁄° *
s
, c⁄° *
e
) {

4 *
ªt
 = 
	`mÆloc
(
e
-
s
+1);

5 
	`mem˝y
(
ªt
, 
s
, 
e
-s);

6 
ªt
[
e
-
s
] = 0;

7  
ªt
;

8 
	}
}

10 
	#MESSAGE_PATH
 "tokíize/ªad_c°rög/"

	)

14 *
	$ªad_c°rög
(
d¨øy_ch¨
 *
out
, c⁄° *
s
, c⁄° *
e
, 
quŸeCh¨
, 
tok_mesßge_queue
 *
mq
) {

15 c⁄° * c⁄° 
tok°¨t
 = 
s
;

16 c⁄° *
p
;

17 
has_ídquŸe
=0, 
has_√wlöes
=0;

21 
	#≠≥nd
(
°¨çå
,
íd±r
Ë
	`d¨øy_≠≥nd_ôems
(*
out
, sèπ±r, (íd±r)-(°¨çå))

	)

22 
	#≠≥nd_ch¨
(
theCh¨
Ë
	`d¨øy_≠≥nd
(*
out
,ÅheCh¨)

	)

23 
	#≠≥nd_zîo
(Ëdÿ{
	`d¨øy_≠≥nd
(*
out
, 0); out->
size
--;} 0)

	)

25 
p
 = 
s
;

26 
p
<
e
) {

27 
c
 = *
p
++;

28 i‡(
c
 == '\\') {

29 
	`≠≥nd
(
s
, 
p
-1);

30 
s
 = 
p
;

31 i‡(
p
 >
e
) {

32 
	`≠≥nd_ch¨
('\\');

33 
	`tok_msg_îr‹
(
íded_ö_back¶ash
, 
p
-1,

37 
c
 = *
p
++;

38 i‡(
c
>='0' && c<='9') {

39 
o˘Æ
 = 
c
-'0';

40 
size_t
 
digô_cou¡
 = 0;

41 
p
<
e
 && *p>='0' && *p<='9') {

42 
o˘Æ
 <<= 3;

43 
o˘Æ
 +(*
p
++) - '0';

44 i‡(++
digô_cou¡
 >= 2)

47 i‡(
p
<
e
 && *p>='0' && *p<='9') {

48 
	`tok_msg_öfo
(
ambiguous_o˘Æ
, 
s
-2,

51 i‡(
o˘Æ
 > 0xFF) {

52 
	`tok_msg_w¨n
(
o˘Æ_ovîÊow
, 
s
-2,

55 
c
 = 
o˘Æ
;

57 
c
) {

59 
size_t
 
digô_cou¡
 = 0;

60 
size_t
 
zîo_cou¡
 = 0;

61 
hex
 = 0;

62 
p
<
e
 && *p=='0'Ëp++, 
zîo_cou¡
++;

63 ;
p
<
e
;
digô_cou¡
++) {

64 
c
 = *
p
++;

65 i‡(
c
>='0' && c<='9')

66 
c
 -= '0';

67 i‡(
c
>='A' && c<='F')

68 
c
 -= 'A'-10;

69 i‡(
c
>='a' && c<='f')

70 
c
 -= 'a'-10;

72 
p
--;

75 
hex
 <<= 4;

76 
hex
 +
c
;

78 i‡(
zîo_cou¡
+
digô_cou¡
 > 2) {

79 *
hex_°rög
 = 
	`°rdup_∫g
(
s
-2, 
p
);

80 
	`tok_msg_w¨n
(
ambiguous_hex
, 
s
-2,

81 "HexÉsˇ≥ '%s' i†ambiguous", 
hex_°rög
);

82 i‡(
digô_cou¡
 > 2)

83 
	`tok_msg_w¨n
(
hex_ovîÊow
, 
s
-2,

84 "HexÉsˇ≥ '%s' ouào‡ønge", 
hex_°rög
);

85 
	`‰ì
(
hex_°rög
);

87 
c
 = 
hex
 & 0xFF;

90 
c
=0x7;

93 
c
=0x8;

96 
c
=0x1B;

99 
c
=0xC;

102 
c
=0xA;

105 
c
=0xD;

108 
c
=0x9;

111 
c
=0xB;

116 i‡(
c
 =
quŸeCh¨
)

118 i‡(
c
=='\'' && 
quŸeCh¨
=='"') {

123 i‡(
c
=='"' && 
quŸeCh¨
=='\'') {

128 i‡(
c
=='?')

130 
	`tok_msg_w¨n
(
unknown_esˇ≥
, 
s
-2,

131 "Unknow¿esˇ≥ sequí˚ '\\%c'", 
c
);

135 
s
 = 
p
;

136 
	`≠≥nd_ch¨
(
c
);

137 } i‡(
c
 =
quŸeCh¨
) {

138 
p
--;

139 
has_ídquŸe
 = 1;

141 } i‡(
	`¸ëu∫
(
c
)) {

142 
has_√wlöes
 = 1;

145 
	`≠≥nd
(
s
, 
p
);

146 
	`≠≥nd_zîo
();

147 i‡(!
has_ídquŸe
) {

148 
	`tok_msg_îr‹
(
missög_ídquŸe
, 
tok°¨t
,

150 
quŸeCh¨
=='\'' ? "character" : "string");

151 } i‡(
has_√wlöes
) {

152 
	`tok_msg_w¨n
(
quŸe_√wlöes
, 
tok°¨t
,

154 
quŸeCh¨
=='\'' ? "Character" : "String");

156  (*)
p
;

158 #unde‡
≠≥nd


159 #unde‡
≠≥nd_ch¨


160 #unde‡
≠≥nd_zîo


161 
	}
}

163 #unde‡
MESSAGE_PATH


	@ccan/ccan/ccan_tokenizer/test/run-simple-token.c

1 
	~<cˇn/cˇn_tokíizî/ªad_˙umbî.c
>

2 
	~<cˇn/cˇn_tokíizî/ªad_c°rög.c
>

3 
	~<cˇn/cˇn_tokíizî/di˘.c
>

4 
	~<cˇn/cˇn_tokíizî/cˇn_tokíizî.c
>

5 
	~<cˇn/cˇn_tokíizî/queue.c
>

6 
	~<cˇn/cˇn_tokíizî/ch¨Êag.c
>

7 
	~<cˇn/èp/èp.h
>

9 
	#ôem
(
num
Ë(
toks
->
fú°
[num])

	)

12 
tok_mesßge_queue
 *
	gMQ
 = 
NULL
;

14 c⁄° *
	g⁄ech¨_tokís
 = "!~#%^&*()=-+{}[]|;:,.<>/?";

15 c⁄° *
	gtwoch¨_tokís
 = "!=##%=^=&=&&*=-=--->+=++==|=||<=<<>=>>/=";

16 c⁄° *
	gthªech¨_tokís
 = "<<=>>=...";

17 c⁄° *
	gch¨_tokí
 = "'x'";

18 c⁄° *
	g°rög_tokí
 = "\"string\"";

19 c⁄° *
	gidít_tokís
 = "dohábc f_o _ba b$f";

21 *
	$back¶ashify
(c⁄° *
°rög
)

23 
i
;

24 *
ªt
 = 
	`èŒoc_size
(
NULL
, 
	`°æí
(
°rög
)*3 + 1);

25 
i
 = 0; i < 
	`°æí
(
°rög
); i++) {

26 
ªt
[
i
*3] = 
°rög
[i];

27 
ªt
[
i
*3+1] = '\\';

28 
ªt
[
i
*3+2] = '\n';

30 
ªt
[
i
*3] = '\0';

31  
ªt
;

32 
	}
}

34 *
	$•acify
(c⁄° *
°rög
, 
num
)

36 
i
;

37 *
ªt
 = 
	`èŒoc_size
(
NULL
, 
	`°æí
(
°rög
)*2 + 1);

38 
	`mem£t
(
ªt
, ' ', 
	`°æí
(
°rög
)*2);

40 
i
 = 0; i < 
	`°æí
(
°rög
); i +
num
)

41 
	`mem˝y
(&
ªt
[
i
 + i/
num
], 
°rög
+i,Çum);

42 
ªt
[
i
 + i/
num
] = '\0';

43  
ªt
;

44 
	}
}

46 
tokí_li°
 *
	$ã°_tokís
(c⁄° *
‹ig
, 
size
)

48 
tokí_li°
 *
toks
;

49 *
°rög
 = 
	`èŒoc_°rdup
(
NULL
, 
‹ig
);

50 
i
;

52 
toks
 = 
	`tokíize
(
°rög
, såög, 
	`°æí
(°rög), 
MQ
);

53 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

55 
	`ok1
(
	`tokí_li°_cou¡
(
toks
Ë=
	`°æí
(
°rög
)/
size
 + 1);

56 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

57 
i
 = 0; i < 
	`°æí
(
°rög
)/
size
; i++) {

58 
	`ok1
(
	`ôem
(
i
+1).
ty≥
 =
TOK_OPERATOR
);

59 
	`ok1
(
	`ôem
(
i
+1).
txt_size
 =
size
);

60 
	`ok1
(
	`°∫cmp
(
	`ôem
(
i
+1).
txt
, 
°rög
 + i*
size
, size) == 0);

61 
	`ok1
(
	`ôem
(
i
+1).
‹ig_size
 =
size
);

62 
	`ok1
(
	`ôem
(
i
+1).
‹ig
 =
°rög
 + i*
size
);

64  
toks
;

65 
	}
}

67 
tokí_li°
 *
	$ã°_tokís_•a˚d
(c⁄° *
‹ig
,

68 
size
)

70 
tokí_li°
 *
toks
;

71 *
°rög
 = 
	`•acify
(
‹ig
, 
size
);

72 
i
;

74 
toks
 = 
	`tokíize
(
°rög
, såög, 
	`°æí
(°rög), 
MQ
);

75 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

77 
	`ok1
(
	`tokí_li°_cou¡
(
toks
Ë=
	`°æí
(
‹ig
)/
size
*2 + 1);

78 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

79 
i
 = 0; i < 
	`°æí
(
‹ig
)/
size
; i++) {

80 
	`ok1
(
	`ôem
(
i
*2+1).
ty≥
 =
TOK_OPERATOR
);

81 
	`ok1
(
	`ôem
(
i
*2+1).
txt_size
 =
size
);

82 
	`ok1
(!
	`°∫cmp
(
	`ôem
(
i
*2+1).
txt
, 
°rög
 + i*(
size
+1), size));

83 
	`ok1
(
	`ôem
(
i
*2+1).
‹ig_size
 =
size
);

84 
	`ok1
(
	`ôem
(
i
*2+1).
‹ig
 =
°rög
 + i*(
size
+1));

85 
	`ok1
(
	`ôem
(
i
*2+2).
ty≥
 =
TOK_WHITE
);

86 
	`ok1
(
	`ôem
(
i
*2+2).
txt_size
 == 1);

87 
	`ok1
(
	`ôem
(
i
*2+2).
txt
[0] == ' ');

88 
	`ok1
(
	`ôem
(
i
*2+2).
‹ig_size
 == 1);

89 
	`ok1
(
	`ôem
(
i
*2+2).
‹ig
 =
°rög
 + i*(
size
+1) + size);

91  
toks
;

92 
	}
}

94 
tokí_li°
 *
	$ã°_tokís_back¶ashed
(c⁄° *
‹ig
,

95 
size
)

97 
tokí_li°
 *
toks
;

98 c⁄° *
°rög
 = 
	`back¶ashify
(
‹ig
);

99 
i
;

101 
toks
 = 
	`tokíize
(
°rög
, såög, 
	`°æí
(°rög), 
MQ
);

102 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

104 
	`ok1
(
	`tokí_li°_cou¡
(
toks
Ë=
	`°æí
(
‹ig
)/
size
 + 1);

105 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

106 
i
 = 0; i < 
	`°æí
(
‹ig
)/
size
; i++) {

107 
	`ok1
(
	`ôem
(
i
+1).
ty≥
 =
TOK_OPERATOR
);

108 
	`ok1
(
	`ôem
(
i
+1).
txt_size
 =
size
);

109 
	`ok1
(
	`°∫cmp
(
	`ôem
(
i
+1).
txt
, 
‹ig
 + i*
size
, size) == 0);

110 
	`ok1
(
	`ôem
(
i
+1).
‹ig_size
 =
size
*3);

111 
	`ok1
(
	`ôem
(
i
+1).
‹ig
 =
°rög
 + i*
size
*3);

113  
toks
;

114 
	}
}

116 
	$⁄ech¨_checks
(c⁄° 
tokí_li°
 *
toks
, 
mul
)

118 
i
;

119 
i
 = 0; i < 
	`°æí
(
⁄ech¨_tokís
); i++)

120 
	`ok1
(
	`ôem
(
i
*
mul
+1).
›kw
 =
⁄ech¨_tokís
[i]);

121 
	}
}

123 
	$twoch¨_checks
(c⁄° 
tokí_li°
 *
toks
, 
mul
)

125 
	`ok1
(
	`ôem
(1).
›kw
 =
NE_OP
);

126 
	`ok1
(
	`ôem
(1*
mul
+1).
›kw
 =
DOUBLE_POUND
);

127 
	`ok1
(
	`ôem
(2*
mul
+1).
›kw
 =
MOD_ASSIGN
);

128 
	`ok1
(
	`ôem
(3*
mul
+1).
›kw
 =
XOR_ASSIGN
);

129 
	`ok1
(
	`ôem
(4*
mul
+1).
›kw
 =
AND_ASSIGN
);

130 
	`ok1
(
	`ôem
(5*
mul
+1).
›kw
 =
AND_OP
);

131 
	`ok1
(
	`ôem
(6*
mul
+1).
›kw
 =
MUL_ASSIGN
);

132 
	`ok1
(
	`ôem
(7*
mul
+1).
›kw
 =
SUB_ASSIGN
);

133 
	`ok1
(
	`ôem
(8*
mul
+1).
›kw
 =
DEC_OP
);

134 
	`ok1
(
	`ôem
(9*
mul
+1).
›kw
 =
PTR_OP
);

135 
	`ok1
(
	`ôem
(10*
mul
+1).
›kw
 =
ADD_ASSIGN
);

136 
	`ok1
(
	`ôem
(11*
mul
+1).
›kw
 =
INC_OP
);

137 
	`ok1
(
	`ôem
(12*
mul
+1).
›kw
 =
EQ_OP
);

138 
	`ok1
(
	`ôem
(13*
mul
+1).
›kw
 =
OR_ASSIGN
);

139 
	`ok1
(
	`ôem
(14*
mul
+1).
›kw
 =
OR_OP
);

140 
	`ok1
(
	`ôem
(15*
mul
+1).
›kw
 =
LE_OP
);

141 
	`ok1
(
	`ôem
(16*
mul
+1).
›kw
 =
LEFT_OP
);

142 
	`ok1
(
	`ôem
(17*
mul
+1).
›kw
 =
GE_OP
);

143 
	`ok1
(
	`ôem
(18*
mul
+1).
›kw
 =
RIGHT_OP
);

144 
	`ok1
(
	`ôem
(19*
mul
+1).
›kw
 =
DIV_ASSIGN
);

145 
	}
}

147 
	$thªech¨_checks
(c⁄° 
tokí_li°
 *
toks
, 
mul
)

149 
	`ok1
(
	`ôem
(1).
›kw
 =
LEFT_ASSIGN
);

150 
	`ok1
(
	`ôem
(1*
mul
+1).
›kw
 =
RIGHT_ASSIGN
);

151 
	`ok1
(
	`ôem
(2*
mul
+1).
›kw
 =
ELLIPSIS
);

152 
	}
}

154 
	$maö
()

156 
i
;

157 
tokí_li°
 *
toks
;

158 *
°r
;

159 *
back¶ashed_idíts
;

161 
	`∂™_ã°s
(1243);

162 
toks
 = 
	`ã°_tokís
(
⁄ech¨_tokís
, 1);

163 
	`⁄ech¨_checks
(
toks
, 1);

164 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

166 
toks
 = 
	`ã°_tokís
(
twoch¨_tokís
, 2);

167 
	`twoch¨_checks
(
toks
, 1);

168 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

170 
toks
 = 
	`ã°_tokís
(
thªech¨_tokís
, 3);

171 
	`thªech¨_checks
(
toks
, 1);

172 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

175 
°r
 = 
	`èŒoc_°rdup
(
NULL
, 
ch¨_tokí
);

176 
toks
 = 
	`tokíize
(
°r
, så, 
	`°æí
(°r), 
MQ
);

177 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

178 
	`ok1
(
	`tokí_li°_cou¡
(
toks
) == 2);

179 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

180 
	`ok1
(
	`ôem
(1).
ty≥
 =
TOK_CHAR
);

181 
	`ok1
(
	`ôem
(1).
txt_size
 =
	`°æí
(
°r
));

182 
	`ok1
(
	`°∫cmp
(
	`ôem
(1).
txt
, 
°r
, 
	`°æí
(str)) == 0);

183 
	`ok1
(
	`ôem
(1).
‹ig_size
 =
	`°æí
(
°r
));

184 
	`ok1
(
	`ôem
(1).
‹ig
 =
°r
);

186 
	`èŒoc_‰ì
(
°r
);

189 
°r
 = 
	`èŒoc_°rdup
(
NULL
, 
°rög_tokí
);

190 
toks
 = 
	`tokíize
(
°r
, så, 
	`°æí
(°r), 
MQ
);

191 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

192 
	`ok1
(
	`tokí_li°_cou¡
(
toks
) == 2);

193 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

194 
	`ok1
(
	`ôem
(1).
ty≥
 =
TOK_STRING
);

195 
	`ok1
(
	`ôem
(1).
txt_size
 =
	`°æí
(
°r
));

196 
	`ok1
(
	`°∫cmp
(
	`ôem
(1).
txt
, 
°r
, 
	`°æí
(str)) == 0);

197 
	`ok1
(
	`ôem
(1).
‹ig_size
 =
	`°æí
(
°r
));

198 
	`ok1
(
	`ôem
(1).
‹ig
 =
°r
);

200 
	`èŒoc_‰ì
(
°r
);

203 
°r
 = 
	`èŒoc_°rdup
(
NULL
, 
idít_tokís
);

204 
toks
 = 
	`tokíize
(
°r
, så, 
	`°æí
(°r), 
MQ
);

205 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

206 
	`tokí_li°_dump
(
toks
, 
°dout
);

207 
	`ok1
(
	`tokí_li°_cou¡
(
toks
) == 10);

208 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

209 
i
 = 0; i < 5; i++) {

210 
	`ok1
(
	`ôem
(
i
*2+1).
ty≥
 =
TOK_IDENTIFIER
);

211 
	`ok1
(
	`ôem
(
i
*2+1).
txt_size
 == 3);

212 
	`ok1
(
	`°∫cmp
(
	`ôem
(
i
*2+1).
txt
, 
°r
 + i*4, 3) == 0);

213 
	`ok1
(
	`ôem
(
i
*2+1).
‹ig_size
 == 3);

214 
	`ok1
(
	`ôem
(
i
*2+1).
‹ig
 =
°r
 + i*4);

215 i‡(
i
 == 4)

217 
	`ok1
(
	`ôem
(
i
*2+2).
ty≥
 =
TOK_WHITE
);

218 
	`ok1
(
	`ôem
(
i
*2+2).
txt_size
 == 1);

219 
	`ok1
(
	`ôem
(
i
*2+2).
txt
[0] == ' ');

220 
	`ok1
(
	`ôem
(
i
*2+2).
‹ig_size
 == 1);

221 
	`ok1
(
	`ôem
(
i
*2+2).
‹ig
 =
°r
 + i*4 + 3);

223 
	`èŒoc_‰ì
(
°r
);

225 
toks
 = 
	`ã°_tokís_•a˚d
(
⁄ech¨_tokís
, 1);

226 
	`⁄ech¨_checks
(
toks
, 2);

227 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

229 
toks
 = 
	`ã°_tokís_•a˚d
(
twoch¨_tokís
, 2);

230 
	`twoch¨_checks
(
toks
, 2);

231 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

233 
toks
 = 
	`ã°_tokís_•a˚d
(
thªech¨_tokís
, 3);

234 
	`thªech¨_checks
(
toks
, 2);

235 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

237 
toks
 = 
	`ã°_tokís_back¶ashed
(
⁄ech¨_tokís
, 1);

238 
	`⁄ech¨_checks
(
toks
, 1);

239 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

241 
toks
 = 
	`ã°_tokís_back¶ashed
(
twoch¨_tokís
, 2);

242 
	`twoch¨_checks
(
toks
, 1);

243 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

245 
toks
 = 
	`ã°_tokís_back¶ashed
(
thªech¨_tokís
, 3);

246 
	`thªech¨_checks
(
toks
, 1);

247 
	`èŒoc_‰ì
((*)
toks
->
‹ig
);

250 
back¶ashed_idíts
 = 
	`back¶ashify
(
idít_tokís
);

251 
toks
 = 
	`tokíize
(
back¶ashed_idíts
, back¶ashed_idíts, 
	`°æí
(back¶ashed_idíts), 
MQ
);

252 
	`ok1
(
	`tokí_li°_ßnôy_check
(
toks
, 
°dout
));

253 
	`ok1
(
	`tokí_li°_cou¡
(
toks
) == 10);

254 
	`ok1
(
	`ôem
(0).
ty≥
 =
TOK_STARTLINE
);

255 
i
 = 0; i < 5; i++) {

256 
	`ok1
(
	`ôem
(
i
*2+1).
ty≥
 =
TOK_IDENTIFIER
);

257 
	`ok1
(
	`ôem
(
i
*2+1).
txt_size
 == 3);

258 
	`ok1
(
	`°∫cmp
(
	`ôem
(
i
*2+1).
txt
, 
idít_tokís
 + i*4, 3) == 0);

259 
	`ok1
(
	`ôem
(
i
*2+1).
‹ig_size
 == 9);

260 
	`ok1
(
	`ôem
(
i
*2+1).
‹ig
 =
back¶ashed_idíts
 + i*12);

261 i‡(
i
 == 4)

263 
	`ok1
(
	`ôem
(
i
*2+2).
ty≥
 =
TOK_WHITE
);

264 
	`ok1
(
	`ôem
(
i
*2+2).
txt_size
 == 1);

265 
	`ok1
(
	`ôem
(
i
*2+2).
txt
[0] == ' ');

266 
	`ok1
(
	`ôem
(
i
*2+2).
‹ig_size
 == 3);

267 
	`ok1
(
	`ôem
(
i
*2+2).
‹ig
 =
back¶ashed_idíts
 + i*12 + 9);

269 
	`èŒoc_‰ì
(
back¶ashed_idíts
);

271  
	`exô_°©us
();

272 
	}
}

	@ccan/ccan/ccan_tokenizer/test/run.c

28 
	~<cˇn/cˇn_tokíizî/ªad_˙umbî.c
>

29 
	~<cˇn/cˇn_tokíizî/ªad_c°rög.c
>

30 
	~<cˇn/cˇn_tokíizî/di˘.c
>

31 
	~<cˇn/cˇn_tokíizî/cˇn_tokíizî.c
>

32 
	~<cˇn/cˇn_tokíizî/queue.c
>

33 
	~<cˇn/cˇn_tokíizî/ch¨Êag.c
>

35 
	~<cˇn/cˇn_tokíizî/cˇn_tokíizî.h
>

37 
	~<cˇn/èp/èp.h
>

39 
	~<m©h.h
>

41 
	#¨øy_cou¡_∑ú
(
ty≥
, ...Ë(c⁄°Åy≥ []){
__VA_ARGS__
}, ((c⁄°Åy≥ []){__VA_ARGS__})/—y≥)

	)

43 
	$ã°_ªad_c°rög
() {

44 
	#√xt
(Ëdÿ{
	`d¨øy_‰ì
(
°r
); 
	`d¨øy_öô
(°r); 
c•
++;} 0)

	)

45 
	#cs
 (*
c•
)

	)

46 
	#vîify_quŸech¨
(
c‹ª˘
, 
c‹ª˘_c⁄töu©i⁄_off£t
, 
quŸech¨
) do { \

47 c⁄° 
size_t
 
s
 = (
c‹ª˘
)-1; \

48 
p
 = 
	`ªad_c°rög
(&
°r
, 
cs
, c†? 
	`°rchr
(cs, 0Ë: 
NULL
, 
quŸech¨
, &
mq
); \

49 
	`ok
(
°r
.
size
==
s
 && så.
Æloc
>†&& så.
ôem
[s]==0 && \

50 !
	`memcmp
(
°r
.
ôem
, 
c‹ª˘
, 
s
), \

51 "\"%s: I†ouçuàc‹ª˘?", 
cs
); \

52 
	`ok
(
p
 =
cs
+
c‹ª˘_c⁄töu©i⁄_off£t
, "\"%s: Is continuationÖointer correct?", cs); \

53 
	`√xt
(); \

54 } 0)

	)

55 
	#vîify
(
c‹ª˘
, 
c‹ª˘_c⁄töu©i⁄_off£t
Ë
	`vîify_quŸech¨
(c‹ª˘, c‹ª˘_c⁄töu©i⁄_off£t, '"')

	)

57 c⁄° * c⁄° 
c°rögs
[] = {

58 
NULL
,

70 c⁄° * c⁄° *
c•
 = 
c°rögs
;

71 c⁄° *
p
;

72 
d¨øy_ch¨
 
°r
 = 
	`d¨øy_√w
();

73 
tok_mesßge_queue
 
mq
;

75 
	`queue_öô
(
mq
, 
NULL
);

78 
	`vîify
("", 0);

81 
	`vîify
("", 0);

84 
	`vîify
("", 0);

87 
	`vîify
("Hello world!", 12);

90 
	`vîify
("Hello world!", 12);

93 
	`vîify
("\\\f\e\b\0\a\r\nw\t\v\'\"", 26);

96 
	`vîify_quŸech¨
("\\\f\e\b\0\a\r\nw\t\v\'\"", 26, '\'');

99 
	`vîify
("\xd8\xa7\xd9\x84\xd8\xa3\xd8\xaf\xd8\xa8\x20\xd8\xa7\xd9\x84\xd8\xb9\xd8\xb1\xd8\xa8\xd9\x8a", 23);

102 
	`vîify
("Ends with \\", 11);

105 
	`vîify
("Tab: '\t' Space: ' ' Overflow: '\377' Ambiguous: 'A3'", 61);

108 
	`vîify
("\x50\x35\x12\xEF\xFE\x12\x45", 32);

110 
	`d¨øy_‰ì
(
°r
);

117 
tok_mesßge
 
m
;

118 
tok_mesßge
 
c‹ª˘_mesßges
[] = {

119 {.
Àvñ
=
TM_ERROR
, .
∑th
="tokenize/read_cstring/missing_endquote"},

120 {.
Àvñ
=
TM_ERROR
, .
∑th
="tokenize/read_cstring/missing_endquote"},

121 {.
Àvñ
=
TM_ERROR
, .
∑th
="tokenize/read_cstring/missing_endquote"},

122 {.
Àvñ
=
TM_WARN
, .
∑th
="tokenize/read_cstring/unknown_escape"},

124 {.
Àvñ
=
TM_WARN
, .
∑th
="tokenize/read_cstring/unknown_escape"},

126 {.
Àvñ
=
TM_ERROR
, .
∑th
="tokenize/read_cstring/ended_in_backslash"},

127 {.
Àvñ
=
TM_ERROR
, .
∑th
="tokenize/read_cstring/missing_endquote"},

128 {.
Àvñ
=
TM_WARN
, .
∑th
="tokenize/read_cstring/octal_overflow"},

129 {.
Àvñ
=
TM_INFO
, .
∑th
="tokenize/read_cstring/ambiguous_octal"},

130 {.
Àvñ
=
TM_WARN
, .
∑th
="tokenize/read_cstring/ambiguous_hex"},

131 {.
Àvñ
=
TM_WARN
, .
∑th
="tokenize/read_cstring/ambiguous_hex"},

132 {.
Àvñ
=
TM_WARN
, .
∑th
="tokenize/read_cstring/hex_overflow"},

134 
size_t
 
i
, 
e
=(
c‹ª˘_mesßges
)/(*correct_messages);

136 
	`queue_cou¡
(
mq
Ë&& 
	`queue_√xt
(mq).
Àvñ
==
TM_DEBUG
)

137 
	`queue_skù
(
mq
);

138 
i
=0; i<
e
; i++) {

139 i‡(!
	`queue_cou¡
(
mq
))

141 
m
 = 
	`dequeue
(
mq
);

142 i‡(
m
.
Àvñ
 !
c‹ª˘_mesßges
[
i
].level)

144 i‡(
	`°rcmp
(
m
.
∑th
, 
c‹ª˘_mesßges
[
i
].path))

146 
	`queue_cou¡
(
mq
Ë&& 
	`queue_√xt
(mq).
Àvñ
==
TM_DEBUG
)

147 
	`queue_skù
(
mq
);

149 i‡(
i
<
e
)

150 
	`¥ötf
("Iãm %zu i†öc‹ª˘\n", 
i
);

151 
	`ok
(
i
==
e
, "Is message queue correct?");

152 
	`ok
(!
	`queue_cou¡
(
mq
), "Message queue should beÉmptyÇow.");

155 
	`queue_‰ì
(
mq
);

156 #unde‡
√xt


157 #unde‡
cs


158 #unde‡
vîify_quŸech¨


159 #unde‡
vîify


160 
	}
}

163 
	$p
(c⁄° *
°r
) {

164 i‡(
°r
)

165 
	`puts
(
°r
);

167 
	`puts
("(null)");

168 
	}
}

171 
	$ã°_queue
() {

172 
	#√xt
(Ëdÿ{
	`queue_‰ì
(
q
); 
	`queue_öô
(q, 
NULL
);} 0)

	)

174 c⁄° * c⁄° 
s
[] = {

192 
	`queue
(c⁄° *Ë
q
;

193 
	`queue_öô
(
q
, 
NULL
);

195 
	`íqueue
(
q
, 
s
[0]);

196 
	`íqueue
(
q
, 
s
[1]);

197 
	`íqueue
(
q
, 
s
[2]);

198 
	`íqueue
(
q
, 
s
[3]);

199 
	`íqueue
(
q
, 
s
[4]);

200 
	`íqueue
(
q
, 
s
[5]);

201 
	`ok
(
	`queue_cou¡
(
q
) == 6, "Checking queue count");

203 
	`ok
(
	`dequeue_check
(
q
)==
s
[0] &&

204 
	`dequeue_check
(
q
)==
s
[1] &&

205 
	`dequeue_check
(
q
)==
s
[2], "Dequeuing/checking 3 items");

206 
	`ok
(
	`queue_cou¡
(
q
) == 3, "Checking queue count");

208 
	`íqueue
(
q
, 
s
[6]);

209 
	`íqueue
(
q
, 
s
[7]);

210 
	`íqueue
(
q
, 
s
[8]);

211 
	`íqueue
(
q
, 
s
[9]);

212 
	`íqueue
(
q
, 
s
[10]);

213 
	`íqueue
(
q
, 
s
[11]);

214 
	`íqueue
(
q
, 
s
[12]);

215 
	`íqueue
(
q
, 
s
[13]);

216 
	`íqueue
(
q
, 
s
[14]);

217 
	`íqueue
(
q
, 
s
[15]);

218 
	`ok
(
	`queue_cou¡
(
q
) == 13, "Checking queue count");

220 
	`ok
(
	`dequeue_check
(
q
)==
s
[3] &&

221 
	`dequeue_check
(
q
)==
s
[4] &&

222 
	`dequeue_check
(
q
)==
s
[5] &&

223 
	`dequeue_check
(
q
)==
s
[6] &&

224 
	`dequeue_check
(
q
)==
s
[7] &&

225 
	`dequeue_check
(
q
)==
s
[8] &&

226 
	`dequeue_check
(
q
)==
s
[9] &&

227 
	`dequeue_check
(
q
)==
s
[10] &&

228 
	`dequeue_check
(
q
)==
s
[11] &&

229 
	`dequeue_check
(
q
)==
s
[12] &&

230 
	`dequeue_check
(
q
)==
s
[13] &&

231 
	`dequeue_check
(
q
)==
s
[14] &&

232 
	`dequeue_check
(
q
)==
s
[15], "Are queue items correct?");

233 
	`ok
(
	`dequeue_check
(
q
)==
NULL
 && dequeue_check(q)==NULL && 
	`queue_cou¡
(q)==0, "Does queueÑun out correctly?");

235 
	`queue_‰ì
(
q
);

237 #unde‡
√xt


238 
	}
}

240 
	#ã°_di˘_sögÀ
(Ë
	`_ã°_di˘_sögÀ
(
di˘
, 
°r
, (°r)-1, 
c‹ª˘
, (c‹ª˘)/(*c‹ª˘))

	)

241 
	$_ã°_di˘_sögÀ
(
di˘
 *di˘, c⁄° *
°r
, 
size_t
 
Àn
, *
c‹ª˘
, size_à
c‹ª˘_cou¡
) {

242 c⁄° *
s
=
°r
, *
e
=°r+
Àn
;

243 
size_t
 
i
;

244 
di˘_íåy
 *
íåy
;

246 
i
=0; 
s
<
e
 && i<
c‹ª˘_cou¡
; i++) {

247 c⁄° *
s_œ°
 = 
s
;

248 
íåy
 = 
	`di˘_lookup
(
di˘
, &
s
, 
e
);

249 i‡(!
íåy
) {

250 i‡(
s_œ°
 !
s
)

252 
s
++;

253 i‡(
c‹ª˘
[
i
] != -100)

257 i‡(
c‹ª˘
[
i
] !
íåy
->
id
)

259 i‡(!*
íåy
->
°r
) {

260 i‡(
s_œ°
+1 !
s
)

262 i‡(
s
[-1] != 0)

265 
size_t
 
Àn
 = 
	`°æí
(
íåy
->
°r
);

266 i‡(
s_œ°
+
Àn
 !
s
)

268 i‡(
	`°∫cmp
(
íåy
->
°r
, 
s
-
Àn
,Üen))

274 i‡(
s
!=
e
 || 
i
!=
c‹ª˘_cou¡
) {

275 
	`¥ötf
("Tokenization failedát ");

276 
	`fwrôe
(
s
, 1, 
e
-s, 
°dout
);

277 
	`¥ötf
("\n");

280 
	`ok
(
s
==
e
 && 
i
==
c‹ª˘_cou¡
, "All ofÅheÅokensáre correct");

281 
	}
}

283 
	$ã°_di˘
() {

284 
di˘_íåy
 
di˘_‹ig
[] = {

311 
di˘
 *di˘ = 
	`di˘_buûd
(
NULL
, 
di˘_‹ig
, (dict_orig)/(*dict_orig));

314 c⁄° *
s
=
NULL
, *
e
=NULL;

315 
	`ok
(
	`di˘_lookup
(
di˘
, &
s
, 
e
)==
NULL
 && s==NULL &&É==NULL, "dict_lookup doesÇothingándÑeturnsÇull onÉmpty input");

319 c⁄° 
°r
[] = "it'sá beautiful day inÅheÇeighborhood\0won't you be myÇeighbor?";

320 
c‹ª˘
[] = {2,0, 3,0, 4,0, 6,0, 8,0, 9,0, 11,-1, 13, 14,0, 5,0, 15,0, 12, -100};

321 
	`ã°_di˘_sögÀ
();

326 c⁄° 
°r
[] = "it'sitem initip";

327 
c‹ª˘
[] = {2,17,0, 8,1,18};

328 
	`ã°_di˘_sögÀ
();

333 c⁄° 
°r
[] = "&^&beaumx yo youthx";

334 
c‹ª˘
[] = {-100,-100,-100, 5,3,-100,-100,-100, 0,-100,-100, 14,10,-100,-100};

335 
	`ã°_di˘_sögÀ
();

340 c⁄° 
°r
[] = "\x80\x12\x34\x80\x32\x80\x32\x34\xFF\xFA\xFF\xEE";

341 
c‹ª˘
[] = {21, 22, 23, 19, 20};

342 
	`ã°_di˘_sögÀ
();

345 
	`èŒoc_‰ì
(
di˘
);

348 
di˘
 = 
	`di˘_buûd
(
NULL
, NULL, 0);

349 
	`èŒoc_‰ì
(
di˘
);

350 
	}
}

352 
	$ã°_ch¨Êag
() {

353 
i
;

354 
c‹ª˘
 = 0;

356 
	#CONTROL
 do { \

357 i‡(
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& !
	`cwhôe
(i) && \

358 !
	`cdigô
(
i
Ë&& !
	`˛ëãr
(iË&& !
	`chex
(iË&& !
	`csymbﬁ
(i) && \

359 !
	`˚xãnded
(
i
) ) \

360 
c‹ª˘
++; \

361 } 0)

	)

362 
	#SPACE
 do { \

363 i‡(!
	`cc⁄åﬁ
(
i
Ë&& 
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& 
	`cwhôe
(i) && \

364 !
	`cdigô
(
i
Ë&& !
	`˛ëãr
(iË&& !
	`chex
(iË&& !
	`csymbﬁ
(i) && \

365 !
	`˚xãnded
(
i
) ) \

366 
c‹ª˘
++; \

367 } 0)

	)

368 
	#RETURN
 do { \

369 i‡(!
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& 
	`¸ëu∫
(iË&& 
	`cwhôe
(i) && \

370 !
	`cdigô
(
i
Ë&& !
	`˛ëãr
(iË&& !
	`chex
(iË&& !
	`csymbﬁ
(i) && \

371 !
	`˚xãnded
(
i
) ) \

372 
c‹ª˘
++; \

373 } 0)

	)

374 
	#SYMBOL
 do { \

375 i‡(!
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& !
	`cwhôe
(i) && \

376 !
	`cdigô
(
i
Ë&& !
	`˛ëãr
(iË&& !
	`chex
(iË&& 
	`csymbﬁ
(i) && \

377 !
	`˚xãnded
(
i
) ) \

378 
c‹ª˘
++; \

379 } 0)

	)

380 
	#DIGIT
 do { \

381 i‡(!
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& !
	`cwhôe
(i) && \

382 
	`cdigô
(
i
Ë&& !
	`˛ëãr
(iË&& 
	`chex
(iË&& !
	`csymbﬁ
(i) && \

383 !
	`˚xãnded
(
i
) ) \

384 
c‹ª˘
++; \

385 } 0)

	)

386 
	#LETTER_HEX
 do { \

387 i‡(!
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& !
	`cwhôe
(i) && \

388 !
	`cdigô
(
i
Ë&& 
	`˛ëãr
(iË&& 
	`chex
(iË&& !
	`csymbﬁ
(i) && \

389 !
	`˚xãnded
(
i
) ) \

390 
c‹ª˘
++; \

391 } 0)

	)

392 
	#LETTER
 do { \

393 i‡(!
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& !
	`cwhôe
(i) && \

394 !
	`cdigô
(
i
Ë&& 
	`˛ëãr
(iË&& !
	`chex
(iË&& !
	`csymbﬁ
(i) && \

395 !
	`˚xãnded
(
i
) ) \

396 
c‹ª˘
++; \

397 } 0)

	)

398 
	#EXTENDED
 do { \

399 i‡(!
	`cc⁄åﬁ
(
i
Ë&& !
	`c•a˚
(iË&& !
	`¸ëu∫
(iË&& !
	`cwhôe
(i) && \

400 !
	`cdigô
(
i
Ë&& !
	`˛ëãr
(iË&& !
	`chex
(iË&& !
	`csymbﬁ
(i) && \

401 
	`˚xãnded
(
i
) ) \

402 
c‹ª˘
++; \

403 } 0)

	)

405 
i
=0; i<'\t'; i++Ë
CONTROL
;

406 
i
 = '\t'; 
SPACE
;

407 
i
 = '\n'; 
RETURN
;

408 
i
 = '\v'; 
SPACE
;

409 
i
 = '\f'; 
SPACE
;

410 
i
 = '\r'; 
RETURN
;

411 
i
='\r'+1; i<' '; i++Ë
CONTROL
;

412 
i
 = ' '; 
SPACE
;

413 
i
='!'; i<='/'; i++Ë
SYMBOL
;

414 
i
='0'; i<='9'; i++Ë
DIGIT
;

415 
i
=':'; i<='@'; i++Ë
SYMBOL
;

416 
i
='A'; i<='F'; i++Ë
LETTER_HEX
;

417 
i
='G'; i<='Z'; i++Ë
LETTER
;

418 
i
='['; i<='`'; i++Ë
SYMBOL
;

419 
i
='a'; i<='f'; i++Ë
LETTER_HEX
;

420 
i
='g'; i<='z'; i++Ë
LETTER
;

421 
i
='{'; i<='~'; i++Ë
SYMBOL
;

422 
i
 = '\x7F'; 
CONTROL
;

424 
	`ok
(
c‹ª˘
==128, "ASCII characters have correct charflags");

425 
c‹ª˘
 = 0;

429 
ui
;

430 
si
;

432 
ui
=128; ui<=255; ui++) {

433 
i
 = 
ui
;

434 
EXTENDED
;

436 
si
=-128; si<0; si++) {

437 
i
 = 
si
;

438 
EXTENDED
;

442 
i
;

443 
i
=-128; i<0; i++Ë
EXTENDED
;

446 
i
;

447 
i
=128; i<=255; i++Ë
EXTENDED
;

450 
	`ok
(
c‹ª˘
==512, "Extended characters have correct charflags");

452 #unde‡
CONTROL


453 #unde‡
SPACE


454 #unde‡
RETURN


455 #unde‡
SYMBOL


456 #unde‡
DIGIT


457 #unde‡
LETTER_HEX


458 #unde‡
LETTER


459 #unde‡
EXTENDED


460 
	}
}

462 
	sªadui_ã°
 {

463 c⁄° *
	mtxt
;

464 
size_t
 
	mtxt_size
;

465 
ªadui_ba£
 
	mba£
;

467 
uöt64_t
 
	mc‹ª˘_öãgî
;

468 
	mc‹ª˘_î∫o
;

469 
size_t
 
	mc‹ª˘_adv™˚
;

472 
	#T
(
txt
, ...Ë{txt, —xt)-1, 
__VA_ARGS__
}

	)

473 
	#M
 (18446744073709551615ULL)

	)

475 
ªadui_ã°
 
	gªadui_ã°s
[] = {

477 
T
("0",
READUI_DEC
, 0,0,1),

478 
T
(" \t42 ",
READUI_DEC
, 42,0,4),

481 
T
("BADBEEFDEADBAT",
READUI_HEX
, 0xBADBEEFDEADBAULL,0,13),

482 
T
("7559",
READUI_OCT
, 0755,0,3),

483 
T
("01010010110012",
READUI_BIN
, 2649,0,13),

484 
T
("1000000000",0x7F, 8594754748609397887ULL,0,10),

487 
T
("",
READUI_DEC
, 0,
EINVAL
,0),

488 
T
("18446744073709551616",

489 
READUI_DEC
,
M
,
ERANGE
,20),

490 
T
("1000000000000000000000000",

491 
READUI_DEC
,
M
,
ERANGE
,25),

492 
T
("10000000000000000",

493 
READUI_HEX
,
M
,
ERANGE
,17),

494 
T
("10000000000000000000000000000000000000000000000000000000000000000",

495 
READUI_BIN
,
M
,
ERANGE
,65),

496 
T
("10000000000",

497 0x7D,
M
,
ERANGE
,11),

498 
T
("9000000000",0x7F, 
M
,
ERANGE
,10),

501 
T
("18446744073709551615",
READUI_DEC
, 
M
,0,20),

504 
	$ã°_ªadui_sögÀ
(
ªadui_ã°
 *
ã°
) {

505 
uöt64_t
 
ªsu…_öãgî
;

506 
ªsu…_î∫o
;

507 
size_t
 
ªsu…_adv™˚
;

509 c⁄° *
s
 = 
ã°
->
txt
, *
e
 = s+ã°->
txt_size
;

510 
î∫o
 = 0;

511 
ªsu…_öãgî
 = 
	`ªadui
(&
s
, 
e
, 
ã°
->
ba£
);

512 
ªsu…_î∫o
 = 
î∫o
;

513 
ªsu…_adv™˚
 = 
s
-
ã°
->
txt
;

515 
	`ok
(
ªsu…_öãgî
 =
ã°
->
c‹ª˘_öãgî
 &&

516 
ªsu…_î∫o
 =
ã°
->
c‹ª˘_î∫o
 &&

517 
ªsu…_adv™˚
 =
ã°
->
c‹ª˘_adv™˚
,

518 "Te°ög \"%s\"", 
ã°
->
txt
);

519 
	}
}

521 
	$ã°_ªadui
() {

522 
size_t
 
i
, 
cou¡
 = (
ªadui_ã°s
)/(*readui_tests);

524 
i
=0; i<
cou¡
; i++)

525 
	`ã°_ªadui_sögÀ
(
ªadui_ã°s
+
i
);

526 
	}
}

528 #unde‡
T


529 #unde‡
M


531 
	$sˇn_numbî_ßnôy_check
(c⁄° 
sˇn_numbî
 *
¢
,

532 
tokí_ty≥
 
ty≥
, c⁄° *
°r_pùes
, c⁄° *
msg
) {

535 i‡(
¢
->
¥efix
 < sn->
digôs
) {

536 
Àn
 = 
¢
->
digôs
 - sn->
¥efix
;

537 i‡(
Àn
!=1 &&Üen!=2) {

538 
	`Áû
("%s : PrefixÜength is %d; should be 1 or 2",

539 
°r_pùes
, 
Àn
);

542 i‡(
¢
->
¥efix
[0] != '0') {

543 
	`Áû
("%s : Prefix doesÇot start with 0",

544 
°r_pùes
);

547 i‡(
Àn
==2 && !
	`°rchr
("BXbx", 
¢
->
¥efix
[1])) {

548 
	`Áû
("%s : Prefix is 0%c; should be 0, 0b, or 0x",

549 
°r_pùes
, 
¢
->
¥efix
[1]);

552 i‡(
Àn
==1 && 
ty≥
==
TOK_FLOATING
) {

553 
	`Áû
("%s : OctalÖrefixáppears on floatingÖointÇumber",

554 
°r_pùes
);

560 i‡(
¢
->
digôs
 < sn->
exp⁄ít
 && sn->digits[0]=='0' &&

561 
ty≥
==
TOK_INTEGER
) {

562 
	`Áû
("%s : First digit ofÇon-prefix integer is 0",

563 
°r_pùes
);

571 c⁄° *
s
 = 
¢
->
digôs
, *
e
 = sn->
exp⁄ít
;

572 i‡(
¢
->
¥efix
+1 < sn->
digôs
) {

573 i‡(
s
 >
e
) {

574 
	`Áû
("%s : 0%cÇot followed byány digits",

575 
°r_pùes
, 
¢
->
¥efix
[1]);

578 i‡(
¢
->
¥efix
[1] == 'X' || sn->prefix[1] == 'x') {

579 
s
<
e
 && 
	`°rchr
(

580 "0123456789ABCDEFabcdef.", *
s
)) s++;

582 i‡(
s
[0]!='0' && s[0]!='1') {

583 
	`Áû
("%s: BinaryÖrefixÇot followed byá 0 or 1",

584 
°r_pùes
);

587 
s
<
e
 && 
	`°rchr
(

588 "0123456789.", *
s
)) s++;

591 i‡(
ty≥
==
TOK_FLOATING
 && 
s
 >
e
) {

592 
	`Áû
("%s : sn->digits isÉmpty iná floatingÖointÇumber",

593 
°r_pùes
);

596 i‡(
¢
->
¥efix
 >¢->
digôs
 && 
s
 >
e
) {

597 
	`Áû
("%s : both sn->prefixánd sn->digitsáreÉmpty",

598 
°r_pùes
);

601 
s
<
e
 && 
	`°rchr
("0123456789.", *s)) s++;

603 i‡(
s
 !
e
) {

604 
	`Áû
("%†: sn->digô†i†nŸÉ¡úñy vÆid", 
°r_pùes
);

610 i‡(
¢
->
exp⁄ít
 < sn->
suffix
) {

611 
c
 = 
¢
->
exp⁄ít
[0];

612 i‡(
ty≥
==
TOK_INTEGER
) {

613 
	`Áû
("%†: sn->exp⁄íài†nŸÉm±y i¿™ i¡egî", 
°r_pùes
);

616 i‡(
¢
->
¥efix
 < sn->
digôs
 && (
c
=='E' || c=='e')) {

617 
	`Áû
("%†: Exp⁄íàf‹ hex/bö¨y sèπ†wôh %c", 
°r_pùes
, 
c
);

620 i‡(
¢
->
¥efix
 >¢->
digôs
 && (
c
=='P' || c=='p')) {

621 
	`Áû
("%†: Exp⁄íàf‹ decimÆ sèπ†wôh %c", 
°r_pùes
, 
c
);

626 
	`∑ss
("%s%s", 
°r_pùes
, 
msg
);

628 
	}
}

630 
	$ã°_sˇn_numbî_sögÀ
(c⁄° *
°r_pùes
,

631 
tokí_ty≥
 
ty≥
, 
size_t
 
dŸs_found
) {

632 *
°r
 = 
	`mÆloc
(
	`°æí
(
°r_pùes
)+1);

633 c⁄° *
ex≥˘ed
[5];

634 
sˇn_numbî
 
¢
;

635 
tokí_ty≥
 
giví_ty≥
;

638 c⁄° *
s
 = 
°r_pùes
;

639 *
d
 = 
°r
;

640 
size_t
 
pùes
 = 0;

642 
ex≥˘ed
[0] = 
d
;

643 ;*
s
;s++) {

644 i‡(*
s
 == ' ')

646 i‡(*
s
 == '|') {

647 i‡(++
pùes
 > 4)

648 
Áû_too_m™y_pùes
;

649 
ex≥˘ed
[
pùes
] = 
d
;

651 *
d
++ = *
s
;

653 *
d
 = 0;

655 i‡(
pùes
 < 3)

656 
Áû_nŸ_íough_pùes
;

657 i‡(
pùes
 == 3)

658 
ex≥˘ed
[4] = 
d
;

661 
giví_ty≥
 = 
	`sˇn_numbî
(&
¢
, 
°r
, 
	`°rchr
(str,0));

663 i‡(
¢
.
¥efix
 !
ex≥˘ed
[0]) {

664 
	`Áû
("%†: sn.¥efix i†wr⁄g", 
°r_pùes
);

667 i‡(
¢
.
digôs
 !
ex≥˘ed
[1]) {

668 
	`Áû
("%†: sn.digô†i†wr⁄g", 
°r_pùes
);

671 i‡(
¢
.
exp⁄ít
 !
ex≥˘ed
[2]) {

672 
	`Áû
("%†: sn.exp⁄íài†wr⁄g", 
°r_pùes
);

675 i‡(
¢
.
suffix
 !
ex≥˘ed
[3]) {

676 
	`Áû
("%†: sn.suffix i†wr⁄g", 
°r_pùes
);

679 i‡(
¢
.
íd
 !
ex≥˘ed
[4]) {

680 
	`Áû
("%†: sn.íd i†wr⁄g", 
°r_pùes
);

683 i‡(
giví_ty≥
 !
ty≥
) {

684 
	`Áû
("%†: Ty≥ inc‹ª˘", 
°r_pùes
);

687 i‡(
¢
.
dŸs_found
 != dots_found) {

688 
	`Áû
("%†: sn.dŸs_found i†%zu; should bê%zu", 
°r_pùes
,

689 
¢
.
dŸs_found
, dots_found);

693 
	`sˇn_numbî_ßnôy_check
(&
¢
, 
ty≥
, 
°r_pùes
, "");

695 
	`‰ì
(
°r
);

698 
Áû_too_m™y_pùes
:

699 
	`Áû
("Toÿm™yÖùe†öÅhêã° såög \"%s\"; should bê3", 
°r_pùes
);

701 
Áû_nŸ_íough_pùes
:

702 
	`Áû
("NŸÉnoughÖùe†öÅhêã° såög \"%s\"; should bê3", 
°r_pùes
);

704 
	}
}

706 
	#T
(
°r
, 
ty≥
, 
dŸs_found
Ë
	`ã°_sˇn_numbî_sögÀ
(°r,ty≥,dŸs_found)

	)

708 
	$ã°_sˇn_numbî
() {

709 
	`T
("0x | 50.1 |Ö+1 | f", 
TOK_FLOATING
, 1);

710 
	`T
("| 100 || L", 
TOK_INTEGER
, 0);

711 
	`T
("0 ||| b21", 
TOK_INTEGER
, 0);

712 
	`T
("0b | 101 || L", 
TOK_INTEGER
, 0);

713 
	`T
("0X | 7A‡||| \t2", 
TOK_INTEGER
, 0);

714 
	`T
("0|||b", 
TOK_INTEGER
, 0);

715 
	`T
("0|||x", 
TOK_INTEGER
, 0);

716 
	}
}

718 #unde‡
T


720 
	#T
(
°rög
, 
vÆue
, 
theBa£
, 
theSuffix
) do { \

721 
	`queue_öô
(
mq
, 
NULL
); \

722 
°r
 = (
°rög
); \

723 
ty≥
 = 
	`sˇn_numbî
(&
¢
, 
°r
, så+(
°rög
)-1); \

724 
	`ok
(
ty≥
==
TOK_INTEGER
, "%†:Åy≥==TOK_INTEGER", 
°r
); \

725 
	`sˇn_numbî_ßnôy_check
(&
¢
, 
ty≥
, 
°r
, \

727 
	`ªad_öãgî
(&
öãgî
, &
¢
, &
mq
); \

728 
	`ok
(
öãgî
.
v
==(
vÆue
Ë&& i¡egî.
ba£
==(
theBa£
) && \

729 
öãgî
.
suffix
==(
theSuffix
), \

730 "%†: C‹ª˘ vÆuê™d suffix", 
°r
); \

731 } 0)

	)

732 
	#Q
(
«me
) do { \

733 i‡(
	`queue_cou¡
(
mq
)) { \

734 c⁄° *
∑th
 = 
	`dequeue
(
mq
).path; \

735 
	`ok
(!
	`°rcmp
(
∑th
, "tokenize/read_cnumber/" #name), \

736 "%†: Dequeued %s", 
°r
, 
∑th
); \

738 } 0)

	)

739 
	#E
() do { \

740 
	`ok
(
	`queue_cou¡
(
mq
)==0, "%†: Mesßgêqueuêem±y", 
°r
); \

741 i‡(
	`queue_cou¡
(
mq
)) \

742 
	`tok_mesßge_queue_dump
(&
mq
); \

743 
	`queue_‰ì
(
mq
); \

744 } 0)

	)

746 
	$ã°_ªad_öãgî
() {

747 
sˇn_numbî
 
¢
;

748 
tok_mesßge_queue
 
mq
;

749 c⁄° *
°r
;

750 
tokí_ty≥
 
ty≥
;

751 
tok_öãgî
 
öãgî
;

753 
	`T
("0b0lu", 0, 8, 
TOK_UL
);

754 
	`E
();

756 
	`T
("1", 1, 10, 
TOK_NOSUFFIX
);

757 
	`E
();

759 
	`T
("32Q", 32, 10, 
TOK_NOSUFFIX
);

760 
	`Q
(
öãgî_suffix_övÆid
);

761 
	`E
();

763 
	`T
("32i", 32, 10, 
TOK_I
);

764 
	`E
();

766 
	`T
("0755f", 493, 8, 
TOK_NOSUFFIX
);

767 
	`Q
(
suffix_Êﬂt_⁄ly
);

768 
	`E
();

770 
	`T
("0xDódBìf", 0xDEADBEEF, 16, 
TOK_NOSUFFIX
);

771 
	`E
();

773 
	`T
("12345678901234567890$1_LONG.SUFFIX", 12345678901234567890ULL, 10, 
TOK_NOSUFFIX
);

774 
	`ok1
(
¢
.
íd
 =
	`°rchr
(
°r
, 0));

775 
	`Q
(
öãgî_suffix_övÆid
);

776 
	`E
();

778 
	`T
("0xDEADBEEFluŒ", 0xDEADBEEF, 16, 
TOK_NOSUFFIX
);

779 
	`Q
(
öãgî_suffix_övÆid
);

780 
	`E
();

782 
	`T
("0xBALLuu", 0xBA, 16, 
TOK_NOSUFFIX
);

783 
	`Q
(
öãgî_suffix_övÆid
);

784 
	`E
();

786 
	`T
("123456789012345678901", 18446744073709551615ULL, 10, 
TOK_NOSUFFIX
);

787 
	`Q
(
öãgî_out_of_ønge
);

788 
	`E
();

790 
	`T
("09", 0, 8, 
TOK_NOSUFFIX
);

791 
	`Q
(
öãgî_övÆid_digôs
);

792 
	`E
();

793 
	}
}

795 #unde‡
T


796 #unde‡
E


798 
	#Teq
(
°rög
, 
equÆs
, 
theSuffix
) do { \

799 
	`queue_öô
(
mq
, 
NULL
); \

800 
°r
 = 
	`mÆloc
((
°rög
)); \

801 
	`mem˝y
(
°r
, 
°rög
, (string)); \

802 
ty≥
 = 
	`sˇn_numbî
(&
¢
, 
°r
, så+(
°rög
)-1); \

803 
	`ok
(
ty≥
==
TOK_FLOATING
, "%†:Åy≥==TOK_FLOATING", 
°r
); \

804 
	`sˇn_numbî_ßnôy_check
(&
¢
, 
ty≥
, 
°r
, \

806 
	`ªad_Êﬂtög
(&
Êﬂtög
, &
¢
, &
mq
); \

807 
	`ok
((
equÆs
) && \

808 
Êﬂtög
.
suffix
==(
theSuffix
), \

809 "%†: C‹ª˘ vÆuê™d suffix", 
°r
); \

810 } 0)

	)

811 
	#T
(
°rög
, 
vÆue
, 
theSuffix
) \

812 
	`Teq
(
°rög
, 
	`Áb¶
(
Êﬂtög
.
v
 - (
vÆue
)Ë<0.00000000000000001, 
theSuffix
)

	)

813 
	#E
() do { \

814 
	`ok
(
	`queue_cou¡
(
mq
)==0, "%†: Mesßgêqueuêem±y", 
°r
); \

815 i‡(
	`queue_cou¡
(
mq
)) \

816 
	`tok_mesßge_queue_dump
(&
mq
); \

817 
	`queue_‰ì
(
mq
); \

818 
	`‰ì
(
°r
); \

819 } 0)

	)

821 
	$ã°_ªad_Êﬂtög
() {

822 
sˇn_numbî
 
¢
;

823 
tok_mesßge_queue
 
mq
;

824 *
°r
;

825 
tokí_ty≥
 
ty≥
;

826 
tok_Êﬂtög
 
Êﬂtög
;

828 
	`T
("1.0", 1.0, 
TOK_NOSUFFIX
);

829 
	`E
();

831 
	`T
("0.0", 0.0, 
TOK_NOSUFFIX
);

832 
	`E
();

834 
	`T
("0755e1", 7550.0, 
TOK_NOSUFFIX
);

835 
	`E
();

837 
	`T
("0xD.Bp0", 0xD.B
p0
, 
TOK_NOSUFFIX
);

838 
	`E
();

842 
	`T
("0x.p0", 0.0, 
TOK_NOSUFFIX
);

843 
	`Q
(
Êﬂtög_övÆid_digôs
);

844 
	`E
();

846 
	`T
("32.0Q", 32.0, 
TOK_NOSUFFIX
);

847 
	`Q
(
Êﬂtög_suffix_övÆid
);

848 
	`E
();

850 
	`T
("32.0Li", 32.0, 
TOK_IMAG_L
);

851 
	`E
();

853 
	`T
("32.0LL", 32.0, 
TOK_NOSUFFIX
);

854 
	`Q
(
suffix_öãgî_⁄ly
);

855 
	`E
();

857 
	`Teq
("0xDEAD.BEEF", 
Êﬂtög
.
v
==0.0, 
TOK_NOSUFFIX
);

858 
	`Q
(
hex_Êﬂt_no_exp⁄ít
);

859 
	`E
();

861 
	`T
("0b101.0p0", 0, 
TOK_NOSUFFIX
);

862 
	`Q
(
bö¨y_Êﬂt
);

863 
	`E
();

868 
	`Teq
("1.e+4933", 
	`isöf
(
Êﬂtög
.
v
), 
TOK_NOSUFFIX
);

869 
	`Q
(
Êﬂtög_out_of_ønge
);

870 
	`E
();

875 
	`Teq
("1.e-4951", 
Êﬂtög
.
v
==0.0, 
TOK_NOSUFFIX
);

876 
	`Q
(
Êﬂtög_out_of_ønge
);

877 
	`E
();

879 
	`Teq
("1.e-4952", 
Êﬂtög
.
v
==0.0, 
TOK_NOSUFFIX
);

880 
	`Q
(
Êﬂtög_out_of_ønge
);

881 
	`E
();

883 
	}
}

885 #unde‡
Teq


886 #unde‡
T


887 #unde‡
Q


888 #unde‡
E


890 
	stokíizî_ã°
 {

891 c⁄° *
	mtxt
;

892 
size_t
 
	mtxt_size
;

894 c⁄° 
tokí
 *
	mtokís
;

895 
size_t
 
	mtokí_cou¡
;

898 
	#T
(
txt
, ...Ë{txt, —xt)-1, 
	`¨øy_cou¡_∑ú
(
tokí
, 
__VA_ARGS__
)}

	)

899 
	#°rög
(
txt
Ë{.
°rög
=(
d¨øy_ch¨
[1]){{.
ôem
 = (txt), .
size
 = —xt)-1}}}

	)

900 
	#›kw
(
v
Ë{.
›kw
 = (v)}

	)

901 
	#txt
(
t
Ë.
txt
 = (t), .
txt_size
 = —)-1

	)

902 
	#öãgî
(...Ë{.
öãgî
={
__VA_ARGS__
}}

	)

903 
	#Êﬂtög
(...Ë{.
Êﬂtög
={
__VA_ARGS__
}}

	)

904 
	#•a˚
 {.
ty≥
 = 
TOK_WHITE
, .
txt
 = " ", .
txt_size
 = 1}

	)

905 
	#°¨éöe
 {.
ty≥
 = 
TOK_STARTLINE
}

	)

906 
	#ö˛ude
(
°r
Ë{.
ö˛ude
 = (°r)}

	)

908 
	stokíizî_msg_ã°
 {

909 
tokíizî_ã°
 
	mã°
;

911 c⁄° * c⁄° *
	mmesßges
;

912 
size_t
 
	mmesßge_cou¡
;

915 
	#M
(...Ë
	`¨øy_cou¡_∑ú
(c⁄° *, 
__VA_ARGS__
)

	)

917 
tokíizî_ã°
 
	gtokíizî_ã°s
[] = {

919 
T
("\n",

920 {.
ty≥
 = 
TOK_WHITE
, 
txt
("\n")}

922 
T
("\na",

923 {.
ty≥
 = 
TOK_WHITE
, 
txt
("\n")},

924 
°¨éöe
,

925 {.
ty≥
 = 
TOK_IDENTIFIER
, 
txt
("a")}

927 
T
("intÇ = c++;",

928 {.
ty≥
 = 
TOK_KEYWORD
,

929 
›kw
(
INT
),

930 
txt
("int")

931 }, 
•a˚
,

932 {.
ty≥
 = 
TOK_IDENTIFIER
,

933 
txt
("n")

934 }, 
•a˚
,

935 {.
ty≥
 = 
TOK_OPERATOR
,

936 
›kw
('='),

937 
txt
("=")

938 }, 
•a˚
,

939 {.
ty≥
 = 
TOK_IDENTIFIER
,

940 
txt
("c")

942 {.
ty≥
 = 
TOK_OPERATOR
,

943 
›kw
(
INC_OP
),

944 
txt
("++")

946 {.
ty≥
 = 
TOK_OPERATOR
,

947 
›kw
(';'),

948 
txt
(";")

951 
T
(".5 42 ",

952 {.
ty≥
 = 
TOK_FLOATING
,

953 
Êﬂtög
(.5, 
TOK_NOSUFFIX
),

954 
txt
(".5")

955 }, 
•a˚
,

956 {.
ty≥
 = 
TOK_INTEGER
,

957 
öãgî
(42, 10, 
TOK_NOSUFFIX
),

958 
txt
("42")

959 }, 
•a˚
,

962 
T
("``AS IS'' AND",

963 {.
ty≥
 = 
TOK_STRAY
,

964 
txt
("``")

966 {.
ty≥
 = 
TOK_IDENTIFIER
,

967 
txt
("AS")

968 }, 
•a˚
,

969 {.
ty≥
 = 
TOK_IDENTIFIER
,

970 
txt
("IS")

972 {.
ty≥
 = 
TOK_CHAR
,

973 
°rög
(""),

974 
txt
("\'\'")

975 }, 
•a˚
,

976 {.
ty≥
 = 
TOK_IDENTIFIER
,

977 
txt
("AND")

981 
T
("0 .05 0 500",

982 {.
ty≥
 = 
TOK_INTEGER
,

983 
öãgî
(0, 8, 
TOK_NOSUFFIX
),

984 
txt
("0")

985 }, 
•a˚
,

986 {.
ty≥
 = 
TOK_FLOATING
,

987 
Êﬂtög
(.05, 
TOK_NOSUFFIX
),

988 
txt
(".05")

989 }, 
•a˚
,

990 {.
ty≥
 = 
TOK_INTEGER
,

991 
öãgî
(0, 8, 
TOK_NOSUFFIX
),

992 
txt
("0")

993 }, 
•a˚
,

994 {.
ty≥
 = 
TOK_INTEGER
,

995 
öãgî
(500, 10, 
TOK_NOSUFFIX
),

996 
txt
("500")

1000 
T
("\t/*comment*/ #include \"include.h\"\n",

1001 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\t")},

1002 {.
Êags
={1,0}, .
ty≥
=
TOK_CCOMMENT
, 
txt
("/*comment*/")},

1003 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1004 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1005 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
INCLUDE
), 
txt
("include")},

1006 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1007 {.
Êags
={1,0}, .
ty≥
=
TOK_STRING_IQUOTE
, 
ö˛ude
("ö˛ude.h"), 
txt
("\"include.h\"")},

1008 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\n")}

1011 
T
("if #define __VA_ARGS__=0X5FULL;\n"

1013 {.
ty≥
=
TOK_KEYWORD
, 
›kw
(
IF
), 
txt
("if")},

1014 
•a˚
,

1015 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('#'), 
txt
("#")},

1016 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("define")},

1017 
•a˚
,

1018 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("__VA_ARGS__")},

1019 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('='), 
txt
("=")},

1020 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(0x5F,16,
TOK_ULL
), 
txt
("0X5FULL")},

1021 {.
ty≥
=
TOK_OPERATOR
, 
›kw
(';'), 
txt
(";")},

1022 {.
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1023 {.
Êags
={1,0}, .
ty≥
=
TOK_STARTLINE
},

1024 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1025 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1026 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")},

1027 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1028 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("__VA_ARGS__")},

1029 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
('('), 
txt
("(")},

1030 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("__VA_ARGS__")},

1031 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
(','), 
txt
(",")},

1032 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1033 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
(
ELLIPSIS
), 
txt
("...")},

1034 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\t")},

1035 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
(')'), 
txt
(")")},

1036 {.
Êags
={1,0}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
VA_ARGS
), 
txt
("__VA_ARGS__")},

1037 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1038 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("bar")},

1039 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1040 {.
Êags
={1,0}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
INT
), 
txt
("int")},

1041 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1042 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("define")},

1045 
T
("#define foo __VA_ARGS__ bar int define\n#define foo() __VA_ARGS__ bar int define",

1046 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1047 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")},

1048 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1049 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("foo")},

1050 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1051 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("__VA_ARGS__")},

1052 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1053 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("bar")},

1054 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1055 {.
Êags
={1,0}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
INT
), 
txt
("int")},

1056 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1057 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("define")},

1058 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1060 {.
Êags
={1,0}, .
ty≥
=
TOK_STARTLINE
},

1061 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1062 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")},

1063 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1064 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("foo")},

1065 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
('('), 
txt
("(")},

1066 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
(')'), 
txt
(")")},

1067 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1068 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("__VA_ARGS__")},

1069 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1070 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("bar")},

1071 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1072 {.
Êags
={1,0}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
INT
), 
txt
("int")},

1073 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1074 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("define")}

1078 
T
("1 1u 1l 1ul 1lu 1ll 1ull 1llu 1U 1L 1UL 1LU 1LL 1ULL 1LLU "

1080 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1")}, 
•a˚
,

1081 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_U
), 
txt
("1u")}, 
•a˚
,

1082 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_L
), 
txt
("1l")}, 
•a˚
,

1083 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_UL
), 
txt
("1ul")}, 
•a˚
,

1084 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_UL
), 
txt
("1lu")}, 
•a˚
,

1085 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_LL
), 
txt
("1Œ")}, 
•a˚
,

1086 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_ULL
), 
txt
("1uŒ")}, 
•a˚
,

1087 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_ULL
), 
txt
("1Œu")}, 
•a˚
,

1088 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_U
), 
txt
("1U")}, 
•a˚
,

1089 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_L
), 
txt
("1L")}, 
•a˚
,

1090 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_UL
), 
txt
("1UL")}, 
•a˚
,

1091 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_UL
), 
txt
("1LU")}, 
•a˚
,

1092 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_LL
), 
txt
("1LL")}, 
•a˚
,

1093 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_ULL
), 
txt
("1ULL")}, 
•a˚
,

1094 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_ULL
), 
txt
("1LLU")}, 
•a˚
,

1095 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1uq")}, 
•a˚
,

1096 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1lq")}, 
•a˚
,

1097 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1Œq")}, 
•a˚
,

1098 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1ulq")}, 
•a˚
,

1099 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1luq")}, 
•a˚
,

1100 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_NOSUFFIX
), 
txt
("1f")}, 
•a˚
,

1101 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(1, 10, 
TOK_I
), 
txt
("1i")}

1104 
T
("\n\r\n \r\n\rint",

1105 {.
ty≥
=
TOK_WHITE
, 
txt
("\n\r")}, 
°¨éöe
,

1106 {.
ty≥
=
TOK_WHITE
, 
txt
("\n")}, 
°¨éöe
,

1107 
•a˚
,

1108 {.
ty≥
=
TOK_WHITE
, 
txt
("\r\n")}, 
°¨éöe
,

1109 {.
ty≥
=
TOK_WHITE
, 
txt
("\r")}, 
°¨éöe
,

1110 {.
ty≥
=
TOK_KEYWORD
, 
›kw
(
INT
), 
txt
("int")}

1113 
T
("oner\\ \nous",

1114 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("onerous")}

1116 
T
("\\\n\\\n\\\n\\",

1117 {.
ty≥
=
TOK_STRAY
, 
txt
("\\")}

1119 
T
("in\\\nt i\\;\nf\\ \r\nor (i=0; i<10; i++) {\\",

1120 {.
ty≥
=
TOK_KEYWORD
, 
›kw
(
INT
), 
txt
("öt")}, 
•a˚
,

1121 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("i")},

1122 {.
ty≥
=
TOK_STRAY
, 
txt
("\\")},

1123 {.
ty≥
=
TOK_OPERATOR
, 
›kw
(';'), 
txt
(";")},

1124 {.
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1126 
°¨éöe
,

1127 {.
ty≥
=
TOK_KEYWORD
, 
›kw
(
FOR
), 
txt
("f‹")}, 
•a˚
,

1128 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('('), 
txt
("(")},

1129 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("i")},

1130 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('='), 
txt
("=")},

1131 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(0,8,0), 
txt
("0")},

1132 {.
ty≥
=
TOK_OPERATOR
, 
›kw
(';'), 
txt
(";")}, 
•a˚
,

1133 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("i")},

1134 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('<'), 
txt
("<")},

1135 {.
ty≥
=
TOK_INTEGER
, 
öãgî
(10,10,0), 
txt
("10")},

1136 {.
ty≥
=
TOK_OPERATOR
, 
›kw
(';'), 
txt
(";")}, 
•a˚
,

1137 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("i")},

1138 {.
ty≥
=
TOK_OPERATOR
, 
›kw
(
INC_OP
), 
txt
("++")},

1139 {.
ty≥
=
TOK_OPERATOR
, 
›kw
(')'), 
txt
(")")}, 
•a˚
,

1140 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('{'), 
txt
("{")},

1141 {.
ty≥
=
TOK_STRAY
, 
txt
("\\")}

1144 
T
("#apple\n#pragma\n#const\n#define \t\n#define foo(x",

1145 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1146 {.
Êags
={1,1}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("apple")},

1147 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1149 {.
Êags
={1,0}, .
ty≥
=
TOK_STARTLINE
},

1150 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1151 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
PRAGMA
), 
txt
("pragma")},

1152 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1154 {.
Êags
={1,0}, .
ty≥
=
TOK_STARTLINE
},

1155 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1156 {.
Êags
={1,1}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("const")},

1157 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1159 {.
Êags
={1,0}, .
ty≥
=
TOK_STARTLINE
},

1160 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1161 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")},

1162 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" \t")},

1163 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
("\n")},

1165 {.
Êags
={1,0}, .
ty≥
=
TOK_STARTLINE
},

1166 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1167 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")},

1168 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1169 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("foo")},

1170 {.
Êags
={1,0}, .
ty≥
=
TOK_OPERATOR
, 
›kw
('('), 
txt
("(")},

1171 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("x")}

1173 
T
("#define",

1174 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1175 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")}

1177 
T
("#define foo",

1178 {.
Êags
={1,0}, .
ty≥
=
TOK_LEADING_POUND
, 
txt
("#")},

1179 {.
Êags
={1,1}, .
ty≥
=
TOK_KEYWORD
, 
›kw
(
DEFINE
), 
txt
("define")},

1180 {.
Êags
={1,0}, .
ty≥
=
TOK_WHITE
, 
txt
(" ")},

1181 {.
Êags
={1,0}, .
ty≥
=
TOK_IDENTIFIER
, 
txt
("foo")}

1183 
T
("`#define foo",

1184 {.
ty≥
=
TOK_STRAY
, 
txt
("`")},

1185 {.
ty≥
=
TOK_OPERATOR
, 
›kw
('#'), 
txt
("#")},

1186 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("define")},

1187 
•a˚
,

1188 {.
ty≥
=
TOK_IDENTIFIER
, 
txt
("foo")}

1192 
tokíizî_msg_ã°
 
	gtokíizî_msg_ã°s
[] = {

1193 {
T
("/* Unterminated C comment",

1194 {.
ty≥
=
TOK_CCOMMENT
, 
txt
("/* Unterminated C comment")}

1195 ), 
M
(

1198 {
T
("\"\n\"\"\n",

1199 {.
ty≥
=
TOK_STRING
, 
°rög
("\n"), 
txt
("\"\n\"")},

1200 {.
ty≥
=
TOK_STRING
, 
°rög
("\n"), 
txt
("\"\n")}

1201 ), 
M
(

1207 #unde‡
T


1208 #unde‡
°rög


1209 #unde‡
›kw


1210 #unde‡
txt


1211 #unde‡
öãgî


1212 #unde‡
Êﬂtög


1213 #unde‡
M


1214 #unde‡
ö˛ude


1216 
	$ã°_tokíizî_sögÀ
(
tokíizî_ã°
 *
t
, 
tok_mesßge_queue
 *
mq
) {

1217 
tokí_li°
 *
é
;

1218 
size_t
 
i
, 
cou¡
 = 
t
->
tokí_cou¡
, 
gí_cou¡
;

1219 c⁄° 
tokí
 *
tok_gí
, *
tok_c‹ª˘
;

1220 
suc˚ss
 = 1;

1221 *
txt
 = 
	`èŒoc_memdup
(
NULL
, 
t
->txt,Å->
txt_size
);

1222 
size_t
 
txt_size
 = 
t
->txt_size;

1223 
	#Áûed
(
fmt
, ...) do { \

1224 
	`¥ötf
("Eº‹: " 
fmt
 "\n", ##
__VA_ARGS__
); \

1225 
suc˚ss
 = 0; \

1226 
d⁄e
; \

1227 } 0)

	)

1229 
é
 = 
	`tokíize
(
txt
,Åxt, 
txt_size
, 
mq
);

1231 i‡(
é
->
‹ig
 !
txt
 ||Ål->
‹ig_size
 !
txt_size
)

1232 
	`Áûed
("tokenize() didÇotÑeplicate orig/orig_size fromárguments");

1233 i‡(!
	`tokí_li°_ßnôy_check
(
é
, 
°dout
))

1234 
	`Áûed
("Sanity check failed");

1236 
gí_cou¡
 = 
	`tokí_li°_cou¡
(
é
);

1237 i‡(
gí_cou¡
 !
cou¡
+1)

1238 
	`Áûed
("IncorrectÇumber ofÅokens (%zu, should be %zu)\n",

1239 
gí_cou¡
, 
cou¡
+1);

1241 
tok_gí
 = 
é
->
fú°
->
√xt
;

1242 
tok_c‹ª˘
 = 
t
->
tokís
;

1243 
i
=0; i<
cou¡
; i++, 
tok_gí
Òok_gí->
√xt
, 
tok_c‹ª˘
++) {

1244 i‡(
tok_gí
->
ty≥
 !
tok_c‹ª˘
->type)

1245 
	`Áûed
("Tokí \"%s\": Inc‹ª˘Åy≥", 
tok_c‹ª˘
->
txt
);

1247 
tokí_Êags
 
g
=
tok_gí
->
Êags
, 
c
=
tok_c‹ª˘
->flags;

1248 i‡(
g
.
µ
!=
c
.µ || g.
µ_dúe˘ive
!=c.pp_directive)

1249 
	`Áûed
("Tokí \"%s\": Inc‹ª˘ fœgs", 
tok_c‹ª˘
->
txt
);

1251 
tok_gí
->
ty≥
) {

1252 
TOK_INTEGER
:

1253 i‡(
tok_gí
->
öãgî
.
v
 !
tok_c‹ª˘
->integer.v ||

1254 
tok_gí
->
öãgî
.
ba£
 !
tok_c‹ª˘
->integer.base ||

1255 
tok_gí
->
öãgî
.
suffix
 !
tok_c‹ª˘
->integer.suffix)

1256 
	`Áûed
("Tokí \"%s\": I¡egî vÆue/ba£/suffix inc‹ª˘", 
tok_c‹ª˘
->
txt
);;

1258 
TOK_FLOATING
:

1259 i‡(
	`Áb¶
(
tok_gí
->
Êﬂtög
.
v
 - 
tok_c‹ª˘
->floating.v) > 0.00000000000000001 ||

1260 
tok_gí
->
Êﬂtög
.
suffix
 !
tok_c‹ª˘
->floating.suffix)

1261 
	`Áûed
("Tokí \"%s\": FlﬂtögÖoöàvÆue/suffix inc‹ª˘", 
tok_c‹ª˘
->
txt
);

1263 
TOK_OPERATOR
:

1264 i‡(
tok_gí
->
›kw
 !
tok_c‹ª˘
->opkw)

1265 
	`Áûed
("Tokí \"%s\": O≥øt‹ opkw inc‹ª˘", 
tok_c‹ª˘
->
txt
);

1267 
TOK_KEYWORD
:

1268 i‡(
tok_gí
->
›kw
 !
tok_c‹ª˘
->opkw)

1269 
	`Áûed
("Tokí \"%s\": Keyw‹d opkw inc‹ª˘", 
tok_c‹ª˘
->
txt
);

1271 
TOK_CHAR
:

1272 
TOK_STRING
:

1274 i‡(
tok_gí
->
°rög
->
size
 !
tok_c‹ª˘
->string->size ||

1275 
	`memcmp
(
tok_gí
->
°rög
->
ôem
, 
tok_c‹ª˘
->string->item,

1276 
tok_gí
->
°rög
->
size
) ||

1277 
tok_gí
->
°rög
->
ôem
[tok_gí->°rög->
size
] != 0 )

1278 
	`Áûed
("Tokí \"%s\": Såög vÆuêöc‹ª˘", 
tok_c‹ª˘
->
txt
);

1280 
TOK_STRING_IQUOTE
:

1281 
TOK_STRING_IANGLE
:

1282 i‡(
	`°rcmp
(
tok_gí
->
ö˛ude
, 
tok_c‹ª˘
->include))

1283 
	`Áûed
("Tokí \"%s\": #ö˛udê°rög inc‹ª˘", 
tok_c‹ª˘
->
txt
);

1285 
TOK_IDENTIFIER
:

1286 
TOK_CCOMMENT
:

1287 
TOK_CPPCOMMENT
:

1288 
TOK_WHITE
:

1289 
TOK_STARTLINE
:

1290 
TOK_STRAY
:

1293 i‡(
tok_gí
->
ty≥
!=
TOK_STARTLINE
 && (

1294 
tok_gí
->
txt_size
 !
tok_c‹ª˘
->txt_size ||

1295 
	`memcmp
(
tok_gí
->
txt
, 
tok_c‹ª˘
->txt,Åok_gí->
txt_size
))

1297 
	`Áûed
("Tokí \"%s\":Åxàöc‹ª˘", 
tok_c‹ª˘
->
txt
);

1300 #unde‡
Áûed


1301 
d⁄e
:

1302 
	`ok
(
suc˚ss
==1, "Tokíizê%s", 
t
->
txt
);

1304 i‡(!
suc˚ss
)

1305 
	`tokí_li°_dump
(
é
, 
°dout
);

1307 
	`èŒoc_‰ì
(
txt
);

1308 
	}
}

1310 
	$ã°_tokíizî_fûe
(c⁄° *
fûe_«me
, 
tok_mesßge_queue
 *
mq
) {

1311 
FILE
 *
f
 = 
	`f›í
(
fûe_«me
, "rb");

1312 
d¨øy_ch¨
 *
ãxt
 = 
	`èŒoc_d¨øy
(
NULL
);

1313 c⁄° 
size_t
 
öc
 = 1024;

1314 
tokí_li°
 *
é
;

1316 i‡(!
f
) {

1317 
	`Áû
("CouldÇŸÑód fûê'%s': %s", 
fûe_«me
, 
	`°ªº‹
(
î∫o
));

1318 
íd
;

1322 
size_t
 
ªad_Àn
;

1324 
	`d¨øy_ªÆloc
(*
ãxt
,Åext->
size
+
öc
+1);

1325 
ªad_Àn
 = 
	`‰ód
(
ãxt
->
ôem
+ãxt->
size
, 1, 
öc
, 
f
);

1326 
ãxt
->
size
 +
ªad_Àn
;

1327 
ãxt
->
ôem
[ãxt->
size
] = 0;

1329 i‡(
ªad_Àn
 < 
öc
)

1333 i‡(
	`„º‹
(
f
)) {

1334 
	`Áû
("Eº‹Ñódög fûê'%s': %s", 
fûe_«me
, 
	`°ªº‹
(
î∫o
));

1335 
íd
;

1338 
é
 = 
	`tokíize
(
ãxt
,Åext->
ôem
,Åext->
size
, 
mq
);

1339 
é
->
fûíame
 = 
fûe_«me
;

1344 i‡(!
	`tokí_li°_ßnôy_check
(
é
, 
°dout
)) {

1345 
	`Áû
("S™ôy check faûed f‹ fûê'%s'", 
fûe_«me
);

1346 
íd
;

1349 
	`∑ss
("Fûê'%s' ha†%zuÅokís", 
fûe_«me
, 
	`tokí_li°_cou¡
(
é
));

1356 
íd
:

1357 
	`èŒoc_‰ì
(
ãxt
);

1358 i‡(
f
)

1359 
	`f˛o£
(
f
);

1360 
	}
}

1362 
	$ã°_tokíizî
() {

1363 
tok_mesßge_queue
 
mq
;

1364 
size_t
 
i
, 
cou¡
;

1365 
has_w¨n_‹_w‹£
 = 0;

1367 
	`queue_öô
(
mq
, 
NULL
);

1369 
cou¡
 = (
tokíizî_ã°s
)/(*tokenizer_tests);

1370 
i
=0; i<
cou¡
; i++) {

1371 
	`ã°_tokíizî_sögÀ
(
tokíizî_ã°s
+
i
, &
mq
);

1372 
	`queue_cou¡
(
mq
)) {

1373 
tok_mesßge
 
msg
 = 
	`dequeue
(
mq
);

1374 (Ë
msg
;

1379 
cou¡
 = (
tokíizî_msg_ã°s
)/(*tokenizer_msg_tests);

1380 
i
=0; i<
cou¡
; i++) {

1381 
size_t
 
j
;

1382 
	`ã°_tokíizî_sögÀ
(&
tokíizî_msg_ã°s
[
i
].
ã°
, &
mq
);

1384 i‡(
	`queue_cou¡
(
mq
Ë!
tokíizî_msg_ã°s
[
i
].
mesßge_cou¡
) {

1385 
	`Áû
("IncorrectÇumber of messages fromÅokenize()");

1386 
	`queue_cou¡
(
mq
))

1387 (Ë
	`dequeue
(
mq
);

1388 
msg_Áû
;

1391 
j
=0; 
	`queue_cou¡
(
mq
); j++) {

1392 
tok_mesßge
 
msg
 = 
	`dequeue
(
mq
);

1393 c⁄° *
ba£
 = "tokenize/";

1394 
size_t
 
ba£Àn
 = 
	`°æí
(
ba£
);

1397 i‡(
	`°∫cmp
(
msg
.
∑th
, 
ba£
, 
ba£Àn
)) {

1398 
	`Áû
("Message fromÅokenize() doesn't start with \"%s\"",

1399 
ba£
);

1400 
msg_Áû
;

1402 i‡(
	`°rcmp
(
msg
.
∑th
+
ba£Àn
,

1403 
tokíizî_msg_ã°s
[
i
].
mesßges
[
j
])) {

1404 
	`Áû
("Incorrect message %s, should be %s",

1405 
msg
.
∑th
+
ba£Àn
, 
tokíizî_msg_ã°s
[
i
].
mesßges
[
j
]);

1406 
msg_Áû
;

1410 
	`∑ss
("Messages fromÅokenize()áre correct");

1411 
msg_Áû
:;

1414 
	`ã°_tokíizî_fûe
("ã°/run.c", &
mq
);

1416 
	`queue_cou¡
(
mq
)) {

1417 
tok_mesßge
 
msg
 = 
	`dequeue
(
mq
);

1418 i‡(
msg
.
Àvñ
 >
TM_WARN
) {

1419 
has_w¨n_‹_w‹£
 = 1;

1420 
	`tok_mesßge_dump
(&
msg
);

1425 
	`ok
(
has_w¨n_‹_w‹£
==0, "TokenizingÑun.c generated%s warnings,Érrors, or bugs",

1426 
has_w¨n_‹_w‹£
 ? "" : "Ço");

1428 
	`queue_‰ì
(
mq
);

1429 
	}
}

1431 
	~<uni°d.h
>

1433 
	$maö
()

1435 
	`∂™_ã°s
(195);

1437 
	`düg
("* Checking queue...");

1438 
	`ã°_queue
();

1440 
	`düg
("* CheckingÑead_cstring...");

1441 
	`ã°_ªad_c°rög
();

1443 
	`düg
("* Checking dict...");

1444 
	`ã°_di˘
();

1446 
	`düg
("* Checking charflag...");

1447 
	`ã°_ch¨Êag
();

1449 
	`düg
("* CheckingÑeadui...");

1450 
	`ã°_ªadui
();

1452 
	`düg
("* Checking scan_number...");

1453 
	`ã°_sˇn_numbî
();

1455 
	`düg
("* CheckingÑead_integer...");

1456 
	`ã°_ªad_öãgî
();

1458 
	`düg
("* CheckingÑead_floating...");

1459 
	`ã°_ªad_Êﬂtög
();

1461 
	`düg
("* CheckingÅokenizer...");

1462 
	`ã°_tokíizî
();

1465  
	`exô_°©us
();

1466 
	}
}

	@ccan/ccan/charset/charset.c

24 
	~"ch¨£t.h
"

25 
	~<as£π.h
>

28 
boﬁ
 
	$utf8_vÆid©e
(c⁄° *
°r
, 
size_t
 
Àngth
)

30 c⁄° *
s
 = 
°r
;

31 c⁄° *
e
 = 
°r
 + 
Àngth
;

32 
Àn
;

34 ; 
s
 < 
e
; s +
Àn
) {

35 
Àn
 = 
	`utf8_vÆid©e_ch¨
(
s
, 
e
);

36 i‡(
Àn
 == 0)

37  
Ál£
;

39 
	`as£π
(
s
 =
e
);

41  
åue
;

42 
	}
}

58 
	$utf8_vÆid©e_ch¨
(c⁄° *
s
, c⁄° *
e
)

60 
c
 = *
s
++;

62 i‡(
c
 <= 0x7F) {

64 } i‡(
c
 <= 0xC1) {

67 } i‡(
c
 <= 0xDF) {

69 i‡(
e
 - 
s
 < 1)

73 i‡((()*
s
++ & 0xC0) != 0x80)

77 } i‡(
c
 <= 0xEF) {

79 i‡(
e
 - 
s
 < 2)

83 i‡(
c
 =0xE0 && ()*
s
 < 0xA0)

87 i‡(
c
 =0xED && ()*
s
 > 0x9F)

91 i‡((()*
s
++ & 0xC0) != 0x80)

93 i‡((()*
s
++ & 0xC0) != 0x80)

97 } i‡(
c
 <= 0xF4) {

99 i‡(
e
 - 
s
 < 3)

103 i‡(
c
 =0xF0 && ()*
s
 < 0x90)

107 i‡(
c
 =0xF4 && ()*
s
 > 0x8F)

111 i‡((()*
s
++ & 0xC0) != 0x80)

113 i‡((()*
s
++ & 0xC0) != 0x80)

115 i‡((()*
s
++ & 0xC0) != 0x80)

122 
	}
}

124 
	$utf8_ªad_ch¨
(c⁄° *
s
, 
uch¨_t
 *
out
)

126 c⁄° *
c
 = (c⁄° *Ë
s
;

128 i‡(
c
[0] <= 0x7F) {

130 *
out
 = 
c
[0];

132 } i‡(
c
[0] <= 0xDF) {

134 *
out
 = ((
uch¨_t
)
c
[0] & 0x1F) << 6 |

135 ((
uch¨_t
)
c
[1] & 0x3F);

137 } i‡(
c
[0] <= 0xEF) {

139 *
out
 = ((
uch¨_t
)
c
[0] & 0xF) << 12 |

140 ((
uch¨_t
)
c
[1] & 0x3F) << 6 |

141 ((
uch¨_t
)
c
[2] & 0x3F);

145 *
out
 = ((
uch¨_t
)
c
[0] & 0x7) << 18 |

146 ((
uch¨_t
)
c
[1] & 0x3F) << 12 |

147 ((
uch¨_t
)
c
[2] & 0x3F) << 6 |

148 ((
uch¨_t
)
c
[3] & 0x3F);

151 
	}
}

153 
	$utf8_wrôe_ch¨
(
uch¨_t
 
unicode
, *
out
)

155 *
o
 = (*Ë
out
;

157 i‡(
unicode
 <= 0x7F) {

159 *
o
++ = 
unicode
;

161 } i‡(
unicode
 <= 0x7FF) {

163 *
o
++ = 0xC0 | 
unicode
 >> 6;

164 *
o
++ = 0x80 | (
unicode
 & 0x3F);

166 } i‡(
unicode
 <= 0xFFFF) {

168 i‡(
unicode
 >= 0xD800 && unicode <= 0xDFFF)

169 
unicode
 = 
REPLACEMENT_CHARACTER
;

170 
thªe_byã_ch¨a˘î
:

171 *
o
++ = 0xE0 | 
unicode
 >> 12;

172 *
o
++ = 0x80 | (
unicode
 >> 6 & 0x3F);

173 *
o
++ = 0x80 | (
unicode
 & 0x3F);

175 } i‡(
unicode
 <= 0x10FFFF) {

177 *
o
++ = 0xF0 | 
unicode
 >> 18;

178 *
o
++ = 0x80 | (
unicode
 >> 12 & 0x3F);

179 *
o
++ = 0x80 | (
unicode
 >> 6 & 0x3F);

180 *
o
++ = 0x80 | (
unicode
 & 0x3F);

184 
unicode
 = 
REPLACEMENT_CHARACTER
;

185 
thªe_byã_ch¨a˘î
;

187 
	}
}

189 
uch¨_t
 
	$‰om_suºog©e_∑ú
(
uc
, 
lc
)

191 i‡(
uc
 >0xD800 && u¯<0xDBFF && 
lc
 >= 0xDC00 &&Üc <= 0xDFFF)

192  0x10000 + ((((
uch¨_t
)
uc
 & 0x3FFË<< 10Ë| (
lc
 & 0x3FF));

194  
REPLACEMENT_CHARACTER
;

195 
	}
}

197 
boﬁ
 
	$to_suºog©e_∑ú
(
uch¨_t
 
unicode
, *
uc
, *
lc
)

199 i‡(
unicode
 >= 0x10000 && unicode <= 0x10FFFF) {

200 
uch¨_t
 
n
 = 
unicode
 - 0x10000;

201 *
uc
 = ((
n
 >> 10) & 0x3FF) | 0xD800;

202 *
lc
 = (
n
 & 0x3FF) | 0xDC00;

203  
åue
;

205 *
uc
 = *
lc
 = 
REPLACEMENT_CHARACTER
;

206  
Ál£
;

208 
	}
}

	@ccan/ccan/charset/charset.h

24 #i‚de‡
CCAN_CHARSET_H


25 
	#CCAN_CHARSET_H


	)

27 
	~<°dboﬁ.h
>

28 
	~<°ddef.h
>

29 
	~<°döt.h
>

31 
	#REPLACEMENT_CHARACTER
 0xFFFD

	)

37 
uöt32_t
 
	tuch¨_t
;

43 
boﬁ
 
utf8_vÆid©e
(c⁄° *
°r
, 
size_t
 
Àngth
);

53 
utf8_vÆid©e_ch¨
(c⁄° *
s
, c⁄° *
e
);

62 
utf8_ªad_ch¨
(c⁄° *
s
, 
uch¨_t
 *
out
);

73 
utf8_wrôe_ch¨
(
uch¨_t
 
unicode
, *
out
);

81 
uch¨_t
 
‰om_suºog©e_∑ú
(
uc
, 
lc
);

90 
boﬁ
 
to_suºog©e_∑ú
(
uch¨_t
 
unicode
, *
uc
, *
lc
);

	@ccan/ccan/charset/test/common.h

1 
	~<°döt.h
>

2 
	~<°dlib.h
>

10 
uöt32_t
 
	$ønd32
()

19 
	`as£π
(
RAND_MAX
 == 2147483647);

20  ((
	`øndom
() & 0xFFFF) << 16) | (random() & 0xFFFF);

22 
uöt32_t
 
ønd32_°©e
 = 0;

23 
ønd32_°©e
 *(
uöt32_t
)0x7FF8A3ED;

24 
ønd32_°©e
 +(
uöt32_t
)0x2AA01D31;

25  
ønd32_°©e
;

27 
	}
}

	@ccan/ccan/charset/test/run-surrogate-pair.c

1 
	~<cˇn/ch¨£t/ch¨£t.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	~<°rög.h
>

6 
	~"comm⁄.h
"

29 
	#INVALID_TRIAL_COUNT
 10000

	)

31 
	#ønge
(
r
, 
lo
, 
hi
Ë(‘Ë% ((hi)-÷o)+1Ë+ (lo))

	)

33 
	$ã°_vÆid
()

35 
uch¨_t
 
unicode
;

36 
uc
, 
lc
;

38 
unicode
 = 0x10000; unicode <= 0x10FFFF; unicode++) {

39 i‡(
	`to_suºog©e_∑ú
(
unicode
, &
uc
, &
lc
Ë!
åue
) {

40 
	`Áû
("to_surrogate_pair didÇotÑeturnÅrue on valid input.");

43 i‡(!(
uc
 >= 0xD800 && uc <= 0xDBFF)) {

44 
	`Áû
("to_surrogate_pair: uc is out ofÑange");

47 i‡(!(
lc
 >= 0xDC00 &&Üc <= 0xDFFF)) {

48 
	`Áû
("to_surrogate_pair:Üc is out ofÑange");

51 i‡(
	`‰om_suºog©e_∑ú
(
uc
, 
lc
Ë!
unicode
) {

52 
	`Áû
("Suºog©ê∑ú c⁄vîsi⁄ didÇŸÖª£rvê‹igöÆ vÆuê(U+%04lX).", ()
unicode
);

57 
	`∑ss
("to_surrogate_pairánd from_surrogate_pair work foráll validárguments.");

58 
	}
}

60 
	$ã°_övÆid_to_suºog©e_∑ú
()

62 
i
;

63 
uch¨_t
 
unicode
;

64 
uc
, 
lc
;

66 
i
 = 1; i <
INVALID_TRIAL_COUNT
; i++) {

67 i‡(
	`ønd32
() % 2) {

68 
unicode
 = 
	`ønge
(
	`ønd32
(), 0x0, 0xFFFF);

71 
unicode
 = 
	`ønd32
();

72 } 
unicode
 < 0x110000);

75 i‡(
	`to_suºog©e_∑ú
(
unicode
, &
uc
, &
lc
Ë!
Ál£
) {

76 
	`Áû
("to_surrogate_pair didÇotÑeturn false on invalid input.");

79 i‡(
uc
 !
REPLACEMENT_CHARACTER
 || 
lc
 != REPLACEMENT_CHARACTER) {

80 
	`Áû
("to_surrogate_pair didÇot set ucándÜcÅoÅheÑeplacement character on invalid input.");

85 
	`∑ss
("to_surrogate_pair seemsÅo handle invalidárgument valuesÖroperly.");

86 
	}
}

88 
	$ã°_övÆid_‰om_suºog©e_∑ú
()

90 
i
;

91 
uc
, 
lc
;

93 
i
 = 1; i <
INVALID_TRIAL_COUNT
; i++) {

94 
	`ønd32
() % 3) {

96 
uc
 = 
	`ønge
(
	`ønd32
(), 0x0, 0xD7FF);

99 
uc
 = 
	`ønge
(
	`ønd32
(), 0xDC00, 0xDFFF);

102 
uc
 = 
	`ønge
(
	`ønd32
(), 0xE000, 0xFFFF);

105 
	`ønd32
() % 3) {

107 
lc
 = 
	`ønge
(
	`ønd32
(), 0x0, 0xD7FF);

110 
lc
 = 
	`ønge
(
	`ønd32
(), 0xD800, 0xDBFF);

113 
lc
 = 
	`ønge
(
	`ønd32
(), 0xE000, 0xFFFF);

117 i‡(
	`‰om_suºog©e_∑ú
(
uc
, 
lc
Ë!
REPLACEMENT_CHARACTER
) {

118 
	`Áû
("‰om_suºog©e_∑ú(0x%04X, 0x%04XËdidÇŸÑëu∫Åhêª∂a˚míàch¨a˘î", 
uc
, 
lc
);

123 
	`∑ss
("from_surrogate_pair seemsÅo handle invalidárgumentsÖroperly.");

124 
	}
}

126 
	$maö
()

128 
	`∂™_ã°s
(3);

130 
	`ã°_vÆid
();

131 
	`ã°_övÆid_to_suºog©e_∑ú
();

132 
	`ã°_övÆid_‰om_suºog©e_∑ú
();

134  
	`exô_°©us
();

135 
	}
}

	@ccan/ccan/charset/test/run-utf8-read-write.c

1 
	~<cˇn/ch¨£t/ch¨£t.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	~<°rög.h
>

6 
	~"comm⁄.h
"

24 
	#TRIAL_COUNT
 1000

	)

25 
	#MAX_CHARS_PER_TRIAL
 100

	)

27 
	#ønge
(
r
, 
lo
, 
hi
Ë(‘Ë% ((hi)-÷o)+1Ë+ (lo))

	)

29 
	$maö
()

31 
åül
;

33 
	`∂™_ã°s
(
TRIAL_COUNT
);

35 
åül
 = 1;Årü»<
TRIAL_COUNT
;Årial++) {

36 
i
, 
cou¡
;

37 
uch¨_t
 
codïoöts
[
MAX_CHARS_PER_TRIAL
];

38 
uch¨_t
 
c
;

39 
boﬁ
 
c_vÆid
;

41 
wrôe_buf„r
[
MAX_CHARS_PER_TRIAL
 * 4];

42 *
o
 = 
wrôe_buf„r
;

43 *
€
 = 
wrôe_buf„r
 + (write_buffer);

45 *
°rög
;

46 c⁄° *
s
;

47 c⁄° *
e
;

49 
Àn
;

51 
cou¡
 = 
	`ønd32
(Ë% 
MAX_CHARS_PER_TRIAL
 + 1;

53 
i
 = 0; i < 
cou¡
; i++) {

54 i‡(
o
 >
€
) {

55 
	`Áû
("utf8_write_char: Buffer overflow (1)");

56 
√xt_åül
;

59 
	`ønd32
() % 7) {

61 
c
 = 
	`ønge
(
	`ønd32
(), 0x0, 0x7F);

62 
c_vÆid
 = 
åue
;

65 
c
 = 
	`ønge
(
	`ønd32
(), 0x80, 0x7FF);

66 
c_vÆid
 = 
åue
;

69 
c
 = 
	`ønge
(
	`ønd32
(), 0x800, 0xD7FF);

70 
c_vÆid
 = 
åue
;

73 
c
 = 
	`ønge
(
	`ønd32
(), 0xD800, 0xDFFF);

74 
c_vÆid
 = 
Ál£
;

77 
c
 = 
	`ønge
(
	`ønd32
(), 0xE000, 0xFFFF);

78 
c_vÆid
 = 
åue
;

81 
c
 = 
	`ønge
(
	`ønd32
(), 0x10000, 0x10FFFF);

82 
c_vÆid
 = 
åue
;

86 
c
 = 
	`ønd32
();

87 } 
c
 < 0x110000);

88 
c_vÆid
 = 
Ál£
;

92 
codïoöts
[
i
] = 
c_vÆid
 ? 
c
 : 
REPLACEMENT_CHARACTER
;

94 
Àn
 = 
	`utf8_wrôe_ch¨
(
c
, 
o
);

95 i‡(
Àn
 < 1 ||Üen > 4) {

96 
	`Áû
("utf8_write_char: Return value isÇot 1Åhru 4.");

97 
√xt_åül
;

99 
o
 +
Àn
;

101 i‡(
o
 > 
€
) {

102 
	`Áû
("utf8_write_char: Buffer overflow (2)");

103 
√xt_åül
;

106 
°rög
 = 
	`mÆloc
(
o
 - 
wrôe_buf„r
);

107 
	`mem˝y
(
°rög
, 
wrôe_buf„r
, 
o
 - write_buffer);

108 
s
 = 
°rög
;

109 
e
 = 
°rög
 + (
o
 - 
wrôe_buf„r
);

111 i‡(!
	`utf8_vÆid©e
(
s
, 
e
 - s)) {

112 
	`Áû
("Invalid stringÖroduced by utf8_write_char.");

113 
√xt_åül_‰ì_°rög
;

116 
i
 = 0; i < 
cou¡
; i++) {

117 i‡(
s
 >
e
) {

118 
	`Áû
("utf8_read_char: Buffer overflow (1)");

119 
√xt_åül_‰ì_°rög
;

122 
Àn
 = 
	`utf8_ªad_ch¨
(
s
, &
c
);

123 i‡(
Àn
 < 1 ||Üen > 4) {

124 
	`Áû
("utf8_read_char: Return value isÇot 1Åhru 4.");

125 
√xt_åül_‰ì_°rög
;

127 i‡(
c
 !
codïoöts
[
i
]) {

128 
	`Áû
("utf8_read_char: CharacterÑead differs fromÅhat written.");

129 
√xt_åül_‰ì_°rög
;

131 
s
 +
Àn
;

133 i‡(
s
 > 
e
) {

134 
	`Áû
("utf8_read_char: Buffer overflow (2)");

135 
√xt_åül_‰ì_°rög
;

137 i‡(
s
 < 
e
) {

138 
	`Áû
("utf8_read_char: DidÇotÑeachÉnd of string.");

139 
√xt_åül_‰ì_°rög
;

142 
	`∑ss
("Trü»%d: %d ch¨a˘îs", 
åül
, 
cou¡
);

144 
√xt_åül_‰ì_°rög
:

145 
	`‰ì
(
°rög
);

146 
√xt_åül
:;

149  
	`exô_°©us
();

150 
	}
}

	@ccan/ccan/charset/test/run-utf8_validate.c

1 
	~<cˇn/ch¨£t/ch¨£t.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	~<as£π.h
>

5 
	~<m©h.h
>

6 
	~<°dio.h
>

7 
	~<°rög.h
>

9 
	~"comm⁄.h
"

12 
uch¨_t
 
	$utf8_øndcode
(
Àn
, 
boﬁ
 
vÆid
, boﬁ 
a·î_˛ù≥d
)

14 
uöt32_t
 
r
 = 
	`ønd32
();

15 
uch¨_t
 
ªt
;

17 
	#ønge
(
lo
, 
hi
Ë((
r
 & 0x7FFFFFFFË% ((hi)-÷o)+1Ë+ (lo))

	)

18 
	#high_bô_£t
(Ë(!!(
r
 & 0x80000000))

	)

20 
Àn
) {

22 i‡(
vÆid
) {

24  
r
 & 0x7F;

33 i‡(!
a·î_˛ù≥d
 && 
	`high_bô_£t
())

34  
	`ønge
(0x80, 0xBF);

36  
	`ønge
(0xF8, 0xFF);

39 i‡(
vÆid
) {

41  
	`ønge
(0x80, 0x7FF);

44  
r
 & 0x7F;

47 i‡(
vÆid
) {

50 
ªt
 = 
	`ønge
(0x800, 0xFFFF);

51 i‡(
ªt
 >= 0xD800 &&Ñet <= 0xDFFF) {

52 
r
 = 
	`ønd32
();

58  
ªt
;

61 i‡(
	`high_bô_£t
())

62  
r
 & 0x7FF;

64  0xD800 + (
r
 & 0x7FF);

67 i‡(
vÆid
) {

69  
	`ønge
(0x10000, 0x10FFFF);

72 i‡(
	`high_bô_£t
())

73  
r
 & 0xFFFF;

75  
	`ønge
(0x110000, 0x1FFFFF);

78 
	`as£π
(
Ál£
);

81 #unde‡
ønge


82 #unde‡
high_bô_£t


83 
	}
}

87 
	$utf8_ícode_øw
(*
out
, 
uc
, 
Àn
)

89 
Àn
) {

91 
	`as£π
(
uc
 <= 0xC1 || (uc >= 0xF8 && uc <= 0xFF));

92 *
out
++ = 
uc
;

95 
	`as£π
(
uc
 <= 0x7FF);

96 *
out
++ = 0xC0 | ((
uc
 >> 6) & 0x1F);

97 *
out
++ = 0x80 | (
uc
 & 0x3F);

100 
	`as£π
(
uc
 <= 0xFFFF);

101 *
out
++ = 0xE0 | ((
uc
 >> 12) & 0x0F);

102 *
out
++ = 0x80 | ((
uc
 >> 6) & 0x3F);

103 *
out
++ = 0x80 | (
uc
 & 0x3F);

106 
	`as£π
(
uc
 <= 0x1FFFFF);

107 *
out
++ = 0xF0 | ((
uc
 >> 18) & 0x07);

108 *
out
++ = 0x80 | ((
uc
 >> 12) & 0x3F);

109 *
out
++ = 0x80 | ((
uc
 >> 6) & 0x3F);

110 *
out
++ = 0x80 | (
uc
 & 0x3F);

113 
	}
}

115 #i‡
COMPUTE_AVERAGE_LENGTH


116 
	gtŸÆ_avîages
;

123 
boﬁ
 
	$utf8_mkã°
(*
out
, 
Àn
)

125 
pf
;

126 
uöt32_t
 
pu
;

127 
n
;

128 
boﬁ
 
vÆid
 = 
åue
;

129 
boﬁ
 
v
;

130 
boﬁ
 
a·î_˛ù≥d
 = 
Ál£
;

132 #i‡
COMPUTE_AVERAGE_LENGTH


133 
n_tŸÆ
 = 0;

134 
cou¡
 = 0;

153 
pf
 = 
	`pow
(0.5, 2.384/
Àn
);

156 
pu
 = 
pf
 * 4294967295.0;

158 ;
Àn
 > 0;Üí -
n
, 
out
 +=Ç) {

159 
v
 = 
	`ønd32
(Ë<
pu
;

161 i‡(
v
) {

163 
n
 = 
	`ønd32
(Ë% (
Àn
 < 4 ?Üen : 4) + 1;

164 
	`utf8_ícode_øw
(
out
, 
	`utf8_øndcode
(
n
, 
åue
, 
a·î_˛ù≥d
),Ç);

165 
a·î_˛ù≥d
 = 
Ál£
;

166 } i‡(
	`ønd32
() % 5) {

168 
n
 = 
	`ønd32
(Ë% (
Àn
 < 4 ?Üen : 4) + 1;

169 
	`utf8_ícode_øw
(
out
, 
	`utf8_øndcode
(
n
, 
Ál£
, 
a·î_˛ù≥d
),Ç);

170 
a·î_˛ù≥d
 = 
Ál£
;

173 
tmp
[4];

174 
n
 = 
	`ønd32
() % 3 + 2;

175 
	`utf8_ícode_øw
(
tmp
, 
	`utf8_øndcode
(
n
, 
åue
, 
a·î_˛ù≥d
),Ç);

176 
n
 -
	`ønd32
() % (n-1) + 1;

177 i‡(
n
 > 
Àn
)

178 
n
 = 
Àn
;

179 
	`as£π
(
n
 >= 1 &&Ç <= 3);

180 
	`mem˝y
(
out
, 
tmp
, 
n
);

181 
a·î_˛ù≥d
 = 
åue
;

184 i‡(!
v
)

185 
vÆid
 = 
Ál£
;

187 #i‡
COMPUTE_AVERAGE_LENGTH


188 
n_tŸÆ
 +
n
;

189 
cou¡
++;

193 #i‡
COMPUTE_AVERAGE_LENGTH


194 i‡(
cou¡
 > 0)

195 
tŸÆ_avîages
 +()
n_tŸÆ
 / 
cou¡
;

198  
vÆid
;

199 
	}
}

201 
	$ã°_utf8_vÆid©e
()

203 
buf„r
[128];

204 
i
;

205 
Àn
;

206 
boﬁ
 
vÆid
;

207 
∑s£d
=0, 
p_vÆid
=0, 
p_övÆid
=0, 
tŸÆ
=0;

208 
cou¡
;

210 
cou¡
 = 100000;

212 #i‡
COMPUTE_AVERAGE_LENGTH


213 
tŸÆ_avîages
 = 0.0;

216 
i
=0; i<
cou¡
; i++) {

217 
Àn
 = 
	`ønd32
(Ë% ((
buf„r
) + 1);

218 
vÆid
 = 
	`utf8_mkã°
(
buf„r
, 
Àn
);

219 i‡(
	`utf8_vÆid©e
(
buf„r
, 
Àn
Ë=
vÆid
) {

220 
∑s£d
++;

221 i‡(
vÆid
)

222 
p_vÆid
++;

224 
p_övÆid
++;

226 
boﬁ
 
uvÆid
 = 
	`utf8_vÆid©e
(
buf„r
, 
Àn
);

227 
	`¥ötf
("Failed: generated %s string, but utf8_validateÑeturned %s\n",

228 
vÆid
 ? "valid" : "invalid",

229 
uvÆid
 ? "true" : "false");

231 
tŸÆ
++;

234 i‡(
∑s£d
 =
tŸÆ
)

235 
	`∑ss
("%d vÆidÅe°s, %d invÆidÅe°s", 
p_vÆid
, 
p_övÆid
);

237 
	`Áû
("Pas£d o∆y %d ouào‡%dÅe°s\n", 
∑s£d
, 
tŸÆ
);

239 
	`ok
(
p_vÆid
 > 
cou¡
/10 && 
p_övÆid
 > count/10,

242 #i‡
COMPUTE_AVERAGE_LENGTH


243 
	`¥ötf
("Avîagêch¨a˘îÜígth: %f\n", 
tŸÆ_avîages
 / 
cou¡
);

245 
	}
}

247 
	$maö
()

250 
	`∂™_ã°s
(2);

252 
	`ã°_utf8_vÆid©e
();

255  
	`exô_°©us
();

256 
	}
}

	@ccan/ccan/check_type/check_type.h

2 #i‚de‡
CCAN_CHECK_TYPE_H


3 
	#CCAN_CHECK_TYPE_H


	)

4 
	~"c⁄fig.h
"

48 #i‡
HAVE_TYPEOF


49 
	#check_ty≥
(
ex¥
, 
ty≥
) \

50 ((
	`ty≥of
(
ex¥
Ë*)0 !(
ty≥
 *)0)

	)

52 
	#check_ty≥s_m©ch
(
ex¥1
, 
ex¥2
) \

53 ((
	`ty≥of
(
ex¥1
Ë*)0 !—y≥of(
ex¥2
Ë*)0)

	)

55 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

57 
	#check_ty≥
(
ex¥
, 
ty≥
) \

58 
	`BUILD_ASSERT_OR_ZERO
((
ex¥
Ë=(
ty≥
))

	)

60 
	#check_ty≥s_m©ch
(
ex¥1
, 
ex¥2
) \

61 
	`BUILD_ASSERT_OR_ZERO
((
ex¥1
Ë=(
ex¥2
))

	)

	@ccan/ccan/check_type/test/compile_fail-check_type.c

1 
	~<cˇn/check_ty≥/check_ty≥.h
>

3 
	$maö
(
¨gc
, *
¨gv
[])

5 #ifde‡
FAIL


6 
	`check_ty≥
(
¨gc
, );

9 
	}
}

	@ccan/ccan/check_type/test/compile_fail-check_type_unsigned.c

1 
	~<cˇn/check_ty≥/check_ty≥.h
>

3 
	$maö
(
¨gc
, *
¨gv
[])

5 #ifde‡
FAIL


6 #i‡
HAVE_TYPEOF


7 
	`check_ty≥
(
¨gc
, );

14 
	}
}

	@ccan/ccan/check_type/test/compile_fail-check_types_match.c

1 
	~<cˇn/check_ty≥/check_ty≥.h
>

3 
	$maö
(
¨gc
, *
¨gv
[])

5 
x
 = 
¨gc
;

6 #ifde‡
FAIL


7 
	`check_ty≥s_m©ch
(
¨gc
, 
x
);

9  
x
;

10 
	}
}

	@ccan/ccan/check_type/test/run.c

1 
	~<cˇn/check_ty≥/check_ty≥.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 
x
 = 0, 
y
 = 0;

8 
	`∂™_ã°s
(9);

10 
	`ok1
(
	`check_ty≥
(
¨gc
, ) == 0);

11 
	`ok1
(
	`check_ty≥
(&
¨gc
, *) == 0);

12 
	`ok1
(
	`check_ty≥s_m©ch
(
¨gc
,árgc) == 0);

13 
	`ok1
(
	`check_ty≥s_m©ch
(
¨gc
, 
x
) == 0);

14 
	`ok1
(
	`check_ty≥s_m©ch
(&
¨gc
, &
x
) == 0);

16 
	`ok1
(
	`check_ty≥
(
x
++, ) == 0);

17 
	`ok
(
x
 == 0, "check_type doesÇotÉvaluateÉxpression");

18 
	`ok1
(
	`check_ty≥s_m©ch
(
x
++, 
y
++) == 0);

19 
	`ok
(
x
 =0 && 
y
 == 0, "check_types_match doesÇotÉvaluateÉxpressions");

21  
	`exô_°©us
();

22 
	}
}

	@ccan/ccan/ciniparser/ciniparser.c

35 
	~<˘y≥.h
>

36 
	~<cˇn/cöù¨£r/cöù¨£r.h
>

38 
	#ASCIILINESZ
 (1024)

	)

39 
	#INI_INVALID_KEY
 ((*Ë
NULL
)

	)

44 
	e_löe_°©us_
 {

45 
	mLINE_UNPROCESSED
,

46 
	mLINE_ERROR
,

47 
	mLINE_EMPTY
,

48 
	mLINE_COMMENT
,

49 
	mLINE_SECTION
,

50 
	mLINE_VALUE


51 } 
	tlöe_°©us
;

64 *
	$°æwc
(c⁄° *
s
)

66 
l
[
ASCIILINESZ
+1];

67 
i
;

69 i‡(
s
 =
NULL
)

70  
NULL
;

72 
i
 = 0; 
s
[i] && i < 
ASCIILINESZ
; i++)

73 
l
[
i
] = 
	`tﬁowî
(
s
[i]);

74 
l
[
i
] = '\0';

75  
l
;

76 
	}
}

90 *
	$°r°rù
(c⁄° *
s
)

92 
l
[
ASCIILINESZ
+1];

93 
i
, 
num•c
;

95 i‡(
s
 =
NULL
)

96  
NULL
;

98 
	`is•a˚
(*
s
))

99 
s
++;

101 
i
 = 
num•c
 = 0; 
s
[i] && i < 
ASCIILINESZ
; i++) {

102 
l
[
i
] = 
s
[i];

103 i‡(
	`is•a˚
(
l
[
i
]))

104 
num•c
++;

106 
num•c
 = 0;

108 
l
[
i
 - 
num•c
] = '\0';

109  
l
;

110 
	}
}

121 
löe_°©us
 
	$cöù¨£r_löe
(*
öput_löe
, *
£˘i⁄
,

122 *
key
, *
vÆue
)

124 
löe_°©us
 
°a
;

125 
löe
[
ASCIILINESZ
+1];

126 
Àn
;

128 
	`°r˝y
(
löe
, 
	`°r°rù
(
öput_löe
));

129 
Àn
 = (Ë
	`°æí
(
löe
);

131 i‡(
Àn
 < 1) {

133 
°a
 = 
LINE_EMPTY
;

134 } i‡(
löe
[0] == '#') {

136 
°a
 = 
LINE_COMMENT
;

137 } i‡(
löe
[0] ='[' &&Üöe[
Àn
-1] == ']') {

139 
	`ssˇnf
(
löe
, "[%[^]]", 
£˘i⁄
);

140 
	`°r˝y
(
£˘i⁄
, 
	`°r°rù
(section));

141 
	`°r˝y
(
£˘i⁄
, 
	`°æwc
(section));

142 
°a
 = 
LINE_SECTION
;

143 } i‡(
	`ssˇnf
 (
löe
, "%[^=] = \"%[^\"]\"", 
key
, 
vÆue
) == 2

144 || 
	`ssˇnf
 (
löe
, "%[^=] = '%[^\']'", 
key
, 
vÆue
) == 2

145 || 
	`ssˇnf
 (
löe
, "%[^=] = %[^;#]", 
key
, 
vÆue
) == 2) {

147 
	`°r˝y
(
key
, 
	`°r°rù
(key));

148 
	`°r˝y
(
key
, 
	`°æwc
(key));

149 
	`°r˝y
(
vÆue
, 
	`°r°rù
(value));

154 i‡(!
	`°rcmp
(
vÆue
, "\"\"") || (!strcmp(value, "''"))) {

155 
vÆue
[0] = 0;

157 
°a
 = 
LINE_VALUE
;

158 } i‡(
	`ssˇnf
(
löe
, "%[^=] = %[;#]", 
key
, 
vÆue
) == 2

159 || 
	`ssˇnf
(
löe
, "%[^=] %[=]", 
key
, 
vÆue
) == 2) {

166 
	`°r˝y
(
key
, 
	`°r°rù
(key));

167 
	`°r˝y
(
key
, 
	`°æwc
(key));

168 
vÆue
[0] = 0;

169 
°a
 = 
LINE_VALUE
;

172 
°a
 = 
LINE_ERROR
;

174  
°a
;

175 
	}
}

179 
	$cöù¨£r_gën£c
(
di˘i⁄¨y
 *
d
)

181 
i
;

182 
n£c
;

184 i‡(
d
 =
NULL
)

187 
n£c
 = 0;

188 
i
 = 0; i < 
d
->
size
; i++) {

189 i‡(
d
->
key
[
i
] =
NULL
)

191 i‡(
	`°rchr
(
d
->
key
[
i
], ':'Ë=
NULL
) {

192 
n£c
 ++;

196  
n£c
;

197 
	}
}

199 *
	$cöù¨£r_gë£˙ame
(
di˘i⁄¨y
 *
d
, 
n
)

201 
i
;

202 
found£c
;

204 i‡(
d
 =
NULL
 || 
n
 < 0)

205  
NULL
;

207 i‡(
n
 == 0)

208 
n
 ++;

210 
found£c
 = 0;

212 
i
 = 0; i < 
d
->
size
; i++) {

213 i‡(
d
->
key
[
i
] =
NULL
)

215 i‡(! 
	`°rchr
(
d
->
key
[
i
], ':')) {

216 
found£c
++;

217 i‡(
found£c
 >
n
)

222 i‡(
found£c
 =
n
) {

223  
d
->
key
[
i
];

226  (*Ë
NULL
;

227 
	}
}

229 
	$cöù¨£r_dump
(
di˘i⁄¨y
 *
d
, 
FILE
 *
f
)

231 
i
;

233 i‡(
d
 =
NULL
 || 
f
 == NULL)

236 
i
 = 0; i < 
d
->
size
; i++) {

237 i‡(
d
->
key
[
i
] =
NULL
)

239 i‡(
d
->
vÆ
[
i
] !
NULL
) {

240 
	`Ârötf
(
f
, "[%s]=[%s]\n", 
d
->
key
[
i
], d->
vÆ
[i]);

242 
	`Ârötf
(
f
, "[%s]=UNDEF\n", 
d
->
key
[
i
]);

247 
	}
}

249 
	$cöù¨£r_dump_öi
(
di˘i⁄¨y
 *
d
, 
FILE
 *
f
)

251 
i
, 
j
;

252 
keym
[
ASCIILINESZ
+1];

253 
n£c
;

254 *
£˙ame
;

255 
£˛í
;

257 i‡(
d
 =
NULL
 || 
f
 == NULL)

260 
	`mem£t
(
keym
, 0, 
ASCIILINESZ
 + 1);

262 
n£c
 = 
	`cöù¨£r_gën£c
(
d
);

263 i‡(
n£c
 < 1) {

265 
i
 = 0; i < 
d
->
size
; i++) {

266 i‡(
d
->
key
[
i
] =
NULL
)

268 
	`Ârötf
(
f
, "%†%s\n", 
d
->
key
[
i
], d->
vÆ
[i]);

273 
i
 = 0; i < 
n£c
; i++) {

274 
£˙ame
 = 
	`cöù¨£r_gë£˙ame
(
d
, 
i
);

275 
£˛í
 = ()
	`°æí
(
£˙ame
);

276 
	`Ârötf
(
f
, "\n[%s]\n", 
£˙ame
);

277 
	`¢¥ötf
(
keym
, 
ASCIILINESZ
 + 1, "%s:", 
£˙ame
);

278 
j
 = 0; j < 
d
->
size
; j++) {

279 i‡(
d
->
key
[
j
] =
NULL
)

281 i‡(!
	`°∫cmp
(
d
->
key
[
j
], 
keym
, 
£˛í
+1)) {

282 
	`Ârötf
(
f
, "%-30s = %s\n",

283 
d
->
key
[
j
]+
£˛í
+1,

284 
d
->
vÆ
[
j
] ? d->val[j] : "");

288 
	`Ârötf
(
f
, "\n");

291 
	}
}

293 *
	$cöù¨£r_gë°rög
(
di˘i⁄¨y
 *
d
, c⁄° *
key
, *
def
)

295 *
lc_key
;

296 *
svÆ
;

298 i‡(
d
 =
NULL
 || 
key
 == NULL)

299  
def
;

301 
lc_key
 = 
	`°æwc
(
key
);

302 
svÆ
 = 
	`di˘i⁄¨y_gë
(
d
, 
lc_key
, 
def
);

304  
svÆ
;

305 
	}
}

307 
	$cöù¨£r_gëöt
(
di˘i⁄¨y
 *
d
, c⁄° *
key
, 
nŸfound
)

309 *
°r
;

311 
°r
 = 
	`cöù¨£r_gë°rög
(
d
, 
key
, 
INI_INVALID_KEY
);

313 i‡(
°r
 =
INI_INVALID_KEY
)

314  
nŸfound
;

316  (Ë
	`°πﬁ
(
°r
, 
NULL
, 10);

317 
	}
}

319 
	$cöù¨£r_gëdoubÀ
(
di˘i⁄¨y
 *
d
, *
key
, 
nŸfound
)

321 *
°r
;

323 
°r
 = 
	`cöù¨£r_gë°rög
(
d
, 
key
, 
INI_INVALID_KEY
);

325 i‡(
°r
 =
INI_INVALID_KEY
)

326  
nŸfound
;

328  
	`©of
(
°r
);

329 
	}
}

331 
	$cöù¨£r_gëboﬁón
(
di˘i⁄¨y
 *
d
, c⁄° *
key
, 
nŸfound
)

333 *
c
;

334 
ªt
;

336 
c
 = 
	`cöù¨£r_gë°rög
(
d
, 
key
, 
INI_INVALID_KEY
);

337 i‡(
c
 =
INI_INVALID_KEY
)

338  
nŸfound
;

340 
c
[0]) {

342 
ªt
 = 1;

345 
ªt
 = 0;

348 
ªt
 = 
nŸfound
;

352  
ªt
;

353 
	}
}

355 
	$cöù¨£r_föd_íåy
(
di˘i⁄¨y
 *
öi
, *
íåy
)

357 
found
 = 0;

359 i‡(
	`cöù¨£r_gë°rög
(
öi
, 
íåy
, 
INI_INVALID_KEY
) != INI_INVALID_KEY) {

360 
found
 = 1;

363  
found
;

364 
	}
}

366 
	$cöù¨£r_£t
(
di˘i⁄¨y
 *
d
, *
íåy
, *
vÆ
)

368  
	`di˘i⁄¨y_£t
(
d
, 
	`°æwc
(
íåy
), 
vÆ
);

369 
	}
}

371 
	$cöù¨£r_un£t
(
di˘i⁄¨y
 *
öi
, *
íåy
)

373 
	`di˘i⁄¨y_un£t
(
öi
, 
	`°æwc
(
íåy
));

374 
	}
}

376 
di˘i⁄¨y
 *
	$cöù¨£r_lﬂd
(c⁄° *
ööame
)

378 
FILE
 *
ö
;

379 
löe
[
ASCIILINESZ
+1];

380 
£˘i⁄
[
ASCIILINESZ
+1];

381 
key
[
ASCIILINESZ
+1];

382 
tmp
[
ASCIILINESZ
+1];

383 
vÆ
[
ASCIILINESZ
+1];

384 
œ°
 = 0, 
Àn
, 
löío
 = 0, 
îrs
 = 0;

385 
di˘i⁄¨y
 *
di˘
;

387 i‡((
ö
 = 
	`f›í
(
ööame
, "r")Ë=
NULL
) {

388 
	`Ârötf
(
°dîr
, "cöù¨£r: c™nŸ o≥¿%s\n", 
ööame
);

389  
NULL
;

392 
di˘
 = 
	`di˘i⁄¨y_√w
(0);

393 i‡(!
di˘
) {

394 
	`f˛o£
(
ö
);

395  
NULL
;

398 
	`mem£t
(
löe
, 0, 
ASCIILINESZ
 + 1);

399 
	`mem£t
(
£˘i⁄
, 0, 
ASCIILINESZ
 + 1);

400 
	`mem£t
(
key
, 0, 
ASCIILINESZ
 + 1);

401 
	`mem£t
(
vÆ
, 0, 
ASCIILINESZ
 + 1);

402 
œ°
 = 0;

404 
	`fgës
(
löe
+
œ°
, 
ASCIILINESZ
-œ°, 
ö
)!=
NULL
) {

405 
löío
++;

406 
Àn
 = (Ë
	`°æí
(
löe
)-1;

408 i‡(
löe
[
Àn
] != '\n') {

409 
	`Ârötf
(
°dîr
,

411 
ööame
,

412 
löío
);

413 
	`di˘i⁄¨y_dñ
(
di˘
);

414 
	`f˛o£
(
ö
);

415  
NULL
;

419 (
Àn
 >= 0) &&

420 ((
löe
[
Àn
] ='\n'Ë|| (
	`is•a˚
(line[len])))) {

421 
löe
[
Àn
] = 0;

422 
Àn
--;

426 i‡(
Àn
 >0 && 
löe
[len] == '\\') {

428 
œ°
 = 
Àn
;

432 
	`cöù¨£r_löe
(
löe
, 
£˘i⁄
, 
key
, 
vÆ
)) {

433 
LINE_EMPTY
:

434 
LINE_COMMENT
:

437 
LINE_SECTION
:

438 
îrs
 = 
	`di˘i⁄¨y_£t
(
di˘
, 
£˘i⁄
, 
NULL
);

441 
LINE_VALUE
:

442 
	`¢¥ötf
(
tmp
, 
ASCIILINESZ
 + 1, "%s:%s", 
£˘i⁄
, 
key
);

443 
îrs
 = 
	`di˘i⁄¨y_£t
(
di˘
, 
tmp
, 
vÆ
);

446 
LINE_ERROR
:

447 
	`Ârötf
(
°dîr
, "ciniparser: syntaxÉrror in %s (%d):\n",

448 
ööame
, 
löío
);

449 
	`Ârötf
(
°dîr
, "-> %s\n", 
löe
);

450 
îrs
++;

456 
	`mem£t
(
löe
, 0, 
ASCIILINESZ
);

457 
œ°
 = 0;

458 i‡(
îrs
 < 0) {

459 
	`Ârötf
(
°dîr
, "ciniparser: memoryállocation failure\n");

464 i‡(
îrs
) {

465 
	`di˘i⁄¨y_dñ
(
di˘
);

466 
di˘
 = 
NULL
;

469 
	`f˛o£
(
ö
);

471  
di˘
;

472 
	}
}

474 
	$cöù¨£r_‰ìdi˘
(
di˘i⁄¨y
 *
d
)

476 
	`di˘i⁄¨y_dñ
(
d
);

477 
	}
}

	@ccan/ccan/ciniparser/ciniparser.h

1 #i‚de‡
_INIPARSER_H_


2 
	#_INIPARSER_H_


	)

39 
	~<°dio.h
>

40 
	~<°dlib.h
>

41 
	~<°rög.h
>

42 
	~<uni°d.h
>

44 
	~"di˘i⁄¨y.h
"

46 
	#cöù¨£r_gë°r
(
d
, 
k
Ë
	`cöù¨£r_gë°rög
(d, k, 
NULL
)

	)

47 
	#cöù¨£r_£t°r
 
cöù¨£r_£t°rög


	)

63 
cöù¨£r_gën£c
(
di˘i⁄¨y
 *
d
);

75 *
cöù¨£r_gë£˙ame
(
di˘i⁄¨y
 *
d
, 
n
);

86 
cöù¨£r_dump_öi
(
di˘i⁄¨y
 *
d
, 
FILE
 *
f
);

99 
cöù¨£r_dump
(
di˘i⁄¨y
 *
d
, 
FILE
 *
f
);

114 *
cöù¨£r_gë°rög
(
di˘i⁄¨y
 *
d
, c⁄° *
key
, *
def
);

141 
cöù¨£r_gëöt
(
di˘i⁄¨y
 *
d
, c⁄° *
key
, 
nŸfound
);

154 
cöù¨£r_gëdoubÀ
(
di˘i⁄¨y
 *
d
, *
key
, 
nŸfound
);

186 
cöù¨£r_gëboﬁón
(
di˘i⁄¨y
 *
d
, c⁄° *
key
, 
nŸfound
);

199 
cöù¨£r_£t°rög
(
di˘i⁄¨y
 *
öi
, *
íåy
, *
vÆ
);

209 
cöù¨£r_un£t
(
di˘i⁄¨y
 *
öi
, *
íåy
);

221 
cöù¨£r_föd_íåy
(
di˘i⁄¨y
 *
öi
, *
íåy
) ;

235 
di˘i⁄¨y
 *
cöù¨£r_lﬂd
(c⁄° *
ööame
);

246 
cöù¨£r_‰ìdi˘
(
di˘i⁄¨y
 *
d
);

258 
cöù¨£r_£t
(
di˘i⁄¨y
 *
d
, *
íåy
, *
vÆ
);

	@ccan/ccan/ciniparser/dictionary.c

39 
	~"di˘i⁄¨y.h
"

41 
	~<°dio.h
>

42 
	~<°dlib.h
>

43 
	~<°rög.h
>

44 
	~<uni°d.h
>

47 
	#MAXVALSZ
 1024

	)

50 
	#DICTMINSZ
 128

	)

53 
	#DICT_INVALID_KEY
 ((*)-1)

	)

60 *
	$mem_doubÀ
(*
±r
, 
size
)

62 *
√w±r
;

64 
√w±r
 = 
	`ˇŒoc
(2 * 
size
, 1);

65 i‡(
√w±r
 =
NULL
) {

66  
NULL
;

68 
	`mem˝y
(
√w±r
, 
±r
, 
size
);

69 
	`‰ì
(
±r
);

70  
√w±r
;

71 
	}
}

75 
	$di˘i⁄¨y_hash
(*
key
)

77 
Àn
;

78 
hash
;

79 
i
;

81 
Àn
 = 
	`°æí
(
key
);

82 
hash
 = 0, 
i
 = 0; i < 
Àn
; i++) {

83 
hash
 +(Ë
key
[
i
];

84 
hash
 += (hash << 10);

85 
hash
 ^= (hash >> 6);

87 
hash
 += (hash << 3);

88 
hash
 ^= (hash >> 11);

89 
hash
 += (hash << 15);

90  
hash
;

91 
	}
}

93 
di˘i⁄¨y
 *
	$di˘i⁄¨y_√w
(
size
)

95 
di˘i⁄¨y
 *
d
;

98 i‡(
size
<
DICTMINSZ
) size=DICTMINSZ;

100 i‡(!(
d
 = (
di˘i⁄¨y
 *Ë
	`ˇŒoc
(1, (dictionary)))) {

101  
NULL
;

103 
d
->
size
 = size;

104 
d
->
vÆ
 = (**Ë
	`ˇŒoc
(
size
, (*));

105 
d
->
key
 = (**Ë
	`ˇŒoc
(
size
, (*));

106 
d
->
hash
 = (*Ë
	`ˇŒoc
(
size
, ());

107  
d
;

108 
	}
}

110 
	$di˘i⁄¨y_dñ
(
di˘i⁄¨y
 *
d
)

112 
i
;

114 i‡(
d
 =
NULL
)

116 
i
 = 0; i < 
d
->
size
; i++) {

117 i‡(
d
->
key
[
i
] !
NULL
)

118 
	`‰ì
(
d
->
key
[
i
]);

119 i‡(
d
->
vÆ
[
i
] !
NULL
)

120 
	`‰ì
(
d
->
vÆ
[
i
]);

122 
	`‰ì
(
d
->
vÆ
);

123 
	`‰ì
(
d
->
key
);

124 
	`‰ì
(
d
->
hash
);

125 
	`‰ì
(
d
);

127 
	}
}

129 *
	$di˘i⁄¨y_gë
(
di˘i⁄¨y
 *
d
, *
key
, *
def
)

131 
hash
;

132 
i
;

134 
hash
 = 
	`di˘i⁄¨y_hash
(
key
);

135 
i
=0; i < 
d
->
size
; i++) {

136 i‡(
d
->
key
[
i
] =
NULL
)

139 i‡(
hash
 =
d
->hash[
i
]) {

141 i‡(!
	`°rcmp
(
key
, 
d
->key[
i
])) {

142  
d
->
vÆ
[
i
];

146  
def
;

147 
	}
}

149 
	$di˘i⁄¨y_£t
(
di˘i⁄¨y
 *
d
, *
key
, *
vÆ
)

151 
i
;

152 
hash
;

154 i‡(
d
==
NULL
 || 
key
==NULL)

158 
hash
 = 
	`di˘i⁄¨y_hash
(
key
);

160 i‡(
d
->
n
 > 0) {

161 
i
 = 0; i < 
d
->
size
; i++) {

162 i‡(
d
->
key
[
i
] =
NULL
)

165 i‡(
hash
 =
d
->hash[
i
]) {

167 i‡(!
	`°rcmp
(
key
, 
d
->key[
i
])) {

169 i‡(
d
->
vÆ
[
i
] !
NULL
)

170 
	`‰ì
(
d
->
vÆ
[
i
]);

171 
d
->
vÆ
[
i
] = vÆ ? 
	`°rdup
(vÆË: 
NULL
;

181 i‡(
d
->
n
 =d->
size
) {

183 
d
->
vÆ
 = (**Ë
	`mem_doubÀ
(d->vÆ, d->
size
 * (*));

184 
d
->
key
 = (**Ë
	`mem_doubÀ
(d->key, d->
size
 * (*));

185 
d
->
hash
 = (*)

186 
	`mem_doubÀ
(
d
->
hash
, d->
size
 * ());

187 i‡((
d
->
vÆ
 =
NULL
Ë|| (d->
key
 =NULLË|| (d->
hash
 == NULL))

191 
d
->
size
 *= 2;

195 
i
 = 0; i < 
d
->
size
; i++) {

196 i‡(
d
->
key
[
i
] =
NULL
) {

202 
d
->
key
[
i
] = 
	`°rdup
(key);

203 
d
->
vÆ
[
i
] = vÆ ? 
	`°rdup
(vÆË: 
NULL
;

204 
d
->
hash
[
i
] = hash;

205 
d
->
n
 ++;

207 
	}
}

209 
	$di˘i⁄¨y_un£t
(
di˘i⁄¨y
 *
d
, *
key
)

211 
hash
;

212 
i
;

214 i‡(
key
 =
NULL
)

217 
hash
 = 
	`di˘i⁄¨y_hash
(
key
);

218 
i
 = 0; i < 
d
->
size
; i++) {

219 i‡(
d
->
key
[
i
] =
NULL
)

222 i‡(
hash
 =
d
->hash[
i
]) {

224 i‡(!
	`°rcmp
(
key
, 
d
->key[
i
])) {

230 i‡(
i
 >
d
->
size
)

234 
	`‰ì
(
d
->
key
[
i
]);

235 
d
->
key
[
i
] = 
NULL
;

236 i‡(
d
->
vÆ
[
i
]!=
NULL
) {

237 
	`‰ì
(
d
->
vÆ
[
i
]);

238 
d
->
vÆ
[
i
] = 
NULL
;

240 
d
->
hash
[
i
] = 0;

241 
d
->
n
 --;

243 
	}
}

245 
	$di˘i⁄¨y_dump
(
di˘i⁄¨y
 *
d
, 
FILE
 *
out
)

247 
i
;

249 i‡(
d
 =
NULL
 || 
out
 == NULL)

251 i‡(
d
->
n
 < 1) {

252 
	`Ârötf
(
out
, "empty dictionary\n");

255 
i
 = 0; i < 
d
->
size
; i++) {

256 i‡(
d
->
key
[
i
]) {

257 
	`Ârötf
(
out
, "%20s\t[%s]\n",

258 
d
->
key
[
i
],

259 
d
->
vÆ
[
i
] ? d->val[i] : "UNDEF");

263 
	}
}

	@ccan/ccan/ciniparser/dictionary.h

1 #i‚de‡
_DICTIONARY_H_


2 
	#_DICTIONARY_H_


	)

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<uni°d.h
>

61 
	s_di˘i⁄¨y_
 {

62 
	mn
;

63 
	msize
;

64 **
	mvÆ
;

65 **
	mkey
;

66 *
	mhash
;

67 } 
	tdi˘i⁄¨y
;

79 
di˘i⁄¨y_hash
(*
key
);

90 
di˘i⁄¨y
 *
di˘i⁄¨y_√w
(
size
);

99 
di˘i⁄¨y_dñ
(
di˘i⁄¨y
 *
vd
);

113 *
di˘i⁄¨y_gë
(
di˘i⁄¨y
 *
d
, *
key
, *
def
);

139 
di˘i⁄¨y_£t
(
di˘i⁄¨y
 *
vd
, *
key
, *
vÆ
);

150 
di˘i⁄¨y_un£t
(
di˘i⁄¨y
 *
d
, *
key
);

162 
di˘i⁄¨y_dump
(
di˘i⁄¨y
 *
d
, 
FILE
 *
out
);

	@ccan/ccan/ciniparser/test/run-dictionary.c

1 
	~<cˇn/cöù¨£r/di˘i⁄¨y.h
>

2 
	~<cˇn/cöù¨£r/di˘i⁄¨y.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$ã°_åivül
() {

7 
di˘i⁄¨y
 *
m≠
 = 
	`di˘i⁄¨y_√w
(0);

8 *
nŸfound
 = (*)0xDEADBEEF;

10 
	`ok1
(
	`di˘i⁄¨y_gë
(
m≠
, "nŸfound", 
nŸfound
) ==Çotfound);

12 
	`ok1
(
	`di˘i⁄¨y_gë
(
m≠
, "⁄e", 
NULL
) == NULL);

13 
	`ok1
(
	`di˘i⁄¨y_£t
(
m≠
, "one", "1") == 0);

15 
	`ok1
(
	`di˘i⁄¨y_gë
(
m≠
, "two", 
NULL
) == NULL);

16 
	`ok1
(
	`di˘i⁄¨y_£t
(
m≠
, "two", "2") == 0);

18 
	`ok1
(
	`di˘i⁄¨y_gë
(
m≠
, "thªe", 
NULL
) == NULL);

19 
	`ok1
(
	`di˘i⁄¨y_£t
(
m≠
, "three", "3") == 0);

21 
	`ok1
(
	`di˘i⁄¨y_gë
(
m≠
, "four", 
NULL
) == NULL);

22 
	`ok1
(
	`di˘i⁄¨y_£t
(
m≠
, "four", "4") == 0);

24 
	`ok1
(!
	`°rcmp
(
	`di˘i⁄¨y_gë
(
m≠
, "thªe", 
NULL
), "3"));

25 
	`ok1
(!
	`°rcmp
(
	`di˘i⁄¨y_gë
(
m≠
, "⁄e", 
NULL
), "1"));

26 
	`ok1
(!
	`°rcmp
(
	`di˘i⁄¨y_gë
(
m≠
, "four", 
NULL
), "4"));

27 
	`ok1
(!
	`°rcmp
(
	`di˘i⁄¨y_gë
(
m≠
, "two", 
NULL
), "2"));

29 
	`ok1
(
m≠
->
n
 == 4);

31 
	`di˘i⁄¨y_dñ
(
m≠
);

32 
	}
}

34 
	$s¸ambÀ
(*
ba£
, 
size_t
 
nmemb
, size_à
size
) {

35 *
i
 = 
ba£
;

36 *
o
;

37 
size_t
 
sd
;

38 ;
nmemb
>1;nmemb--) {

39 
o
 = 
i
 + 
size
*(
	`øndom
()%
nmemb
);

40 
sd
=
size
;sd--;) {

41 
tmp
 = *
o
;

42 *
o
++ = *
i
;

43 *
i
++ = 
tmp
;

46 
	}
}

50 *
	$øndom_°rög
() {

51 
size_t
 
Àn
 = 
	`øndom
() % 100;

52 *
°r
 = 
	`mÆloc
(
Àn
+1);

53 *
i
;

55 
i
=
°r
; 
Àn
--; i++) {

56 #i‚de‡
RANDOM_STRING_READABLE


57 
c
 = 
	`øndom
();

58 *
i
 = 
c
 ? c : ' ';

61 
c
 = 
	`øndom
()%95 + 32;

62 *
i
 = 
c
;

65 *
i
 = 0;

67  
°r
;

68 
	}
}

70 
	sã°_íåy
 {

71 *
	m°r
;

72 *
	mvÆue
;

75 
	$by_°r
(c⁄° *
≠
, c⁄° *
bp
) {

76  
	`°rcmp
(((
ã°_íåy
*)
≠
)->
°r
, ((ã°_íåy*)
bp
)->str);

77 
	}
}

79 
	$cuŒ_du∂iˇãs
(
ã°_íåy
 *
íåõs
, 
size_t
 *
cou¡
) {

80 
ã°_íåy
 *
i
, *
o
, *
e
 = 
íåõs
 + *
cou¡
;

82 
	`qs‹t
(
íåõs
, *
cou¡
, (*íåõs), 
by_°r
);

84 
i
=
íåõs
, 
o
Û¡rõs; i<
e
;) {

86 i‡(
o
>
íåõs
) {

87 c⁄° *
œ°
 = 
o
[-1].
°r
;

88 i‡(!
	`°rcmp
(
œ°
, 
i
->
°r
)) {

90 
	`‰ì
(
i
->
°r
);

91 
i
++;

92 } 
i
<
e
 && !
	`°rcmp
(
œ°
, i->
°r
));

99 *
vÆue
 = 
i
->value;

100 dÿ*
o
++ = *
i
++; i<
e
 && i->
vÆue
 == value);

104 *
cou¡
 = 
o
-
íåõs
;

105 
	}
}

107 
	$‰ì_ã°_íåõs
(
ã°_íåy
 *
íåõs
, 
size_t
 
cou¡
) {

108 
ã°_íåy
 *
i
 = 
íåõs
;

109 ;
cou¡
--;
i
++)

110 
	`‰ì
(
i
->
°r
);

111 
	`‰ì
(
íåõs
);

112 
	}
}

114 
	$ã°_di˘i⁄¨y
(
size_t
 
cou¡
, 
FILE
 *
out
) {

115 
di˘i⁄¨y
 *
m≠
 = 
	`di˘i⁄¨y_√w
(0);

117 
	#¥öt
(
èg
, 
fmt
, ...) do { \

118 i‡(
out
) \

119 
	`Ârötf
(
out
, 
èg
 
fmt
 "\n", ##
__VA_ARGS__
); \

120 } 0)

	)

121 
	#debug
(...Ë
	`¥öt
("debug: ", 
__VA_ARGS__
)

	)

122 
	#msg
(...Ë
	`¥öt
("öfo: ", 
__VA_ARGS__
)

	)

124 
ã°_íåy
 *
íåõs
 = 
	`mÆloc
((*íåõsË* 
cou¡
);

125 
ã°_íåy
 *
i
, *
e
 = 
íåõs
+
cou¡
;

126 *
vÆue_ba£
 = 
	`mÆloc
(
cou¡
), *
vÆue
 = value_base;

127 
size_t
 
unique_cou¡
 = 0;

130 
	`mem£t
(
vÆue
, 0, 
cou¡
);

132 
	`msg
("Gíî©ög %zuÅe°É¡rõs...", 
cou¡
);

134 
i
=
íåõs
; i<
e
; 
vÆue
++) {

135 *
°r
 = 
	`øndom_°rög
();

136 
size_t
 
ßme_cou¡
 = 
	`øndom
()%5 ?Ñandom()%3 :Ñandom()%10;

138 
i
->
°r
 = str;

139 
i
->
vÆue
 = value;

140 
i
++;

142 ;
ßme_cou¡
-- && 
i
<
e
; i++) {

143 
i
->
°r
 = 
	`°rdup
(str);

144 
i
->
vÆue
 = value;

148 
	`cuŒ_du∂iˇãs
(
íåõs
, &
cou¡
);

149 
e
 = 
íåõs
+
cou¡
;

150 
	`s¸ambÀ
(
íåõs
, 
cou¡
, (*entries));

152 
	#îr
(...) do { \

153 
	`¥öt
("îr‹: ", 
__VA_ARGS__
); \

154 
Áû
; \

155 } 0)

	)

157 
	`msg
("In£πög/lookög u∞%zuÉ¡rõs...", 
cou¡
);

159 
i
=
íåõs
; i<
e
; i++) {

160 *
vÆue
;

162 
	`debug
("Lookög u∞%s", 
i
->
°r
);

164 
vÆue
 = 
	`di˘i⁄¨y_gë
(
m≠
, 
i
->
°r
, 
NULL
);

166 i‡(!
vÆue
) {

167 
vÆue_°r
[64];

169 i‡(*
i
->
vÆue
)

170 
	`îr
("Previously insertedÉntryÇot found");

172 
	`debug
("Not found;Éntering");

177 
	`•rötf
(
vÆue_°r
, "%lu", ()(
i
->
vÆue
 - 
vÆue_ba£
));

179 i‡(
	`di˘i⁄¨y_£t
(
m≠
, 
i
->
°r
, 
vÆue_°r
) != 0)

180 
	`îr
("dictionary_set hadánÉrror");

182 *
i
->
vÆue
 = 1;

184 
unique_cou¡
++;

186 i‡(()(
i
->
vÆue
 - 
vÆue_ba£
) !=

187 
	`°πoul
(
vÆue
, 
NULL
, 10))

188 
	`îr
("lookupÑeturned incorrect value");

189 i‡(!*
i
->
vÆue
)

190 
	`îr
("lookupÑeturned bogus value");

194 i‡(
m≠
->
n
 !
unique_cou¡
)

195 
	`îr
("Dictionary has incorrect count");

197 
	`¥ötf
("di˘i⁄¨yÅe°Öas£dá·î %zu in£πs, %zuÜookup†(%zuÅŸÆ o≥øti⁄s)\n", 
unique_cou¡
, (
i
-
íåõs
)-unique_count, i-entries);

199 
	`‰ì_ã°_íåõs
(
íåõs
, 
e
-entries);

200 
	`‰ì
(
vÆue_ba£
);

201 
	`di˘i⁄¨y_dñ
(
m≠
);

204 
Áû
:

205 
	`¥ötf
("di˘i⁄¨yÅe° faûedá·î %zu in£πs, %zuÜookup†(%zuÅŸÆ o≥øti⁄s)\n", 
unique_cou¡
, (
i
-
íåõs
)-unique_count, i-entries);

207 
	`‰ì_ã°_íåõs
(
íåõs
, 
e
-entries);

208 
	`‰ì
(
vÆue_ba£
);

209 
	`di˘i⁄¨y_dñ
(
m≠
);

212 #unde‡
¥öt


213 #unde‡
îr


214 #unde‡
debug


215 #unde‡
msg


216 
	}
}

218 
	$maö
()

220 
	`∂™_ã°s
(15);

222 
	`ã°_åivül
();

223 
	`ok1
(
	`ã°_di˘i⁄¨y
(10000, 
NULL
));

225  
	`exô_°©us
();

226 
	}
}

	@ccan/ccan/ciniparser/test/run.c

1 
	~<cˇn/cöù¨£r/cöù¨£r.h
>

2 
	~<cˇn/cöù¨£r/cöù¨£r.c
>

3 
	~<cˇn/cöù¨£r/di˘i⁄¨y.h
>

4 
	~<cˇn/cöù¨£r/di˘i⁄¨y.c
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<°rög.h
>

8 
	~<uni°d.h
>

9 
	~<°dboﬁ.h
>

11 
	~<cˇn/èp/èp.h
>

13 
	#NUM_TESTS
 12

	)

15 
	$maö
(
¨gc
, * 
¨gv
[])

17 
di˘i⁄¨y
 *
öi
;

18 *
öi_«me
;

19 *
°mp
, *
°mp1
, *
°mp2
, *
°mp3
;

20 
ômp
, 
ômp1
, 
i
;

21 
boﬁ
 
btmp
;

22 
dtmp
;

24 i‡(
¨gc
 < 2)

25 
öi_«me
 = "test/test.ini";

27 
öi_«me
 = 
¨gv
[1] ;

29 
	`∂™_ã°s
(
NUM_TESTS
);

31 
	`ok
(
öi
 = 
	`cöù¨£r_lﬂd
(
öi_«me
),

32 "cöù¨£r_lﬂd(Ë :Üﬂdög %s", 
öi_«me
);

33 
	`ok
(
ômp
 = 
	`cöù¨£r_gën£c
(
öi
),

35 
ômp
, 
öi_«me
);

36 
	`ok
(
°mp
 = 
	`cöù¨£r_gë£˙ame
(
öi
, 
ômp
),

37 "cöù¨£r_gë£˙ame():Üa° di˘É¡ry (%dËi†%s", 
ômp
, 
°mp
);

38 
	`ok
(
°mp2
 = 
	`cöù¨£r_gë£˙ame
(
öi
, 1),

39 "cöù¨£r_gë£˙ame(): fú° di˘É¡ry i†%s", 
°mp2
);

40 
	`ok
(
i
 = 
	`cöù¨£r_föd_íåy
(
öi
, "Foo:shemp"),

42 
i
 ? "yes" : "no");

43 
	`ok
(
°mp1
 = 
	`cöù¨£r_gë°rög
(
öi
, "Wöe:Gø≥", 
NULL
),

44 "cöù¨£r_gë°rög(Ë: Wöe:Gø≥ = %s", 
°mp1
);

45 
	`ok
(!
	`cöù¨£r_£t
(
öi
, "Wine:Grape", "Grape Ape"),

47 
	`ok
(
°mp2
 = 
	`cöù¨£r_gë°rög
(
öi
, "Wöe:Gø≥", 
NULL
),

48 "cöù¨£r_gë°rög(Ë: Wöe:Gø≥ = %s", 
°mp2
);

49 
	`cöù¨£r_un£t
(
öi
, "Wine:Grape");

50 
	`ok
(! (
°mp3
 = 
	`cöù¨£r_gë°rög
(
öi
, "Wöe:Gø≥", 
NULL
)),

53 
°mp3
 =
NULL
 ? "Yes" : "no");

54 
	`ok
(
ômp1
 = 
	`cöù¨£r_gëöt
(
öi
, "Pizza:Capres", 0),

55 "cöù¨£r_gëöt(Ë : Pizza:C≠ª†%d", 
ômp1
);

56 
	`ok
(
btmp
 = 
	`cöù¨£r_gëboﬁón
(
öi
, "Pizza:Mushrooms", 0),

57 "cöù¨£r_gëboﬁón(): Pizza:C≠ª†%s", 
btmp
 ? "true" : "false");

58 
	`ok
(
dtmp
 = 
	`cöù¨£r_gëdoubÀ
(
öi
, "Wine:Alcohol", 0.00),

59 "cöù¨£r_gëdoubÀ(Ë: Wöe:Alcohﬁ = %-2.1f", 
dtmp
);

63 
	`cöù¨£r_dump
(
öi
, 
°dout
);

64 
	`cöù¨£r_dump_öi
(
öi
, 
°dout
);

66 
	`cöù¨£r_‰ìdi˘
(
öi
);

68  
	`exô_°©us
();

69 
	}
}

	@ccan/ccan/compiler/compiler.h

2 #i‚de‡
CCAN_COMPILER_H


3 
	#CCAN_COMPILER_H


	)

4 
	~"c⁄fig.h
"

6 #i‚de‡
COLD


7 #i‡
HAVE_ATTRIBUTE_COLD


20 
	#COLD
 
	`__©åibuã__
((
cﬁd
))

	)

22 
	#COLD


	)

26 #i‚de‡
NORETURN


27 #i‡
HAVE_ATTRIBUTE_NORETURN


40 
	#NORETURN
 
	`__©åibuã__
((
n‹ëu∫
))

	)

42 
	#NORETURN


	)

46 #i‚de‡
PRINTF_FMT


47 #i‡
HAVE_ATTRIBUTE_PRINTF


58 
	#PRINTF_FMT
(
nfmt
, 
«rg
) \

59 
	`__©åibuã__
((
	`f‹m©
(
__¥ötf__
, 
nfmt
, 
«rg
)))

	)

61 
	#PRINTF_FMT
(
nfmt
, 
«rg
)

	)

65 #i‚de‡
CONST_FUNCTION


66 #i‡
HAVE_ATTRIBUTE_CONST


74 
	#CONST_FUNCTION
 
	`__©åibuã__
((c⁄°))

	)

76 
	#CONST_FUNCTION


	)

80 #i‡
HAVE_ATTRIBUTE_UNUSED


81 #i‚de‡
UNNEEDED


98 
	#UNNEEDED
 
	`__©åibuã__
((
unu£d
))

	)

101 #i‚de‡
NEEDED


102 #i‡
HAVE_ATTRIBUTE_USED


117 
	#NEEDED
 
	`__©åibuã__
((
u£d
))

	)

120 
	#NEEDED
 
	`__©åibuã__
((
unu£d
))

	)

124 #i‚de‡
UNUSED


139 
	#UNUSED
 
	`__©åibuã__
((
unu£d
))

	)

142 #i‚de‡
UNNEEDED


143 
	#UNNEEDED


	)

145 #i‚de‡
NEEDED


146 
	#NEEDED


	)

148 #i‚de‡
UNUSED


149 
	#UNUSED


	)

153 #i‚de‡
IS_COMPILE_CONSTANT


154 #i‡
HAVE_BUILTIN_CONSTANT_P


190 
	#IS_COMPILE_CONSTANT
(
ex¥
Ë
	`__buûtö_c⁄°™t_p
”x¥)

	)

193 
	#IS_COMPILE_CONSTANT
(
ex¥
Ë0

	)

197 #i‚de‡
WARN_UNUSED_RESULT


198 #i‡
HAVE_WARN_UNUSED_RESULT


212 
	#WARN_UNUSED_RESULT
 
	`__©åibuã__
((
w¨n_unu£d_ªsu…
))

	)

214 
	#WARN_UNUSED_RESULT


	)

	@ccan/ccan/compiler/test/compile_fail-printf.c

1 
	~<cˇn/compûî/compûî.h
>

3 
	$PRINTF_FMT
(2,3Ë
	$my_¥ötf
(
x
, c⁄° *
fmt
, ...)

5 
	}
}

7 
	$maö
(
¨gc
, *
¨gv
[])

9 
i
 = 0;

11 
	`my_¥ötf
(1, "NotáÖointer "

12 #ifde‡
FAIL


14 #i‡!
HAVE_ATTRIBUTE_PRINTF


20 
i
);

22 
	}
}

	@ccan/ccan/compiler/test/run-is_compile_constant.c

1 
	~<cˇn/compûî/compûî.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 
	`∂™_ã°s
(2);

8 
	`ok1
(!
	`IS_COMPILE_CONSTANT
(
¨gc
));

9 #i‡
HAVE_BUILTIN_CONSTANT_P


10 
	`ok1
(
	`IS_COMPILE_CONSTANT
(7));

12 
	`∑ss
("If !HAVE_BUILTIN_CONSTANT_P, IS_COMPILE_CONSTANTálways false");

14  
	`exô_°©us
();

15 
	}
}

	@ccan/ccan/container_of/container_of.h

2 #i‚de‡
CCAN_CONTAINER_OF_H


3 
	#CCAN_CONTAINER_OF_H


	)

4 
	~<°ddef.h
>

6 
	~"c⁄fig.h
"

7 
	~<cˇn/check_ty≥/check_ty≥.h
>

33 
	#c⁄èöî_of
(
membî_±r
, 
c⁄èöög_ty≥
, 
membî
) \

34 ((
c⁄èöög_ty≥
 *) \

35 ((*)(
membî_±r
) \

36 - 
	`c⁄èöî_off
(
c⁄èöög_ty≥
, 
membî
)) \

37 + 
	`check_ty≥s_m©ch
(*(
membî_±r
), ((
c⁄èöög_ty≥
 *)0)->
membî
))

	)

63 
	#c⁄èöî_off
(
c⁄èöög_ty≥
, 
membî
) \

64 
	`off£tof
(
c⁄èöög_ty≥
, 
membî
)

	)

82 #i‡
HAVE_TYPEOF


83 
	#c⁄èöî_of_v¨
(
membî_±r
, 
c⁄èöî_v¨
, 
membî
) \

84 
	`c⁄èöî_of
(
membî_±r
, 
	`ty≥of
(*
c⁄èöî_v¨
), 
membî
)

	)

86 
	#c⁄èöî_of_v¨
(
membî_±r
, 
c⁄èöî_v¨
, 
membî
) \

87 ((*)((*)(
membî_±r
) - \

88 
	`c⁄èöî_off_v¨
(
c⁄èöî_v¨
, 
membî
)))

	)

101 #i‡
HAVE_TYPEOF


102 
	#c⁄èöî_off_v¨
(
v¨
, 
membî
) \

103 
	`c⁄èöî_off
(
	`ty≥of
(*
v¨
), 
membî
)

	)

105 
	#c⁄èöî_off_v¨
(
v¨
, 
membî
) \

106 ((*)&(
v¨
)->
membî
 - (*)(v¨))

	)

	@ccan/ccan/container_of/test/compile_fail-bad-type.c

1 
	~<cˇn/c⁄èöî_of/c⁄èöî_of.h
>

2 
	~<°dlib.h
>

4 
	sfoo
 {

5 
	ma
;

6 
	mb
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 
foo
 foÿ{ .
a
 = 1, .
b
 = 2 };

12 *
öç
 = &
foo
.
a
;

13 *
p
;

15 #ifde‡
FAIL


17 
p
 = 
	`c⁄èöî_of
(
öç
, 
foo
, 
a
);

19 
p
 = (*)
öç
;

21  
p
 =
NULL
;

22 
	}
}

	@ccan/ccan/container_of/test/compile_fail-types.c

1 
	~<cˇn/c⁄èöî_of/c⁄èöî_of.h
>

2 
	~<°dlib.h
>

4 
	sfoo
 {

5 
	ma
;

6 
	mb
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 
foo
 foÿ{ .
a
 = 1, .
b
 = 2 }, *
fo›
;

12 *
öç
 = &
foo
.
a
;

14 #ifde‡
FAIL


16 
fo›
 = 
	`c⁄èöî_of
(
öç
, 
foo
, 
b
);

18 
fo›
 = 
NULL
;

20 (Ë
fo›
;

21  
öç
 =
NULL
;

22 
	}
}

	@ccan/ccan/container_of/test/compile_fail-var-types.c

1 
	~<cˇn/c⁄èöî_of/c⁄èöî_of.h
>

2 
	~<°dlib.h
>

4 
	sfoo
 {

5 
	ma
;

6 
	mb
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 
foo
 foÿ{ .
a
 = 1, .
b
 = 2 }, *
fo›
;

12 *
öç
 = &
foo
.
a
;

14 #ifde‡
FAIL


16 
fo›
 = 
	`c⁄èöî_of_v¨
(
öç
, fo›, 
b
);

17 #i‡!
HAVE_TYPEOF


21 
fo›
 = 
NULL
;

23 (Ë
fo›
;

24  
öç
 =
NULL
;

25 
	}
}

	@ccan/ccan/container_of/test/run.c

1 
	~<cˇn/c⁄èöî_of/c⁄èöî_of.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	sfoo
 {

5 
	ma
;

6 
	mb
;

9 
	$maö
(
¨gc
, *
¨gv
[])

11 
foo
 foÿ{ .
a
 = 1, .
b
 = 2 };

12 *
öç
 = &
foo
.
a
;

13 *
ch¨p
 = &
foo
.
b
;

15 
	`∂™_ã°s
(8);

16 
	`ok1
(
	`c⁄èöî_of
(
öç
, 
foo
, 
a
) == &foo);

17 
	`ok1
(
	`c⁄èöî_of
(
ch¨p
, 
foo
, 
b
) == &foo);

18 
	`ok1
(
	`c⁄èöî_of_v¨
(
öç
, &
foo
, 
a
) == &foo);

19 
	`ok1
(
	`c⁄èöî_of_v¨
(
ch¨p
, &
foo
, 
b
) == &foo);

21 
	`ok1
(
	`c⁄èöî_off
(
foo
, 
a
) == 0);

22 
	`ok1
(
	`c⁄èöî_off
(
foo
, 
b
Ë=
	`off£tof
(foo, b));

23 
	`ok1
(
	`c⁄èöî_off_v¨
(&
foo
, 
a
) == 0);

24 
	`ok1
(
	`c⁄èöî_off_v¨
(&
foo
, 
b
Ë=
	`off£tof
(foo, b));

25  
	`exô_°©us
();

26 
	}
}

	@ccan/ccan/cpuid/cpuid.c

27 #i‡
deföed
(
__i386__
Ë|| deföed(
__i386
Ë|| deföed(
__x86_64
) \

28 || 
deföed
(
_M_AMD64
Ë|| 
	$deföed
(
__M_X64
)

29 
	~"˝uid.h
"

31 
	~<°rög.h
>

34 
CPU_PROC_BRAND_STRING_INTERNAL0
 = 0x80000003,

35 
CPU_PROC_BRAND_STRING_INTERNAL1
 = 0x80000004

38 #i‚de‡
_MSC_VER


39 
	$___˝uid
(
˝uid_t
 
öfo
, 
uöt32_t
 *
óx
, uöt32_à*
ebx
, uöt32_à*
ecx
, uöt32_à*
edx
)

41 
	`__asm__
(

45 : "˜"(*
óx
), "=D"(*
ebx
), "=c"(*
ecx
), "=d"(*
edx
)

46 : "0" (
öfo
)

48 
	}
}

50 
	~<öåö.h
>

52 
	$___˝uid
(
˝uid_t
 
öfo
, 
uöt32_t
 *
óx
, uöt32_à*
ebx
, uöt32_à*
ecx
, uöt32_à*
edx
)

54 
uöt32_t
 
ªgi°îs
[4];

55 
	`__˝uid
(
ªgi°îs
, 
öfo
);

57 *
óx
 = 
ªgi°îs
[0];

58 *
ebx
 = 
ªgi°îs
[1];

59 *
ecx
 = 
ªgi°îs
[2];

60 *
edx
 = 
ªgi°îs
[3];

61 
	}
}

65 
uöt32_t
 
	m„©uª
;

66 
uöt32_t
 
	mmask
;

67 
boﬁ
 
	mu£_edx
;

68 } 
	g„©uªs
[] = {

69 { 
CF_MMX
, 1 << 23, 
åue
 },

70 { 
CF_SSE
, 1 << 25, 
åue
 },

71 { 
CF_SSE2
, 1 << 26, 
åue
 },

72 { 
CF_SSE3
, 1 << 9, 
Ál£
 },

73 { 
CF_FPU
, 1 << 0, 
åue
 },

75 { 
CF_TSC
, 1 << 4, 
åue
 },

76 { 
CF_MSR
, 1 << 5, 
åue
 },

78 { 
CF_SSSE3
, 1 << 9, 
Ál£
 },

79 { 
CF_AVX
, 1 << 28, 
Ál£
 },

82 { 
CEF_x64
, 1 << 30, 
åue
 },

83 { 
CEF_FPU
, 1 << 0, 
åue
 },

84 { 
CEF_DE
, 1 << 2, 
åue
 },

85 { 
CEF_SYSCALLRET
, 1 << 11, 
åue
 },

86 { 
CEF_CMOV
, 1 << 15, 
åue
 },

88 { 
CEF_SSE4a
, 1 << 6, 
Ál£
 },

89 { 
CEF_FMA4
, 1 << 16, 
Ál£
 },

90 { 
CEF_XOP
, 1 << 11, 
Ál£
 }

93 
boﬁ
 
	$˝uid_is_suµ‹ãd
()

95 
ªt
 = 0;

96 #i‡
	`deföed
(
__GNUC__
Ë|| deföed(
__˛™g__
)

115 #i‡
UINTPTR_MAX
 == 0xffffffffffffffff

116 
	#ASM_PUSHF
 "pushfq\n\t"

	)

117 
	#ASM_POPF
 "p›fq\n\t"

	)

118 
	#ASM_PUSHEAX
 "pushq %%øx\n\t"

	)

119 
	#ASM_POPEAX
 "p›q %%øx\n\t"

	)

120 
	#ASM_PUSHECX
 "pushq %%rcx\n\t"

	)

121 #ñi‡
UINTPTR_MAX
 == 0xffffffff

122 
	#ASM_PUSHF
 "pushÊ\n\t"

	)

123 
	#ASM_POPF
 "p›Ê\n\t"

	)

124 
	#ASM_PUSHEAX
 "push»%%óx\n\t"

	)

125 
	#ASM_POPEAX
 "p›»%%óx\n\t"

	)

126 
	#ASM_PUSHECX
 "push»%%ecx\n\t"

	)

129 
asm
 volatile(

130 
ASM_PUSHF


131 
ASM_POPEAX


134 
ASM_PUSHEAX


135 
ASM_POPF


136 
ASM_PUSHF


137 
ASM_POPEAX


141 
ASM_PUSHECX


142 
ASM_POPF


143 : "˜" (
ªt
)

146 #unde‡
ASM_PUSHF


147 #unde‡
ASM_POPF


148 #unde‡
ASM_PUSHEAX


149 #unde‡
ASM_POPEAX


150 #unde‡
ASM_PUSHECX


151 #ñi‡
deföed
 
_MSC_VER


152 
__asm
 {

153 
pushfd


154 
p›
 
óx


155 
mov
 
ecx
, 
óx


156 
x‹
 
óx
, 0x200000

157 
push
 
óx


158 
p›fd


160 
pushfd


161 
p›
 
óx


162 
x‹
 
óx
, 
ecx


163 
shr
 
óx
, 0x21

164 
™d
 
óx
, 0x1

165 
push
 
ecx


166 
p›fd


168 
mov
 
óx
, 
ªt


171  !!
ªt
;

172 
	}
}

174 
boﬁ
 
	$˝uid_ã°_„©uª
(
˝uid_t
 
„©uª
)

176 i‡(
„©uª
 > 
CPU_VIRT_PHYS_ADDR_SIZES
 || fótuª < 
CPU_EXTENDED_PROC_INFO_FEATURE_BITS
)

177  
Ál£
;

179  (
„©uª
 <
	`˝uid_highe°_ext_func_suµ‹ãd
());

180 
	}
}

182 
boﬁ
 
	$˝uid_has_„©uª
(
„©uª
, 
boﬁ
 
exãnded
)

184 
uöt32_t
 
óx
, 
ebx
, 
ecx
, 
edx
, 
i
;

186 i‡(!
exãnded
)

187 
	`___˝uid
(
CPU_PROCINFO_AND_FEATUREBITS
, &
óx
, &
ebx
, &
ecx
, &
edx
);

189 
	`___˝uid
(
CPU_EXTENDED_PROC_INFO_FEATURE_BITS
, &
óx
, &
ebx
, &
ecx
, &
edx
);

191 
i
 = 0; i < (
„©uªs
) / (features[0]); ++i) {

192 i‡(
„©uªs
[
i
].
„©uª
 == feature) {

193 i‡(
„©uªs
[
i
].
u£_edx
)

194  (
edx
 & 
„©uªs
[
i
].
mask
);

196  (
ecx
 & 
„©uªs
[
i
].
mask
);

199  
Ál£
;

200 
	}
}

202 c⁄° *c⁄° 
	g˝uids
[] = {

221 
˝uty≥_t
 
	$˝uid_gë_˝u_ty≥
()

223 
˝uty≥_t
 
˝uty≥
;

224 i‡(
˝uty≥
 =
CT_NONE
) {

226 
buf
[12];

227 
uöt32_t
 
bufu32
[3];

228 } 
u
;

229 
uöt32_t
 
i
;

231 
	`___˝uid
(
CPU_VENDORID
, &
i
, &
u
.
bufu32
[0], &u.bufu32[2], &u.bufu32[1]);

232 
i
 = 0; i < (
˝uids
) / (cpuids[0]); ++i) {

233 i‡(
	`°∫cmp
(
˝uids
[
i
], 
u
.
buf
, 12) == 0) {

234 
˝uty≥
 = (
˝uty≥_t
)
i
;

240  
˝uty≥
;

241 
	}
}

243 
boﬁ
 
	$˝uid_•rötf_˝uty≥
(c⁄° 
˝uty≥_t
 
˝uty≥
, *
buf
)

245 i‡(
˝uty≥
 =
CT_NONE
)

246  
Ál£
;

248 
	`mem˝y
(
buf
, 
˝uids
[()
˝uty≥
], 12);

249 
buf
[12] = '\0';

250  
åue
;

251 
	}
}

253 
uöt32_t
 
	$˝uid_highe°_ext_func_suµ‹ãd
()

255 
uöt32_t
 
highe°
;

257 i‡(!
highe°
) {

258 #i‡
	`deföed
(
__GNUC__
Ë|| deföed(
__˛™g__
)

259 
asm
 volatile(

261 : "˜" (
highe°
)

262 : "a" (
CPU_HIGHEST_EXTENDED_FUNCTION_SUPPORTED
)

264 #ñi‡
deföed
 
_MSC_VER


265 
__asm
 {

266 
mov
 
óx
, 
CPU_HIGHEST_EXTENDED_FUNCTION_SUPPORTED


267 
˝uid


268 
mov
 
highe°
, 
óx


273  
highe°
;

274 
	}
}

276 
	$˝uid
(
˝uid_t
 
öfo
, 
uöt32_t
 *
buf
)

281 i‡(
öfo
 > 
CPU_VIRT_PHYS_ADDR_SIZES
 || (öfÿ> 
CPU_HIGHEST_EXTENDED_FUNCTION_SUPPORTED


282 && !
	`˝uid_ã°_„©uª
(
öfo
)))

285 i‡(
öfo
 =
CPU_PROC_BRAND_STRING
) {

286 
ˇched
[48] = { 0 };

287 i‡(
ˇched
[0] == '\0') {

288 
	`___˝uid
(
CPU_PROC_BRAND_STRING
, &
buf
[0], &buf[1], &buf[2], &buf[3]);

289 
	`___˝uid
(
CPU_PROC_BRAND_STRING_INTERNAL0
, &
buf
[4], &buf[5], &buf[6], &buf[7]);

290 
	`___˝uid
(
CPU_PROC_BRAND_STRING_INTERNAL1
, &
buf
[8], &buf[9], &buf[10], &buf[11]);

292 
	`mem˝y
(
ˇched
, 
buf
,  cached);

294 
buf
 = (
uöt32_t
 *)
ˇched
;

297 } i‡(
öfo
 =
CPU_HIGHEST_EXTENDED_FUNCTION_SUPPORTED
) {

298 *
buf
 = 
	`˝uid_highe°_ext_func_suµ‹ãd
();

302 
uöt32_t
 
óx
, 
ebx
, 
ecx
, 
edx
;

303 
	`___˝uid
(
öfo
, &
óx
, &
ebx
, &
ecx
, &
edx
);

305 
öfo
) {

306 
CPU_VENDORID
:

307 
buf
[0] = 
ebx
;

308 
buf
[1] = 
edx
;

309 
buf
[2] = 
ecx
;

311 
CPU_PROCINFO_AND_FEATUREBITS
:

312 
buf
[0] = 
óx
;

313 
buf
[1] = 
edx
;

314 
buf
[2] = 
ecx
;

315 
buf
[3] = 
ebx
;

317 
CPU_CACHE_AND_TLBD_INFO
:

318 
buf
[0] = 
óx
;

319 
buf
[1] = 
ebx
;

320 
buf
[2] = 
ecx
;

321 
buf
[3] = 
edx
;

323 
CPU_EXTENDED_PROC_INFO_FEATURE_BITS
:

324 
buf
[0] = 
edx
;

325 
buf
[1] = 
ecx
;

327 
CPU_L1_CACHE_AND_TLB_IDS
:

328 
buf
[0] = 
óx
;

329 
buf
[1] = 
ebx
;

330 
buf
[2] = 
ecx
;

331 
buf
[3] = 
edx
;

333 
CPU_EXTENDED_L2_CACHE_FEATURES
:

334 
buf
[0] = 
ecx
 & 0xFF;

335 
buf
[1] = (
ecx
 >> 12) & 0xFF;

336 
buf
[2] = 
ecx
 >> 16;

338 
CPU_ADV_POWER_MGT_INFO
:

339 *
buf
 = 
edx
;

341 
CPU_VIRT_PHYS_ADDR_SIZES
:

342 
buf
[0] = 
óx
 & 0xFF;

343 
buf
[1] = (
óx
 >> 8) & 0xFF;

346 *
buf
 = 0xbaadf00d;

349 
	}
}

	@ccan/ccan/cpuid/cpuid.h

22 #i‚de‡
CCAN_CPUID_H


23 
	#CCAN_CPUID_H


	)

25 
	~<°dboﬁ.h
>

26 
	~<°döt.h
>

65 
	e˝uid
 {

66 
	mCPU_VENDORID
 = 0,

67 
	mCPU_PROCINFO_AND_FEATUREBITS
 = 1,

68 
	mCPU_CACHE_AND_TLBD_INFO
 = 2,

70 
	mCPU_HIGHEST_EXTENDED_FUNCTION_SUPPORTED
 = 0x80000000,

71 
	mCPU_EXTENDED_PROC_INFO_FEATURE_BITS
 = 0x80000001,

72 
	mCPU_PROC_BRAND_STRING
 = 0x80000002,

73 
	mCPU_L1_CACHE_AND_TLB_IDS
 = 0x80000005,

74 
	mCPU_EXTENDED_L2_CACHE_FEATURES
 = 0x80000006,

75 
	mCPU_ADV_POWER_MGT_INFO
 = 0x80000007,

76 
	mCPU_VIRT_PHYS_ADDR_SIZES
 = 0x80000008

77 } 
	t˝uid_t
;

79 
	#CF_MMX
 0

	)

80 
	#CF_SSE
 1

	)

81 
	#CF_SSE2
 2

	)

82 
	#CF_SSE3
 3

	)

83 
	#CF_FPU
 4

	)

84 
	#CF_TSC
 5

	)

85 
	#CF_MSR
 6

	)

86 
	#CF_SSSE3
 7

	)

87 
	#CF_AVX
 8

	)

88 
	#CF_FMA
 9

	)

90 
	#CEF_x64
 10

	)

91 
	#CEF_FPU
 11

	)

92 
	#CEF_DE
 12

	)

93 
	#CEF_SYSCALLRET
 13

	)

94 
	#CEF_CMOV
 14

	)

95 
	#CEF_SSE4a
 15

	)

96 
	#CEF_FMA4
 16

	)

97 
	#CEF_XOP
 17

	)

99 
	e˝uty≥
 {

100 
	mCT_NONE
,

101 
	mCT_AMDK5
,

102 
	mCT_AMD
,

103 
	mCT_CENTAUR
,

104 
	mCT_CYRIX
,

105 
	mCT_INTEL
,

106 
	mCT_TRANSMETA
,

107 
	mCT_NATIONAL_SEMICONDUCTOR
,

108 
	mCT_NEXGEN
,

109 
	mCT_RISE
,

110 
	mCT_SIS
,

111 
	mCT_UMC
,

112 
	mCT_VIA
,

113 
	mCT_VORTEX
,

114 
	mCT_KVM


115 } 
	t˝uty≥_t
;

117 #i‡
deföed
(
__i386__
Ë|| deföed(
__i386
Ë|| deföed(
__x86_64
) \

118 || 
deföed
(
_M_AMD64
Ë|| 
	$deföed
(
__M_X64
)

127 
	#is_öãl_˝u
(Ë
	`˝uid_gë_˝u_ty≥
(Ë=
CT_INTEL


	)

128 
	#is_amd_˝u
(Ë
	`˝uid_gë_˝u_ty≥
(Ë=
CT_AMDK5
 || cpuid_gë_˝u_ty≥(Ë=
CT_AMD


	)

129 
˝uty≥_t
 
	`˝uid_gë_˝u_ty≥
();

137 
boﬁ
 
	`˝uid_•rötf_˝uty≥
(c⁄° 
˝uty≥_t
 
˝uty≥
, *
buf
);

148 
boﬁ
 
	`˝uid_is_suµ‹ãd
();

164 
uöt32_t
 
	`˝uid_highe°_ext_func_suµ‹ãd
();

228 
	`˝uid
(
˝uid_t
 
öfo
, 
uöt32_t
 *
buf
);

238 
boﬁ
 
	`˝uid_ã°_„©uª
(
˝uid_t
 
„©uª
);

253 
	#˝uid_has_mmx
(Ë
	`˝uid_has_„©uª
(
CF_MMX
, 
Ál£
)

	)

254 
	#˝uid_has_s£
(Ë
	`˝uid_has_„©uª
(
CF_SSE
, 
Ál£
)

	)

255 
	#˝uid_has_s£2
(Ë
	`˝uid_has_„©uª
(
CF_SSE2
, 
Ál£
)

	)

256 
	#˝uid_has_s£3
(Ë
	`˝uid_has_„©uª
(
CF_SSE3
, 
Ál£
)

	)

257 
	#˝uid_has_ss£3
(Ë
	`˝uid_has_„©uª
(
CF_SSSE3
, 
Ál£
)

	)

258 
	#˝uid_has_avx
(Ë
	`˝uid_has_„©uª
(
CF_AVX
, 
Ál£
)

	)

259 
	#˝uid_has_fma
(Ë
	`˝uid_has_„©uª
(
CF_FMA
, 
Ál£
)

	)

260 
	#˝uid_has_x64
(Ë
	`˝uid_has_„©uª
(
CEF_x64
, 
åue
)

	)

261 
	#˝uid_has_s£4a
(Ë
	`˝uid_has_„©uª
(
CEF_SSE4a
, 
åue
)

	)

262 
	#˝uid_has_fma4
(Ë
	`˝uid_has_„©uª
(
CEF_FMA4
, 
åue
)

	)

263 
	#˝uid_has_x›
(Ë
	`˝uid_has_„©uª
(
CEF_XOP
, 
åue
)

	)

264 
boﬁ
 
	`˝uid_has_„©uª
(
„©uª
, boﬁ 
exãnded
);

267 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

269 
	#˝uid_gë_˝u_ty≥
(Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

270 
	#˝uid_gë_˝u_ty≥_°rög
(Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

272 
	#˝uid_is_suµ‹ãd
(Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

273 
	#˝uid
(
öfo
, 
buf
Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

275 
	#˝uid_highe°_ext_func_suµ‹ãd
(Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

276 
	#˝uid_ã°_„©uª
(
„©uª
Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

277 
	#˝uid_has_„©uª
(
„©uª
, 
ext
Ë
	`BUILD_ASSERT_OR_ZERO
(0)

	)

	@ccan/ccan/cpuid/test/run.c

1 
	~"../˝uid.c
"

3 
	~<°dio.h
>

4 
	~<°döt.h
>

6 
	$maö
()

8 i‡(!
	`˝uid_is_suµ‹ãd
()) {

9 
	`¥ötf
 ("CPUID instruction isÇot supported byÅhis CPU\n");

13 
˝uty≥
[12];

14 i‡(
	`˝uid_•rötf_˝uty≥
(
	`˝uid_gë_˝u_ty≥
(), 
˝uty≥
))

15 
	`¥ötf
 ("Víd‹ ID: %s\n", 
˝uty≥
);

17 
buf
[48];

18 
	`˝uid
(
CPU_PROC_BRAND_STRING
, (
uöt32_t
 *)
buf
);

19 
	`¥ötf
 ("Pro˚ss‹ Bønd: %s\n", 
buf
);

21 
	`¥ötf
 ("Highe°Éxãnded fun˘i⁄ suµ‹ãd: %#010x\n", 
	`˝uid_highe°_ext_func_suµ‹ãd
());

23 
uöt32_t
 
phys_vút
[2];

24 
	`˝uid
(
CPU_VIRT_PHYS_ADDR_SIZES
, 
phys_vút
);

25 
	`¥ötf
 ("Physiˇ»addªs†size: %d\nVútuÆáddªs†size: %d\n", 
phys_vút
[0],Öhys_virt[1]);

27 
uöt32_t
 
ext„©uªs
[2];

28 
	`˝uid
(
CPU_EXTENDED_PROC_INFO_FEATURE_BITS
, 
ext„©uªs
);

29 
	`¥ötf
 ("ExãndedÖro˚ss‹ infÿ™d fótuª bôs: %d %d\n", 
ext„©uªs
[0],Éxtfeatures[1]);

31 
uöt32_t
 
l2c
[3];

32 
	`˝uid
(
CPU_EXTENDED_L2_CACHE_FEATURES
, 
l2c
);

33 
	`¥ötf
("L2 Line size: %u bytes\tAssociativity: %02xh\tCache Size: %u KB\n",

34 
l2c
[0],Ü2c[1],Ü2c[2]);

36 
uöt32_t
 
övÆid
;

37 
	`˝uid
(0x0ffffffUL, &
övÆid
);

38 
	`¥ötf
 ("Te°ög invÆid: %#010x\n", 
övÆid
);

40 
	}
}

	@ccan/ccan/crc/crc.c

26 
	~"¸c.h
"

27 
	~<cˇn/¨øy_size/¨øy_size.h
>

28 
	~<°dboﬁ.h
>

29 
	~<°dlib.h
>

39 c⁄° 
uöt32_t
 
	g¸c32c_èb
[] = {

110 
uöt32_t
 
	$¸c32c
(
uöt32_t
 
¸c
, c⁄° *
buf
, 
size_t
 
size
)

112 c⁄° 
uöt8_t
 *
p
 = 
buf
;

114 
size
--)

115 
¸c
 = 
¸c32c_èb
[(¸¯^ *
p
++) & 0xFFL] ^ (crc >> 8);

117  
¸c
;

118 
	}
}

120 c⁄° 
uöt32_t
 *
	$¸c32c_èbÀ
()

122  
¸c32c_èb
;

123 
	}
}

125 c⁄° 
uöt32_t
 
	g¸c32_õì_èb
[] = {

171 
uöt32_t
 
	$¸c32_õì
(
uöt32_t
 
¸c
, c⁄° *
buf
, 
size_t
 
size
)

173 c⁄° 
uöt8_t
 *
p
;

175 
p
 = 
buf
;

176 
¸c
 ^= ~0U;

178 
size
--)

179 
¸c
 = 
¸c32_õì_èb
[(¸¯^ *
p
++) & 0xFF] ^ (crc >> 8);

181  
¸c
 ^ ~0U;

182 
	}
}

184 c⁄° 
uöt32_t
 *
	$¸c32_õì_èbÀ
()

186  
¸c32_õì_èb
;

187 
	}
}

190 
uöt16_t
 
	g¸c64_èb
[] = {

279 
uöt64_t
 
	$¸c64_iso
(
uöt64_t
 
¸c
, c⁄° *
buf
, 
size_t
 
size
)

281 c⁄° 
uöt8_t
 *
p
 = 
buf
;

283 
size
--) {

284 
uöt64_t
 
èbvÆ
 = 
¸c64_èb
[(
¸c
 ^ *
p
++) & 0xFFL];

285 
èbvÆ
 <<= 48;

286 
¸c
 = 
èbvÆ
 ^ (crc >> 8);

288  
¸c
;

289 
	}
}

291 c⁄° 
uöt64_t
 *
	$¸c64_iso_èbÀ
()

293 
uöt64_t
 *
fuŒèb
 = 
NULL
;

294 
i
;

296 i‡(
fuŒèb
)

297  
fuŒèb
;

299 
fuŒèb
 = 
	`mÆloc
((
uöt64_t
)*
	`ARRAY_SIZE
(
¸c64_èb
));

300 i‡(!
fuŒèb
)

301  
NULL
;

303 
i
 = 0; i < 
	`ARRAY_SIZE
(
¸c64_èb
); i++)

304 
fuŒèb
[
i
] = (
uöt64_t
)
¸c64_èb
[i] << 48;

306  
fuŒèb
;

307 
	}
}

	@ccan/ccan/crc/crc.h

2 #i‚de‡
CCAN_CRC_H


3 
	#CCAN_CRC_H


	)

4 
	~<°döt.h
>

5 
	~<°dlib.h
>

46 
uöt32_t
 
¸c32c
(uöt32_à
°¨t_¸c
, c⁄° *
buf
, 
size_t
 
size
);

65 c⁄° 
uöt32_t
 *
¸c32c_èbÀ
();

78 
uöt32_t
 
¸c32_õì
(uöt32_à
°¨t_¸c
, c⁄° *
buf
, 
size_t
 
size
);

85 c⁄° 
uöt32_t
 *
¸c32_õì_èbÀ
();

98 
uöt64_t
 
¸c64_iso
(uöt64_à
°¨t_¸c
, c⁄° *
buf
, 
size_t
 
size
);

105 c⁄° 
uöt64_t
 *
¸c64_iso_èbÀ
();

	@ccan/ccan/crc/test/api.c

1 
	~<cˇn/¸c/¸c.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°rög.h
>

5 c⁄° 
uöt32_t
 
	g¸c32c_èb
[] = {

72 c⁄° 
uöt32_t
 
	g¸c32_õì_èb
[] = {

118 
uöt32_t
 
	g¸cc_ex≥˘
[] = {

164 
uöt32_t
 
	g¸cc_zîo_ex≥˘
[] = {

168 
uöt32_t
 
	g¸c_õì_ex≥˘
[] = {

214 
uöt32_t
 
	g¸c_õì_zîo_ex≥˘
[] = {

219 
ã°_¸c32
(
	$uöt32_t
 (*
¸c
)(
uöt32_t
, c⁄° *, 
size_t
),

220 c⁄° 
uöt32_t
 *(*
¸c_èbÀ
)(),

221 c⁄° 
uöt32_t
 
zîo_ex≥˘
[4],

222 c⁄° 
uöt32_t
 
four_ch¨_ex≥˘
[256],

223 c⁄° 
uöt32_t
 *
èbÀ_ex≥˘
)

225 
i
;

226 
c
[4] = { 0 };

228 
i
 = 0; i < 4; i++)

229 
	`ok1
(
	`¸c
(0, 
c
, 
i
Ë=
zîo_ex≥˘
[i]);

231 
i
 = 0; i < 256; i++) {

232 
	`mem£t
(
c
, 
i
, (c));

233 
	`ok1
(
	`¸c
(0, 
c
, (c)Ë=
four_ch¨_ex≥˘
[
i
]);

235 
	`ok1
(
	`¸c
(¸c(0, 
c
, 
i
%5), c+i%5, 4 - (i%5))

236 =
four_ch¨_ex≥˘
[
i
]);

238 
	`ok1
(
	`memcmp
(
	`¸c_èbÀ
(), 
èbÀ_ex≥˘
, 1024) == 0);

239 
	}
}

241 
	$ã°_¸c64
()

244 
	`ok1
(
	`¸c64_iso
(0, "IHATEMATH", 
	`°æí
("IHATEMATH"))

248 
	`ok1
(
	`¸c64_iso
(0, "123456789", 
	`°æí
("123456789"))

250 
	}
}

252 
	$maö
(
¨gc
, *
¨gv
[])

254 
	`∂™_ã°s
(517 * 2 + 2);

255 
	`ã°_¸c32
(
¸c32c
, 
¸c32c_èbÀ
,

256 
¸cc_zîo_ex≥˘
, 
¸cc_ex≥˘
, 
¸c32c_èb
);

257 
	`ã°_¸c32
(
¸c32_õì
, 
¸c32_õì_èbÀ
,

258 
¸c_õì_zîo_ex≥˘
, 
¸c_õì_ex≥˘
, 
¸c32_õì_èb
);

259 
	`ã°_¸c64
();

260  
	`exô_°©us
();

261 
	}
}

	@ccan/ccan/crcsync/crcsync.c

2 
	~"¸csync.h
"

3 
	~<cˇn/¸c/¸c.h
>

4 
	~<°rög.h
>

5 
	~<as£π.h
>

6 
	~<°dboﬁ.h
>

10 
uöt64_t
 
	$mask_of
(
¸cbôs
)

12  -1ULL << (64 - 
¸cbôs
);

13 
	}
}

15 
	$¸c_of_blocks
(c⁄° *
d©a
, 
size_t
 
Àn
, 
block_size
,

16 
¸cbôs
, 
uöt64_t
 
¸c
[])

18 
i
;

19 c⁄° 
uöt8_t
 *
buf
 = 
d©a
;

20 
uöt64_t
 
¸cmask
 = 
	`mask_of
(
¸cbôs
);

22 
i
 = 0; 
Àn
 >
block_size
; i++) {

23 
¸c
[
i
] = (
	`¸c64_iso
(0, 
buf
, 
block_size
Ë& 
¸cmask
);

24 
buf
 +
block_size
;

25 
Àn
 -
block_size
;

27 i‡(
Àn
)

28 
¸c
[
i
] = (
	`¸c64_iso
(0, 
buf
, 
Àn
Ë& 
¸cmask
);

29 
	}
}

31 
	s¸c_c⁄ãxt
 {

32 
size_t
 
	mblock_size
;

33 
uöt64_t
 
	m¸cmask
;

36 *
	mbuf„r
;

37 
size_t
 
	mbuf„r_°¨t
, 
	mbuf„r_íd
;

40 
uöt64_t
 
	mru¬ög_¸c
;

41 
size_t
 
	mlôîÆ_byãs
;

42 
size_t
 
	mtŸÆ_byãs
;

43 
	mhave_m©ch
;

46 
size_t
 
	mèû_size
;

47 
uöt64_t
 
	mèû_¸c
;

50 
uöt64_t
 
	mun¸c_èb
[256];

53 
	mnum_¸cs
;

54 
uöt64_t
 
	m¸c
[];

59 
	$öô_un¸c_èb
(
uöt64_t
 
un¸c_èb
[], 
wsize
)

61 
i
;

62 
uöt64_t
 
∑π_¸c
;

63 
uöt8_t
 
buf„r
[
wsize
];

66 
	`mem£t
(
buf„r
, 0, 
wsize
);

67 
∑π_¸c
 = 
	`¸c64_iso
(0, 
buf„r
+1, 
wsize
-1);

69 
i
 = 0; i < 256; i++) {

70 
buf„r
[0] = 
i
;

71 
un¸c_èb
[
i
] = (
	`¸c64_iso
(0, 
buf„r
, 
wsize
Ë^ 
∑π_¸c
);

73 
	}
}

75 
¸c_c⁄ãxt
 *
	$¸c_c⁄ãxt_√w
(
size_t
 
block_size
, 
¸cbôs
,

76 c⁄° 
uöt64_t
 
¸c
[], 
num_¸cs
,

77 
size_t
 
èû_size
)

79 
¸c_c⁄ãxt
 *
˘x
;

81 
	`as£π
(
num_¸cs
 > 0);

82 
	`as£π
(
block_size
 > 0);

83 
	`as£π
(
èû_size
 < 
block_size
);

85 
˘x
 = 
	`mÆloc
((*˘xË+ (
¸c
[0])*
num_¸cs
);

86 i‡(
˘x
) {

87 
˘x
->
block_size
 = block_size;

88 
˘x
->
èû_size
 =Åail_size;

89 i‡(
èû_size
)

90 
˘x
->
èû_¸c
 = 
¸c
[--
num_¸cs
];

92 
˘x
->
¸cmask
 = 
	`mask_of
(
¸cbôs
);

93 
˘x
->
num_¸cs
 =Çum_crcs;

94 
	`mem˝y
(
˘x
->
¸c
, crc, (¸c[0])*
num_¸cs
);

95 
˘x
->
buf„r_íd
 = 0;

96 
˘x
->
buf„r_°¨t
 = 0;

97 
˘x
->
ru¬ög_¸c
 = 0;

98 
˘x
->
lôîÆ_byãs
 = 0;

99 
˘x
->
tŸÆ_byãs
 = 0;

100 
˘x
->
have_m©ch
 = -1;

101 
	`öô_un¸c_èb
(
˘x
->
un¸c_èb
, 
block_size
);

102 
˘x
->
buf„r
 = 
	`mÆloc
(
block_size
);

103 i‡(!
˘x
->
buf„r
) {

104 
	`‰ì
(
˘x
);

105 
˘x
 = 
NULL
;

108  
˘x
;

109 
	}
}

112 
	$¸c_m©ches
(c⁄° 
¸c_c⁄ãxt
 *
˘x
)

114 
i
;

116 i‡(
˘x
->
lôîÆ_byãs
 < ctx->
block_size
)

119 
i
 = 0; i < 
˘x
->
num_¸cs
; i++)

120 i‡((
˘x
->
ru¬ög_¸c
 & ctx->
¸cmask
Ë=˘x->
¸c
[
i
])

121  
i
;

123 
	}
}

125 
boﬁ
 
	$èû_m©ches
(c⁄° 
¸c_c⁄ãxt
 *
˘x
)

127 i‡(
˘x
->
lôîÆ_byãs
 !˘x->
èû_size
)

128  
Ál£
;

130  (
˘x
->
ru¬ög_¸c
 & ctx->
¸cmask
Ë=˘x->
èû_¸c
;

131 
	}
}

133 
uöt64_t
 
	$¸c_add_byã
(
uöt64_t
 
¸c
, 
uöt8_t
 
√wbyã
)

135  
	`¸c64_iso
(
¸c
, &
√wbyã
, 1);

136 
	}
}

138 
uöt64_t
 
	$¸c_ªmove_byã
(
uöt64_t
 
¸c
, 
uöt8_t
 
ﬁdbyã
,

139 c⁄° 
uöt64_t
 
un¸c_èb
[])

141  
¸c
 ^ 
un¸c_èb
[
ﬁdbyã
];

142 
	}
}

144 
uöt64_t
 
	$¸c_rﬁl
(
uöt64_t
 
¸c
, 
uöt8_t
 
ﬁdbyã
, uöt8_à
√wbyã
,

145 c⁄° 
uöt64_t
 
un¸c_èb
[])

147  
	`¸c_add_byã
(
	`¸c_ªmove_byã
(
¸c
, 
ﬁdbyã
, 
un¸c_èb
), 
√wbyã
);

148 
	}
}

150 
size_t
 
	$buf„r_size
(c⁄° 
¸c_c⁄ãxt
 *
˘x
)

152  
˘x
->
buf„r_íd
 - ctx->
buf„r_°¨t
;

153 
	}
}

155 
size_t
 
	$¸c_ªad_block
(
¸c_c⁄ãxt
 *
˘x
, *
ªsu…
,

156 c⁄° *
buf
, 
size_t
 
buÊí
)

158 
size_t
 
c⁄sumed
 = 0, 
Àn
;

159 
¸cm©ch
 = -1;

160 c⁄° 
uöt8_t
 *
ﬁd
, *
p
 = 
buf
;

163 i‡(
˘x
->
have_m©ch
 >= 0) {

164 
¸cm©ch
 = 
˘x
->
have_m©ch
;

165 
have_m©ch
;

169 i‡(
	`buf„r_size
(
˘x
Ë>˘x->
block_size
)

170 
ﬁd
 = (
uöt8_t
 *)
˘x
->
buf„r
 + ctx->
buf„r_°¨t
;

172 
ﬁd
 = 
NULL
;

174 
˘x
->
lôîÆ_byãs
 < ctx->
block_size


175 || (
¸cm©ch
 = 
	`¸c_m©ches
(
˘x
)) < 0) {

176 i‡(
c⁄sumed
 =
buÊí
)

180 
˘x
->
lôîÆ_byãs
++;

181 
˘x
->
tŸÆ_byãs
++;

182 
c⁄sumed
++;

185 i‡(
ﬁd
) {

186 
˘x
->
ru¬ög_¸c
 = 
	`¸c_rﬁl
(ctx->running_crc,

187 *
ﬁd
, *
p
,

188 
˘x
->
un¸c_èb
);

189 
ﬁd
++;

191 i‡(
ﬁd
 =(
uöt8_t
 *)
˘x
->
buf„r
 + ctx->
buf„r_íd
)

192 
ﬁd
 = 
buf
;

194 
˘x
->
ru¬ög_¸c
 = 
	`¸c_add_byã
(˘x->ru¬ög_¸c, *
p
);

195 i‡(
p
 =(
uöt8_t
 *)
buf
 + 
˘x
->
block_size
 - 1)

196 
ﬁd
 = 
buf
;

199 i‡(
	`èû_m©ches
(
˘x
)) {

200 
¸cm©ch
 = 
˘x
->
num_¸cs
;

201 
have_m©ch
;

204 
p
++;

207 i‡(
¸cm©ch
 >= 0) {

209 i‡(
˘x
->
lôîÆ_byãs
 > ctx->
block_size
) {

211 *
ªsu…
 = 
˘x
->
lôîÆ_byãs
 - ctx->
block_size
;

212 
˘x
->
lôîÆ_byãs
 = ctx->
block_size
;

214 
˘x
->
have_m©ch
 = 
¸cm©ch
;

216 
have_m©ch
:

217 *
ªsu…
 = -
¸cm©ch
-1;

218 i‡(
¸cm©ch
 =
˘x
->
num_¸cs
)

219 
	`as£π
(
˘x
->
lôîÆ_byãs
 =˘x->
èû_size
);

221 
	`as£π
(
˘x
->
lôîÆ_byãs
 =˘x->
block_size
);

222 
˘x
->
lôîÆ_byãs
 = 0;

223 
˘x
->
have_m©ch
 = -1;

224 
˘x
->
ru¬ög_¸c
 = 0;

226 
˘x
->
buf„r_°¨t
 = ctx->
buf„r_íd
 = 0;

230 i‡(
˘x
->
lôîÆ_byãs
 > ctx->
block_size
) {

231 *
ªsu…
 = 
˘x
->
lôîÆ_byãs
 - ctx->
block_size
;

232 
˘x
->
lôîÆ_byãs
 -*
ªsu…
;

234 i‡(*
ªsu…
 >
	`buf„r_size
(
˘x
))

235 
˘x
->
buf„r_°¨t
 = ctx->
buf„r_íd
 = 0;

237 
˘x
->
buf„r_°¨t
 +*
ªsu…
;

239 *
ªsu…
 = 0;

242 
Àn
 = 
˘x
->
lôîÆ_byãs
 - 
	`buf„r_size
(ctx);

245 i‡(
˘x
->
buf„r_íd
 + 
Àn
 > ctx->
block_size
) {

246 
	`memmove
(
˘x
->
buf„r
,

247 (
uöt8_t
 *)
˘x
->
buf„r
 + ctx->
buf„r_°¨t
,

248 
	`buf„r_size
(
˘x
));

249 
˘x
->
buf„r_íd
 -˘x->
buf„r_°¨t
;

250 
˘x
->
buf„r_°¨t
 = 0;

254 
	`mem˝y
((
uöt8_t
 *)
˘x
->
buf„r
 + ctx->
buf„r_íd
,

255 (c⁄° 
uöt8_t
 *)
buf
 + 
buÊí
 - 
Àn
,Üen);

256 
˘x
->
buf„r_íd
 +
Àn
;

257 
	`as£π
(
	`buf„r_size
(
˘x
Ë<˘x->
block_size
);

259  
c⁄sumed
;

260 
	}
}

262 
	$¸c_ªad_Êush
(
¸c_c⁄ãxt
 *
˘x
)

264 
ªt
;

267 i‡(
˘x
->
have_m©ch
 != -1) {

268 
˘x
->
lôîÆ_byãs
 -˘x->
block_size
;

269 
	`as£π
(
˘x
->
lôîÆ_byãs
 == 0);

270 
ªt
 = -
˘x
->
have_m©ch
-1;

271 
˘x
->
have_m©ch
 = -1;

272 
˘x
->
ru¬ög_¸c
 = 0;

274 
˘x
->
buf„r_°¨t
 = ctx->
buf„r_íd
;

275  
ªt
;

279 
ªt
 = 
	`buf„r_size
(
˘x
);

280 
	`as£π
(
˘x
->
lôîÆ_byãs
 =
ªt
);

281 
˘x
->
buf„r_°¨t
 = ctx->
buf„r_íd
 = 0;

282 
˘x
->
lôîÆ_byãs
 = 0;

283  
ªt
;

284 
	}
}

290 
	$¸c_c⁄ãxt_‰ì
(
¸c_c⁄ãxt
 *
˘x
)

292 
	`‰ì
(
˘x
->
buf„r
);

293 
	`‰ì
(
˘x
);

294 
	}
}

	@ccan/ccan/crcsync/crcsync.h

2 #i‚de‡
CCAN_CRCSYNC_H


3 
	#CCAN_CRCSYNC_H


	)

4 
	~<°döt.h
>

5 
	~<°ddef.h
>

18 
¸c_of_blocks
(c⁄° *
d©a
, 
size_t
 
Àn
, 
blocksize
,

19 
¸cbôs
, 
uöt64_t
 
¸c
[]);

32 
¸c_c⁄ãxt
 *
¸c_c⁄ãxt_√w
(
size_t
 
blocksize
, 
¸cbôs
,

33 c⁄° 
uöt64_t
 
¸c
[], 
num_¸cs
,

34 
size_t
 
föÆ_size
);

51 
size_t
 
¸c_ªad_block
(
¸c_c⁄ãxt
 *
˘x
, *
ªsu…
,

52 c⁄° *
buf
, 
size_t
 
buÊí
);

61 
¸c_ªad_Êush
(
¸c_c⁄ãxt
 *
˘x
);

67 
¸c_c⁄ãxt_‰ì
(
¸c_c⁄ãxt
 *
˘x
);

	@ccan/ccan/crcsync/test/run-crash.c

3 
	~<cˇn/¸csync/¸csync.h
>

4 
	~<cˇn/¸csync/¸csync.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<°dlib.h
>

7 
	~<°dboﬁ.h
>

10 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ (◊º)[0]))

	)

13 
	mblock_cou¡
;

14 
uöt64_t
 *
	m¸cs
;

15 } 
	t¸c_öfo_t
;

17 
	$¸cblocks
(
¸c_öfo_t
 *
¸c_öfo
, c⁄° *
d©a
, 
d©Æí
, 
blocksize
)

19 
¸c_öfo
->
block_cou¡
 = (
d©Æí
+
blocksize
-1)/blocksize;

20 
¸c_öfo
->
¸cs
 = 
	`mÆloc
((
uöt64_t
)*(¸c_öfo->
block_cou¡
 + 1));

21 
	`¸c_of_blocks
(
d©a
, 
d©Æí
, 
blocksize
, 60, 
¸c_öfo
->
¸cs
);

22 
	}
}

24 
	#BLOCKSIZE
 5

	)

26 
	$maö
(
¨gc
, *
¨gv
[])

29 c⁄° *
d©a1
 =

33 c⁄° *
d©a2
 =

46 
ex≥˘ed
[] = { 4,

52 
¸c_öfo_t
 
¸c_öfo1
;

53 
¸c_c⁄ãxt
 *
¸c˘x
;

54 
ªsu…
;

55 
size_t
 
ndige°ed
;

56 
size_t
 
off£t
 = 0;

57 
size_t
 
Àn2
 = 
	`°æí
(
d©a2
);

58 
size_t
 
èûsize
 = 
	`°æí
(
d©a1
Ë% 
BLOCKSIZE
;

59 
ex≥˘ed_i
 = 0;

61 
	`∂™_ã°s
(
	`ARRAY_SIZE
(
ex≥˘ed
) + 2);

62 
	`¸cblocks
(&
¸c_öfo1
, 
d©a1
, 
	`°æí
(d©a1), 
BLOCKSIZE
);

64 
¸c˘x
 = 
	`¸c_c⁄ãxt_√w
(
BLOCKSIZE
, 60, 
¸c_öfo1
.
¸cs
, crc_öfo1.
block_cou¡
,

65 
èûsize
);

66  
off£t
 < 
Àn2
)

68 
ndige°ed
 = 
	`¸c_ªad_block
(
¸c˘x
, &
ªsu…
, 
d©a2
+
off£t
, 
Àn2
 - offset);

69 
off£t
 +
ndige°ed
;

70 i‡(
ªsu…
 < 0)

72 
	`ok1
(
ªsu…
 =
ex≥˘ed
[
ex≥˘ed_i
++]);

75 
	`ok1
(
ªsu…
 <
ex≥˘ed
[
ex≥˘ed_i
]);

76 
ex≥˘ed
[
ex≥˘ed_i
] -
ªsu…
;

77 i‡(!
ex≥˘ed
[
ex≥˘ed_i
])

78 
ex≥˘ed_i
++;

82 (
ªsu…
 = 
	`¸c_ªad_Êush
(
¸c˘x
)) != 0) {

83 i‡(
ªsu…
 < 0)

85 
	`ok1
(
ªsu…
 =
ex≥˘ed
[
ex≥˘ed_i
++]);

88 
	`ok1
(
ªsu…
 <
ex≥˘ed
[
ex≥˘ed_i
]);

89 
ex≥˘ed
[
ex≥˘ed_i
] -
ªsu…
;

90 i‡(!
ex≥˘ed
[
ex≥˘ed_i
])

91 
ex≥˘ed_i
++;

94 
	`ok1
(
ex≥˘ed_i
 =
	`ARRAY_SIZE
(
ex≥˘ed
));

95 
	`¸c_c⁄ãxt_‰ì
(
¸c˘x
);

96 
	`‰ì
(
¸c_öfo1
.
¸cs
);

98 
	}
}

	@ccan/ccan/crcsync/test/run-crc.c

1 
	~<cˇn/¸csync/¸csync.h
>

2 
	~<cˇn/¸csync/¸csync.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 
buf„r
[1024];

8 
i
, 
j
;

9 
uöt64_t
 
¸cs
[12] = { 0xFFFFF, 0xdeadf00d };

11 
	`∂™_ã°s
(3 + 8192);

14 
	`mem£t
(
buf„r
, 0, (buffer));

15 
	`¸c_of_blocks
(
buf„r
, (buf„r), (buf„r), 64, 
¸cs
);

16 
	`ok1
(
¸cs
[0] == 0);

17 
	`¸c_of_blocks
(
buf„r
, (buf„r), (buf„r)/2, 64, 
¸cs
);

18 
	`ok1
(
¸cs
[0] == 0);

19 
	`ok1
(
¸cs
[1] == 0);

22 
i
 = 0; i < (
buf„r
); i++) {

23 
buf„r
[
i
] = i;

24 
	`¸c_of_blocks
(
buf„r
, (buffer), (buffer)/7,

25 64, 
¸cs
);

26 
j
 = 0; j < (
buf„r
); j += (buffer)/7) {

27 
Àn
 = (
buf„r
)/7;

28 i‡(
j
 + 
Àn
 > (
buf„r
))

29 
Àn
 = (
buf„r
Ë- 
j
;

31 
	`ok1
(
	`¸c64_iso
(0, 
buf„r
 + 
j
, 
Àn
Ë=
¸cs
[j/((buffer)/7)]);

35  
	`exô_°©us
();

36 
	}
}

	@ccan/ccan/crcsync/test/run-roll.c

1 
	~<cˇn/¸csync/¸csync.h
>

2 
	~<cˇn/¸csync/¸csync.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

5 
	~<°dboﬁ.h
>

8 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ (◊º)[0]))

	)

10 
	$ã°_rﬁl
(
wsize
)

12 
uöt8_t
 
d©a
[
wsize
 * 2];

13 
uöt64_t
 
un¸c_èb
[256];

14 
i
;

16 
	`öô_un¸c_èb
(
un¸c_èb
, 
wsize
);

18 
i
 = 0; i < 
	`ARRAY_SIZE
(
d©a
); i++)

19 
d©a
[
i
] = 
	`øndom
();

21 
i
 = 1; i < 
	`ARRAY_SIZE
(
d©a
Ë- 
wsize
; i++) {

22 
uöt64_t
 
rﬁl¸c
, 
¸c
;

24 
¸c
 = 
	`¸c64_iso
(0, 
d©a
+
i
, 
wsize
);

25 
rﬁl¸c
 = 
	`¸c_rﬁl
(
	`¸c64_iso
(0, 
d©a
+
i
-1, 
wsize
),

26 
d©a
[
i
-1], d©a[i+
wsize
-1], 
un¸c_èb
);

28 
	`ok
(
¸c
 =
rﬁl¸c
, "wsizê%u, i %u", 
wsize
, 
i
);

30 
	}
}

32 
	$maö
(
¨gc
, *
¨gv
[])

34 
	`∂™_ã°s
(100 - 1 + 128 - 1);

35 
	`ã°_rﬁl
(100);

36 
	`ã°_rﬁl
(128);

37  
	`exô_°©us
();

38 
	}
}

	@ccan/ccan/crcsync/test/run.c

1 
	~<cˇn/¸csync/¸csync.h
>

2 
	~<cˇn/¸csync/¸csync.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

5 
	~<°dboﬁ.h
>

6 
	~<°rög.h
>

9 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ (◊º)[0]))

	)

11 
	sªsu…
 {

13 
	mLITERAL
, 
	mBLOCK


14 } 
	mty≥
;

16 
size_t
 
	mvÆ
;

19 
ölöe
 
size_t
 
	$num_blocks
(
size_t
 
Àn
, size_à
block_size
)

21  (
Àn
 + 
block_size
 - 1) / block_size;

22 
	}
}

24 
	$check_föÆized_ªsu…
(
size_t
 
cuº_lôîÆ
,

25 c⁄° 
ªsu…
 
ªsu…s
[],

26 
size_t
 
num_ªsu…s
,

27 
size_t
 *
cuº_ªsu…
)

29 i‡(
cuº_lôîÆ
 == 0)

31 
	`ok1
(*
cuº_ªsu…
 < 
num_ªsu…s
);

32 
	`ok1
(
ªsu…s
[*
cuº_ªsu…
].
ty≥
 =
LITERAL
);

33 
	`ok1
(
ªsu…s
[*
cuº_ªsu…
].
vÆ
 =
cuº_lôîÆ
);

34 (*
cuº_ªsu…
)++;

35 
	}
}

37 
	$check_ªsu…
(
ªsu…
,

38 
size_t
 *
cuº_lôîÆ
,

39 c⁄° 
ªsu…
 
ªsu…s
[], 
size_t
 
num_ªsu…s
,

40 
size_t
 *
cuº_ªsu…
)

43 i‡(
ªsu…
 >= 0) {

44 *
cuº_lôîÆ
 +
ªsu…
;

49 i‡(*
cuº_lôîÆ
) {

50 
	`check_föÆized_ªsu…
(*
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
,

51 
cuº_ªsu…
);

52 *
cuº_lôîÆ
 = 0;

55 
	`ok1
(*
cuº_ªsu…
 < 
num_ªsu…s
);

56 
	`ok1
(
ªsu…s
[*
cuº_ªsu…
].
ty≥
 =
BLOCK
);

57 
	`ok1
(
ªsu…s
[*
cuº_ªsu…
].
vÆ
 =-
ªsu…
 - 1);

58 (*
cuº_ªsu…
)++;

59 
	}
}

62 
	$ã°_sync
(c⁄° *
buf„r1
, 
size_t
 
Àn1
,

63 c⁄° *
buf„r2
, 
size_t
 
Àn2
,

64 
size_t
 
block_size
,

65 c⁄° 
ªsu…
 
ªsu…s
[], 
size_t
 
num_ªsu…s
)

67 
¸c_c⁄ãxt
 *
˘x
;

68 
size_t
 
u£d
, 
ªt
, 
i
, 
cuº_lôîÆ
, 
èûsize
;

69 
ªsu…
;

70 
uöt64_t
 
¸cs
[
	`num_blocks
(
Àn1
, 
block_size
)];

72 
	`¸c_of_blocks
(
buf„r1
, 
Àn1
, 
block_size
, 64, 
¸cs
);

74 
èûsize
 = 
Àn1
 % 
block_size
;

77 
˘x
 = 
	`¸c_c⁄ãxt_√w
(
block_size
, 64, 
¸cs
, 
	`ARRAY_SIZE
(crcs),

78 
èûsize
);

80 
cuº_lôîÆ
 = 0;

81 
u£d
 = 0, 
i
 = 0; u£d < 
Àn2
; u£d +
ªt
) {

82 
ªt
 = 
	`¸c_ªad_block
(
˘x
, &
ªsu…
, 
buf„r2
+
u£d
, 
Àn2
-used);

83 
	`check_ªsu…
(
ªsu…
, &
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
, &
i
);

86 (
ªsu…
 = 
	`¸c_ªad_Êush
(
˘x
)) != 0)

87 
	`check_ªsu…
(
ªsu…
, &
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
, &
i
);

89 
	`check_föÆized_ªsu…
(
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
, &
i
);

92 
	`ok1
(
i
 =
num_ªsu…s
);

93 
	`¸c_c⁄ãxt_‰ì
(
˘x
);

96 
˘x
 = 
	`¸c_c⁄ãxt_√w
(
block_size
, 64, 
¸cs
, 
	`ARRAY_SIZE
(crcs),

97 
èûsize
);

99 
cuº_lôîÆ
 = 0;

100 
u£d
 = 0, 
i
 = 0; u£d < 
Àn2
; u£d +
ªt
) {

101 
ªt
 = 
	`¸c_ªad_block
(
˘x
, &
ªsu…
, 
buf„r2
+
u£d
, 1);

103 
	`check_ªsu…
(
ªsu…
, &
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
, &
i
);

106 (
ªsu…
 = 
	`¸c_ªad_Êush
(
˘x
)) != 0)

107 
	`check_ªsu…
(
ªsu…
, &
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
, &
i
);

109 
	`check_föÆized_ªsu…
(
cuº_lôîÆ
, 
ªsu…s
, 
num_ªsu…s
, &
i
);

112 
	`ok1
(
i
 =
num_ªsu…s
);

113 
	`¸c_c⁄ãxt_‰ì
(
˘x
);

114 
	}
}

116 
	#BUFFER_SIZE
 512

	)

117 
	#BLOCK_SIZE
 128

	)

118 
	#NUM_BLOCKS
 (
BUFFER_SIZE
 / 
BLOCK_SIZE
)

	)

120 
	$maö
(
¨gc
, *
¨gv
[])

122 *
buf„r1
, *
buf„r2
;

123 
i
;

124 
uöt64_t
 
¸cs1
[
NUM_BLOCKS
], 
¸cs2
[NUM_BLOCKS];

126 
	`∂™_ã°s
(664);

128 
buf„r1
 = 
	`ˇŒoc
(
BUFFER_SIZE
, 1);

129 
buf„r2
 = 
	`ˇŒoc
(
BUFFER_SIZE
, 1);

132 
¸cs1
[
	`ARRAY_SIZE
(crcs1)-1] = 0xdeadbeef;

133 
	`¸c_of_blocks
(
buf„r1
, 
BUFFER_SIZE
-
BLOCK_SIZE
-1, BLOCK_SIZE, 64, 
¸cs1
);

134 
	`ok1
(
¸cs1
[
	`ARRAY_SIZE
(crcs1)-1] == 0xdeadbeef);

135 
	`¸c_of_blocks
(
buf„r2
, 
BUFFER_SIZE
-
BLOCK_SIZE
-1, BLOCK_SIZE, 64, 
¸cs2
);

136 
	`ok1
(
	`memcmp
(
¸cs1
, 
¸cs2
, (¸cs1[0])*(
	`ARRAY_SIZE
(crcs1)-1)) == 0);

139 
i
 = 0; i < 
BUFFER_SIZE
; i++)

140 
buf„r1
[
i
] = 
buf„r2
[i] = i + i/
BLOCK_SIZE
;

142 
¸cs1
[
	`ARRAY_SIZE
(crcs1)-1] = 0xdeadbeef;

143 
	`¸c_of_blocks
(
buf„r1
, 
BUFFER_SIZE
-
BLOCK_SIZE
-1, BLOCK_SIZE, 64, 
¸cs1
);

144 
	`ok1
(
¸cs1
[
	`ARRAY_SIZE
(crcs1)-1] == 0xdeadbeef);

145 
	`¸c_of_blocks
(
buf„r2
, 
BUFFER_SIZE
-
BLOCK_SIZE
-1, BLOCK_SIZE, 64, 
¸cs2
);

146 
	`ok1
(
	`memcmp
(
¸cs1
, 
¸cs2
, (¸cs1[0])*(
	`ARRAY_SIZE
(crcs1)-1)) == 0);

149 
	`¸c_of_blocks
(
buf„r1
, 
BUFFER_SIZE
, 
BLOCK_SIZE
, 64, 
¸cs1
);

150 
	`¸c_of_blocks
(
buf„r2
, 
BUFFER_SIZE
, 
BLOCK_SIZE
, 8, 
¸cs2
);

151 
i
 = 0; i < 
NUM_BLOCKS
; i++)

152 
	`ok1
(
¸cs2
[
i
] =(
¸cs1
[i] & 0xFF00000000000000ULL));

156 
ªsu…
 
ªs
[
NUM_BLOCKS
];

158 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªs
); i++) {

159 
ªs
[
i
].
ty≥
 = 
BLOCK
;

160 
ªs
[
i
].
vÆ
 = i;

162 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
, 
buf„r2
,

163 
BUFFER_SIZE
, 
BLOCK_SIZE
,

164 
ªs
, 
	`ARRAY_SIZE
(res));

169 
ªsu…
 
ªs
[
NUM_BLOCKS
+1];

170 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªs
); i++) {

171 
ªs
[
i
].
ty≥
 = 
BLOCK
;

172 
ªs
[
i
].
vÆ
 = i;

174 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
, 
buf„r2
,

175 
BUFFER_SIZE
, 
BLOCK_SIZE
-1,

176 
ªs
, 
	`ARRAY_SIZE
(res));

181 
ªsu…
 
ªs
[
NUM_BLOCKS
];

182 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªs
)-1; i++) {

183 
ªs
[
i
].
ty≥
 = 
BLOCK
;

184 
ªs
[
i
].
vÆ
 = i;

186 
ªs
[
i
].
ty≥
 = 
LITERAL
;

187 
ªs
[
i
].
vÆ
 = 1;

189 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
-
BLOCK_SIZE
,

190 
buf„r2
, 
BUFFER_SIZE
-
BLOCK_SIZE
+1, BLOCK_SIZE,

191 
ªs
, 
	`ARRAY_SIZE
(res));

196 
ªsu…
 
ªs
[
NUM_BLOCKS
+2];

197 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªs
)-1; i++) {

198 
ªs
[
i
].
ty≥
 = 
BLOCK
;

199 
ªs
[
i
].
vÆ
 = i;

201 
ªs
[
i
].
ty≥
 = 
LITERAL
;

202 
ªs
[
i
].
vÆ
 = 1;

204 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
-1,

205 
buf„r2
, 
BUFFER_SIZE
,

206 
BLOCK_SIZE
 - 1, 
ªs
, 
	`ARRAY_SIZE
(res));

210 
i
 = 0; i < 
NUM_BLOCKS
; i++) {

211 
j
;

212 
ªsu…
 
ªs
[
NUM_BLOCKS
];

215 
	`mem˝y
(
buf„r2
, 
buf„r1
, 
BUFFER_SIZE
);

216 
buf„r2
[
i
 * 
BLOCK_SIZE
]++;

218 
j
 = 0; j < 
	`ARRAY_SIZE
(
ªs
); j++) {

219 i‡(
j
 =
i
) {

220 
ªs
[
j
].
ty≥
 = 
LITERAL
;

221 
ªs
[
j
].
vÆ
 = 
BLOCK_SIZE
;

223 
ªs
[
j
].
ty≥
 = 
BLOCK
;

224 
ªs
[
j
].
vÆ
 = j;

228 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
,

229 
buf„r2
, 
BUFFER_SIZE
,

230 
BLOCK_SIZE
, 
ªs
, 
	`ARRAY_SIZE
(res));

234 
i
 = 0; i < 
NUM_BLOCKS
; i++) {

235 
j
;

236 
ªsu…
 
ªs
[
NUM_BLOCKS
];

239 
	`mem˝y
(
buf„r2
, 
buf„r1
, 
i
 * 
BLOCK_SIZE
 + BLOCK_SIZE/2);

240 
	`mem˝y
(
buf„r2
 + 
i
 * 
BLOCK_SIZE
 + BLOCK_SIZE/2,

241 
buf„r1
 + 
i
 * 
BLOCK_SIZE
 + BLOCK_SIZE/2 + 1,

242 
BUFFER_SIZE
 - (
i
 * 
BLOCK_SIZE
 + BLOCK_SIZE/2 + 1));

244 
j
 = 0; j < 
	`ARRAY_SIZE
(
ªs
); j++) {

245 i‡(
j
 =
i
) {

246 
ªs
[
j
].
ty≥
 = 
LITERAL
;

247 
ªs
[
j
].
vÆ
 = 
BLOCK_SIZE
-1;

249 
ªs
[
j
].
ty≥
 = 
BLOCK
;

250 
ªs
[
j
].
vÆ
 = j;

254 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
,

255 
buf„r2
, 
BUFFER_SIZE
-1,

256 
BLOCK_SIZE
, 
ªs
, 
	`ARRAY_SIZE
(res));

260 
i
 = 0; i < (1 << 
NUM_BLOCKS
); i++) {

261 
j
, 
num_ªs
;

262 
ªsu…
 
ªs
[
NUM_BLOCKS
];

264 
	`mem˝y
(
buf„r2
, 
buf„r1
, 
BUFFER_SIZE
);

265 
j
 = 
num_ªs
 = 0; j < 
	`ARRAY_SIZE
(
ªs
); j++) {

266 i‡(
i
 & (ò<< 
j
)) {

267 
ªs
[
num_ªs
].
ty≥
 = 
BLOCK
;

268 
ªs
[
num_ªs
].
vÆ
 = 
j
;

269 
num_ªs
++;

272 
buf„r2
[
j
 * 
BLOCK_SIZE
]++;

273 i‡(
num_ªs
 && 
ªs
[num_ªs-1].
ty≥
 =
LITERAL
)

274 
ªs
[
num_ªs
-1].
vÆ
 +
BLOCK_SIZE
;

276 
ªs
[
num_ªs
].
ty≥
 = 
LITERAL
;

277 
ªs
[
num_ªs
].
vÆ
 = 
BLOCK_SIZE
;

278 
num_ªs
++;

283 
	`ã°_sync
(
buf„r1
, 
BUFFER_SIZE
,

284 
buf„r2
, 
BUFFER_SIZE
,

285 
BLOCK_SIZE
, 
ªs
, 
num_ªs
);

288 
	`‰ì
(
buf„r1
);

289 
	`‰ì
(
buf„r2
);

290  
	`exô_°©us
();

291 
	}
}

	@ccan/ccan/daemon_with_notify/daemon_with_notify.c

32 
	~<f˙é.h
>

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<sys/ty≥s.h
>

36 
	~<sys/waô.h
>

37 
	~<sig«l.h
>

38 
	~<uni°d.h
>

39 
	~<sys/£À˘.h
>

41 
	~<cˇn/d´m⁄_wôh_nŸify/d´m⁄_wôh_nŸify.h
>

43 
sigu§1_h™dÀr
(
sig
);

45 
pid_t
 
	g∑ª¡_pid
;

47 
	$sigu§1_h™dÀr
(
sig
)

49 i‡(
sig
 =
SIGUSR1
)

50 
	`_exô
(
EXIT_SUCCESS
);

51 
	}
}

53 
	$d´m⁄_is_ªady
()

55 
	`kûl
(
∑ª¡_pid
, 
SIGUSR1
);

57 
	}
}

59 
	$d´m⁄ize
(
nochdú
, 
no˛o£
, 
waô_sigu§1
)

61 
fd
;

62 
pid_t
 
chûd
= -1;

64 
∑ª¡_pid

	`gëpid
();

65 
	`sig«l
(
SIGUSR1
, 
sigu§1_h™dÀr
);

67 
chûd

	`f‹k
();

69 
chûd
)

76 i‡(
waô_sigu§1
)

79 
exô_code
= -1;

80 
°©us
;

81 
	`waôpid
(
chûd
, &
°©us
, 0) != child);

82 i‡(
	`WIFEXITED
(
°©us
))

84 
exô_code

	`WEXITSTATUS
(
°©us
);

86 i‡(
	`WIFSIGNALED
(
°©us
))

88 
exô_code
= -1;

90 
	`_exô
(
exô_code
);

94 
	`_exô
(
EXIT_SUCCESS
);

99 i‡(
	`£tsid
() == -1)

102 i‡(
nochdú
 == 0) {

103 if(
	`chdú
("/") != 0) {

104 
	`≥º‹
("chdir");

109 i‡(
no˛o£
 =0 && (
fd
 = 
	`›í
("/dev/nuŒ", 
O_RDWR
, 0)) != -1) {

110 if(
	`dup2
(
fd
, 
STDIN_FILENO
) < 0) {

111 
	`≥º‹
("dup2 stdin");

114 if(
	`dup2
(
fd
, 
STDOUT_FILENO
) < 0) {

115 
	`≥º‹
("dup2 stdout");

118 if(
	`dup2
(
fd
, 
STDERR_FILENO
) < 0) {

119 
	`≥º‹
("dup2 stderr");

123 i‡(
fd
 > 
STDERR_FILENO
) {

124 if(
	`˛o£
(
fd
) < 0) {

125 
	`≥º‹
("close");

131 
	}
}

	@ccan/ccan/daemon_with_notify/daemon_with_notify.h

2 #i‚de‡
CCAN_DAEMON_WITH_NOTIFY_H


3 
	#CCAN_DAEMON_WITH_NOTIFY_H


	)

23 
d´m⁄ize
(
nochdú
, 
no˛o£
, 
waô_sigu§1
);

31 
d´m⁄_is_ªady
();

	@ccan/ccan/daemon_with_notify/test/run.c

1 
	~<cˇn/d´m⁄_wôh_nŸify/d´m⁄_wôh_nŸify.h
>

2 
	~<cˇn/d´m⁄_wôh_nŸify/d´m⁄_wôh_nŸify.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

5 
	~<uni°d.h
>

6 
	~<îr.h
>

7 
	~<î∫o.h
>

8 
	~<°rög.h
>

10 
	schûd_d©a
 {

11 
pid_t
 
	mpid
;

12 
pid_t
 
	mµid
;

13 
	mö_roŸ_dú
;

14 
	mªad_‰om_°dö
, 
	mwrôe_to_°dout
, 
	mwrôe_to_°dîr
;

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
fds
[2];

20 
chûd_d©a
 
d´m⁄ized
;

21 
pid_t
 
pid
;

23 
	`∂™_ã°s
(6);

25 i‡(
	`pùe
(
fds
) != 0)

26 
	`îr
(1, "FailedÖipe");

30 
pid
 = 
	`f‹k
();

31 i‡(
pid
 == -1)

32 
	`îr
(1, "Failed fork");

34 i‡(
pid
 == 0) {

35 
buf„r
[2];

36 
pid
 = 
	`gëpid
();

37 
	`d´m⁄ize
(0, 0, 1);

38 
	`d´m⁄_is_ªady
();

40 
	`mem£t
(&
d´m⁄ized
, 0, (daemonized));

41 
d´m⁄ized
.
pid
 = 
	`gëpid
();

42 
d´m⁄ized
.
ö_roŸ_dú
 = (
	`gëcwd
(
buf„r
, 2Ë!
NULL
);

43 
d´m⁄ized
.
ªad_‰om_°dö


44 
	`ªad
(
STDIN_FILENO
, 
buf„r
, 1Ë=-1 ? 
î∫o
 : 0;

45 
d´m⁄ized
.
wrôe_to_°dout


46 
	`wrôe
(
STDOUT_FILENO
, 
buf„r
, 1Ë=-1 ? 
î∫o
 : 0;

47 i‡(
	`wrôe
(
STDERR_FILENO
, 
buf„r
, 1) != 1) {

48 
d´m⁄ized
.
wrôe_to_°dîr
 = 
î∫o
;

49 i‡(
d´m⁄ized
.
wrôe_to_°dîr
 == 0)

50 
d´m⁄ized
.
wrôe_to_°dîr
 = -1;

52 
d´m⁄ized
.
wrôe_to_°dîr
 = 0;

55 
	`gëµid
(Ë=
pid
)

56 
	`¶ìp
(1);

57 
d´m⁄ized
.
µid
 = 
	`gëµid
();

58 i‡(
	`wrôe
(
fds
[1], &
d´m⁄ized
, (daemonized))

59 !(
d´m⁄ized
))

60 
	`exô
(1);

61 
	`exô
(0);

64 i‡(
	`ªad
(
fds
[0], &
d´m⁄ized
, (daemonized)) != (daemonized))

65 
	`îr
(1, "FailedÑead");

67 
	`ok1
(
d´m⁄ized
.
pid
 !=Öid);

68 
	`ok1
(
d´m⁄ized
.
µid
 == 1);

69 
	`ok1
(
d´m⁄ized
.
ö_roŸ_dú
);

70 
	`ok1
(
d´m⁄ized
.
ªad_‰om_°dö
 == 0);

71 
	`ok1
(
d´m⁄ized
.
wrôe_to_°dout
 == 0);

72 
	`ok1
(
d´m⁄ized
.
wrôe_to_°dîr
 == 0);

74  
	`exô_°©us
();

75 
	}
}

	@ccan/ccan/daemonize/daemonize.c

2 
	~<cˇn/d´m⁄ize/d´m⁄ize.h
>

3 
	~<uni°d.h
>

4 
	~<°dlib.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

11 
boﬁ
 
	$d´m⁄ize
()

13 
pid_t
 
pid
;

16 i‡((
pid
 = 
	`f‹k
()) < 0)

17  
Ál£
;

18 i‡(
pid
 != 0)

19 
	`exô
(0);

22 
	`˛o£
(
STDIN_FILENO
);

23 
	`˛o£
(
STDOUT_FILENO
);

24 
	`˛o£
(
STDERR_FILENO
);

28 i‡(
	`›í
("/dev/nuŒ", 
O_WRONLY
) != 0)

29  
Ál£
;

30 i‡(
	`dup2
(0, 
STDERR_FILENO
) != STDERR_FILENO)

31  
Ál£
;

32 
	`˛o£
(0);

35 
	`£tsid
();

37 i‡(
	`chdú
("/") != 0)

38  
Ál£
;

41 
	`umask
(0);

42  
åue
;

43 
	}
}

	@ccan/ccan/daemonize/daemonize.h

2 #i‚de‡
CCAN_DAEMONIZE_H


3 
	#CCAN_DAEMONIZE_H


	)

4 
	~<°dboﬁ.h
>

19 
boﬁ
 
d´m⁄ize
();

	@ccan/ccan/daemonize/test/run.c

1 
	~<cˇn/d´m⁄ize/d´m⁄ize.h
>

2 
	~<cˇn/d´m⁄ize/d´m⁄ize.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

5 
	~<uni°d.h
>

6 
	~<îr.h
>

7 
	~<î∫o.h
>

8 
	~<°rög.h
>

10 
	schûd_d©a
 {

11 
pid_t
 
	mpid
;

12 
pid_t
 
	mµid
;

13 
boﬁ
 
	mö_roŸ_dú
;

14 
	mªad_‰om_°dö
, 
	mwrôe_to_°dout
, 
	mwrôe_to_°dîr
;

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
fds
[2];

20 
chûd_d©a
 
d´m⁄ized
;

21 
pid_t
 
pid
;

23 
	`∂™_ã°s
(6);

25 i‡(
	`pùe
(
fds
) != 0)

26 
	`îr
(1, "FailedÖipe");

30 
pid
 = 
	`f‹k
();

31 i‡(
pid
 == -1)

32 
	`îr
(1, "Failed fork");

34 i‡(
pid
 == 0) {

35 
buf„r
[2];

36 
pid
 = 
	`gëpid
();

37 
	`d´m⁄ize
();

39 
	`mem£t
(&
d´m⁄ized
, 0, (daemonized));

40 
d´m⁄ized
.
pid
 = 
	`gëpid
();

41 
d´m⁄ized
.
ö_roŸ_dú
 = (
	`gëcwd
(
buf„r
, 2Ë!
NULL
);

42 
d´m⁄ized
.
ªad_‰om_°dö


43 
	`ªad
(
STDIN_FILENO
, 
buf„r
, 1Ë=-1 ? 
î∫o
 : 0;

44 
d´m⁄ized
.
wrôe_to_°dout


45 
	`wrôe
(
STDOUT_FILENO
, 
buf„r
, 1Ë=-1 ? 
î∫o
 : 0;

46 i‡(
	`wrôe
(
STDERR_FILENO
, 
buf„r
, 1) != 1) {

47 
d´m⁄ized
.
wrôe_to_°dîr
 = 
î∫o
;

48 i‡(
d´m⁄ized
.
wrôe_to_°dîr
 == 0)

49 
d´m⁄ized
.
wrôe_to_°dîr
 = -1;

51 
d´m⁄ized
.
wrôe_to_°dîr
 = 0;

54 
	`gëµid
(Ë=
pid
)

55 
	`¶ìp
(1);

56 
d´m⁄ized
.
µid
 = 
	`gëµid
();

57 i‡(
	`wrôe
(
fds
[1], &
d´m⁄ized
, (daemonized))

58 !(
d´m⁄ized
))

59 
	`exô
(1);

60 
	`exô
(0);

63 i‡(
	`ªad
(
fds
[0], &
d´m⁄ized
, (daemonized)) != (daemonized))

64 
	`îr
(1, "FailedÑead");

66 
	`ok1
(
d´m⁄ized
.
pid
 !=Öid);

67 
	`ok1
(
d´m⁄ized
.
µid
 == 1);

68 
	`ok1
(
d´m⁄ized
.
ö_roŸ_dú
);

69 
	`ok1
(
d´m⁄ized
.
ªad_‰om_°dö
 =
EBADF
);

70 
	`ok1
(
d´m⁄ized
.
wrôe_to_°dout
 =
EBADF
);

71 
	`ok1
(
d´m⁄ized
.
wrôe_to_°dîr
 == 0);

73  
	`exô_°©us
();

74 
	}
}

	@ccan/ccan/darray/darray.h

23 #i‚de‡
CCAN_DARRAY_H


24 
	#CCAN_DARRAY_H


	)

26 
	~<°dlib.h
>

27 
	~<°rög.h
>

28 
	~"c⁄fig.h
"

115 
	#d¨øy
(
ty≥
Ë°ru˘ {ty≥ *
ôem
; 
size_t
 
size
; size_à
Æloc
;}

	)

117 
	#d¨øy_√w
(Ë{0,0,0}

	)

118 
	#d¨øy_öô
(
¨r
Ëdÿ{◊º).
ôem
=0; (¨r).
size
=0; (¨r).
Æloc
=0;} 0)

	)

119 
	#d¨øy_‰ì
(
¨r
Ëdÿ{
	`‰ì
(◊º).
ôem
);} 0)

	)

139 
	$d¨øy
(Ë
	td¨øy_ch¨
;

140 
	$d¨øy
(sig√d Ë
	td¨øy_sch¨
;

141 
	$d¨øy
(Ë
	td¨øy_uch¨
;

143 
	$d¨øy
(Ë
	td¨øy_sh‹t
;

144 
	$d¨øy
(Ë
	td¨øy_öt
;

145 
	$d¨øy
(Ë
	td¨øy_l⁄g
;

147 
	$d¨øy
(Ë
	td¨øy_ush‹t
;

148 
	$d¨øy
(Ë
	td¨øy_uöt
;

149 
	$d¨øy
(Ë
	td¨øy_ul⁄g
;

154 
	#d¨øy_ôem
(
¨r
, 
i
Ë(◊º).
ôem
[i])

	)

155 
	#d¨øy_size
(
¨r
Ë(◊º).
size
)

	)

156 
	#d¨øy_Æloc
(
¨r
Ë(◊º).
Æloc
)

	)

157 
	#d¨øy_em±y
(
¨r
Ë(◊º).
size
 =0)

	)

162 
	#d¨øy_≠≥nd
(
¨r
, ...) do { \

163 
	`d¨øy_ªsize
(
¨r
, (¨r).
size
+1); \

164 (
¨r
).
ôem
[◊º).
size
-1] = (
__VA_ARGS__
); \

165 
	}
} 0)

	)

166 
	#d¨øy_¥ïíd
(
¨r
, ...) do { \

167 
	`d¨øy_ªsize
(
¨r
, (¨r).
size
+1); \

168 
	`memmove
((
¨r
).
ôem
+1, (¨r).ôem, (◊º).
size
-1)*(*(arr).item)); \

169 (
¨r
).
ôem
[0] = (
__VA_ARGS__
); \

170 } 0)

	)

171 
	#d¨øy_push
(
¨r
, ...Ë
	`d¨øy_≠≥nd
◊º, 
__VA_ARGS__
)

	)

176 
	#d¨øy_≠≥nd_ôems
(
¨r
, 
ôems
, 
cou¡
) do { \

177 
size_t
 
__cou¡
 = (
cou¡
), 
__ﬁdSize
 = (
¨r
).
size
; \

178 
	`d¨øy_ªsize
(
¨r
, 
__ﬁdSize
 + 
__cou¡
); \

179 
	`mem˝y
((
¨r
).
ôem
 + 
__ﬁdSize
, 
ôems
, 
__cou¡
 * (*(arr).item)); \

180 } 0)

	)

182 
	#d¨øy_¥ïíd_ôems
(
¨r
, 
ôems
, 
cou¡
) do { \

183 
size_t
 
__cou¡
 = (
cou¡
), 
__ﬁdSize
 = (
¨r
).
size
; \

184 
	`d¨øy_ªsize
(
¨r
, 
__cou¡
 + 
__ﬁdSize
); \

185 
	`memmove
((
¨r
).
ôem
 + 
__cou¡
, (¨r).ôem, 
__ﬁdSize
 * (*(arr).item)); \

186 
	`mem˝y
((
¨r
).
ôem
, 
ôems
, 
__cou¡
 * (*(arr).item)); \

187 } 0)

	)

189 
	#d¨øy_≠≥nd_ôems_nuŒãrmö©e
(
¨r
, 
ôems
, 
cou¡
) do { \

190 
size_t
 
__cou¡
 = (
cou¡
), 
__ﬁdSize
 = (
¨r
).
size
; \

191 
	`d¨øy_ªsize
(
¨r
, 
__ﬁdSize
 + 
__cou¡
 + 1); \

192 
	`mem˝y
((
¨r
).
ôem
 + 
__ﬁdSize
, 
ôems
, 
__cou¡
 * (*(arr).item)); \

193 (
¨r
).
ôem
[--◊º).
size
] = 0; \

194 } 0)

	)

196 
	#d¨øy_¥ïíd_ôems_nuŒãrmö©e
(
¨r
, 
ôems
, 
cou¡
) do { \

197 
size_t
 
__cou¡
 = (
cou¡
), 
__ﬁdSize
 = (
¨r
).
size
; \

198 
	`d¨øy_ªsize
(
¨r
, 
__cou¡
 + 
__ﬁdSize
 + 1); \

199 
	`memmove
((
¨r
).
ôem
 + 
__cou¡
, (¨r).ôem, 
__ﬁdSize
 * (*(arr).item)); \

200 
	`mem˝y
((
¨r
).
ôem
, 
ôems
, 
__cou¡
 * (*(arr).item)); \

201 (
¨r
).
ôem
[--◊º).
size
] = 0; \

202 } 0)

	)

204 #i‡
HAVE_TYPEOF


205 
	#d¨øy_≠≥nds
(
¨r
, ...Ë
	`d¨øy_≠≥nds_t
◊º, 
	`ty≥of
((*◊º).
ôem
)), 
__VA_ARGS__
)

	)

206 
	#d¨øy_¥ïíds
(
¨r
, ...Ë
	`d¨øy_¥ïíds_t
◊º, 
	`ty≥of
((*◊º).
ôem
)), 
__VA_ARGS__
)

	)

209 
	#d¨øy_≠≥nds_t
(
¨r
, 
ty≥
, ...) do { \

210 
ty≥
 
__§c
[] = {
__VA_ARGS__
}; \

211 
	`d¨øy_≠≥nd_ôems
(
¨r
, 
__§c
, (__src)/(*__src)); \

212 } 0)

	)

213 
	#d¨øy_¥ïíds_t
(
¨r
, 
ty≥
, ...) do { \

214 
ty≥
 
__§c
[] = {
__VA_ARGS__
}; \

215 
	`d¨øy_¥ïíd_ôems
(
¨r
, 
__§c
, (__src)/(*__src)); \

216 } 0)

	)

222 
	#d¨øy_p›
(
¨r
Ë(◊º).
ôem
[--◊º).
size
])

	)

223 
	#d¨øy_p›_check
(
¨r
Ë(◊º).
size
 ? 
	`d¨øy_p›
◊ºË: 
NULL
)

	)

228 
	#d¨øy_‰om_ôems
(
¨r
, 
ôems
, 
cou¡
Ëdÿ{
size_t
 
__cou¡
 = (cou¡); 
	`d¨øy_ªsize
◊º, __cou¡); 
	`mem˝y
(◊º).
ôem
, iãms, __cou¡*(*◊º).ôem));} 0)

	)

229 
	#d¨øy_‰om_c
(
¨r
, 
c_¨øy
Ë
	`d¨øy_‰om_ôems
◊º, c_¨øy, (c_¨øy)/(*(c_¨øy)))

	)

234 
	#d¨øy_≠≥nd_°rög
(
¨r
, 
°r
Ëdÿ{c⁄° *
__°r
 = (°r); 
	`d¨øy_≠≥nd_ôems
◊º, __°r, 
	`°æí
(__°r)+1); (¨r).
size
--;} 0)

	)

235 
	#d¨øy_≠≥nd_lô
(
¨r
, 
°rögLôîÆ
Ëdÿ{
	`d¨øy_≠≥nd_ôems
◊º, såögLôîÆ, (°rögLôîÆ)); (¨r).
size
--;} 0)

	)

237 
	#d¨øy_¥ïíd_°rög
(
¨r
, 
°r
) do { \

238 c⁄° *
__°r
 = (
°r
); \

239 
	`d¨øy_¥ïíd_ôems_nuŒãrmö©e
(
¨r
, 
__°r
, 
	`°æí
(__str)); \

240 } 0)

	)

241 
	#d¨øy_¥ïíd_lô
(
¨r
, 
°rögLôîÆ
) \

242 
	`d¨øy_¥ïíd_ôems_nuŒãrmö©e
(
¨r
, 
°rögLôîÆ
, (°rögLôîÆË- 1)

	)

244 
	#d¨øy_‰om_°rög
(
¨r
, 
°r
Ëdÿ{c⁄° *
__°r
 = (°r); 
	`d¨øy_‰om_ôems
◊º, __°r, 
	`°æí
(__°r)+1); (¨r).
size
--;} 0)

	)

245 
	#d¨øy_‰om_lô
(
¨r
, 
°rögLôîÆ
Ëdÿ{
	`d¨øy_‰om_ôems
◊º, såögLôîÆ, (°rögLôîÆ)); (¨r).
size
--;} 0)

	)

250 
	#d¨øy_ªsize
(
¨r
, 
√wSize
Ë
	`d¨øy_growÆloc
◊º, (¨r).
size
 = (√wSize))

	)

251 
	#d¨øy_ªsize0
(
¨r
, 
√wSize
) do { \

252 
size_t
 
__ﬁdSize
 = (
¨r
).
size
, 
__√wSize
 = (
√wSize
); \

253 (
¨r
).
size
 = 
__√wSize
; \

254 i‡(
__√wSize
 > 
__ﬁdSize
) { \

255 
	`d¨øy_growÆloc
(
¨r
, 
__√wSize
); \

256 
	`mem£t
(&(
¨r
).
ôem
[
__ﬁdSize
], 0, (
__√wSize
 - __oldSize) * (*(arr).item)); \

258 } 0)

	)

260 
	#d¨øy_ªÆloc
(
¨r
, 
√wAŒoc
) do { \

261 (
¨r
).
ôem
 = 
	`ªÆloc
(◊º).ôem, (◊º).
Æloc
 = (
√wAŒoc
)) * (*(arr).item)); \

262 } 0)

	)

263 
	#d¨øy_growÆloc
(
¨r
, 
√ed
) do { \

264 
size_t
 
__√ed
 = (
√ed
); \

265 i‡(
__√ed
 > (
¨r
).
Æloc
) \

266 
	`d¨øy_ªÆloc
(
¨r
, 
	`d¨øy_√xt_Æloc
(◊º).
Æloc
, 
__√ed
)); \

267 } 0)

	)

269 #i‡
HAVE_STATEMENT_EXPR
==1

270 
	#d¨øy_make_room
(
¨r
, 
room
Ë({
size_t
 
√wAŒoc
 = (¨r).
size
+‘oom); i‡(◊º).
Æloc
<√wAŒocË
	`d¨øy_ªÆloc
◊º,ÇewAŒoc); (¨r).
ôem
+◊º).size; })

	)

273 
ölöe
 
size_t
 
	$d¨øy_√xt_Æloc
(
size_t
 
Æloc
, size_à
√ed
)

275 i‡(
Æloc
 == 0)

276 
Æloc
 = 1;

277 
Æloc
 < 
√ed
)

278 
Æloc
 *= 2;

279  
Æloc
;

280 
	}
}

290 
	#d¨øy_f‹óch
(
i
, 
¨r
) \

291 (
i
Ë&(
¨r
).
ôem
[0]; (iË< &◊º).ôem[◊º).
size
]; (i)++)

	)

298 
	#d¨øy_f‹óch_ªvî£
(
i
, 
¨r
) \

299 (
i
Ë&(
¨r
).
ôem
[◊º).
size
]; (i)-- > &◊º).ôem[0]; )

	)

	@ccan/ccan/darray/test/lotsOfNumbers.h

1 c⁄° 
	glŸsOfNumbîs
[] = {

	@ccan/ccan/darray/test/lotsOfStrings.h

1 c⁄° * c⁄° 
	glŸsOfSåögs
[] = {

	@ccan/ccan/darray/test/run.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/d¨øy/d¨øy.h
>

3 
	~<°dio.h
>

5 
	~"lŸsOfNumbîs.h
"

6 
	~"lŸsOfSåögs.h
"

8 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ (*◊º)))

	)

11 *
	m°rögsF
, *
	m°rögsB
;

13 
size_t
 
	m°rögsSize
;

14 } 
	gamÆgams
;

16 
gíî©eAmÆgams
();

17 
‰ìAmÆgams
();

18 
isZîos
(*
±r
, 
size_t
 
size
);

19 
memtûe
(*
de°
, 
size_t
 
de°Width
, c⁄° *
§c
, size_à
§cWidth
);

23 
	#ã°ög
(...Ë
	`¥ötf
("Te°ög %s...\n", #__VA_ARGS__)

	)

24 
	#åa˚
(...Ëdÿ{
	`¥ötf
(
__VA_ARGS__
); 
	`puts
("");} 0)

	)

26 
	#ã°ög
(...Ëdÿ{} 0)

	)

27 
	#åa˚
(...Ëdÿ{} 0)

	)

30 
	~"ã°Lôs.h
"

32 
	$maö
() {

33 
	`d¨øy
(Ë
¨r
 = 
	`d¨øy_√w
();

34 
d¨øy_ch¨
 
°r
 = 
	`d¨øy_√w
();

35 
	#ª£t
(
¨r
Ëdÿ{
	`d¨øy_‰ì
◊º); 
	`d¨øy_öô
◊º);} 0)

	)

36 
size_t
 
i
;

38 
	`åa˚
("Generatingámalgams (internal)");

39 
	`gíî©eAmÆgams
();

41 
	`∂™_ã°s
(41);

43 
	`ã°Lôs
();

45 
	`ã°ög
(
d¨øy_push
);

47 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfNumbîs
); i++)

48 
	`d¨øy_push
(
¨r
, 
lŸsOfNumbîs
[
i
]);

49 
	`ok1
(
	`d¨øy_size
(
¨r
Ë=
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

50 
	`ok1
(
	`d¨øy_Æloc
(
¨r
Ë>
	`d¨øy_size
(arr));

51 
	`ok1
(!
	`memcmp
(
¨r
.
ôem
, 
lŸsOfNumbîs
, (lotsOfNumbers)));

53 
	`ª£t
(
¨r
);

55 
	`ã°ög
(
d¨øy_¥ïíd
, 
d¨øy_p›
);

57 
i
 = 
	`ARRAY_SIZE
(
lŸsOfNumbîs
); i;)

58 
	`d¨øy_¥ïíd
(
¨r
, 
lŸsOfNumbîs
[--
i
]);

59 
	`ok1
(
	`d¨øy_size
(
¨r
Ë=
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

60 
	`ok1
(
	`d¨øy_Æloc
(
¨r
Ë>
	`d¨øy_size
(arr));

61 
	`ok1
(!
	`memcmp
(
¨r
.
ôem
, 
lŸsOfNumbîs
, (lotsOfNumbers)));

63 
i
 = 
	`ARRAY_SIZE
(
lŸsOfNumbîs
); i;) {

64 i‡(
	`d¨øy_p›
(
¨r
Ë!()
lŸsOfNumbîs
[--
i
]) {

65 
i
++;

69 
	`ok1
(
i
==0);

70 
	`ok1
(
	`d¨øy_size
(
¨r
) == 0);

72 
	`ª£t
(
¨r
);

74 
	`ã°ög
(
d¨øy_‰om_c
, 
d¨øy_f‹óch
, 
d¨øy_f‹óch_ªvî£
);

76 *
i
;

77 
size_t
 
j
;

79 
	`d¨øy_‰om_c
(
¨r
, 
lŸsOfNumbîs
);

80 
	`ok1
(
	`d¨øy_size
(
¨r
Ë=
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

81 
	`ok1
(
	`d¨øy_Æloc
(
¨r
Ë>
	`d¨øy_size
(arr));

82 
	`ok1
(
	`memcmp
(
¨r
.
ôem
, 
lŸsOfNumbîs
, (lotsOfNumbers)) == 0);

84 
j
 = 0;

85 
	`d¨øy_f‹óch
(
i
, 
¨r
) {

86 i‡(
i
 - 
¨r
.
ôem
 !
j
)

88 i‡(*
i
 !()
lŸsOfNumbîs
[
j
])

90 
j
++;

92 
	`ok1
(
j
 =
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

94 
j
 = 0;

95 
	`d¨øy_f‹óch_ªvî£
(
i
, 
¨r
) {

96 i‡(
i
 - 
¨r
.
ôem
 !
	`d¨øy_size
◊º)-
j
-1)

98 i‡(*
i
 !()
lŸsOfNumbîs
[
	`d¨øy_size
(
¨r
)-
j
-1])

100 
j
++;

102 
	`ok1
(
j
 =
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

104 
	`ª£t
(
¨r
);

106 
	`ã°ög
(
d¨øy_≠≥nd_°rög
);

108 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfSåögs
); i++)

109 
	`d¨øy_≠≥nd_°rög
(
°r
, 
lŸsOfSåögs
[
i
]);

110 
	`ok1
(
°r
.
size
 =
amÆgams
.
°rögsSize
);

111 
	`ok1
(
°r
.
Æloc
 > så.
size
);

112 
	`ok1
(
°r
.
ôem
[°r.
size
] == 0);

113 
	`ok1
(!
	`°rcmp
(
°r
.
ôem
, 
amÆgams
.
°rögsF
));

115 
	`ª£t
(
°r
);

117 
	`ã°ög
(
d¨øy_¥ïíd_°rög
);

119 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfSåögs
); i++)

120 
	`d¨øy_¥ïíd_°rög
(
°r
, 
lŸsOfSåögs
[
i
]);

121 
	`ok1
(
°r
.
size
 =
amÆgams
.
°rögsSize
);

122 
	`ok1
(
°r
.
Æloc
 > så.
size
);

123 
	`ok1
(
°r
.
ôem
[°r.
size
] == 0);

124 
	`ok1
(!
	`°rcmp
(
°r
.
ôem
, 
amÆgams
.
°rögsB
));

126 
	`ª£t
(
°r
);

128 
	`ã°ög
(
d¨øy_‰om_°rög
);

130 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfSåögs
); i++) {

131 
	`d¨øy_‰om_°rög
(
°r
, 
lŸsOfSåögs
[
i
]);

132 i‡(
°r
.
size
 !
	`°æí
(
lŸsOfSåögs
[
i
]))

134 i‡(
°r
.
Æloc
 < 
	`°æí
(
lŸsOfSåögs
[
i
])+1)

136 i‡(
	`°rcmp
(
°r
.
ôem
, 
lŸsOfSåögs
[
i
]))

139 
	`ok1
(
i
 =
	`ARRAY_SIZE
(
lŸsOfSåögs
));

141 
	`ª£t
(
°r
);

143 
	`ã°ög
(
d¨øy_ªsize0
);

145 
size_t
 
¥evSize
=0, 
size
;

146 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfNumbîs
); i++, 
¥evSize
=
size
) {

147 
size
 = 
lŸsOfNumbîs
[
i
] & 0xFFFF;

148 
	`d¨øy_ªsize0
(
¨r
, 
size
);

149 i‡(
	`d¨øy_size
(
¨r
Ë!
size
)

151 i‡(
	`d¨øy_Æloc
(
¨r
Ë< 
size
)

153 i‡(
size
>
¥evSize
) {

154 i‡(!
	`isZîos
(
¨r
.
ôem
+
¥evSize
, (
size
-prevSize)*(*arr.item)))

158 
	`memtûe
(
¨r
.
ôem
, 
	`d¨øy_size
◊º)*(*¨r.ôem), 
lŸsOfNumbîs
, (lotsOfNumbers));

160 
	`ok1
(
i
 =
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

162 
	`ª£t
(
¨r
);

164 
	`ã°ög
(
d¨øy_ªÆloc
);

166 
size_t
 
s
,
a
;

167 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfNumbîs
); i++) {

168 
¨r
.
size
 = (
s
 = 
lŸsOfNumbîs
[
i
] >> 16);

170 
a
 = 
amÆgams
.
°rögsSize
/(*
¨r
.
ôem
)+2;

171 
	`d¨øy_ªÆloc
(
¨r
, 
a
 = 
lŸsOfNumbîs
[
i
] % ((
amÆgams
.
°rögsSize
/(*¨r.
ôem
))+1));

172 i‡(
a
*(*
¨r
.
ôem
Ë> 
amÆgams
.
°rögsSize
)

174 i‡(
	`d¨øy_Æloc
(
¨r
Ë!
a
)

176 i‡(
	`d¨øy_size
(
¨r
Ë!
s
)

178 
	`memtûe
(
¨r
.
ôem
, 
a
*(*¨r.ôem), 
amÆgams
.
°rögsF
,á*(*arr.item));

179 i‡(
	`memcmp
(
¨r
.
ôem
, 
amÆgams
.
°rögsF
, 
a
*(*arr.item)))

182 
	`ok1
(
i
 =
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

184 
	`ª£t
(
¨r
);

186 
	`ã°ög
(
d¨øy_growÆloc
);

188 
size_t
 
¥evA
, 
s
, 
a
;

189 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfNumbîs
); i++) {

190 
¨r
.
size
 = (
s
 = 
lŸsOfNumbîs
[
i
] >> 16);

192 
a
 = 
amÆgams
.
°rögsSize
/(*
¨r
.
ôem
)+2;

193 
¥evA
 = 
	`d¨øy_Æloc
(
¨r
);

194 
	`d¨øy_growÆloc
(
¨r
, 
a
 = 
lŸsOfNumbîs
[
i
] % ((
amÆgams
.
°rögsSize
/(*¨r.
ôem
))+1));

195 i‡(
a
*(*
¨r
.
ôem
Ë> 
amÆgams
.
°rögsSize
)

197 i‡(
	`d¨øy_Æloc
(
¨r
Ë< 
a
)

199 i‡(
	`d¨øy_Æloc
(
¨r
Ë< 
¥evA
)

201 i‡(
	`d¨øy_size
(
¨r
Ë!
s
)

204 
	`memtûe
(
¨r
.
ôem
, 
a
*(*¨r.ôem), 
amÆgams
.
°rögsF
,á*(*arr.item));

205 i‡(
	`memcmp
(
¨r
.
ôem
, 
amÆgams
.
°rögsF
, 
a
*(*arr.item)))

209 i‡(!(
lŸsOfNumbîs
[
i
] & 15)) {

210 
	`ª£t
(
¨r
);

213 
	`ok1
(
i
 =
	`ARRAY_SIZE
(
lŸsOfNumbîs
));

215 
	`ª£t
(
¨r
);

217 
	`ã°ög
(
d¨øy_make_room
);

219 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfSåögs
); i++) {

220 *
de°
 = 
	`d¨øy_make_room
(
°r
, 
	`°æí
(
lŸsOfSåögs
[
i
]));

221 i‡(
°r
.
Æloc
 < så.
size
+
	`°æí
(
lŸsOfSåögs
[
i
]))

223 i‡(
de°
 !
°r
.
ôem
+°r.
size
)

226 
	`mem˝y
(
de°
, 
lŸsOfSåögs
[
i
], 
	`°æí
(lotsOfStrings[i]));

227 
°r
.
size
 +
	`°æí
(
lŸsOfSåögs
[
i
]);

229 
	`ok1
(
i
 =
	`ARRAY_SIZE
(
lŸsOfSåögs
));

230 
	`ok1
(
°r
.
size
 =
amÆgams
.
°rögsSize
);

232 
	`d¨øy_≠≥nd
(
°r
, 0);

233 
	`ok1
(!
	`°rcmp
(
°r
.
ôem
, 
amÆgams
.
°rögsF
));

235 
	`ª£t
(
°r
);

237 
	`ã°ög
(
d¨øy_≠≥nds
, 
d¨øy_¥ïíds
, 
d¨øy_p›_check
);

239 
	`d¨øy
(c⁄° *Ë
¨r
 = 
	`d¨øy_√w
();

240 c⁄° *
n
[9] = {"zero", "one", "two", "three", "four", "five", "six", "seven", "eight"};

242 #i‡
HAVE_TYPEOF


243 
	`d¨øy_≠≥nds
(
¨r
, 
n
[5],Ç[6],Ç[7],Ç[8]);

245 
	`d¨øy_≠≥nds_t
(
¨r
, c⁄° *, 
n
[5],Ç[6],Ç[7],Ç[8]);

247 
	`ok1
(
	`d¨øy_size
(
¨r
)==4 && 
	`d¨øy_Æloc
(arr)>=4);

249 #i‡
HAVE_TYPEOF


250 
	`d¨øy_¥ïíds
(
¨r
, 
n
[0],Ç[1],Ç[2],Ç[3],Ç[4]);

252 
	`d¨øy_¥ïíds_t
(
¨r
, c⁄° *, 
n
[0],Ç[1],Ç[2],Ç[3],Ç[4]);

255 
	`ok1
(
	`d¨øy_size
(
¨r
)==9 && 
	`d¨øy_Æloc
(arr)>=9);

257 
	`ok1
(
¨r
.
ôem
[0]==
n
[0] &&

258 
¨r
.
ôem
[1]==
n
[1] &&

259 
¨r
.
ôem
[2]==
n
[2] &&

260 
¨r
.
ôem
[3]==
n
[3] &&

261 
¨r
.
ôem
[4]==
n
[4] &&

262 
¨r
.
ôem
[5]==
n
[5] &&

263 
¨r
.
ôem
[6]==
n
[6] &&

264 
¨r
.
ôem
[7]==
n
[7] &&

265 
¨r
.
ôem
[8]==
n
[8]);

267 
	`ok1
(
	`d¨øy_p›_check
(
¨r
)==
n
[8] &&

268 
	`d¨øy_p›_check
(
¨r
)==
n
[7] &&

269 
	`d¨øy_p›_check
(
¨r
)==
n
[6] &&

270 
	`d¨øy_p›_check
(
¨r
)==
n
[5] &&

271 
	`d¨øy_p›_check
(
¨r
)==
n
[4] &&

272 
	`d¨øy_p›_check
(
¨r
)==
n
[3] &&

273 
	`d¨øy_p›_check
(
¨r
)==
n
[2] &&

274 
	`d¨øy_p›_check
(
¨r
)==
n
[1] &&

275 
	`d¨øy_p›_check
(
¨r
)==
n
[0]);

277 
	`ok1
(
	`d¨øy_size
(
¨r
)==0);

279 
	`ok1
(
	`d¨øy_p›_check
(
¨r
)==
NULL
 && darray_pop_check(arr)==NULL && darray_pop_check(arr)==NULL);

281 
	`d¨øy_‰ì
(
¨r
);

284 
	`åa˚
("Freeingámalgams (internal)");

285 
	`‰ìAmÆgams
();

287  
	`exô_°©us
();

288 
	}
}

290 
	$gíî©eAmÆgams
() {

291 
size_t
 
i
;

292 
size_t
 
lŸsOfSåögsLí
 = 0;

293 c⁄° *
§c
;

294 *
p
;

296 
i
=0; i < 
	`ARRAY_SIZE
(
lŸsOfSåögs
); i++)

297 
lŸsOfSåögsLí
 +
	`°æí
(
lŸsOfSåögs
[
i
]);

298 
amÆgams
.
°rögsSize
 = 
lŸsOfSåögsLí
;

300 
amÆgams
.
°rögsF
 = 
	`mÆloc
(
lŸsOfSåögsLí
+1);

301 
amÆgams
.
°rögsB
 = 
	`mÆloc
(
lŸsOfSåögsLí
+1);

303 
i
=0,
p
=
amÆgams
.
°rögsF
; i < 
	`ARRAY_SIZE
(
lŸsOfSåögs
); i++) {

304 
size_t
 
Àn
 = 
	`°æí
(
§c
=
lŸsOfSåögs
[
i
]);

305 
	`mem˝y
(
p
, 
§c
, 
Àn
);

306 
p
 +
Àn
;

308 *
p
 = 0;

309 
	`ok1
(
p
-
amÆgams
.
°rögsF
 =()
lŸsOfSåögsLí
);

310 
	`ok1
(
	`°æí
(
amÆgams
.
°rögsF
Ë=
lŸsOfSåögsLí
);

312 
i
 = 
	`ARRAY_SIZE
(
lŸsOfSåögs
), 
p
 = 
amÆgams
.
°rögsB
; i--;) {

313 
size_t
 
Àn
 = 
	`°æí
(
§c
=
lŸsOfSåögs
[
i
]);

314 
	`mem˝y
(
p
, 
§c
, 
Àn
);

315 
p
 +
Àn
;

317 *
p
 = 0;

318 
	`ok1
(
p
-
amÆgams
.
°rögsB
 =()
lŸsOfSåögsLí
);

319 
	`ok1
(
	`°æí
(
amÆgams
.
°rögsB
Ë=
lŸsOfSåögsLí
);

320 
	}
}

322 
	$‰ìAmÆgams
() {

323 
	`‰ì
(
amÆgams
.
°rögsF
);

324 
	`‰ì
(
amÆgams
.
°rögsB
);

325 
	}
}

327 
	$isZîos
(*
±r
, 
size_t
 
size
) {

328 *
pc
 = 
±r
;

329 
size_t
 *
∂
;

330 i‡(
size
>8) {

332 (
size_t
)
pc
 & ((size_t)-1))

333 i‡(*
pc
++)

335 
∂
 = (
size_t
*)
pc
;

336 
size
 -
pc
-(*)
±r
;

337 
size
 >(
size_t
)) {

338 
size
 -(
size_t
);

339 i‡(*
∂
++)

342 
pc
 = (*)
∂
;

344 
size
--)

345 i‡(*
pc
++)

348 
	}
}

350 
	$memtûe
(*
de°
, 
size_t
 
de°Width
, c⁄° *
§c
, size_à
§cWidth
) {

351 *
d
 = 
de°
;

352 
de°Width
 > 
§cWidth
) {

353 
de°Width
 -
§cWidth
;

354 
	`mem˝y
(
d
, 
§c
, 
§cWidth
);

355 
d
 +
§cWidth
;

357 
	`mem˝y
(
d
, 
§c
, 
de°Width
);

358 
	}
}

	@ccan/ccan/darray/test/testLits.h

1 
ã°d¨øy_‰om_lô
();

2 
ã°d¨øy_≠≥nd_lô
();

3 
ã°d¨øy_¥ïíd_lô
();

5 
	$ã°Lôs
() {

6 
	`ã°ög
(
d¨øy_‰om_lô
);

7 
	`ok1
(
	`ã°d¨øy_‰om_lô
());

9 
	`ã°ög
(
ã°d¨øy_≠≥nd_lô
);

10 
	`ok1
(
	`ã°d¨øy_≠≥nd_lô
());

12 
	`ã°ög
(
ã°d¨øy_¥ïíd_lô
);

13 
	`ok1
(
	`ã°d¨øy_¥ïíd_lô
());

14 
	}
}

16 
	$ã°d¨øy_‰om_lô
() {

17 
d¨øy_ch¨
 
a
 = 
	`d¨øy_√w
();

18 
size_t
 
ã°sPas£d
 = 0;

19 
size_t
 
Àn
 = 0;

22 
	`d¨øy_‰om_lô
(
a
, "\xC0\x19\xDE\x94\xC9\xB1_\xDF\xBEr[\xBB\x43\x65\xC7\xD8\x93\xB7\x16u\x1D\x8C\x64\x91\xF5\xDE*GC\xECp\xCA!\x15\xF0\x07(b(\x87\xE0nDP\xC5\x1C\xC5\xB4\x38\xC3i\xA6\xEE\x81\xB0p\x9C\x94\xA2w\xA2$\xF5%rS\xF3\\f\x1A\xF4\xFC\x93\xDD'\xE8\xA7\x11\xF4\xF7\xC9\xCE\x92I\xF6\x94p");

23 
Àn
 = 
	`°æí
("\xC0\x19\xDE\x94\xC9\xB1_\xDF\xBEr[\xBB\x43\x65\xC7\xD8\x93\xB7\x16u\x1D\x8C\x64\x91\xF5\xDE*GC\xECp\xCA!\x15\xF0\x07(b(\x87\xE0nDP\xC5\x1C\xC5\xB4\x38\xC3i\xA6\xEE\x81\xB0p\x9C\x94\xA2w\xA2$\xF5%rS\xF3\\f\x1A\xF4\xFC\x93\xDD'\xE8\xA7\x11\xF4\xF7\xC9\xCE\x92I\xF6\x94p");

24 i‡(
Àn
 != ("\xC0\x19\xDE\x94\xC9\xB1_\xDF\xBEr[\xBB\x43\x65\xC7\xD8\x93\xB7\x16u\x1D\x8C\x64\x91\xF5\xDE*GC\xECp\xCA!\x15\xF0\x07(b(\x87\xE0nDP\xC5\x1C\xC5\xB4\x38\xC3i\xA6\xEE\x81\xB0p\x9C\x94\xA2w\xA2$\xF5%rS\xF3\\f\x1A\xF4\xFC\x93\xDD'\xE8\xA7\x11\xF4\xF7\xC9\xCE\x92I\xF6\x94p")-1)

25 
íd
;

26 i‡(
a
.
size
 !
Àn
)

27 
íd
;

28 i‡(
a
.
size
 >á.
Æloc
)

29 
íd
;

30 i‡(
	`°rcmp
(
a
.
ôem
, "\xC0\x19\xDE\x94\xC9\xB1_\xDF\xBEr[\xBB\x43\x65\xC7\xD8\x93\xB7\x16u\x1D\x8C\x64\x91\xF5\xDE*GC\xECp\xCA!\x15\xF0\x07(b(\x87\xE0nDP\xC5\x1C\xC5\xB4\x38\xC3i\xA6\xEE\x81\xB0p\x9C\x94\xA2w\xA2$\xF5%rS\xF3\\f\x1A\xF4\xFC\x93\xDD'\xE8\xA7\x11\xF4\xF7\xC9\xCE\x92I\xF6\x94p"))

31 
íd
;

32 
	`d¨øy_‰ì
(
a
);

33 
	`d¨øy_öô
(
a
);

34 
ã°sPas£d
++;

37 
	`d¨øy_‰om_lô
(
a
, "\xEC\x08\xC5\xB9\x97m\xA4\xBF\x12\x0E\xC6\xB4\x1FN\x13\xB0^\xBB\x32(*\xD5\x8DQ\x87o7\xBB\x01\x96z\xF0\xC3!\x04\x80\xD8\xDA\x18\xDB\xCA\x94\x1A\xD4\xBF\xE8\x83\xE2\xF6\x91yk\xA6\xE1\x96\x39\xFF)\xB2\xB3\xFC\xA6\xA7\xD8\xAE\xF8U\xCD)\xDD\x9Al\xFB\xDEw?\xD8\xD8\xBC\"z\xC9\x7F\x92r\tUm\x95\x17\xAD\x96=\xBE\xF5\xDD\x13\x8A\x62\x01\xB7\x0E\x06\xC2\xA1\xEE\x8Cje3O6\x9C_)v\xCD/\xB8z%\xA2> \xDF\x1B\xC1\x62\x8E\x14\x61\xA0\xCAl\xD3\x8D\xBA}C\x7F}~\xD9\xEB]\x8C\x9B\x9Cq\xB5\x38\xC4O\xC9\x17\xE6\xEF\xF7\x9E\x12\x1D\xA1\x13\x8F<\x9D\xEF\x92\x93w\x1F=\xFF\x8F\xDDJ\xBB\xD2}\x98\x1D)\xB3\x98\xE2n6/\xB0\x38\x44");

38 
Àn
 = 
	`°æí
("\xEC\x08\xC5\xB9\x97m\xA4\xBF\x12\x0E\xC6\xB4\x1FN\x13\xB0^\xBB\x32(*\xD5\x8DQ\x87o7\xBB\x01\x96z\xF0\xC3!\x04\x80\xD8\xDA\x18\xDB\xCA\x94\x1A\xD4\xBF\xE8\x83\xE2\xF6\x91yk\xA6\xE1\x96\x39\xFF)\xB2\xB3\xFC\xA6\xA7\xD8\xAE\xF8U\xCD)\xDD\x9Al\xFB\xDEw?\xD8\xD8\xBC\"z\xC9\x7F\x92r\tUm\x95\x17\xAD\x96=\xBE\xF5\xDD\x13\x8A\x62\x01\xB7\x0E\x06\xC2\xA1\xEE\x8Cje3O6\x9C_)v\xCD/\xB8z%\xA2> \xDF\x1B\xC1\x62\x8E\x14\x61\xA0\xCAl\xD3\x8D\xBA}C\x7F}~\xD9\xEB]\x8C\x9B\x9Cq\xB5\x38\xC4O\xC9\x17\xE6\xEF\xF7\x9E\x12\x1D\xA1\x13\x8F<\x9D\xEF\x92\x93w\x1F=\xFF\x8F\xDDJ\xBB\xD2}\x98\x1D)\xB3\x98\xE2n6/\xB0\x38\x44");

39 i‡(
Àn
 != ("\xEC\x08\xC5\xB9\x97m\xA4\xBF\x12\x0E\xC6\xB4\x1FN\x13\xB0^\xBB\x32(*\xD5\x8DQ\x87o7\xBB\x01\x96z\xF0\xC3!\x04\x80\xD8\xDA\x18\xDB\xCA\x94\x1A\xD4\xBF\xE8\x83\xE2\xF6\x91yk\xA6\xE1\x96\x39\xFF)\xB2\xB3\xFC\xA6\xA7\xD8\xAE\xF8U\xCD)\xDD\x9Al\xFB\xDEw?\xD8\xD8\xBC\"z\xC9\x7F\x92r\tUm\x95\x17\xAD\x96=\xBE\xF5\xDD\x13\x8A\x62\x01\xB7\x0E\x06\xC2\xA1\xEE\x8Cje3O6\x9C_)v\xCD/\xB8z%\xA2> \xDF\x1B\xC1\x62\x8E\x14\x61\xA0\xCAl\xD3\x8D\xBA}C\x7F}~\xD9\xEB]\x8C\x9B\x9Cq\xB5\x38\xC4O\xC9\x17\xE6\xEF\xF7\x9E\x12\x1D\xA1\x13\x8F<\x9D\xEF\x92\x93w\x1F=\xFF\x8F\xDDJ\xBB\xD2}\x98\x1D)\xB3\x98\xE2n6/\xB0\x38\x44")-1)

40 
íd
;

41 i‡(
a
.
size
 !
Àn
)

42 
íd
;

43 i‡(
a
.
size
 >á.
Æloc
)

44 
íd
;

45 i‡(
	`°rcmp
(
a
.
ôem
, "\xEC\x08\xC5\xB9\x97m\xA4\xBF\x12\x0E\xC6\xB4\x1FN\x13\xB0^\xBB\x32(*\xD5\x8DQ\x87o7\xBB\x01\x96z\xF0\xC3!\x04\x80\xD8\xDA\x18\xDB\xCA\x94\x1A\xD4\xBF\xE8\x83\xE2\xF6\x91yk\xA6\xE1\x96\x39\xFF)\xB2\xB3\xFC\xA6\xA7\xD8\xAE\xF8U\xCD)\xDD\x9Al\xFB\xDEw?\xD8\xD8\xBC\"z\xC9\x7F\x92r\tUm\x95\x17\xAD\x96=\xBE\xF5\xDD\x13\x8A\x62\x01\xB7\x0E\x06\xC2\xA1\xEE\x8Cje3O6\x9C_)v\xCD/\xB8z%\xA2> \xDF\x1B\xC1\x62\x8E\x14\x61\xA0\xCAl\xD3\x8D\xBA}C\x7F}~\xD9\xEB]\x8C\x9B\x9Cq\xB5\x38\xC4O\xC9\x17\xE6\xEF\xF7\x9E\x12\x1D\xA1\x13\x8F<\x9D\xEF\x92\x93w\x1F=\xFF\x8F\xDDJ\xBB\xD2}\x98\x1D)\xB3\x98\xE2n6/\xB0\x38\x44"))

46 
íd
;

47 
	`d¨øy_‰ì
(
a
);

48 
	`d¨øy_öô
(
a
);

49 
ã°sPas£d
++;

52 
	`d¨øy_‰om_lô
(
a
, "~Er=L\xA6\xC0\xB1m\xC2\x66`\xA4\x89\xE6\xA8\xEE\x03,\xA5\xC4\xAD\xC5\xC1\xE5\x38\xA3\x99\x9F^\x13\x41]|\x81J=\xA9\xE5\xAC\f\xD6\x92/\x07z\x90+\x9C\xA4O\xF4\xC4\xA3\x12\"\xC2{\xB7\x1E\xA4\x66\xB5\xC8\xB4\x45\xC8#G\x15\x37\x33\x9E\x9B\x8D\x91 \x13\xE2(\x91QV5\xAD\v\v\xD1\x11\xB5i\xE3\xF0\x01Z\xF0\xFD\\\xFA\x07W\xD8p\xB4\x92\x1B/>\xAF\xFC\x83\xE6x");

53 
Àn
 = 
	`°æí
("~Er=L\xA6\xC0\xB1m\xC2\x66`\xA4\x89\xE6\xA8\xEE\x03,\xA5\xC4\xAD\xC5\xC1\xE5\x38\xA3\x99\x9F^\x13\x41]|\x81J=\xA9\xE5\xAC\f\xD6\x92/\x07z\x90+\x9C\xA4O\xF4\xC4\xA3\x12\"\xC2{\xB7\x1E\xA4\x66\xB5\xC8\xB4\x45\xC8#G\x15\x37\x33\x9E\x9B\x8D\x91 \x13\xE2(\x91QV5\xAD\v\v\xD1\x11\xB5i\xE3\xF0\x01Z\xF0\xFD\\\xFA\x07W\xD8p\xB4\x92\x1B/>\xAF\xFC\x83\xE6x");

54 i‡(
Àn
 != ("~Er=L\xA6\xC0\xB1m\xC2\x66`\xA4\x89\xE6\xA8\xEE\x03,\xA5\xC4\xAD\xC5\xC1\xE5\x38\xA3\x99\x9F^\x13\x41]|\x81J=\xA9\xE5\xAC\f\xD6\x92/\x07z\x90+\x9C\xA4O\xF4\xC4\xA3\x12\"\xC2{\xB7\x1E\xA4\x66\xB5\xC8\xB4\x45\xC8#G\x15\x37\x33\x9E\x9B\x8D\x91 \x13\xE2(\x91QV5\xAD\v\v\xD1\x11\xB5i\xE3\xF0\x01Z\xF0\xFD\\\xFA\x07W\xD8p\xB4\x92\x1B/>\xAF\xFC\x83\xE6x")-1)

55 
íd
;

56 i‡(
a
.
size
 !
Àn
)

57 
íd
;

58 i‡(
a
.
size
 >á.
Æloc
)

59 
íd
;

60 i‡(
	`°rcmp
(
a
.
ôem
, "~Er=L\xA6\xC0\xB1m\xC2\x66`\xA4\x89\xE6\xA8\xEE\x03,\xA5\xC4\xAD\xC5\xC1\xE5\x38\xA3\x99\x9F^\x13\x41]|\x81J=\xA9\xE5\xAC\f\xD6\x92/\x07z\x90+\x9C\xA4O\xF4\xC4\xA3\x12\"\xC2{\xB7\x1E\xA4\x66\xB5\xC8\xB4\x45\xC8#G\x15\x37\x33\x9E\x9B\x8D\x91 \x13\xE2(\x91QV5\xAD\v\v\xD1\x11\xB5i\xE3\xF0\x01Z\xF0\xFD\\\xFA\x07W\xD8p\xB4\x92\x1B/>\xAF\xFC\x83\xE6x"))

61 
íd
;

62 
	`d¨øy_‰ì
(
a
);

63 
	`d¨øy_öô
(
a
);

64 
ã°sPas£d
++;

67 
	`d¨øy_‰om_lô
(
a
, "h\xC2\x1E&\xB3\x43\x88\x11&i\x16\xA3\x05>\x94*D\x14&\x17%x\xB9z\x8F\x7F\x15LLU\x16\x1A\x34\x1C-\xD6\xD3\xEC\x89y\xB3\x82\xC4\xFBw\xAC\xE4\xDA\xC1\xB7\x17\xCC`u]\xC6\x99\x0F \x8F\xA8\x11\x86\xD8)\x01\xE6\x38\x30\xF7\xD1\xB6\x96\xAE\xC6<8`\xD3*\x9DÖ\x01\x85v\xB0\th\x81H\xFF]_\xF3\x15\x9D\xCB[\xF8/n\xC9\x1E\x89>\x9E\xC7/~\xEFQ\\\x1A_\xE4\xE5\xFC\x1C'\xEF\xC8\xE0\x43!\x8AYc_y\xBB\xEE\x7Fy\xF4Ms\xD2\x62\xBAY\xA9\xDC\xAA\xCE\xEDSz\x92m\xF2\x17mO\xB3[\x89\x1E\xBC\xED$\xF1\x07g4\x1B\nhr\xAF\x42\xCF\x1A\xA6\x83\x80(\xA2\x1C\x37\xE3\xFC\x05\xDC\x1F#\x92\"\xDD\x8BrRn\xF7\xCF\xB8\xD8\xEE\x1EwdaA#\xA0\x9E}\x85\xC8Gm\x1C<\xE7\x95\xD0\xC8\xB5X\xEF\x35\xB9\xD6XTW\x88\x8E\x05u\x80\x41\x83?\x9CL\xEA\x92L|%");

68 
Àn
 = 
	`°æí
("h\xC2\x1E&\xB3\x43\x88\x11&i\x16\xA3\x05>\x94*D\x14&\x17%x\xB9z\x8F\x7F\x15LLU\x16\x1A\x34\x1C-\xD6\xD3\xEC\x89y\xB3\x82\xC4\xFBw\xAC\xE4\xDA\xC1\xB7\x17\xCC`u]\xC6\x99\x0F \x8F\xA8\x11\x86\xD8)\x01\xE6\x38\x30\xF7\xD1\xB6\x96\xAE\xC6<8`\xD3*\x9DÖ\x01\x85v\xB0\th\x81H\xFF]_\xF3\x15\x9D\xCB[\xF8/n\xC9\x1E\x89>\x9E\xC7/~\xEFQ\\\x1A_\xE4\xE5\xFC\x1C'\xEF\xC8\xE0\x43!\x8AYc_y\xBB\xEE\x7Fy\xF4Ms\xD2\x62\xBAY\xA9\xDC\xAA\xCE\xEDSz\x92m\xF2\x17mO\xB3[\x89\x1E\xBC\xED$\xF1\x07g4\x1B\nhr\xAF\x42\xCF\x1A\xA6\x83\x80(\xA2\x1C\x37\xE3\xFC\x05\xDC\x1F#\x92\"\xDD\x8BrRn\xF7\xCF\xB8\xD8\xEE\x1EwdaA#\xA0\x9E}\x85\xC8Gm\x1C<\xE7\x95\xD0\xC8\xB5X\xEF\x35\xB9\xD6XTW\x88\x8E\x05u\x80\x41\x83?\x9CL\xEA\x92L|%");

69 i‡(
Àn
 != ("h\xC2\x1E&\xB3\x43\x88\x11&i\x16\xA3\x05>\x94*D\x14&\x17%x\xB9z\x8F\x7F\x15LLU\x16\x1A\x34\x1C-\xD6\xD3\xEC\x89y\xB3\x82\xC4\xFBw\xAC\xE4\xDA\xC1\xB7\x17\xCC`u]\xC6\x99\x0F \x8F\xA8\x11\x86\xD8)\x01\xE6\x38\x30\xF7\xD1\xB6\x96\xAE\xC6<8`\xD3*\x9DÖ\x01\x85v\xB0\th\x81H\xFF]_\xF3\x15\x9D\xCB[\xF8/n\xC9\x1E\x89>\x9E\xC7/~\xEFQ\\\x1A_\xE4\xE5\xFC\x1C'\xEF\xC8\xE0\x43!\x8AYc_y\xBB\xEE\x7Fy\xF4Ms\xD2\x62\xBAY\xA9\xDC\xAA\xCE\xEDSz\x92m\xF2\x17mO\xB3[\x89\x1E\xBC\xED$\xF1\x07g4\x1B\nhr\xAF\x42\xCF\x1A\xA6\x83\x80(\xA2\x1C\x37\xE3\xFC\x05\xDC\x1F#\x92\"\xDD\x8BrRn\xF7\xCF\xB8\xD8\xEE\x1EwdaA#\xA0\x9E}\x85\xC8Gm\x1C<\xE7\x95\xD0\xC8\xB5X\xEF\x35\xB9\xD6XTW\x88\x8E\x05u\x80\x41\x83?\x9CL\xEA\x92L|%")-1)

70 
íd
;

71 i‡(
a
.
size
 !
Àn
)

72 
íd
;

73 i‡(
a
.
size
 >á.
Æloc
)

74 
íd
;

75 i‡(
	`°rcmp
(
a
.
ôem
, "h\xC2\x1E&\xB3\x43\x88\x11&i\x16\xA3\x05>\x94*D\x14&\x17%x\xB9z\x8F\x7F\x15LLU\x16\x1A\x34\x1C-\xD6\xD3\xEC\x89y\xB3\x82\xC4\xFBw\xAC\xE4\xDA\xC1\xB7\x17\xCC`u]\xC6\x99\x0F \x8F\xA8\x11\x86\xD8)\x01\xE6\x38\x30\xF7\xD1\xB6\x96\xAE\xC6<8`\xD3*\x9DÖ\x01\x85v\xB0\th\x81H\xFF]_\xF3\x15\x9D\xCB[\xF8/n\xC9\x1E\x89>\x9E\xC7/~\xEFQ\\\x1A_\xE4\xE5\xFC\x1C'\xEF\xC8\xE0\x43!\x8AYc_y\xBB\xEE\x7Fy\xF4Ms\xD2\x62\xBAY\xA9\xDC\xAA\xCE\xEDSz\x92m\xF2\x17mO\xB3[\x89\x1E\xBC\xED$\xF1\x07g4\x1B\nhr\xAF\x42\xCF\x1A\xA6\x83\x80(\xA2\x1C\x37\xE3\xFC\x05\xDC\x1F#\x92\"\xDD\x8BrRn\xF7\xCF\xB8\xD8\xEE\x1EwdaA#\xA0\x9E}\x85\xC8Gm\x1C<\xE7\x95\xD0\xC8\xB5X\xEF\x35\xB9\xD6XTW\x88\x8E\x05u\x80\x41\x83?\x9CL\xEA\x92L|%"))

76 
íd
;

77 
	`d¨øy_‰ì
(
a
);

78 
	`d¨øy_öô
(
a
);

79 
ã°sPas£d
++;

82 
	`d¨øy_‰om_lô
(
a
, "\"\xD3\x84h)\xB7{\xB8\xDB\xD6y\xE9\x16+\xAD\xC4\xE9n\xDBZ\xAB\x38}3ic\xDE\x64\xC4\x91`\xE7\xD9I\xDC\xF8\xC3*/\x85P\xFB\xB7\x95lk5\xF4\xE2\x02\x15K\xDE\xF9\xA4l\xDEQ\xFE\x14G\xD5\t\xC3\x62;\rU\xF9\xBF\x99\x9F\x9D\x92U\x9D\x66\xBC\x06\x63\x9D\x99\xF0\xCA\xD2\xD2\x9EO\xD2\f2\x96.p\x81\x82wP*\xC0m\x93\xD9\xCB \xED\x94r\xA9:\vU\x19i\xAD\x88\x12\xD1\x1CP\xE5&*\xD7\x06\xFE\x90\x96N\"\xF4\x1A \x89\x64\x38\x65\x32\xF5\x8B\xB5V\xD3\x8A\xC6\n\xF0\xC7u\xEC!\x10\xE5\x42\xE5\x61\x05\x94\x9B\x11v\xC8n%5\xEA\xBC\x41K(\xF6\xD8.\xADS+\xCB\xAD\xAE@;\xAFP^\xD9\xDD\xC1\x1F:\xFA\v\x99\x85g3\xAC\x84\xC8xA\x1F\xA2\x9E\x89\x1F\x41\x08\x61\x41\x9C\x06\x07\x46\xF1\xBE\x83\x42\xF9\xAA\xD5\r\x8AUZ\x1E-\xF7\xD4\x9D\xAC\x04\xFF#\no\xBF\xC5\x9E\n0\x12\x64\x96\xFF\xF5'\xD6j\x10'\xE7\xB2rB2X\xBCY\xD9\x44\x9E\x1E\xBB-\t\x84+\xA8[z\x87\xF8\xE3K\xD1R'\xB0\xBA\x13\xBF\x64\xFA\x85g\x81{\xC6\xDC\xBA\xCF\x85wd\xC3u\xDC\x33\xF0t\\.&<\x92~\xC4_\xCF\xBC\xB9\xE9\x31\x65\x1B\x1F+\xEF\x32\xD3\xEB,\xE6\x36\x06*3\xB0");

83 
Àn
 = 
	`°æí
("\"\xD3\x84h)\xB7{\xB8\xDB\xD6y\xE9\x16+\xAD\xC4\xE9n\xDBZ\xAB\x38}3ic\xDE\x64\xC4\x91`\xE7\xD9I\xDC\xF8\xC3*/\x85P\xFB\xB7\x95lk5\xF4\xE2\x02\x15K\xDE\xF9\xA4l\xDEQ\xFE\x14G\xD5\t\xC3\x62;\rU\xF9\xBF\x99\x9F\x9D\x92U\x9D\x66\xBC\x06\x63\x9D\x99\xF0\xCA\xD2\xD2\x9EO\xD2\f2\x96.p\x81\x82wP*\xC0m\x93\xD9\xCB \xED\x94r\xA9:\vU\x19i\xAD\x88\x12\xD1\x1CP\xE5&*\xD7\x06\xFE\x90\x96N\"\xF4\x1A \x89\x64\x38\x65\x32\xF5\x8B\xB5V\xD3\x8A\xC6\n\xF0\xC7u\xEC!\x10\xE5\x42\xE5\x61\x05\x94\x9B\x11v\xC8n%5\xEA\xBC\x41K(\xF6\xD8.\xADS+\xCB\xAD\xAE@;\xAFP^\xD9\xDD\xC1\x1F:\xFA\v\x99\x85g3\xAC\x84\xC8xA\x1F\xA2\x9E\x89\x1F\x41\x08\x61\x41\x9C\x06\x07\x46\xF1\xBE\x83\x42\xF9\xAA\xD5\r\x8AUZ\x1E-\xF7\xD4\x9D\xAC\x04\xFF#\no\xBF\xC5\x9E\n0\x12\x64\x96\xFF\xF5'\xD6j\x10'\xE7\xB2rB2X\xBCY\xD9\x44\x9E\x1E\xBB-\t\x84+\xA8[z\x87\xF8\xE3K\xD1R'\xB0\xBA\x13\xBF\x64\xFA\x85g\x81{\xC6\xDC\xBA\xCF\x85wd\xC3u\xDC\x33\xF0t\\.&<\x92~\xC4_\xCF\xBC\xB9\xE9\x31\x65\x1B\x1F+\xEF\x32\xD3\xEB,\xE6\x36\x06*3\xB0");

84 i‡(
Àn
 != ("\"\xD3\x84h)\xB7{\xB8\xDB\xD6y\xE9\x16+\xAD\xC4\xE9n\xDBZ\xAB\x38}3ic\xDE\x64\xC4\x91`\xE7\xD9I\xDC\xF8\xC3*/\x85P\xFB\xB7\x95lk5\xF4\xE2\x02\x15K\xDE\xF9\xA4l\xDEQ\xFE\x14G\xD5\t\xC3\x62;\rU\xF9\xBF\x99\x9F\x9D\x92U\x9D\x66\xBC\x06\x63\x9D\x99\xF0\xCA\xD2\xD2\x9EO\xD2\f2\x96.p\x81\x82wP*\xC0m\x93\xD9\xCB \xED\x94r\xA9:\vU\x19i\xAD\x88\x12\xD1\x1CP\xE5&*\xD7\x06\xFE\x90\x96N\"\xF4\x1A \x89\x64\x38\x65\x32\xF5\x8B\xB5V\xD3\x8A\xC6\n\xF0\xC7u\xEC!\x10\xE5\x42\xE5\x61\x05\x94\x9B\x11v\xC8n%5\xEA\xBC\x41K(\xF6\xD8.\xADS+\xCB\xAD\xAE@;\xAFP^\xD9\xDD\xC1\x1F:\xFA\v\x99\x85g3\xAC\x84\xC8xA\x1F\xA2\x9E\x89\x1F\x41\x08\x61\x41\x9C\x06\x07\x46\xF1\xBE\x83\x42\xF9\xAA\xD5\r\x8AUZ\x1E-\xF7\xD4\x9D\xAC\x04\xFF#\no\xBF\xC5\x9E\n0\x12\x64\x96\xFF\xF5'\xD6j\x10'\xE7\xB2rB2X\xBCY\xD9\x44\x9E\x1E\xBB-\t\x84+\xA8[z\x87\xF8\xE3K\xD1R'\xB0\xBA\x13\xBF\x64\xFA\x85g\x81{\xC6\xDC\xBA\xCF\x85wd\xC3u\xDC\x33\xF0t\\.&<\x92~\xC4_\xCF\xBC\xB9\xE9\x31\x65\x1B\x1F+\xEF\x32\xD3\xEB,\xE6\x36\x06*3\xB0")-1)

85 
íd
;

86 i‡(
a
.
size
 !
Àn
)

87 
íd
;

88 i‡(
a
.
size
 >á.
Æloc
)

89 
íd
;

90 i‡(
	`°rcmp
(
a
.
ôem
, "\"\xD3\x84h)\xB7{\xB8\xDB\xD6y\xE9\x16+\xAD\xC4\xE9n\xDBZ\xAB\x38}3ic\xDE\x64\xC4\x91`\xE7\xD9I\xDC\xF8\xC3*/\x85P\xFB\xB7\x95lk5\xF4\xE2\x02\x15K\xDE\xF9\xA4l\xDEQ\xFE\x14G\xD5\t\xC3\x62;\rU\xF9\xBF\x99\x9F\x9D\x92U\x9D\x66\xBC\x06\x63\x9D\x99\xF0\xCA\xD2\xD2\x9EO\xD2\f2\x96.p\x81\x82wP*\xC0m\x93\xD9\xCB \xED\x94r\xA9:\vU\x19i\xAD\x88\x12\xD1\x1CP\xE5&*\xD7\x06\xFE\x90\x96N\"\xF4\x1A \x89\x64\x38\x65\x32\xF5\x8B\xB5V\xD3\x8A\xC6\n\xF0\xC7u\xEC!\x10\xE5\x42\xE5\x61\x05\x94\x9B\x11v\xC8n%5\xEA\xBC\x41K(\xF6\xD8.\xADS+\xCB\xAD\xAE@;\xAFP^\xD9\xDD\xC1\x1F:\xFA\v\x99\x85g3\xAC\x84\xC8xA\x1F\xA2\x9E\x89\x1F\x41\x08\x61\x41\x9C\x06\x07\x46\xF1\xBE\x83\x42\xF9\xAA\xD5\r\x8AUZ\x1E-\xF7\xD4\x9D\xAC\x04\xFF#\no\xBF\xC5\x9E\n0\x12\x64\x96\xFF\xF5'\xD6j\x10'\xE7\xB2rB2X\xBCY\xD9\x44\x9E\x1E\xBB-\t\x84+\xA8[z\x87\xF8\xE3K\xD1R'\xB0\xBA\x13\xBF\x64\xFA\x85g\x81{\xC6\xDC\xBA\xCF\x85wd\xC3u\xDC\x33\xF0t\\.&<\x92~\xC4_\xCF\xBC\xB9\xE9\x31\x65\x1B\x1F+\xEF\x32\xD3\xEB,\xE6\x36\x06*3\xB0"))

91 
íd
;

92 
	`d¨øy_‰ì
(
a
);

93 
	`d¨øy_öô
(
a
);

94 
ã°sPas£d
++;

97 
	`d¨øy_‰om_lô
(
a
, "\x16\x33\xBB\xD6\xAB\xCC\n\xBC{\xD3\xC0\xC2>Gc\xAC\xAB\xC8T\xBA\x17\x30`\x8E\x8D\xACs\x93]\xF8\x96\xDE\x07\n\xBF\x35\\[\xA7\xDF\x38\xFC\xCC\na\xFFx\x96\x05\xFD'\r&\xFE\x35\xB5\xBAY\x14=\xE2\x1D\x9B_S^\x1C\ne\xC4\xED\x89\x88\x07\x1En\x1A\x32vV\xE2m\x93\x94`]'\x07\xFE*\x1F\xAB\x96\xBAQZtfOa\xE5\x19\xDB\x13@/\x9F\x96\x37u\x9C\xEE\x0Fh\x80w\xBB\xE4\xB5\x12\x83\x83\x0F\xC0\x1BK\xE9\xDD_\x07\xB3\r\x95\xF1\xDAs\x91\xCE\x9EI\x88\xC7\x15\xC6@\xD1W\x15/c\x97\xDD\x41:P\x93\xF0\xB7\x42\x16\xFA\x84Zv[\xCC\x39\xA1*xcV\x90\xB3\xC4!\x03\xB1\xC3\x43$U\xC5;\xE5\xA2\x92Y]\xB5\x14U'\x12\x44oE\xCB^\x06\x89\x14\xCC\x97<\xFFi\xC8\x8D\xDB\x10\xD2\xA0\vtw>\xD7Q\xA8\xA1\xEA\xA6\x84\xED\xB6\x8C\x84za,|\x1Ahm\x98\x34j\x92k\xE3\x39\xAC\xCE\x96\xF8\x81\xD2\x9C\xB1)\xA2\xF8Y\xA7\x88G\r\xECN\x8D`\x1Bl\x80\xAB\xB6\x61/\xE4\xE9(\xE0\x1C]\x02\xE2\xB1\xD8O\xB4\xFFp{\xE5\x96\x8D\x16\xFC]+J\xC5\xFD\x89j\xB0\x82\xA3\xD8\xDB\xE5Y\xCA\x96\x39\x88<z\x01RP\x7Fz\x94\xDFRK\x15x0\x8B\xF0\xAA\xD1\x32\xBF\xED\x34\xFC\x63S\xCC\x38y9\x91\xB6*\xD7?\xBD|\x84\x93\xE3\xBD\xC3\xEFyP\xC8\xF5\x64|\xB0\x62\t*\x9C\x39\n\x93\xBA\xF8\xD9\xE1\x97r\xCE\xF2\xFE\r\xB6\xE1\xAA~\xEE\x33\x08u\x12\xC8\x17\x90\xBF\xC1\xFE;YF\x9F\xD9\xE4y\xD9I`\xC6\x93j\x94\x02\x34\x65OB\x9F\x99Z\v\x8A\x1AJ@\xFE\xCB\xFCly+f\xC7\x8F\x1A\xFD\xBDJ\xAFhnk\x15G\xCC\x9DPI?B\xDD\xBC\x9B\x12\xE8\x42y8");

98 
Àn
 = 
	`°æí
("\x16\x33\xBB\xD6\xAB\xCC\n\xBC{\xD3\xC0\xC2>Gc\xAC\xAB\xC8T\xBA\x17\x30`\x8E\x8D\xACs\x93]\xF8\x96\xDE\x07\n\xBF\x35\\[\xA7\xDF\x38\xFC\xCC\na\xFFx\x96\x05\xFD'\r&\xFE\x35\xB5\xBAY\x14=\xE2\x1D\x9B_S^\x1C\ne\xC4\xED\x89\x88\x07\x1En\x1A\x32vV\xE2m\x93\x94`]'\x07\xFE*\x1F\xAB\x96\xBAQZtfOa\xE5\x19\xDB\x13@/\x9F\x96\x37u\x9C\xEE\x0Fh\x80w\xBB\xE4\xB5\x12\x83\x83\x0F\xC0\x1BK\xE9\xDD_\x07\xB3\r\x95\xF1\xDAs\x91\xCE\x9EI\x88\xC7\x15\xC6@\xD1W\x15/c\x97\xDD\x41:P\x93\xF0\xB7\x42\x16\xFA\x84Zv[\xCC\x39\xA1*xcV\x90\xB3\xC4!\x03\xB1\xC3\x43$U\xC5;\xE5\xA2\x92Y]\xB5\x14U'\x12\x44oE\xCB^\x06\x89\x14\xCC\x97<\xFFi\xC8\x8D\xDB\x10\xD2\xA0\vtw>\xD7Q\xA8\xA1\xEA\xA6\x84\xED\xB6\x8C\x84za,|\x1Ahm\x98\x34j\x92k\xE3\x39\xAC\xCE\x96\xF8\x81\xD2\x9C\xB1)\xA2\xF8Y\xA7\x88G\r\xECN\x8D`\x1Bl\x80\xAB\xB6\x61/\xE4\xE9(\xE0\x1C]\x02\xE2\xB1\xD8O\xB4\xFFp{\xE5\x96\x8D\x16\xFC]+J\xC5\xFD\x89j\xB0\x82\xA3\xD8\xDB\xE5Y\xCA\x96\x39\x88<z\x01RP\x7Fz\x94\xDFRK\x15x0\x8B\xF0\xAA\xD1\x32\xBF\xED\x34\xFC\x63S\xCC\x38y9\x91\xB6*\xD7?\xBD|\x84\x93\xE3\xBD\xC3\xEFyP\xC8\xF5\x64|\xB0\x62\t*\x9C\x39\n\x93\xBA\xF8\xD9\xE1\x97r\xCE\xF2\xFE\r\xB6\xE1\xAA~\xEE\x33\x08u\x12\xC8\x17\x90\xBF\xC1\xFE;YF\x9F\xD9\xE4y\xD9I`\xC6\x93j\x94\x02\x34\x65OB\x9F\x99Z\v\x8A\x1AJ@\xFE\xCB\xFCly+f\xC7\x8F\x1A\xFD\xBDJ\xAFhnk\x15G\xCC\x9DPI?B\xDD\xBC\x9B\x12\xE8\x42y8");

99 i‡(
Àn
 != ("\x16\x33\xBB\xD6\xAB\xCC\n\xBC{\xD3\xC0\xC2>Gc\xAC\xAB\xC8T\xBA\x17\x30`\x8E\x8D\xACs\x93]\xF8\x96\xDE\x07\n\xBF\x35\\[\xA7\xDF\x38\xFC\xCC\na\xFFx\x96\x05\xFD'\r&\xFE\x35\xB5\xBAY\x14=\xE2\x1D\x9B_S^\x1C\ne\xC4\xED\x89\x88\x07\x1En\x1A\x32vV\xE2m\x93\x94`]'\x07\xFE*\x1F\xAB\x96\xBAQZtfOa\xE5\x19\xDB\x13@/\x9F\x96\x37u\x9C\xEE\x0Fh\x80w\xBB\xE4\xB5\x12\x83\x83\x0F\xC0\x1BK\xE9\xDD_\x07\xB3\r\x95\xF1\xDAs\x91\xCE\x9EI\x88\xC7\x15\xC6@\xD1W\x15/c\x97\xDD\x41:P\x93\xF0\xB7\x42\x16\xFA\x84Zv[\xCC\x39\xA1*xcV\x90\xB3\xC4!\x03\xB1\xC3\x43$U\xC5;\xE5\xA2\x92Y]\xB5\x14U'\x12\x44oE\xCB^\x06\x89\x14\xCC\x97<\xFFi\xC8\x8D\xDB\x10\xD2\xA0\vtw>\xD7Q\xA8\xA1\xEA\xA6\x84\xED\xB6\x8C\x84za,|\x1Ahm\x98\x34j\x92k\xE3\x39\xAC\xCE\x96\xF8\x81\xD2\x9C\xB1)\xA2\xF8Y\xA7\x88G\r\xECN\x8D`\x1Bl\x80\xAB\xB6\x61/\xE4\xE9(\xE0\x1C]\x02\xE2\xB1\xD8O\xB4\xFFp{\xE5\x96\x8D\x16\xFC]+J\xC5\xFD\x89j\xB0\x82\xA3\xD8\xDB\xE5Y\xCA\x96\x39\x88<z\x01RP\x7Fz\x94\xDFRK\x15x0\x8B\xF0\xAA\xD1\x32\xBF\xED\x34\xFC\x63S\xCC\x38y9\x91\xB6*\xD7?\xBD|\x84\x93\xE3\xBD\xC3\xEFyP\xC8\xF5\x64|\xB0\x62\t*\x9C\x39\n\x93\xBA\xF8\xD9\xE1\x97r\xCE\xF2\xFE\r\xB6\xE1\xAA~\xEE\x33\x08u\x12\xC8\x17\x90\xBF\xC1\xFE;YF\x9F\xD9\xE4y\xD9I`\xC6\x93j\x94\x02\x34\x65OB\x9F\x99Z\v\x8A\x1AJ@\xFE\xCB\xFCly+f\xC7\x8F\x1A\xFD\xBDJ\xAFhnk\x15G\xCC\x9DPI?B\xDD\xBC\x9B\x12\xE8\x42y8")-1)

100 
íd
;

101 i‡(
a
.
size
 !
Àn
)

102 
íd
;

103 i‡(
a
.
size
 >á.
Æloc
)

104 
íd
;

105 i‡(
	`°rcmp
(
a
.
ôem
, "\x16\x33\xBB\xD6\xAB\xCC\n\xBC{\xD3\xC0\xC2>Gc\xAC\xAB\xC8T\xBA\x17\x30`\x8E\x8D\xACs\x93]\xF8\x96\xDE\x07\n\xBF\x35\\[\xA7\xDF\x38\xFC\xCC\na\xFFx\x96\x05\xFD'\r&\xFE\x35\xB5\xBAY\x14=\xE2\x1D\x9B_S^\x1C\ne\xC4\xED\x89\x88\x07\x1En\x1A\x32vV\xE2m\x93\x94`]'\x07\xFE*\x1F\xAB\x96\xBAQZtfOa\xE5\x19\xDB\x13@/\x9F\x96\x37u\x9C\xEE\x0Fh\x80w\xBB\xE4\xB5\x12\x83\x83\x0F\xC0\x1BK\xE9\xDD_\x07\xB3\r\x95\xF1\xDAs\x91\xCE\x9EI\x88\xC7\x15\xC6@\xD1W\x15/c\x97\xDD\x41:P\x93\xF0\xB7\x42\x16\xFA\x84Zv[\xCC\x39\xA1*xcV\x90\xB3\xC4!\x03\xB1\xC3\x43$U\xC5;\xE5\xA2\x92Y]\xB5\x14U'\x12\x44oE\xCB^\x06\x89\x14\xCC\x97<\xFFi\xC8\x8D\xDB\x10\xD2\xA0\vtw>\xD7Q\xA8\xA1\xEA\xA6\x84\xED\xB6\x8C\x84za,|\x1Ahm\x98\x34j\x92k\xE3\x39\xAC\xCE\x96\xF8\x81\xD2\x9C\xB1)\xA2\xF8Y\xA7\x88G\r\xECN\x8D`\x1Bl\x80\xAB\xB6\x61/\xE4\xE9(\xE0\x1C]\x02\xE2\xB1\xD8O\xB4\xFFp{\xE5\x96\x8D\x16\xFC]+J\xC5\xFD\x89j\xB0\x82\xA3\xD8\xDB\xE5Y\xCA\x96\x39\x88<z\x01RP\x7Fz\x94\xDFRK\x15x0\x8B\xF0\xAA\xD1\x32\xBF\xED\x34\xFC\x63S\xCC\x38y9\x91\xB6*\xD7?\xBD|\x84\x93\xE3\xBD\xC3\xEFyP\xC8\xF5\x64|\xB0\x62\t*\x9C\x39\n\x93\xBA\xF8\xD9\xE1\x97r\xCE\xF2\xFE\r\xB6\xE1\xAA~\xEE\x33\x08u\x12\xC8\x17\x90\xBF\xC1\xFE;YF\x9F\xD9\xE4y\xD9I`\xC6\x93j\x94\x02\x34\x65OB\x9F\x99Z\v\x8A\x1AJ@\xFE\xCB\xFCly+f\xC7\x8F\x1A\xFD\xBDJ\xAFhnk\x15G\xCC\x9DPI?B\xDD\xBC\x9B\x12\xE8\x42y8"))

106 
íd
;

107 
	`d¨øy_‰ì
(
a
);

108 
	`d¨øy_öô
(
a
);

109 
ã°sPas£d
++;

112 
	`d¨øy_‰om_lô
(
a
, "ZE\x16p\xE4ni/\xD6\x35\x81L\x8E\xF8\x1B$\xC9\xA7\x88\xEE,\x02\xA1\x31\x97.\x9AYn\x9E\x8C\xDC\x9E{<\x0F\xF5\x15\"{`&|\x1Fk\xFE\x44z\xABq\xB9.\xE2O\x07\xB4\x1B~\x87\xBBO\xBB\xC6\xA5\xA5Z\x1F\x8Ezu9\xC6\x46\x96\x94\xCA$\x88>\x14I\xEA\xF7\x31\xF3\x95H\x8E\"x.\xEC\xEF\xCA\x0Eu=\xDA\x99\xA8Y\x1C\xEE\x39\xBD!\xE8\xDD\xF8\xD1\xE1S\x8E-W\xE4\xF3r\xEB\xAB\xE8\xC2M\xD8\xAA\xD8\x34\xE6\xE1\xA3\nb3\x16|\x91G\xCB\xF7.ajy'\xC8\xC4\xC5?\x8D$\xA1\v\x02\x7F\xDBN\xBB\xBBu\x96\xCB\xDF\xB2\x15\xEF\xD4\xE8\x11\xEB\x65\xCA\xBD\x31(l\x95\x17\xF7_\xAE\xC6w\x88\xF5\xF9\xE7\xB8\x98\x18\xDF)?\xDF\x8D\x16\xE1\xC3\xC1\xE1\xAFr\xE6M\xB0Gm\x18\x15\xF1\xA9\xF5\x35\xDA\xA9\xCA\xC4;\x15\xC5h\x12\xAC\xE1\xFC\xF1\xA0\xDB\x12\x17\t4\t\x11Z?\xCA\x42JUULji\xADN\xBD\x06\x93\xAB\xA2\xD6\x8F\x45\xF8~,\xE0\x95\xAD\xE6\xD5\x1BJ\x80\x0E\xC8L\x01\xC2\xE4\x39\xD4\xCE%5\xC3\xA4\xC6\x04{}\x89\n\xFF\x46\x16\xAF\x63\x0E\xE1\x99S\xAB\x63\x41(\xE8\xA8\xC0\x8F\xB2\xC8z\xDA\xA5\xF5\xC2\x13\x38\xA7K\xC9\xBD\xC0\xFD\xA2\xA5\xF5h\x08\xAD\xD0x&\xA7\xB1\v\xE6lTc$\x16\x81\x12Qs\xAA\xFE\xF6\xCD\xC9\xF5\xAD\x1A*lm\xB2\xDB\xC7\x08m;\xCE\x1C\xC9\xD7&VG\x07\xE9\x93\xE7\x04\x86\xF3\xD1[\xAE\x87:Ce\xE5\x61@\x9DV\x89+\xEA(\xF7\xB2\xB5g\xF4\xFF\x61\xDF\x92\xD8\x97\x96|}kb\xED\xB5\x04@\xC3\xF9=\xF1\x39\x03I\x87\xEF\xC5\x37t\xCC\x80;\x1A\xCE\x34\x37\x96\xDBHq\x1D\xF0\xE8\x92\x8B\xC4\x61\xF3\xD6\xA2\x35\x33\x34\x90\xB6Jbr\x7F\x8FI\xF4\x18\xCE\x04\v\xA0\x33K\x1D\xC2\x9F\xA9\x1A\xFDi\xFCn\x18\xD0\xBE-$2\x9BK\xD9\xBF\xD7Q.\xFD\x80\x0F");

113 
Àn
 = 
	`°æí
("ZE\x16p\xE4ni/\xD6\x35\x81L\x8E\xF8\x1B$\xC9\xA7\x88\xEE,\x02\xA1\x31\x97.\x9AYn\x9E\x8C\xDC\x9E{<\x0F\xF5\x15\"{`&|\x1Fk\xFE\x44z\xABq\xB9.\xE2O\x07\xB4\x1B~\x87\xBBO\xBB\xC6\xA5\xA5Z\x1F\x8Ezu9\xC6\x46\x96\x94\xCA$\x88>\x14I\xEA\xF7\x31\xF3\x95H\x8E\"x.\xEC\xEF\xCA\x0Eu=\xDA\x99\xA8Y\x1C\xEE\x39\xBD!\xE8\xDD\xF8\xD1\xE1S\x8E-W\xE4\xF3r\xEB\xAB\xE8\xC2M\xD8\xAA\xD8\x34\xE6\xE1\xA3\nb3\x16|\x91G\xCB\xF7.ajy'\xC8\xC4\xC5?\x8D$\xA1\v\x02\x7F\xDBN\xBB\xBBu\x96\xCB\xDF\xB2\x15\xEF\xD4\xE8\x11\xEB\x65\xCA\xBD\x31(l\x95\x17\xF7_\xAE\xC6w\x88\xF5\xF9\xE7\xB8\x98\x18\xDF)?\xDF\x8D\x16\xE1\xC3\xC1\xE1\xAFr\xE6M\xB0Gm\x18\x15\xF1\xA9\xF5\x35\xDA\xA9\xCA\xC4;\x15\xC5h\x12\xAC\xE1\xFC\xF1\xA0\xDB\x12\x17\t4\t\x11Z?\xCA\x42JUULji\xADN\xBD\x06\x93\xAB\xA2\xD6\x8F\x45\xF8~,\xE0\x95\xAD\xE6\xD5\x1BJ\x80\x0E\xC8L\x01\xC2\xE4\x39\xD4\xCE%5\xC3\xA4\xC6\x04{}\x89\n\xFF\x46\x16\xAF\x63\x0E\xE1\x99S\xAB\x63\x41(\xE8\xA8\xC0\x8F\xB2\xC8z\xDA\xA5\xF5\xC2\x13\x38\xA7K\xC9\xBD\xC0\xFD\xA2\xA5\xF5h\x08\xAD\xD0x&\xA7\xB1\v\xE6lTc$\x16\x81\x12Qs\xAA\xFE\xF6\xCD\xC9\xF5\xAD\x1A*lm\xB2\xDB\xC7\x08m;\xCE\x1C\xC9\xD7&VG\x07\xE9\x93\xE7\x04\x86\xF3\xD1[\xAE\x87:Ce\xE5\x61@\x9DV\x89+\xEA(\xF7\xB2\xB5g\xF4\xFF\x61\xDF\x92\xD8\x97\x96|}kb\xED\xB5\x04@\xC3\xF9=\xF1\x39\x03I\x87\xEF\xC5\x37t\xCC\x80;\x1A\xCE\x34\x37\x96\xDBHq\x1D\xF0\xE8\x92\x8B\xC4\x61\xF3\xD6\xA2\x35\x33\x34\x90\xB6Jbr\x7F\x8FI\xF4\x18\xCE\x04\v\xA0\x33K\x1D\xC2\x9F\xA9\x1A\xFDi\xFCn\x18\xD0\xBE-$2\x9BK\xD9\xBF\xD7Q.\xFD\x80\x0F");

114 i‡(
Àn
 != ("ZE\x16p\xE4ni/\xD6\x35\x81L\x8E\xF8\x1B$\xC9\xA7\x88\xEE,\x02\xA1\x31\x97.\x9AYn\x9E\x8C\xDC\x9E{<\x0F\xF5\x15\"{`&|\x1Fk\xFE\x44z\xABq\xB9.\xE2O\x07\xB4\x1B~\x87\xBBO\xBB\xC6\xA5\xA5Z\x1F\x8Ezu9\xC6\x46\x96\x94\xCA$\x88>\x14I\xEA\xF7\x31\xF3\x95H\x8E\"x.\xEC\xEF\xCA\x0Eu=\xDA\x99\xA8Y\x1C\xEE\x39\xBD!\xE8\xDD\xF8\xD1\xE1S\x8E-W\xE4\xF3r\xEB\xAB\xE8\xC2M\xD8\xAA\xD8\x34\xE6\xE1\xA3\nb3\x16|\x91G\xCB\xF7.ajy'\xC8\xC4\xC5?\x8D$\xA1\v\x02\x7F\xDBN\xBB\xBBu\x96\xCB\xDF\xB2\x15\xEF\xD4\xE8\x11\xEB\x65\xCA\xBD\x31(l\x95\x17\xF7_\xAE\xC6w\x88\xF5\xF9\xE7\xB8\x98\x18\xDF)?\xDF\x8D\x16\xE1\xC3\xC1\xE1\xAFr\xE6M\xB0Gm\x18\x15\xF1\xA9\xF5\x35\xDA\xA9\xCA\xC4;\x15\xC5h\x12\xAC\xE1\xFC\xF1\xA0\xDB\x12\x17\t4\t\x11Z?\xCA\x42JUULji\xADN\xBD\x06\x93\xAB\xA2\xD6\x8F\x45\xF8~,\xE0\x95\xAD\xE6\xD5\x1BJ\x80\x0E\xC8L\x01\xC2\xE4\x39\xD4\xCE%5\xC3\xA4\xC6\x04{}\x89\n\xFF\x46\x16\xAF\x63\x0E\xE1\x99S\xAB\x63\x41(\xE8\xA8\xC0\x8F\xB2\xC8z\xDA\xA5\xF5\xC2\x13\x38\xA7K\xC9\xBD\xC0\xFD\xA2\xA5\xF5h\x08\xAD\xD0x&\xA7\xB1\v\xE6lTc$\x16\x81\x12Qs\xAA\xFE\xF6\xCD\xC9\xF5\xAD\x1A*lm\xB2\xDB\xC7\x08m;\xCE\x1C\xC9\xD7&VG\x07\xE9\x93\xE7\x04\x86\xF3\xD1[\xAE\x87:Ce\xE5\x61@\x9DV\x89+\xEA(\xF7\xB2\xB5g\xF4\xFF\x61\xDF\x92\xD8\x97\x96|}kb\xED\xB5\x04@\xC3\xF9=\xF1\x39\x03I\x87\xEF\xC5\x37t\xCC\x80;\x1A\xCE\x34\x37\x96\xDBHq\x1D\xF0\xE8\x92\x8B\xC4\x61\xF3\xD6\xA2\x35\x33\x34\x90\xB6Jbr\x7F\x8FI\xF4\x18\xCE\x04\v\xA0\x33K\x1D\xC2\x9F\xA9\x1A\xFDi\xFCn\x18\xD0\xBE-$2\x9BK\xD9\xBF\xD7Q.\xFD\x80\x0F")-1)

115 
íd
;

116 i‡(
a
.
size
 !
Àn
)

117 
íd
;

118 i‡(
a
.
size
 >á.
Æloc
)

119 
íd
;

120 i‡(
	`°rcmp
(
a
.
ôem
, "ZE\x16p\xE4ni/\xD6\x35\x81L\x8E\xF8\x1B$\xC9\xA7\x88\xEE,\x02\xA1\x31\x97.\x9AYn\x9E\x8C\xDC\x9E{<\x0F\xF5\x15\"{`&|\x1Fk\xFE\x44z\xABq\xB9.\xE2O\x07\xB4\x1B~\x87\xBBO\xBB\xC6\xA5\xA5Z\x1F\x8Ezu9\xC6\x46\x96\x94\xCA$\x88>\x14I\xEA\xF7\x31\xF3\x95H\x8E\"x.\xEC\xEF\xCA\x0Eu=\xDA\x99\xA8Y\x1C\xEE\x39\xBD!\xE8\xDD\xF8\xD1\xE1S\x8E-W\xE4\xF3r\xEB\xAB\xE8\xC2M\xD8\xAA\xD8\x34\xE6\xE1\xA3\nb3\x16|\x91G\xCB\xF7.ajy'\xC8\xC4\xC5?\x8D$\xA1\v\x02\x7F\xDBN\xBB\xBBu\x96\xCB\xDF\xB2\x15\xEF\xD4\xE8\x11\xEB\x65\xCA\xBD\x31(l\x95\x17\xF7_\xAE\xC6w\x88\xF5\xF9\xE7\xB8\x98\x18\xDF)?\xDF\x8D\x16\xE1\xC3\xC1\xE1\xAFr\xE6M\xB0Gm\x18\x15\xF1\xA9\xF5\x35\xDA\xA9\xCA\xC4;\x15\xC5h\x12\xAC\xE1\xFC\xF1\xA0\xDB\x12\x17\t4\t\x11Z?\xCA\x42JUULji\xADN\xBD\x06\x93\xAB\xA2\xD6\x8F\x45\xF8~,\xE0\x95\xAD\xE6\xD5\x1BJ\x80\x0E\xC8L\x01\xC2\xE4\x39\xD4\xCE%5\xC3\xA4\xC6\x04{}\x89\n\xFF\x46\x16\xAF\x63\x0E\xE1\x99S\xAB\x63\x41(\xE8\xA8\xC0\x8F\xB2\xC8z\xDA\xA5\xF5\xC2\x13\x38\xA7K\xC9\xBD\xC0\xFD\xA2\xA5\xF5h\x08\xAD\xD0x&\xA7\xB1\v\xE6lTc$\x16\x81\x12Qs\xAA\xFE\xF6\xCD\xC9\xF5\xAD\x1A*lm\xB2\xDB\xC7\x08m;\xCE\x1C\xC9\xD7&VG\x07\xE9\x93\xE7\x04\x86\xF3\xD1[\xAE\x87:Ce\xE5\x61@\x9DV\x89+\xEA(\xF7\xB2\xB5g\xF4\xFF\x61\xDF\x92\xD8\x97\x96|}kb\xED\xB5\x04@\xC3\xF9=\xF1\x39\x03I\x87\xEF\xC5\x37t\xCC\x80;\x1A\xCE\x34\x37\x96\xDBHq\x1D\xF0\xE8\x92\x8B\xC4\x61\xF3\xD6\xA2\x35\x33\x34\x90\xB6Jbr\x7F\x8FI\xF4\x18\xCE\x04\v\xA0\x33K\x1D\xC2\x9F\xA9\x1A\xFDi\xFCn\x18\xD0\xBE-$2\x9BK\xD9\xBF\xD7Q.\xFD\x80\x0F"))

121 
íd
;

122 
	`d¨øy_‰ì
(
a
);

123 
	`d¨øy_öô
(
a
);

124 
ã°sPas£d
++;

127 
	`d¨øy_‰om_lô
(
a
, ")~\x96\x02\xE7h9\xB1\x65\x35\x8B\xF8\r\x81\x07\xCD\x9F\xD8-\xE2LB\xA1\xEA\n\x7F\xB1\xBFP15\x88\x32\x9C\x34\xCF\x02\xF8\x64\x8F\x43+\x1B\xB1\x8B\xAC\xB4\x96\xB3\xCB\xDB\x64\xF8\x91\xC0o$\f\x9A\xF6!\x97=jmU\xFD\x9C\xDB}\x15\x81\xAF\xE4q\x8C\xD7\xB8>\x9B\n\x96\f\xE0/Z\x1B\xB9\xE6|;/\xD2\x93\xC9\xC3\x63\x0FP#-\xF5\xDF\xF5\xFB@$\xB9\xEDG\xBF\xC1\xE2\xBF\xF8\x30\xC5p\xFB\xFF\xA9\xA6\xF7\xBD\xFD@\xC2\xFD\x92 \xA0\x91H\xA5\xD1\xC4\xCF\xB7\xD9T\xA9v\xF8q \xBA?\x9B\xA9@\xC8.\xBC\x89\xC0\x62\xD1\x38\x98\x83V\xB6\xB8\x85\x66\x1C\xC9Y\xCE\x8D\xF4\xCA\xCC\xDF\xB4\x06\xE1\xFC|\xA5i\xE2\x85\x02T\xEE\x35P\xDE\xDE\xE8\xE7Y\xB1\xDC:\x8A\xF6=a\xD8\x7F");

128 
Àn
 = 
	`°æí
(")~\x96\x02\xE7h9\xB1\x65\x35\x8B\xF8\r\x81\x07\xCD\x9F\xD8-\xE2LB\xA1\xEA\n\x7F\xB1\xBFP15\x88\x32\x9C\x34\xCF\x02\xF8\x64\x8F\x43+\x1B\xB1\x8B\xAC\xB4\x96\xB3\xCB\xDB\x64\xF8\x91\xC0o$\f\x9A\xF6!\x97=jmU\xFD\x9C\xDB}\x15\x81\xAF\xE4q\x8C\xD7\xB8>\x9B\n\x96\f\xE0/Z\x1B\xB9\xE6|;/\xD2\x93\xC9\xC3\x63\x0FP#-\xF5\xDF\xF5\xFB@$\xB9\xEDG\xBF\xC1\xE2\xBF\xF8\x30\xC5p\xFB\xFF\xA9\xA6\xF7\xBD\xFD@\xC2\xFD\x92 \xA0\x91H\xA5\xD1\xC4\xCF\xB7\xD9T\xA9v\xF8q \xBA?\x9B\xA9@\xC8.\xBC\x89\xC0\x62\xD1\x38\x98\x83V\xB6\xB8\x85\x66\x1C\xC9Y\xCE\x8D\xF4\xCA\xCC\xDF\xB4\x06\xE1\xFC|\xA5i\xE2\x85\x02T\xEE\x35P\xDE\xDE\xE8\xE7Y\xB1\xDC:\x8A\xF6=a\xD8\x7F");

129 i‡(
Àn
 != (")~\x96\x02\xE7h9\xB1\x65\x35\x8B\xF8\r\x81\x07\xCD\x9F\xD8-\xE2LB\xA1\xEA\n\x7F\xB1\xBFP15\x88\x32\x9C\x34\xCF\x02\xF8\x64\x8F\x43+\x1B\xB1\x8B\xAC\xB4\x96\xB3\xCB\xDB\x64\xF8\x91\xC0o$\f\x9A\xF6!\x97=jmU\xFD\x9C\xDB}\x15\x81\xAF\xE4q\x8C\xD7\xB8>\x9B\n\x96\f\xE0/Z\x1B\xB9\xE6|;/\xD2\x93\xC9\xC3\x63\x0FP#-\xF5\xDF\xF5\xFB@$\xB9\xEDG\xBF\xC1\xE2\xBF\xF8\x30\xC5p\xFB\xFF\xA9\xA6\xF7\xBD\xFD@\xC2\xFD\x92 \xA0\x91H\xA5\xD1\xC4\xCF\xB7\xD9T\xA9v\xF8q \xBA?\x9B\xA9@\xC8.\xBC\x89\xC0\x62\xD1\x38\x98\x83V\xB6\xB8\x85\x66\x1C\xC9Y\xCE\x8D\xF4\xCA\xCC\xDF\xB4\x06\xE1\xFC|\xA5i\xE2\x85\x02T\xEE\x35P\xDE\xDE\xE8\xE7Y\xB1\xDC:\x8A\xF6=a\xD8\x7F")-1)

130 
íd
;

131 i‡(
a
.
size
 !
Àn
)

132 
íd
;

133 i‡(
a
.
size
 >á.
Æloc
)

134 
íd
;

135 i‡(
	`°rcmp
(
a
.
ôem
, ")~\x96\x02\xE7h9\xB1\x65\x35\x8B\xF8\r\x81\x07\xCD\x9F\xD8-\xE2LB\xA1\xEA\n\x7F\xB1\xBFP15\x88\x32\x9C\x34\xCF\x02\xF8\x64\x8F\x43+\x1B\xB1\x8B\xAC\xB4\x96\xB3\xCB\xDB\x64\xF8\x91\xC0o$\f\x9A\xF6!\x97=jmU\xFD\x9C\xDB}\x15\x81\xAF\xE4q\x8C\xD7\xB8>\x9B\n\x96\f\xE0/Z\x1B\xB9\xE6|;/\xD2\x93\xC9\xC3\x63\x0FP#-\xF5\xDF\xF5\xFB@$\xB9\xEDG\xBF\xC1\xE2\xBF\xF8\x30\xC5p\xFB\xFF\xA9\xA6\xF7\xBD\xFD@\xC2\xFD\x92 \xA0\x91H\xA5\xD1\xC4\xCF\xB7\xD9T\xA9v\xF8q \xBA?\x9B\xA9@\xC8.\xBC\x89\xC0\x62\xD1\x38\x98\x83V\xB6\xB8\x85\x66\x1C\xC9Y\xCE\x8D\xF4\xCA\xCC\xDF\xB4\x06\xE1\xFC|\xA5i\xE2\x85\x02T\xEE\x35P\xDE\xDE\xE8\xE7Y\xB1\xDC:\x8A\xF6=a\xD8\x7F"))

136 
íd
;

137 
	`d¨øy_‰ì
(
a
);

138 
	`d¨øy_öô
(
a
);

139 
ã°sPas£d
++;

142 
	`d¨øy_‰om_lô
(
a
, "!\xB5\xEB\xC0[\xE5\x35\x1F\x44\x84.\r\xE7\x44\xD3\nJ\xD8`\xFA\x85\x03\xE1_rm\xDD\x04yn\x90S\x8DH\x01\x0F\n(:\xD5\x14\x1C\x42\x81#&%;Y\xC7\xBA\x91\xEFhA\x12\x92\x04\x41\x96j\xB3R\x8D\xDF\x87\x16^\xBE\x42$0\xF9j\x13y\xB3\x61I\x8A\x8C+m\x9B\xD4=\x8A/q\fR@^\x97H2Gb\x1D\vA\v\r\xE1\xC5\x88rd\x88\x8B\xF0\xC0[\x8C\x45\x37\xC1\x45\xC8\x1F\\3\xB7\xD5\xAA\x98\xCD\x19\xE4*\xCDk\x95\xFE\x04\x33\x38\x14\x11\xA2p");

143 
Àn
 = 
	`°æí
("!\xB5\xEB\xC0[\xE5\x35\x1F\x44\x84.\r\xE7\x44\xD3\nJ\xD8`\xFA\x85\x03\xE1_rm\xDD\x04yn\x90S\x8DH\x01\x0F\n(:\xD5\x14\x1C\x42\x81#&%;Y\xC7\xBA\x91\xEFhA\x12\x92\x04\x41\x96j\xB3R\x8D\xDF\x87\x16^\xBE\x42$0\xF9j\x13y\xB3\x61I\x8A\x8C+m\x9B\xD4=\x8A/q\fR@^\x97H2Gb\x1D\vA\v\r\xE1\xC5\x88rd\x88\x8B\xF0\xC0[\x8C\x45\x37\xC1\x45\xC8\x1F\\3\xB7\xD5\xAA\x98\xCD\x19\xE4*\xCDk\x95\xFE\x04\x33\x38\x14\x11\xA2p");

144 i‡(
Àn
 != ("!\xB5\xEB\xC0[\xE5\x35\x1F\x44\x84.\r\xE7\x44\xD3\nJ\xD8`\xFA\x85\x03\xE1_rm\xDD\x04yn\x90S\x8DH\x01\x0F\n(:\xD5\x14\x1C\x42\x81#&%;Y\xC7\xBA\x91\xEFhA\x12\x92\x04\x41\x96j\xB3R\x8D\xDF\x87\x16^\xBE\x42$0\xF9j\x13y\xB3\x61I\x8A\x8C+m\x9B\xD4=\x8A/q\fR@^\x97H2Gb\x1D\vA\v\r\xE1\xC5\x88rd\x88\x8B\xF0\xC0[\x8C\x45\x37\xC1\x45\xC8\x1F\\3\xB7\xD5\xAA\x98\xCD\x19\xE4*\xCDk\x95\xFE\x04\x33\x38\x14\x11\xA2p")-1)

145 
íd
;

146 i‡(
a
.
size
 !
Àn
)

147 
íd
;

148 i‡(
a
.
size
 >á.
Æloc
)

149 
íd
;

150 i‡(
	`°rcmp
(
a
.
ôem
, "!\xB5\xEB\xC0[\xE5\x35\x1F\x44\x84.\r\xE7\x44\xD3\nJ\xD8`\xFA\x85\x03\xE1_rm\xDD\x04yn\x90S\x8DH\x01\x0F\n(:\xD5\x14\x1C\x42\x81#&%;Y\xC7\xBA\x91\xEFhA\x12\x92\x04\x41\x96j\xB3R\x8D\xDF\x87\x16^\xBE\x42$0\xF9j\x13y\xB3\x61I\x8A\x8C+m\x9B\xD4=\x8A/q\fR@^\x97H2Gb\x1D\vA\v\r\xE1\xC5\x88rd\x88\x8B\xF0\xC0[\x8C\x45\x37\xC1\x45\xC8\x1F\\3\xB7\xD5\xAA\x98\xCD\x19\xE4*\xCDk\x95\xFE\x04\x33\x38\x14\x11\xA2p"))

151 
íd
;

152 
	`d¨øy_‰ì
(
a
);

153 
	`d¨øy_öô
(
a
);

154 
ã°sPas£d
++;

157 
	`d¨øy_‰om_lô
(
a
, "\xB7<\x14\x01\xC2\x91K\xC8O\xAD\xD2L\x83\\\x8B\xAE\x11\x1B\xB9\x44GR\xC7\xDD\xAD\x18\x0F\x14\x02\xE2R\r\x13I\xE0#\x9E$\x19\x89\x9C&t\x0F\xDF-w\xD0\x96yg\x86\x1B\x1E\xDF\x13\x0Er|\xB6\x38.,k\x11\xB9\xE5\xF2\xEC\xBD]\xB3\xAF\xD8\xA7\xF6\xFB\x0Ek\xA0\xC8\xD3\x46\xC2%\xE9t[\x05\xF9\x96g\x82.S;ZX\xED\x34Z\xF2'YD\x89o\xA1\xBB\xCB\xBE\xB3\x1B'M\n\xCESc(\xECT9\xA5\x83\x30\x80\x44\x08\x90\x33\xAE\x08\x62\"\xE6\x82G\xFDN\x95\xC1\x01\xFE/LS\x1A'Z3L\xF5\xC8\xE0>(_\x17\xDA\xCC\xED\xB6\xED\x84K7\x1B\x95-t\xE0<\xE4V\xE2\x94\x8F%\x83W\xDB\x99_\x9D-\xF9\x45\x18\xB8\x38\xE7\xD9\xDD\xAF\xE6\x62\x07\x95\x01\xB1\x8C_\x02\x80\xC1\xD8\\\x87\xBF\xEB\xF5\xFB \x9Cm\xE2n\x1Fm\xA8\x33\x1CY\";\x8F\x17\xE8\xD7\x9Aj\n\xF9\\\xC7\xEB\xF3\x88\xCDHXoJ\xD2\n\xECZ\x9AK\xD3-\xC3\xA9)pa%\x1E\x8A\x64\x8E$k0\xD3\x86p\x9A\x9A\x32\xF1x!\xA7\xB1HV\xCB\x94z\xB1\x33.W\xF6Vtp\x9C$`\x93\x8A\xC9S]\x99\x07\xB3\xD7?\xE8j\x08\xEA#\x9E\x65{.}IJ\x0E\x99\xB5\xCCS=jk-2\xB2\x94q\xAE\x35\xC3\x61\x1E\xF1\xBDvs/\xC2\xC9\xD9\x96\xA0t\x19\xC1\xA7\x04\xA8\x7F\xC4\xEC-\x1B\xD2\xE3\xF6\x9D\x12\xD2\xC2");

158 
Àn
 = 
	`°æí
("\xB7<\x14\x01\xC2\x91K\xC8O\xAD\xD2L\x83\\\x8B\xAE\x11\x1B\xB9\x44GR\xC7\xDD\xAD\x18\x0F\x14\x02\xE2R\r\x13I\xE0#\x9E$\x19\x89\x9C&t\x0F\xDF-w\xD0\x96yg\x86\x1B\x1E\xDF\x13\x0Er|\xB6\x38.,k\x11\xB9\xE5\xF2\xEC\xBD]\xB3\xAF\xD8\xA7\xF6\xFB\x0Ek\xA0\xC8\xD3\x46\xC2%\xE9t[\x05\xF9\x96g\x82.S;ZX\xED\x34Z\xF2'YD\x89o\xA1\xBB\xCB\xBE\xB3\x1B'M\n\xCESc(\xECT9\xA5\x83\x30\x80\x44\x08\x90\x33\xAE\x08\x62\"\xE6\x82G\xFDN\x95\xC1\x01\xFE/LS\x1A'Z3L\xF5\xC8\xE0>(_\x17\xDA\xCC\xED\xB6\xED\x84K7\x1B\x95-t\xE0<\xE4V\xE2\x94\x8F%\x83W\xDB\x99_\x9D-\xF9\x45\x18\xB8\x38\xE7\xD9\xDD\xAF\xE6\x62\x07\x95\x01\xB1\x8C_\x02\x80\xC1\xD8\\\x87\xBF\xEB\xF5\xFB \x9Cm\xE2n\x1Fm\xA8\x33\x1CY\";\x8F\x17\xE8\xD7\x9Aj\n\xF9\\\xC7\xEB\xF3\x88\xCDHXoJ\xD2\n\xECZ\x9AK\xD3-\xC3\xA9)pa%\x1E\x8A\x64\x8E$k0\xD3\x86p\x9A\x9A\x32\xF1x!\xA7\xB1HV\xCB\x94z\xB1\x33.W\xF6Vtp\x9C$`\x93\x8A\xC9S]\x99\x07\xB3\xD7?\xE8j\x08\xEA#\x9E\x65{.}IJ\x0E\x99\xB5\xCCS=jk-2\xB2\x94q\xAE\x35\xC3\x61\x1E\xF1\xBDvs/\xC2\xC9\xD9\x96\xA0t\x19\xC1\xA7\x04\xA8\x7F\xC4\xEC-\x1B\xD2\xE3\xF6\x9D\x12\xD2\xC2");

159 i‡(
Àn
 != ("\xB7<\x14\x01\xC2\x91K\xC8O\xAD\xD2L\x83\\\x8B\xAE\x11\x1B\xB9\x44GR\xC7\xDD\xAD\x18\x0F\x14\x02\xE2R\r\x13I\xE0#\x9E$\x19\x89\x9C&t\x0F\xDF-w\xD0\x96yg\x86\x1B\x1E\xDF\x13\x0Er|\xB6\x38.,k\x11\xB9\xE5\xF2\xEC\xBD]\xB3\xAF\xD8\xA7\xF6\xFB\x0Ek\xA0\xC8\xD3\x46\xC2%\xE9t[\x05\xF9\x96g\x82.S;ZX\xED\x34Z\xF2'YD\x89o\xA1\xBB\xCB\xBE\xB3\x1B'M\n\xCESc(\xECT9\xA5\x83\x30\x80\x44\x08\x90\x33\xAE\x08\x62\"\xE6\x82G\xFDN\x95\xC1\x01\xFE/LS\x1A'Z3L\xF5\xC8\xE0>(_\x17\xDA\xCC\xED\xB6\xED\x84K7\x1B\x95-t\xE0<\xE4V\xE2\x94\x8F%\x83W\xDB\x99_\x9D-\xF9\x45\x18\xB8\x38\xE7\xD9\xDD\xAF\xE6\x62\x07\x95\x01\xB1\x8C_\x02\x80\xC1\xD8\\\x87\xBF\xEB\xF5\xFB \x9Cm\xE2n\x1Fm\xA8\x33\x1CY\";\x8F\x17\xE8\xD7\x9Aj\n\xF9\\\xC7\xEB\xF3\x88\xCDHXoJ\xD2\n\xECZ\x9AK\xD3-\xC3\xA9)pa%\x1E\x8A\x64\x8E$k0\xD3\x86p\x9A\x9A\x32\xF1x!\xA7\xB1HV\xCB\x94z\xB1\x33.W\xF6Vtp\x9C$`\x93\x8A\xC9S]\x99\x07\xB3\xD7?\xE8j\x08\xEA#\x9E\x65{.}IJ\x0E\x99\xB5\xCCS=jk-2\xB2\x94q\xAE\x35\xC3\x61\x1E\xF1\xBDvs/\xC2\xC9\xD9\x96\xA0t\x19\xC1\xA7\x04\xA8\x7F\xC4\xEC-\x1B\xD2\xE3\xF6\x9D\x12\xD2\xC2")-1)

160 
íd
;

161 i‡(
a
.
size
 !
Àn
)

162 
íd
;

163 i‡(
a
.
size
 >á.
Æloc
)

164 
íd
;

165 i‡(
	`°rcmp
(
a
.
ôem
, "\xB7<\x14\x01\xC2\x91K\xC8O\xAD\xD2L\x83\\\x8B\xAE\x11\x1B\xB9\x44GR\xC7\xDD\xAD\x18\x0F\x14\x02\xE2R\r\x13I\xE0#\x9E$\x19\x89\x9C&t\x0F\xDF-w\xD0\x96yg\x86\x1B\x1E\xDF\x13\x0Er|\xB6\x38.,k\x11\xB9\xE5\xF2\xEC\xBD]\xB3\xAF\xD8\xA7\xF6\xFB\x0Ek\xA0\xC8\xD3\x46\xC2%\xE9t[\x05\xF9\x96g\x82.S;ZX\xED\x34Z\xF2'YD\x89o\xA1\xBB\xCB\xBE\xB3\x1B'M\n\xCESc(\xECT9\xA5\x83\x30\x80\x44\x08\x90\x33\xAE\x08\x62\"\xE6\x82G\xFDN\x95\xC1\x01\xFE/LS\x1A'Z3L\xF5\xC8\xE0>(_\x17\xDA\xCC\xED\xB6\xED\x84K7\x1B\x95-t\xE0<\xE4V\xE2\x94\x8F%\x83W\xDB\x99_\x9D-\xF9\x45\x18\xB8\x38\xE7\xD9\xDD\xAF\xE6\x62\x07\x95\x01\xB1\x8C_\x02\x80\xC1\xD8\\\x87\xBF\xEB\xF5\xFB \x9Cm\xE2n\x1Fm\xA8\x33\x1CY\";\x8F\x17\xE8\xD7\x9Aj\n\xF9\\\xC7\xEB\xF3\x88\xCDHXoJ\xD2\n\xECZ\x9AK\xD3-\xC3\xA9)pa%\x1E\x8A\x64\x8E$k0\xD3\x86p\x9A\x9A\x32\xF1x!\xA7\xB1HV\xCB\x94z\xB1\x33.W\xF6Vtp\x9C$`\x93\x8A\xC9S]\x99\x07\xB3\xD7?\xE8j\x08\xEA#\x9E\x65{.}IJ\x0E\x99\xB5\xCCS=jk-2\xB2\x94q\xAE\x35\xC3\x61\x1E\xF1\xBDvs/\xC2\xC9\xD9\x96\xA0t\x19\xC1\xA7\x04\xA8\x7F\xC4\xEC-\x1B\xD2\xE3\xF6\x9D\x12\xD2\xC2"))

166 
íd
;

167 
	`d¨øy_‰ì
(
a
);

168 
	`d¨øy_öô
(
a
);

169 
ã°sPas£d
++;

172 
íd
:

173 
	`d¨øy_‰ì
(
a
);

174  
ã°sPas£d
 == 10;

175 
	}
}

178 *
	môem
;

179 
size_t
 
	msize
;

180 } 
	tã°Lôs_°rög
;

182 
	$ã°d¨øy_≠≥nd_lô
() {

183 
d¨øy_ch¨
 
a
 = 
	`d¨øy_√w
();

184 
	`d¨øy
(
ã°Lôs_°rög
Ë
°rögs
 = 
	`d¨øy_√w
();

185 
ã°Lôs_°rög
 *
i
;

186 
size_t
 
ã°sPas£d
 = 0;

187 
size_t
 
ﬁdSize
;

188 
ã°Lôs_°rög
 
≠≥nd
;

189 
size_t
 
offs
 = 0;

192 
≠≥nd
.
size
 = ("v\xF8\xFE\xC6\x9D^5\xF4=kK\xD1(Mz\x9D\xA3\r\x12\x7F(D\xFC?\x89\x7F\xD2\x97\x0E]\f\xB4\x9F\x45n\x99h\xDE\x36\xBF>\xA7\xEF\x94\\>wVa\xFF\xBD\x08\xF1;\xF3\nx\xBFV*\x9C\xFC@\x1D\x02:\xD7\x9Bxvr}\xD6\xAC\x86I\xACN\x14\x06|\x7FSP\x8C\xB3\xFB~\xC9\t\xB3\xA4\x1EMO\x1C\xA3n\xA0\xB3\xC2n\x8B\xC6\x9CHi\x7F\tX9\x01\xDC\xED\x11I\xC4\f\x16\x14\xBC\x12\\\xB2\xCE\xAB\xE4\x1E-kZ\t\x13\xEF\xA6\xA2\x1B\xCC\x19\x86\xD4\x80#\x95\xB6\xC6zssc\xB4(\xBE\x9D\x9C\x98:\xB2\xEA\x45\xA8\xBB\x08\xC0J\x17^H\xBFL\xF8\xE1\xF4P\x1Ay5\xF6S0i\x1Fn\xB7Y\xD8\x98\x85\x01\x90\x8E\x1A/&\xEF")-1;

193 
ﬁdSize
 = 
a
.
size
;

194 
	`d¨øy_≠≥nd_lô
(
a
, "v\xF8\xFE\xC6\x9D^5\xF4=kK\xD1(Mz\x9D\xA3\r\x12\x7F(D\xFC?\x89\x7F\xD2\x97\x0E]\f\xB4\x9F\x45n\x99h\xDE\x36\xBF>\xA7\xEF\x94\\>wVa\xFF\xBD\x08\xF1;\xF3\nx\xBFV*\x9C\xFC@\x1D\x02:\xD7\x9Bxvr}\xD6\xAC\x86I\xACN\x14\x06|\x7FSP\x8C\xB3\xFB~\xC9\t\xB3\xA4\x1EMO\x1C\xA3n\xA0\xB3\xC2n\x8B\xC6\x9CHi\x7F\tX9\x01\xDC\xED\x11I\xC4\f\x16\x14\xBC\x12\\\xB2\xCE\xAB\xE4\x1E-kZ\t\x13\xEF\xA6\xA2\x1B\xCC\x19\x86\xD4\x80#\x95\xB6\xC6zssc\xB4(\xBE\x9D\x9C\x98:\xB2\xEA\x45\xA8\xBB\x08\xC0J\x17^H\xBFL\xF8\xE1\xF4P\x1Ay5\xF6S0i\x1Fn\xB7Y\xD8\x98\x85\x01\x90\x8E\x1A/&\xEF");

195 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

196 
íd
;

197 i‡(
a
.
size
 >á.
Æloc
)

198 
íd
;

199 i‡(
a
.
ôem
[a.
size
])

200 
íd
;

201 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "v\xF8\xFE\xC6\x9D^5\xF4=kK\xD1(Mz\x9D\xA3\r\x12\x7F(D\xFC?\x89\x7F\xD2\x97\x0E]\f\xB4\x9F\x45n\x99h\xDE\x36\xBF>\xA7\xEF\x94\\>wVa\xFF\xBD\x08\xF1;\xF3\nx\xBFV*\x9C\xFC@\x1D\x02:\xD7\x9Bxvr}\xD6\xAC\x86I\xACN\x14\x06|\x7FSP\x8C\xB3\xFB~\xC9\t\xB3\xA4\x1EMO\x1C\xA3n\xA0\xB3\xC2n\x8B\xC6\x9CHi\x7F\tX9\x01\xDC\xED\x11I\xC4\f\x16\x14\xBC\x12\\\xB2\xCE\xAB\xE4\x1E-kZ\t\x13\xEF\xA6\xA2\x1B\xCC\x19\x86\xD4\x80#\x95\xB6\xC6zssc\xB4(\xBE\x9D\x9C\x98:\xB2\xEA\x45\xA8\xBB\x08\xC0J\x17^H\xBFL\xF8\xE1\xF4P\x1Ay5\xF6S0i\x1Fn\xB7Y\xD8\x98\x85\x01\x90\x8E\x1A/&\xEF",á.
size
-oldSize))

202 
íd
;

203 
≠≥nd
.
ôem
 = 
	`°rdup
("v\xF8\xFE\xC6\x9D^5\xF4=kK\xD1(Mz\x9D\xA3\r\x12\x7F(D\xFC?\x89\x7F\xD2\x97\x0E]\f\xB4\x9F\x45n\x99h\xDE\x36\xBF>\xA7\xEF\x94\\>wVa\xFF\xBD\x08\xF1;\xF3\nx\xBFV*\x9C\xFC@\x1D\x02:\xD7\x9Bxvr}\xD6\xAC\x86I\xACN\x14\x06|\x7FSP\x8C\xB3\xFB~\xC9\t\xB3\xA4\x1EMO\x1C\xA3n\xA0\xB3\xC2n\x8B\xC6\x9CHi\x7F\tX9\x01\xDC\xED\x11I\xC4\f\x16\x14\xBC\x12\\\xB2\xCE\xAB\xE4\x1E-kZ\t\x13\xEF\xA6\xA2\x1B\xCC\x19\x86\xD4\x80#\x95\xB6\xC6zssc\xB4(\xBE\x9D\x9C\x98:\xB2\xEA\x45\xA8\xBB\x08\xC0J\x17^H\xBFL\xF8\xE1\xF4P\x1Ay5\xF6S0i\x1Fn\xB7Y\xD8\x98\x85\x01\x90\x8E\x1A/&\xEF");

204 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

205 
ã°sPas£d
++;

208 
≠≥nd
.
size
 = ("\f\x8F[w\xD4\xAE\xBC\x1Dn\xF7\xE0jD\xA4p\x0E\n<\x9C\xF0Z\xC1I\x86~\xD1G\xB3\x01\xA6\x86)q1\x12\xD5\x08\x0E\x08\x7F+/pp\x14\xF0\xCF\x97%\xE0Q\x06\xCE)\xDF\x92\xBD\x06Z\xC2\x80\x94\xE3V%*\x18\xE1\xF4\xFA\xBD\x14MCjZ\xB2(\x91\x19\x8A\xB1\x34\xD3\x45\xC4\x1F\x39Q\xCB`\x0F\x9C\x81J\x0F\x86%\xA2\xEA>\x04\x7F\x94\x9F\xC7\xD2\xD9`\xEB\x30\xE7\xCDp\xBC\xD5\xD7\xDD!j|\xC1T\xE1 NB;A\xF7\xA2\x9C\xA6!\xDF\xB5\x9D\x64\x86\xD8\xFD\xD1\x99\xA3\xD0\\Q\xE1|\r\x18\xD9;\xE0\x95\xD8h\xF0\xC2V\xD7\\\x01\x91\xBEg\xC6\x44\x97U\xF8s/\xF7\x8C\xF4y\xDA\xC3\x38$\x8Fr\x86\x9D\xB4u\xAF\x0Et\xEC\xDD\xB0\"~x\x8F\x9B\x7F\xABl\x05\xAC\"\xA0\t\xCEL+\xDD\xB1V!\xAF\xFA\xD3\x03\xFB\xC2g\xEB\xA8\xDB\xF8\x16r\xB1\x41\xD9\x14\x06O\\O\xEB\x92\xF4\x39\xB1\x18s\x9B\x41#Q\xC3\x66\xCC\xA6\x33\xD4n\x12\v")-1;

209 
ﬁdSize
 = 
a
.
size
;

210 
	`d¨øy_≠≥nd_lô
(
a
, "\f\x8F[w\xD4\xAE\xBC\x1Dn\xF7\xE0jD\xA4p\x0E\n<\x9C\xF0Z\xC1I\x86~\xD1G\xB3\x01\xA6\x86)q1\x12\xD5\x08\x0E\x08\x7F+/pp\x14\xF0\xCF\x97%\xE0Q\x06\xCE)\xDF\x92\xBD\x06Z\xC2\x80\x94\xE3V%*\x18\xE1\xF4\xFA\xBD\x14MCjZ\xB2(\x91\x19\x8A\xB1\x34\xD3\x45\xC4\x1F\x39Q\xCB`\x0F\x9C\x81J\x0F\x86%\xA2\xEA>\x04\x7F\x94\x9F\xC7\xD2\xD9`\xEB\x30\xE7\xCDp\xBC\xD5\xD7\xDD!j|\xC1T\xE1 NB;A\xF7\xA2\x9C\xA6!\xDF\xB5\x9D\x64\x86\xD8\xFD\xD1\x99\xA3\xD0\\Q\xE1|\r\x18\xD9;\xE0\x95\xD8h\xF0\xC2V\xD7\\\x01\x91\xBEg\xC6\x44\x97U\xF8s/\xF7\x8C\xF4y\xDA\xC3\x38$\x8Fr\x86\x9D\xB4u\xAF\x0Et\xEC\xDD\xB0\"~x\x8F\x9B\x7F\xABl\x05\xAC\"\xA0\t\xCEL+\xDD\xB1V!\xAF\xFA\xD3\x03\xFB\xC2g\xEB\xA8\xDB\xF8\x16r\xB1\x41\xD9\x14\x06O\\O\xEB\x92\xF4\x39\xB1\x18s\x9B\x41#Q\xC3\x66\xCC\xA6\x33\xD4n\x12\v");

211 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

212 
íd
;

213 i‡(
a
.
size
 >á.
Æloc
)

214 
íd
;

215 i‡(
a
.
ôem
[a.
size
])

216 
íd
;

217 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\f\x8F[w\xD4\xAE\xBC\x1Dn\xF7\xE0jD\xA4p\x0E\n<\x9C\xF0Z\xC1I\x86~\xD1G\xB3\x01\xA6\x86)q1\x12\xD5\x08\x0E\x08\x7F+/µ\x14\xF0\xCF\x97%\xE0Q\x06\xCE)\xDF\x92\xBD\x06Z\xC2\x80\x94\xE3V%*\x18\xE1\xF4\xFA\xBD\x14MCjZ\xB2(\x91\x19\x8A\xB1\x34\xD3\x45\xC4\x1F\x39Q\xCB`\x0F\x9C\x81J\x0F\x86%\xA2\xEA>\x04\x7F\x94\x9F\xC7\xD2\xD9`\xEB\x30\xE7\xCDp\xBC\xD5\xD7\xDD!j|\xC1T\xE1 NB;A\xF7\xA2\x9C\xA6!\xDF\xB5\x9D\x64\x86\xD8\xFD\xD1\x99\xA3\xD0\\Q\xE1|\r\x18\xD9;\xE0\x95\xD8h\xF0\xC2V\xD7\\\x01\x91\xBEg\xC6\x44\x97U\xF8s/\xF7\x8C\xF4y\xDA\xC3\x38$\x8Fr\x86\x9D\xB4u\xAF\x0Et\xEC\xDD\xB0\"~x\x8F\x9B\x7F\xABl\x05\xAC\"\xA0\t\xCEL+\xDD\xB1V!\xAF\xFA\xD3\x03\xFB\xC2g\xEB\xA8\xDB\xF8\x16r\xB1\x41\xD9\x14\x06O\\O\xEB\x92\xF4\x39\xB1\x18s\x9B\x41#Q\xC3\x66\xCC\xA6\x33\xD4n\x12\v",á.
size
-oldSize))

218 
íd
;

219 
≠≥nd
.
ôem
 = 
	`°rdup
("\f\x8F[w\xD4\xAE\xBC\x1Dn\xF7\xE0jD\xA4p\x0E\n<\x9C\xF0Z\xC1I\x86~\xD1G\xB3\x01\xA6\x86)q1\x12\xD5\x08\x0E\x08\x7F+/pp\x14\xF0\xCF\x97%\xE0Q\x06\xCE)\xDF\x92\xBD\x06Z\xC2\x80\x94\xE3V%*\x18\xE1\xF4\xFA\xBD\x14MCjZ\xB2(\x91\x19\x8A\xB1\x34\xD3\x45\xC4\x1F\x39Q\xCB`\x0F\x9C\x81J\x0F\x86%\xA2\xEA>\x04\x7F\x94\x9F\xC7\xD2\xD9`\xEB\x30\xE7\xCDp\xBC\xD5\xD7\xDD!j|\xC1T\xE1 NB;A\xF7\xA2\x9C\xA6!\xDF\xB5\x9D\x64\x86\xD8\xFD\xD1\x99\xA3\xD0\\Q\xE1|\r\x18\xD9;\xE0\x95\xD8h\xF0\xC2V\xD7\\\x01\x91\xBEg\xC6\x44\x97U\xF8s/\xF7\x8C\xF4y\xDA\xC3\x38$\x8Fr\x86\x9D\xB4u\xAF\x0Et\xEC\xDD\xB0\"~x\x8F\x9B\x7F\xABl\x05\xAC\"\xA0\t\xCEL+\xDD\xB1V!\xAF\xFA\xD3\x03\xFB\xC2g\xEB\xA8\xDB\xF8\x16r\xB1\x41\xD9\x14\x06O\\O\xEB\x92\xF4\x39\xB1\x18s\x9B\x41#Q\xC3\x66\xCC\xA6\x33\xD4n\x12\v");

220 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

221 
ã°sPas£d
++;

224 
≠≥nd
.
size
 = ("\xE1\xAF\x8F\xA8\xDBXq\xF3Mv\xEDK\xA6\xE3\xBCh\xFDq\xFC\xC5\xE0\x99\x41\xCD\xF8\fx\x98 +d}\x8B\xF8\xA0\xAA\x01\x86\xAD\xAB\f \x81\x63*\xF3)\xAE\x8Eu]\xC0j\"c\xA0W\xC0`\x1F\x44\xB7\x96R\x05+\xF9\x98\x87z\xFB/83\xC4P\xADnV?\xF2Y\x05\xC3\x42\xE3\xEA\x84\xEB\xF3).\xEE\xC7&>\x14&rr\xC8\x41\x04*\x95\x32\x63q\x13\xEC*\x9C\x1A\x15\xF4\xB2\xEA\xF5m\xA3wp\xD1NR\x8D\xF4z\x93\xC8\x38{\x93\x43\xE8\xA6( \xF8\xEA\x45\x18\xE2\xAF\xE7\x08\x66\xEE\x12.\xBD\xF3\xBEg\x9D\xDB\xFF`\xAF\x64\x0EQ\xAD~%8\xB2\xFDHd\xAD\x65\x9A\x10O\xAA\xD8|\xA4\xD4\xFE\x81\xE7\xE3\xFA\x96u\x9B\x0F\xA8x\xC2\x10&\xCC\xB4\xB5\x1C|n\x06P\x03\x94i\xF6}\xCB\xA5\xE7\x95+\xD6\xB1\x43\x06\xDDH\xAFL\xB8\x31=\x1A\xBD\xA4\x89\xCE\x12\xB4\x08\xECr\xBA\x36\xF4\x44-dff]\x9A\xE4-\xC7\x17\x1E\xB4\xAA\xBE\xBB\xDD\x65G\x92\"`\xBB\x9B\xBD\x18\x16\x9E\x41\x35\xD7Vj\xB0\xF9\xC1\xB2\xBF)\xCAW\xCBT,0\x03\x44\xD8\xF4\xF3\x81\xEC\xBC\x61\x16\xD1#\xC3$\x89KW\xFF\x9E\xD9%@H8%\xAE\x8A\x1CS\xEB\xE1<6\x07P\xEC\x62\xF0\v\xC6\xD7\x93yW\xB5\xF2\xF4\x66\xAA\xA3Q\x9A\n\xD0\x85X\xFF:\x9A%P*\x0E\x80-S\x1Cx\xFE\xE1\x85\xC3\xC7\xF3z\xE0\x18\x63\xF7&\xA5\x99U\xAF\x95Kz:qd\x8A\xC2\xAB\xBAm\xF5\x91\x39\xA1G\xC6L\xDA\xB9\x33\xBB\xC7\x11\xEA\x31\xB9\xEEG\xBB\x81\x36\xB7L\xBB\xDC`\x04\x30x(\xB0\x7F!b4\xC6\xAE\xA8\xEE\xA1\xBB\x37:\xA8k<\xF7\xE9\xEB\xC7\xAF\x62\x31\xCDJ\xE6\xAB\xC3%2\xD9\x0F.\xB8\\\xE0\xB7\x91\x36\xBE\x95[\"\xA4\f\xAD\x96k\x14\xDD]\xE4\xD8\xC5\x87q\xF0\xE5\x02\xAA\xC1{6&\x1C\xB2\xD0]\x1F\xBA\xA1\xE4#N\t\x94\xAE\xBBZ\xF1\xD5\xE8\xCA\x43\xE6\x8A\xA7\xFEl\x81=v\xC5\x06\x8C")-1;

225 
ﬁdSize
 = 
a
.
size
;

226 
	`d¨øy_≠≥nd_lô
(
a
, "\xE1\xAF\x8F\xA8\xDBXq\xF3Mv\xEDK\xA6\xE3\xBCh\xFDq\xFC\xC5\xE0\x99\x41\xCD\xF8\fx\x98 +d}\x8B\xF8\xA0\xAA\x01\x86\xAD\xAB\f \x81\x63*\xF3)\xAE\x8Eu]\xC0j\"c\xA0W\xC0`\x1F\x44\xB7\x96R\x05+\xF9\x98\x87z\xFB/83\xC4P\xADnV?\xF2Y\x05\xC3\x42\xE3\xEA\x84\xEB\xF3).\xEE\xC7&>\x14&rr\xC8\x41\x04*\x95\x32\x63q\x13\xEC*\x9C\x1A\x15\xF4\xB2\xEA\xF5m\xA3wp\xD1NR\x8D\xF4z\x93\xC8\x38{\x93\x43\xE8\xA6( \xF8\xEA\x45\x18\xE2\xAF\xE7\x08\x66\xEE\x12.\xBD\xF3\xBEg\x9D\xDB\xFF`\xAF\x64\x0EQ\xAD~%8\xB2\xFDHd\xAD\x65\x9A\x10O\xAA\xD8|\xA4\xD4\xFE\x81\xE7\xE3\xFA\x96u\x9B\x0F\xA8x\xC2\x10&\xCC\xB4\xB5\x1C|n\x06P\x03\x94i\xF6}\xCB\xA5\xE7\x95+\xD6\xB1\x43\x06\xDDH\xAFL\xB8\x31=\x1A\xBD\xA4\x89\xCE\x12\xB4\x08\xECr\xBA\x36\xF4\x44-dff]\x9A\xE4-\xC7\x17\x1E\xB4\xAA\xBE\xBB\xDD\x65G\x92\"`\xBB\x9B\xBD\x18\x16\x9E\x41\x35\xD7Vj\xB0\xF9\xC1\xB2\xBF)\xCAW\xCBT,0\x03\x44\xD8\xF4\xF3\x81\xEC\xBC\x61\x16\xD1#\xC3$\x89KW\xFF\x9E\xD9%@H8%\xAE\x8A\x1CS\xEB\xE1<6\x07P\xEC\x62\xF0\v\xC6\xD7\x93yW\xB5\xF2\xF4\x66\xAA\xA3Q\x9A\n\xD0\x85X\xFF:\x9A%P*\x0E\x80-S\x1Cx\xFE\xE1\x85\xC3\xC7\xF3z\xE0\x18\x63\xF7&\xA5\x99U\xAF\x95Kz:qd\x8A\xC2\xAB\xBAm\xF5\x91\x39\xA1G\xC6L\xDA\xB9\x33\xBB\xC7\x11\xEA\x31\xB9\xEEG\xBB\x81\x36\xB7L\xBB\xDC`\x04\x30x(\xB0\x7F!b4\xC6\xAE\xA8\xEE\xA1\xBB\x37:\xA8k<\xF7\xE9\xEB\xC7\xAF\x62\x31\xCDJ\xE6\xAB\xC3%2\xD9\x0F.\xB8\\\xE0\xB7\x91\x36\xBE\x95[\"\xA4\f\xAD\x96k\x14\xDD]\xE4\xD8\xC5\x87q\xF0\xE5\x02\xAA\xC1{6&\x1C\xB2\xD0]\x1F\xBA\xA1\xE4#N\t\x94\xAE\xBBZ\xF1\xD5\xE8\xCA\x43\xE6\x8A\xA7\xFEl\x81=v\xC5\x06\x8C");

227 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

228 
íd
;

229 i‡(
a
.
size
 >á.
Æloc
)

230 
íd
;

231 i‡(
a
.
ôem
[a.
size
])

232 
íd
;

233 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\xE1\xAF\x8F\xA8\xDBXq\xF3Mv\xEDK\xA6\xE3\xBCh\xFDq\xFC\xC5\xE0\x99\x41\xCD\xF8\fx\x98 +d}\x8B\xF8\xA0\xAA\x01\x86\xAD\xAB\‡\x81\x63*\xF3)\xAE\x8Eu]\xC0j\"c\xA0W\xC0`\x1F\x44\xB7\x96R\x05+\xF9\x98\x87z\xFB/83\xC4P\xADnV?\xF2Y\x05\xC3\x42\xE3\xEA\x84\xEB\xF3).\xEE\xC7&>\x14&º\xC8\x41\x04*\x95\x32\x63q\x13\xEC*\x9C\x1A\x15\xF4\xB2\xEA\xF5m\xA3wp\xD1NR\x8D\xF4z\x93\xC8\x38{\x93\x43\xE8\xA6–\xF8\xEA\x45\x18\xE2\xAF\xE7\x08\x66\xEE\x12.\xBD\xF3\xBEg\x9D\xDB\xFF`\xAF\x64\x0EQ\xAD~%8\xB2\xFDHd\xAD\x65\x9A\x10O\xAA\xD8|\xA4\xD4\xFE\x81\xE7\xE3\xFA\x96u\x9B\x0F\xA8x\xC2\x10&\xCC\xB4\xB5\x1C|n\x06P\x03\x94i\xF6}\xCB\xA5\xE7\x95+\xD6\xB1\x43\x06\xDDH\xAFL\xB8\x31=\x1A\xBD\xA4\x89\xCE\x12\xB4\x08\xECr\xBA\x36\xF4\x44-dff]\x9A\xE4-\xC7\x17\x1E\xB4\xAA\xBE\xBB\xDD\x65G\x92\"`\xBB\x9B\xBD\x18\x16\x9E\x41\x35\xD7Vj\xB0\xF9\xC1\xB2\xBF)\xCAW\xCBT,0\x03\x44\xD8\xF4\xF3\x81\xEC\xBC\x61\x16\xD1#\xC3$\x89KW\xFF\x9E\xD9%@H8%\xAE\x8A\x1CS\xEB\xE1<6\x07P\xEC\x62\xF0\v\xC6\xD7\x93yW\xB5\xF2\xF4\x66\xAA\xA3Q\x9A\n\xD0\x85X\xFF:\x9A%P*\x0E\x80-S\x1Cx\xFE\xE1\x85\xC3\xC7\xF3z\xE0\x18\x63\xF7&\xA5\x99U\xAF\x95Kz:qd\x8A\xC2\xAB\xBAm\xF5\x91\x39\xA1G\xC6L\xDA\xB9\x33\xBB\xC7\x11\xEA\x31\xB9\xEEG\xBB\x81\x36\xB7L\xBB\xDC`\x04\x30x(\xB0\x7F!b4\xC6\xAE\xA8\xEE\xA1\xBB\x37:\xA8k<\xF7\xE9\xEB\xC7\xAF\x62\x31\xCDJ\xE6\xAB\xC3%2\xD9\x0F.\xB8\\\xE0\xB7\x91\x36\xBE\x95[\"\xA4\f\xAD\x96k\x14\xDD]\xE4\xD8\xC5\x87q\xF0\xE5\x02\xAA\xC1{6&\x1C\xB2\xD0]\x1F\xBA\xA1\xE4#N\t\x94\xAE\xBBZ\xF1\xD5\xE8\xCA\x43\xE6\x8A\xA7\xFEl\x81=v\xC5\x06\x8C",á.
size
-oldSize))

234 
íd
;

235 
≠≥nd
.
ôem
 = 
	`°rdup
("\xE1\xAF\x8F\xA8\xDBXq\xF3Mv\xEDK\xA6\xE3\xBCh\xFDq\xFC\xC5\xE0\x99\x41\xCD\xF8\fx\x98 +d}\x8B\xF8\xA0\xAA\x01\x86\xAD\xAB\f \x81\x63*\xF3)\xAE\x8Eu]\xC0j\"c\xA0W\xC0`\x1F\x44\xB7\x96R\x05+\xF9\x98\x87z\xFB/83\xC4P\xADnV?\xF2Y\x05\xC3\x42\xE3\xEA\x84\xEB\xF3).\xEE\xC7&>\x14&rr\xC8\x41\x04*\x95\x32\x63q\x13\xEC*\x9C\x1A\x15\xF4\xB2\xEA\xF5m\xA3wp\xD1NR\x8D\xF4z\x93\xC8\x38{\x93\x43\xE8\xA6( \xF8\xEA\x45\x18\xE2\xAF\xE7\x08\x66\xEE\x12.\xBD\xF3\xBEg\x9D\xDB\xFF`\xAF\x64\x0EQ\xAD~%8\xB2\xFDHd\xAD\x65\x9A\x10O\xAA\xD8|\xA4\xD4\xFE\x81\xE7\xE3\xFA\x96u\x9B\x0F\xA8x\xC2\x10&\xCC\xB4\xB5\x1C|n\x06P\x03\x94i\xF6}\xCB\xA5\xE7\x95+\xD6\xB1\x43\x06\xDDH\xAFL\xB8\x31=\x1A\xBD\xA4\x89\xCE\x12\xB4\x08\xECr\xBA\x36\xF4\x44-dff]\x9A\xE4-\xC7\x17\x1E\xB4\xAA\xBE\xBB\xDD\x65G\x92\"`\xBB\x9B\xBD\x18\x16\x9E\x41\x35\xD7Vj\xB0\xF9\xC1\xB2\xBF)\xCAW\xCBT,0\x03\x44\xD8\xF4\xF3\x81\xEC\xBC\x61\x16\xD1#\xC3$\x89KW\xFF\x9E\xD9%@H8%\xAE\x8A\x1CS\xEB\xE1<6\x07P\xEC\x62\xF0\v\xC6\xD7\x93yW\xB5\xF2\xF4\x66\xAA\xA3Q\x9A\n\xD0\x85X\xFF:\x9A%P*\x0E\x80-S\x1Cx\xFE\xE1\x85\xC3\xC7\xF3z\xE0\x18\x63\xF7&\xA5\x99U\xAF\x95Kz:qd\x8A\xC2\xAB\xBAm\xF5\x91\x39\xA1G\xC6L\xDA\xB9\x33\xBB\xC7\x11\xEA\x31\xB9\xEEG\xBB\x81\x36\xB7L\xBB\xDC`\x04\x30x(\xB0\x7F!b4\xC6\xAE\xA8\xEE\xA1\xBB\x37:\xA8k<\xF7\xE9\xEB\xC7\xAF\x62\x31\xCDJ\xE6\xAB\xC3%2\xD9\x0F.\xB8\\\xE0\xB7\x91\x36\xBE\x95[\"\xA4\f\xAD\x96k\x14\xDD]\xE4\xD8\xC5\x87q\xF0\xE5\x02\xAA\xC1{6&\x1C\xB2\xD0]\x1F\xBA\xA1\xE4#N\t\x94\xAE\xBBZ\xF1\xD5\xE8\xCA\x43\xE6\x8A\xA7\xFEl\x81=v\xC5\x06\x8C");

236 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

237 
ã°sPas£d
++;

240 
≠≥nd
.
size
 = ("y\xC8}P\x83\xD3\xD3>\xC4\xED\x84o\x92\xC0\x33\x34\x87_\x8Cm\x91(Z;+\xC9\xBF\xD4\xCF\x90L \xBB\xA6\xE0Y\xF7\\3%\xDC\x63\x1A\xF0/}\xE0\xDE\xCF\xD0\x31\xEA\xF1|F\xA8\x94\xCDp\xEF@\xAEi\x95\xCA\x45\xC4\x8F\xA4\x65\xE7\xFD*\x90\xEC\xA8\xA6\xFF\x96N\xDF\xEBG\xE8\n^\x9C\xFD\x37\x1F\x43T\x08\xBA\x37H\f\xDC\x99\xAAQ,\x96z\x97=3ib4*u\xFE\x98\xFB\f\xE7jqL\xE5\xAD\x30\x19\xB8*\x94\xC0\x03\x46\x01\x8C\xCD>\xFE\xBEL\xBB[>;\x15\xD4\xDC\xE2\xC0\x1E\xC7\xF2\x96IOPt.\xB1\x63\xC4\xDE\xC1\vL\xE0\x9A\xBA\x99\n\xF5i\xB6{L\xA6\t\xFF\x1B\x64N\xF4\xDD\xDD\xFDG]\x8Dk\xAF\x0E\xB5\x38\x39:\xA2l\xA6tHN\xC6\xC9\x01{r:h\xD0\xA3\x62\x05\xD0~o\xBB")-1;

241 
ﬁdSize
 = 
a
.
size
;

242 
	`d¨øy_≠≥nd_lô
(
a
, "y\xC8}P\x83\xD3\xD3>\xC4\xED\x84o\x92\xC0\x33\x34\x87_\x8Cm\x91(Z;+\xC9\xBF\xD4\xCF\x90L \xBB\xA6\xE0Y\xF7\\3%\xDC\x63\x1A\xF0/}\xE0\xDE\xCF\xD0\x31\xEA\xF1|F\xA8\x94\xCDp\xEF@\xAEi\x95\xCA\x45\xC4\x8F\xA4\x65\xE7\xFD*\x90\xEC\xA8\xA6\xFF\x96N\xDF\xEBG\xE8\n^\x9C\xFD\x37\x1F\x43T\x08\xBA\x37H\f\xDC\x99\xAAQ,\x96z\x97=3ib4*u\xFE\x98\xFB\f\xE7jqL\xE5\xAD\x30\x19\xB8*\x94\xC0\x03\x46\x01\x8C\xCD>\xFE\xBEL\xBB[>;\x15\xD4\xDC\xE2\xC0\x1E\xC7\xF2\x96IOPt.\xB1\x63\xC4\xDE\xC1\vL\xE0\x9A\xBA\x99\n\xF5i\xB6{L\xA6\t\xFF\x1B\x64N\xF4\xDD\xDD\xFDG]\x8Dk\xAF\x0E\xB5\x38\x39:\xA2l\xA6tHN\xC6\xC9\x01{r:h\xD0\xA3\x62\x05\xD0~o\xBB");

243 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

244 
íd
;

245 i‡(
a
.
size
 >á.
Æloc
)

246 
íd
;

247 i‡(
a
.
ôem
[a.
size
])

248 
íd
;

249 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "y\xC8}P\x83\xD3\xD3>\xC4\xED\x84o\x92\xC0\x33\x34\x87_\x8Cm\x91(Z;+\xC9\xBF\xD4\xCF\x90L \xBB\xA6\xE0Y\xF7\\3%\xDC\x63\x1A\xF0/}\xE0\xDE\xCF\xD0\x31\xEA\xF1|F\xA8\x94\xCDp\xEF@\xAEi\x95\xCA\x45\xC4\x8F\xA4\x65\xE7\xFD*\x90\xEC\xA8\xA6\xFF\x96N\xDF\xEBG\xE8\n^\x9C\xFD\x37\x1F\x43T\x08\xBA\x37H\f\xDC\x99\xAAQ,\x96z\x97=3ib4*u\xFE\x98\xFB\f\xE7jqL\xE5\xAD\x30\x19\xB8*\x94\xC0\x03\x46\x01\x8C\xCD>\xFE\xBEL\xBB[>;\x15\xD4\xDC\xE2\xC0\x1E\xC7\xF2\x96IOPt.\xB1\x63\xC4\xDE\xC1\vL\xE0\x9A\xBA\x99\n\xF5i\xB6{L\xA6\t\xFF\x1B\x64N\xF4\xDD\xDD\xFDG]\x8Dk\xAF\x0E\xB5\x38\x39:\xA2l\xA6tHN\xC6\xC9\x01{r:h\xD0\xA3\x62\x05\xD0~o\xBB",á.
size
-oldSize))

250 
íd
;

251 
≠≥nd
.
ôem
 = 
	`°rdup
("y\xC8}P\x83\xD3\xD3>\xC4\xED\x84o\x92\xC0\x33\x34\x87_\x8Cm\x91(Z;+\xC9\xBF\xD4\xCF\x90L \xBB\xA6\xE0Y\xF7\\3%\xDC\x63\x1A\xF0/}\xE0\xDE\xCF\xD0\x31\xEA\xF1|F\xA8\x94\xCDp\xEF@\xAEi\x95\xCA\x45\xC4\x8F\xA4\x65\xE7\xFD*\x90\xEC\xA8\xA6\xFF\x96N\xDF\xEBG\xE8\n^\x9C\xFD\x37\x1F\x43T\x08\xBA\x37H\f\xDC\x99\xAAQ,\x96z\x97=3ib4*u\xFE\x98\xFB\f\xE7jqL\xE5\xAD\x30\x19\xB8*\x94\xC0\x03\x46\x01\x8C\xCD>\xFE\xBEL\xBB[>;\x15\xD4\xDC\xE2\xC0\x1E\xC7\xF2\x96IOPt.\xB1\x63\xC4\xDE\xC1\vL\xE0\x9A\xBA\x99\n\xF5i\xB6{L\xA6\t\xFF\x1B\x64N\xF4\xDD\xDD\xFDG]\x8Dk\xAF\x0E\xB5\x38\x39:\xA2l\xA6tHN\xC6\xC9\x01{r:h\xD0\xA3\x62\x05\xD0~o\xBB");

252 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

253 
ã°sPas£d
++;

256 
≠≥nd
.
size
 = ("\x93\x8A\x19^\x10\\\xD9\x8D\x9D\x7F\xCA\x8F\x1B\x85\x42\x1F\xCFG\xBD\x63M\x81\x44\xA3\xA9\x8F\xCA_\x80)\xBBqjo\xCD\x01\x8A\x17\xA4\x07:[\xFF+X\xEB\x19\xAC\xA2\xAB\xC7\xC8\x65H?\xE7\xE2H\xF0$\x01\x08\vrR\x1AI\xE0&\xBF~\xD1\x9AUDZX8<\x92\x64\x9CP\v\xBE(\xD7\n\v\x99\xEC\x18\x93\x36V\x01\f\xA7M\xA3 \xD8\x98%\"\xCA\xBD\x63\xA8\x8Bg\x13\x8A>f'\"w\xD4\xF6U\xA8Jy\x07\x85v5\xA2\t\x94\x17W\x96\xE2<RSl-\xB1\x87L\xBC\xFD\xC5i`s\x81\x06\xB9\n\xE8\xD6\x64\xEE\xFA\xC2\x8A\x32n\x9B\x90.\xC9G\xAEW\xEAv.\"\x9D&\x91 \xDF\xC4y\xC3\x42\x97\xB8\xAAV\xAC+\x8A\xF9{\x82\xD5\xD7\xDC q\x80\xB0\xB1na\x85\x42\xF2\x32\xAD\x32\x41\x90V\xFF\xA5\x10\x66\x0E,C\x87\xD4\x8C\x84\xF0uD[\x03\x13\xB2\xE5J\xB6\x8B\x99\xB9\xF4\x8A\x1B\xF7\x85")-1;

257 
ﬁdSize
 = 
a
.
size
;

258 
	`d¨øy_≠≥nd_lô
(
a
, "\x93\x8A\x19^\x10\\\xD9\x8D\x9D\x7F\xCA\x8F\x1B\x85\x42\x1F\xCFG\xBD\x63M\x81\x44\xA3\xA9\x8F\xCA_\x80)\xBBqjo\xCD\x01\x8A\x17\xA4\x07:[\xFF+X\xEB\x19\xAC\xA2\xAB\xC7\xC8\x65H?\xE7\xE2H\xF0$\x01\x08\vrR\x1AI\xE0&\xBF~\xD1\x9AUDZX8<\x92\x64\x9CP\v\xBE(\xD7\n\v\x99\xEC\x18\x93\x36V\x01\f\xA7M\xA3 \xD8\x98%\"\xCA\xBD\x63\xA8\x8Bg\x13\x8A>f'\"w\xD4\xF6U\xA8Jy\x07\x85v5\xA2\t\x94\x17W\x96\xE2<RSl-\xB1\x87L\xBC\xFD\xC5i`s\x81\x06\xB9\n\xE8\xD6\x64\xEE\xFA\xC2\x8A\x32n\x9B\x90.\xC9G\xAEW\xEAv.\"\x9D&\x91 \xDF\xC4y\xC3\x42\x97\xB8\xAAV\xAC+\x8A\xF9{\x82\xD5\xD7\xDC q\x80\xB0\xB1na\x85\x42\xF2\x32\xAD\x32\x41\x90V\xFF\xA5\x10\x66\x0E,C\x87\xD4\x8C\x84\xF0uD[\x03\x13\xB2\xE5J\xB6\x8B\x99\xB9\xF4\x8A\x1B\xF7\x85");

259 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

260 
íd
;

261 i‡(
a
.
size
 >á.
Æloc
)

262 
íd
;

263 i‡(
a
.
ôem
[a.
size
])

264 
íd
;

265 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\x93\x8A\x19^\x10\\\xD9\x8D\x9D\x7F\xCA\x8F\x1B\x85\x42\x1F\xCFG\xBD\x63M\x81\x44\xA3\xA9\x8F\xCA_\x80)\xBBqjo\xCD\x01\x8A\x17\xA4\x07:[\xFF+X\xEB\x19\xAC\xA2\xAB\xC7\xC8\x65H?\xE7\xE2H\xF0$\x01\x08\vrR\x1AI\xE0&\xBF~\xD1\x9AUDZX8<\x92\x64\x9CP\v\xBE(\xD7\n\v\x99\xEC\x18\x93\x36V\x01\f\xA7M\xA3 \xD8\x98%\"\xCA\xBD\x63\xA8\x8Bg\x13\x8A>f'\"w\xD4\xF6U\xA8Jy\x07\x85v5\xA2\t\x94\x17W\x96\xE2<RSl-\xB1\x87L\xBC\xFD\xC5i`s\x81\x06\xB9\n\xE8\xD6\x64\xEE\xFA\xC2\x8A\x32n\x9B\x90.\xC9G\xAEW\xEAv.\"\x9D&\x91 \xDF\xC4y\xC3\x42\x97\xB8\xAAV\xAC+\x8A\xF9{\x82\xD5\xD7\xDC q\x80\xB0\xB1«\x85\x42\xF2\x32\xAD\x32\x41\x90V\xFF\xA5\x10\x66\x0E,C\x87\xD4\x8C\x84\xF0uD[\x03\x13\xB2\xE5J\xB6\x8B\x99\xB9\xF4\x8A\x1B\xF7\x85",á.
size
-oldSize))

266 
íd
;

267 
≠≥nd
.
ôem
 = 
	`°rdup
("\x93\x8A\x19^\x10\\\xD9\x8D\x9D\x7F\xCA\x8F\x1B\x85\x42\x1F\xCFG\xBD\x63M\x81\x44\xA3\xA9\x8F\xCA_\x80)\xBBqjo\xCD\x01\x8A\x17\xA4\x07:[\xFF+X\xEB\x19\xAC\xA2\xAB\xC7\xC8\x65H?\xE7\xE2H\xF0$\x01\x08\vrR\x1AI\xE0&\xBF~\xD1\x9AUDZX8<\x92\x64\x9CP\v\xBE(\xD7\n\v\x99\xEC\x18\x93\x36V\x01\f\xA7M\xA3 \xD8\x98%\"\xCA\xBD\x63\xA8\x8Bg\x13\x8A>f'\"w\xD4\xF6U\xA8Jy\x07\x85v5\xA2\t\x94\x17W\x96\xE2<RSl-\xB1\x87L\xBC\xFD\xC5i`s\x81\x06\xB9\n\xE8\xD6\x64\xEE\xFA\xC2\x8A\x32n\x9B\x90.\xC9G\xAEW\xEAv.\"\x9D&\x91 \xDF\xC4y\xC3\x42\x97\xB8\xAAV\xAC+\x8A\xF9{\x82\xD5\xD7\xDC q\x80\xB0\xB1na\x85\x42\xF2\x32\xAD\x32\x41\x90V\xFF\xA5\x10\x66\x0E,C\x87\xD4\x8C\x84\xF0uD[\x03\x13\xB2\xE5J\xB6\x8B\x99\xB9\xF4\x8A\x1B\xF7\x85");

268 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

269 
ã°sPas£d
++;

272 
≠≥nd
.
size
 = ("\xF5\x08$:\xCC\xD7\x8A\xB8%\xF4P6\x18")-1;

273 
ﬁdSize
 = 
a
.
size
;

274 
	`d¨øy_≠≥nd_lô
(
a
, "\xF5\x08$:\xCC\xD7\x8A\xB8%\xF4P6\x18");

275 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

276 
íd
;

277 i‡(
a
.
size
 >á.
Æloc
)

278 
íd
;

279 i‡(
a
.
ôem
[a.
size
])

280 
íd
;

281 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\xF5\x08$:\xCC\xD7\x8A\xB8%\xF4P6\x18",á.
size
-oldSize))

282 
íd
;

283 
≠≥nd
.
ôem
 = 
	`°rdup
("\xF5\x08$:\xCC\xD7\x8A\xB8%\xF4P6\x18");

284 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

285 
ã°sPas£d
++;

288 
≠≥nd
.
size
 = ("2\x9A\x86\x94H\xA8\xD4\x8F\xE4\xD5\x10\xB3\xC3~\xF7\xB5g:n(\xA7x\xFD\xB7\xD5{\xED\xD7\xDDZ\xA2\x81\xD7\xD1m\x8E\xD3\x07\xA5\x9C\xFCl$4\xC1k\xE2X\xCF\x84\xB2\xEB];p\x9A)\x02q\xC1\x1E\xB6\vKud\xE7ttR\xB8@\x1C\xF9\xB6\xCE>s\xF9\x9F\x07\x99O\xAD\xB1\x7F\xC2I7\xA3O\x9D^-\xD9\xDE\xE0\x9CqY\\:0[\xD8\x95\x82.\xCE\xD1>\x06KQ\r_\xCEmy\xA9\xACv\xE8\x35\x8BWy\xBD_\x16\x33\\\xC8\xE1p\xFBIm\xCBvP\x11U\x94\x88(\xC1\xAD\xCC\x90\x03\xB2\xCEU\xDC\t]\xF7\x89\x90z\xE2\xB8\x17\xE7\xB4\xCD\xC4\x65\xC2\xCC\x36[Y\x95\xA1\x82\xB6\x07_o\xD7\x31\xE0\xC8p\x92\xFA\x31\xCD\xD5\xC6\xA9\xEA\xCF\x85\x96)\xF6\x15N\xB0xh\xA1_\xFC\xEB\t\x86Zc\xFA\xCD\xB9\xB7\t\xE8\x42P\x10<Y\xD5\x30\xE7\n\xE0i\x0F\x9Ew\xF2@\xF5\x17\xC1mp\x9E\xA6\xE6+\x14\x98\x8C\x1E\xBCL\xFC\x17\x89nW\xE8\x9E\xBE\x9El\xEB\x88\xD0\xD1\xD4\x94Gt\v\r\x0F\xDC\xBAZ J8\xC7\xF4\x9A\x81\xC3=\xC8\x8C\x18\xC5\xE8{Y\xBA\xCB>\xD9\x35\x90\xEF\xB2\x99\xC0\x0F\xBE\xCF\xB0\x65\xC4\x99L)e\x99\x86-\xDBVJ\xA6\xCA\t\xA2m\xF9\xD9H\xF7\x04\x1C \x9C\xD2\x05 K\x1C\xA3,\x96\x61jH\xC0\xC3\xEC\xB3\n*\xDA\xFD\xDF\n\x9B\xB6\xF4yDzs")-1;

289 
ﬁdSize
 = 
a
.
size
;

290 
	`d¨øy_≠≥nd_lô
(
a
, "2\x9A\x86\x94H\xA8\xD4\x8F\xE4\xD5\x10\xB3\xC3~\xF7\xB5g:n(\xA7x\xFD\xB7\xD5{\xED\xD7\xDDZ\xA2\x81\xD7\xD1m\x8E\xD3\x07\xA5\x9C\xFCl$4\xC1k\xE2X\xCF\x84\xB2\xEB];p\x9A)\x02q\xC1\x1E\xB6\vKud\xE7ttR\xB8@\x1C\xF9\xB6\xCE>s\xF9\x9F\x07\x99O\xAD\xB1\x7F\xC2I7\xA3O\x9D^-\xD9\xDE\xE0\x9CqY\\:0[\xD8\x95\x82.\xCE\xD1>\x06KQ\r_\xCEmy\xA9\xACv\xE8\x35\x8BWy\xBD_\x16\x33\\\xC8\xE1p\xFBIm\xCBvP\x11U\x94\x88(\xC1\xAD\xCC\x90\x03\xB2\xCEU\xDC\t]\xF7\x89\x90z\xE2\xB8\x17\xE7\xB4\xCD\xC4\x65\xC2\xCC\x36[Y\x95\xA1\x82\xB6\x07_o\xD7\x31\xE0\xC8p\x92\xFA\x31\xCD\xD5\xC6\xA9\xEA\xCF\x85\x96)\xF6\x15N\xB0xh\xA1_\xFC\xEB\t\x86Zc\xFA\xCD\xB9\xB7\t\xE8\x42P\x10<Y\xD5\x30\xE7\n\xE0i\x0F\x9Ew\xF2@\xF5\x17\xC1mp\x9E\xA6\xE6+\x14\x98\x8C\x1E\xBCL\xFC\x17\x89nW\xE8\x9E\xBE\x9El\xEB\x88\xD0\xD1\xD4\x94Gt\v\r\x0F\xDC\xBAZ J8\xC7\xF4\x9A\x81\xC3=\xC8\x8C\x18\xC5\xE8{Y\xBA\xCB>\xD9\x35\x90\xEF\xB2\x99\xC0\x0F\xBE\xCF\xB0\x65\xC4\x99L)e\x99\x86-\xDBVJ\xA6\xCA\t\xA2m\xF9\xD9H\xF7\x04\x1C \x9C\xD2\x05 K\x1C\xA3,\x96\x61jH\xC0\xC3\xEC\xB3\n*\xDA\xFD\xDF\n\x9B\xB6\xF4yDzs");

291 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

292 
íd
;

293 i‡(
a
.
size
 >á.
Æloc
)

294 
íd
;

295 i‡(
a
.
ôem
[a.
size
])

296 
íd
;

297 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "2\x9A\x86\x94H\xA8\xD4\x8F\xE4\xD5\x10\xB3\xC3~\xF7\xB5g:n(\xA7x\xFD\xB7\xD5{\xED\xD7\xDDZ\xA2\x81\xD7\xD1m\x8E\xD3\x07\xA5\x9C\xFCl$4\xC1k\xE2X\xCF\x84\xB2\xEB];p\x9A)\x02q\xC1\x1E\xB6\vKud\xE7âR\xB8@\x1C\xF9\xB6\xCE>s\xF9\x9F\x07\x99O\xAD\xB1\x7F\xC2I7\xA3O\x9D^-\xD9\xDE\xE0\x9CqY\\:0[\xD8\x95\x82.\xCE\xD1>\x06KQ\r_\xCEmy\xA9\xACv\xE8\x35\x8BWy\xBD_\x16\x33\\\xC8\xE1p\xFBIm\xCBvP\x11U\x94\x88(\xC1\xAD\xCC\x90\x03\xB2\xCEU\xDC\t]\xF7\x89\x90z\xE2\xB8\x17\xE7\xB4\xCD\xC4\x65\xC2\xCC\x36[Y\x95\xA1\x82\xB6\x07_o\xD7\x31\xE0\xC8p\x92\xFA\x31\xCD\xD5\xC6\xA9\xEA\xCF\x85\x96)\xF6\x15N\xB0xh\xA1_\xFC\xEB\t\x86Zc\xFA\xCD\xB9\xB7\t\xE8\x42P\x10<Y\xD5\x30\xE7\n\xE0i\x0F\x9Ew\xF2@\xF5\x17\xC1mp\x9E\xA6\xE6+\x14\x98\x8C\x1E\xBCL\xFC\x17\x89nW\xE8\x9E\xBE\x9El\xEB\x88\xD0\xD1\xD4\x94Gt\v\r\x0F\xDC\xBAZ J8\xC7\xF4\x9A\x81\xC3=\xC8\x8C\x18\xC5\xE8{Y\xBA\xCB>\xD9\x35\x90\xEF\xB2\x99\xC0\x0F\xBE\xCF\xB0\x65\xC4\x99LÎ\x99\x86-\xDBVJ\xA6\xCA\t\xA2m\xF9\xD9H\xF7\x04\x1C \x9C\xD2\x05 K\x1C\xA3,\x96\x61jH\xC0\xC3\xEC\xB3\n*\xDA\xFD\xDF\n\x9B\xB6\xF4yDzs",á.
size
-oldSize))

298 
íd
;

299 
≠≥nd
.
ôem
 = 
	`°rdup
("2\x9A\x86\x94H\xA8\xD4\x8F\xE4\xD5\x10\xB3\xC3~\xF7\xB5g:n(\xA7x\xFD\xB7\xD5{\xED\xD7\xDDZ\xA2\x81\xD7\xD1m\x8E\xD3\x07\xA5\x9C\xFCl$4\xC1k\xE2X\xCF\x84\xB2\xEB];p\x9A)\x02q\xC1\x1E\xB6\vKud\xE7ttR\xB8@\x1C\xF9\xB6\xCE>s\xF9\x9F\x07\x99O\xAD\xB1\x7F\xC2I7\xA3O\x9D^-\xD9\xDE\xE0\x9CqY\\:0[\xD8\x95\x82.\xCE\xD1>\x06KQ\r_\xCEmy\xA9\xACv\xE8\x35\x8BWy\xBD_\x16\x33\\\xC8\xE1p\xFBIm\xCBvP\x11U\x94\x88(\xC1\xAD\xCC\x90\x03\xB2\xCEU\xDC\t]\xF7\x89\x90z\xE2\xB8\x17\xE7\xB4\xCD\xC4\x65\xC2\xCC\x36[Y\x95\xA1\x82\xB6\x07_o\xD7\x31\xE0\xC8p\x92\xFA\x31\xCD\xD5\xC6\xA9\xEA\xCF\x85\x96)\xF6\x15N\xB0xh\xA1_\xFC\xEB\t\x86Zc\xFA\xCD\xB9\xB7\t\xE8\x42P\x10<Y\xD5\x30\xE7\n\xE0i\x0F\x9Ew\xF2@\xF5\x17\xC1mp\x9E\xA6\xE6+\x14\x98\x8C\x1E\xBCL\xFC\x17\x89nW\xE8\x9E\xBE\x9El\xEB\x88\xD0\xD1\xD4\x94Gt\v\r\x0F\xDC\xBAZ J8\xC7\xF4\x9A\x81\xC3=\xC8\x8C\x18\xC5\xE8{Y\xBA\xCB>\xD9\x35\x90\xEF\xB2\x99\xC0\x0F\xBE\xCF\xB0\x65\xC4\x99L)e\x99\x86-\xDBVJ\xA6\xCA\t\xA2m\xF9\xD9H\xF7\x04\x1C \x9C\xD2\x05 K\x1C\xA3,\x96\x61jH\xC0\xC3\xEC\xB3\n*\xDA\xFD\xDF\n\x9B\xB6\xF4yDzs");

300 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

301 
ã°sPas£d
++;

304 
≠≥nd
.
size
 = ("\xBD\x8EJ\xA8\x91\xFC;\x11_\x0F\xB8=\xDC\x8AjL0=\x9F\xF2\xA8\xEF)\x97j\x1F\x06\x32\xD5\xC5j\xDE\xDE\xF5\x44\"\xA2\xD5\xA9\xB2\xD7\x14\x9D\xA8W\xA9\xF7?\x91W\xC9\xD7Q\x9F\xD7,5Q\xAF\xEA\x8DU\f\xEB\x8A\xF8\x41\xD4L\xF9Q@\x1A\xD6\x63w7\x8B\x9F\xF5\x18\x9AU\"\x13\xC9\xFD\xD1\x43\xF7\xD9~M>\x8B@\xC0\xEE\xB6H\x8D\x89\x8C\x04@\x83\xBC\x35\x16\xC7\xB8\x44\xC0;\xA7\x31\xDE\xC2\x11{\xF3\xC1\xAF\xC4HP\xA3\xAA\xA7Wl\xA5\xC3\x44\x92\xB6\x65\xE4\x1A\xDE\xFC\x02\xA6[Z\xC8\xE8\x8A\xE8\xD8kE\xB5\xCE\x31=\x9C\f\x8F\xD0\xB7\xFB\xD6G\xF8\x9C\xD7\xC4\x33O:\x9F\x06\x9Dz\xCF\xA7\xDD-\x05L:\x1B\xEA\xD1\x35\x61\xFC\x99\x44\xF3\xE1\x65O\xBD\xA5x\x99\xF8\x10\x91\xDE\xA2\x0E\xE8j\xCE\x1E/G)\x9F\x32\xE9\x90\xED\x95\x1B\xA3Y4\xE1\x46!\xC4\x82\x99,0\xF8\xBD\x9B\xED\x8Fxh\xF4\xA9MNS,\xECj\x10>\x98\xE9]\xEE\xB4\xD5%]\x1E\xB4\xB3\xD6\x44\x66\x64$\xB2\xAC\xA0\xB3@P\xF7\fu\"(\xA9\x1E#l_.\x9D\xF6\x34\xCF\xD1:T\x06V\xF2\xA7g\x1A'f\xD2\xD6\xF5\x39\x02\x8F\x93\v\x11Tyf:\xDD\xB0Z\xA5\"\xE8ns{P\xCD\x38\x45\xC6\xA8+\xB3)\xF0\xCD\x83IUTQ~8\xDFj\xA1\xA2]d\x8D\x34\xA6\xD6\n\x9EP}y\xAC\xD5\x14\x92\xE6\xBA\x9FJ%][\xC4\xFB\xCBi2\xE6\xF7\x98\x87@\x11\xA0")-1;

305 
ﬁdSize
 = 
a
.
size
;

306 
	`d¨øy_≠≥nd_lô
(
a
, "\xBD\x8EJ\xA8\x91\xFC;\x11_\x0F\xB8=\xDC\x8AjL0=\x9F\xF2\xA8\xEF)\x97j\x1F\x06\x32\xD5\xC5j\xDE\xDE\xF5\x44\"\xA2\xD5\xA9\xB2\xD7\x14\x9D\xA8W\xA9\xF7?\x91W\xC9\xD7Q\x9F\xD7,5Q\xAF\xEA\x8DU\f\xEB\x8A\xF8\x41\xD4L\xF9Q@\x1A\xD6\x63w7\x8B\x9F\xF5\x18\x9AU\"\x13\xC9\xFD\xD1\x43\xF7\xD9~M>\x8B@\xC0\xEE\xB6H\x8D\x89\x8C\x04@\x83\xBC\x35\x16\xC7\xB8\x44\xC0;\xA7\x31\xDE\xC2\x11{\xF3\xC1\xAF\xC4HP\xA3\xAA\xA7Wl\xA5\xC3\x44\x92\xB6\x65\xE4\x1A\xDE\xFC\x02\xA6[Z\xC8\xE8\x8A\xE8\xD8kE\xB5\xCE\x31=\x9C\f\x8F\xD0\xB7\xFB\xD6G\xF8\x9C\xD7\xC4\x33O:\x9F\x06\x9Dz\xCF\xA7\xDD-\x05L:\x1B\xEA\xD1\x35\x61\xFC\x99\x44\xF3\xE1\x65O\xBD\xA5x\x99\xF8\x10\x91\xDE\xA2\x0E\xE8j\xCE\x1E/G)\x9F\x32\xE9\x90\xED\x95\x1B\xA3Y4\xE1\x46!\xC4\x82\x99,0\xF8\xBD\x9B\xED\x8Fxh\xF4\xA9MNS,\xECj\x10>\x98\xE9]\xEE\xB4\xD5%]\x1E\xB4\xB3\xD6\x44\x66\x64$\xB2\xAC\xA0\xB3@P\xF7\fu\"(\xA9\x1E#l_.\x9D\xF6\x34\xCF\xD1:T\x06V\xF2\xA7g\x1A'f\xD2\xD6\xF5\x39\x02\x8F\x93\v\x11Tyf:\xDD\xB0Z\xA5\"\xE8ns{P\xCD\x38\x45\xC6\xA8+\xB3)\xF0\xCD\x83IUTQ~8\xDFj\xA1\xA2]d\x8D\x34\xA6\xD6\n\x9EP}y\xAC\xD5\x14\x92\xE6\xBA\x9FJ%][\xC4\xFB\xCBi2\xE6\xF7\x98\x87@\x11\xA0");

307 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

308 
íd
;

309 i‡(
a
.
size
 >á.
Æloc
)

310 
íd
;

311 i‡(
a
.
ôem
[a.
size
])

312 
íd
;

313 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\xBD\x8EJ\xA8\x91\xFC;\x11_\x0F\xB8=\xDC\x8AjL0=\x9F\xF2\xA8\xEF)\x97j\x1F\x06\x32\xD5\xC5j\xDE\xDE\xF5\x44\"\xA2\xD5\xA9\xB2\xD7\x14\x9D\xA8W\xA9\xF7?\x91W\xC9\xD7Q\x9F\xD7,5Q\xAF\xEA\x8DU\f\xEB\x8A\xF8\x41\xD4L\xF9Q@\x1A\xD6\x63w7\x8B\x9F\xF5\x18\x9AU\"\x13\xC9\xFD\xD1\x43\xF7\xD9~M>\x8B@\xC0\xEE\xB6H\x8D\x89\x8C\x04@\x83\xBC\x35\x16\xC7\xB8\x44\xC0;\xA7\x31\xDE\xC2\x11{\xF3\xC1\xAF\xC4HP\xA3\xAA\xA7Wl\xA5\xC3\x44\x92\xB6\x65\xE4\x1A\xDE\xFC\x02\xA6[Z\xC8\xE8\x8A\xE8\xD8kE\xB5\xCE\x31=\x9C\f\x8F\xD0\xB7\xFB\xD6G\xF8\x9C\xD7\xC4\x33O:\x9F\x06\x9Dz\xCF\xA7\xDD-\x05L:\x1B\xEA\xD1\x35\x61\xFC\x99\x44\xF3\xE1\x65O\xBD\xA5x\x99\xF8\x10\x91\xDE\xA2\x0E\xE8j\xCE\x1E/G)\x9F\x32\xE9\x90\xED\x95\x1B\xA3Y4\xE1\x46!\xC4\x82\x99,0\xF8\xBD\x9B\xED\x8Fxh\xF4\xA9MNS,\xECj\x10>\x98\xE9]\xEE\xB4\xD5%]\x1E\xB4\xB3\xD6\x44\x66\x64$\xB2\xAC\xA0\xB3@P\xF7\fu\"(\xA9\x1E#l_.\x9D\xF6\x34\xCF\xD1:T\x06V\xF2\xA7g\x1A'f\xD2\xD6\xF5\x39\x02\x8F\x93\v\x11Tyf:\xDD\xB0Z\xA5\"\xE8ns{P\xCD\x38\x45\xC6\xA8+\xB3)\xF0\xCD\x83IUTQ~8\xDFj\xA1\xA2]d\x8D\x34\xA6\xD6\n\x9EP}y\xAC\xD5\x14\x92\xE6\xBA\x9FJ%][\xC4\xFB\xCBi2\xE6\xF7\x98\x87@\x11\xA0",á.
size
-oldSize))

314 
íd
;

315 
≠≥nd
.
ôem
 = 
	`°rdup
("\xBD\x8EJ\xA8\x91\xFC;\x11_\x0F\xB8=\xDC\x8AjL0=\x9F\xF2\xA8\xEF)\x97j\x1F\x06\x32\xD5\xC5j\xDE\xDE\xF5\x44\"\xA2\xD5\xA9\xB2\xD7\x14\x9D\xA8W\xA9\xF7?\x91W\xC9\xD7Q\x9F\xD7,5Q\xAF\xEA\x8DU\f\xEB\x8A\xF8\x41\xD4L\xF9Q@\x1A\xD6\x63w7\x8B\x9F\xF5\x18\x9AU\"\x13\xC9\xFD\xD1\x43\xF7\xD9~M>\x8B@\xC0\xEE\xB6H\x8D\x89\x8C\x04@\x83\xBC\x35\x16\xC7\xB8\x44\xC0;\xA7\x31\xDE\xC2\x11{\xF3\xC1\xAF\xC4HP\xA3\xAA\xA7Wl\xA5\xC3\x44\x92\xB6\x65\xE4\x1A\xDE\xFC\x02\xA6[Z\xC8\xE8\x8A\xE8\xD8kE\xB5\xCE\x31=\x9C\f\x8F\xD0\xB7\xFB\xD6G\xF8\x9C\xD7\xC4\x33O:\x9F\x06\x9Dz\xCF\xA7\xDD-\x05L:\x1B\xEA\xD1\x35\x61\xFC\x99\x44\xF3\xE1\x65O\xBD\xA5x\x99\xF8\x10\x91\xDE\xA2\x0E\xE8j\xCE\x1E/G)\x9F\x32\xE9\x90\xED\x95\x1B\xA3Y4\xE1\x46!\xC4\x82\x99,0\xF8\xBD\x9B\xED\x8Fxh\xF4\xA9MNS,\xECj\x10>\x98\xE9]\xEE\xB4\xD5%]\x1E\xB4\xB3\xD6\x44\x66\x64$\xB2\xAC\xA0\xB3@P\xF7\fu\"(\xA9\x1E#l_.\x9D\xF6\x34\xCF\xD1:T\x06V\xF2\xA7g\x1A'f\xD2\xD6\xF5\x39\x02\x8F\x93\v\x11Tyf:\xDD\xB0Z\xA5\"\xE8ns{P\xCD\x38\x45\xC6\xA8+\xB3)\xF0\xCD\x83IUTQ~8\xDFj\xA1\xA2]d\x8D\x34\xA6\xD6\n\x9EP}y\xAC\xD5\x14\x92\xE6\xBA\x9FJ%][\xC4\xFB\xCBi2\xE6\xF7\x98\x87@\x11\xA0");

316 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

317 
ã°sPas£d
++;

320 
≠≥nd
.
size
 = ("\x8E}z\x05\xDF\xD6\xF1\xD2\xBC\x15\xC1\xED\xF7\xF6\xFC\x83\xA8\x32\x33=\xB8K\x14\x86\xCCX1nD\x99\xBD\x44IB\xF6+\x97\xF2\x15\x86\xFA\xD9\xA5\xB8\xE9\x01;\x92\xC3\xF0\xD8\xA8]\xBF\xB7\xB8\x03\x38.\xF0KMW\xF1\xBAU]1\xC5\x61\x38zvR\xAD\xB0\x66\x03\x08\xFB\x86\xCFY\xB0\v\xBE+d\xF2\x84\x41\xC5\x84pUy\xE8\xAF\x94=\xE3\x33v+e\xFCi\xFB\x97\xB8\x32\xD4:9:\xE8\x15\x84\xF9\xE0\xAA\x11\xFF\xB9\x94\x13\xE4\xD3J\x88\x37\xD6\xE7\xF2\xAB\x36\xDC\xA5l38F\xDB\xD8\x95\x14\x1C\x1B\x36\xE0-\x93\x1E\x07\x94l\x03x\x16\x11\x94\xCD\"8\xD8\xED+\x10\xB5\xDCznl\xCD\x99SA\x12Y0\xAB\x81\f\xAC\xCB\xFE\x8A\x46\x8E\x7F\x8F\x97\x14\xF5\x38v~#\xB4")-1;

321 
ﬁdSize
 = 
a
.
size
;

322 
	`d¨øy_≠≥nd_lô
(
a
, "\x8E}z\x05\xDF\xD6\xF1\xD2\xBC\x15\xC1\xED\xF7\xF6\xFC\x83\xA8\x32\x33=\xB8K\x14\x86\xCCX1nD\x99\xBD\x44IB\xF6+\x97\xF2\x15\x86\xFA\xD9\xA5\xB8\xE9\x01;\x92\xC3\xF0\xD8\xA8]\xBF\xB7\xB8\x03\x38.\xF0KMW\xF1\xBAU]1\xC5\x61\x38zvR\xAD\xB0\x66\x03\x08\xFB\x86\xCFY\xB0\v\xBE+d\xF2\x84\x41\xC5\x84pUy\xE8\xAF\x94=\xE3\x33v+e\xFCi\xFB\x97\xB8\x32\xD4:9:\xE8\x15\x84\xF9\xE0\xAA\x11\xFF\xB9\x94\x13\xE4\xD3J\x88\x37\xD6\xE7\xF2\xAB\x36\xDC\xA5l38F\xDB\xD8\x95\x14\x1C\x1B\x36\xE0-\x93\x1E\x07\x94l\x03x\x16\x11\x94\xCD\"8\xD8\xED+\x10\xB5\xDCznl\xCD\x99SA\x12Y0\xAB\x81\f\xAC\xCB\xFE\x8A\x46\x8E\x7F\x8F\x97\x14\xF5\x38v~#\xB4");

323 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

324 
íd
;

325 i‡(
a
.
size
 >á.
Æloc
)

326 
íd
;

327 i‡(
a
.
ôem
[a.
size
])

328 
íd
;

329 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\x8E}z\x05\xDF\xD6\xF1\xD2\xBC\x15\xC1\xED\xF7\xF6\xFC\x83\xA8\x32\x33=\xB8K\x14\x86\xCCX1nD\x99\xBD\x44IB\xF6+\x97\xF2\x15\x86\xFA\xD9\xA5\xB8\xE9\x01;\x92\xC3\xF0\xD8\xA8]\xBF\xB7\xB8\x03\x38.\xF0KMW\xF1\xBAU]1\xC5\x61\x38zvR\xAD\xB0\x66\x03\x08\xFB\x86\xCFY\xB0\v\xBE+d\xF2\x84\x41\xC5\x84pUy\xE8\xAF\x94=\xE3\x33v+e\xFCi\xFB\x97\xB8\x32\xD4:9:\xE8\x15\x84\xF9\xE0\xAA\x11\xFF\xB9\x94\x13\xE4\xD3J\x88\x37\xD6\xE7\xF2\xAB\x36\xDC\xA5l38F\xDB\xD8\x95\x14\x1C\x1B\x36\xE0-\x93\x1E\x07\x94l\x03x\x16\x11\x94\xCD\"8\xD8\xED+\x10\xB5\xDCz∆\xCD\x99SA\x12Y0\xAB\x81\f\xAC\xCB\xFE\x8A\x46\x8E\x7F\x8F\x97\x14\xF5\x38v~#\xB4",á.
size
-oldSize))

330 
íd
;

331 
≠≥nd
.
ôem
 = 
	`°rdup
("\x8E}z\x05\xDF\xD6\xF1\xD2\xBC\x15\xC1\xED\xF7\xF6\xFC\x83\xA8\x32\x33=\xB8K\x14\x86\xCCX1nD\x99\xBD\x44IB\xF6+\x97\xF2\x15\x86\xFA\xD9\xA5\xB8\xE9\x01;\x92\xC3\xF0\xD8\xA8]\xBF\xB7\xB8\x03\x38.\xF0KMW\xF1\xBAU]1\xC5\x61\x38zvR\xAD\xB0\x66\x03\x08\xFB\x86\xCFY\xB0\v\xBE+d\xF2\x84\x41\xC5\x84pUy\xE8\xAF\x94=\xE3\x33v+e\xFCi\xFB\x97\xB8\x32\xD4:9:\xE8\x15\x84\xF9\xE0\xAA\x11\xFF\xB9\x94\x13\xE4\xD3J\x88\x37\xD6\xE7\xF2\xAB\x36\xDC\xA5l38F\xDB\xD8\x95\x14\x1C\x1B\x36\xE0-\x93\x1E\x07\x94l\x03x\x16\x11\x94\xCD\"8\xD8\xED+\x10\xB5\xDCznl\xCD\x99SA\x12Y0\xAB\x81\f\xAC\xCB\xFE\x8A\x46\x8E\x7F\x8F\x97\x14\xF5\x38v~#\xB4");

332 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

333 
ã°sPas£d
++;

336 
≠≥nd
.
size
 = ("\x18`\v\xC8\xC5N\xEEM!\x9D\x06@\x98#l\xCEOW(*\f\x92\xF2\xEA\x08\xA6\xCF\x06\xA9Z0\xA3.\xF6\x99\xE0\f@\xA8\x8E\xE7\xD8\xF1.R)\xF4%Y;\xD5h1\x9BW\x81\x8B\xA7Y$\x9A\xD8\xA6L\x85\x43J\xD9\x33\x81\x9A\xEBt/\x0Fs\xFE\x19\xEBg\x93\xDD\x1Dn\xDEzd&\x85\xB8\xAE\x92\xF4\x42\xFA\x45\x94\x0F[Z\x17\xFA\x41Zq\xFF\xD1z\x05}\xFFK\xE9r\xAF\xAB\x61\x86\x98j$\xB0\x9C:\xD8\x1D\xE8\xFD\xE9\x84\xEA\xFE\x63\x99\xC0Y\xCC\xDE\xF7\x1E\xE5\xA7\x96\xE0\xC2M\fA-\x90#\x9F[x\x13#\x8Ev\xBF\xAF\x87\xE1\x8E\xD8>\xF8\xC4'g\xE3L\xC0\xE0\xDC\x15Z\x98\xC4%\xE1\x91\xE9\xEA\xE3\xF6V\x90NK5_K\xE0\x1E\x35")-1;

337 
ﬁdSize
 = 
a
.
size
;

338 
	`d¨øy_≠≥nd_lô
(
a
, "\x18`\v\xC8\xC5N\xEEM!\x9D\x06@\x98#l\xCEOW(*\f\x92\xF2\xEA\x08\xA6\xCF\x06\xA9Z0\xA3.\xF6\x99\xE0\f@\xA8\x8E\xE7\xD8\xF1.R)\xF4%Y;\xD5h1\x9BW\x81\x8B\xA7Y$\x9A\xD8\xA6L\x85\x43J\xD9\x33\x81\x9A\xEBt/\x0Fs\xFE\x19\xEBg\x93\xDD\x1Dn\xDEzd&\x85\xB8\xAE\x92\xF4\x42\xFA\x45\x94\x0F[Z\x17\xFA\x41Zq\xFF\xD1z\x05}\xFFK\xE9r\xAF\xAB\x61\x86\x98j$\xB0\x9C:\xD8\x1D\xE8\xFD\xE9\x84\xEA\xFE\x63\x99\xC0Y\xCC\xDE\xF7\x1E\xE5\xA7\x96\xE0\xC2M\fA-\x90#\x9F[x\x13#\x8Ev\xBF\xAF\x87\xE1\x8E\xD8>\xF8\xC4'g\xE3L\xC0\xE0\xDC\x15Z\x98\xC4%\xE1\x91\xE9\xEA\xE3\xF6V\x90NK5_K\xE0\x1E\x35");

339 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

340 
íd
;

341 i‡(
a
.
size
 >á.
Æloc
)

342 
íd
;

343 i‡(
a
.
ôem
[a.
size
])

344 
íd
;

345 i‡(
	`memcmp
(
a
.
ôem
+
ﬁdSize
, "\x18`\v\xC8\xC5N\xEEM!\x9D\x06@\x98#l\xCEOW(*\f\x92\xF2\xEA\x08\xA6\xCF\x06\xA9Z0\xA3.\xF6\x99\xE0\f@\xA8\x8E\xE7\xD8\xF1.R)\xF4%Y;\xD5h1\x9BW\x81\x8B\xA7Y$\x9A\xD8\xA6L\x85\x43J\xD9\x33\x81\x9A\xEBt/\x0Fs\xFE\x19\xEBg\x93\xDD\x1Dn\xDEzd&\x85\xB8\xAE\x92\xF4\x42\xFA\x45\x94\x0F[Z\x17\xFA\x41Zq\xFF\xD1z\x05}\xFFK\xE9r\xAF\xAB\x61\x86\x98j$\xB0\x9C:\xD8\x1D\xE8\xFD\xE9\x84\xEA\xFE\x63\x99\xC0Y\xCC\xDE\xF7\x1E\xE5\xA7\x96\xE0\xC2M\fA-\x90#\x9F[x\x13#\x8Ev\xBF\xAF\x87\xE1\x8E\xD8>\xF8\xC4'g\xE3L\xC0\xE0\xDC\x15Z\x98\xC4%\xE1\x91\xE9\xEA\xE3\xF6V\x90NK5_K\xE0\x1E\x35",á.
size
-oldSize))

346 
íd
;

347 
≠≥nd
.
ôem
 = 
	`°rdup
("\x18`\v\xC8\xC5N\xEEM!\x9D\x06@\x98#l\xCEOW(*\f\x92\xF2\xEA\x08\xA6\xCF\x06\xA9Z0\xA3.\xF6\x99\xE0\f@\xA8\x8E\xE7\xD8\xF1.R)\xF4%Y;\xD5h1\x9BW\x81\x8B\xA7Y$\x9A\xD8\xA6L\x85\x43J\xD9\x33\x81\x9A\xEBt/\x0Fs\xFE\x19\xEBg\x93\xDD\x1Dn\xDEzd&\x85\xB8\xAE\x92\xF4\x42\xFA\x45\x94\x0F[Z\x17\xFA\x41Zq\xFF\xD1z\x05}\xFFK\xE9r\xAF\xAB\x61\x86\x98j$\xB0\x9C:\xD8\x1D\xE8\xFD\xE9\x84\xEA\xFE\x63\x99\xC0Y\xCC\xDE\xF7\x1E\xE5\xA7\x96\xE0\xC2M\fA-\x90#\x9F[x\x13#\x8Ev\xBF\xAF\x87\xE1\x8E\xD8>\xF8\xC4'g\xE3L\xC0\xE0\xDC\x15Z\x98\xC4%\xE1\x91\xE9\xEA\xE3\xF6V\x90NK5_K\xE0\x1E\x35");

348 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

349 
ã°sPas£d
++;

352 i‡(
°rögs
.
size
 != 10)

353 
íd
;

355 
	`d¨øy_f‹óch
(
i
, 
°rögs
) {

356 i‡(
a
.
size
-
offs
 < 
i
->size)

357 
íd
;

358 i‡(
	`memcmp
(
a
.
ôem
+
offs
, 
i
->ôem, i->
size
))

359 
íd
;

360 
offs
 +
i
->
size
;

363 i‡(
offs
 !
a
.
size
)

364 
íd
;

365 i‡(
a
.
ôem
[
offs
])

366 
íd
;

367 
ã°sPas£d
++;

369 
íd
:

370 
	`d¨øy_‰ì
(
a
);

371 
	`d¨øy_f‹óch
(
i
, 
°rögs
)

372 
	`‰ì
(
i
->
ôem
);

373 
	`d¨øy_‰ì
(
°rögs
);

374  
ã°sPas£d
 == 10+1;

375 
	}
}

377 
	$ã°d¨øy_¥ïíd_lô
() {

378 
d¨øy_ch¨
 
a
 = 
	`d¨øy_√w
();

379 
	`d¨øy
(
ã°Lôs_°rög
Ë
°rögs
 = 
	`d¨øy_√w
();

380 
ã°Lôs_°rög
 *
i
;

381 
size_t
 
ã°sPas£d
 = 0;

382 
size_t
 
ﬁdSize
;

383 
ã°Lôs_°rög
 
≠≥nd
;

384 
size_t
 
offs
;

387 
≠≥nd
.
size
 = ("*g\xC2;\x98\x92\xD3\x84\xF4\x64\xB4\xC8\x83@\xA6s\xE5\xEF,\xB4\xAB\x12\x36\xE9\x8F\x88\xF8\x9C\v\x08\xE6M\x98\xA0\x1D\x9B\xF5\xD9\xEC \xC2\xFFK;'\xFE?\xF0\xAB\xA3>\x97\xB4n\x11\x65\xA1\xFC\r\x13\x8BU\xC4;\xC3\xD2\xA8l\xE6\xA7\xE0\xCA\xB7@\xA2\xD2\x89\x14\x8A\x05\x33\xB9\xF7\x45yp\x17\xDC\x9C\xBF,\xB6Z(\xE9\xD9\x34g\x0E`\x80\x8Ag\xD0%I\xC1?Y\x16\xFA\xE2.\xB9\x36\xEA\xC1\x06Kj\x9Bx\xF9\xD0\x84\x89\x91\xF4\x87\x14\x93h(\xF1\x98\x38\x9Cq\xC6,\x13\x04\x61\xDA\xC2\xA1\xFE\xF3\xEAz\x9F\xCAyS\xEF\xBB\xF9\\\x16M\xEC\xAB\xC1\x34\x80~\xCE\r:K\xB4\x19\x99\xE1\x82/\x96\x87\xCD\xDD")-1;

388 
ﬁdSize
 = 
a
.
size
;

389 
	`d¨øy_¥ïíd_lô
(
a
, "*g\xC2;\x98\x92\xD3\x84\xF4\x64\xB4\xC8\x83@\xA6s\xE5\xEF,\xB4\xAB\x12\x36\xE9\x8F\x88\xF8\x9C\v\x08\xE6M\x98\xA0\x1D\x9B\xF5\xD9\xEC \xC2\xFFK;'\xFE?\xF0\xAB\xA3>\x97\xB4n\x11\x65\xA1\xFC\r\x13\x8BU\xC4;\xC3\xD2\xA8l\xE6\xA7\xE0\xCA\xB7@\xA2\xD2\x89\x14\x8A\x05\x33\xB9\xF7\x45yp\x17\xDC\x9C\xBF,\xB6Z(\xE9\xD9\x34g\x0E`\x80\x8Ag\xD0%I\xC1?Y\x16\xFA\xE2.\xB9\x36\xEA\xC1\x06Kj\x9Bx\xF9\xD0\x84\x89\x91\xF4\x87\x14\x93h(\xF1\x98\x38\x9Cq\xC6,\x13\x04\x61\xDA\xC2\xA1\xFE\xF3\xEAz\x9F\xCAyS\xEF\xBB\xF9\\\x16M\xEC\xAB\xC1\x34\x80~\xCE\r:K\xB4\x19\x99\xE1\x82/\x96\x87\xCD\xDD");

390 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

391 
íd
;

392 i‡(
a
.
size
 >á.
Æloc
)

393 
íd
;

394 i‡(
a
.
ôem
[a.
size
])

395 
íd
;

396 i‡(
	`memcmp
(
a
.
ôem
, "*g\xC2;\x98\x92\xD3\x84\xF4\x64\xB4\xC8\x83@\xA6s\xE5\xEF,\xB4\xAB\x12\x36\xE9\x8F\x88\xF8\x9C\v\x08\xE6M\x98\xA0\x1D\x9B\xF5\xD9\xEC \xC2\xFFK;'\xFE?\xF0\xAB\xA3>\x97\xB4n\x11\x65\xA1\xFC\r\x13\x8BU\xC4;\xC3\xD2\xA8l\xE6\xA7\xE0\xCA\xB7@\xA2\xD2\x89\x14\x8A\x05\x33\xB9\xF7\x45yp\x17\xDC\x9C\xBF,\xB6Z(\xE9\xD9\x34g\x0E`\x80\x8Ag\xD0%I\xC1?Y\x16\xFA\xE2.\xB9\x36\xEA\xC1\x06Kj\x9Bx\xF9\xD0\x84\x89\x91\xF4\x87\x14\x93h(\xF1\x98\x38\x9Cq\xC6,\x13\x04\x61\xDA\xC2\xA1\xFE\xF3\xEAz\x9F\xCAyS\xEF\xBB\xF9\\\x16M\xEC\xAB\xC1\x34\x80~\xCE\r:K\xB4\x19\x99\xE1\x82/\x96\x87\xCD\xDD",á.
size
-
ﬁdSize
))

397 
íd
;

398 
≠≥nd
.
ôem
 = 
	`°rdup
("*g\xC2;\x98\x92\xD3\x84\xF4\x64\xB4\xC8\x83@\xA6s\xE5\xEF,\xB4\xAB\x12\x36\xE9\x8F\x88\xF8\x9C\v\x08\xE6M\x98\xA0\x1D\x9B\xF5\xD9\xEC \xC2\xFFK;'\xFE?\xF0\xAB\xA3>\x97\xB4n\x11\x65\xA1\xFC\r\x13\x8BU\xC4;\xC3\xD2\xA8l\xE6\xA7\xE0\xCA\xB7@\xA2\xD2\x89\x14\x8A\x05\x33\xB9\xF7\x45yp\x17\xDC\x9C\xBF,\xB6Z(\xE9\xD9\x34g\x0E`\x80\x8Ag\xD0%I\xC1?Y\x16\xFA\xE2.\xB9\x36\xEA\xC1\x06Kj\x9Bx\xF9\xD0\x84\x89\x91\xF4\x87\x14\x93h(\xF1\x98\x38\x9Cq\xC6,\x13\x04\x61\xDA\xC2\xA1\xFE\xF3\xEAz\x9F\xCAyS\xEF\xBB\xF9\\\x16M\xEC\xAB\xC1\x34\x80~\xCE\r:K\xB4\x19\x99\xE1\x82/\x96\x87\xCD\xDD");

399 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

400 
ã°sPas£d
++;

403 
≠≥nd
.
size
 = ("B\xFD\xE5\xB0\xAC]`\n><\xFF\xDC\x38k\x03!\xE5\xFF\xC1\x31\x94\xC8\x1C\xAE\x83\x39\xA2K\xC5u\xA4\xD3\x9C\x07\xB0\xCE\xDF\x33\xE6\x02\xE3P\xE0\x83\xD8\x97<\x95\xF1\xFF\x34I\x89\xD2\x17\xD9\x17\xACH\x01-1-\xBB\x86\xFE\xED\x01\xBA\x01\tvf\x95Wm\xE0\xCBX%\x0E<\xC9\x9D\x19\x06\xD6\x36\xD9\x1C\tI\xB5IE\x80\x87oM;\x1D\xC3\x9D\xB6\t\x89\x37\xE9\xC2\x34\x94\xE3\xEC].I\x86\xD5\x9C\xAE\x87\xB0m\x11=\xDF\xB1\xFE\xD2\xF6`z3\xE7\xC6\xE8\xEEl\x15\x9D>3\xF8\x8D\xC2\x65(`\xE6I\x9B\x15\xFD\xED \f\xC3_\xC5\xBA\x38\xCB\xF7\x9B\xD9\x14VQM\xAD\x98\xDEJ\xCC#\xA8\x92\xB7\x14\xC1\nX\xD9\xB4\x96$\xB1\x12\xAF\x06\x07TmmTM\xAC\x33\xD4:\x8A\x94M:Srcr\x17\x95pKE\xC1\t\xC0\xB1\x84\x11\xF5\x97\x15\x62\x11\x33\x05\xB5\x9A.@\xBF\x13\xD7\xCAn\xBE\x34\xB5\xA6\x15\xB6\x88\x13\xDE\xA3\xE9\xC3/\xF9\x36L\\\x0E\x1Fg\xDD\xC0\x01\xD0\x90\x9ENq*\xBD\x31/ttV\xAC\xA4\x12?s\xC1\xFF\x35\xBB~\xDC\x05\x06\xFF\xF8\xFA\x1B\x65\x11T\x8Fz\xF3W0\x98\x1D\x7F\x03\x9AQ3\te\xAB]\x93\xD6xfS\xE5\xB2$(\xFA\xE4\xD1\xCC\xA9\x80\xF0\xC3\x36uK\xF0\xD2(B`\x11\x04\x9Bx")-1;

404 
ﬁdSize
 = 
a
.
size
;

405 
	`d¨øy_¥ïíd_lô
(
a
, "B\xFD\xE5\xB0\xAC]`\n><\xFF\xDC\x38k\x03!\xE5\xFF\xC1\x31\x94\xC8\x1C\xAE\x83\x39\xA2K\xC5u\xA4\xD3\x9C\x07\xB0\xCE\xDF\x33\xE6\x02\xE3P\xE0\x83\xD8\x97<\x95\xF1\xFF\x34I\x89\xD2\x17\xD9\x17\xACH\x01-1-\xBB\x86\xFE\xED\x01\xBA\x01\tvf\x95Wm\xE0\xCBX%\x0E<\xC9\x9D\x19\x06\xD6\x36\xD9\x1C\tI\xB5IE\x80\x87oM;\x1D\xC3\x9D\xB6\t\x89\x37\xE9\xC2\x34\x94\xE3\xEC].I\x86\xD5\x9C\xAE\x87\xB0m\x11=\xDF\xB1\xFE\xD2\xF6`z3\xE7\xC6\xE8\xEEl\x15\x9D>3\xF8\x8D\xC2\x65(`\xE6I\x9B\x15\xFD\xED \f\xC3_\xC5\xBA\x38\xCB\xF7\x9B\xD9\x14VQM\xAD\x98\xDEJ\xCC#\xA8\x92\xB7\x14\xC1\nX\xD9\xB4\x96$\xB1\x12\xAF\x06\x07TmmTM\xAC\x33\xD4:\x8A\x94M:Srcr\x17\x95pKE\xC1\t\xC0\xB1\x84\x11\xF5\x97\x15\x62\x11\x33\x05\xB5\x9A.@\xBF\x13\xD7\xCAn\xBE\x34\xB5\xA6\x15\xB6\x88\x13\xDE\xA3\xE9\xC3/\xF9\x36L\\\x0E\x1Fg\xDD\xC0\x01\xD0\x90\x9ENq*\xBD\x31/ttV\xAC\xA4\x12?s\xC1\xFF\x35\xBB~\xDC\x05\x06\xFF\xF8\xFA\x1B\x65\x11T\x8Fz\xF3W0\x98\x1D\x7F\x03\x9AQ3\te\xAB]\x93\xD6xfS\xE5\xB2$(\xFA\xE4\xD1\xCC\xA9\x80\xF0\xC3\x36uK\xF0\xD2(B`\x11\x04\x9Bx");

406 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

407 
íd
;

408 i‡(
a
.
size
 >á.
Æloc
)

409 
íd
;

410 i‡(
a
.
ôem
[a.
size
])

411 
íd
;

412 i‡(
	`memcmp
(
a
.
ôem
, "B\xFD\xE5\xB0\xAC]`\n><\xFF\xDC\x38k\x03!\xE5\xFF\xC1\x31\x94\xC8\x1C\xAE\x83\x39\xA2K\xC5u\xA4\xD3\x9C\x07\xB0\xCE\xDF\x33\xE6\x02\xE3P\xE0\x83\xD8\x97<\x95\xF1\xFF\x34I\x89\xD2\x17\xD9\x17\xACH\x01-1-\xBB\x86\xFE\xED\x01\xBA\x01\tvf\x95Wm\xE0\xCBX%\x0E<\xC9\x9D\x19\x06\xD6\x36\xD9\x1C\tI\xB5IE\x80\x87oM;\x1D\xC3\x9D\xB6\t\x89\x37\xE9\xC2\x34\x94\xE3\xEC].I\x86\xD5\x9C\xAE\x87\xB0m\x11=\xDF\xB1\xFE\xD2\xF6`z3\xE7\xC6\xE8\xEEl\x15\x9D>3\xF8\x8D\xC2\x65(`\xE6I\x9B\x15\xFD\xED \f\xC3_\xC5\xBA\x38\xCB\xF7\x9B\xD9\x14VQM\xAD\x98\xDEJ\xCC#\xA8\x92\xB7\x14\xC1\nX\xD9\xB4\x96$\xB1\x12\xAF\x06\x07TmmTM\xAC\x33\xD4:\x8A\x94M:Sr¸\x17\x95pKE\xC1\t\xC0\xB1\x84\x11\xF5\x97\x15\x62\x11\x33\x05\xB5\x9A.@\xBF\x13\xD7\xCAn\xBE\x34\xB5\xA6\x15\xB6\x88\x13\xDE\xA3\xE9\xC3/\xF9\x36L\\\x0E\x1Fg\xDD\xC0\x01\xD0\x90\x9ENq*\xBD\x31/âV\xAC\xA4\x12?s\xC1\xFF\x35\xBB~\xDC\x05\x06\xFF\xF8\xFA\x1B\x65\x11T\x8Fz\xF3W0\x98\x1D\x7F\x03\x9AQ3\ã\xAB]\x93\xD6xfS\xE5\xB2$(\xFA\xE4\xD1\xCC\xA9\x80\xF0\xC3\x36uK\xF0\xD2(B`\x11\x04\x9Bx",á.
size
-
ﬁdSize
))

413 
íd
;

414 
≠≥nd
.
ôem
 = 
	`°rdup
("B\xFD\xE5\xB0\xAC]`\n><\xFF\xDC\x38k\x03!\xE5\xFF\xC1\x31\x94\xC8\x1C\xAE\x83\x39\xA2K\xC5u\xA4\xD3\x9C\x07\xB0\xCE\xDF\x33\xE6\x02\xE3P\xE0\x83\xD8\x97<\x95\xF1\xFF\x34I\x89\xD2\x17\xD9\x17\xACH\x01-1-\xBB\x86\xFE\xED\x01\xBA\x01\tvf\x95Wm\xE0\xCBX%\x0E<\xC9\x9D\x19\x06\xD6\x36\xD9\x1C\tI\xB5IE\x80\x87oM;\x1D\xC3\x9D\xB6\t\x89\x37\xE9\xC2\x34\x94\xE3\xEC].I\x86\xD5\x9C\xAE\x87\xB0m\x11=\xDF\xB1\xFE\xD2\xF6`z3\xE7\xC6\xE8\xEEl\x15\x9D>3\xF8\x8D\xC2\x65(`\xE6I\x9B\x15\xFD\xED \f\xC3_\xC5\xBA\x38\xCB\xF7\x9B\xD9\x14VQM\xAD\x98\xDEJ\xCC#\xA8\x92\xB7\x14\xC1\nX\xD9\xB4\x96$\xB1\x12\xAF\x06\x07TmmTM\xAC\x33\xD4:\x8A\x94M:Srcr\x17\x95pKE\xC1\t\xC0\xB1\x84\x11\xF5\x97\x15\x62\x11\x33\x05\xB5\x9A.@\xBF\x13\xD7\xCAn\xBE\x34\xB5\xA6\x15\xB6\x88\x13\xDE\xA3\xE9\xC3/\xF9\x36L\\\x0E\x1Fg\xDD\xC0\x01\xD0\x90\x9ENq*\xBD\x31/ttV\xAC\xA4\x12?s\xC1\xFF\x35\xBB~\xDC\x05\x06\xFF\xF8\xFA\x1B\x65\x11T\x8Fz\xF3W0\x98\x1D\x7F\x03\x9AQ3\te\xAB]\x93\xD6xfS\xE5\xB2$(\xFA\xE4\xD1\xCC\xA9\x80\xF0\xC3\x36uK\xF0\xD2(B`\x11\x04\x9Bx");

415 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

416 
ã°sPas£d
++;

419 
≠≥nd
.
size
 = ("\x1C\xBA\x07\x30\xD4|%e'yY\x7F\xE2\xD4~\xAB<\xEC%#\x80\xDC\x46\x65\xCA\x9D~\x86\xD6\x84\xF3\x38^\x90\x9A~F\x8F\xF7JH\xFC\xAB\x8Eo\x10W\x97\r\xDB\x36.\xEC\x92\xFBV\x11j\x98\xDAs\x1B&M\xB5\x1D\r\xCD\x14\x34\xA1\x96\xD5\xAD\x05)\xD0\xD9\xA5\xFA\xF3\xD9\x83n\x9A\x95\xDA\xB4\xF5\x1C\"6\x02\x36\x9B)\xA1\x35t+\xA9\xDBS\xD1\x42\x91\xCAr\x8Bq\xE9\x86\x18\xC2\xBE\xDC\xA3\xC4!\xCF\x33\xFE\x81^\x82\x35\x46\x31jG\xB3\x93\x8A\xB5\xD6\xC5\xE5IIVL.u\xD1\x91\"9\xB0\xAF\x86#\x8E\x81>\xC6\xC8\xF5\xAC\xD3\xA5\xC5O\x95\xCA\xAA\x93\x35\x9C\xE8\xB6R\x1F\xE4\xD8\r\xB5\x84K:\xBE\xF3\xDE\x9A\x83\xC8J\xD4\xD7\xBF\x84\x46\xE7\x05;\xFF}\xAAML\xF3\x65,\xA0\x8A\xBF\xA4\"\x9D\x0E*\xAE\x89NA \x12\xCD\xFC\x9A\xE2\xD9\xF0\x62\x08jA\xC3\x44}%\xD1O:\xBAs\xD1\x66I\x10r\x8C\x41\xBFY\r\xA5VP\xD0\x1E\xB6iC\xC9\x65 \xFF\xA9\x8E\x01\xEF\xAE@u\x14\x03\xE9\x34\x83\xBC\xED\x83\xBCW\xB8\xF0\xD9\x65\x41\x07\xA1\xB1 \x03\x39\xC6\x8C\xEF\x92\x81u\x10\x91\xB8\x38\x38*\"\x96m\xEB\fh\xFD%Z\xD7\x64GID^\xA4\x97Q\x8D\xB3\x1B\xE4O:\xC8\x9D\xD0\x89\xAF\xC4)6'\xD5\xB2.\xDD,kZ\xF0n|\x86kU\xB2V\x01\x65\x0F\xA4\xF1\xEC\xD8\xF6\x89\x7F\x14\xCD\v\x14\xAD\x19\xA0`\x9F)\nW\xB6\x9C\x39\xEB;\xBEJ\xD8\x11\xB8.\xB9\xCF\x81N{m\xE9\x65L\xD2?7\x19\x03\xB8\xB5\x95\x9C!\xDA\x82\x43\x45\x42<\xF3\x8B\xA7\xAB\xE1\x41\x06\x88\x31\x8D\xC8\x7F\xF2\x99\f\xEF\xC5%\x80\x9E\xAC\x93S\x07\x46\xE1l\xC7\x7F\x86\xAA\x05\x83%\xA1\xD9\x34\xAE\xF8\x04\xBCh\xAE")-1;

420 
ﬁdSize
 = 
a
.
size
;

421 
	`d¨øy_¥ïíd_lô
(
a
, "\x1C\xBA\x07\x30\xD4|%e'yY\x7F\xE2\xD4~\xAB<\xEC%#\x80\xDC\x46\x65\xCA\x9D~\x86\xD6\x84\xF3\x38^\x90\x9A~F\x8F\xF7JH\xFC\xAB\x8Eo\x10W\x97\r\xDB\x36.\xEC\x92\xFBV\x11j\x98\xDAs\x1B&M\xB5\x1D\r\xCD\x14\x34\xA1\x96\xD5\xAD\x05)\xD0\xD9\xA5\xFA\xF3\xD9\x83n\x9A\x95\xDA\xB4\xF5\x1C\"6\x02\x36\x9B)\xA1\x35t+\xA9\xDBS\xD1\x42\x91\xCAr\x8Bq\xE9\x86\x18\xC2\xBE\xDC\xA3\xC4!\xCF\x33\xFE\x81^\x82\x35\x46\x31jG\xB3\x93\x8A\xB5\xD6\xC5\xE5IIVL.u\xD1\x91\"9\xB0\xAF\x86#\x8E\x81>\xC6\xC8\xF5\xAC\xD3\xA5\xC5O\x95\xCA\xAA\x93\x35\x9C\xE8\xB6R\x1F\xE4\xD8\r\xB5\x84K:\xBE\xF3\xDE\x9A\x83\xC8J\xD4\xD7\xBF\x84\x46\xE7\x05;\xFF}\xAAML\xF3\x65,\xA0\x8A\xBF\xA4\"\x9D\x0E*\xAE\x89NA \x12\xCD\xFC\x9A\xE2\xD9\xF0\x62\x08jA\xC3\x44}%\xD1O:\xBAs\xD1\x66I\x10r\x8C\x41\xBFY\r\xA5VP\xD0\x1E\xB6iC\xC9\x65 \xFF\xA9\x8E\x01\xEF\xAE@u\x14\x03\xE9\x34\x83\xBC\xED\x83\xBCW\xB8\xF0\xD9\x65\x41\x07\xA1\xB1 \x03\x39\xC6\x8C\xEF\x92\x81u\x10\x91\xB8\x38\x38*\"\x96m\xEB\fh\xFD%Z\xD7\x64GID^\xA4\x97Q\x8D\xB3\x1B\xE4O:\xC8\x9D\xD0\x89\xAF\xC4)6'\xD5\xB2.\xDD,kZ\xF0n|\x86kU\xB2V\x01\x65\x0F\xA4\xF1\xEC\xD8\xF6\x89\x7F\x14\xCD\v\x14\xAD\x19\xA0`\x9F)\nW\xB6\x9C\x39\xEB;\xBEJ\xD8\x11\xB8.\xB9\xCF\x81N{m\xE9\x65L\xD2?7\x19\x03\xB8\xB5\x95\x9C!\xDA\x82\x43\x45\x42<\xF3\x8B\xA7\xAB\xE1\x41\x06\x88\x31\x8D\xC8\x7F\xF2\x99\f\xEF\xC5%\x80\x9E\xAC\x93S\x07\x46\xE1l\xC7\x7F\x86\xAA\x05\x83%\xA1\xD9\x34\xAE\xF8\x04\xBCh\xAE");

422 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

423 
íd
;

424 i‡(
a
.
size
 >á.
Æloc
)

425 
íd
;

426 i‡(
a
.
ôem
[a.
size
])

427 
íd
;

428 i‡(
	`memcmp
(
a
.
ôem
, "\x1C\xBA\x07\x30\xD4|%e'yY\x7F\xE2\xD4~\xAB<\xEC%#\x80\xDC\x46\x65\xCA\x9D~\x86\xD6\x84\xF3\x38^\x90\x9A~F\x8F\xF7JH\xFC\xAB\x8Eo\x10W\x97\r\xDB\x36.\xEC\x92\xFBV\x11j\x98\xDAs\x1B&M\xB5\x1D\r\xCD\x14\x34\xA1\x96\xD5\xAD\x05)\xD0\xD9\xA5\xFA\xF3\xD9\x83n\x9A\x95\xDA\xB4\xF5\x1C\"6\x02\x36\x9B)\xA1\x35t+\xA9\xDBS\xD1\x42\x91\xCAr\x8Bq\xE9\x86\x18\xC2\xBE\xDC\xA3\xC4!\xCF\x33\xFE\x81^\x82\x35\x46\x31jG\xB3\x93\x8A\xB5\xD6\xC5\xE5IIVL.u\xD1\x91\"9\xB0\xAF\x86#\x8E\x81>\xC6\xC8\xF5\xAC\xD3\xA5\xC5O\x95\xCA\xAA\x93\x35\x9C\xE8\xB6R\x1F\xE4\xD8\r\xB5\x84K:\xBE\xF3\xDE\x9A\x83\xC8J\xD4\xD7\xBF\x84\x46\xE7\x05;\xFF}\xAAML\xF3\x65,\xA0\x8A\xBF\xA4\"\x9D\x0E*\xAE\x89NA \x12\xCD\xFC\x9A\xE2\xD9\xF0\x62\x08jA\xC3\x44}%\xD1O:\xBAs\xD1\x66I\x10r\x8C\x41\xBFY\r\xA5VP\xD0\x1E\xB6iC\xC9\x65 \xFF\xA9\x8E\x01\xEF\xAE@u\x14\x03\xE9\x34\x83\xBC\xED\x83\xBCW\xB8\xF0\xD9\x65\x41\x07\xA1\xB1 \x03\x39\xC6\x8C\xEF\x92\x81u\x10\x91\xB8\x38\x38*\"\x96m\xEB\fh\xFD%Z\xD7\x64GID^\xA4\x97Q\x8D\xB3\x1B\xE4O:\xC8\x9D\xD0\x89\xAF\xC4)6'\xD5\xB2.\xDD,kZ\xF0n|\x86kU\xB2V\x01\x65\x0F\xA4\xF1\xEC\xD8\xF6\x89\x7F\x14\xCD\v\x14\xAD\x19\xA0`\x9F)\nW\xB6\x9C\x39\xEB;\xBEJ\xD8\x11\xB8.\xB9\xCF\x81N{m\xE9\x65L\xD2?7\x19\x03\xB8\xB5\x95\x9C!\xDA\x82\x43\x45\x42<\xF3\x8B\xA7\xAB\xE1\x41\x06\x88\x31\x8D\xC8\x7F\xF2\x99\f\xEF\xC5%\x80\x9E\xAC\x93S\x07\x46\xE1l\xC7\x7F\x86\xAA\x05\x83%\xA1\xD9\x34\xAE\xF8\x04\xBCh\xAE",á.
size
-
ﬁdSize
))

429 
íd
;

430 
≠≥nd
.
ôem
 = 
	`°rdup
("\x1C\xBA\x07\x30\xD4|%e'yY\x7F\xE2\xD4~\xAB<\xEC%#\x80\xDC\x46\x65\xCA\x9D~\x86\xD6\x84\xF3\x38^\x90\x9A~F\x8F\xF7JH\xFC\xAB\x8Eo\x10W\x97\r\xDB\x36.\xEC\x92\xFBV\x11j\x98\xDAs\x1B&M\xB5\x1D\r\xCD\x14\x34\xA1\x96\xD5\xAD\x05)\xD0\xD9\xA5\xFA\xF3\xD9\x83n\x9A\x95\xDA\xB4\xF5\x1C\"6\x02\x36\x9B)\xA1\x35t+\xA9\xDBS\xD1\x42\x91\xCAr\x8Bq\xE9\x86\x18\xC2\xBE\xDC\xA3\xC4!\xCF\x33\xFE\x81^\x82\x35\x46\x31jG\xB3\x93\x8A\xB5\xD6\xC5\xE5IIVL.u\xD1\x91\"9\xB0\xAF\x86#\x8E\x81>\xC6\xC8\xF5\xAC\xD3\xA5\xC5O\x95\xCA\xAA\x93\x35\x9C\xE8\xB6R\x1F\xE4\xD8\r\xB5\x84K:\xBE\xF3\xDE\x9A\x83\xC8J\xD4\xD7\xBF\x84\x46\xE7\x05;\xFF}\xAAML\xF3\x65,\xA0\x8A\xBF\xA4\"\x9D\x0E*\xAE\x89NA \x12\xCD\xFC\x9A\xE2\xD9\xF0\x62\x08jA\xC3\x44}%\xD1O:\xBAs\xD1\x66I\x10r\x8C\x41\xBFY\r\xA5VP\xD0\x1E\xB6iC\xC9\x65 \xFF\xA9\x8E\x01\xEF\xAE@u\x14\x03\xE9\x34\x83\xBC\xED\x83\xBCW\xB8\xF0\xD9\x65\x41\x07\xA1\xB1 \x03\x39\xC6\x8C\xEF\x92\x81u\x10\x91\xB8\x38\x38*\"\x96m\xEB\fh\xFD%Z\xD7\x64GID^\xA4\x97Q\x8D\xB3\x1B\xE4O:\xC8\x9D\xD0\x89\xAF\xC4)6'\xD5\xB2.\xDD,kZ\xF0n|\x86kU\xB2V\x01\x65\x0F\xA4\xF1\xEC\xD8\xF6\x89\x7F\x14\xCD\v\x14\xAD\x19\xA0`\x9F)\nW\xB6\x9C\x39\xEB;\xBEJ\xD8\x11\xB8.\xB9\xCF\x81N{m\xE9\x65L\xD2?7\x19\x03\xB8\xB5\x95\x9C!\xDA\x82\x43\x45\x42<\xF3\x8B\xA7\xAB\xE1\x41\x06\x88\x31\x8D\xC8\x7F\xF2\x99\f\xEF\xC5%\x80\x9E\xAC\x93S\x07\x46\xE1l\xC7\x7F\x86\xAA\x05\x83%\xA1\xD9\x34\xAE\xF8\x04\xBCh\xAE");

431 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

432 
ã°sPas£d
++;

435 
≠≥nd
.
size
 = ("\xE8\xD1\x31")-1;

436 
ﬁdSize
 = 
a
.
size
;

437 
	`d¨øy_¥ïíd_lô
(
a
, "\xE8\xD1\x31");

438 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

439 
íd
;

440 i‡(
a
.
size
 >á.
Æloc
)

441 
íd
;

442 i‡(
a
.
ôem
[a.
size
])

443 
íd
;

444 i‡(
	`memcmp
(
a
.
ôem
, "\xE8\xD1\x31",á.
size
-
ﬁdSize
))

445 
íd
;

446 
≠≥nd
.
ôem
 = 
	`°rdup
("\xE8\xD1\x31");

447 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

448 
ã°sPas£d
++;

451 
≠≥nd
.
size
 = ("\\\x99{A\xC4\x86\xEA\xC4\x41]\xACi\x8C\x08\xFC?\x17\x9E\x90\x83<a\xB9n\xE7g\x04\xF8;\x97\x63=\x7FPy\xDB\xBCJ=\xDA\x13V{pg\xD4/\xB5\x1B\xDD&io\x9D?\xA7\x18,\xE4h\xE3\xB1]\xE4\xB5Iq\xDE\x02%\xBD\x9Al\x8Co\xEC")-1;

452 
ﬁdSize
 = 
a
.
size
;

453 
	`d¨øy_¥ïíd_lô
(
a
, "\\\x99{A\xC4\x86\xEA\xC4\x41]\xACi\x8C\x08\xFC?\x17\x9E\x90\x83<a\xB9n\xE7g\x04\xF8;\x97\x63=\x7FPy\xDB\xBCJ=\xDA\x13V{pg\xD4/\xB5\x1B\xDD&io\x9D?\xA7\x18,\xE4h\xE3\xB1]\xE4\xB5Iq\xDE\x02%\xBD\x9Al\x8Co\xEC");

454 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

455 
íd
;

456 i‡(
a
.
size
 >á.
Æloc
)

457 
íd
;

458 i‡(
a
.
ôem
[a.
size
])

459 
íd
;

460 i‡(
	`memcmp
(
a
.
ôem
, "\\\x99{A\xC4\x86\xEA\xC4\x41]\xACi\x8C\x08\xFC?\x17\x9E\x90\x83<a\xB9n\xE7g\x04\xF8;\x97\x63=\x7FPy\xDB\xBCJ=\xDA\x13V{pg\xD4/\xB5\x1B\xDD&io\x9D?\xA7\x18,\xE4h\xE3\xB1]\xE4\xB5Iq\xDE\x02%\xBD\x9Al\x8Co\xEC",á.
size
-
ﬁdSize
))

461 
íd
;

462 
≠≥nd
.
ôem
 = 
	`°rdup
("\\\x99{A\xC4\x86\xEA\xC4\x41]\xACi\x8C\x08\xFC?\x17\x9E\x90\x83<a\xB9n\xE7g\x04\xF8;\x97\x63=\x7FPy\xDB\xBCJ=\xDA\x13V{pg\xD4/\xB5\x1B\xDD&io\x9D?\xA7\x18,\xE4h\xE3\xB1]\xE4\xB5Iq\xDE\x02%\xBD\x9Al\x8Co\xEC");

463 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

464 
ã°sPas£d
++;

467 
≠≥nd
.
size
 = ("\x1A\xDD\xD2\xAE\xA7H\xB1\xD4J\xA0\xC5Y\x08\xC7Q\xD4\x41\x46\xA5\x1F\xE1\xEE\x14\x0EP\xFE\x14o\xEF\xB8\x33\x93\x43\xB5YEV3L\xF4\x9F=\x19P\x9B&\xE5\xA7\xF9\x63s\xCB\xCF\x87M^\x92\xB6TnT")-1;

468 
ﬁdSize
 = 
a
.
size
;

469 
	`d¨øy_¥ïíd_lô
(
a
, "\x1A\xDD\xD2\xAE\xA7H\xB1\xD4J\xA0\xC5Y\x08\xC7Q\xD4\x41\x46\xA5\x1F\xE1\xEE\x14\x0EP\xFE\x14o\xEF\xB8\x33\x93\x43\xB5YEV3L\xF4\x9F=\x19P\x9B&\xE5\xA7\xF9\x63s\xCB\xCF\x87M^\x92\xB6TnT");

470 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

471 
íd
;

472 i‡(
a
.
size
 >á.
Æloc
)

473 
íd
;

474 i‡(
a
.
ôem
[a.
size
])

475 
íd
;

476 i‡(
	`memcmp
(
a
.
ôem
, "\x1A\xDD\xD2\xAE\xA7H\xB1\xD4J\xA0\xC5Y\x08\xC7Q\xD4\x41\x46\xA5\x1F\xE1\xEE\x14\x0EP\xFE\x14o\xEF\xB8\x33\x93\x43\xB5YEV3L\xF4\x9F=\x19P\x9B&\xE5\xA7\xF9\x63s\xCB\xCF\x87M^\x92\xB6TnT",á.
size
-
ﬁdSize
))

477 
íd
;

478 
≠≥nd
.
ôem
 = 
	`°rdup
("\x1A\xDD\xD2\xAE\xA7H\xB1\xD4J\xA0\xC5Y\x08\xC7Q\xD4\x41\x46\xA5\x1F\xE1\xEE\x14\x0EP\xFE\x14o\xEF\xB8\x33\x93\x43\xB5YEV3L\xF4\x9F=\x19P\x9B&\xE5\xA7\xF9\x63s\xCB\xCF\x87M^\x92\xB6TnT");

479 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

480 
ã°sPas£d
++;

483 
≠≥nd
.
size
 = ("\xAF\x37\xE2\x8Bl\xD3\xB9]\x8E\xF9N\xB2@\xE7\x45\xF8\x99\x9E\x66\xB8\xD6\xE4\x82\x44\x89\xD7\x93\xCF\xDF\xA2\x32\x42\xC2\x66\xF6\xA4\x83\x19\x95\x90ts\x99/\xA7\x33\xCC\xA5ka\xC2\x1E\x39\x36\x63\x99\xF7\x10\\\r\xE4\\\xE3\xAD+\xB9\xFC\xB8\xAC\x82K\xD5\x17\x45\xE8\x85\x12\v\xD5\xC2\r\x10\xEF@\xCF\x8B\x7F[w\xFD\x98\xBB\xB0\x30\xEBo~\xE9\x61\x18\xB7(\x1E\x93\xC7\x42J\x9F\x99\xE2\x9B@P\x16\xF8\x19\x9Ak\x17*\xF4\x9C\xFD\xFE\xDF\x95\xC2\x8C/\xBC\xB9\x8B\xB5`\xABt]\xEAl\xB7\xAD\\kn_K\xAER\v\xA7\x8E\xEF\x45\xEAw\x1D\xC7\x85\xA3\xAC\x99tcd\\n\xFA\x8B.\xD7\x91\xEB\x8D\tkkJ\xDD\xD6\"\xC0\x44\x46\xD2\xDD\xDDzn\xA6\x8A\xE2\xE1\xA7Q\xE5\x39\xC0\xC9\xBB=1K\xEC\x9A\xC2\xF0\x1CjS}q\f\xE1\x41\xD6,\x05\xB4\x16R\x05\xD4H\x9Bv\x93\xB4\xD8\xF2}\x1F\x64\xD6r\xFF\x14\x13I'b\x99[\x92\x1E\x9B\xB2\x35\x02\xE9=8\xB9\xD9\xBB\xEB*\x97\x8A\xC8\xEB\xF4!\xE2<\x05\xC3g\x1Dx\xEA\xF5\x99\x83lT\x1E/\xB4\x37})z\xA3\xBE\xF0?\x1FsM1\x81\xC3\x8B\xEA\xF6\x8C\xC3\x11\x9E\xC0\x89\xFA}\x95|tW\x1B+\xBE\xFD\xE9\x44\x38\x1D\xD4\x01\x03\xCD<a\xC7l\xE3w")-1;

484 
ﬁdSize
 = 
a
.
size
;

485 
	`d¨øy_¥ïíd_lô
(
a
, "\xAF\x37\xE2\x8Bl\xD3\xB9]\x8E\xF9N\xB2@\xE7\x45\xF8\x99\x9E\x66\xB8\xD6\xE4\x82\x44\x89\xD7\x93\xCF\xDF\xA2\x32\x42\xC2\x66\xF6\xA4\x83\x19\x95\x90ts\x99/\xA7\x33\xCC\xA5ka\xC2\x1E\x39\x36\x63\x99\xF7\x10\\\r\xE4\\\xE3\xAD+\xB9\xFC\xB8\xAC\x82K\xD5\x17\x45\xE8\x85\x12\v\xD5\xC2\r\x10\xEF@\xCF\x8B\x7F[w\xFD\x98\xBB\xB0\x30\xEBo~\xE9\x61\x18\xB7(\x1E\x93\xC7\x42J\x9F\x99\xE2\x9B@P\x16\xF8\x19\x9Ak\x17*\xF4\x9C\xFD\xFE\xDF\x95\xC2\x8C/\xBC\xB9\x8B\xB5`\xABt]\xEAl\xB7\xAD\\kn_K\xAER\v\xA7\x8E\xEF\x45\xEAw\x1D\xC7\x85\xA3\xAC\x99tcd\\n\xFA\x8B.\xD7\x91\xEB\x8D\tkkJ\xDD\xD6\"\xC0\x44\x46\xD2\xDD\xDDzn\xA6\x8A\xE2\xE1\xA7Q\xE5\x39\xC0\xC9\xBB=1K\xEC\x9A\xC2\xF0\x1CjS}q\f\xE1\x41\xD6,\x05\xB4\x16R\x05\xD4H\x9Bv\x93\xB4\xD8\xF2}\x1F\x64\xD6r\xFF\x14\x13I'b\x99[\x92\x1E\x9B\xB2\x35\x02\xE9=8\xB9\xD9\xBB\xEB*\x97\x8A\xC8\xEB\xF4!\xE2<\x05\xC3g\x1Dx\xEA\xF5\x99\x83lT\x1E/\xB4\x37})z\xA3\xBE\xF0?\x1FsM1\x81\xC3\x8B\xEA\xF6\x8C\xC3\x11\x9E\xC0\x89\xFA}\x95|tW\x1B+\xBE\xFD\xE9\x44\x38\x1D\xD4\x01\x03\xCD<a\xC7l\xE3w");

486 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

487 
íd
;

488 i‡(
a
.
size
 >á.
Æloc
)

489 
íd
;

490 i‡(
a
.
ôem
[a.
size
])

491 
íd
;

492 i‡(
	`memcmp
(
a
.
ôem
, "\xAF\x37\xE2\x8Bl\xD3\xB9]\x8E\xF9N\xB2@\xE7\x45\xF8\x99\x9E\x66\xB8\xD6\xE4\x82\x44\x89\xD7\x93\xCF\xDF\xA2\x32\x42\xC2\x66\xF6\xA4\x83\x19\x95\x90ts\x99/\xA7\x33\xCC\xA5ka\xC2\x1E\x39\x36\x63\x99\xF7\x10\\\r\xE4\\\xE3\xAD+\xB9\xFC\xB8\xAC\x82K\xD5\x17\x45\xE8\x85\x12\v\xD5\xC2\r\x10\xEF@\xCF\x8B\x7F[w\xFD\x98\xBB\xB0\x30\xEBo~\xE9\x61\x18\xB7(\x1E\x93\xC7\x42J\x9F\x99\xE2\x9B@P\x16\xF8\x19\x9Ak\x17*\xF4\x9C\xFD\xFE\xDF\x95\xC2\x8C/\xBC\xB9\x8B\xB5`\xABt]\xEAl\xB7\xAD\\kn_K\xAER\v\xA7\x8E\xEF\x45\xEAw\x1D\xC7\x85\xA3\xAC\x99tcd\\n\xFA\x8B.\xD7\x91\xEB\x8D\tkkJ\xDD\xD6\"\xC0\x44\x46\xD2\xDD\xDDzn\xA6\x8A\xE2\xE1\xA7Q\xE5\x39\xC0\xC9\xBB=1K\xEC\x9A\xC2\xF0\x1CjS}q\f\xE1\x41\xD6,\x05\xB4\x16R\x05\xD4H\x9Bv\x93\xB4\xD8\xF2}\x1F\x64\xD6r\xFF\x14\x13I'b\x99[\x92\x1E\x9B\xB2\x35\x02\xE9=8\xB9\xD9\xBB\xEB*\x97\x8A\xC8\xEB\xF4!\xE2<\x05\xC3g\x1Dx\xEA\xF5\x99\x83lT\x1E/\xB4\x37})z\xA3\xBE\xF0?\x1FsM1\x81\xC3\x8B\xEA\xF6\x8C\xC3\x11\x9E\xC0\x89\xFA}\x95|tW\x1B+\xBE\xFD\xE9\x44\x38\x1D\xD4\x01\x03\xCD<a\xC7l\xE3w",á.
size
-
ﬁdSize
))

493 
íd
;

494 
≠≥nd
.
ôem
 = 
	`°rdup
("\xAF\x37\xE2\x8Bl\xD3\xB9]\x8E\xF9N\xB2@\xE7\x45\xF8\x99\x9E\x66\xB8\xD6\xE4\x82\x44\x89\xD7\x93\xCF\xDF\xA2\x32\x42\xC2\x66\xF6\xA4\x83\x19\x95\x90ts\x99/\xA7\x33\xCC\xA5ka\xC2\x1E\x39\x36\x63\x99\xF7\x10\\\r\xE4\\\xE3\xAD+\xB9\xFC\xB8\xAC\x82K\xD5\x17\x45\xE8\x85\x12\v\xD5\xC2\r\x10\xEF@\xCF\x8B\x7F[w\xFD\x98\xBB\xB0\x30\xEBo~\xE9\x61\x18\xB7(\x1E\x93\xC7\x42J\x9F\x99\xE2\x9B@P\x16\xF8\x19\x9Ak\x17*\xF4\x9C\xFD\xFE\xDF\x95\xC2\x8C/\xBC\xB9\x8B\xB5`\xABt]\xEAl\xB7\xAD\\kn_K\xAER\v\xA7\x8E\xEF\x45\xEAw\x1D\xC7\x85\xA3\xAC\x99tcd\\n\xFA\x8B.\xD7\x91\xEB\x8D\tkkJ\xDD\xD6\"\xC0\x44\x46\xD2\xDD\xDDzn\xA6\x8A\xE2\xE1\xA7Q\xE5\x39\xC0\xC9\xBB=1K\xEC\x9A\xC2\xF0\x1CjS}q\f\xE1\x41\xD6,\x05\xB4\x16R\x05\xD4H\x9Bv\x93\xB4\xD8\xF2}\x1F\x64\xD6r\xFF\x14\x13I'b\x99[\x92\x1E\x9B\xB2\x35\x02\xE9=8\xB9\xD9\xBB\xEB*\x97\x8A\xC8\xEB\xF4!\xE2<\x05\xC3g\x1Dx\xEA\xF5\x99\x83lT\x1E/\xB4\x37})z\xA3\xBE\xF0?\x1FsM1\x81\xC3\x8B\xEA\xF6\x8C\xC3\x11\x9E\xC0\x89\xFA}\x95|tW\x1B+\xBE\xFD\xE9\x44\x38\x1D\xD4\x01\x03\xCD<a\xC7l\xE3w");

495 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

496 
ã°sPas£d
++;

499 
≠≥nd
.
size
 = ("J\x8E\x1A\xBB\x35\xF4\xEDQ\xE5\xE6|Z[\x04\x37\xC7\xCB\xAB~\x07P\xFE\r9\xF4\x9A\x07\x02P\xB1{\xF9\x42\x1E\x91\x9A\xFC\x8E?\x17\x61Y\xDFIq\x9E\x03\xC7\xB4\xBC\xAA\x1E\xE6\xA4y\x15\x8D\x06\x42\x39\x1D\xDB\xC8\xC2O\xA4\xEA\xF9\xAC\x08\xF6\x1E\xD6\v\t\x14<u\xCC\x0E\xBA.f\xADQga)\x8B\x87\x65(%\xF1M\x88,C\x7FVx\x99\xCBp\xC8\xD3Pk\xC8;\r\xF7\xCE A\x11\xCA\x9A\xA6GW\x8E\x16\xAC\x30\xA8R\x12>\xC8\xCF\x30\x17\x1C\x16\x99\v\xA2\xC3Q{\x17\xB5|4\xC4On\x11\xBC\x46SL\xE1\x61\x1A\xE5W\xFF:\xA0\xDA\xBD\x95\xCBG\xAD(\xAE)-\\\x8F\x64\x95\v\xCB\xE1")-1;

500 
ﬁdSize
 = 
a
.
size
;

501 
	`d¨øy_¥ïíd_lô
(
a
, "J\x8E\x1A\xBB\x35\xF4\xEDQ\xE5\xE6|Z[\x04\x37\xC7\xCB\xAB~\x07P\xFE\r9\xF4\x9A\x07\x02P\xB1{\xF9\x42\x1E\x91\x9A\xFC\x8E?\x17\x61Y\xDFIq\x9E\x03\xC7\xB4\xBC\xAA\x1E\xE6\xA4y\x15\x8D\x06\x42\x39\x1D\xDB\xC8\xC2O\xA4\xEA\xF9\xAC\x08\xF6\x1E\xD6\v\t\x14<u\xCC\x0E\xBA.f\xADQga)\x8B\x87\x65(%\xF1M\x88,C\x7FVx\x99\xCBp\xC8\xD3Pk\xC8;\r\xF7\xCE A\x11\xCA\x9A\xA6GW\x8E\x16\xAC\x30\xA8R\x12>\xC8\xCF\x30\x17\x1C\x16\x99\v\xA2\xC3Q{\x17\xB5|4\xC4On\x11\xBC\x46SL\xE1\x61\x1A\xE5W\xFF:\xA0\xDA\xBD\x95\xCBG\xAD(\xAE)-\\\x8F\x64\x95\v\xCB\xE1");

502 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

503 
íd
;

504 i‡(
a
.
size
 >á.
Æloc
)

505 
íd
;

506 i‡(
a
.
ôem
[a.
size
])

507 
íd
;

508 i‡(
	`memcmp
(
a
.
ôem
, "J\x8E\x1A\xBB\x35\xF4\xEDQ\xE5\xE6|Z[\x04\x37\xC7\xCB\xAB~\x07P\xFE\r9\xF4\x9A\x07\x02P\xB1{\xF9\x42\x1E\x91\x9A\xFC\x8E?\x17\x61Y\xDFIq\x9E\x03\xC7\xB4\xBC\xAA\x1E\xE6\xA4y\x15\x8D\x06\x42\x39\x1D\xDB\xC8\xC2O\xA4\xEA\xF9\xAC\x08\xF6\x1E\xD6\v\t\x14<u\xCC\x0E\xBA.f\xADQga)\x8B\x87\x65(%\xF1M\x88,C\x7FVx\x99\xCBp\xC8\xD3Pk\xC8;\r\xF7\xCE A\x11\xCA\x9A\xA6GW\x8E\x16\xAC\x30\xA8R\x12>\xC8\xCF\x30\x17\x1C\x16\x99\v\xA2\xC3Q{\x17\xB5|4\xC4On\x11\xBC\x46SL\xE1\x61\x1A\xE5W\xFF:\xA0\xDA\xBD\x95\xCBG\xAD(\xAE)-\\\x8F\x64\x95\v\xCB\xE1",á.
size
-
ﬁdSize
))

509 
íd
;

510 
≠≥nd
.
ôem
 = 
	`°rdup
("J\x8E\x1A\xBB\x35\xF4\xEDQ\xE5\xE6|Z[\x04\x37\xC7\xCB\xAB~\x07P\xFE\r9\xF4\x9A\x07\x02P\xB1{\xF9\x42\x1E\x91\x9A\xFC\x8E?\x17\x61Y\xDFIq\x9E\x03\xC7\xB4\xBC\xAA\x1E\xE6\xA4y\x15\x8D\x06\x42\x39\x1D\xDB\xC8\xC2O\xA4\xEA\xF9\xAC\x08\xF6\x1E\xD6\v\t\x14<u\xCC\x0E\xBA.f\xADQga)\x8B\x87\x65(%\xF1M\x88,C\x7FVx\x99\xCBp\xC8\xD3Pk\xC8;\r\xF7\xCE A\x11\xCA\x9A\xA6GW\x8E\x16\xAC\x30\xA8R\x12>\xC8\xCF\x30\x17\x1C\x16\x99\v\xA2\xC3Q{\x17\xB5|4\xC4On\x11\xBC\x46SL\xE1\x61\x1A\xE5W\xFF:\xA0\xDA\xBD\x95\xCBG\xAD(\xAE)-\\\x8F\x64\x95\v\xCB\xE1");

511 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

512 
ã°sPas£d
++;

515 
≠≥nd
.
size
 = ("DM\x8D]\x92\xC8\x33Y\x8F\x04\x1C?\xB5I\xE9\xEF\xCC\xD4\xB8\xBF\xE9\xC1x\xEA\x46\xB5kQN\xBFLoT\xB4-v\xF5\x31\xD8\xC8\xD3\xF8;r\xE7\xE2\x62\xEF\xA8\xD8O+_M\xED\x16=6|\x86@\x1C\xF1t\x81^\xD1\x8D\xD7\x87\"g?D'\x90[\xBC\x9D\x62\f\xC8W\xD0\xE8\x14\x12o\x80;\n{\x1B\xC0\xD4\xBA\x13\xCD\x8CV\xB5\xFA\xCA&31\xBF\x1DIh\x18\xFB\x0E\xB2\x08i,\xA1\xCE\x9F\xCB\x9F)\xF6\x9E\x46\x95\x8A\xE2\xB3\x99\x36\x65\t\x1C\xFF\x8Bl=u\xBFzf\x9BI\t\xCDP6\x13\x84\x44\xFD\xDE\r\xB2\x36<\xF6\x1F\xEE_\xCC\x86<\x99\x1C\xDC\xAA\xE6Q\x08\xE0\xEC\x66\x11\xDD\xE8\xED\xD0\xCF+\x88\x43\x9B\x92\xE6\xE9mQ\xE0\x32\xD8h\x87\x8D\xB8\xA6r\x03\x80\x8E\xF5\xDB\xB8\xAE<\x17\x8B\xC4\xF2l\x90){\xF4\x84\t\xC5\x80H\xE2k\xFC\xD2\x0F\xBC\xB0\x1D\xE3Y\x8E#bk\xFE+\xCA\x84\xF0\x83\x14o\xA3(\xE5\v\x90\x8Ap\xD8S\xEDkg\x19\x66\xD0\x8Eo\x87\xEC\x44ymR\xEEI\x81\xC6Q>Xp\x8F\xB4\x64\xB5\x8Ar:\x10\xAD\x19/Y\xE2\xDF\xB8\xAA\xF9\x8F\xFD|\x94\xB5&|\x97\x05\x07\x91`v\xA3\xA2\xF9\xDEg\x8E\xF0\x9E}$\xDA\x63`\xCC\x38\xA8\xA2\x9D\v\f\xFC%\xFE\xCD\x30\x39\xEE\xECI\xAA\x18\x93\xC3\x33\x85\x9B\xA2\xF1\xBB%~\xC2")-1;

516 
ﬁdSize
 = 
a
.
size
;

517 
	`d¨øy_¥ïíd_lô
(
a
, "DM\x8D]\x92\xC8\x33Y\x8F\x04\x1C?\xB5I\xE9\xEF\xCC\xD4\xB8\xBF\xE9\xC1x\xEA\x46\xB5kQN\xBFLoT\xB4-v\xF5\x31\xD8\xC8\xD3\xF8;r\xE7\xE2\x62\xEF\xA8\xD8O+_M\xED\x16=6|\x86@\x1C\xF1t\x81^\xD1\x8D\xD7\x87\"g?D'\x90[\xBC\x9D\x62\f\xC8W\xD0\xE8\x14\x12o\x80;\n{\x1B\xC0\xD4\xBA\x13\xCD\x8CV\xB5\xFA\xCA&31\xBF\x1DIh\x18\xFB\x0E\xB2\x08i,\xA1\xCE\x9F\xCB\x9F)\xF6\x9E\x46\x95\x8A\xE2\xB3\x99\x36\x65\t\x1C\xFF\x8Bl=u\xBFzf\x9BI\t\xCDP6\x13\x84\x44\xFD\xDE\r\xB2\x36<\xF6\x1F\xEE_\xCC\x86<\x99\x1C\xDC\xAA\xE6Q\x08\xE0\xEC\x66\x11\xDD\xE8\xED\xD0\xCF+\x88\x43\x9B\x92\xE6\xE9mQ\xE0\x32\xD8h\x87\x8D\xB8\xA6r\x03\x80\x8E\xF5\xDB\xB8\xAE<\x17\x8B\xC4\xF2l\x90){\xF4\x84\t\xC5\x80H\xE2k\xFC\xD2\x0F\xBC\xB0\x1D\xE3Y\x8E#bk\xFE+\xCA\x84\xF0\x83\x14o\xA3(\xE5\v\x90\x8Ap\xD8S\xEDkg\x19\x66\xD0\x8Eo\x87\xEC\x44ymR\xEEI\x81\xC6Q>Xp\x8F\xB4\x64\xB5\x8Ar:\x10\xAD\x19/Y\xE2\xDF\xB8\xAA\xF9\x8F\xFD|\x94\xB5&|\x97\x05\x07\x91`v\xA3\xA2\xF9\xDEg\x8E\xF0\x9E}$\xDA\x63`\xCC\x38\xA8\xA2\x9D\v\f\xFC%\xFE\xCD\x30\x39\xEE\xECI\xAA\x18\x93\xC3\x33\x85\x9B\xA2\xF1\xBB%~\xC2");

518 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

519 
íd
;

520 i‡(
a
.
size
 >á.
Æloc
)

521 
íd
;

522 i‡(
a
.
ôem
[a.
size
])

523 
íd
;

524 i‡(
	`memcmp
(
a
.
ôem
, "DM\x8D]\x92\xC8\x33Y\x8F\x04\x1C?\xB5I\xE9\xEF\xCC\xD4\xB8\xBF\xE9\xC1x\xEA\x46\xB5kQN\xBFLoT\xB4-v\xF5\x31\xD8\xC8\xD3\xF8;r\xE7\xE2\x62\xEF\xA8\xD8O+_M\xED\x16=6|\x86@\x1C\xF1t\x81^\xD1\x8D\xD7\x87\"g?D'\x90[\xBC\x9D\x62\f\xC8W\xD0\xE8\x14\x12o\x80;\n{\x1B\xC0\xD4\xBA\x13\xCD\x8CV\xB5\xFA\xCA&31\xBF\x1DIh\x18\xFB\x0E\xB2\x08i,\xA1\xCE\x9F\xCB\x9F)\xF6\x9E\x46\x95\x8A\xE2\xB3\x99\x36\x65\t\x1C\xFF\x8Bl=u\xBFzf\x9BI\t\xCDP6\x13\x84\x44\xFD\xDE\r\xB2\x36<\xF6\x1F\xEE_\xCC\x86<\x99\x1C\xDC\xAA\xE6Q\x08\xE0\xEC\x66\x11\xDD\xE8\xED\xD0\xCF+\x88\x43\x9B\x92\xE6\xE9mQ\xE0\x32\xD8h\x87\x8D\xB8\xA6r\x03\x80\x8E\xF5\xDB\xB8\xAE<\x17\x8B\xC4\xF2l\x90){\xF4\x84\t\xC5\x80H\xE2k\xFC\xD2\x0F\xBC\xB0\x1D\xE3Y\x8E#bk\xFE+\xCA\x84\xF0\x83\x14o\xA3(\xE5\v\x90\x8Ap\xD8S\xEDkg\x19\x66\xD0\x8Eo\x87\xEC\x44ymR\xEEI\x81\xC6Q>Xp\x8F\xB4\x64\xB5\x8Ar:\x10\xAD\x19/Y\xE2\xDF\xB8\xAA\xF9\x8F\xFD|\x94\xB5&|\x97\x05\x07\x91`v\xA3\xA2\xF9\xDEg\x8E\xF0\x9E}$\xDA\x63`\xCC\x38\xA8\xA2\x9D\v\f\xFC%\xFE\xCD\x30\x39\xEE\xECI\xAA\x18\x93\xC3\x33\x85\x9B\xA2\xF1\xBB%~\xC2",á.
size
-
ﬁdSize
))

525 
íd
;

526 
≠≥nd
.
ôem
 = 
	`°rdup
("DM\x8D]\x92\xC8\x33Y\x8F\x04\x1C?\xB5I\xE9\xEF\xCC\xD4\xB8\xBF\xE9\xC1x\xEA\x46\xB5kQN\xBFLoT\xB4-v\xF5\x31\xD8\xC8\xD3\xF8;r\xE7\xE2\x62\xEF\xA8\xD8O+_M\xED\x16=6|\x86@\x1C\xF1t\x81^\xD1\x8D\xD7\x87\"g?D'\x90[\xBC\x9D\x62\f\xC8W\xD0\xE8\x14\x12o\x80;\n{\x1B\xC0\xD4\xBA\x13\xCD\x8CV\xB5\xFA\xCA&31\xBF\x1DIh\x18\xFB\x0E\xB2\x08i,\xA1\xCE\x9F\xCB\x9F)\xF6\x9E\x46\x95\x8A\xE2\xB3\x99\x36\x65\t\x1C\xFF\x8Bl=u\xBFzf\x9BI\t\xCDP6\x13\x84\x44\xFD\xDE\r\xB2\x36<\xF6\x1F\xEE_\xCC\x86<\x99\x1C\xDC\xAA\xE6Q\x08\xE0\xEC\x66\x11\xDD\xE8\xED\xD0\xCF+\x88\x43\x9B\x92\xE6\xE9mQ\xE0\x32\xD8h\x87\x8D\xB8\xA6r\x03\x80\x8E\xF5\xDB\xB8\xAE<\x17\x8B\xC4\xF2l\x90){\xF4\x84\t\xC5\x80H\xE2k\xFC\xD2\x0F\xBC\xB0\x1D\xE3Y\x8E#bk\xFE+\xCA\x84\xF0\x83\x14o\xA3(\xE5\v\x90\x8Ap\xD8S\xEDkg\x19\x66\xD0\x8Eo\x87\xEC\x44ymR\xEEI\x81\xC6Q>Xp\x8F\xB4\x64\xB5\x8Ar:\x10\xAD\x19/Y\xE2\xDF\xB8\xAA\xF9\x8F\xFD|\x94\xB5&|\x97\x05\x07\x91`v\xA3\xA2\xF9\xDEg\x8E\xF0\x9E}$\xDA\x63`\xCC\x38\xA8\xA2\x9D\v\f\xFC%\xFE\xCD\x30\x39\xEE\xECI\xAA\x18\x93\xC3\x33\x85\x9B\xA2\xF1\xBB%~\xC2");

527 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

528 
ã°sPas£d
++;

531 
≠≥nd
.
size
 = ("D\x16\xB9\x17yF\xDA\x32\x41\xF4\f\x04\x90\x45\x81\xB0\re\xDD\xC3\x65T\xDF>X\x03!)\xBDUY\xD8\x05\x35\xE6\x12\xA4z0\x1B\xD4\x45-\x17S\xBA%E\xF8\xFB\x32\x8B\x1B\xC0\x91\x39/\xD6\f^B\x01\x43/\x83\xD6`)\xD6\xAD\"\x9C\xD5\x32\xA5\xDC\x39\xC6We\xEB\x32p\xB9n\x89\x41\xBE\x18\xEF\x94\xE4h'\xEDY\xA6\x91\xC3\xD8\x06\xAC;:\xA6M\x7F\r\x07\xDB\x15q5R\xDC\xB2\x05\xAFU=\x1Ax\x86\x13T\x1B\x17\x8Ds\x8F\xF1-\xDD\xCD\x18\xB1\x16\xDF\x80x\v\x85\xDA\xFA\x90\x83\x86\x38x\xC6\xF2\x98\xF8\r\xDF\xC8q\xB5\xA2T=\x08\xB0M\x0E\x0F\x9B\x1C<\xC6\x86\xA8\x8BJ0\xFF\xD2\x1B\xCAh\x93\x32\xBE<\xDF\x7F\xD9\x1C\x16h{Hs\x85\xA1\f\x06\x93\xE4%\x95J\xDE\xAB\x45 \x89Pv\x05o\x02.\r\xA0\x8E\x86\xDF\x34X|*\x14G\x8D\x94)\xFE\xA5\x0Er\xC5\xD6o*us\xE5\x02\xAF\x85\xC7\xEF\x61G6\xEA$X9P\xE9~\x9D\xF5\x99\x8D=\xB7\x8FO\x97\xFA\"\xFF\x41\x41j\xE9\x61\x62\x1D]\xA2\x63\xCD\xC0\r\x83S\x15\x85\x7F\xA4\xA8\f\xE8\x82\xAC\xDC\xF5\x8B\xF2h\x81\xE7.\x92\x9F\x84\xB9J\x03\xD3\xD5<\x90")-1;

532 
ﬁdSize
 = 
a
.
size
;

533 
	`d¨øy_¥ïíd_lô
(
a
, "D\x16\xB9\x17yF\xDA\x32\x41\xF4\f\x04\x90\x45\x81\xB0\re\xDD\xC3\x65T\xDF>X\x03!)\xBDUY\xD8\x05\x35\xE6\x12\xA4z0\x1B\xD4\x45-\x17S\xBA%E\xF8\xFB\x32\x8B\x1B\xC0\x91\x39/\xD6\f^B\x01\x43/\x83\xD6`)\xD6\xAD\"\x9C\xD5\x32\xA5\xDC\x39\xC6We\xEB\x32p\xB9n\x89\x41\xBE\x18\xEF\x94\xE4h'\xEDY\xA6\x91\xC3\xD8\x06\xAC;:\xA6M\x7F\r\x07\xDB\x15q5R\xDC\xB2\x05\xAFU=\x1Ax\x86\x13T\x1B\x17\x8Ds\x8F\xF1-\xDD\xCD\x18\xB1\x16\xDF\x80x\v\x85\xDA\xFA\x90\x83\x86\x38x\xC6\xF2\x98\xF8\r\xDF\xC8q\xB5\xA2T=\x08\xB0M\x0E\x0F\x9B\x1C<\xC6\x86\xA8\x8BJ0\xFF\xD2\x1B\xCAh\x93\x32\xBE<\xDF\x7F\xD9\x1C\x16h{Hs\x85\xA1\f\x06\x93\xE4%\x95J\xDE\xAB\x45 \x89Pv\x05o\x02.\r\xA0\x8E\x86\xDF\x34X|*\x14G\x8D\x94)\xFE\xA5\x0Er\xC5\xD6o*us\xE5\x02\xAF\x85\xC7\xEF\x61G6\xEA$X9P\xE9~\x9D\xF5\x99\x8D=\xB7\x8FO\x97\xFA\"\xFF\x41\x41j\xE9\x61\x62\x1D]\xA2\x63\xCD\xC0\r\x83S\x15\x85\x7F\xA4\xA8\f\xE8\x82\xAC\xDC\xF5\x8B\xF2h\x81\xE7.\x92\x9F\x84\xB9J\x03\xD3\xD5<\x90");

534 i‡(
a
.
size
 !
ﬁdSize
+
≠≥nd
.size)

535 
íd
;

536 i‡(
a
.
size
 >á.
Æloc
)

537 
íd
;

538 i‡(
a
.
ôem
[a.
size
])

539 
íd
;

540 i‡(
	`memcmp
(
a
.
ôem
, "D\x16\xB9\x17yF\xDA\x32\x41\xF4\f\x04\x90\x45\x81\xB0\ª\xDD\xC3\x65T\xDF>X\x03!)\xBDUY\xD8\x05\x35\xE6\x12\xA4z0\x1B\xD4\x45-\x17S\xBA%E\xF8\xFB\x32\x8B\x1B\xC0\x91\x39/\xD6\f^B\x01\x43/\x83\xD6`)\xD6\xAD\"\x9C\xD5\x32\xA5\xDC\x39\xC6We\xEB\x32p\xB9n\x89\x41\xBE\x18\xEF\x94\xE4h'\xEDY\xA6\x91\xC3\xD8\x06\xAC;:\xA6M\x7F\r\x07\xDB\x15q5R\xDC\xB2\x05\xAFU=\x1Ax\x86\x13T\x1B\x17\x8Ds\x8F\xF1-\xDD\xCD\x18\xB1\x16\xDF\x80x\v\x85\xDA\xFA\x90\x83\x86\x38x\xC6\xF2\x98\xF8\r\xDF\xC8q\xB5\xA2T=\x08\xB0M\x0E\x0F\x9B\x1C<\xC6\x86\xA8\x8BJ0\xFF\xD2\x1B\xCAh\x93\x32\xBE<\xDF\x7F\xD9\x1C\x16h{Hs\x85\xA1\f\x06\x93\xE4%\x95J\xDE\xAB\x45 \x89Pv\x05o\x02.\r\xA0\x8E\x86\xDF\x34X|*\x14G\x8D\x94)\xFE\xA5\x0Er\xC5\xD6o*us\xE5\x02\xAF\x85\xC7\xEF\x61G6\xEA$X9P\xE9~\x9D\xF5\x99\x8D=\xB7\x8FO\x97\xFA\"\xFF\x41\x41j\xE9\x61\x62\x1D]\xA2\x63\xCD\xC0\r\x83S\x15\x85\x7F\xA4\xA8\f\xE8\x82\xAC\xDC\xF5\x8B\xF2h\x81\xE7.\x92\x9F\x84\xB9J\x03\xD3\xD5<\x90",á.
size
-
ﬁdSize
))

541 
íd
;

542 
≠≥nd
.
ôem
 = 
	`°rdup
("D\x16\xB9\x17yF\xDA\x32\x41\xF4\f\x04\x90\x45\x81\xB0\re\xDD\xC3\x65T\xDF>X\x03!)\xBDUY\xD8\x05\x35\xE6\x12\xA4z0\x1B\xD4\x45-\x17S\xBA%E\xF8\xFB\x32\x8B\x1B\xC0\x91\x39/\xD6\f^B\x01\x43/\x83\xD6`)\xD6\xAD\"\x9C\xD5\x32\xA5\xDC\x39\xC6We\xEB\x32p\xB9n\x89\x41\xBE\x18\xEF\x94\xE4h'\xEDY\xA6\x91\xC3\xD8\x06\xAC;:\xA6M\x7F\r\x07\xDB\x15q5R\xDC\xB2\x05\xAFU=\x1Ax\x86\x13T\x1B\x17\x8Ds\x8F\xF1-\xDD\xCD\x18\xB1\x16\xDF\x80x\v\x85\xDA\xFA\x90\x83\x86\x38x\xC6\xF2\x98\xF8\r\xDF\xC8q\xB5\xA2T=\x08\xB0M\x0E\x0F\x9B\x1C<\xC6\x86\xA8\x8BJ0\xFF\xD2\x1B\xCAh\x93\x32\xBE<\xDF\x7F\xD9\x1C\x16h{Hs\x85\xA1\f\x06\x93\xE4%\x95J\xDE\xAB\x45 \x89Pv\x05o\x02.\r\xA0\x8E\x86\xDF\x34X|*\x14G\x8D\x94)\xFE\xA5\x0Er\xC5\xD6o*us\xE5\x02\xAF\x85\xC7\xEF\x61G6\xEA$X9P\xE9~\x9D\xF5\x99\x8D=\xB7\x8FO\x97\xFA\"\xFF\x41\x41j\xE9\x61\x62\x1D]\xA2\x63\xCD\xC0\r\x83S\x15\x85\x7F\xA4\xA8\f\xE8\x82\xAC\xDC\xF5\x8B\xF2h\x81\xE7.\x92\x9F\x84\xB9J\x03\xD3\xD5<\x90");

543 
	`d¨øy_≠≥nd
(
°rögs
, 
≠≥nd
);

544 
ã°sPas£d
++;

547 
offs
 = 
a
.
size
;

548 i‡(
a
.
ôem
[
offs
])

549 
íd
;

550 i‡(
°rögs
.
size
 != 10)

551 
íd
;

552 
	`d¨øy_f‹óch
(
i
, 
°rögs
) {

553 i‡(
offs
 < 
i
->
size
)

554 
íd
;

555 
offs
 -
i
->
size
;

556 i‡(
	`memcmp
(
a
.
ôem
+
offs
, 
i
->ôem, i->
size
))

557 
íd
;

559 i‡(
offs
)

560 
íd
;

561 
ã°sPas£d
++;

563 
íd
:

564 
	`d¨øy_‰ì
(
a
);

565 
	`d¨øy_f‹óch
(
i
, 
°rögs
)

566 
	`‰ì
(
i
->
ôem
);

567 
	`d¨øy_‰ì
(
°rögs
);

568  
ã°sPas£d
 == 10+1;

569 
	}
}

	@ccan/ccan/dgraph/dgraph.c

2 
	~<cˇn/dgøph/dgøph.h
>

3 
	~<°dlib.h
>

4 
	~<°dio.h
>

6 
	$dgøph_öô_node
(
dgøph_node
 *
n
)

8 
	`éi°_öô
(&
n
->
edge
[
DGRAPH_FROM
]);

9 
	`éi°_öô
(&
n
->
edge
[
DGRAPH_TO
]);

10 
	}
}

12 
	$‰ì_edge
(
dgøph_edge
 *
e
)

14 
	`éi°_dñ_‰om
(&
e
->
n
[
DGRAPH_FROM
]->
edge
[DGRAPH_FROM],

15 
e
, 
li°
[
DGRAPH_FROM
]);

16 
	`éi°_dñ_‰om
(&
e
->
n
[
DGRAPH_TO
]->
edge
[DGRAPH_TO],

17 
e
, 
li°
[
DGRAPH_TO
]);

18 
	`‰ì
(
e
);

19 
	}
}

21 
	$dgøph_˛ór_node
(
dgøph_node
 *
n
)

23 
dgøph_edge
 *
e
;

24 
i
;

26 ()
	`dgøph_debug
(
n
);

27 
i
 = 
DGRAPH_FROM
; i <
DGRAPH_TO
; i++) {

28 (
e
 = 
	`éi°_t›
(&
n
->
edge
[
i
], 
li°
[i])Ë!
NULL
) {

29 
	`as£π
(
e
->
n
[
i
] ==Ç);

30 
	`‰ì_edge
(
e
);

33 
	}
}

35 
	$dgøph_add_edge
(
dgøph_node
 *
‰om
, dgøph_nodê*
to
)

37 
dgøph_edge
 *
e
 = 
	`mÆloc
((*e));

39 ()
	`dgøph_debug
(
‰om
);

40 ()
	`dgøph_debug
(
to
);

41 
e
->
n
[
DGRAPH_FROM
] = 
‰om
;

42 
e
->
n
[
DGRAPH_TO
] = 
to
;

43 
	`éi°_add
(&
‰om
->
edge
[
DGRAPH_FROM
], 
e
, 
li°
[DGRAPH_FROM]);

44 
	`éi°_add
(&
to
->
edge
[
DGRAPH_TO
], 
e
, 
li°
[DGRAPH_TO]);

45 
	}
}

47 
boﬁ
 
	$dgøph_dñ_edge
(
dgøph_node
 *
‰om
, dgøph_nodê*
to
)

49 
dgøph_edge
 *
e
, *
√xt
;

51 ()
	`dgøph_debug
(
‰om
);

52 ()
	`dgøph_debug
(
to
);

53 
	`dgøph_f‹_óch_edge_ß„
(
‰om
, 
e
, 
√xt
, 
DGRAPH_FROM
) {

54 i‡(
e
->
n
[
DGRAPH_TO
] =
to
) {

55 
	`‰ì_edge
(
e
);

56  
åue
;

59  
Ál£
;

60 
	}
}

62 
boﬁ
 
åavî£_dïth_fú°
(
dgøph_node
 *
n
,

63 
dgøph_dú
 
dú
,

64 
	$boﬁ
 (*
‚
)(
dgøph_node
 *, *),

65 c⁄° *
d©a
)

67 
dgøph_edge
 *
e
, *
√xt
;

70 
	`éi°_f‹_óch_ß„
(&
n
->
edge
[
dú
], 
e
, 
√xt
, 
li°
[dir]) {

71 i‡(!
	`åavî£_dïth_fú°
(
e
->
n
[!
dú
], dú, 
‚
, 
d©a
))

72  
Ál£
;

74  
	`‚
(
n
, (*)
d©a
);

75 
	}
}

77 
dgøph_åavî£
(c⁄° 
dgøph_node
 *
n
,

78 
dgøph_dú
 
dú
,

79 
	$boﬁ
 (*
‚
)(
dgøph_node
 *, *),

80 c⁄° *
d©a
)

82 
dgøph_edge
 *
e
, *
√xt
;

85 
	`éi°_f‹_óch_ß„
(&
n
->
edge
[
dú
], 
e
, 
√xt
, 
li°
[dir]) {

86 i‡(!
	`åavî£_dïth_fú°
(
e
->
n
[!
dú
], dú, 
‚
, 
d©a
))

89 
	}
}

91 
	scheck_öfo
 {

92 c⁄° 
dgøph_node
 *
	mªt
;

93 c⁄° *
	mab‹t°r
;

96 
boﬁ
 
	$föd_backedge
(c⁄° 
dgøph_node
 *
‰om
,

97 c⁄° 
dgøph_node
 *
to
,

98 
dgøph_dú
 
dú
)

100 
dgøph_edge
 *
e
;

102 
	`éi°_f‹_óch
(&
‰om
->
edge
[
dú
], 
e
, 
li°
[dir]) {

103 i‡(
e
->
n
[!
dú
] =
to
)

104  
åue
;

106  
Ál£
;

107 
	}
}

109 
boﬁ
 
	$dgøph_check_node
(
dgøph_node
 *
n
, *
öfo_
)

111 
check_öfo
 *
öfo
 = 
öfo_
;

112 
dú
;

113 
dgøph_edge
 *
e
;

115 
dú
 = 
DGRAPH_FROM
; dú <
DGRAPH_TO
; dir++) {

117 i‡(!
	`éi°_check
(&
n
->
edge
[
dú
], 
öfo
->
ab‹t°r
)) {

118 
öfo
->
ªt
 = 
NULL
;

119  
Ál£
;

123 
	`éi°_f‹_óch
(&
n
->
edge
[
dú
], 
e
, 
li°
[dir]) {

124 i‡(
e
->
n
[
dú
] ==Ç) {

125 i‡(
	`föd_backedge
(
e
->
n
[!
dú
],Ç, !dir))

127 i‡(
öfo
->
ab‹t°r
) {

128 
	`Ârötf
(
°dîr
,

131 
öfo
->
ab‹t°r
, 
e
->
n
[!
dú
],

132 !
dú
 =
DGRAPH_FROM


134 
n
);

135 
	`ab‹t
();

137 
öfo
->
ªt
 = 
NULL
;

138  
Ál£
;

141 i‡(
öfo
->
ab‹t°r
) {

142 
	`Ârötf
(
°dîr
,

145 
öfo
->
ab‹t°r
, 
n
,

146 
dú
 =
DGRAPH_FROM


148 
e
,É->
n
[
dú
]);

149 
	`ab‹t
();

151 
öfo
->
ªt
 = 
NULL
;

152  
Ál£
;

156  
åue
;

157 
	}
}

159 
dgøph_node
 *
	$dgøph_check
(c⁄° 
dgøph_node
 *
n
,

160 c⁄° *
ab‹t°r
)

162 
check_öfo
 
öfo
;

165 
öfo
.
ªt
 = 
n
;

166 
öfo
.
ab‹t°r
 =ábortstr;

168 
	`dgøph_check_node
((
dgøph_node
 *)
öfo
.
ªt
, &info);

170 i‡(
öfo
.
ªt
)

171 
	`dgøph_åavî£
(
n
, 
DGRAPH_FROM
, 
dgøph_check_node
, &
öfo
);

172 i‡(
öfo
.
ªt
)

173 
	`dgøph_åavî£
(
n
, 
DGRAPH_TO
, 
dgøph_check_node
, &
öfo
);

174  (*)
öfo
.
ªt
;

175 
	}
}

	@ccan/ccan/dgraph/dgraph.h

2 #i‚de‡
CCAN_DGRAPH_H


3 
	#CCAN_DGRAPH_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/éi°/éi°.h
>

6 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

7 
	~<°dboﬁ.h
>

9 
	edgøph_dú
 {

10 
	mDGRAPH_FROM
,

11 
	mDGRAPH_TO


15 
TLIST_TYPE
(
dgøph_edge
, dgraph_edge);

24 
	sdgøph_node
 {

25 
éi°_dgøph_edge
 
	medge
[2];

33 
	sdgøph_edge
 {

34 
li°_node
 
	mli°
[2];

35 
dgøph_node
 *
	mn
[2];

38 
dgøph_öô_node
(
dgøph_node
 *
n
);

39 
dgøph_˛ór_node
(
dgøph_node
 *
n
);

40 
dgøph_add_edge
(
dgøph_node
 *
‰om
, dgøph_nodê*
to
);

41 
boﬁ
 
dgøph_dñ_edge
(
dgøph_node
 *
‰om
, dgøph_nodê*
to
);

43 #ifde‡
CCAN_DGRAPH_DEBUG


44 
	#dgøph_debug
(
n
Ë
	`dgøph_check
(“), 
__func__
)

	)

46 
	#dgøph_debug
(
n
Ë“)

	)

50 
	#dgøph_åavî£_‰om
(
n
, 
‚
, 
¨g
) \

51 
	`dgøph_åavî£
(
	`dgøph_debug
(
n
), 
DGRAPH_FROM
, \

52 
	`ty≥ß„_cb_¥órgs
(
boﬁ
, *, (
‚
), (
¨g
), \

53 
dgøph_node
 *), \

54 (
¨g
))

	)

56 
	#dgøph_åavî£_to
(
n
, 
‚
, 
¨g
) \

57 
	`dgøph_åavî£
(
	`dgøph_debug
(
n
), 
DGRAPH_TO
, \

58 
	`ty≥ß„_cb_¥órgs
(
boﬁ
, *, (
‚
), (
¨g
), \

59 
dgøph_node
 *), \

60 (
¨g
))

	)

62 
dgøph_åavî£
(c⁄° 
dgøph_node
 *
n
,

63 
dgøph_dú
 
dú
,

64 
	$boﬁ
 (*
‚
)(
dgøph_node
 *
‰om
, *
d©a
),

65 c⁄° *
d©a
);

67 
	#dgøph_f‹_óch_edge
(
n
, 
i
, 
dú
) \

68 
	`éi°_f‹_óch
(&
	`dgøph_debug
(
n
)->
edge
[
dú
], 
i
, 
li°
[dú])

	)

70 
	#dgøph_f‹_óch_edge_ß„
(
n
, 
i
, 
√xt
, 
dú
) \

71 
	`éi°_f‹_óch_ß„
(&
	`dgøph_debug
(
n
)->
edge
[
dú
], 
i
, 
√xt
, 
li°
[dú])

	)

83 
dgøph_node
 *
	`dgøph_check
(c⁄° dgøph_nodê*
n
,

84 c⁄° *
ab‹t°r
);

	@ccan/ccan/dgraph/test/run-debug.c

1 
	#CCAN_DGRAPH_DEBUG
 1

	)

2 
	~<cˇn/dgøph/dgøph.h
>

4 
	~<cˇn/dgøph/dgøph.c
>

5 
	~<cˇn/èp/èp.h
>

7 
boﬁ
 
	$cou¡_nodes
(
dgøph_node
 *
n
, *
cou¡
)

9 (*
cou¡
)++;

10  
åue
;

11 
	}
}

13 
boﬁ
 
	$°›_åavî£
(
dgøph_node
 *
n
, *
cou¡
)

15 i‡(--(*
cou¡
) == 0)

16  
Ál£
;

17  
åue
;

18 
	}
}

20 
	$maö
()

22 
dgøph_node
 
n1
, 
n2
, 
n3
;

23 
cou¡
 = 0;

26 
	`∂™_ã°s
(42);

28 
	`dgøph_öô_node
(&
n1
);

29 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

30 
cou¡
 = 0;

31 
	`dgøph_åavî£_‰om
(&
n1
, 
cou¡_nodes
, &
cou¡
);

32 
	`ok1
(
cou¡
 == 0);

33 
cou¡
 = 0;

34 
	`dgøph_åavî£_to
(&
n1
, 
cou¡_nodes
, &
cou¡
);

35 
	`ok1
(
cou¡
 == 0);

37 
	`dgøph_öô_node
(&
n2
);

38 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

39 
	`dgøph_add_edge
(&
n1
, &
n2
);

40 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

41 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

42 
cou¡
 = 0;

43 
	`dgøph_åavî£_‰om
(&
n1
, 
cou¡_nodes
, &
cou¡
);

44 
	`ok1
(
cou¡
 == 1);

45 
cou¡
 = 0;

46 
	`dgøph_åavî£_to
(&
n1
, 
cou¡_nodes
, &
cou¡
);

47 
	`ok1
(
cou¡
 == 0);

48 
cou¡
 = 0;

49 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

50 
	`ok1
(
cou¡
 == 0);

51 
cou¡
 = 0;

52 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

53 
	`ok1
(
cou¡
 == 1);

55 
	`dgøph_öô_node
(&
n3
);

56 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

57 
	`dgøph_add_edge
(&
n2
, &
n3
);

58 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

59 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

60 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

61 
cou¡
 = 0;

62 
	`dgøph_åavî£_‰om
(&
n1
, 
cou¡_nodes
, &
cou¡
);

63 
	`ok1
(
cou¡
 == 2);

64 
cou¡
 = 0;

65 
	`dgøph_åavî£_to
(&
n1
, 
cou¡_nodes
, &
cou¡
);

66 
	`ok1
(
cou¡
 == 0);

67 
cou¡
 = 0;

68 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

69 
	`ok1
(
cou¡
 == 1);

70 
cou¡
 = 0;

71 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

72 
	`ok1
(
cou¡
 == 1);

73 
cou¡
 = 0;

74 
	`dgøph_åavî£_‰om
(&
n3
, 
cou¡_nodes
, &
cou¡
);

75 
	`ok1
(
cou¡
 == 0);

76 
cou¡
 = 0;

77 
	`dgøph_åavî£_to
(&
n3
, 
cou¡_nodes
, &
cou¡
);

78 
	`ok1
(
cou¡
 == 2);

81 
cou¡
 = 1;

82 
	`dgøph_åavî£_‰om
(&
n1
, 
°›_åavî£
, &
cou¡
);

83 
	`ok1
(
cou¡
 == 0);

84 
cou¡
 = 2;

85 
	`dgøph_åavî£_‰om
(&
n1
, 
°›_åavî£
, &
cou¡
);

86 
	`ok1
(
cou¡
 == 0);

87 
cou¡
 = 3;

88 
	`dgøph_åavî£_‰om
(&
n1
, 
°›_åavî£
, &
cou¡
);

89 
	`ok1
(
cou¡
 == 1);

91 
	`dgøph_˛ór_node
(&
n1
);

92 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

93 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

94 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

96 
cou¡
 = 0;

97 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

98 
	`ok1
(
cou¡
 == 1);

99 
cou¡
 = 0;

100 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

101 
	`ok1
(
cou¡
 == 0);

102 
cou¡
 = 0;

103 
	`dgøph_åavî£_‰om
(&
n3
, 
cou¡_nodes
, &
cou¡
);

104 
	`ok1
(
cou¡
 == 0);

105 
cou¡
 = 0;

106 
	`dgøph_åavî£_to
(&
n3
, 
cou¡_nodes
, &
cou¡
);

107 
	`ok1
(
cou¡
 == 1);

109 
	`ok1
(
	`dgøph_dñ_edge
(&
n2
, &
n3
));

110 
cou¡
 = 0;

111 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

112 
	`ok1
(
cou¡
 == 0);

113 
cou¡
 = 0;

114 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

115 
	`ok1
(
cou¡
 == 0);

116 
cou¡
 = 0;

117 
	`dgøph_åavî£_‰om
(&
n3
, 
cou¡_nodes
, &
cou¡
);

118 
	`ok1
(
cou¡
 == 0);

119 
cou¡
 = 0;

120 
	`dgøph_åavî£_to
(&
n3
, 
cou¡_nodes
, &
cou¡
);

121 
	`ok1
(
cou¡
 == 0);

122 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

123 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

124 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

126 
	`ok1
(!
	`dgøph_dñ_edge
(&
n2
, &
n3
));

127 
	`dgøph_˛ór_node
(&
n2
);

129 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

130 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

131 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

134  
	`exô_°©us
();

135 
	}
}

	@ccan/ccan/dgraph/test/run.c

1 
	~<cˇn/dgøph/dgøph.h
>

3 
	~<cˇn/dgøph/dgøph.c
>

4 
	~<cˇn/èp/èp.h
>

6 
boﬁ
 
	$cou¡_nodes
(
dgøph_node
 *
n
, *
cou¡
)

8 (*
cou¡
)++;

9  
åue
;

10 
	}
}

12 
boﬁ
 
	$°›_åavî£
(
dgøph_node
 *
n
, *
cou¡
)

14 i‡(--(*
cou¡
) == 0)

15  
Ál£
;

16  
åue
;

17 
	}
}

19 
	$maö
()

21 
dgøph_node
 
n1
, 
n2
, 
n3
;

22 
cou¡
 = 0;

25 
	`∂™_ã°s
(42);

27 
	`dgøph_öô_node
(&
n1
);

28 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

29 
cou¡
 = 0;

30 
	`dgøph_åavî£_‰om
(&
n1
, 
cou¡_nodes
, &
cou¡
);

31 
	`ok1
(
cou¡
 == 0);

32 
cou¡
 = 0;

33 
	`dgøph_åavî£_to
(&
n1
, 
cou¡_nodes
, &
cou¡
);

34 
	`ok1
(
cou¡
 == 0);

36 
	`dgøph_öô_node
(&
n2
);

37 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

38 
	`dgøph_add_edge
(&
n1
, &
n2
);

39 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

40 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

41 
cou¡
 = 0;

42 
	`dgøph_åavî£_‰om
(&
n1
, 
cou¡_nodes
, &
cou¡
);

43 
	`ok1
(
cou¡
 == 1);

44 
cou¡
 = 0;

45 
	`dgøph_åavî£_to
(&
n1
, 
cou¡_nodes
, &
cou¡
);

46 
	`ok1
(
cou¡
 == 0);

47 
cou¡
 = 0;

48 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

49 
	`ok1
(
cou¡
 == 0);

50 
cou¡
 = 0;

51 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

52 
	`ok1
(
cou¡
 == 1);

54 
	`dgøph_öô_node
(&
n3
);

55 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

56 
	`dgøph_add_edge
(&
n2
, &
n3
);

57 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

58 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

59 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

60 
cou¡
 = 0;

61 
	`dgøph_åavî£_‰om
(&
n1
, 
cou¡_nodes
, &
cou¡
);

62 
	`ok1
(
cou¡
 == 2);

63 
cou¡
 = 0;

64 
	`dgøph_åavî£_to
(&
n1
, 
cou¡_nodes
, &
cou¡
);

65 
	`ok1
(
cou¡
 == 0);

66 
cou¡
 = 0;

67 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

68 
	`ok1
(
cou¡
 == 1);

69 
cou¡
 = 0;

70 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

71 
	`ok1
(
cou¡
 == 1);

72 
cou¡
 = 0;

73 
	`dgøph_åavî£_‰om
(&
n3
, 
cou¡_nodes
, &
cou¡
);

74 
	`ok1
(
cou¡
 == 0);

75 
cou¡
 = 0;

76 
	`dgøph_åavî£_to
(&
n3
, 
cou¡_nodes
, &
cou¡
);

77 
	`ok1
(
cou¡
 == 2);

80 
cou¡
 = 1;

81 
	`dgøph_åavî£_‰om
(&
n1
, 
°›_åavî£
, &
cou¡
);

82 
	`ok1
(
cou¡
 == 0);

83 
cou¡
 = 2;

84 
	`dgøph_åavî£_‰om
(&
n1
, 
°›_åavî£
, &
cou¡
);

85 
	`ok1
(
cou¡
 == 0);

86 
cou¡
 = 3;

87 
	`dgøph_åavî£_‰om
(&
n1
, 
°›_åavî£
, &
cou¡
);

88 
	`ok1
(
cou¡
 == 1);

90 
	`dgøph_˛ór_node
(&
n1
);

91 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

92 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

93 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

95 
cou¡
 = 0;

96 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

97 
	`ok1
(
cou¡
 == 1);

98 
cou¡
 = 0;

99 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

100 
	`ok1
(
cou¡
 == 0);

101 
cou¡
 = 0;

102 
	`dgøph_åavî£_‰om
(&
n3
, 
cou¡_nodes
, &
cou¡
);

103 
	`ok1
(
cou¡
 == 0);

104 
cou¡
 = 0;

105 
	`dgøph_åavî£_to
(&
n3
, 
cou¡_nodes
, &
cou¡
);

106 
	`ok1
(
cou¡
 == 1);

108 
	`ok1
(
	`dgøph_dñ_edge
(&
n2
, &
n3
));

109 
cou¡
 = 0;

110 
	`dgøph_åavî£_‰om
(&
n2
, 
cou¡_nodes
, &
cou¡
);

111 
	`ok1
(
cou¡
 == 0);

112 
cou¡
 = 0;

113 
	`dgøph_åavî£_to
(&
n2
, 
cou¡_nodes
, &
cou¡
);

114 
	`ok1
(
cou¡
 == 0);

115 
cou¡
 = 0;

116 
	`dgøph_åavî£_‰om
(&
n3
, 
cou¡_nodes
, &
cou¡
);

117 
	`ok1
(
cou¡
 == 0);

118 
cou¡
 = 0;

119 
	`dgøph_åavî£_to
(&
n3
, 
cou¡_nodes
, &
cou¡
);

120 
	`ok1
(
cou¡
 == 0);

121 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

122 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

123 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

125 
	`ok1
(!
	`dgøph_dñ_edge
(&
n2
, &
n3
));

126 
	`dgøph_˛ór_node
(&
n2
);

128 
	`ok1
(
	`dgøph_check
(&
n1
, 
NULL
) == &n1);

129 
	`ok1
(
	`dgøph_check
(&
n2
, 
NULL
) == &n2);

130 
	`ok1
(
	`dgøph_check
(&
n3
, 
NULL
) == &n3);

133  
	`exô_°©us
();

134 
	}
}

	@ccan/ccan/endian/endian.h

2 #i‚de‡
CCAN_ENDIAN_H


3 
	#CCAN_ENDIAN_H


	)

4 
	~<°döt.h
>

5 
	~"c⁄fig.h
"

18 
	#BSWAP_16
(
vÆ
) \

19 ((((
uöt16_t
)
vÆ
 & 0x00ff) << 8) \

20 | (((
uöt16_t
)
vÆ
 & 0xff00Ë>> 8))

	)

33 
	#BSWAP_32
(
vÆ
) \

34 ((((
uöt32_t
)
vÆ
 & 0x000000ff) << 24) \

35 | (((
uöt32_t
)
vÆ
 & 0x0000ff00) << 8) \

36 | (((
uöt32_t
)
vÆ
 & 0x00ff0000) >> 8) \

37 | (((
uöt32_t
)
vÆ
 & 0xff000000Ë>> 24))

	)

50 
	#BSWAP_64
(
vÆ
) \

51 ((((
uöt64_t
)
vÆ
 & 0x00000000000000ffULL) << 56) \

52 | (((
uöt64_t
)
vÆ
 & 0x000000000000ff00ULL) << 40) \

53 | (((
uöt64_t
)
vÆ
 & 0x0000000000ff0000ULL) << 24) \

54 | (((
uöt64_t
)
vÆ
 & 0x00000000ff000000ULL) << 8) \

55 | (((
uöt64_t
)
vÆ
 & 0x000000ff00000000ULL) >> 8) \

56 | (((
uöt64_t
)
vÆ
 & 0x0000ff0000000000ULL) >> 24) \

57 | (((
uöt64_t
)
vÆ
 & 0x00ff000000000000ULL) >> 40) \

58 | (((
uöt64_t
)
vÆ
 & 0xff00000000000000ULLË>> 56))

	)

60 #i‡
HAVE_BYTESWAP_H


61 
	~<byãsw≠.h
>

71 
ölöe
 
uöt16_t
 
	$bsw≠_16
(
uöt16_t
 
vÆ
)

73  
	`BSWAP_16
(
vÆ
);

74 
	}
}

84 
ölöe
 
uöt32_t
 
	$bsw≠_32
(
uöt32_t
 
vÆ
)

86  
	`BSWAP_32
(
vÆ
);

87 
	}
}

90 #i‡!
HAVE_BSWAP_64


100 
ölöe
 
uöt64_t
 
	$bsw≠_64
(
uöt64_t
 
vÆ
)

102  
	`BSWAP_64
(
vÆ
);

103 
	}
}

107 #i‡!
HAVE_LITTLE_ENDIAN
 && !
HAVE_BIG_ENDIAN


109 #ñi‡
HAVE_LITTLE_ENDIAN
 && 
HAVE_BIG_ENDIAN


113 #ifde‡
__CHECKER__


115 
	#ENDIAN_CAST
 
	`__©åibuã__
((
f‹˚
))

	)

116 
	#ENDIAN_TYPE
 
	`__©åibuã__
((
bôwi£
))

	)

118 
	#ENDIAN_CAST


	)

119 
	#ENDIAN_TYPE


	)

122 
uöt64_t
 
	tENDIAN_TYPE
 
	tÀöt64_t
;

123 
uöt64_t
 
	tENDIAN_TYPE
 
	tbeöt64_t
;

124 
uöt32_t
 
	tENDIAN_TYPE
 
	tÀöt32_t
;

125 
uöt32_t
 
	tENDIAN_TYPE
 
	tbeöt32_t
;

126 
uöt16_t
 
	tENDIAN_TYPE
 
	tÀöt16_t
;

127 
uöt16_t
 
	tENDIAN_TYPE
 
	tbeöt16_t
;

129 #i‡
HAVE_LITTLE_ENDIAN


134 
	#CPU_TO_LE64
(
«tive
Ë((
ENDIAN_CAST
 
Àöt64_t
)“©ive))

	)

140 
	#CPU_TO_LE32
(
«tive
Ë((
ENDIAN_CAST
 
Àöt32_t
)“©ive))

	)

146 
	#CPU_TO_LE16
(
«tive
Ë((
ENDIAN_CAST
 
Àöt16_t
)“©ive))

	)

152 
	#LE64_TO_CPU
(
À_vÆ
Ë((
ENDIAN_CAST
 
uöt64_t
)÷e_vÆ))

	)

158 
	#LE32_TO_CPU
(
À_vÆ
Ë((
ENDIAN_CAST
 
uöt32_t
)÷e_vÆ))

	)

164 
	#LE16_TO_CPU
(
À_vÆ
Ë((
ENDIAN_CAST
 
uöt16_t
)÷e_vÆ))

	)

167 
	#CPU_TO_LE64
(
«tive
Ë((
ENDIAN_CAST
 
Àöt64_t
)
	`BSWAP_64
“©ive))

	)

168 
	#CPU_TO_LE32
(
«tive
Ë((
ENDIAN_CAST
 
Àöt32_t
)
	`BSWAP_32
“©ive))

	)

169 
	#CPU_TO_LE16
(
«tive
Ë((
ENDIAN_CAST
 
Àöt16_t
)
	`BSWAP_16
“©ive))

	)

170 
	#LE64_TO_CPU
(
À_vÆ
Ë
	`BSWAP_64
((
ENDIAN_CAST
 
uöt64_t
Óe_vÆ)

	)

171 
	#LE32_TO_CPU
(
À_vÆ
Ë
	`BSWAP_32
((
ENDIAN_CAST
 
uöt32_t
Óe_vÆ)

	)

172 
	#LE16_TO_CPU
(
À_vÆ
Ë
	`BSWAP_16
((
ENDIAN_CAST
 
uöt16_t
Óe_vÆ)

	)

175 #i‡
HAVE_BIG_ENDIAN


180 
	#CPU_TO_BE64
(
«tive
Ë((
ENDIAN_CAST
 
beöt64_t
)“©ive))

	)

186 
	#CPU_TO_BE32
(
«tive
Ë((
ENDIAN_CAST
 
beöt32_t
)“©ive))

	)

192 
	#CPU_TO_BE16
(
«tive
Ë((
ENDIAN_CAST
 
beöt16_t
)“©ive))

	)

198 
	#BE64_TO_CPU
(
À_vÆ
Ë((
ENDIAN_CAST
 
uöt64_t
)÷e_vÆ))

	)

204 
	#BE32_TO_CPU
(
À_vÆ
Ë((
ENDIAN_CAST
 
uöt32_t
)÷e_vÆ))

	)

210 
	#BE16_TO_CPU
(
À_vÆ
Ë((
ENDIAN_CAST
 
uöt16_t
)÷e_vÆ))

	)

213 
	#CPU_TO_BE64
(
«tive
Ë((
ENDIAN_CAST
 
beöt64_t
)
	`BSWAP_64
“©ive))

	)

214 
	#CPU_TO_BE32
(
«tive
Ë((
ENDIAN_CAST
 
beöt32_t
)
	`BSWAP_32
“©ive))

	)

215 
	#CPU_TO_BE16
(
«tive
Ë((
ENDIAN_CAST
 
beöt16_t
)
	`BSWAP_16
“©ive))

	)

216 
	#BE64_TO_CPU
(
À_vÆ
Ë
	`BSWAP_64
((
ENDIAN_CAST
 
uöt64_t
Óe_vÆ)

	)

217 
	#BE32_TO_CPU
(
À_vÆ
Ë
	`BSWAP_32
((
ENDIAN_CAST
 
uöt32_t
Óe_vÆ)

	)

218 
	#BE16_TO_CPU
(
À_vÆ
Ë
	`BSWAP_16
((
ENDIAN_CAST
 
uöt16_t
Óe_vÆ)

	)

226 
ölöe
 
Àöt64_t
 
	$˝u_to_À64
(
uöt64_t
 
«tive
)

228  
	`CPU_TO_LE64
(
«tive
);

229 
	}
}

235 
ölöe
 
Àöt32_t
 
	$˝u_to_À32
(
uöt32_t
 
«tive
)

237  
	`CPU_TO_LE32
(
«tive
);

238 
	}
}

244 
ölöe
 
Àöt16_t
 
	$˝u_to_À16
(
uöt16_t
 
«tive
)

246  
	`CPU_TO_LE16
(
«tive
);

247 
	}
}

253 
ölöe
 
uöt64_t
 
	$À64_to_˝u
(
Àöt64_t
 
À_vÆ
)

255  
	`LE64_TO_CPU
(
À_vÆ
);

256 
	}
}

262 
ölöe
 
uöt32_t
 
	$À32_to_˝u
(
Àöt32_t
 
À_vÆ
)

264  
	`LE32_TO_CPU
(
À_vÆ
);

265 
	}
}

271 
ölöe
 
uöt16_t
 
	$À16_to_˝u
(
Àöt16_t
 
À_vÆ
)

273  
	`LE16_TO_CPU
(
À_vÆ
);

274 
	}
}

280 
ölöe
 
beöt64_t
 
	$˝u_to_be64
(
uöt64_t
 
«tive
)

282  ((
ENDIAN_CAST
 
beöt64_t
)
	`BSWAP_64
(
«tive
));

283  
	`CPU_TO_BE64
(
«tive
);

284 
	}
}

290 
ölöe
 
beöt32_t
 
	$˝u_to_be32
(
uöt32_t
 
«tive
)

292  
	`CPU_TO_BE32
(
«tive
);

293 
	}
}

299 
ölöe
 
beöt16_t
 
	$˝u_to_be16
(
uöt16_t
 
«tive
)

301  
	`CPU_TO_BE16
(
«tive
);

302 
	}
}

308 
ölöe
 
uöt64_t
 
	$be64_to_˝u
(
beöt64_t
 
be_vÆ
)

310  
	`BE64_TO_CPU
(
be_vÆ
);

311 
	}
}

317 
ölöe
 
uöt32_t
 
	$be32_to_˝u
(
beöt32_t
 
be_vÆ
)

319  
	`BE32_TO_CPU
(
be_vÆ
);

320 
	}
}

326 
ölöe
 
uöt16_t
 
	$be16_to_˝u
(
beöt16_t
 
be_vÆ
)

328  
	`BE16_TO_CPU
(
be_vÆ
);

329 
	}
}

332 #ifde‡
CCAN_SHORT_TYPES_H


336 
beöt64_t
 
	tbe64
;

337 
beöt32_t
 
	tbe32
;

338 
beöt16_t
 
	tbe16
;

343 
Àöt64_t
 
	tÀ64
;

344 
Àöt32_t
 
	tÀ32
;

345 
Àöt16_t
 
	tÀ16
;

	@ccan/ccan/endian/test/compile_ok-constant.c

1 
	~<cˇn/ídün/ídün.h
>

3 
	sfoo
 {

4 
	m⁄e
[
BSWAP_16
(0xFF00)];

5 
	mtwo
[
BSWAP_32
(0xFF000000)];

6 
	mthªe
[
BSWAP_64
(0xFF00000000000000ULL)];

9 
	$maö
()

12 
	}
}

	@ccan/ccan/endian/test/run.c

1 
	~<cˇn/ídün/ídün.h
>

2 
	~<°dlib.h
>

3 
	~<°ddef.h
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
(
¨gc
, *
¨gv
[])

9 
uöt64_t
 
u64
;

10 
u64_byãs
[8];

11 } 
u64
;

13 
uöt32_t
 
u32
;

14 
u32_byãs
[4];

15 } 
u32
;

17 
uöt16_t
 
u16
;

18 
u16_byãs
[2];

19 } 
u16
;

21 
	`∂™_ã°s
(48);

24 
u64
.
u64_byãs
[0] = 0x00;

25 
u64
.
u64_byãs
[1] = 0x11;

26 
u64
.
u64_byãs
[2] = 0x22;

27 
u64
.
u64_byãs
[3] = 0x33;

28 
u64
.
u64_byãs
[4] = 0x44;

29 
u64
.
u64_byãs
[5] = 0x55;

30 
u64
.
u64_byãs
[6] = 0x66;

31 
u64
.
u64_byãs
[7] = 0x77;

32 
u64
.u64 = 
	`bsw≠_64
(u64.u64);

33 
	`ok1
(
u64
.
u64_byãs
[7] == 0x00);

34 
	`ok1
(
u64
.
u64_byãs
[6] == 0x11);

35 
	`ok1
(
u64
.
u64_byãs
[5] == 0x22);

36 
	`ok1
(
u64
.
u64_byãs
[4] == 0x33);

37 
	`ok1
(
u64
.
u64_byãs
[3] == 0x44);

38 
	`ok1
(
u64
.
u64_byãs
[2] == 0x55);

39 
	`ok1
(
u64
.
u64_byãs
[1] == 0x66);

40 
	`ok1
(
u64
.
u64_byãs
[0] == 0x77);

42 
u32
.
u32_byãs
[0] = 0x00;

43 
u32
.
u32_byãs
[1] = 0x11;

44 
u32
.
u32_byãs
[2] = 0x22;

45 
u32
.
u32_byãs
[3] = 0x33;

46 
u32
.u32 = 
	`bsw≠_32
(u32.u32);

47 
	`ok1
(
u32
.
u32_byãs
[3] == 0x00);

48 
	`ok1
(
u32
.
u32_byãs
[2] == 0x11);

49 
	`ok1
(
u32
.
u32_byãs
[1] == 0x22);

50 
	`ok1
(
u32
.
u32_byãs
[0] == 0x33);

52 
u16
.
u16_byãs
[0] = 0x00;

53 
u16
.
u16_byãs
[1] = 0x11;

54 
u16
.u16 = 
	`bsw≠_16
(u16.u16);

55 
	`ok1
(
u16
.
u16_byãs
[1] == 0x00);

56 
	`ok1
(
u16
.
u16_byãs
[0] == 0x11);

59 
u64
.u64 = 
	`˝u_to_À64
(0x0011223344556677ULL);

60 
	`ok1
(
u64
.
u64_byãs
[0] == 0x77);

61 
	`ok1
(
u64
.
u64_byãs
[1] == 0x66);

62 
	`ok1
(
u64
.
u64_byãs
[2] == 0x55);

63 
	`ok1
(
u64
.
u64_byãs
[3] == 0x44);

64 
	`ok1
(
u64
.
u64_byãs
[4] == 0x33);

65 
	`ok1
(
u64
.
u64_byãs
[5] == 0x22);

66 
	`ok1
(
u64
.
u64_byãs
[6] == 0x11);

67 
	`ok1
(
u64
.
u64_byãs
[7] == 0x00);

68 
	`ok1
(
	`À64_to_˝u
(
u64
.u64) == 0x0011223344556677ULL);

70 
u64
.u64 = 
	`˝u_to_be64
(0x0011223344556677ULL);

71 
	`ok1
(
u64
.
u64_byãs
[7] == 0x77);

72 
	`ok1
(
u64
.
u64_byãs
[6] == 0x66);

73 
	`ok1
(
u64
.
u64_byãs
[5] == 0x55);

74 
	`ok1
(
u64
.
u64_byãs
[4] == 0x44);

75 
	`ok1
(
u64
.
u64_byãs
[3] == 0x33);

76 
	`ok1
(
u64
.
u64_byãs
[2] == 0x22);

77 
	`ok1
(
u64
.
u64_byãs
[1] == 0x11);

78 
	`ok1
(
u64
.
u64_byãs
[0] == 0x00);

79 
	`ok1
(
	`be64_to_˝u
(
u64
.u64) == 0x0011223344556677ULL);

81 
u32
.u32 = 
	`˝u_to_À32
(0x00112233);

82 
	`ok1
(
u32
.
u32_byãs
[0] == 0x33);

83 
	`ok1
(
u32
.
u32_byãs
[1] == 0x22);

84 
	`ok1
(
u32
.
u32_byãs
[2] == 0x11);

85 
	`ok1
(
u32
.
u32_byãs
[3] == 0x00);

86 
	`ok1
(
	`À32_to_˝u
(
u32
.u32) == 0x00112233);

88 
u32
.u32 = 
	`˝u_to_be32
(0x00112233);

89 
	`ok1
(
u32
.
u32_byãs
[3] == 0x33);

90 
	`ok1
(
u32
.
u32_byãs
[2] == 0x22);

91 
	`ok1
(
u32
.
u32_byãs
[1] == 0x11);

92 
	`ok1
(
u32
.
u32_byãs
[0] == 0x00);

93 
	`ok1
(
	`be32_to_˝u
(
u32
.u32) == 0x00112233);

95 
u16
.u16 = 
	`˝u_to_À16
(0x0011);

96 
	`ok1
(
u16
.
u16_byãs
[0] == 0x11);

97 
	`ok1
(
u16
.
u16_byãs
[1] == 0x00);

98 
	`ok1
(
	`À16_to_˝u
(
u16
.u16) == 0x0011);

100 
u16
.u16 = 
	`˝u_to_be16
(0x0011);

101 
	`ok1
(
u16
.
u16_byãs
[1] == 0x11);

102 
	`ok1
(
u16
.
u16_byãs
[0] == 0x00);

103 
	`ok1
(
	`be16_to_˝u
(
u16
.u16) == 0x0011);

105 
	`exô
(
	`exô_°©us
());

106 
	}
}

	@ccan/ccan/err/err.c

2 
	~"îr.h
"

4 #i‡!
HAVE_ERR_H


5 
	~<°d¨g.h
>

6 
	~<°dio.h
>

7 
	~<î∫o.h
>

8 
	~<°rög.h
>

9 
	~<°dlib.h
>

11 c⁄° *
	g¥og«me
 = "unknownÖrogram";

13 
	$îr_£t_¥og«me
(c⁄° *
«me
)

15 
¥og«me
 = 
«me
;

16 
	}
}

18 
NORETURN
 
	$îr
(
evÆ
, c⁄° *
fmt
, ...)

20 
îr_î∫o
 = 
î∫o
;

21 
va_li°
 
≠
;

23 
	`Ârötf
(
°dîr
, "%s: ", 
¥og«me
);

24 
	`va_°¨t
(
≠
, 
fmt
);

25 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

26 
	`va_íd
(
≠
);

27 
	`Ârötf
(
°dîr
, ": %s\n", 
	`°ªº‹
(
îr_î∫o
));

28 
	`exô
(
evÆ
);

29 
	}
}

31 
NORETURN
 
	$îrx
(
evÆ
, c⁄° *
fmt
, ...)

33 
va_li°
 
≠
;

35 
	`Ârötf
(
°dîr
, "%s: ", 
¥og«me
);

36 
	`va_°¨t
(
≠
, 
fmt
);

37 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

38 
	`va_íd
(
≠
);

39 
	`Ârötf
(
°dîr
, "\n");

40 
	`exô
(
evÆ
);

41 
	}
}

43 
	$w¨n
(c⁄° *
fmt
, ...)

45 
îr_î∫o
 = 
î∫o
;

46 
va_li°
 
≠
;

48 
	`Ârötf
(
°dîr
, "%s: ", 
¥og«me
);

49 
	`va_°¨t
(
≠
, 
fmt
);

50 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

51 
	`va_íd
(
≠
);

52 
	`Ârötf
(
°dîr
, ": %s\n", 
	`°ªº‹
(
îr_î∫o
));

53 
	}
}

55 
	$w¨nx
(c⁄° *
fmt
, ...)

57 
va_li°
 
≠
;

59 
	`Ârötf
(
°dîr
, "%s: ", 
¥og«me
);

60 
	`va_°¨t
(
≠
, 
fmt
);

61 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

62 
	`va_íd
(
≠
);

63 
	`Ârötf
(
°dîr
, "\n");

64 
	}
}

	@ccan/ccan/err/err.h

2 #i‚de‡
CCAN_ERR_H


3 
	#CCAN_ERR_H


	)

4 
	~"c⁄fig.h
"

6 #i‡
HAVE_ERR_H


7 
	~<îr.h
>

10 
	#îr_£t_¥og«me
(
«me
Ë((Íame)

	)

13 
	~<cˇn/compûî/compûî.h
>

27 
îr_£t_¥og«me
(c⁄° *
«me
);

42 
NORETURN
 
îr
(
evÆ
, c⁄° *
fmt
, ...);

56 
NORETURN
 
îrx
(
evÆ
, c⁄° *
fmt
, ...);

71 
w¨n
(c⁄° *
fmt
, ...);

85 
w¨nx
(c⁄° *
fmt
, ...);

	@ccan/ccan/err/test/run.c

1 
	~<cˇn/îr/îr.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<uni°d.h
>

4 
	~<°rög.h
>

5 
	~<î∫o.h
>

6 
	~<°dio.h
>

7 
	~<°dlib.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/waô.h
>

11 
	#BUFFER_MAX
 1024

	)

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
pfd
[2];

16 c⁄° *
ba£
;

18 
	`∂™_ã°s
(24);

20 
	`îr_£t_¥og«me
(
¨gv
[0]);

23 
ba£
 = 
	`°ºchr
(
¨gv
[0], '/');

24 i‡(
ba£
)

25 
ba£
++;

27 
ba£
 = 
¨gv
[0];

30 
	`pùe
(
pfd
);

31 
	`fÊush
(
°dout
);

32 i‡(
	`f‹k
()) {

33 
buf„r
[
BUFFER_MAX
+1];

34 
i
;

35 
°©us
;

38 
	`˛o£
(
pfd
[1]);

39 
i
 = 0; i < 
BUFFER_MAX
; i++) {

40 i‡(
	`ªad
(
pfd
[0], 
buf„r
 + 
i
, 1) == 0) {

41 
buf„r
[
i
] = '\0';

42 
	`ok1
(
	`°r°r
(
buf„r
, "runningÉrr:"));

43 
	`ok1
(
	`°r°r
(
buf„r
, 
	`°ªº‹
(
ENOENT
)));

44 
	`ok1
(
	`°r°r
(
buf„r
, 
ba£
));

45 
	`ok1
(
buf„r
[
i
-1] == '\n');

49 
	`˛o£
(
pfd
[0]);

50 
	`ok1
(
	`waô
(&
°©us
) != -1);

51 
	`ok1
(
	`WIFEXITED
(
°©us
));

52 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 17);

54 
	`˛o£
(
pfd
[0]);

55 
	`dup2
(
pfd
[1], 
STDERR_FILENO
);

56 
î∫o
 = 
ENOENT
;

57 
	`îr
(17, "running %s", "err");

58 
	`ab‹t
();

62 
	`pùe
(
pfd
);

63 
	`fÊush
(
°dout
);

64 i‡(
	`f‹k
()) {

65 
buf„r
[
BUFFER_MAX
+1];

66 
i
;

67 
°©us
;

70 
	`˛o£
(
pfd
[1]);

71 
i
 = 0; i < 
BUFFER_MAX
; i++) {

72 i‡(
	`ªad
(
pfd
[0], 
buf„r
 + 
i
, 1) == 0) {

73 
buf„r
[
i
] = '\0';

74 
	`ok1
(
	`°r°r
(
buf„r
, "runningÉrrx\n"));

75 
	`ok1
(
	`°r°r
(
buf„r
, 
ba£
));

79 
	`˛o£
(
pfd
[0]);

80 
	`ok1
(
	`waô
(&
°©us
) != -1);

81 
	`ok1
(
	`WIFEXITED
(
°©us
));

82 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 17);

84 
	`˛o£
(
pfd
[0]);

85 
	`dup2
(
pfd
[1], 
STDERR_FILENO
);

86 
	`îrx
(17, "running %s", "errx");

87 
	`ab‹t
();

92 
	`pùe
(
pfd
);

93 
	`fÊush
(
°dout
);

94 i‡(
	`f‹k
()) {

95 
buf„r
[
BUFFER_MAX
+1];

96 
i
;

97 
°©us
;

100 
	`˛o£
(
pfd
[1]);

101 
i
 = 0; i < 
BUFFER_MAX
; i++) {

102 i‡(
	`ªad
(
pfd
[0], 
buf„r
 + 
i
, 1) == 0) {

103 
buf„r
[
i
] = '\0';

104 
	`ok1
(
	`°r°r
(
buf„r
, "running warn:"));

105 
	`ok1
(
	`°r°r
(
buf„r
, 
	`°ªº‹
(
ENOENT
)));

106 
	`ok1
(
	`°r°r
(
buf„r
, 
ba£
));

107 
	`ok1
(
buf„r
[
i
-1] == '\n');

111 
	`˛o£
(
pfd
[0]);

112 
	`ok1
(
	`waô
(&
°©us
) != -1);

113 
	`ok1
(
	`WIFEXITED
(
°©us
));

114 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 17);

116 
	`˛o£
(
pfd
[0]);

117 
	`dup2
(
pfd
[1], 
STDERR_FILENO
);

118 
î∫o
 = 
ENOENT
;

119 
	`w¨n
("running %s", "warn");

120 
	`exô
(17);

124 
	`pùe
(
pfd
);

125 
	`fÊush
(
°dout
);

126 i‡(
	`f‹k
()) {

127 
buf„r
[
BUFFER_MAX
+1];

128 
i
;

129 
°©us
;

132 
	`˛o£
(
pfd
[1]);

133 
i
 = 0; i < 
BUFFER_MAX
; i++) {

134 i‡(
	`ªad
(
pfd
[0], 
buf„r
 + 
i
, 1) == 0) {

135 
buf„r
[
i
] = '\0';

136 
	`ok1
(
	`°r°r
(
buf„r
, "running warnx\n"));

137 
	`ok1
(
	`°r°r
(
buf„r
, 
ba£
));

141 
	`˛o£
(
pfd
[0]);

142 
	`ok1
(
	`waô
(&
°©us
) != -1);

143 
	`ok1
(
	`WIFEXITED
(
°©us
));

144 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 17);

146 
	`˛o£
(
pfd
[0]);

147 
	`dup2
(
pfd
[1], 
STDERR_FILENO
);

148 
	`w¨nx
("running %s", "warnx");

149 
	`exô
(17);

151  
	`exô_°©us
();

152 
	}
}

	@ccan/ccan/failtest/failtest.c

2 
	~<cˇn/Áûã°/Áûã°.h
>

3 
	~<°d¨g.h
>

4 
	~<°rög.h
>

5 
	~<°dio.h
>

6 
	~<°d¨g.h
>

7 
	~<˘y≥.h
>

8 
	~<uni°d.h
>

9 
	~<pﬁl.h
>

10 
	~<î∫o.h
>

11 
	~<sys/ty≥s.h
>

12 
	~<sys/waô.h
>

13 
	~<sys/°©.h
>

14 
	~<sys/time.h
>

15 
	~<sys/mm™.h
>

16 
	~<sys/ªsour˚.h
>

17 
	~<sig«l.h
>

18 
	~<as£π.h
>

19 
	~<cˇn/îr/îr.h
>

20 
	~<cˇn/time/time.h
>

21 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

22 
	~<cˇn/Áûã°/Áûã°_¥Ÿo.h
>

23 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

24 
	~<cˇn/hash/hash.h
>

25 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

26 
	~<cˇn/°r/°r.h
>

27 
	~<cˇn/compûî/compûî.h
>

29 
	$Áûã°_ªsu…
 (*
Áûã°_hook
)(
éi°_ˇŒs
 *);

31 
FILE
 *
åa˚f
 = 
NULL
, *
w¨nf
;

32 
åa˚ödít
 = 0;

34 
Áûã°_timeout_ms
 = 20000;

36 c⁄° *
Áû∑th
;

37 c⁄° *
debug∑th
;

39 
	eöfo_ty≥
 {

40 
WRITE
,

41 
RELEASE_LOCKS
,

42 
FAILURE
,

43 
SUCCESS
,

44 
UNEXPECTED


47 
	slock_öfo
 {

48 
fd
;

50 
off_t
 
°¨t
, 
íd
;

51 
ty≥
;

55 
size_t
 
	$hash_ˇŒ
(c⁄° 
Áûã°_ˇŒ
 *
ˇŒ
)

57  
	`hash
(
ˇŒ
->
fûe
, 
	`°æí
(call->file),

58 
	`hash
(&
ˇŒ
->
löe
, 1,

59 
	`hash
(
ˇŒ
->
backåa˚
, cÆl->
backåa˚_num
,

60 
ˇŒ
->
ty≥
)));

61 
	}
}

63 
boﬁ
 
	$ˇŒ_eq
(c⁄° 
Áûã°_ˇŒ
 *
ˇŒ1
,

64 c⁄° 
Áûã°_ˇŒ
 *
ˇŒ2
)

66 
i
;

68 i‡(
	`°rcmp
(
ˇŒ1
->
fûe
, 
ˇŒ2
->file) != 0

69 || 
ˇŒ1
->
löe
 !
ˇŒ2
->line

70 || 
ˇŒ1
->
ty≥
 !
ˇŒ2
->type

71 || 
ˇŒ1
->
backåa˚_num
 !
ˇŒ2
->backtrace_num)

72  
Ál£
;

74 
i
 = 0; i < 
ˇŒ1
->
backåa˚_num
; i++)

75 i‡(
ˇŒ1
->
backåa˚
[
i
] !
ˇŒ2
->backtrace[i])

76  
Ál£
;

78  
åue
;

79 
	}
}

82 
HTABLE_DEFINE_TYPE
(
Áûã°_ˇŒ
, (Áûã°_ˇŒ *), 
hash_ˇŒ
,

83 
ˇŒ_eq
, 
ÁûèbÀ
);

85 
	$boﬁ
 (*
Áûã°_exô_check
)(
éi°_ˇŒs
 *
hi°‹y
);

88 
éi°_ˇŒs
 
hi°‹y
 = 
	`TLIST_INIT
(history);

90 
c⁄åﬁ_fd
 = -1;

92 
Áûã°_ˇŒ
 *
our_hi°‹y_°¨t
 = 
NULL
;

94 
time•ec
 
°¨t
;

96 
boﬁ
 
¥obög
 = 
Ál£
;

98 
ÁûèbÀ
 failtable;

101 
wrôe_ˇŒ
 *
chûd_wrôes
 = 
NULL
;

102 
chûd_wrôes_num
 = 0;

105 
pid_t
 
lock_ow√r
;

106 
lock_öfo
 *
locks
 = 
NULL
;

107 
lock_num
 = 0;

110 
pid_t
 
‹ig_pid
;

113 c⁄° 
öfo_to_¨g
[] = "mceoxprwfal";

116 
Áûã°_ˇŒ
 
uƒec‹ded_ˇŒ
;

118 
	sc⁄ã¡s_ßved
 {

119 
size_t
 
cou¡
;

120 
off_t
 
off
;

121 
off_t
 
ﬁd_Àn
;

122 
c⁄ã¡s
[1];

126 
	sßved_mm≠≥d_fûe
 {

127 
ßved_mm≠≥d_fûe
 *
√xt
;

128 
Áûã°_ˇŒ
 *
›íî
;

129 
c⁄ã¡s_ßved
 *
s
;

132 
ßved_mm≠≥d_fûe
 *
ßved_mm≠≥d_fûes
;

134 #i‡
HAVE_BACKTRACE


135 
	~<execöfo.h
>

137 **
	$gë_backåa˚
(*
num
)

139 
max_back
 = 100;

140 **
ªt
;

142 
agaö
:

143 
ªt
 = 
	`mÆloc
(
max_back
 * (*));

144 *
num
 = 
	`backåa˚
(
ªt
, 
max_back
);

145 i‡(*
num
 =
max_back
) {

146 
	`‰ì
(
ªt
);

147 
max_back
 *= 2;

148 
agaö
;

150  
ªt
;

151 
	}
}

155 **
	$gë_backåa˚
(*
num
)

157 *
num
 = 0;

158  
NULL
;

159 
	}
}

162 
Áûã°_ˇŒ
 *
	$add_hi°‹y_
(
Áûã°_ˇŒ_ty≥
 
ty≥
,

163 
boﬁ
 
ˇn_Àak
,

164 c⁄° *
fûe
,

165 
löe
,

166 c⁄° *
ñem
,

167 
size_t
 
ñem_size
)

169 
Áûã°_ˇŒ
 *
ˇŒ
;

172 i‡(!
fûe
)

173  &
uƒec‹ded_ˇŒ
;

175 
ˇŒ
 = 
	`mÆloc
( *call);

176 
ˇŒ
->
ty≥
 =Åype;

177 
ˇŒ
->
ˇn_Àak
 = can_leak;

178 
ˇŒ
->
fûe
 = file;

179 
ˇŒ
->
löe
 =Üine;

180 
ˇŒ
->
˛ónup
 = 
NULL
;

181 
ˇŒ
->
backåa˚
 = 
	`gë_backåa˚
(&ˇŒ->
backåa˚_num
);

182 
	`mem˝y
(&
ˇŒ
->
u
, 
ñem
, 
ñem_size
);

183 
	`éi°_add_èû
(&
hi°‹y
, 
ˇŒ
, 
li°
);

184  
ˇŒ
;

185 
	}
}

187 
	#add_hi°‹y
(
ty≥
, 
ˇn_Àak
, 
fûe
, 
löe
, 
ñem
) \

188 
	`add_hi°‹y_
((
ty≥
), (
ˇn_Àak
), (
fûe
), (
löe
), (
ñem
), (*”Àm)))

	)

191 
	#£t_˛ónup
(
ˇŒ
, 
˛ón
, 
ty≥
) \

192 (
ˇŒ
)->
˛ónup
 = (*)(()(
	`˛ón
((
ty≥
 *)
NULL
, 
Ál£
),1), (
˛ón
))

	)

195 
	$move_fd_to_high
(
fd
)

197 
i
;

198 
æimô
 
lim
;

199 
max
;

201 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, &
lim
) == 0) {

202 
max
 = 
lim
.
æim_cur
;

203 
	`¥ötf
("Max i†%i\n", 
max
);

205 
max
 = 
FD_SETSIZE
;

207 
i
 = 
max
 - 1; i > 
fd
; i--) {

208 i‡(
	`f˙é
(
i
, 
F_GETFL
Ë=-1 && 
î∫o
 =
EBADF
) {

209 i‡(
	`dup2
(
fd
, 
i
) == -1) {

210 
	`w¨n
("FaûedÅÿdu∞fd %òtÿ%i", 
fd
, 
i
);

213 
	`˛o£
(
fd
);

214  
i
;

218  
fd
;

219 
	}
}

221 
boﬁ
 
	$ªad_wrôe_öfo
(
fd
)

223 
wrôe_ˇŒ
 *
w
;

224 *
buf
;

227 
chûd_wrôes
 = 
	`ªÆloc
(child_writes,

228 (
chûd_wrôes_num
+1Ë* (
chûd_wrôes
[0]));

229 
w
 = &
chûd_wrôes
[
chûd_wrôes_num
];

230 i‡(!
	`ªad_Æl
(
fd
, 
w
, (*w)))

231  
Ál£
;

233 
w
->
buf
 = bu‡
	`mÆloc
(w->
cou¡
);

234 i‡(!
	`ªad_Æl
(
fd
, 
buf
, 
w
->
cou¡
))

235  
Ál£
;

237 
chûd_wrôes_num
++;

238  
åue
;

239 
	}
}

241 *
	$Áû∑th_°rög
()

243 
Áûã°_ˇŒ
 *
i
;

244 *
ªt
 = 
	`°rdup
("");

245 
Àn
 = 0;

248 
	`éi°_f‹_óch
(&
hi°‹y
, 
i
, 
li°
) {

249 
ªt
 = 
	`ªÆloc
‘ë, 
Àn
 + 2);

250 
ªt
[
Àn
] = 
öfo_to_¨g
[
i
->
ty≥
];

251 i‡(
i
->
Áû
)

252 
ªt
[
Àn
] = 
	`touµî
(ret[len]);

253 
ªt
[++
Àn
] = '\0';

255  
ªt
;

256 
	}
}

258 
	$do_w¨n
(
e
, c⁄° *
fmt
, 
va_li°
 
≠
)

260 *
p
 = 
	`Áû∑th_°rög
();

262 
	`vÂrötf
(
w¨nf
, 
fmt
, 
≠
);

263 i‡(
e
 != -1)

264 
	`Ârötf
(
w¨nf
, ": %s", 
	`°ªº‹
(
e
));

265 
	`Ârötf
(
w¨nf
, " [%s]\n", 
p
);

266 
	`‰ì
(
p
);

267 
	}
}

269 
	$fw¨n
(c⁄° *
fmt
, ...)

271 
va_li°
 
≠
;

272 
e
 = 
î∫o
;

274 
	`va_°¨t
(
≠
, 
fmt
);

275 
	`do_w¨n
(
e
, 
fmt
, 
≠
);

276 
	`va_íd
(
≠
);

277 
	}
}

280 
	$fw¨nx
(c⁄° *
fmt
, ...)

282 
va_li°
 
≠
;

284 
	`va_°¨t
(
≠
, 
fmt
);

285 
	`do_w¨n
(-1, 
fmt
, 
≠
);

286 
	`va_íd
(
≠
);

287 
	}
}

289 
	$ãŒ_∑ª¡
(
öfo_ty≥
 
ty≥
)

291 i‡(
c⁄åﬁ_fd
 != -1)

292 
	`wrôe_Æl
(
c⁄åﬁ_fd
, &
ty≥
, (type));

293 
	}
}

295 
	$chûd_Áû
(c⁄° *
out
, 
size_t
 
ouéí
, c⁄° *
fmt
, ...)

297 
va_li°
 
≠
;

298 *
∑th
 = 
	`Áû∑th_°rög
();

300 
	`va_°¨t
(
≠
, 
fmt
);

301 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

302 
	`va_íd
(
≠
);

304 
	`Ârötf
(
°dîr
, "%.*s", ()
ouéí
, 
out
);

305 
	`¥ötf
("Tÿª¥odu˚: --Áû∑th=%s\n", 
∑th
);

306 
	`‰ì
(
∑th
);

307 
	`ãŒ_∑ª¡
(
FAILURE
);

308 
	`exô
(1);

309 
	}
}

311 
	$PRINTF_FMT
(1, 2Ë
	$åa˚
(c⁄° *
fmt
, ...)

313 
va_li°
 
≠
;

314 
i
;

315 *
p
;

316 
idx
;

318 i‡(!
åa˚f
)

321 
i
 = 0; i < 
åa˚ödít
; i++)

322 
	`Ârötf
(
åa˚f
, " ");

324 
p
 = 
	`Áû∑th_°rög
();

325 
	`Ârötf
(
åa˚f
, "%i: %u: %†", 
idx
++, 
	`gëpid
(), 
p
);

326 
	`va_°¨t
(
≠
, 
fmt
);

327 
	`vÂrötf
(
åa˚f
, 
fmt
, 
≠
);

328 
	`va_íd
(
≠
);

329 
	`‰ì
(
p
);

330 
	}
}

332 
pid_t
 
	gchûd
;

334 
	$h™d_down
(
signum
)

336 
	`kûl
(
chûd
, 
signum
);

337 
	}
}

339 
	$ªÀa£_locks
()

342 i‡(
lock_ow√r
 == 0)

346 i‡(
lock_ow√r
 =
	`gëpid
()) {

347 
i
;

348 
Êock
 
Ê
;

349 
Ê
.
l_ty≥
 = 
F_UNLCK
;

350 
Ê
.
l_whí˚
 = 
SEEK_SET
;

351 
Ê
.
l_°¨t
 = 0;

352 
Ê
.
l_Àn
 = 0;

354 
	`åa˚
("Rñósög %uÜocks\n", 
lock_num
);

355 
i
 = 0; i < 
lock_num
; i++)

356 
	`f˙é
(
locks
[
i
].
fd
, 
F_SETLK
, &
Ê
);

359 
öfo_ty≥
 
ty≥
 = 
RELEASE_LOCKS
;

360 
	`as£π
(
c⁄åﬁ_fd
 != -1);

361 
	`wrôe_Æl
(
c⁄åﬁ_fd
, &
ty≥
, (type));

363 
lock_ow√r
 = 0;

364 
	}
}

367 
off_t
 
	$off_max
()

369 
	`BUILD_ASSERT
((
off_t
) == 4 || (off_t) == 8);

370 i‡((
off_t
) == 4)

371  (
off_t
)0x7FFFFFF;

373  (
off_t
)0x7FFFFFFFFFFFFFFULL;

374 
	}
}

376 
	$gë_locks
()

378 
i
;

379 
Êock
 
Ê
;

381 i‡(
lock_ow√r
 =
	`gëpid
())

384 i‡(
lock_ow√r
 != 0) {

385 
öfo_ty≥
 
ty≥
 = 
RELEASE_LOCKS
;

386 
	`as£π
(
c⁄åﬁ_fd
 != -1);

387 
	`åa˚
("AskingÖarentÅoÑeleaseÜocks\n");

388 
	`wrôe_Æl
(
c⁄åﬁ_fd
, &
ty≥
, (type));

391 
Ê
.
l_whí˚
 = 
SEEK_SET
;

393 
i
 = 0; i < 
lock_num
; i++) {

394 
Ê
.
l_ty≥
 = 
locks
[
i
].
ty≥
;

395 
Ê
.
l_°¨t
 = 
locks
[
i
].
°¨t
;

396 i‡(
locks
[
i
].
íd
 =
	`off_max
())

397 
Ê
.
l_Àn
 = 0;

399 
Ê
.
l_Àn
 = 
locks
[
i
].
íd
 -Üocks[i].
°¨t
 + 1;

401 i‡(
	`f˙é
(
locks
[
i
].
fd
, 
F_SETLKW
, &
Ê
) != 0)

402 
	`ab‹t
();

404 
	`åa˚
("Acquúed %uÜocks\n", 
lock_num
);

405 
lock_ow√r
 = 
	`gëpid
();

406 
	}
}

409 
c⁄ã¡s_ßved
 *
	$ßve_c⁄ã¡s
(c⁄° *
fûíame
,

410 
fd
, 
size_t
 
cou¡
, 
off_t
 
off
,

411 c⁄° *
why
)

413 
c⁄ã¡s_ßved
 *
s
 = 
	`mÆloc
((*sË+ 
cou¡
);

414 
ssize_t
 
ªt
;

416 
s
->
off
 = off;

418 
ªt
 = 
	`¥ód
(
fd
, 
s
->
c⁄ã¡s
, 
cou¡
, 
off
);

419 i‡(
ªt
 < 0) {

420 
	`fw¨n
("failtest_write: failedÅo save old contents!");

421 
s
->
cou¡
 = 0;

423 
s
->
cou¡
 = 
ªt
;

427 
off
 = 
	`l£ek
(
fd
, 0, 
SEEK_CUR
);

428 
s
->
ﬁd_Àn
 = 
	`l£ek
(
fd
, 0, 
SEEK_END
);

429 
	`l£ek
(
fd
, 
off
, 
SEEK_SET
);

431 
	`åa˚
("Saving %p %s %zu@%lluáfter %s (filelength %llu) via fd %i\n",

432 
s
, 
fûíame
, s->
cou¡
, ()s->
off
, 
why
,

433 ()
s
->
ﬁd_Àn
, 
fd
);

434  
s
;

435 
	}
}

437 
	$ª°‹e_c⁄ã¡s
(
Áûã°_ˇŒ
 *
›íî
,

438 
c⁄ã¡s_ßved
 *
s
,

439 
boﬁ
 
ª°‹e_off£t
,

440 c⁄° *
ˇŒî
)

442 
fd
;

445 i‡(
c⁄åﬁ_fd
 == -1)

449 i‡(
›íî
->
u
.
›í
.
˛o£d
) {

451 
fd
 = 
	`›í
(
›íî
->
u
.
›í
.
∑th«me
, 
O_RDWR
);

452 i‡(
fd
 < 0) {

453 
	`fw¨n
("failtest: couldÇotÑeopen %sÅo clean up %s!",

454 
›íî
->
u
.
›í
.
∑th«me
, 
ˇŒî
);

458 
fd
 = 
	`move_fd_to_high
(fd);

459 
	`åa˚
("Reopening %sÅoÑestore it (was fd %i,Çow %i)\n",

460 
›íî
->
u
.
›í
.
∑th«me
, o≥√r->u.›í.
ªt
, 
fd
);

461 
›íî
->
u
.
›í
.
ªt
 = 
fd
;

462 
›íî
->
u
.
›í
.
˛o£d
 = 
Ál£
;

464 
fd
 = 
›íî
->
u
.
›í
.
ªt
;

466 
	`åa˚
("Restoring %p %s %zu@%lluáfter %s (filelength %llu) via fd %i\n",

467 
s
, 
›íî
->
u
.
›í
.
∑th«me
, s->
cou¡
, ()s->
off
, 
ˇŒî
,

468 ()
s
->
ﬁd_Àn
, 
fd
);

469 i‡(
	`pwrôe
(
fd
, 
s
->
c⁄ã¡s
, s->
cou¡
, s->
off
) != s->count) {

470 
	`fw¨n
("failtest: write failed cleaning up %s for %s!",

471 
›íî
->
u
.
›í
.
∑th«me
, 
ˇŒî
);

474 i‡(
	`·runˇã
(
fd
, 
s
->
ﬁd_Àn
) != 0) {

475 
	`fw¨n
("failtest_write:Åruncate failed cleaning up %s for %s!",

476 
›íî
->
u
.
›í
.
∑th«me
, 
ˇŒî
);

479 i‡(
ª°‹e_off£t
) {

480 
	`åa˚
("Restoring offset of fd %iÅo %llu\n",

481 
fd
, ()
s
->
off
);

482 
	`l£ek
(
fd
, 
s
->
off
, 
SEEK_SET
);

484 
	}
}

487 
	$ßve_mm≠≥d_fûes
()

489 
Áûã°_ˇŒ
 *
i
;

490 
	`åa˚
("Saving mmapped files in child\n");

492 
	`éi°_f‹_óch_ªv
(&
hi°‹y
, 
i
, 
li°
) {

493 
mm≠_ˇŒ
 *
m
 = &
i
->
u
.
mm≠
;

494 
ßved_mm≠≥d_fûe
 *
s
;

496 i‡(
i
->
ty≥
 !
FAILTEST_MMAP
)

500 i‡(
m
->
›íî
->
u
.
›í
.
˛o£d
)

503 
s
 = 
	`mÆloc
( *s);

504 
s
->†
	`ßve_c⁄ã¡s
(
m
->
›íî
->
u
.
›í
.
∑th«me
,

505 
m
->
fd
, m->
Àngth
, m->
off£t
,

507 
s
->
›íî
 = 
m
->opener;

508 
s
->
√xt
 = 
ßved_mm≠≥d_fûes
;

509 
ßved_mm≠≥d_fûes
 = 
s
;

511 
	}
}

513 
	$‰ì_mm≠≥d_fûes
(
boﬁ
 
ª°‹e
)

515 
	`åa˚
("%s mmapped files in child\n",

516 
ª°‹e
 ? "Restoring" : "Discarding");

517 
ßved_mm≠≥d_fûes
) {

518 
ßved_mm≠≥d_fûe
 *
√xt
 = 
ßved_mm≠≥d_fûes
->next;

519 i‡(
ª°‹e
)

520 
	`ª°‹e_c⁄ã¡s
(
ßved_mm≠≥d_fûes
->
›íî
,

521 
ßved_mm≠≥d_fûes
->
s
, 
Ál£
,

523 
	`‰ì
(
ßved_mm≠≥d_fûes
->
s
);

524 
	`‰ì
(
ßved_mm≠≥d_fûes
);

525 
ßved_mm≠≥d_fûes
 = 
√xt
;

527 
	}
}

530 
Áûã°_ˇŒ
 *
	$›íî_of
(
fd
)

532 
Áûã°_ˇŒ
 *
i
;

535 i‡(
fd
 < 0)

536  
NULL
;

539 
	`éi°_f‹_óch_ªv
(&
hi°‹y
, 
i
, 
li°
) {

540 i‡(
i
->
Áû
)

542 
i
->
ty≥
) {

543 
FAILTEST_CLOSE
:

544 i‡(
i
->
u
.
˛o£
.
fd
 == fd) {

545  
NULL
;

548 
FAILTEST_OPEN
:

549 i‡(
i
->
u
.
›í
.
ªt
 =
fd
) {

550 i‡(
i
->
u
.
›í
.
˛o£d
)

551  
NULL
;

552  
i
;

555 
FAILTEST_PIPE
:

556 i‡(
i
->
u
.
pùe
.
fds
[0] =
fd
 || i->u.pipe.fds[1] == fd) {

557  
i
;

566  
NULL
;

567 
	}
}

569 
	$‰ì_ˇŒ
(
Áûã°_ˇŒ
 *
ˇŒ
)

572 i‡(
ˇŒ
->
ty≥
 =
FAILTEST_OPEN
)

573 
	`‰ì
((*)
ˇŒ
->
u
.
›í
.
∑th«me
);

574 
	`‰ì
(
ˇŒ
->
backåa˚
);

575 
	`éi°_dñ_‰om
(&
hi°‹y
, 
ˇŒ
, 
li°
);

576 
	`‰ì
(
ˇŒ
);

577 
	}
}

580 
	$‰ì_evîythög
()

582 
Áûã°_ˇŒ
 *
i
;

584 (
i
 = 
	`éi°_t›
(&
hi°‹y
, 
li°
)Ë!
NULL
)

585 
	`‰ì_ˇŒ
(
i
);

587 
	`ÁûèbÀ_˛ór
(&
ÁûèbÀ
);

588 
	}
}

590 
NORETURN
 
	$Áûã°_˛ónup
(
boﬁ
 
f‹˚d_˛ónup
, 
°©us
)

592 
Áûã°_ˇŒ
 *
i
;

593 
boﬁ
 
ª°‹e
 = 
åue
;

596 i‡(
c⁄åﬁ_fd
 != -1)

597 
°©us
 = 0;

600 
ª°‹e
 = 
Ál£
;

603 
	`éi°_f‹_óch_ªv
(&
hi°‹y
, 
i
, 
li°
) {

605 i‡(
i
 =
our_hi°‹y_°¨t
)

606 
ª°‹e
 = 
Ál£
;

608 i‡(
i
->
Áû
)

611 i‡(
i
->
˛ónup
)

612 
i
->
	`˛ónup
(&i->
u
, 
ª°‹e
);

615 i‡(!
f‹˚d_˛ónup
 && 
i
->
ˇn_Àak
) {

616 
	`¥ötf
("Leakát %s:%u: --failpath=%s\n",

617 
i
->
fûe
, i->
löe
, 
	`Áû∑th_°rög
());

618 
°©us
 = 1;

623 
	`‰ì_mm≠≥d_fûes
(
åue
);

625 
	`‰ì_evîythög
();

626 i‡(
°©us
 == 0)

627 
	`ãŒ_∑ª¡
(
SUCCESS
);

629 
	`ãŒ_∑ª¡
(
FAILURE
);

630 
	`exô
(
°©us
);

631 
	}
}

633 
boﬁ
 
	$fﬁlowög_∑th
()

635 i‡(!
Áû∑th
)

636  
Ál£
;

638 i‡(*
Áû∑th
 == '+') {

639 
Áû∑th
 = 
NULL
;

640  
Ál£
;

642  
åue
;

643 
	}
}

645 
boﬁ
 
	$fﬁlow_∑th
(
Áûã°_ˇŒ
 *
ˇŒ
)

647 i‡(*
Áû∑th
 == '\0') {

649  
ˇŒ
->
Áû
 = 
Ál£
;

652 i‡(
	`tﬁowî
(()*
Áû∑th
Ë!
öfo_to_¨g
[
ˇŒ
->
ty≥
])

653 
	`îrx
(1, "FailpathÉxpected '%s' got '%c'\n",

654 
Áû∑th
, 
öfo_to_¨g
[
ˇŒ
->
ty≥
]);

655 
ˇŒ
->
Áû
 = 
	`cisuµî
(*(
Áû∑th
++));

656 i‡(
ˇŒ
->
Áû
)

657 
ˇŒ
->
ˇn_Àak
 = 
Ál£
;

658  
ˇŒ
->
Áû
;

659 
	}
}

661 
boﬁ
 
	$should_Áû
(
Áûã°_ˇŒ
 *
ˇŒ
)

663 
°©us
;

664 
c⁄åﬁ
[2], 
ouçut
[2];

665 
öfo_ty≥
 
ty≥
 = 
UNEXPECTED
;

666 *
out
 = 
NULL
;

667 
size_t
 
ouéí
 = 0;

668 
Áûã°_ˇŒ
 *
dup
;

670 i‡(
ˇŒ
 =&
uƒec‹ded_ˇŒ
)

671  
Ál£
;

673 i‡(
	`fﬁlowög_∑th
())

674  
	`fﬁlow_∑th
(
ˇŒ
);

677 i‡(
debug∑th
) {

678 *
∑th
;

682 
ˇŒ
->
Áû
 = 
	`cisuµî
(
debug∑th
[
	`°æí
(debugpath)-1]);

683 
∑th
 = 
	`Áû∑th_°rög
();

685 i‡(
	`°ªq
(
∑th
, 
debug∑th
)) {

686 
°r
[80];

689 
	`sig«l
(
SIGUSR1
, 
SIG_IGN
);

690 
	`•rötf
(
°r
, "xterm -e gdb /proc/%d/exe %d &",

691 
	`gëpid
(), getpid());

692 i‡(
	`sy°em
(
°r
) == 0)

693 
	`¶ìp
(5);

696 
∑th
[
	`°æí
(path)-1] = '\0';

697 i‡(!
	`°r°¨ts
(
debug∑th
, 
∑th
)) {

698 
	`Ârötf
(
°dîr
,

699 "--debug∑thÇŸ fﬁlowed: %s\n", 
∑th
);

700 
debug∑th
 = 
NULL
;

703 
	`‰ì
(
∑th
);

707 i‡(
¥obög
) {

708 
	`åa˚
("Not failing %c dueÅo FAIL_PROBEÑeturn\n",

709 
öfo_to_¨g
[
ˇŒ
->
ty≥
]);

710  
ˇŒ
->
Áû
 = 
Ál£
;

714 
dup
 = 
	`ÁûèbÀ_gë
(&
ÁûèbÀ
, 
ˇŒ
);

715 i‡(
dup
) {

716 
	`åa˚
("Not failing %c dueÅo duplicate\n",

717 
öfo_to_¨g
[
ˇŒ
->
ty≥
]);

718  
ˇŒ
->
Áû
 = 
Ál£
;

721 i‡(
Áûã°_hook
) {

722 
	`Áûã°_hook
(&
hi°‹y
)) {

723 
FAIL_OK
:

725 
FAIL_PROBE
:

726 
¥obög
 = 
åue
;

728 
FAIL_DONT_FAIL
:

729 
	`åa˚
("Not failing %c dueÅo failhookÑeturn\n",

730 
öfo_to_¨g
[
ˇŒ
->
ty≥
]);

731 
ˇŒ
->
Áû
 = 
Ál£
;

732  
Ál£
;

734 
	`ab‹t
();

739 
	`ÁûèbÀ_add
(&
ÁûèbÀ
, 
ˇŒ
);

742 
ˇŒ
->
Áû
 = 
åue
;

743 i‡(
	`pùe
(
c⁄åﬁ
Ë!0 ||Öùe(
ouçut
) != 0)

744 
	`îr
(1, "openingÖipe");

747 
c⁄åﬁ
[0] = 
	`move_fd_to_high
(control[0]);

748 
c⁄åﬁ
[1] = 
	`move_fd_to_high
(control[1]);

749 
ouçut
[0] = 
	`move_fd_to_high
(output[0]);

750 
ouçut
[1] = 
	`move_fd_to_high
(output[1]);

753 
	`fÊush
(
°dout
);

754 
	`fÊush
(
w¨nf
);

755 i‡(
åa˚f
)

756 
	`fÊush
(
åa˚f
);

757 
chûd
 = 
	`f‹k
();

758 i‡(
chûd
 == -1)

759 
	`îr
(1, "forking failed");

761 i‡(
chûd
 == 0) {

762 
åa˚ödít
++;

763 i‡(
åa˚f
) {

764 
time•ec
 
diff
;

765 c⁄° *
p
;

766 *
Áû∑th
;

767 
Áûã°_ˇŒ
 *
c
;

769 
c
 = 
	`éi°_èû
(&
hi°‹y
, 
li°
);

770 
diff
 = 
	`time_sub
(
	`time_now
(), 
°¨t
);

771 
Áû∑th
 = 
	`Áû∑th_°rög
();

772 
p
 = 
	`°ºchr
(
c
->
fûe
, '/');

773 i‡(
p
)

774 
p
++;

776 
p
 = 
c
->
fûe
;

777 
	`åa˚
("%u->%u (%u.%02u): %s (%s:%u)\n",

778 
	`gëµid
(), 
	`gëpid
(),

779 ()
diff
.
tv_£c
, ()diff.
tv_n£c
 / 10000000,

780 
Áû∑th
, 
p
, 
c
->
löe
);

781 
	`‰ì
(
Áû∑th
);

784 
our_hi°‹y_°¨t
 = 
	`éi°_èû
(&
hi°‹y
, 
li°
);

785 
	`˛o£
(
c⁄åﬁ
[0]);

786 
	`˛o£
(
ouçut
[0]);

788 i‡(!
åa˚f
) {

789 
	`dup2
(
ouçut
[1], 
STDOUT_FILENO
);

790 
	`dup2
(
ouçut
[1], 
STDERR_FILENO
);

791 i‡(
ouçut
[1] !
STDOUT_FILENO


792 && 
ouçut
[1] !
STDERR_FILENO
)

793 
	`˛o£
(
ouçut
[1]);

795 
c⁄åﬁ_fd
 = 
	`move_fd_to_high
(
c⁄åﬁ
[1]);

798 
	`‰ì_mm≠≥d_fûes
(
Ál£
);

801 
	`ßve_mm≠≥d_fûes
();

804 
ˇŒ
->
ˇn_Àak
 = 
Ál£
;

806  
åue
;

809 
	`sig«l
(
SIGUSR1
, 
h™d_down
);

811 
	`˛o£
(
c⁄åﬁ
[1]);

812 
	`˛o£
(
ouçut
[1]);

817 
pﬁlfd
 
pfd
[2];

818 
ªt
;

820 
pfd
[0].
fd
 = 
ouçut
[0];

821 
pfd
[0].
evíts
 = 
POLLIN
|
POLLHUP
;

822 
pfd
[1].
fd
 = 
c⁄åﬁ
[0];

823 
pfd
[1].
evíts
 = 
POLLIN
|
POLLHUP
;

825 i‡(
ty≥
 =
SUCCESS
)

826 
ªt
 = 
	`pﬁl
(
pfd
, 1, 
Áûã°_timeout_ms
);

828 
ªt
 = 
	`pﬁl
(
pfd
, 2, 
Áûã°_timeout_ms
);

830 i‡(
ªt
 == 0)

831 
	`h™d_down
(
SIGUSR1
);

832 i‡(
ªt
 < 0) {

833 i‡(
î∫o
 =
EINTR
)

835 
	`îr
(1, "Pﬁ»ªtu∫ed %i", 
ªt
);

838 i‡(
pfd
[0].
ªvíts
 & 
POLLIN
) {

839 
ssize_t
 
Àn
;

841 
out
 = 
	`ªÆloc
(out, 
ouéí
 + 8192);

842 
Àn
 = 
	`ªad
(
ouçut
[0], 
out
 + 
ouéí
, 8192);

843 
ouéí
 +
Àn
;

844 } i‡(
ty≥
 !
SUCCESS
 && (
pfd
[1].
ªvíts
 & 
POLLIN
)) {

845 i‡(
	`ªad_Æl
(
c⁄åﬁ
[0], &
ty≥
, (type))) {

846 i‡(
ty≥
 =
WRITE
) {

847 i‡(!
	`ªad_wrôe_öfo
(
c⁄åﬁ
[0]))

849 } i‡(
ty≥
 =
RELEASE_LOCKS
) {

850 
	`ªÀa£_locks
();

854 } i‡(
pfd
[0].
ªvíts
 & 
POLLHUP
) {

857 } 
ty≥
 !
FAILURE
);

859 
	`˛o£
(
ouçut
[0]);

860 
	`˛o£
(
c⁄åﬁ
[0]);

861 
	`waôpid
(
chûd
, &
°©us
, 0);

862 i‡(!
	`WIFEXITED
(
°©us
)) {

863 i‡(
	`WTERMSIG
(
°©us
Ë=
SIGUSR1
)

864 
	`chûd_Áû
(
out
, 
ouéí
, "Timed out");

866 
	`chûd_Áû
(
out
, 
ouéí
, "Killed by signal %u: ",

867 
	`WTERMSIG
(
°©us
));

870 i‡(
ty≥
 =
FAILURE
) {

871 
	`Ârötf
(
°dîr
, "%.*s", ()
ouéí
, 
out
);

872 
	`ãŒ_∑ª¡
(
ty≥
);

873 
	`exô
(
	`WEXITSTATUS
(
°©us
) ? WEXITSTATUS(status) : 1);

875 i‡(
	`WEXITSTATUS
(
°©us
) != 0)

876 
	`chûd_Áû
(
out
, 
ouéí
, "Exited with status %i: ",

877 
	`WEXITSTATUS
(
°©us
));

879 
	`‰ì
(
out
);

880 
	`sig«l
(
SIGUSR1
, 
SIG_DFL
);

883 
¥obög
 = 
Ál£
;

886 
ˇŒ
->
Áû
 = 
Ál£
;

887  
Ál£
;

888 
	}
}

890 
	$˛ónup_ˇŒoc
(
ˇŒoc_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

892 
	`åa˚
("undoög cÆlo¯%p\n", 
ˇŒ
->
ªt
);

893 
	`‰ì
(
ˇŒ
->
ªt
);

894 
	}
}

896 *
	$Áûã°_ˇŒoc
(
size_t
 
nmemb
, size_à
size
,

897 c⁄° *
fûe
, 
löe
)

899 
Áûã°_ˇŒ
 *
p
;

900 
ˇŒoc_ˇŒ
 
ˇŒ
;

901 
ˇŒ
.
nmemb
 =Çmemb;

902 
ˇŒ
.
size
 = size;

903 
p
 = 
	`add_hi°‹y
(
FAILTEST_CALLOC
, 
åue
, 
fûe
, 
löe
, &
ˇŒ
);

905 i‡(
	`should_Áû
(
p
)) {

906 
p
->
u
.
ˇŒoc
.
ªt
 = 
NULL
;

907 
p
->
îr‹
 = 
ENOMEM
;

909 
p
->
u
.
ˇŒoc
.
ªt
 = 
	`ˇŒoc
(
nmemb
, 
size
);

910 
	`£t_˛ónup
(
p
, 
˛ónup_ˇŒoc
, 
ˇŒoc_ˇŒ
);

912 
	`åa˚
("calloc %zu x %zu %s:%u -> %p\n",

913 
nmemb
, 
size
, 
fûe
, 
löe
, 
p
->
u
.
ˇŒoc
.
ªt
);

914 
î∫o
 = 
p
->
îr‹
;

915  
p
->
u
.
ˇŒoc
.
ªt
;

916 
	}
}

918 
	$˛ónup_mÆloc
(
mÆloc_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

920 
	`åa˚
("undoög mÆlo¯%p\n", 
ˇŒ
->
ªt
);

921 
	`‰ì
(
ˇŒ
->
ªt
);

922 
	}
}

924 *
	$Áûã°_mÆloc
(
size_t
 
size
, c⁄° *
fûe
, 
löe
)

926 
Áûã°_ˇŒ
 *
p
;

927 
mÆloc_ˇŒ
 
ˇŒ
;

928 
ˇŒ
.
size
 = size;

930 
p
 = 
	`add_hi°‹y
(
FAILTEST_MALLOC
, 
åue
, 
fûe
, 
löe
, &
ˇŒ
);

931 i‡(
	`should_Áû
(
p
)) {

932 
p
->
u
.
mÆloc
.
ªt
 = 
NULL
;

933 
p
->
îr‹
 = 
ENOMEM
;

935 
p
->
u
.
mÆloc
.
ªt
 = 
	`mÆloc
(
size
);

936 
	`£t_˛ónup
(
p
, 
˛ónup_mÆloc
, 
mÆloc_ˇŒ
);

938 
	`åa˚
("malloc %zu %s:%u -> %p\n",

939 
size
, 
fûe
, 
löe
, 
p
->
u
.
mÆloc
.
ªt
);

940 
î∫o
 = 
p
->
îr‹
;

941  
p
->
u
.
mÆloc
.
ªt
;

942 
	}
}

944 
	$˛ónup_ªÆloc
(
ªÆloc_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

946 
	`åa˚
("undoögÑóŒo¯%p\n", 
ˇŒ
->
ªt
);

947 
	`‰ì
(
ˇŒ
->
ªt
);

948 
	}
}

951 
	$fixup_±r_hi°‹y
(*
±r
, c⁄° *
why
)

953 
Áûã°_ˇŒ
 *
i
;

956 
	`éi°_f‹_óch_ªv
(&
hi°‹y
, 
i
, 
li°
) {

957 
i
->
ty≥
) {

958 
FAILTEST_REALLOC
:

959 i‡(
i
->
u
.
ªÆloc
.
ªt
 =
±r
) {

960 
	`åa˚
("foundÑealloc %p %s:%u matching %s\n",

961 
±r
, 
i
->
fûe
, i->
löe
, 
why
);

962 
i
->
˛ónup
 = 
NULL
;

963 
i
->
ˇn_Àak
 = 
Ál£
;

967 
FAILTEST_MALLOC
:

968 i‡(
i
->
u
.
mÆloc
.
ªt
 =
±r
) {

969 
	`åa˚
("found malloc %p %s:%u matching %s\n",

970 
±r
, 
i
->
fûe
, i->
löe
, 
why
);

971 
i
->
˛ónup
 = 
NULL
;

972 
i
->
ˇn_Àak
 = 
Ál£
;

976 
FAILTEST_CALLOC
:

977 i‡(
i
->
u
.
ˇŒoc
.
ªt
 =
±r
) {

978 
	`åa˚
("found calloc %p %s:%u matching %s\n",

979 
±r
, 
i
->
fûe
, i->
löe
, 
why
);

980 
i
->
˛ónup
 = 
NULL
;

981 
i
->
ˇn_Àak
 = 
Ál£
;

989 
	`åa˚
("DidÇŸ föd %∞m©chög %s\n", 
±r
, 
why
);

990 
	}
}

992 *
	$Áûã°_ªÆloc
(*
±r
, 
size_t
 
size
, c⁄° *
fûe
, 
löe
)

994 
Áûã°_ˇŒ
 *
p
;

995 
ªÆloc_ˇŒ
 
ˇŒ
;

996 
ˇŒ
.
size
 = size;

997 
p
 = 
	`add_hi°‹y
(
FAILTEST_REALLOC
, 
åue
, 
fûe
, 
löe
, &
ˇŒ
);

1000 i‡(
	`should_Áû
(
p
)) {

1001 
p
->
u
.
ªÆloc
.
ªt
 = 
NULL
;

1002 
p
->
îr‹
 = 
ENOMEM
;

1005 
p
->
u
.
ªÆloc
.
ªt
 = 
NULL
;

1006 
	`fixup_±r_hi°‹y
(
±r
, "realloc");

1007 
p
->
u
.
ªÆloc
.
ªt
 = 
	`ªÆloc
(
±r
, 
size
);

1008 
	`£t_˛ónup
(
p
, 
˛ónup_ªÆloc
, 
ªÆloc_ˇŒ
);

1010 
	`åa˚
("realloc %p %s:%u -> %p\n",

1011 
±r
, 
fûe
, 
löe
, 
p
->
u
.
ªÆloc
.
ªt
);

1012 
î∫o
 = 
p
->
îr‹
;

1013  
p
->
u
.
ªÆloc
.
ªt
;

1014 
	}
}

1019 
	$Áûã°_‰ì
(*
±r
)

1021 
	`fixup_±r_hi°‹y
(
±r
, "free");

1022 
	`åa˚
("‰ì %p\n", 
±r
);

1023 
	`‰ì
(
±r
);

1024 
	}
}

1027 
c⁄ã¡s_ßved
 *
	$ßve_fûe
(c⁄° *
∑th«me
)

1029 
fd
;

1030 
c⁄ã¡s_ßved
 *
s
;

1032 
fd
 = 
	`›í
(
∑th«me
, 
O_RDONLY
);

1033 i‡(
fd
 < 0)

1034  
NULL
;

1036 
s
 = 
	`ßve_c⁄ã¡s
(
∑th«me
, 
fd
, 
	`l£ek
(fd, 0, 
SEEK_END
), 0,

1038 
	`˛o£
(
fd
);

1039  
s
;

1040 
	}
}

1044 
boﬁ
 
	$›í_would_Áû
(c⁄° *
∑th«me
, 
Êags
)

1046 i‡((
Êags
 & 
O_ACCMODE
Ë=
O_RDONLY
)

1047  
	`ac˚ss
(
∑th«me
, 
R_OK
) != 0;

1048 i‡(!(
Êags
 & 
O_CREAT
)) {

1049 i‡((
Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
)

1050  
	`ac˚ss
(
∑th«me
, 
W_OK
) != 0;

1051 i‡((
Êags
 & 
O_ACCMODE
Ë=
O_RDWR
)

1052  
	`ac˚ss
(
∑th«me
, 
W_OK
) != 0

1053 || 
	`ac˚ss
(
∑th«me
, 
R_OK
) != 0;

1056  
Ál£
;

1057 
	}
}

1059 
	$˛ónup_›í
(
›í_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

1061 i‡(
ª°‹e
 && 
ˇŒ
->
ßved
)

1062 
	`ª°‹e_c⁄ã¡s
(
	`c⁄èöî_of
(
ˇŒ
, 
Áûã°_ˇŒ
,

1063 
u
.
›í
),

1064 
ˇŒ
->
ßved
, 
Ál£
, "open with O_TRUNC");

1065 i‡(!
ˇŒ
->
˛o£d
) {

1066 
	`åa˚
("Cleaning up open %s by closing fd %i\n",

1067 
ˇŒ
->
∑th«me
, cÆl->
ªt
);

1068 
	`˛o£
(
ˇŒ
->
ªt
);

1069 
ˇŒ
->
˛o£d
 = 
åue
;

1071 
	`‰ì
(
ˇŒ
->
ßved
);

1072 
	}
}

1074 
	$Áûã°_›í
(c⁄° *
∑th«me
,

1075 c⁄° *
fûe
, 
löe
, ...)

1077 
Áûã°_ˇŒ
 *
p
;

1078 
›í_ˇŒ
 
ˇŒ
;

1079 
va_li°
 
≠
;

1081 
ˇŒ
.
∑th«me
 = 
	`°rdup
(pathname);

1082 
	`va_°¨t
(
≠
, 
löe
);

1083 
ˇŒ
.
Êags
 = 
	`va_¨g
(
≠
, );

1084 
ˇŒ
.
Æways_ßve
 = 
Ál£
;

1085 
ˇŒ
.
˛o£d
 = 
Ál£
;

1086 i‡(
ˇŒ
.
Êags
 & 
O_CREAT
) {

1087 
ˇŒ
.
mode
 = 
	`va_¨g
(
≠
, );

1088 
	`va_íd
(
≠
);

1090 
p
 = 
	`add_hi°‹y
(
FAILTEST_OPEN
, 
åue
, 
fûe
, 
löe
, &
ˇŒ
);

1092 i‡(
p
 =&
uƒec‹ded_ˇŒ
)

1093 
	`‰ì
((*)
ˇŒ
.
∑th«me
);

1095 i‡(
	`should_Áû
(
p
)) {

1097 i‡(
	`›í_would_Áû
(
∑th«me
, 
ˇŒ
.
Êags
)) {

1098 
	`åa˚
("Open would have failedányway: stopping\n");

1099 
	`Áûã°_˛ónup
(
åue
, 0);

1101 
p
->
u
.
›í
.
ªt
 = -1;

1103 
p
->
îr‹
 = 
EACCES
;

1106 i‡(
ˇŒ
.
Êags
 & 
O_TRUNC
)

1107 
p
->
u
.
›í
.
ßved
 = 
	`ßve_fûe
(
∑th«me
);

1109 
p
->
u
.
›í
.
ßved
 = 
NULL
;

1110 
p
->
u
.
›í
.
ªt
 = 
	`›í
(
∑th«me
, 
ˇŒ
.
Êags
, cÆl.
mode
);

1111 i‡(
p
->
u
.
›í
.
ªt
 == -1) {

1112 
p
->
u
.
›í
.
˛o£d
 = 
åue
;

1113 
p
->
ˇn_Àak
 = 
Ál£
;

1115 
	`£t_˛ónup
(
p
, 
˛ónup_›í
, 
›í_ˇŒ
);

1118 
	`åa˚
("open %s %s:%u -> %i (opener %p)\n",

1119 
∑th«me
, 
fûe
, 
löe
, 
p
->
u
.
›í
.
ªt
, &p->u.open);

1120 
î∫o
 = 
p
->
îr‹
;

1121  
p
->
u
.
›í
.
ªt
;

1122 
	}
}

1124 
	$˛ónup_mm≠
(
mm≠_ˇŒ
 *
mm≠
, 
boﬁ
 
ª°‹e
)

1126 
	`åa˚
("cleaning up mmap @%p (opener %p)\n",

1127 
mm≠
->
ªt
, mm≠->
›íî
);

1128 i‡(
ª°‹e
)

1129 
	`ª°‹e_c⁄ã¡s
(
mm≠
->
›íî
, mm≠->
ßved
, 
Ál£
, "mmap");

1130 
	`‰ì
(
mm≠
->
ßved
);

1131 
	}
}

1133 *
	$Áûã°_mm≠
(*
addr
, 
size_t
 
Àngth
, 
¥Ÿ
, 
Êags
,

1134 
fd
, 
off_t
 
off£t
, c⁄° *
fûe
, 
löe
)

1136 
Áûã°_ˇŒ
 *
p
;

1137 
mm≠_ˇŒ
 
ˇŒ
;

1139 
ˇŒ
.
addr
 =áddr;

1140 
ˇŒ
.
Àngth
 =Üength;

1141 
ˇŒ
.
¥Ÿ
 =Örot;

1142 
ˇŒ
.
Êags
 = flags;

1143 
ˇŒ
.
off£t
 = offset;

1144 
ˇŒ
.
fd
 = fd;

1145 
ˇŒ
.
›íî
 = 
	`›íî_of
(
fd
);

1148 i‡(!
ˇŒ
.
›íî
) {

1149 i‡(
fd
 != -1) {

1150 
	`fw¨nx
("failtest_mmap: couldn't figure out source for"

1151 " fd %ò© %s:%u", 
fd
, 
fûe
, 
löe
);

1153 
addr
 = 
	`mm≠
◊ddr, 
Àngth
, 
¥Ÿ
, 
Êags
, 
fd
, 
off£t
);

1154 
	`åa˚
("mm≠ o‡fd %ò-> %∞(›íî = NULL)\n", 
fd
, 
addr
);

1155  
addr
;

1158 
p
 = 
	`add_hi°‹y
(
FAILTEST_MMAP
, 
Ál£
, 
fûe
, 
löe
, &
ˇŒ
);

1159 i‡(
	`should_Áû
(
p
)) {

1160 
p
->
u
.
mm≠
.
ªt
 = 
MAP_FAILED
;

1161 
p
->
îr‹
 = 
ENOMEM
;

1163 
p
->
u
.
mm≠
.
ªt
 = 
	`mm≠
(
addr
, 
Àngth
, 
¥Ÿ
, 
Êags
, 
fd
, 
off£t
);

1165 i‡(
p
->
u
.
mm≠
.
ªt
 !
MAP_FAILED


1166 && (
¥Ÿ
 & 
PROT_WRITE
)

1167 && 
ˇŒ
.
›íî
->
ty≥
 =
FAILTEST_OPEN
) {

1168 c⁄° *
‚ame
 = 
ˇŒ
.
›íî
->
u
.
›í
.
∑th«me
;

1169 
p
->
u
.
mm≠
.
ßved
 = 
	`ßve_c⁄ã¡s
(
‚ame
, 
fd
, 
Àngth
,

1170 
off£t
, "being mmapped");

1171 
	`£t_˛ónup
(
p
, 
˛ónup_mm≠
, 
mm≠_ˇŒ
);

1174 
	`åa˚
("mmap of fd %i %s:%u -> %p (opener = %p)\n",

1175 
fd
, 
fûe
, 
löe
, 
addr
, 
ˇŒ
.
›íî
);

1176 
î∫o
 = 
p
->
îr‹
;

1177  
p
->
u
.
mm≠
.
ªt
;

1178 
	}
}

1182 *
	$Áûã°_mm≠_nﬁoc
(*
addr
, 
size_t
 
Àngth
, 
¥Ÿ
, 
Êags
,

1183 
fd
, 
off_t
 
off£t
)

1185  
	`Áûã°_mm≠
(
addr
, 
Àngth
, 
¥Ÿ
, 
Êags
, 
fd
, 
off£t
,

1186 
__FILE__
, 
__LINE__
);

1187 
	}
}

1189 
	$˛ónup_pùe
(
pùe_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

1191 
	`åa˚
("cleaning upÖipe fd=%i%s,%i%s\n",

1192 
ˇŒ
->
fds
[0], cÆl->
˛o£d
[0] ? "(already closed)" : "",

1193 
ˇŒ
->
fds
[1], cÆl->
˛o£d
[1] ? "(already closed)" : "");

1194 i‡(!
ˇŒ
->
˛o£d
[0])

1195 
	`˛o£
(
ˇŒ
->
fds
[0]);

1196 i‡(!
ˇŒ
->
˛o£d
[1])

1197 
	`˛o£
(
ˇŒ
->
fds
[1]);

1198 
	}
}

1200 
	$Áûã°_pùe
(
pùefd
[2], c⁄° *
fûe
, 
löe
)

1202 
Áûã°_ˇŒ
 *
p
;

1203 
pùe_ˇŒ
 
ˇŒ
;

1205 
p
 = 
	`add_hi°‹y
(
FAILTEST_PIPE
, 
åue
, 
fûe
, 
löe
, &
ˇŒ
);

1206 i‡(
	`should_Áû
(
p
)) {

1207 
p
->
u
.
›í
.
ªt
 = -1;

1209 
p
->
îr‹
 = 
EMFILE
;

1211 
p
->
u
.
pùe
.
ªt
 = 
	`pùe
’->u.pùe.
fds
);

1212 
p
->
u
.
pùe
.
˛o£d
[0] =Ö->u.pùe.˛o£d[1] = 
Ál£
;

1213 
	`£t_˛ónup
(
p
, 
˛ónup_pùe
, 
pùe_ˇŒ
);

1216 
	`åa˚
("pùê%s:%u -> %i,%i\n", 
fûe
, 
löe
,

1217 
p
->
u
.
pùe
.
ªt
 ? -1 :Ö->u.pùe.
fds
[0],

1218 
p
->
u
.
pùe
.
ªt
 ? -1 :Ö->u.pùe.
fds
[1]);

1221 
	`mem˝y
(
pùefd
, 
p
->
u
.
pùe
.
fds
, (p->u.pipe.fds));

1222 
î∫o
 = 
p
->
îr‹
;

1223  
p
->
u
.
pùe
.
ªt
;

1224 
	}
}

1226 
	$˛ónup_ªad
(
ªad_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

1228 i‡(
ª°‹e
) {

1229 
	`åa˚
("cleaning upÑead on fd %i: seekingÅo %llu\n",

1230 
ˇŒ
->
fd
, ()ˇŒ->
off
);

1233 i‡(
	`l£ek
(
ˇŒ
->
fd
, cÆl->
off
, 
SEEK_SET
) != call->off) {

1234 
	`fw¨n
("RestoringÜseekÖointer failed (read)");

1237 
	}
}

1239 
ssize_t
 
	$Áûã°_add_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
, 
off_t
 
off
,

1240 
boﬁ
 
is_¥ód
, c⁄° *
fûe
, 
löe
)

1242 
Áûã°_ˇŒ
 *
p
;

1243 
ªad_ˇŒ
 
ˇŒ
;

1244 
ˇŒ
.
fd
 = fd;

1245 
ˇŒ
.
buf
 = buf;

1246 
ˇŒ
.
cou¡
 = count;

1247 
ˇŒ
.
off
 = off;

1248 
p
 = 
	`add_hi°‹y
(
FAILTEST_READ
, 
Ál£
, 
fûe
, 
löe
, &
ˇŒ
);

1251 i‡(
	`should_Áû
(
p
)) {

1252 
p
->
u
.
ªad
.
ªt
 = -1;

1253 
p
->
îr‹
 = 
EIO
;

1255 i‡(
is_¥ód
)

1256 
p
->
u
.
ªad
.
ªt
 = 
	`¥ód
(
fd
, 
buf
, 
cou¡
, 
off
);

1258 
p
->
u
.
ªad
.
ªt
 = 
	`ªad
(
fd
, 
buf
, 
cou¡
);

1259 i‡(
p
->
u
.
ªad
.
ªt
 != -1)

1260 
	`£t_˛ónup
(
p
, 
˛ónup_ªad
, 
ªad_ˇŒ
);

1263 
	`åa˚
("%sread %s:%u fd %i %zu@%llu -> %zi\n",

1264 
is_¥ód
 ? "p" : "", 
fûe
, 
löe
, 
fd
, 
cou¡
, ()
off
,

1265 
p
->
u
.
ªad
.
ªt
);

1266 
î∫o
 = 
p
->
îr‹
;

1267  
p
->
u
.
ªad
.
ªt
;

1268 
	}
}

1270 
	$˛ónup_wrôe
(
wrôe_ˇŒ
 *
wrôe
, 
boﬁ
 
ª°‹e
)

1272 
	`åa˚
("˛ónög u∞wrôê⁄ %s\n", 
wrôe
->
›íî
->
u
.
›í
.
∑th«me
);

1273 i‡(
ª°‹e
)

1274 
	`ª°‹e_c⁄ã¡s
(
wrôe
->
›íî
, wrôe->
ßved
, !wrôe->
is_pwrôe
,

1276 
	`‰ì
(
wrôe
->
ßved
);

1277 
	}
}

1279 
ssize_t
 
	$Áûã°_add_wrôe
(
fd
, c⁄° *
buf
,

1280 
size_t
 
cou¡
, 
off_t
 
off
,

1281 
boﬁ
 
is_pwrôe
,

1282 c⁄° *
fûe
, 
löe
)

1284 
Áûã°_ˇŒ
 *
p
;

1285 
wrôe_ˇŒ
 
ˇŒ
;

1287 
ˇŒ
.
fd
 = fd;

1288 
ˇŒ
.
buf
 = buf;

1289 
ˇŒ
.
cou¡
 = count;

1290 
ˇŒ
.
off
 = off;

1291 
ˇŒ
.
is_pwrôe
 = is_pwrite;

1292 
ˇŒ
.
›íî
 = 
	`›íî_of
(
fd
);

1293 
p
 = 
	`add_hi°‹y
(
FAILTEST_WRITE
, 
Ál£
, 
fûe
, 
löe
, &
ˇŒ
);

1297 i‡(
c⁄åﬁ_fd
 !-1 && 
off
 =(
off_t
)-1) {

1298 
öfo_ty≥
 
ty≥
 = 
WRITE
;

1300 
	`wrôe_Æl
(
c⁄åﬁ_fd
, &
ty≥
, (type));

1301 
	`wrôe_Æl
(
c⁄åﬁ_fd
, &
p
->
u
.
wrôe
, (p->u.write));

1302 
	`wrôe_Æl
(
c⁄åﬁ_fd
, 
buf
, 
cou¡
);

1306 i‡(
	`should_Áû
(
p
)) {

1307 
p
->
u
.
wrôe
.
ªt
 = -1;

1308 
p
->
îr‹
 = 
EIO
;

1310 
boﬁ
 
is_fûe
;

1311 
	`as£π
(
ˇŒ
.
›íî
 =
p
->
u
.
wrôe
.opener);

1313 i‡(
p
->
u
.
wrôe
.
›íî
) {

1314 
is_fûe
 = (
p
->
u
.
wrôe
.
›íî
->
ty≥
 =
FAILTEST_OPEN
);

1318 
is_fûe
 = 
Ál£
;

1322 i‡(!
is_fûe
 && 
chûd_wrôes_num
 != 0) {

1323 i‡(
chûd_wrôes
[0].
fd
 != fd)

1324 
	`îrx
(1, "Child wroteÅo fd %u,Çot %u?",

1325 
chûd_wrôes
[0].
fd
, fd);

1326 i‡(
chûd_wrôes
[0].
off
 !
p
->
u
.
wrôe
.off)

1327 
	`îrx
(1, "Child wroteÅo offset %zu,Çot %zu?",

1328 (
size_t
)
chûd_wrôes
[0].
off
,

1329 (
size_t
)
p
->
u
.
wrôe
.
off
);

1330 i‡(
chûd_wrôes
[0].
cou¡
 != count)

1331 
	`îrx
(1, "Child wroteÜength %zu,Çot %zu?",

1332 
chûd_wrôes
[0].
cou¡
, count);

1333 i‡(
	`memcmp
(
chûd_wrôes
[0].
buf
, buf, 
cou¡
)) {

1334 
	`chûd_Áû
(
NULL
, 0,

1336 " fd %uÅh™ wêdid!\n", 
fd
);

1338 
	`‰ì
((*)
chûd_wrôes
[0].
buf
);

1339 
chûd_wrôes_num
--;

1340 
	`memmove
(&
chûd_wrôes
[0], &child_writes[1],

1341 (
chûd_wrôes
[0]Ë* 
chûd_wrôes_num
);

1344 
	`åa˚
("write %s:%i on fd %iálready done by child\n",

1345 
fûe
, 
löe
, 
fd
);

1346 
p
->
u
.
wrôe
.
ªt
 = 
cou¡
;

1347 
î∫o
 = 
p
->
îr‹
;

1348  
p
->
u
.
wrôe
.
ªt
;

1351 i‡(
is_fûe
) {

1352 
p
->
u
.
wrôe
.
ßved
 = 
	`ßve_c⁄ã¡s
(
ˇŒ
.
›íî
->u.
›í
.
∑th«me
,

1353 
fd
, 
cou¡
, 
off
,

1355 
	`£t_˛ónup
(
p
, 
˛ónup_wrôe
, 
wrôe_ˇŒ
);

1360 i‡(
p
->
u
.
wrôe
.
is_pwrôe
)

1361 
p
->
u
.
wrôe
.
ªt
 = 
	`pwrôe
(
fd
, 
buf
, 
cou¡
, 
off
);

1363 
p
->
u
.
wrôe
.
ªt
 = 
	`wrôe
(
fd
, 
buf
, 
cou¡
);

1365 
	`åa˚
("%swrite %s:%i %zu@%llu on fd %i -> %zi\n",

1366 
p
->
u
.
wrôe
.
is_pwrôe
 ? "p" : "",

1367 
fûe
, 
löe
, 
cou¡
, ()
off
, 
fd
, 
p
->
u
.
wrôe
.
ªt
);

1368 
î∫o
 = 
p
->
îr‹
;

1369  
p
->
u
.
wrôe
.
ªt
;

1370 
	}
}

1372 
ssize_t
 
	$Áûã°_pwrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
, 
off_t
 
off£t
,

1373 c⁄° *
fûe
, 
löe
)

1375  
	`Áûã°_add_wrôe
(
fd
, 
buf
, 
cou¡
, 
off£t
, 
åue
, 
fûe
, 
löe
);

1376 
	}
}

1378 
ssize_t
 
	$Áûã°_wrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
,

1379 c⁄° *
fûe
, 
löe
)

1381  
	`Áûã°_add_wrôe
(
fd
, 
buf
, 
cou¡
, 
	`l£ek
(fd, 0, 
SEEK_CUR
), 
Ál£
,

1382 
fûe
, 
löe
);

1383 
	}
}

1385 
ssize_t
 
	$Áûã°_¥ód
(
fd
, *
buf
, 
size_t
 
cou¡
, 
off_t
 
off
,

1386 c⁄° *
fûe
, 
löe
)

1388  
	`Áûã°_add_ªad
(
fd
, 
buf
, 
cou¡
, 
off
, 
åue
, 
fûe
, 
löe
);

1389 
	}
}

1391 
ssize_t
 
	$Áûã°_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
,

1392 c⁄° *
fûe
, 
löe
)

1394  
	`Áûã°_add_ªad
(
fd
, 
buf
, 
cou¡
, 
	`l£ek
(fd, 0, 
SEEK_CUR
), 
Ál£
,

1395 
fûe
, 
löe
);

1396 
	}
}

1398 
lock_öfo
 *
WARN_UNUSED_RESULT


1399 
	$add_lock
(
lock_öfo
 *
locks
, 
fd
, 
off_t
 
°¨t
, off_à
íd
, 
ty≥
)

1401 
i
;

1402 
lock_öfo
 *
l
;

1404 
i
 = 0; i < 
lock_num
; i++) {

1405 
l
 = &
locks
[
i
];

1407 i‡(
l
->
fd
 != fd)

1423 i‡(
°¨t
 > 
l
->°¨à&& 
íd
 <Ü->end) {

1425 
off_t
 
√w_°¨t
, 
√w_íd
;

1426 
√w_°¨t
 = 
íd
 + 1;

1427 
√w_íd
 = 
l
->
íd
;

1428 
	`åa˚
("splittingÜock on fd %i from %llu-%llu"

1430 
fd
, ()
l
->
°¨t
, (Ó->
íd
,

1431 ()
l
->
°¨t
, ()start - 1);

1432 
l
->
íd
 = 
°¨t
 - 1;

1433 
locks
 = 
	`add_lock
(locks,

1434 
fd
, 
√w_°¨t
, 
√w_íd
, 
l
->
ty≥
);

1435 
l
 = &
locks
[
i
];

1436 } i‡(
°¨t
 <
l
->°¨à&& 
íd
 >=Ü->end) {

1438 
	`åa˚
("erasingÜock on fd %i %llu-%llu\n",

1439 
fd
, ()
l
->
°¨t
, (Ó->
íd
);

1440 
l
->
íd
 = 0;

1441 
l
->
°¨t
 = 1;

1442 } i‡(
íd
 >
l
->
°¨t
 &&Énd <Ü->end) {

1443 
	`åa˚
("trimmingÜock on fd %i from %llu-%llu"

1445 
fd
, ()
l
->
°¨t
, (Ó->
íd
,

1446 ()
íd
 + 1, ()
l
->end);

1448 
l
->
°¨t
 = 
íd
 + 1;

1449 } i‡(
°¨t
 > 
l
->°¨à&& sèπ <l->
íd
) {

1450 
	`åa˚
("trimmingÜock on fd %i from %llu-%llu"

1452 
fd
, ()
l
->
°¨t
, (Ó->
íd
,

1453 ()
l
->
°¨t
, ()start - 1);

1455 
l
->
íd
 = 
°¨t
-1;

1458 i‡(
l
->
íd
 <Ü->
°¨t
) {

1459 
	`åa˚
("f‹gëtögÜock o¿fd %i\n", 
fd
);

1460 
	`memmove
(
l
,Ü + 1, (--
lock_num
 - 
i
) * (l[0]));

1461 
i
--;

1465 i‡(
ty≥
 !
F_UNLCK
) {

1466 
locks
 = 
	`ªÆloc
÷ocks, (
lock_num
 + 1) * (*locks));

1467 
l
 = &
locks
[
lock_num
++];

1468 
l
->
fd
 = fd;

1469 
l
->
°¨t
 = start;

1470 
l
->
íd
 =Énd;

1471 
l
->
ty≥
 =Åype;

1472 
	`åa˚
("newÜock on fd %i %llu-%llu\n",

1473 
fd
, ()
l
->
°¨t
, (Ó->
íd
);

1475  
locks
;

1476 
	}
}

1479 
	$Áûã°_˛o£
(
fd
, c⁄° *
fûe
, 
löe
)

1481 
˛o£_ˇŒ
 
ˇŒ
;

1482 
Áûã°_ˇŒ
 *
p
, *
›íî
;

1485 
›íî
 = 
	`›íî_of
(
fd
);

1487 
ˇŒ
.
fd
 = fd;

1488 
p
 = 
	`add_hi°‹y
(
FAILTEST_CLOSE
, 
Ál£
, 
fûe
, 
löe
, &
ˇŒ
);

1489 
p
->
Áû
 = 
Ál£
;

1492 i‡(
	`fﬁlowög_∑th
()) {

1493 i‡(
	`fﬁlow_∑th
(
p
))

1494 
	`ab‹t
();

1497 
	`åa˚
("˛o£ o¿fd %i\n", 
fd
);

1498 i‡(
fd
 < 0)

1499  
	`˛o£
(
fd
);

1502 i‡(
›íî
) {

1503 
	`åa˚
("˛o£ o¿fd %òfound o≥√∏%p\n", 
fd
, 
›íî
);

1504 i‡(
›íî
->
ty≥
 =
FAILTEST_PIPE
) {

1506 i‡(
›íî
->
u
.
pùe
.
fds
[0] =
fd
) {

1507 
	`as£π
(!
›íî
->
u
.
pùe
.
˛o£d
[0]);

1508 
›íî
->
u
.
pùe
.
˛o£d
[0] = 
åue
;

1509 } i‡(
›íî
->
u
.
pùe
.
fds
[1] =
fd
) {

1510 
	`as£π
(!
›íî
->
u
.
pùe
.
˛o£d
[1]);

1511 
›íî
->
u
.
pùe
.
˛o£d
[1] = 
åue
;

1513 
	`ab‹t
();

1514 
›íî
->
ˇn_Àak
 = (!›íî->
u
.
pùe
.
˛o£d
[0]

1515 || !
›íî
->
u
.
pùe
.
˛o£d
[1]);

1516 } i‡(
›íî
->
ty≥
 =
FAILTEST_OPEN
) {

1517 
›íî
->
u
.
›í
.
˛o£d
 = 
åue
;

1518 
›íî
->
ˇn_Àak
 = 
Ál£
;

1520 
	`ab‹t
();

1524 i‡(
c⁄åﬁ_fd
 != -1) {

1525 
Áûã°_ˇŒ
 *
i
;

1527 
	`éi°_f‹_óch_ªv
(&
hi°‹y
, 
i
, 
li°
) {

1528 i‡(
i
 =
our_hi°‹y_°¨t
)

1530 i‡(
i
 =
›íî
)

1532 i‡(
i
->
ty≥
 =
FAILTEST_LSEEK
 && i->
u
.
l£ek
.
fd
 == fd) {

1533 
	`åa˚
("˛o£ o¿fd %òund€†l£ek\n", 
fd
);

1535 
i
->
	`˛ónup
(&i->
u
, 
åue
);

1536 
i
->
˛ónup
 = 
NULL
;

1537 } i‡(
i
->
ty≥
 =
FAILTEST_WRITE


1538 && 
i
->
u
.
wrôe
.
fd
 == fd

1539 && !
i
->
u
.
wrôe
.
is_pwrôe
) {

1540 
	`åa˚
("close on fd %i undoes write"

1541 " off£àch™ge\n", 
fd
);

1543 i‡(
	`l£ek
(
fd
, 
i
->
u
.
wrôe
.
off
, 
SEEK_SET
)

1544 !
i
->
u
.
wrôe
.
off
) {

1545 
	`fw¨n
("RestoringÜseekÖointer failed (write)");

1547 } i‡(
i
->
ty≥
 =
FAILTEST_READ


1548 && 
i
->
u
.
ªad
.
fd
 == fd) {

1550 i‡(
i
->
˛ónup
) {

1551 
	`åa˚
("close on fd %i undoesÑead"

1552 " off£àch™ge\n", 
fd
);

1554 
i
->
	`˛ónup
(&i->
u
, 
åue
);

1555 
i
->
˛ónup
 = 
NULL
;

1562 
locks
 = 
	`add_lock
÷ocks, 
fd
, 0, 
	`off_max
(), 
F_UNLCK
);

1563  
	`˛o£
(
fd
);

1564 
	}
}

1567 
off_t
 
	$íd_of
(
off_t
 
°¨t
, off_à
Àn
)

1569 i‡(
Àn
 == 0)

1570  
	`off_max
();

1571  
°¨t
 + 
Àn
 - 1;

1572 
	}
}

1575 
	$Áûã°_f˙é
(
fd
, c⁄° *
fûe
, 
löe
, 
cmd
, ...)

1577 
Áûã°_ˇŒ
 *
p
;

1578 
f˙é_ˇŒ
 
ˇŒ
;

1579 
va_li°
 
≠
;

1581 
ˇŒ
.
fd
 = fd;

1582 
ˇŒ
.
cmd
 = cmd;

1585 
cmd
) {

1586 
F_SETFL
:

1587 
F_SETFD
:

1588 
	`va_°¨t
(
≠
, 
cmd
);

1589 
ˇŒ
.
¨g
.
l
 = 
	`va_¨g
(
≠
, );

1590 
	`va_íd
(
≠
);

1591 
	`åa˚
("f˙é o¿fd %òF_SETFL/F_SETFD\n", 
fd
);

1592  
	`f˙é
(
fd
, 
cmd
, 
ˇŒ
.
¨g
.
l
);

1593 
F_GETFD
:

1594 
F_GETFL
:

1595 
	`åa˚
("f˙é o¿fd %òF_GETFL/F_GETFD\n", 
fd
);

1596  
	`f˙é
(
fd
, 
cmd
);

1597 
F_GETLK
:

1598 
	`åa˚
("f˙é o¿fd %òF_GETLK\n", 
fd
);

1599 
	`gë_locks
();

1600 
	`va_°¨t
(
≠
, 
cmd
);

1601 
ˇŒ
.
¨g
.
Ê
 = *
	`va_¨g
(
≠
, 
Êock
 *);

1602 
	`va_íd
(
≠
);

1603  
	`f˙é
(
fd
, 
cmd
, &
ˇŒ
.
¨g
.
Ê
);

1604 
F_SETLK
:

1605 
F_SETLKW
:

1606 
	`åa˚
("fcntl on fd %i F_SETLK%s\n",

1607 
fd
, 
cmd
 =
F_SETLKW
 ? "W" : "");

1608 
	`va_°¨t
(
≠
, 
cmd
);

1609 
ˇŒ
.
¨g
.
Ê
 = *
	`va_¨g
(
≠
, 
Êock
 *);

1610 
	`va_íd
(
≠
);

1614 
	`îr
(1, "Áûã°: unknow¿f˙é %u", 
cmd
);

1617 
p
 = 
	`add_hi°‹y
(
FAILTEST_FCNTL
, 
Ál£
, 
fûe
, 
löe
, &
ˇŒ
);

1619 i‡(
	`should_Áû
(
p
)) {

1620 
p
->
u
.
f˙é
.
ªt
 = -1;

1621 i‡(
p
->
u
.
f˙é
.
cmd
 =
F_SETLK
)

1622 
p
->
îr‹
 = 
EAGAIN
;

1624 
p
->
îr‹
 = 
EDEADLK
;

1626 
	`gë_locks
();

1627 
p
->
u
.
f˙é
.
ªt
 = 
	`f˙é
’->u.f˙é.
fd
,Ö->u.f˙é.
cmd
,

1628 &
p
->
u
.
f˙é
.
¨g
.
Ê
);

1629 i‡(
p
->
u
.
f˙é
.
ªt
 == -1)

1630 
p
->
îr‹
 = 
î∫o
;

1633 
	`as£π
(
p
->
u
.
f˙é
.
¨g
.
Ê
.
l_whí˚
 =
SEEK_SET
);

1634 
locks
 = 
	`add_lock
(locks,

1635 
p
->
u
.
f˙é
.
fd
,

1636 
p
->
u
.
f˙é
.
¨g
.
Ê
.
l_°¨t
,

1637 
	`íd_of
(
p
->
u
.
f˙é
.
¨g
.
Ê
.
l_°¨t
,

1638 
p
->
u
.
f˙é
.
¨g
.
Ê
.
l_Àn
),

1639 
p
->
u
.
f˙é
.
¨g
.
Ê
.
l_ty≥
);

1642 
	`åa˚
("f˙é o¿fd %ò-> %i\n", 
fd
, 
p
->
u
.
f˙é
.
ªt
);

1643 
î∫o
 = 
p
->
îr‹
;

1644  
p
->
u
.
f˙é
.
ªt
;

1645 
	}
}

1647 
	$˛ónup_l£ek
(
l£ek_ˇŒ
 *
ˇŒ
, 
boﬁ
 
ª°‹e
)

1649 i‡(
ª°‹e
) {

1650 
	`åa˚
("cleaning upÜseek on fd %i -> %llu\n",

1651 
ˇŒ
->
fd
, ()ˇŒ->
ﬁd_off
);

1652 i‡(
	`l£ek
(
ˇŒ
->
fd
, cÆl->
ﬁd_off
, 
SEEK_SET
) != call->old_off)

1653 
	`fw¨n
("RestoringÜseekÖointer failed");

1655 
	}
}

1658 
off_t
 
	$Áûã°_l£ek
(
fd
, 
off_t
 
off£t
, 
whí˚
, c⁄° *
fûe
,

1659 
löe
)

1661 
Áûã°_ˇŒ
 *
p
;

1662 
l£ek_ˇŒ
 
ˇŒ
;

1663 
ˇŒ
.
fd
 = fd;

1664 
ˇŒ
.
off£t
 = offset;

1665 
ˇŒ
.
whí˚
 = whence;

1666 
ˇŒ
.
ﬁd_off
 = 
	`l£ek
(
fd
, 0, 
SEEK_CUR
);

1668 
p
 = 
	`add_hi°‹y
(
FAILTEST_LSEEK
, 
Ál£
, 
fûe
, 
löe
, &
ˇŒ
);

1669 
p
->
Áû
 = 
Ál£
;

1672 i‡(
Áû∑th
)

1673 i‡(
	`should_Áû
(
p
))

1674 
	`ab‹t
();

1676 
p
->
u
.
l£ek
.
ªt
 = 
	`l£ek
(
fd
, 
off£t
, 
whí˚
);

1678 i‡(
p
->
u
.
l£ek
.
ªt
 !(
off_t
)-1)

1679 
	`£t_˛ónup
(
p
, 
˛ónup_l£ek
, 
l£ek_ˇŒ
);

1681 
	`åa˚
("lseek %s:%u on fd %i from %lluÅo %llu%s\n",

1682 
fûe
, 
löe
, 
fd
, ()
ˇŒ
.
ﬁd_off
, ()
off£t
,

1683 
whí˚
 =
SEEK_CUR
 ? " (from current off)" :

1684 
whí˚
 =
SEEK_END
 ? " (fromÉnd)" :

1685 
whí˚
 =
SEEK_SET
 ? "" : " (invalid whence)");

1686  
p
->
u
.
l£ek
.
ªt
;

1687 
	}
}

1690 
pid_t
 
	$Áûã°_gëpid
(c⁄° *
fûe
, 
löe
)

1693 
	`as£π
(
‹ig_pid
);

1694  
‹ig_pid
;

1695 
	}
}

1697 
	$Áûã°_öô
(
¨gc
, *
¨gv
[])

1699 
i
;

1701 
‹ig_pid
 = 
	`gëpid
();

1703 
w¨nf
 = 
	`fd›í
(
	`move_fd_to_high
(
	`dup
(
STDERR_FILENO
)), "w");

1704 
i
 = 1; i < 
¨gc
; i++) {

1705 i‡(!
	`°∫cmp
(
¨gv
[
i
], "--Áû∑th=", 
	`°æí
("--failpath="))) {

1706 
Áû∑th
 = 
¨gv
[
i
] + 
	`°æí
("--failpath=");

1707 } i‡(
	`°rcmp
(
¨gv
[
i
], "--trace") == 0) {

1708 
åa˚f
 = 
w¨nf
;

1709 
Áûã°_timeout_ms
 = -1;

1710 } i‡(!
	`°∫cmp
(
¨gv
[
i
], "--debugpath=",

1711 
	`°æí
("--debugpath="))) {

1712 
debug∑th
 = 
¨gv
[
i
] + 
	`°æí
("--debugpath=");

1715 
	`ÁûèbÀ_öô
(&
ÁûèbÀ
);

1716 
°¨t
 = 
	`time_now
();

1717 
	}
}

1719 
boﬁ
 
	$Áûã°_has_Áûed
()

1721  
c⁄åﬁ_fd
 != -1;

1722 
	}
}

1724 
	$Áûã°_exô
(
°©us
)

1726 
	`åa˚
("Áûã°_exô wôh sètu†%i\n", 
°©us
);

1727 i‡(
Áûã°_exô_check
) {

1728 i‡(!
	`Áûã°_exô_check
(&
hi°‹y
))

1729 
	`chûd_Áû
(
NULL
, 0, "failtest_exit_check failed\n");

1732 
	`Áûã°_˛ónup
(
Ál£
, 
°©us
);

1733 
	}
}

	@ccan/ccan/failtest/failtest.h

2 #i‚de‡
CCAN_FAILTEST_H


3 
	#CCAN_FAILTEST_H


	)

4 
	~"c⁄fig.h
"

5 #i‡
HAVE_FILE_OFFSET_BITS


6 
	#_FILE_OFFSET_BITS
 64

	)

8 
	~<sys/ty≥s.h
>

9 
	~<°dboﬁ.h
>

10 
	~<f˙é.h
>

11 
	~<cˇn/compûî/compûî.h
>

12 
	~<cˇn/éi°/éi°.h
>

23 
Áûã°_öô
(
¨gc
, *
¨gv
[]);

35 
NORETURN
 
Áûã°_exô
(
°©us
);

40 
	eÁûã°_ˇŒ_ty≥
 {

41 
	mFAILTEST_MALLOC
,

42 
	mFAILTEST_CALLOC
,

43 
	mFAILTEST_REALLOC
,

44 
	mFAILTEST_OPEN
,

45 
	mFAILTEST_CLOSE
,

46 
	mFAILTEST_PIPE
,

47 
	mFAILTEST_READ
,

48 
	mFAILTEST_WRITE
,

49 
	mFAILTEST_FCNTL
,

50 
	mFAILTEST_MMAP
,

51 
	mFAILTEST_LSEEK


54 
	sˇŒoc_ˇŒ
 {

55 *
	mªt
;

56 
size_t
 
	mnmemb
;

57 
size_t
 
	msize
;

60 
	smÆloc_ˇŒ
 {

61 *
	mªt
;

62 
size_t
 
	msize
;

65 
	sªÆloc_ˇŒ
 {

66 *
	mªt
;

67 *
	m±r
;

68 
size_t
 
	msize
;

71 
	s›í_ˇŒ
 {

72 
	mªt
;

73 c⁄° *
	m∑th«me
;

74 
	mÊags
;

75 
mode_t
 
	mmode
;

76 
boﬁ
 
	mÆways_ßve
;

77 
boﬁ
 
	m˛o£d
;

79 
c⁄ã¡s_ßved
 *
	mßved
;

82 
	s˛o£_ˇŒ
 {

83 
	mfd
;

86 
	spùe_ˇŒ
 {

87 
	mªt
;

88 
	mfds
[2];

89 
boﬁ
 
	m˛o£d
[2];

92 
	sªad_ˇŒ
 {

93 
ssize_t
 
	mªt
;

94 
off_t
 
	moff
;

95 
	mfd
;

96 *
	mbuf
;

97 
size_t
 
	mcou¡
;

100 
	swrôe_ˇŒ
 {

101 
ssize_t
 
	mªt
;

102 
	mfd
;

103 c⁄° *
	mbuf
;

104 
size_t
 
	mcou¡
;

105 
off_t
 
	moff
;

106 
boﬁ
 
	mis_pwrôe
;

107 
Áûã°_ˇŒ
 *
	m›íî
;

108 
c⁄ã¡s_ßved
 *
	mßved
;

111 
	sf˙é_ˇŒ
 {

112 
	mªt
;

113 
	mfd
;

114 
	mcmd
;

116 
Êock
 
	mÊ
;

117 
	ml
;

118 
	mi
;

119 } 
	m¨g
;

122 
	smm≠_ˇŒ
 {

123 *
	mªt
;

124 *
	maddr
;

125 
size_t
 
	mÀngth
;

126 
	m¥Ÿ
;

127 
	mÊags
;

128 
	mfd
;

129 
off_t
 
	moff£t
;

130 
Áûã°_ˇŒ
 *
	m›íî
;

131 
c⁄ã¡s_ßved
 *
	mßved
;

134 
	sl£ek_ˇŒ
 {

135 
ssize_t
 
	mªt
;

136 
	mfd
;

137 
off_t
 
	moff£t
;

138 
	mwhí˚
;

139 
off_t
 
	mﬁd_off
;

156 
	sÁûã°_ˇŒ
 {

158 
li°_node
 
	mli°
;

159 
Áûã°_ˇŒ_ty≥
 
	mty≥
;

161 c⁄° *
	mfûe
;

162 
	mlöe
;

164 
boﬁ
 
	mÁû
;

166 
	mîr‹
;

168 (*
	m˛ónup
)(*
	mu
, 
boﬁ
 
	mª°‹e
);

170 
boﬁ
 
	mˇn_Àak
;

172 **
	mbackåa˚
;

173 
	mbackåa˚_num
;

176 
ˇŒoc_ˇŒ
 
	mˇŒoc
;

177 
mÆloc_ˇŒ
 
	mmÆloc
;

178 
ªÆloc_ˇŒ
 
	mªÆloc
;

179 
›í_ˇŒ
 
	m›í
;

180 
˛o£_ˇŒ
 
	m˛o£
;

181 
pùe_ˇŒ
 
	mpùe
;

182 
ªad_ˇŒ
 
	mªad
;

183 
wrôe_ˇŒ
 
	mwrôe
;

184 
f˙é_ˇŒ
 
	mf˙é
;

185 
mm≠_ˇŒ
 
	mmm≠
;

186 
l£ek_ˇŒ
 
	ml£ek
;

187 } 
	mu
;

191 
TLIST_TYPE
(
ˇŒs
, 
Áûã°_ˇŒ
);

193 
	eÁûã°_ªsu…
 {

195 
	mFAIL_OK
,

197 
	mFAIL_DONT_FAIL
,

199 
	mFAIL_PROBE
,

227 
	$Áûã°_ªsu…
 (*
Áûã°_hook
)(
éi°_ˇŒs
 *
hi°‹y
);

240 
	$boﬁ
 (*
Áûã°_exô_check
)(
éi°_ˇŒs
 *
hi°‹y
);

250 
boﬁ
 
	`Áûã°_has_Áûed
();

257 
Áûã°_timeout_ms
;

	@ccan/ccan/failtest/failtest_override.h

2 #i‚de‡
CCAN_FAILTEST_OVERRIDE_H


3 
	#CCAN_FAILTEST_OVERRIDE_H


	)

5 
	~"c⁄fig.h
"

6 #i‡
HAVE_FILE_OFFSET_BITS


7 
	#_FILE_OFFSET_BITS
 64

	)

11 
	~<°dlib.h
>

13 #unde‡
ˇŒoc


14 
	#ˇŒoc
(
nmemb
, 
size
) \

15 
	`Áûã°_ˇŒoc
((
nmemb
), (
size
), 
__FILE__
, 
__LINE__
)

	)

17 #unde‡
mÆloc


18 
	#mÆloc
(
size
) \

19 
	`Áûã°_mÆloc
((
size
), 
__FILE__
, 
__LINE__
)

	)

21 #unde‡
ªÆloc


22 
	#ªÆloc
(
±r
, 
size
) \

23 
	`Áûã°_ªÆloc
((
±r
), (
size
), 
__FILE__
, 
__LINE__
)

	)

25 #unde‡
‰ì


26 
	#‰ì
(
±r
) \

27 
	`Áûã°_‰ì
(
±r
)

	)

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 
	~<sys/mm™.h
>

33 
	~<f˙é.h
>

34 
	~<uni°d.h
>

36 #unde‡
›í


37 
	#›í
(
∑th«me
, ...) \

38 
	`Áûã°_›í
((
∑th«me
), 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
)

	)

40 #unde‡
pùe


41 
	#pùe
(
pùefd
) \

42 
	`Áûã°_pùe
((
pùefd
), 
__FILE__
, 
__LINE__
)

	)

44 #unde‡
ªad


45 
	#ªad
(
fd
, 
buf
, 
cou¡
) \

46 
	`Áûã°_ªad
((
fd
), (
buf
), (
cou¡
), 
__FILE__
, 
__LINE__
)

	)

48 #unde‡
wrôe


49 
	#wrôe
(
fd
, 
buf
, 
cou¡
) \

50 
	`Áûã°_wrôe
((
fd
), (
buf
), (
cou¡
), 
__FILE__
, 
__LINE__
)

	)

52 #unde‡
¥ód


53 
	#¥ód
(
fd
, 
buf
, 
cou¡
, 
off
) \

54 
	`Áûã°_¥ód
((
fd
), (
buf
), (
cou¡
), (
off
), 
__FILE__
, 
__LINE__
)

	)

56 #unde‡
pwrôe


57 
	#pwrôe
(
fd
, 
buf
, 
cou¡
, 
off
) \

58 
	`Áûã°_pwrôe
((
fd
), (
buf
), (
cou¡
), (
off
), 
__FILE__
, 
__LINE__
)

	)

60 #unde‡
˛o£


61 
	#˛o£
(
fd
Ë
	`Áûã°_˛o£
(fd, 
__FILE__
, 
__LINE__
)

	)

63 #unde‡
f˙é


64 
	#f˙é
(
fd
, ...Ë
	`Áûã°_f˙é
((fd), 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
)

	)

66 #unde‡
mm≠


68 #ifde‡
__O≥nBSD__


69 
	#mm≠
(
addr
, 
Àngth
, 
¥Ÿ
, 
Êags
, 
fd
, 
off£t
) \

70 
	`Áûã°_mm≠_nﬁoc
((
addr
), (
Àngth
), (
¥Ÿ
), (
Êags
), (
fd
), (
off£t
))

	)

72 
	#mm≠
(
addr
, 
Àngth
, 
¥Ÿ
, 
Êags
, 
fd
, 
off£t
) \

73 
	`Áûã°_mm≠
((
addr
), (
Àngth
), (
¥Ÿ
), (
Êags
), (
fd
), (
off£t
), \

74 
__FILE__
, 
__LINE__
)

	)

77 #unde‡
l£ek


78 
	#l£ek
(
fd
, 
off£t
, 
whí˚
) \

79 
	`Áûã°_l£ek
((
fd
), (
off£t
), (
whí˚
), 
__FILE__
, 
__LINE__
)

	)

82 #unde‡
gëpid


83 
	#gëpid
(Ë
	`Áûã°_gëpid
(
__FILE__
, 
__LINE__
)

	)

85 
	~<cˇn/Áûã°/Áûã°_¥Ÿo.h
>

	@ccan/ccan/failtest/failtest_proto.h

2 #i‚de‡
CCAN_FAILTEST_PROTO_H


3 
	#CCAN_FAILTEST_PROTO_H


	)

4 
	~<°dlib.h
>

7 *
Áûã°_ˇŒoc
(
size_t
 
nmemb
, size_à
size
,

8 c⁄° *
fûe
, 
löe
);

9 *
Áûã°_mÆloc
(
size_t
 
size
, c⁄° *
fûe
, 
löe
);

10 *
Áûã°_ªÆloc
(*
±r
, 
size_t
 
size
,

11 c⁄° *
fûe
, 
löe
);

12 
Áûã°_‰ì
(*
±r
);

13 
Áûã°_›í
(c⁄° *
∑th«me
,

14 c⁄° *
fûe
, 
löe
, ...);

15 
Áûã°_pùe
(
pùefd
[2], c⁄° *
fûe
, 
löe
);

16 
ssize_t
 
Áûã°_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
,

17 c⁄° *
fûe
, 
löe
);

18 
ssize_t
 
Áûã°_wrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
,

19 c⁄° *
fûe
, 
löe
);

20 
ssize_t
 
Áûã°_¥ód
(
fd
, *
buf
, 
size_t
 
cou¡
, 
off_t
 
off£t
,

21 c⁄° *
fûe
, 
löe
);

22 
ssize_t
 
Áûã°_pwrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
, 
off_t
 
off£t
,

23 c⁄° *
fûe
, 
löe
);

24 *
Áûã°_mm≠
(*
addr
, 
size_t
 
Àngth
, 
¥Ÿ
, 
Êags
,

25 
fd
, 
off_t
 
off£t
, c⁄° *
fûe
, 
löe
);

26 *
Áûã°_mm≠_nﬁoc
(*
addr
, 
size_t
 
Àngth
, 
¥Ÿ
, 
Êags
,

27 
fd
, 
off_t
 
off£t
);

28 
off_t
 
Áûã°_l£ek
(
fd
, off_à
off£t
, 
whí˚
,

29 c⁄° *
fûe
, 
löe
);

30 
Áûã°_˛o£
(
fd
, c⁄° *
fûe
, 
löe
);

31 
Áûã°_f˙é
(
fd
, c⁄° *
fûe
, 
löe
, 
cmd
, ...);

32 
pid_t
 
Áûã°_gëpid
(c⁄° *
fûe
, 
löe
);

	@ccan/ccan/failtest/failtest_undo.h

2 #i‚de‡
CCAN_FAILTEST_RESTORE_H


3 
	#CCAN_FAILTEST_RESTORE_H


	)

6 #unde‡
ˇŒoc


7 
	#ˇŒoc
(
nmemb
, 
size
) \

8 
	`Áûã°_ˇŒoc
((
nmemb
), (
size
), 
NULL
, 0)

	)

10 #unde‡
mÆloc


11 
	#mÆloc
(
size
) \

12 
	`Áûã°_mÆloc
((
size
), 
NULL
, 0)

	)

14 #unde‡
ªÆloc


15 
	#ªÆloc
(
±r
, 
size
) \

16 
	`Áûã°_ªÆloc
((
±r
), (
size
), 
NULL
, 0)

	)

18 #unde‡
›í


19 
	#›í
(
∑th«me
, ...) \

20 
	`Áûã°_›í
((
∑th«me
), 
NULL
, 0, 
__VA_ARGS__
)

	)

22 #unde‡
pùe


23 
	#pùe
(
pùefd
) \

24 
	`Áûã°_pùe
((
pùefd
), 
NULL
, 0)

	)

26 #unde‡
ªad


27 
	#ªad
(
fd
, 
buf
, 
cou¡
) \

28 
	`Áûã°_ªad
((
fd
), (
buf
), (
cou¡
), 
NULL
, 0)

	)

30 #unde‡
wrôe


31 
	#wrôe
(
fd
, 
buf
, 
cou¡
) \

32 
	`Áûã°_wrôe
((
fd
), (
buf
), (
cou¡
), 
NULL
, 0)

	)

34 #unde‡
mm≠


35 
	#mm≠
(
addr
, 
Àngth
, 
¥Ÿ
, 
Êags
, 
fd
, 
off£t
) \

36 
	`Áûã°_mm≠
((
addr
), (
Àngth
), (
¥Ÿ
), (
Êags
), (
fd
), (
off£t
), 
NULL
, 0)

	)

38 #unde‡
l£ek


39 
	#l£ek
(
fd
, 
off
, 
whí˚
) \

40 
	`Áûã°_l£ek
((
fd
), (
off
), (
whí˚
), 
NULL
, 0)

	)

42 #unde‡
˛o£


43 
	#˛o£
(
fd
Ë
	`Áûã°_˛o£
(fd)

	)

45 #unde‡
f˙é


46 
	#f˙é
(
fd
, ...) \

47 
	`Áûã°_f˙é
((
fd
), 
NULL
, 0, 
__VA_ARGS__
)

	)

	@ccan/ccan/failtest/test/run-failpath.c

1 
	~<cˇn/Áûã°/Áûã°.c
>

2 
	~<°dlib.h
>

3 
	~<£tjmp.h
>

4 
	~<°dio.h
>

5 
	~<°d¨g.h
>

6 
	~<cˇn/èp/èp.h
>

8 
	$maö
()

10 
fds
[2], 
fd
;

11 *
p
;

13 
	`∂™_ã°s
(14);

14 
	`Áûã°_öô
(0, 
NULL
);

16 
Áû∑th
 = "mceopwrMCEOPWR";

18 
	`ok1
((
p
 = 
	`Áûã°_mÆloc
(10, "run-Áû∑th.c", 1)Ë!
NULL
);

19 
	`ok1
(
	`Áûã°_ˇŒoc
(10, 5, "run-Áû∑th.c", 1Ë!
NULL
);

20 
	`ok1
((
p
 = 
	`Áûã°_ªÆloc
’, 100, "run-Áû∑th.c", 1)Ë!
NULL
);

21 
	`ok1
((
fd
 = 
	`Áûã°_›í
("failpath-scratch", "run-failpath.c", 1,

22 
O_RDWR
|
O_CREAT
, 0600)) >= 0);

23 
	`ok1
(
	`Áûã°_pùe
(
fds
, "run-failpath.c", 1) == 0);

24 
	`ok1
(
	`Áûã°_wrôe
(
fd
, "xxxx", 4, "run-failpath.c", 1) == 4);

25 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

26 
	`ok1
(
	`Áûã°_ªad
(
fd
, 
p
, 5, "run-failpath.c", 1) == 4);

29 
	`ok1
(
	`Áûã°_mÆloc
(10, "run-Áû∑th.c", 1Ë=
NULL
);

30 
	`ok1
(
	`Áûã°_ˇŒoc
(10, 5, "run-Áû∑th.c", 1Ë=
NULL
);

31 
	`ok1
(
	`Áûã°_ªÆloc
(
p
, 100, "run-Áû∑th.c", 1Ë=
NULL
);

32 
	`ok1
(
	`Áûã°_›í
("failpath-scratch", "run-failpath.c", 1,

33 
O_RDWR
|
O_CREAT
, 0600) == -1);

34 
	`ok1
(
	`Áûã°_pùe
(
fds
, "run-failpath.c", 1) == -1);

35 
	`ok1
(
	`Áûã°_wrôe
(
fd
, "xxxx", 4, "run-failpath.c", 1) == -1);

36 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

37 
	`ok1
(
	`Áûã°_ªad
(
fd
, 
p
, 5, "run-failpath.c", 1) == -1);

38  
	`exô_°©us
();

39 
	}
}

	@ccan/ccan/failtest/test/run-history.c

2 
	~<cˇn/Áûã°/Áûã°.c
>

3 
	~<°dlib.h
>

4 
	~<°dio.h
>

5 
	~<°d¨g.h
>

6 
	~<cˇn/èp/èp.h
>

8 
	$maö
()

10 
Áûã°_ˇŒ
 *
ˇŒ
;

11 
ˇŒoc_ˇŒ
 calloc_call;

12 
mÆloc_ˇŒ
 malloc_call;

13 
ªÆloc_ˇŒ
Ñealloc_call;

14 
›í_ˇŒ
 open_call;

15 
pùe_ˇŒ
Öipe_call;

16 
ªad_ˇŒ
Ñead_call;

17 
wrôe_ˇŒ
 write_call;

18 
mm≠_ˇŒ
 mmap_call;

19 
buf
[20];

20 
i
;

21 *
∑th
;

24 
	`∂™_ã°s
(69);

26 
ˇŒoc_ˇŒ
.
ªt
 = 
	`ˇŒoc
(1, 2);

27 
ˇŒoc_ˇŒ
.
nmemb
 = 1;

28 
ˇŒoc_ˇŒ
.
size
 = 2;

29 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_CALLOC
, 
åue
,

30 "run-hi°‹y.c", 1, &
ˇŒoc_ˇŒ
);

32 
ˇŒ
->
Áû
 = 
Ál£
;

33 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_CALLOC
);

34 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
åue
);

35 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

36 
	`ok1
(
ˇŒ
->
löe
 == 1);

37 
	`ok1
(
ˇŒ
->
u
.
ˇŒoc
.
ªt
 =
ˇŒoc_ˇŒ
.ret);

38 
	`ok1
(
ˇŒ
->
u
.
ˇŒoc
.
nmemb
 =
ˇŒoc_ˇŒ
.nmemb);

39 
	`ok1
(
ˇŒ
->
u
.
ˇŒoc
.
size
 =
ˇŒoc_ˇŒ
.size);

41 
mÆloc_ˇŒ
.
ªt
 = 
	`mÆloc
(2);

42 
mÆloc_ˇŒ
.
size
 = 2;

43 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_MALLOC
, 
åue
,

44 "run-hi°‹y.c", 2, &
mÆloc_ˇŒ
);

46 
ˇŒ
->
Áû
 = 
Ál£
;

47 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_MALLOC
);

48 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
åue
);

49 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

50 
	`ok1
(
ˇŒ
->
löe
 == 2);

51 
	`ok1
(
ˇŒ
->
u
.
mÆloc
.
ªt
 =
mÆloc_ˇŒ
.ret);

52 
	`ok1
(
ˇŒ
->
u
.
mÆloc
.
size
 =
mÆloc_ˇŒ
.size);

54 
ªÆloc_ˇŒ
.
ªt
 = 
	`ªÆloc
(
mÆloc_ˇŒ
.ret, 3);

55 
ªÆloc_ˇŒ
.
±r
 = 
mÆloc_ˇŒ
.
ªt
;

56 
ªÆloc_ˇŒ
.
size
 = 3;

57 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_REALLOC
, 
åue
, "run-history.c", 3,

58 &
ªÆloc_ˇŒ
);

60 
ˇŒ
->
Áû
 = 
Ál£
;

61 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_REALLOC
);

62 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
åue
);

63 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

64 
	`ok1
(
ˇŒ
->
löe
 == 3);

65 
	`ok1
(
ˇŒ
->
u
.
ªÆloc
.
ªt
 =
ªÆloc_ˇŒ
.ret);

66 
	`ok1
(
ˇŒ
->
u
.
ªÆloc
.
±r
 =
ªÆloc_ˇŒ
.ptr);

67 
	`ok1
(
ˇŒ
->
u
.
ªÆloc
.
size
 =
ªÆloc_ˇŒ
.size);

69 
›í_ˇŒ
.
ªt
 = 
	`›í
("ã°/run-hi°‹y.c", 
O_RDONLY
);

70 
›í_ˇŒ
.
∑th«me
 = "test/run-history.c";

71 
›í_ˇŒ
.
Êags
 = 
O_RDONLY
;

72 
›í_ˇŒ
.
mode
 = 0;

73 
›í_ˇŒ
.
˛o£d
 = 
Ál£
;

74 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_OPEN
, 
åue
, "run-hi°‹y.c", 4, &
›í_ˇŒ
);

76 
ˇŒ
->
Áû
 = 
Ál£
;

77 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_OPEN
);

78 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
åue
);

79 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

80 
	`ok1
(
ˇŒ
->
löe
 == 4);

81 
	`ok1
(
ˇŒ
->
u
.
›í
.
ªt
 =
›í_ˇŒ
.ret);

82 
	`ok1
(
	`°rcmp
(
ˇŒ
->
u
.
›í
.
∑th«me
, 
›í_ˇŒ
.pathname) == 0);

83 
	`ok1
(
ˇŒ
->
u
.
›í
.
Êags
 =
›í_ˇŒ
.flags);

84 
	`ok1
(
ˇŒ
->
u
.
›í
.
mode
 =
›í_ˇŒ
.mode);

86 
pùe_ˇŒ
.
ªt
 = 
	`pùe
’ùe_ˇŒ.
fds
);

87 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_PIPE
, 
åue
, "run-hi°‹y.c", 5, &
pùe_ˇŒ
);

89 
ˇŒ
->
Áû
 = 
Ál£
;

90 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_PIPE
);

91 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

92 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
åue
);

93 
	`ok1
(
ˇŒ
->
löe
 == 5);

94 
	`ok1
(
ˇŒ
->
u
.
pùe
.
ªt
 =
pùe_ˇŒ
.ret);

95 
	`ok1
(
ˇŒ
->
u
.
pùe
.
fds
[0] =
pùe_ˇŒ
.fds[0]);

96 
	`ok1
(
ˇŒ
->
u
.
pùe
.
fds
[1] =
pùe_ˇŒ
.fds[1]);

98 
ªad_ˇŒ
.
ªt
 = 
	`ªad
(
›í_ˇŒ
.ªt, 
buf
, 20);

99 
ªad_ˇŒ
.
buf
 = buf;

100 
ªad_ˇŒ
.
fd
 = 
›í_ˇŒ
.
ªt
;

101 
ªad_ˇŒ
.
cou¡
 = 20;

102 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_READ
, 
Ál£
, "run-hi°‹y.c", 6, &
ªad_ˇŒ
);

104 
ˇŒ
->
Áû
 = 
Ál£
;

105 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_READ
);

106 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
Ál£
);

107 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

108 
	`ok1
(
ˇŒ
->
löe
 == 6);

109 
	`ok1
(
ˇŒ
->
u
.
ªad
.
ªt
 =
ªad_ˇŒ
.ret);

110 
	`ok1
(
ˇŒ
->
u
.
ªad
.
buf
 =
ªad_ˇŒ
.buf);

111 
	`ok1
(
ˇŒ
->
u
.
ªad
.
fd
 =
ªad_ˇŒ
.fd);

112 
	`ok1
(
ˇŒ
->
u
.
ªad
.
cou¡
 =
ªad_ˇŒ
.count);

114 
wrôe_ˇŒ
.
ªt
 = 20;

115 
wrôe_ˇŒ
.
buf
 = buf;

116 
wrôe_ˇŒ
.
fd
 = 
›í_ˇŒ
.
ªt
;

117 
wrôe_ˇŒ
.
cou¡
 = 20;

118 
wrôe_ˇŒ
.
›íî
 = 
NULL
;

119 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_WRITE
, 
Ál£
, "run-history.c", 7,

120 &
wrôe_ˇŒ
);

122 
ˇŒ
->
Áû
 = 
Ál£
;

123 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_WRITE
);

124 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
Ál£
);

125 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

126 
	`ok1
(
ˇŒ
->
löe
 == 7);

127 
	`ok1
(
ˇŒ
->
u
.
wrôe
.
ªt
 =
wrôe_ˇŒ
.ret);

128 
	`ok1
(
ˇŒ
->
u
.
wrôe
.
buf
 =
wrôe_ˇŒ
.buf);

129 
	`ok1
(
ˇŒ
->
u
.
wrôe
.
fd
 =
wrôe_ˇŒ
.fd);

130 
	`ok1
(
ˇŒ
->
u
.
wrôe
.
cou¡
 =
wrôe_ˇŒ
.count);

131 
	`ok1
(
ˇŒ
->
u
.
wrôe
.
›íî
 =
wrôe_ˇŒ
.opener);

133 
mm≠_ˇŒ
.
ªt
 = &mmap_call;

134 
mm≠_ˇŒ
.
addr
 = 
NULL
;

135 
mm≠_ˇŒ
.
Àngth
 = 4096;

136 
mm≠_ˇŒ
.
¥Ÿ
 = 
PROT_READ
;

137 
mm≠_ˇŒ
.
Êags
 = 0;

138 
mm≠_ˇŒ
.
fd
 = 
›í_ˇŒ
.
ªt
;

139 
mm≠_ˇŒ
.
off£t
 = 0;

140 
mm≠_ˇŒ
.
›íî
 = 
	`›íî_of
(
›í_ˇŒ
.
ªt
);

141 
	`ok1
(
mm≠_ˇŒ
.
›íî
->
ty≥
 =
FAILTEST_OPEN
);

142 
mm≠_ˇŒ
.
ßved
 = 
NULL
;

144 
ˇŒ
 = 
	`add_hi°‹y
(
FAILTEST_MMAP
, 
Ál£
, "run-history.c", 8,

145 &
mm≠_ˇŒ
);

147 
ˇŒ
->
Áû
 = 
Ál£
;

148 
	`ok1
(
ˇŒ
->
ty≥
 =
FAILTEST_MMAP
);

149 
	`ok1
(
ˇŒ
->
ˇn_Àak
 =
Ál£
);

150 
	`ok1
(
	`°rcmp
(
ˇŒ
->
fûe
, "run-history.c") == 0);

151 
	`ok1
(
ˇŒ
->
löe
 == 8);

152 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
ªt
 =
mm≠_ˇŒ
.ret);

153 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
addr
 =
mm≠_ˇŒ
.addr);

154 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
Àngth
 =
mm≠_ˇŒ
.length);

155 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
¥Ÿ
 =
mm≠_ˇŒ
.prot);

156 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
Êags
 =
mm≠_ˇŒ
.flags);

157 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
fd
 =
mm≠_ˇŒ
.fd);

158 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
off£t
 =
mm≠_ˇŒ
.offset);

159 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
›íî
 =
mm≠_ˇŒ
.opener);

160 
	`ok1
(
ˇŒ
->
u
.
mm≠
.
ßved
 =
mm≠_ˇŒ
.saved);

162 
i
 = 0;

163 
	`éi°_f‹_óch
(&
hi°‹y
, 
ˇŒ
, 
li°
)

164 
i
++;

166 
	`ok1
(
i
 == 8);

168 
	`éi°_f‹_óch
(&
hi°‹y
, 
ˇŒ
, 
li°
)

169 
ˇŒ
->
Áû
 = 
Ál£
;

171 
∑th
 = 
	`Áû∑th_°rög
();

172 
	`ok1
(
	`°ªq
(
∑th
, "cmeoprwa"));

173 
	`‰ì
(
∑th
);

175 
	`éi°_f‹_óch
(&
hi°‹y
, 
ˇŒ
, 
li°
)

176 
ˇŒ
->
Áû
 = 
åue
;

178 
∑th
 = 
	`Áû∑th_°rög
();

179 
	`ok1
(
	`°ªq
(
∑th
, "CMEOPRWA"));

180 
	`‰ì
(
∑th
);

182  
	`exô_°©us
();

183 
	}
}

	@ccan/ccan/failtest/test/run-locking.c

2 
	~<cˇn/Áûã°/Áûã°.c
>

3 
	~<°dlib.h
>

4 
	~<£tjmp.h
>

5 
	~<°dio.h
>

6 
	~<°d¨g.h
>

7 
	~<as£π.h
>

8 
	~<cˇn/èp/èp.h
>

10 
	#SIZE
 8

	)

13 
Áûã°_ªsu…
 
	$d⁄t_Áû
(
éi°_ˇŒs
 *
hi°‹y
)

15  
FAIL_DONT_FAIL
;

16 
	}
}

18 
boﬁ
 
	$∂a˚_lock
(
fd
, 
lock¨r
[], 
pos
, 
size
,

19 
ty≥
)

21 
Êock
 
Ê
;

24 i‡(
ty≥
 =
F_RDLCK
)

25 
	`mem£t
(
lock¨r
+
pos
, 1, 
size
);

26 i‡(
ty≥
 =
F_WRLCK
)

27 
	`mem£t
(
lock¨r
+
pos
, 2, 
size
);

29 
	`mem£t
(
lock¨r
+
pos
, 0, 
size
);

31 
Ê
.
l_whí˚
 = 
SEEK_SET
;

32 
Ê
.
l_ty≥
 = 
ty≥
;

33 
Ê
.
l_°¨t
 = 
pos
;

34 
Ê
.
l_Àn
 = 
size
;

35  
	`Áûã°_f˙é
(
fd
, "run-lockög.c", 1, 
F_SETLK
, &
Ê
) == 0;

36 
	}
}

38 
	$lock_lookup
(
fd
, 
pos
)

40 
ªt
 = 0;

41 
i
;

42 
lock_öfo
 *
l
;

44 
i
 = 0; i < 
lock_num
; i++) {

45 
l
 = &
locks
[
i
];

47 i‡(
l
->
fd
 != fd)

50 i‡(
pos
 >
l
->
°¨t
 &&Öo†<l->
íd
) {

51 i‡(
ªt
)

52 
ªt
 = 3;

53 i‡(
l
->
ty≥
 =
F_RDLCK
)

54 
ªt
 = 1;

56 
ªt
 = 2;

59  
ªt
;

60 
	}
}

62 
boﬁ
 
	$ã°
(
fd
,

63 
p1
, 
s1
,

64 
p2
, 
s2
,

65 
p3
, 
s3
)

67 
i
;

68 
lock¨r
[
SIZE
];

70 
	`mem£t
(
lock¨r
, 0, (lockarr));

72 i‡(!
	`∂a˚_lock
(
fd
, 
lock¨r
, 
p1
, 
s1
, 
F_WRLCK
))

73  
Ál£
;

75 i‡(!
	`∂a˚_lock
(
fd
, 
lock¨r
, 
p2
, 
s2
, 
F_RDLCK
))

76  
Ál£
;

78 i‡(!
	`∂a˚_lock
(
fd
, 
lock¨r
, 
p3
, 
s3
, 
F_UNLCK
))

79  
Ál£
;

81 
i
 = 0; i < 
SIZE
; i++) {

82 i‡(
	`lock_lookup
(
fd
, 
i
Ë!
lock¨r
[i])

83  
Ál£
;

87 
lock_num
 = 0;

88  
åue
;

89 
	}
}

91 
	$maö
()

93 
fd
;

94 
Êags
;

95 
isize
;

97 
	`∂™_ã°s
(5835);

98 
	`Áûã°_öô
(0, 
NULL
);

99 
Áûã°_hook
 = 
d⁄t_Áû
;

101 
fd
 = 
	`›í
("run-lockög-s¸©ch", 
O_RDWR
|
O_CREAT
, 0600);

103 
Êags
 = 
	`f˙é
(
fd
, 
F_GETFL
);

104 
	`ok1
(
	`Áûã°_f˙é
(
fd
, "run-lockög.c", 1, 
F_GETFL
Ë=
Êags
);

105 
Êags
 |
O_NONBLOCK
;

106 
	`ok1
(
	`Áûã°_f˙é
(
fd
, "run-lockög.c", 1, 
F_SETFL
, 
Êags
) == 0);

107 
	`ok1
(
	`Áûã°_f˙é
(
fd
, "run-lockög.c", 1, 
F_GETFL
Ë=
Êags
);

109 
isize
 = 1; isize < 4; isize++) {

110 
ùos
;

111 
ùos
 = 0; ipo†+ 
isize
 < 
SIZE
; ipos++) {

112 
jsize
;

113 
jsize
 = 1; jsize < 4; jsize++) {

114 
jpos
;

115 
jpos
 = 0; jpo†+ 
jsize
 < 
SIZE
; jpos++) {

116 
ksize
;

117 
ksize
 = 1; ksize < 4; ksize++) {

118 
kpos
;

119 
kpos
 = 0;

120 
kpos
 + 
ksize
 < 
SIZE
;

121 
kpos
++) {

122 
	`ok1
(
	`ã°
(
fd
,

123 
ùos
, 
isize
,

124 
jpos
, 
jsize
,

125 
kpos
, 
ksize
));

133  
	`exô_°©us
();

134 
	}
}

	@ccan/ccan/failtest/test/run-malloc.c

1 
	~"c⁄fig.h
"

2 
	~<°dlib.h
>

3 
	~<£tjmp.h
>

4 
	~<°dio.h
>

5 
	~<°d¨g.h
>

6 
	~<as£π.h
>

7 
	~<cˇn/èp/èp.h
>

10 
jmp_buf
 
	gexôed
;

11 
	#exô
(
°©us
Ë
	`l⁄gjmp
(
exôed
, (°©usË+ 1)

	)

13 
	#¥ötf
 
ßved_¥ötf


	)

14 
ßved_¥ötf
(c⁄° *
fmt
, ...);

16 
	#Ârötf
 
ßved_Ârötf


	)

17 
ßved_Ârötf
(
FILE
 *
ign‹ed
, c⁄° *
fmt
, ...);

19 
	#vÂrötf
 
ßved_vÂrötf


	)

20 
ßved_vÂrötf
(
FILE
 *
ign‹ed
, c⁄° *
fmt
, 
va_li°
 
≠
);

23 
	#ªÆloc
 
£t_ªÆloc


	)

24 *
£t_ªÆloc
(*
±r
, 
size_t
 
size
);

26 
	#‰ì
 
£t_‰ì


	)

27 
£t_‰ì
(*
±r
);

30 
	~<cˇn/Áûã°/Áûã°.c
>

32 #unde‡
ªÆloc


33 #unde‡
‰ì


35 *
	gbuf„r
;

36 *
	$£t_ªÆloc
(*
±r
, 
size_t
 
size
)

38  
buf„r
 = 
	`ªÆloc
(
±r
, 
size
);

39 
	}
}

41 
	$£t_‰ì
(*
±r
)

43 i‡(
±r
 =
buf„r
)

44 
buf„r
 = 
NULL
;

45 
	`‰ì
(
±r
);

46 
	}
}

48 *
	gouçut
 = 
NULL
;

50 
	$ßved_v¥ötf
(c⁄° *
fmt
, 
va_li°
 
≠
)

52 
ªt
;

53 
Àn
 = 0;

54 
va_li°
 
≠2
;

56 
	`va_c›y
(
≠2
, 
≠
);

57 
ªt
 = 
	`v¢¥ötf
(
NULL
, 0, 
fmt
, 
≠2
);

58 
	`va_íd
(
≠2
);

60 i‡(
ouçut
)

61 
Àn
 = 
	`°æí
(
ouçut
);

63 
ouçut
 = 
	`ªÆloc
(ouçut, 
Àn
 + 
ªt
 + 1);

64  
	`v•rötf
(
ouçut
 + 
Àn
, 
fmt
, 
≠
);

65 
	}
}

67 
	$ßved_vÂrötf
(
FILE
 *
ign‹ed
, c⁄° *
fmt
, 
va_li°
 
≠
)

69  
	`ßved_v¥ötf
(
fmt
, 
≠
);

70 
	}
}

72 
	$ßved_¥ötf
(c⁄° *
fmt
, ...)

74 
va_li°
 
≠
;

75 
ªt
;

77 
	`va_°¨t
(
≠
, 
fmt
);

78 
ªt
 = 
	`ßved_v¥ötf
(
fmt
, 
≠
);

79 
	`va_íd
(
≠
);

80  
ªt
;

81 
	}
}

83 
	$ßved_Ârötf
(
FILE
 *
ign‹ed
, c⁄° *
fmt
, ...)

85 
va_li°
 
≠
;

86 
ªt
;

88 
	`va_°¨t
(
≠
, 
fmt
);

89 
ªt
 = 
	`ßved_v¥ötf
(
fmt
, 
≠
);

90 
	`va_íd
(
≠
);

91  
ªt
;

92 
	}
}

94 
	$maö
()

96 
°©us
;

98 
	`∂™_ã°s
(3);

99 
	`Áûã°_öô
(0, 
NULL
);

101 
°©us
 = 
	`£tjmp
(
exôed
);

102 i‡(
°©us
 == 0) {

103 *
p
 = 
	`Áûã°_mÆloc
(1, "run-malloc.c", 1);

106 i‡(!
p
)

107 
	`kûl
(
	`gëpid
(), 
SIGSEGV
);

108 
	`Áû
("Expected childÅo crash!");

110 
	`ok1
(
°©us
 == 2);

111 
	`ok1
(
	`°r°r
(
ouçut
, "Killed by signal"));

112 
	`ok1
(
	`°r°r
(
ouçut
, "--failpath=M\n"));

114 
	`‰ì
(
buf„r
);

115  
	`exô_°©us
();

116 
	}
}

	@ccan/ccan/failtest/test/run-open.c

2 
	~<cˇn/Áûã°/Áûã°.c
>

3 
	~<°dlib.h
>

4 
	~<£tjmp.h
>

5 
	~<°dio.h
>

6 
	~<°d¨g.h
>

7 
	~<as£π.h
>

8 
	~<cˇn/èp/èp.h
>

10 
	$maö
()

12 
fd
, 
pfd
[2], 
îr
;

13 
buf
[] = "Hello world!";

14 
°©
 
°
;

16 
	`∂™_ã°s
(12);

17 
	`Áûã°_öô
(0, 
NULL
);

19 i‡(
	`pùe
(
pfd
))

20 
	`ab‹t
();

21 
fd
 = 
	`Áûã°_›í
("run-open-scratchpad", "run-open.c", 1,

22 
O_RDWR
|
O_CREAT
, 0600);

23 i‡(
fd
 == -1) {

25 
îr
 = 
î∫o
;

26 i‡(
	`wrôe
(
pfd
[1], &
îr
, (err)) != (err))

27 
	`ab‹t
();

28 
	`Áûã°_exô
(0);

31 
	`ok1
(
	`wrôe
(
fd
, 
buf
, 
	`°æí
(buf)) == strlen(buf));

32 
	`l£ek
(
fd
, 
SEEK_SET
, 0);

33 
	`ok1
(
	`ªad
(
fd
, 
buf
, 
	`°æí
("Hello world!")) == strlen("Hello world!"));

34 
	`ok1
(
	`°rcmp
(
buf
, "Hello world!") == 0);

37 
	`ok1
(
	`°©
("run-›í-s¸©ch∑d", &
°
) == 0);

38 
	`ok1
(
°
.
°_size
 =
	`°æí
(
buf
));

39 
	`ok1
(
	`S_ISREG
(
°
.
°_mode
));

40 
	`ok1
((
°
.
°_mode
 & 0777) == 0600);

43 
	`ok1
(
	`ªad
(
pfd
[0], &
îr
, (err)) == (err));

44 
	`ok1
(
îr
 =
EACCES
);

47 
	`Áûã°_˛o£
(
fd
, "run-open.c", 1);

48 
	`˛o£
(
pfd
[0]);

49 
	`˛o£
(
pfd
[1]);

52 i‡(
	`pùe
(
pfd
) != 0)

53 
	`ab‹t
();

54 
fd
 = 
	`Áûã°_›í
("run-›í-s¸©ch∑d", "run-›í.c", 1, 
O_RDONLY
);

55 i‡(
fd
 == -1) {

57 
îr
 = 
î∫o
;

58 i‡(
	`wrôe
(
pfd
[1], &
îr
, (err)) != (err))

59 
	`ab‹t
();

60 
	`Áûã°_exô
(0);

63 
	`ok1
(
	`wrôe
(
fd
, 
buf
, 
	`°æí
(buf)) == -1);

64 
	`ok1
(
	`ªad
(
fd
, 
buf
, 
	`°æí
("Hello world!")) == strlen("Hello world!"));

65 
	`ok1
(
	`°rcmp
(
buf
, "Hello world!") == 0);

67 
	`Áûã°_˛o£
(
fd
, "run-open.c", 1);

68 
	`˛o£
(
pfd
[0]);

69 
	`˛o£
(
pfd
[1]);

71  
	`exô_°©us
();

72 
	}
}

	@ccan/ccan/failtest/test/run-with-fdlimit.c

2 
	~<cˇn/Áûã°/Áûã°.c
>

3 
	~<°dlib.h
>

4 
	~<îr.h
>

5 
	~<cˇn/èp/èp.h
>

7 
	$maö
()

9 
fd
, 
pfd
[2], 
ecode
;

10 
æimô
 
lim
;

12 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, &
lim
) != 0)

13 
	`îr
(1, "getrlimit RLIMIT_NOFILE fail?");

15 
	`¥ötf
("rlimit = %lu/%lu (inf=%lu)\n",

16 ()
lim
.
æim_cur
, (Óim.
æim_max
,

17 ()
RLIM_INFINITY
);

18 
lim
.
æim_cur
 /= 2;

19 i‡(
lim
.
æim_cur
 < 8)

20 
	`îrx
(1, "gëæimôÜimô %lòtoÿlow", ()
lim
.
æim_cur
);

21 i‡(
	`£ålimô
(
RLIMIT_NOFILE
, &
lim
) != 0)

22 
	`îr
(1, "setrlimit RLIMIT_NOFILE (%li/%li)",

23 ()
lim
.
æim_cur
, (Óim.
æim_max
);

25 
	`∂™_ã°s
(2);

26 
	`Áûã°_öô
(0, 
NULL
);

28 i‡(
	`pùe
(
pfd
))

29 
	`ab‹t
();

31 
fd
 = 
	`Áûã°_›í
("run-with-fdlimit-scratch", "run-with_fdlimit.c", 1,

32 
O_RDWR
|
O_CREAT
, 0600);

33 i‡(
fd
 == -1) {

35 
ecode
 = 
î∫o
;

36 i‡(
	`wrôe
(
pfd
[1], &
ecode
, (ecode)) != (ecode))

37 
	`ab‹t
();

38 
	`Áûã°_exô
(0);

42 
	`ok1
(
	`ªad
(
pfd
[0], &
ecode
, (ecode)) == (ecode));

43 
	`ok1
(
ecode
 =
EACCES
);

46 
	`Áûã°_˛o£
(
fd
, "run-open.c", 1);

47 
	`˛o£
(
pfd
[0]);

48 
	`˛o£
(
pfd
[1]);

50  
	`exô_°©us
();

51 
	}
}

	@ccan/ccan/failtest/test/run-write.c

2 
	~<cˇn/Áûã°/Áûã°.c
>

3 
	~<°dlib.h
>

4 
	~<£tjmp.h
>

5 
	~<°dio.h
>

6 
	~<°d¨g.h
>

7 
	~<as£π.h
>

8 
	~<cˇn/èp/èp.h
>

10 
	$maö
(
¨gc
, *
¨gv
[])

12 
fd
;

13 *
p
;

14 
buf
[] = "Hello world!";

16 
	`∂™_ã°s
(5);

17 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

19 
fd
 = 
	`Áûã°_›í
("run-wrôe-s¸©ch∑d", 
__FILE__
, 
__LINE__
,

20 
O_RDWR
|
O_CREAT
, 0600);

22 i‡(
fd
 < 0)

23 
	`Áûã°_exô
(0);

24 i‡(
	`wrôe
(
fd
, 
buf
, 
	`°æí
(buf)) != strlen(buf))

25 
	`ab‹t
();

26 
	`ok1
(
	`l£ek
(
fd
, 0, 
SEEK_CUR
Ë=
	`°æí
(
buf
));

28 
p
 = 
	`Áûã°_mÆloc
(100, 
__FILE__
, 
__LINE__
);

29 i‡(!
p
) {

31 
i
;

33 
i
 = 0; i < 
	`°æí
(
buf
)+1; i++)

34 i‡(
	`Áûã°_wrôe
(
fd
, "x", 1, 
__FILE__
, 
__LINE__
)

37 
	`Áûã°_˛o£
(
fd
, 
__FILE__
, 
__LINE__
);

38 
	`Áûã°_exô
(0);

42 
	`ok1
(
	`l£ek
(
fd
, 0, 
SEEK_CUR
Ë=
	`°æí
(
buf
));

44 
	`ok1
(
	`l£ek
(
fd
, 0, 
SEEK_END
Ë=
	`°æí
(
buf
));

45 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

46 
	`ok1
(
	`ªad
(
fd
, 
buf
, 
	`°æí
(buf)) == strlen("Hello world!"));

47 
	`ok1
(
	`°rcmp
(
buf
, "Hello world!") == 0);

48 
	`Áûã°_˛o£
(
fd
, 
__FILE__
, 
__LINE__
);

50  
	`exô_°©us
();

51 
	}
}

	@ccan/ccan/foreach/foreach.c

2 
	~<cˇn/f‹óch/f‹óch.h
>

3 #i‡!
HAVE_COMPOUND_LITERALS
 || !
HAVE_FOR_LOOP_DECLARATION


4 
	~<cˇn/li°/li°.h
>

5 
	~<°döt.h
>

6 
	~<°dlib.h
>

7 
	~<°d¨g.h
>

10 
LIST_HEAD
(
ôîs
);

12 
	sôî_öfo
 {

13 
li°_node
 
	mli°
;

14 c⁄° *
	mödex
;

15 
	mi
, 
	mnum
;

16 
boﬁ
 
	m⁄°ack
;

20 
boﬁ
 
	$⁄_°ack
(c⁄° *
±r
, c⁄° *
⁄°ack
)

22 #i‡
HAVE_STACK_GROWS_UPWARDS


23  
±r
 < 
⁄°ack
;

25  
±r
 > 
⁄°ack
;

27 
	}
}

29 
	$‰ì_ﬁd_ôîs
(c⁄° *
ödex
)

31 
ôî_öfo
 *
i
, *
√xt
;

33 
	`li°_f‹_óch_ß„
(&
ôîs
, 
i
, 
√xt
, 
li°
) {

36 i‡(
i
->
ödex
 == index

37 || (
i
->
⁄°ack
 && !
	`⁄_°ack
(i->
ödex
, &i))) {

38 
	`li°_dñ
(&
i
->
li°
);

39 
	`‰ì
(
i
);

42 
	}
}

44 
ôî_öfo
 *
	$föd_ôî
(c⁄° *
ödex
)

46 
ôî_öfo
 *
i
;

48 
	`li°_f‹_óch
(&
ôîs
, 
i
, 
li°
) {

49 i‡(
i
->
ödex
 == index)

50  
i
;

52 
	`ab‹t
();

53 
	}
}

55 
ôî_öfo
 *
	$√w_ôî
(c⁄° *
ödex
)

57 
ôî_öfo
 *
öfo
 = 
	`mÆloc
( *info);

58 
öfo
->
ödex
 = index;

59 
öfo
->
i
 = info->
num
 = 0;

60 
öfo
->
⁄°ack
 = 
	`⁄_°ack
(
ödex
, &info);

61 
	`li°_add
(&
ôîs
, &
öfo
->
li°
);

62  
öfo
;

63 
	}
};

65 #i‡
HAVE_COMPOUND_LITERALS


66 
	$_f‹óch_ôî_öô
(c⁄° *
i
)

68 
	`‰ì_ﬁd_ôîs
(
i
);

69 
	`√w_ôî
(
i
);

70 
	}
}

72 
	$_f‹óch_ôî
(c⁄° *
i
)

74 
ôî_öfo
 *
öfo
 = 
	`föd_ôî
(
i
);

75  
öfo
->
i
;

76 
	}
}

78 
	$_f‹óch_ôî_öc
(c⁄° *
i
)

80 
ôî_öfo
 *
öfo
 = 
	`föd_ôî
(
i
);

81  ++
öfo
->
i
;

82 
	}
}

84 
	g_f‹óch_ãrm
 = 0x42430199;

89 
	$cou¡_vÆs
(
ôî_öfo
 *
öfo
, 
va_li°
 *
≠
)

91 
i
;

92 
vÆ
 = 0;

94 
i
 = 0; i < 
öfo
->
num
 || 
vÆ
 !
_f‹óch_ãrm
; i++) {

95 
vÆ
 = 
	`va_¨g
(*
≠
, );

97 
_f‹óch_ãrm
++;

98  
i
;

99 
	}
}

101 
	$_f‹óch_ötvÆ_öô
(c⁄° *
i
, 
vÆ
, ...)

103 
va_li°
 
≠
;

104 
ôî_öfo
 *
öfo
;

106 
	`‰ì_ﬁd_ôîs
(
i
);

107 
öfo
 = 
	`√w_ôî
(
i
);

109 
	`va_°¨t
(
≠
, 
vÆ
);

110 
öfo
->
num
 = 
	`cou¡_vÆs
(öfo, &
≠
);

111 
	`va_íd
(
≠
);

113  
vÆ
;

114 
	}
}

116 
boﬁ
 
	$_f‹óch_ötvÆ_d⁄e
(c⁄° *
i
)

118 
ôî_öfo
 *
öfo
 = 
	`föd_ôî
(
i
);

119  
öfo
->
i
 =öfo->
num
;

120 
	}
}

122 
	$_f‹óch_ötvÆ_√xt
(c⁄° *
i
, 
vÆ
, ...)

124 
ôî_öfo
 *
öfo
 = 
	`föd_ôî
(
i
);

125 
va_li°
 
≠
;

126 
num
;

128 
	`va_°¨t
(
≠
, 
vÆ
);

129 
öfo
->
num
 = 
	`cou¡_vÆs
(öfo, &
≠
);

130 
	`va_íd
(
≠
);

132 
öfo
->
i
++;

133 
	`as£π
(
öfo
->
i
 <öfo->
num
);

134 i‡(
öfo
->
i
 =öfo->
num
)

137 
	`va_°¨t
(
≠
, 
vÆ
);

138 
num
 = 0;Çum < 
öfo
->
i
;Çum++)

139 
vÆ
 = 
	`va_¨g
(
≠
, );

141 
	`va_íd
(
≠
);

142  
vÆ
;

143 
	}
}

145 *
	$_f‹óch_±rvÆ_öô
(c⁄° *
i
, c⁄° *
vÆ
, ...)

147 
	`‰ì_ﬁd_ôîs
(
i
);

148 
	`√w_ôî
(
i
);

150  (*)
vÆ
;

151 
	}
}

153 *
	$_f‹óch_±rvÆ_√xt
(c⁄° *
i
, c⁄° *
vÆ
, ...)

155 
ôî_öfo
 *
öfo
 = 
	`föd_ôî
(
i
);

156 
va_li°
 
≠
;

157 
num
;

159 
öfo
->
i
++;

160 
	`va_°¨t
(
≠
, 
vÆ
);

161 
num
 = 0;Çum < 
öfo
->
i
;Çum++)

162 
vÆ
 = 
	`va_¨g
(
≠
, *);

163 
	`va_íd
(
≠
);

164  (*)
vÆ
;

165 
	}
}

	@ccan/ccan/foreach/foreach.h

2 #i‚de‡
CCAN_FOREACH_H


3 
	#CCAN_FOREACH_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°ddef.h
>

6 
	~<as£π.h
>

7 
	~<°dboﬁ.h
>

9 #i‡
HAVE_COMPOUND_LITERALS


10 #i‡
HAVE_FOR_LOOP_DECLARATION


25 
	#f‹óch_öt
(
i
, ...) \

26 
_f‹óch_i
 = (((
i
Ë(([]Ë{ 
__VA_ARGS__
 })[0]), 0); \

27 
_f‹óch_i
 < (([]Ë{ 
__VA_ARGS__
 })/(); \

28 (
i
Ë(([]Ë{ 
__VA_ARGS__
, 0 })[++
_f‹óch_i
])

	)

46 
	#f‹óch_±r
(
i
, ...) \

47 
_f‹óch_i
 \

48 (((
i
Ë(*)((
	`FOREACH_TYPEOF
(i)[]){ 
__VA_ARGS__
 })[0]), 0); \

49 (
i
); \

50 (
i
Ë(*)((
	`FOREACH_TYPEOF
(i)[]) \

51 { 
__VA_ARGS__
, 
NULL
})[++
_f‹óch_i
], \

52 
	`_f‹óch_no_nuŒvÆ
(
_f‹óch_i
, 
i
, \

53 ((c⁄° *[]){ 
__VA_ARGS__
})))

	)

56 
	#f‹óch_öt
(
i
, ...) \

57 (
i
Ë(([]){ 
__VA_ARGS__
 })[0], 
	`_f‹óch_ôî_öô
(&(i)); \

58 
	`_f‹óch_ôî
(&(
i
)Ë< (([]Ë{ 
__VA_ARGS__
 }) \

60 (
i
Ë([]Ë{ 
__VA_ARGS__
, 0 }[
	`_f‹óch_ôî_öc
(&(i))])

	)

62 
	#f‹óch_±r
(
i
, ...) \

63 (
i
Ë(*)((
	`FOREACH_TYPEOF
(i)[]){ 
__VA_ARGS__
 })[0], \

64 
	`_f‹óch_ôî_öô
(&(
i
)); \

65 (
i
); \

66 (
i
Ë(*)((
	`FOREACH_TYPEOF
(i)[]){ 
__VA_ARGS__
, 
NULL
 }) \

67 [
	`_f‹óch_ôî_öc
(&(
i
))], \

68 
	`_f‹óch_no_nuŒvÆ
(
	`_f‹óch_ôî
(&(
i
)), i, \

69 ((c⁄° *[]){ 
__VA_ARGS__
})))

	)

71 
_f‹óch_ôî_öô
(c⁄° *
i
);

72 
_f‹óch_ôî
(c⁄° *
i
);

73 
_f‹óch_ôî_öc
(c⁄° *
i
);

78 
	#_f‹óch_no_nuŒvÆ
(
i
, 
p
, 
¨r
) \

79 
	`as£π
((
i
Ë>(
¨r
)/◊º[0]Ë|| (
p
))

	)

81 #i‡
HAVE_TYPEOF


82 
	#FOREACH_TYPEOF
(
i
Ë
	`__ty≥of__
(i)

	)

84 
	#FOREACH_TYPEOF
(
i
Ëc⁄° *

	)

90 
	#f‹óch_öt
(
i
, ...) \

91 
i
 = 
	`_f‹óch_ötvÆ_öô
(&(i), 
__VA_ARGS__
, 
_f‹óch_ãrm
); \

92 !
	`_f‹óch_ötvÆ_d⁄e
(&
i
); \

93 
i
 = 
	`_f‹óch_ötvÆ_√xt
(&(i), 
__VA_ARGS__
, 
_f‹óch_ãrm
))

	)

95 
	#f‹óch_±r
(
i
, ...) \

96 
i
 = 
	`_f‹óch_±rvÆ_öô
(&(i), 
__VA_ARGS__
, 
NULL
); \

97 (
i
); \

98 
i
 = 
	`_f‹óch_±rvÆ_√xt
(&(i), 
__VA_ARGS__
, 
NULL
))

	)

100 
_f‹óch_ãrm
;

101 
_f‹óch_ötvÆ_öô
(c⁄° *
i
, 
vÆ
, ...);

102 
boﬁ
 
_f‹óch_ötvÆ_d⁄e
(c⁄° *
i
);

103 
_f‹óch_ötvÆ_√xt
(c⁄° *
i
, 
vÆ
, ...);

104 *
_f‹óch_±rvÆ_öô
(c⁄° *
i
, c⁄° *
vÆ
, ...);

105 *
_f‹óch_±rvÆ_√xt
(c⁄° *
i
, c⁄° *
vÆ
, ...);

	@ccan/ccan/foreach/test/compile_ok-const.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/f‹óch/f‹óch.c
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 c⁄° *
s1
 = "hñlo", *
s2
 = "w‹ld", *
p
;

8 
i
 = 0;

10 
	`f‹óch_±r
(
p
, 
s1
, 
s2
)

11 
i
++;

13  
i
 == 2 ? 0 : 1;

14 
	}
}

	@ccan/ccan/foreach/test/compile_ok-nonconst.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/f‹óch/f‹óch.c
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 *
p
;

8 
i
 = 0;

10 
	`f‹óch_±r
(
p
, 
¨gv
[0],árgv[1])

11 
i
++;

13  
i
 == 2 ? 0 : 1;

14 
	}
}

	@ccan/ccan/foreach/test/run-break.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

5 
	~<cˇn/f‹óch/f‹óch.c
>

7 
	$cou¡_ôîs
()

9 
cou¡
 = 0;

10 #i‡!
HAVE_COMPOUND_LITERALS
 || !
HAVE_FOR_LOOP_DECLARATION


11 
ôî_öfo
 *
i
;

13 
	`li°_f‹_óch
(&
ôîs
, 
i
, 
li°
)

14 
cou¡
++;

16  
cou¡
;

17 
	}
}

19 
	$maö
()

21 
i
, 
j
, 
sum
;

23 
	`∂™_ã°s
(2);

25 
sum
 = 0;

26 
	`f‹óch_öt
(
i
, 0, 1, 2, 3, 4) {

27 
	`f‹óch_öt
(
j
, 0, 1, 2, 3, 4) {

28 
sum
 +
i
*
j
;

29 i‡(
j
 =
i
)

33 
	`ok1
(
sum
 == 65);

34 
	`ok1
(
	`cou¡_ôîs
() <= 2);

36  
	`exô_°©us
();

37 
	}
}

	@ccan/ccan/foreach/test/run-nested.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

5 
	~<°dlib.h
>

6 
	~<cˇn/f‹óch/f‹óch.c
>

8 
	$ã°_öt_ªcursi⁄
(
Àvñ
)

10 
i
, 
sum
 = 0;

12 
	`f‹óch_öt
(
i
, 0, 1, 2, 3, 4) {

13 
sum
 +
i
;

14 i‡(
i
 > 
Àvñ
)

15 
sum
 +
	`ã°_öt_ªcursi⁄
(
i
);

17  
sum
;

18 
	}
}

20 
	$ã°_±r_ªcursi⁄
(c⁄° *
Àvñ
)

22 
sum
 = 0;

23 c⁄° *
i
;

25 
	`f‹óch_±r
(
i
, "0", "1", "2", "3", "4") {

26 
sum
 +
	`©oi
(
i
);

27 i‡(
	`©oi
(
i
Ë>átoi(
Àvñ
))

28 
sum
 +
	`ã°_±r_ªcursi⁄
(
i
);

30  
sum
;

31 
	}
}

33 
	$cou¡_ôîs
()

35 
cou¡
 = 0;

36 #i‡!
HAVE_COMPOUND_LITERALS
 || !
HAVE_FOR_LOOP_DECLARATION


37 
ôî_öfo
 *
i
;

39 
	`li°_f‹_óch
(&
ôîs
, 
i
, 
li°
)

40 
cou¡
++;

42  
cou¡
;

43 
	}
}

45 
	$maö
()

47 
i
, 
j
, 
sum
, 
max_ôîs
;

48 c⁄° *
i°r
, *
j°r
;

50 
	`∂™_ã°s
(13);

52 
sum
 = 0;

53 
	`f‹óch_öt
(
i
, 0, 1, 2, 3, 4)

54 
	`f‹óch_öt
(
j
, 0, 1, 2, 3, 4)

55 
sum
 +
i
*
j
;

56 
	`düg
("sum = %i\n", 
sum
);

57 
	`düg
("ôî†%i\n", 
	`cou¡_ôîs
());

58 
	`ok1
(
sum
 == 100);

59 
	`ok1
(
	`cou¡_ôîs
() <= 2);

62 
sum
 = 0;

63 
	`f‹óch_öt
(
i
, 0, 1, 2, 3, 4)

64 
	`f‹óch_öt
(
j
, 0, 1, 2, 3, 4)

65 
sum
 +
i
*
j
;

66 
	`düg
("sum = %i\n", 
sum
);

67 
	`düg
("ôî†%i\n", 
	`cou¡_ôîs
());

68 
	`ok1
(
sum
 == 100);

69 
	`ok1
(
	`cou¡_ôîs
() <= 2);

71 
sum
 = 0;

72 
	`f‹óch_±r
(
i°r
, "0", "1", "2", "3", "4")

73 
	`f‹óch_±r
(
j°r
, "0", "1", "2", "3", "4")

74 
sum
 +
	`©oi
(
i°r
)*©oi(
j°r
);

75 
	`düg
("sum = %i\n", 
sum
);

76 
	`düg
("ôî†%i\n", 
	`cou¡_ôîs
());

77 
	`ok1
(
sum
 == 100);

78 
	`ok1
(
	`cou¡_ôîs
() <= 2 + 2);

81 
sum
 = 0;

82 
	`f‹óch_±r
(
i°r
, "0", "1", "2", "3", "4")

83 
	`f‹óch_±r
(
j°r
, "0", "1", "2", "3", "4")

84 
sum
 +
	`©oi
(
i°r
)*©oi(
j°r
);

85 
	`düg
("sum = %i\n", 
sum
);

86 
	`düg
("ôî†%i\n", 
	`cou¡_ôîs
());

87 
	`ok1
(
sum
 == 100);

88 
	`ok1
(
	`cou¡_ôîs
() <= 2 + 2);

91 
i
 = 0; i < 2; i++) {

92 
sum
 = 
	`ã°_öt_ªcursi⁄
(0);

93 
	`düg
("sum = %i\n", 
sum
);

94 
	`düg
("ôî†%i\n", 
	`cou¡_ôîs
());

95 
	`ok1
(
sum
 == 160);

97 
sum
 = 
	`ã°_±r_ªcursi⁄
("0");

98 
	`düg
("sum = %i\n", 
sum
);

99 
	`düg
("ôî†%i\n", 
	`cou¡_ôîs
());

100 
	`ok1
(
sum
 == 160);

101 i‡(
i
 == 0)

102 
max_ôîs
 = 
	`cou¡_ôîs
();

104 
	`ok1
(
	`cou¡_ôîs
(Ë<
max_ôîs
);

106  
	`exô_°©us
();

107 
	}
}

	@ccan/ccan/foreach/test/run-not-on-stack.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

5 
	~<°dlib.h
>

6 
	~<cˇn/f‹óch/f‹óch.c
>

8 
	gglobÆ_i
;

9 *
	gÆlocs
[1000];

10 
	gnum_Ælocs
;

12 
	$ôî©e
(
dïth
, 
boﬁ
 
d⁄e_globÆ
)

14 *
i
, 
ex≥˘i
;

15 c⁄° *
ex≥˘p
[] = { "hello", "there" };

16 c⁄° **
p
;

17 
°ack_i
;

19 i‡(
dïth
 == 4)

22 i‡(!
d⁄e_globÆ
) {

23 
ex≥˘i
 = 0;

24 
	`f‹óch_öt
(
globÆ_i
, 0, 1) {

25 
	`ok1
(
globÆ_i
 =
ex≥˘i
);

26 
ex≥˘i
++;

27 i‡(
globÆ_i
 == 0)

28 
	`ôî©e
(
dïth
 + 1, 
åue
);

30 
	`ok1
(
ex≥˘i
 == 2);

33 
i
 = 
Ælocs
[
num_Ælocs
++] = 
	`mÆloc
((*i));

34 
ex≥˘i
 = 0;

35 
	`f‹óch_öt
(*
i
, 0, 1) {

36 
	`ok1
(*
i
 =
ex≥˘i
);

37 
ex≥˘i
++;

38 i‡(*
i
 == 0)

39 
	`ôî©e
(
dïth
 + 1, 
d⁄e_globÆ
);

41 
	`ok1
(
ex≥˘i
 == 2);

43 
p
 = 
Ælocs
[
num_Ælocs
++] = 
	`mÆloc
((*p));

44 
ex≥˘i
 = 0;

45 
	`f‹óch_±r
(*
p
, "hello", "there") {

46 
	`ok1
(
	`°rcmp
(
ex≥˘p
[
ex≥˘i
], *
p
) == 0);

47 
ex≥˘i
++;

48 i‡(
ex≥˘i
 == 1)

49 
	`ôî©e
(
dïth
 + 1, 
d⁄e_globÆ
);

51 
	`ok1
(
ex≥˘i
 == 2);

52 
	`ok1
(*
p
 =
NULL
);

54 
ex≥˘i
 = 0;

55 
	`f‹óch_öt
(
°ack_i
, 0, 1) {

56 
	`ok1
(
°ack_i
 =
ex≥˘i
);

57 
ex≥˘i
++;

58 i‡(
°ack_i
 == 0)

59 
	`ôî©e
(
dïth
 + 1, 
d⁄e_globÆ
);

61 
	`ok1
(
ex≥˘i
 == 2);

62 
	}
}

64 
	$maö
()

66 
i
;

67 
	`∂™_ã°s
(861);

69 
	`ôî©e
(0, 
Ál£
);

71 
	`ok1
(
num_Ælocs
 < 1000);

72 
i
 = 0; i < 
num_Ælocs
; i++)

73 
	`‰ì
(
Ælocs
[
i
]);

75  
	`exô_°©us
();

76 
	}
}

	@ccan/ccan/foreach/test/run-single-arg.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

5 
	~<cˇn/f‹óch/f‹óch.c
>

7 
	$maö
()

9 
i
, 
num
;

10 c⁄° *
p
;

12 
	`∂™_ã°s
(5);

14 
num
 = 0;

15 
	`f‹óch_öt
(
i
, 0) {

16 
	`ok1
(
i
 == 0);

17 
num
++;

19 
	`ok1
(
num
 == 1);

21 
num
 = 0;

22 
	`f‹óch_±r
(
p
, "hello") {

23 
	`ok1
(
	`°rcmp
("hñlo", 
p
) == 0);

24 
num
++;

26 
	`ok1
(
p
 =
NULL
);

27 
	`ok1
(
num
 == 1);

29  
	`exô_°©us
();

30 
	}
}

	@ccan/ccan/foreach/test/run.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

5 
	~<cˇn/f‹óch/f‹óch.c
>

7 
	$maö
()

9 
i
, 
ex≥˘i
;

10 c⁄° *
p
, *
ex≥˘p
[] = { "hello", "there", "big", "big", "world" };

12 
	`∂™_ã°s
(11);

14 
ex≥˘i
 = 0;

15 
	`f‹óch_öt
(
i
, 0, 1, 2, 3, 4) {

16 
	`ok1
(
i
 =
ex≥˘i
);

17 
ex≥˘i
++;

20 
ex≥˘i
 = 0;

21 
	`f‹óch_±r
(
p
, "hello", "there", "big", "big", "world") {

22 
	`ok1
(
	`°rcmp
(
ex≥˘p
[
ex≥˘i
], 
p
) == 0);

23 
ex≥˘i
++;

25 
	`ok1
(
p
 =
NULL
);

27  
	`exô_°©us
();

28 
	}
}

	@ccan/ccan/grab_file/grab_file.c

2 
	~"gøb_fûe.h
"

3 
	~<cˇn/èŒoc/èŒoc.h
>

4 
	~<cˇn/n€º/n€º.h
>

5 
	~<uni°d.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

10 *
	$gøb_fd
(c⁄° *
˘x
, 
fd
, 
size_t
 *
size
)

12 
ªt
;

13 
size_t
 
max
, 
s
;

14 *
buf„r
;

15 
°©
 
°
;

17 i‡(!
size
)

18 
size
 = &
s
;

19 *
size
 = 0;

21 i‡(
	`f°©
(
fd
, &
°
Ë=0 && 
	`S_ISREG
(°.
°_mode
))

22 
max
 = 
°
.
°_size
;

24 
max
 = 16384;

26 
buf„r
 = 
	`èŒoc_¨øy
(
˘x
, , 
max
+1);

27 (
ªt
 = 
	`ªad
(
fd
, 
buf„r
 + *
size
, 
max
 - *size)) > 0) {

28 *
size
 +
ªt
;

29 i‡(*
size
 =
max
) {

30 
buf„r
 = 
	`èŒoc_ªÆloc
(
˘x
, buf„r, , 
max
*2+1);

31 i‡(!
buf„r
) {

32 
buf„r
 = 
	`èŒoc_ªÆloc
(
˘x
, buffer, ,

33 
max
 + 1024*1024 + 1);

34 i‡(!
buf„r
)

35  
NULL
;

36 
max
 += 1024*1024;

38 
max
 *= 2;

41 i‡(
ªt
 < 0) {

42 
	`èŒoc_‰ì
(
buf„r
);

43 
buf„r
 = 
NULL
;

45 
buf„r
[*
size
] = '\0';

47  
buf„r
;

48 
	}
}

50 *
	$gøb_fûe
(c⁄° *
˘x
, c⁄° *
fûíame
, 
size_t
 *
size
)

52 
fd
;

53 *
buf„r
;

55 i‡(!
fûíame
)

56 
fd
 = 
	`dup
(
STDIN_FILENO
);

58 
fd
 = 
	`›í
(
fûíame
, 
O_RDONLY
, 0);

60 i‡(
fd
 < 0)

61  
NULL
;

63 
buf„r
 = 
	`gøb_fd
(
˘x
, 
fd
, 
size
);

64 
	`˛o£_n€º
(
fd
);

65  
buf„r
;

66 
	}
}

	@ccan/ccan/grab_file/grab_file.h

2 #i‚de‡
CCAN_GRAB_FILE_H


3 
	#CCAN_GRAB_FILE_H


	)

4 
	~<°dio.h
>

34 *
gøb_fd
(c⁄° *
˘x
, 
fd
, 
size_t
 *
size
);

61 *
gøb_fûe
(c⁄° *
˘x
, c⁄° *
fûíame
, 
size_t
 *
size
);

	@ccan/ccan/grab_file/test/run-grab.c

3 
	~<cˇn/gøb_fûe/gøb_fûe.h
>

4 
	~<°dlib.h
>

5 
	~<°dio.h
>

6 
	~<îr.h
>

7 
	~<sys/°©.h
>

8 
	~<cˇn/gøb_fûe/gøb_fûe.c
>

9 
	~<cˇn/èp/èp.h
>

10 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
i
;

16 **
•lô
, *
°r
;

17 
Àngth
;

18 
°©
 
°
;

20 
°r
 = 
	`gøb_fûe
(
NULL
, "test/run-grab.c", NULL);

21 
•lô
 = 
	`°r•lô
(
°r
, str, "\n");

22 
Àngth
 = 
	`°æí
(
•lô
[0]);

23 
	`ok1
(!
	`°rcmp
(
•lô
[0], "/* This isÅest for grab_file() function"));

24 
i
 = 1; 
•lô
[i]; i++)

25 
Àngth
 +
	`°æí
(
•lô
[
i
]);

26 
	`ok1
(!
	`°rcmp
(
•lô
[
i
-1], "/* End of grab_file()Åest */"));

27 i‡(
	`°©
("ã°/run-gøb.c", &
°
) != 0)

29 i‡(
	`°©
("cˇn/gøb_fûe/ã°/run-gøb.c", &
°
) != 0)

30 
	`îr
(1, "CouldÇot stat self");

31 
	`ok1
(
°
.
°_size
 =
Àngth
 + 
i
);

32 
	`èŒoc_‰ì
(
°r
);

35 
	}
}

	@ccan/ccan/hash/hash.c

40 
	~<°dio.h
>

41 
	~<time.h
>

42 
	~<°döt.h
>

43 
	~<sys/∑øm.h
>

45 #ifde‡
löux


46 
	~<ídün.h
>

53 #i‡(
deföed
(
__BYTE_ORDER
Ë&& deföed(
__LITTLE_ENDIAN
) && \

54 
	g__BYTE_ORDER
 =
__LITTLE_ENDIAN
) || \

55 (
deföed
(
i386
Ë|| deföed(
__i386__
Ë|| deföed(
__i486__
) || \

56 
deföed
(
__i586__
Ë|| deföed(
__i686__
Ë|| deföed(
__x86_64
) || \

57 
deföed
(
vax
Ë|| 
	$deföed
(
MIPSEL
))

58 
	#HASH_LITTLE_ENDIAN
 1

	)

59 
	#HASH_BIG_ENDIAN
 0

	)

60 #ñi‡(
	`deföed
(
__BYTE_ORDER
Ë&& deföed(
__BIG_ENDIAN
) && \

61 
__BYTE_ORDER
 =
__BIG_ENDIAN
) || \

62 (
	`deföed
(
•¨c
Ë|| deföed(
POWERPC
Ë|| deföed(
mc68000
Ë|| 
	$deföed
(
£l
))

63 
	#HASH_LITTLE_ENDIAN
 0

	)

64 
	#HASH_BIG_ENDIAN
 1

	)

66 #îr‹ 
Unknown
 
ídün


70 
	~"hash.h
"

72 #i‡
HAVE_LITTLE_ENDIAN


73 
	#HASH_LITTLE_ENDIAN
 1

	)

74 
	#HASH_BIG_ENDIAN
 0

	)

75 #ñi‡
HAVE_BIG_ENDIAN


76 
	#HASH_LITTLE_ENDIAN
 0

	)

77 
	#HASH_BIG_ENDIAN
 1

	)

79 #îr‹ 
Unknown
 
ídün


82 
	#hashsize
(
n
Ë((
uöt32_t
)1<<“))

	)

83 
	#hashmask
(
n
Ë(
	`hashsize
“)-1)

	)

84 
	#rŸ
(
x
,
k
Ë(((x)<<(k)Ë| ((x)>>(32-(k))))

	)

130 
	#mix
(
a
,
b
,
c
) \

132 
a
 -
c
;á ^
	`rŸ
(c, 4); c +
b
; \

133 
b
 -
a
; b ^
	`rŸ
◊, 6);á +
c
; \

134 
c
 -
b
; c ^
	`rŸ
(b, 8); b +
a
; \

135 
a
 -
c
;á ^
	`rŸ
(c,16); c +
b
; \

136 
b
 -
a
; b ^
	`rŸ
◊,19);á +
c
; \

137 
c
 -
b
; c ^
	`rŸ
(b, 4); b +
a
; \

138 
	}

	)
}

165 
	#föÆ
(
a
,
b
,
c
) \

167 
c
 ^
b
; c -
	`rŸ
(b,14); \

168 
a
 ^
c
;á -
	`rŸ
(c,11); \

169 
b
 ^
a
; b -
	`rŸ
(a,25); \

170 
c
 ^
b
; c -
	`rŸ
(b,16); \

171 
a
 ^
c
;á -
	`rŸ
(c,4); \

172 
b
 ^
a
; b -
	`rŸ
(a,14); \

173 
c
 ^
b
; c -
	`rŸ
(b,24); \

174 }

	)

189 
uöt32_t
 
	$hash_u32
(

190 c⁄° 
uöt32_t
 *
k
,

191 
size_t
 
Àngth
,

192 
uöt32_t
 
öôvÆ
)

194 
uöt32_t
 
a
,
b
,
c
;

197 
a
 = 
b
 = 
c
 = 0xdódbì‡+ (((
uöt32_t
)
Àngth
)<<2Ë+ 
öôvÆ
;

200 
Àngth
 > 3)

202 
a
 +
k
[0];

203 
b
 +
k
[1];

204 
c
 +
k
[2];

205 
	`mix
(
a
,
b
,
c
);

206 
Àngth
 -= 3;

207 
k
 += 3;

211 
Àngth
)

213 3 : 
c
+=
k
[2];

214 2 : 
b
+=
k
[1];

215 1 : 
a
+=
k
[0];

216 
	`föÆ
(
a
,
b
,
c
);

221  
c
;

222 
	}
}

252 
uöt32_t
 
	$hashlôée
–c⁄° *
key
, 
size_t
 
Àngth
, 
uöt32_t
 *
vÆ2
 )

254 
uöt32_t
 
a
,
b
,
c
;

255 uni⁄ { c⁄° *
±r
; 
size_t
 
i
; } 
u
;

258 
a
 = 
b
 = 
c
 = 0xdódbì‡+ ((
uöt32_t
)
Àngth
Ë+ *
vÆ2
;

260 
u
.
±r
 = 
key
;

261 i‡(
HASH_LITTLE_ENDIAN
 && ((
u
.
i
 & 0x3) == 0)) {

262 c⁄° 
uöt32_t
 *
k
 = (c⁄° uöt32_à*)
key
;

263 c⁄° 
uöt8_t
 *
k8
;

266 
Àngth
 > 12)

268 
a
 +
k
[0];

269 
b
 +
k
[1];

270 
c
 +
k
[2];

271 
	`mix
(
a
,
b
,
c
);

272 
Àngth
 -= 12;

273 
k
 += 3;

289 
Àngth
)

291 12: 
c
+=
k
[2]; 
b
+=k[1]; 
a
+=k[0]; ;

292 11: 
c
+=
k
[2]&0xffffff; 
b
+=k[1]; 
a
+=k[0]; ;

293 10: 
c
+=
k
[2]&0xffff; 
b
+=k[1]; 
a
+=k[0]; ;

294 9 : 
c
+=
k
[2]&0xff; 
b
+=k[1]; 
a
+=k[0]; ;

295 8 : 
b
+=
k
[1]; 
a
+=k[0]; ;

296 7 : 
b
+=
k
[1]&0xffffff; 
a
+=k[0]; ;

297 6 : 
b
+=
k
[1]&0xffff; 
a
+=k[0]; ;

298 5 : 
b
+=
k
[1]&0xff; 
a
+=k[0]; ;

299 4 : 
a
+=
k
[0]; ;

300 3 : 
a
+=
k
[0]&0xffffff; ;

301 2 : 
a
+=
k
[0]&0xffff; ;

302 1 : 
a
+=
k
[0]&0xff; ;

303 0 :  
c
;

308 
k8
 = (c⁄° 
uöt8_t
 *)
k
;

309 
Àngth
)

311 12: 
c
+=
k
[2]; 
b
+=k[1]; 
a
+=k[0]; ;

312 11: 
c
+=((
uöt32_t
)
k8
[10])<<16;

313 10: 
c
+=((
uöt32_t
)
k8
[9])<<8;

314 9 : 
c
+=
k8
[8];

315 8 : 
b
+=
k
[1]; 
a
+=k[0]; ;

316 7 : 
b
+=((
uöt32_t
)
k8
[6])<<16;

317 6 : 
b
+=((
uöt32_t
)
k8
[5])<<8;

318 5 : 
b
+=
k8
[4];

319 4 : 
a
+=
k
[0]; ;

320 3 : 
a
+=((
uöt32_t
)
k8
[2])<<16;

321 2 : 
a
+=((
uöt32_t
)
k8
[1])<<8;

322 1 : 
a
+=
k8
[0]; ;

323 0 :  
c
;

328 } i‡(
HASH_LITTLE_ENDIAN
 && ((
u
.
i
 & 0x1) == 0)) {

329 c⁄° 
uöt16_t
 *
k
 = (c⁄° uöt16_à*)
key
;

330 c⁄° 
uöt8_t
 *
k8
;

333 
Àngth
 > 12)

335 
a
 +
k
[0] + (((
uöt32_t
)k[1])<<16);

336 
b
 +
k
[2] + (((
uöt32_t
)k[3])<<16);

337 
c
 +
k
[4] + (((
uöt32_t
)k[5])<<16);

338 
	`mix
(
a
,
b
,
c
);

339 
Àngth
 -= 12;

340 
k
 += 6;

344 
k8
 = (c⁄° 
uöt8_t
 *)
k
;

345 
Àngth
)

347 12: 
c
+=
k
[4]+(((
uöt32_t
)k[5])<<16);

348 
b
+=
k
[2]+(((
uöt32_t
)k[3])<<16);

349 
a
+=
k
[0]+(((
uöt32_t
)k[1])<<16);

351 11: 
c
+=((
uöt32_t
)
k8
[10])<<16;

352 10: 
c
+=
k
[4];

353 
b
+=
k
[2]+(((
uöt32_t
)k[3])<<16);

354 
a
+=
k
[0]+(((
uöt32_t
)k[1])<<16);

356 9 : 
c
+=
k8
[8];

357 8 : 
b
+=
k
[2]+(((
uöt32_t
)k[3])<<16);

358 
a
+=
k
[0]+(((
uöt32_t
)k[1])<<16);

360 7 : 
b
+=((
uöt32_t
)
k8
[6])<<16;

361 6 : 
b
+=
k
[2];

362 
a
+=
k
[0]+(((
uöt32_t
)k[1])<<16);

364 5 : 
b
+=
k8
[4];

365 4 : 
a
+=
k
[0]+(((
uöt32_t
)k[1])<<16);

367 3 : 
a
+=((
uöt32_t
)
k8
[2])<<16;

368 2 : 
a
+=
k
[0];

370 1 : 
a
+=
k8
[0];

372 0 :  
c
;

376 c⁄° 
uöt8_t
 *
k
 = (c⁄° uöt8_à*)
key
;

379 
Àngth
 > 12)

381 
a
 +
k
[0];

382 
a
 +((
uöt32_t
)
k
[1])<<8;

383 
a
 +((
uöt32_t
)
k
[2])<<16;

384 
a
 +((
uöt32_t
)
k
[3])<<24;

385 
b
 +
k
[4];

386 
b
 +((
uöt32_t
)
k
[5])<<8;

387 
b
 +((
uöt32_t
)
k
[6])<<16;

388 
b
 +((
uöt32_t
)
k
[7])<<24;

389 
c
 +
k
[8];

390 
c
 +((
uöt32_t
)
k
[9])<<8;

391 
c
 +((
uöt32_t
)
k
[10])<<16;

392 
c
 +((
uöt32_t
)
k
[11])<<24;

393 
	`mix
(
a
,
b
,
c
);

394 
Àngth
 -= 12;

395 
k
 += 12;

399 
Àngth
)

401 12: 
c
+=((
uöt32_t
)
k
[11])<<24;

402 11: 
c
+=((
uöt32_t
)
k
[10])<<16;

403 10: 
c
+=((
uöt32_t
)
k
[9])<<8;

404 9 : 
c
+=
k
[8];

405 8 : 
b
+=((
uöt32_t
)
k
[7])<<24;

406 7 : 
b
+=((
uöt32_t
)
k
[6])<<16;

407 6 : 
b
+=((
uöt32_t
)
k
[5])<<8;

408 5 : 
b
+=
k
[4];

409 4 : 
a
+=((
uöt32_t
)
k
[3])<<24;

410 3 : 
a
+=((
uöt32_t
)
k
[2])<<16;

411 2 : 
a
+=((
uöt32_t
)
k
[1])<<8;

412 1 : 
a
+=
k
[0];

414 0 :  
c
;

418 
	`föÆ
(
a
,
b
,
c
);

419 *
vÆ2
 = 
b
;

420  
c
;

421 
	}
}

429 
uöt32_t
 
	$hashbig
–c⁄° *
key
, 
size_t
 
Àngth
, 
uöt32_t
 *
vÆ2
)

431 
uöt32_t
 
a
,
b
,
c
;

432 uni⁄ { c⁄° *
±r
; 
size_t
 
i
; } 
u
;

435 
a
 = 
b
 = 
c
 = 0xdódbì‡+ ((
uöt32_t
)
Àngth
Ë+ *
vÆ2
;

437 
u
.
±r
 = 
key
;

438 i‡(
HASH_BIG_ENDIAN
 && ((
u
.
i
 & 0x3) == 0)) {

439 c⁄° 
uöt32_t
 *
k
 = (c⁄° uöt32_à*)
key
;

440 c⁄° 
uöt8_t
 *
k8
;

443 
Àngth
 > 12)

445 
a
 +
k
[0];

446 
b
 +
k
[1];

447 
c
 +
k
[2];

448 
	`mix
(
a
,
b
,
c
);

449 
Àngth
 -= 12;

450 
k
 += 3;

466 
Àngth
)

468 12: 
c
+=
k
[2]; 
b
+=k[1]; 
a
+=k[0]; ;

469 11: 
c
+=
k
[2]&0xffffff00; 
b
+=k[1]; 
a
+=k[0]; ;

470 10: 
c
+=
k
[2]&0xffff0000; 
b
+=k[1]; 
a
+=k[0]; ;

471 9 : 
c
+=
k
[2]&0xff000000; 
b
+=k[1]; 
a
+=k[0]; ;

472 8 : 
b
+=
k
[1]; 
a
+=k[0]; ;

473 7 : 
b
+=
k
[1]&0xffffff00; 
a
+=k[0]; ;

474 6 : 
b
+=
k
[1]&0xffff0000; 
a
+=k[0]; ;

475 5 : 
b
+=
k
[1]&0xff000000; 
a
+=k[0]; ;

476 4 : 
a
+=
k
[0]; ;

477 3 : 
a
+=
k
[0]&0xffffff00; ;

478 2 : 
a
+=
k
[0]&0xffff0000; ;

479 1 : 
a
+=
k
[0]&0xff000000; ;

480 0 :  
c
;

485 
k8
 = (c⁄° 
uöt8_t
 *)
k
;

486 
Àngth
)

488 12: 
c
+=
k
[2]; 
b
+=k[1]; 
a
+=k[0]; ;

489 11: 
c
+=((
uöt32_t
)
k8
[10])<<8;

490 10: 
c
+=((
uöt32_t
)
k8
[9])<<16;

491 9 : 
c
+=((
uöt32_t
)
k8
[8])<<24;

492 8 : 
b
+=
k
[1]; 
a
+=k[0]; ;

493 7 : 
b
+=((
uöt32_t
)
k8
[6])<<8;

494 6 : 
b
+=((
uöt32_t
)
k8
[5])<<16;

495 5 : 
b
+=((
uöt32_t
)
k8
[4])<<24;

496 4 : 
a
+=
k
[0]; ;

497 3 : 
a
+=((
uöt32_t
)
k8
[2])<<8;

498 2 : 
a
+=((
uöt32_t
)
k8
[1])<<16;

499 1 : 
a
+=((
uöt32_t
)
k8
[0])<<24; ;

500 0 :  
c
;

506 c⁄° 
uöt8_t
 *
k
 = (c⁄° uöt8_à*)
key
;

509 
Àngth
 > 12)

511 
a
 +((
uöt32_t
)
k
[0])<<24;

512 
a
 +((
uöt32_t
)
k
[1])<<16;

513 
a
 +((
uöt32_t
)
k
[2])<<8;

514 
a
 +((
uöt32_t
)
k
[3]);

515 
b
 +((
uöt32_t
)
k
[4])<<24;

516 
b
 +((
uöt32_t
)
k
[5])<<16;

517 
b
 +((
uöt32_t
)
k
[6])<<8;

518 
b
 +((
uöt32_t
)
k
[7]);

519 
c
 +((
uöt32_t
)
k
[8])<<24;

520 
c
 +((
uöt32_t
)
k
[9])<<16;

521 
c
 +((
uöt32_t
)
k
[10])<<8;

522 
c
 +((
uöt32_t
)
k
[11]);

523 
	`mix
(
a
,
b
,
c
);

524 
Àngth
 -= 12;

525 
k
 += 12;

529 
Àngth
)

531 12: 
c
+=
k
[11];

532 11: 
c
+=((
uöt32_t
)
k
[10])<<8;

533 10: 
c
+=((
uöt32_t
)
k
[9])<<16;

534 9 : 
c
+=((
uöt32_t
)
k
[8])<<24;

535 8 : 
b
+=
k
[7];

536 7 : 
b
+=((
uöt32_t
)
k
[6])<<8;

537 6 : 
b
+=((
uöt32_t
)
k
[5])<<16;

538 5 : 
b
+=((
uöt32_t
)
k
[4])<<24;

539 4 : 
a
+=
k
[3];

540 3 : 
a
+=((
uöt32_t
)
k
[2])<<8;

541 2 : 
a
+=((
uöt32_t
)
k
[1])<<16;

542 1 : 
a
+=((
uöt32_t
)
k
[0])<<24;

544 0 :  
c
;

548 
	`föÆ
(
a
,
b
,
c
);

549 *
vÆ2
 = 
b
;

550  
c
;

551 
	}
}

557 
uöt64_t
 
	$hash64_°abÀ_64
(c⁄° *
key
, 
size_t
 
n
, 
uöt64_t
 
ba£
)

559 c⁄° 
uöt64_t
 *
k
 = 
key
;

560 
uöt32_t
 
a
,
b
,
c
;

563 
a
 = 
b
 = 
c
 = 0xdódbì‡+ ((
uöt32_t
)
n
*8Ë+ (
ba£
 >> 32) + base;

565 
n
 > 3) {

566 
a
 +(
uöt32_t
)
k
[0];

567 
b
 +(
uöt32_t
)(
k
[0] >> 32);

568 
c
 +(
uöt32_t
)
k
[1];

569 
	`mix
(
a
,
b
,
c
);

570 
a
 +(
uöt32_t
)(
k
[1] >> 32);

571 
b
 +(
uöt32_t
)
k
[2];

572 
c
 +(
uöt32_t
)(
k
[2] >> 32);

573 
	`mix
(
a
,
b
,
c
);

574 
n
 -= 3;

575 
k
 += 3;

577 
n
) {

579 
a
 +(
uöt32_t
)
k
[0];

580 
b
 +(
uöt32_t
)(
k
[0] >> 32);

581 
c
 +(
uöt32_t
)
k
[1];

582 
	`mix
(
a
,
b
,
c
);

583 
a
 +(
uöt32_t
)(
k
[1] >> 32);

586 
a
 +(
uöt32_t
)
k
[0];

587 
b
 +(
uöt32_t
)(
k
[0] >> 32);

590  
c
;

592 
	`föÆ
(
a
,
b
,
c
);

593  ((
uöt64_t
)
b
 << 32Ë| 
c
;

594 
	}
}

596 
uöt64_t
 
	$hash64_°abÀ_32
(c⁄° *
key
, 
size_t
 
n
, 
uöt64_t
 
ba£
)

598 c⁄° 
uöt32_t
 *
k
 = 
key
;

599 
uöt32_t
 
a
,
b
,
c
;

602 
a
 = 
b
 = 
c
 = 0xdódbì‡+ ((
uöt32_t
)
n
*4Ë+ (
ba£
 >> 32) + base;

604 
n
 > 3) {

605 
a
 +
k
[0];

606 
b
 +
k
[1];

607 
c
 +
k
[2];

608 
	`mix
(
a
,
b
,
c
);

610 
n
 -= 3;

611 
k
 += 3;

613 
n
) {

615 
b
 +(
uöt32_t
)
k
[1];

617 
a
 +(
uöt32_t
)
k
[0];

620  
c
;

622 
	`föÆ
(
a
,
b
,
c
);

623  ((
uöt64_t
)
b
 << 32Ë| 
c
;

624 
	}
}

626 
uöt64_t
 
	$hash64_°abÀ_16
(c⁄° *
key
, 
size_t
 
n
, 
uöt64_t
 
ba£
)

628 c⁄° 
uöt16_t
 *
k
 = 
key
;

629 
uöt32_t
 
a
,
b
,
c
;

632 
a
 = 
b
 = 
c
 = 0xdódbì‡+ ((
uöt32_t
)
n
*2Ë+ (
ba£
 >> 32) + base;

634 
n
 > 6) {

635 
a
 +(
uöt32_t
)
k
[0] + ((uint32_t)k[1] << 16);

636 
b
 +(
uöt32_t
)
k
[2] + ((uint32_t)k[3] << 16);

637 
c
 +(
uöt32_t
)
k
[4] + ((uint32_t)k[5] << 16);

638 
	`mix
(
a
,
b
,
c
);

640 
n
 -= 6;

641 
k
 += 6;

644 
n
) {

646 
c
 +(
uöt32_t
)
k
[4];

648 
b
 +((
uöt32_t
)
k
[3] << 16);

650 
b
 +(
uöt32_t
)
k
[2];

652 
a
 +((
uöt32_t
)
k
[1] << 16);

654 
a
 +(
uöt32_t
)
k
[0];

657  
c
;

659 
	`föÆ
(
a
,
b
,
c
);

660  ((
uöt64_t
)
b
 << 32Ë| 
c
;

661 
	}
}

663 
uöt64_t
 
	$hash64_°abÀ_8
(c⁄° *
key
, 
size_t
 
n
, 
uöt64_t
 
ba£
)

665 
uöt32_t
 
b32
 = 
ba£
 + (base >> 32);

666 
uöt32_t
 
lowî
 = 
	`hashlôée
(
key
, 
n
, &
b32
);

668  ((
uöt64_t
)
b32
 << 32Ë| 
lowî
;

669 
	}
}

671 
uöt32_t
 
	$hash_™y
(c⁄° *
key
, 
size_t
 
Àngth
, 
uöt32_t
 
ba£
)

673 i‡(
HASH_BIG_ENDIAN
)

674  
	`hashbig
(
key
, 
Àngth
, &
ba£
);

676  
	`hashlôée
(
key
, 
Àngth
, &
ba£
);

677 
	}
}

679 
uöt32_t
 
	$hash_°abÀ_64
(c⁄° *
key
, 
size_t
 
n
, 
uöt32_t
 
ba£
)

681  
	`hash64_°abÀ_64
(
key
, 
n
, 
ba£
);

682 
	}
}

684 
uöt32_t
 
	$hash_°abÀ_32
(c⁄° *
key
, 
size_t
 
n
, 
uöt32_t
 
ba£
)

686  
	`hash64_°abÀ_32
(
key
, 
n
, 
ba£
);

687 
	}
}

689 
uöt32_t
 
	$hash_°abÀ_16
(c⁄° *
key
, 
size_t
 
n
, 
uöt32_t
 
ba£
)

691  
	`hash64_°abÀ_16
(
key
, 
n
, 
ba£
);

692 
	}
}

694 
uöt32_t
 
	$hash_°abÀ_8
(c⁄° *
key
, 
size_t
 
n
, 
uöt32_t
 
ba£
)

696  
	`hashlôée
(
key
, 
n
, &
ba£
);

697 
	}
}

701 
uöt64_t
 
	$hash64_™y
(c⁄° *
key
, 
size_t
 
Àngth
, 
uöt64_t
 
ba£
)

703 
uöt32_t
 
b32
 = 
ba£
 + (base >> 32);

704 
uöt32_t
 
lowî
;

706 i‡(
HASH_BIG_ENDIAN
)

707 
lowî
 = 
	`hashbig
(
key
, 
Àngth
, &
b32
);

709 
lowî
 = 
	`hashlôée
(
key
, 
Àngth
, &
b32
);

711  ((
uöt64_t
)
b32
 << 32Ë| 
lowî
;

712 
	}
}

714 #ifde‡
SELF_TEST


717 
	$drivî1
()

719 
uöt8_t
 
buf
[256];

720 
uöt32_t
 
i
;

721 
uöt32_t
 
h
=0;

722 
time_t
 
a
,
z
;

724 
	`time
(&
a
);

725 
i
=0; i<256; ++iË
buf
[i] = 'x';

726 
i
=0; i<1; ++i)

728 
h
 = 
	`hashlôée
(&
buf
[0],1,h);

730 
	`time
(&
z
);

731 i‡(
z
-
a
 > 0Ë
	`¥ötf
("timê%d %.8x\n", z-a, 
h
);

732 
	}
}

735 
	#HASHSTATE
 1

	)

736 
	#HASHLEN
 1

	)

737 
	#MAXPAIR
 60

	)

738 
	#MAXLEN
 70

	)

739 
	$drivî2
()

741 
uöt8_t
 
qa
[
MAXLEN
+1], 
qb
[MAXLEN+2], *
a
 = &qa[0], *
b
 = &qb[1];

742 
uöt32_t
 
c
[
HASHSTATE
], 
d
[HASHSTATE], 
i
=0, 
j
=0, 
k
, 
l
, 
m
=0, 
z
;

743 
uöt32_t
 
e
[
HASHSTATE
],
f
[HASHSTATE],
g
[HASHSTATE],
h
[HASHSTATE];

744 
uöt32_t
 
x
[
HASHSTATE
],
y
[HASHSTATE];

745 
uöt32_t
 
hÀn
;

747 
	`¥ötf
("Nÿm‹êth™ %dÅrül†shouldÉvî bê√eded \n",
MAXPAIR
/2);

748 
hÀn
=0; hÀ¿< 
MAXLEN
; ++hlen)

750 
z
=0;

751 
i
=0; i<
hÀn
; ++i)

753 
j
=0; j<8; ++j)

755 
m
=1; m<8; ++m)

757 
l
=0;Ü<
HASHSTATE
; ++l)

758 
e
[
l
]=
f
[l]=
g
[l]=
h
[l]=
x
[l]=
y
[l]=~((
uöt32_t
)0);

761 
k
=0; k<
MAXPAIR
; k+=2)

763 
uöt32_t
 
föished
=1;

765 
l
=0;Ü<
hÀn
+1; ++lË{
a
[l] = 
b
[l] = (
uöt8_t
)0;}

767 
a
[
i
] ^(
k
<<
j
);

768 
a
[
i
] ^(
k
>>(8-
j
));

769 
c
[0] = 
	`hashlôée
(
a
, 
hÀn
, 
m
);

770 
b
[
i
] ^((
k
+1)<<
j
);

771 
b
[
i
] ^((
k
+1)>>(8-
j
));

772 
d
[0] = 
	`hashlôée
(
b
, 
hÀn
, 
m
);

774 
l
=0;Ü<
HASHSTATE
; ++l)

776 
e
[
l
] &(
c
[l]^
d
[l]);

777 
f
[
l
] &~(
c
[l]^
d
[l]);

778 
g
[
l
] &
c
[l];

779 
h
[
l
] &~
c
[l];

780 
x
[
l
] &
d
[l];

781 
y
[
l
] &~
d
[l];

782 i‡(
e
[
l
]|
f
[l]|
g
[l]|
h
[l]|
x
[l]|
y
[l]Ë
föished
=0;

784 i‡(
föished
) ;

786 i‡(
k
>
z
) z=k;

787 i‡(
k
==
MAXPAIR
)

789 
	`¥ötf
("Some bit didn't change: ");

790 
	`¥ötf
("%.8x %.8x %.8x %.8x %.8x %.8x ",

791 
e
[0],
f
[0],
g
[0],
h
[0],
x
[0],
y
[0]);

792 
	`¥ötf
("ò%d j %d m %dÜí %d\n", 
i
, 
j
, 
m
, 
hÀn
);

794 i‡(
z
==
MAXPAIR
Ë
d⁄e
;

798 
d⁄e
:

799 i‡(
z
 < 
MAXPAIR
)

801 
	`¥ötf
("Mix suc˚s† %2d byã† %2d inôvÆ† ",
i
,
m
);

802 
	`¥ötf
("ªquúed %dÅrüls\n", 
z
/2);

805 
	`¥ötf
("\n");

806 
	}
}

809 
	$drivî3
()

811 
uöt8_t
 
buf
[
MAXLEN
+20], *
b
;

812 
uöt32_t
 
Àn
;

813 
uöt8_t
 
q
[] = "This isÅheÅime foráll good menÅo comeÅoÅheáid ofÅheir country...";

814 
uöt32_t
 
h
;

815 
uöt8_t
 
qq
[] = "xThis isÅheÅime foráll good menÅo comeÅoÅheáid ofÅheir country...";

816 
uöt32_t
 
i
;

817 
uöt8_t
 
qqq
[] = "xxThis isÅheÅime foráll good menÅo comeÅoÅheáid ofÅheir country...";

818 
uöt32_t
 
j
;

819 
uöt8_t
 
qqqq
[] = "xxxThis isÅheÅime foráll good menÅo comeÅoÅheáid ofÅheir country...";

820 
uöt32_t
 
ªf
,
x
,
y
;

821 
uöt8_t
 *
p
;

823 
	`¥ötf
("Endianness. TheseÜines shouldáll beÅhe same (for values filled in):\n");

824 
	`¥ötf
("%.8x %.8x %.8x\n",

825 
	`hash_w‹d
((c⁄° 
uöt32_t
 *)
q
, ((q)-1)/4, 13),

826 
	`hash_w‹d
((c⁄° 
uöt32_t
 *)
q
, ((q)-5)/4, 13),

827 
	`hash_w‹d
((c⁄° 
uöt32_t
 *)
q
, ((q)-9)/4, 13));

828 
p
 = 
q
;

829 
	`¥ötf
("%.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x\n",

830 
	`hashlôée
(
p
, (
q
)-1, 13), hashlittle(p, (q)-2, 13),

831 
	`hashlôée
(
p
, (
q
)-3, 13), hashlittle(p, (q)-4, 13),

832 
	`hashlôée
(
p
, (
q
)-5, 13), hashlittle(p, (q)-6, 13),

833 
	`hashlôée
(
p
, (
q
)-7, 13), hashlittle(p, (q)-8, 13),

834 
	`hashlôée
(
p
, (
q
)-9, 13), hashlittle(p, (q)-10, 13),

835 
	`hashlôée
(
p
, (
q
)-11, 13), hashlittle(p, (q)-12, 13));

836 
p
 = &
qq
[1];

837 
	`¥ötf
("%.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x\n",

838 
	`hashlôée
(
p
, (
q
)-1, 13), hashlittle(p, (q)-2, 13),

839 
	`hashlôée
(
p
, (
q
)-3, 13), hashlittle(p, (q)-4, 13),

840 
	`hashlôée
(
p
, (
q
)-5, 13), hashlittle(p, (q)-6, 13),

841 
	`hashlôée
(
p
, (
q
)-7, 13), hashlittle(p, (q)-8, 13),

842 
	`hashlôée
(
p
, (
q
)-9, 13), hashlittle(p, (q)-10, 13),

843 
	`hashlôée
(
p
, (
q
)-11, 13), hashlittle(p, (q)-12, 13));

844 
p
 = &
qqq
[2];

845 
	`¥ötf
("%.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x\n",

846 
	`hashlôée
(
p
, (
q
)-1, 13), hashlittle(p, (q)-2, 13),

847 
	`hashlôée
(
p
, (
q
)-3, 13), hashlittle(p, (q)-4, 13),

848 
	`hashlôée
(
p
, (
q
)-5, 13), hashlittle(p, (q)-6, 13),

849 
	`hashlôée
(
p
, (
q
)-7, 13), hashlittle(p, (q)-8, 13),

850 
	`hashlôée
(
p
, (
q
)-9, 13), hashlittle(p, (q)-10, 13),

851 
	`hashlôée
(
p
, (
q
)-11, 13), hashlittle(p, (q)-12, 13));

852 
p
 = &
qqqq
[3];

853 
	`¥ötf
("%.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x %.8x\n",

854 
	`hashlôée
(
p
, (
q
)-1, 13), hashlittle(p, (q)-2, 13),

855 
	`hashlôée
(
p
, (
q
)-3, 13), hashlittle(p, (q)-4, 13),

856 
	`hashlôée
(
p
, (
q
)-5, 13), hashlittle(p, (q)-6, 13),

857 
	`hashlôée
(
p
, (
q
)-7, 13), hashlittle(p, (q)-8, 13),

858 
	`hashlôée
(
p
, (
q
)-9, 13), hashlittle(p, (q)-10, 13),

859 
	`hashlôée
(
p
, (
q
)-11, 13), hashlittle(p, (q)-12, 13));

860 
	`¥ötf
("\n");

863 
i
=47; 
j
=0;

864 
	`hashlôée2
(
q
, (q), &
i
, &
j
);

865 i‡(
	`hashlôée
(
q
, (q), 47Ë!
i
)

866 
	`¥ötf
("hashlittle2ánd hashlittle mismatch\n");

869 
Àn
 = 0xdeadbeef;

870 
i
=47, 
j
=0;

871 
	`hash_w‹d2
(&
Àn
, 1, &
i
, &
j
);

872 i‡(
	`hash_w‹d
(&
Àn
, 1, 47Ë!
i
)

873 
	`¥ötf
("hash_word2ánd hash_word mismatch %x %x\n",

874 
i
, 
	`hash_w‹d
(&
Àn
, 1, 47));

877 
h
=0, 
b
=
buf
+1; h<8; ++h, ++b)

879 
i
=0; i<
MAXLEN
; ++i)

881 
Àn
 = 
i
;

882 
j
=0; j<
i
; ++jË*(
b
+j)=0;

885 
ªf
 = 
	`hashlôée
(
b
, 
Àn
, (
uöt32_t
)1);

886 *(
b
+
i
)=(
uöt8_t
)~0;

887 *(
b
-1)=(
uöt8_t
)~0;

888 
x
 = 
	`hashlôée
(
b
, 
Àn
, (
uöt32_t
)1);

889 
y
 = 
	`hashlôée
(
b
, 
Àn
, (
uöt32_t
)1);

890 i‡((
ªf
 !
x
Ë|| (ª‡!
y
))

892 
	`¥ötf
("Æignmíàîr‹: %.8x %.8x %.8x %d %d\n",
ªf
,
x
,
y
,

893 
h
, 
i
);

897 
	}
}

900 
	$drivî4
()

902 
uöt8_t
 
buf
[1];

903 
uöt32_t
 
h
,
i
,
°©e
[
HASHSTATE
];

906 
buf
[0] = ~0;

907 
i
=0; i<
HASHSTATE
; ++iË
°©e
[i] = 1;

908 
	`¥ötf
("These shouldáll be different\n");

909 
i
=0, 
h
=0; i<8; ++i)

911 
h
 = 
	`hashlôée
(
buf
, 0, h);

912 
	`¥ötf
("%2ld 0-byã såögs, hash i† %.8x\n", 
i
, 
h
);

914 
	}
}

917 
	$maö
()

919 
	`drivî1
();

920 
	`drivî2
();

921 
	`drivî3
();

922 
	`drivî4
();

924 
	}
}

	@ccan/ccan/hash/hash.h

2 #i‚de‡
CCAN_HASH_H


3 
	#CCAN_HASH_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°döt.h
>

6 
	~<°dlib.h
>

7 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

53 
	#hash
(
p
, 
num
, 
ba£
Ë
	`hash_™y
(’), (num)*(*’)), (ba£))

	)

94 
	#hash_°abÀ
(
p
, 
num
, 
ba£
) \

95 (
	`BUILD_ASSERT_OR_ZERO
((*(
p
)) == 8 || (*(p)) == 4 \

96 || (*(
p
)) == 2 || (*(p)) == 1) + \

97 (*(
p
)Ë=8 ? 
	`hash_°abÀ_64
(’), (
num
), (
ba£
)) \

98 : (*(
p
)Ë=4 ? 
	`hash_°abÀ_32
(’), (
num
), (
ba£
)) \

99 : (*(
p
)Ë=2 ? 
	`hash_°abÀ_16
(’), (
num
), (
ba£
)) \

100 : 
	`hash_°abÀ_8
((
p
), (
num
), (
ba£
)))

	)

116 
uöt32_t
 
hash_u32
(c⁄° uöt32_à*
key
, 
size_t
 
num
, uöt32_à
ba£
);

130 
ölöe
 
uöt32_t
 
	$hash_°rög
(c⁄° *
°rög
)

135 
uöt32_t
 
ªt
;

137 
ªt
 = 0; *
°rög
; string++)

138 
ªt
 = (ªà<< 5Ë-Ñë + *
°rög
;

140  
ªt
;

141 
	}
}

182 
	#hash64
(
p
, 
num
, 
ba£
Ë
	`hash64_™y
(’), (num)*(*’)), (ba£))

	)

223 
	#hash64_°abÀ
(
p
, 
num
, 
ba£
) \

224 (
	`BUILD_ASSERT_OR_ZERO
((*(
p
)) == 8 || (*(p)) == 4 \

225 || (*(
p
)) == 2 || (*(p)) == 1) + \

226 (*(
p
)Ë=8 ? 
	`hash64_°abÀ_64
(’), (
num
), (
ba£
)) \

227 : (*(
p
)Ë=4 ? 
	`hash64_°abÀ_32
(’), (
num
), (
ba£
)) \

228 : (*(
p
)Ë=2 ? 
	`hash64_°abÀ_16
(’), (
num
), (
ba£
)) \

229 : 
	`hash64_°abÀ_8
((
p
), (
num
), (
ba£
)))

	)

240 
	#hashl
(
p
, 
num
, 
ba£
) \

241 (
	`BUILD_ASSERT_OR_ZERO
((Ë=(
uöt32_t
) \

242 || (Ë=(
uöt64_t
)) + \

243 ((Ë=(
uöt64_t
) \

244 ? 
	`hash64
((
p
), (
num
), (
ba£
)Ë: 
	`hash
(’), (num), (ba£))))

	)

247 
uöt32_t
 
hash_™y
(c⁄° *
key
, 
size_t
 
Àngth
, uöt32_à
ba£
);

248 
uöt32_t
 
hash_°abÀ_64
(c⁄° *
key
, 
size_t
 
n
, uöt32_à
ba£
);

249 
uöt32_t
 
hash_°abÀ_32
(c⁄° *
key
, 
size_t
 
n
, uöt32_à
ba£
);

250 
uöt32_t
 
hash_°abÀ_16
(c⁄° *
key
, 
size_t
 
n
, uöt32_à
ba£
);

251 
uöt32_t
 
hash_°abÀ_8
(c⁄° *
key
, 
size_t
 
n
, uöt32_à
ba£
);

252 
uöt64_t
 
hash64_™y
(c⁄° *
key
, 
size_t
 
Àngth
, uöt64_à
ba£
);

253 
uöt64_t
 
hash64_°abÀ_64
(c⁄° *
key
, 
size_t
 
n
, uöt64_à
ba£
);

254 
uöt64_t
 
hash64_°abÀ_32
(c⁄° *
key
, 
size_t
 
n
, uöt64_à
ba£
);

255 
uöt64_t
 
hash64_°abÀ_16
(c⁄° *
key
, 
size_t
 
n
, uöt64_à
ba£
);

256 
uöt64_t
 
hash64_°abÀ_8
(c⁄° *
key
, 
size_t
 
n
, uöt64_à
ba£
);

300 
ölöe
 
uöt32_t
 
	$hash_poöãr
(c⁄° *
p
, 
uöt32_t
 
ba£
)

302 i‡((
p
Ë% (
uöt32_t
) == 0) {

305 
uöt32_t
 
a
[(
p
) / (uint32_t)];

306 c⁄° *
p
;

307 } 
u
;

308 
u
.
p
 =Ö;

309  
	`hash_u32
(
u
.
a
, (
p
Ë/ (
uöt32_t
), 
ba£
);

311  
	`hash
(&
p
, 1, 
ba£
);

312 
	}
}

	@ccan/ccan/hash/test/api-hash_stable.c

1 
	~<cˇn/hash/hash.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dboﬁ.h
>

4 
	~<°rög.h
>

6 
	#ARRAY_WORDS
 5

	)

8 
	$maö
(
¨gc
, *
¨gv
[])

10 
i
;

11 
uöt8_t
 
u8¨øy
[
ARRAY_WORDS
];

12 
uöt16_t
 
u16¨øy
[
ARRAY_WORDS
];

13 
uöt32_t
 
u32¨øy
[
ARRAY_WORDS
];

14 
uöt64_t
 
u64¨øy
[
ARRAY_WORDS
];

17 
i
 = 0; i < 
ARRAY_WORDS
; i++) {

18 
u8¨øy
[
i
] = i;

19 
u16¨øy
[
i
] = i;

20 
u32¨øy
[
i
] = i;

21 
u64¨øy
[
i
] = i;

24 
	`∂™_ã°s
(264);

27 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 0) == 0x1d4833cc);

28 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1) == 0x37125e2 );

29 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2) == 0x330a007a);

30 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 4) == 0x7b0df29b);

31 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 8) == 0xe7e5d741);

32 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 16) == 0xaae57471);

33 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 32) == 0xc55399e5);

34 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 64) == 0x67f21f7 );

35 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 128) == 0x1d795b71);

36 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 256) == 0xeb961671);

37 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 512) == 0xc2597247);

38 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1024) == 0x3f5c4d75);

39 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2048) == 0xe65cf4f9);

40 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 4096) == 0xf2cd06cb);

41 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 8192) == 0x443041e1);

42 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 16384) == 0xdfc618f5);

43 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 32768) == 0x5e3d5b97);

44 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 65536) == 0xd5f64730);

45 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 131072) == 0x372bbecc);

46 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 262144) == 0x7c194c8d);

47 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 524288) == 0x16cbb416);

48 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1048576) == 0x53e99222);

49 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2097152) == 0x6394554a);

50 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 4194304) == 0xd83a506d);

51 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 8388608) == 0x7619d9a4);

52 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 16777216) == 0xfe98e5f6);

53 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 33554432) == 0x6c262927);

54 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 67108864) == 0x3f0106fd);

55 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 134217728) == 0xc91e3a28);

56 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 268435456) == 0x14229579);

57 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 536870912) == 0x9dbefa76);

58 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1073741824) == 0xb05c0c78);

59 
	`ok1
(
	`hash_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2147483648U) == 0x88f24d81);

61 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 0) == 0xecb5f507);

62 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1) == 0xadd666e6);

63 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2) == 0xea0f214c);

64 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 4) == 0xae4051ba);

65 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 8) == 0x6ed28026);

66 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 16) == 0xa3917a19);

67 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 32) == 0xf370f32b);

68 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 64) == 0x807af460);

69 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 128) == 0xb4c8cd83);

70 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 256) == 0xa10cb5b0);

71 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 512) == 0x8b7d7387);

72 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1024) == 0x9e49d1c );

73 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2048) == 0x288830d1);

74 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 4096) == 0xbe078a43);

75 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 8192) == 0xa16d5d88);

76 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 16384) == 0x46839fcd);

77 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 32768) == 0x9db9bd4f);

78 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 65536) == 0xedff58f8);

79 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 131072) == 0x95ecef18);

80 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 262144) == 0x23c31b7d);

81 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 524288) == 0x1d85c7d0);

82 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1048576) == 0x25218842);

83 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2097152) == 0x711d985c);

84 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 4194304) == 0x85470eca);

85 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 8388608) == 0x99ed4ceb);

86 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 16777216) == 0x67b3710c);

87 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 33554432) == 0x77f1ab35);

88 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 67108864) == 0x81f688aa);

89 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 134217728) == 0x27b56ca5);

90 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 268435456) == 0xf21ba203);

91 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 536870912) == 0xd48d1d1 );

92 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1073741824) == 0xa542b62d);

93 
	`ok1
(
	`hash_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2147483648U) == 0xa04c7058);

95 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 0) == 0x13305f8c);

96 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1) == 0x171abf74);

97 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2) == 0x7646fcc7);

98 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 4) == 0xa758ed5);

99 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 8) == 0x2dedc2e4);

100 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 16) == 0x28e2076b);

101 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 32) == 0xb73091c5);

102 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 64) == 0x87daf5db);

103 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 128) == 0xa16dfe20);

104 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 256) == 0x300c63c3);

105 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 512) == 0x255c91fc);

106 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1024) == 0x6357b26);

107 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2048) == 0x4bc5f339);

108 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 4096) == 0x1301617c);

109 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 8192) == 0x506792c9);

110 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 16384) == 0xcd596705);

111 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 32768) == 0xa8713cac);

112 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 65536) == 0x94d9794);

113 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 131072) == 0xac753e8);

114 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 262144) == 0xcd8bdd20);

115 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 524288) == 0xd44faf80);

116 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1048576) == 0x2547ccbe);

117 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2097152) == 0xbab06dbc);

118 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 4194304) == 0xaac0e882);

119 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 8388608) == 0x443f48d0);

120 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 16777216) == 0xdff49fcc);

121 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 33554432) == 0x9ce0fd65);

122 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 67108864) == 0x9ddb1def);

123 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 134217728) == 0x86096f25);

124 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 268435456) == 0xe713b7b5);

125 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 536870912) == 0x5baeffc5);

126 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1073741824) == 0xde874f52);

127 
	`ok1
(
	`hash_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2147483648U) == 0xeca13b4e);

129 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 0) == 0x12ef6302);

130 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1) == 0xe9aeb406);

131 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2) == 0xc4218ceb);

132 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 4) == 0xb3d11412);

133 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 8) == 0xdafbd654);

134 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 16) == 0x9c336cba);

135 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 32) == 0x65059721);

136 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 64) == 0x95b5bbe6);

137 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 128) == 0xe7596b84);

138 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 256) == 0x503622a2);

139 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 512) == 0xecdcc5ca);

140 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1024) == 0xc40d0513);

141 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2048) == 0xaab25e4d);

142 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 4096) == 0xcc353fb9);

143 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 8192) == 0x18e2319f);

144 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 16384) == 0xfddaae8d);

145 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 32768) == 0xef7976f2);

146 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 65536) == 0x86359fc9);

147 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 131072) == 0x8b5af385);

148 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 262144) == 0x80d4ee31);

149 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 524288) == 0x42f5f85b);

150 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1048576) == 0x9a6920e1);

151 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2097152) == 0x7b7c9850);

152 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 4194304) == 0x69573e09);

153 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 8388608) == 0xc942bc0e);

154 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 16777216) == 0x7a89f0f1);

155 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 33554432) == 0x2dd641ca);

156 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 67108864) == 0x89bbd391);

157 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 134217728) == 0xbcf88e31);

158 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 268435456) == 0xfa7a3460);

159 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 536870912) == 0x49a37be0);

160 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1073741824) == 0x1b346394);

161 
	`ok1
(
	`hash_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2147483648U) == 0x6c3a1592);

163 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 0) == 16887282882572727244ULL);

164 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1) == 12032777473133454818ULL);

165 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2) == 18183407363221487738ULL);

166 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 4) == 17860764172704150171ULL);

167 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 8) == 18076051600675559233ULL);

168 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 16) == 9909361918431556721ULL);

169 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 32) == 12937969888744675813ULL);

170 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 64) == 5245669057381736951ULL);

171 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 128) == 4376874646406519665ULL);

172 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 256) == 14219974419871569521ULL);

173 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 512) == 2263415354134458951ULL);

174 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1024) == 4953859694526221685ULL);

175 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2048) == 3432228642067641593ULL);

176 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 4096) == 1219647244417697483ULL);

177 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 8192) == 7629939424585859553ULL);

178 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 16384) == 10041660531376789749ULL);

179 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 32768) == 13859885793922603927ULL);

180 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 65536) == 15069060338344675120ULL);

181 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 131072) == 818163430835601100ULL);

182 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 262144) == 14914314323019517069ULL);

183 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 524288) == 17518437749769352214ULL);

184 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1048576) == 14920048004901212706ULL);

185 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2097152) == 8758567366332536138ULL);

186 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 4194304) == 6226655736088907885ULL);

187 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 8388608) == 13716650013685832100ULL);

188 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 16777216) == 305325651636315638ULL);

189 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 33554432) == 16784147606583781671ULL);

190 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 67108864) == 16509467555140798205ULL);

191 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 134217728) == 8717281234694060584ULL);

192 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 268435456) == 8098476701725660537ULL);

193 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 536870912) == 16345871539461094006ULL);

194 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 1073741824) == 3755557000429964408ULL);

195 
	`ok1
(
	`hash64_°abÀ
(
u8¨øy
, 
ARRAY_WORDS
, 2147483648U) == 15017348801959710081ULL);

197 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 0) == 1038028831307724039ULL);

198 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1) == 10155473272642627302ULL);

199 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2) == 5714751190106841420ULL);

200 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 4) == 3923885607767527866ULL);

201 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 8) == 3931017318293995558ULL);

202 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 16) == 1469696588339313177ULL);

203 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 32) == 11522218526952715051ULL);

204 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 64) == 6953517591561958496ULL);

205 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 128) == 7406689491740052867ULL);

206 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 256) == 10101844489704093104ULL);

207 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 512) == 12511348870707245959ULL);

208 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1024) == 1614019938016861468ULL);

209 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2048) == 5294796182374592721ULL);

210 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 4096) == 16089570706643716675ULL);

211 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 8192) == 1689302638424579464ULL);

212 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 16384) == 1446340172370386893ULL);

213 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 32768) == 16535503506744393039ULL);

214 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 65536) == 3496794142527150328ULL);

215 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 131072) == 6568245367474548504ULL);

216 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 262144) == 9487676460765485949ULL);

217 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 524288) == 4519762130966530000ULL);

218 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1048576) == 15623412069215340610ULL);

219 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2097152) == 544013388676438108ULL);

220 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 4194304) == 5594904760290840266ULL);

221 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 8388608) == 18098755780041592043ULL);

222 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 16777216) == 6389168672387330316ULL);

223 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 33554432) == 896986127732419381ULL);

224 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 67108864) == 13232626471143901354ULL);

225 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 134217728) == 53378562890493093ULL);

226 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 268435456) == 10072361400297824771ULL);

227 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 536870912) == 14511948118285144529ULL);

228 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 1073741824) == 6981033484844447277ULL);

229 
	`ok1
(
	`hash64_°abÀ
(
u16¨øy
, 
ARRAY_WORDS
, 2147483648U) == 5619339091684126808ULL);

231 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 0) == 3037571077312110476ULL);

232 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1) == 14732398743825071988ULL);

233 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2) == 14949132158206672071ULL);

234 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 4) == 1291370080511561429ULL);

235 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 8) == 10792665964172133092ULL);

236 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 16) == 14250138032054339435ULL);

237 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 32) == 17136741522078732741ULL);

238 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 64) == 3260193403318236635ULL);

239 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 128) == 10526616652205653536ULL);

240 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 256) == 9019690373358576579ULL);

241 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 512) == 6997491436599677436ULL);

242 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1024) == 18302783371416533798ULL);

243 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2048) == 10149320644446516025ULL);

244 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 4096) == 7073759949410623868ULL);

245 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 8192) == 17442399482223760073ULL);

246 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 16384) == 2983906194216281861ULL);

247 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 32768) == 4975845419129060524ULL);

248 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 65536) == 594019910205413268ULL);

249 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 131072) == 11903010186073691112ULL);

250 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 262144) == 7339636527154847008ULL);

251 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 524288) == 15243305400579108736ULL);

252 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1048576) == 16737926245392043198ULL);

253 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2097152) == 15725083267699862972ULL);

254 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 4194304) == 12527834265678833794ULL);

255 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 8388608) == 13908436455987824848ULL);

256 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 16777216) == 9672773345173872588ULL);

257 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 33554432) == 2305314279896710501ULL);

258 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 67108864) == 1866733780381408751ULL);

259 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 134217728) == 11906263969465724709ULL);

260 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 268435456) == 5501594918093830069ULL);

261 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 536870912) == 15823785789276225477ULL);

262 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 1073741824) == 17353000723889475410ULL);

263 
	`ok1
(
	`hash64_°abÀ
(
u32¨øy
, 
ARRAY_WORDS
, 2147483648U) == 7494736910655503182ULL);

265 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 0) == 9765419389786481410ULL);

266 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1) == 11182806172127114246ULL);

267 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2) == 2559155171395472619ULL);

268 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 4) == 3311692033324815378ULL);

269 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 8) == 1297175419505333844ULL);

270 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 16) == 617896928653569210ULL);

271 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 32) == 1517398559958603553ULL);

272 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 64) == 4504821917445110758ULL);

273 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 128) == 1971743331114904452ULL);

274 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 256) == 6177667912354374306ULL);

275 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 512) == 15570521289777792458ULL);

276 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1024) == 9204559632415917331ULL);

277 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2048) == 9008982669760028237ULL);

278 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 4096) == 14803537660281700281ULL);

279 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 8192) == 2873966517448487327ULL);

280 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 16384) == 5859277625928363661ULL);

281 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 32768) == 15520461285618185970ULL);

282 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 65536) == 16746489793331175369ULL);

283 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 131072) == 514952025484227461ULL);

284 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 262144) == 10867212269810675249ULL);

285 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 524288) == 9822204377278314587ULL);

286 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1048576) == 3295088921987850465ULL);

287 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2097152) == 7559197431498053712ULL);

288 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 4194304) == 1667267269116771849ULL);

289 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 8388608) == 2916804068951374862ULL);

290 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 16777216) == 14422558383125688561ULL);

291 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 33554432) == 10083112683694342602ULL);

292 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 67108864) == 7222777647078298513ULL);

293 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 134217728) == 18424513674048212529ULL);

294 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 268435456) == 14913668581101810784ULL);

295 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 536870912) == 14377721174297902048ULL);

296 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 1073741824) == 6031715005667500948ULL);

297 
	`ok1
(
	`hash64_°abÀ
(
u64¨øy
, 
ARRAY_WORDS
, 2147483648U) == 4827100319722378642ULL);

299  
	`exô_°©us
();

300 
	}
}

	@ccan/ccan/hash/test/run.c

1 
	~<cˇn/hash/hash.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/hash/hash.c
>

4 
	~<°dboﬁ.h
>

5 
	~<°rög.h
>

7 
	#ARRAY_WORDS
 5

	)

9 
	$maö
(
¨gc
, *
¨gv
[])

11 
i
, 
j
, 
k
;

12 
uöt32_t
 
¨øy
[
ARRAY_WORDS
], 
vÆ
;

13 
¨øy2
[(
¨øy
Ë+ (
uöt32_t
)];

14 
uöt32_t
 
ªsu…s
[256];

17 
i
 = 0; i < 
ARRAY_WORDS
; i++)

18 
¨øy
[
i
] = i;

20 
	`∂™_ã°s
(39);

22 
vÆ
 = 
	`hash
(
¨øy
, 
ARRAY_WORDS
, 0);

23 
i
 = 0; i < (
uöt32_t
); i++) {

24 
	`mem˝y
(
¨øy2
 + 
i
, 
¨øy
, (array));

25 
	`ok
(
	`hash
(
¨øy2
 + 
i
, 
ARRAY_WORDS
, 0Ë!
vÆ
,

26 "hash m©chedáàoff£à%i", 
i
);

31 
i
 = 0; i < (
uöt32_t
); i++) {

32 
lowe°
 = -1U, 
highe°
 = 0;

34 
	`mem£t
(
ªsu…s
, 0, (results));

36 
j
 = 0; j < 256000; j++) {

37 
k
 = 0; k < 
ARRAY_WORDS
; k++)

38 
¨øy
[
k
] = 
	`øndom
();

39 
ªsu…s
[(
	`hash
(
¨øy
, 
ARRAY_WORDS
, 0Ë>> 
i
*8)&0xFF]++;

42 
j
 = 0; j < 256; j++) {

43 i‡(
ªsu…s
[
j
] < 
lowe°
)

44 
lowe°
 = 
ªsu…s
[
j
];

45 i‡(
ªsu…s
[
j
] > 
highe°
)

46 
highe°
 = 
ªsu…s
[
j
];

49 
	`ok
(
lowe°
 > 800, "Byã %òlowe° %i", 
i
,Üowest);

50 
	`ok
(
highe°
 < 1200, "Byã %òhighe° %i", 
i
, highest);

51 
	`düg
("Byã %i,Ñ™gê%u-%u", 
i
, 
lowe°
, 
highe°
);

56 
i
 = 0; i < (
uöt64_t
); i++) {

57 
lowe°
 = -1U, 
highe°
 = 0;

59 
	`mem£t
(
ªsu…s
, 0, (results));

61 
j
 = 0; j < 256000; j++) {

62 
k
 = 0; k < 
ARRAY_WORDS
; k++)

63 
¨øy
[
k
] = 
	`øndom
();

64 
ªsu…s
[(
	`hash64
(
¨øy
, ◊ºay)/(
uöt64_t
),

65 0Ë>> 
i
*8)&0xFF]++;

68 
j
 = 0; j < 256; j++) {

69 i‡(
ªsu…s
[
j
] < 
lowe°
)

70 
lowe°
 = 
ªsu…s
[
j
];

71 i‡(
ªsu…s
[
j
] > 
highe°
)

72 
highe°
 = 
ªsu…s
[
j
];

75 
	`ok
(
lowe°
 > 800, "Byã %òlowe° %i", 
i
,Üowest);

76 
	`ok
(
highe°
 < 1200, "Byã %òhighe° %i", 
i
, highest);

77 
	`düg
("Byã %i,Ñ™gê%u-%u", 
i
, 
lowe°
, 
highe°
);

81 
i
 = 0; i < (
uöt32_t
); i++) {

82 
lowe°
 = -1U, 
highe°
 = 0;

83 *
p
 = 
	`mÆloc
(256000);

85 
	`mem£t
(
ªsu…s
, 0, (results));

87 
j
 = 0; j < 256000; j++)

88 
ªsu…s
[(
	`hash_poöãr
(
p
 + 
j
, 0Ë>> 
i
*8)&0xFF]++;

89 
	`‰ì
(
p
);

91 
j
 = 0; j < 256; j++) {

92 i‡(
ªsu…s
[
j
] < 
lowe°
)

93 
lowe°
 = 
ªsu…s
[
j
];

94 i‡(
ªsu…s
[
j
] > 
highe°
)

95 
highe°
 = 
ªsu…s
[
j
];

98 
	`ok
(
lowe°
 > 800, "hash_poöã∏byã %òlowe° %i", 
i
,Üowest);

99 
	`ok
(
highe°
 < 1200, "hash_pointer byte %i highest %i",

100 
i
, 
highe°
);

101 
	`düg
("hash_poöã∏byã %i,Ñ™gê%u-%u", 
i
, 
lowe°
, 
highe°
);

104 i‡((Ë=(
uöt32_t
))

105 
	`ok1
(
	`hashl
(
¨øy
, 
ARRAY_WORDS
, 0)

106 =
	`hash
(
¨øy
, 
ARRAY_WORDS
, 0));

108 
	`ok1
(
	`hashl
(
¨øy
, 
ARRAY_WORDS
, 0)

109 =
	`hash64
(
¨øy
, 
ARRAY_WORDS
, 0));

112 
i
 = 0; i < 1; i++) {

113 
num
 = 0, 
curs‹
, 
lowe°
 = -1U, 
highe°
 = 0;

114 
p
[5];

116 
	`mem£t
(
ªsu…s
, 0, (results));

118 
	`mem£t
(
p
, 'A', (p));

119 
p
[(p)-1] = '\0';

122 
curs‹
 = 0; curs‹ < (
p
)-1; cursor++) {

123 
p
[
curs‹
]++;

124 i‡(
p
[
curs‹
] <= 'z')

126 
p
[
curs‹
] = 'A';

128 i‡(
curs‹
 =(
p
)-1)

131 
ªsu…s
[(
	`hash_°rög
(
p
Ë>> 
i
*8)&0xFF]++;

132 
num
++;

135 
j
 = 0; j < 256; j++) {

136 i‡(
ªsu…s
[
j
] < 
lowe°
)

137 
lowe°
 = 
ªsu…s
[
j
];

138 i‡(
ªsu…s
[
j
] > 
highe°
)

139 
highe°
 = 
ªsu…s
[
j
];

142 
	`ok
(
lowe°
 > 35000, "hash_poöã∏byã %òlowe° %i", 
i
,Üowest);

143 
	`ok
(
highe°
 < 53000, "hash_pointer byte %i highest %i",

144 
i
, 
highe°
);

145 
	`düg
("hash_poöã∏byã %i,Ñ™gê%u-%u", 
i
, 
lowe°
, 
highe°
);

148  
	`exô_°©us
();

149 
	}
}

	@ccan/ccan/heap/heap.c

2 
	~<cˇn/hóp/hóp.h
>

11 
	#HEAP_MEM_HYSTERESIS
 4096

	)

13 
ölöe
 
	$sw≠
(
hóp
 *
h
, 
size_t
 
i
, size_à
j
)

15 *
foo
 = 
h
->
d©a
[
i
];

17 
h
->
d©a
[
i
] = h->d©a[
j
];

18 
h
->
d©a
[
j
] = 
foo
;

19 
	}
}

21 
	$__up
(
hóp
 *
h
, 
size_t
 
j
)

23 
size_t
 
i
;

25 
j
) {

26 
i
 = (
j
 - 1) / 2;

28 i‡(
h
->
	`Àss
(h->
d©a
[
j
], h->d©a[
i
])) {

29 
	`sw≠
(
h
, 
i
, 
j
);

30 
j
 = 
i
;

35 
	}
}

37 
	$hóp_push
(
hóp
 *
h
, *
d©a
)

39 i‡(
h
->
Àn
 =h->
ˇp
) {

40 *
m
 = 
	`ªÆloc
(
h
->
d©a
, (h->
ˇp
 + 1) * (*));

41 i‡(
m
 =
NULL
)

43 
h
->
d©a
 = 
m
;

44 
h
->
ˇp
++;

46 
h
->
d©a
[h->
Àn
++] = data;

47 
	`__up
(
h
, h->
Àn
 - 1);

49 
	}
}

51 
	$__down
(
hóp
 *
h
, 
size_t
 
i
)

53 
size_t
 
l
, 
r
, 
j
;

56 
l
 = 2 * 
i
 + 1;

57 i‡(
l
 >
h
->
Àn
)

59 
r
 = 
l
 + 1;

60 i‡(
r
 >
h
->
Àn
)

61 
j
 = 
l
;

63 
j
 = 
h
->
	`Àss
(h->
d©a
[
l
], h->d©a[
r
]) ?Ü :Ñ;

65 i‡(
h
->
	`Àss
(h->
d©a
[
j
], h->d©a[
i
])) {

66 
	`sw≠
(
h
, 
i
, 
j
);

67 
i
 = 
j
;

72 
	}
}

74 *
	$hóp_p›
(
hóp
 *
h
)

76 *
ªt
 = 
h
->
d©a
[0];

77 *
m
;

79 
	`sw≠
(
h
, 0, --h->
Àn
);

80 i‡(
h
->
Àn
) {

81 
	`__down
(
h
, 0);

82 i‡(
h
->
Àn
 =h->
ˇp
 - 
HEAP_MEM_HYSTERESIS
) {

83 
m
 = 
	`ªÆloc
(
h
->
d©a
, h->
Àn
 * (*));

84 i‡(
m
 =
NULL
)

85  
NULL
;

86 
h
->
d©a
 = 
m
;

87 
h
->
ˇp
 = h->
Àn
;

91  
ªt
;

92 
	}
}

94 
hóp
 *
	$hóp_öô
(
hóp_Àss_func_t
 
Àss
)

96 
hóp
 *hó∞
	`ˇŒoc
(1, (*heap));

98 i‡(
hóp
 =
NULL
)

99  
NULL
;

100 
hóp
->
Àss
 =Üess;

101  
hóp
;

102 
	}
}

104 
	$hóp_ify
(
hóp
 *
h
, 
hóp_Àss_func_t
 
Àss
)

106 
i
;

108 i‡(
Àss
)

109 
h
->
Àss
 =Üess;

111 
i
 = 
h
->
Àn
 / 2 - 1; i >= 0; i--)

112 
	`__down
(
h
, 
i
);

113 
	}
}

115 
	$hóp_‰ì
(
hóp
 *heap)

117 
	`‰ì
(
hóp
->
d©a
);

118 
	`‰ì
(
hóp
);

119 
	}
}

	@ccan/ccan/heap/heap.h

2 #i‚de‡
CCAN_HEAP_H


3 
	#CCAN_HEAP_H


	)

5 
	~<°dboﬁ.h
>

6 
	~<°dlib.h
>

8 
	$boﬁ
 (*
	thóp_Àss_func_t
)(const *, const *);

24 
	shóp
 {

25 **
d©a
;

26 
hóp_Àss_func_t
 
Àss
;

27 
size_t
 
ˇp
;

28 
size_t
 
Àn
;

40 
hóp
 *
	`hóp_öô
(
hóp_Àss_func_t
 
Àss
);

50 
	#HEAP_INIT
(
func
Ë{ 
NULL
, func, 0, 0 
	}

	)
}

61 
hóp_‰ì
(
hóp
 *heap);

70 
hóp_ify
(
hóp
 *
h
, 
hóp_Àss_func_t
 
Àss
);

83 
hóp_push
(
hóp
 *
h
, *
d©a
);

98 *
hóp_p›
(
hóp
 *
h
);

117 
ölöe
 *
	$hóp_≥ek
(c⁄° 
hóp
 *
h
)

119  
h
->
d©a
[0];

120 
	}
}

	@ccan/ccan/heap/test/run.c

1 
	~<°dlib.h
>

2 
	~<°dio.h
>

4 
	~<cˇn/hóp/hóp.h
>

6 
	~<cˇn/hóp/hóp.c
>

7 
	~<cˇn/èp/èp.h
>

9 
	sôem
 {

10 *
	mfoob¨
;

11 
	mv
;

14 
boﬁ
 
	$hóp_ok
(c⁄° 
hóp
 *
h
, 
hóp_Àss_func_t
 
Àss
, 
i
)

16 
l
, 
r
;

18 
l
 = 2 * 
i
 + 1;

19 
r
 = 
l
 + 1;

21 i‡(
l
 < 
h
->
Àn
) {

22 i‡(
	`Àss
(
h
->
d©a
[
l
], h->d©a[
i
])) {

23 
	`Ârötf
(
°dîr
, "heapÖroperty violation\n");

24  
Ál£
;

26 i‡(!
	`hóp_ok
(
h
, 
Àss
, 
l
))

27  
Ál£
;

29 i‡(
r
 < 
h
->
Àn
) {

30 i‡(
	`Àss
(
h
->
d©a
[
r
], h->d©a[
i
])) {

31 
	`Ârötf
(
°dîr
, "heapÖroperty violation\n");

32  
Ál£
;

34 i‡(!
	`hóp_ok
(
h
, 
Àss
, 
r
))

35  
Ál£
;

37  
åue
;

38 
	}
}

40 
boﬁ
 
	$Àss
(c⁄° 
ôem
 *
a
, c⁄° ôem *
b
)

42  
a
->
v
 < 
b
->v;

43 
	}
}

45 
boﬁ
 
	$__Àss
(c⁄° *
a
, c⁄° *
b
)

47  
	`Àss
(
a
, 
b
);

48 
	}
}

50 
boﬁ
 
	$m‹e
(c⁄° 
ôem
 *
a
, c⁄° ôem *
b
)

52  
a
->
v
 > 
b
->v;

53 
	}
}

55 
boﬁ
 
	$__m‹e
(c⁄° *
a
, c⁄° *
b
)

57  
	`m‹e
(
a
, 
b
);

58 
	}
}

60 
boﬁ
 
	$some_ã°
(
size_t
 
n
, 
boﬁ
 
is_Àss
)

62 
ôem
 *
ôems
 = 
	`ˇŒoc
(
n
, (*items));

63 
ôem
 *ôem, *
¥ev
;

64 
hóp
 *
h
;

65 
i
;

67 i‡(
ôems
 =
NULL
) {

68 
	`≥º‹
("items");

69 
	`exô
(
EXIT_FAILURE
);

72 i‡(
is_Àss
)

73 
h
 = 
	`hóp_öô
(
__Àss
);

75 
h
 = 
	`hóp_öô
(
__m‹e
);

76 i‡(
h
 =
NULL
) {

77 
	`≥º‹
("heap_init");

78 
	`exô
(
EXIT_FAILURE
);

81 
i
 = 0; i < 
n
; i++) {

82 
ôem
 = &
ôems
[
i
];

84 
ôem
->
v
 = 
	`ønd
();

85 
	`¥ötf
("pushög %d\n", 
ôem
->
v
);

86 
	`hóp_push
(
h
, 
ôem
);

87 i‡(!
	`hóp_ok
(
h
, 
is_Àss
 ? 
__Àss
 : 
__m‹e
, 0))

88  
Ál£
;

90 i‡(
is_Àss
) {

91 
	`hóp_ify
(
h
, 
__m‹e
);

92 i‡(!
	`hóp_ok
(
h
, 
__m‹e
, 0))

93  
Ál£
;

94 
	`hóp_ify
(
h
, 
__Àss
);

95 i‡(!
	`hóp_ok
(
h
, 
__Àss
, 0))

96  
Ál£
;

98 
	`hóp_ify
(
h
, 
NULL
);

99 i‡(!
	`hóp_ok
(
h
, 
__m‹e
, 0))

100  
Ál£
;

103 
i
 = 0; i < 
n
; i++) {

104 
ôem
 = 
	`hóp_p›
(
h
);

105 i‡(!
	`hóp_ok
(
h
, 
is_Àss
 ? 
__Àss
 : 
__m‹e
, 0))

106  
Ál£
;

107 
	`¥ötf
("p›≥d %d\n", 
ôem
->
v
);

108 i‡(
i
 > 0) {

109 i‡(
is_Àss
) {

110 i‡(
	`Àss
(
ôem
, 
¥ev
))

111  
Ál£
;

113 i‡(
	`m‹e
(
ôem
, 
¥ev
))

114  
Ál£
;

117 
¥ev
 = 
ôem
;

119 
	`hóp_‰ì
(
h
);

120 
	`‰ì
(
ôems
);

121  
åue
;

122 
	}
}

124 
	$maö
()

126 
	`∂™_ã°s
(3);

128 
	`ok1
(
	`some_ã°
(5000, 
åue
));

129 
	`ok1
(
	`some_ã°
(1, 
åue
));

130 
	`ok1
(
	`some_ã°
(33, 
Ál£
));

132  
	`exô_°©us
();

133 
	}
}

	@ccan/ccan/htable/htable.c

2 
	~<cˇn/hèbÀ/hèbÀ.h
>

3 
	~<cˇn/compûî/compûî.h
>

4 
	~<°dlib.h
>

5 
	~<limôs.h
>

6 
	~<°dboﬁ.h
>

7 
	~<as£π.h
>

10 
	#HTABLE_DELETED
 (0x1)

	)

13 
ölöe
 
uöçå_t
 
	$gë_exåa_±r_bôs
(c⁄° 
hèbÀ
 *
ht
,

14 
uöçå_t
 
e
)

16  
e
 & 
ht
->
comm⁄_mask
;

17 
	}
}

19 
ölöe
 *
	$gë_øw_±r
(c⁄° 
hèbÀ
 *
ht
, 
uöçå_t
 
e
)

21  (*)((
e
 & ~
ht
->
comm⁄_mask
Ë| ht->
comm⁄_bôs
);

22 
	}
}

24 
ölöe
 
uöçå_t
 
	$make_hvÆ
(c⁄° 
hèbÀ
 *
ht
,

25 c⁄° *
p
, 
uöçå_t
 
bôs
)

27  ((
uöçå_t
)
p
 & ~
ht
->
comm⁄_mask
Ë| 
bôs
;

28 
	}
}

30 
ölöe
 
boﬁ
 
	$íåy_is_vÆid
(
uöçå_t
 
e
)

32  
e
 > 
HTABLE_DELETED
;

33 
	}
}

35 
ölöe
 
uöçå_t
 
	$gë_hash_±r_bôs
(c⁄° 
hèbÀ
 *
ht
,

36 
size_t
 
hash
)

41  (
hash
 ^ (hash >> 
ht
->
bôs
))

42 & 
ht
->
comm⁄_mask
 & ~ht->
≥r„˘_bô
;

43 
	}
}

45 
hèbÀ_öô
(
hèbÀ
 *
ht
,

46 
	$size_t
 (*
ªhash
)(c⁄° *
ñem
, *
¥iv
), *priv)

48 
hèbÀ
 
em±y
 = 
	`HTABLE_INITIALIZER
”m±y, 
NULL
, NULL);

49 *
ht
 = 
em±y
;

50 
ht
->
ªhash
 =Ñehash;

51 
ht
->
¥iv
 =Öriv;

52 
ht
->
èbÀ
 = &ht->
≥r„˘_bô
;

53 
	}
}

55 
	$hèbÀ_˛ór
(
hèbÀ
 *
ht
)

57 i‡(
ht
->
èbÀ
 !&ht->
≥r„˘_bô
)

58 
	`‰ì
((*)
ht
->
èbÀ
);

59 
	`hèbÀ_öô
(
ht
, ht->
ªhash
, ht->
¥iv
);

60 
	}
}

62 
size_t
 
	$hash_buckë
(c⁄° 
hèbÀ
 *
ht
, 
size_t
 
h
)

64  
h
 & ((1 << 
ht
->
bôs
)-1);

65 
	}
}

67 *
	$hèbÀ_vÆ
(c⁄° 
hèbÀ
 *
ht
,

68 
hèbÀ_ôî
 *
i
, 
size_t
 
hash
, 
uöçå_t
 
≥r„˘
)

70 
uöçå_t
 
h2
 = 
	`gë_hash_±r_bôs
(
ht
, 
hash
Ë| 
≥r„˘
;

72 
ht
->
èbÀ
[
i
->
off
]) {

73 i‡(
ht
->
èbÀ
[
i
->
off
] !
HTABLE_DELETED
) {

74 i‡(
	`gë_exåa_±r_bôs
(
ht
, ht->
èbÀ
[
i
->
off
]Ë=
h2
)

75  
	`gë_øw_±r
(
ht
, ht->
èbÀ
[
i
->
off
]);

77 
i
->
off
 = (i->of‡+ 1Ë& ((1 << 
ht
->
bôs
)-1);

78 
h2
 &~
≥r„˘
;

80  
NULL
;

81 
	}
}

83 *
	$hèbÀ_fú°vÆ
(c⁄° 
hèbÀ
 *
ht
,

84 
hèbÀ_ôî
 *
i
, 
size_t
 
hash
)

86 
i
->
off
 = 
	`hash_buckë
(
ht
, 
hash
);

87  
	`hèbÀ_vÆ
(
ht
, 
i
, 
hash
, ht->
≥r„˘_bô
);

88 
	}
}

90 *
	$hèbÀ_√xtvÆ
(c⁄° 
hèbÀ
 *
ht
,

91 
hèbÀ_ôî
 *
i
, 
size_t
 
hash
)

93 
i
->
off
 = (i->of‡+ 1Ë& ((1 << 
ht
->
bôs
)-1);

94  
	`hèbÀ_vÆ
(
ht
, 
i
, 
hash
, 0);

95 
	}
}

97 *
	$hèbÀ_fú°
(c⁄° 
hèbÀ
 *
ht
, 
hèbÀ_ôî
 *
i
)

99 
i
->
off
 = 0; i->of‡< (
size_t
)1 << 
ht
->
bôs
; i->off++) {

100 i‡(
	`íåy_is_vÆid
(
ht
->
èbÀ
[
i
->
off
]))

101  
	`gë_øw_±r
(
ht
, ht->
èbÀ
[
i
->
off
]);

103  
NULL
;

104 
	}
}

106 *
	$hèbÀ_√xt
(c⁄° 
hèbÀ
 *
ht
, 
hèbÀ_ôî
 *
i
)

108 
i
->
off
++; i->of‡< (
size_t
)1 << 
ht
->
bôs
; i->off++) {

109 i‡(
	`íåy_is_vÆid
(
ht
->
èbÀ
[
i
->
off
]))

110  
	`gë_øw_±r
(
ht
, ht->
èbÀ
[
i
->
off
]);

112  
NULL
;

113 
	}
}

116 
	$ht_add
(
hèbÀ
 *
ht
, c⁄° *
√w
, 
size_t
 
h
)

118 
size_t
 
i
;

119 
uöçå_t
 
≥r„˘
 = 
ht
->
≥r„˘_bô
;

121 
i
 = 
	`hash_buckë
(
ht
, 
h
);

123 
	`íåy_is_vÆid
(
ht
->
èbÀ
[
i
])) {

124 
≥r„˘
 = 0;

125 
i
 = (ò+ 1Ë& ((1 << 
ht
->
bôs
)-1);

127 
ht
->
èbÀ
[
i
] = 
	`make_hvÆ
(ht, 
√w
, 
	`gë_hash_±r_bôs
(ht, 
h
)|
≥r„˘
);

128 
	}
}

130 
COLD
 
boﬁ
 
	$doubÀ_èbÀ
(
hèbÀ
 *
ht
)

132 
i
;

133 
size_t
 
ﬁdnum
 = (size_t)1 << 
ht
->
bôs
;

134 
uöçå_t
 *
ﬁdèbÀ
, 
e
;

136 
ﬁdèbÀ
 = 
ht
->
èbÀ
;

137 
ht
->
èbÀ
 = 
	`ˇŒoc
(1 << (ht->
bôs
+1), (
size_t
));

138 i‡(!
ht
->
èbÀ
) {

139 
ht
->
èbÀ
 = 
ﬁdèbÀ
;

140  
Ál£
;

142 
ht
->
bôs
++;

143 
ht
->
max
 = ((
size_t
)3 << ht->
bôs
) / 4;

144 
ht
->
max_wôh_dñëed
 = ((
size_t
)9 << ht->
bôs
) / 10;

147 i‡(!
ht
->
≥r„˘_bô
 && ht->
comm⁄_mask
) {

148 
i
 = 0; i < (
ht
->
comm⁄_mask
Ë* 
CHAR_BIT
; i++) {

149 i‡(
ht
->
comm⁄_mask
 & ((
size_t
)1 << 
i
)) {

150 
ht
->
≥r„˘_bô
 = (
size_t
)1 << 
i
;

156 i‡(
ﬁdèbÀ
 !&
ht
->
≥r„˘_bô
) {

157 
i
 = 0; i < 
ﬁdnum
; i++) {

158 i‡(
	`íåy_is_vÆid
(
e
 = 
ﬁdèbÀ
[
i
])) {

159 *
p
 = 
	`gë_øw_±r
(
ht
, 
e
);

160 
	`ht_add
(
ht
, 
p
, ht->
	`ªhash
’, ht->
¥iv
));

163 
	`‰ì
(
ﬁdèbÀ
);

165 
ht
->
dñëed
 = 0;

166  
åue
;

167 
	}
}

169 
COLD
 
	$ªhash_èbÀ
(
hèbÀ
 *
ht
)

171 
size_t
 
°¨t
, 
i
;

172 
uöçå_t
 
e
;

175 
°¨t
 = 0; 
ht
->
èbÀ
[start]; start++);

177 
i
 = 0; i < (
size_t
)1 << 
ht
->
bôs
; i++) {

178 
size_t
 
h
 = (
i
 + 
°¨t
Ë& ((1 << 
ht
->
bôs
)-1);

179 
e
 = 
ht
->
èbÀ
[
h
];

180 i‡(!
e
)

182 i‡(
e
 =
HTABLE_DELETED
)

183 
ht
->
èbÀ
[
h
] = 0;

184 i‡(!(
e
 & 
ht
->
≥r„˘_bô
)) {

185 *
p
 = 
	`gë_øw_±r
(
ht
, 
e
);

186 
ht
->
èbÀ
[
h
] = 0;

187 
	`ht_add
(
ht
, 
p
, ht->
	`ªhash
’, ht->
¥iv
));

190 
ht
->
dñëed
 = 0;

191 
	}
}

194 
COLD
 
	$upd©e_comm⁄
(
hèbÀ
 *
ht
, c⁄° *
p
)

196 
i
;

197 
uöçå_t
 
maskdiff
, 
bôsdiff
;

199 i‡(
ht
->
ñems
 == 0) {

204 
i
 = (
uöçå_t
)*
CHAR_BIT
 - 1; i > 0; i--) {

205 i‡((
uöçå_t
)
p
 & ((uöçå_t)1 << 
i
))

209 
ht
->
comm⁄_mask
 = ~((
uöçå_t
)1 << 
i
);

210 
ht
->
comm⁄_bôs
 = ((
uöçå_t
)
p
 & ht->
comm⁄_mask
);

211 
ht
->
≥r„˘_bô
 = 1;

216 
maskdiff
 = 
ht
->
comm⁄_bôs
 ^ ((
uöçå_t
)
p
 & ht->
comm⁄_mask
);

219 
bôsdiff
 = 
ht
->
comm⁄_bôs
 & 
maskdiff
;

221 
i
 = 0; i < (
size_t
)1 << 
ht
->
bôs
; i++) {

222 i‡(!
	`íåy_is_vÆid
(
ht
->
èbÀ
[
i
]))

226 
ht
->
èbÀ
[
i
] &~
maskdiff
;

227 
ht
->
èbÀ
[
i
] |
bôsdiff
;

231 
ht
->
comm⁄_mask
 &~
maskdiff
;

232 
ht
->
comm⁄_bôs
 &~
maskdiff
;

233 
ht
->
≥r„˘_bô
 &~
maskdiff
;

234 
	}
}

236 
boﬁ
 
	$hèbÀ_add
(
hèbÀ
 *
ht
, 
size_t
 
hash
, c⁄° *
p
)

238 i‡(
ht
->
ñems
+1 > ht->
max
 && !
	`doubÀ_èbÀ
(ht))

239  
Ál£
;

240 i‡(
ht
->
ñems
+1 + ht->
dñëed
 > ht->
max_wôh_dñëed
)

241 
	`ªhash_èbÀ
(
ht
);

242 
	`as£π
(
p
);

243 i‡(((
uöçå_t
)
p
 & 
ht
->
comm⁄_mask
Ë!ht->
comm⁄_bôs
)

244 
	`upd©e_comm⁄
(
ht
, 
p
);

246 
	`ht_add
(
ht
, 
p
, 
hash
);

247 
ht
->
ñems
++;

248  
åue
;

249 
	}
}

251 
boﬁ
 
	$hèbÀ_dñ
(
hèbÀ
 *
ht
, 
size_t
 
h
, c⁄° *
p
)

253 
hèbÀ_ôî
 
i
;

254 *
c
;

256 
c
 = 
	`hèbÀ_fú°vÆ
(
ht
,&
i
,
h
); c; c = 
	`hèbÀ_√xtvÆ
(ht,&i,h)) {

257 i‡(
c
 =
p
) {

258 
	`hèbÀ_dñvÆ
(
ht
, &
i
);

259  
åue
;

262  
Ál£
;

263 
	}
}

265 
	$hèbÀ_dñvÆ
(
hèbÀ
 *
ht
, 
hèbÀ_ôî
 *
i
)

267 
	`as£π
(
i
->
off
 < (
size_t
)1 << 
ht
->
bôs
);

268 
	`as£π
(
	`íåy_is_vÆid
(
ht
->
èbÀ
[
i
->
off
]));

270 
ht
->
ñems
--;

271 
ht
->
èbÀ
[
i
->
off
] = 
HTABLE_DELETED
;

272 
ht
->
dñëed
++;

273 
	}
}

	@ccan/ccan/htable/htable.h

2 #i‚de‡
CCAN_HTABLE_H


3 
	#CCAN_HTABLE_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°döt.h
>

6 
	~<°dboﬁ.h
>

7 
	~<°dlib.h
>

15 
	shèbÀ
 {

16 
size_t
 (*
ªhash
)(c⁄° *
	mñem
, *
	m¥iv
);

17 *
	m¥iv
;

18 
	mbôs
;

19 
size_t
 
	mñems
, 
	mdñëed
, 
	mmax
, 
	mmax_wôh_dñëed
;

21 
uöçå_t
 
	mcomm⁄_mask
, 
	mcomm⁄_bôs
;

22 
uöçå_t
 
	m≥r„˘_bô
;

23 
uöçå_t
 *
	mèbÀ
;

42 
	#HTABLE_INITIALIZER
(
«me
, 
ªhash
, 
¥iv
) \

43 { 
ªhash
, 
¥iv
, 0, 0, 0, 0, 0, -1, 0, 0, &
«me
.
≥r„˘_bô
 }

	)

51 
hèbÀ_öô
(
hèbÀ
 *
ht
,

52 
	$size_t
 (*
ªhash
)(c⁄° *
ñem
, *
¥iv
), *priv);

60 
	`hèbÀ_˛ór
(
hèbÀ
 *
ht
);

67 
size_t
 
	`hèbÀ_ªhash
(c⁄° *
ñem
);

78 
boﬁ
 
	`hèbÀ_add
(
hèbÀ
 *
ht
, 
size_t
 
hash
, c⁄° *
p
);

88 
boﬁ
 
	`hèbÀ_dñ
(
hèbÀ
 *
ht
, 
size_t
 
hash
, c⁄° *
p
);

95 
	shèbÀ_ôî
 {

96 
size_t
 
off
;

109 *
	`hèbÀ_fú°vÆ
(c⁄° 
hèbÀ
 *htable,

110 
hèbÀ_ôî
 *
i
, 
size_t
 
hash
);

120 *
	`hèbÀ_√xtvÆ
(c⁄° 
hèbÀ
 *htable,

121 
hèbÀ_ôî
 *
i
, 
size_t
 
hash
);

132 
ölöe
 *
	`hèbÀ_gë
(c⁄° 
hèbÀ
 *
ht
,

133 
size_t
 
h
,

134 
	$boﬁ
 (*
cmp
)(c⁄° *
ˇndid©e
, *
±r
),

135 c⁄° *
±r
)

137 
hèbÀ_ôî
 
i
;

138 *
c
;

140 
c
 = 
	`hèbÀ_fú°vÆ
(
ht
,&
i
,
h
); c; c = 
	`hèbÀ_√xtvÆ
(ht,&i,h)) {

141 i‡(
	`cmp
(
c
, (*)
±r
))

142  
c
;

144  
NULL
;

145 
	}
}

154 *
hèbÀ_fú°
(c⁄° 
hèbÀ
 *hèbÀ, 
hèbÀ_ôî
 *
i
);

164 *
hèbÀ_√xt
(c⁄° 
hèbÀ
 *hèbÀ, 
hèbÀ_ôî
 *
i
);

174 
hèbÀ_dñvÆ
(
hèbÀ
 *
ht
, 
hèbÀ_ôî
 *
i
);

	@ccan/ccan/htable/htable_type.h

2 #i‚de‡
CCAN_HTABLE_TYPE_H


3 
	#CCAN_HTABLE_TYPE_H


	)

4 
	~<cˇn/hèbÀ/hèbÀ.h
>

5 
	~"c⁄fig.h
"

45 
	#HTABLE_DEFINE_TYPE
(
ty≥
, 
keyof
, 
hash‚
, 
eq‚
, 
«me
) \

46 
	s«me
 { 
hèbÀ
 
øw
; }; \

47 
«me
##
_ôî
 { 
hèbÀ_ôî
 
i
; }; \

48 
ölöe
 
size_t
 
«me
##
	`_hash
(c⁄° *
ñem
, *
¥iv
) \

50  
	`hash‚
(
	`keyof
((c⁄° 
ty≥
 *)
ñem
)); \

52 
ölöe
 
«me
##
	`_öô
(«mê*
ht
) \

54 
	`hèbÀ_öô
(&
ht
->
øw
, 
«me
##
_hash
, 
NULL
); \

56 
ölöe
 
«me
##
	`_˛ór
(«mê*
ht
) \

58 
	`hèbÀ_˛ór
(&
ht
->
øw
); \

60 
ölöe
 
boﬁ
 
«me
##
	`_add
(«mê*
ht
, c⁄° 
ty≥
 *
ñem
) \

62  
	`hèbÀ_add
(&
ht
->
øw
, 
	`hash‚
(
	`keyof
(
ñem
)),Élem); \

64 
ölöe
 
boﬁ
 
«me
##
	`_dñ
(«mê*
ht
, c⁄° 
ty≥
 *
ñem
) \

66  
	`hèbÀ_dñ
(&
ht
->
øw
, 
	`hash‚
(
	`keyof
(
ñem
)),Élem); \

68 
ölöe
 
ty≥
 *
«me
##
	`_gë
(c⁄° «mê*
ht
, \

69 c⁄° 
	`HTABLE_KTYPE
(
keyof
Ë
k
) \

72 ()(
	`eq‚
((c⁄° 
ty≥
 *)
NULL
, \

73 
	`keyof
((c⁄° 
ty≥
 *)
NULL
))); \

74  
	`hèbÀ_gë
(&
ht
->
øw
, \

75 
	`hash‚
(
k
), \

76 (
	`boﬁ
 (*)(c⁄° *, *))(
eq‚
), \

77 
k
); \

79 
ölöe
 
boﬁ
 
«me
##
	`_dñkey
(«mê*
ht
, \

80 c⁄° 
	`HTABLE_KTYPE
(
keyof
Ë
k
) \

82 
ty≥
 *
ñem
 = 
«me
##
	`_gë
(
ht
, 
k
); \

83 i‡(
ñem
) \

84  
«me
##
	`_dñ
(
ht
, 
ñem
); \

85  
Ál£
; \

87 
ölöe
 
ty≥
 *
«me
##
	`_fú°
(c⁄° «mê*
ht
, \

88 
«me
##
_ôî
 *
ôî
) \

90  
	`hèbÀ_fú°
(&
ht
->
øw
, &
ôî
->
i
); \

92 
ölöe
 
ty≥
 *
«me
##
	`_√xt
(c⁄° «mê*
ht
, \

93 
«me
##
_ôî
 *
ôî
) \

95  
	`hèbÀ_√xt
(&
ht
->
øw
, &
ôî
->
i
); \

96 }

	)

98 #i‡
HAVE_TYPEOF


99 
	#HTABLE_KTYPE
(
keyof
Ë
	`ty≥of
(
	`keyof
(
NULL
))

	)

101 
	#HTABLE_KTYPE
(
keyof
Ë*

	)

	@ccan/ccan/htable/test/run-size.c

1 
	~<cˇn/hèbÀ/hèbÀ.h
>

2 
	~<cˇn/hèbÀ/hèbÀ.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dboﬁ.h
>

5 
	~<°rög.h
>

7 
	#NUM_VALS
 512

	)

11 
size_t
 
	$hash
(c⁄° *
ñem
, *
unu£d
)

13 
size_t
 
h
 = *(
uöt64_t
 *)
ñem
 / 2;

14  
h
;

15 
	}
}

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
hèbÀ
 
ht
;

20 
uöt64_t
 
vÆ
[
NUM_VALS
];

21 
i
;

23 
	`∂™_ã°s
((
NUM_VALS
) * 2);

24 
i
 = 0; i < 
NUM_VALS
; i++)

25 
vÆ
[
i
] = i;

27 
	`hèbÀ_öô
(&
ht
, 
hash
, 
NULL
);

28 
i
 = 0; i < 
NUM_VALS
; i++) {

29 
	`ok1
(
ht
.
max
 >
i
);

30 
	`ok1
(
ht
.
max
 <
i
 * 2);

31 
	`hèbÀ_add
(&
ht
, 
	`hash
(&
vÆ
[
i
], 
NULL
), &val[i]);

33 
	`hèbÀ_˛ór
(&
ht
);

35  
	`exô_°©us
();

36 
	}
}

	@ccan/ccan/htable/test/run-type.c

1 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

2 
	~<cˇn/hèbÀ/hèbÀ.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dboﬁ.h
>

5 
	~<°rög.h
>

7 
	#NUM_BITS
 7

	)

8 
	#NUM_VALS
 (1 << 
NUM_BITS
)

	)

10 
	sobj
 {

12 
	munu£d
;

13 
	mkey
;

16 c⁄° *
	$objkey
(c⁄° 
obj
 *obj)

18  &
obj
->
key
;

19 
	}
}

24 
size_t
 
	$objhash
(c⁄° *
key
)

26 
size_t
 
h
 = *
key
 / 2;

27 
h
 |-1UL << 
NUM_BITS
;

28  
h
;

29 
	}
}

31 
boﬁ
 
	$cmp
(c⁄° 
obj
 *obj, c⁄° *
key
)

33  
obj
->
key
 == *key;

34 
	}
}

36 
HTABLE_DEFINE_TYPE
(
obj
, 
objkey
, 
objhash
, 
cmp
, 
hèbÀ_obj
);

38 
	$add_vÆs
(
hèbÀ_obj
 *
ht
,

39 
obj
 
vÆ
[], 
num
)

41 
i
;

43 
i
 = 0; i < 
num
; i++) {

44 i‡(
	`hèbÀ_obj_gë
(
ht
, &
i
)) {

45 
	`Áû
("%uáÃódy i¿hash", 
i
);

48 
	`hèbÀ_obj_add
(
ht
, &
vÆ
[
i
]);

49 i‡(
	`hèbÀ_obj_gë
(
ht
, &
i
Ë!&
vÆ
[i]) {

50 
	`Áû
("%uÇŸáddedÅÿhash", 
i
);

54 
	`∑ss
("Added %uÇumbî†tÿhash", 
i
);

55 
	}
}

57 
	$föd_vÆs
(c⁄° 
hèbÀ_obj
 *
ht
,

58 c⁄° 
obj
 
vÆ
[], 
num
)

60 
i
;

62 
i
 = 0; i < 
num
; i++) {

63 i‡(
	`hèbÀ_obj_gë
(
ht
, &
i
Ë!&
vÆ
[i]) {

64 
	`Áû
("%uÇŸ found i¿hash", 
i
);

68 
	`∑ss
("Found %uÇumbî†ö hash", 
i
);

69 
	}
}

71 
	$dñ_vÆs
(
hèbÀ_obj
 *
ht
,

72 c⁄° 
obj
 
vÆ
[], 
num
)

74 
i
;

76 
i
 = 0; i < 
num
; i++) {

77 i‡(!
	`hèbÀ_obj_dñkey
(
ht
, &
vÆ
[
i
].
key
)) {

78 
	`Áû
("%uÇŸ dñëed from hash", 
i
);

82 
	`∑ss
("Dñëed %uÇumbî†ö hash", 
i
);

83 
	}
}

85 
	$dñ_vÆs_bykey
(
hèbÀ_obj
 *
ht
,

86 c⁄° 
obj
 
vÆ
[], 
num
)

88 
i
;

90 
i
 = 0; i < 
num
; i++) {

91 i‡(!
	`hèbÀ_obj_dñkey
(
ht
, &
i
)) {

92 
	`Áû
("%uÇŸ dñëed by key from hash", 
i
);

96 
	`∑ss
("Dñëed %uÇumbî†by key from hash", 
i
);

97 
	}
}

99 
boﬁ
 
	$check_mask
(
hèbÀ
 *
ht
, c⁄° 
obj
 
vÆ
[], 
num
)

101 
uöt64_t
 
i
;

103 
i
 = 0; i < 
num
; i++) {

104 i‡(((
uöçå_t
)&
vÆ
[
i
] & 
ht
->
comm⁄_mask
Ë!ht->
comm⁄_bôs
)

105  
Ál£
;

107  
åue
;

108 
	}
}

110 
	$maö
(
¨gc
, *
¨gv
[])

112 
i
;

113 
hèbÀ_obj
 
ht
;

114 
obj
 
vÆ
[
NUM_VALS
];

115 
d√
;

116 *
p
;

117 
hèbÀ_obj_ôî
 
ôî
;

119 
	`∂™_ã°s
(20);

120 
i
 = 0; i < 
NUM_VALS
; i++)

121 
vÆ
[
i
].
key
 = i;

122 
d√
 = 
i
;

124 
	`hèbÀ_obj_öô
(&
ht
);

125 
	`ok1
(
ht
.
øw
.
max
 == 0);

126 
	`ok1
(
ht
.
øw
.
bôs
 == 0);

129 
	`ok1
(!
	`hèbÀ_obj_gë
(&
ht
, &
d√
));

132 
	`add_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

133 
	`ok1
(
ht
.
øw
.
bôs
 =
NUM_BITS
 + 1);

134 
	`ok1
(
ht
.
øw
.
max
 < (1 << ht.øw.
bôs
));

137 
	`ok1
(
ht
.
øw
.
comm⁄_mask
 != 0);

138 
	`ok1
(
ht
.
øw
.
comm⁄_mask
 != -1);

139 
	`ok1
(
	`check_mask
(&
ht
.
øw
, 
vÆ
, 
NUM_VALS
));

142 
	`föd_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

143 
	`ok1
(!
	`hèbÀ_obj_gë
(&
ht
, &
d√
));

146 
i
 = 0;

147 
p
 = 
	`hèbÀ_obj_fú°
(&
ht
,&
ôî
);Ö;Ö = 
	`hèbÀ_obj_√xt
(&ht, &iter))

148 
i
++;

149 
	`ok1
(
i
 =
NUM_VALS
);

152 
	`dñ_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

153 
	`ok1
(!
	`hèbÀ_obj_gë
(&
ht
, &
vÆ
[0].
key
));

156 
	`hèbÀ_add
(&
ht
.
øw
, 0, (*)~(
uöçå_t
)&
vÆ
[
NUM_VALS
-1]);

157 
	`hèbÀ_obj_add
(&
ht
, &
vÆ
[
NUM_VALS
-1]);

158 
	`ok1
(
ht
.
øw
.
comm⁄_mask
 == 0);

159 
	`ok1
(
ht
.
øw
.
comm⁄_bôs
 == 0);

161 
	`hèbÀ_dñ
(&
ht
.
øw
, 0, (*)~(
uöçå_t
)&
vÆ
[
NUM_VALS
-1]);

164 
	`add_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
-1);

167 
	`föd_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

168 
	`ok1
(!
	`hèbÀ_obj_gë
(&
ht
, &
d√
));

171 
	`dñ_vÆs_bykey
(&
ht
, 
vÆ
, 
NUM_VALS
);

172 
	`hèbÀ_obj_˛ór
(&
ht
);

174  
	`exô_°©us
();

175 
	}
}

	@ccan/ccan/htable/test/run-zero-hash-first-entry.c

1 
	~<cˇn/hèbÀ/hèbÀ.h
>

2 
	~<cˇn/hèbÀ/hèbÀ.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dboﬁ.h
>

6 
	sd©a
 {

7 
size_t
 
	mkey
;

11 
size_t
 
	$hash
(c⁄° *
e
, *
unu£d
)

13 
d©a
 *
d
 = (d©®*)
e
;

15  
d
->
key
;

16 
	}
}

18 
boﬁ
 
	$eq
(c⁄° *
e
, *
k
)

20 
d©a
 *
d
 = (d©®*)
e
;

21 
size_t
 *
key
 = (size_à*)
k
;

23  (
d
->
key
 == *key);

24 
	}
}

26 
	$maö
()

28 
hèbÀ
 
èbÀ
;

29 
d©a
 *
d0
, *
d1
;

31 
	`∂™_ã°s
(6);

33 
d1
 = 
	`mÆloc
((
d©a
));

34 
d1
->
key
 = 1;

35 
d0
 = 
	`mÆloc
((
d©a
));

36 
d0
->
key
 = 0;

38 
	`hèbÀ_öô
(&
èbÀ
, 
hash
, 
NULL
);

40 
	`hèbÀ_add
(&
èbÀ
, 
d0
->
key
, d0);

41 
	`hèbÀ_add
(&
èbÀ
, 
d1
->
key
, d1);

43 
	`ok1
(
èbÀ
.
ñems
 == 2);

44 
	`ok1
(
	`hèbÀ_gë
(&
èbÀ
, 1, 
eq
, &
d1
->
key
) == d1);

45 
	`ok1
(
	`hèbÀ_gë
(&
èbÀ
, 0, 
eq
, &
d0
->
key
) == d0);

46 
	`hèbÀ_˛ór
(&
èbÀ
);

49 
	`hèbÀ_add
(&
èbÀ
, 
d1
->
key
, d1);

50 
	`hèbÀ_add
(&
èbÀ
, 
d0
->
key
, d0);

52 
	`ok1
(
èbÀ
.
ñems
 == 2);

53 
	`ok1
(
	`hèbÀ_gë
(&
èbÀ
, 1, 
eq
, &
d1
->
key
) == d1);

54 
	`ok1
(
	`hèbÀ_gë
(&
èbÀ
, 0, 
eq
, &
d0
->
key
) == d0);

55 
	`hèbÀ_˛ór
(&
èbÀ
);

57 
	`‰ì
(
d0
);

58 
	`‰ì
(
d1
);

59  
	`exô_°©us
();

60 
	}
}

	@ccan/ccan/htable/test/run.c

1 
	~<cˇn/hèbÀ/hèbÀ.h
>

2 
	~<cˇn/hèbÀ/hèbÀ.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dboﬁ.h
>

5 
	~<°rög.h
>

7 
	#NUM_BITS
 7

	)

8 
	#NUM_VALS
 (1 << 
NUM_BITS
)

	)

13 
size_t
 
	$hash
(c⁄° *
ñem
, *
unu£d
)

15 
size_t
 
h
 = *(
uöt64_t
 *)
ñem
 / 2;

16 
h
 |-1UL << 
NUM_BITS
;

17  
h
;

18 
	}
}

20 
boﬁ
 
	$objcmp
(c⁄° *
hãÀm
, *
cmpd©a
)

22  *(
uöt64_t
 *)
hãÀm
 =*(uöt64_à*)
cmpd©a
;

23 
	}
}

25 
	$add_vÆs
(
hèbÀ
 *
ht
,

26 c⁄° 
uöt64_t
 
vÆ
[],

27 
off
, 
num
)

29 
uöt64_t
 
i
;

31 
i
 = 
off
; i < off+
num
; i++) {

32 i‡(
	`hèbÀ_gë
(
ht
, 
	`hash
(&
i
, 
NULL
), 
objcmp
, &i)) {

33 
	`Áû
("%ŒuáÃódy i¿hash", ()
i
);

36 
	`hèbÀ_add
(
ht
, 
	`hash
(&
vÆ
[
i
], 
NULL
), &val[i]);

37 i‡(
	`hèbÀ_gë
(
ht
, 
	`hash
(&
i
, 
NULL
), 
objcmp
, &iË!&
vÆ
[i]) {

38 
	`Áû
("%ŒuÇŸáddedÅÿhash", ()
i
);

42 
	`∑ss
("Added %ŒuÇumbî†tÿhash", ()
i
);

43 
	}
}

46 
	$ªfûl_vÆs
(
hèbÀ
 *
ht
,

47 c⁄° 
uöt64_t
 
vÆ
[], 
num
)

49 
uöt64_t
 
i
;

51 
i
 = 0; i < 
num
; i++) {

52 i‡(
	`hèbÀ_gë
(
ht
, 
	`hash
(&
i
, 
NULL
), 
objcmp
, &i))

54 
	`hèbÀ_add
(
ht
, 
	`hash
(&
vÆ
[
i
], 
NULL
), &val[i]);

56 
	}
}

59 
	$föd_vÆs
(
hèbÀ
 *
ht
,

60 c⁄° 
uöt64_t
 
vÆ
[], 
num
)

62 
uöt64_t
 
i
;

64 
i
 = 0; i < 
num
; i++) {

65 i‡(
	`hèbÀ_gë
(
ht
, 
	`hash
(&
i
, 
NULL
), 
objcmp
, &iË!&
vÆ
[i]) {

66 
	`Áû
("%ŒuÇŸ found i¿hash", ()
i
);

70 
	`∑ss
("Found %ŒuÇumbî†ö hash", ()
i
);

71 
	}
}

73 
	$dñ_vÆs
(
hèbÀ
 *
ht
,

74 c⁄° 
uöt64_t
 
vÆ
[], 
num
)

76 
uöt64_t
 
i
;

78 
i
 = 0; i < 
num
; i++) {

79 i‡(!
	`hèbÀ_dñ
(
ht
, 
	`hash
(&
vÆ
[
i
], 
NULL
), &val[i])) {

80 
	`Áû
("%ŒuÇŸ dñëed from hash", ()
i
);

84 
	`∑ss
("Dñëed %ŒuÇumbî†ö hash", ()
i
);

85 
	}
}

87 
boﬁ
 
	$check_mask
(
hèbÀ
 *
ht
, 
uöt64_t
 
vÆ
[], 
num
)

89 
uöt64_t
 
i
;

91 
i
 = 0; i < 
num
; i++) {

92 i‡(((
uöçå_t
)&
vÆ
[
i
] & 
ht
->
comm⁄_mask
Ë!ht->
comm⁄_bôs
)

93  
Ál£
;

95  
åue
;

96 
	}
}

98 
	$maö
(
¨gc
, *
¨gv
[])

100 
i
, 
weight
;

101 
uöçå_t
 
≥r„˘_bô
;

102 
hèbÀ
 
ht
;

103 
uöt64_t
 
vÆ
[
NUM_VALS
];

104 
uöt64_t
 
d√
;

105 *
p
;

106 
hèbÀ_ôî
 
ôî
;

108 
	`∂™_ã°s
(29);

109 
i
 = 0; i < 
NUM_VALS
; i++)

110 
vÆ
[
i
] = i;

111 
d√
 = 
i
;

113 
	`hèbÀ_öô
(&
ht
, 
hash
, 
NULL
);

114 
	`ok1
(
ht
.
max
 == 0);

115 
	`ok1
(
ht
.
bôs
 == 0);

118 
	`ok1
(!
	`hèbÀ_gë
(&
ht
, 
	`hash
(&
d√
, 
NULL
), 
objcmp
, &dne));

121 
	`add_vÆs
(&
ht
, 
vÆ
, 0, 1);

122 
	`ok1
(
ht
.
bôs
 == 1);

123 
	`ok1
(
ht
.
max
 == 1);

124 
weight
 = 0;

125 
i
 = 0; i < (
ht
.
comm⁄_mask
Ë* 
CHAR_BIT
; i++) {

126 i‡(
ht
.
comm⁄_mask
 & ((
uöçå_t
)1 << 
i
)) {

127 
weight
++;

131 
	`ok1
(
weight
 =
i
-1);

134 
	`ok1
(
	`check_mask
(&
ht
, 
vÆ
, 1));

137 
	`add_vÆs
(&
ht
, 
vÆ
, 1, 1);

138 
	`ok1
(
ht
.
bôs
 == 2);

139 
	`ok1
(
ht
.
max
 == 3);

142 
	`ok1
(
ht
.
comm⁄_mask
 != 0);

143 
	`ok1
(
ht
.
comm⁄_mask
 != -1);

144 
	`ok1
(
	`check_mask
(&
ht
, 
vÆ
, 2));

147 
	`add_vÆs
(&
ht
, 
vÆ
, 2, 
NUM_VALS
 - 2);

150 
	`föd_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

151 
	`ok1
(!
	`hèbÀ_gë
(&
ht
, 
	`hash
(&
d√
, 
NULL
), 
objcmp
, &dne));

154 
i
 = 0;

155 
p
 = 
	`hèbÀ_fú°
(&
ht
,&
ôî
);Ö;Ö = 
	`hèbÀ_√xt
(&ht, &iter))

156 
i
++;

157 
	`ok1
(
i
 =
NUM_VALS
);

160 
	`dñ_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

161 
	`ok1
(!
	`hèbÀ_gë
(&
ht
, 
	`hash
(&
vÆ
[0], 
NULL
), 
objcmp
, &val[0]));

164 
	`hèbÀ_add
(&
ht
, 0, (*)~(
uöçå_t
)&
vÆ
[
NUM_VALS
-1]);

165 
	`hèbÀ_add
(&
ht
, 
	`hash
(&
vÆ
[
NUM_VALS
-1], 
NULL
), &val[NUM_VALS-1]);

166 
	`ok1
(
ht
.
comm⁄_mask
 == 0);

167 
	`ok1
(
ht
.
comm⁄_bôs
 == 0);

169 
	`hèbÀ_dñ
(&
ht
, 0, (*)~(
uöçå_t
)&
vÆ
[
NUM_VALS
-1]);

172 
	`add_vÆs
(&
ht
, 
vÆ
, 0, 
NUM_VALS
-1);

175 
	`föd_vÆs
(&
ht
, 
vÆ
, 
NUM_VALS
);

176 
	`ok1
(!
	`hèbÀ_gë
(&
ht
, 
	`hash
(&
d√
, 
NULL
), 
objcmp
, &dne));

179 
	`hèbÀ_˛ór
(&
ht
);

180 
	`hèbÀ_add
(&
ht
, 0, (*)((
uöçå_t
)&
vÆ
[
NUM_VALS
-1]));

181 
	`ok1
(
ht
.
≥r„˘_bô
);

182 
≥r„˘_bô
 = 
ht
.perfect_bit;

183 
	`hèbÀ_add
(&
ht
, 0, (*)((
uöçå_t
)&
vÆ
[
NUM_VALS
-1]

184 | 
≥r„˘_bô
));

185 
	`ok1
(
ht
.
≥r„˘_bô
 == 0);

186 
	`hèbÀ_dñ
(&
ht
, 0, (*)((
uöçå_t
)&
vÆ
[
NUM_VALS
-1] | 
≥r„˘_bô
));

189 
	`add_vÆs
(&
ht
, 
vÆ
, 0, 
NUM_VALS
-1);

191 
	`ok1
(
ht
.
≥r„˘_bô
 != 0);

192 
	`hèbÀ_˛ór
(&
ht
);

194  
	`exô_°©us
();

195 
	}
}

	@ccan/ccan/htable/tools/hsearchspeed.c

2 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

3 
	~<cˇn/hèbÀ/hèbÀ.c
>

4 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

5 
	~<cˇn/gøb_fûe/gøb_fûe.h
>

6 
	~<cˇn/èŒoc/èŒoc.h
>

7 
	~<cˇn/hash/hash.h
>

8 
	~<cˇn/time/time.h
>

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<°rög.h
>

12 
	~<time.h
>

13 
	~<uni°d.h
>

14 
	~<sys/time.h
>

15 
	~<£¨ch.h
>

18 
size_t
 
	$n‹mÆize
(c⁄° 
timevÆ
 *
°¨t
,

19 c⁄° 
timevÆ
 *
°›
,

20 
num
)

22 
timevÆ
 
diff
;

24 
	`timîsub
(
°›
, 
°¨t
, &
diff
);

27  ()(
diff
.
tv_£c
 * 1000000 + diff.
tv_u£c
)

28 / 
num
 * 1000;

29 
	}
}

31 
	$maö
(
¨gc
, *
¨gv
[])

33 
size_t
 
i
, 
j
, 
num
;

34 
timevÆ
 
°¨t
, 
°›
;

35 **
w
;

36 
ENTRY
 *
w‹ds
, *
missw‹ds
;

38 
w
 = 
	`°r•lô
(
NULL
, 
	`gøb_fûe
(NULL,

39 
¨gv
[1] ?árgv[1] : "/usr/share/dict/words",

40 
NULL
), "\n");

41 
num
 = 
	`èŒoc_¨øy_Àngth
(
w
) - 1;

42 
	`¥ötf
("%zu w‹ds\n", 
num
);

44 
	`h¸óã
(
num
+num/3);

46 
w‹ds
 = 
	`èŒoc_¨øy
(
w
, 
ENTRY
, 
num
);

47 
i
 = 0; i < 
num
; i++) {

48 
w‹ds
[
i
].
key
 = 
w
[i];

49 
w‹ds
[
i
].
d©a
 = w‹ds[i].
key
;

53 
missw‹ds
 = 
	`èŒoc_¨øy
(
w
, 
ENTRY
, 
num
);

54 
i
 = 0; i < 
num
; i++) {

55 
œ°c
;

56 i‡(
	`°æí
(
w
[
i
]))

57 
œ°c
 = 
w
[
i
][
	`°æí
(w[i])-1];

59 
œ°c
 = 'z';

60 
missw‹ds
[
i
].
key
 = 
	`èŒoc_a•rötf
(misswords, "%c%s%c%c",

61 
œ°c
, 
w
[
i
],

62 
œ°c
,Üastc);

65 
	`¥ötf
("#01: Initial insert: ");

66 
	`fÊush
(
°dout
);

67 
°¨t
 = 
	`time_now
();

68 
i
 = 0; i < 
num
; i++)

69 
	`h£¨ch
(
w‹ds
[
i
], 
ENTER
);

70 
°›
 = 
	`time_now
();

71 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

73 
	`¥ötf
("#02: InitialÜookup (match): ");

74 
	`fÊush
(
°dout
);

75 
°¨t
 = 
	`time_now
();

76 
i
 = 0; i < 
num
; i++)

77 i‡(
	`h£¨ch
(
w‹ds
[
i
], 
FIND
)->
d©a
 != words[i].data)

78 
	`ab‹t
();

79 
°›
 = 
	`time_now
();

80 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

82 
	`¥ötf
("#03: InitialÜookup (miss): ");

83 
	`fÊush
(
°dout
);

84 
°¨t
 = 
	`time_now
();

85 
i
 = 0; i < 
num
; i++) {

86 i‡(
	`h£¨ch
(
missw‹ds
[
i
], 
FIND
))

87 
	`ab‹t
();

89 
°›
 = 
	`time_now
();

90 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

93 
	`¥ötf
("#04: InitialÜookup (random): ");

94 
	`fÊush
(
°dout
);

95 
°¨t
 = 
	`time_now
();

96 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

97 i‡(
	`h£¨ch
(
w‹ds
[
i
], 
FIND
)->
d©a
 != words[i].data)

98 
	`ab‹t
();

99 
°›
 = 
	`time_now
();

100 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

103 
	}
}

	@ccan/ccan/htable/tools/speed.c

2 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

3 
	~<cˇn/hèbÀ/hèbÀ.c
>

4 
	~<cˇn/hash/hash.h
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<°rög.h
>

8 
	~<time.h
>

9 
	~<uni°d.h
>

10 
	~<sys/time.h
>

12 
size_t
 
	ghashcou¡
;

13 
	sobje˘
 {

15 
	mkey
;

18 
obje˘
 *
	m£lf
;

21 c⁄° *
	$objkey
(c⁄° 
obje˘
 *
obj
)

23  &
obj
->
key
;

24 
	}
}

26 
size_t
 
	$hash_obj
(c⁄° *
key
)

28 
hashcou¡
++;

29  
	`hashl
(
key
, 1, 0);

30 
	}
}

32 
boﬁ
 
	$cmp
(c⁄° 
obje˘
 *obje˘, c⁄° *
key
)

34  
obje˘
->
key
 == *key;

35 
	}
}

37 
HTABLE_DEFINE_TYPE
(
obje˘
, 
objkey
, 
hash_obj
, 
cmp
, 
hèbÀ_obj
);

39 
	$p›cou¡
(
vÆ
)

41 #i‡
HAVE_BUILTIN_POPCOUNTL


42  
	`__buûtö_p›cou¡l
(
vÆ
);

44 i‡((Ë=(
u64
)) {

45 
u64
 
v
 = 
vÆ
;

46 
v
 = (v & 0x5555555555555555ULL)

47 + ((
v
 >> 1) & 0x5555555555555555ULL);

48 
v
 = (v & 0x3333333333333333ULL)

49 + ((
v
 >> 1) & 0x3333333333333333ULL);

50 
v
 = (v & 0x0F0F0F0F0F0F0F0FULL)

51 + ((
v
 >> 1) & 0x0F0F0F0F0F0F0F0FULL);

52 
v
 = (v & 0x00FF00FF00FF00FFULL)

53 + ((
v
 >> 1) & 0x00FF00FF00FF00FFULL);

54 
v
 = (v & 0x0000FFFF0000FFFFULL)

55 + ((
v
 >> 1) & 0x0000FFFF0000FFFFULL);

56 
v
 = (v & 0x00000000FFFFFFFFULL)

57 + ((
v
 >> 1) & 0x00000000FFFFFFFFULL);

58  
v
;

60 
vÆ
 = (val & 0x55555555ULL) + ((val >> 1) & 0x55555555ULL);

61 
vÆ
 = (val & 0x33333333ULL) + ((val >> 1) & 0x33333333ULL);

62 
vÆ
 = (val & 0x0F0F0F0FULL) + ((val >> 1) & 0x0F0F0F0FULL);

63 
vÆ
 = (val & 0x00FF00FFULL) + ((val >> 1) & 0x00FF00FFULL);

64 
vÆ
 = (val & 0x0000FFFFULL) + ((val >> 1) & 0x0000FFFFULL);

65  
vÆ
;

67 
	}
}

69 
size_t
 
	$≥r„˘
(c⁄° 
hèbÀ
 *
ht
)

71 
size_t
 
i
, 
∂a˚d_≥r„˘
 = 0;

73 
i
 = 0; i < ((
size_t
)1 << 
ht
->
bôs
); i++) {

74 i‡(!
	`íåy_is_vÆid
(
ht
->
èbÀ
[
i
]))

76 i‡(
	`hash_buckë
(
ht
, ht->
	`ªhash
(
	`gë_øw_±r
(ht, ht->
èbÀ
[
i
]),

77 
ht
->
¥iv
)Ë=
i
) {

78 
	`as£π
((
ht
->
èbÀ
[
i
] & ht->
≥r„˘_bô
)

79 =
ht
->
≥r„˘_bô
);

80 
∂a˚d_≥r„˘
++;

83  
∂a˚d_≥r„˘
;

84 
	}
}

86 
size_t
 
	$cou¡_dñëed
(c⁄° 
hèbÀ
 *
ht
)

88 
size_t
 
i
, 
dñëe_m¨kîs
 = 0;

90 
i
 = 0; i < ((
size_t
)1 << 
ht
->
bôs
); i++) {

91 i‡(
ht
->
èbÀ
[
i
] =
HTABLE_DELETED
)

92 
dñëe_m¨kîs
++;

94  
dñëe_m¨kîs
;

95 
	}
}

98 
size_t
 
	$n‹mÆize
(c⁄° 
timevÆ
 *
°¨t
,

99 c⁄° 
timevÆ
 *
°›
,

100 
num
)

102 
timevÆ
 
diff
;

104 
	`timîsub
(
°›
, 
°¨t
, &
diff
);

107  ()(
diff
.
tv_£c
 * 1000000 + diff.
tv_u£c
)

108 / 
num
 * 1000;

109 
	}
}

111 
size_t
 
	$w‹°_run
(
hèbÀ
 *
ht
, 
size_t
 *
dñëed
)

113 
size_t
 
l⁄ge°
 = 0, 
Àn
 = 0, 
this_dñ
 = 0, 
i
;

115 *
dñëed
 = 0;

117 
i
 = 0; i < ((
size_t
)1 << 
ht
->
bôs
); i++) {

118 i‡(
ht
->
èbÀ
[
i
]) {

119 
Àn
++;

120 i‡(
ht
->
èbÀ
[
i
] =
HTABLE_DELETED
)

121 
this_dñ
++;

123 i‡(
Àn
 > 
l⁄ge°
) {

124 
l⁄ge°
 = 
Àn
;

125 *
dñëed
 = 
this_dñ
;

127 
Àn
 = 0;

128 
this_dñ
 = 0;

131  
l⁄ge°
;

132 
	}
}

134 
	$maö
(
¨gc
, *
¨gv
[])

136 
obje˘
 *
objs
;

137 
size_t
 
i
, 
j
, 
num
, 
dñëed
;

138 
timevÆ
 
°¨t
, 
°›
;

139 
hèbÀ_obj
 
ht
;

140 
boﬁ
 
make_dumb
 = 
Ál£
;

142 i‡(
¨gv
[1] && 
	`°rcmp
(argv[1], "--dumb") == 0) {

143 
¨gv
++;

144 
make_dumb
 = 
åue
;

146 
num
 = 
¨gv
[1] ? 
	`©oi
(argv[1]) : 1000000;

147 
objs
 = 
	`ˇŒoc
(
num
, (objs[0]));

149 
i
 = 0; i < 
num
; i++) {

150 
objs
[
i
].
key
 = i;

151 
objs
[
i
].
£lf
 = &objs[i];

154 
	`hèbÀ_obj_öô
(&
ht
);

156 
	`¥ötf
("Initial insert: ");

157 
	`fÊush
(
°dout
);

158 
	`gëtimeofday
(&
°¨t
, 
NULL
);

159 
i
 = 0; i < 
num
; i++)

160 
	`hèbÀ_obj_add
(&
ht
, 
objs
[
i
].
£lf
);

161 
	`gëtimeofday
(&
°›
, 
NULL
);

162 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

163 
	`¥ötf
("Details: hash size %u, mask bits %u,Öerfect %.0f%%\n",

164 1U << 
ht
.
øw
.
bôs
, 
	`p›cou¡
(ht.øw.
comm⁄_mask
),

165 
	`≥r„˘
(&
ht
.
øw
Ë* 100.0 / ht.øw.
ñems
);

167 i‡(
make_dumb
) {

169 
	`upd©e_comm⁄
(&
ht
.
øw
, (*)~ht.øw.
comm⁄_bôs
);

170 
	`¥ötf
("Details: DUMB MODE: mask bits %u\n",

171 
	`p›cou¡
(
ht
.
øw
.
comm⁄_mask
));

174 
	`¥ötf
("InitialÜookup (match): ");

175 
	`fÊush
(
°dout
);

176 
	`gëtimeofday
(&
°¨t
, 
NULL
);

177 
i
 = 0; i < 
num
; i++)

178 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
i
)->
£lf
 !
objs
[i].self)

179 
	`ab‹t
();

180 
	`gëtimeofday
(&
°›
, 
NULL
);

181 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

183 
	`¥ötf
("InitialÜookup (miss): ");

184 
	`fÊush
(
°dout
);

185 
	`gëtimeofday
(&
°¨t
, 
NULL
);

186 
i
 = 0; i < 
num
; i++) {

187 
n
 = 
i
 + 
num
;

188 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
n
))

189 
	`ab‹t
();

191 
	`gëtimeofday
(&
°›
, 
NULL
);

192 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

195 
	`¥ötf
("InitialÜookup (random): ");

196 
	`fÊush
(
°dout
);

197 
	`gëtimeofday
(&
°¨t
, 
NULL
);

198 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

199 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
j
)->
£lf
 !&
objs
[j])

200 
	`ab‹t
();

201 
	`gëtimeofday
(&
°›
, 
NULL
);

202 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

204 
hashcou¡
 = 0;

205 
	`¥ötf
("Initial deleteáll: ");

206 
	`fÊush
(
°dout
);

207 
	`gëtimeofday
(&
°¨t
, 
NULL
);

208 
i
 = 0; i < 
num
; i++)

209 i‡(!
	`hèbÀ_obj_dñ
(&
ht
, 
objs
[
i
].
£lf
))

210 
	`ab‹t
();

211 
	`gëtimeofday
(&
°›
, 
NULL
);

212 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

213 
	`¥ötf
("Dëaûs:Ñehashe†%zu\n", 
hashcou¡
);

215 
	`¥ötf
("InitialÑe-inserting: ");

216 
	`fÊush
(
°dout
);

217 
	`gëtimeofday
(&
°¨t
, 
NULL
);

218 
i
 = 0; i < 
num
; i++)

219 
	`hèbÀ_obj_add
(&
ht
, 
objs
[
i
].
£lf
);

220 
	`gëtimeofday
(&
°›
, 
NULL
);

221 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

223 
hashcou¡
 = 0;

224 
	`¥ötf
("Deleting first half: ");

225 
	`fÊush
(
°dout
);

226 
	`gëtimeofday
(&
°¨t
, 
NULL
);

227 
i
 = 0; i < 
num
; i+=2)

228 i‡(!
	`hèbÀ_obj_dñ
(&
ht
, 
objs
[
i
].
£lf
))

229 
	`ab‹t
();

230 
	`gëtimeofday
(&
°›
, 
NULL
);

231 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

233 
	`¥ötf
("Details:Ñehashes %zu, delete markers %zu\n",

234 
hashcou¡
, 
	`cou¡_dñëed
(&
ht
.
øw
));

236 
	`¥ötf
("Adding (a different) half: ");

237 
	`fÊush
(
°dout
);

239 
i
 = 0; i < 
num
; i+=2)

240 
objs
[
i
].
key
 = 
num
+i;

242 
	`gëtimeofday
(&
°¨t
, 
NULL
);

243 
i
 = 0; i < 
num
; i+=2)

244 
	`hèbÀ_obj_add
(&
ht
, 
objs
[
i
].
£lf
);

245 
	`gëtimeofday
(&
°›
, 
NULL
);

246 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

248 
	`¥ötf
("Details: delete markers %zu,Öerfect %.0f%%\n",

249 
	`cou¡_dñëed
(&
ht
.
øw
), 
	`≥r„˘
(&ht.øwË* 100.0 / ht.øw.
ñems
);

251 
	`¥ötf
("Lookupáfter half-change (match): ");

252 
	`fÊush
(
°dout
);

253 
	`gëtimeofday
(&
°¨t
, 
NULL
);

254 
i
 = 1; i < 
num
; i+=2)

255 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
i
)->
£lf
 !
objs
[i].self)

256 
	`ab‹t
();

257 
i
 = 0; i < 
num
; i+=2) {

258 
n
 = 
i
 + 
num
;

259 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
n
)->
£lf
 !
objs
[
i
].self)

260 
	`ab‹t
();

262 
	`gëtimeofday
(&
°›
, 
NULL
);

263 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

265 
	`¥ötf
("Lookupáfter half-change (miss): ");

266 
	`fÊush
(
°dout
);

267 
	`gëtimeofday
(&
°¨t
, 
NULL
);

268 
i
 = 0; i < 
num
; i++) {

269 
n
 = 
i
 + 
num
 * 2;

270 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
n
))

271 
	`ab‹t
();

273 
	`gëtimeofday
(&
°›
, 
NULL
);

274 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

278 
i
 = 0; i < 5; i++) {

279 i‡(
i
 == 0) {

281 
	`¥ötf
("Details: initial churn\n");

283 
	`¥ötf
("Churning %sÅime: ",

284 
i
 == 1 ? "second"

285 : 
i
 == 2 ? "third"

286 : 
i
 == 3 ? "fourth"

288 
	`fÊush
(
°dout
);

290 
	`gëtimeofday
(&
°¨t
, 
NULL
);

291 
j
 = 0; j < 
num
; j++) {

292 i‡(!
	`hèbÀ_obj_dñ
(&
ht
, &
objs
[
j
]))

293 
	`ab‹t
();

294 
objs
[
j
].
key
 = 
num
*
i
+j;

295 i‡(!
	`hèbÀ_obj_add
(&
ht
, &
objs
[
j
]))

296 
	`ab‹t
();

298 
	`gëtimeofday
(&
°›
, 
NULL
);

299 i‡(
i
 != 0)

300 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

304 
	`¥ötf
("Details:Ñeinserting with spread\n");

305 
i
 = 0; i < 
num
; i++) {

306 i‡(!
	`hèbÀ_obj_dñ
(&
ht
, 
objs
[
i
].
£lf
))

307 
	`ab‹t
();

308 
objs
[
i
].
key
 = 
num
 * 5 + i * 9;

309 i‡(!
	`hèbÀ_obj_add
(&
ht
, 
objs
[
i
].
£lf
))

310 
	`ab‹t
();

312 
	`¥ötf
("Details: delete markers %zu,Öerfect %.0f%%\n",

313 
	`cou¡_dñëed
(&
ht
.
øw
), 
	`≥r„˘
(&ht.øwË* 100.0 / ht.øw.
ñems
);

314 
i
 = 
	`w‹°_run
(&
ht
.
øw
, &
dñëed
);

315 
	`¥ötf
("Dëaûs: w‹°Ñu¿%zu (%zu dñëed)\n", 
i
, 
dñëed
);

317 
	`¥ötf
("Lookupáfter churn & spread (match): ");

318 
	`fÊush
(
°dout
);

319 
	`gëtimeofday
(&
°¨t
, 
NULL
);

320 
i
 = 0; i < 
num
; i++) {

321 
n
 = 
num
 * 5 + 
i
 * 9;

322 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
n
)->
£lf
 !
objs
[
i
].self)

323 
	`ab‹t
();

325 
	`gëtimeofday
(&
°›
, 
NULL
);

326 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

328 
	`¥ötf
("Lookupáfter churn & spread (miss): ");

329 
	`fÊush
(
°dout
);

330 
	`gëtimeofday
(&
°¨t
, 
NULL
);

331 
i
 = 0; i < 
num
; i++) {

332 
n
 = 
num
 * (5 + 9Ë+ 
i
 * 9;

333 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
n
))

334 
	`ab‹t
();

336 
	`gëtimeofday
(&
°›
, 
NULL
);

337 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

339 
	`¥ötf
("Lookupáfter churn & spread (random): ");

340 
	`fÊush
(
°dout
);

341 
	`gëtimeofday
(&
°¨t
, 
NULL
);

342 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum) {

343 
n
 = 
num
 * 5 + 
j
 * 9;

344 i‡(
	`hèbÀ_obj_gë
(&
ht
, &
n
)->
£lf
 !&
objs
[
j
])

345 
	`ab‹t
();

347 
	`gëtimeofday
(&
°›
, 
NULL
);

348 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

350 
hashcou¡
 = 0;

351 
	`¥ötf
("Deleting halfáfter churn & spread: ");

352 
	`fÊush
(
°dout
);

353 
	`gëtimeofday
(&
°¨t
, 
NULL
);

354 
i
 = 0; i < 
num
; i+=2)

355 i‡(!
	`hèbÀ_obj_dñ
(&
ht
, 
objs
[
i
].
£lf
))

356 
	`ab‹t
();

357 
	`gëtimeofday
(&
°›
, 
NULL
);

358 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

360 
	`¥ötf
("Adding (a different) halfáfter churn & spread: ");

361 
	`fÊush
(
°dout
);

363 
i
 = 0; i < 
num
; i+=2)

364 
objs
[
i
].
key
 = 
num
*6+i*9;

366 
	`gëtimeofday
(&
°¨t
, 
NULL
);

367 
i
 = 0; i < 
num
; i+=2)

368 
	`hèbÀ_obj_add
(&
ht
, 
objs
[
i
].
£lf
);

369 
	`gëtimeofday
(&
°›
, 
NULL
);

370 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

372 
	`¥ötf
("Details: delete markers %zu,Öerfect %.0f%%\n",

373 
	`cou¡_dñëed
(&
ht
.
øw
), 
	`≥r„˘
(&ht.øwË* 100.0 / ht.øw.
ñems
);

376 
	}
}

	@ccan/ccan/htable/tools/stringspeed.c

2 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

3 
	~<cˇn/hèbÀ/hèbÀ.c
>

4 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

5 
	~<cˇn/gøb_fûe/gøb_fûe.h
>

6 
	~<cˇn/èŒoc/èŒoc.h
>

7 
	~<cˇn/hash/hash.h
>

8 
	~<cˇn/time/time.h
>

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<°rög.h
>

12 
	~<time.h
>

13 
	~<uni°d.h
>

14 
	~<sys/time.h
>

16 
size_t
 
	ghashcou¡
;

18 c⁄° *
	$°rkey
(c⁄° *
°r
)

20  
°r
;

21 
	}
}

23 
size_t
 
	$hash_°r
(c⁄° *
key
)

25 
hashcou¡
++;

26  
	`hash
(
key
, 
	`°æí
(key), 0);

27 
	}
}

29 
boﬁ
 
	$cmp
(c⁄° *
obj
, c⁄° *
key
)

31  
	`°rcmp
(
obj
, 
key
) == 0;

32 
	}
}

34 
HTABLE_DEFINE_TYPE
(, 
°rkey
, 
hash_°r
, 
cmp
, 
hèbÀ_°r
);

37 
size_t
 
	$n‹mÆize
(c⁄° 
timevÆ
 *
°¨t
,

38 c⁄° 
timevÆ
 *
°›
,

39 
num
)

41 
timevÆ
 
diff
;

43 
	`timîsub
(
°›
, 
°¨t
, &
diff
);

46  ()(
diff
.
tv_£c
 * 1000000 + diff.
tv_u£c
)

47 / 
num
 * 1000;

48 
	}
}

50 
	$maö
(
¨gc
, *
¨gv
[])

52 
size_t
 
i
, 
j
, 
num
;

53 
timevÆ
 
°¨t
, 
°›
;

54 
hèbÀ_°r
 
ht
;

55 **
w‹ds
, **
missw‹ds
;

57 
w‹ds
 = 
	`°r•lô
(
NULL
, 
	`gøb_fûe
(NULL,

58 
¨gv
[1] ?árgv[1] : "/usr/share/dict/words",

59 
NULL
), "\n");

60 
	`hèbÀ_°r_öô
(&
ht
);

61 
num
 = 
	`èŒoc_¨øy_Àngth
(
w‹ds
) - 1;

63 
	`¥ötf
("%zu w‹ds\n", 
num
);

66 
missw‹ds
 = 
	`èŒoc_¨øy
(
w‹ds
, *, 
num
);

67 
i
 = 0; i < 
num
; i++) {

68 
œ°c
;

69 i‡(
	`°æí
(
w‹ds
[
i
]))

70 
œ°c
 = 
w‹ds
[
i
][
	`°æí
(words[i])-1];

72 
œ°c
 = 'z';

73 
missw‹ds
[
i
] = 
	`èŒoc_a•rötf
(misswords, "%c%s%c%c",

74 
œ°c
, 
w‹ds
[
i
],Üastc,Üastc);

77 
	`¥ötf
("#01: Initial insert: ");

78 
	`fÊush
(
°dout
);

79 
°¨t
 = 
	`time_now
();

80 
i
 = 0; i < 
num
; i++)

81 
	`hèbÀ_°r_add
(&
ht
, 
w‹ds
[
i
]);

82 
°›
 = 
	`time_now
();

83 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

85 
	`¥ötf
("Bytesállocated: %zu\n",

86 (
ht
.
øw
.
èbÀ
[0]Ë<< ht.øw.
bôs
);

88 
	`¥ötf
("#02: InitialÜookup (match): ");

89 
	`fÊush
(
°dout
);

90 
°¨t
 = 
	`time_now
();

91 
i
 = 0; i < 
num
; i++)

92 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
w‹ds
[
i
]) != words[i])

93 
	`ab‹t
();

94 
°›
 = 
	`time_now
();

95 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

97 
	`¥ötf
("#03: InitialÜookup (miss): ");

98 
	`fÊush
(
°dout
);

99 
°¨t
 = 
	`time_now
();

100 
i
 = 0; i < 
num
; i++) {

101 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
missw‹ds
[
i
]))

102 
	`ab‹t
();

104 
°›
 = 
	`time_now
();

105 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

108 
	`¥ötf
("#04: InitialÜookup (random): ");

109 
	`fÊush
(
°dout
);

110 
°¨t
 = 
	`time_now
();

111 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

112 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
w‹ds
[
j
]) != words[j])

113 
	`ab‹t
();

114 
°›
 = 
	`time_now
();

115 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

117 
hashcou¡
 = 0;

118 
	`¥ötf
("#05: Initial deleteáll: ");

119 
	`fÊush
(
°dout
);

120 
°¨t
 = 
	`time_now
();

121 
i
 = 0; i < 
num
; i++)

122 i‡(!
	`hèbÀ_°r_dñ
(&
ht
, 
w‹ds
[
i
]))

123 
	`ab‹t
();

124 
°›
 = 
	`time_now
();

125 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

127 
	`¥ötf
("#06: InitialÑe-inserting: ");

128 
	`fÊush
(
°dout
);

129 
°¨t
 = 
	`time_now
();

130 
i
 = 0; i < 
num
; i++)

131 
	`hèbÀ_°r_add
(&
ht
, 
w‹ds
[
i
]);

132 
°›
 = 
	`time_now
();

133 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

135 
hashcou¡
 = 0;

136 
	`¥ötf
("#07: Deleting first half: ");

137 
	`fÊush
(
°dout
);

138 
°¨t
 = 
	`time_now
();

139 
i
 = 0; i < 
num
; i+=2)

140 i‡(!
	`hèbÀ_°r_dñ
(&
ht
, 
w‹ds
[
i
]))

141 
	`ab‹t
();

142 
°›
 = 
	`time_now
();

143 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

145 
	`¥ötf
("#08: Adding (a different) half: ");

146 
	`fÊush
(
°dout
);

148 
°¨t
 = 
	`time_now
();

149 
i
 = 0; i < 
num
; i+=2)

150 
	`hèbÀ_°r_add
(&
ht
, 
missw‹ds
[
i
]);

151 
°›
 = 
	`time_now
();

152 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

154 
	`¥ötf
("#09: Lookupáfter half-change (match): ");

155 
	`fÊush
(
°dout
);

156 
°¨t
 = 
	`time_now
();

157 
i
 = 1; i < 
num
; i+=2)

158 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
w‹ds
[
i
]) != words[i])

159 
	`ab‹t
();

160 
i
 = 0; i < 
num
; i+=2) {

161 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
missw‹ds
[
i
]) != misswords[i])

162 
	`ab‹t
();

164 
°›
 = 
	`time_now
();

165 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

167 
	`¥ötf
("#10: Lookupáfter half-change (miss): ");

168 
	`fÊush
(
°dout
);

169 
°¨t
 = 
	`time_now
();

170 
i
 = 0; i < 
num
; i+=2)

171 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
w‹ds
[
i
]))

172 
	`ab‹t
();

173 
i
 = 1; i < 
num
; i+=2) {

174 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
missw‹ds
[
i
]))

175 
	`ab‹t
();

177 
°›
 = 
	`time_now
();

178 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

182 
	`¥ötf
("#11: Churn 1: ");

183 
°¨t
 = 
	`time_now
();

184 
j
 = 0; j < 
num
; j+=2) {

185 i‡(!
	`hèbÀ_°r_dñ
(&
ht
, 
missw‹ds
[
j
]))

186 
	`ab‹t
();

187 i‡(!
	`hèbÀ_°r_add
(&
ht
, 
w‹ds
[
j
]))

188 
	`ab‹t
();

190 
°›
 = 
	`time_now
();

191 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

193 
	`¥ötf
("#12: Churn 2: ");

194 
°¨t
 = 
	`time_now
();

195 
j
 = 1; j < 
num
; j+=2) {

196 i‡(!
	`hèbÀ_°r_dñ
(&
ht
, 
w‹ds
[
j
]))

197 
	`ab‹t
();

198 i‡(!
	`hèbÀ_°r_add
(&
ht
, 
missw‹ds
[
j
]))

199 
	`ab‹t
();

201 
°›
 = 
	`time_now
();

202 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

204 
	`¥ötf
("#13: Churn 3: ");

205 
°¨t
 = 
	`time_now
();

206 
j
 = 1; j < 
num
; j+=2) {

207 i‡(!
	`hèbÀ_°r_dñ
(&
ht
, 
missw‹ds
[
j
]))

208 
	`ab‹t
();

209 i‡(!
	`hèbÀ_°r_add
(&
ht
, 
w‹ds
[
j
]))

210 
	`ab‹t
();

212 
°›
 = 
	`time_now
();

213 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

216 
	`¥ötf
("#14: Post-ChurnÜookup (match): ");

217 
	`fÊush
(
°dout
);

218 
°¨t
 = 
	`time_now
();

219 
i
 = 0; i < 
num
; i++)

220 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
w‹ds
[
i
]) != words[i])

221 
	`ab‹t
();

222 
°›
 = 
	`time_now
();

223 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

225 
	`¥ötf
("#15: Post-ChurnÜookup (miss): ");

226 
	`fÊush
(
°dout
);

227 
°¨t
 = 
	`time_now
();

228 
i
 = 0; i < 
num
; i++) {

229 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
missw‹ds
[
i
]))

230 
	`ab‹t
();

232 
°›
 = 
	`time_now
();

233 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

236 
	`¥ötf
("#16: Post-ChurnÜookup (random): ");

237 
	`fÊush
(
°dout
);

238 
°¨t
 = 
	`time_now
();

239 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

240 i‡(
	`hèbÀ_°r_gë
(&
ht
, 
w‹ds
[
j
]) != words[j])

241 
	`ab‹t
();

242 
°›
 = 
	`time_now
();

243 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

246 
	}
}

	@ccan/ccan/idtree/idtree.c

27 
	~<cˇn/idåì/idåì.h
>

28 
	~<cˇn/èŒoc/èŒoc.h
>

29 
	~<°döt.h
>

30 
	~<°rög.h
>

32 
	#IDTREE_BITS
 5

	)

33 
	#IDTREE_FULL
 0xfffffffful

	)

35 
	#TOP_LEVEL_FULL
 (
IDTREE_FULL
 >> 30)

	)

37 
	#IDTREE_SIZE
 (1 << 
IDTREE_BITS
)

	)

38 
	#IDTREE_MASK
 ((1 << 
IDTREE_BITS
)-1)

	)

39 
	#MAX_ID_SHIFT
 (()*8 - 1)

	)

40 
	#MAX_ID_BIT
 (1U << 
MAX_ID_SHIFT
)

	)

41 
	#MAX_ID_MASK
 (
MAX_ID_BIT
 - 1)

	)

42 
	#MAX_LEVEL
 (
MAX_ID_SHIFT
 + 
IDTREE_BITS
 - 1Ë/ 
	)
IDTREE_BITS

43 
	#IDTREE_FREE_MAX
 
MAX_LEVEL
 + 
	)
MAX_LEVEL

45 
	#£t_bô
(
bô
, 
v
Ë(vË|(1<<(bô))

	)

46 
	#˛ór_bô
(
bô
, 
v
Ë(vË&~(1<<(bô))

	)

47 
	#ã°_bô
(
bô
, 
v
Ë((vË& (1<<(bô)))

	)

49 
	sidåì_œyî
 {

50 
uöt32_t
 
	mbôm≠
;

51 
idåì_œyî
 *
	m¨y
[
IDTREE_SIZE
];

52 
	mcou¡
;

55 
	sidåì
 {

56 
idåì_œyî
 *
	mt›
;

57 
idåì_œyî
 *
	mid_‰ì
;

58 
	mœyîs
;

59 
	mid_‰ì_˙t
;

62 
idåì_œyî
 *
	$Æloc_œyî
(
idåì
 *
idp
)

64 
idåì_œyî
 *
p
;

66 i‡(!(
p
 = 
idp
->
id_‰ì
))

67  
NULL
;

68 
idp
->
id_‰ì
 = 
p
->
¨y
[0];

69 
idp
->
id_‰ì_˙t
--;

70 
p
->
¨y
[0] = 
NULL
;

71  
p
;

72 
	}
}

74 
	$föd_√xt_bô
(
uöt32_t
 
bm
, 
maxid
, 
n
)

76 
n
<
maxid
 && !
	`ã°_bô
“, 
bm
))Ç++;

77  
n
;

78 
	}
}

80 
	$‰ì_œyî
(
idåì
 *
idp
, 
idåì_œyî
 *
p
)

82 
p
->
¨y
[0] = 
idp
->
id_‰ì
;

83 
idp
->
id_‰ì
 = 
p
;

84 
idp
->
id_‰ì_˙t
++;

85 
	}
}

87 
	$idåì_¥e_gë
(
idåì
 *
idp
)

89 
idp
->
id_‰ì_˙t
 < 
IDTREE_FREE_MAX
) {

90 
idåì_œyî
 *
≤
 = 
	`èŒoc_zîo
(
idp
, idtree_layer);

91 if(
≤
 =
NULL
)

93 
	`‰ì_œyî
(
idp
, 
≤
);

96 
	}
}

98 
	$sub_Æloc
(
idåì
 *
idp
, c⁄° *
±r
, *
°¨tög_id
)

100 
n
, 
m
, 
sh
;

101 
idåì_œyî
 *
p
, *
≤
;

102 
idåì_œyî
 *
∑
[
MAX_LEVEL
+1];

103 
l
, 
id
, 
oid
;

104 
uöt32_t
 
bm
;

106 
	`mem£t
(
∑
, 0, (pa));

108 
id
 = *
°¨tög_id
;

109 
ª°¨t
:

110 
p
 = 
idp
->
t›
;

111 
l
 = 
idp
->
œyîs
;

112 
∑
[
l
--] = 
NULL
;

117 
n
 = (
id
 >> (
IDTREE_BITS
*
l
)Ë& 
IDTREE_MASK
;

118 
bm
 = ~
p
->
bôm≠
;

119 
m
 = 
	`föd_√xt_bô
(
bm
, 
IDTREE_SIZE
, 
n
);

120 i‡(
m
 =
IDTREE_SIZE
) {

122 
l
++;

123 
oid
 = 
id
;

124 
id
 = (id | ((1 << (
IDTREE_BITS
*
l
))-1)) + 1;

127 i‡(!(
p
 = 
∑
[
l
])) {

128 *
°¨tög_id
 = 
id
;

135 
sh
 = 
IDTREE_BITS
 * (
l
 + 1);

136 i‡(
oid
 >> 
sh
 =
id
 >> sh)

139 
ª°¨t
;

141 i‡(
m
 !
n
) {

142 
sh
 = 
IDTREE_BITS
*
l
;

143 
id
 = ((id >> 
sh
Ë^ 
n
 ^ 
m
) << sh;

145 i‡((
id
 >
MAX_ID_BIT
) || (id < 0))

147 i‡(
l
 == 0)

152 i‡(!
p
->
¨y
[
m
]) {

153 i‡(!(
≤
 = 
	`Æloc_œyî
(
idp
)))

155 
p
->
¨y
[
m
] = 
≤
;

156 
p
->
cou¡
++;

158 
∑
[
l
--] = 
p
;

159 
p
 =Ö->
¨y
[
m
];

165 
p
->
¨y
[
m
] = (
idåì_œyî
 *)
±r
;

166 
	`£t_bô
(
m
, 
p
->
bôm≠
);

167 
p
->
cou¡
++;

174 
n
 = 
id
;

175 
p
->
bôm≠
 =
IDTREE_FULL
) {

176 i‡(!(
p
 = 
∑
[++
l
]))

178 
n
 =Ç >> 
IDTREE_BITS
;

179 
	`£t_bô
((
n
 & 
IDTREE_MASK
), 
p
->
bôm≠
);

181 (
id
);

182 
	}
}

184 
	$idåì_gë_√w_above_öt
(
idåì
 *
idp
,

185 c⁄° *
±r
, 
°¨tög_id
)

187 
idåì_œyî
 *
p
, *
≤
;

188 
œyîs
, 
v
, 
id
;

190 
	`idåì_¥e_gë
(
idp
);

192 
id
 = 
°¨tög_id
;

193 
buûd_up
:

194 
p
 = 
idp
->
t›
;

195 
œyîs
 = 
idp
->layers;

196 i‡(!
p
) {

197 i‡(!(
p
 = 
	`Æloc_œyî
(
idp
)))

199 
œyîs
 = 1;

205 (
œyîs
 < 
MAX_LEVEL
Ë&& (
id
 >(1 << (œyîs*
IDTREE_BITS
)))) {

206 
œyîs
++;

207 i‡(!
p
->
cou¡
)

209 i‡(!(
≤
 = 
	`Æloc_œyî
(
idp
))) {

214 
≤
 = 
p
;Ö &&Ö !
idp
->
t›
;Ön =Ö) {

215 
p
 =Ö->
¨y
[0];

216 
≤
->
¨y
[0] = 
NULL
;

217 
≤
->
bôm≠
 =Ön->
cou¡
 = 0;

218 
	`‰ì_œyî
(
idp
, 
≤
);

222 
≤
->
¨y
[0] = 
p
;

223 
≤
->
cou¡
 = 1;

224 i‡(
p
->
bôm≠
 =
IDTREE_FULL
)

225 
	`£t_bô
(0, 
≤
->
bôm≠
);

226 
p
 = 
≤
;

228 
idp
->
t›
 = 
p
;

229 
idp
->
œyîs
 =Üayers;

230 
v
 = 
	`sub_Æloc
(
idp
, 
±r
, &
id
);

231 i‡(
v
 == -2)

232 
buûd_up
;

233 (
v
);

234 
	}
}

236 
	$sub_ªmove
(
idåì
 *
idp
, 
shi·
, 
id
)

238 
idåì_œyî
 *
p
 = 
idp
->
t›
;

239 
idåì_œyî
 **
∑
[1+
MAX_LEVEL
];

240 
idåì_œyî
 ***
∑a
 = &
∑
[0];

241 
n
;

243 *
∑a
 = 
NULL
;

244 *++
∑a
 = &
idp
->
t›
;

246 (
shi·
 > 0Ë&& 
p
) {

247 
n
 = (
id
 >> 
shi·
Ë& 
IDTREE_MASK
;

248 
	`˛ór_bô
(
n
, 
p
->
bôm≠
);

249 *++
∑a
 = &
p
->
¨y
[
n
];

250 
p
 =Ö->
¨y
[
n
];

251 
shi·
 -
IDTREE_BITS
;

253 
n
 = 
id
 & 
IDTREE_MASK
;

254 i‡(
p
 !
NULL
 && 
	`ã°_bô
(
n
,Ö->
bôm≠
)) {

255 
	`˛ór_bô
(
n
, 
p
->
bôm≠
);

256 
p
->
¨y
[
n
] = 
NULL
;

257 *
∑a
 && ! --((**∑a)->
cou¡
)){

258 
	`‰ì_œyî
(
idp
, **
∑a
);

259 **
∑a
-- = 
NULL
;

261 i‡–! *
∑a
 )

262 
idp
->
œyîs
 = 0;

266 
	}
}

268 *
	$idåì_lookup
(c⁄° 
idåì
 *
idp
, 
id
)

270 
n
;

271 
idåì_œyî
 *
p
;

273 
n
 = 
idp
->
œyîs
 * 
IDTREE_BITS
;

274 
p
 = 
idp
->
t›
;

279 i‡(
n
 + 
IDTREE_BITS
 < 31 &&

280 (
id
 & ~(~0 << 
MAX_ID_SHIFT
)Ë>> (
n
 + 
IDTREE_BITS
))

281  
NULL
;

284 
id
 &
MAX_ID_MASK
;

286 
n
 >
IDTREE_BITS
 && 
p
) {

287 
n
 -
IDTREE_BITS
;

288 
p
 =Ö->
¨y
[(
id
 >> 
n
Ë& 
IDTREE_MASK
];

290 ((*)
p
);

291 
	}
}

293 
boﬁ
 
	$idåì_ªmove
(
idåì
 *
idp
, 
id
)

295 
idåì_œyî
 *
p
;

298 
id
 &
MAX_ID_MASK
;

300 i‡(
	`sub_ªmove
(
idp
, (idp->
œyîs
 - 1Ë* 
IDTREE_BITS
, 
id
) == -1) {

301  
Ál£
;

304 i‡–
idp
->
t›
 && idp->t›->
cou¡
 == 1 &&

305 (
idp
->
œyîs
 > 1) &&

306 
idp
->
t›
->
¨y
[0]) {

308 
p
 = 
idp
->
t›
->
¨y
[0];

309 
idp
->
t›
->
bôm≠
 = idp->t›->
cou¡
 = 0;

310 
	`‰ì_œyî
(
idp
, idp->
t›
);

311 
idp
->
t›
 = 
p
;

312 --
idp
->
œyîs
;

314 
idp
->
id_‰ì_˙t
 >
IDTREE_FREE_MAX
) {

315 
p
 = 
	`Æloc_œyî
(
idp
);

316 
	`èŒoc_‰ì
(
p
);

318  
åue
;

319 
	}
}

321 
idåì
 *
	$idåì_√w
(*
mem_˘x
)

323  
	`èŒoc_zîo
(
mem_˘x
, 
idåì
);

324 
	}
}

326 
	$idåì_add
(
idåì
 *
idp
, c⁄° *
±r
, 
limô
)

328 
ªt
 = 
	`idåì_gë_√w_above_öt
(
idp
, 
±r
, 0);

329 i‡(
ªt
 > 
limô
) {

330 
	`idåì_ªmove
(
idp
, 
ªt
);

333  
ªt
;

334 
	}
}

336 
	$idåì_add_above
(
idåì
 *
idp
, c⁄° *
±r
,

337 
°¨tög_id
, 
limô
)

339 
ªt
 = 
	`idåì_gë_√w_above_öt
(
idp
, 
±r
, 
°¨tög_id
);

340 i‡(
ªt
 > 
limô
) {

341 
	`idåì_ªmove
(
idp
, 
ªt
);

344  
ªt
;

345 
	}
}

	@ccan/ccan/idtree/idtree.h

2 #i‚de‡
CCAN_IDTREE_H


3 
	#CCAN_IDTREE_H


	)

4 
	~<°dboﬁ.h
>

22 
idåì
 *
idåì_√w
(*
mem_˘x
);

55 
idåì_add
(
idåì
 *idåì, c⁄° *
±r
, 
limô
);

89 
idåì_add_above
(
idåì
 *idåì, c⁄° *
±r
,

90 
°¨tög_id
, 
limô
);

107 *
idåì_lookup
(c⁄° 
idåì
 *idåì, 
id
);

125 
boﬁ
 
idåì_ªmove
(
idåì
 *idåì, 
id
);

	@ccan/ccan/idtree/test/run-wrap.c

1 
	~<cˇn/idåì/idåì.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<limôs.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 
i
;

8 
idåì
 *idtree;

10 
	`∂™_ã°s
(6);

11 
idåì
 = 
	`idåì_√w
(
NULL
);

13 
	`ok1
(
	`idåì_add_above
(
idåì
, &
i
, 
INT_MAX
-1, INT_MAX) == INT_MAX-1);

14 
	`ok1
(
	`idåì_add_above
(
idåì
, &
i
, 
INT_MAX
-1, INT_MAX) == INT_MAX);

15 
	`ok1
(
	`idåì_add_above
(
idåì
, &
i
, 
INT_MAX
-1, INT_MAX) == -1);

17 
	`ok1
(
	`idåì_ªmove
(
idåì
, 
INT_MAX
-1Ë=
åue
);

18 
	`ok1
(
	`idåì_add_above
(
idåì
, &
i
, 
INT_MAX
-1, INT_MAX) == INT_MAX-1);

19 
	`ok1
(
	`idåì_add_above
(
idåì
, &
i
, 
INT_MAX
-1, INT_MAX) == -1);

20 
	`èŒoc_‰ì
(
idåì
);

21 
	`exô
(
	`exô_°©us
());

22 
	}
}

	@ccan/ccan/idtree/test/run.c

1 
	~<cˇn/idåì/idåì.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<limôs.h
>

5 
	#ALLOC_MAX
 (2 * 
IDTREE_SIZE
)

	)

7 
	$maö
(
¨gc
, *
¨gv
[])

9 
i
;

10 c⁄° 
Æloˇãd
[
ALLOC_MAX
] = { 0 };

11 
idåì
 *idtree;

12 *
˘x
;

14 
	`∂™_ã°s
(
ALLOC_MAX
 * 5 + 2);

15 
˘x
 = 
	`èŒoc_«med_c⁄°
(
NULL
, 1, "testÑoot");

16 
idåì
 = 
	`idåì_√w
(
˘x
);

17 
	`ok1
(
	`èŒoc_föd_∑ª¡_by«me
(
idåì
, "ã°ÑoŸ"Ë=
˘x
);

19 
i
 = 0; i < 
ALLOC_MAX
; i++) {

20 
id
 = 
	`idåì_add
(
idåì
, &
Æloˇãd
[
i
], 
ALLOC_MAX
-1);

21 
	`ok1
(
id
 =
i
);

22 
	`ok1
(
	`idåì_lookup
(
idåì
, 
i
Ë=&
Æloˇãd
[i]);

24 
	`ok1
(
	`idåì_add
(
idåì
, &
Æloˇãd
[
i
], 
ALLOC_MAX
-1) == -1);

27 
i
 = 0; i < 
ALLOC_MAX
; i += 2)

28 
	`ok1
(
	`idåì_ªmove
(
idåì
, 
i
));

30 
i
 = 0; i < 
ALLOC_MAX
; i++) {

31 i‡(
i
 % 2 == 0)

32 
	`ok1
(!
	`idåì_lookup
(
idåì
, 
i
));

34 
	`ok1
(
	`idåì_lookup
(
idåì
, 
i
Ë=&
Æloˇãd
[i]);

38 
i
 = 0; i < 
ALLOC_MAX
/2; i++) {

39 
	`ok1
(
	`idåì_add
(
idåì
, &
Æloˇãd
[
i
*2], 
INT_MAX
) == i * 2);

42 
i
 = 0; i < 
ALLOC_MAX
; i++) {

43 
	`ok1
(
	`idåì_lookup
(
idåì
, 
i
Ë=&
Æloˇãd
[i]);

45 
	`èŒoc_‰ì
(
˘x
);

46 
	`exô
(
	`exô_°©us
());

47 
	}
}

	@ccan/ccan/ilog/ilog.c

3 
	~"ûog.h
"

4 
	~<limôs.h
>

20 
UNNEEDED
 c⁄° 
	gDEBRUIJN_IDX32
[32]={

26 #unde‡
ûog32_nz


27 #unde‡
ûog32


28 #unde‡
ûog64_nz


29 #unde‡
ûog64


31 
	$ûog32
(
uöt32_t
 
_v
){

35 #i‡
	`deföed
(
ILOG_NODEBRUIJN
)

36 
ªt
;

37 
m
;

38 
ªt
=
_v
>0;

39 
m
=(
_v
>0xFFFFU)<<4;

40 
_v
>>=
m
;

41 
ªt
|=
m
;

42 
m
=(
_v
>0xFFU)<<3;

43 
_v
>>=
m
;

44 
ªt
|=
m
;

45 
m
=(
_v
>0xFU)<<2;

46 
_v
>>=
m
;

47 
ªt
|=
m
;

48 
m
=(
_v
>3)<<1;

49 
_v
>>=
m
;

50 
ªt
|=
m
;

51 
ªt
+=
_v
>1;

52  
ªt
;

55 
ªt
;

56 
ªt
=
_v
>0;

57 
_v
|=_v>>1;

58 
_v
|=_v>>2;

59 
_v
|=_v>>4;

60 
_v
|=_v>>8;

61 
_v
|=_v>>16;

62 
_v
=(_v>>1)+1;

63 
ªt
+=
DEBRUIJN_IDX32
[
_v
*0x77CB531U>>27&0x1F];

64  
ªt
;

66 
	}
}

68 
	$ûog32_nz
(
uöt32_t
 
_v
)

70  
	`ûog32
(
_v
);

71 
	}
}

73 
	$ûog64
(
uöt64_t
 
_v
){

74 #i‡
	`deföed
(
ILOG_NODEBRUIJN
)

75 
uöt32_t
 
v
;

76 
ªt
;

77 
m
;

78 
ªt
=
_v
>0;

79 
m
=(
_v
>0xFFFFFFFFU)<<5;

80 
v
=(
uöt32_t
)(
_v
>>
m
);

81 
ªt
|=
m
;

82 
m
=(
v
>0xFFFFU)<<4;

83 
v
>>=
m
;

84 
ªt
|=
m
;

85 
m
=(
v
>0xFFU)<<3;

86 
v
>>=
m
;

87 
ªt
|=
m
;

88 
m
=(
v
>0xFU)<<2;

89 
v
>>=
m
;

90 
ªt
|=
m
;

91 
m
=(
v
>3)<<1;

92 
v
>>=
m
;

93 
ªt
|=
m
;

94 
ªt
+=
v
>1;

95  
ªt
;

98 #i‡
LONG_MAX
<9223372036854775807LL

99 
uöt32_t
 
v
;

100 
ªt
;

101 
m
;

102 
ªt
=
_v
>0;

103 
m
=(
_v
>0xFFFFFFFFU)<<5;

104 
v
=(
uöt32_t
)(
_v
>>
m
);

105 
ªt
|=
m
;

106 
v
|=v>>1;

107 
v
|=v>>2;

108 
v
|=v>>4;

109 
v
|=v>>8;

110 
v
|=v>>16;

111 
v
=(v>>1)+1;

112 
ªt
+=
DEBRUIJN_IDX32
[
v
*0x77CB531U>>27&0x1F];

113  
ªt
;

116 c⁄° 
DEBRUIJN_IDX64
[64]={

122 
ªt
;

123 
ªt
=
_v
>0;

124 
_v
|=_v>>1;

125 
_v
|=_v>>2;

126 
_v
|=_v>>4;

127 
_v
|=_v>>8;

128 
_v
|=_v>>16;

129 
_v
|=_v>>32;

130 
_v
=(_v>>1)+1;

131 
ªt
+=
DEBRUIJN_IDX64
[
_v
*0x218A392CD3D5DBF>>58&0x3F];

132  
ªt
;

135 
	}
}

137 
	$ûog64_nz
(
uöt64_t
 
_v
)

139  
	`ûog64
(
_v
);

140 
	}
}

	@ccan/ccan/ilog/ilog.h

2 #i‡!
deföed
(
_ûog_H
)

3 
	#_ûog_H
 (1)

	)

4 
	~"c⁄fig.h
"

5 
	~<°döt.h
>

6 
	~<limôs.h
>

7 
	~<cˇn/compûî/compûî.h
>

28 
	$ûog32
(
uöt32_t
 
_v
Ë
CONST_FUNCTION
;

47 
	$ûog32_nz
(
uöt32_t
 
_v
Ë
CONST_FUNCTION
;

59 
	$ûog64
(
uöt64_t
 
_v
Ë
CONST_FUNCTION
;

71 
	$ûog64_nz
(
uöt64_t
 
_v
Ë
CONST_FUNCTION
;

86 
	#STATIC_ILOG_32
(
_v
Ë(
	`STATIC_ILOG5
((
uöt32_t
)(_v)))

	)

97 
	#STATIC_ILOG_64
(
_v
Ë(
	`STATIC_ILOG6
((
uöt64_t
)(_v)))

	)

103 #i‡
INT_MAX
>=2147483647 && 
HAVE_BUILTIN_CLZ


104 
	#buûtö_ûog32_nz
(
v
) \

105 ((()()*
CHAR_BIT
Ë- 
	`__buûtö_˛z
(
v
))

	)

106 #ñi‡
LONG_MAX
>=2147483647L && 
HAVE_BUILTIN_CLZL


107 
	#buûtö_ûog32_nz
(
v
) \

108 ((()()*
CHAR_BIT
Ë- 
	`__buûtö_˛zl
(
v
))

	)

111 #i‡
INT_MAX
>=9223372036854775807LL && 
HAVE_BUILTIN_CLZ


112 
	#buûtö_ûog64_nz
(
v
) \

113 ((()()*
CHAR_BIT
Ë- 
	`__buûtö_˛z
(
v
))

	)

114 #ñi‡
LONG_MAX
>=9223372036854775807LL && 
HAVE_BUILTIN_CLZL


115 
	#buûtö_ûog64_nz
(
v
) \

116 ((()()*
CHAR_BIT
Ë- 
	`__buûtö_˛zl
(
v
))

	)

117 #ñi‡
HAVE_BUILTIN_CLZLL


118 
	#buûtö_ûog64_nz
(
v
) \

119 ((()()*
CHAR_BIT
Ë- 
	`__buûtö_˛zŒ
(
v
))

	)

122 #ifde‡
buûtö_ûog32_nz


123 
	#ûog32
(
_v
Ë(
	`buûtö_ûog32_nz
(_v)&-!!(_v))

	)

124 
	#ûog32_nz
(
_v
Ë
	`buûtö_ûog32_nz
(_v)

	)

126 
	#ûog32_nz
(
_v
Ë
	`ûog32
(_v)

	)

127 
	#ûog32
(
_v
Ë(
	`IS_COMPILE_CONSTANT
(_vË? 
	`STATIC_ILOG_32
(_vË: 
	`ûog32
(_v))

	)

130 #ifde‡
buûtö_ûog64_nz


131 
	#ûog64
(
_v
Ë(
	`buûtö_ûog64_nz
(_v)&-!!(_v))

	)

132 
	#ûog64_nz
(
_v
Ë
	`buûtö_ûog64_nz
(_v)

	)

134 
	#ûog64_nz
(
_v
Ë
	`ûog64
(_v)

	)

135 
	#ûog64
(
_v
Ë(
	`IS_COMPILE_CONSTANT
(_vË? 
	`STATIC_ILOG_64
(_vË: 
	`ûog64
(_v))

	)

139 
	#STATIC_ILOG0
(
_v
Ë(!!(_v))

	)

140 
	#STATIC_ILOG1
(
_v
Ë(((_v)&0x2)?2:
	`STATIC_ILOG0
(_v))

	)

141 
	#STATIC_ILOG2
(
_v
Ë(((_v)&0xC)?2+
	`STATIC_ILOG1
((_v)>>2):STATIC_ILOG1(_v))

	)

142 
	#STATIC_ILOG3
(
_v
) \

143 (((
_v
)&0xF0)?4+
	`STATIC_ILOG2
((_v)>>4):STATIC_ILOG2(_v))

	)

144 
	#STATIC_ILOG4
(
_v
) \

145 (((
_v
)&0xFF00)?8+
	`STATIC_ILOG3
((_v)>>8):STATIC_ILOG3(_v))

	)

146 
	#STATIC_ILOG5
(
_v
) \

147 (((
_v
)&0xFFFF0000)?16+
	`STATIC_ILOG4
((_v)>>16):STATIC_ILOG4(_v))

	)

148 
	#STATIC_ILOG6
(
_v
) \

149 (((
_v
)&0xFFFFFFFF00000000ULL)?32+
	`STATIC_ILOG5
((_v)>>32):STATIC_ILOG5(_v))

	)

	@ccan/ccan/ilog/test/run-out-of-line.c

1 
	~<cˇn/ûog/ûog.h
>

2 
	~<cˇn/ûog/ûog.c
>

3 
	~<°dio.h
>

4 
	~<cˇn/èp/èp.h
>

8 
	$ã°_ûog32
(
uöt32_t
 
_v
){

9 
ªt
;

10 
ªt
=0;
_v
;ret++)_v>>=1;

11  
ªt
;

12 
	}
}

14 
	$ã°_ûog64
(
uöt64_t
 
_v
){

15 
ªt
;

16 
ªt
=0;
_v
;ret++)_v>>=1;

17  
ªt
;

18 
	}
}

20 
	#NTRIALS
 (64)

	)

22 
	$maö
(
_¨gc
,c⁄° *
_¨gv
[]){

23 
i
;

24 
j
;

25 (*
û32
)(
uöt32_t
Ë
ûog32
;

26 (*
û64
)(
uöt64_t
Ë
ûog64
;

27 (*
û32_nz
)(
uöt32_t
Ë
ûog32_nz
;

28 (*
û64_nz
)(
uöt64_t
Ë
ûog64_nz
;

31 
	`∂™_ã°s
(33 * 
NTRIALS
 * 3 + 65 * NTRIALS * 3);

32 
i
=0;i<=32;i++){

33 
uöt32_t
 
v
;

35 
v
=
i
?(
uöt32_t
)1U<<(i-1):0;

36 
j
=0;j<
NTRIALS
;j++){

37 
l
;

38 
l
=
	`ã°_ûog32
(
v
);

39 
	`ok1
(
	`STATIC_ILOG_32
(
v
)==
l
);

40 
	`ok1
(
	`û32
(
v
)==
l
);

41 
	`ok1
(
	`û32_nz
(
v
Ë=
l
 || v == 0);

44 
v
=(1103515245U*v+12345U)&0xFFFFFFFFU>>((33-
i
)>>1)>>((32-i)>>1);

48 
i
=0;i<=64;i++){

49 
uöt64_t
 
v
;

51 
v
=
i
?(
uöt64_t
)1U<<(i-1):0;

52 
j
=0;j<
NTRIALS
;j++){

53 
l
;

54 
l
=
	`ã°_ûog64
(
v
);

55 
	`ok1
(
	`STATIC_ILOG_64
(
v
)==
l
);

56 
	`ok1
(
	`û64
(
v
)==
l
);

57 
	`ok1
(
	`û64_nz
(
v
Ë=
l
 || v == 0);

60 
v
=(
uöt64_t
)((2862933555777941757ULL*v+3037000493ULL)

61 &0xFFFFFFFFFFFFFFFFULL>>((65-
i
)>>1)>>((64-i)>>1));

64  
	`exô_°©us
();

65 
	}
}

	@ccan/ccan/ilog/test/run.c

1 
	~<cˇn/ûog/ûog.h
>

2 
	~<cˇn/ûog/ûog.c
>

3 
	~<°dio.h
>

4 
	~<cˇn/èp/èp.h
>

8 
	$ã°_ûog32
(
uöt32_t
 
_v
){

9 
ªt
;

10 
ªt
=0;
_v
;ret++)_v>>=1;

11  
ªt
;

12 
	}
}

14 
	$ã°_ûog64
(
uöt64_t
 
_v
){

15 
ªt
;

16 
ªt
=0;
_v
;ret++)_v>>=1;

17  
ªt
;

18 
	}
}

20 
	#NTRIALS
 (64)

	)

22 
	$maö
(
_¨gc
,c⁄° *
_¨gv
[]){

23 
i
;

24 
j
;

26 
	`∂™_ã°s
(33 * 
NTRIALS
 * 3 + 65 * NTRIALS * 3);

27 
i
=0;i<=32;i++){

28 
uöt32_t
 
v
;

30 
v
=
i
?(
uöt32_t
)1U<<(i-1):0;

31 
j
=0;j<
NTRIALS
;j++){

32 
l
;

33 
l
=
	`ã°_ûog32
(
v
);

34 
	`ok1
(
	`STATIC_ILOG_32
(
v
)==
l
);

35 
	`ok1
(
	`ûog32
(
v
)==
l
);

36 
	`ok1
(
	`ûog32_nz
(
v
Ë=
l
 || v == 0);

39 
v
=(1103515245U*v+12345U)&0xFFFFFFFFU>>((33-
i
)>>1)>>((32-i)>>1);

43 
i
=0;i<=64;i++){

44 
uöt64_t
 
v
;

46 
v
=
i
?(
uöt64_t
)1U<<(i-1):0;

47 
j
=0;j<
NTRIALS
;j++){

48 
l
;

49 
l
=
	`ã°_ûog64
(
v
);

50 
	`ok1
(
	`STATIC_ILOG_64
(
v
)==
l
);

51 
	`ok1
(
	`ûog64
(
v
)==
l
);

52 
	`ok1
(
	`ûog64_nz
(
v
Ë=
l
 || v == 0);

55 
v
=(
uöt64_t
)((2862933555777941757ULL*v+3037000493ULL)

56 &0xFFFFFFFFFFFFFFFFULL>>((65-
i
)>>1)>>((64-i)>>1));

59  
	`exô_°©us
();

60 
	}
}

	@ccan/ccan/io/backend.h

2 #i‚de‡
CCAN_IO_BACKEND_H


3 
	#CCAN_IO_BACKEND_H


	)

4 
	~<°dboﬁ.h
>

5 
	~<cˇn/timî/timî.h
>

7 
	sio_Æloc
 {

8 *(*
	mÆloc
)(
size_t
 
	msize
);

9 *(*
	mªÆloc
)(*
	m±r
, 
size_t
 
	msize
);

10 (*
	m‰ì
)(*
	m±r
);

12 
io_Æloc
 io_alloc;

14 
	sfd
 {

15 
	mfd
;

16 
boﬁ
 
	mli°íî
;

17 
size_t
 
	mbackíd_öfo
;

21 
	sio_li°íî
 {

22 
fd
 
	mfd
;

25 (*
	möô
)(
	mfd
, *
	m¨g
);

26 *
	m¨g
;

29 
	sio_timeout
 {

30 
timî
 
	mtimî
;

31 
io_c⁄n
 *
	mc⁄n
;

33 
io_∂™
 (*
√xt
)(
	mio_c⁄n
 *, *
	m¨g
);

34 *
	m√xt_¨g
;

38 
	sio_c⁄n
 {

39 
fd
 
	mfd
;

41 (*
	mföish
)(
	mio_c⁄n
 *, *
	m¨g
);

42 *
	mföish_¨g
;

44 
io_c⁄n
 *
	mdu∂ex
;

45 
io_timeout
 *
	mtimeout
;

47 
io_∂™
 
	m∂™
;

50 
ölöe
 
boﬁ
 
	$timeout_a˘ive
(c⁄° 
io_c⁄n
 *
c⁄n
)

52  
c⁄n
->
timeout
 && conn->timeout->conn;

53 
	}
}

55 *
io_lo›_ªtu∫
;

57 #ifde‡
DEBUG


58 
io_c⁄n
 *
cuºít
;

59 
ölöe
 
	$£t_cuºít
(
io_c⁄n
 *
c⁄n
)

61 
cuºít
 = 
c⁄n
;

62 
	}
}

63 
ölöe
 
boﬁ
 
	$doög_debug_⁄
(
io_c⁄n
 *
c⁄n
)

65  
io_debug_c⁄n
 && 
	`io_debug_c⁄n
(
c⁄n
);

66 
	}
}

67 
ölöe
 
boﬁ
 
	$doög_debug
()

69  
io_debug_c⁄n
;

70 
	}
}

72 
ölöe
 
	$£t_cuºít
(
io_c⁄n
 *
c⁄n
)

74 
	}
}

75 
ölöe
 
boﬁ
 
	$doög_debug_⁄
(
io_c⁄n
 *
c⁄n
)

77  
Ál£
;

78 
	}
}

79 
ölöe
 
boﬁ
 
	$doög_debug
()

81  
Ál£
;

82 
	}
}

85 
boﬁ
 
add_li°íî
(
io_li°íî
 *
l
);

86 
boﬁ
 
add_c⁄n
(
io_c⁄n
 *
c
);

87 
boﬁ
 
add_du∂ex
(
io_c⁄n
 *
c
);

88 
dñ_li°íî
(
io_li°íî
 *
l
);

89 
backíd_∂™_ch™ged
(
io_c⁄n
 *
c⁄n
);

90 
backíd_add_timeout
(
io_c⁄n
 *
c⁄n
, 
time•ec
 
ts
);

91 
backíd_dñ_timeout
(
io_c⁄n
 *
c⁄n
);

92 
backíd_dñ_c⁄n
(
io_c⁄n
 *
c⁄n
);

94 
io_ªady
(
io_c⁄n
 *
c⁄n
);

95 *
do_io_lo›
(
io_c⁄n
 **
ªady
);

	@ccan/ccan/io/benchmarks/run-different-speed.c

3 
	~<cˇn/io/io.h
>

4 
	~<cˇn/time/time.h
>

5 
	~<cˇn/îr/îr.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/sockë.h
>

8 
	~<sys/un.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

11 
	~<f˙é.h
>

12 
	~<î∫o.h
>

13 
	~<°dio.h
>

14 
	~<sig«l.h
>

16 
	#REQUEST_SIZE
 1024

	)

17 
	#REPLY_SIZE
 10240

	)

18 
	#NUM_CONNS
 500

	)

19 
	#NUM_CHILDREN
 2

	)

21 
	gcom∂ëed
;

23 
	s˛õ¡
 {

24 
	mªque°_buf„r
[
REQUEST_SIZE
];

25 
	mª∂y_buf„r
[
REPLY_SIZE
];

28 
io_∂™
 
wrôe_ª∂y
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client);

29 
io_∂™
 
	$ªad_ªque°
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client)

31  
	`io_ªad
(
˛õ¡
->
ªque°_buf„r
, 
REQUEST_SIZE
,

32 
wrôe_ª∂y
, 
˛õ¡
);

33 
	}
}

36 
io_∂™
 
	$wrôe_com∂ëe
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client)

38 
com∂ëed
++;

39  
	`ªad_ªque°
(
c⁄n
, 
˛õ¡
);

40 
	}
}

42 
io_∂™
 
	$wrôe_ª∂y
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client)

44  
	`io_wrôe
(
˛õ¡
->
ª∂y_buf„r
, 
REPLY_SIZE
,

45 
wrôe_com∂ëe
, 
˛õ¡
);

46 
	}
}

49 
	$¸óã_˛õ¡s
(
sockaddr_un
 *
addr
, 
waôfd
)

51 
˛õ¡
 
d©a
;

52 
i
, 
sock
[
NUM_CONNS
], 
•ìd
[NUM_CONNS], 
d⁄e
[NUM_CONNS], 
cou¡
 = 0;

54 
i
 = 0; i < 
NUM_CONNS
; i++) {

56 
•ìd
[
i
] = (1 << (
	`øndom
() % 10));

57 
sock
[
i
] = 
	`sockë
(
AF_UNIX
, 
SOCK_STREAM
, 0);

58 i‡(
sock
[
i
] < 0)

59 
	`îr
(1, "creating socket");

60 i‡(
	`c⁄√˘
(
sock
[
i
], (*)
addr
, (*addr)) != 0)

61 
	`îr
(1, "connecting socket");

63 
	`f˙é
(
sock
[
i
], 
F_SETFD
, f˙é(sock[i], 
F_GETFD
)|
O_NONBLOCK
);

64 
d⁄e
[
i
] = 0;

67 
	`ªad
(
waôfd
, &
i
, 1);

70 
i
 = 0; i < 
NUM_CONNS
; i++) {

71 
ªt
, 
byãs
 = 
•ìd
[
i
];

72 i‡(
d⁄e
[
i
] < 
REQUEST_SIZE
) {

73 i‡(
REQUEST_SIZE
 - 
d⁄e
[
i
] < 
byãs
)

74 
byãs
 = 
REQUEST_SIZE
 - 
d⁄e
[
i
];

75 
ªt
 = 
	`wrôe
(
sock
[
i
], 
d©a
.
ªque°_buf„r
,

76 
byãs
);

77 i‡(
ªt
 > 0)

78 
d⁄e
[
i
] +
ªt
;

79 i‡(
ªt
 < 0 && 
î∫o
 !
EAGAIN
)

80 
Áû
;

82 i‡(
REQUEST_SIZE
 + 
REPLY_SIZE
 - 
d⁄e
[
i
] < 
byãs
)

83 
byãs
 = 
REQUEST_SIZE
 + 
REPLY_SIZE


84 - 
d⁄e
[
i
];

85 
ªt
 = 
	`ªad
(
sock
[
i
], 
d©a
.
ª∂y_buf„r
,

86 
byãs
);

87 i‡(
ªt
 > 0) {

88 
d⁄e
[
i
] +
ªt
;

89 i‡(
d⁄e
[
i
] =
REQUEST_SIZE
 + 
REPLY_SIZE
) {

90 
cou¡
++;

91 
d⁄e
[
i
] = 0;

93 } i‡(
ªt
 < 0 && 
î∫o
 !
EAGAIN
)

94 
Áû
;

98 
Áû
:

99 
	`¥ötf
("Chûd did %u\n", 
cou¡
);

100 
	`exô
(0);

101 
	}
}

103 
	gtimeout
[2];

104 
	$sigÆ¨m
(
sig
)

106 
	`wrôe
(
timeout
[1], "1", 1);

107 
	}
}

109 
io_∂™
 
	$do_timeout
(
io_c⁄n
 *
c⁄n
, *
buf
)

111  
	`io_bªak
(
buf
, 
	`io_idÀ
());

112 
	}
}

114 
	$maö
(
¨gc
, *
¨gv
[])

116 
˛õ¡
 client;

117 
i
, 
j
;

118 
sockaddr_un
 
addr
;

119 
time•ec
 
°¨t
, 
íd
;

120 
fd
, 
wake
[2];

121 
buf
;

123 
addr
.
sun_Ámûy
 = 
AF_UNIX
;

124 
	`•rötf
(
addr
.
sun_∑th
, "/tmp/run-dif„ª¡-•ìd.sock.%u", 
	`gëpid
());

126 i‡(
	`pùe
(
wake
Ë!0 ||Öùe(
timeout
) != 0)

127 
	`îr
(1, "CreatingÖipes");

129 
fd
 = 
	`sockë
(
AF_UNIX
, 
SOCK_STREAM
, 0);

130 i‡(
fd
 < 0)

131 
	`îr
(1, "Creating socket");

133 i‡(
	`böd
(
fd
, (*)&
addr
, (addr)) != 0)

134 
	`îr
(1, "BödögÅÿ%s", 
addr
.
sun_∑th
);

136 i‡(
	`li°í
(
fd
, 
NUM_CONNS
) != 0)

137 
	`îr
(1, "Li°íög o¿%s", 
addr
.
sun_∑th
);

139 
i
 = 0; i < 
NUM_CHILDREN
; i++) {

140 
	`f‹k
()) {

142 
	`îr
(1, "forking");

144 
	`˛o£
(
wake
[1]);

145 
	`¸óã_˛õ¡s
(&
addr
, 
wake
[0]);

148 
j
 = 0; j < 
NUM_CONNS
; j++) {

149 
ªt
 = 
	`ac˚±
(
fd
, 
NULL
, 0);

150 i‡(
ªt
 < 0)

151 
	`îr
(1, "Accepting fd");

153 
	`io_√w_c⁄n
(
ªt
,

154 
	`io_ªad
(
˛õ¡
.
ªque°_buf„r
, 
REQUEST_SIZE
,

155 
wrôe_ª∂y
, &
˛õ¡
));

159 
	`io_√w_c⁄n
(
timeout
[0], 
	`io_ªad
(&
buf
, 1, 
do_timeout
, &buf));

161 
	`˛o£
(
wake
[0]);

162 
i
 = 0; i < 
NUM_CHILDREN
; i++)

163 
	`wrôe
(
wake
[1], "1", 1);

165 
	`sig«l
(
SIGALRM
, 
sigÆ¨m
);

166 
	`Æ¨m
(10);

167 
°¨t
 = 
	`time_now
();

168 
	`io_lo›
();

169 
íd
 = 
	`time_now
();

170 
	`˛o£
(
fd
);

172 
	`¥ötf
("%u connections complete (%uÇsÖer conn)\n",

173 
com∂ëed
,

174 ()
	`time_to_n£c
(
	`time_divide
(
	`time_sub
(
íd
, 
°¨t
), 
com∂ëed
)));

176 
	}
}

	@ccan/ccan/io/benchmarks/run-length-prefix.c

3 
	~<cˇn/io/io.h
>

4 
	~<cˇn/time/time.h
>

5 
	~<cˇn/îr/îr.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/sockë.h
>

8 
	~<sys/un.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

11 
	~<f˙é.h
>

12 
	~<î∫o.h
>

13 
	~<°dio.h
>

14 
	~<sig«l.h
>

15 
	~<as£π.h
>

17 
	#REQUEST_MAX
 131072

	)

18 
	#NUM_CONNS
 500

	)

19 
	#NUM_CHILDREN
 2

	)

21 
	gcom∂ëed
;

23 
	s˛õ¡
 {

24 
	mÀn
;

25 *
	mªque°_buf„r
;

28 
io_∂™
 
wrôe_ª∂y
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client);

29 
io_∂™
 
	$ªad_body
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client)

31 
	`as£π
(
˛õ¡
->
Àn
 <
REQUEST_MAX
);

32  
	`io_ªad
(
˛õ¡
->
ªque°_buf„r
, clõ¡->
Àn
,

33 
wrôe_ª∂y
, 
˛õ¡
);

34 
	}
}

36 
io_∂™
 
	$io_ªad_hódî
(
˛õ¡
 *client)

38  
	`io_ªad
(&
˛õ¡
->
Àn
, (˛õ¡->Àn), 
ªad_body
, client);

39 
	}
}

42 
io_∂™
 
	$wrôe_com∂ëe
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client)

44 
com∂ëed
++;

45  
	`io_ªad_hódî
(
˛õ¡
);

46 
	}
}

48 
io_∂™
 
	$wrôe_ª∂y
(
io_c⁄n
 *
c⁄n
, 
˛õ¡
 *client)

50  
	`io_wrôe
(&
˛õ¡
->
Àn
, (client->len),

51 
wrôe_com∂ëe
, 
˛õ¡
);

52 
	}
}

55 
	$¸óã_˛õ¡s
(
sockaddr_un
 *
addr
, 
waôfd
)

57 
˛õ¡
 
d©a
;

58 
i
, 
sock
[
NUM_CONNS
], 
Àn
[NUM_CONNS], 
d⁄e
[NUM_CONNS],

59 
ªsu…
[
NUM_CONNS
], 
cou¡
 = 0;

61 
i
 = 0; i < 
NUM_CONNS
; i++) {

62 
Àn
[
i
] = (
	`øndom
(Ë% 
REQUEST_MAX
) + 1;

63 
sock
[
i
] = 
	`sockë
(
AF_UNIX
, 
SOCK_STREAM
, 0);

64 i‡(
sock
[
i
] < 0)

65 
	`îr
(1, "creating socket");

66 i‡(
	`c⁄√˘
(
sock
[
i
], (*)
addr
, (*addr)) != 0)

67 
	`îr
(1, "connecting socket");

69 
	`f˙é
(
sock
[
i
], 
F_SETFD
, f˙é(sock[i], 
F_GETFD
)|
O_NONBLOCK
);

70 
d⁄e
[
i
] = 0;

73 
	`ªad
(
waôfd
, &
i
, 1);

76 
i
 = 0; i < 
NUM_CONNS
; i++) {

77 
ªt
, 
tŸÀn
 = 
Àn
[
i
] + (len[i]);

78 i‡(
d⁄e
[
i
] < (
Àn
[i]) +Üen[i]) {

79 
d©a
.
Àn
 =Üí[
i
];

80 
ªt
 = 
	`wrôe
(
sock
[
i
], (*)&
d©a
 + 
d⁄e
[i],

81 
tŸÀn
 - 
d⁄e
[
i
]);

82 i‡(
ªt
 > 0)

83 
d⁄e
[
i
] +
ªt
;

84 i‡(
ªt
 < 0 && 
î∫o
 !
EAGAIN
)

85 
Áû
;

87 
off
 = 
d⁄e
[
i
] - 
tŸÀn
;

88 
ªt
 = 
	`ªad
(
sock
[
i
], (*)&
ªsu…
[i] + 
off
,

89 (
ªsu…
[
i
]Ë- 
off
);

90 i‡(
ªt
 > 0) {

91 
d⁄e
[
i
] +
ªt
;

92 i‡(
d⁄e
[
i
] =
tŸÀn


93 + (
ªsu…
[
i
])) {

94 
	`as£π
(
ªsu…
[
i
] =
Àn
[i]);

95 
cou¡
++;

96 
d⁄e
[
i
] = 0;

98 } i‡(
ªt
 < 0 && 
î∫o
 !
EAGAIN
)

99 
Áû
;

103 
Áû
:

104 
	`¥ötf
("Chûd did %u\n", 
cou¡
);

105 
	`exô
(0);

106 
	}
}

108 
	gtimeout
[2];

109 
	$sigÆ¨m
(
sig
)

111 
	`wrôe
(
timeout
[1], "1", 1);

112 
	}
}

114 
io_∂™
 
	$do_timeout
(
io_c⁄n
 *
c⁄n
, *
buf
)

116  
	`io_bªak
(
buf
, 
	`io_idÀ
());

117 
	}
}

119 
	$maö
(
¨gc
, *
¨gv
[])

121 
i
, 
j
;

122 
sockaddr_un
 
addr
;

123 
time•ec
 
°¨t
, 
íd
;

124 
buf„r
[
REQUEST_MAX
];

125 
fd
, 
wake
[2];

126 
buf
;

128 
addr
.
sun_Ámûy
 = 
AF_UNIX
;

129 
	`•rötf
(
addr
.
sun_∑th
, "/tmp/run-dif„ª¡-•ìd.sock.%u", 
	`gëpid
());

131 i‡(
	`pùe
(
wake
Ë!0 ||Öùe(
timeout
) != 0)

132 
	`îr
(1, "CreatingÖipes");

134 
fd
 = 
	`sockë
(
AF_UNIX
, 
SOCK_STREAM
, 0);

135 i‡(
fd
 < 0)

136 
	`îr
(1, "Creating socket");

138 i‡(
	`böd
(
fd
, (*)&
addr
, (addr)) != 0)

139 
	`îr
(1, "BödögÅÿ%s", 
addr
.
sun_∑th
);

141 i‡(
	`li°í
(
fd
, 
NUM_CONNS
) != 0)

142 
	`îr
(1, "Li°íög o¿%s", 
addr
.
sun_∑th
);

144 
i
 = 0; i < 
NUM_CHILDREN
; i++) {

145 
	`f‹k
()) {

147 
	`îr
(1, "forking");

149 
	`˛o£
(
wake
[1]);

150 
	`¸óã_˛õ¡s
(&
addr
, 
wake
[0]);

153 
j
 = 0; j < 
NUM_CONNS
; j++) {

154 
˛õ¡
 *˛õ¡ = 
	`mÆloc
((*client));

155 
ªt
 = 
	`ac˚±
(
fd
, 
NULL
, 0);

156 i‡(
ªt
 < 0)

157 
	`îr
(1, "Accepting fd");

159 
˛õ¡
->
ªque°_buf„r
 = 
buf„r
;

160 
	`io_√w_c⁄n
(
ªt
, 
	`io_ªad_hódî
(
˛õ¡
));

164 
	`io_√w_c⁄n
(
timeout
[0], 
	`io_ªad
(&
buf
, 1, 
do_timeout
, &buf));

166 
	`˛o£
(
wake
[0]);

167 
i
 = 0; i < 
NUM_CHILDREN
; i++)

168 
	`wrôe
(
wake
[1], "1", 1);

170 
	`sig«l
(
SIGALRM
, 
sigÆ¨m
);

171 
	`Æ¨m
(10);

172 
°¨t
 = 
	`time_now
();

173 
	`io_lo›
();

174 
íd
 = 
	`time_now
();

175 
	`˛o£
(
fd
);

177 
	`¥ötf
("%u connections complete (%uÇsÖer conn)\n",

178 
com∂ëed
,

179 ()
	`time_to_n£c
(
	`time_divide
(
	`time_sub
(
íd
, 
°¨t
), 
com∂ëed
)));

181 
	}
}

	@ccan/ccan/io/benchmarks/run-loop.c

1 
	~<cˇn/io/io.h
>

2 
	~<cˇn/time/time.h
>

3 
	~<sys/waô.h
>

4 
	~<°dio.h
>

5 
	~<°rög.h
>

6 
	~<as£π.h
>

7 
	~<îr.h
>

8 
	~<sig«l.h
>

10 
	#NUM
 500

	)

11 
	#NUM_ITERS
 10000

	)

13 
	sbuf„r
 {

14 
	môîs
;

15 
io_c⁄n
 *
	mªadî
, *
	mwrôî
;

16 
	mbuf
[32];

19 
io_∂™
 
poke_ªadî
(
io_c⁄n
 *
c⁄n
, 
buf„r
 *
buf
);

21 
io_∂™
 
	$poke_wrôî
(
io_c⁄n
 *
c⁄n
, 
buf„r
 *
buf
)

23 
	`as£π
(
c⁄n
 =
buf
->
ªadî
);

25 i‡(
buf
->
ôîs
 =
NUM_ITERS
)

26  
	`io_˛o£
();

29 
	`io_wake
(
buf
->
wrôî
,

30 
	`io_wrôe
(&
buf
->buf, (buf->buf), 
poke_ªadî
, buf));

33  
	`io_idÀ
();

34 
	}
}

36 
io_∂™
 
	$poke_ªadî
(
io_c⁄n
 *
c⁄n
, 
buf„r
 *
buf
)

38 
	`as£π
(
c⁄n
 =
buf
->
wrôî
);

40 
	`io_wake
(
buf
->
ªadî
,

41 
	`io_ªad
(&
buf
->buf, (buf->buf), 
poke_wrôî
, buf));

43 i‡(++
buf
->
ôîs
 =
NUM_ITERS
)

44  
	`io_˛o£
();

47  
	`io_idÀ
();

48 
	}
}

50 
	$maö
()

52 
i
;

53 
fds
[2], 
œ°_ªad
, 
œ°_wrôe
;

54 
time•ec
 
°¨t
, 
íd
;

55 
buf„r
 
buf
[
NUM
];

57 i‡(
	`pùe
(
fds
) != 0)

58 
	`îr
(1, "pipe");

59 
œ°_ªad
 = 
fds
[0];

60 
œ°_wrôe
 = 
fds
[1];

62 
i
 = 1; i < 
NUM
; i++) {

63 
buf
[
i
].
ôîs
 = 0;

64 i‡(
	`pùe
(
fds
) < 0)

65 
	`îr
(1, "pipe");

66 
	`mem£t
(
buf
[
i
].buf, i, (buf[i].buf));

67 
	`•rötf
(
buf
[
i
].buf, "%i-%i", i, i);

69 
buf
[
i
].
ªadî
 = 
	`io_√w_c⁄n
(
œ°_ªad
, 
	`io_idÀ
());

70 i‡(!
buf
[
i
].
ªadî
)

71 
	`îr
(1, "Cª©ögÑódî %i", 
i
);

72 
buf
[
i
].
wrôî
 = 
	`io_√w_c⁄n
(
fds
[1],

73 
	`io_wrôe
(&
buf
[
i
].buf,

74 (
buf
[
i
].buf),

75 
poke_ªadî
, &
buf
[
i
]));

76 i‡(!
buf
[
i
].
wrôî
)

77 
	`îr
(1, "Cª©ög wrôî %i", 
i
);

78 
œ°_ªad
 = 
fds
[0];

82 
i
 = 0;

83 
buf
[
i
].
ôîs
 = 0;

84 
	`•rötf
(
buf
[
i
].buf, "%i-%i", i, i);

85 
buf
[
i
].
ªadî
 = 
	`io_√w_c⁄n
(
œ°_ªad
, 
	`io_idÀ
());

86 i‡(!
buf
[
i
].
ªadî
)

87 
	`îr
(1, "Cª©ögÑódî %i", 
i
);

88 
buf
[
i
].
wrôî
 = 
	`io_√w_c⁄n
(
œ°_wrôe
, 
	`io_wrôe
(&buf[i].buf,

89 (
buf
[
i
].buf),

90 
poke_ªadî
, &
buf
[
i
]));

91 i‡(!
buf
[
i
].
wrôî
)

92 
	`îr
(1, "Cª©ög wrôî %i", 
i
);

95 
°¨t
 = 
	`time_now
();

96 i‡(
	`io_lo›
(Ë!
NULL
)

97 
	`îrx
(1, "io_loop?");

98 
íd
 = 
	`time_now
();

100 
i
 = 0; i < 
NUM
; i++) {

101 
b
[(
buf
[0].buf)];

102 
	`mem£t
(
b
, 
i
, (b));

103 
	`•rötf
(
b
, "%i-%i", 
i
, i);

104 i‡(
	`memcmp
(
b
, 
buf
[(
i
 + 
NUM_ITERS
Ë% 
NUM
].buf, (b)) != 0)

105 
	`îrx
(1, "Buffer for %i was '%s'Çot '%s'",

106 
i
, 
buf
[(ò+ 
NUM_ITERS
Ë% 
NUM
].buf, 
b
);

109 
	`¥ötf
("run-many: %u %u iterations: %llu usec\n",

110 
NUM
, 
NUM_ITERS
, ()
	`time_to_u£c
(
	`time_sub
(
íd
, 
°¨t
)));

112 
	}
}

	@ccan/ccan/io/io.c

2 
	~"io.h
"

3 
	~"backíd.h
"

4 
	~<sys/ty≥s.h
>

5 
	~<sys/sockë.h
>

6 
	~<√tdb.h
>

7 
	~<°rög.h
>

8 
	~<î∫o.h
>

9 
	~<°dlib.h
>

10 
	~<as£π.h
>

11 
	~<pﬁl.h
>

12 
	~<uni°d.h
>

13 
	~<f˙é.h
>

15 *
	gio_lo›_ªtu∫
;

17 
io_Æloc
 
	gio_Æloc
 = {

18 
mÆloc
, 
ªÆloc
, 
‰ì


21 #ifde‡
DEBUG


23 
boﬁ
 
	gio_∂™_nodebug
;

25 
io_c⁄n
 *
	gcuºít
;

27 
	$boﬁ
 (*
io_debug_c⁄n
)(
io_c⁄n
 *
c⁄n
);

29 
boﬁ
 
io_debug_wakeup
;

31 
io_∂™
 
	$io_debug
(
io_∂™
 
∂™
)

33 
io_c⁄n
 *
ªady
 = 
NULL
;

35 i‡(
io_∂™_nodebug
) {

36 
io_∂™_nodebug
 = 
Ál£
;

37  
∂™
;

40 i‡(!
cuºít
 || !
	`doög_debug_⁄
(current)) {

41 i‡(!
io_debug_wakeup
)

42  
∂™
;

45 
io_debug_wakeup
 = 
Ál£
;

46 
cuºít
->
∂™
 =Ölan;

47 
	`backíd_∂™_ch™ged
(
cuºít
);

50 
io_lo›_ªtu∫
 = 
	`do_io_lo›
(&
ªady
);

52 i‡(
ªady
) {

53 
	`£t_cuºít
(
ªady
);

54 i‡(!
ªady
->
∂™
.
√xt
) {

56 i‡(
ªady
->
föish
) {

57 
î∫o
 = 
ªady
->
∂™
.
u1
.
s
;

58 
ªady
->
	`föish
‘ódy,Ñódy->
föish_¨g
);

59 
ªady
->
föish
 = 
NULL
;

61 
	`backíd_dñ_c⁄n
(
ªady
);

64 i‡(
ªady
->
∂™
.
	`io
‘ódy->
fd
.fd, &ready->plan) != 2)

65 
	`ab‹t
();

67 
	`£t_cuºít
(
NULL
);

72  
	`io_idÀ_
();

73 
	}
}

75 
	$io_debug_io
(
ªt
)

78 
io_c⁄n
 *
c⁄n
 = 
cuºít
;

79 
ßved_î∫o
 = 
î∫o
;

81 i‡(!
	`doög_debug_⁄
(
c⁄n
))

82  
ªt
;

85 
ªt
) {

88 
î∫o
 = 
ßved_î∫o
;

89 
	`io_˛o£
();

92 
	`io_debug
(
c⁄n
->
∂™
);

95 i‡(
	`timeout_a˘ive
(
c⁄n
))

96 
	`backíd_dñ_timeout
(
c⁄n
);

97 
c⁄n
->
∂™
.
	`√xt
(c⁄n, c⁄n->∂™.
√xt_¨g
);

100 
	`ab‹t
();

105 
	}
}

107 
	$debug_io_wake
(
io_c⁄n
 *
c⁄n
)

110 i‡(
io_debug_c⁄n
 && 
	`io_debug_c⁄n
(
c⁄n
))

111 
io_debug_wakeup
 = 
åue
;

112 
	}
}

115 
	$io_∂™_debug_agaö
()

117 
io_∂™_nodebug
 = 
Ál£
;

118 
	}
}

120 
	$debug_io_wake
(
io_c⁄n
 *
c⁄n
)

122 
	}
}

123 
	$io_∂™_debug_agaö
()

125 
	}
}

128 
io_li°íî
 *
io_√w_li°íî_
(
fd
,

129 (*
öô
)(
fd
, *
¨g
),

130 *
¨g
)

132 
io_li°íî
 *
l
 = 
io_Æloc
.
	`Æloc
((*l));

134 i‡(!
l
)

135  
NULL
;

137 
l
->
fd
.
li°íî
 = 
åue
;

138 
l
->
fd
.fd = fd;

139 
l
->
öô
 = init;

140 
l
->
¨g
 =árg;

141 i‡(!
	`add_li°íî
(
l
)) {

142 
io_Æloc
.
	`‰ì
(
l
);

143  
NULL
;

145  
l
;

146 
	}
}

148 
	$io_˛o£_li°íî
(
io_li°íî
 *
l
)

150 
	`˛o£
(
l
->
fd
.fd);

151 
	`dñ_li°íî
(
l
);

152 
io_Æloc
.
	`‰ì
(
l
);

153 
	}
}

155 
io_c⁄n
 *
	$io_√w_c⁄n_
(
fd
, 
io_∂™
 
∂™
)

157 
io_c⁄n
 *
c⁄n
 = 
io_Æloc
.
	`Æloc
((*conn));

159 
	`io_∂™_debug_agaö
();

161 i‡(!
c⁄n
)

162  
NULL
;

164 
c⁄n
->
fd
.
li°íî
 = 
Ál£
;

165 
c⁄n
->
fd
.fd = fd;

166 
c⁄n
->
∂™
 =Ölan;

167 
c⁄n
->
föish
 = 
NULL
;

168 
c⁄n
->
föish_¨g
 = 
NULL
;

169 
c⁄n
->
du∂ex
 = 
NULL
;

170 
c⁄n
->
timeout
 = 
NULL
;

171 i‡(!
	`add_c⁄n
(
c⁄n
)) {

172 
io_Æloc
.
	`‰ì
(
c⁄n
);

173  
NULL
;

175  
c⁄n
;

176 
	}
}

178 
io_£t_föish_
(
io_c⁄n
 *
c⁄n
,

179 (*
föish
)(
io_c⁄n
 *, *),

180 *
¨g
)

182 
c⁄n
->
föish
 = finish;

183 
c⁄n
->
föish_¨g
 = 
¨g
;

184 
	}
}

186 
io_c⁄n
 *
	$io_du∂ex_
(
io_c⁄n
 *
ﬁd
, 
io_∂™
 
∂™
)

188 
io_c⁄n
 *
c⁄n
;

190 
	`io_∂™_debug_agaö
();

192 
	`as£π
(!
ﬁd
->
du∂ex
);

194 
c⁄n
 = 
io_Æloc
.
	`Æloc
((*conn));

195 i‡(!
c⁄n
)

196  
NULL
;

198 
c⁄n
->
fd
.
li°íî
 = 
Ál£
;

199 
c⁄n
->
fd
.fd = 
ﬁd
->fd.fd;

200 
c⁄n
->
∂™
 =Ölan;

201 
c⁄n
->
du∂ex
 = 
ﬁd
;

202 
c⁄n
->
föish
 = 
NULL
;

203 
c⁄n
->
föish_¨g
 = 
NULL
;

204 
c⁄n
->
timeout
 = 
NULL
;

205 i‡(!
	`add_du∂ex
(
c⁄n
)) {

206 
io_Æloc
.
	`‰ì
(
c⁄n
);

207  
NULL
;

209 
ﬁd
->
du∂ex
 = 
c⁄n
;

210  
c⁄n
;

211 
	}
}

213 
boﬁ
 
io_timeout_
(
io_c⁄n
 *
c⁄n
, 
time•ec
 
ts
,

214 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *), *
¨g
)

216 
	`as£π
(
cb
);

218 i‡(!
c⁄n
->
timeout
) {

219 
c⁄n
->
timeout
 = 
io_Æloc
.
	`Æloc
((*conn->timeout));

220 i‡(!
c⁄n
->
timeout
)

221  
Ál£
;

223 
	`as£π
(!
	`timeout_a˘ive
(
c⁄n
));

225 
c⁄n
->
timeout
->
√xt
 = 
cb
;

226 
c⁄n
->
timeout
->
√xt_¨g
 = 
¨g
;

227 
	`backíd_add_timeout
(
c⁄n
, 
ts
);

228  
åue
;

229 
	}
}

232 
	$do_wrôe
(
fd
, 
io_∂™
 *
∂™
)

234 
ssize_t
 
ªt
 = 
	`wrôe
(
fd
, 
∂™
->
u1
.
˝
,Öœn->
u2
.
s
);

235 i‡(
ªt
 < 0)

236  
	`io_debug_io
(-1);

238 
∂™
->
u1
.
˝
 +
ªt
;

239 
∂™
->
u2
.
s
 -
ªt
;

240  
	`io_debug_io
(
∂™
->
u2
.
s
 == 0);

241 
	}
}

244 
io_∂™
 
io_wrôe_
(c⁄° *
d©a
, 
size_t
 
Àn
,

245 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

246 *
¨g
)

248 
io_∂™
 
∂™
;

250 
	`as£π
(
cb
);

251 
∂™
.
u1
.
c⁄°_vp
 = 
d©a
;

252 
∂™
.
u2
.
s
 = 
Àn
;

253 
∂™
.
io
 = 
do_wrôe
;

254 
∂™
.
√xt
 = 
cb
;

255 
∂™
.
√xt_¨g
 = 
¨g
;

256 
∂™
.
pﬁlÊag
 = 
POLLOUT
;

258  
∂™
;

259 
	}
}

261 
	$do_ªad
(
fd
, 
io_∂™
 *
∂™
)

263 
ssize_t
 
ªt
 = 
	`ªad
(
fd
, 
∂™
->
u1
.
˝
,Öœn->
u2
.
s
);

264 i‡(
ªt
 <= 0)

265  
	`io_debug_io
(-1);

267 
∂™
->
u1
.
˝
 +
ªt
;

268 
∂™
->
u2
.
s
 -
ªt
;

269  
	`io_debug_io
(
∂™
->
u2
.
s
 == 0);

270 
	}
}

273 
io_∂™
 
io_ªad_
(*
d©a
, 
size_t
 
Àn
,

274 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

275 *
¨g
)

277 
io_∂™
 
∂™
;

279 
	`as£π
(
cb
);

280 
∂™
.
u1
.
˝
 = 
d©a
;

281 
∂™
.
u2
.
s
 = 
Àn
;

282 
∂™
.
io
 = 
do_ªad
;

283 
∂™
.
√xt
 = 
cb
;

284 
∂™
.
√xt_¨g
 = 
¨g
;

285 
∂™
.
pﬁlÊag
 = 
POLLIN
;

287  
∂™
;

288 
	}
}

290 
	$do_ªad_∑πül
(
fd
, 
io_∂™
 *
∂™
)

292 
ssize_t
 
ªt
 = 
	`ªad
(
fd
, 
∂™
->
u1
.
˝
, *(
size_t
 *Ìœn->
u2
.
vp
);

293 i‡(
ªt
 <= 0)

294  
	`io_debug_io
(-1);

296 *(
size_t
 *)
∂™
->
u2
.
vp
 = 
ªt
;

297  
	`io_debug_io
(1);

298 
	}
}

301 
io_∂™
 
io_ªad_∑πül_
(*
d©a
, 
size_t
 *
Àn
,

302 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

303 *
¨g
)

305 
io_∂™
 
∂™
;

307 
	`as£π
(
cb
);

308 
∂™
.
u1
.
˝
 = 
d©a
;

309 
∂™
.
u2
.
vp
 = 
Àn
;

310 
∂™
.
io
 = 
do_ªad_∑πül
;

311 
∂™
.
√xt
 = 
cb
;

312 
∂™
.
√xt_¨g
 = 
¨g
;

313 
∂™
.
pﬁlÊag
 = 
POLLIN
;

315  
∂™
;

316 
	}
}

318 
	$do_wrôe_∑πül
(
fd
, 
io_∂™
 *
∂™
)

320 
ssize_t
 
ªt
 = 
	`wrôe
(
fd
, 
∂™
->
u1
.
˝
, *(
size_t
 *Ìœn->
u2
.
vp
);

321 i‡(
ªt
 < 0)

322  
	`io_debug_io
(-1);

324 *(
size_t
 *)
∂™
->
u2
.
vp
 = 
ªt
;

325  
	`io_debug_io
(1);

326 
	}
}

329 
io_∂™
 
io_wrôe_∑πül_
(c⁄° *
d©a
, 
size_t
 *
Àn
,

330 
	$io_∂™
 (*
cb
)(
io_c⁄n
*, *),

331 *
¨g
)

333 
io_∂™
 
∂™
;

335 
	`as£π
(
cb
);

336 
∂™
.
u1
.
c⁄°_vp
 = 
d©a
;

337 
∂™
.
u2
.
vp
 = 
Àn
;

338 
∂™
.
io
 = 
do_wrôe_∑πül
;

339 
∂™
.
√xt
 = 
cb
;

340 
∂™
.
√xt_¨g
 = 
¨g
;

341 
∂™
.
pﬁlÊag
 = 
POLLOUT
;

343  
∂™
;

344 
	}
}

346 
	$Æªady_c⁄√˘ed
(
fd
, 
io_∂™
 *
∂™
)

348  
	`io_debug_io
(1);

349 
	}
}

351 
	$do_c⁄√˘
(
fd
, 
io_∂™
 *
∂™
)

353 
îr
, 
ªt
;

354 
sockÀn_t
 
Àn
 = (
îr
);

357 
ªt
 = 
	`gësock›t
(
fd
, 
SOL_SOCKET
, 
SO_ERROR
, &
îr
, &
Àn
);

358 i‡(
ªt
 < 0)

361 i‡(
îr
 == 0) {

363 
	`f˙é
(
fd
, 
F_SETFD
, 
∂™
->
u1
.
s
);

367 
	}
}

369 
io_∂™
 
io_c⁄√˘_
(
fd
, c⁄° 
addröfo
 *
addr
,

370 
	$io_∂™
 (*
cb
)(
io_c⁄n
*, *),

371 *
¨g
)

373 
io_∂™
 
∂™
;

375 
	`as£π
(
cb
);

377 
∂™
.
√xt
 = 
cb
;

378 
∂™
.
√xt_¨g
 = 
¨g
;

381 
∂™
.
u1
.
s
 = 
	`f˙é
(
fd
, 
F_GETFD
);

382 
	`f˙é
(
fd
, 
F_SETFD
, 
∂™
.
u1
.
s
 | 
O_NONBLOCK
);

385 i‡(
	`c⁄√˘
(
fd
, 
addr
->
ai_addr
,áddr->
ai_addæí
) == 0) {

387 
∂™
.
pﬁlÊag
 = 
POLLOUT
;

388 
∂™
.
io
 = 
Æªady_c⁄√˘ed
;

390 i‡(
î∫o
 !
EINPROGRESS
)

391  
	`io_˛o£_
();

393 
∂™
.
pﬁlÊag
 = 
POLLIN
;

394 
∂™
.
io
 = 
do_c⁄√˘
;

396  
∂™
;

397 
	}
}

399 
io_∂™
 
	$io_idÀ_
()

401 
io_∂™
 
∂™
;

403 
∂™
.
pﬁlÊag
 = 0;

404 
∂™
.
io
 = 
NULL
;

406 
∂™
.
√xt
 = (*)
io_idÀ_
;

408  
∂™
;

409 
	}
}

411 
	$io_wake_
(
io_c⁄n
 *
c⁄n
, 
io_∂™
 
∂™
)

414 
	`io_∂™_debug_agaö
();

417 i‡(!
c⁄n
->
∂™
.
√xt
)

420 
	`as£π
(!
c⁄n
->
∂™
.
io
);

421 
c⁄n
->
∂™
 =Ölan;

422 
	`backíd_∂™_ch™ged
(
c⁄n
);

424 
	`debug_io_wake
(
c⁄n
);

425 
	}
}

427 
	$io_ªady
(
io_c⁄n
 *
c⁄n
)

429 
	`£t_cuºít
(
c⁄n
);

430 
c⁄n
->
∂™
.
	`io
(c⁄n->
fd
.fd, &conn->plan)) {

432 
c⁄n
->
∂™
 = 
	`io_˛o£
();

433 
	`backíd_∂™_ch™ged
(
c⁄n
);

438 i‡(
	`timeout_a˘ive
(
c⁄n
))

439 
	`backíd_dñ_timeout
(
c⁄n
);

440 
c⁄n
->
∂™
 = c⁄n->∂™.
	`√xt
(c⁄n, c⁄n->∂™.
√xt_¨g
);

441 
	`backíd_∂™_ch™ged
(
c⁄n
);

443 
	`£t_cuºít
(
NULL
);

444 
	}
}

447 
io_∂™
 
	$io_˛o£_
()

449 
io_∂™
 
∂™
;

451 
∂™
.
pﬁlÊag
 = 0;

453 
∂™
.
√xt
 = 
NULL
;

454 
∂™
.
u1
.
s
 = 
î∫o
;

456  
∂™
;

457 
	}
}

459 
io_∂™
 
	$io_˛o£_cb
(
io_c⁄n
 *
c⁄n
, *
¨g
)

461  
	`io_˛o£
();

462 
	}
}

465 
io_∂™
 
	$io_bªak_
(*
ªt
, 
io_∂™
 
∂™
)

467 
	`io_∂™_debug_agaö
();

469 
	`as£π
(
ªt
);

470 
io_lo›_ªtu∫
 = 
ªt
;

472  
∂™
;

473 
	}
}

475 
io_£t_Æloc
(*(*
Æloc‚
)(
size_t
 
size
),

476 *(*
ªÆloc‚
)(*
±r
, 
size_t
 
size
),

477 (*
‰ì‚
)(*
±r
))

479 
io_Æloc
.
Æloc
 = 
Æloc‚
;

480 
io_Æloc
.
ªÆloc
 = 
ªÆloc‚
;

481 
io_Æloc
.
‰ì
 = 
‰ì‚
;

482 
	}
}

	@ccan/ccan/io/io.h

2 #i‚de‡
CCAN_IO_H


3 
	#CCAN_IO_H


	)

4 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

5 
	~<cˇn/time/time.h
>

6 
	~<°dboﬁ.h
>

7 
	~<uni°d.h
>

8 
	~"io_∂™.h
"

30 
	#io_√w_c⁄n
(
fd
, 
∂™
) \

31 (
	`io_∂™_no_debug
(), 
	`io_√w_c⁄n_
((
fd
), (
∂™
)))

	)

32 
io_c⁄n
 *
io_√w_c⁄n_
(
fd
, 
io_∂™
 
∂™
);

53 
	#io_£t_föish
(
c⁄n
, 
föish
, 
¨g
) \

54 
	`io_£t_föish_
((
c⁄n
), \

55 
	`ty≥ß„_cb_¥órgs
(, *, \

56 (
föish
), (
¨g
), \

57 
io_c⁄n
 *), \

58 (
¨g
))

	)

59 
io_£t_föish_
(
io_c⁄n
 *
c⁄n
,

60 (*
föish
)(
io_c⁄n
 *, *),

61 *
¨g
);

117 
	#io_√w_li°íî
(
fd
, 
öô
, 
¨g
) \

118 
	`io_√w_li°íî_
((
fd
), \

119 
	`ty≥ß„_cb_¥órgs
(, *, \

120 (
öô
), (
¨g
), \

121 
fd
), \

122 (
¨g
))

	)

123 
io_li°íî
 *
	`io_√w_li°íî_
(
fd
,

124 (*
öô
)(
fd
, *
¨g
),

125 *
¨g
);

141 
	`io_˛o£_li°íî
(
io_li°íî
 *
li°íî
);

163 
	#io_wrôe
(
d©a
, 
Àn
, 
cb
, 
¨g
) \

164 
	`io_debug
(
	`io_wrôe_
((
d©a
), (
Àn
), \

165 
	`ty≥ß„_cb_¥órgs
(
io_∂™
, *, \

166 (
cb
), (
¨g
), 
io_c⁄n
 *), \

167 (
¨g
)))

	)

168 
io_∂™
 
	`io_wrôe_
(c⁄° *
d©a
, 
size_t
 
Àn
,

169 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

170 *
¨g
);

192 
	#io_ªad
(
d©a
, 
Àn
, 
cb
, 
¨g
) \

193 
	`io_debug
(
	`io_ªad_
((
d©a
), (
Àn
), \

194 
	`ty≥ß„_cb_¥órgs
(
io_∂™
, *, \

195 (
cb
), (
¨g
), 
io_c⁄n
 *), \

196 (
¨g
)))

	)

197 
io_∂™
 
	`io_ªad_
(*
d©a
, 
size_t
 
Àn
,

198 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

199 *
¨g
);

237 
	#io_ªad_∑πül
(
d©a
, 
Àn
, 
cb
, 
¨g
) \

238 
	`io_debug
(
	`io_ªad_∑πül_
((
d©a
), (
Àn
), \

239 
	`ty≥ß„_cb_¥órgs
(
io_∂™
, *, \

240 (
cb
), (
¨g
), \

241 
io_c⁄n
 *), \

242 (
¨g
)))

	)

243 
io_∂™
 
	`io_ªad_∑πül_
(*
d©a
, 
size_t
 *
Àn
,

244 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

245 *
¨g
);

283 
	#io_wrôe_∑πül
(
d©a
, 
Àn
, 
cb
, 
¨g
) \

284 
	`io_debug
(
	`io_wrôe_∑πül_
((
d©a
), (
Àn
), \

285 
	`ty≥ß„_cb_¥órgs
(
io_∂™
, *, \

286 (
cb
), (
¨g
), \

287 
io_c⁄n
 *), \

288 (
¨g
)))

	)

289 
io_∂™
 
	`io_wrôe_∑πül_
(c⁄° *
d©a
, 
size_t
 *
Àn
,

290 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

291 *
¨g
);

327 
addröfo
;

328 
	#io_c⁄√˘
(
fd
, 
addr
, 
cb
, 
¨g
) \

329 
	`io_debug
(
	`io_c⁄√˘_
((
fd
), (
addr
), \

330 
	`ty≥ß„_cb_¥órgs
(
io_∂™
, *, \

331 (
cb
), (
¨g
), \

332 
io_c⁄n
 *), \

333 (
¨g
)))

	)

334 
io_∂™
 
	`io_c⁄√˘_
(
fd
, c⁄° 
addröfo
 *
addr
,

335 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

336 *
¨g
);

350 
	#io_idÀ
(Ë
	`io_debug
(
	`io_idÀ_
())

	)

351 
io_∂™
 
	`io_idÀ_
();

378 
	#io_timeout
(
c⁄n
, 
ts
, 
‚
, 
¨g
) \

379 
	`io_timeout_
((
c⁄n
), (
ts
), \

380 
	`ty≥ß„_cb_¥órgs
(
io_∂™
, *, \

381 (
‚
), (
¨g
), \

382 
io_c⁄n
 *), \

383 (
¨g
))

	)

384 
boﬁ
 
	`io_timeout_
(
io_c⁄n
 *
c⁄n
, 
time•ec
 
ts
,

385 
	$io_∂™
 (*
‚
)(
io_c⁄n
 *, *), *
¨g
);

414 
	#io_du∂ex
(
c⁄n
, 
∂™
) \

415 (
	`io_∂™_no_debug
(), 
	`io_du∂ex_
((
c⁄n
), (
∂™
)))

	)

416 
io_c⁄n
 *
	`io_du∂ex_
(io_c⁄¿*
c⁄n
, 
io_∂™
 
∂™
);

431 
	#io_wake
(
c⁄n
, 
∂™
Ë(
	`io_∂™_no_debug
(), 
	`io_wake_
((c⁄n), (∂™)))

	)

432 
	`io_wake_
(
io_c⁄n
 *
c⁄n
, 
io_∂™
 
∂™
);

451 
	#io_bªak
(
ªt
, 
∂™
Ë(
	`io_∂™_no_debug
(), 
	`io_bªak_
(‘ë), (∂™)))

	)

452 
io_∂™
 
	`io_bªak_
(*
ªt
, io_∂™ 
∂™
);

468 
	#io_˛o£
(Ë
	`io_debug
(
	`io_˛o£_
())

	)

469 
io_∂™
 
	`io_˛o£_
();

481 
io_∂™
 
	`io_˛o£_cb
(
io_c⁄n
 *, *
unu£d
);

492 *
	`io_lo›
();

503 
	`io_£t_Æloc
(*(*
Æloc‚
)(
size_t
 
size
),

504 *(*
ªÆloc‚
)(*
±r
, 
size_t
 
size
),

505 (*
‰ì‚
)(*
±r
));

	@ccan/ccan/io/io_plan.h

2 #i‚de‡
CCAN_IO_PLAN_H


3 
	#CCAN_IO_PLAN_H


	)

4 
	gio_c⁄n
;

22 
	sio_∂™
 {

23 
	mpﬁlÊag
;

25 (*
	mio
)(
	mfd
, 
io_∂™
 *
	m∂™
);

27 
io_∂™
 (*
√xt
)(
	mio_c⁄n
 *, *
	m¨g
);

28 *
	m√xt_¨g
;

31 *
	m˝
;

32 *
	mvp
;

33 c⁄° *
	mc⁄°_vp
;

34 
size_t
 
	ms
;

35 
	mc
[(
size_t
)];

36 } 
	mu1
;

38 *
	mp
;

39 *
	mvp
;

40 c⁄° *
	mc⁄°_vp
;

41 
size_t
 
	ms
;

42 
	mc
[(
size_t
)];

43 } 
	mu2
;

46 #ifde‡
DEBUG


65 
	$boﬁ
 (*
io_debug_c⁄n
)(
io_c⁄n
 *
c⁄n
);

78 
io_∂™
 
	`io_debug
(io_∂™ 
∂™
);

100 
	`io_debug_io
(
ªt
);

117 
	#io_∂™_no_debug
(Ë((
io_∂™_nodebug
 = 
åue
))

	)

119 
boﬁ
 
io_∂™_nodebug
;

121 
ölöe
 
io_∂™
 
	$io_debug
(
io_∂™
 
∂™
)

123  
∂™
;

124 
	}
}

125 
ölöe
 
	$io_debug_io
(
ªt
)

127  
ªt
;

128 
	}
}

129 
	#io_∂™_no_debug
(Ë()0

	)

	@ccan/ccan/io/poll.c

2 
	~"io.h
"

3 
	~"backíd.h
"

4 
	~<as£π.h
>

5 
	~<pﬁl.h
>

6 
	~<°dlib.h
>

7 
	~<sys/ty≥s.h
>

8 
	~<sys/sockë.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

12 
size_t
 
	gnum_fds
 = 0, 
	gmax_fds
 = 0, 
	gnum_˛osög
 = 0, 
	gnum_waôög
 = 0;

13 
pﬁlfd
 *
	gpﬁlfds
 = 
NULL
;

14 
fd
 **
	gfds
 = 
NULL
;

15 
timîs
 
	gtimeouts
;

16 #ifde‡
DEBUG


17 
	gio_lo›_Àvñ
;

18 
io_c⁄n
 *
	g‰ì_œãr
;

19 
	$io_lo›_íãr
()

21 
io_lo›_Àvñ
++;

22 
	}
}

23 
	$io_lo›_exô
()

25 
io_lo›_Àvñ
--;

26 i‡(
io_lo›_Àvñ
 == 0) {

28 
‰ì_œãr
) {

29 
io_c⁄n
 *
c
 = 
‰ì_œãr
;

30 
‰ì_œãr
 = 
c
->
föish_¨g
;

31 
io_Æloc
.
	`‰ì
(
c
);

34 
	}
}

35 
	$‰ì_c⁄n
(
io_c⁄n
 *
c⁄n
)

38 i‡(
io_lo›_Àvñ
 > 1) {

39 
io_c⁄n
 *
c
;

40 
c
 = 
‰ì_œãr
; c; c = c->
föish_¨g
)

41 
	`as£π
(
c
 !
c⁄n
);

42 
c⁄n
->
föish_¨g
 = 
‰ì_œãr
;

43 
‰ì_œãr
 = 
c⁄n
;

45 
io_Æloc
.
	`‰ì
(
c⁄n
);

46 
	}
}

48 
	$io_lo›_íãr
()

50 
	}
}

51 
	$io_lo›_exô
()

53 
	}
}

54 
	$‰ì_c⁄n
(
io_c⁄n
 *
c⁄n
)

56 
io_Æloc
.
	`‰ì
(
c⁄n
);

57 
	}
}

60 
boﬁ
 
	$add_fd
(
fd
 *fd, 
evíts
)

62 i‡(
num_fds
 + 1 > 
max_fds
) {

63 
pﬁlfd
 *
√wpﬁlfds
;

64 
fd
 **
√wfds
;

65 
size_t
 
num
 = 
max_fds
 ? max_fds * 2 : 8;

67 
√wpﬁlfds
 = 
io_Æloc
.
	`ªÆloc
(
pﬁlfds
, (*√wpﬁlfds)*
num
);

68 i‡(!
√wpﬁlfds
)

69  
Ál£
;

70 
pﬁlfds
 = 
√wpﬁlfds
;

71 
√wfds
 = 
io_Æloc
.
	`ªÆloc
(
fds
, (*√wfdsË* 
num
);

72 i‡(!
√wfds
)

73  
Ál£
;

74 
fds
 = 
√wfds
;

75 
max_fds
 = 
num
;

78 
pﬁlfds
[
num_fds
].
evíts
 =Évents;

80 i‡(!
evíts
)

81 
pﬁlfds
[
num_fds
].
fd
 = -fd->fd;

83 
pﬁlfds
[
num_fds
].
fd
 = fd->fd;

84 
pﬁlfds
[
num_fds
].
ªvíts
 = 0;

85 
fds
[
num_fds
] = 
fd
;

86 
fd
->
backíd_öfo
 = 
num_fds
;

87 
num_fds
++;

88 i‡(
evíts
)

89 
num_waôög
++;

91  
åue
;

92 
	}
}

94 
	$dñ_fd
(
fd
 *fd)

96 
size_t
 
n
 = 
fd
->
backíd_öfo
;

98 
	`as£π
(
n
 != -1);

99 
	`as£π
(
n
 < 
num_fds
);

100 i‡(
pﬁlfds
[
n
].
evíts
)

101 
num_waôög
--;

102 i‡(
n
 !
num_fds
 - 1) {

104 
pﬁlfds
[
n
] =Öﬁlfds[
num_fds
-1];

105 
fds
[
n
] = fds[
num_fds
-1];

106 
	`as£π
(
fds
[
n
]->
backíd_öfo
 =
num_fds
-1);

107 
fds
[
n
]->
backíd_öfo
 =Ç;

108 } i‡(
num_fds
 == 1) {

110 
io_Æloc
.
	`‰ì
(
pﬁlfds
);

111 
io_Æloc
.
	`‰ì
(
fds
);

112 
pﬁlfds
 = 
NULL
;

113 
fds
 = 
NULL
;

114 
max_fds
 = 0;

116 
num_fds
--;

117 
fd
->
backíd_öfo
 = -1;

118 
	`˛o£
(
fd
->fd);

119 
	}
}

121 
boﬁ
 
	$add_li°íî
(
io_li°íî
 *
l
)

123 i‡(!
	`add_fd
(&
l
->
fd
, 
POLLIN
))

124  
Ál£
;

125  
åue
;

126 
	}
}

128 
	$backíd_∂™_ch™ged
(
io_c⁄n
 *
c⁄n
)

130 
pﬁlfd
 *
pfd
;

133 i‡(
c⁄n
->
fd
.
backíd_öfo
 == -1)

136 
pfd
 = &
pﬁlfds
[
c⁄n
->
fd
.
backíd_öfo
];

138 i‡(
pfd
->
evíts
)

139 
num_waôög
--;

141 
pfd
->
evíts
 = 
c⁄n
->
∂™
.
pﬁlÊag
;

142 i‡(
c⁄n
->
du∂ex
) {

143 
mask
 = 
c⁄n
->
du∂ex
->
∂™
.
pﬁlÊag
;

145 
	`as£π
(!
mask
 || 
pfd
->
evíts
 != mask);

146 
pfd
->
evíts
 |
mask
;

148 i‡(
pfd
->
evíts
) {

149 
num_waôög
++;

150 
pfd
->
fd
 = 
c⁄n
->fd.fd;

152 
pfd
->
fd
 = -
c⁄n
->fd.fd;

154 i‡(!
c⁄n
->
∂™
.
√xt
)

155 
num_˛osög
++;

156 
	}
}

158 
boﬁ
 
	$add_c⁄n
(
io_c⁄n
 *
c
)

160 i‡(!
	`add_fd
(&
c
->
fd
, c->
∂™
.
pﬁlÊag
))

161  
Ál£
;

163 i‡(!
c
->
∂™
.
√xt
)

164 
num_˛osög
++;

165  
åue
;

166 
	}
}

168 
boﬁ
 
	$add_du∂ex
(
io_c⁄n
 *
c
)

170 
c
->
fd
.
backíd_öfo
 = c->
du∂ex
->fd.backend_info;

171 
	`backíd_∂™_ch™ged
(
c
);

172  
åue
;

173 
	}
}

175 
	$backíd_dñ_c⁄n
(
io_c⁄n
 *
c⁄n
)

177 i‡(
c⁄n
->
föish
) {

179 
î∫o
 = 
c⁄n
->
∂™
.
u1
.
s
;

180 
c⁄n
->
	`föish
(c⁄n, c⁄n->
föish_¨g
);

182 i‡(
	`timeout_a˘ive
(
c⁄n
))

183 
	`backíd_dñ_timeout
(
c⁄n
);

184 
io_Æloc
.
	`‰ì
(
c⁄n
->
timeout
);

185 i‡(
c⁄n
->
du∂ex
) {

187 
fds
[
c⁄n
->
fd
.
backíd_öfo
] = &c⁄n->
du∂ex
->fd;

188 
c⁄n
->
du∂ex
->du∂ex = 
NULL
;

189 
c⁄n
->
fd
.
backíd_öfo
 = -1;

191 
	`dñ_fd
(&
c⁄n
->
fd
);

192 
num_˛osög
--;

193 
	`‰ì_c⁄n
(
c⁄n
);

194 
	}
}

196 
	$dñ_li°íî
(
io_li°íî
 *
l
)

198 
	`dñ_fd
(&
l
->
fd
);

199 
	}
}

201 
	$£t_∂™
(
io_c⁄n
 *
c⁄n
, 
io_∂™
 
∂™
)

203 
c⁄n
->
∂™
 =Ölan;

204 
	`backíd_∂™_ch™ged
(
c⁄n
);

205 
	}
}

207 
	$ac˚±_c⁄n
(
io_li°íî
 *
l
)

209 
fd
 = 
	`ac˚±
(
l
->fd.fd, 
NULL
, NULL);

212 i‡(
fd
 < 0)

214 
l
->
	`öô
(
fd
,Ü->
¨g
);

215 
	}
}

218 
boﬁ
 
	$föish_c⁄ns
(
io_c⁄n
 **
ªady
)

220 
i
;

222 
i
 = 0; !
io_lo›_ªtu∫
 && i < 
num_fds
; i++) {

223 
io_c⁄n
 *
c
, *
du∂ex
;

225 i‡(!
num_˛osög
)

228 i‡(
fds
[
i
]->
li°íî
)

230 
c
 = (*)
fds
[
i
];

231 
du∂ex
 = 
c
->du∂ex; c; c = du∂ex, du∂ex = 
NULL
) {

232 i‡(!
c
->
∂™
.
√xt
) {

233 i‡(
	`doög_debug_⁄
(
c
Ë&& 
ªady
) {

234 *
ªady
 = 
c
;

235  
åue
;

237 
	`backíd_dñ_c⁄n
(
c
);

238 
i
--;

242  
Ál£
;

243 
	}
}

245 
	$backíd_add_timeout
(
io_c⁄n
 *
c⁄n
, 
time•ec
 
duøti⁄
)

247 i‡(!
timeouts
.
ba£
)

248 
	`timîs_öô
(&
timeouts
, 
	`time_now
());

249 
	`timî_add
(&
timeouts
, &
c⁄n
->
timeout
->
timî
,

250 
	`time_add
(
	`time_now
(), 
duøti⁄
));

251 
c⁄n
->
timeout
->conn = conn;

252 
	}
}

254 
	$backíd_dñ_timeout
(
io_c⁄n
 *
c⁄n
)

256 
	`as£π
(
c⁄n
->
timeout
->conn == conn);

257 
	`timî_dñ
(&
timeouts
, &
c⁄n
->
timeout
->
timî
);

258 
c⁄n
->
timeout
->c⁄¿
NULL
;

259 
	}
}

262 *
	$do_io_lo›
(
io_c⁄n
 **
ªady
)

264 *
ªt
;

266 
	`io_lo›_íãr
();

268 !
io_lo›_ªtu∫
) {

269 
i
, 
r
, 
timeout
 = 
INT_MAX
;

270 
time•ec
 
now
;

271 
boﬁ
 
some_timeouts
 = 
Ál£
;

273 i‡(
timeouts
.
ba£
) {

274 
time•ec
 
fú°
;

275 
li°_hód
 
expúed
;

276 
io_timeout
 *
t
;

278 
now
 = 
	`time_now
();

281 
	`timîs_expúe
(&
timeouts
, 
now
, &
expúed
);

282 (
t
 = 
	`li°_p›
(&
expúed
, 
io_timeout
, 
timî
.
li°
))) {

283 
io_c⁄n
 *
c⁄n
 = 
t
->conn;

285 
t
->
c⁄n
 = 
NULL
;

286 
	`£t_cuºít
(
c⁄n
);

287 
	`£t_∂™
(
c⁄n
, 
t
->
	`√xt
(c⁄n,Å->
√xt_¨g
));

288 
some_timeouts
 = 
åue
;

292 i‡(
	`timî_óæõ°
(&
timeouts
, &
fú°
)) {

293 
uöt64_t
 
f
 = 
	`time_to_m£c
(
	`time_sub
(
fú°
, 
now
));

294 i‡(
f
 < 
INT_MAX
)

295 
timeout
 = 
f
;

299 i‡(
num_˛osög
) {

301 i‡(
	`föish_c⁄ns
(
ªady
))

302  
NULL
;

308 i‡(
	`doög_debug
(Ë&& 
some_timeouts
)

311 i‡(
num_fds
 == 0)

315 
	`as£π
(
num_waôög
);

317 
r
 = 
	`pﬁl
(
pﬁlfds
, 
num_fds
, 
timeout
);

318 i‡(
r
 < 0)

321 
i
 = 0; i < 
num_fds
 && !
io_lo›_ªtu∫
; i++) {

322 
io_c⁄n
 *
c
 = (*)
fds
[
i
];

323 
evíts
 = 
pﬁlfds
[
i
].
ªvíts
;

325 i‡(
r
 == 0)

328 i‡(
fds
[
i
]->
li°íî
) {

329 i‡(
evíts
 & 
POLLIN
) {

330 
	`ac˚±_c⁄n
((*)
c
);

331 
r
--;

333 } i‡(
evíts
 & (
POLLIN
|
POLLOUT
)) {

334 
r
--;

335 i‡(
c
->
du∂ex
) {

336 
mask
 = 
c
->
du∂ex
->
∂™
.
pﬁlÊag
;

337 i‡(
evíts
 & 
mask
) {

338 i‡(
	`doög_debug_⁄
(
c
->
du∂ex
)

339 && 
ªady
) {

340 *
ªady
 = 
c
->
du∂ex
;

341  
NULL
;

343 
	`io_ªady
(
c
->
du∂ex
);

344 
evíts
 &~
mask
;

347 i‡(
	`doög_debug
())

349 i‡(!(
evíts
&(
POLLIN
|
POLLOUT
)))

353 i‡(
	`doög_debug_⁄
(
c
Ë&& 
ªady
) {

354 *
ªady
 = 
c
;

355  
NULL
;

357 
	`io_ªady
(
c
);

359 i‡(
	`doög_debug
())

361 } i‡(
evíts
 & (
POLLHUP
|
POLLNVAL
|
POLLERR
)) {

362 
r
--;

363 
	`£t_cuºít
(
c
);

364 
î∫o
 = 
EBADF
;

365 
	`£t_∂™
(
c
, 
	`io_˛o£
());

366 i‡(
c
->
du∂ex
) {

367 
	`£t_cuºít
(
c
->
du∂ex
);

368 
	`£t_∂™
(
c
->
du∂ex
, 
	`io_˛o£
());

374 
num_˛osög
 && !
io_lo›_ªtu∫
) {

375 i‡(
	`föish_c⁄ns
(
ªady
))

376  
NULL
;

379 
ªt
 = 
io_lo›_ªtu∫
;

380 
io_lo›_ªtu∫
 = 
NULL
;

382 
	`io_lo›_exô
();

383  
ªt
;

384 
	}
}

386 *
	$io_lo›
()

388  
	`do_io_lo›
(
NULL
);

389 
	}
}

	@ccan/ccan/io/test/run-01-start-finish-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64001"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-01-°¨t-föish.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-01-start-finish.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65001"

	)

13 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, *
°©e
)

15 
	`ok1
(*
°©e
 == 1);

16 (*
°©e
)++;

17 
	`io_bªak
(
°©e
 + 1, 
	`io_idÀ
());

18 
	}
}

20 
	$öô_c⁄n
(
fd
, *
°©e
)

22 
	`ok1
(*
°©e
 == 0);

23 (*
°©e
)++;

24 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
, 
	`io_˛o£
()), 
föish_ok
, 
°©e
);

25 
	}
}

27 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

29 
fd
, 
⁄
 = 1;

30 
addröfo
 *addröfo, 
höts
;

32 
	`mem£t
(&
höts
, 0, (hints));

33 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

34 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

35 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

36 
höts
.
ai_¥Ÿocﬁ
 = 0;

38 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

41 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

42 
addröfo
->
ai_¥Ÿocﬁ
);

43 i‡(
fd
 < 0)

46 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

47 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

48 
	`˛o£
(
fd
);

51 i‡(
	`li°í
(
fd
, 1) != 0) {

52 
	`˛o£
(
fd
);

55 *
öfo
 = 
addröfo
;

56  
fd
;

57 
	}
}

59 
	$maö
()

61 
°©e
 = 0;

62 
addröfo
 *addrinfo;

63 
io_li°íî
 *
l
;

64 
fd
;

67 
	`∂™_ã°s
(9);

68 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

69 
	`ok1
(
fd
 >= 0);

70 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, &
°©e
);

71 
	`ok1
(
l
);

72 
	`fÊush
(
°dout
);

73 i‡(!
	`f‹k
()) {

74 
	`io_˛o£_li°íî
(
l
);

75 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

76 
addröfo
->
ai_¥Ÿocﬁ
);

77 i‡(
fd
 < 0)

78 
	`exô
(1);

79 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

80 
	`exô
(2);

81 
	`˛o£
(
fd
);

82 
	`‰ìaddröfo
(
addröfo
);

83 
	`exô
(0);

85 
	`‰ìaddröfo
(
addröfo
);

86 
	`ok1
(
	`io_lo›
(Ë=&
°©e
 + 1);

87 
	`ok1
(
°©e
 == 2);

88 
	`io_˛o£_li°íî
(
l
);

89 
	`ok1
(
	`waô
(&
°©e
));

90 
	`ok1
(
	`WIFEXITED
(
°©e
));

91 
	`ok1
(
	`WEXITSTATUS
(
°©e
) == 0);

94  
	`exô_°©us
();

95 
	}
}

	@ccan/ccan/io/test/run-02-read-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64002"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-02-ªad.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-02-read.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65002"

	)

13 
	sd©a
 {

14 
	m°©e
;

15 
	mbuf
[4];

18 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

20 
	`ok1
(
d
->
°©e
 == 1);

21 
d
->
°©e
++;

22 
	`io_bªak
(
d
, 
	`io_idÀ
());

23 
	}
}

25 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

27 
	`ok1
(
d
->
°©e
 == 0);

28 
d
->
°©e
++;

30 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
,

31 
	`io_ªad
(
d
->
buf
, (d->buf), 
io_˛o£_cb
, d)),

32 
föish_ok
, 
d
);

33 
	}
}

35 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

37 
fd
, 
⁄
 = 1;

38 
addröfo
 *addröfo, 
höts
;

40 
	`mem£t
(&
höts
, 0, (hints));

41 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

42 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

43 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

44 
höts
.
ai_¥Ÿocﬁ
 = 0;

46 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

49 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

50 
addröfo
->
ai_¥Ÿocﬁ
);

51 i‡(
fd
 < 0)

54 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

55 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

56 
	`˛o£
(
fd
);

59 i‡(
	`li°í
(
fd
, 1) != 0) {

60 
	`˛o£
(
fd
);

63 *
öfo
 = 
addröfo
;

64  
fd
;

65 
	}
}

67 
	$maö
()

69 
d©a
 *
d
 = 
	`mÆloc
((*d));

70 
addröfo
 *addrinfo;

71 
io_li°íî
 *
l
;

72 
fd
, 
°©us
;

75 
	`∂™_ã°s
(10);

76 
d
->
°©e
 = 0;

77 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

78 
	`ok1
(
fd
 >= 0);

79 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

80 
	`ok1
(
l
);

81 
	`fÊush
(
°dout
);

82 i‡(!
	`f‹k
()) {

83 
i
;

85 
	`io_˛o£_li°íî
(
l
);

86 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

87 
addröfo
->
ai_¥Ÿocﬁ
);

88 i‡(
fd
 < 0)

89 
	`exô
(1);

90 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

91 
	`exô
(2);

92 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

93 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

94 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

97 
	`˛o£
(
fd
);

98 
	`‰ìaddröfo
(
addröfo
);

99 
	`‰ì
(
d
);

100 
	`exô
(0);

102 
	`‰ìaddröfo
(
addröfo
);

103 
	`ok1
(
	`io_lo›
(Ë=
d
);

104 
	`ok1
(
d
->
°©e
 == 2);

105 
	`ok1
(
	`memcmp
(
d
->
buf
, "hellothere", (d->buf)) == 0);

106 
	`‰ì
(
d
);

107 
	`io_˛o£_li°íî
(
l
);

109 
	`ok1
(
	`waô
(&
°©us
));

110 
	`ok1
(
	`WIFEXITED
(
°©us
));

111 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

114  
	`exô_°©us
();

115 
	}
}

	@ccan/ccan/io/test/run-03-readpartial-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64003"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-03-ªad∑πül.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-03-readpartial.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65003"

	)

13 
	sd©a
 {

14 
	m°©e
;

15 
size_t
 
	mbyãs
;

16 
	mbuf
[4];

19 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

21 
	`ok1
(
d
->
°©e
 == 1);

22 
d
->
°©e
++;

23 
	`io_bªak
(
d
, 
	`io_idÀ
());

24 
	}
}

26 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

28 
	`ok1
(
d
->
°©e
 == 0);

29 
d
->
°©e
++;

30 
d
->
byãs
 = (d->
buf
);

32 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
,

33 
	`io_ªad_∑πül
(
d
->
buf
, &d->
byãs
, 
io_˛o£_cb
, d)),

34 
föish_ok
, 
d
);

35 
	}
}

37 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

39 
fd
, 
⁄
 = 1;

40 
addröfo
 *addröfo, 
höts
;

42 
	`mem£t
(&
höts
, 0, (hints));

43 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

44 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

45 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

46 
höts
.
ai_¥Ÿocﬁ
 = 0;

48 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

51 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

52 
addröfo
->
ai_¥Ÿocﬁ
);

53 i‡(
fd
 < 0)

56 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

57 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

58 
	`˛o£
(
fd
);

61 i‡(
	`li°í
(
fd
, 1) != 0) {

62 
	`˛o£
(
fd
);

65 *
öfo
 = 
addröfo
;

66  
fd
;

67 
	}
}

69 
	$wrôe_to_sockë
(c⁄° *
°r
, c⁄° 
addröfo
 *addrinfo)

71 
fd
, 
i
;

73 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

74 
addröfo
->
ai_¥Ÿocﬁ
);

75 i‡(
fd
 < 0)

76 
	`exô
(1);

77 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

78 
	`exô
(2);

79 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

80 
i
 = 0; i < 
	`°æí
(
°r
); i++) {

81 i‡(
	`wrôe
(
fd
, 
°r
 + 
i
, 1) != 1)

84 
	`˛o£
(
fd
);

85 
	}
}

87 
	$maö
()

89 
d©a
 *
d
 = 
	`mÆloc
((*d));

90 
addröfo
 *addrinfo;

91 
io_li°íî
 *
l
;

92 
fd
, 
°©us
;

95 
	`∂™_ã°s
(22);

96 
d
->
°©e
 = 0;

97 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

98 
	`ok1
(
fd
 >= 0);

99 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

100 
	`ok1
(
l
);

101 
	`fÊush
(
°dout
);

102 i‡(!
	`f‹k
()) {

103 
	`io_˛o£_li°íî
(
l
);

104 
	`wrôe_to_sockë
("hñlŸhîe", 
addröfo
);

105 
	`‰ìaddröfo
(
addröfo
);

106 
	`‰ì
(
d
);

107 
	`exô
(0);

109 
	`ok1
(
	`io_lo›
(Ë=
d
);

110 
	`ok1
(
d
->
°©e
 == 2);

111 
	`ok1
(
d
->
byãs
 > 0);

112 
	`ok1
(
d
->
byãs
 <(d->
buf
));

113 
	`ok1
(
	`memcmp
(
d
->
buf
, "hñlŸhîe", d->
byãs
) == 0);

115 
	`ok1
(
	`waô
(&
°©us
));

116 
	`ok1
(
	`WIFEXITED
(
°©us
));

117 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

119 
	`fÊush
(
°dout
);

120 i‡(!
	`f‹k
()) {

121 
	`io_˛o£_li°íî
(
l
);

122 
	`wrôe_to_sockë
("hi", 
addröfo
);

123 
	`‰ìaddröfo
(
addröfo
);

124 
	`‰ì
(
d
);

125 
	`exô
(0);

127 
d
->
°©e
 = 0;

128 
	`ok1
(
	`io_lo›
(Ë=
d
);

129 
	`ok1
(
d
->
°©e
 == 2);

130 
	`ok1
(
d
->
byãs
 > 0);

131 
	`ok1
(
d
->
byãs
 <
	`°æí
("hi"));

132 
	`ok1
(
	`memcmp
(
d
->
buf
, "hi", d->
byãs
) == 0);

134 
	`‰ìaddröfo
(
addröfo
);

135 
	`‰ì
(
d
);

136 
	`io_˛o£_li°íî
(
l
);

138 
	`ok1
(
	`waô
(&
°©us
));

139 
	`ok1
(
	`WIFEXITED
(
°©us
));

140 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

143  
	`exô_°©us
();

144 
	}
}

	@ccan/ccan/io/test/run-04-writepartial-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64004"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-04-wrôï¨tül.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-04-writepartial.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65004"

	)

13 
	sd©a
 {

14 
	m°©e
;

15 
size_t
 
	mbyãs
;

16 *
	mbuf
;

19 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

21 
	`ok1
(
d
->
°©e
 == 1);

22 
d
->
°©e
++;

23 
	`io_bªak
(
d
, 
	`io_idÀ
());

24 
	}
}

26 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

28 
	`ok1
(
d
->
°©e
 == 0);

29 
d
->
°©e
++;

30 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
,

31 
	`io_wrôe_∑πül
(
d
->
buf
, &d->
byãs
, 
io_˛o£_cb
, d)),

32 
föish_ok
, 
d
);

33 
	}
}

35 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

37 
fd
, 
⁄
 = 1;

38 
addröfo
 *addröfo, 
höts
;

40 
	`mem£t
(&
höts
, 0, (hints));

41 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

42 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

43 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

44 
höts
.
ai_¥Ÿocﬁ
 = 0;

46 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

49 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

50 
addröfo
->
ai_¥Ÿocﬁ
);

51 i‡(
fd
 < 0)

54 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

55 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

56 
	`˛o£
(
fd
);

59 i‡(
	`li°í
(
fd
, 1) != 0) {

60 
	`˛o£
(
fd
);

63 *
öfo
 = 
addröfo
;

64  
fd
;

65 
	}
}

67 
	$ªad_‰om_sockë
(c⁄° *
°r
, c⁄° 
addröfo
 *addrinfo)

69 
fd
;

70 
buf
[100];

72 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

73 
addröfo
->
ai_¥Ÿocﬁ
);

74 i‡(
fd
 < 0)

75 
	`exô
(1);

76 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

77 
	`exô
(2);

78 i‡(
	`ªad
(
fd
, 
buf
, 
	`°æí
(
°r
)) != strlen(str))

79 
	`exô
(3);

80 i‡(
	`memcmp
(
buf
, 
°r
, 
	`°æí
(str)) != 0)

81 
	`exô
(4);

82 
	`˛o£
(
fd
);

83 
	}
}

85 
	$maö
()

87 
d©a
 *
d
 = 
	`mÆloc
((*d));

88 
addröfo
 *addrinfo;

89 
io_li°íî
 *
l
;

90 
fd
, 
°©us
;

93 
	`∂™_ã°s
(11);

94 
d
->
°©e
 = 0;

95 
d
->
byãs
 = 1024*1024;

96 
d
->
buf
 = 
	`mÆloc
(d->
byãs
);

97 
	`mem£t
(
d
->
buf
, 'a', d->
byãs
);

98 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

99 
	`ok1
(
fd
 >= 0);

100 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

101 
	`ok1
(
l
);

102 
	`fÊush
(
°dout
);

103 i‡(!
	`f‹k
()) {

104 
	`io_˛o£_li°íî
(
l
);

105 
	`ªad_‰om_sockë
("ØØØ", 
addröfo
);

106 
	`‰ìaddröfo
(
addröfo
);

107 
	`‰ì
(
d
->
buf
);

108 
	`‰ì
(
d
);

109 
	`exô
(0);

111 
	`ok1
(
	`io_lo›
(Ë=
d
);

112 
	`ok1
(
d
->
°©e
 == 2);

113 
	`ok1
(
d
->
byãs
 > 0);

114 
	`ok1
(
d
->
byãs
 <= 1024*1024);

116 
	`ok1
(
	`waô
(&
°©us
));

117 
	`ok1
(
	`WIFEXITED
(
°©us
));

118 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

120 
	`‰ìaddröfo
(
addröfo
);

121 
	`‰ì
(
d
->
buf
);

122 
	`‰ì
(
d
);

123 
	`io_˛o£_li°íî
(
l
);

126  
	`exô_°©us
();

127 
	}
}

	@ccan/ccan/io/test/run-05-write-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64005"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-05-wrôe.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-05-write.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65005"

	)

13 
	sd©a
 {

14 
	m°©e
;

15 
size_t
 
	mbyãs
;

16 *
	mbuf
;

19 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

21 
	`ok1
(
d
->
°©e
 == 1);

22 
d
->
°©e
++;

23 
	`io_bªak
(
d
, 
	`io_idÀ
());

24 
	}
}

26 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

28 
	`ok1
(
d
->
°©e
 == 0);

29 
d
->
°©e
++;

30 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
, 
	`io_wrôe
(
d
->
buf
, d->
byãs
,

31 
io_˛o£_cb
, 
d
)),

32 
föish_ok
, 
d
);

33 
	}
}

35 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

37 
fd
, 
⁄
 = 1;

38 
addröfo
 *addröfo, 
höts
;

40 
	`mem£t
(&
höts
, 0, (hints));

41 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

42 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

43 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

44 
höts
.
ai_¥Ÿocﬁ
 = 0;

46 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

49 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

50 
addröfo
->
ai_¥Ÿocﬁ
);

51 i‡(
fd
 < 0)

54 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

55 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

56 
	`˛o£
(
fd
);

59 i‡(
	`li°í
(
fd
, 1) != 0) {

60 
	`˛o£
(
fd
);

63 *
öfo
 = 
addröfo
;

64  
fd
;

65 
	}
}

67 
	$ªad_‰om_sockë
(
size_t
 
byãs
, c⁄° 
addröfo
 *addrinfo)

69 
fd
, 
d⁄e
, 
r
;

70 
buf
[100];

72 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

73 
addröfo
->
ai_¥Ÿocﬁ
);

74 i‡(
fd
 < 0)

75 
	`exô
(1);

76 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

77 
	`exô
(2);

79 
d⁄e
 = 0; d⁄ê< 
byãs
; d⁄ê+
r
) {

80 
r
 = 
	`ªad
(
fd
, 
buf
, (buf));

81 i‡(
r
 < 0)

82 
	`exô
(3);

83 
d⁄e
 +
r
;

85 
	`˛o£
(
fd
);

86 
	}
}

88 
	$maö
()

90 
d©a
 *
d
 = 
	`mÆloc
((*d));

91 
addröfo
 *addrinfo;

92 
io_li°íî
 *
l
;

93 
fd
, 
°©us
;

96 
	`∂™_ã°s
(9);

97 
d
->
°©e
 = 0;

98 
d
->
byãs
 = 1024*1024;

99 
d
->
buf
 = 
	`mÆloc
(d->
byãs
);

100 
	`mem£t
(
d
->
buf
, 'a', d->
byãs
);

101 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

102 
	`ok1
(
fd
 >= 0);

103 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

104 
	`ok1
(
l
);

105 
	`fÊush
(
°dout
);

106 i‡(!
	`f‹k
()) {

107 
	`io_˛o£_li°íî
(
l
);

108 
	`ªad_‰om_sockë
(
d
->
byãs
, 
addröfo
);

109 
	`‰ìaddröfo
(
addröfo
);

110 
	`‰ì
(
d
->
buf
);

111 
	`‰ì
(
d
);

112 
	`exô
(0);

114 
	`ok1
(
	`io_lo›
(Ë=
d
);

115 
	`ok1
(
d
->
°©e
 == 2);

117 
	`ok1
(
	`waô
(&
°©us
));

118 
	`ok1
(
	`WIFEXITED
(
°©us
));

119 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

121 
	`‰ìaddröfo
(
addröfo
);

122 
	`‰ì
(
d
->
buf
);

123 
	`‰ì
(
d
);

124 
	`io_˛o£_li°íî
(
l
);

127  
	`exô_°©us
();

128 
	}
}

	@ccan/ccan/io/test/run-06-idle-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64006"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-06-idÀ.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-06-idle.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/°©.h
>

10 
	~<f˙é.h
>

12 #i‚de‡
PORT


13 
	#PORT
 "65006"

	)

16 
io_c⁄n
 *
	gidÀr
;

18 
	sd©a
 {

19 
	m°©e
;

20 
	mbuf
[4];

23 
io_∂™
 
	$ªad_d⁄e
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

25 
	`ok1
(
d
->
°©e
 == 2 || d->state == 3);

26 
d
->
°©e
++;

27  
	`io_˛o£
();

28 
	}
}

30 
	$föish_wakî
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

32 
	`io_wake
(
idÀr
, 
	`io_ªad
(
d
->
buf
, (d->buf), 
ªad_d⁄e
, d));

33 
	`ok1
(
d
->
°©e
 == 1);

34 
d
->
°©e
++;

35 
	}
}

37 
	$föish_idÀ
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

39 
	`ok1
(
d
->
°©e
 == 3);

40 
d
->
°©e
++;

41 
	`io_bªak
(
d
, 
	`io_idÀ
());

42 
	}
}

44 
io_∂™
 
	$√vî
(
io_c⁄n
 *
c⁄n
, *
¨g
)

46 
	`ab‹t
();

47 
	}
}

49 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

51 
fd2
;

53 
	`ok1
(
d
->
°©e
 == 0);

54 
d
->
°©e
++;

55 
idÀr
 = 
	`io_√w_c⁄n
(
fd
, 
	`io_idÀ
());

56 
	`io_£t_föish
(
idÀr
, 
föish_idÀ
, 
d
);

59 
fd2
 = 
	`›í
("/dev/nuŒ", 
O_RDONLY
);

60 
	`ok1
(
fd2
 >= 0);

61 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd2
, 
	`io_ªad
(
idÀr
, 1, 
√vî
, 
NULL
)),

62 
föish_wakî
, 
d
);

63 
	}
}

65 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

67 
fd
, 
⁄
 = 1;

68 
addröfo
 *addröfo, 
höts
;

70 
	`mem£t
(&
höts
, 0, (hints));

71 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

72 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

73 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

74 
höts
.
ai_¥Ÿocﬁ
 = 0;

76 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

79 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

80 
addröfo
->
ai_¥Ÿocﬁ
);

81 i‡(
fd
 < 0)

84 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

85 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

86 
	`˛o£
(
fd
);

89 i‡(
	`li°í
(
fd
, 1) != 0) {

90 
	`˛o£
(
fd
);

93 *
öfo
 = 
addröfo
;

94  
fd
;

95 
	}
}

97 
	$maö
()

99 
d©a
 *
d
 = 
	`mÆloc
((*d));

100 
addröfo
 *addrinfo;

101 
io_li°íî
 *
l
;

102 
fd
, 
°©us
;

105 
	`∂™_ã°s
(13);

106 
d
->
°©e
 = 0;

107 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

108 
	`ok1
(
fd
 >= 0);

109 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

110 
	`ok1
(
l
);

111 
	`fÊush
(
°dout
);

112 i‡(!
	`f‹k
()) {

113 
i
;

115 
	`io_˛o£_li°íî
(
l
);

116 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

117 
addröfo
->
ai_¥Ÿocﬁ
);

118 i‡(
fd
 < 0)

119 
	`exô
(1);

120 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

121 
	`exô
(2);

122 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

123 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

124 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

127 
	`˛o£
(
fd
);

128 
	`‰ìaddröfo
(
addröfo
);

129 
	`‰ì
(
d
);

130 
	`exô
(0);

132 
	`‰ìaddröfo
(
addröfo
);

134 
	`ok1
(
	`io_lo›
(Ë=
d
);

135 
	`ok1
(
d
->
°©e
 == 4);

136 
	`ok1
(
	`memcmp
(
d
->
buf
, "hellothere", (d->buf)) == 0);

137 
	`‰ì
(
d
);

138 
	`io_˛o£_li°íî
(
l
);

140 
	`ok1
(
	`waô
(&
°©us
));

141 
	`ok1
(
	`WIFEXITED
(
°©us
));

142 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

145  
	`exô_°©us
();

146 
	}
}

	@ccan/ccan/io/test/run-07-break-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64007"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-07-bªak.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-07-break.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65007"

	)

13 
	sd©a
 {

14 
	m°©e
;

15 
	mbuf
[4];

18 
io_∂™
 
	$ªad_d⁄e
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

20 
	`ok1
(
d
->
°©e
 == 1);

21 
d
->
°©e
++;

22  
	`io_˛o£
();

23 
	}
}

25 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

27 
	`ok1
(
d
->
°©e
 == 2);

28 
d
->
°©e
++;

29 
	}
}

31 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

33 
	`ok1
(
d
->
°©e
 == 0);

34 
d
->
°©e
++;

36 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
,

37 
	`io_bªak
(
d
,

38 
	`io_ªad
(
d
->
buf
, (d->buf), 
ªad_d⁄e
, d))),

39 
föish_ok
, 
d
);

40 
	}
}

42 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

44 
fd
, 
⁄
 = 1;

45 
addröfo
 *addröfo, 
höts
;

47 
	`mem£t
(&
höts
, 0, (hints));

48 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

49 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

50 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

51 
höts
.
ai_¥Ÿocﬁ
 = 0;

53 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

56 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

57 
addröfo
->
ai_¥Ÿocﬁ
);

58 i‡(
fd
 < 0)

61 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

62 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

63 
	`˛o£
(
fd
);

66 i‡(
	`li°í
(
fd
, 1) != 0) {

67 
	`˛o£
(
fd
);

70 *
öfo
 = 
addröfo
;

71  
fd
;

72 
	}
}

74 
	$maö
()

76 
d©a
 *
d
 = 
	`mÆloc
((*d));

77 
addröfo
 *addrinfo;

78 
io_li°íî
 *
l
;

79 
fd
, 
°©us
;

82 
	`∂™_ã°s
(13);

83 
d
->
°©e
 = 0;

84 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

85 
	`ok1
(
fd
 >= 0);

86 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

87 
	`ok1
(
l
);

88 
	`fÊush
(
°dout
);

89 i‡(!
	`f‹k
()) {

90 
i
;

92 
	`io_˛o£_li°íî
(
l
);

93 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

94 
addröfo
->
ai_¥Ÿocﬁ
);

95 i‡(
fd
 < 0)

96 
	`exô
(1);

97 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

98 
	`exô
(2);

99 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

100 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

101 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

104 
	`˛o£
(
fd
);

105 
	`‰ìaddröfo
(
addröfo
);

106 
	`‰ì
(
d
);

107 
	`exô
(0);

109 
	`‰ìaddröfo
(
addröfo
);

110 
	`ok1
(
	`io_lo›
(Ë=
d
);

111 
	`ok1
(
d
->
°©e
 == 1);

112 
	`io_˛o£_li°íî
(
l
);

114 
	`ok1
(
	`io_lo›
(Ë=
NULL
);

115 
	`ok1
(
d
->
°©e
 == 3);

116 
	`ok1
(
	`memcmp
(
d
->
buf
, "hellothere", (d->buf)) == 0);

117 
	`‰ì
(
d
);

119 
	`ok1
(
	`waô
(&
°©us
));

120 
	`ok1
(
	`WIFEXITED
(
°©us
));

121 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

124  
	`exô_°©us
();

125 
	}
}

	@ccan/ccan/io/test/run-08-hangup-on-idle-DEBUG.c

1 
	#DEBUG


	)

2 
	#maö
 
ªÆ_maö


	)

3 
ªÆ_maö
();

4 
	~"run-08-h™gup-⁄-idÀ.c
"

5 #unde‡
maö


6 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

7 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-08-hangup-on-idle.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 
	gfds2
[2];

11 
io_∂™
 
	$timeout_wakeup
(
io_c⁄n
 *
c⁄n
, *
buf
)

14 
	`˛o£
(
fds2
[1]);

15  
	`io_ªad
(
buf
, 16, 
io_˛o£_cb
, 
NULL
);

16 
	}
}

18 
	$maö
()

20 
fds
[2];

21 
io_c⁄n
 *
c⁄n
;

22 
buf
[16];

24 
	`∂™_ã°s
(4);

26 
	`ok1
(
	`pùe
(
fds
) == 0);

29 
	`io_√w_c⁄n
(
fds
[1], 
	`io_wrôe
("helloÅhere world", 16,

30 
io_˛o£_cb
, 
NULL
));

31 
c⁄n
 = 
	`io_√w_c⁄n
(
fds
[0], 
	`io_idÀ
());

34 
	`ok1
(
	`pùe
(
fds2
) == 0);

35 
	`io_√w_c⁄n
(
fds2
[0], 
	`io_ªad
(
buf
, 16, 
io_˛o£_cb
, 
NULL
));

38 
	`io_timeout
(
c⁄n
, 
	`time_‰om_m£c
(500), 
timeout_wakeup
, 
buf
);

40 
	`ok1
(
	`io_lo›
(Ë=
NULL
);

41 
	`ok1
(
	`memcmp
(
buf
, "helloÅhere world", 16) == 0);

44  
	`exô_°©us
();

45 
	}
}

	@ccan/ccan/io/test/run-08-read-after-hangup-DEBUG.c

1 
	#DEBUG


	)

2 
	#maö
 
ªÆ_maö


	)

3 
ªÆ_maö
();

4 
	~"run-08-ªad-a·î-h™gup.c
"

5 #unde‡
maö


6 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

7 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-08-read-after-hangup.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

8 
	~<sig«l.h
>

10 
	göbuf
[8];

12 
io_∂™
 
	$wake_ô
(
io_c⁄n
 *
c⁄n
, io_c⁄¿*
ªadî
)

14 
	`io_wake
(
ªadî
, 
	`io_ªad
(
öbuf
, 8, 
io_˛o£_cb
, 
NULL
));

15  
	`io_˛o£
();

16 
	}
}

18 
	$maö
()

20 
fds
[2];

21 
io_c⁄n
 *
c⁄n
;

23 
	`∂™_ã°s
(3);

25 
	`ok1
(
	`pùe
(
fds
) == 0);

26 
c⁄n
 = 
	`io_√w_c⁄n
(
fds
[0], 
	`io_idÀ
());

27 
	`io_√w_c⁄n
(
fds
[1], 
	`io_wrôe
("EASYTEST", 8, 
wake_ô
, 
c⁄n
));

29 
	`ok1
(
	`io_lo›
(Ë=
NULL
);

30 
	`ok1
(
	`memcmp
(
öbuf
, "EASYTEST", (inbuf)) == 0);

33  
	`exô_°©us
();

34 
	}
}

	@ccan/ccan/io/test/run-09-connect-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64009"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-09-c⁄√˘.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-09-connect.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65009"

	)

13 
io_li°íî
 *
	gl
;

15 
	sd©a
 {

16 
	m°©e
;

17 
	mbuf
[10];

20 
io_∂™
 
	$˛o£r
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

22 
d
->
°©e
++;

23  
	`io_˛o£
();

24 
	}
}

26 
io_∂™
 
	$c⁄√˘ed
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d2
)

28 
	`ok1
(
d2
->
°©e
 == 0);

29 
d2
->
°©e
++;

30  
	`io_ªad
(
d2
->
buf
, (d2->buf), 
˛o£r
, d2);

31 
	}
}

33 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

35 
	`ok1
(
d
->
°©e
 == 0);

36 
d
->
°©e
++;

37 
	`io_√w_c⁄n
(
fd
, 
	`io_wrôe
(
d
->
buf
, (d->buf), 
˛o£r
, d));

38 
	`io_˛o£_li°íî
(
l
);

39 
	}
}

41 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

43 
fd
, 
⁄
 = 1;

44 
addröfo
 *addröfo, 
höts
;

46 
	`mem£t
(&
höts
, 0, (hints));

47 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

48 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

49 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

50 
höts
.
ai_¥Ÿocﬁ
 = 0;

52 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

55 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

56 
addröfo
->
ai_¥Ÿocﬁ
);

57 i‡(
fd
 < 0)

60 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

61 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

62 
	`˛o£
(
fd
);

65 i‡(
	`li°í
(
fd
, 1) != 0) {

66 
	`˛o£
(
fd
);

69 *
öfo
 = 
addröfo
;

70  
fd
;

71 
	}
}

73 
	$maö
()

75 
d©a
 *
d
 = 
	`mÆloc
((*d)), *
d2
 = malloc((*d2));

76 
addröfo
 *addrinfo;

77 
fd
;

80 
	`∂™_ã°s
(8);

81 
d
->
°©e
 = 0;

82 
	`mem£t
(
d
->
buf
, 'a', (d->buf));

83 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

84 
	`ok1
(
fd
 >= 0);

85 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

86 
	`ok1
(
l
);

88 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

89 
addröfo
->
ai_¥Ÿocﬁ
);

90 
d2
->
°©e
 = 0;

91 
	`ok1
(
	`io_√w_c⁄n
(
fd
, 
	`io_c⁄√˘
(fd, 
addröfo
, 
c⁄√˘ed
, 
d2
)));

93 
	`ok1
(
	`io_lo›
(Ë=
NULL
);

94 
	`ok1
(
d
->
°©e
 == 2);

95 
	`ok1
(
d2
->
°©e
 == 2);

97 
	`‰ìaddröfo
(
addröfo
);

98 
	`‰ì
(
d
);

99 
	`‰ì
(
d2
);

102  
	`exô_°©us
();

103 
	}
}

	@ccan/ccan/io/test/run-10-many-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64010"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-10-m™y.c
"

6 #unde‡
maö


8 
boﬁ
 
	$debug_⁄e
(
io_c⁄n
 *
c⁄n
)

10  
c⁄n
 =
buf
[1].
ªadî
;

11 
	}
}

12 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
debug_⁄e
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-10-many.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 
	#NUM
 100

	)

10 
	#NUM_ITERS
 1000

	)

12 
	sbuf„r
 {

13 
	môîs
;

14 
io_c⁄n
 *
	mªadî
, *
	mwrôî
;

15 
	mbuf
[32];

18 
io_∂™
 
poke_ªadî
(
io_c⁄n
 *
c⁄n
, 
buf„r
 *
buf
);

20 
io_∂™
 
	$poke_wrôî
(
io_c⁄n
 *
c⁄n
, 
buf„r
 *
buf
)

22 
	`as£π
(
c⁄n
 =
buf
->
ªadî
);

24 i‡(
buf
->
ôîs
 =
NUM_ITERS
)

25  
	`io_˛o£
();

28 
	`io_wake
(
buf
->
wrôî
,

29 
	`io_wrôe
(&
buf
->buf, (buf->buf), 
poke_ªadî
, buf));

32  
	`io_idÀ
();

33 
	}
}

35 
io_∂™
 
	$poke_ªadî
(
io_c⁄n
 *
c⁄n
, 
buf„r
 *
buf
)

37 
	`as£π
(
c⁄n
 =
buf
->
wrôî
);

39 
	`io_wake
(
buf
->
ªadî
,

40 
	`io_ªad
(&
buf
->buf, (buf->buf), 
poke_wrôî
, buf));

42 i‡(++
buf
->
ôîs
 =
NUM_ITERS
)

43  
	`io_˛o£
();

46  
	`io_idÀ
();

47 
	}
}

49 
buf„r
 
	gbuf
[
NUM
];

51 
	$maö
()

53 
i
;

54 
fds
[2], 
œ°_ªad
, 
œ°_wrôe
;

56 
	`∂™_ã°s
(5 + 
NUM
);

58 
	`ok1
(
	`pùe
(
fds
) == 0);

59 
œ°_ªad
 = 
fds
[0];

60 
œ°_wrôe
 = 
fds
[1];

62 
i
 = 1; i < 
NUM
; i++) {

63 i‡(
	`pùe
(
fds
) < 0)

65 
	`mem£t
(
buf
[
i
].buf, i, (buf[i].buf));

66 
	`•rötf
(
buf
[
i
].buf, "%i-%i", i, i);

69 
buf
[
i
].
ªadî
 = 
	`io_√w_c⁄n
(
œ°_ªad
, 
	`io_idÀ
());

70 i‡(!
buf
[
i
].
ªadî
)

72 
buf
[
i
].
wrôî
 = 
	`io_√w_c⁄n
(
fds
[1],

73 
	`io_wrôe
(&
buf
[
i
].buf,

74 (
buf
[
i
].buf),

75 
poke_ªadî
, &
buf
[
i
]));

76 i‡(!
buf
[
i
].
wrôî
)

78 
œ°_ªad
 = 
fds
[0];

80 i‡(!
	`ok1
(
i
 =
NUM
))

81 
	`exô
(
	`exô_°©us
());

84 
i
 = 0;

85 
	`•rötf
(
buf
[
i
].buf, "%i-%i", i, i);

86 
buf
[
i
].
ªadî
 = 
	`io_√w_c⁄n
(
œ°_ªad
, 
	`io_idÀ
());

87 
	`ok1
(
buf
[
i
].
ªadî
);

88 
buf
[
i
].
wrôî
 = 
	`io_√w_c⁄n
(
œ°_wrôe
,

89 
	`io_wrôe
(&
buf
[
i
].buf, (buf[i].buf),

90 
poke_ªadî
, &
buf
[
i
]));

91 
	`ok1
(
buf
[
i
].
wrôî
);

94 
	`ok1
(
	`io_lo›
(Ë=
NULL
);

96 
i
 = 0; i < 
NUM
; i++) {

97 
b
[(
buf
[0].buf)];

98 
	`mem£t
(
b
, 
i
, (b));

99 
	`•rötf
(
b
, "%i-%i", 
i
, i);

100 
	`ok1
(
	`memcmp
(
b
, 
buf
[(
i
 + 
NUM_ITERS
Ë% 
NUM
].buf, (b)) == 0);

104  
	`exô_°©us
();

105 
	}
}

	@ccan/ccan/io/test/run-12-bidir-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64012"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-12-bidú.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-12-bidir.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65012"

	)

13 
	sd©a
 {

14 
io_li°íî
 *
	ml
;

15 
	m°©e
;

16 
	mbuf
[4];

17 
	mwbuf
[32];

20 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

22 
d
->
°©e
++;

23 
	}
}

25 
io_∂™
 
	$wrôe_d⁄e
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

27 
d
->
°©e
++;

28  
	`io_˛o£
();

29 
	}
}

31 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

33 
io_c⁄n
 *
c⁄n
;

35 
	`ok1
(
d
->
°©e
 == 0);

36 
d
->
°©e
++;

38 
	`io_˛o£_li°íî
(
d
->
l
);

40 
	`mem£t
(
d
->
wbuf
, 7, (d->wbuf));

42 
c⁄n
 = 
	`io_√w_c⁄n
(
fd
, 
	`io_ªad
(
d
->
buf
, (d->buf), 
io_˛o£_cb
, d));

43 
	`io_£t_föish
(
c⁄n
, 
föish_ok
, 
d
);

44 
c⁄n
 = 
	`io_du∂ex
(c⁄n, 
	`io_wrôe
(
d
->
wbuf
, (d->wbuf), 
wrôe_d⁄e
, d));

45 
	`ok1
(
c⁄n
);

46 
	`io_£t_föish
(
c⁄n
, 
föish_ok
, 
d
);

47 
	}
}

49 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

51 
fd
, 
⁄
 = 1;

52 
addröfo
 *addröfo, 
höts
;

54 
	`mem£t
(&
höts
, 0, (hints));

55 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

56 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

57 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

58 
höts
.
ai_¥Ÿocﬁ
 = 0;

60 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

63 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

64 
addröfo
->
ai_¥Ÿocﬁ
);

65 i‡(
fd
 < 0)

68 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

69 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

70 
	`˛o£
(
fd
);

73 i‡(
	`li°í
(
fd
, 1) != 0) {

74 
	`˛o£
(
fd
);

77 *
öfo
 = 
addröfo
;

78  
fd
;

79 
	}
}

81 
	$maö
()

83 
d©a
 *
d
 = 
	`mÆloc
((*d));

84 
addröfo
 *addrinfo;

85 
fd
, 
°©us
;

88 
	`∂™_ã°s
(10);

89 
d
->
°©e
 = 0;

90 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

91 
	`ok1
(
fd
 >= 0);

92 
d
->
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, d);

93 
	`ok1
(
d
->
l
);

94 
	`fÊush
(
°dout
);

95 i‡(!
	`f‹k
()) {

96 
i
;

97 
buf
[32];

99 
	`io_˛o£_li°íî
(
d
->
l
);

100 
	`‰ì
(
d
);

101 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

102 
addröfo
->
ai_¥Ÿocﬁ
);

103 i‡(
fd
 < 0)

104 
	`exô
(1);

105 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

106 
	`exô
(2);

107 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

108 
i
 = 0; i < 32; i++) {

109 i‡(
	`ªad
(
fd
, 
buf
+
i
, 1) != 1)

112 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

113 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

116 
	`˛o£
(
fd
);

117 
	`‰ìaddröfo
(
addröfo
);

118 
	`exô
(0);

120 
	`‰ìaddröfo
(
addröfo
);

121 
	`ok1
(
	`io_lo›
(Ë=
NULL
);

122 
	`ok1
(
d
->
°©e
 == 4);

123 
	`ok1
(
	`memcmp
(
d
->
buf
, "hellothere", (d->buf)) == 0);

124 
	`‰ì
(
d
);

126 
	`ok1
(
	`waô
(&
°©us
));

127 
	`ok1
(
	`WIFEXITED
(
°©us
));

128 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

131  
	`exô_°©us
();

132 
	}
}

	@ccan/ccan/io/test/run-13-all-idle-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64013"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-13-Æl-idÀ.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-13-all-idle.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

8 
	~<sig«l.h
>

10 
	$maö
()

12 
°©us
;

14 
	`∂™_ã°s
(3);

16 i‡(
	`f‹k
() == 0) {

17 
fds
[2];

19 
	`ok1
(
	`pùe
(
fds
) == 0);

20 
	`io_√w_c⁄n
(
fds
[0], 
	`io_idÀ
());

21 
	`io_lo›
();

22 
	`exô
(1);

25 
	`ok1
(
	`waô
(&
°©us
) != -1);

26 
	`ok1
(
	`WIFSIGNALED
(
°©us
));

27 
	`ok1
(
	`WTERMSIG
(
°©us
Ë=
SIGABRT
);

30  
	`exô_°©us
();

31 
	}
}

	@ccan/ccan/io/test/run-15-timeout-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64015"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-15-timeout.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-15-timeout.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

10 #i‚de‡
PORT


11 
	#PORT
 "65015"

	)

14 
	sd©a
 {

15 
	m°©e
;

16 
	mtimeout_u£c
;

17 
boﬁ
 
	mtimed_out
;

18 
	mbuf
[4];

22 
io_∂™
 
	$no_timeout
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

24 
	`ok1
(
d
->
°©e
 == 1);

25 
d
->
°©e
++;

26  
	`io_˛o£
();

27 
	}
}

29 
io_∂™
 
	$timeout
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

31 
	`ok1
(
d
->
°©e
 == 1);

32 
d
->
°©e
++;

33 
d
->
timed_out
 = 
åue
;

34  
	`io_˛o£
();

35 
	}
}

37 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

39 
	`ok1
(
d
->
°©e
 == 2);

40 
d
->
°©e
++;

41 
	`io_bªak
(
d
, 
	`io_idÀ
());

42 
	}
}

44 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

46 
io_c⁄n
 *
c⁄n
;

48 
	`ok1
(
d
->
°©e
 == 0);

49 
d
->
°©e
++;

51 
c⁄n
 = 
	`io_√w_c⁄n
(
fd
, 
	`io_ªad
(
d
->
buf
, (d->buf), 
no_timeout
, d));

52 
	`io_£t_föish
(
c⁄n
, 
föish_ok
, 
d
);

53 
	`io_timeout
(
c⁄n
, 
	`time_‰om_u£c
(
d
->
timeout_u£c
), 
timeout
, d);

54 
	}
}

56 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

58 
fd
, 
⁄
 = 1;

59 
addröfo
 *addröfo, 
höts
;

61 
	`mem£t
(&
höts
, 0, (hints));

62 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

63 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

64 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

65 
höts
.
ai_¥Ÿocﬁ
 = 0;

67 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

70 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

71 
addröfo
->
ai_¥Ÿocﬁ
);

72 i‡(
fd
 < 0)

75 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

76 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

77 
	`˛o£
(
fd
);

80 i‡(
	`li°í
(
fd
, 1) != 0) {

81 
	`˛o£
(
fd
);

84 *
öfo
 = 
addröfo
;

85  
fd
;

86 
	}
}

88 
	$maö
()

90 
d©a
 *
d
 = 
	`mÆloc
((*d));

91 
addröfo
 *addrinfo;

92 
io_li°íî
 *
l
;

93 
fd
, 
°©us
;

96 
	`∂™_ã°s
(20);

97 
d
->
°©e
 = 0;

98 
d
->
timed_out
 = 
Ál£
;

99 
d
->
timeout_u£c
 = 100000;

100 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

101 
	`ok1
(
fd
 >= 0);

102 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

103 
	`ok1
(
l
);

104 
	`fÊush
(
°dout
);

106 i‡(!
	`f‹k
()) {

107 
i
;

109 
	`io_˛o£_li°íî
(
l
);

110 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

111 
addröfo
->
ai_¥Ÿocﬁ
);

112 i‡(
fd
 < 0)

113 
	`exô
(1);

114 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

115 
	`exô
(2);

116 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

117 
	`u¶ìp
(500000);

118 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

119 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

122 
	`˛o£
(
fd
);

123 
	`‰ìaddröfo
(
addröfo
);

124 
	`‰ì
(
d
);

125 
	`exô
(
i
);

127 
	`ok1
(
	`io_lo›
(Ë=
d
);

128 
	`ok1
(
d
->
°©e
 == 3);

129 
	`ok1
(
d
->
timed_out
 =
åue
);

130 
	`ok1
(
	`waô
(&
°©us
));

131 
	`ok1
(
	`WIFEXITED
(
°©us
));

132 
	`ok1
(
	`WEXITSTATUS
(
°©us
Ë< (
d
->
buf
));

135 
d
->
°©e
 = 0;

136 
d
->
timed_out
 = 
Ál£
;

137 
d
->
timeout_u£c
 = 500000;

138 
	`fÊush
(
°dout
);

140 i‡(!
	`f‹k
()) {

141 
i
;

143 
	`io_˛o£_li°íî
(
l
);

144 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

145 
addröfo
->
ai_¥Ÿocﬁ
);

146 i‡(
fd
 < 0)

147 
	`exô
(1);

148 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

149 
	`exô
(2);

150 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

151 
	`u¶ìp
(100000);

152 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

153 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

156 
	`˛o£
(
fd
);

157 
	`‰ìaddröfo
(
addröfo
);

158 
	`‰ì
(
d
);

159 
	`exô
(
i
);

161 
	`ok1
(
	`io_lo›
(Ë=
d
);

162 
	`ok1
(
d
->
°©e
 == 3);

163 
	`ok1
(
d
->
timed_out
 =
Ál£
);

164 
	`ok1
(
	`waô
(&
°©us
));

165 
	`ok1
(
	`WIFEXITED
(
°©us
));

166 
	`ok1
(
	`WEXITSTATUS
(
°©us
Ë>(
d
->
buf
));

168 
	`io_˛o£_li°íî
(
l
);

169 
	`‰ìaddröfo
(
addröfo
);

170 
	`‰ì
(
d
);

173  
	`exô_°©us
();

174 
	}
}

	@ccan/ccan/io/test/run-17-homemade-io-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64017"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-17-homemade-io.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-17-homemade-io.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65017"

	)

13 
	s∑ckë
 {

14 
	m°©e
;

15 
size_t
 
	mÀn
;

16 *
	mc⁄ã¡s
;

19 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
∑ckë
 *
pkt
)

21 
	`ok1
(
pkt
->
°©e
 == 3);

22 
pkt
->
°©e
++;

23 
	`io_bªak
(
pkt
, 
	`io_idÀ
());

24 
	}
}

26 
	$do_ªad_∑ckë
(
fd
, 
io_∂™
 *
∂™
)

28 
∑ckë
 *
pkt
 = 
∂™
->
u1
.
vp
;

29 *
de°
;

30 
ssize_t
 
ªt
;

31 
size_t
 
off
, 
tŸÀn
;

34 i‡(
∂™
->
u2
.
s
 < (
size_t
)) {

35 
	`ok1
(
pkt
->
°©e
 == 1);

36 
pkt
->
°©e
++;

37 
de°
 = (*)&
pkt
->
Àn
;

38 
off
 = 
∂™
->
u2
.
s
;

39 
tŸÀn
 = (
pkt
->
Àn
);

41 
	`ok1
(
pkt
->
°©e
 == 2);

42 
pkt
->
°©e
++;

43 i‡(
pkt
->
Àn
 == 0)

44  
	`io_debug_io
(1);

45 i‡(!
pkt
->
c⁄ã¡s
 && !’kt->c⁄ã¡†
	`mÆloc
’kt->
Àn
)))

46 
Áû
;

48 
de°
 = 
pkt
->
c⁄ã¡s
;

49 
off
 = 
∂™
->
u2
.
s
 - (
pkt
->
Àn
);

50 
tŸÀn
 = 
pkt
->
Àn
;

54 
ªt
 = 
	`ªad
(
fd
, 
de°
 + 
off
, 
tŸÀn
 - off);

55 i‡(
ªt
 <= 0)

56 
Áû
;

58 
∂™
->
u2
.
s
 +
ªt
;

61  
	`io_debug_io
(
∂™
->
u2
.
s
 >(
pkt
->
Àn
)

62 && 
∂™
->
u2
.
s
 =
pkt
->
Àn
 + (pkt->len));

64 
Áû
:

65 
	`‰ì
(
pkt
->
c⁄ã¡s
);

66  
	`io_debug_io
(-1);

67 
	}
}

69 
io_∂™
 
io_ªad_∑ckë
(
∑ckë
 *
pkt
,

70 
	$io_∂™
 (*
cb
)(
io_c⁄n
 *, *),

71 *
¨g
)

73 
io_∂™
 
∂™
;

75 
	`as£π
(
cb
);

76 
pkt
->
c⁄ã¡s
 = 
NULL
;

77 
∂™
.
u1
.
vp
 = 
pkt
;

78 
∂™
.
u2
.
s
 = 0;

79 
∂™
.
io
 = 
do_ªad_∑ckë
;

80 
∂™
.
√xt
 = 
cb
;

81 
∂™
.
√xt_¨g
 = 
¨g
;

82 
∂™
.
pﬁlÊag
 = 
POLLIN
;

84  
∂™
;

85 
	}
}

87 
	$öô_c⁄n
(
fd
, 
∑ckë
 *
pkt
)

89 
	`ok1
(
pkt
->
°©e
 == 0);

90 
pkt
->
°©e
++;

92 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
, 
	`io_ªad_∑ckë
(
pkt
, 
io_˛o£_cb
,Ökt)),

93 
föish_ok
, 
pkt
);

94 
	}
}

96 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

98 
fd
, 
⁄
 = 1;

99 
addröfo
 *addröfo, 
höts
;

101 
	`mem£t
(&
höts
, 0, (hints));

102 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

103 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

104 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

105 
höts
.
ai_¥Ÿocﬁ
 = 0;

107 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

110 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

111 
addröfo
->
ai_¥Ÿocﬁ
);

112 i‡(
fd
 < 0)

115 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

116 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

117 
	`˛o£
(
fd
);

120 i‡(
	`li°í
(
fd
, 1) != 0) {

121 
	`˛o£
(
fd
);

124 *
öfo
 = 
addröfo
;

125  
fd
;

126 
	}
}

128 
	$maö
()

130 
∑ckë
 *
pkt
 = 
	`mÆloc
((*pkt));

131 
addröfo
 *addrinfo;

132 
io_li°íî
 *
l
;

133 
fd
, 
°©us
;

136 
	`∂™_ã°s
(13);

137 
pkt
->
°©e
 = 0;

138 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

139 
	`ok1
(
fd
 >= 0);

140 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
pkt
);

141 
	`ok1
(
l
);

142 
	`fÊush
(
°dout
);

143 i‡(!
	`f‹k
()) {

145 
size_t
 
Àn
;

146 
d©a
[8];

147 } 
d©a
;

149 
	`io_˛o£_li°íî
(
l
);

150 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

151 
addröfo
->
ai_¥Ÿocﬁ
);

152 i‡(
fd
 < 0)

153 
	`exô
(1);

154 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

155 
	`exô
(2);

156 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

158 
d©a
.
Àn
 = (data.data);

159 
	`mem˝y
(
d©a
.data, "hithere!", (data.data));

160 i‡(
	`wrôe
(
fd
, &
d©a
, (data)) != (data))

161 
	`exô
(3);

163 
	`˛o£
(
fd
);

164 
	`‰ìaddröfo
(
addröfo
);

165 
	`‰ì
(
pkt
);

166 
	`exô
(0);

168 
	`‰ìaddröfo
(
addröfo
);

169 
	`ok1
(
	`io_lo›
(Ë=
pkt
);

170 
	`ok1
(
pkt
->
°©e
 == 4);

171 
	`ok1
(
pkt
->
Àn
 == 8);

172 
	`ok1
(
	`memcmp
(
pkt
->
c⁄ã¡s
, "hithere!", 8) == 0);

173 
	`‰ì
(
pkt
->
c⁄ã¡s
);

174 
	`‰ì
(
pkt
);

175 
	`io_˛o£_li°íî
(
l
);

177 
	`ok1
(
	`waô
(&
°©us
));

178 
	`ok1
(
	`WIFEXITED
(
°©us
));

179 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

182  
	`exô_°©us
();

183 
	}
}

	@ccan/ccan/io/test/run-18-errno-DEBUG.c

1 
	#DEBUG


	)

2 
	#PORT
 "64018"

	)

3 
	#maö
 
ªÆ_maö


	)

4 
ªÆ_maö
();

5 
	~"run-18-î∫o.c
"

6 #unde‡
maö


7 
boﬁ
 
	$Æways_debug
(
io_c⁄n
 *
c⁄n
Ë{  
åue
; 
	}
}

8 
	$maö
(Ë{ 
io_debug_c⁄n
 = 
Æways_debug
;  
	`ªÆ_maö
(); 
	}
}

	@ccan/ccan/io/test/run-18-errno.c

1 
	~<cˇn/io/io.h
>

3 
	~<cˇn/io/pﬁl.c
>

4 
	~<cˇn/io/io.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

9 #i‚de‡
PORT


10 
	#PORT
 "65018"

	)

13 
	$föish_100
(
io_c⁄n
 *
c⁄n
, *
°©e
)

15 
	`ok1
(
î∫o
 == 100);

16 
	`ok1
(*
°©e
 == 1);

17 (*
°©e
)++;

18 
	}
}

20 
	$föish_EBADF
(
io_c⁄n
 *
c⁄n
, *
°©e
)

22 
	`ok1
(
î∫o
 =
EBADF
);

23 
	`ok1
(*
°©e
 == 3);

24 (*
°©e
)++;

25 
	`io_bªak
(
°©e
 + 1, 
	`io_˛o£
());

26 
	}
}

28 
	$öô_c⁄n
(
fd
, *
°©e
)

30 i‡(*
°©e
 == 0) {

31 (*
°©e
)++;

32 
î∫o
 = 100;

33 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
, 
	`io_˛o£
()), 
föish_100
, 
°©e
);

35 
	`ok1
(*
°©e
 == 2);

36 (*
°©e
)++;

37 
	`˛o£
(
fd
);

38 
î∫o
 = 0;

39 
	`io_£t_föish
(
	`io_√w_c⁄n
(
fd
, 
	`io_ªad
(
°©e
, 0,

40 
io_˛o£_cb
, 
NULL
)),

41 
föish_EBADF
, 
°©e
);

43 
	}
}

45 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

47 
fd
, 
⁄
 = 1;

48 
addröfo
 *addröfo, 
höts
;

50 
	`mem£t
(&
höts
, 0, (hints));

51 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

52 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

53 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

54 
höts
.
ai_¥Ÿocﬁ
 = 0;

56 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

59 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

60 
addröfo
->
ai_¥Ÿocﬁ
);

61 i‡(
fd
 < 0)

64 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

65 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

66 
	`˛o£
(
fd
);

69 i‡(
	`li°í
(
fd
, 1) != 0) {

70 
	`˛o£
(
fd
);

73 *
öfo
 = 
addröfo
;

74  
fd
;

75 
	}
}

77 
	$maö
()

79 
°©e
 = 0;

80 
addröfo
 *addrinfo;

81 
io_li°íî
 *
l
;

82 
fd
;

85 
	`∂™_ã°s
(12);

86 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

87 
	`ok1
(
fd
 >= 0);

88 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, &
°©e
);

89 
	`ok1
(
l
);

90 
	`fÊush
(
°dout
);

91 i‡(!
	`f‹k
()) {

92 
	`io_˛o£_li°íî
(
l
);

93 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

94 
addröfo
->
ai_¥Ÿocﬁ
);

95 i‡(
fd
 < 0)

96 
	`exô
(1);

97 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

98 
	`exô
(2);

99 
	`˛o£
(
fd
);

100 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

101 
addröfo
->
ai_¥Ÿocﬁ
);

102 i‡(
fd
 < 0)

103 
	`exô
(3);

104 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

105 
	`exô
(4);

106 
	`˛o£
(
fd
);

107 
	`‰ìaddröfo
(
addröfo
);

108 
	`exô
(0);

110 
	`‰ìaddröfo
(
addröfo
);

111 
	`ok1
(
	`io_lo›
(Ë=&
°©e
 + 1);

112 
	`ok1
(
°©e
 == 4);

113 
	`io_˛o£_li°íî
(
l
);

114 
	`ok1
(
	`waô
(&
°©e
));

115 
	`ok1
(
	`WIFEXITED
(
°©e
));

116 
	`ok1
(
	`WEXITSTATUS
(
°©e
) == 0);

119  
	`exô_°©us
();

120 
	}
}

	@ccan/ccan/io/test/run-set_alloc.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<sig«l.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/waô.h
>

9 *
	$no_mÆloc
(
size_t
 
size
)

11 
	`ab‹t
();

12 
	}
}

13 *
	$no_ªÆloc
(*
p
, 
size_t
 
size
)

15 
	`ab‹t
();

16 
	}
}

17 
	$no_‰ì
(*
p
)

19 
	`ab‹t
();

20 
	}
}

21 
	#mÆloc
 
no_mÆloc


	)

22 
	#ªÆloc
 
no_ªÆloc


	)

23 
	#‰ì
 
no_‰ì


	)

25 
	~<cˇn/io/pﬁl.c
>

26 
	~<cˇn/io/io.c
>

28 #unde‡
mÆloc


29 #unde‡
ªÆloc


30 #unde‡
‰ì


32 
	gÆloc_cou¡
, 
	gªÆloc_cou¡
, 
	g‰ì_cou¡
;

33 *
	g±rs
[100];

35 **
	$föd_±r
(*
p
)

37 
i
;

39 
i
 = 0; i < 100; i++)

40 i‡(
±rs
[
i
] =
p
)

41  
±rs
 + 
i
;

42  
NULL
;

43 
	}
}

45 *
	$Æloc‚
(
size_t
 
size
)

47 
Æloc_cou¡
++;

48  *
	`föd_±r
(
NULL
Ë
	`mÆloc
(
size
);

49 
	}
}

51 *
	$ªÆloc‚
(*
±r
, 
size_t
 
size
)

53 
ªÆloc_cou¡
++;

54 i‡(!
±r
)

55 
Æloc_cou¡
++;

57  *
	`föd_±r
(
±r
Ë
	`ªÆloc
’å, 
size
);

58 
	}
}

60 
	$‰ì‚
(*
±r
)

62 
‰ì_cou¡
++;

63 
	`‰ì
(
±r
);

64 *
	`föd_±r
(
±r
Ë
NULL
;

65 
	}
}

67 #i‚de‡
PORT


68 
	#PORT
 "65015"

	)

71 
	sd©a
 {

72 
	m°©e
;

73 
	mtimeout_u£c
;

74 
boﬁ
 
	mtimed_out
;

75 
	mbuf
[4];

79 
io_∂™
 
	$no_timeout
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

81 
	`ok1
(
d
->
°©e
 == 1);

82 
d
->
°©e
++;

83  
	`io_˛o£
();

84 
	}
}

86 
io_∂™
 
	$timeout
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

88 
	`ok1
(
d
->
°©e
 == 1);

89 
d
->
°©e
++;

90 
d
->
timed_out
 = 
åue
;

91  
	`io_˛o£
();

92 
	}
}

94 
	$föish_ok
(
io_c⁄n
 *
c⁄n
, 
d©a
 *
d
)

96 
	`ok1
(
d
->
°©e
 == 2);

97 
d
->
°©e
++;

98 
	`io_bªak
(
d
, 
	`io_idÀ
());

99 
	}
}

101 
	$öô_c⁄n
(
fd
, 
d©a
 *
d
)

103 
io_c⁄n
 *
c⁄n
;

105 
	`ok1
(
d
->
°©e
 == 0);

106 
d
->
°©e
++;

108 
c⁄n
 = 
	`io_√w_c⁄n
(
fd
, 
	`io_ªad
(
d
->
buf
, (d->buf), 
no_timeout
, d));

109 
	`io_£t_föish
(
c⁄n
, 
föish_ok
, 
d
);

110 
	`io_timeout
(
c⁄n
, 
	`time_‰om_u£c
(
d
->
timeout_u£c
), 
timeout
, d);

111 
	}
}

113 
	$make_li°í_fd
(c⁄° *
p‹t
, 
addröfo
 **
öfo
)

115 
fd
, 
⁄
 = 1;

116 
addröfo
 *addröfo, 
höts
;

118 
	`mem£t
(&
höts
, 0, (hints));

119 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

120 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

121 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

122 
höts
.
ai_¥Ÿocﬁ
 = 0;

124 i‡(
	`gëaddröfo
(
NULL
, 
p‹t
, &
höts
, &
addröfo
) != 0)

127 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

128 
addröfo
->
ai_¥Ÿocﬁ
);

129 i‡(
fd
 < 0)

132 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

133 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0) {

134 
	`˛o£
(
fd
);

137 i‡(
	`li°í
(
fd
, 1) != 0) {

138 
	`˛o£
(
fd
);

141 *
öfo
 = 
addröfo
;

142  
fd
;

143 
	}
}

145 
	$maö
()

147 
d©a
 *
d
 = 
	`Æloc‚
((*d));

148 
addröfo
 *addrinfo;

149 
io_li°íî
 *
l
;

150 
fd
, 
°©us
;

152 
	`io_£t_Æloc
(
Æloc‚
, 
ªÆloc‚
, 
‰ì‚
);

155 
	`∂™_ã°s
(25);

156 
d
->
°©e
 = 0;

157 
d
->
timed_out
 = 
Ál£
;

158 
d
->
timeout_u£c
 = 100000;

159 
fd
 = 
	`make_li°í_fd
(
PORT
, &
addröfo
);

160 
	`ok1
(
fd
 >= 0);

161 
l
 = 
	`io_√w_li°íî
(
fd
, 
öô_c⁄n
, 
d
);

162 
	`ok1
(
l
);

163 
	`fÊush
(
°dout
);

165 i‡(!
	`f‹k
()) {

166 
i
;

168 
	`io_˛o£_li°íî
(
l
);

169 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

170 
addröfo
->
ai_¥Ÿocﬁ
);

171 i‡(
fd
 < 0)

172 
	`exô
(1);

173 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

174 
	`exô
(2);

175 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

176 
	`u¶ìp
(500000);

177 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

178 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

181 
	`˛o£
(
fd
);

182 
	`‰ìaddröfo
(
addröfo
);

183 
	`‰ì
(
d
);

184 
	`exô
(
i
);

186 
	`ok1
(
	`io_lo›
(Ë=
d
);

187 
	`ok1
(
d
->
°©e
 == 3);

188 
	`ok1
(
d
->
timed_out
 =
åue
);

189 
	`ok1
(
	`waô
(&
°©us
));

190 
	`ok1
(
	`WIFEXITED
(
°©us
));

191 
	`ok1
(
	`WEXITSTATUS
(
°©us
Ë< (
d
->
buf
));

194 
d
->
°©e
 = 0;

195 
d
->
timed_out
 = 
Ál£
;

196 
d
->
timeout_u£c
 = 500000;

197 
	`fÊush
(
°dout
);

199 i‡(!
	`f‹k
()) {

200 
i
;

202 
	`io_˛o£_li°íî
(
l
);

203 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

204 
addröfo
->
ai_¥Ÿocﬁ
);

205 i‡(
fd
 < 0)

206 
	`exô
(1);

207 i‡(
	`c⁄√˘
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

208 
	`exô
(2);

209 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

210 
	`u¶ìp
(100000);

211 
i
 = 0; i < 
	`°æí
("hellothere"); i++) {

212 i‡(
	`wrôe
(
fd
, "hñlŸhîe" + 
i
, 1) != 1)

215 
	`˛o£
(
fd
);

216 
	`‰ìaddröfo
(
addröfo
);

217 
	`‰ì
(
d
);

218 
	`exô
(
i
);

220 
	`ok1
(
	`io_lo›
(Ë=
d
);

221 
	`ok1
(
d
->
°©e
 == 3);

222 
	`ok1
(
d
->
timed_out
 =
Ál£
);

223 
	`ok1
(
	`waô
(&
°©us
));

224 
	`ok1
(
	`WIFEXITED
(
°©us
));

225 
	`ok1
(
	`WEXITSTATUS
(
°©us
Ë>(
d
->
buf
));

227 
	`io_˛o£_li°íî
(
l
);

228 
	`‰ìaddröfo
(
addröfo
);

231 
	`ok1
(
ªÆloc_cou¡
);

232 
	`ok1
(
Æloc_cou¡
);

233 
	`ok1
(
‰ì_cou¡
);

235 
	`ok1
(
‰ì_cou¡
 < 
Æloc_cou¡
);

236 
	`‰ì‚
(
d
);

237 
	`ok1
(
‰ì_cou¡
 =
Æloc_cou¡
);

239  
	`exô_°©us
();

240 
	}
}

	@ccan/ccan/isaac/isaac.c

4 
	~<Êﬂt.h
>

5 
	~<m©h.h
>

6 
	~<°rög.h
>

7 
	~<cˇn/ûog/ûog.h
>

8 
	~"ißac.h
"

11 
	#ISAAC_MASK
 (0xFFFFFFFFU)

	)

14 
ölöe
 
uöt32_t
 
	$lowî_bôs
(
uöt32_t
 
x
)

16  (
x
 & ((
ISAAC_SZ
-1) << 2)) >> 2;

17 
	}
}

20 
ölöe
 
uöt32_t
 
	$uµî_bôs
(
uöt32_t
 
y
)

22  (
y
 >> (
ISAAC_SZ_LOG
+2)Ë& (
ISAAC_SZ
-1);

23 
	}
}

25 
	$ißac_upd©e
(
ißac_˘x
 *
_˘x
){

26 
uöt32_t
 *
m
;

27 
uöt32_t
 *
r
;

28 
uöt32_t
 
a
;

29 
uöt32_t
 
b
;

30 
uöt32_t
 
x
;

31 
uöt32_t
 
y
;

32 
i
;

33 
m
=
_˘x
->m;

34 
r
=
_˘x
->r;

35 
a
=
_˘x
->a;

36 
b
=
_˘x
->b+(++_˘x->
c
);

37 
i
=0;i<
ISAAC_SZ
/2;i++){

38 
x
=
m
[
i
];

39 
a
=◊^a<<13)+
m
[
i
+
ISAAC_SZ
/2];

40 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

41 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

42 
x
=
m
[++
i
];

43 
a
=◊^a>>6)+
m
[
i
+
ISAAC_SZ
/2];

44 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

45 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

46 
x
=
m
[++
i
];

47 
a
=◊^a<<2)+
m
[
i
+
ISAAC_SZ
/2];

48 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

49 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

50 
x
=
m
[++
i
];

51 
a
=◊^a>>16)+
m
[
i
+
ISAAC_SZ
/2];

52 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

53 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

55 
i
=
ISAAC_SZ
/2;i<ISAAC_SZ;i++){

56 
x
=
m
[
i
];

57 
a
=◊^a<<13)+
m
[
i
-
ISAAC_SZ
/2];

58 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

59 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

60 
x
=
m
[++
i
];

61 
a
=◊^a>>6)+
m
[
i
-
ISAAC_SZ
/2];

62 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

63 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

64 
x
=
m
[++
i
];

65 
a
=◊^a<<2)+
m
[
i
-
ISAAC_SZ
/2];

66 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

67 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

68 
x
=
m
[++
i
];

69 
a
=◊^a>>16)+
m
[
i
-
ISAAC_SZ
/2];

70 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

71 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

73 
_˘x
->
b
=b;

74 
_˘x
->
a
=a;

75 
_˘x
->
n
=
ISAAC_SZ
;

76 
	}
}

78 
	$ißac_mix
(
uöt32_t
 
_x
[8]){

79 c⁄° 
SHIFT
[8]={11,2,8,16,10,4,8,9};

80 
i
;

81 
i
=0;i<8;i++){

82 
_x
[
i
]^=_x[(i+1)&7]<<
SHIFT
[i];

83 
_x
[(
i
+3)&7]+=_x[i];

84 
_x
[(
i
+1)&7]+=_x[(i+2)&7];

85 
i
++;

86 
_x
[
i
]^=_x[(i+1)&7]>>
SHIFT
[i];

87 
_x
[(
i
+3)&7]+=_x[i];

88 
_x
[(
i
+1)&7]+=_x[(i+2)&7];

90 
	}
}

93 
	$ißac_öô
(
ißac_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
){

94 
_˘x
->
a
=_˘x->
b
=_˘x->
c
=0;

95 
	`mem£t
(
_˘x
->
r
,0,(_ctx->r));

96 
	`ißac_ª£ed
(
_˘x
,
_£ed
,
_n£ed
);

97 
	}
}

99 
	$ißac_ª£ed
(
ißac_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
){

100 
uöt32_t
 *
m
;

101 
uöt32_t
 *
r
;

102 
uöt32_t
 
x
[8];

103 
i
;

104 
j
;

105 
m
=
_˘x
->m;

106 
r
=
_˘x
->r;

107 if(
_n£ed
>
ISAAC_SEED_SZ_MAX
)_nseed=ISAAC_SEED_SZ_MAX;

108 
i
=0;i<
_n£ed
>>2;i++){

109 
r
[
i
]^=(
uöt32_t
)
_£ed
[i<<2|3]<<24|(uint32_t)_seed[i<<2|2]<<16|

110 (
uöt32_t
)
_£ed
[
i
<<2|1]<<8|_seed[i<<2];

112 
_n£ed
-=
i
<<2;

113 if(
_n£ed
>0){

114 
uöt32_t
 
ri
;

115 
ri
=
_£ed
[
i
<<2];

116 
j
=1;j<
_n£ed
;j++)
ri
|=(
uöt32_t
)
_£ed
[
i
<<2|j]<<(j<<3);

117 
r
[
i
++]^=
ri
;

119 
x
[0]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=0x9E3779B9U;

120 
i
=0;i<4;i++)
	`ißac_mix
(
x
);

121 
i
=0;i<
ISAAC_SZ
;i+=8){

122 
j
=0;j<8;j++)
x
[j]+=
r
[
i
+j];

123 
	`ißac_mix
(
x
);

124 
	`mem˝y
(
m
+
i
,
x
,(x));

126 
i
=0;i<
ISAAC_SZ
;i+=8){

127 
j
=0;j<8;j++)
x
[j]+=
m
[
i
+j];

128 
	`ißac_mix
(
x
);

129 
	`mem˝y
(
m
+
i
,
x
,(x));

131 
	`ißac_upd©e
(
_˘x
);

132 
	}
}

134 
uöt32_t
 
	$ißac_√xt_uöt32
(
ißac_˘x
 *
_˘x
){

135 if(!
_˘x
->
n
)
	`ißac_upd©e
(_ctx);

136  
_˘x
->
r
[--_˘x->
n
];

137 
	}
}

139 
uöt32_t
 
	$ißac_√xt_uöt
(
ißac_˘x
 *
_˘x
,
uöt32_t
 
_n
){

140 
uöt32_t
 
r
;

141 
uöt32_t
 
v
;

142 
uöt32_t
 
d
;

144 
r
=
	`ißac_√xt_uöt32
(
_˘x
);

145 
v
=
r
%
_n
;

146 
d
=
r
-
v
;

148 ((
d
+
_n
-1)&
ISAAC_MASK
)<d);

149  
v
;

150 
	}
}

160 
	$ißac_Êﬂt_bôs
(
ißac_˘x
 *
_˘x
,
uöt32_t
 
_bôs
,
_ba£
){

161 
ªt
;

162 
nbôs_√eded
;

163 !
_bôs
){

164 if(
_ba£
+
FLT_MANT_DIG
<
FLT_MIN_EXP
) 0;

165 
_ba£
-=32;

166 
_bôs
=
	`ißac_√xt_uöt32
(
_˘x
);

174 
nbôs_√eded
=
FLT_MANT_DIG
-
	`ûog32_nz
(
_bôs
);

175 #i‡
FLT_MANT_DIG
>32

176 
ªt
=
	`ldexpf
(()
_bôs
,
_ba£
);

177 #i‡
FLT_MANT_DIG
>65

178 32-
nbôs_√eded
<0){

180 if(32-
nbôs_√eded
<0){

182 
_ba£
-=32;

183 
nbôs_√eded
-=32;

184 
ªt
+=
	`ldexpf
(()
	`ißac_√xt_uöt32
(
_˘x
),
_ba£
);

186 
_bôs
=
	`ißac_√xt_uöt32
(
_˘x
)>>32-
nbôs_√eded
;

187 
ªt
+=
	`ldexpf
(()
_bôs
,
_ba£
-
nbôs_√eded
);

189 if(
nbôs_√eded
>0){

190 
_bôs
=_bôs<<
nbôs_√eded
|
	`ißac_√xt_uöt32
(
_˘x
)>>(32-nbits_needed);

192 #i‡
FLT_MANT_DIG
<32

193 
_bôs
>>=-
nbôs_√eded
;

195 
ªt
=
	`ldexpf
(()
_bôs
,
_ba£
-
nbôs_√eded
);

197  
ªt
;

198 
	}
}

200 
	$ißac_√xt_Êﬂt
(
ißac_˘x
 *
_˘x
){

201  
	`ißac_Êﬂt_bôs
(
_˘x
,0,0);

202 
	}
}

204 
	$ißac_√xt_sig√d_Êﬂt
(
ißac_˘x
 *
_˘x
){

205 
uöt32_t
 
bôs
;

206 
bôs
=
	`ißac_√xt_uöt32
(
_˘x
);

207  (1|-(()
bôs
&1))*
	`ißac_Êﬂt_bôs
(
_˘x
,bits>>1,-31);

208 
	}
}

217 
	$ißac_doubÀ_bôs
(
ißac_˘x
 *
_˘x
,
uöt32_t
 
_bôs
,
_ba£
){

218 
ªt
;

219 
nbôs_√eded
;

220 !
_bôs
){

221 if(
_ba£
+
DBL_MANT_DIG
<
DBL_MIN_EXP
) 0;

222 
_ba£
-=32;

223 
_bôs
=
	`ißac_√xt_uöt32
(
_˘x
);

225 
nbôs_√eded
=
DBL_MANT_DIG
-
	`ûog32_nz
(
_bôs
);

226 #i‡
DBL_MANT_DIG
>32

227 
ªt
=
	`ldexp
(()
_bôs
,
_ba£
);

228 #i‡
DBL_MANT_DIG
>65

229 32-
nbôs_√eded
<0){

231 if(32-
nbôs_√eded
<0){

233 
_ba£
-=32;

234 
nbôs_√eded
-=32;

235 
ªt
+=
	`ldexp
(()
	`ißac_√xt_uöt32
(
_˘x
),
_ba£
);

237 
_bôs
=
	`ißac_√xt_uöt32
(
_˘x
)>>(32-
nbôs_√eded
);

238 
ªt
+=
	`ldexp
(()
_bôs
,
_ba£
-
nbôs_√eded
);

240 if(
nbôs_√eded
>0){

241 
_bôs
=_bôs<<
nbôs_√eded
|
	`ißac_√xt_uöt32
(
_˘x
)>>32-nbits_needed;

243 #i‡
DBL_MANT_DIG
<32

244 
_bôs
>>=-
nbôs_√eded
;

246 
ªt
=
	`ldexp
(()
_bôs
,
exp
-
DBL_MANT_DIG
);

248  
ªt
;

249 
	}
}

251 
	$ißac_√xt_doubÀ
(
ißac_˘x
 *
_˘x
){

252  
	`ißac_doubÀ_bôs
(
_˘x
,0,0);

253 
	}
}

255 
	$ißac_√xt_sig√d_doubÀ
(
ißac_˘x
 *
_˘x
){

256 
uöt32_t
 
bôs
;

257 
bôs
=
	`ißac_√xt_uöt32
(
_˘x
);

258  (1|-(()
bôs
&1))*
	`ißac_doubÀ_bôs
(
_˘x
,bits>>1,-31);

259 
	}
}

	@ccan/ccan/isaac/isaac.h

2 #i‡!
deföed
(
_ißac_H
)

3 
	#_ißac_H
 (1)

	)

4 
	~<°döt.h
>

8 
ißac_˘x
 
	tißac_˘x
;

17 
	#ISAAC_SZ_LOG
 (8)

	)

18 
	#ISAAC_SZ
 (1<<
ISAAC_SZ_LOG
)

	)

19 
	#ISAAC_SEED_SZ_MAX
 (
ISAAC_SZ
<<2)

	)

31 
	sißac_˘x
{

32 
	mn
;

33 
uöt32_t
 
	mr
[
ISAAC_SZ
];

34 
uöt32_t
 
	mm
[
ISAAC_SZ
];

35 
uöt32_t
 
	ma
;

36 
uöt32_t
 
	mb
;

37 
uöt32_t
 
	mc
;

50 
ißac_öô
(
ißac_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
);

62 
ißac_ª£ed
(
ißac_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
);

67 
uöt32_t
 
ißac_√xt_uöt32
(
ißac_˘x
 *
_˘x
);

77 
uöt32_t
 
ißac_√xt_uöt
(
ißac_˘x
 *
_˘x
,uöt32_à
_n
);

90 
ißac_√xt_Êﬂt
(
ißac_˘x
 *
_˘x
);

104 
ißac_√xt_sig√d_Êﬂt
(
ißac_˘x
 *
_˘x
);

117 
ißac_√xt_doubÀ
(
ißac_˘x
 *
_˘x
);

131 
ißac_√xt_sig√d_doubÀ
(
ißac_˘x
 *
_˘x
);

	@ccan/ccan/isaac/isaac64.c

4 
	~<Êﬂt.h
>

5 
	~<m©h.h
>

6 
	~<°rög.h
>

7 
	~<cˇn/ûog/ûog.h
>

8 
	~"ißac64.h
"

11 
	#ISAAC64_MASK
 ((
uöt64_t
)0xFFFFFFFFFFFFFFFFULL)

	)

14 
ölöe
 
uöt32_t
 
	$lowî_bôs
(
uöt64_t
 
x
)

16  (
x
 & ((
ISAAC64_SZ
-1) << 3)) >>3;

17 
	}
}

20 
ölöe
 
uöt32_t
 
	$uµî_bôs
(
uöt32_t
 
y
)

22  (
y
 >> (
ISAAC64_SZ_LOG
+3)Ë& (
ISAAC64_SZ
-1);

23 
	}
}

25 
	$ißac64_upd©e
(
ißac64_˘x
 *
_˘x
){

26 
uöt64_t
 *
m
;

27 
uöt64_t
 *
r
;

28 
uöt64_t
 
a
;

29 
uöt64_t
 
b
;

30 
uöt64_t
 
x
;

31 
uöt64_t
 
y
;

32 
i
;

33 
m
=
_˘x
->m;

34 
r
=
_˘x
->r;

35 
a
=
_˘x
->a;

36 
b
=
_˘x
->b+(++_˘x->
c
);

37 
i
=0;i<
ISAAC64_SZ
/2;i++){

38 
x
=
m
[
i
];

39 
a
=~◊^a<<21)+
m
[
i
+
ISAAC64_SZ
/2];

40 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

41 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

42 
x
=
m
[++
i
];

43 
a
=◊^a>>5)+
m
[
i
+
ISAAC64_SZ
/2];

44 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

45 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

46 
x
=
m
[++
i
];

47 
a
=◊^a<<12)+
m
[
i
+
ISAAC64_SZ
/2];

48 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

49 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

50 
x
=
m
[++
i
];

51 
a
=◊^a>>33)+
m
[
i
+
ISAAC64_SZ
/2];

52 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

53 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

55 
i
=
ISAAC64_SZ
/2;i<ISAAC64_SZ;i++){

56 
x
=
m
[
i
];

57 
a
=~◊^a<<21)+
m
[
i
-
ISAAC64_SZ
/2];

58 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

59 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

60 
x
=
m
[++
i
];

61 
a
=◊^a>>5)+
m
[
i
-
ISAAC64_SZ
/2];

62 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

63 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

64 
x
=
m
[++
i
];

65 
a
=◊^a<<12)+
m
[
i
-
ISAAC64_SZ
/2];

66 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

67 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

68 
x
=
m
[++
i
];

69 
a
=◊^a>>33)+
m
[
i
-
ISAAC64_SZ
/2];

70 
m
[
i
]=
y
=m[
	`lowî_bôs
(
x
)]+
a
+
b
;

71 
r
[
i
]=
b
=
m
[
	`uµî_bôs
(
y
)]+
x
;

73 
_˘x
->
b
=b;

74 
_˘x
->
a
=a;

75 
_˘x
->
n
=
ISAAC64_SZ
;

76 
	}
}

78 
	$ißac64_mix
(
uöt64_t
 
_x
[8]){

79 c⁄° 
SHIFT
[8]={9,9,23,15,14,20,17,14};

80 
i
;

81 
i
=0;i<8;i++){

82 
_x
[
i
]-=_x[(i+4)&7];

83 
_x
[(
i
+5)&7]^=_x[(i+7)&7]>>
SHIFT
[i];

84 
_x
[(
i
+7)&7]+=_x[i];

85 
i
++;

86 
_x
[
i
]-=_x[(i+4)&7];

87 
_x
[(
i
+5)&7]^=_x[(i+7)&7]<<
SHIFT
[i];

88 
_x
[(
i
+7)&7]+=_x[i];

90 
	}
}

93 
	$ißac64_öô
(
ißac64_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
){

94 
_˘x
->
a
=_˘x->
b
=_˘x->
c
=0;

95 
	`mem£t
(
_˘x
->
r
,0,(_ctx->r));

96 
	`ißac64_ª£ed
(
_˘x
,
_£ed
,
_n£ed
);

97 
	}
}

99 
	$ißac64_ª£ed
(
ißac64_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
){

100 
uöt64_t
 *
m
;

101 
uöt64_t
 *
r
;

102 
uöt64_t
 
x
[8];

103 
i
;

104 
j
;

105 
m
=
_˘x
->m;

106 
r
=
_˘x
->r;

107 if(
_n£ed
>
ISAAC64_SEED_SZ_MAX
)_nseed=ISAAC64_SEED_SZ_MAX;

108 
i
=0;i<
_n£ed
>>3;i++){

109 
r
[
i
]^=(
uöt64_t
)
_£ed
[i<<3|7]<<56|(uint64_t)_seed[i<<3|6]<<48|

110 (
uöt64_t
)
_£ed
[
i
<<3|5]<<40|(uint64_t)_seed[i<<3|4]<<32|

111 (
uöt64_t
)
_£ed
[
i
<<3|3]<<24|(uint64_t)_seed[i<<3|2]<<16|

112 (
uöt64_t
)
_£ed
[
i
<<3|1]<<8|_seed[i<<3];

114 
_n£ed
-=
i
<<3;

115 if(
_n£ed
>0){

116 
uöt64_t
 
ri
;

117 
ri
=
_£ed
[
i
<<3];

118 
j
=1;j<
_n£ed
;j++)
ri
|=(
uöt64_t
)
_£ed
[
i
<<3|j]<<(j<<3);

119 
r
[
i
++]^=
ri
;

121 
x
[0]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=(
uöt64_t
)0x9E3779B97F4A7C13ULL;

122 
i
=0;i<4;i++)
	`ißac64_mix
(
x
);

123 
i
=0;i<
ISAAC64_SZ
;i+=8){

124 
j
=0;j<8;j++)
x
[j]+=
r
[
i
+j];

125 
	`ißac64_mix
(
x
);

126 
	`mem˝y
(
m
+
i
,
x
,(x));

128 
i
=0;i<
ISAAC64_SZ
;i+=8){

129 
j
=0;j<8;j++)
x
[j]+=
m
[
i
+j];

130 
	`ißac64_mix
(
x
);

131 
	`mem˝y
(
m
+
i
,
x
,(x));

133 
	`ißac64_upd©e
(
_˘x
);

134 
	}
}

136 
uöt64_t
 
	$ißac64_√xt_uöt64
(
ißac64_˘x
 *
_˘x
){

137 if(!
_˘x
->
n
)
	`ißac64_upd©e
(_ctx);

138  
_˘x
->
r
[--_˘x->
n
];

139 
	}
}

141 
uöt64_t
 
	$ißac64_√xt_uöt
(
ißac64_˘x
 *
_˘x
,
uöt64_t
 
_n
){

142 
uöt64_t
 
r
;

143 
uöt64_t
 
v
;

144 
uöt64_t
 
d
;

146 
r
=
	`ißac64_√xt_uöt64
(
_˘x
);

147 
v
=
r
%
_n
;

148 
d
=
r
-
v
;

150 ((
d
+
_n
-1)&
ISAAC64_MASK
)<d);

151  
v
;

152 
	}
}

162 
	$ißac64_Êﬂt_bôs
(
ißac64_˘x
 *
_˘x
,
uöt64_t
 
_bôs
,
_ba£
){

163 
ªt
;

164 
nbôs_√eded
;

165 !
_bôs
){

166 if(
_ba£
+
FLT_MANT_DIG
<
FLT_MIN_EXP
) 0;

167 
_ba£
-=64;

168 
_bôs
=
	`ißac64_√xt_uöt64
(
_˘x
);

170 
nbôs_√eded
=
FLT_MANT_DIG
-
	`ûog64_nz
(
_bôs
);

171 #i‡
FLT_MANT_DIG
>64

172 
ªt
=
	`ldexpf
(()
_bôs
,
_ba£
);

173 #i‡
FLT_MANT_DIG
>129

174 64-
nbôs_√eded
<0){

176 if(64-
nbôs_√eded
<0){

178 
_ba£
-=64;

179 
nbôs_√eded
-=64;

180 
ªt
+=
	`ldexpf
(()
	`ißac64_√xt_uöt64
(
_˘x
),
_ba£
);

182 
_bôs
=
	`ißac64_√xt_uöt64
(
_˘x
)>>(64-
nbôs_√eded
);

183 
ªt
+=
	`ldexpf
(()
_bôs
,
_ba£
-
nbôs_√eded
);

185 if(
nbôs_√eded
>0){

186 
_bôs
=_bôs<<
nbôs_√eded
|
	`ißac64_√xt_uöt64
(
_˘x
)>>(64-nbits_needed);

188 #i‡
FLT_MANT_DIG
<64

189 
_bôs
>>=-
nbôs_√eded
;

191 
ªt
=
	`ldexpf
(()
_bôs
,
_ba£
-
nbôs_√eded
);

193  
ªt
;

194 
	}
}

196 
	$ißac64_√xt_Êﬂt
(
ißac64_˘x
 *
_˘x
){

197  
	`ißac64_Êﬂt_bôs
(
_˘x
,0,0);

198 
	}
}

200 
	$ißac64_√xt_sig√d_Êﬂt
(
ißac64_˘x
 *
_˘x
){

201 
uöt64_t
 
bôs
;

202 
bôs
=
	`ißac64_√xt_uöt64
(
_˘x
);

203  (1|-(()
bôs
&1))*
	`ißac64_Êﬂt_bôs
(
_˘x
,bits>>1,-63);

204 
	}
}

213 
	$ißac64_doubÀ_bôs
(
ißac64_˘x
 *
_˘x
,
uöt64_t
 
_bôs
,
_ba£
){

214 
ªt
;

215 
nbôs_√eded
;

216 !
_bôs
){

217 if(
_ba£
+
DBL_MANT_DIG
<
DBL_MIN_EXP
) 0;

218 
_ba£
-=64;

219 
_bôs
=
	`ißac64_√xt_uöt64
(
_˘x
);

221 
nbôs_√eded
=
DBL_MANT_DIG
-
	`ûog64_nz
(
_bôs
);

222 #i‡
DBL_MANT_DIG
>64

223 
ªt
=
	`ldexp
(()
_bôs
,
_ba£
);

224 #i‡
DBL_MANT_DIG
>129

225 64-
nbôs_√eded
<0){

227 if(64-
nbôs_√eded
<0){

229 
_ba£
-=64;

230 
nbôs_√eded
-=64;

231 
ªt
+=
	`ldexp
(()
	`ißac64_√xt_uöt64
(
_˘x
),
_ba£
);

233 
_bôs
=
	`ißac64_√xt_uöt64
(
_˘x
)>>(64-
nbôs_√eded
);

234 
ªt
+=
	`ldexp
(()
_bôs
,
_ba£
-
nbôs_√eded
);

236 if(
nbôs_√eded
>0){

237 
_bôs
=_bôs<<
nbôs_√eded
|
	`ißac64_√xt_uöt64
(
_˘x
)>>(64-nbits_needed);

239 #i‡
DBL_MANT_DIG
<64

240 
_bôs
>>=-
nbôs_√eded
;

242 
ªt
=
	`ldexp
(()
_bôs
,
_ba£
-
nbôs_√eded
);

244  
ªt
;

245 
	}
}

247 
	$ißac64_√xt_doubÀ
(
ißac64_˘x
 *
_˘x
){

248  
	`ißac64_doubÀ_bôs
(
_˘x
,0,0);

249 
	}
}

251 
	$ißac64_√xt_sig√d_doubÀ
(
ißac64_˘x
 *
_˘x
){

252 
uöt64_t
 
bôs
;

253 
bôs
=
	`ißac64_√xt_uöt64
(
_˘x
);

254  (1|-(()
bôs
&1))*
	`ißac64_doubÀ_bôs
(
_˘x
,bits>>1,-63);

255 
	}
}

	@ccan/ccan/isaac/isaac64.h

2 #i‡!
deföed
(
_ißac64_H
)

3 
	#_ißac64_H
 (1)

	)

4 
	~<°döt.h
>

8 
ißac64_˘x
 
	tißac64_˘x
;

12 
	#ISAAC64_SZ_LOG
 (8)

	)

13 
	#ISAAC64_SZ
 (1<<
ISAAC64_SZ_LOG
)

	)

14 
	#ISAAC64_SEED_SZ_MAX
 (
ISAAC64_SZ
<<3)

	)

29 
	sißac64_˘x
{

30 
	mn
;

31 
uöt64_t
 
	mr
[
ISAAC64_SZ
];

32 
uöt64_t
 
	mm
[
ISAAC64_SZ
];

33 
uöt64_t
 
	ma
;

34 
uöt64_t
 
	mb
;

35 
uöt64_t
 
	mc
;

48 
ißac64_öô
(
ißac64_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
);

60 
ißac64_ª£ed
(
ißac64_˘x
 *
_˘x
,c⁄° *
_£ed
,
_n£ed
);

65 
uöt64_t
 
ißac64_√xt_uöt64
(
ißac64_˘x
 *
_˘x
);

75 
uöt64_t
 
ißac64_√xt_uöt
(
ißac64_˘x
 *
_˘x
,uöt64_à
_n
);

88 
ißac64_√xt_Êﬂt
(
ißac64_˘x
 *
_˘x
);

102 
ißac64_√xt_sig√d_Êﬂt
(
ißac64_˘x
 *
_˘x
);

115 
ißac64_√xt_doubÀ
(
ißac64_˘x
 *
_˘x
);

129 
ißac64_√xt_sig√d_doubÀ
(
ißac64_˘x
 *
_˘x
);

	@ccan/ccan/isaac/test/run.c

1 
	~<cˇn/ißac/ißac.h
>

2 
	~<cˇn/ißac/ißac.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°ddef.h
>

6 c⁄° 
uöt32_t
 
	gSTATEVEC
[
ISAAC_SZ
<<1]={

137 
	$maö
(
_¨gc
,c⁄° *
_¨gv
[]){

138 
ißac_˘x
 
ißac
;

139 
i
;

140 
j
;

142 
	`∂™_ã°s
(2);

143 
	`ißac_öô
(&
ißac
,
NULL
,0);

144 
j
=0;j<
ISAAC_SZ
;j++)
	`ißac_√xt_uöt32
(&
ißac
);

145 
i
=0;i<2;i++){

146 
nm©ches
;

147 
nm©ches
=0;

148 
j
=0;j<
ISAAC_SZ
;j++){

149 
nm©ches
+=
	`ißac_√xt_uöt32
(&
ißac
)==
STATEVEC
[(
i
+1)*
ISAAC_SZ
-
j
-1];

151 
	`ok1
(
nm©ches
==
ISAAC_SZ
);

157  
	`exô_°©us
();

158 
	}
}

	@ccan/ccan/isaac/test/run64.c

1 
	~<cˇn/ißac/ißac64.h
>

2 
	~<cˇn/ißac/ißac64.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°ddef.h
>

6 c⁄° 
uöt64_t
 
	gSTATEVEC64
[
ISAAC64_SZ
<<1]={

265 
	$maö
(
_¨gc
,c⁄° *
_¨gv
[]){

266 
ißac64_˘x
 
ißac64
;

267 
i
;

268 
j
;

271 
	`∂™_ã°s
(2);

272 
	`ißac64_öô
(&
ißac64
,
NULL
,0);

273 
j
=0;j<
ISAAC64_SZ
;j++)
	`ißac64_√xt_uöt64
(&
ißac64
);

274 
i
=0;i<2;i++){

275 
nm©ches
;

276 
nm©ches
=0;

277 
j
=0;j<
ISAAC64_SZ
;j++){

278 
nm©ches
+=
	`ißac64_√xt_uöt64
(&
ißac64
)==
STATEVEC64
[(
i
+1)*
ISAAC64_SZ
-
j
-1];

280 
	`ok1
(
nm©ches
==
ISAAC64_SZ
);

286  
	`exô_°©us
();

287 
	}
}

	@ccan/ccan/iscsi/discovery.c

18 
	~"c⁄fig.h
"

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<¨∑/öë.h
>

23 
	~"iscsi.h
"

24 
	~"iscsi-¥iv©e.h
"

26 
	$iscsi_discovîy_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
)

28 
iscsi_pdu
 *
pdu
;

29 c⁄° *
°r
;

31 i‡(
iscsi
 =
NULL
) {

32 
	`¥ötf
("tryingÅo sendÅext on NULL context\n");

36 i‡(
iscsi
->
£ssi⁄_ty≥
 !
ISCSI_SESSION_DISCOVERY
) {

37 
	`¥ötf
("TryingÅo do discovery onÇon-discovery session\n");

41 
pdu
 = 
	`iscsi_Æloˇã_pdu
(
iscsi
, 
ISCSI_PDU_TEXT_REQUEST
, 
ISCSI_PDU_TEXT_RESPONSE
);

42 i‡(
pdu
 =
NULL
) {

43 
	`¥ötf
("FailedÅoállocateÅextÖdu\n");

48 
	`iscsi_pdu_£t_immedüã
(
pdu
);

51 
	`iscsi_pdu_£t_pduÊags
(
pdu
, 
ISCSI_PDU_TEXT_FINAL
);

54 
	`iscsi_pdu_£t_ât
(
pdu
, 0xffffffff);

57 
°r
 = "SendTargets=All";

58 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

59 
	`¥ötf
("pduádd data failed\n");

60 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

64 
pdu
->
ˇŒback
 = 
cb
;

65 
pdu
->
¥iv©e_d©a
 =Örivate_data;

67 i‡(
	`iscsi_queue_pdu
(
iscsi
, 
pdu
) != 0) {

68 
	`¥ötf
("failedÅo queue iscsiÅextÖdu\n");

69 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

74 
	}
}

76 
	$iscsi_‰ì_discovîy_addªs£s
(
iscsi_discovîy_addªss
 *
addªs£s
)

78 
addªs£s
 !
NULL
) {

79 
iscsi_discovîy_addªss
 *
√xt
 = 
addªs£s
->next;

81 i‡(
addªs£s
->
èrgë_«me
 !
NULL
) {

82 
	`‰ì
(
	`disˇrd_c⁄°
(
addªs£s
->
èrgë_«me
));

83 
addªs£s
->
èrgë_«me
 = 
NULL
;

85 i‡(
addªs£s
->
èrgë_addªss
 !
NULL
) {

86 
	`‰ì
(
	`disˇrd_c⁄°
(
addªs£s
->
èrgë_addªss
));

87 
addªs£s
->
èrgë_addªss
 = 
NULL
;

89 
addªs£s
->
√xt
 = 
NULL
;

90 
	`‰ì
(
addªs£s
);

91 
addªs£s
 = 
√xt
;

93 
	}
}

95 
	$iscsi_¥o˚ss_ãxt_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
)

97 
iscsi_discovîy_addªss
 *
èrgës
 = 
NULL
;

100 i‡(
hdr
[1] !
ISCSI_PDU_TEXT_FINAL
) {

101 
	`¥ötf
("unsuµ‹ãd fœg†öÅexàª∂y %02x\n", 
hdr
[1]);

102 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

107 
hdr
 +
ISCSI_HEADER_SIZE
;

108 
size
 -
ISCSI_HEADER_SIZE
;

110 
size
 > 0) {

111 
Àn
;

113 
Àn
 = 
	`°æí
((*)
hdr
);

115 i‡(
Àn
 == 0) {

119 i‡(
Àn
 > 
size
) {

120 
	`¥ötf
("À¿> sizêwhíÖ¨sög discovîy d©®%d>%d\n", 
Àn
, 
size
);

121 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

122 
	`iscsi_‰ì_discovîy_addªs£s
(
èrgës
);

127 i‡(!
	`°∫cmp
((*)
hdr
, "TargetName=", 11)) {

128 
iscsi_discovîy_addªss
 *
èrgë
;

130 
èrgë
 = 
	`mÆloc
((
iscsi_discovîy_addªss
));

131 i‡(
èrgë
 =
NULL
) {

132 
	`¥ötf
("FailedÅoállocate data forÇew discoveredÅarget\n");

133 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

134 
	`iscsi_‰ì_discovîy_addªs£s
(
èrgës
);

137 
	`bzîo
(
èrgë
, (
iscsi_discovîy_addªss
));

138 
èrgë
->
èrgë_«me
 = 
	`°rdup
((*)
hdr
+11);

139 i‡(
èrgë
->
èrgë_«me
 =
NULL
) {

140 
	`¥ötf
("FailedÅoállocate data forÇew discoveredÅargetÇame\n");

141 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

142 
	`‰ì
(
èrgë
);

143 
èrgë
 = 
NULL
;

144 
	`iscsi_‰ì_discovîy_addªs£s
(
èrgës
);

147 
èrgë
->
√xt
 = 
èrgës
;

148 
èrgës
 = 
èrgë
;

149 } i‡(!
	`°∫cmp
((*)
hdr
, "TargetAddress=", 14)) {

150 
èrgës
->
èrgë_addªss
 = 
	`°rdup
((*)
hdr
+14);

151 i‡(
èrgës
->
èrgë_addªss
 =
NULL
) {

152 
	`¥ötf
("FailedÅoállocate data forÇew discoveredÅargetáddress\n");

153 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

154 
	`iscsi_‰ì_discovîy_addªs£s
(
èrgës
);

158 
	`¥ötf
("D⁄'àknow howÅÿh™dÀ discovîy såög : %s\n", 
hdr
);

159 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

160 
	`iscsi_‰ì_discovîy_addªs£s
(
èrgës
);

164 
hdr
 +
Àn
 + 1;

165 
size
 -
Àn
 + 1;

168 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_GOOD
, 
èrgës
,Ödu->
¥iv©e_d©a
);

169 
	`iscsi_‰ì_discovîy_addªs£s
(
èrgës
);

172 
	}
}

	@ccan/ccan/iscsi/dlinklist.h

24 #i‚de‡
_DLINKLIST_H


25 
	#_DLINKLIST_H


	)

66 
	#DLIST_ADD
(
li°
, 
p
) \

68 i‡(!(
li°
)) { \

69 (
p
)->
¥ev
 = (
li°
) = (p); \

70 (
p
)->
√xt
 = 
NULL
; \

72 (
p
)->
¥ev
 = (
li°
)->prev; \

73 (
li°
)->
¥ev
 = (
p
); \

74 (
p
)->
√xt
 = (
li°
); \

75 (
li°
Ë(
p
); \

77 } 0)

	)

84 
	#DLIST_REMOVE
(
li°
, 
p
) \

86 i‡((
p
Ë=(
li°
)) { \

87 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p)->prev; \

88 (
li°
Ë(
p
)->
√xt
; \

89 } i‡((
li°
Ë&& (
p
Ë=÷i°)->
¥ev
) { \

90 (
p
)->
¥ev
->
√xt
 = 
NULL
; \

91 (
li°
)->
¥ev
 = (
p
)->prev; \

93 i‡((
p
)->
¥ev
Ë’)->¥ev->
√xt
 = (p)->next; \

94 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p)->prev; \

96 i‡((
p
Ë!(
li°
)Ë’)->
√xt
 = (p)->
¥ev
 = 
NULL
; \

97 } 0)

	)

104 
	#DLIST_HEAD
(
p
, 
ªsu…_hód
) \

106 (
ªsu…_hód
Ë(
p
); \

107 
	`DLIST_PREV
(
ªsu…_hód
)Ë‘esu…_hódË‘esu…_hód)->
¥ev
; \

108 } 0)

	)

111 
	#DLIST_TAIL
(
li°
Ë(÷i°)?÷i°)->
¥ev
:
NULL
)

	)

114 
	#DLIST_PREV
(
p
Ë((’)->
¥ev
 && (p)->¥ev->
√xt
 !
NULL
)?’)->¥ev:NULL)

	)

118 
	#DLIST_ADD_AFTER
(
li°
, 
p
, 
ñ
) \

120 i‡(!(
li°
Ë|| !(
ñ
)) { \

121 
	`DLIST_ADD
(
li°
, 
p
); \

123 (
p
)->
¥ev
 = (
ñ
); \

124 (
p
)->
√xt
 = (
ñ
)->next; \

125 (
ñ
)->
√xt
 = (
p
); \

126 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p); \

127 i‡((
li°
)->
¥ev
 =(
ñ
)Ë÷i°)->¥ev = (
p
); \

129 } 0)

	)

136 
	#DLIST_ADD_END
(
li°
, 
p
, 
ty≥
) \

138 i‡(!(
li°
)) { \

139 
	`DLIST_ADD
(
li°
, 
p
); \

141 
	`DLIST_ADD_AFTER
(
li°
, 
p
, (li°)->
¥ev
); \

143 } 0)

	)

146 
	#DLIST_PROMOTE
(
li°
, 
p
) \

148 
	`DLIST_REMOVE
(
li°
, 
p
); \

149 
	`DLIST_ADD
(
li°
, 
p
); \

150 } 0)

	)

156 
	#DLIST_DEMOTE
(
li°
, 
p
, 
ty≥
) \

158 
	`DLIST_REMOVE
(
li°
, 
p
); \

159 
	`DLIST_ADD_END
(
li°
, 
p
, 
NULL
); \

160 } 0)

	)

167 
	#DLIST_CONCATENATE
(
li°1
, 
li°2
, 
ty≥
) \

169 i‡(!(
li°1
)) { \

170 (
li°1
Ë(
li°2
); \

172 (
li°1
)->
¥ev
->
√xt
 = (
li°2
); \

173 i‡(
li°2
) { \

174 *
_tm∂i°
 = (*)(
li°1
)->
¥ev
; \

175 (
li°1
)->
¥ev
 = (
li°2
)->prev; \

176 (
li°2
)->
¥ev
 = 
_tm∂i°
; \

179 } 0)

	)

	@ccan/ccan/iscsi/init.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<°rög.h
>

21 
	~<°rögs.h
>

22 
	~<°dlib.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<uni°d.h
>

25 
	~<time.h
>

26 
	~"iscsi.h
"

27 
	~"iscsi-¥iv©e.h
"

28 
	~"dlökli°.h
"

31 
iscsi_c⁄ãxt
 *
	$iscsi_¸óã_c⁄ãxt
(c⁄° *
öôüt‹_«me
)

33 
iscsi_c⁄ãxt
 *
iscsi
;

35 
iscsi
 = 
	`mÆloc
((
iscsi_c⁄ãxt
));

36 i‡(
iscsi
 =
NULL
) {

37 
	`¥ötf
("FailedÅoállocate iscsi context\n");

38  
NULL
;

41 
	`bzîo
(
iscsi
, (
iscsi_c⁄ãxt
));

43 
iscsi
->
öôüt‹_«me
 = 
	`°rdup
(initiator_name);

44 i‡(
iscsi
->
öôüt‹_«me
 =
NULL
) {

45 
	`¥ötf
("FailedÅoállocate initiatorÇame context\n");

46 
	`‰ì
(
iscsi
);

47  
NULL
;

50 
iscsi
->
fd
 = -1;

53 
	`§™dom
(
	`gëpid
(Ë^ 
	`time
(
NULL
));

54 
	`iscsi_£t_øndom_isid
(
iscsi
);

56  
iscsi
;

57 
	}
}

59 
	$iscsi_£t_øndom_isid
(
iscsi_c⁄ãxt
 *
iscsi
)

61 
iscsi
->
isid
[0] = 0x80;

62 
iscsi
->
isid
[1] = 
	`øndom
()&0xff;

63 
iscsi
->
isid
[2] = 
	`øndom
()&0xff;

64 
iscsi
->
isid
[3] = 
	`øndom
()&0xff;

65 
iscsi
->
isid
[4] = 0;

66 
iscsi
->
isid
[5] = 0;

69 
	}
}

71 
	$iscsi_£t_Æüs
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
Æüs
)

73 i‡(
iscsi
 =
NULL
) {

74 
	`¥ötf
("Context is NULL whenáddingálias\n");

77 i‡(
iscsi
->
is_loggedö
 != 0) {

78 
	`¥ötf
("AlreadyÜogged in whenáddingálias\n");

82 i‡(
iscsi
->
Æüs
 !
NULL
) {

83 
	`‰ì
(
	`disˇrd_c⁄°
(
iscsi
->
Æüs
));

84 
iscsi
->
Æüs
 = 
NULL
;

87 
iscsi
->
Æüs
 = 
	`°rdup
(alias);

88 i‡(
iscsi
->
Æüs
 =
NULL
) {

89 
	`¥ötf
("FailedÅoállocateáliasÇame\n");

94 
	}
}

96 
	$iscsi_£t_èrgë«me
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
èrgë_«me
)

98 i‡(
iscsi
 =
NULL
) {

99 
	`¥ötf
("Context is NULL whenáddingÅargetname\n");

102 i‡(
iscsi
->
is_loggedö
 != 0) {

103 
	`¥ötf
("AlreadyÜogged in whenáddingÅargetname\n");

107 i‡(
iscsi
->
èrgë_«me
 !
NULL
) {

108 
	`‰ì
(
	`disˇrd_c⁄°
(
iscsi
->
èrgë_«me
));

109 
iscsi
->
èrgë_«me

NULL
;

112 
iscsi
->
èrgë_«me
 = 
	`°rdup
(target_name);

113 i‡(
iscsi
->
èrgë_«me
 =
NULL
) {

114 
	`¥ötf
("FailedÅoállocateÅargetÇame\n");

119 
	}
}

121 
	$iscsi_de°roy_c⁄ãxt
(
iscsi_c⁄ãxt
 *
iscsi
)

123 
iscsi_pdu
 *
pdu
;

125 i‡(
iscsi
 =
NULL
) {

128 i‡(
iscsi
->
öôüt‹_«me
 !
NULL
) {

129 
	`‰ì
(
	`disˇrd_c⁄°
(
iscsi
->
öôüt‹_«me
));

130 
iscsi
->
öôüt‹_«me
 = 
NULL
;

132 i‡(
iscsi
->
Æüs
 !
NULL
) {

133 
	`‰ì
(
	`disˇrd_c⁄°
(
iscsi
->
Æüs
));

134 
iscsi
->
Æüs
 = 
NULL
;

136 i‡(
iscsi
->
is_loggedö
 != 0) {

137 
	`¥ötf
("deswtroying context whileÜogged in\n");

139 i‡(
iscsi
->
fd
 != -1) {

140 
	`iscsi_disc⁄√˘
(
iscsi
);

143 i‡(
iscsi
->
öbuf
 !
NULL
) {

144 
	`‰ì
(
iscsi
->
öbuf
);

145 
iscsi
->
öbuf
 = 
NULL
;

146 
iscsi
->
ösize
 = 0;

147 
iscsi
->
öpos
 = 0;

150 (
pdu
 = 
iscsi
->
outqueue
)) {

151 
	`DLIST_REMOVE
(
iscsi
->
outqueue
, 
pdu
);

152 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_CANCELLED
, 
NULL
,Ödu->
¥iv©e_d©a
);

153 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

155 (
pdu
 = 
iscsi
->
waôpdu
)) {

156 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

157 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_CANCELLED
, 
NULL
,Ödu->
¥iv©e_d©a
);

158 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

161 
	`‰ì
(
iscsi
);

164 
	}
}

	@ccan/ccan/iscsi/iscsi-private.h

17 #i‚de‡
CCAN_ISCSI_PRIVATE_H


18 
	#CCAN_ISCSI_PRIVATE_H


	)

20 
	~<°döt.h
>

22 #i‚de‡
disˇrd_c⁄°


23 
	#disˇrd_c⁄°
(
±r
Ë((*)((
öçå_t
)’å)))

	)

26 
	siscsi_c⁄ãxt
 {

27 c⁄° *
	möôüt‹_«me
;

28 c⁄° *
	mèrgë_«me
;

29 c⁄° *
	mÆüs
;

30 
iscsi_£ssi⁄_ty≥
 
	m£ssi⁄_ty≥
;

31 
	misid
[6];

32 
uöt32_t
 
	môt
;

33 
uöt32_t
 
	mcmd¢
;

34 
uöt32_t
 
	m°©¢
;

36 
	mfd
;

37 
	mis_c⁄√˘ed
;

38 
	mis_loggedö
;

40 
iscsi_comm™d_cb
 
	mc⁄√˘_cb
;

41 *
	mc⁄√˘_d©a
;

43 
iscsi_pdu
 *
	moutqueue
;

44 
iscsi_pdu
 *
	mwaôpdu
;

46 
	mösize
;

47 
	möpos
;

48 *
	möbuf
;

51 
	#ISCSI_HEADER_SIZE
 48

	)

53 
	#ISCSI_PDU_IMMEDIATE
 0x40

	)

55 
	#ISCSI_PDU_TEXT_FINAL
 0x80

	)

56 
	#ISCSI_PDU_TEXT_CONTINUE
 0x40

	)

58 
	#ISCSI_PDU_LOGIN_TRANSIT
 0x80

	)

59 
	#ISCSI_PDU_LOGIN_CONTINUE
 0x40

	)

60 
	#ISCSI_PDU_LOGIN_CSG_SECNEG
 0x00

	)

61 
	#ISCSI_PDU_LOGIN_CSG_OPNEG
 0x04

	)

62 
	#ISCSI_PDU_LOGIN_CSG_FF
 0x0c

	)

63 
	#ISCSI_PDU_LOGIN_NSG_SECNEG
 0x00

	)

64 
	#ISCSI_PDU_LOGIN_NSG_OPNEG
 0x01

	)

65 
	#ISCSI_PDU_LOGIN_NSG_FF
 0x03

	)

68 
	#ISCSI_PDU_SCSI_FINAL
 0x80

	)

69 
	#ISCSI_PDU_SCSI_READ
 0x40

	)

70 
	#ISCSI_PDU_SCSI_WRITE
 0x20

	)

71 
	#ISCSI_PDU_SCSI_ATTR_UNTAGGED
 0x00

	)

72 
	#ISCSI_PDU_SCSI_ATTR_SIMPLE
 0x01

	)

73 
	#ISCSI_PDU_SCSI_ATTR_ORDERED
 0x02

	)

74 
	#ISCSI_PDU_SCSI_ATTR_HEADOFQUEUE
 0x03

	)

75 
	#ISCSI_PDU_SCSI_ATTR_ACA
 0x04

	)

77 
	#ISCSI_PDU_DATA_FINAL
 0x80

	)

78 
	#ISCSI_PDU_DATA_ACK_REQUESTED
 0x40

	)

79 
	#ISCSI_PDU_DATA_BIDIR_OVERFLOW
 0x10

	)

80 
	#ISCSI_PDU_DATA_BIDIR_UNDERFLOW
 0x08

	)

81 
	#ISCSI_PDU_DATA_RESIDUAL_OVERFLOW
 0x04

	)

82 
	#ISCSI_PDU_DATA_RESIDUAL_UNDERFLOW
 0x02

	)

83 
	#ISCSI_PDU_DATA_CONTAINS_STATUS
 0x01

	)

85 
	eiscsi_›code
 {
	mISCSI_PDU_NOP_OUT
=0x00,

86 
	mISCSI_PDU_SCSI_REQUEST
=0x01,

87 
	mISCSI_PDU_LOGIN_REQUEST
=0x03,

88 
	mISCSI_PDU_TEXT_REQUEST
=0x04,

89 
	mISCSI_PDU_LOGOUT_REQUEST
=0x06,

90 
	mISCSI_PDU_NOP_IN
=0x20,

91 
	mISCSI_PDU_SCSI_RESPONSE
=0x21,

92 
	mISCSI_PDU_LOGIN_RESPONSE
=0x23,

93 
	mISCSI_PDU_TEXT_RESPONSE
=0x24,

94 
	mISCSI_PDU_DATA_IN
=0x25,

95 
	mISCSI_PDU_LOGOUT_RESPONSE
=0x26};

97 
	siscsi_pdu
 {

98 
iscsi_pdu
 *
	m¥ev
, *
	m√xt
;

100 
uöt32_t
 
	môt
;

101 
uöt32_t
 
	mcmd¢
;

102 
iscsi_›code
 
	mª•⁄£_›code
;

104 
iscsi_comm™d_cb
 
	mˇŒback
;

105 *
	m¥iv©e_d©a
;

107 
	mwrôãn
;

108 
iscsi_d©a
 
	moutd©a
;

109 
iscsi_d©a
 
	möd©a
;

111 
iscsi_scsi_cbd©a
 *
	mscsi_cbd©a
;

114 
iscsi_‰ì_scsi_cbd©a
(
iscsi_scsi_cbd©a
 *
scsi_cbd©a
);

116 
iscsi_pdu
 *
iscsi_Æloˇã_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_›code
 
›code
, iscsi_›codê
ª•⁄£_›code
);

117 
iscsi_‰ì_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
);

118 
iscsi_pdu_£t_pduÊags
(
iscsi_pdu
 *
pdu
, 
Êags
);

119 
iscsi_pdu_£t_immedüã
(
iscsi_pdu
 *
pdu
);

120 
iscsi_pdu_£t_ât
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
ât
);

121 
iscsi_pdu_£t_cmd¢
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
cmd¢
);

122 
iscsi_pdu_£t_lun
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
lun
);

123 
iscsi_pdu_£t_exp°©¢
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
exp°©¢¢
);

124 
iscsi_pdu_£t_expx„æí
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
expx„æí
);

125 
iscsi_pdu_add_d©a
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
d±r
, 
dsize
);

126 
iscsi_queue_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
);

127 
iscsi_add_d©a
(
iscsi_d©a
 *
d©a
, c⁄° *
d±r
, 
dsize
, 
pduÆignmít
);

128 
iscsi_£t_øndom_isid
(
iscsi_c⁄ãxt
 *
iscsi
);

130 
	gscsi_èsk
;

131 
iscsi_pdu_£t_cdb
(
iscsi_pdu
 *
pdu
, 
scsi_èsk
 *
èsk
);

133 
iscsi_gë_pdu_size
(c⁄° *
hdr
);

134 
iscsi_¥o˚ss_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
hdr
, 
size
);

136 
iscsi_¥o˚ss_logö_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
);

137 
iscsi_¥o˚ss_ãxt_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
);

138 
iscsi_¥o˚ss_logout_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
);

139 
iscsi_¥o˚ss_scsi_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
);

140 
iscsi_¥o˚ss_scsi_d©a_ö
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
, *
is_föished
);

141 
iscsi_¥o˚ss_n›_out_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
);

	@ccan/ccan/iscsi/iscsi.h

17 #i‚de‡
CCAN_ISCSI_H


18 
	#CCAN_ISCSI_H


	)

20 
	giscsi_c⁄ãxt
;

21 
	gsockaddr
;

27 
iscsi_gë_fd
(
iscsi_c⁄ãxt
 *
iscsi
);

32 
iscsi_which_evíts
(
iscsi_c⁄ãxt
 *
iscsi
);

37 
iscsi_£rvi˚
(
iscsi_c⁄ãxt
 *
iscsi
, 
ªvíts
);

49 
iscsi_c⁄ãxt
 *
iscsi_¸óã_c⁄ãxt
(c⁄° *
öôüt‹_«me
);

59 
iscsi_de°roy_c⁄ãxt
(
iscsi_c⁄ãxt
 *
iscsi
);

68 
iscsi_£t_Æüs
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
Æüs
);

79 
iscsi_£t_èrgë«me
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
èrgë«me
);

85 
	eiscsi_£ssi⁄_ty≥
 {
	mISCSI_SESSION_DISCOVERY
=1, 
	mISCSI_SESSION_NORMAL
=2};

96 
iscsi_£t_£ssi⁄_ty≥
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_£ssi⁄_ty≥
 
£ssi⁄_ty≥
);

102 
	eicsi_°©us
 { 
	mISCSI_STATUS_GOOD
 =0,

103 
	mISCSI_STATUS_CHECK_CONDITION
 =2,

104 
	mISCSI_STATUS_CANCELLED
 =0x0f000000,

105 
	mISCSI_STATUS_ERROR
 =0x0f000001 };

112 (*
	tiscsi_comm™d_cb
)(
	tiscsi_c⁄ãxt
 *
	tiscsi
, 
	t°©us
, *
	tcomm™d_d©a
, *
	t¥iv©e_d©a
);

137 
	`iscsi_c⁄√˘_async
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
èrgë
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
);

147 
	`iscsi_disc⁄√˘
(
iscsi_c⁄ãxt
 *
iscsi
);

163 
	`iscsi_logö_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
);

179 
	`iscsi_logout_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
);

200 
	`iscsi_discovîy_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
);

202 
	siscsi_discovîy_addªss
 {

203 
iscsi_discovîy_addªss
 *
√xt
;

204 c⁄° *
èrgë_«me
;

205 c⁄° *
èrgë_addªss
;

223 
	`iscsi_n›_out_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
d©a
, 
Àn
, *
¥iv©e_d©a
);

246 
	siscsi_d©a
 {

247 
size
;

248 *
d©a
;

255 
	`iscsi_ªp‹éuns_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, 
ªp‹t_ty≥
, 
Æloc_Àn
, *
¥iv©e_d©a
);

256 
	`iscsi_ã°unôªady_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
);

257 
	`iscsi_öquúy_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
evpd
, 
∑ge_code
, 
maxsize
, *
¥iv©e_d©a
);

258 
	`iscsi_ªadˇ∑côy10_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
lba
, 
pmi
, *
¥iv©e_d©a
);

259 
	`iscsi_ªad10_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
lba
, 
d©Æí
, 
blocksize
, *
¥iv©e_d©a
);

260 
	`iscsi_wrôe10_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, *
d©a
, 
d©Æí
, 
lba
, 
fua
, 
fu™v
, 
blocksize
, *
¥iv©e_d©a
);

261 
	`iscsi_mode£n£6_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
dbd
, 
pc
, 
∑ge_code
, 
sub_∑ge_code
, 
Æloc_Àn
, *
¥iv©e_d©a
);

	@ccan/ccan/iscsi/login.c

18 
	~"c⁄fig.h
"

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<¨∑/öë.h
>

23 
	~<cˇn/compûî/compûî.h
>

24 
	~"iscsi.h
"

25 
	~"iscsi-¥iv©e.h
"

27 
	$iscsi_logö_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
)

29 
iscsi_pdu
 *
pdu
;

30 c⁄° *
°r
;

31 *
a°r
;

32 
ªt
;

34 i‡(
iscsi
 =
NULL
) {

35 
	`¥ötf
("tryingÅoÜogin on NULL context\n");

39 i‡(
iscsi
->
is_loggedö
 != 0) {

40 
	`¥ötf
("tryingÅoÜogin whileálreadyÜogged in\n");

44 
iscsi
->
£ssi⁄_ty≥
) {

45 
ISCSI_SESSION_DISCOVERY
:

46 
ISCSI_SESSION_NORMAL
:

49 
	`¥ötf
("tryingÅoÜogin without setting sessionÅype\n");

53 
pdu
 = 
	`iscsi_Æloˇã_pdu
(
iscsi
, 
ISCSI_PDU_LOGIN_REQUEST
, 
ISCSI_PDU_LOGIN_RESPONSE
);

54 i‡(
pdu
 =
NULL
) {

55 
	`¥ötf
("FailedÅoállocateÜoginÖdu\n");

60 
	`iscsi_pdu_£t_immedüã
(
pdu
);

63 
	`iscsi_pdu_£t_pduÊags
(
pdu
, 
ISCSI_PDU_LOGIN_TRANSIT
|
ISCSI_PDU_LOGIN_CSG_OPNEG
|
ISCSI_PDU_LOGIN_NSG_FF
);

67 i‡(
	`a•rötf
(&
a°r
, "Inôüt‹Name=%s", 
iscsi
->
öôüt‹_«me
) == -1) {

68 
	`¥ötf
("asprintf failed\n");

69 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

72 
ªt
 = 
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
a°r
, 
	`°æí
(astr)+1);

73 
	`‰ì
(
a°r
);

74 i‡(
ªt
 != 0) {

75 
	`¥ötf
("pduádd data failed\n");

76 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

81 i‡(
iscsi
->
Æüs
) {

82 i‡(
	`a•rötf
(&
a°r
, "Inôüt‹Alüs=%s", 
iscsi
->
Æüs
) == -1) {

83 
	`¥ötf
("asprintf failed\n");

84 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

87 
ªt
 = 
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
a°r
, 
	`°æí
(astr)+1);

88 
	`‰ì
(
a°r
);

89 i‡(
ªt
 != 0) {

90 
	`¥ötf
("pduádd data failed\n");

91 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

97 i‡(
iscsi
->
£ssi⁄_ty≥
 =
ISCSI_SESSION_NORMAL
) {

98 i‡(
iscsi
->
èrgë_«me
 =
NULL
) {

99 
	`¥ötf
("tryingÇormal connect butÅargetÇameÇot set\n");

100 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

104 i‡(
	`a•rötf
(&
a°r
, "T¨gëName=%s", 
iscsi
->
èrgë_«me
) == -1) {

105 
	`¥ötf
("asprintf failed\n");

106 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

109 
ªt
 = 
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
a°r
, 
	`°æí
(astr)+1);

110 
	`‰ì
(
a°r
);

111 i‡(
ªt
 != 0) {

112 
	`¥ötf
("pduádd data failed\n");

113 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

119 
iscsi
->
£ssi⁄_ty≥
) {

120 
ISCSI_SESSION_DISCOVERY
:

121 
°r
 = "SessionType=Discovery";

123 
ISCSI_SESSION_NORMAL
:

124 
°r
 = "SessionType=Normal";

127 
	`¥ötf
("ˇ¿nŸ h™dÀ sessi⁄†%d yë\n", 
iscsi
->
£ssi⁄_ty≥
);

130 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

131 
	`¥ötf
("pduádd data failed\n");

132 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

136 
°r
 = "HeaderDigest=None";

137 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

138 
	`¥ötf
("pduádd data failed\n");

139 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

142 
°r
 = "DataDigest=None";

143 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

144 
	`¥ötf
("pduádd data failed\n");

145 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

148 
°r
 = "InitialR2T=Yes";

149 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

150 
	`¥ötf
("pduádd data failed\n");

151 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

154 
°r
 = "ImmediateData=Yes";

155 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

156 
	`¥ötf
("pduádd data failed\n");

157 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

160 
°r
 = "MaxBurstLength=262144";

161 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

162 
	`¥ötf
("pduádd data failed\n");

163 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

166 
°r
 = "FirstBurstLength=262144";

167 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

168 
	`¥ötf
("pduádd data failed\n");

169 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

172 
°r
 = "MaxRecvDataSegmentLength=262144";

173 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

174 
	`¥ötf
("pduádd data failed\n");

175 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

178 
°r
 = "DataPDUInOrder=Yes";

179 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

180 
	`¥ötf
("pduádd data failed\n");

181 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

184 
°r
 = "DataSequenceInOrder=Yes";

185 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, (*)
°r
, 
	`°æí
(str)+1) != 0) {

186 
	`¥ötf
("pduádd data failed\n");

187 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

192 
pdu
->
ˇŒback
 = 
cb
;

193 
pdu
->
¥iv©e_d©a
 =Örivate_data;

195 i‡(
	`iscsi_queue_pdu
(
iscsi
, 
pdu
) != 0) {

196 
	`¥ötf
("failedÅo queue iscsiÜoginÖdu\n");

197 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

202 
	}
}

204 
	$iscsi_¥o˚ss_logö_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
)

206 
°©us
;

208 i‡(
size
 < 
ISCSI_HEADER_SIZE
) {

209 
	`¥ötf
("don't haveÉnough dataÅoÑead status fromÜoginÑeply\n");

218 
°©us
 = 
	`¡ohs
(*(
uöt16_t
 *)&
hdr
[36]);

219 i‡(
°©us
 != 0) {

220 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
NULL
,Ödu->
¥iv©e_d©a
);

224 
iscsi
->
°©¢
 = 
	`¡ohs
(*(
uöt16_t
 *)&
hdr
[24]);

226 
iscsi
->
is_loggedö
 = 1;

227 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_GOOD
, 
NULL
,Ödu->
¥iv©e_d©a
);

230 
	}
}

233 
	$iscsi_logout_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
)

235 
iscsi_pdu
 *
pdu
;

237 i‡(
iscsi
 =
NULL
) {

238 
	`¥ötf
("tryingÅoÜogout on NULL context\n");

242 i‡(
iscsi
->
is_loggedö
 == 0) {

243 
	`¥ötf
("tryingÅoÜogout whileÇotÜogged in\n");

247 
pdu
 = 
	`iscsi_Æloˇã_pdu
(
iscsi
, 
ISCSI_PDU_LOGOUT_REQUEST
, 
ISCSI_PDU_LOGOUT_RESPONSE
);

248 i‡(
pdu
 =
NULL
) {

249 
	`¥ötf
("FailedÅoállocateÜogoutÖdu\n");

254 
	`iscsi_pdu_£t_immedüã
(
pdu
);

257 
	`iscsi_pdu_£t_pduÊags
(
pdu
, 0x80);

260 
pdu
->
ˇŒback
 = 
cb
;

261 
pdu
->
¥iv©e_d©a
 =Örivate_data;

263 i‡(
	`iscsi_queue_pdu
(
iscsi
, 
pdu
) != 0) {

264 
	`¥ötf
("failedÅo queue iscsiÜogoutÖdu\n");

265 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

270 
	}
}

272 
	$iscsi_¥o˚ss_logout_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
 
UNUSED
)

274 
iscsi
->
is_loggedö
 = 0;

275 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_GOOD
, 
NULL
,Ödu->
¥iv©e_d©a
);

278 
	}
}

280 
	$iscsi_£t_£ssi⁄_ty≥
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_£ssi⁄_ty≥
 
£ssi⁄_ty≥
)

282 i‡(
iscsi
 =
NULL
) {

283 
	`¥ötf
("TryingÅo set sesssionÅype on NULL context\n");

286 i‡(
iscsi
->
is_loggedö
) {

287 
	`¥ötf
("tryingÅo set sessionÅype whileÜogged in\n");

291 
iscsi
->
£ssi⁄_ty≥
 = session_type;

294 
	}
}

	@ccan/ccan/iscsi/nop.c

18 
	~<°dio.h
>

19 
	~"iscsi.h
"

20 
	~"iscsi-¥iv©e.h
"

22 
	$iscsi_n›_out_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, *
d©a
, 
Àn
, *
¥iv©e_d©a
)

24 
iscsi_pdu
 *
pdu
;

26 i‡(
iscsi
 =
NULL
) {

27 
	`¥ötf
("tryingÅo sendÇop-out on NULL context\n");

31 i‡(
iscsi
->
is_loggedö
 == 0) {

32 
	`¥ötf
("trying sendÇop-out whileÇotÜogged in\n");

36 
pdu
 = 
	`iscsi_Æloˇã_pdu
(
iscsi
, 
ISCSI_PDU_NOP_OUT
, 
ISCSI_PDU_NOP_IN
);

37 i‡(
pdu
 =
NULL
) {

38 
	`¥ötf
("FailedÅoállocateÇop-outÖdu\n");

43 
	`iscsi_pdu_£t_immedüã
(
pdu
);

46 
	`iscsi_pdu_£t_pduÊags
(
pdu
, 0x80);

49 
	`iscsi_pdu_£t_ât
(
pdu
, 0xffffffff);

52 
	`iscsi_pdu_£t_lun
(
pdu
, 2);

55 
	`iscsi_pdu_£t_cmd¢
(
pdu
, 
iscsi
->
cmd¢
);

56 
pdu
->
cmd¢
 = 
iscsi
->cmdsn;

59 
pdu
->
ˇŒback
 = 
cb
;

60 
pdu
->
¥iv©e_d©a
 =Örivate_data;

62 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, 
d©a
, 
Àn
) != 0) {

63 
	`¥ötf
("FailedÅoádd outdataÅoÇop-out\n");

64 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

69 i‡(
	`iscsi_queue_pdu
(
iscsi
, 
pdu
) != 0) {

70 
	`¥ötf
("failedÅo queue iscsiÇop-outÖdu\n");

71 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

76 
	}
}

78 
	$iscsi_¥o˚ss_n›_out_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
)

80 
iscsi_d©a
 
d©a
;

82 
d©a
.d©®
NULL
;

83 
d©a
.
size
 = 0;

85 i‡(
size
 > 
ISCSI_HEADER_SIZE
) {

86 
d©a
.d©®
	`disˇrd_c⁄°
(&
hdr
[
ISCSI_HEADER_SIZE
]);

87 
d©a
.
size
 = sizê- 
ISCSI_HEADER_SIZE
;

89 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_GOOD
, &
d©a
,Ödu->
¥iv©e_d©a
);

92 
	}
}

	@ccan/ccan/iscsi/pdu.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<°rögs.h
>

21 
	~<°rög.h
>

22 
	~<¨∑/öë.h
>

23 
	~"iscsi.h
"

24 
	~"iscsi-¥iv©e.h
"

25 
	~"scsi-lowÀvñ.h
"

26 
	~"dlökli°.h
"

28 
iscsi_pdu
 *
	$iscsi_Æloˇã_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_›code
 
›code
, iscsi_›codê
ª•⁄£_›code
)

30 
iscsi_pdu
 *
pdu
;

32 
pdu
 = 
	`mÆloc
((
iscsi_pdu
));

33 i‡(
pdu
 =
NULL
) {

34 
	`¥ötf
("failedÅoállocateÖdu\n");

35  
NULL
;

37 
	`bzîo
(
pdu
, (
iscsi_pdu
));

39 
pdu
->
outd©a
.
size
 = 
ISCSI_HEADER_SIZE
;

40 
pdu
->
outd©a
.
d©a
 = 
	`mÆloc
’du->outd©a.
size
);

42 i‡(
pdu
->
outd©a
.
d©a
 =
NULL
) {

43 
	`¥ötf
("failedÅoállocateÖdu header\n");

44 
	`‰ì
(
pdu
);

45 
pdu
 = 
NULL
;

46  
NULL
;

48 
	`bzîo
(
pdu
->
outd©a
.
d©a
,Ödu->outd©a.
size
);

51 
pdu
->
outd©a
.
d©a
[0] = 
›code
;

52 
pdu
->
ª•⁄£_›code
 =Ñesponse_opcode;

55 i‡(
›code
 ==
ISCSI_PDU_LOGIN_REQUEST
) {

56 
	`mem˝y
(&
pdu
->
outd©a
.
d©a
[8], &
iscsi
->
isid
[0], 6);

60 *(
uöt32_t
 *)&
pdu
->
outd©a
.
d©a
[16] = 
	`ht⁄l
(
iscsi
->
ôt
);

61 
pdu
->
ôt
 = 
iscsi
->itt;

63 
iscsi
->
ôt
++;

65  
pdu
;

66 
	}
}

68 
	$iscsi_‰ì_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
)

70 i‡(
pdu
 =
NULL
) {

71 
	`¥ötf
("tryingÅo free NULLÖdu\n");

74 i‡(
pdu
->
outd©a
.
d©a
) {

75 
	`‰ì
(
pdu
->
outd©a
.
d©a
);

76 
pdu
->
outd©a
.
d©a
 = 
NULL
;

78 i‡(
pdu
->
öd©a
.
d©a
) {

79 
	`‰ì
(
pdu
->
öd©a
.
d©a
);

80 
pdu
->
öd©a
.
d©a
 = 
NULL
;

82 i‡(
pdu
->
scsi_cbd©a
) {

83 
	`iscsi_‰ì_scsi_cbd©a
(
pdu
->
scsi_cbd©a
);

84 
pdu
->
scsi_cbd©a
 = 
NULL
;

87 
	`‰ì
(
pdu
);

88 
	}
}

91 
	$iscsi_add_d©a
(
iscsi_d©a
 *
d©a
, c⁄° *
d±r
, 
dsize
, 
pduÆignmít
)

93 
Àn
, 
Æig√d
;

94 *
buf
;

96 i‡(
dsize
 == 0) {

97 
	`¥ötf
("TryingÅoáppend zero size dataÅo iscsi_data\n");

101 
Àn
 = 
d©a
->
size
 + 
dsize
;

102 
Æig√d
 = 
Àn
;

103 i‡(
pduÆignmít
) {

104 
Æig√d
 = (aligned+3)&0xfffffffc;

106 
buf
 = 
	`mÆloc
(
Æig√d
);

107 i‡(
buf
 =
NULL
) {

108 
	`¥ötf
("ÁûedÅÿÆloˇã buf„∏f‹ %d byãs\n", 
Àn
);

112 
	`mem˝y
(
buf
, 
d©a
->d©a, d©a->
size
);

113 
	`mem˝y
(
buf
 + 
d©a
->
size
, 
d±r
, 
dsize
);

114 i‡(
Àn
 !
Æig√d
) {

116 
	`bzîo
(
buf
+
Àn
, 
Æig√d
-len);

119 
	`‰ì
(
d©a
->data);

120 
d©a
->d©®
buf
;

121 
d©a
->
size
 = 
Àn
;

124 
	}
}

126 
	$iscsi_pdu_add_d©a
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
d±r
, 
dsize
)

128 i‡(
pdu
 =
NULL
) {

129 
	`¥ötf
("tryingÅoádd dataÅo NULLÖdu\n");

132 i‡(
dsize
 == 0) {

133 
	`¥ötf
("TryingÅoáppend zero size dataÅoÖdu\n");

137 i‡(
	`iscsi_add_d©a
(&
pdu
->
outd©a
, 
d±r
, 
dsize
, 1) != 0) {

138 
	`¥ötf
("failedÅoádd dataÅoÖdu buffer\n");

143 *(
uöt32_t
 *)&
pdu
->
outd©a
.
d©a
[4] = 
	`ht⁄l
’du->outd©a.
size
-
ISCSI_HEADER_SIZE
);

146 
	}
}

148 
	$iscsi_gë_pdu_size
(c⁄° *
hdr
)

150 
size
;

152 
size
 = (
	`¡ohl
(*(
uöt32_t
 *)&
hdr
[4])&0x00ffffffË+ 
ISCSI_HEADER_SIZE
;

153 
size
 = (size+3)&0xfffffffc;

155  
size
;

156 
	}
}

159 
	$iscsi_¥o˚ss_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
hdr
, 
size
)

161 
uöt32_t
 
ôt
;

162 
iscsi_›code
 
›code
;

163 
iscsi_pdu
 *
pdu
;

164 
uöt8_t
 
ah¶í
;

166 
›code
 = 
hdr
[0] & 0x3f;

167 
ah¶í
 = 
hdr
[4];

168 
ôt
 = 
	`¡ohl
(*(
uöt32_t
 *)&
hdr
[16]);

170 i‡(
ah¶í
 != 0) {

171 
	`¥ötf
("cant handleÉxpanded headers yet\n");

175 
pdu
 = 
iscsi
->
waôpdu
;Ödu;Ödu =Ödu->
√xt
) {

176 
iscsi_›code
 
ex≥˘ed_ª•⁄£
 = 
pdu
->
ª•⁄£_›code
;

177 
is_föished
 = 1;

179 i‡(
pdu
->
ôt
 != itt) {

186 i‡(
›code
 =
ISCSI_PDU_DATA_IN
 && 
ex≥˘ed_ª•⁄£
 =
ISCSI_PDU_SCSI_RESPONSE
) {

187 
ex≥˘ed_ª•⁄£
 = 
ISCSI_PDU_DATA_IN
;

190 i‡(
›code
 !
ex≥˘ed_ª•⁄£
) {

191 
	`¥ötf
("GŸ wr⁄g opcodêback f‹ iâ:%d gŸ:%dÉx≥˘ed %d\n", 
ôt
, 
›code
, 
pdu
->
ª•⁄£_›code
);

194 
›code
) {

195 
ISCSI_PDU_LOGIN_RESPONSE
:

196 i‡(
	`iscsi_¥o˚ss_logö_ª∂y
(
iscsi
, 
pdu
, 
hdr
, 
size
) != 0) {

197 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

198 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

199 
	`¥ötf
("iscsiÜoginÑeply failed\n");

203 
ISCSI_PDU_TEXT_RESPONSE
:

204 i‡(
	`iscsi_¥o˚ss_ãxt_ª∂y
(
iscsi
, 
pdu
, 
hdr
, 
size
) != 0) {

205 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

206 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

207 
	`¥ötf
("iscsiÅextÑeply failed\n");

211 
ISCSI_PDU_LOGOUT_RESPONSE
:

212 i‡(
	`iscsi_¥o˚ss_logout_ª∂y
(
iscsi
, 
pdu
, 
hdr
, 
size
) != 0) {

213 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

214 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

215 
	`¥ötf
("iscsiÜogoutÑeply failed\n");

219 
ISCSI_PDU_SCSI_RESPONSE
:

220 i‡(
	`iscsi_¥o˚ss_scsi_ª∂y
(
iscsi
, 
pdu
, 
hdr
, 
size
) != 0) {

221 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

222 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

223 
	`¥ötf
("iscsiÑesponseÑeply failed\n");

227 
ISCSI_PDU_DATA_IN
:

228 i‡(
	`iscsi_¥o˚ss_scsi_d©a_ö
(
iscsi
, 
pdu
, 
hdr
, 
size
, &
is_föished
) != 0) {

229 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

230 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

231 
	`¥ötf
("iscsi data in failed\n");

235 
ISCSI_PDU_NOP_IN
:

236 i‡(
	`iscsi_¥o˚ss_n›_out_ª∂y
(
iscsi
, 
pdu
, 
hdr
, 
size
) != 0) {

237 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

238 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

239 
	`¥ötf
("iscsiÇop-in failed\n");

244 
	`¥ötf
("D⁄'àknow howÅÿh™dÀ opcodê%d\n", 
›code
);

248 i‡(
is_föished
) {

249 
	`DLIST_REMOVE
(
iscsi
->
waôpdu
, 
pdu
);

250 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

252 
	`¥ötf
("pdu isÇot yet finished,Üet itÑemain\n");

258 
	}
}

260 
	$iscsi_pdu_£t_pduÊags
(
iscsi_pdu
 *
pdu
, 
Êags
)

262 
pdu
->
outd©a
.
d©a
[1] = 
Êags
;

263 
	}
}

265 
	$iscsi_pdu_£t_immedüã
(
iscsi_pdu
 *
pdu
)

267 
pdu
->
outd©a
.
d©a
[0] |
ISCSI_PDU_IMMEDIATE
;

268 
	}
}

270 
	$iscsi_pdu_£t_ât
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
ât
)

272 *(
uöt32_t
 *)&
pdu
->
outd©a
.
d©a
[20] = 
	`ht⁄l
(
ât
);

273 
	}
}

275 
	$iscsi_pdu_£t_cmd¢
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
cmd¢
)

277 *(
uöt32_t
 *)&
pdu
->
outd©a
.
d©a
[24] = 
	`ht⁄l
(
cmd¢
);

278 
	}
}

280 
	$iscsi_pdu_£t_exp°©¢
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
exp°©¢¢
)

282 *(
uöt32_t
 *)&
pdu
->
outd©a
.
d©a
[28] = 
	`ht⁄l
(
exp°©¢¢
);

283 
	}
}

285 
	$iscsi_pdu_£t_cdb
(
iscsi_pdu
 *
pdu
, 
scsi_èsk
 *
èsk
)

287 
	`bzîo
(&
pdu
->
outd©a
.
d©a
[32], 16);

288 
	`mem˝y
(&
pdu
->
outd©a
.
d©a
[32], 
èsk
->
cdb
,Åask->
cdb_size
);

289 
	}
}

291 
	$iscsi_pdu_£t_lun
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
lun
)

293 
pdu
->
outd©a
.
d©a
[9] = 
lun
;

294 
	}
}

296 
	$iscsi_pdu_£t_expx„æí
(
iscsi_pdu
 *
pdu
, 
uöt32_t
 
expx„æí
)

298 *(
uöt32_t
 *)&
pdu
->
outd©a
.
d©a
[20] = 
	`ht⁄l
(
expx„æí
);

299 
	}
}

	@ccan/ccan/iscsi/scsi-command.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<°rög.h
>

21 
	~<¨∑/öë.h
>

22 
	~"iscsi.h
"

23 
	~"iscsi-¥iv©e.h
"

24 
	~"scsi-lowÀvñ.h
"

25 
	~"dlökli°.h
"

27 
	siscsi_scsi_cbd©a
 {

28 
iscsi_scsi_cbd©a
 *
	m¥ev
, *
	m√xt
;

29 
iscsi_comm™d_cb
 
	mˇŒback
;

30 *
	m¥iv©e_d©a
;

31 
scsi_èsk
 *
	mèsk
;

34 
	$iscsi_‰ì_scsi_cbd©a
(
iscsi_scsi_cbd©a
 *
scsi_cbd©a
)

36 i‡(
scsi_cbd©a
 =
NULL
) {

39 i‡(
scsi_cbd©a
->
èsk
 =
NULL
) {

40 
	`scsi_‰ì_scsi_èsk
(
scsi_cbd©a
->
èsk
);

41 
scsi_cbd©a
->
èsk
 = 
NULL
;

43 
	`‰ì
(
scsi_cbd©a
);

44 
	}
}

46 
	$iscsi_scsi_ª•⁄£_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

48 
iscsi_scsi_cbd©a
 *
scsi_cbd©a
 = (iscsi_scsi_cbd©®*)
¥iv©e_d©a
;

49 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

51 
°©us
) {

52 
ISCSI_STATUS_CHECK_CONDITION
:

53 
scsi_cbd©a
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_CHECK_CONDITION
, 
èsk
, scsi_cbd©a->
¥iv©e_d©a
);

57 
ISCSI_STATUS_GOOD
:

58 
scsi_cbd©a
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_GOOD
, 
èsk
, scsi_cbd©a->
¥iv©e_d©a
);

61 
	`¥ötf
("C™àh™dÀ scsò°©u†%d yë\n", 
°©us
);

62 
scsi_cbd©a
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
èsk
, scsi_cbd©a->
¥iv©e_d©a
);

64 
	}
}

67 
	$iscsi_scsi_comm™d_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
scsi_èsk
 *
èsk
, 
iscsi_comm™d_cb
 
cb
, 
iscsi_d©a
 *
d©a
, *
¥iv©e_d©a
)

69 
iscsi_pdu
 *
pdu
;

70 
iscsi_scsi_cbd©a
 *
scsi_cbd©a
;

71 
Êags
;

73 i‡(
iscsi
 =
NULL
) {

74 
	`¥ötf
("tryingÅo send command on NULL context\n");

75 
	`scsi_‰ì_scsi_èsk
(
èsk
);

79 i‡(
iscsi
->
£ssi⁄_ty≥
 !
ISCSI_SESSION_NORMAL
) {

80 
	`¥ötf
("TryingÅo send command on discovery session\n");

81 
	`scsi_‰ì_scsi_èsk
(
èsk
);

85 i‡(
iscsi
->
is_loggedö
 == 0) {

86 
	`¥ötf
("TryingÅo send command whileÇotÜogged in\n");

87 
	`scsi_‰ì_scsi_èsk
(
èsk
);

91 
scsi_cbd©a
 = 
	`mÆloc
((
iscsi_scsi_cbd©a
));

92 i‡(
scsi_cbd©a
 =
NULL
) {

93 
	`¥ötf
("failedÅoállocate scsi cbdata\n");

94 
	`scsi_‰ì_scsi_èsk
(
èsk
);

97 
	`bzîo
(
scsi_cbd©a
, (
iscsi_scsi_cbd©a
));

98 
scsi_cbd©a
->
èsk
 =Åask;

99 
scsi_cbd©a
->
ˇŒback
 = 
cb
;

100 
scsi_cbd©a
->
¥iv©e_d©a
 =Örivate_data;

102 
pdu
 = 
	`iscsi_Æloˇã_pdu
(
iscsi
, 
ISCSI_PDU_SCSI_REQUEST
, 
ISCSI_PDU_SCSI_RESPONSE
);

103 i‡(
pdu
 =
NULL
) {

104 
	`¥ötf
("FailedÅoállocateÅextÖdu\n");

105 
	`iscsi_‰ì_scsi_cbd©a
(
scsi_cbd©a
);

108 
pdu
->
scsi_cbd©a
 = scsi_cbdata;

111 
Êags
 = 
ISCSI_PDU_SCSI_FINAL
|
ISCSI_PDU_SCSI_ATTR_SIMPLE
;

112 
èsk
->
x„r_dú
) {

113 
SCSI_XFER_NONE
:

115 
SCSI_XFER_READ
:

116 
Êags
 |
ISCSI_PDU_SCSI_READ
;

118 
SCSI_XFER_WRITE
:

119 
Êags
 |
ISCSI_PDU_SCSI_WRITE
;

120 i‡(
d©a
 =
NULL
) {

121 
	`¥ötf
("DATA-OUT command but data == NULL\n");

122 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

125 i‡(
d©a
->
size
 !
èsk
->
expx„æí
) {

126 
	`¥ötf
("d©®size:%d i†nŸ samêa†ex≥˘ed d©®å™s„∏Àngth:%d\n", 
d©a
->
size
, 
èsk
->
expx„æí
);

127 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

130 i‡(
	`iscsi_pdu_add_d©a
(
iscsi
, 
pdu
, 
d©a
->d©a, d©a->
size
) != 0) {

131 
	`¥ötf
("FailedÅoádd outdataÅoÅheÖdu\n");

132 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

138 
	`iscsi_pdu_£t_pduÊags
(
pdu
, 
Êags
);

141 
	`iscsi_pdu_£t_lun
(
pdu
, 
lun
);

144 
	`iscsi_pdu_£t_expx„æí
(
pdu
, 
èsk
->
expx„æí
);

147 
	`iscsi_pdu_£t_cmd¢
(
pdu
, 
iscsi
->
cmd¢
);

148 
pdu
->
cmd¢
 = 
iscsi
->cmdsn;

149 
iscsi
->
cmd¢
++;

152 
	`iscsi_pdu_£t_exp°©¢
(
pdu
, 
iscsi
->
°©¢
+1);

155 
	`iscsi_pdu_£t_cdb
(
pdu
, 
èsk
);

157 
pdu
->
ˇŒback
 = 
iscsi_scsi_ª•⁄£_cb
;

158 
pdu
->
¥iv©e_d©a
 = 
scsi_cbd©a
;

160 i‡(
	`iscsi_queue_pdu
(
iscsi
, 
pdu
) != 0) {

161 
	`¥ötf
("failedÅo queue iscsi scsiÖdu\n");

162 
	`iscsi_‰ì_pdu
(
iscsi
, 
pdu
);

167 
	}
}

170 
	$iscsi_¥o˚ss_scsi_ª∂y
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
)

172 
°©¢
, 
Êags
, 
ª•⁄£
, 
°©us
;

173 
iscsi_scsi_cbd©a
 *
scsi_cbd©a
 = 
pdu
->scsi_cbdata;

174 
scsi_èsk
 *
èsk
 = 
scsi_cbd©a
->task;

176 
°©¢
 = 
	`¡ohl
(*(
uöt32_t
 *)&
hdr
[24]);

177 i‡(
°©¢
 > ()
iscsi
->statsn) {

178 
iscsi
->
°©¢
 = statsn;

181 
Êags
 = 
hdr
[1];

182 i‡((
Êags
&
ISCSI_PDU_DATA_FINAL
) == 0) {

183 
	`¥ötf
("scsòª•⁄£Ödu buàFöÆ bô i†nŸ së: 0x%02x\n", 
Êags
);

184 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
èsk
,Ödu->
¥iv©e_d©a
);

187 i‡((
Êags
&
ISCSI_PDU_DATA_ACK_REQUESTED
) != 0) {

188 
	`¥ötf
("scsòª•⁄£ásked f‹ ACK 0x%02x\n", 
Êags
);

189 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
èsk
,Ödu->
¥iv©e_d©a
);

195 i‡((
Êags
&
ISCSI_PDU_DATA_BIDIR_OVERFLOW
) != 0) {

196 
	`¥ötf
("scsòª•⁄£ c⁄èö†bidú ovîÊow 0x%02x\n", 
Êags
);

198 i‡((
Êags
&
ISCSI_PDU_DATA_BIDIR_UNDERFLOW
) != 0) {

199 
	`¥ötf
("scsòª•⁄£ c⁄èö†bidú undîÊow 0x%02x\n", 
Êags
);

201 i‡((
Êags
&
ISCSI_PDU_DATA_RESIDUAL_OVERFLOW
) != 0) {

202 
	`¥ötf
("scsòª•⁄£ c⁄èö†ªsiduÆ ovîÊow 0x%02x\n", 
Êags
);

204 i‡((
Êags
&
ISCSI_PDU_DATA_RESIDUAL_UNDERFLOW
) != 0) {

205 
	`¥ötf
("scsòª•⁄£ c⁄èö†ªsiduÆ undîÊow 0x%02x\n", 
Êags
);

209 
ª•⁄£
 = 
hdr
[2];

210 i‡(
ª•⁄£
 != 0x00) {

211 
	`¥ötf
("scsòª∂yÑe•⁄£ fõld:%d\n", 
ª•⁄£
);

214 
°©us
 = 
hdr
[3];

216 
°©us
) {

217 
ISCSI_STATUS_GOOD
:

218 
èsk
->
d©aö
.
d©a
 = 
pdu
->
öd©a
.data;

219 
èsk
->
d©aö
.
size
 = 
pdu
->
öd©a
.size;

221 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_GOOD
, &pdu->
öd©a
,Ödu->
¥iv©e_d©a
);

223 
ISCSI_STATUS_CHECK_CONDITION
:

224 
èsk
->
d©aö
.
d©a
 = 
	`disˇrd_c⁄°
(
hdr
 + 
ISCSI_HEADER_SIZE
);

225 
èsk
->
d©aö
.
size
 = sizê- 
ISCSI_HEADER_SIZE
;

227 
èsk
->
£n£
.
îr‹_ty≥
 =Åask->
d©aö
.
d©a
[2] & 0x7f;

228 
èsk
->
£n£
.
key
 =Åask->
d©aö
.
d©a
[4] & 0x0f;

229 
èsk
->
£n£
.
ascq
 = 
	`¡ohs
(*(
uöt16_t
 *)&—ask->
d©aö
.
d©a
[14]));

231 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_CHECK_CONDITION
, 
èsk
,Ödu->
¥iv©e_d©a
);

234 
	`¥ötf
("Unknow¿°©u†:%d\n", 
°©us
);

236 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
èsk
,Ödu->
¥iv©e_d©a
);

241 
	}
}

243 
	$iscsi_¥o˚ss_scsi_d©a_ö
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
, c⁄° *
hdr
, 
size
, *
is_föished
)

245 
°©¢
, 
Êags
, 
°©us
;

246 
iscsi_scsi_cbd©a
 *
scsi_cbd©a
 = 
pdu
->scsi_cbdata;

247 
scsi_èsk
 *
èsk
 = 
scsi_cbd©a
->task;

248 
d¶
;

250 
°©¢
 = 
	`¡ohl
(*(
uöt32_t
 *)&
hdr
[24]);

251 i‡(
°©¢
 > ()
iscsi
->statsn) {

252 
iscsi
->
°©¢
 = statsn;

255 
Êags
 = 
hdr
[1];

256 i‡((
Êags
&
ISCSI_PDU_DATA_ACK_REQUESTED
) != 0) {

257 
	`¥ötf
("scsòª•⁄£ásked f‹ ACK 0x%02x\n", 
Êags
);

258 
pdu
->
	`ˇŒback
(
iscsi
, 
ISCSI_STATUS_ERROR
, 
èsk
,Ödu->
¥iv©e_d©a
);

264 i‡((
Êags
&
ISCSI_PDU_DATA_RESIDUAL_OVERFLOW
) != 0) {

265 
	`¥ötf
("scsòª•⁄£ c⁄èö†ªsiduÆ ovîÊow 0x%02x\n", 
Êags
);

267 i‡((
Êags
&
ISCSI_PDU_DATA_RESIDUAL_UNDERFLOW
) != 0) {

268 
	`¥ötf
("scsòª•⁄£ c⁄èö†ªsiduÆ undîÊow 0x%02x\n", 
Êags
);

271 
d¶
 = 
	`¡ohl
(*(
uöt32_t
 *)&
hdr
[4])&0x00ffffff;

273 i‡(
d¶
 > 
size
 - 
ISCSI_HEADER_SIZE
) {

274 
	`¥ötf
 ("d¶ i†:%d, whûêbuff£∏sizêi‡%d\n", 
d¶
, 
size
 - 
ISCSI_HEADER_SIZE
);

277 i‡(
	`iscsi_add_d©a
(&
pdu
->
öd©a
, 
	`disˇrd_c⁄°
(
hdr
 + 
ISCSI_HEADER_SIZE
), 
d¶
, 0) != 0) {

278 
	`¥ötf
("failedÅoádd dataÅoÖdu in buffer\n");

283 i‡((
Êags
&
ISCSI_PDU_DATA_FINAL
) == 0) {

284 
	`¥ötf
("scsòd©a-ö wôhouàFöÆ bô: 0x%02x\n", 
Êags
);

285 *
is_föished
 = 0;

287 i‡((
Êags
&
ISCSI_PDU_DATA_CONTAINS_STATUS
) == 0) {

288 
	`¥ötf
("scsòd©a-ö wôhouàSètu†bô: 0x%02x\n", 
Êags
);

289 *
is_föished
 = 0;

292 i‡(*
is_föished
 == 0) {

300 
°©us
 = 
hdr
[3];

301 
èsk
->
d©aö
.
d©a
 = 
pdu
->
öd©a
.data;

302 
èsk
->
d©aö
.
size
 = 
pdu
->
öd©a
.size;

304 
pdu
->
	`ˇŒback
(
iscsi
, 
°©us
, 
èsk
,Ödu->
¥iv©e_d©a
);

307 
	}
}

316 
	$iscsi_ã°unôªady_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
)

318 
scsi_èsk
 *
èsk
;

319 
ªt
;

321 i‡((
èsk
 = 
	`scsi_cdb_ã°unôªady
()Ë=
NULL
) {

322 
	`¥ötf
("FailedÅo createÅestunitready cdb\n");

325 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 
lun
, 
èsk
, 
cb
, 
NULL
, 
¥iv©e_d©a
);

327  
ªt
;

328 
	}
}

331 
	$iscsi_ªp‹éuns_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_comm™d_cb
 
cb
, 
ªp‹t_ty≥
, 
Æloc_Àn
, *
¥iv©e_d©a
)

333 
scsi_èsk
 *
èsk
;

334 
ªt
;

336 i‡(
Æloc_Àn
 < 16) {

337 
	`¥ötf
("MöimumáŒowedáŒo¯À¿f‹Ñï‹éun†i†16. You s≥cifõd %d\n", 
Æloc_Àn
);

341 i‡((
èsk
 = 
	`scsi_ªp‹éuns_cdb
(
ªp‹t_ty≥
, 
Æloc_Àn
)Ë=
NULL
) {

342 
	`¥ötf
("FailedÅo createÑeportluns cdb\n");

346 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 0, 
èsk
, 
cb
, 
NULL
, 
¥iv©e_d©a
);

348  
ªt
;

349 
	}
}

351 
	$iscsi_öquúy_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
evpd
, 
∑ge_code
, 
maxsize
, *
¥iv©e_d©a
)

353 
scsi_èsk
 *
èsk
;

354 
ªt
;

356 i‡((
èsk
 = 
	`scsi_cdb_öquúy
(
evpd
, 
∑ge_code
, 
maxsize
)Ë=
NULL
) {

357 
	`¥ötf
("FailedÅo create inquiry cdb\n");

360 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 
lun
, 
èsk
, 
cb
, 
NULL
, 
¥iv©e_d©a
);

362  
ªt
;

363 
	}
}

365 
	$iscsi_ªadˇ∑côy10_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
lba
, 
pmi
, *
¥iv©e_d©a
)

367 
scsi_èsk
 *
èsk
;

368 
ªt
;

370 i‡((
èsk
 = 
	`scsi_cdb_ªadˇ∑côy10
(
lba
, 
pmi
)Ë=
NULL
) {

371 
	`¥ötf
("FailedÅo createÑeadcapacity10 cdb\n");

374 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 
lun
, 
èsk
, 
cb
, 
NULL
, 
¥iv©e_d©a
);

376  
ªt
;

377 
	}
}

379 
	$iscsi_ªad10_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
lba
, 
d©Æí
, 
blocksize
, *
¥iv©e_d©a
)

381 
scsi_èsk
 *
èsk
;

382 
ªt
;

384 i‡(
d©Æí
 % 
blocksize
 != 0) {

385 
	`¥ötf
("d©Æí:%d i†nŸá mu…ùÀ o‡thêblocksize:%d\n", 
d©Æí
, 
blocksize
);

389 i‡((
èsk
 = 
	`scsi_cdb_ªad10
(
lba
, 
d©Æí
, 
blocksize
)Ë=
NULL
) {

390 
	`¥ötf
("FailedÅo createÑead10 cdb\n");

393 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 
lun
, 
èsk
, 
cb
, 
NULL
, 
¥iv©e_d©a
);

395  
ªt
;

396 
	}
}

399 
	$iscsi_wrôe10_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, *
d©a
, 
d©Æí
, 
lba
, 
fua
, 
fu™v
, 
blocksize
, *
¥iv©e_d©a
)

401 
scsi_èsk
 *
èsk
;

402 
iscsi_d©a
 
outd©a
;

403 
ªt
;

405 i‡(
d©Æí
 % 
blocksize
 != 0) {

406 
	`¥ötf
("d©Æí:%d i†nŸá mu…ùÀ o‡thêblocksize:%d\n", 
d©Æí
, 
blocksize
);

410 i‡((
èsk
 = 
	`scsi_cdb_wrôe10
(
lba
, 
d©Æí
, 
fua
, 
fu™v
, 
blocksize
)Ë=
NULL
) {

411 
	`¥ötf
("FailedÅo createÑead10 cdb\n");

415 
outd©a
.
d©a
 = data;

416 
outd©a
.
size
 = 
d©Æí
;

418 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 
lun
, 
èsk
, 
cb
, &
outd©a
, 
¥iv©e_d©a
);

420  
ªt
;

421 
	}
}

423 
	$iscsi_mode£n£6_async
(
iscsi_c⁄ãxt
 *
iscsi
, 
lun
, 
iscsi_comm™d_cb
 
cb
, 
dbd
, 
pc
, 
∑ge_code
, 
sub_∑ge_code
, 
Æloc_Àn
, *
¥iv©e_d©a
)

425 
scsi_èsk
 *
èsk
;

426 
ªt
;

428 i‡((
èsk
 = 
	`scsi_cdb_mode£n£6
(
dbd
, 
pc
, 
∑ge_code
, 
sub_∑ge_code
, 
Æloc_Àn
)Ë=
NULL
) {

429 
	`¥ötf
("FailedÅo create modesense6 cdb\n");

432 
ªt
 = 
	`iscsi_scsi_comm™d_async
(
iscsi
, 
lun
, 
èsk
, 
cb
, 
NULL
, 
¥iv©e_d©a
);

434  
ªt
;

435 
	}
}

	@ccan/ccan/iscsi/scsi-lowlevel.c

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<°ddef.h
>

28 
	~<°rög.h
>

29 
	~<°rögs.h
>

30 
	~<°döt.h
>

31 
	~<¨∑/öë.h
>

32 
	~<cˇn/compûî/compûî.h
>

33 
	~"scsi-lowÀvñ.h
"

34 
	~"dlökli°.h
"

37 
	$scsi_‰ì_scsi_èsk
(
scsi_èsk
 *
èsk
)

39 
scsi_Æloˇãd_mem‹y
 *
mem
;

41 (
mem
 = 
èsk
->mem)) {

42 
	`DLIST_REMOVE
(
èsk
->
mem
, mem);

43 
	`‰ì
(
mem
);

45 
	`‰ì
(
èsk
);

46 
	}
}

48 *
	$scsi_mÆloc
(
scsi_èsk
 *
èsk
, 
size_t
 
size
)

50 
scsi_Æloˇãd_mem‹y
 *
mem
;

52 
mem
 = 
	`mÆloc
((
scsi_Æloˇãd_mem‹y
));

53 i‡(
mem
 =
NULL
) {

54 
	`¥ötf
("FailedÅoállocate memoryÅo scsiÅask\n");

55  
NULL
;

57 
	`bzîo
(
mem
, (
scsi_Æloˇãd_mem‹y
));

58 
mem
->
±r
 = 
	`mÆloc
(
size
);

59 i‡(
mem
->
±r
 =
NULL
) {

60 
	`¥ötf
("FailedÅoállocate memory buffer for scsiÅask\n");

61 
	`‰ì
(
mem
);

62  
NULL
;

64 
	`bzîo
(
mem
->
±r
, 
size
);

65 
	`DLIST_ADD
(
èsk
->
mem
, mem);

66  
mem
->
±r
;

67 
	}
}

72 
scsi_èsk
 *
	$scsi_cdb_ã°unôªady
()

74 
scsi_èsk
 *
èsk
;

76 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

77 i‡(
èsk
 =
NULL
) {

78 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

79  
NULL
;

82 
	`bzîo
(
èsk
, (
scsi_èsk
));

83 
èsk
->
cdb
[0] = 
SCSI_OPCODE_TESTUNITREADY
;

85 
èsk
->
cdb_size
 = 6;

86 
èsk
->
x„r_dú
 = 
SCSI_XFER_NONE
;

87 
èsk
->
expx„æí
 = 0;

89  
èsk
;

90 
	}
}

96 
scsi_èsk
 *
	$scsi_ªp‹éuns_cdb
(
ªp‹t_ty≥
, 
Æloc_Àn
)

98 
scsi_èsk
 *
èsk
;

100 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

101 i‡(
èsk
 =
NULL
) {

102 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

103  
NULL
;

106 
	`bzîo
(
èsk
, (
scsi_èsk
));

107 
èsk
->
cdb
[0] = 
SCSI_OPCODE_REPORTLUNS
;

108 
èsk
->
cdb
[2] = 
ªp‹t_ty≥
;

109 *(
uöt32_t
 *)&
èsk
->
cdb
[6] = 
	`ht⁄l
(
Æloc_Àn
);

111 
èsk
->
cdb_size
 = 12;

112 
èsk
->
x„r_dú
 = 
SCSI_XFER_READ
;

113 
èsk
->
expx„æí
 = 
Æloc_Àn
;

115 
èsk
->
∑øms
.
ªp‹éuns
.
ªp‹t_ty≥
 =Ñeport_type;

117  
èsk
;

118 
	}
}

123 
	$scsi_ªp‹éuns_d©aö_gëfuŒsize
(
scsi_èsk
 *
èsk
)

125 
uöt32_t
 
li°_size
;

127 
li°_size
 = 
	`ht⁄l
(*(
uöt32_t
 *)&(
èsk
->
d©aö
.
d©a
[0])) + 8;

129  
li°_size
;

130 
	}
}

135 
scsi_ªp‹éuns_li°
 *
	$scsi_ªp‹éuns_d©aö_unm¨shÆl
(
scsi_èsk
 *
èsk
)

137 
scsi_ªp‹éuns_li°
 *
li°
;

138 
li°_size
;

139 
i
, 
num_luns
;

141 i‡(
èsk
->
d©aö
.
size
 < 4) {

142 
	`¥ötf
("notÉnough data forÑeportlunsÜistÜength\n");

143  
NULL
;

146 
li°_size
 = 
	`ht⁄l
(*(
uöt32_t
 *)&(
èsk
->
d©aö
.
d©a
[0])) + 8;

147 i‡(
li°_size
 < 
èsk
->
d©aö
.
size
) {

148 
	`¥ötf
("notÉnough dataÅo unmarshallÑeportluns data\n");

149  
NULL
;

152 
num_luns
 = 
li°_size
 / 8 - 1;

153 
li°
 = 
	`scsi_mÆloc
(
èsk
, 
	`off£tof
(
scsi_ªp‹éuns_li°
, 
luns
Ë+ (
uöt16_t
Ë* 
num_luns
);

154 i‡(
li°
 =
NULL
) {

155 
	`¥ötf
("FailedÅoállocateÑeportluns structure\n");

156  
NULL
;

159 
li°
->
num
 = 
num_luns
;

160 
i
=0; i<
num_luns
; i++) {

161 
li°
->
luns
[
i
] = 
	`ht⁄s
(*(
uöt16_t
 *)&(
èsk
->
d©aö
.
d©a
[i*8+8]));

164  
li°
;

165 
	}
}

171 
scsi_èsk
 *
	$scsi_cdb_ªadˇ∑côy10
(
lba
, 
pmi
)

173 
scsi_èsk
 *
èsk
;

175 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

176 i‡(
èsk
 =
NULL
) {

177 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

178  
NULL
;

181 
	`bzîo
(
èsk
, (
scsi_èsk
));

182 
èsk
->
cdb
[0] = 
SCSI_OPCODE_READCAPACITY10
;

184 *(
uöt32_t
 *)&
èsk
->
cdb
[2] = 
	`ht⁄l
(
lba
);

186 i‡(
pmi
) {

187 
èsk
->
cdb
[8] |= 0x01;

190 
èsk
->
cdb_size
 = 10;

191 
èsk
->
x„r_dú
 = 
SCSI_XFER_READ
;

192 
èsk
->
expx„æí
 = 8;

194 
èsk
->
∑øms
.
ªadˇ∑côy10
.
lba
 =Üba;

195 
èsk
->
∑øms
.
ªadˇ∑côy10
.
pmi
 =Ömi;

197  
èsk
;

198 
	}
}

203 
	$scsi_ªadˇ∑côy10_d©aö_gëfuŒsize
(
scsi_èsk
 *
èsk


204 
UNUSED
)

207 
	}
}

212 
scsi_ªadˇ∑côy10
 *
	$scsi_ªadˇ∑côy10_d©aö_unm¨shÆl
(
scsi_èsk
 *
èsk
)

214 
scsi_ªadˇ∑côy10
 *
rc10
;

216 i‡(
èsk
->
d©aö
.
size
 < 8) {

217 
	`¥ötf
("NotÉnough dataÅo unmarshallÑeadcapacity10\n");

218  
NULL
;

220 
rc10
 = 
	`mÆloc
((
scsi_ªadˇ∑côy10
));

221 i‡(
rc10
 =
NULL
) {

222 
	`¥ötf
("FailedÅoállocateÑeadcapacity10 structure\n");

223  
NULL
;

226 
rc10
->
lba
 = 
	`ht⁄l
(*(
uöt32_t
 *)&(
èsk
->
d©aö
.
d©a
[0]));

227 
rc10
->
block_size
 = 
	`ht⁄l
(*(
uöt32_t
 *)&(
èsk
->
d©aö
.
d©a
[4]));

229  
rc10
;

230 
	}
}

239 
scsi_èsk
 *
	$scsi_cdb_öquúy
(
evpd
, 
∑ge_code
, 
Æloc_Àn
)

241 
scsi_èsk
 *
èsk
;

243 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

244 i‡(
èsk
 =
NULL
) {

245 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

246  
NULL
;

249 
	`bzîo
(
èsk
, (
scsi_èsk
));

250 
èsk
->
cdb
[0] = 
SCSI_OPCODE_INQUIRY
;

252 i‡(
evpd
) {

253 
èsk
->
cdb
[1] |= 0x01;

256 
èsk
->
cdb
[2] = 
∑ge_code
;

258 *(
uöt16_t
 *)&
èsk
->
cdb
[3] = 
	`ht⁄s
(
Æloc_Àn
);

260 
èsk
->
cdb_size
 = 6;

261 
èsk
->
x„r_dú
 = 
SCSI_XFER_READ
;

262 
èsk
->
expx„æí
 = 
Æloc_Àn
;

264 
èsk
->
∑øms
.
öquúy
.
evpd
 =Évpd;

265 
èsk
->
∑øms
.
öquúy
.
∑ge_code
 =Öage_code;

267  
èsk
;

268 
	}
}

273 
	$scsi_öquúy_d©aö_gëfuŒsize
(
scsi_èsk
 *
èsk
)

275 i‡(
èsk
->
∑øms
.
öquúy
.
evpd
 != 0) {

276 
	`¥ötf
("CanÇot handleÉxtended inquiry yet\n");

281  
èsk
->
d©aö
.
d©a
[4] + 3;

282 
	}
}

287 *
	$scsi_öquúy_d©aö_unm¨shÆl
(
scsi_èsk
 *
èsk
)

289 
scsi_öquúy_°™d¨d
 *
öq
;

291 i‡(
èsk
->
∑øms
.
öquúy
.
evpd
 != 0) {

292 
	`¥ötf
("CanÇot handleÉxtended inquiry yet\n");

293  
NULL
;

297 
öq
 = 
	`scsi_mÆloc
(
èsk
, (
scsi_öquúy_°™d¨d
));

298 i‡(
öq
 =
NULL
) {

299 
	`¥ötf
("FailedÅoállocate standard inquiry structure\n");

300  
NULL
;

303 
öq
->
≥rùîÆ_quÆifõr
 = (
èsk
->
d©aö
.
d©a
[0]>>5)&0x07;

304 
öq
->
≥rùîÆ_devi˚_ty≥
 = 
èsk
->
d©aö
.
d©a
[0]&0x1f;

305 
öq
->
rmb
 = 
èsk
->
d©aö
.
d©a
[1]&0x80;

306 
öq
->
vîsi⁄
 = 
èsk
->
d©aö
.
d©a
[2];

307 
öq
->
n‹maˇ
 = 
èsk
->
d©aö
.
d©a
[3]&0x20;

308 
öq
->
hisup
 = 
èsk
->
d©aö
.
d©a
[3]&0x10;

309 
öq
->
ª•⁄£_d©a_f‹m©
 = 
èsk
->
d©aö
.
d©a
[3]&0x0f;

311 
	`mem˝y
(&
öq
->
víd‹_idítifiˇti⁄
[0], &
èsk
->
d©aö
.
d©a
[8], 8);

312 
	`mem˝y
(&
öq
->
¥odu˘_idítifiˇti⁄
[0], &
èsk
->
d©aö
.
d©a
[16], 16);

313 
	`mem˝y
(&
öq
->
¥odu˘_ªvisi⁄_Àvñ
[0], &
èsk
->
d©aö
.
d©a
[32], 4);

315  
öq
;

316 
	}
}

321 
scsi_èsk
 *
	$scsi_cdb_ªad10
(
lba
, 
x„æí
, 
blocksize
)

323 
scsi_èsk
 *
èsk
;

325 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

326 i‡(
èsk
 =
NULL
) {

327 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

328  
NULL
;

331 
	`bzîo
(
èsk
, (
scsi_èsk
));

332 
èsk
->
cdb
[0] = 
SCSI_OPCODE_READ10
;

334 *(
uöt32_t
 *)&
èsk
->
cdb
[2] = 
	`ht⁄l
(
lba
);

335 *(
uöt16_t
 *)&
èsk
->
cdb
[7] = 
	`ht⁄s
(
x„æí
/
blocksize
);

337 
èsk
->
cdb_size
 = 10;

338 
èsk
->
x„r_dú
 = 
SCSI_XFER_READ
;

339 
èsk
->
expx„æí
 = 
x„æí
;

341  
èsk
;

342 
	}
}

347 
scsi_èsk
 *
	$scsi_cdb_wrôe10
(
lba
, 
x„æí
, 
fua
, 
fu™v
, 
blocksize
)

349 
scsi_èsk
 *
èsk
;

351 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

352 i‡(
èsk
 =
NULL
) {

353 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

354  
NULL
;

357 
	`bzîo
(
èsk
, (
scsi_èsk
));

358 
èsk
->
cdb
[0] = 
SCSI_OPCODE_WRITE10
;

360 i‡(
fua
) {

361 
èsk
->
cdb
[1] |= 0x08;

363 i‡(
fu™v
) {

364 
èsk
->
cdb
[1] |= 0x02;

367 *(
uöt32_t
 *)&
èsk
->
cdb
[2] = 
	`ht⁄l
(
lba
);

368 *(
uöt16_t
 *)&
èsk
->
cdb
[7] = 
	`ht⁄s
(
x„æí
/
blocksize
);

370 
èsk
->
cdb_size
 = 10;

371 
èsk
->
x„r_dú
 = 
SCSI_XFER_WRITE
;

372 
èsk
->
expx„æí
 = 
x„æí
;

374  
èsk
;

375 
	}
}

382 
scsi_èsk
 *
	$scsi_cdb_mode£n£6
(
dbd
, 
scsi_mode£n£_∑ge_c⁄åﬁ
 
pc
, 
scsi_mode£n£_∑ge_code
 
∑ge_code
, 
sub_∑ge_code
, 
Æloc_Àn
)

384 
scsi_èsk
 *
èsk
;

386 
èsk
 = 
	`mÆloc
((
scsi_èsk
));

387 i‡(
èsk
 =
NULL
) {

388 
	`¥ötf
("FailedÅoállocate scsiÅask structure\n");

389  
NULL
;

392 
	`bzîo
(
èsk
, (
scsi_èsk
));

393 
èsk
->
cdb
[0] = 
SCSI_OPCODE_MODESENSE6
;

395 i‡(
dbd
) {

396 
èsk
->
cdb
[1] |= 0x08;

398 
èsk
->
cdb
[2] = 
pc
<<6 | 
∑ge_code
;

399 
èsk
->
cdb
[3] = 
sub_∑ge_code
;

400 
èsk
->
cdb
[4] = 
Æloc_Àn
;

402 
èsk
->
cdb_size
 = 6;

403 
èsk
->
x„r_dú
 = 
SCSI_XFER_READ
;

404 
èsk
->
expx„æí
 = 
Æloc_Àn
;

406 
èsk
->
∑øms
.
mode£n£6
.
dbd
 = dbd;

407 
èsk
->
∑øms
.
mode£n£6
.
pc
 =Öc;

408 
èsk
->
∑øms
.
mode£n£6
.
∑ge_code
 =Öage_code;

409 
èsk
->
∑øms
.
mode£n£6
.
sub_∑ge_code
 = sub_page_code;

411  
èsk
;

412 
	}
}

417 
	$scsi_mode£n£6_d©aö_gëfuŒsize
(
scsi_èsk
 *
èsk
)

419 
Àn
;

421 
Àn
 = 
èsk
->
d©aö
.
d©a
[0] + 1;

423  
Àn
;

424 
	}
}

428 
	$scsi_d©aö_gëfuŒsize
(
scsi_èsk
 *
èsk
)

430 
èsk
->
cdb
[0]) {

431 
SCSI_OPCODE_TESTUNITREADY
:

433 
SCSI_OPCODE_INQUIRY
:

434  
	`scsi_öquúy_d©aö_gëfuŒsize
(
èsk
);

435 
SCSI_OPCODE_MODESENSE6
:

436  
	`scsi_mode£n£6_d©aö_gëfuŒsize
(
èsk
);

437 
SCSI_OPCODE_READCAPACITY10
:

438  
	`scsi_ªadˇ∑côy10_d©aö_gëfuŒsize
(
èsk
);

441 
SCSI_OPCODE_REPORTLUNS
:

442  
	`scsi_ªp‹éuns_d©aö_gëfuŒsize
(
èsk
);

444 
	`¥ötf
("Unknow¿›code:%d f‹ d©aö gë fuŒ size\n", 
èsk
->
cdb
[0]);

446 
	}
}

448 *
	$scsi_d©aö_unm¨shÆl
(
scsi_èsk
 *
èsk
)

450 
èsk
->
cdb
[0]) {

451 
SCSI_OPCODE_TESTUNITREADY
:

452  
NULL
;

453 
SCSI_OPCODE_INQUIRY
:

454  
	`scsi_öquúy_d©aö_unm¨shÆl
(
èsk
);

455 
SCSI_OPCODE_READCAPACITY10
:

456  
	`scsi_ªadˇ∑côy10_d©aö_unm¨shÆl
(
èsk
);

459 
SCSI_OPCODE_REPORTLUNS
:

460  
	`scsi_ªp‹éuns_d©aö_unm¨shÆl
(
èsk
);

462 
	`¥ötf
("Unknow¿›code:%d f‹ d©aö unm¨shÆl\n", 
èsk
->
cdb
[0]);

463  
NULL
;

464 
	}
}

	@ccan/ccan/iscsi/scsi-lowlevel.h

17 #i‚de‡
CCAN_ISCSI_SCSI_LOWLEVEL_H


18 
	#CCAN_ISCSI_SCSI_LOWLEVEL_H


	)

20 
	#SCSI_CDB_MAX_SIZE
 16

	)

22 
	escsi_›code
 {
	mSCSI_OPCODE_TESTUNITREADY
=0x00,

23 
	mSCSI_OPCODE_INQUIRY
=0x12,

24 
	mSCSI_OPCODE_MODESENSE6
=0x1a,

25 
	mSCSI_OPCODE_READCAPACITY10
=0x25,

26 
	mSCSI_OPCODE_READ10
=0x28,

27 
	mSCSI_OPCODE_WRITE10
=0x2A,

28 
	mSCSI_OPCODE_REPORTLUNS
=0xA0};

31 
	#SCSI_SENSE_KEY_ILLEGAL_REQUEST
 0x05

	)

32 
	#SCSI_SENSE_KEY_UNIT_ATTENTION
 0x06

	)

35 
	#SCSI_SENSE_ASCQ_INVALID_FIELD_IN_CDB
 0x2400

	)

36 
	#SCSI_SENSE_ASCQ_BUS_RESET
 0x2900

	)

38 
	escsi_x„r_dú
 {
	mSCSI_XFER_NONE
=0,

39 
	mSCSI_XFER_READ
=1,

40 
	mSCSI_XFER_WRITE
=2};

42 
	sscsi_ªp‹éuns_∑øms
 {

43 
	mªp‹t_ty≥
;

45 
	sscsi_ªadˇ∑côy10_∑øms
 {

46 
	mlba
;

47 
	mpmi
;

49 
	sscsi_öquúy_∑øms
 {

50 
	mevpd
;

51 
	m∑ge_code
;

53 
	sscsi_mode£n£6_∑øms
 {

54 
	mdbd
;

55 
	mpc
;

56 
	m∑ge_code
;

57 
	msub_∑ge_code
;

60 
	sscsi_£n£
 {

61 
	mîr‹_ty≥
;

62 
	mkey
;

63 
	mascq
;

66 
	sscsi_d©a
 {

67 
	msize
;

68 *
	md©a
;

71 
	sscsi_Æloˇãd_mem‹y
 {

72 
scsi_Æloˇãd_mem‹y
 *
	m¥ev
, *
	m√xt
;

73 *
	m±r
;

76 
	sscsi_èsk
 {

77 
	mcdb_size
;

78 
	mx„r_dú
;

79 
	mexpx„æí
;

80 
	mcdb
[
SCSI_CDB_MAX_SIZE
];

82 
scsi_ªadˇ∑côy10_∑øms
 
	mªadˇ∑côy10
;

83 
scsi_ªp‹éuns_∑øms
 
	mªp‹éuns
;

84 
scsi_öquúy_∑øms
 
	möquúy
;

85 
scsi_mode£n£6_∑øms
 
	mmode£n£6
;

86 } 
	m∑øms
;

88 
scsi_£n£
 
	m£n£
;

89 
scsi_d©a
 
	md©aö
;

90 
scsi_Æloˇãd_mem‹y
 *
	mmem
;

93 
scsi_‰ì_scsi_èsk
(
scsi_èsk
 *
èsk
);

99 
scsi_èsk
 *
scsi_cdb_ã°unôªady
();

105 
	#SCSI_REPORTLUNS_REPORT_ALL_LUNS
 0x00

	)

106 
	#SCSI_REPORTLUNS_REPORT_WELL_KNOWN_ONLY
 0x01

	)

107 
	#SCSI_REPORTLUNS_REPORT_AVAILABLE_LUNS_ONLY
 0x02

	)

109 
	sscsi_ªp‹éuns_li°
 {

110 
uöt32_t
 
	mnum
;

111 
uöt16_t
 
	mluns
[0];

114 
scsi_èsk
 *
scsi_ªp‹éuns_cdb
(
ªp‹t_ty≥
, 
Æloc_Àn
);

119 
	sscsi_ªadˇ∑côy10
 {

120 
uöt32_t
 
	mlba
;

121 
uöt32_t
 
	mblock_size
;

123 
scsi_èsk
 *
scsi_cdb_ªadˇ∑côy10
(
lba
, 
pmi
);

129 
	escsi_öquúy_≥rùhîÆ_quÆifõr
 {
	mSCSI_INQUIRY_PERIPHERAL_QUALIFIER_CONNECTED
=0x00,

130 
	mSCSI_INQUIRY_PERIPHERAL_QUALIFIER_DISCONNECTED
=0x01,

131 
	mSCSI_INQUIRY_PERIPHERAL_QUALIFIER_NOT_SUPPORTED
=0x03};

133 
	escsi_öquúy_≥rùhîÆ_devi˚_ty≥
 {
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_DIRECT_ACCESS
=0x00,

134 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_SEQUENTIAL_ACCESS
=0x01,

135 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_PRINTER
=0x02,

136 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_PROCESSOR
=0x03,

137 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_WRITE_ONCE
=0x04,

138 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_MMC
=0x05,

139 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_SCANNER
=0x06,

140 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_OPTICAL_MEMORY
=0x07,

141 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_MEDIA_CHANGER
=0x08,

142 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_COMMUNICATIONS
=0x09,

143 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_STORAGE_ARRAY_CONTROLLER
=0x0c,

144 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_ENCLOSURE_SERVICES
=0x0d,

145 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_SIMPLIFIED_DIRECT_ACCESS
=0x0e,

146 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_OPTICAL_CARD_READER
=0x0f,

147 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_BRIDGE_CONTROLLER
=0x10,

148 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_OSD
=0x11,

149 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_AUTOMATION
=0x12,

150 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_SEQURITY_MANAGER
=0x13,

151 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_WELL_KNOWN_LUN
=0x1e,

152 
	mSCSI_INQUIRY_PERIPHERAL_DEVICE_TYPE_UNKNOWN
=0x1f};

154 
	sscsi_öquúy_°™d¨d
 {

155 
scsi_öquúy_≥rùhîÆ_quÆifõr
 
	m≥rùîÆ_quÆifõr
;

156 
scsi_öquúy_≥rùhîÆ_devi˚_ty≥
 
	m≥rùîÆ_devi˚_ty≥
;

157 
	mrmb
;

158 
	mvîsi⁄
;

159 
	mn‹maˇ
;

160 
	mhisup
;

161 
	mª•⁄£_d©a_f‹m©
;

163 
	mvíd‹_idítifiˇti⁄
[8+1];

164 
	m¥odu˘_idítifiˇti⁄
[16+1];

165 
	m¥odu˘_ªvisi⁄_Àvñ
[4+1];

168 
scsi_èsk
 *
scsi_cdb_öquúy
(
evpd
, 
∑ge_code
, 
Æloc_Àn
);

175 
	escsi_mode£n£_∑ge_c⁄åﬁ
 {
	mSCSI_MODESENSE_PC_CURRENT
=0x00,

176 
	mSCSI_MODESENSE_PC_CHANGEABLE
=0x01,

177 
	mSCSI_MODESENSE_PC_DEFAULT
=0x02,

178 
	mSCSI_MODESENSE_PC_SAVED
=0x03};

180 
	escsi_mode£n£_∑ge_code
 {
	mSCSI_MODESENSE_PAGECODE_RETURN_ALL_PAGES
=0x3f};

182 
scsi_èsk
 *
scsi_cdb_mode£n£6
(
dbd
, 
scsi_mode£n£_∑ge_c⁄åﬁ
 
pc
, 
scsi_mode£n£_∑ge_code
 
∑ge_code
, 
sub_∑ge_code
, 
Æloc_Àn
);

187 
scsi_d©aö_gëfuŒsize
(
scsi_èsk
 *
èsk
);

188 *
scsi_d©aö_unm¨shÆl
(
scsi_èsk
 *
èsk
);

190 
scsi_èsk
 *
scsi_cdb_ªad10
(
lba
, 
x„æí
, 
blocksize
);

191 
scsi_èsk
 *
scsi_cdb_wrôe10
(
lba
, 
x„æí
, 
fua
, 
fu™v
, 
blocksize
);

	@ccan/ccan/iscsi/socket.c

18 
	~"c⁄fig.h
"

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<°rögs.h
>

23 
	~<î∫o.h
>

24 
	~<f˙é.h
>

25 
	~<uni°d.h
>

26 
	~<√töë/ö.h
>

27 
	~<pﬁl.h
>

28 
	~<sys/io˘l.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/sockë.h
>

31 
	~<¨∑/öë.h
>

32 
	~"iscsi.h
"

33 
	~"iscsi-¥iv©e.h
"

34 
	~"dlökli°.h
"

35 #i‡
HAVE_SYS_FILIO_H


36 
	~<sys/fûio.h
>

39 
	$£t_n⁄blockög
(
fd
)

41 
v
;

42 
v
 = 
	`f˙é
(
fd
, 
F_GETFL
, 0);

43 
	`f˙é
(
fd
, 
F_SETFL
, 
v
 | 
O_NONBLOCK
);

44 
	}
}

46 
	$iscsi_c⁄√˘_async
(
iscsi_c⁄ãxt
 *
iscsi
, c⁄° *
èrgë
, 
iscsi_comm™d_cb
 
cb
, *
¥iv©e_d©a
)

48 
p‹t
 = 3260;

49 *
°r
;

50 *
addr
;

52 
sockaddr
 
ß
;

53 
sockaddr_°‹age
 
ss
;

54 
sockaddr_ö
 
sö
;

55 } 
s
;

56 
socksize
;

58 i‡(
iscsi
 =
NULL
) {

59 
	`¥ötf
("TryingÅo connect NULL context\n");

62 i‡(
iscsi
->
fd
 != -1) {

63 
	`¥ötf
("TryingÅo connect butálready connected\n");

67 
addr
 = 
	`°rdup
(
èrgë
);

68 i‡(
addr
 =
NULL
) {

69 
	`¥ötf
("failedÅo strdupÅargetáddress\n");

74 i‡((
°r
 = 
	`rödex
(
addr
, ',')Ë!
NULL
) {

75 
°r
[0] = 0;

80 i‡((
°r
 = 
	`rödex
(
addr
, ':')Ë!
NULL
) {

81 
p‹t
 = 
	`©oi
(
°r
+1);

82 
°r
[0] = 0;

85 
s
.
sö
.
sö_Ámûy
 = 
AF_INET
;

86 
s
.
sö
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

87 i‡(
	`öë_±⁄
(
AF_INET
, 
addr
, &
s
.
sö
.
sö_addr
) != 1) {

88 
	`¥ötf
("failedÅo convertÅo ipáddress\n");

89 
	`‰ì
(
addr
);

92 
	`‰ì
(
addr
);

94 
s
.
ss
.
ss_Ámûy
) {

95 
AF_INET
:

96 
iscsi
->
fd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

97 
socksize
 = (
sockaddr_ö
);

100 
	`¥ötf
("Unknow¿Ámûy :%d\n", 
s
.
ss
.
ss_Ámûy
);

105 i‡(
iscsi
->
fd
 == -1) {

106 
	`¥ötf
("FailedÅo open socket\n");

111 
iscsi
->
c⁄√˘_cb
 = 
cb
;

112 
iscsi
->
c⁄√˘_d©a
 = 
¥iv©e_d©a
;

114 
	`£t_n⁄blockög
(
iscsi
->
fd
);

116 i‡(
	`c⁄√˘
(
iscsi
->
fd
, &
s
.
ß
, 
socksize
Ë!0 && 
î∫o
 !
EINPROGRESS
) {

117 
	`¥ötf
("C⁄√˘ faûedÉºnÿ: %†(%d)\n", 
	`°ªº‹
(
î∫o
),Érrno);

122 
	}
}

124 
	$iscsi_disc⁄√˘
(
iscsi_c⁄ãxt
 *
iscsi
)

126 i‡(
iscsi
 =
NULL
) {

127 
	`¥ötf
("TryingÅo disconnect NULL context\n");

130 i‡(
iscsi
->
is_loggedö
 != 0) {

131 
	`¥ötf
("TryingÅo disconnect whileÜogged in\n");

134 i‡(
iscsi
->
fd
 == -1) {

135 
	`¥ötf
("TryingÅo disconnect butÇot connected\n");

139 
	`˛o£
(
iscsi
->
fd
);

140 
iscsi
->
fd
 = -1;

142 
iscsi
->
is_c⁄√˘ed
 = 0;

145 
	}
}

147 
	$iscsi_gë_fd
(
iscsi_c⁄ãxt
 *
iscsi
)

149 i‡(
iscsi
 =
NULL
) {

150 
	`¥ötf
("TryingÅo get fd for NULL context\n");

154  
iscsi
->
fd
;

155 
	}
}

157 
	$iscsi_which_evíts
(
iscsi_c⁄ãxt
 *
iscsi
)

159 
evíts
 = 
POLLIN
;

161 i‡(
iscsi
->
is_c⁄√˘ed
 == 0) {

162 
evíts
 |
POLLOUT
;

165 i‡(
iscsi
->
outqueue
) {

166 
evíts
 |
POLLOUT
;

168  
evíts
;

169 
	}
}

171 
	$iscsi_ªad_‰om_sockë
(
iscsi_c⁄ãxt
 *
iscsi
)

173 
avaûabÀ
;

174 
size
;

175 *
buf
;

176 
ssize_t
 
cou¡
;

178 i‡(
	`io˘l
(
iscsi
->
fd
, 
FIONREAD
, &
avaûabÀ
) != 0) {

179 
	`¥ötf
("io˘»FIONREADÑëu∫edÉº‹ : %d\n", 
î∫o
);

182 i‡(
avaûabÀ
 == 0) {

183 
	`¥ötf
("no dataÑeadable in socket, socket is closed\n");

186 
size
 = 
iscsi
->
ösize
 - iscsi->
öpos
 + 
avaûabÀ
;

187 
buf
 = 
	`mÆloc
(
size
);

188 i‡(
buf
 =
NULL
) {

189 
	`¥ötf
("ÁûedÅÿÆloˇã %d byã†f‹ i≈uàbuf„r\n", 
size
);

192 i‡(
iscsi
->
ösize
 > iscsi->
öpos
) {

193 
	`mem˝y
(
buf
, 
iscsi
->
öbuf
 + iscsi->
öpos
, iscsi->
ösize
 - iscsi->inpos);

194 
iscsi
->
ösize
 -iscsi->
öpos
;

195 
iscsi
->
öpos
 = 0;

198 
cou¡
 = 
	`ªad
(
iscsi
->
fd
, 
buf
 + iscsi->
ösize
, 
avaûabÀ
);

199 i‡(
cou¡
 == -1) {

200 i‡(
î∫o
 =
EINTR
) {

201 
	`‰ì
(
buf
);

202 
buf
 = 
NULL
;

205 
	`¥ötf
("ªad from sockë faûed,Éºno:%d\n", 
î∫o
);

206 
	`‰ì
(
buf
);

207 
buf
 = 
NULL
;

211 i‡(
iscsi
->
öbuf
 !
NULL
) {

212 
	`‰ì
(
iscsi
->
öbuf
);

214 
iscsi
->
öbuf
 = 
buf
;

215 
iscsi
->
ösize
 +
cou¡
;

218 i‡(
iscsi
->
ösize
 - iscsi->
öpos
 < 48) {

221 
cou¡
 = 
	`iscsi_gë_pdu_size
(
iscsi
->
öbuf
 + iscsi->
öpos
);

222 i‡(
iscsi
->
ösize
 + iscsi->
öpos
 < 
cou¡
) {

225 i‡(
	`iscsi_¥o˚ss_pdu
(
iscsi
, iscsi->
öbuf
 + iscsi->
öpos
, 
cou¡
) != 0) {

226 
	`¥ötf
("failedÅoÖrocessÖdu\n");

229 
iscsi
->
öpos
 +
cou¡
;

230 i‡(
iscsi
->
öpos
 =iscsi->
ösize
) {

231 
	`‰ì
(
iscsi
->
öbuf
);

232 
iscsi
->
öbuf
 = 
NULL
;

233 
iscsi
->
ösize
 = 0;

234 
iscsi
->
öpos
 = 0;

236 i‡(
iscsi
->
öpos
 > iscsi->
ösize
) {

237 
	`¥ötf
("inpos > insize. bug!\n");

243 
	}
}

245 
	$iscsi_wrôe_to_sockë
(
iscsi_c⁄ãxt
 *
iscsi
)

247 
ssize_t
 
cou¡
;

249 i‡(
iscsi
 =
NULL
) {

250 
	`¥ötf
("tryingÅo writeÅo socket for NULL context\n");

253 i‡(
iscsi
->
fd
 == -1) {

254 
	`¥ötf
("tryingÅo write butÇot connected\n");

258 
iscsi
->
outqueue
 !
NULL
) {

259 
ssize_t
 
tŸÆ
;

261 
tŸÆ
 = 
iscsi
->
outqueue
->
outd©a
.
size
;

262 
tŸÆ
 = (total +3) & 0xfffffffc;

264 
cou¡
 = 
	`wrôe
(
iscsi
->
fd
, iscsi->
outqueue
->
outd©a
.
d©a
 + iscsi->outqueue->
wrôãn
, 
tŸÆ
 - iscsi->outqueue->written);

265 i‡(
cou¡
 == -1) {

266 i‡(
î∫o
 =
EAGAIN
 ||Éºnÿ=
EWOULDBLOCK
) {

267 
	`¥ötf
("socket would block,Ñeturn from writeÅo socket\n");

270 
	`¥ötf
("Eº‹ whí wrôögÅÿsockë :%d\n", 
î∫o
);

274 
iscsi
->
outqueue
->
wrôãn
 +
cou¡
;

275 i‡(
iscsi
->
outqueue
->
wrôãn
 =
tŸÆ
) {

276 
iscsi_pdu
 *
pdu
 = 
iscsi
->
outqueue
;

278 
	`DLIST_REMOVE
(
iscsi
->
outqueue
, 
pdu
);

279 
	`DLIST_ADD_END
(
iscsi
->
waôpdu
, 
pdu
, 
NULL
);

283 
	}
}

285 
	$iscsi_£rvi˚
(
iscsi_c⁄ãxt
 *
iscsi
, 
ªvíts
)

287 i‡(
ªvíts
 & 
POLLERR
) {

288 
	`¥ötf
("iscsi_service: POLLERR, socketÉrror\n");

289 
iscsi
->
	`c⁄√˘_cb
(iscsi, 
ISCSI_STATUS_ERROR
, 
NULL
, iscsi->
c⁄√˘_d©a
);

292 i‡(
ªvíts
 & 
POLLHUP
) {

293 
	`¥ötf
("iscsi_service: POLLHUP, socketÉrror\n");

294 
iscsi
->
	`c⁄√˘_cb
(iscsi, 
ISCSI_STATUS_ERROR
, 
NULL
, iscsi->
c⁄√˘_d©a
);

298 i‡(
iscsi
->
is_c⁄√˘ed
 =0 && iscsi->
fd
 !-1 && 
ªvíts
&
POLLOUT
) {

299 
iscsi
->
is_c⁄√˘ed
 = 1;

300 
iscsi
->
	`c⁄√˘_cb
(iscsi, 
ISCSI_STATUS_GOOD
, 
NULL
, iscsi->
c⁄√˘_d©a
);

304 i‡(
ªvíts
 & 
POLLOUT
 && 
iscsi
->
outqueue
 !
NULL
) {

305 i‡(
	`iscsi_wrôe_to_sockë
(
iscsi
) != 0) {

306 
	`¥ötf
("writeÅo socket failed\n");

310 i‡(
ªvíts
 & 
POLLIN
) {

311 i‡(
	`iscsi_ªad_‰om_sockë
(
iscsi
) != 0) {

312 
	`¥ötf
("read from socket failed\n");

318 
	}
}

320 
	$iscsi_queue_pdu
(
iscsi_c⁄ãxt
 *
iscsi
, 
iscsi_pdu
 *
pdu
)

322 i‡(
iscsi
 =
NULL
) {

323 
	`¥ötf
("tryingÅo queueÅo NULL context\n");

326 i‡(
pdu
 =
NULL
) {

327 
	`¥ötf
("tryingÅo queue NULLÖdu\n");

330 
	`DLIST_ADD_END
(
iscsi
->
outqueue
, 
pdu
, 
NULL
);

333 
	}
}

	@ccan/ccan/iscsi/test/run.c

1 
	~<cˇn/iscsi/iscsi.h
>

2 
	~<cˇn/iscsi/discovîy.c
>

3 
	~<cˇn/iscsi/sockë.c
>

4 
	~<cˇn/iscsi/öô.c
>

5 
	~<cˇn/iscsi/pdu.c
>

6 
	~<cˇn/iscsi/scsi-lowÀvñ.c
>

7 
	~<cˇn/iscsi/n›.c
>

8 
	~<cˇn/iscsi/logö.c
>

9 
	~<cˇn/iscsi/scsi-comm™d.c
>

10 
	~<cˇn/èp/èp.h
>

12 
	$maö
()

14 
iscsi_c⁄ãxt
 *
iscsi
;

16 
	`∂™_ã°s
(2);

18 
iscsi
 = 
	`iscsi_¸óã_c⁄ãxt
("someÇame");

19 
	`ok1
(
iscsi
);

20 
	`ok1
(
	`iscsi_de°roy_c⁄ãxt
(
iscsi
) == 0);

23  
	`exô_°©us
();

24 
	}
}

	@ccan/ccan/iscsi/tools/iscsiclient.c

16 
	#TARGET
 "10.1.1.27:3260"

	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<°döt.h
>

21 
	~<°rög.h
>

22 
	~<pﬁl.h
>

23 
	~<cˇn/iscsi/iscsi.h
>

24 
	~<cˇn/iscsi/scsi-lowÀvñ.h
>

26 
	s˛õ¡_°©e
 {

27 *
	mmesßge
;

28 
	mhas_discovîed_èrgë
;

29 *
	mèrgë_«me
;

30 *
	mèrgë_addªss
;

31 
	mlun
;

32 
	mblock_size
;

35 
	$n›_out_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

37 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

38 
iscsi_d©a
 *
d©a
 = 
comm™d_d©a
;

40 
	`¥ötf
("NOP-IN sètus:%d\n", 
°©us
);

41 i‡(
d©a
->
size
 > 0) {

42 
	`¥ötf
("NOP-IN d©a:%s\n", 
d©a
->data);

44 
	`exô
(10);

45 
	}
}

48 
	$wrôe10_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

50 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

51 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

52 
i
;

54 i‡(
°©us
 =
ISCSI_STATUS_CHECK_CONDITION
) {

56 
	`¥ötf
("Wrôe10 faûed wôh sí£ key:%dáscq:%04x\n", 
èsk
->
£n£
.
key
,Åask->£n£.
ascq
);

57 
	`exô
(10);

60 
	`¥ötf
("Write successful\n");

61 
	`exô
(10);

62 
	}
}

65 
	$ªad10_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

67 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

68 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

69 
i
;

71 i‡(
°©us
 =
ISCSI_STATUS_CHECK_CONDITION
) {

72 
	`¥ötf
("Ród10 faûed wôh sí£ key:%dáscq:%04x\n", 
èsk
->
£n£
.
key
,Åask->£n£.
ascq
);

73 
	`exô
(10);

76 
	`¥ötf
("READ10 successful. Block content:\n");

77 
i
=0;i<
èsk
->
d©aö
.
size
;i++) {

78 
	`¥ötf
("%02x ", 
èsk
->
d©aö
.
d©a
[
i
]);

79 i‡(
i
%16==15)

80 
	`¥ötf
("\n");

81 i‡(
i
==69)

84 
	`¥ötf
("...\n");

86 
	`¥ötf
("Finished, wontÅryÅo write data sinceÅhat willÜikely destroy your LUN :-(\n");

87 
	`¥ötf
("Send NOP-OUT\n");

88 i‡(
	`iscsi_n›_out_async
(
iscsi
, 
n›_out_cb
, "Pög!", 6, 
¥iv©e_d©a
) != 0) {

89 
	`¥ötf
("failedÅo sendÇop-out\n");

90 
	`exô
(10);

97 
	}
}

99 
	$ªadˇ∑côy10_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

101 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

102 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

103 
scsi_ªadˇ∑côy10
 *
rc10
;

104 
fuŒ_size
;

106 i‡(
°©us
 =
ISCSI_STATUS_CHECK_CONDITION
) {

107 
	`¥ötf
("Ródˇ∑côy10 faûed wôh sí£ key:%dáscq:%04x\n", 
èsk
->
£n£
.
key
,Åask->£n£.
ascq
);

108 
	`exô
(10);

111 
fuŒ_size
 = 
	`scsi_d©aö_gëfuŒsize
(
èsk
);

112 i‡(
fuŒ_size
 < 
èsk
->
d©aö
.
size
) {

113 
	`¥ötf
("notÉnough data for full sizeÑeadcapacity10\n");

114 
	`exô
(10);

117 
rc10
 = 
	`scsi_d©aö_unm¨shÆl
(
èsk
);

118 i‡(
rc10
 =
NULL
) {

119 
	`¥ötf
("failedÅo unmarshallÑeadcapacity10 data\n");

120 
	`exô
(10);

122 
˛¡
->
block_size
 = 
rc10
->block_size;

123 
	`¥ötf
("READCAPACITY10 suc˚ssful. Size:%d block† blocksize:%d. Ród fú° block\n", 
rc10
->
lba
,Ñc10->
block_size
);

124 
	`‰ì
(
rc10
);

126 i‡(
	`iscsi_ªad10_async
(
iscsi
, 
˛¡
->
lun
, 
ªad10_cb
, 0, c t->
block_size
, c t->block_size, 
¥iv©e_d©a
) != 0) {

127 
	`¥ötf
("failedÅo sendÑead10 command\n");

128 
	`exô
(10);

130 
	}
}

132 
	$mode£n£6_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

134 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

135 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

136 
fuŒ_size
;

138 i‡(
°©us
 =
ISCSI_STATUS_CHECK_CONDITION
) {

139 
	`¥ötf
("Mode£n£6 faûed wôh sí£ key:%dáscq:%04x\n", 
èsk
->
£n£
.
key
,Åask->£n£.
ascq
);

140 
	`exô
(10);

143 
fuŒ_size
 = 
	`scsi_d©aö_gëfuŒsize
(
èsk
);

144 i‡(
fuŒ_size
 > 
èsk
->
d©aö
.
size
) {

145 
	`¥ötf
("didÇot getÉnough data for mode sense, sening modesenseágainásking for bigger buffer\n");

146 i‡(
	`iscsi_mode£n£6_async
(
iscsi
, 
˛¡
->
lun
, 
mode£n£6_cb
, 0, 
SCSI_MODESENSE_PC_CURRENT
, 
SCSI_MODESENSE_PAGECODE_RETURN_ALL_PAGES
, 0, 
fuŒ_size
, 
¥iv©e_d©a
) != 0) {

147 
	`¥ötf
("failedÅo send modesense6 command\n");

148 
	`exô
(10);

153 
	`¥ötf
("MODESENSE6 successful.\n");

154 
	`¥ötf
("Send READCAPACITY10\n");

155 i‡(
	`iscsi_ªadˇ∑côy10_async
(
iscsi
, 
˛¡
->
lun
, 
ªadˇ∑côy10_cb
, 0, 0, 
¥iv©e_d©a
) != 0) {

156 
	`¥ötf
("failedÅo sendÑeadcapacity command\n");

157 
	`exô
(10);

159 
	}
}

161 
	$öquúy_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

163 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

164 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

165 
scsi_öquúy_°™d¨d
 *
öq
;

167 i‡(
°©us
 =
ISCSI_STATUS_CHECK_CONDITION
) {

168 
	`¥ötf
("Inquúy faûed wôh sí£ key:%dáscq:%04x\n", 
èsk
->
£n£
.
key
,Åask->£n£.
ascq
);

169 
	`exô
(10);

172 
	`¥ötf
("INQUIRY successful for standard data.\n");

173 
öq
 = 
	`scsi_d©aö_unm¨shÆl
(
èsk
);

174 i‡(
öq
 =
NULL
) {

175 
	`¥ötf
("failedÅo unmarshall inquiry datain blob\n");

176 
	`exô
(10);

179 
	`¥ötf
("Devi˚ Ty≥ i†%d. Víd‹Id:%†Produ˘Id:%s\n", 
öq
->
≥rùîÆ_devi˚_ty≥
, inq->
víd‹_idítifiˇti⁄
, inq->
¥odu˘_idítifiˇti⁄
);

180 
	`¥ötf
("Send MODESENSE6\n");

181 i‡(
	`iscsi_mode£n£6_async
(
iscsi
, 
˛¡
->
lun
, 
mode£n£6_cb
, 0, 
SCSI_MODESENSE_PC_CURRENT
, 
SCSI_MODESENSE_PAGECODE_RETURN_ALL_PAGES
, 0, 4, 
¥iv©e_d©a
) != 0) {

182 
	`¥ötf
("failedÅo send modesense6 command\n");

183 
	`exô
(10);

186 
	}
}

188 
	$ã°unôªady_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

190 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

191 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

193 i‡(
°©us
 =
ISCSI_STATUS_CHECK_CONDITION
) {

194 
	`¥ötf
("Fú°Åe°unôªady faûed wôh sí£ key:%dáscq:%04x\n", 
èsk
->
£n£
.
key
,Åask->£n£.
ascq
);

195 i‡(
èsk
->
£n£
.
key
 =
SCSI_SENSE_KEY_UNIT_ATTENTION
 &&Åask->£n£.
ascq
 =
SCSI_SENSE_ASCQ_BUS_RESET
) {

196 
	`¥ötf
("target device just came online,Åryágain\n");

198 i‡(
	`iscsi_ã°unôªady_async
(
iscsi
, 
˛¡
->
lun
, 
ã°unôªady_cb
, 
¥iv©e_d©a
) != 0) {

199 
	`¥ötf
("failedÅo sendÅestunitready command\n");

200 
	`exô
(10);

206 
	`¥ötf
("TESTUNITREADY suc˚ssful, dÿ™ inquúy o¿lun:%d\n", 
˛¡
->
lun
);

207 i‡(
	`iscsi_öquúy_async
(
iscsi
, 
˛¡
->
lun
, 
öquúy_cb
, 0, 0, 64, 
¥iv©e_d©a
) != 0) {

208 
	`¥ötf
("failedÅo send inquiry command\n");

209 
	`exô
(10);

211 
	}
}

214 
	$ªp‹éuns_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

216 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

217 
scsi_èsk
 *
èsk
 = 
comm™d_d©a
;

218 
scsi_ªp‹éuns_li°
 *
li°
;

219 
uöt32_t
 
fuŒ_ªp‹t_size
;

220 
i
;

222 i‡(
°©us
 !
ISCSI_STATUS_GOOD
) {

223 
	`¥ötf
("Rï‹éun†Áûed wôh unknow¿°©u†codê:%d\n", 
°©us
);

227 
fuŒ_ªp‹t_size
 = 
	`scsi_d©aö_gëfuŒsize
(
èsk
);

229 
	`¥ötf
("REPORTLUNS sètus:%d d©®size:%d, fuŒÑï‹t†lun†d©®size:%d\n", 
°©us
, 
èsk
->
d©aö
.
size
, 
fuŒ_ªp‹t_size
);

230 i‡(
fuŒ_ªp‹t_size
 > 
èsk
->
d©aö
.
size
) {

231 
	`¥ötf
("We didÇot getállÅhe data weÇeed inÑeportluns,áskágain\n");

232 i‡(
	`iscsi_ªp‹éuns_async
(
iscsi
, 
ªp‹éuns_cb
, 0, 
fuŒ_ªp‹t_size
, 
¥iv©e_d©a
) != 0) {

233 
	`¥ötf
("failedÅo sendÑeportluns command\n");

234 
	`exô
(10);

240 
li°
 = 
	`scsi_d©aö_unm¨shÆl
(
èsk
);

241 i‡(
li°
 =
NULL
) {

242 
	`¥ötf
("failedÅo unmarshallÑeportluns datain blob\n");

243 
	`exô
(10);

245 
i
=0; i < 
li°
->
num
; i++) {

246 
	`¥ötf
("LUN:%d found\n", 
li°
->
luns
[
i
]);

247 
˛¡
->
lun
 = 
li°
->
luns
[
i
];

250 
	`¥ötf
("Wû»u£ LUN:%d\n", 
˛¡
->
lun
);

251 
	`¥ötf
("SídÅe°unôªadyÅÿlu¿%d\n", 
˛¡
->
lun
);

252 i‡(
	`iscsi_ã°unôªady_async
(
iscsi
, 
˛¡
->
lun
, 
ã°unôªady_cb
, 
¥iv©e_d©a
) != 0) {

253 
	`¥ötf
("failedÅo sendÅestunitready command\n");

254 
	`exô
(10);

256 
	}
}

259 
	$n‹mÆlogö_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

261 i‡(
°©us
 != 0) {

262 
	`¥ötf
("FaûedÅÿlog i¿tÿèrgë. sètu†:0x%04x\n", 
°©us
);

263 
	`exô
(10);

266 
	`¥ötf
("Logged inÇormal session, sendÑeportluns\n");

267 i‡(
	`iscsi_ªp‹éuns_async
(
iscsi
, 
ªp‹éuns_cb
, 0, 16, 
¥iv©e_d©a
) != 0) {

268 
	`¥ötf
("failedÅo sendÑeportluns command\n");

269 
	`exô
(10);

271 
	}
}

274 
	$n‹mÆc⁄√˘_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

276 
	`¥ötf
("ConnectedÅo iscsi socket\n");

278 i‡(
°©us
 != 0) {

279 
	`¥ötf
("n‹mÆc⁄√˘_cb: c⁄√˘i⁄ faûed sètus:%d\n", 
°©us
);

280 
	`exô
(10);

283 
	`¥ötf
("connected, sendÜogin command\n");

284 
	`iscsi_£t_£ssi⁄_ty≥
(
iscsi
, 
ISCSI_SESSION_NORMAL
);

285 i‡(
	`iscsi_logö_async
(
iscsi
, 
n‹mÆlogö_cb
, 
¥iv©e_d©a
) != 0) {

286 
	`¥ötf
("iscsi_login_async failed\n");

287 
	`exô
(10);

289 
	}
}

293 
	$discovîylogout_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

295 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

297 
	`¥ötf
("discovîy sessi⁄Üogged out, Mesßgê‰om maö(Ëwas:[%s]\n", 
˛¡
->
mesßge
);

299 
	`¥ötf
("disconnect socket\n");

300 i‡(
	`iscsi_disc⁄√˘
(
iscsi
) != 0) {

301 
	`¥ötf
("FailedÅo disconnect old socket\n");

302 
	`exô
(10);

305 
	`¥ötf
("ªc⁄√˘ wôhÇ‹mÆÜogöÅÿ[%s]\n", 
˛¡
->
èrgë_addªss
);

306 
	`¥ötf
("U£Å¨gë«mê[%s] whí c⁄√˘ög\n", 
˛¡
->
èrgë_«me
);

307 i‡(
	`iscsi_£t_èrgë«me
(
iscsi
, 
˛¡
->
èrgë_«me
)) {

308 
	`¥ötf
("FailedÅo setÅargetÇame\n");

309 
	`exô
(10);

311 i‡(
	`iscsi_£t_Æüs
(
iscsi
, "ronnie") != 0) {

312 
	`¥ötf
("FailedÅoáddálias\n");

313 
	`exô
(10);

315 i‡(
	`iscsi_£t_£ssi⁄_ty≥
(
iscsi
, 
ISCSI_SESSION_NORMAL
) != 0) {

316 
	`¥ötf
("FailedÅo set settionÅypeÅoÇormal\n");

317 
	`exô
(10);

320 i‡(
	`iscsi_c⁄√˘_async
(
iscsi
, 
˛¡
->
èrgë_addªss
, 
n‹mÆc⁄√˘_cb
, clnt) != 0) {

321 
	`¥ötf
("iscsi_connect failed\n");

322 
	`exô
(10);

324 
	}
}

326 
	$discovîy_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

328 
˛õ¡_°©e
 *
˛¡
 = (˛õ¡_°©ê*)
¥iv©e_d©a
;

329 
iscsi_discovîy_addªss
 *
addr
;

331 
	`¥ötf
("discovîy cÆlback sètus:%04x\n", 
°©us
);

332 
addr
=
comm™d_d©a
;áddr;áddr˜ddr->
√xt
) {

333 
	`¥ötf
("T¨gë:%†Addªss:%s\n", 
addr
->
èrgë_«me
,áddr->
èrgë_addªss
);

336 
addr
=
comm™d_d©a
;

337 
˛¡
->
has_discovîed_èrgë
 = 1;

338 
˛¡
->
èrgë_«me
 = 
	`°rdup
(
addr
->target_name);

339 
˛¡
->
èrgë_addªss
 = 
	`°rdup
(
addr
->target_address);

342 
	`¥ötf
("discovery complete, sendÜogout command\n");

344 i‡(
	`iscsi_logout_async
(
iscsi
, 
discovîylogout_cb
, 
¥iv©e_d©a
) != 0) {

345 
	`¥ötf
("iscsi_logout_async failed\n");

346 
	`exô
(10);

348 
	}
}

351 
	$discovîylogö_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

353 i‡(
°©us
 != 0) {

354 
	`¥ötf
("FaûedÅÿlog i¿tÿèrgë. sètu†:0x%04x\n", 
°©us
);

355 
	`exô
(10);

358 
	`¥ötf
("Logged inÅoÅarget, send discovery command\n");

359 i‡(
	`iscsi_discovîy_async
(
iscsi
, 
discovîy_cb
, 
¥iv©e_d©a
) != 0) {

360 
	`¥ötf
("failedÅo send discovery command\n");

361 
	`exô
(10);

364 
	}
}

366 
	$discovîyc⁄√˘_cb
(
iscsi_c⁄ãxt
 *
iscsi
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

368 
	`¥ötf
("C⁄√˘edÅÿiscsòsockë sètus:0x%08x\n", 
°©us
);

370 i‡(
°©us
 != 0) {

371 
	`¥ötf
("discovîyc⁄√˘_cb: c⁄√˘i⁄ faûed sètus:%d\n", 
°©us
);

372 
	`exô
(10);

375 
	`¥ötf
("connected, sendÜogin command\n");

376 
	`iscsi_£t_£ssi⁄_ty≥
(
iscsi
, 
ISCSI_SESSION_DISCOVERY
);

377 i‡(
	`iscsi_logö_async
(
iscsi
, 
discovîylogö_cb
, 
¥iv©e_d©a
) != 0) {

378 
	`¥ötf
("iscsi_login_async failed\n");

379 
	`exô
(10);

381 
	}
}

384 
	$maö
(
¨gc
, *
¨gv
[])

386 
iscsi_c⁄ãxt
 *
iscsi
;

387 
pﬁlfd
 
pfd
;

388 
˛õ¡_°©e
 
˛¡
;

390 
	`¥ötf
("iscsi client\n");

392 
iscsi
 = 
	`iscsi_¸óã_c⁄ãxt
("iqn.2002-10.com.ronnie:client");

393 i‡(
iscsi
 =
NULL
) {

394 
	`¥ötf
("FailedÅo create context\n");

395 
	`exô
(10);

398 i‡(
	`iscsi_£t_Æüs
(
iscsi
, "ronnie") != 0) {

399 
	`¥ötf
("FailedÅoáddálias\n");

400 
	`exô
(10);

403 
˛¡
.
mesßge
 = "Hello iSCSI";

404 
˛¡
.
has_discovîed_èrgë
 = 0;

405 i‡(
	`iscsi_c⁄√˘_async
(
iscsi
, 
TARGET
, 
discovîyc⁄√˘_cb
, &
˛¡
) != 0) {

406 
	`¥ötf
("iscsi_connect failed\n");

407 
	`exô
(10);

411 
pfd
.
fd
 = 
	`iscsi_gë_fd
(
iscsi
);

412 
pfd
.
evíts
 = 
	`iscsi_which_evíts
(
iscsi
);

414 i‡(
	`pﬁl
(&
pfd
, 1, -1) < 0) {

415 
	`¥ötf
("Poll failed");

416 
	`exô
(10);

418 i‡(
	`iscsi_£rvi˚
(
iscsi
, 
pfd
.
ªvíts
) < 0) {

419 
	`¥ötf
("iscsi_service failed\n");

424 
	`¥ötf
("STOP\n");

425 
	`exô
(10);

427 
	`¥ötf
("ok\n");

429 
	}
}

	@ccan/ccan/jmap/jmap.c

2 
	~<cˇn/jm≠/jm≠.h
>

3 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

4 
	~<°dlib.h
>

5 
	~<°rög.h
>

7 
jm≠
 *
	$jm≠_√w_
(
size_t
 
size
)

9 
jm≠
 *
m≠
;

12 
	`BUILD_ASSERT
((
W‹d_t
) == ());

14 
	`BUILD_ASSERT
((
W‹d_t
) >= (*));

16 
	`as£π
(
size
 >(*
m≠
));

17 
m≠
 = 
	`mÆloc
(
size
);

18 i‡(
m≠
) {

19 
m≠
->
judy
 = 
NULL
;

20 
	`mem£t
(&
m≠
->
îr
, 0, (map->err));

21 
m≠
->
îr°r
 = 
NULL
;

22 
m≠
->
num_ac˚s£s
 = 0;

23 
m≠
->
acc_vÆue
 = 
NULL
;

24 
m≠
->
acc_ödex
 = 0;

25 
m≠
->
fun˙ame
 = 
NULL
;

27  
m≠
;

28 
	}
}

30 c⁄° *
	$jm≠_îr‹_°r_
(
jm≠
 *
m≠
)

32 *
°r
;

33 
	`‰ì
((*)
m≠
->
îr°r
);

34 
m≠
->
îr°r
 = 
°r
 = 
	`mÆloc
(100);

35 i‡(!
m≠
->
îr°r
)

38 
	`•rötf
(
°r
,

40 
	`JU_ERRNO
(&
m≠
->
îr
), 
	`JU_ERRID
(&map->err));

41  
°r
;

42 
	}
}

44 
	$jm≠_‰ì_
(c⁄° 
jm≠
 *
m≠
)

46 
	`‰ì
((*)
m≠
->
îr°r
);

47 
	`JudyLFªeAºay
((
PPvoid_t
)&
m≠
->
judy
, 
PJE0
);

48 
	`‰ì
((*)
m≠
);

49 
	}
}

	@ccan/ccan/jmap/jmap.h

2 #i‚de‡
CCAN_JMAP_H


3 
	#CCAN_JMAP_H


	)

4 
	~<cˇn/compûî/compûî.h
>

5 
	~<cˇn/tc⁄/tc⁄.h
>

6 
	~<°ddef.h
>

7 
	~<Judy.h
>

8 
	~<°dboﬁ.h
>

9 
	~<°rög.h
>

10 
	~<as£π.h
>

11 #ifde‡
CCAN_JMAP_DEBUG


12 
	~<°dio.h
>

21 
	sjm≠
 {

22 
Pvoid_t
 
	mjudy
;

23 
JEº‹_t
 
	mîr
;

24 c⁄° *
	mîr°r
;

26 
	mnum_ac˚s£s
;

28 *
	macc_vÆue
;

29 
	macc_ödex
;

30 c⁄° *
	mfun˙ame
;

43 
	#JMAP_MEMBERS
(
ôy≥
, 
˘y≥
) \

44 
jm≠
 
øw
; \

45 
	`TCON
(
ôy≥
 
iˇ«ry
; 
˘y≥
 
cˇ«ry
)

	)

62 
	#jm≠_√w
(
ty≥
Ë(—y≥ *)
	`jm≠_√w_
(—y≥)))

	)

71 
	#jm≠_‰ì
(
m≠
Ë
	`jm≠_‰ì_
(&(m≠)->
øw
)

	)

91 
	#jm≠_îr‹
(
m≠
Ë
	`jm≠_îr‹_
(&(m≠)->
øw
)

	)

102 
	#jm≠_øwi
(
m≠
, 
ex¥
Ë(&
	`tc⁄_check
((m≠), 
iˇ«ry
, (ex¥))->
øw
)

	)

113 
	#jm≠_øwc
(
m≠
, 
ex¥
Ë(&
	`tc⁄_check
((m≠), 
cˇ«ry
, (ex¥))->
øw
)

	)

125 
	#jm≠_øwci
(
m≠
, 
õx¥
, 
˚x¥
) \

126 (&
	`tc⁄_check
—c⁄_check((
m≠
), 
cˇ«ry
, (
˚x¥
)), 
iˇ«ry
, (
õx¥
))->
øw
)

	)

141 
	#jm≠_add
(
m≠
, 
ödex
, 
vÆue
) \

142 
	`jm≠_add_
(
	`jm≠_øwci
((
m≠
), (
ödex
), (
vÆue
)), \

143 ()(
ödex
), ()
vÆue
)

	)

158 
	#jm≠_£t
(
m≠
, 
ödex
, 
vÆue
) \

159 
	`jm≠_£t_
(
	`jm≠_øwci
((
m≠
), (
ödex
), (
vÆue
)), \

160 ()(
ödex
), ()
vÆue
)

	)

171 
	#jm≠_dñ
(
m≠
, 
ödex
) \

172 
	`jm≠_dñ_
(
	`jm≠_øwi
((
m≠
), (
ödex
)), ()(ödex))

	)

183 
	#jm≠_ã°
(
m≠
, 
ödex
) \

184 
	`jm≠_ã°_
(
	`jm≠_øwi
((
m≠
), (
ödex
)), ()(ödex))

	)

201 
	#jm≠_gë
(
m≠
, 
ödex
) \

202 
	`tc⁄_ˇ°
((
m≠
), 
cˇ«ry
, \

203 
	`jm≠_gë_
(
	`jm≠_øwi
((
m≠
), (
ödex
)), ()(ödex)))

	)

212 
	#jm≠_cou¡
(
m≠
) \

213 
	`jm≠_p›cou¡_
(&(
m≠
)->
øw
, 0, -1UL)

	)

224 
	#jm≠_p›cou¡
(
m≠
, 
°¨t
, 
íd_ö˛
) \

225 
	`jm≠_p›cou¡_
(
	`jm≠_øwi
((
m≠
), (
°¨t
Ë? (°¨tË: (
íd_ö˛
)), \

226 ()(
°¨t
), ()(
íd_ö˛
))

	)

251 
	#jm≠_¡h
(
m≠
, 
n
, 
övÆid
) \

252 
	`tc⁄_ˇ°
((
m≠
), 
iˇ«ry
, \

253 
	`jm≠_¡h_
(
	`jm≠_øwi
((
m≠
), (
övÆid
)), \

254 (
n
), ()(
övÆid
)))

	)

272 
	#jm≠_fú°
(
m≠
) \

273 
	`tc⁄_ˇ°
((
m≠
), 
iˇ«ry
, 
	`jm≠_fú°_
(&(m≠)->
øw
))

	)

284 
	#jm≠_√xt
(
m≠
, 
¥ev
) \

285 
	`tc⁄_ˇ°
((
m≠
), 
iˇ«ry
, 
	`jm≠_√xt_
(
	`jm≠_øwi
((m≠), (
¥ev
)), \

286 ()(
¥ev
)))

	)

303 
	#jm≠_œ°
(
m≠
) \

304 
	`tc⁄_ˇ°
((
m≠
), 
iˇ«ry
, 
	`jm≠_œ°_
(&(m≠)->
øw
))

	)

317 
	#jm≠_¥ev
(
m≠
, 
¥ev
) \

318 
	`tc⁄_ˇ°
((
m≠
), 
iˇ«ry
, 
	`jm≠_¥ev_
(
	`jm≠_øwi
((m≠), (
¥ev
)), (¥ev)))

	)

348 
	#jm≠_gëvÆ
(
m≠
, 
ödex
) \

349 
	`tc⁄_ˇ°_±r
((
m≠
), 
cˇ«ry
, \

350 
	`jm≠_gëvÆ_
(
	`jm≠_øwi
((
m≠
), (
ödex
)), \

351 ()(
ödex
)))

	)

368 
	#jm≠_putvÆ
(
m≠
, 
p
) \

369 
	`jm≠_putvÆ_
(
	`jm≠_øwc
((
m≠
), **(
p
)), (p))

	)

395 
	#jm≠_¡hvÆ
(
m≠
, 
n
, 
ödex
) \

396 
	`tc⁄_ˇ°_±r
((
m≠
), 
cˇ«ry
, \

397 
	`jm≠_¡hvÆ_
(
	`jm≠_øwi
((
m≠
), *(
ödex
)), (
n
), (ödex)))

	)

418 
	#jm≠_fú°vÆ
(
m≠
, 
ödex
) \

419 
	`tc⁄_ˇ°_±r
((
m≠
), 
cˇ«ry
, \

420 
	`jm≠_fú°vÆ_
(
	`jm≠_øwi
((
m≠
), *(
ödex
)), \

421 (*)(
ödex
)))

	)

434 
	#jm≠_√xtvÆ
(
m≠
, 
ödex
) \

435 
	`tc⁄_ˇ°_±r
((
m≠
), 
cˇ«ry
, \

436 
	`jm≠_√xtvÆ_
(
	`jm≠_øwi
((
m≠
), *(
ödex
)), \

437 (*)(
ödex
)))

	)

448 
	#jm≠_œ°vÆ
(
m≠
, 
ödex
) \

449 
	`tc⁄_ˇ°_±r
((
m≠
), 
cˇ«ry
, \

450 
	`jm≠_œ°vÆ_
(
	`jm≠_øwi
((
m≠
), *(
ödex
)), \

451 (*)(
ödex
)))

	)

465 
	#jm≠_¥evvÆ
(
m≠
, 
ödex
) \

466 
	`tc⁄_ˇ°_±r
((
m≠
), 
cˇ«ry
, \

467 
	`jm≠_¥evvÆ_
(
	`jm≠_øwi
((
m≠
), *(
ödex
)), \

468 (*)(
ödex
)))

	)

473 
ölöe
 
	$jm≠_debug_add_ac˚ss
(c⁄° 
jm≠
 *
m≠
,

474 
ödex
,

475 *
vÆ
,

476 c⁄° *
fun˙ame
)

478 #ifde‡
CCAN_JMAP_DEBUG


479 i‡(!
m≠
->
acc_vÆue
) {

480 ((
jm≠
 *)
m≠
)->
acc_vÆue
 = 
vÆ
;

481 ((
jm≠
 *)
m≠
)->
acc_ödex
 = 
ödex
;

482 ((
jm≠
 *)
m≠
)->
fun˙ame
 = funcname;

485 i‡(
vÆ
)

486 
	`as£π
(++((
jm≠
 *)
m≠
)->
num_ac˚s£s
);

487 
	}
}

489 
ölöe
 
	$jm≠_debug_dñ_ac˚ss
(
jm≠
 *
m≠
, **
vÆ
)

491 
	`as£π
(--
m≠
->
num_ac˚s£s
 >= 0);

492 #ifde‡
CCAN_JMAP_DEBUG


493 i‡(
m≠
->
acc_vÆue
 =*
vÆ
)

494 
m≠
->
acc_vÆue
 = 
NULL
;

497 
	`as£π
(
	`mem£t
(
vÆ
, 0x42, (*)));

498 
	}
}

500 
ölöe
 
	$jm≠_debug_ac˚ss
(
jm≠
 *
m≠
)

502 #ifde‡
CCAN_JMAP_DEBUG


503 i‡(
m≠
->
num_ac˚s£s
 && m≠->
acc_vÆue
)

504 
	`Ârötf
(
°dîr
,

506 
m≠
->
acc_ödex
, *m≠->
acc_vÆue
, map->acc_value,

507 
m≠
->
fun˙ame
);

509 
	`as£π
(!
m≠
->
num_ac˚s£s
);

510 
	}
}

513 
jm≠
 *
jm≠_√w_
(
size_t
 
size
);

514 
jm≠_‰ì_
(c⁄° 
jm≠
 *
m≠
);

515 c⁄° *
COLD
 
jm≠_îr‹_°r_
(
jm≠
 *
m≠
);

516 
ölöe
 c⁄° *
	$jm≠_îr‹_
(
jm≠
 *
m≠
)

518 i‡(
	`JU_ERRNO
(&
m≠
->
îr
Ë<
JU_ERRNO_NFMAX
)

519  
NULL
;

520  
	`jm≠_îr‹_°r_
(
m≠
);

521 
	}
}

522 
ölöe
 
boﬁ
 
	$jm≠_add_
(
jm≠
 *
m≠
,

523 
ödex
, 
vÆue
)

525 *
vÆ
;

526 
	`jm≠_debug_ac˚ss
(
m≠
);

527 
vÆ
 = (*)
	`JudyLIns
(&
m≠
->
judy
, 
ödex
, &m≠->
îr
);

528 i‡(
vÆ
 =
PJERR
)

529  
Ál£
;

530 *
vÆ
 = 
vÆue
;

531  
åue
;

532 
	}
}

533 
ölöe
 
boﬁ
 
	$jm≠_£t_
(c⁄° 
jm≠
 *
m≠
,

534 
ödex
, 
vÆue
)

536 *
vÆ
;

537 
vÆ
 = (*)
	`JudyLGë
(
m≠
->
judy
, 
ödex
,

538 (
JEº‹_t
 *)&
m≠
->
îr
);

539 i‡(
vÆ
 && vÆ !
PJERR
) {

540 *
vÆ
 = 
vÆue
;

541  
åue
;

543  
Ál£
;

544 
	}
}

545 
ölöe
 
boﬁ
 
	$jm≠_dñ_
(
jm≠
 *
m≠
, 
ödex
)

547 
	`jm≠_debug_ac˚ss
(
m≠
);

548  
	`JudyLDñ
(&
m≠
->
judy
, 
ödex
, &m≠->
îr
) == 1;

549 
	}
}

550 
ölöe
 
boﬁ
 
	$jm≠_ã°_
(c⁄° 
jm≠
 *
m≠
, 
ödex
)

552  
	`JudyLGë
(
m≠
->
judy
, 
ödex
, (
JEº‹_t
 *)&m≠->
îr
Ë!
NULL
;

553 
	}
}

554 
ölöe
 
	$jm≠_gë_
(c⁄° 
jm≠
 *
m≠
,

555 
ödex
)

557 *
vÆ
;

558 
vÆ
 = (*)
	`JudyLGë
(
m≠
->
judy
, 
ödex
,

559 (
JEº‹_t
 *)&
m≠
->
îr
);

560 i‡(!
vÆ
 || vÆ =
PJERR
)

562  *
vÆ
;

563 
	}
}

564 
ölöe
 
	$jm≠_p›cou¡_
(c⁄° 
jm≠
 *
m≠
,

565 
°¨t
,

566 
íd_ö˛
)

568  
	`JudyLCou¡
(
m≠
->
judy
, 
°¨t
, 
íd_ö˛
, (
JEº‹_t
 *)&m≠->
îr
);

569 
	}
}

570 
ölöe
 
	$jm≠_¡h_
(c⁄° 
jm≠
 *
m≠
,

571 
n
, 
övÆid
)

573 
ödex
;

574 i‡(!
	`JudyLByCou¡
(
m≠
->
judy
, 
n
+1, &
ödex
, (
JEº‹_t
 *)&m≠->
îr
))

575 
ödex
 = 
övÆid
;

576  
ödex
;

577 
	}
}

578 
ölöe
 
	$jm≠_fú°_
(c⁄° 
jm≠
 *
m≠
)

580 
ödex
 = 0;

581 i‡(!
	`JudyLFú°
(
m≠
->
judy
, &
ödex
, (
JEº‹_t
 *)&m≠->
îr
))

582 
ödex
 = 0;

584 
	`as£π
(
ödex
 != 0);

585  
ödex
;

586 
	}
}

587 
ölöe
 
	$jm≠_√xt_
(c⁄° 
jm≠
 *
m≠
,

588 
¥ev
)

590 i‡(!
	`JudyLNext
(
m≠
->
judy
, &
¥ev
, (
JEº‹_t
 *)&m≠->
îr
))

591 
¥ev
 = 0;

593 
	`as£π
(
¥ev
 != 0);

594  
¥ev
;

595 
	}
}

596 
ölöe
 
	$jm≠_œ°_
(c⁄° 
jm≠
 *
m≠
)

598 
ödex
 = -1;

599 i‡(!
	`JudyLLa°
(
m≠
->
judy
, &
ödex
, (
JEº‹_t
 *)&m≠->
îr
))

600 
ödex
 = 0;

602 
	`as£π
(
ödex
 != 0);

603  
ödex
;

604 
	}
}

605 
ölöe
 
	$jm≠_¥ev_
(c⁄° 
jm≠
 *
m≠
,

606 
¥ev
)

608 i‡(!
	`JudyLPªv
(
m≠
->
judy
, &
¥ev
, (
JEº‹_t
 *)&m≠->
îr
))

609 
¥ev
 = 0;

611 
	`as£π
(
¥ev
 != 0);

612  
¥ev
;

613 
	}
}

614 
ölöe
 *
	$jm≠_gëvÆ_
(
jm≠
 *
m≠
, 
ödex
)

616 *
vÆ
;

617 
vÆ
 = (*)
	`JudyLGë
(
m≠
->
judy
, 
ödex
,

618 (
JEº‹_t
 *)&
m≠
->
îr
);

619 
	`jm≠_debug_add_ac˚ss
(
m≠
, 
ödex
, 
vÆ
, "jmap_getval");

620  
vÆ
;

621 
	}
}

622 
ölöe
 
	$jm≠_putvÆ_
(
jm≠
 *
m≠
, *
p
)

624 
	`jm≠_debug_dñ_ac˚ss
(
m≠
, 
p
);

625 
	}
}

626 
ölöe
 *
	$jm≠_¡hvÆ_
(c⁄° 
jm≠
 *
m≠
, 
n
,

627 *
ödex
)

629 *
vÆ
;

630 
vÆ
 = (*)
	`JudyLByCou¡
(
m≠
->
judy
, 
n
+1, 
ödex
,

631 (
JEº‹_t
 *)&
m≠
->
îr
);

632 
	`jm≠_debug_add_ac˚ss
(
m≠
, *
ödex
, 
vÆ
, "jmap_nthval");

633  
vÆ
;

634 
	}
}

635 
ölöe
 *
	$jm≠_fú°vÆ_
(c⁄° 
jm≠
 *
m≠
,

636 *
ödex
)

638 *
vÆ
;

639 *
ödex
 = 0;

640 
vÆ
 = (*)
	`JudyLFú°
(
m≠
->
judy
, 
ödex
,

641 (
JEº‹_t
 *)&
m≠
->
îr
);

642 
	`jm≠_debug_add_ac˚ss
(
m≠
, *
ödex
, 
vÆ
, "jmap_firstval");

643  
vÆ
;

644 
	}
}

645 
ölöe
 *
	$jm≠_√xtvÆ_
(c⁄° 
jm≠
 *
m≠
,

646 *
ödex
)

648 *
vÆ
;

649 
vÆ
 = (*)
	`JudyLNext
(
m≠
->
judy
, 
ödex
,

650 (
JEº‹_t
 *)&
m≠
->
îr
);

651 
	`jm≠_debug_add_ac˚ss
(
m≠
, *
ödex
, 
vÆ
, "jmap_nextval");

652  
vÆ
;

653 
	}
}

654 
ölöe
 *
	$jm≠_œ°vÆ_
(c⁄° 
jm≠
 *
m≠
,

655 *
ödex
)

657 *
vÆ
;

658 *
ödex
 = -1;

659 
vÆ
 = (*)
	`JudyLLa°
(
m≠
->
judy
, 
ödex
,

660 (
JEº‹_t
 *)&
m≠
->
îr
);

661 
	`jm≠_debug_add_ac˚ss
(
m≠
, *
ödex
, 
vÆ
, "jmap_lastval");

662  
vÆ
;

663 
	}
}

664 
ölöe
 *
	$jm≠_¥evvÆ_
(c⁄° 
jm≠
 *
m≠
,

665 *
ödex
)

667 *
vÆ
;

668 
vÆ
 = (*)
	`JudyLPªv
(
m≠
->
judy
, 
ödex
,

669 (
JEº‹_t
 *)&
m≠
->
îr
);

670 
	`jm≠_debug_add_ac˚ss
(
m≠
, *
ödex
, 
vÆ
, "jmap_prevval");

671  
vÆ
;

672 
	}
}

	@ccan/ccan/jmap/test/run-access-count.c

2 
	~<cˇn/jm≠/jm≠.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/waô.h
>

6 
	~<uni°d.h
>

8 
	sm≠
 {

9 
JMAP_MEMBERS
(, );

12 
	$maö
(
¨gc
, *
¨gv
[])

14 
m≠
 *map;

15 *
vÆue
;

16 
°©us
;

18 
	`∂™_ã°s
(9);

20 
m≠
 = 
	`jm≠_√w
(map);

21 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

22 
	`ok1
(
	`jm≠_add
(
m≠
, 0, 1));

25 
vÆue
 = 
	`jm≠_gëvÆ
(
m≠
, 0);

26 
	`ok1
(
vÆue
);

27 i‡(!
	`f‹k
()) {

28 
	`jm≠_add
(
m≠
, 1, 2);

29 
	`exô
(0);

31 
	`waô
(&
°©us
);

32 
	`ok1
(
	`WIFSIGNALED
(
°©us
Ë&& 
	`WTERMSIG
(°©usË=
SIGABRT
);

34 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

37 
vÆue
 = 
	`jm≠_gëvÆ
(
m≠
, 0);

38 
	`ok1
(
vÆue
);

39 i‡(!
	`f‹k
()) {

40 
	`jm≠_dñ
(
m≠
, 0);

41 
	`exô
(0);

43 
	`waô
(&
°©us
);

44 
	`ok1
(
	`WIFSIGNALED
(
°©us
Ë&& 
	`WTERMSIG
(°©usË=
SIGABRT
);

46 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

48 
	`ok1
(
	`jm≠_add
(
m≠
, 0, 1));

51 
vÆue
 = 
	`jm≠_gëvÆ
(
m≠
, 0);

52 
	`ok1
(
vÆue
);

53 i‡(!
	`f‹k
()) {

54 
	`jm≠_£t
(
m≠
, 0, 2);

55 
	`exô
(0);

57 
	`waô
(&
°©us
);

58 
	`ok1
(
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(status) == 0);

60 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

63 
	`jm≠_‰ì
(
m≠
);

65  
	`exô_°©us
();

66 
	}
}

	@ccan/ccan/jmap/test/run-ptridx-int.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/jm≠/jm≠.c
>

4 
	gidx
;

6 
	sm≠
 {

7 
JMAP_MEMBERS
(
idx
 *, );

10 
	#NUM
 100

	)

12 
	$cmp_±r
(c⁄° *
a
, c⁄° *
b
)

14  *(**)
a
 - *(**)
b
;

15 
	}
}

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
m≠
 *map;

20 
idx
 *idx[
NUM
+1], *
ödex
;

21 
i
;

22 *
öç
;

24 
	`∂™_ã°s
(25 + 
NUM
*2 + 6);

25 
i
 = 0; i < 
NUM
+1; i++)

26 
idx
[
i
] = 
	`mÆloc
(20);

28 
	`qs‹t
(
idx
, 
NUM
, (idx[0]), 
cmp_±r
);

30 
m≠
 = 
	`jm≠_√w
(map);

31 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

33 
	`ok1
(
	`jm≠_ã°
(
m≠
, 
idx
[
NUM
]Ë=
Ál£
);

34 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[
NUM
]) == 0);

35 
	`ok1
(
	`jm≠_cou¡
(
m≠
) == 0);

36 
	`ok1
(
	`jm≠_fú°
(
m≠
) == 0);

37 
	`ok1
(
	`jm≠_dñ
(
m≠
, 
idx
[0]Ë=
Ál£
);

40 
	`ok1
(
	`jm≠_£t
(
m≠
, 
idx
[0], 0Ë=
Ál£
);

41 
	`ok1
(
	`jm≠_add
(
m≠
, 
idx
[0], 1Ë=
åue
);

42 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[0]) == 1);

43 
	`ok1
(
	`jm≠_£t
(
m≠
, 
idx
[0], -1Ë=
åue
);

44 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[0]) == -1);

46 
	`ok1
(
	`jm≠_ã°
(
m≠
, 
idx
[0]Ë=
åue
);

47 
	`ok1
(
	`jm≠_cou¡
(
m≠
) == 1);

48 
	`ok1
(
	`jm≠_fú°
(
m≠
Ë=
idx
[0]);

49 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
idx
[0]Ë=
NULL
);

51 
	`ok1
(
	`jm≠_dñ
(
m≠
, 
idx
[0]Ë=
åue
);

52 
	`ok1
(
	`jm≠_ã°
(
m≠
, 
idx
[0]Ë=
Ál£
);

53 
	`ok1
(
	`jm≠_cou¡
(
m≠
) == 0);

55 
i
 = 0; i < 
NUM
; i++)

56 
	`jm≠_add
(
m≠
, 
idx
[
i
], i+1);

58 
	`ok1
(
	`jm≠_cou¡
(
m≠
Ë=
NUM
);

60 
	`ok1
(
	`jm≠_fú°
(
m≠
Ë=
idx
[0]);

61 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
idx
[0]) == idx[1]);

62 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
idx
[
NUM
-1]Ë=
NULL
);

64 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[0]) == 1);

65 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[
NUM
-1]) == NUM);

66 
	`ok1
(
	`jm≠_gë
(
m≠
, (*)((*)
idx
[
NUM
-1] + 1)) == 0);

69 
i
 = 0; i < 
NUM
; i++) {

70 
öç
 = 
	`jm≠_gëvÆ
(
m≠
, 
idx
[
i
]);

71 
	`ok1
(*
öç
 =
i
+1);

72 *
öç
 = 
NUM
-
i
;

73 
	`jm≠_putvÆ
(
m≠
, &
öç
);

75 
i
 = 0; i < 
NUM
; i++)

76 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[
i
]Ë=
NUM
-i);

78 
öç
 = 
	`jm≠_fú°vÆ
(
m≠
, &
ödex
);

79 
	`ok1
(
ödex
 =
idx
[0]);

80 
	`ok1
(*
öç
 =
NUM
);

81 
	`jm≠_putvÆ
(
m≠
, &
öç
);

83 
öç
 = 
	`jm≠_√xtvÆ
(
m≠
, &
ödex
);

84 
	`ok1
(
ödex
 =
idx
[1]);

85 
	`ok1
(*
öç
 =
NUM
-1);

86 
	`jm≠_putvÆ
(
m≠
, &
öç
);

88 
ödex
 = 
idx
[
NUM
-1];

89 
öç
 = 
	`jm≠_√xtvÆ
(
m≠
, &
ödex
);

90 
	`ok1
(
öç
 =
NULL
);

92 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

93 
	`jm≠_‰ì
(
m≠
);

95 
i
 = 0; i < 
NUM
+1; i++)

96 
	`‰ì
(
idx
[
i
]);

98  
	`exô_°©us
();

99 
	}
}

	@ccan/ccan/jmap/test/run-ptridx-type.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/jm≠/jm≠.c
>

4 
	gfoo
;

5 
	gidx
;

7 
	sjm≠_foo
 {

8 
JMAP_MEMBERS
(
idx
 *, 
foo
 *);

11 
	#NUM
 100

	)

13 
	$cmp_±r
(c⁄° *
a
, c⁄° *
b
)

15  *(**)
a
 - *(**)
b
;

16 
	}
}

18 
	$maö
(
¨gc
, *
¨gv
[])

20 
jm≠_foo
 *
m≠
;

21 
foo
 *foo[
NUM
+1], **
fo›
;

22 
idx
 *idx[
NUM
+1], *
ödex
;

24 
i
;

26 
	`∂™_ã°s
(25 + 
NUM
*2 + 6);

27 
i
 = 0; i < 
NUM
+1; i++)

28 
foo
[
i
] = 
	`mÆloc
(20);

30 
	`qs‹t
(
foo
, 
NUM
, (foo[0]), 
cmp_±r
);

33 
i
 = 0; i < 
NUM
+1; i++)

34 
idx
[
i
] = (*)((*)
foo
[i] + 1);

36 
m≠
 = 
	`jm≠_√w
(
jm≠_foo
);

37 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

39 
	`ok1
(
	`jm≠_ã°
(
m≠
, 
idx
[
NUM
]Ë=
Ál£
);

40 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[
NUM
]Ë=(
foo
 *)
NULL
);

41 
	`ok1
(
	`jm≠_cou¡
(
m≠
) == 0);

42 
	`ok1
(
	`jm≠_fú°
(
m≠
Ë=(
idx
 *)
NULL
);

43 
	`ok1
(
	`jm≠_dñ
(
m≠
, 
idx
[0]Ë=
Ál£
);

46 
	`ok1
(
	`jm≠_£t
(
m≠
, 
idx
[0], 
foo
[0]Ë=
Ál£
);

47 
	`ok1
(
	`jm≠_add
(
m≠
, 
idx
[0], 
foo
[1]Ë=
åue
);

48 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[0]Ë=
foo
[1]);

49 
	`ok1
(
	`jm≠_£t
(
m≠
, 
idx
[0], 
foo
[0]Ë=
åue
);

50 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[0]Ë=
foo
[0]);

52 
	`ok1
(
	`jm≠_ã°
(
m≠
, 
idx
[0]Ë=
åue
);

53 
	`ok1
(
	`jm≠_cou¡
(
m≠
) == 1);

54 
	`ok1
(
	`jm≠_fú°
(
m≠
Ë=
idx
[0]);

55 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
idx
[0]Ë=
NULL
);

57 
	`ok1
(
	`jm≠_dñ
(
m≠
, 
idx
[0]Ë=
åue
);

58 
	`ok1
(
	`jm≠_ã°
(
m≠
, 
idx
[0]Ë=
Ál£
);

59 
	`ok1
(
	`jm≠_cou¡
(
m≠
) == 0);

61 
i
 = 0; i < 
NUM
; i++)

62 
	`jm≠_add
(
m≠
, 
idx
[
i
], 
foo
[i]);

64 
	`ok1
(
	`jm≠_cou¡
(
m≠
Ë=
NUM
);

66 
	`ok1
(
	`jm≠_fú°
(
m≠
Ë=
idx
[0]);

67 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
idx
[0]) == idx[1]);

68 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
idx
[
NUM
-1]Ë=
NULL
);

70 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[0]Ë=
foo
[0]);

71 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[
NUM
-1]Ë=
foo
[NUM-1]);

72 
	`ok1
(
	`jm≠_gë
(
m≠
, (*)((*)
idx
[
NUM
-1] + 1)Ë=
NULL
);

75 
i
 = 0; i < 
NUM
; i++) {

76 
fo›
 = 
	`jm≠_gëvÆ
(
m≠
, 
idx
[
i
]);

77 
	`ok1
(*
fo›
 =
foo
[
i
]);

78 *
fo›
 = 
foo
[
NUM
-1-
i
];

79 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

81 
i
 = 0; i < 
NUM
; i++)

82 
	`ok1
(
	`jm≠_gë
(
m≠
, 
idx
[
i
]Ë=
foo
[
NUM
-1-i]);

84 
fo›
 = 
	`jm≠_fú°vÆ
(
m≠
, &
ödex
);

85 
	`ok1
(
ödex
 =
idx
[0]);

86 
	`ok1
(*
fo›
 =
foo
[
NUM
-1]);

87 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

89 
fo›
 = 
	`jm≠_√xtvÆ
(
m≠
, &
ödex
);

90 
	`ok1
(
ödex
 =
idx
[1]);

91 
	`ok1
(*
fo›
 =
foo
[
NUM
-2]);

92 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

94 
ödex
 = 
idx
[
NUM
-1];

95 
fo›
 = 
	`jm≠_√xtvÆ
(
m≠
, &
ödex
);

96 
	`ok1
(
fo›
 =
NULL
);

98 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

99 
	`jm≠_‰ì
(
m≠
);

101 
i
 = 0; i < 
NUM
+1; i++)

102 
	`‰ì
(
foo
[
i
]);

104  
	`exô_°©us
();

105 
	}
}

	@ccan/ccan/jmap/test/run-uintidx-type.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/jm≠/jm≠.c
>

4 
	gfoo
;

6 
	sjm≠_foo
 {

7 
JMAP_MEMBERS
(, 
foo
 *);

10 
	#NUM
 100

	)

12 
	$maö
(
¨gc
, *
¨gv
[])

14 
jm≠_foo
 *
m≠
;

15 
foo
 *foo[
NUM
], **
fo›
;

16 
i
;

18 
	`∂™_ã°s
(40 + 
NUM
*2 + 19);

19 
i
 = 0; i < 
NUM
; i++)

20 
foo
[
i
] = 
	`mÆloc
(20);

22 
m≠
 = 
	`jm≠_√w
(
jm≠_foo
);

23 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

25 
	`ok1
(
	`jm≠_ã°
(
m≠
, 0Ë=
Ál£
);

26 
	`ok1
(
	`jm≠_gë
(
m≠
, 0Ë=(
foo
 *)
NULL
);

27 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 0, -1) == 0);

28 
	`ok1
(
	`jm≠_fú°
(
m≠
) == 0);

29 
	`ok1
(
	`jm≠_œ°
(
m≠
) == 0);

30 
	`ok1
(
	`jm≠_dñ
(
m≠
, 0Ë=
Ál£
);

33 
	`ok1
(
	`jm≠_£t
(
m≠
, 1, 
foo
[0]Ë=
Ál£
);

34 
	`ok1
(
	`jm≠_add
(
m≠
, 1, 
foo
[1]Ë=
åue
);

35 
	`ok1
(
	`jm≠_gë
(
m≠
, 1Ë=
foo
[1]);

36 
	`ok1
(
	`jm≠_£t
(
m≠
, 1, 
foo
[0]Ë=
åue
);

37 
	`ok1
(
	`jm≠_gë
(
m≠
, 1Ë=
foo
[0]);

39 
	`ok1
(
	`jm≠_ã°
(
m≠
, 1Ë=
åue
);

40 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 0, -1) == 1);

41 
	`ok1
(
	`jm≠_fú°
(
m≠
) == 1);

42 
	`ok1
(
	`jm≠_œ°
(
m≠
) == 1);

43 
	`ok1
(
	`jm≠_√xt
(
m≠
, 0) == 1);

44 
	`ok1
(
	`jm≠_√xt
(
m≠
, 1) == 0);

45 
	`ok1
(
	`jm≠_¥ev
(
m≠
, 2) == 1);

46 
	`ok1
(
	`jm≠_¥ev
(
m≠
, 1) == 0);

48 
	`ok1
(
	`jm≠_dñ
(
m≠
, 1Ë=
åue
);

49 
	`ok1
(
	`jm≠_ã°
(
m≠
, 1Ë=
Ál£
);

50 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 0, -1) == 0);

52 
i
 = 0; i < 
NUM
; i++)

53 
	`jm≠_add
(
m≠
, 
i
+1, 
foo
[i]);

55 
	`ok1
(
	`jm≠_cou¡
(
m≠
Ë=
NUM
);

56 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 0, -1Ë=
NUM
);

57 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 1, 
NUM
) == NUM);

58 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 1, 
NUM
/2) == NUM/2);

59 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 
NUM
/2+1, NUM) == NUM - NUM/2);

61 
	`ok1
(
	`jm≠_¡h
(
m≠
, 0, -1) == 1);

62 
	`ok1
(
	`jm≠_¡h
(
m≠
, 
NUM
-1, -1) == NUM);

63 
	`ok1
(
	`jm≠_¡h
(
m≠
, 
NUM
, -1Ë=(
size_t
)-1);

64 
	`ok1
(
	`jm≠_fú°
(
m≠
) == 1);

65 
	`ok1
(
	`jm≠_œ°
(
m≠
Ë=
NUM
);

66 
	`ok1
(
	`jm≠_√xt
(
m≠
, 1) == 2);

67 
	`ok1
(
	`jm≠_√xt
(
m≠
, 
NUM
) == 0);

68 
	`ok1
(
	`jm≠_¥ev
(
m≠
, 2) == 1);

69 
	`ok1
(
	`jm≠_¥ev
(
m≠
, 1) == 0);

71 
	`ok1
(
	`jm≠_gë
(
m≠
, 1Ë=
foo
[0]);

72 
	`ok1
(
	`jm≠_gë
(
m≠
, 
NUM
Ë=
foo
[NUM-1]);

73 
	`ok1
(
	`jm≠_gë
(
m≠
, 
NUM
+1Ë=
NULL
);

76 
i
 = 0; i < 
NUM
; i++) {

77 
fo›
 = 
	`jm≠_gëvÆ
(
m≠
, 
i
+1);

78 
	`ok1
(*
fo›
 =
foo
[
i
]);

79 *
fo›
 = 
foo
[
NUM
-1-
i
];

80 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

82 
i
 = 0; i < 
NUM
; i++)

83 
	`ok1
(
	`jm≠_gë
(
m≠
, 
i
+1Ë=
foo
[
NUM
-1-i]);

85 
fo›
 = 
	`jm≠_¡hvÆ
(
m≠
, 0, &
i
);

86 
	`ok1
(
i
 == 1);

87 
	`ok1
(*
fo›
 =
foo
[
NUM
-1]);

88 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

89 
fo›
 = 
	`jm≠_¡hvÆ
(
m≠
, 
NUM
-1, &
i
);

90 
	`ok1
(
i
 =
NUM
);

91 
	`ok1
(*
fo›
 =
foo
[0]);

92 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

94 
fo›
 = 
	`jm≠_fú°vÆ
(
m≠
, &
i
);

95 
	`ok1
(
i
 == 1);

96 
	`ok1
(*
fo›
 =
foo
[
NUM
-1]);

97 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

99 
fo›
 = 
	`jm≠_√xtvÆ
(
m≠
, &
i
);

100 
	`ok1
(
i
 == 2);

101 
	`ok1
(*
fo›
 =
foo
[
NUM
-2]);

102 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

104 
fo›
 = 
	`jm≠_¥evvÆ
(
m≠
, &
i
);

105 
	`ok1
(
i
 == 1);

106 
	`ok1
(*
fo›
 =
foo
[
NUM
-1]);

107 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

109 
fo›
 = 
	`jm≠_¥evvÆ
(
m≠
, &
i
);

110 
	`ok1
(
fo›
 =
NULL
);

112 
fo›
 = 
	`jm≠_œ°vÆ
(
m≠
, &
i
);

113 
	`ok1
(
i
 =
NUM
);

114 
	`ok1
(*
fo›
 =
foo
[0]);

115 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

117 
fo›
 = 
	`jm≠_¥evvÆ
(
m≠
, &
i
);

118 
	`ok1
(
i
 =
NUM
-1);

119 
	`ok1
(*
fo›
 =
foo
[1]);

120 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

122 
fo›
 = 
	`jm≠_√xtvÆ
(
m≠
, &
i
);

123 
	`ok1
(
i
 =
NUM
);

124 
	`ok1
(*
fo›
 =
foo
[0]);

125 
	`jm≠_putvÆ
(
m≠
, &
fo›
);

127 
fo›
 = 
	`jm≠_√xtvÆ
(
m≠
, &
i
);

128 
	`ok1
(
fo›
 =
NULL
);

130 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

131 
	`jm≠_‰ì
(
m≠
);

133 
i
 = 0; i < 
NUM
; i++)

134 
	`‰ì
(
foo
[
i
]);

136  
	`exô_°©us
();

137 
	}
}

	@ccan/ccan/jmap/test/run.c

1 
	~<cˇn/èp/èp.h
>

2 
	#CCAN_JMAP_DEBUG


	)

3 
	~<cˇn/jm≠/jm≠.c
>

5 
	sm≠
 {

6 
JMAP_MEMBERS
(, );

9 
	$maö
(
¨gc
, *
¨gv
[])

11 
m≠
 *map;

12 
i
, *
vÆue
;

13 c⁄° *
îr
;

15 
	`∂™_ã°s
(51);

17 
m≠
 = 
	`jm≠_√w
(map);

18 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

20 
	`ok1
(
	`jm≠_ã°
(
m≠
, 0Ë=
Ál£
);

21 
	`ok1
(
	`jm≠_dñ
(
m≠
, 0Ë=
Ál£
);

22 
	`ok1
(
	`jm≠_add
(
m≠
, 0, 1Ë=
åue
);

23 
	`ok1
(
	`jm≠_ã°
(
m≠
, 0Ë=
åue
);

24 
	`ok1
(
	`jm≠_gë
(
m≠
, 0) == 1);

25 
	`ok1
(
	`jm≠_gë
(
m≠
, 1) == 0);

26 
	`ok1
(
	`jm≠_dñ
(
m≠
, 0Ë=
åue
);

28 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 0, -1) == 0);

29 
	`ok1
(
	`jm≠_¡h
(
m≠
, 0, 0) == 0);

30 
	`ok1
(
	`jm≠_¡h
(
m≠
, 0, -1Ë=(
size_t
)-1);

31 
	`ok1
(
	`jm≠_fú°
(
m≠
) == 0);

32 
	`ok1
(
	`jm≠_œ°
(
m≠
) == 0);

34 
	`ok1
(
	`jm≠_gëvÆ
(
m≠
, 0Ë=
NULL
);

37 
i
 = 0; i < 1000000; i++)

38 
	`jm≠_add
(
m≠
, (
i
 << 4) + 1, (i << 5) + 1);

41 
	`düg
("%u byã†mem‹y u£d\n", ()
	`JudyLMemU£d
(
m≠
->
øw
.
judy
));

43 
	`ok1
(
	`jm≠_gë
(
m≠
, 1) == 1);

44 
	`ok1
(
	`jm≠_gë
(
m≠
, (999999 << 4) + 1) == (999999 << 5) + 1);

45 
	`ok1
(
	`jm≠_p›cou¡
(
m≠
, 0, -1) == 1000000);

46 
	`ok1
(
	`jm≠_¡h
(
m≠
, 0, -1) == 1);

47 
	`ok1
(
	`jm≠_¡h
(
m≠
, 999999, -1) == (999999 << 4) + 1);

48 
	`ok1
(
	`jm≠_¡h
(
m≠
, 1000000, -1Ë=(
size_t
)-1);

49 
	`ok1
(
	`jm≠_fú°
(
m≠
) == 1);

50 
	`ok1
(
	`jm≠_œ°
(
m≠
) == (999999 << 4) + 1);

51 
	`ok1
(
	`jm≠_√xt
(
m≠
, 1) == (1 << 4) + 1);

52 
	`ok1
(
	`jm≠_√xt
(
m≠
, (999999 << 4) + 1) == 0);

53 
	`ok1
(
	`jm≠_¥ev
(
m≠
, 2) == 1);

54 
	`ok1
(
	`jm≠_¥ev
(
m≠
, 0) == 0);

55 
	`ok1
(
	`jm≠_îr‹
(
m≠
Ë=
NULL
);

58 
vÆue
 = 
	`jm≠_gëvÆ
(
m≠
, 1);

59 
	`ok1
(
vÆue
 && *value == 1);

60 *
vÆue
 = 2;

61 
	`ok1
(
	`jm≠_gë
(
m≠
, 1) == 2);

62 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

63 
	`ok1
(
	`jm≠_gë
(
m≠
, 1) == 2);

64 
	`ok1
(
	`jm≠_£t
(
m≠
, 1, 1));

66 
vÆue
 = 
	`jm≠_gëvÆ
(
m≠
, (999999 << 4) + 1);

67 
	`ok1
(
vÆue
 && *value == (999999 << 5) + 1);

68 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

70 
vÆue
 = 
	`jm≠_¡hvÆ
(
m≠
, 0, &
i
);

71 
	`ok1
(
i
 == 1);

72 
	`ok1
(
vÆue
 && *value == 1);

73 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

74 
vÆue
 = 
	`jm≠_¡hvÆ
(
m≠
, 999999, &
i
);

75 
	`ok1
(
i
 == (999999 << 4) + 1);

76 
	`ok1
(
vÆue
 && *value == (999999 << 5) + 1);

77 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

78 
	`ok1
(
	`jm≠_¡hvÆ
(
m≠
, 1000000, &
i
Ë=
NULL
);

80 
vÆue
 = 
	`jm≠_fú°vÆ
(
m≠
, &
i
);

81 
	`ok1
(
i
 == 1);

82 
	`ok1
(
vÆue
 && *value == 1);

83 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

84 
	`ok1
(
	`jm≠_¥evvÆ
(
m≠
, &
i
Ë=
NULL
);

86 
i
 = 1;

87 
vÆue
 = 
	`jm≠_√xtvÆ
(
m≠
, &
i
);

88 
	`ok1
(
i
 == (1 << 4) + 1);

89 
	`ok1
(
vÆue
 && *value == (1 << 5) + 1);

90 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

92 
vÆue
 = 
	`jm≠_œ°vÆ
(
m≠
, &
i
);

93 
	`ok1
(
i
 == (999999 << 4) + 1);

94 
	`ok1
(
vÆue
 && *value == (999999 << 5) + 1);

95 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

96 
	`ok1
(
	`jm≠_√xtvÆ
(
m≠
, &
i
Ë=
NULL
);

98 
i
 = (999999 << 4) + 1;

99 
vÆue
 = 
	`jm≠_¥evvÆ
(
m≠
, &
i
);

100 
	`ok1
(
i
 == (999998 << 4) + 1);

101 
	`ok1
(
vÆue
 && *value == (999998 << 5) + 1);

102 
	`jm≠_putvÆ
(
m≠
, &
vÆue
);

105 
	`JU_ERRNO
(&
m≠
->
øw
.
îr
) = 100;

106 
	`JU_ERRID
(&
m≠
->
øw
.
îr
) = 991;

107 
îr
 = 
	`jm≠_îr‹
(
m≠
);

108 
	`ok1
(
îr
);

109 
	`ok1
(
	`°r°r
(
îr
, "100"));

110 
	`ok1
(
	`°r°r
(
îr
, "991"));

111 
	`ok1
(
îr
 =
m≠
->
øw
.
îr°r
);

112 
	`jm≠_‰ì
(
m≠
);

114  
	`exô_°©us
();

115 
	}
}

	@ccan/ccan/jmap/tools/speed.c

2 
	~<cˇn/jm≠/jm≠_ty≥.h
>

3 
	~<cˇn/jm≠/jm≠.c
>

4 
	~<°dio.h
>

5 
	~<°dlib.h
>

6 
	~<time.h
>

7 
	~<uni°d.h
>

8 
	~<sys/time.h
>

10 
	sobje˘
 {

12 
obje˘
 *
	m£lf
;

16 
size_t
 
	$n‹mÆize
(c⁄° 
timevÆ
 *
°¨t
,

17 c⁄° 
timevÆ
 *
°›
,

18 
num
)

20 
timevÆ
 
diff
;

22 
	`timîsub
(
°›
, 
°¨t
, &
diff
);

25  ()(
diff
.
tv_£c
 * 1000000 + diff.
tv_u£c
)

26 / 
num
 * 1000;

27 
	}
}

29 
JMAP_DEFINE_UINTIDX_TYPE
(
obje˘
, 
obj
);

31 
	$maö
(
¨gc
, *
¨gv
[])

33 
obje˘
 *
objs
;

34 
size_t
 
i
, 
j
, 
num
;

35 
timevÆ
 
°¨t
, 
°›
;

36 
jm≠_obj
 *
jm≠
;

38 
num
 = 
¨gv
[1] ? 
	`©oi
(argv[1]) : 1000000;

39 
objs
 = 
	`ˇŒoc
(
num
, (objs[0]));

41 
i
 = 0; i < 
num
; i++) {

42 
objs
[
i
].
£lf
 = &objs[i];

45 
jm≠
 = 
	`jm≠_obj_√w
();

47 
	`¥ötf
("Initial insert: ");

48 
	`fÊush
(
°dout
);

49 
	`gëtimeofday
(&
°¨t
, 
NULL
);

50 
i
 = 0; i < 
num
; i++)

51 
	`jm≠_obj_add
(
jm≠
, 
i
, 
objs
[i].
£lf
);

52 
	`gëtimeofday
(&
°›
, 
NULL
);

53 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

55 
	`¥ötf
("InitialÜookup (match): ");

56 
	`fÊush
(
°dout
);

57 
	`gëtimeofday
(&
°¨t
, 
NULL
);

58 
i
 = 0; i < 
num
; i++)

59 i‡(
	`jm≠_obj_gë
(
jm≠
, 
i
)->
£lf
 !
objs
[i].self)

60 
	`ab‹t
();

61 
	`gëtimeofday
(&
°›
, 
NULL
);

62 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

64 
	`¥ötf
("InitialÜookup (miss): ");

65 
	`fÊush
(
°dout
);

66 
	`gëtimeofday
(&
°¨t
, 
NULL
);

67 
i
 = 0; i < 
num
; i++)

68 i‡(
	`jm≠_obj_gë
(
jm≠
, 
i
+
num
))

69 
	`ab‹t
();

70 
	`gëtimeofday
(&
°›
, 
NULL
);

71 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

74 
	`¥ötf
("InitialÜookup (random): ");

75 
	`fÊush
(
°dout
);

76 
	`gëtimeofday
(&
°¨t
, 
NULL
);

77 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

78 i‡(
	`jm≠_obj_gë
(
jm≠
, 
j
)->
£lf
 !&
objs
[j])

79 
	`ab‹t
();

80 
	`gëtimeofday
(&
°›
, 
NULL
);

81 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

83 
	`¥ötf
("Initial deleteáll: ");

84 
	`fÊush
(
°dout
);

85 
	`gëtimeofday
(&
°¨t
, 
NULL
);

86 
i
 = 0; i < 
num
; i++)

87 
	`jm≠_obj_dñ
(
jm≠
, 
i
);

88 
	`gëtimeofday
(&
°›
, 
NULL
);

89 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

91 
	`¥ötf
("InitialÑe-inserting: ");

92 
	`fÊush
(
°dout
);

93 
	`gëtimeofday
(&
°¨t
, 
NULL
);

94 
i
 = 0; i < 
num
; i++)

95 
	`jm≠_obj_add
(
jm≠
, 
i
, 
objs
[i].
£lf
);

96 
	`gëtimeofday
(&
°›
, 
NULL
);

97 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

99 
	`¥ötf
("Deleting first half: ");

100 
	`fÊush
(
°dout
);

101 
	`gëtimeofday
(&
°¨t
, 
NULL
);

102 
i
 = 0; i < 
num
; i+=2)

103 
	`jm≠_obj_dñ
(
jm≠
, 
i
);

104 
	`gëtimeofday
(&
°›
, 
NULL
);

105 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

107 
	`¥ötf
("Adding (a different) half: ");

108 
	`fÊush
(
°dout
);

110 
	`gëtimeofday
(&
°¨t
, 
NULL
);

111 
i
 = 0; i < 
num
; i+=2)

112 
	`jm≠_obj_add
(
jm≠
, 
num
+
i
, 
objs
[i].
£lf
);

113 
	`gëtimeofday
(&
°›
, 
NULL
);

114 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

116 
	`¥ötf
("Lookupáfter half-change (match): ");

117 
	`fÊush
(
°dout
);

118 
	`gëtimeofday
(&
°¨t
, 
NULL
);

119 
i
 = 1; i < 
num
; i+=2)

120 i‡(
	`jm≠_obj_gë
(
jm≠
, 
i
)->
£lf
 !
objs
[i].self)

121 
	`ab‹t
();

122 
i
 = 0; i < 
num
; i+=2)

123 i‡(
	`jm≠_obj_gë
(
jm≠
, 
i
+
num
)->
£lf
 !
objs
[i].self)

124 
	`ab‹t
();

125 
	`gëtimeofday
(&
°›
, 
NULL
);

126 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

128 
	`¥ötf
("Lookupáfter half-change(miss): ");

129 
	`fÊush
(
°dout
);

130 
	`gëtimeofday
(&
°¨t
, 
NULL
);

131 
i
 = 0; i < 
num
; i++)

132 i‡(
	`jm≠_obj_gë
(
jm≠
, 
i
+
num
*2))

133 
	`ab‹t
();

134 
	`gëtimeofday
(&
°›
, 
NULL
);

135 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

139 
	`¥ötf
("Details: churning firstÅime\n");

140 
i
 = 1; i < 
num
; i+=2) {

141 i‡(!
	`jm≠_obj_dñ
(
jm≠
, 
i
))

142 
	`ab‹t
();

143 
	`jm≠_obj_add
(
jm≠
, 
i
, 
objs
[i].
£lf
);

145 
i
 = 0; i < 
num
; i+=2) {

146 i‡(!
	`jm≠_obj_dñ
(
jm≠
, 
i
+
num
))

147 
	`ab‹t
();

148 
	`jm≠_obj_add
(
jm≠
, 
i
, 
objs
[i].
£lf
);

150 
i
 = 1; i < 5; i++) {

151 
	`¥ötf
("Churning %sÅime: ",

152 
i
 == 1 ? "second"

153 : 
i
 == 2 ? "third"

154 : 
i
 == 3 ? "fourth"

156 
	`fÊush
(
°dout
);

157 
	`gëtimeofday
(&
°¨t
, 
NULL
);

158 
j
 = 0; j < 
num
; j++) {

159 i‡(!
	`jm≠_obj_dñ
(
jm≠
, 
num
*(
i
-1)+
j
))

160 
	`ab‹t
();

161 
	`jm≠_obj_add
(
jm≠
, 
num
*
i
+
j
, &
objs
[j]);

163 
	`gëtimeofday
(&
°›
, 
NULL
);

164 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

168 
	`¥ötf
("Details:Ñeinserting with spread\n");

169 
i
 = 0; i < 
num
; i++) {

170 i‡(!
	`jm≠_obj_dñ
(
jm≠
, 
num
*4 + 
i
))

171 
	`ab‹t
();

172 
	`jm≠_obj_add
(
jm≠
, 
num
 * 5 + 
i
 * 9, 
objs
[i].
£lf
);

175 i‡(
	`jm≠_obj_p›cou¡
(
jm≠
, 0, -1Ë!
num
)

176 
	`ab‹t
();

178 
	`¥ötf
("Lookupáfter churn & spread (match): ");

179 
	`fÊush
(
°dout
);

180 
	`gëtimeofday
(&
°¨t
, 
NULL
);

181 
i
 = 0; i < 
num
; i++)

182 i‡(
	`jm≠_obj_gë
(
jm≠
, 
num
 * 5 + 
i
 * 9)->
£lf
 !
objs
[i].self) {

183 
	`¥ötf
("ò =%u\n", 
i
);

184 
	`ab‹t
();

186 
	`gëtimeofday
(&
°›
, 
NULL
);

187 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

189 
	`¥ötf
("Lookupáfter churn & spread (miss): ");

190 
	`fÊush
(
°dout
);

191 
	`gëtimeofday
(&
°¨t
, 
NULL
);

192 
i
 = 0; i < 
num
; i++)

193 i‡(
	`jm≠_obj_gë
(
jm≠
, 
num
 * 6 + 
i
 * 9))

194 
	`ab‹t
();

195 
	`gëtimeofday
(&
°›
, 
NULL
);

196 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

198 
	`¥ötf
("Lookupáfter churn & spread (random): ");

199 
	`fÊush
(
°dout
);

200 
	`gëtimeofday
(&
°¨t
, 
NULL
);

201 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

202 i‡(
	`jm≠_obj_gë
(
jm≠
, 
num
 * 5 + 
j
 * 9)->
£lf
 !&
objs
[j])

203 
	`ab‹t
();

204 
	`gëtimeofday
(&
°›
, 
NULL
);

205 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

207 
	`¥ötf
("Lookupáfter churn & spread (half-random): ");

208 
	`fÊush
(
°dout
);

209 
	`gëtimeofday
(&
°¨t
, 
NULL
);

210 
i
 = 0, 
j
 = 0; i < 
num
/2; i++, j = (j + 10007) %Çum) {

211 i‡(
	`jm≠_obj_gë
(
jm≠
, 
num
 * 5 + 
j
 * 9)->
£lf
 !&
objs
[j])

212 
	`ab‹t
();

213 i‡(
	`jm≠_obj_gë
(
jm≠
, 
num
 * 5 + (
j
 + 1Ë* 9)->
£lf
 !&
objs
[j+1])

214 
	`ab‹t
();

216 
	`gëtimeofday
(&
°›
, 
NULL
);

217 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

219 
	`¥ötf
("Deleting halfáfter churn & spread: ");

220 
	`fÊush
(
°dout
);

221 
	`gëtimeofday
(&
°¨t
, 
NULL
);

222 
i
 = 0; i < 
num
; i+=2)

223 
	`jm≠_obj_dñ
(
jm≠
, 
num
 * 5 + 
i
 * 9);

224 
	`gëtimeofday
(&
°›
, 
NULL
);

225 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

227 
	`¥ötf
("Adding (a different) halfáfter churn & spread: ");

228 
	`fÊush
(
°dout
);

230 
	`gëtimeofday
(&
°¨t
, 
NULL
);

231 
i
 = 0; i < 
num
; i+=2)

232 
	`jm≠_obj_add
(
jm≠
, 
num
 * 6 + 
i
 * 9, 
objs
[i].
£lf
);

233 
	`gëtimeofday
(&
°›
, 
NULL
);

234 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

237 
	}
}

	@ccan/ccan/jset/jset.c

2 
	~<cˇn/j£t/j£t.h
>

3 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

4 
	~<°dlib.h
>

5 
	~<°rög.h
>

7 
j£t
 *
	$j£t_√w_
(
size_t
 
size
)

9 
j£t
 *
£t
;

12 
	`BUILD_ASSERT
((Ë=(
W‹d_t
));

14 
	`BUILD_ASSERT
((
W‹d_t
) >= (*));

16 
	`as£π
(
size
 >(*
£t
));

17 
£t
 = 
	`mÆloc
(
size
);

18 i‡(
£t
) {

19 
£t
->
judy
 = 
NULL
;

20 
	`mem£t
(&
£t
->
îr
, 0, (set->err));

21 
£t
->
îr°r
 = 
NULL
;

23  
£t
;

24 
	}
}

26 c⁄° *
	$j£t_îr‹_°r_
(
j£t
 *
£t
)

28 *
°r
;

29 
	`‰ì
((*)
£t
->
îr°r
);

30 
£t
->
îr°r
 = 
°r
 = 
	`mÆloc
(100);

31 i‡(!
£t
->
îr°r
)

34 
	`•rötf
(
°r
,

36 
	`JU_ERRNO
(&
£t
->
îr
), 
	`JU_ERRID
(&set->err));

37  
°r
;

38 
	}
}

40 
	$j£t_‰ì_
(c⁄° 
j£t
 *
£t
)

42 
	`‰ì
((*)
£t
->
îr°r
);

43 
	`Judy1FªeAºay
((
PPvoid_t
)&
£t
->
judy
, 
PJE0
);

44 
	`‰ì
((*)
£t
);

45 
	}
}

	@ccan/ccan/jset/jset.h

2 #i‚de‡
CCAN_JSET_H


3 
	#CCAN_JSET_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/compûî/compûî.h
>

6 
	~<cˇn/tc⁄/tc⁄.h
>

7 
	~<Judy.h
>

8 
	~<°dboﬁ.h
>

9 
	~<as£π.h
>

17 
	sj£t
 {

18 *
	mjudy
;

19 
JEº‹_t
 
	mîr
;

20 c⁄° *
	mîr°r
;

32 
	#JSET_MEMBERS
(
ty≥
) \

33 
j£t
 
øw
; \

34 
	`TCON
(
ty≥
 
ˇ«ry
)

	)

48 
	#j£t_√w
(
ty≥
Ë(—y≥ *)
	`j£t_√w_
(—y≥)))

	)

57 
	#j£t_‰ì
(
£t
Ë
	`j£t_‰ì_
(&(£t)->
øw
)

	)

77 
	#j£t_îr‹
(
£t
) \

78 
	`j£t_îr‹_
(&(
£t
)->
øw
)

	)

89 
	#j£t_øw
(
£t
, 
ex¥
Ë(&
	`tc⁄_check
((£t), 
ˇ«ry
, (ex¥))->
øw
)

	)

101 
	#j£t_ã°
(
£t
, 
ödex
) \

102 
	`j£t_ã°_
(
	`j£t_øw
((
£t
), (
ödex
)), ()(ödex))

	)

115 
	#j£t_£t
(
£t
, 
ödex
) \

116 
	`j£t_£t_
(
	`j£t_øw
((
£t
), (
ödex
)), ()(ödex))

	)

129 
	#j£t_˛ór
(
£t
, 
ödex
) \

130 
	`j£t_˛ór_
(
	`j£t_øw
((
£t
), (
ödex
)), ()(ödex))

	)

140 
	#j£t_cou¡
(
£t
) \

141 
	`j£t_p›cou¡_
(&(
£t
)->
øw
, 0, -1UL)

	)

152 
	#j£t_p›cou¡
(
£t
, 
°¨t
, 
íd_ö˛
) \

153 
	`j£t_p›cou¡_
(
	`j£t_øw
((
£t
), (
°¨t
Ë? (°¨tË: (
íd_ö˛
)), \

154 ()(
°¨t
), ()(
íd_ö˛
))

	)

188 
	#j£t_¡h
(
£t
, 
n
, 
övÆid
) \

189 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, \

190 
	`j£t_¡h_
(
	`j£t_øw
((
£t
), (
övÆid
)), \

191 (
n
), ()(
övÆid
)))

	)

207 
	#j£t_fú°
(
£t
) \

208 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_fú°_
(&(£t)->
øw
))

	)

218 
	#j£t_√xt
(
£t
, 
¥ev
) \

219 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_√xt_
(&(£t)->
øw
, ()(
¥ev
)))

	)

232 
	#j£t_œ°
(
£t
) \

233 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_œ°_
(&(£t)->
øw
))

	)

243 
	#j£t_¥ev
(
£t
, 
¥ev
) \

244 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_¥ev_
(&(£t)->
øw
, ()(
¥ev
)))

	)

253 
	#j£t_fú°_˛ór
(
£t
) \

254 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_√xt_˛ór_
(&(£t)->
øw
, 0))

	)

256 
	#j£t_√xt_˛ór
(
£t
, 
¥ev
) \

257 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_√xt_˛ór_
(&(£t)->
øw
, \

258 ()(
¥ev
)))

	)

260 
	#j£t_œ°_˛ór
(
£t
) \

261 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_œ°_˛ór_
(&(£t)->
øw
))

	)

263 
	#j£t_¥ev_˛ór
(
£t
, 
¥ev
) \

264 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`j£t_¥ev_˛ór_
(&(£t)->
øw
, \

265 ()(
¥ev
)))

	)

268 
j£t
 *
j£t_√w_
(
size_t
 
size
);

269 
j£t_‰ì_
(c⁄° 
j£t
 *
£t
);

270 c⁄° *
COLD
 
j£t_îr‹_°r_
(
j£t
 *
£t
);

271 
ölöe
 c⁄° *
	$j£t_îr‹_
(
j£t
 *
£t
)

273 i‡(
	`JU_ERRNO
(&
£t
->
îr
Ë<
JU_ERRNO_NFMAX
)

274  
NULL
;

275  
	`j£t_îr‹_°r_
(
£t
);

276 
	}
}

277 
ölöe
 
boﬁ
 
	$j£t_ã°_
(c⁄° 
j£t
 *
£t
, 
ödex
)

279  
	`Judy1Te°
(
£t
->
judy
, 
ödex
, (
JEº‹_t
 *)&£t->
îr
);

280 
	}
}

281 
ölöe
 
boﬁ
 
	$j£t_£t_
(
j£t
 *
£t
, 
ödex
)

283  
	`Judy1Së
(&
£t
->
judy
, 
ödex
, &£t->
îr
);

284 
	}
}

285 
ölöe
 
boﬁ
 
	$j£t_˛ór_
(
j£t
 *
£t
, 
ödex
)

287  
	`Judy1Un£t
(&
£t
->
judy
, 
ödex
, &£t->
îr
);

288 
	}
}

289 
ölöe
 
	$j£t_p›cou¡_
(c⁄° 
j£t
 *
£t
,

290 
°¨t
,

291 
íd_ö˛
)

293  
	`Judy1Cou¡
(
£t
->
judy
, 
°¨t
, 
íd_ö˛
, (
JEº‹_t
 *)&£t->
îr
);

294 
	}
}

295 
ölöe
 
	$j£t_¡h_
(c⁄° 
j£t
 *
£t
,

296 
n
, 
övÆid
)

298 
ödex
;

299 i‡(!
	`Judy1ByCou¡
(
£t
->
judy
, 
n
+1, &
ödex
, (
JEº‹_t
 *)&£t->
îr
))

300 
ödex
 = 
övÆid
;

301  
ödex
;

302 
	}
}

303 
ölöe
 
	$j£t_fú°_
(c⁄° 
j£t
 *
£t
)

305 
ödex
 = 0;

306 i‡(!
	`Judy1Fú°
(
£t
->
judy
, &
ödex
, (
JEº‹_t
 *)&£t->
îr
))

307 
ödex
 = 0;

309 
	`as£π
(
ödex
 != 0);

310  
ödex
;

311 
	}
}

312 
ölöe
 
	$j£t_√xt_
(c⁄° 
j£t
 *
£t
,

313 
¥ev
)

315 i‡(!
	`Judy1Next
(
£t
->
judy
, &
¥ev
, (
JEº‹_t
 *)&£t->
îr
))

316 
¥ev
 = 0;

318 
	`as£π
(
¥ev
 != 0);

319  
¥ev
;

320 
	}
}

321 
ölöe
 
	$j£t_œ°_
(c⁄° 
j£t
 *
£t
)

323 
ödex
 = -1;

324 i‡(!
	`Judy1La°
(
£t
->
judy
, &
ödex
, (
JEº‹_t
 *)&£t->
îr
))

325 
ödex
 = 0;

327 
	`as£π
(
ödex
 != 0);

328  
ödex
;

329 
	}
}

330 
ölöe
 
	$j£t_¥ev_
(c⁄° 
j£t
 *
£t
,

331 
¥ev
)

333 i‡(!
	`Judy1Pªv
(
£t
->
judy
, &
¥ev
, (
JEº‹_t
 *)&£t->
îr
))

334 
¥ev
 = 0;

336 
	`as£π
(
¥ev
 != 0);

337  
¥ev
;

338 
	}
}

339 
ölöe
 
	$j£t_√xt_˛ór_
(c⁄° 
j£t
 *
£t
,

340 
¥ev
)

342 i‡(!
	`Judy1NextEm±y
(
£t
->
judy
, &
¥ev
, (
JEº‹_t
 *)&£t->
îr
))

343 
¥ev
 = 0;

345 
	`as£π
(
¥ev
 != 0);

346  
¥ev
;

347 
	}
}

348 
ölöe
 
	$j£t_œ°_˛ór_
(c⁄° 
j£t
 *
£t
)

350 
ödex
 = -1;

351 i‡(!
	`Judy1La°Em±y
(
£t
->
judy
, &
ödex
, (
JEº‹_t
 *)&£t->
îr
))

352 
ödex
 = 0;

353  
ödex
;

354 
	}
}

355 
ölöe
 
	$j£t_¥ev_˛ór_
(c⁄° 
j£t
 *
£t
,

356 
¥ev
)

358 i‡(!
	`Judy1PªvEm±y
(
£t
->
judy
, &
¥ev
, (
JEº‹_t
 *)&£t->
îr
))

359 
¥ev
 = 0;

360  
¥ev
;

361 
	}
}

	@ccan/ccan/jset/test/run-pointer-type.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/j£t/j£t.c
>

4 
	gfoo
;

6 
	sj£t_foo
 {

7 
JSET_MEMBERS
(
foo
 *);

10 
	$cmp_±r
(c⁄° *
a
, c⁄° *
b
)

12  *(**)
a
 - *(**)
b
;

13 
	}
}

15 
	#NUM
 100

	)

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
j£t_foo
 *
£t
;

20 
foo
 *foo[
NUM
];

21 
i
;

23 
	`∂™_ã°s
(20);

24 
i
 = 0; i < 
NUM
; i++)

25 
foo
[
i
] = 
	`mÆloc
(20);

27 
£t
 = 
	`j£t_√w
(
j£t_foo
);

28 
	`ok1
(
	`j£t_îr‹
(
£t
Ë=
NULL
);

30 
	`ok1
(
	`j£t_£t
(
£t
, 
foo
[0]Ë=
åue
);

31 
	`ok1
(
	`j£t_£t
(
£t
, 
foo
[0]Ë=
Ál£
);

32 
	`ok1
(
	`j£t_˛ór
(
£t
, 
foo
[0]Ë=
åue
);

33 
	`ok1
(
	`j£t_˛ór
(
£t
, 
foo
[0]Ë=
Ál£
);

34 
	`ok1
(
	`j£t_cou¡
(
£t
) == 0);

35 
	`ok1
(
	`j£t_¡h
(
£t
, 0, 
NULL
Ë=(
foo
 *)NULL);

36 
	`ok1
(
	`j£t_fú°
(
£t
Ë=(
foo
 *)
NULL
);

37 
	`ok1
(
	`j£t_œ°
(
£t
Ë=(
foo
 *)
NULL
);

39 
i
 = 0; i < 
NUM
; i++)

40 
	`j£t_£t
(
£t
, 
foo
[
i
]);

42 
	`qs‹t
(
foo
, 
NUM
, (foo[0]), 
cmp_±r
);

44 
	`ok1
(
	`j£t_cou¡
(
£t
Ë=
NUM
);

45 
	`ok1
(
	`j£t_¡h
(
£t
, 0, 
NULL
Ë=
foo
[0]);

46 
	`ok1
(
	`j£t_¡h
(
£t
, 
NUM
-1, 
NULL
Ë=
foo
[NUM-1]);

47 
	`ok1
(
	`j£t_¡h
(
£t
, 
NUM
, 
NULL
Ë=(
foo
 *)NULL);

48 
	`ok1
(
	`j£t_fú°
(
£t
Ë=
foo
[0]);

49 
	`ok1
(
	`j£t_œ°
(
£t
Ë=
foo
[
NUM
-1]);

50 
	`ok1
(
	`j£t_√xt
(
£t
, 
foo
[0]) == foo[1]);

51 
	`ok1
(
	`j£t_√xt
(
£t
, 
foo
[
NUM
-1]Ë=(foÿ*)
NULL
);

52 
	`ok1
(
	`j£t_¥ev
(
£t
, 
foo
[1]) == foo[0]);

53 
	`ok1
(
	`j£t_¥ev
(
£t
, 
foo
[0]Ë=(foÿ*)
NULL
);

54 
	`ok1
(
	`j£t_îr‹
(
£t
Ë=
NULL
);

55 
	`j£t_‰ì
(
£t
);

57 
i
 = 0; i < 
NUM
; i++)

58 
	`‰ì
(
foo
[
i
]);

60  
	`exô_°©us
();

61 
	}
}

	@ccan/ccan/jset/test/run.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/j£t/j£t.c
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 
	sj£t_l⁄g
 {

7 
	`JSET_MEMBERS
();

8 } *
£t
;

9 
size_t
 
i
;

10 c⁄° *
îr
;

12 
	`∂™_ã°s
(34);

14 
£t
 = 
	`j£t_√w
(
j£t_l⁄g
);

15 
	`ok1
(
	`j£t_îr‹
(
£t
Ë=
NULL
);

17 
	`ok1
(
	`j£t_£t
(
£t
, 0Ë=
åue
);

18 
	`ok1
(
	`j£t_£t
(
£t
, 0Ë=
Ál£
);

19 
	`ok1
(
	`j£t_˛ór
(
£t
, 0Ë=
åue
);

20 
	`ok1
(
	`j£t_˛ór
(
£t
, 0Ë=
Ál£
);

21 
	`ok1
(
	`j£t_p›cou¡
(
£t
, 0, -1) == 0);

22 
	`ok1
(
	`j£t_¡h
(
£t
, 0, 0) == 0);

23 
	`ok1
(
	`j£t_¡h
(
£t
, 0, -1Ë=(
size_t
)-1);

24 
	`ok1
(
	`j£t_fú°
(
£t
) == 0);

25 
	`ok1
(
	`j£t_œ°
(
£t
) == 0);

26 
	`ok1
(
	`j£t_fú°_˛ór
(
£t
) == 1);

27 
	`ok1
(
	`j£t_œ°_˛ór
(
£t
Ë=(
size_t
)-1);

28 
	`ok1
(
	`j£t_¥ev_˛ór
(
£t
, 1) == 0);

29 
	`ok1
(
	`j£t_√xt_˛ór
(
£t
, 1) == 2);

30 
	`ok1
(
	`j£t_√xt_˛ór
(
£t
, -1) == 0);

33 
i
 = 0; i < 1000000; i++)

34 
	`j£t_£t
(
£t
, 1 + (
i
 << 4));

37 
	`düg
("%u byã†mem‹y u£d\n", ()
	`Judy1MemU£d
(
£t
->
øw
.
judy
));

39 
	`ok1
(
	`j£t_p›cou¡
(
£t
, 0, -1) == 1000000);

40 
	`ok1
(
	`j£t_¡h
(
£t
, 0, -1) == 1);

41 
	`ok1
(
	`j£t_¡h
(
£t
, 999999, -1) == 1 + (999999 << 4));

42 
	`ok1
(
	`j£t_¡h
(
£t
, 1000000, -1Ë=(
size_t
)-1);

43 
	`ok1
(
	`j£t_fú°
(
£t
) == 1);

44 
	`ok1
(
	`j£t_œ°
(
£t
) == 1 + (999999 << 4));

45 
	`ok1
(
	`j£t_fú°_˛ór
(
£t
) == 2);

46 
	`ok1
(
	`j£t_œ°_˛ór
(
£t
Ë=(
size_t
)-1);

47 
	`ok1
(
	`j£t_¥ev_˛ór
(
£t
, 3) == 2);

48 
	`ok1
(
	`j£t_¥ev_˛ór
(
£t
, 2) == 0);

49 
	`ok1
(
	`j£t_√xt
(
£t
, 1) == 1 + (1 << 4));

50 
	`ok1
(
	`j£t_√xt
(
£t
, 1 + (999999 << 4)) == 0);

51 
	`ok1
(
	`j£t_¥ev
(
£t
, 1) == 0);

52 
	`ok1
(
	`j£t_¥ev
(
£t
, 2) == 1);

53 
	`ok1
(
	`j£t_îr‹
(
£t
Ë=
NULL
);

56 
	`JU_ERRNO
(&
£t
->
øw
.
îr
) = 100;

57 
	`JU_ERRID
(&
£t
->
øw
.
îr
) = 991;

58 
îr
 = 
	`j£t_îr‹
(
£t
);

59 
	`ok1
(
îr
);

60 
	`ok1
(
	`°r°r
(
îr
, "100"));

61 
	`ok1
(
	`°r°r
(
îr
, "991"));

62 
	`ok1
(
îr
 =
£t
->
øw
.
îr°r
);

63 
	`j£t_‰ì
(
£t
);

65  
	`exô_°©us
();

66 
	}
}

	@ccan/ccan/json/json.c

24 
	~"js⁄.h
"

26 
	~<as£π.h
>

27 
	~<°döt.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

32 
	#out_of_mem‹y
() do { \

33 
	`Ârötf
(
°dîr
, "Out of memory.\n"); \

34 
	`exô
(
EXIT_FAILURE
); \

35 } 0)

	)

38 *
	$js⁄_°rdup
(c⁄° *
°r
)

40 *
ªt
 = (*Ë
	`mÆloc
(
	`°æí
(
°r
) + 1);

41 i‡(
ªt
 =
NULL
)

42 
	`out_of_mem‹y
();

43 
	`°r˝y
(
ªt
, 
°r
);

44  
ªt
;

45 
	}
}

51 *
	mcur
;

52 *
	míd
;

53 *
	m°¨t
;

54 } 
	tSB
;

56 
	$sb_öô
(
SB
 *
sb
)

58 
sb
->
°¨t
 = (*Ë
	`mÆloc
(17);

59 i‡(
sb
->
°¨t
 =
NULL
)

60 
	`out_of_mem‹y
();

61 
sb
->
cur
 = sb->
°¨t
;

62 
sb
->
íd
 = sb->
°¨t
 + 16;

63 
	}
}

66 
	#sb_√ed
(
sb
, 
√ed
) do { \

67 i‡((
sb
)->
íd
 - (sb)->
cur
 < (
√ed
)) \

68 
	`sb_grow
(
sb
, 
√ed
); \

69 } 0)

	)

71 
	$sb_grow
(
SB
 *
sb
, 
√ed
)

73 
size_t
 
Àngth
 = 
sb
->
cur
 - sb->
°¨t
;

74 
size_t
 
Æloc
 = 
sb
->
íd
 - sb->
°¨t
;

77 
Æloc
 *= 2;

78 } 
Æloc
 < 
Àngth
 + 
√ed
);

80 
sb
->
°¨t
 = (*Ë
	`ªÆloc
(sb->°¨t, 
Æloc
 + 1);

81 i‡(
sb
->
°¨t
 =
NULL
)

82 
	`out_of_mem‹y
();

83 
sb
->
cur
 = sb->
°¨t
 + 
Àngth
;

84 
sb
->
íd
 = sb->
°¨t
 + 
Æloc
;

85 
	}
}

87 
	$sb_put
(
SB
 *
sb
, c⁄° *
byãs
, 
cou¡
)

89 
	`sb_√ed
(
sb
, 
cou¡
);

90 
	`mem˝y
(
sb
->
cur
, 
byãs
, 
cou¡
);

91 
sb
->
cur
 +
cou¡
;

92 
	}
}

94 
	#sb_putc
(
sb
, 
c
) do { \

95 i‡((
sb
)->
cur
 >(sb)->
íd
) \

96 
	`sb_grow
(
sb
, 1); \

97 *(
sb
)->
cur
++ = (
c
); \

98 } 0)

	)

100 
	$sb_puts
(
SB
 *
sb
, c⁄° *
°r
)

102 
	`sb_put
(
sb
, 
°r
, 
	`°æí
(str));

103 
	}
}

105 *
	$sb_föish
(
SB
 *
sb
)

107 *
sb
->
cur
 = 0;

108 
	`as£π
(
sb
->
°¨t
 <sb->
cur
 && 
	`°æí
(sb->°¨tË=(
size_t
)(sb->cur - sb->start));

109  
sb
->
°¨t
;

110 
	}
}

112 
	$sb_‰ì
(
SB
 *
sb
)

114 
	`‰ì
(
sb
->
°¨t
);

115 
	}
}

129 
uöt32_t
 
	tuch¨_t
;

151 
	$utf8_vÆid©e_cz
(c⁄° *
s
)

153 
c
 = *
s
++;

155 i‡(
c
 <= 0x7F) {

157 } i‡(
c
 <= 0xC1) {

160 } i‡(
c
 <= 0xDF) {

162 i‡((()*
s
++ & 0xC0) != 0x80)

166 } i‡(
c
 <= 0xEF) {

168 i‡(
c
 =0xE0 && ()*
s
 < 0xA0)

172 i‡(
c
 =0xED && ()*
s
 > 0x9F)

176 i‡((()*
s
++ & 0xC0) != 0x80)

178 i‡((()*
s
++ & 0xC0) != 0x80)

182 } i‡(
c
 <= 0xF4) {

184 i‡(
c
 =0xF0 && ()*
s
 < 0x90)

188 i‡(
c
 =0xF4 && ()*
s
 > 0x8F)

192 i‡((()*
s
++ & 0xC0) != 0x80)

194 i‡((()*
s
++ & 0xC0) != 0x80)

196 i‡((()*
s
++ & 0xC0) != 0x80)

203 
	}
}

206 
boﬁ
 
	$utf8_vÆid©e
(c⁄° *
s
)

208 
Àn
;

210 ; *
s
 !0; s +
Àn
) {

211 
Àn
 = 
	`utf8_vÆid©e_cz
(
s
);

212 i‡(
Àn
 == 0)

213  
Ál£
;

216  
åue
;

217 
	}
}

226 
	$utf8_ªad_ch¨
(c⁄° *
s
, 
uch¨_t
 *
out
)

228 c⁄° *
c
 = (c⁄° *Ë
s
;

230 
	`as£π
(
	`utf8_vÆid©e_cz
(
s
));

232 i‡(
c
[0] <= 0x7F) {

234 *
out
 = 
c
[0];

236 } i‡(
c
[0] <= 0xDF) {

238 *
out
 = ((
uch¨_t
)
c
[0] & 0x1F) << 6 |

239 ((
uch¨_t
)
c
[1] & 0x3F);

241 } i‡(
c
[0] <= 0xEF) {

243 *
out
 = ((
uch¨_t
)
c
[0] & 0xF) << 12 |

244 ((
uch¨_t
)
c
[1] & 0x3F) << 6 |

245 ((
uch¨_t
)
c
[2] & 0x3F);

249 *
out
 = ((
uch¨_t
)
c
[0] & 0x7) << 18 |

250 ((
uch¨_t
)
c
[1] & 0x3F) << 12 |

251 ((
uch¨_t
)
c
[2] & 0x3F) << 6 |

252 ((
uch¨_t
)
c
[3] & 0x3F);

255 
	}
}

265 
	$utf8_wrôe_ch¨
(
uch¨_t
 
unicode
, *
out
)

267 *
o
 = (*Ë
out
;

269 
	`as£π
(
unicode
 <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));

271 i‡(
unicode
 <= 0x7F) {

273 *
o
++ = 
unicode
;

275 } i‡(
unicode
 <= 0x7FF) {

277 *
o
++ = 0xC0 | 
unicode
 >> 6;

278 *
o
++ = 0x80 | (
unicode
 & 0x3F);

280 } i‡(
unicode
 <= 0xFFFF) {

282 *
o
++ = 0xE0 | 
unicode
 >> 12;

283 *
o
++ = 0x80 | (
unicode
 >> 6 & 0x3F);

284 *
o
++ = 0x80 | (
unicode
 & 0x3F);

288 *
o
++ = 0xF0 | 
unicode
 >> 18;

289 *
o
++ = 0x80 | (
unicode
 >> 12 & 0x3F);

290 *
o
++ = 0x80 | (
unicode
 >> 6 & 0x3F);

291 *
o
++ = 0x80 | (
unicode
 & 0x3F);

294 
	}
}

302 
boﬁ
 
	$‰om_suºog©e_∑ú
(
uöt16_t
 
uc
, uöt16_à
lc
, 
uch¨_t
 *
unicode
)

304 i‡(
uc
 >0xD800 && u¯<0xDBFF && 
lc
 >= 0xDC00 &&Üc <= 0xDFFF) {

305 *
unicode
 = 0x10000 + ((((
uch¨_t
)
uc
 & 0x3FFË<< 10Ë| (
lc
 & 0x3FF));

306  
åue
;

308  
Ál£
;

310 
	}
}

317 
	$to_suºog©e_∑ú
(
uch¨_t
 
unicode
, 
uöt16_t
 *
uc
, uöt16_à*
lc
)

319 
uch¨_t
 
n
;

321 
	`as£π
(
unicode
 >= 0x10000 && unicode <= 0x10FFFF);

323 
n
 = 
unicode
 - 0x10000;

324 *
uc
 = ((
n
 >> 10) & 0x3FF) | 0xD800;

325 *
lc
 = (
n
 & 0x3FF) | 0xDC00;

326 
	}
}

328 
	#is_•a˚
(
c
Ë((cË='\t' || (cË='\n' || (cË='\r' || (cË=' ')

	)

329 
	#is_digô
(
c
Ë((cË>'0' && (cË<'9')

	)

331 
boﬁ
 
∑r£_vÆue
 (c⁄° **
•
, 
Js⁄Node
 **
out
);

332 
boﬁ
 
∑r£_°rög
 (c⁄° **
•
, **
out
);

333 
boﬁ
 
∑r£_numbî
 (c⁄° **
•
, *
out
);

334 
boﬁ
 
∑r£_¨øy
 (c⁄° **
•
, 
Js⁄Node
 **
out
);

335 
boﬁ
 
∑r£_obje˘
 (c⁄° **
•
, 
Js⁄Node
 **
out
);

336 
boﬁ
 
∑r£_hex16
 (c⁄° **
•
, 
uöt16_t
 *
out
);

338 
boﬁ
 
ex≥˘_lôîÆ
 (c⁄° **
•
, c⁄° *
°r
);

339 
skù_•a˚
 (c⁄° **
•
);

341 
emô_vÆue
 (
SB
 *
out
, c⁄° 
Js⁄Node
 *
node
);

342 
emô_vÆue_ödíãd
 (
SB
 *
out
, c⁄° 
Js⁄Node
 *
node
, c⁄° *
•a˚
, 
ödít_Àvñ
);

343 
emô_°rög
 (
SB
 *
out
, c⁄° *
°r
);

344 
emô_numbî
 (
SB
 *
out
, 
num
);

345 
emô_¨øy
 (
SB
 *
out
, c⁄° 
Js⁄Node
 *
¨øy
);

346 
emô_¨øy_ödíãd
 (
SB
 *
out
, c⁄° 
Js⁄Node
 *
¨øy
, c⁄° *
•a˚
, 
ödít_Àvñ
);

347 
emô_obje˘
 (
SB
 *
out
, c⁄° 
Js⁄Node
 *
obje˘
);

348 
emô_obje˘_ödíãd
 (
SB
 *
out
, c⁄° 
Js⁄Node
 *
obje˘
, c⁄° *
•a˚
, 
ödít_Àvñ
);

350 
wrôe_hex16
(*
out
, 
uöt16_t
 
vÆ
);

352 
Js⁄Node
 *
mknode
(
Js⁄Tag
 
èg
);

353 
≠≥nd_node
(
Js⁄Node
 *
∑ª¡
, Js⁄Nodê*
chûd
);

354 
¥ïíd_node
(
Js⁄Node
 *
∑ª¡
, Js⁄Nodê*
chûd
);

355 
≠≥nd_membî
(
Js⁄Node
 *
obje˘
, *
key
, Js⁄Nodê*
vÆue
);

358 
boﬁ
 
èg_is_vÆid
(
èg
);

359 
boﬁ
 
numbî_is_vÆid
(c⁄° *
num
);

361 
Js⁄Node
 *
	$js⁄_decode
(c⁄° *
js⁄
)

363 c⁄° *
s
 = 
js⁄
;

364 
Js⁄Node
 *
ªt
;

366 
	`skù_•a˚
(&
s
);

367 i‡(!
	`∑r£_vÆue
(&
s
, &
ªt
))

368  
NULL
;

370 
	`skù_•a˚
(&
s
);

371 i‡(*
s
 != 0) {

372 
	`js⁄_dñëe
(
ªt
);

373  
NULL
;

376  
ªt
;

377 
	}
}

379 *
	$js⁄_ícode
(c⁄° 
Js⁄Node
 *
node
)

381  
	`js⁄_°rögify
(
node
, 
NULL
);

382 
	}
}

384 *
	$js⁄_ícode_°rög
(c⁄° *
°r
)

386 
SB
 
sb
;

387 
	`sb_öô
(&
sb
);

389 
	`emô_°rög
(&
sb
, 
°r
);

391  
	`sb_föish
(&
sb
);

392 
	}
}

394 *
	$js⁄_°rögify
(c⁄° 
Js⁄Node
 *
node
, c⁄° *
•a˚
)

396 
SB
 
sb
;

397 
	`sb_öô
(&
sb
);

399 i‡(
•a˚
 !
NULL
)

400 
	`emô_vÆue_ödíãd
(&
sb
, 
node
, 
•a˚
, 0);

402 
	`emô_vÆue
(&
sb
, 
node
);

404  
	`sb_föish
(&
sb
);

405 
	}
}

407 
	$js⁄_dñëe
(
Js⁄Node
 *
node
)

409 i‡(
node
 !
NULL
) {

410 
	`js⁄_ªmove_‰om_∑ª¡
(
node
);

412 
node
->
èg
) {

413 
JSON_STRING
:

414 
	`‰ì
(
node
->
°rög_
);

416 
JSON_ARRAY
:

417 
JSON_OBJECT
:

419 
Js⁄Node
 *
chûd
, *
√xt
;

420 
chûd
 = 
node
->
chûdªn
.
hód
; chûd !
NULL
; chûd = 
√xt
) {

421 
√xt
 = 
chûd
->next;

422 
	`js⁄_dñëe
(
chûd
);

429 
	`‰ì
(
node
);

431 
	}
}

433 
boﬁ
 
	$js⁄_vÆid©e
(c⁄° *
js⁄
)

435 c⁄° *
s
 = 
js⁄
;

437 
	`skù_•a˚
(&
s
);

438 i‡(!
	`∑r£_vÆue
(&
s
, 
NULL
))

439  
Ál£
;

441 
	`skù_•a˚
(&
s
);

442 i‡(*
s
 != 0)

443  
Ál£
;

445  
åue
;

446 
	}
}

448 
Js⁄Node
 *
	$js⁄_föd_ñemít
(
Js⁄Node
 *
¨øy
, 
ödex
)

450 
Js⁄Node
 *
ñemít
;

451 
i
 = 0;

453 i‡(
¨øy
 =
NULL
 ||áºay->
èg
 !
JSON_ARRAY
)

454  
NULL
;

456 
	`js⁄_f‹óch
(
ñemít
, 
¨øy
) {

457 i‡(
i
 =
ödex
)

458  
ñemít
;

459 
i
++;

462  
NULL
;

463 
	}
}

465 
Js⁄Node
 *
	$js⁄_föd_membî
(
Js⁄Node
 *
obje˘
, c⁄° *
«me
)

467 
Js⁄Node
 *
membî
;

469 i‡(
obje˘
 =
NULL
 || obje˘->
èg
 !
JSON_OBJECT
)

470  
NULL
;

472 
	`js⁄_f‹óch
(
membî
, 
obje˘
)

473 i‡(
	`°rcmp
(
membî
->
key
, 
«me
) == 0)

474  
membî
;

476  
NULL
;

477 
	}
}

479 
Js⁄Node
 *
	$js⁄_fú°_chûd
(c⁄° 
Js⁄Node
 *
node
)

481 i‡(
node
 !
NULL
 && (node->
èg
 =
JSON_ARRAY
 ||Çode->èg =
JSON_OBJECT
))

482  
node
->
chûdªn
.
hód
;

483  
NULL
;

484 
	}
}

486 
Js⁄Node
 *
	$mknode
(
Js⁄Tag
 
èg
)

488 
Js⁄Node
 *
ªt
 = (Js⁄Node*Ë
	`ˇŒoc
(1, (JsonNode));

489 i‡(
ªt
 =
NULL
)

490 
	`out_of_mem‹y
();

491 
ªt
->
èg
 =Åag;

492  
ªt
;

493 
	}
}

495 
Js⁄Node
 *
	$js⁄_mknuŒ
()

497  
	`mknode
(
JSON_NULL
);

498 
	}
}

500 
Js⁄Node
 *
	$js⁄_mkboﬁ
(
boﬁ
 
b
)

502 
Js⁄Node
 *
ªt
 = 
	`mknode
(
JSON_BOOL
);

503 
ªt
->
boﬁ_
 = 
b
;

504  
ªt
;

505 
	}
}

507 
Js⁄Node
 *
	$mk°rög
(*
s
)

509 
Js⁄Node
 *
ªt
 = 
	`mknode
(
JSON_STRING
);

510 
ªt
->
°rög_
 = 
s
;

511  
ªt
;

512 
	}
}

514 
Js⁄Node
 *
	$js⁄_mk°rög
(c⁄° *
s
)

516  
	`mk°rög
(
	`js⁄_°rdup
(
s
));

517 
	}
}

519 
Js⁄Node
 *
	$js⁄_mknumbî
(
n
)

521 
Js⁄Node
 *
node
 = 
	`mknode
(
JSON_NUMBER
);

522 
node
->
numbî_
 = 
n
;

523  
node
;

524 
	}
}

526 
Js⁄Node
 *
	$js⁄_mk¨øy
()

528  
	`mknode
(
JSON_ARRAY
);

529 
	}
}

531 
Js⁄Node
 *
	$js⁄_mkobje˘
()

533  
	`mknode
(
JSON_OBJECT
);

534 
	}
}

536 
	$≠≥nd_node
(
Js⁄Node
 *
∑ª¡
, Js⁄Nodê*
chûd
)

538 
chûd
->
∑ª¡
 =Öarent;

539 
chûd
->
¥ev
 = 
∑ª¡
->
chûdªn
.
èû
;

540 
chûd
->
√xt
 = 
NULL
;

542 i‡(
∑ª¡
->
chûdªn
.
èû
 !
NULL
)

543 
∑ª¡
->
chûdªn
.
èû
->
√xt
 = 
chûd
;

545 
∑ª¡
->
chûdªn
.
hód
 = 
chûd
;

546 
∑ª¡
->
chûdªn
.
èû
 = 
chûd
;

547 
	}
}

549 
	$¥ïíd_node
(
Js⁄Node
 *
∑ª¡
, Js⁄Nodê*
chûd
)

551 
chûd
->
∑ª¡
 =Öarent;

552 
chûd
->
¥ev
 = 
NULL
;

553 
chûd
->
√xt
 = 
∑ª¡
->
chûdªn
.
hód
;

555 i‡(
∑ª¡
->
chûdªn
.
hód
 !
NULL
)

556 
∑ª¡
->
chûdªn
.
hód
->
¥ev
 = 
chûd
;

558 
∑ª¡
->
chûdªn
.
èû
 = 
chûd
;

559 
∑ª¡
->
chûdªn
.
hód
 = 
chûd
;

560 
	}
}

562 
	$≠≥nd_membî
(
Js⁄Node
 *
obje˘
, *
key
, Js⁄Nodê*
vÆue
)

564 
vÆue
->
key
 = key;

565 
	`≠≥nd_node
(
obje˘
, 
vÆue
);

566 
	}
}

568 
	$js⁄_≠≥nd_ñemít
(
Js⁄Node
 *
¨øy
, Js⁄Nodê*
ñemít
)

570 
	`as£π
(
¨øy
->
èg
 =
JSON_ARRAY
);

571 
	`as£π
(
ñemít
->
∑ª¡
 =
NULL
);

573 
	`≠≥nd_node
(
¨øy
, 
ñemít
);

574 
	}
}

576 
	$js⁄_¥ïíd_ñemít
(
Js⁄Node
 *
¨øy
, Js⁄Nodê*
ñemít
)

578 
	`as£π
(
¨øy
->
èg
 =
JSON_ARRAY
);

579 
	`as£π
(
ñemít
->
∑ª¡
 =
NULL
);

581 
	`¥ïíd_node
(
¨øy
, 
ñemít
);

582 
	}
}

584 
	$js⁄_≠≥nd_membî
(
Js⁄Node
 *
obje˘
, c⁄° *
key
, Js⁄Nodê*
vÆue
)

586 
	`as£π
(
obje˘
->
èg
 =
JSON_OBJECT
);

587 
	`as£π
(
vÆue
->
∑ª¡
 =
NULL
);

589 
	`≠≥nd_membî
(
obje˘
, 
	`js⁄_°rdup
(
key
), 
vÆue
);

590 
	}
}

592 
	$js⁄_¥ïíd_membî
(
Js⁄Node
 *
obje˘
, c⁄° *
key
, Js⁄Nodê*
vÆue
)

594 
	`as£π
(
obje˘
->
èg
 =
JSON_OBJECT
);

595 
	`as£π
(
vÆue
->
∑ª¡
 =
NULL
);

597 
vÆue
->
key
 = 
	`js⁄_°rdup
(key);

598 
	`¥ïíd_node
(
obje˘
, 
vÆue
);

599 
	}
}

601 
	$js⁄_ªmove_‰om_∑ª¡
(
Js⁄Node
 *
node
)

603 
Js⁄Node
 *
∑ª¡
 = 
node
->parent;

605 i‡(
∑ª¡
 !
NULL
) {

606 i‡(
node
->
¥ev
 !
NULL
)

607 
node
->
¥ev
->
√xt
 =Çode->next;

609 
∑ª¡
->
chûdªn
.
hód
 = 
node
->
√xt
;

610 i‡(
node
->
√xt
 !
NULL
)

611 
node
->
√xt
->
¥ev
 =Çode->prev;

613 
∑ª¡
->
chûdªn
.
èû
 = 
node
->
¥ev
;

615 
	`‰ì
(
node
->
key
);

617 
node
->
∑ª¡
 = 
NULL
;

618 
node
->
¥ev
 =Çode->
√xt
 = 
NULL
;

619 
node
->
key
 = 
NULL
;

621 
	}
}

623 
boﬁ
 
	$∑r£_vÆue
(c⁄° **
•
, 
Js⁄Node
 **
out
)

625 c⁄° *
s
 = *
•
;

627 *
s
) {

629 i‡(
	`ex≥˘_lôîÆ
(&
s
, "null")) {

630 i‡(
out
)

631 *
out
 = 
	`js⁄_mknuŒ
();

632 *
•
 = 
s
;

633  
åue
;

635  
Ál£
;

638 i‡(
	`ex≥˘_lôîÆ
(&
s
, "false")) {

639 i‡(
out
)

640 *
out
 = 
	`js⁄_mkboﬁ
(
Ál£
);

641 *
•
 = 
s
;

642  
åue
;

644  
Ál£
;

647 i‡(
	`ex≥˘_lôîÆ
(&
s
, "true")) {

648 i‡(
out
)

649 *
out
 = 
	`js⁄_mkboﬁ
(
åue
);

650 *
•
 = 
s
;

651  
åue
;

653  
Ál£
;

656 *
°r
;

657 i‡(
	`∑r£_°rög
(&
s
, 
out
 ? &
°r
 : 
NULL
)) {

658 i‡(
out
)

659 *
out
 = 
	`mk°rög
(
°r
);

660 *
•
 = 
s
;

661  
åue
;

663  
Ál£
;

667 i‡(
	`∑r£_¨øy
(&
s
, 
out
)) {

668 *
•
 = 
s
;

669  
åue
;

671  
Ál£
;

674 i‡(
	`∑r£_obje˘
(&
s
, 
out
)) {

675 *
•
 = 
s
;

676  
åue
;

678  
Ál£
;

681 
num
;

682 i‡(
	`∑r£_numbî
(&
s
, 
out
 ? &
num
 : 
NULL
)) {

683 i‡(
out
)

684 *
out
 = 
	`js⁄_mknumbî
(
num
);

685 *
•
 = 
s
;

686  
åue
;

688  
Ál£
;

691 
	}
}

693 
boﬁ
 
	$∑r£_¨øy
(c⁄° **
•
, 
Js⁄Node
 **
out
)

695 c⁄° *
s
 = *
•
;

696 
Js⁄Node
 *
ªt
 = 
out
 ? 
	`js⁄_mk¨øy
(Ë: 
NULL
;

697 
Js⁄Node
 *
ñemít
;

699 i‡(*
s
++ != '[')

700 
Áûuª
;

701 
	`skù_•a˚
(&
s
);

703 i‡(*
s
 == ']') {

704 
s
++;

705 
suc˚ss
;

709 i‡(!
	`∑r£_vÆue
(&
s
, 
out
 ? &
ñemít
 : 
NULL
))

710 
Áûuª
;

711 
	`skù_•a˚
(&
s
);

713 i‡(
out
)

714 
	`js⁄_≠≥nd_ñemít
(
ªt
, 
ñemít
);

716 i‡(*
s
 == ']') {

717 
s
++;

718 
suc˚ss
;

721 i‡(*
s
++ != ',')

722 
Áûuª
;

723 
	`skù_•a˚
(&
s
);

726 
suc˚ss
:

727 *
•
 = 
s
;

728 i‡(
out
)

729 *
out
 = 
ªt
;

730  
åue
;

732 
Áûuª
:

733 
	`js⁄_dñëe
(
ªt
);

734  
Ál£
;

735 
	}
}

737 
boﬁ
 
	$∑r£_obje˘
(c⁄° **
•
, 
Js⁄Node
 **
out
)

739 c⁄° *
s
 = *
•
;

740 
Js⁄Node
 *
ªt
 = 
out
 ? 
	`js⁄_mkobje˘
(Ë: 
NULL
;

741 *
key
;

742 
Js⁄Node
 *
vÆue
;

744 i‡(*
s
++ != '{')

745 
Áûuª
;

746 
	`skù_•a˚
(&
s
);

748 i‡(*
s
 == '}') {

749 
s
++;

750 
suc˚ss
;

754 i‡(!
	`∑r£_°rög
(&
s
, 
out
 ? &
key
 : 
NULL
))

755 
Áûuª
;

756 
	`skù_•a˚
(&
s
);

758 i‡(*
s
++ != ':')

759 
Áûuª_‰ì_key
;

760 
	`skù_•a˚
(&
s
);

762 i‡(!
	`∑r£_vÆue
(&
s
, 
out
 ? &
vÆue
 : 
NULL
))

763 
Áûuª_‰ì_key
;

764 
	`skù_•a˚
(&
s
);

766 i‡(
out
)

767 
	`≠≥nd_membî
(
ªt
, 
key
, 
vÆue
);

769 i‡(*
s
 == '}') {

770 
s
++;

771 
suc˚ss
;

774 i‡(*
s
++ != ',')

775 
Áûuª
;

776 
	`skù_•a˚
(&
s
);

779 
suc˚ss
:

780 *
•
 = 
s
;

781 i‡(
out
)

782 *
out
 = 
ªt
;

783  
åue
;

785 
Áûuª_‰ì_key
:

786 i‡(
out
)

787 
	`‰ì
(
key
);

788 
Áûuª
:

789 
	`js⁄_dñëe
(
ªt
);

790  
Ál£
;

791 
	}
}

793 
boﬁ
 
	$∑r£_°rög
(c⁄° **
•
, **
out
)

795 c⁄° *
s
 = *
•
;

796 
SB
 
sb
;

797 
throwaway_buf„r
[4];

799 *
b
;

801 i‡(*
s
++ != '"')

802  
Ál£
;

804 i‡(
out
) {

805 
	`sb_öô
(&
sb
);

806 
	`sb_√ed
(&
sb
, 4);

807 
b
 = 
sb
.
cur
;

809 
b
 = 
throwaway_buf„r
;

812 *
s
 != '"') {

813 
c
 = *
s
++;

816 i‡(
c
 == '\\') {

817 
c
 = *
s
++;

818 
c
) {

822 *
b
++ = 
c
;

825 *
b
++ = '\b';

828 *
b
++ = '\f';

831 *
b
++ = '\n';

834 *
b
++ = '\r';

837 *
b
++ = '\t';

841 
uöt16_t
 
uc
, 
lc
;

842 
uch¨_t
 
unicode
;

844 i‡(!
	`∑r£_hex16
(&
s
, &
uc
))

845 
Áûed
;

847 i‡(
uc
 >= 0xD800 && uc <= 0xDFFF) {

849 i‡(*
s
++ !'\\' || *s++ !'u' || !
	`∑r£_hex16
(&s, &
lc
))

850 
Áûed
;

851 i‡(!
	`‰om_suºog©e_∑ú
(
uc
, 
lc
, &
unicode
))

852 
Áûed
;

853 } i‡(
uc
 == 0) {

855 
Áûed
;

857 
unicode
 = 
uc
;

860 
b
 +
	`utf8_wrôe_ch¨
(
unicode
, b);

865 
Áûed
;

867 } i‡(
c
 <= 0x1F) {

869 
Áûed
;

872 
Àn
;

874 
s
--;

875 
Àn
 = 
	`utf8_vÆid©e_cz
(
s
);

876 i‡(
Àn
 == 0)

877 
Áûed
;

879 
Àn
--)

880 *
b
++ = *
s
++;

887 i‡(
out
) {

888 
sb
.
cur
 = 
b
;

889 
	`sb_√ed
(&
sb
, 4);

890 
b
 = 
sb
.
cur
;

892 
b
 = 
throwaway_buf„r
;

895 
s
++;

897 i‡(
out
)

898 *
out
 = 
	`sb_föish
(&
sb
);

899 *
•
 = 
s
;

900  
åue
;

902 
Áûed
:

903 i‡(
out
)

904 
	`sb_‰ì
(&
sb
);

905  
Ál£
;

906 
	}
}

918 
boﬁ
 
	$∑r£_numbî
(c⁄° **
•
, *
out
)

920 c⁄° *
s
 = *
•
;

923 i‡(*
s
 == '-')

924 
s
++;

927 i‡(*
s
 == '0') {

928 
s
++;

930 i‡(!
	`is_digô
(*
s
))

931  
Ál£
;

933 
s
++;

934 } 
	`is_digô
(*
s
));

938 i‡(*
s
 == '.') {

939 
s
++;

940 i‡(!
	`is_digô
(*
s
))

941  
Ál£
;

943 
s
++;

944 } 
	`is_digô
(*
s
));

948 i‡(*
s
 == 'E' || *s == 'e') {

949 
s
++;

950 i‡(*
s
 == '+' || *s == '-')

951 
s
++;

952 i‡(!
	`is_digô
(*
s
))

953  
Ál£
;

955 
s
++;

956 } 
	`is_digô
(*
s
));

959 i‡(
out
)

960 *
out
 = 
	`°πod
(*
•
, 
NULL
);

962 *
•
 = 
s
;

963  
åue
;

964 
	}
}

966 
	$skù_•a˚
(c⁄° **
•
)

968 c⁄° *
s
 = *
•
;

969 
	`is_•a˚
(*
s
))

970 
s
++;

971 *
•
 = 
s
;

972 
	}
}

974 
	$emô_vÆue
(
SB
 *
out
, c⁄° 
Js⁄Node
 *
node
)

976 
	`as£π
(
	`èg_is_vÆid
(
node
->
èg
));

977 
node
->
èg
) {

978 
JSON_NULL
:

979 
	`sb_puts
(
out
, "null");

981 
JSON_BOOL
:

982 
	`sb_puts
(
out
, 
node
->
boﬁ_
 ? "true" : "false");

984 
JSON_STRING
:

985 
	`emô_°rög
(
out
, 
node
->
°rög_
);

987 
JSON_NUMBER
:

988 
	`emô_numbî
(
out
, 
node
->
numbî_
);

990 
JSON_ARRAY
:

991 
	`emô_¨øy
(
out
, 
node
);

993 
JSON_OBJECT
:

994 
	`emô_obje˘
(
out
, 
node
);

997 
	`as£π
(
Ál£
);

999 
	}
}

1001 
	$emô_vÆue_ödíãd
(
SB
 *
out
, c⁄° 
Js⁄Node
 *
node
, c⁄° *
•a˚
, 
ödít_Àvñ
)

1003 
	`as£π
(
	`èg_is_vÆid
(
node
->
èg
));

1004 
node
->
èg
) {

1005 
JSON_NULL
:

1006 
	`sb_puts
(
out
, "null");

1008 
JSON_BOOL
:

1009 
	`sb_puts
(
out
, 
node
->
boﬁ_
 ? "true" : "false");

1011 
JSON_STRING
:

1012 
	`emô_°rög
(
out
, 
node
->
°rög_
);

1014 
JSON_NUMBER
:

1015 
	`emô_numbî
(
out
, 
node
->
numbî_
);

1017 
JSON_ARRAY
:

1018 
	`emô_¨øy_ödíãd
(
out
, 
node
, 
•a˚
, 
ödít_Àvñ
);

1020 
JSON_OBJECT
:

1021 
	`emô_obje˘_ödíãd
(
out
, 
node
, 
•a˚
, 
ödít_Àvñ
);

1024 
	`as£π
(
Ál£
);

1026 
	}
}

1028 
	$emô_¨øy
(
SB
 *
out
, c⁄° 
Js⁄Node
 *
¨øy
)

1030 c⁄° 
Js⁄Node
 *
ñemít
;

1032 
	`sb_putc
(
out
, '[');

1033 
	`js⁄_f‹óch
(
ñemít
, 
¨øy
) {

1034 
	`emô_vÆue
(
out
, 
ñemít
);

1035 i‡(
ñemít
->
√xt
 !
NULL
)

1036 
	`sb_putc
(
out
, ',');

1038 
	`sb_putc
(
out
, ']');

1039 
	}
}

1041 
	$emô_¨øy_ödíãd
(
SB
 *
out
, c⁄° 
Js⁄Node
 *
¨øy
, c⁄° *
•a˚
, 
ödít_Àvñ
)

1043 c⁄° 
Js⁄Node
 *
ñemít
 = 
¨øy
->
chûdªn
.
hód
;

1044 
i
;

1046 i‡(
ñemít
 =
NULL
) {

1047 
	`sb_puts
(
out
, "[]");

1051 
	`sb_puts
(
out
, "[\n");

1052 
ñemít
 !
NULL
) {

1053 
i
 = 0; i < 
ödít_Àvñ
 + 1; i++)

1054 
	`sb_puts
(
out
, 
•a˚
);

1055 
	`emô_vÆue_ödíãd
(
out
, 
ñemít
, 
•a˚
, 
ödít_Àvñ
 + 1);

1057 
ñemít
 =ÉÀmít->
√xt
;

1058 
	`sb_puts
(
out
, 
ñemít
 !
NULL
 ? ",\n" : "\n");

1060 
i
 = 0; i < 
ödít_Àvñ
; i++)

1061 
	`sb_puts
(
out
, 
•a˚
);

1062 
	`sb_putc
(
out
, ']');

1063 
	}
}

1065 
	$emô_obje˘
(
SB
 *
out
, c⁄° 
Js⁄Node
 *
obje˘
)

1067 c⁄° 
Js⁄Node
 *
membî
;

1069 
	`sb_putc
(
out
, '{');

1070 
	`js⁄_f‹óch
(
membî
, 
obje˘
) {

1071 
	`emô_°rög
(
out
, 
membî
->
key
);

1072 
	`sb_putc
(
out
, ':');

1073 
	`emô_vÆue
(
out
, 
membî
);

1074 i‡(
membî
->
√xt
 !
NULL
)

1075 
	`sb_putc
(
out
, ',');

1077 
	`sb_putc
(
out
, '}');

1078 
	}
}

1080 
	$emô_obje˘_ödíãd
(
SB
 *
out
, c⁄° 
Js⁄Node
 *
obje˘
, c⁄° *
•a˚
, 
ödít_Àvñ
)

1082 c⁄° 
Js⁄Node
 *
membî
 = 
obje˘
->
chûdªn
.
hód
;

1083 
i
;

1085 i‡(
membî
 =
NULL
) {

1086 
	`sb_puts
(
out
, "{}");

1090 
	`sb_puts
(
out
, "{\n");

1091 
membî
 !
NULL
) {

1092 
i
 = 0; i < 
ödít_Àvñ
 + 1; i++)

1093 
	`sb_puts
(
out
, 
•a˚
);

1094 
	`emô_°rög
(
out
, 
membî
->
key
);

1095 
	`sb_puts
(
out
, ": ");

1096 
	`emô_vÆue_ödíãd
(
out
, 
membî
, 
•a˚
, 
ödít_Àvñ
 + 1);

1098 
membî
 = membî->
√xt
;

1099 
	`sb_puts
(
out
, 
membî
 !
NULL
 ? ",\n" : "\n");

1101 
i
 = 0; i < 
ödít_Àvñ
; i++)

1102 
	`sb_puts
(
out
, 
•a˚
);

1103 
	`sb_putc
(
out
, '}');

1104 
	}
}

1106 
	$emô_°rög
(
SB
 *
out
, c⁄° *
°r
)

1108 
boﬁ
 
esˇ≥_unicode
 = 
Ál£
;

1109 c⁄° *
s
 = 
°r
;

1110 *
b
;

1112 
	`as£π
(
	`utf8_vÆid©e
(
°r
));

1118 
	`sb_√ed
(
out
, 14);

1119 
b
 = 
out
->
cur
;

1121 *
b
++ = '"';

1122 *
s
 != 0) {

1123 
c
 = *
s
++;

1126 
c
) {

1128 *
b
++ = '\\';

1129 *
b
++ = '"';

1132 *
b
++ = '\\';

1133 *
b
++ = '\\';

1136 *
b
++ = '\\';

1137 *
b
++ = 'b';

1140 *
b
++ = '\\';

1141 *
b
++ = 'f';

1144 *
b
++ = '\\';

1145 *
b
++ = 'n';

1148 *
b
++ = '\\';

1149 *
b
++ = 'r';

1152 *
b
++ = '\\';

1153 *
b
++ = 't';

1156 
Àn
;

1158 
s
--;

1159 
Àn
 = 
	`utf8_vÆid©e_cz
(
s
);

1161 i‡(
Àn
 == 0) {

1170 
	`as£π
(
Ál£
);

1171 i‡(
esˇ≥_unicode
) {

1172 
	`°r˝y
(
b
, "\\uFFFD");

1173 
b
 += 6;

1175 *
b
++ = 0xEF;

1176 *
b
++ = 0xBF;

1177 *
b
++ = 0xBD;

1179 
s
++;

1180 } i‡(
c
 < 0x1F || (¯>0x80 && 
esˇ≥_unicode
)) {

1182 
uöt32_t
 
unicode
;

1184 
s
 +
	`utf8_ªad_ch¨
(s, &
unicode
);

1186 i‡(
unicode
 <= 0xFFFF) {

1187 *
b
++ = '\\';

1188 *
b
++ = 'u';

1189 
b
 +
	`wrôe_hex16
(b, 
unicode
);

1192 
uöt16_t
 
uc
, 
lc
;

1193 
	`as£π
(
unicode
 <= 0x10FFFF);

1194 
	`to_suºog©e_∑ú
(
unicode
, &
uc
, &
lc
);

1195 *
b
++ = '\\';

1196 *
b
++ = 'u';

1197 
b
 +
	`wrôe_hex16
(b, 
uc
);

1198 *
b
++ = '\\';

1199 *
b
++ = 'u';

1200 
b
 +
	`wrôe_hex16
(b, 
lc
);

1204 
Àn
--)

1205 *
b
++ = *
s
++;

1216 
out
->
cur
 = 
b
;

1217 
	`sb_√ed
(
out
, 14);

1218 
b
 = 
out
->
cur
;

1220 *
b
++ = '"';

1222 
out
->
cur
 = 
b
;

1223 
	}
}

1225 
	$emô_numbî
(
SB
 *
out
, 
num
)

1233 
buf
[64];

1234 
	`•rötf
(
buf
, "%.16g", 
num
);

1236 i‡(
	`numbî_is_vÆid
(
buf
))

1237 
	`sb_puts
(
out
, 
buf
);

1239 
	`sb_puts
(
out
, "null");

1240 
	}
}

1242 
boﬁ
 
	$èg_is_vÆid
(
èg
)

1244  ( 
èg
 <
JSON_OBJECT
);

1245 
	}
}

1247 
boﬁ
 
	$numbî_is_vÆid
(c⁄° *
num
)

1249  (
	`∑r£_numbî
(&
num
, 
NULL
) && *num == '\0');

1250 
	}
}

1252 
boﬁ
 
	$ex≥˘_lôîÆ
(c⁄° **
•
, c⁄° *
°r
)

1254 c⁄° *
s
 = *
•
;

1256 *
°r
 != '\0')

1257 i‡(*
s
++ !*
°r
++)

1258  
Ál£
;

1260 *
•
 = 
s
;

1261  
åue
;

1262 
	}
}

1268 
boﬁ
 
	$∑r£_hex16
(c⁄° **
•
, 
uöt16_t
 *
out
)

1270 c⁄° *
s
 = *
•
;

1271 
uöt16_t
 
ªt
 = 0;

1272 
uöt16_t
 
i
;

1273 
uöt16_t
 
tmp
;

1274 
c
;

1276 
i
 = 0; i < 4; i++) {

1277 
c
 = *
s
++;

1278 i‡(
c
 >= '0' && c <= '9')

1279 
tmp
 = 
c
 - '0';

1280 i‡(
c
 >= 'A' && c <= 'F')

1281 
tmp
 = 
c
 - 'A' + 10;

1282 i‡(
c
 >= 'a' && c <= 'f')

1283 
tmp
 = 
c
 - 'a' + 10;

1285  
Ál£
;

1287 
ªt
 <<= 4;

1288 
ªt
 +
tmp
;

1291 i‡(
out
)

1292 *
out
 = 
ªt
;

1293 *
•
 = 
s
;

1294  
åue
;

1295 
	}
}

1301 
	$wrôe_hex16
(*
out
, 
uöt16_t
 
vÆ
)

1303 c⁄° *
hex
 = "0123456789ABCDEF";

1305 *
out
++ = 
hex
[(
vÆ
 >> 12) & 0xF];

1306 *
out
++ = 
hex
[(
vÆ
 >> 8) & 0xF];

1307 *
out
++ = 
hex
[(
vÆ
 >> 4) & 0xF];

1308 *
out
++ = 
hex
[ 
vÆ
 & 0xF];

1311 
	}
}

1313 
boﬁ
 
	$js⁄_check
(c⁄° 
Js⁄Node
 *
node
, 
îrmsg
[256])

1315 
	#¥obÀm
(...) do { \

1316 i‡(
îrmsg
 !
NULL
) \

1317 
	`¢¥ötf
(
îrmsg
, 256, 
__VA_ARGS__
); \

1318  
Ál£
; \

1319 } 0)

	)

1321 i‡(
node
->
key
 !
NULL
 && !
	`utf8_vÆid©e
(node->key))

1322 
	`¥obÀm
("key contains invalid UTF-8");

1324 i‡(!
	`èg_is_vÆid
(
node
->
èg
))

1325 
	`¥obÀm
("èg i†övÆid (%u)", 
node
->
èg
);

1327 i‡(
node
->
èg
 =
JSON_BOOL
) {

1328 i‡(
node
->
boﬁ_
 !
Ál£
 &&Çode->boﬁ_ !
åue
)

1329 
	`¥obÀm
("boﬁ_ i†√ôhî fÆ£ (%dËn‹Åruê(%d)", ()
Ál£
, ()
åue
);

1330 } i‡(
node
->
èg
 =
JSON_STRING
) {

1331 i‡(
node
->
°rög_
 =
NULL
)

1332 
	`¥obÀm
("string_ is NULL");

1333 i‡(!
	`utf8_vÆid©e
(
node
->
°rög_
))

1334 
	`¥obÀm
("string_ contains invalid UTF-8");

1335 } i‡(
node
->
èg
 =
JSON_ARRAY
 ||Çode->èg =
JSON_OBJECT
) {

1336 
Js⁄Node
 *
hód
 = 
node
->
chûdªn
.head;

1337 
Js⁄Node
 *
èû
 = 
node
->
chûdªn
.tail;

1339 i‡(
hód
 =
NULL
 || 
èû
 == NULL) {

1340 i‡(
hód
 !
NULL
)

1341 
	`¥obÀm
("tail is NULL, but head isÇot");

1342 i‡(
èû
 !
NULL
)

1343 
	`¥obÀm
("head is NULL, butÅail isÇot");

1345 
Js⁄Node
 *
chûd
;

1346 
Js⁄Node
 *
œ°
 = 
NULL
;

1348 i‡(
hód
->
¥ev
 !
NULL
)

1349 
	`¥obÀm
("First child'sÖrevÖointer isÇot NULL");

1351 
chûd
 = 
hód
; chûd !
NULL
; 
œ°
 = chûd, chûd = chûd->
√xt
) {

1352 i‡(
chûd
 =
node
)

1353 
	`¥obÀm
("node is its own child");

1354 i‡(
chûd
->
√xt
 == child)

1355 
	`¥obÀm
("child->next == child (cycle)");

1356 i‡(
chûd
->
√xt
 =
hód
)

1357 
	`¥obÀm
("child->next == head (cycle)");

1359 i‡(
chûd
->
∑ª¡
 !
node
)

1360 
	`¥obÀm
("child doesÇotÖoint backÅoÖarent");

1361 i‡(
chûd
->
√xt
 !
NULL
 && chûd->√xt->
¥ev
 != child)

1362 
	`¥obÀm
("child->next doesÇotÖoint backÅo child");

1364 i‡(
node
->
èg
 =
JSON_ARRAY
 && 
chûd
->
key
 !
NULL
)

1365 
	`¥obÀm
("ArrayÉlement's key isÇot NULL");

1366 i‡(
node
->
èg
 =
JSON_OBJECT
 && 
chûd
->
key
 =
NULL
)

1367 
	`¥obÀm
("Object member's key is NULL");

1369 i‡(!
	`js⁄_check
(
chûd
, 
îrmsg
))

1370  
Ál£
;

1373 i‡(
œ°
 !
èû
)

1374 
	`¥obÀm
("tail doesÇot matchÖointer found by startingát headánd followingÇextÜinks");

1378  
åue
;

1380 #unde‡
¥obÀm


1381 
	}
}

	@ccan/ccan/json/json.h

24 #i‚de‡
CCAN_JSON_H


25 
	#CCAN_JSON_H


	)

27 
	~<°dboﬁ.h
>

28 
	~<°ddef.h
>

31 
	mJSON_NULL
,

32 
	mJSON_BOOL
,

33 
	mJSON_STRING
,

34 
	mJSON_NUMBER
,

35 
	mJSON_ARRAY
,

36 
	mJSON_OBJECT
,

37 } 
	tJs⁄Tag
;

39 
Js⁄Node
 
	tJs⁄Node
;

41 
	sJs⁄Node


44 
Js⁄Node
 *
	m∑ª¡
;

45 
Js⁄Node
 *
	m¥ev
, *
	m√xt
;

48 *
	mkey
;

50 
Js⁄Tag
 
	mèg
;

53 
boﬁ
 
	mboﬁ_
;

56 *
	m°rög_
;

59 
	mnumbî_
;

64 
Js⁄Node
 *
	mhód
, *
	mèû
;

65 } 
	mchûdªn
;

71 
Js⁄Node
 *
js⁄_decode
 (c⁄° *
js⁄
);

72 *
js⁄_ícode
 (c⁄° 
Js⁄Node
 *
node
);

73 *
js⁄_ícode_°rög
 (c⁄° *
°r
);

74 *
js⁄_°rögify
 (c⁄° 
Js⁄Node
 *
node
, c⁄° *
•a˚
);

75 
js⁄_dñëe
 (
Js⁄Node
 *
node
);

77 
boﬁ
 
js⁄_vÆid©e
 (c⁄° *
js⁄
);

81 
Js⁄Node
 *
js⁄_föd_ñemít
 (Js⁄Nodê*
¨øy
, 
ödex
);

82 
Js⁄Node
 *
js⁄_föd_membî
 (Js⁄Nodê*
obje˘
, c⁄° *
key
);

84 
Js⁄Node
 *
js⁄_fú°_chûd
 (c⁄° Js⁄Nodê*
node
);

86 
	#js⁄_f‹óch
(
i
, 
obje˘_‹_¨øy
) \

87 (
i
Ë
	`js⁄_fú°_chûd
(
obje˘_‹_¨øy
); \

88 (
i
Ë!
NULL
; \

89 (
i
Ë(i)->
√xt
)

	)

93 
Js⁄Node
 *
js⁄_mknuŒ
();

94 
Js⁄Node
 *
js⁄_mkboﬁ
(
boﬁ
 
b
);

95 
Js⁄Node
 *
js⁄_mk°rög
(c⁄° *
s
);

96 
Js⁄Node
 *
js⁄_mknumbî
(
n
);

97 
Js⁄Node
 *
js⁄_mk¨øy
();

98 
Js⁄Node
 *
js⁄_mkobje˘
();

100 
js⁄_≠≥nd_ñemít
(
Js⁄Node
 *
¨øy
, Js⁄Nodê*
ñemít
);

101 
js⁄_¥ïíd_ñemít
(
Js⁄Node
 *
¨øy
, Js⁄Nodê*
ñemít
);

102 
js⁄_≠≥nd_membî
(
Js⁄Node
 *
obje˘
, c⁄° *
key
, Js⁄Nodê*
vÆue
);

103 
js⁄_¥ïíd_membî
(
Js⁄Node
 *
obje˘
, c⁄° *
key
, Js⁄Nodê*
vÆue
);

105 
js⁄_ªmove_‰om_∑ª¡
(
Js⁄Node
 *
node
);

115 
boﬁ
 
js⁄_check
(c⁄° 
Js⁄Node
 *
node
, 
îrmsg
[256]);

	@ccan/ccan/json/test/common.h

1 
	~<cˇn/js⁄/js⁄.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	~<î∫o.h
>

5 
	~<°rög.h
>

7 *
	$chomp
(*
s
)

9 *
e
;

11 i‡(
s
 =
NULL
 || *s == 0)

12  
s
;

14 
e
 = 
	`°rchr
(
s
, 0);

15 i‡(
e
[-1] == '\n')

16 *--
e
 = 0;

17  
s
;

18 
	}
}

	@ccan/ccan/json/test/run-construction.c

3 
	~"comm⁄.h
"

5 
	#should_be
(
v¨
, 
ex≥˘ed
Ë
	`should_be_
(v¨, #v¨,Éx≥˘ed)

	)

7 
	$should_be_
(c⁄° 
Js⁄Node
 *
node
, c⁄° *
«me
, c⁄° *
ex≥˘ed
)

9 
îrmsg
[256];

10 *
ícoded
;

12 i‡(!
	`js⁄_check
(
node
, 
îrmsg
)) {

13 
	`Áû
("Inv¨ü¡†check faûed: %s", 
îrmsg
);

17 
ícoded
 = 
	`js⁄_ícode
(
node
);

19 i‡(
	`°rcmp
(
ícoded
, 
ex≥˘ed
) == 0)

20 
	`∑ss
("%†i†%s", 
«me
, 
ex≥˘ed
);

22 
	`Áû
("%†should bê%s, buài†a˘uÆly %s", 
«me
, 
ex≥˘ed
, 
ícoded
);

24 
	`‰ì
(
ícoded
);

25 
	}
}

27 
	$ã°_°rög
()

29 
Js⁄Node
 *
°r
;

31 
°r
 = 
	`js⁄_mk°rög
("Hello\tworld!\n\001");

32 
	`should_be
(
°r
, "\"Hello\\tworld!\\n\\u0001\"");

33 
	`js⁄_dñëe
(
°r
);

35 
°r
 = 
	`js⁄_mk°rög
("\"\\\b\f\n\r\t");

36 
	`should_be
(
°r
, "\"\\\"\\\\\\b\\f\\n\\r\\t\"");

37 
	`js⁄_dñëe
(
°r
);

38 
	}
}

40 
	$ã°_numbî
()

42 
Js⁄Node
 *
num
;

44 
num
 = 
	`js⁄_mknumbî
(5678901234.0);

45 
	`should_be
(
num
, "5678901234");

46 
	`js⁄_dñëe
(
num
);

48 
num
 = 
	`js⁄_mknumbî
(-5678901234.0);

49 
	`should_be
(
num
, "-5678901234");

50 
	`js⁄_dñëe
(
num
);

52 
num
 = 
	`js⁄_mknumbî
(0.0 / 0.0);

53 
	`should_be
(
num
, "null");

54 
	`js⁄_dñëe
(
num
);

55 
	}
}

57 
	$ã°_¨øy
()

59 
Js⁄Node
 *
¨øy
;

60 
Js⁄Node
 *
chûdªn
[5 + 1];

62 
¨øy
 = 
	`js⁄_mk¨øy
();

63 
	`should_be
(
¨øy
, "[]");

65 
chûdªn
[1] = 
	`js⁄_mknumbî
(1);

66 
chûdªn
[2] = 
	`js⁄_mknumbî
(2);

67 
chûdªn
[3] = 
	`js⁄_mknumbî
(3);

68 
chûdªn
[4] = 
	`js⁄_mknumbî
(4);

69 
chûdªn
[5] = 
	`js⁄_mknumbî
(5);

71 
	`js⁄_≠≥nd_ñemít
(
¨øy
, 
chûdªn
[3]);

72 
	`should_be
(
¨øy
, "[3]");

74 
	`js⁄_ªmove_‰om_∑ª¡
(
chûdªn
[3]);

75 
	`should_be
(
¨øy
, "[]");

77 
	`js⁄_¥ïíd_ñemít
(
¨øy
, 
chûdªn
[3]);

78 
	`should_be
(
¨øy
, "[3]");

80 
	`js⁄_¥ïíd_ñemít
(
¨øy
, 
chûdªn
[2]);

81 
	`should_be
(
¨øy
, "[2,3]");

83 
	`js⁄_≠≥nd_ñemít
(
¨øy
, 
chûdªn
[4]);

84 
	`should_be
(
¨øy
, "[2,3,4]");

86 
	`js⁄_dñëe
(
chûdªn
[3]);

87 
	`should_be
(
¨øy
, "[2,4]");

89 
	`js⁄_¥ïíd_ñemít
(
¨øy
, 
chûdªn
[1]);

90 
	`should_be
(
¨øy
, "[1,2,4]");

92 
	`js⁄_dñëe
(
chûdªn
[1]);

93 
	`should_be
(
¨øy
, "[2,4]");

95 
	`js⁄_dñëe
(
chûdªn
[4]);

96 
	`should_be
(
¨øy
, "[2]");

98 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 0Ë=
chûdªn
[2]);

99 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, -1Ë=
NULL
);

100 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 1Ë=
NULL
);

102 
	`js⁄_≠≥nd_ñemít
(
¨øy
, 
chûdªn
[5]);

103 
	`should_be
(
¨øy
, "[2,5]");

105 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 0Ë=
chûdªn
[2]);

106 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 1Ë=
chûdªn
[5]);

107 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, -1Ë=
NULL
);

108 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 2Ë=
NULL
);

110 
	`js⁄_dñëe
(
chûdªn
[2]);

111 
	`js⁄_dñëe
(
chûdªn
[5]);

112 
	`should_be
(
¨øy
, "[]");

114 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, -1Ë=
NULL
);

115 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 0Ë=
NULL
);

116 
	`ok1
(
	`js⁄_föd_ñemít
(
¨øy
, 1Ë=
NULL
);

118 
	`js⁄_dñëe
(
¨øy
);

119 
	}
}

121 
	$ã°_obje˘
()

123 
Js⁄Node
 *
obje˘
;

124 
Js⁄Node
 *
chûdªn
[5 + 1];

126 
obje˘
 = 
	`js⁄_mkobje˘
();

127 
	`should_be
(
obje˘
, "{}");

129 
chûdªn
[1] = 
	`js⁄_mknumbî
(1);

130 
chûdªn
[2] = 
	`js⁄_mknumbî
(2);

131 
chûdªn
[3] = 
	`js⁄_mknumbî
(3);

133 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "⁄e"Ë=
NULL
);

134 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "two"Ë=
NULL
);

135 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "thªe"Ë=
NULL
);

137 
	`js⁄_≠≥nd_membî
(
obje˘
, "⁄e", 
chûdªn
[1]);

138 
	`should_be
(
obje˘
, "{\"one\":1}");

140 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "⁄e"Ë=
chûdªn
[1]);

141 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "two"Ë=
NULL
);

142 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "thªe"Ë=
NULL
);

144 
	`js⁄_¥ïíd_membî
(
obje˘
, "two", 
chûdªn
[2]);

145 
	`should_be
(
obje˘
, "{\"two\":2,\"one\":1}");

147 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "⁄e"Ë=
chûdªn
[1]);

148 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "two"Ë=
chûdªn
[2]);

149 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "thªe"Ë=
NULL
);

151 
	`js⁄_≠≥nd_membî
(
obje˘
, "thªe", 
chûdªn
[3]);

152 
	`should_be
(
obje˘
, "{\"two\":2,\"one\":1,\"three\":3}");

154 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "⁄e"Ë=
chûdªn
[1]);

155 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "two"Ë=
chûdªn
[2]);

156 
	`ok1
(
	`js⁄_föd_membî
(
obje˘
, "thªe"Ë=
chûdªn
[3]);

158 
	`js⁄_dñëe
(
obje˘
);

159 
	}
}

161 
	$maö
()

163 
Js⁄Node
 *
node
;

165 (Ë
chomp
;

167 
	`∂™_ã°s
(49);

169 
	`ok1
(
	`js⁄_föd_ñemít
(
NULL
, 0) == NULL);

170 
	`ok1
(
	`js⁄_föd_membî
(
NULL
, "") == NULL);

171 
	`ok1
(
	`js⁄_fú°_chûd
(
NULL
) == NULL);

173 
node
 = 
	`js⁄_mknuŒ
();

174 
	`should_be
(
node
, "null");

175 
	`js⁄_dñëe
(
node
);

177 
node
 = 
	`js⁄_mkboﬁ
(
Ál£
);

178 
	`should_be
(
node
, "false");

179 
	`js⁄_dñëe
(
node
);

181 
node
 = 
	`js⁄_mkboﬁ
(
åue
);

182 
	`should_be
(
node
, "true");

183 
	`js⁄_dñëe
(
node
);

185 
	`ã°_°rög
();

186 
	`ã°_numbî
();

187 
	`ã°_¨øy
();

188 
	`ã°_obje˘
();

190  
	`exô_°©us
();

191 
	}
}

	@ccan/ccan/json/test/run-decode-encode.c

1 
	~"comm⁄.h
"

3 
	$maö
()

5 c⁄° *
°rögs_fûe
 = "test/test-strings";

6 c⁄° *
°rögs_ªícoded_fûe
 = "test/test-strings-reencoded";

7 
FILE
 *
f
, *
f2
;

8 
buf„r
[1024], 
buf„r2
[1024];

10 
	`∂™_ã°s
(90);

12 
f
 = 
	`f›í
(
°rögs_fûe
, "rb");

13 i‡(
f
 =
NULL
) {

14 
	`düg
("CouldÇŸ o≥¿%s: %s", 
°rögs_fûe
, 
	`°ªº‹
(
î∫o
));

17 
f2
 = 
	`f›í
(
°rögs_ªícoded_fûe
, "rb");

18 i‡(
f2
 =
NULL
) {

19 
	`düg
("CouldÇŸ o≥¿%s: %s", 
°rögs_ªícoded_fûe
, 
	`°ªº‹
(
î∫o
));

23 
	`fgës
(
buf„r
, (buf„r), 
f
)) {

24 c⁄° *
s
 = 
	`chomp
(
buf„r
);

25 
boﬁ
 
vÆid
;

26 
Js⁄Node
 *
node
;

28 i‡(
	`ex≥˘_lôîÆ
(&
s
, "valid ")) {

29 
vÆid
 = 
åue
;

30 } i‡(
	`ex≥˘_lôîÆ
(&
s
, "invalid ")) {

31 
vÆid
 = 
Ál£
;

33 
	`Áû
("InvÆidÜöêöÅe°-°rögs: %s", 
buf„r
);

37 
node
 = 
	`js⁄_decode
(
s
);

39 i‡(
vÆid
) {

40 *
ªícoded
;

41 
îrmsg
[256];

43 i‡(
node
 =
NULL
) {

44 
	`Áû
("%†i†vÆid, buàjs⁄_decodêªtu∫ed NULL", 
s
);

48 i‡(!
	`js⁄_check
(
node
, 
îrmsg
)) {

49 
	`Áû
("C‹ru±Åªê¥odu˚d by js⁄_decode: %s", 
îrmsg
);

53 
ªícoded
 = 
	`js⁄_ícode
(
node
);

55 i‡(!
	`fgës
(
buf„r2
, (buf„r2), 
f2
)) {

56 
	`Áû
("ã°-°rögs-ªícoded i†missögÅhi†löe: %s", 
ªícoded
);

59 
	`chomp
(
buf„r2
);

61 
	`ok
(
	`°rcmp
(
ªícoded
, 
buf„r2
Ë=0, "ª-ícodê%†-> %s", 
s
,Ñeencoded);

63 
	`‰ì
(
ªícoded
);

64 
	`js⁄_dñëe
(
node
);

65 } i‡(
node
 !
NULL
) {

66 
	`Áû
("%†i†övÆid, buàjs⁄_decodêªtu∫edÇ⁄-NULL", 
s
);

71 i‡(
	`„º‹
(
f
Ë|| 
	`f˛o£
(fË!0 || fîr‹(
f2
) || fclose(f2) != 0) {

72 
	`düg
("I/OÉrrorÑeadingÅest data.");

76  
	`exô_°©us
();

77 
	}
}

	@ccan/ccan/json/test/run-stringify.c

1 
	~"comm⁄.h
"

3 
	gbuf1
[256], 
	gbuf2
[256];

6 *
	$quŸe_°rög
(c⁄° *
°r
, 
buf
[256])

8 *
out
 = 
buf
;

10 *
out
++ = '"';

11 ; *
°r
 != 0; str++) {

12 i‡(
out
 - 
buf
 > 256 - 5) {

14 
out
 = 
buf
 + 256 - 5;

15 *
out
++ = '.';

16 *
out
++ = '.';

17 *
out
++ = '.';

20 *
°r
) {

22 *
out
++ = '\\';

23 *
out
++ = 't';

26 *
out
++ = '\\';

27 *
out
++ = 'n';

30 *
out
++ = '\\';

31 *
out
++ = '"';

34 *
out
++ = '\\';

35 *
out
++ = '\\';

38 *
out
++ = *
°r
;

42 *
out
++ = '"';

44 *
out
 = 0;

45  
buf
;

46 
	}
}

48 
	$ã°_°rögify
(c⁄° *
öput
, c⁄° *
ex≥˘ed
)

50 
Js⁄Node
 *
node
 = 
NULL
;

51 *
íc
 = 
NULL
;

52 *
°∫
 = 
NULL
;

53 *
°r
 = 
NULL
;

55 
node
 = 
	`js⁄_decode
(
öput
);

56 i‡(
node
 =
NULL
) {

57 
	`Áû
("FaûedÅÿdecodê%s", 
öput
);

58 
íd
;

61 
íc
 = 
	`js⁄_ícode
(
node
);

62 i‡(
	`°rcmp
(
íc
, 
öput
) != 0) {

63 
	`Áû
("%†ª-ícode†tÿ%s. EôhîÉncode/decodêi†brokí, o∏thêöpuà°rögÇìd†tÿbên‹mÆized", 
öput
, 
íc
);

64 
íd
;

67 
°∫
 = 
	`js⁄_°rögify
(
node
, 
NULL
);

68 i‡(
	`°rcmp
(
°∫
, 
íc
) != 0) {

69 
	`Áû
("json_stringify with NULL spaceÖroducedá different stringÅhan json_encode");

70 
íd
;

73 
°r
 = 
	`js⁄_°rögify
(
node
, "\t");

74 i‡(
	`°rcmp
(
°r
, 
ex≥˘ed
) != 0) {

75 
	`Áû
("Expected %s, but json_stringifyÖroduced %s",

76 
	`quŸe_°rög
(
ex≥˘ed
, 
buf1
), quŸe_°rög(
°r
, 
buf2
));

77 
íd
;

80 
	`∑ss
("°rögify %s", 
öput
);

82 
íd
:

83 
	`js⁄_dñëe
(
node
);

84 
	`‰ì
(
íc
);

85 
	`‰ì
(
°∫
);

86 
	`‰ì
(
°r
);

87 
	}
}

89 
	$maö
()

91 (Ë
chomp
;

93 
	`∂™_ã°s
(9);

95 
	`ã°_°rögify
("[]", "[]");

96 
	`ã°_°rögify
("[1]", "[\n\t1\n]");

97 
	`ã°_°rögify
("[1,2,3]", "[\n\t1,\n\t2,\n\t3\n]");

98 
	`ã°_°rögify
("[[]]", "[\n\t[]\n]");

99 
	`ã°_°rögify
("[[1,2],[3,4]]", "[\n\t[\n\t\t1,\n\t\t2\n\t],\n\t[\n\t\t3,\n\t\t4\n\t]\n]");

101 
	`ã°_°rögify
("{}", "{}");

102 
	`ã°_°rögify
("{\"one\":1}", "{\n\t\"one\": 1\n}");

103 
	`ã°_°rögify
("{\"one\":1,\"t*\":[2,3,10]}", "{\n\t\"one\": 1,\n\t\"t*\": [\n\t\t2,\n\t\t3,\n\t\t10\n\t]\n}");

104 
	`ã°_°rögify
("{\"a\":{\"1\":1,\"2\":2},\"b\":{\"3\":[null,false,true,\"\\f\"]}}",

107  
	`exô_°©us
();

108 
	}
}

	@ccan/ccan/json/test/run-validate.c

1 
	~"comm⁄.h
"

3 
	$maö
()

5 c⁄° *
°rögs_fûe
 = "test/test-strings";

6 
FILE
 *
f
;

7 
buf„r
[1024];

9 
	`∂™_ã°s
(224);

11 
f
 = 
	`f›í
(
°rögs_fûe
, "rb");

12 i‡(
f
 =
NULL
) {

13 
	`düg
("CouldÇŸ o≥¿%s: %s", 
°rögs_fûe
, 
	`°ªº‹
(
î∫o
));

17 
	`fgës
(
buf„r
, (buf„r), 
f
)) {

18 c⁄° *
s
 = 
	`chomp
(
buf„r
);

19 
boﬁ
 
vÆid
;

21 i‡(
	`ex≥˘_lôîÆ
(&
s
, "valid ")) {

22 
vÆid
 = 
åue
;

23 } i‡(
	`ex≥˘_lôîÆ
(&
s
, "invalid ")) {

24 
vÆid
 = 
Ál£
;

26 
	`Áû
("InvÆidÜöêöÅe°-°rögs: %s", 
buf„r
);

30 i‡(
	`°rcmp
(
s
, "\"1\\u2\"") == 0)

31 
	`puts
("here");

33 i‡(
	`js⁄_vÆid©e
(
s
Ë=
vÆid
) {

34 
	`∑ss
("%†%s", 
vÆid
 ? "vÆid" : "övÆid", 
s
);

36 
	`Áû
("%s is %s, but json_validateÑeturned %s",

37 
s
,

38 
vÆid
 ? "valid" : "invalid",

39 
vÆid
 ? "false" : "true");

43 i‡(
	`„º‹
(
f
Ë|| 
	`f˛o£
(f) != 0) {

44 
	`düg
("I/OÉrrorÑeadingÅest strings.");

48  
	`exô_°©us
();

49 
	}
}

	@ccan/ccan/lbalance/lbalance.c

2 
	~<cˇn/lbÆ™˚/lbÆ™˚.h
>

3 
	~<cˇn/éi°/éi°.h
>

4 
	~<sys/time.h
>

5 
	~<sys/ªsour˚.h
>

6 
	~<uni°d.h
>

7 
	~<î∫o.h
>

8 
	~<as£π.h
>

9 
	~<°dlib.h
>

12 
TLIST_TYPE
(
lbÆ™˚_èsk
, lbalance_task);

14 
	s°©s
 {

16 
	mnum_°©s
;

18 
	mw‹k_øã
;

21 
	slbÆ™˚
 {

22 
éi°_lbÆ™˚_èsk
 
	mèsks
;

23 
	mnum_èsks
;

26 
	mèrgë
;

28 
boﬁ
 
	mèrgë_u±od©e
;

31 
timevÆ
 
	m¥ev_èsks_time
;

32 
	mèsks_sum
;

35 
rußge
 
	m¥ev_ußge
;

38 
	mtŸÆ_°©s
;

41 
	mmax_°©s
;

42 
°©s
 *
	m°©s
;

45 
	slbÆ™˚_èsk
 {

46 
lbÆ™˚
 *
	mlb
;

47 
li°_node
 
	mli°
;

50 
timevÆ
 
	m°¨t
;

51 
	mèsks_sum_°¨t
;

54 
lbÆ™˚
 *
	$lbÆ™˚_√w
()

56 
lbÆ™˚
 *
lb
 = 
	`mÆloc
( *lb);

57 i‡(!
lb
)

58  
NULL
;

60 
	`éi°_öô
(&
lb
->
èsks
);

61 
lb
->
num_èsks
 = 0;

62 
	`gëtimeofday
(&
lb
->
¥ev_èsks_time
, 
NULL
);

63 
lb
->
èsks_sum
 = 0.0;

65 
	`gërußge
(
RUSAGE_CHILDREN
, &
lb
->
¥ev_ußge
);

67 
lb
->
max_°©s
 = 1;

68 
lb
->
°©s
 = 
	`mÆloc
(÷b->°©s[0]Ë*Üb->
max_°©s
);

69 i‡(!
lb
->
°©s
) {

70 
	`‰ì
(
lb
);

71  
NULL
;

73 
lb
->
°©s
[0].
num_°©s
 = 0;

74 
lb
->
°©s
[0].
w‹k_øã
 = 0.0;

75 
lb
->
tŸÆ_°©s
 = 0;

78 
lb
->
èrgë
 = -1L;

79 #ifde‡
_SC_NPROCESSORS_ONLN


80 
lb
->
èrgë
 = 
	`sysc⁄f
(
_SC_NPROCESSORS_ONLN
);

81 #ñi‡
	`deföed
(
_SC_NPROCESSORS_CONF
)

82 i‡(
lb
->
èrgë
 == ()-1L)

83 
lb
->
èrgë
 = 
	`sysc⁄f
(
_SC_NPROCESSORS_CONF
);

86 i‡(
lb
->
èrgë
 == ()-1L ||Üb->target < 2)

87 
lb
->
èrgë
 = 2;

88 
lb
->
èrgë_u±od©e
 = 
åue
;

90  
lb
;

91 
	}
}

94 
	$timevÆ_sub
(
timevÆ
 
ª˚¡
, timevÆ 
ﬁd
)

96 
diff
;

98 i‡(
ﬁd
.
tv_u£c
 > 
ª˚¡
.tv_usec) {

99 
diff
 = 1000000 + 
ª˚¡
.
tv_u£c
 - 
ﬁd
.tv_usec;

100 
ª˚¡
.
tv_£c
--;

102 
diff
 = 
ª˚¡
.
tv_u£c
 - 
ﬁd
.tv_usec;

104 
diff
 +()(
ª˚¡
.
tv_£c
 - 
ﬁd
.tv_sec) * 1000000;

105  
diff
;

106 
	}
}

109 
	$upd©e_èsks_sum
(
lbÆ™˚
 *
lb
,

110 c⁄° 
timevÆ
 *
now
)

112 
lb
->
èsks_sum
 +
	`timevÆ_sub
(*
now
,Üb->
¥ev_èsks_time
)

113 * 
lb
->
num_èsks
;

114 
lb
->
¥ev_èsks_time
 = *
now
;

115 
	}
}

117 
lbÆ™˚_èsk
 *
	$lbÆ™˚_èsk_√w
(
lbÆ™˚
 *
lb
)

119 
lbÆ™˚_èsk
 *
èsk
 = 
	`mÆloc
( *task);

120 i‡(!
èsk
)

121  
NULL
;

123 i‡(
lb
->
num_èsks
 + 1 =lb->
max_°©s
) {

124 
°©s
 *
s
 = 
	`ªÆloc
(
lb
->stats,

125 (*
s
Ë* (
lb
->
max_°©s
 + 1));

126 i‡(!
s
) {

127 
	`‰ì
(
èsk
);

128  
NULL
;

130 
lb
->
°©s
 = 
s
;

131 
lb
->
°©s
[lb->
max_°©s
].
num_°©s
 = 0;

132 
lb
->
°©s
[lb->
max_°©s
].
w‹k_øã
 = 0.0;

133 
lb
->
max_°©s
++;

136 
èsk
->
lb
 =Üb;

137 
	`gëtimeofday
(&
èsk
->
°¨t
, 
NULL
);

140 
	`upd©e_èsks_sum
(
lb
, &
èsk
->
°¨t
);

142 
èsk
->
èsks_sum_°¨t
 = 
lb
->
èsks_sum
;

143 
	`éi°_add_èû
(&
lb
->
èsks
, 
èsk
, 
li°
);

144 
lb
->
num_èsks
++;

146  
èsk
;

147 
	}
}

150 
	$degøde_°©s
(
lbÆ™˚
 *
lb
)

152 
i
;

154 i‡(
lb
->
tŸÆ_°©s
 <Üb->
max_°©s
 * 16)

158 
	`Ârötf
(
°dîr
, ".");

160 
i
 = 0; i < 
lb
->
max_°©s
; i++) {

161 
°©s
 *
s
 = &
lb
->°©s[
i
];

162 
°©s_lo°
 = (
s
->
num_°©s
 + 1) / 2;

163 
s
->
w‹k_øã
 *()(s->
num_°©s
 - 
°©s_lo°
)

164 / 
s
->
num_°©s
;

165 
s
->
num_°©s
 -
°©s_lo°
;

166 
lb
->
tŸÆ_°©s
 -
°©s_lo°
;

167 i‡(
s
->
num_°©s
 == 0)

168 
s
->
w‹k_øã
 = 0.0;

170 
	}
}

172 
	$add_to_°©s
(
lbÆ™˚
 *
lb
,

173 
num_èsks
,

174 
w‹k_øã
)

177 
	`Ârötf
(
°dîr
, "With %.2fÑunning, workÑate was %.5f\n",

178 
num_èsks
, 
w‹k_øã
);

180 
	`as£π
(
num_èsks
 >= 1);

181 
	`as£π
(
num_èsks
 < 
lb
->
max_°©s
);

183 
lb
->
°©s
[
num_èsks
].
num_°©s
++;

184 
lb
->
°©s
[
num_èsks
].
w‹k_øã
 += work_rate;

185 
lb
->
tŸÆ_°©s
++;

186 
lb
->
èrgë_u±od©e
 = 
Ál£
;

187 
	}
}

189 
	$lbÆ™˚_èsk_‰ì
(
lbÆ™˚_èsk
 *
èsk
,

190 c⁄° 
rußge
 *
ußge
)

192 
w‹k_d⁄e
, 
duøti⁄
;

193 
num_èsks
;

194 
timevÆ
 
now
;

195 
rußge
 
ru
;

197 
	`gëtimeofday
(&
now
, 
NULL
);

198 
duøti⁄
 = 
	`timevÆ_sub
(
now
, 
èsk
->
°¨t
);

200 
	`gërußge
(
RUSAGE_CHILDREN
, &
ru
);

201 i‡(
ußge
) {

202 
w‹k_d⁄e
 = 
ußge
->
ru_utime
.
tv_u£c
 + ußge->
ru_°ime
.tv_usec

203 + (
ußge
->
ru_utime
.
tv_£c
 + ußge->
ru_°ime
.tv_sec)

207 
w‹k_d⁄e
 = 
	`timevÆ_sub
(
ru
.
ru_utime
,

208 
èsk
->
lb
->
¥ev_ußge
.
ru_utime
)

209 + 
	`timevÆ_sub
(
ru
.
ru_°ime
,

210 
èsk
->
lb
->
¥ev_ußge
.
ru_utime
);

213 
èsk
->
lb
->
¥ev_ußge
 = 
ru
;

216 
	`upd©e_èsks_sum
(
èsk
->
lb
, &
now
);

219 
num_èsks
 = (
èsk
->
lb
->
èsks_sum
 -Åask->
èsks_sum_°¨t
)

220 / 
duøti⁄
 + 0.5;

223 
	`add_to_°©s
(
èsk
->
lb
, 
num_èsks
, 
w‹k_d⁄e
 / 
duøti⁄
);

226 
	`degøde_°©s
(
èsk
->
lb
);

229 
èsk
->
lb
->
èrgë_u±od©e
 = 
Ál£
;

232 
	`éi°_dñ_‰om
(&
èsk
->
lb
->
èsks
,Åask, 
li°
);

233 
èsk
->
lb
->
num_èsks
--;

234 
	`‰ì
(
èsk
);

235 
	}
}

243 
	$be°_èrgë
(c⁄° 
lbÆ™˚
 *
lb
)

245 
i
, 
found_dr›
 = 0;

246 
be°_f_max
 = -1.0, 
˛iff
 = -1.0;

249 
i
 = 1; i < 
lb
->
max_°©s
; i++) {

250 
	`¥ötf
("%u: %‡(%u)\n", 
i
,

251 
lb
->
°©s
[
i
].
w‹k_øã
 /Üb->°©s[i].
num_°©s
,

252 
lb
->
°©s
[
i
].
num_°©s
);

256 
i
 = 1; i < 
lb
->
max_°©s
; i++) {

257 
f
;

259 i‡(!
lb
->
°©s
[
i
].
num_°©s
)

260 
f
 = 0;

262 
f
 = 
lb
->
°©s
[
i
].
w‹k_øã
 /Üb->°©s[i].
num_°©s
;

264 i‡(
f
 > 
be°_f_max
) {

266 
	`¥ötf
("Be° i†%i\n", 
i
);

268 
be°_f_max
 = 
f
 - (‡/ (
i
 + 1)) / 4;

269 
˛iff
 = 
f
 - (‡/ (
i
 + 1)) / 2;

270 
found_dr›
 = 0;

271 } i‡(!
found_dr›
 && 
f
 < 
˛iff
) {

273 
	`¥ötf
("Found dr›áà%i\n", 
i
);

275 
found_dr›
 = 
i
;

279 i‡(
found_dr›
) {

280  
found_dr›
 - 1;

282  
i
 - 1;

283 
	}
}

285 
	$ˇlcuœã_èrgë
(
lbÆ™˚
 *
lb
)

287 
èrgë
;

289 
èrgë
 = 
	`be°_èrgë
(
lb
);

292 i‡(
èrgë
 >
lb
->
max_°©s
 ||Üb->
°©s
[èrgë].
num_°©s
 == 0)

293  
èrgë
;

295 i‡(
èrgë
 + 1 =
lb
->
max_°©s
 ||Üb->
°©s
[èrgë+1].
num_°©s
 == 0)

296  
èrgë
 + 1;

298 i‡(
èrgë
 > 1 && 
lb
->
°©s
[èrgë-1].
num_°©s
 == 0)

299  
èrgë
 - 1;

301  
èrgë
;

302 
	}
}

304 
	$lbÆ™˚_èrgë
(
lbÆ™˚
 *
lb
)

306 i‡(!
lb
->
èrgë_u±od©e
) {

307 
lb
->
èrgë
 = 
	`ˇlcuœã_èrgë
(lb);

308 
lb
->
èrgë_u±od©e
 = 
åue
;

310  
lb
->
èrgë
;

311 
	}
}

313 
	$lbÆ™˚_‰ì
(
lbÆ™˚
 *
lb
)

315 
lbÆ™˚_èsk
 *
èsk
;

317 (
èsk
 = 
	`éi°_t›
(&
lb
->
èsks
, 
li°
))) {

318 
	`as£π
(
èsk
->
lb
 ==Üb);

319 
	`éi°_dñ_‰om
(&
lb
->
èsks
, 
èsk
, 
li°
);

320 
lb
->
num_èsks
--;

321 
	`‰ì
(
èsk
);

323 
	`as£π
(
lb
->
num_èsks
 == 0);

324 
	`‰ì
(
lb
->
°©s
);

325 
	`‰ì
(
lb
);

326 
	}
}

	@ccan/ccan/lbalance/lbalance.h

2 #i‚de‡
CCAN_LBALANCE_H


3 
	#CCAN_LBALANCE_H


	)

4 
	~"c⁄fig.h
"

6 
	glbÆ™˚
;

7 
	glbÆ™˚_èsk
;

8 
	gtimevÆ
;

9 
	grußge
;

22 
lbÆ™˚
 *
lbÆ™˚_√w
();

30 
lbÆ™˚_‰ì
(
lbÆ™˚
 *lbalance);

49 
lbÆ™˚_èsk
 *
lbÆ™˚_èsk_√w
(
lbÆ™˚
 *lbalance);

78 
lbÆ™˚_èsk_‰ì
(
lbÆ™˚_èsk
 *
èsk
,

79 c⁄° 
rußge
 *
ußge
);

104 
lbÆ™˚_èrgë
(
lbÆ™˚
 *lbalance);

	@ccan/ccan/lbalance/test/run.c

1 
	~"c⁄fig.h
"

2 
	~<sys/time.h
>

3 
	~<sys/ªsour˚.h
>

4 
	~<uni°d.h
>

5 
	~<î∫o.h
>

7 
Áke_gëtimeofday
(
timevÆ
 *
tv
, 
timez⁄e
 *
tz
);

8 
Áke_gërußge
(
who
, 
rußge
 *
ußge
);

9 
	#gëtimeofday
 
Áke_gëtimeofday


	)

10 
	#gërußge
 
Áke_gërußge


	)

12 
	~<cˇn/lbÆ™˚/lbÆ™˚.c
>

13 
	~<cˇn/èp/èp.h
>

15 
	gÁkëime_ms
 = 0;

16 
rußge
 
	gtŸÆ_ußge
;

18 
	$Áke_gëtimeofday
(
timevÆ
 *
tv
, 
timez⁄e
 *
tz
)

20 
	`as£π
(
tz
 =
NULL
);

21 
tv
->
tv_u£c
 = (
Ákëime_ms
 % 1000) * 1000;

22 
tv
->
tv_£c
 = 
Ákëime_ms
 / 1000;

24 
	}
}

26 
	$Áke_gërußge
(
who
, 
rußge
 *
ußge
)

28 
	`as£π
(
who
 =
RUSAGE_CHILDREN
);

29 *
ußge
 = 
tŸÆ_ußge
;

31 
	}
}

33 
	$ã°_›timum
(
lbÆ™˚
 *
lb
, 
›timum
)

35 
j
, 
i
, 
num_èsks
 = 0, 
u£c
, 
num_cou¡ed
 = 0;

36 
avîage
;

37 
lbÆ™˚_èsk
 *
èsks
[1000];

39 
j
 = 0; j < 1000; j++) {

40 
	`düg
("lbÆ™˚_èrgë i†%u\n", 
	`lbÆ™˚_èrgë
(
lb
));

42 i‡(
	`lbÆ™˚_èrgë
(
lb
Ë=
›timum
 && 
num_cou¡ed
 == 0) {

43 
avîage
 = 
	`lbÆ™˚_èrgë
(
lb
);

44 
num_cou¡ed
 = 1;

45 } i‡(
num_cou¡ed
) {

46 
avîage
 +
	`lbÆ™˚_èrgë
(
lb
);

47 
num_cou¡ed
++;

51 
i
 = 0; i < 
	`lbÆ™˚_èrgë
(
lb
); i++) {

52 
èsks
[
i
] = 
	`lbÆ™˚_èsk_√w
(
lb
);

54 
num_èsks
 = 
i
;

56 
Ákëime_ms
 += 100;

58 i‡(
num_èsks
 <
›timum
) {

59 
u£c
 = 100000;

61 
u£c
 = 100000 * 
›timum
 / 
num_èsks
;

64 
i
 = 0; i < 
num_èsks
; i++) {

65 
tŸÆ_ußge
.
ru_utime
.
tv_u£c
 +
u£c
 / 2;

66 i‡(
tŸÆ_ußge
.
ru_utime
.
tv_u£c
 > 1000000) {

67 
tŸÆ_ußge
.
ru_utime
.
tv_u£c
 -= 1000000;

68 
tŸÆ_ußge
.
ru_utime
.
tv_£c
++;

70 
tŸÆ_ußge
.
ru_°ime
.
tv_u£c
 +
u£c
 / 2;

71 i‡(
tŸÆ_ußge
.
ru_°ime
.
tv_u£c
 > 1000000) {

72 
tŸÆ_ußge
.
ru_°ime
.
tv_u£c
 -= 1000000;

73 
tŸÆ_ußge
.
ru_°ime
.
tv_£c
++;

75 
	`lbÆ™˚_èsk_‰ì
(
èsks
[
i
], 
NULL
);

80 
	`ok1
(
num_cou¡ed
 && ()(
avîage
 /Çum_cou¡ed + 0.5Ë=
›timum
);

81 
	}
}

83 
	$maö
()

85 
lbÆ™˚
 *
lb
;

87 
	`∂™_ã°s
(4);

88 
lb
 = 
	`lbÆ™˚_√w
();

90 
	`ã°_›timum
(
lb
, 1);

91 
	`ã°_›timum
(
lb
, 2);

92 
	`ã°_›timum
(
lb
, 4);

93 
	`ã°_›timum
(
lb
, 64);

94 
	`lbÆ™˚_‰ì
(
lb
);

96  
	`exô_°©us
();

97 
	}
}

	@ccan/ccan/lbalance/tools/lbalance.c

1 
	~<cˇn/lbÆ™˚/lbÆ™˚.h
>

2 
	~<cˇn/lbÆ™˚/lbÆ™˚.c
>

3 
	~<cˇn/time/time.h
>

4 
	~<cˇn/jm≠/jm≠_ty≥.h
>

5 
	~<°dio.h
>

6 
	~<îr.h
>

9 
JMAP_DEFINE_UINTIDX_TYPE
(
lbÆ™˚_èsk
, 
èsk
);

12 
	gbu∫_cou¡
;

14 
	$ˇlibøã_bu∫_˝u
()

16 
timevÆ
 
°¨t
 = 
	`time_now
();

18 
	`time_Àss
(
	`time_now
(), 
	`time_add
(
°¨t
, 
	`time_‰om_m£c
(1000))))

19 
bu∫_cou¡
++;

20 
	`¥ötf
("Bu∫ cou¡ = %lu\n", 
bu∫_cou¡
);

21 
	}
}

23 
	$bu∫_˝u
()

25 
i
, 
a·î
 = 0;

26 
timevÆ
 
°¨t
 = 
	`time_now
();

29 
i
 = 0; i < 
bu∫_cou¡
; i++) {

30 
a·î
 +
	`time_Àss
(
	`time_now
(),

31 
	`time_add
(
°¨t
, 
	`time_‰om_m£c
(1000)));

34 
	`exô
(
a·î
);

35 
	}
}

37 
pid_t
 
	$•awn
(*
¨gs
[])

39 
pid_t
 
pid
 = 
	`f‹k
();

41 i‡(
pid
 == -1)

42 
	`îr
(1, "forking");

43 i‡(
pid
 == 0) {

44 i‡(!
¨gs
[0])

45 
	`bu∫_˝u
();

46 
	`execvp
(
¨gs
[0],árgs);

47 
	`îr
(1, "exec failed");

49  
pid
;

50 
	}
}

52 
	$maö
(
¨gc
, *
¨gv
[])

54 
i
, 
num
, 
fixed_èrgë
 = 0, 
num_d⁄e
 = 0, 
num_ru¬ög
 = 0;

55 
lbÆ™˚
 *
lb
;

56 
jm≠_èsk
 *
èsks
 = 
	`jm≠_èsk_√w
();

58 i‡(
¨gc
 < 2) {

59 
	`Ârötf
(
°dîr
,

62 
	`exô
(1);

65 i‡(
	`°∫cmp
(
¨gv
[1], "--fixed=", 
	`°æí
("--fixed=")) == 0) {

66 
fixed_èrgë
 = 
	`©oi
(
¨gv
[1] + 
	`°æí
("--fixed="));

67 i‡(!
fixed_èrgë
)

68 
	`îrx
(1, "NeedÖositiveÇumberáfter --fixed");

69 
¨gv
++;

70 
¨gc
--;

71 
lb
 = 
NULL
;

73 
lb
 = 
	`lbÆ™˚_√w
();

75 
num
 = 
	`©oi
(
¨gv
[1]);

76 
¨gv
++;

77 
¨gc
--;

79 i‡(!
¨gv
[1])

80 
	`ˇlibøã_bu∫_˝u
();

82 
num_d⁄e
 < 
num
) {

83 
j
, 
èrgë
 = 
fixed_èrgë
;

84 
lbÆ™˚_èsk
 *
èsk
;

85 
rußge
 
ru
;

86 
pid_t
 
pid
;

88 i‡(
lb
) {

89 
èrgë
 = 
	`lbÆ™˚_èrgë
(
lb
);

90 
	`¥ötf
("(%u)", 
èrgë
);

93 
num_ru¬ög
 < 
èrgë
 && 
num_d⁄e
 +Çum_ru¬ög < 
num
) {

94 
pid
 = 
	`•awn
(
¨gv
+1);

95 i‡(
lb
)

96 
èsk
 = 
	`lbÆ™˚_èsk_√w
(
lb
);

98 
èsk
 = (*)1;

99 
	`jm≠_èsk_add
(
èsks
, 
pid
, 
èsk
);

100 
num_ru¬ög
++;

101 
	`¥ötf
("+"); 
	`fÊush
(
°dout
);

105 
pid
 = 
	`waô3
(
NULL
, 0, &
ru
);

106 
èsk
 = 
	`jm≠_èsk_gë
(
èsks
, 
pid
);

107 i‡(
lb
)

108 
	`lbÆ™˚_èsk_‰ì
(
èsk
, &
ru
);

109 
num_d⁄e
++;

110 
num_ru¬ög
--;

111 
	`¥ötf
("-"); 
	`fÊush
(
°dout
);

113 
	`¥ötf
("\n");

114 i‡(
lb
)

115 
	`lbÆ™˚_‰ì
(
lb
);

117 
	}
}

	@ccan/ccan/likely/likely.c

2 #ifde‡
CCAN_LIKELY_DEBUG


3 
	~<cˇn/likñy/likñy.h
>

4 
	~<cˇn/hash/hash.h
>

5 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

6 
	~<°dlib.h
>

7 
	~<°dio.h
>

8 
	såa˚
 {

9 c⁄° *
	mc⁄d°r
;

10 c⁄° *
	mfûe
;

11 
	mlöe
;

12 
boﬁ
 
	mex≥˘
;

13 
	mcou¡
, 
	mright
;

16 
size_t
 
	$hash_åa˚
(c⁄° 
åa˚
 *trace)

18  
	`hash
(
åa˚
->
c⁄d°r
, 
	`°æí
(trace->condstr),

19 
	`hash
(
åa˚
->
fûe
, 
	`°æí
(trace->file),

20 
åa˚
->
löe
 +Åø˚->
ex≥˘
));

21 
	}
}

23 
boﬁ
 
	$åa˚_eq
(c⁄° 
åa˚
 *
t1
, c⁄° åa˚ *
t2
)

25  
t1
->
c⁄d°r
 =
t2
->condstr

26 && 
t1
->
fûe
 =
t2
->file

27 && 
t1
->
löe
 =
t2
->line

28 && 
t1
->
ex≥˘
 =
t2
->expect;

29 
	}
}

32 
HTABLE_DEFINE_TYPE
(
åa˚
, (c⁄° åa˚ *), 
hash_åa˚
, 
åa˚_eq
,

33 
thash
);

35 
thash
 
	ghèbÀ


36 { 
HTABLE_INITIALIZER
(
hèbÀ
.
øw
, 
thash_hash
, 
NULL
) };

38 
	$öô_åa˚
(
åa˚
 *trace,

39 c⁄° *
c⁄d°r
, c⁄° *
fûe
, 
löe
,

40 
boﬁ
 
ex≥˘
)

42 
åa˚
->
c⁄d°r
 = condstr;

43 
åa˚
->
fûe
 = file;

44 
åa˚
->
löe
 =Üine;

45 
åa˚
->
ex≥˘
 =Éxpect;

46 
åa˚
->
cou¡
 =Åø˚->
right
 = 0;

47 
	}
}

49 
åa˚
 *
	$add_åa˚
(c⁄° 
åa˚
 *
t
)

51 
åa˚
 *åa˚ = 
	`mÆloc
((*trace));

52 *
åa˚
 = *
t
;

53 
	`thash_add
(&
hèbÀ
, 
åa˚
);

54  
åa˚
;

55 
	}
}

57 
	$_likñy_åa˚
(
boﬁ
 
c⁄d
, boﬁ 
ex≥˘
,

58 c⁄° *
c⁄d°r
,

59 c⁄° *
fûe
, 
löe
)

61 
åa˚
 *
p
,Årace;

63 
	`öô_åa˚
(&
åa˚
, 
c⁄d°r
, 
fûe
, 
löe
, 
ex≥˘
);

64 
p
 = 
	`thash_gë
(&
hèbÀ
, &
åa˚
);

65 i‡(!
p
)

66 
p
 = 
	`add_åa˚
(&
åa˚
);

68 
p
->
cou¡
++;

69 i‡(
c⁄d
 =
ex≥˘
)

70 
p
->
right
++;

72  
c⁄d
;

73 
	}
}

75 
	$right_øtio
(c⁄° 
åa˚
 *
t
)

77  ()
t
->
right
 /Å->
cou¡
;

78 
	}
}

80 *
	$likñy_°©s
(
mö_hôs
, 
≥r˚¡
)

82 
åa˚
 *
w‹°
;

83 
w‹°_øtio
;

84 
thash_ôî
 
i
;

85 *
ªt
;

86 
åa˚
 *
t
;

88 
w‹°
 = 
NULL
;

89 
w‹°_øtio
 = 2;

92 
t
 = 
	`thash_fú°
(&
hèbÀ
, &
i
);Å;Å = 
	`thash_√xt
(&htable, &i)) {

93 i‡(
t
->
cou¡
 >
mö_hôs
) {

94 i‡(
	`right_øtio
(
t
Ë< 
w‹°_øtio
) {

95 
w‹°
 = 
t
;

96 
w‹°_øtio
 = 
	`right_øtio
(
t
);

101 i‡(
w‹°_øtio
 * 100 > 
≥r˚¡
)

102  
NULL
;

104 
ªt
 = 
	`mÆloc
(
	`°æí
(
w‹°
->
c⁄d°r
) +

105 
	`°æí
(
w‹°
->
fûe
) +

108 
	`•rötf
(
ªt
, "%s:%u:%slikely(%s) correct %u%% (%lu/%lu)",

109 
w‹°
->
fûe
, w‹°->
löe
,

110 
w‹°
->
ex≥˘
 ? "" : "un", w‹°->
c⁄d°r
,

111 ()(
w‹°_øtio
 * 100),

112 
w‹°
->
right
, w‹°->
cou¡
);

114 
	`thash_dñ
(&
hèbÀ
, 
w‹°
);

115 
	`‰ì
(
w‹°
);

117  
ªt
;

118 
	}
}

120 
	$likñy_°©s_ª£t
()

122 
thash_ôî
 
i
;

123 
åa˚
 *
t
;

127 (
t
 = 
	`thash_fú°
(&
hèbÀ
, &
i
)Ë!
NULL
) {

128 ; 
t
;Å = 
	`thash_√xt
(&
hèbÀ
, &
i
)) {

129 
	`thash_dñ
(&
hèbÀ
, 
t
);

130 
	`‰ì
(
t
);

134 
	`thash_˛ór
(&
hèbÀ
);

135 
	}
}

	@ccan/ccan/likely/likely.h

2 #i‚de‡
CCAN_LIKELY_H


3 
	#CCAN_LIKELY_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°dboﬁ.h
>

7 #i‚de‡
CCAN_LIKELY_DEBUG


8 #i‡
HAVE_BUILTIN_EXPECT


32 
	#likñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
(!!(c⁄d), 1)

	)

53 
	#u∆ikñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
(!!(c⁄d), 0)

	)

55 
	#likñy
(
c⁄d
Ë(!!(c⁄d))

	)

56 
	#u∆ikñy
(
c⁄d
Ë(!!(c⁄d))

	)

59 
	~<cˇn/°r/°r.h
>

61 
	#likñy
(
c⁄d
) \

62 (
	`_likñy_åa˚
(!!(
c⁄d
), 1, 
	`°rögify
(c⁄d), 
__FILE__
, 
__LINE__
))

	)

63 
	#u∆ikñy
(
c⁄d
) \

64 (
	`_likñy_åa˚
(!!(
c⁄d
), 0, 
	`°rögify
(c⁄d), 
__FILE__
, 
__LINE__
))

	)

66 
_likñy_åa˚
(
boﬁ
 
c⁄d
, boﬁ 
ex≥˘
,

67 c⁄° *
c⁄d°r
,

68 c⁄° *
fûe
, 
löe
);

102 *
likñy_°©s
(
mö_hôs
, 
≥r˚¡
);

109 
likñy_°©s_ª£t
();

	@ccan/ccan/likely/test/run-debug.c

1 
	#CCAN_LIKELY_DEBUG
 1

	)

2 
	~<cˇn/likñy/likñy.c
>

3 
	~<cˇn/likñy/likñy.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°dlib.h
>

7 
boﬁ
 
	$⁄e_£ems_likñy
(
vÆ
)

9 i‡(
	`likñy
(
vÆ
 == 1))

10  
åue
;

11  
Ál£
;

12 
	}
}

14 
boﬁ
 
	$⁄e_£ems_u∆ikñy
(
vÆ
)

16 i‡(
	`u∆ikñy
(
vÆ
 == 1))

17  
åue
;

18  
Ál£
;

19 
	}
}

21 
boﬁ
 
	$likñy_⁄e_u∆ikñy_two
(
vÆ1
, 
vÆ2
)

24 i‡(
	`likñy
(
vÆ1
 =1Ë&& 
	`u∆ikñy
(
vÆ2
 == 2))

25  
åue
;

26  
Ál£
;

27 
	}
}

29 
	$maö
(
¨gc
, *
¨gv
[])

31 *
bad
;

33 
	`∂™_ã°s
(14);

36 
	`⁄e_£ems_likñy
(1);

37 
	`ok1
(
	`likñy_°©s
(0, 90Ë=
NULL
);

38 
	`⁄e_£ems_u∆ikñy
(2);

39 
	`ok1
(
	`likñy_°©s
(0, 90Ë=
NULL
);

42 
	`⁄e_£ems_likñy
(0);

43 
	`⁄e_£ems_likñy
(2);

45 
	`ok1
(!
	`likñy_°©s
(4, 90));

46 
bad
 = 
	`likñy_°©s
(3, 90);

47 
	`ok
(
	`°ªnds
(
bad
, "run-debug.c:9:likely(val == 1) correct 33% (1/3)"),

48 "likñy_°©†ªtu∫ed %s", 
bad
);

49 
	`‰ì
(
bad
);

52 
	`ok1
(!
	`likñy_°©s
(0, 90));

55 
bad
 = 
	`likñy_°©s
(0, 100);

56 
	`ok
(
	`°ªnds
(
bad
, "run-debug.c:16:unlikely(val == 1) correct 100% (1/1)"),

57 "likñy_°©†ªtu∫ed %s", 
bad
);

58 
	`‰ì
(
bad
);

61 
	`ok1
(!
	`likñy_°©s
(0, 100));

64 
	`⁄e_£ems_u∆ikñy
(0);

65 
	`⁄e_£ems_u∆ikñy
(2);

66 
	`⁄e_£ems_u∆ikñy
(1);

68 
bad
 = 
	`likñy_°©s
(0, 90);

69 
	`ok
(
	`°ªnds
(
bad
, "run-debug.c:16:unlikely(val == 1) correct 66% (2/3)"),

70 "likñy_°©†ªtu∫ed %s", 
bad
);

71 
	`‰ì
(
bad
);

72 
	`ok1
(!
	`likñy_°©s
(0, 100));

74 
	`likñy_⁄e_u∆ikñy_two
(1, 1);

75 
	`likñy_⁄e_u∆ikñy_two
(1, 1);

76 
	`likñy_⁄e_u∆ikñy_two
(1, 1);

77 
	`ok1
(!
	`likñy_°©s
(0, 90));

78 
	`likñy_⁄e_u∆ikñy_two
(1, 2);

80 
bad
 = 
	`likñy_°©s
(0, 90);

81 
	`ok
(
	`°ªnds
(
bad
, "run-debug.c:24:unlikely(val2 == 2) correct 75% (3/4)"),

82 "likñy_°©†ªtu∫ed %s", 
bad
);

83 
	`‰ì
(
bad
);

84 
bad
 = 
	`likñy_°©s
(0, 100);

85 
	`ok
(
	`°ªnds
(
bad
, "run-debug.c:24:likely(val1 == 1) correct 100% (4/4)"),

86 "likñy_°©†ªtu∫ed %s", 
bad
);

87 
	`‰ì
(
bad
);

89 
	`ok1
(!
	`likñy_°©s
(0, 100));

92 
	`⁄e_£ems_u∆ikñy
(0);

93 
	`⁄e_£ems_u∆ikñy
(2);

94 
	`⁄e_£ems_u∆ikñy
(1);

95 
	`likñy_°©s_ª£t
();

97 
	`ok1
(!
	`likñy_°©s
(0, 100));

99 
	`exô
(
	`exô_°©us
());

100 
	}
}

103 
	~<cˇn/hash/hash.h
>

104 
	~<cˇn/hèbÀ/hèbÀ.h
>

105 
	~<cˇn/°r/°r.h
>

	@ccan/ccan/likely/test/run.c

1 
	~<cˇn/likñy/likñy.c
>

2 
	~<cˇn/likñy/likñy.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

6 
boﬁ
 
	$⁄e_£ems_likñy
(
vÆ
)

8 i‡(
	`likñy
(
vÆ
 == 1))

9  
åue
;

10  
Ál£
;

11 
	}
}

13 
boﬁ
 
	$⁄e_£ems_u∆ikñy
(
vÆ
)

15 i‡(
	`u∆ikñy
(
vÆ
 == 1))

16  
åue
;

17  
Ál£
;

18 
	}
}

20 
	$maö
(
¨gc
, *
¨gv
[])

22 
	`∂™_ã°s
(4);

25 
	`ok1
(
	`⁄e_£ems_likñy
(1));

26 
	`ok1
(!
	`⁄e_£ems_likñy
(2));

27 
	`ok1
(
	`⁄e_£ems_u∆ikñy
(1));

28 
	`ok1
(!
	`⁄e_£ems_u∆ikñy
(2));

29 
	`exô
(
	`exô_°©us
());

30 
	}
}

	@ccan/ccan/list/list.c

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

4 
	~"li°.h
"

6 *
	$c‹ru±
(c⁄° *
ab‹t°r
,

7 c⁄° 
li°_node
 *
hód
,

8 c⁄° 
li°_node
 *
node
,

9 
cou¡
)

11 i‡(
ab‹t°r
) {

12 
	`Ârötf
(
°dîr
,

14 
ab‹t°r
, 
node
, 
cou¡
, 
hód
);

15 
	`ab‹t
();

17  
NULL
;

18 
	}
}

20 
li°_node
 *
	$li°_check_node
(c⁄° 
li°_node
 *
node
,

21 c⁄° *
ab‹t°r
)

23 c⁄° 
li°_node
 *
p
, *
n
;

24 
cou¡
 = 0;

26 
p
 = 
node
, 
n
 =Çode->
√xt
;Ç !=Çode;Ö =Ç,Ç =Ç->next) {

27 
cou¡
++;

28 i‡(
n
->
¥ev
 !
p
)

29  
	`c‹ru±
(
ab‹t°r
, 
node
, 
n
, 
cou¡
);

32 i‡(
node
->
¥ev
 !
p
)

33  
	`c‹ru±
(
ab‹t°r
, 
node
,Çode, 0);

35  (
li°_node
 *)
node
;

36 
	}
}

38 
li°_hód
 *
	$li°_check
(c⁄° 
li°_hód
 *
h
, c⁄° *
ab‹t°r
)

40 i‡(!
	`li°_check_node
(&
h
->
n
, 
ab‹t°r
))

41  
NULL
;

42  (
li°_hód
 *)
h
;

43 
	}
}

	@ccan/ccan/list/list.h

2 #i‚de‡
CCAN_LIST_H


3 
	#CCAN_LIST_H


	)

4 
	~<°dboﬁ.h
>

5 
	~<as£π.h
>

6 
	~<cˇn/c⁄èöî_of/c⁄èöî_of.h
>

7 
	~<cˇn/check_ty≥/check_ty≥.h
>

22 
	sli°_node


24 
li°_node
 *
	m√xt
, *
	m¥ev
;

39 
	sli°_hód


41 
li°_node
 
	mn
;

70 
li°_hód
 *
li°_check
(c⁄° li°_hód *
h
, c⁄° *
ab‹t°r
);

88 
li°_node
 *
li°_check_node
(c⁄° li°_nodê*
n
,

89 c⁄° *
ab‹t°r
);

91 #ifde‡
CCAN_LIST_DEBUG


92 
	#li°_debug
(
h
Ë
	`li°_check
((h), 
__func__
)

	)

93 
	#li°_debug_node
(
n
Ë
	`li°_check_node
(“), 
__func__
)

	)

95 
	#li°_debug
(
h
Ë(h)

	)

96 
	#li°_debug_node
(
n
Ë“)

	)

111 
	#LIST_HEAD_INIT
(
«me
Ë{ { &«me.
n
, &«me.¿} }

	)

126 
	#LIST_HEAD
(
«me
) \

127 
li°_hód
 
«me
 = 
	`LIST_HEAD_INIT
“ame)

	)

140 
ölöe
 
	$li°_hód_öô
(
li°_hód
 *
h
)

142 
h
->
n
.
√xt
 = h->n.
¥ev
 = &h->n;

143 
	}
}

158 
ölöe
 
	$li°_add
(
li°_hód
 *
h
, 
li°_node
 *
n
)

160 
n
->
√xt
 = 
h
->n.next;

161 
n
->
¥ev
 = &
h
->n;

162 
h
->
n
.
√xt
->
¥ev
 =Ç;

163 
h
->
n
.
√xt
 =Ç;

164 ()
	`li°_debug
(
h
);

165 
	}
}

177 
ölöe
 
	$li°_add_èû
(
li°_hód
 *
h
, 
li°_node
 *
n
)

179 
n
->
√xt
 = &
h
->n;

180 
n
->
¥ev
 = 
h
->n.prev;

181 
h
->
n
.
¥ev
->
√xt
 =Ç;

182 
h
->
n
.
¥ev
 =Ç;

183 ()
	`li°_debug
(
h
);

184 
	}
}

195 
ölöe
 
boﬁ
 
	$li°_em±y
(c⁄° 
li°_hód
 *
h
)

197 ()
	`li°_debug
(
h
);

198  
h
->
n
.
√xt
 == &h->n;

199 
	}
}

215 
ölöe
 
	$li°_dñ
(
li°_node
 *
n
)

217 ()
	`li°_debug_node
(
n
);

218 
n
->
√xt
->
¥ev
 =Ç->prev;

219 
n
->
¥ev
->
√xt
 =Ç->next;

220 #ifde‡
CCAN_LIST_DEBUG


222 
n
->
√xt
 =Ç->
¥ev
 = 
NULL
;

224 
	}
}

240 
ölöe
 
	$li°_dñ_‰om
(
li°_hód
 *
h
, 
li°_node
 *
n
)

242 #ifde‡
CCAN_LIST_DEBUG


245 
li°_node
 *
i
;

246 
i
 = 
h
->
n
.
√xt
; i !=Ç; i = i->next)

247 
	`as£π
(
i
 !&
h
->
n
);

252 
	`as£π
(!
	`li°_em±y
(
h
));

253 
	`li°_dñ
(
n
);

254 
	}
}

269 
	#li°_íåy
(
n
, 
ty≥
, 
membî
Ë
	`c⁄èöî_of
“,Åy≥, membî)

	)

285 
	#li°_t›
(
h
, 
ty≥
, 
membî
) \

286 ((
ty≥
 *)
	`li°_t›_
((
h
), 
	`li°_off_
—y≥, 
membî
)))

	)

288 
ölöe
 c⁄° *
	$li°_t›_
(c⁄° 
li°_hód
 *
h
, 
size_t
 
off
)

290 i‡(
	`li°_em±y
(
h
))

291  
NULL
;

292  (c⁄° *)
h
->
n
.
√xt
 - 
off
;

293 
	}
}

309 
	#li°_p›
(
h
, 
ty≥
, 
membî
) \

310 ((
ty≥
 *)
	`li°_p›_
((
h
), 
	`li°_off_
—y≥, 
membî
)))

	)

312 
ölöe
 c⁄° *
	$li°_p›_
(c⁄° 
li°_hód
 *
h
, 
size_t
 
off
)

314 
li°_node
 *
n
;

316 i‡(
	`li°_em±y
(
h
))

317  
NULL
;

318 
n
 = 
h
->n.
√xt
;

319 
	`li°_dñ
(
n
);

320  (c⁄° *)
n
 - 
off
;

321 
	}
}

337 
	#li°_èû
(
h
, 
ty≥
, 
membî
) \

338 ((
ty≥
 *)
	`li°_èû_
((
h
), 
	`li°_off_
—y≥, 
membî
)))

	)

340 
ölöe
 c⁄° *
	$li°_èû_
(c⁄° 
li°_hód
 *
h
, 
size_t
 
off
)

342 i‡(
	`li°_em±y
(
h
))

343  
NULL
;

344  (c⁄° *)
h
->
n
.
¥ev
 - 
off
;

345 
	}
}

360 
	#li°_f‹_óch
(
h
, 
i
, 
membî
) \

361 
	`li°_f‹_óch_off
(
h
, 
i
, 
	`li°_off_v¨_
(i, 
membî
))

	)

376 
	#li°_f‹_óch_ªv
(
h
, 
i
, 
membî
) \

377 
i
 = 
	`c⁄èöî_of_v¨
(
	`li°_debug
(
h
)->
n
.
¥ev
, i, 
membî
); \

378 &
i
->
membî
 !&(
h
)->
n
; \

379 
i
 = 
	`c⁄èöî_of_v¨
(i->
membî
.
¥ev
, i, membî))

	)

399 
	#li°_f‹_óch_ß„
(
h
, 
i
, 
nxt
, 
membî
) \

400 
	`li°_f‹_óch_ß„_off
(
h
, 
i
, 
nxt
, 
	`li°_off_v¨_
(i, 
membî
))

	)

416 
	#li°_√xt
(
h
, 
i
, 
membî
) \

417 ((
	`li°_ty≥of
(
i
))
	`li°_íåy_‹_nuŒ
(
	`li°_debug
(
h
), \

418 (
i
)->
membî
.
√xt
, \

419 
	`li°_off_v¨_
((
i
), 
membî
)))

	)

434 
	#li°_¥ev
(
h
, 
i
, 
membî
) \

435 ((
	`li°_ty≥of
(
i
))
	`li°_íåy_‹_nuŒ
(
	`li°_debug
(
h
), \

436 (
i
)->
membî
.
¥ev
, \

437 
	`li°_off_v¨_
((
i
), 
membî
)))

	)

454 
ölöe
 
	$li°_≠≥nd_li°
(
li°_hód
 *
to
,

455 
li°_hód
 *
‰om
)

457 
li°_node
 *
‰om_èû
 = 
	`li°_debug
(
‰om
)->
n
.
¥ev
;

458 
li°_node
 *
to_èû
 = 
	`li°_debug
(
to
)->
n
.
¥ev
;

461 
to
->
n
.
¥ev
 = 
‰om_èû
;

462 
‰om_èû
->
√xt
 = &
to
->
n
;

463 
to_èû
->
√xt
 = &
‰om
->
n
;

464 
‰om
->
n
.
¥ev
 = 
to_èû
;

467 
	`li°_dñ
(&
‰om
->
n
);

468 
	`li°_hód_öô
(
‰om
);

469 
	}
}

484 
ölöe
 
	$li°_¥ïíd_li°
(
li°_hód
 *
to
,

485 
li°_hód
 *
‰om
)

487 
li°_node
 *
‰om_èû
 = 
	`li°_debug
(
‰om
)->
n
.
¥ev
;

488 
li°_node
 *
to_hód
 = 
	`li°_debug
(
to
)->
n
.
√xt
;

491 
to
->
n
.
√xt
 = &
‰om
->n;

492 
‰om
->
n
.
¥ev
 = &
to
->n;

493 
to_hód
->
¥ev
 = 
‰om_èû
;

494 
‰om_èû
->
√xt
 = 
to_hód
;

497 
	`li°_dñ
(&
‰om
->
n
);

498 
	`li°_hód_öô
(
‰om
);

499 
	}
}

530 
	#li°_f‹_óch_off
(
h
, 
i
, 
off
) \

531 
i
 = 
	`li°_node_to_off_
(
	`li°_debug
(
h
)->
n
.
√xt
, (
off
)); \

532 
	`li°_node_‰om_off_
((*)
i
, (
off
)Ë!&(
h
)->
n
; \

533 
i
 = 
	`li°_node_to_off_
(
	`li°_node_‰om_off_
((*)i, (
off
))->
√xt
, \

534 (
off
)))

	)

552 
	#li°_f‹_óch_ß„_off
(
h
, 
i
, 
nxt
, 
off
) \

553 
i
 = 
	`li°_node_to_off_
(
	`li°_debug
(
h
)->
n
.
√xt
, (
off
)), \

554 
nxt
 = 
	`li°_node_to_off_
(
	`li°_node_‰om_off_
(
i
, (
off
))->
√xt
, \

555 (
off
)); \

556 
	`li°_node_‰om_off_
(
i
, (
off
)Ë!&(
h
)->
n
; \

557 
i
 = 
nxt
, \

558 
nxt
 = 
	`li°_node_to_off_
(
	`li°_node_‰om_off_
(
i
, (
off
))->
√xt
, \

559 (
off
)))

	)

563 
	#li°_íåy_off
(
n
, 
ty≥
, 
off
) \

564 ((
ty≥
 *)
	`li°_node_‰om_off_
((
n
), (
off
)))

	)

566 
	#li°_hód_off
(
h
, 
ty≥
, 
off
) \

567 ((
ty≥
 *)
	`li°_hód_off
((
h
), (
off
)))

	)

569 
	#li°_èû_off
(
h
, 
ty≥
, 
off
) \

570 ((
ty≥
 *)
	`li°_èû_
((
h
), (
off
)))

	)

572 
	#li°_add_off
(
h
, 
n
, 
off
) \

573 
	`li°_add
((
h
), 
	`li°_node_‰om_off_
((
n
), (
off
)))

	)

575 
	#li°_dñ_off
(
n
, 
off
) \

576 
	`li°_dñ
(
	`li°_node_‰om_off_
((
n
), (
off
)))

	)

578 
	#li°_dñ_‰om_off
(
h
, 
n
, 
off
) \

579 
	`li°_dñ_‰om
(
h
, 
	`li°_node_‰om_off_
((
n
), (
off
)))

	)

582 
ölöe
 *
	$li°_node_to_off_
(
li°_node
 *
node
, 
size_t
 
off
)

584  (*)((*)
node
 - 
off
);

585 
	}
}

586 
ölöe
 
li°_node
 *
	$li°_node_‰om_off_
(*
±r
, 
size_t
 
off
)

588  (
li°_node
 *)((*)
±r
 + 
off
);

589 
	}
}

592 
	#li°_off_
(
ty≥
, 
membî
) \

593 (
	`c⁄èöî_off
(
ty≥
, 
membî
) + \

594 
	`check_ty≥
(((
ty≥
 *)0)->
membî
, 
li°_node
))

	)

596 
	#li°_off_v¨_
(
v¨
, 
membî
) \

597 (
	`c⁄èöî_off_v¨
(
v¨
, 
membî
) + \

598 
	`check_ty≥
(
v¨
->
membî
, 
li°_node
))

	)

600 #i‡
HAVE_TYPEOF


601 
	#li°_ty≥of
(
v¨
Ë
	`ty≥of
(v¨)

	)

603 
	#li°_ty≥of
(
v¨
Ë*

	)

607 
ölöe
 *
	$li°_íåy_‹_nuŒ
(
li°_hód
 *
h
,

608 
li°_node
 *
n
,

609 
size_t
 
off
)

611 i‡(
n
 =&
h
->n)

612  
NULL
;

613  (*)
n
 - 
off
;

614 
	}
}

	@ccan/ccan/list/test/compile_ok-constant.c

1 
	~<cˇn/li°/li°.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/li°/li°.c
>

4 
	~<°dboﬁ.h
>

5 
	~<°dio.h
>

7 
	schûd
 {

8 c⁄° *
	m«me
;

9 
li°_node
 
	mli°
;

12 
boﬁ
 
	$chûdªn
(c⁄° 
li°_hód
 *
li°
)

14  !
	`li°_em±y
(
li°
);

15 
	}
}

17 c⁄° 
chûd
 *
	$fú°_chûd
(c⁄° 
li°_hód
 *
li°
)

19  
	`li°_t›
(
li°
, 
chûd
,Üist);

20 
	}
}

22 c⁄° 
chûd
 *
	$œ°_chûd
(c⁄° 
li°_hód
 *
li°
)

24  
	`li°_èû
(
li°
, 
chûd
,Üist);

25 
	}
}

27 
	$check_chûdªn
(c⁄° 
li°_hód
 *
li°
)

29 
	`li°_check
(
li°
, "bad childÜist");

30 
	}
}

32 
	$¥öt_chûdªn
(c⁄° 
li°_hód
 *
li°
)

34 c⁄° 
chûd
 *
c
;

35 
	`li°_f‹_óch
(
li°
, 
c
,Üist)

36 
	`¥ötf
("%s\n", 
c
->
«me
);

37 
	}
}

39 
	$maö
()

41 
	`LIST_HEAD
(
h
);

43 
	`chûdªn
(&
h
);

44 
	`fú°_chûd
(&
h
);

45 
	`œ°_chûd
(&
h
);

46 
	`check_chûdªn
(&
h
);

47 
	`¥öt_chûdªn
(&
h
);

49 
	}
}

	@ccan/ccan/list/test/helper.c

1 
	~<°dlib.h
>

2 
	~<°dboﬁ.h
>

3 
	~<time.h
>

5 
	~<cˇn/li°/li°.h
>

6 
	~"hñ≥r.h
"

8 
	#ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING
 \

9 (42)

	)

11 
	s›aque
 {

12 
li°_node
 
	mli°
;

13 
size_t
 
	m£¸ë_off£t
;

14 
	m£¸ë_døwî
[42];

17 
boﬁ
 
	gnŸ_øndomized
 = 
åue
;

19 
›aque
 *
	$¸óã_›aque_blob
()

21 
›aque
 *
blob
 = 
	`ˇŒoc
(1, (opaque));

23 i‡(
nŸ_øndomized
) {

24 
	`§™dom
(()
	`time
(
NULL
));

25 
nŸ_øndomized
 = 
Ál£
;

28 
blob
->
£¸ë_off£t
 = 
	`øndom
(Ë% ((blob->
£¸ë_døwî
));

29 
blob
->
£¸ë_døwî
[blob->
£¸ë_off£t
] =

30 
ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING
;

32  
blob
;

33 
	}
}

35 
boﬁ
 
	$if_blobs_know_the_£¸ë
(
›aque
 *
blob
)

37 
boﬁ
 
™swî
 = 
åue
;

38 
i
;

39 
i
 = 0; i < (
blob
->
£¸ë_døwî
) /

40 (
blob
->
£¸ë_døwî
[0]); 
i
++)

41 i‡(
i
 !
blob
->
£¸ë_off£t
)

42 
™swî
 =ánswî && (
blob
->
£¸ë_døwî
[
i
] == 0);

44 
™swî
 =ánswer &&

45 (
blob
->
£¸ë_døwî
[blob->
£¸ë_off£t
] ==

46 
ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING
);

48  
™swî
;

49 
	}
}

51 
	$de°roy_›aque_blob
(
›aque
 *
blob
)

53 
	`‰ì
(
blob
);

54 
	}
}

	@ccan/ccan/list/test/helper.h

2 
	g›aque
;

3 
›aque
 
	t›aque_t
;

5 
›aque_t
 *
¸óã_›aque_blob
();

6 
boﬁ
 
if_blobs_know_the_£¸ë
(
›aque_t
 *
blob
);

7 
de°roy_›aque_blob
(
›aque_t
 *
blob
);

	@ccan/ccan/list/test/run-check-corrupt.c

1 
	~<£tjmp.h
>

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<°d¨g.h
>

5 
	~<°rög.h
>

6 
	~<îr.h
>

9 
jmp_buf
 
	gab‹ãd
;

10 
	#ab‹t
(Ë
	`l⁄gjmp
(
ab‹ãd
, 1)

	)

12 
	#Ârötf
 
my_Ârötf


	)

13 
	g¥ötf_buf„r
[1000];

15 
	$my_Ârötf
(
FILE
 *
°ªam
, c⁄° *
f‹m©
, ...)

17 
va_li°
 
≠
;

18 
ªt
;

19 
	`va_°¨t
(
≠
, 
f‹m©
);

20 
ªt
 = 
	`v•rötf
(
¥ötf_buf„r
, 
f‹m©
, 
≠
);

21 
	`va_íd
(
≠
);

22  
ªt
;

23 
	}
}

25 
	~<cˇn/li°/li°.h
>

26 
	~<cˇn/èp/èp.h
>

27 
	~<cˇn/li°/li°.c
>

29 
	$maö
(
¨gc
, *
¨gv
[])

31 
li°_hód
 
li°
;

32 
li°_node
 
n1
;

33 
ex≥˘
[100];

35 
	`∂™_ã°s
(9);

37 
li°
.
n
.
√xt
 = &list.n;

38 
li°
.
n
.
¥ev
 = &list.n;

39 
	`ok1
(
	`li°_check
(&
li°
, 
NULL
) == &list);

42 
li°
.
n
.
¥ev
 = &
n1
;

44 
	`ok1
(
	`li°_check
(&
li°
, 
NULL
) == NULL);

47 
	`•rötf
(
ex≥˘
, "test message:Örev corrupt inÇode %p (0) of %p\n",

48 &
li°
, &list);

49 i‡(
	`£tjmp
(
ab‹ãd
) == 0) {

50 
	`li°_check
(&
li°
, "test message");

51 
	`Áû
("list_check onÉmpty with bad backÖtr didn't fail!");

53 
	`ok1
(
	`°rcmp
(
¥ötf_buf„r
, 
ex≥˘
) == 0);

57 
li°
.
n
.
√xt
 = &
n1
;

58 
li°
.
n
.
¥ev
 = &
n1
;

59 
n1
.
¥ev
 = &
li°
.
n
;

60 
n1
.
√xt
 = &
li°
.
n
;

61 
	`ok1
(
	`li°_check
(&
li°
, 
NULL
) == &list);

62 
	`ok1
(
	`li°_check_node
(&
n1
, 
NULL
) == &n1);

65 
n1
.
¥ev
 = &n1;

66 
	`ok1
(
	`li°_check
(&
li°
, 
NULL
) == NULL);

67 
	`ok1
(
	`li°_check_node
(&
n1
, 
NULL
) == NULL);

70 
	`•rötf
(
ex≥˘
, "test message:Örev corrupt inÇode %p (1) of %p\n",

71 &
n1
, &
li°
);

72 i‡(
	`£tjmp
(
ab‹ãd
) == 0) {

73 
	`li°_check
(&
li°
, "test message");

74 
	`Áû
("list_check onÇ1 bad backÖtr didn't fail!");

76 
	`ok1
(
	`°rcmp
(
¥ötf_buf„r
, 
ex≥˘
) == 0);

79 
	`•rötf
(
ex≥˘
, "test message:Örev corrupt inÇode %p (0) of %p\n",

80 &
n1
, &n1);

81 i‡(
	`£tjmp
(
ab‹ãd
) == 0) {

82 
	`li°_check_node
(&
n1
, "test message");

83 
	`Áû
("list_check_node onÇ1 bad backÖtr didn't fail!");

85 
	`ok1
(
	`°rcmp
(
¥ötf_buf„r
, 
ex≥˘
) == 0);

88  
	`exô_°©us
();

89 
	}
}

	@ccan/ccan/list/test/run-list_del_from-assert.c

1 
	#CCAN_LIST_DEBUG
 1

	)

2 
	~<cˇn/li°/li°.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<cˇn/li°/li°.c
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/waô.h
>

7 
	~<uni°d.h
>

8 
	~<sig«l.h
>

10 
	$maö
(
¨gc
, *
¨gv
[])

12 
li°_hód
 
li°1
, 
li°2
;

13 
li°_node
 
n1
, 
n2
, 
n3
;

14 
pid_t
 
chûd
;

15 
°©us
;

17 
	`∂™_ã°s
(1);

18 
	`li°_hód_öô
(&
li°1
);

19 
	`li°_hód_öô
(&
li°2
);

20 
	`li°_add
(&
li°1
, &
n1
);

21 
	`li°_add
(&
li°2
, &
n2
);

22 
	`li°_add_èû
(&
li°2
, &
n3
);

24 
chûd
 = 
	`f‹k
();

25 i‡(
chûd
) {

26 
	`waô
(&
°©us
);

29 
	`li°_dñ_‰om
(&
li°1
, &
n3
);

30 
	`exô
(0);

33 
	`ok1
(
	`WIFSIGNALED
(
°©us
Ë&& 
	`WTERMSIG
(°©usË=
SIGABRT
);

34 
	`li°_dñ_‰om
(&
li°2
, &
n3
);

35  
	`exô_°©us
();

36 
	}
}

	@ccan/ccan/list/test/run-list_prev-list_next.c

1 
	~<cˇn/li°/li°.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/li°/li°.c
>

4 
	~"hñ≥r.h
"

6 
	s∑ª¡
 {

7 c⁄° *
	m«me
;

8 
	mnum_chûdªn
;

9 
li°_hód
 
	mchûdªn
;

12 
	schûd
 {

13 c⁄° *
	m«me
;

14 
li°_node
 
	mli°
;

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
∑ª¡
Öarent;

20 
chûd
 
c1
, 
c2
, 
c3
;

22 
	`∂™_ã°s
(12);

23 
∑ª¡
.
num_chûdªn
 = 0;

24 
	`li°_hód_öô
(&
∑ª¡
.
chûdªn
);

26 
c1
.
«me
 = "c1";

27 
	`li°_add
(&
∑ª¡
.
chûdªn
, &
c1
.
li°
);

29 
	`ok1
(
	`li°_√xt
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
Ë=
NULL
);

30 
	`ok1
(
	`li°_¥ev
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
Ë=
NULL
);

32 
c2
.
«me
 = "c2";

33 
	`li°_add_èû
(&
∑ª¡
.
chûdªn
, &
c2
.
li°
);

35 
	`ok1
(
	`li°_√xt
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
Ë=&
c2
);

36 
	`ok1
(
	`li°_¥ev
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
Ë=
NULL
);

37 
	`ok1
(
	`li°_√xt
(&
∑ª¡
.
chûdªn
, &
c2
, 
li°
Ë=
NULL
);

38 
	`ok1
(
	`li°_¥ev
(&
∑ª¡
.
chûdªn
, &
c2
, 
li°
Ë=&
c1
);

40 
c3
.
«me
 = "c3";

41 
	`li°_add_èû
(&
∑ª¡
.
chûdªn
, &
c3
.
li°
);

43 
	`ok1
(
	`li°_√xt
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
Ë=&
c2
);

44 
	`ok1
(
	`li°_¥ev
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
Ë=
NULL
);

45 
	`ok1
(
	`li°_√xt
(&
∑ª¡
.
chûdªn
, &
c2
, 
li°
Ë=&
c3
);

46 
	`ok1
(
	`li°_¥ev
(&
∑ª¡
.
chûdªn
, &
c2
, 
li°
Ë=&
c1
);

47 
	`ok1
(
	`li°_√xt
(&
∑ª¡
.
chûdªn
, &
c3
, 
li°
Ë=
NULL
);

48 
	`ok1
(
	`li°_¥ev
(&
∑ª¡
.
chûdªn
, &
c3
, 
li°
Ë=&
c2
);

49  
	`exô_°©us
();

50 
	}
}

	@ccan/ccan/list/test/run-prepend_list.c

1 
	~<cˇn/li°/li°.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/li°/li°.c
>

4 
	~<°d¨g.h
>

6 
boﬁ
 
	$li°_ex≥˘
(
li°_hód
 *
h
, ...)

8 
va_li°
 
≠
;

9 
li°_node
 *
n
 = &
h
->n, *
ex≥˘ed
;

11 
	`va_°¨t
(
≠
, 
h
);

12 (
ex≥˘ed
 = 
	`va_¨g
(
≠
, 
li°_node
 *)Ë!
NULL
) {

13 
n
 =Ç->
√xt
;

14 i‡(
n
 !
ex≥˘ed
)

15  
Ál£
;

17  (
n
->
√xt
 =&
h
->n);

18 
	}
}

20 
	$maö
(
¨gc
, *
¨gv
[])

22 
li°_hód
 
h1
, 
h2
;

23 
li°_node
 
n
[4];

25 
	`∂™_ã°s
(40);

27 
	`li°_hód_öô
(&
h1
);

28 
	`li°_hód_öô
(&
h2
);

31 
	`li°_≠≥nd_li°
(&
h1
, &
h2
);

32 
	`ok1
(
	`li°_em±y
(&
h1
));

33 
	`ok1
(
	`li°_em±y
(&
h2
));

34 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

35 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

38 
	`li°_¥ïíd_li°
(&
h1
, &
h2
);

39 
	`ok1
(
	`li°_em±y
(&
h1
));

40 
	`ok1
(
	`li°_em±y
(&
h2
));

41 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

42 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

45 
	`li°_add
(&
h1
, &
n
[0]);

46 
	`li°_≠≥nd_li°
(&
h1
, &
h2
);

47 
	`ok1
(
	`li°_em±y
(&
h2
));

48 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

49 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

50 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[0], 
NULL
));

53 
	`li°_¥ïíd_li°
(&
h1
, &
h2
);

54 
	`ok1
(
	`li°_em±y
(&
h2
));

55 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

56 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

57 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[0], 
NULL
));

60 
	`li°_≠≥nd_li°
(&
h2
, &
h1
);

61 
	`ok1
(
	`li°_em±y
(&
h1
));

62 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

63 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

64 
	`ok1
(
	`li°_ex≥˘
(&
h2
, &
n
[0], 
NULL
));

67 
	`li°_¥ïíd_li°
(&
h1
, &
h2
);

68 
	`ok1
(
	`li°_em±y
(&
h2
));

69 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

70 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

71 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[0], 
NULL
));

74 
	`li°_add
(&
h2
, &
n
[1]);

75 
	`li°_¥ïíd_li°
(&
h1
, &
h2
);

76 
	`ok1
(
	`li°_em±y
(&
h2
));

77 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

78 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

79 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[1], &n[0], 
NULL
));

82 
	`li°_add
(&
h2
, &
n
[2]);

83 
	`li°_≠≥nd_li°
(&
h1
, &
h2
);

84 
	`ok1
(
	`li°_em±y
(&
h2
));

85 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

86 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

87 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[1], &n[0], &n[2], 
NULL
));

90 
	`li°_dñ_‰om
(&
h1
, &
n
[2]);

91 
	`li°_add
(&
h2
, &
n
[2]);

92 
	`li°_add_èû
(&
h2
, &
n
[3]);

93 
	`li°_¥ïíd_li°
(&
h1
, &
h2
);

94 
	`ok1
(
	`li°_em±y
(&
h2
));

95 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

96 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

97 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[2], &n[3], &n[1], &n[0], 
NULL
));

100 
	`li°_dñ_‰om
(&
h1
, &
n
[2]);

101 
	`li°_dñ_‰om
(&
h1
, &
n
[3]);

102 
	`li°_add
(&
h2
, &
n
[2]);

103 
	`li°_add_èû
(&
h2
, &
n
[3]);

104 
	`li°_≠≥nd_li°
(&
h1
, &
h2
);

105 
	`ok1
(
	`li°_em±y
(&
h2
));

106 
	`ok1
(
	`li°_check
(&
h1
, 
NULL
));

107 
	`ok1
(
	`li°_check
(&
h2
, 
NULL
));

108 
	`ok1
(
	`li°_ex≥˘
(&
h1
, &
n
[1], &n[0], &n[2], &n[3], 
NULL
));

110  
	`exô_°©us
();

111 
	}
}

	@ccan/ccan/list/test/run-single-eval.c

2 
	~<cˇn/li°/li°.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<cˇn/li°/li°.c
>

6 
	s∑ª¡
 {

7 c⁄° *
	m«me
;

8 
li°_hód
 
	mchûdªn
;

9 
	mnum_chûdªn
;

10 
	mevÆ_cou¡
;

13 
	schûd
 {

14 c⁄° *
	m«me
;

15 
li°_node
 
	mli°
;

18 
LIST_HEAD
(
°©ic_li°
);

20 
	#ªf
(
obj
, 
cou¡î
Ë((cou¡î)++, (obj))

	)

22 
	$maö
(
¨gc
, *
¨gv
[])

24 
∑ª¡
Öarent;

25 
chûd
 
c1
, 
c2
, 
c3
, *
c
, *
n
;

26 
i
;

27 
°©ic_cou¡
 = 0, 
∑ª¡_cou¡
 = 0, 
li°_cou¡
 = 0,

28 
node_cou¡
 = 0;

29 
li°_hód
 
li°
 = 
	`LIST_HEAD_INIT
(list);

31 
	`∂™_ã°s
(74);

33 
	`ok1
(
	`li°_em±y
(
	`ªf
(&
°©ic_li°
, 
°©ic_cou¡
)));

34 
	`ok1
(
°©ic_cou¡
 == 1);

35 
	`ok1
(
	`li°_check
(
	`ªf
(&
°©ic_li°
, 
°©ic_cou¡
), 
NULL
));

36 
	`ok1
(
°©ic_cou¡
 == 2);

37 
	`ok1
(
	`li°_em±y
(
	`ªf
(&
li°
, 
li°_cou¡
)));

38 
	`ok1
(
li°_cou¡
 == 1);

39 
	`ok1
(
	`li°_check
(
	`ªf
(&
li°
, 
li°_cou¡
), 
NULL
));

40 
	`ok1
(
li°_cou¡
 == 2);

42 
∑ª¡
.
num_chûdªn
 = 0;

43 
	`li°_hód_öô
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
));

44 
	`ok1
(
∑ª¡_cou¡
 == 1);

46 
	`ok1
(
	`li°_em±y
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
)));

47 
	`ok1
(
∑ª¡_cou¡
 == 2);

48 
	`ok1
(
	`li°_check
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
NULL
));

49 
	`ok1
(
∑ª¡_cou¡
 == 3);

51 
c2
.
«me
 = "c2";

52 
	`li°_add
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), &
c2
.
li°
);

53 
	`ok1
(
∑ª¡_cou¡
 == 4);

55 
	`ok1
(!
	`li°_em±y
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
)));

56 
	`ok1
(
∑ª¡_cou¡
 == 5);

57 
	`ok1
(
c2
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
n
);

58 
	`ok1
(
c2
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
n
);

59 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
√xt
 =&
c2
.
li°
);

60 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
¥ev
 =&
c2
.
li°
);

62 
	`ok1
(
	`li°_check
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
NULL
));

63 
	`ok1
(
∑ª¡_cou¡
 == 6);

65 
c1
.
«me
 = "c1";

66 
	`li°_add
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), &
c1
.
li°
);

67 
	`ok1
(
∑ª¡_cou¡
 == 7);

69 
	`ok1
(!
	`li°_em±y
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
)));

70 
	`ok1
(
∑ª¡_cou¡
 == 8);

71 
	`ok1
(
c2
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
n
);

72 
	`ok1
(
c2
.
li°
.
¥ev
 =&
c1
.list);

73 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
√xt
 =&
c1
.
li°
);

74 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
¥ev
 =&
c2
.
li°
);

75 
	`ok1
(
c1
.
li°
.
√xt
 =&
c2
.list);

76 
	`ok1
(
c1
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
n
);

78 
	`ok1
(
	`li°_check
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
NULL
));

79 
	`ok1
(
∑ª¡_cou¡
 == 9);

81 
c3
.
«me
 = "c3";

82 
	`li°_add_èû
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), &
c3
.
li°
);

83 
	`ok1
(
∑ª¡_cou¡
 == 10);

85 
	`ok1
(!
	`li°_em±y
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
)));

86 
	`ok1
(
∑ª¡_cou¡
 == 11);

87 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
√xt
 =&
c1
.
li°
);

88 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
¥ev
 =&
c3
.
li°
);

89 
	`ok1
(
c1
.
li°
.
√xt
 =&
c2
.list);

90 
	`ok1
(
c1
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
n
);

91 
	`ok1
(
c2
.
li°
.
√xt
 =&
c3
.list);

92 
	`ok1
(
c2
.
li°
.
¥ev
 =&
c1
.list);

93 
	`ok1
(
c3
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
n
);

94 
	`ok1
(
c3
.
li°
.
¥ev
 =&
c2
.list);

96 
	`ok1
(
	`li°_check
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
NULL
));

97 
	`ok1
(
∑ª¡_cou¡
 == 12);

100 
	`ok1
(
	`li°_check_node
(&
c1
.
li°
, 
NULL
));

101 
	`ok1
(
	`li°_check_node
(&
c2
.
li°
, 
NULL
));

102 
	`ok1
(
	`li°_check_node
(&
c3
.
li°
, 
NULL
));

105 
	`ok1
(
	`li°_t›
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
chûd
, 
li°
Ë=&
c1
);

106 
	`ok1
(
∑ª¡_cou¡
 == 13);

109 
	`ok1
(
	`li°_èû
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
chûd
, 
li°
Ë=&
c3
);

110 
	`ok1
(
∑ª¡_cou¡
 == 14);

113 
i
 = 0;

114 
	`li°_f‹_óch
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
) {

115 
i
++) {

117 
	`ok1
(
c
 =&
c1
);

120 
	`ok1
(
c
 =&
c2
);

123 
	`ok1
(
c
 =&
c3
);

126 i‡(
i
 > 2)

129 
	`ok1
(
i
 == 3);

132 
i
 = 0;

133 
	`li°_f‹_óch_ß„
(&
∑ª¡
.
chûdªn
, 
c
, 
n
, 
li°
) {

134 
i
++) {

136 
	`ok1
(
c
 =&
c1
);

137 
	`li°_dñ
(
	`ªf
(&
c
->
li°
, 
node_cou¡
));

138 
	`ok1
(
node_cou¡
 == 1);

141 
	`ok1
(
c
 =&
c2
);

142 
	`li°_dñ_‰om
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
),

143 
	`ªf
(&
c
->
li°
, 
node_cou¡
));

144 
	`ok1
(
node_cou¡
 == 2);

147 
	`ok1
(
c
 =&
c3
);

148 
	`li°_dñ_‰om
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
),

149 
	`ªf
(&
c
->
li°
, 
node_cou¡
));

150 
	`ok1
(
node_cou¡
 == 3);

153 
	`ok1
(
	`li°_check
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
NULL
));

154 i‡(
i
 > 2)

157 
	`ok1
(
i
 == 3);

158 
	`ok1
(
∑ª¡_cou¡
 == 19);

159 
	`ok1
(
	`li°_em±y
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
)));

160 
	`ok1
(
∑ª¡_cou¡
 == 20);

163 
	`ok1
(
	`li°_t›
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
chûd
, 
li°
Ë=
NULL
);

164 
	`ok1
(
∑ª¡_cou¡
 == 21);

165 
	`ok1
(
	`li°_èû
(
	`ªf
(&
∑ª¡
.
chûdªn
, 
∑ª¡_cou¡
), 
chûd
, 
li°
Ë=
NULL
);

166 
	`ok1
(
∑ª¡_cou¡
 == 22);

167  
	`exô_°©us
();

168 
	}
}

	@ccan/ccan/list/test/run-with-debug.c

2 
	#CCAN_LIST_DEBUG
 1

	)

3 
	~<cˇn/li°/ã°/run.c
>

	@ccan/ccan/list/test/run.c

1 
	~<cˇn/li°/li°.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/li°/li°.c
>

4 
	~"hñ≥r.h
"

6 
	s∑ª¡
 {

7 c⁄° *
	m«me
;

8 
li°_hód
 
	mchûdªn
;

9 
	mnum_chûdªn
;

12 
	schûd
 {

13 c⁄° *
	m«me
;

14 
li°_node
 
	mli°
;

17 
LIST_HEAD
(
°©ic_li°
);

19 
	$maö
(
¨gc
, *
¨gv
[])

21 
∑ª¡
Öarent;

22 
chûd
 
c1
, 
c2
, 
c3
, *
c
, *
n
;

23 
i
;

24 
li°_hód
 
li°
 = 
	`LIST_HEAD_INIT
(list);

25 
›aque_t
 *
q
, *
nq
;

26 
li°_hód
 
›aque_li°
 = 
	`LIST_HEAD_INIT
(opaque_list);

28 
	`∂™_ã°s
(68);

30 
	`ok1
(
	`li°_em±y
(&
°©ic_li°
));

31 
	`ok1
(
	`li°_check
(&
°©ic_li°
, 
NULL
));

32 
	`ok1
(
	`li°_em±y
(&
li°
));

33 
	`ok1
(
	`li°_check
(&
li°
, 
NULL
));

35 
∑ª¡
.
num_chûdªn
 = 0;

36 
	`li°_hód_öô
(&
∑ª¡
.
chûdªn
);

38 
	`ok1
(
	`li°_em±y
(&
∑ª¡
.
chûdªn
));

39 
	`ok1
(
	`li°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

41 
c2
.
«me
 = "c2";

42 
	`li°_add
(&
∑ª¡
.
chûdªn
, &
c2
.
li°
);

44 
	`ok1
(!
	`li°_em±y
(&
∑ª¡
.
chûdªn
));

45 
	`ok1
(
c2
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
n
);

46 
	`ok1
(
c2
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
n
);

47 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
√xt
 =&
c2
.
li°
);

48 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
¥ev
 =&
c2
.
li°
);

50 
	`ok1
(
	`li°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

52 
c1
.
«me
 = "c1";

53 
	`li°_add
(&
∑ª¡
.
chûdªn
, &
c1
.
li°
);

55 
	`ok1
(!
	`li°_em±y
(&
∑ª¡
.
chûdªn
));

56 
	`ok1
(
c2
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
n
);

57 
	`ok1
(
c2
.
li°
.
¥ev
 =&
c1
.list);

58 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
√xt
 =&
c1
.
li°
);

59 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
¥ev
 =&
c2
.
li°
);

60 
	`ok1
(
c1
.
li°
.
√xt
 =&
c2
.list);

61 
	`ok1
(
c1
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
n
);

63 
	`ok1
(
	`li°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

65 
c3
.
«me
 = "c3";

66 
	`li°_add_èû
(&
∑ª¡
.
chûdªn
, &
c3
.
li°
);

68 
	`ok1
(!
	`li°_em±y
(&
∑ª¡
.
chûdªn
));

69 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
√xt
 =&
c1
.
li°
);

70 
	`ok1
(
∑ª¡
.
chûdªn
.
n
.
¥ev
 =&
c3
.
li°
);

71 
	`ok1
(
c1
.
li°
.
√xt
 =&
c2
.list);

72 
	`ok1
(
c1
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
n
);

73 
	`ok1
(
c2
.
li°
.
√xt
 =&
c3
.list);

74 
	`ok1
(
c2
.
li°
.
¥ev
 =&
c1
.list);

75 
	`ok1
(
c3
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
n
);

76 
	`ok1
(
c3
.
li°
.
¥ev
 =&
c2
.list);

78 
	`ok1
(
	`li°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

81 
	`ok1
(
	`li°_check_node
(&
c1
.
li°
, 
NULL
));

82 
	`ok1
(
	`li°_check_node
(&
c2
.
li°
, 
NULL
));

83 
	`ok1
(
	`li°_check_node
(&
c3
.
li°
, 
NULL
));

86 
	`ok1
(
	`li°_t›
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=&
c1
);

89 
	`ok1
(
	`li°_p›
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=&
c1
);

90 
	`ok1
(
	`li°_t›
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=&
c2
);

91 
	`li°_add
(&
∑ª¡
.
chûdªn
, &
c1
.
li°
);

94 
	`ok1
(
	`li°_èû
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=&
c3
);

97 
i
 = 0;

98 
	`li°_f‹_óch
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
) {

99 
i
++) {

101 
	`ok1
(
c
 =&
c1
);

104 
	`ok1
(
c
 =&
c2
);

107 
	`ok1
(
c
 =&
c3
);

110 i‡(
i
 > 2)

113 
	`ok1
(
i
 == 3);

116 
i
 = 0;

117 
	`li°_f‹_óch_ªv
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
) {

118 
i
++) {

120 
	`ok1
(
c
 =&
c3
);

123 
	`ok1
(
c
 =&
c2
);

126 
	`ok1
(
c
 =&
c1
);

129 i‡(
i
 > 2)

132 
	`ok1
(
i
 == 3);

135 
i
 = 0;

136 
	`li°_f‹_óch_ß„
(&
∑ª¡
.
chûdªn
, 
c
, 
n
, 
li°
) {

137 
i
++) {

139 
	`ok1
(
c
 =&
c1
);

140 
	`li°_dñ
(&
c
->
li°
);

143 
	`ok1
(
c
 =&
c2
);

144 
	`li°_dñ_‰om
(&
∑ª¡
.
chûdªn
, &
c
->
li°
);

147 
	`ok1
(
c
 =&
c3
);

148 
	`li°_dñ_‰om
(&
∑ª¡
.
chûdªn
, &
c
->
li°
);

151 
	`ok1
(
	`li°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

152 i‡(
i
 > 2)

155 
	`ok1
(
i
 == 3);

156 
	`ok1
(
	`li°_em±y
(&
∑ª¡
.
chûdªn
));

159 
	`li°_add_èû
(&
›aque_li°
,

160 (
li°_node
 *)
	`¸óã_›aque_blob
());

161 
	`li°_add_èû
(&
›aque_li°
,

162 (
li°_node
 *)
	`¸óã_›aque_blob
());

163 
	`li°_add_èû
(&
›aque_li°
,

164 (
li°_node
 *)
	`¸óã_›aque_blob
());

166 
i
 = 0;

168 
	`li°_f‹_óch_off
(&
›aque_li°
, 
q
, 0) {

169 
i
++;

170 
	`ok1
(
	`if_blobs_know_the_£¸ë
(
q
));

172 
	`ok1
(
i
 == 3);

175 
i
 = 0;

176 
	`li°_f‹_óch_ß„_off
(&
›aque_li°
, 
q
, 
nq
, 0) {

177 
i
++) {

179 
	`ok1
(
	`if_blobs_know_the_£¸ë
(
q
));

180 
	`li°_dñ_off
(
q
, 0);

181 
	`de°roy_›aque_blob
(
q
);

184 
	`ok1
(
	`if_blobs_know_the_£¸ë
(
q
));

185 
	`li°_dñ_‰om_off
(&
›aque_li°
, 
q
, 0);

186 
	`de°roy_›aque_blob
(
q
);

189 
	`ok1
(
c
 =&
c3
);

190 
	`li°_dñ_‰om_off
(&
›aque_li°
, 
q
, 0);

191 
	`de°roy_›aque_blob
(
q
);

194 
	`ok1
(
	`li°_check
(&
›aque_li°
, 
NULL
));

195 i‡(
i
 > 2)

198 
	`ok1
(
i
 == 3);

199 
	`ok1
(
	`li°_em±y
(&
›aque_li°
));

202 
	`ok1
(
	`li°_t›
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=
NULL
);

203 
	`ok1
(
	`li°_èû
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=
NULL
);

204 
	`ok1
(
	`li°_p›
(&
∑ª¡
.
chûdªn
, 
chûd
, 
li°
Ë=
NULL
);

205  
	`exô_°©us
();

206 
	}
}

	@ccan/ccan/md4/md4.c

22 
	~"md4.h
"

23 
	~<cˇn/ídün/ídün.h
>

24 
	~<cˇn/¨øy_size/¨øy_size.h
>

25 
	~<°rög.h
>

27 
ölöe
 
uöt32_t
 
	$lshi·
(
uöt32_t
 
x
, 
s
)

29 
x
 &= 0xFFFFFFFF;

30  ((
x
 << 
s
) & 0xFFFFFFFF) | (x >> (32 - s));

31 
	}
}

33 
ölöe
 
uöt32_t
 
	$F
(
uöt32_t
 
x
, uöt32_à
y
, uöt32_à
z
)

35  (
x
 & 
y
Ë| ((~xË& 
z
);

36 
	}
}

38 
ölöe
 
uöt32_t
 
	$G
(
uöt32_t
 
x
, uöt32_à
y
, uöt32_à
z
)

40  (
x
 & 
y
Ë| (x & 
z
) | (y & z);

41 
	}
}

43 
ölöe
 
uöt32_t
 
	$H
(
uöt32_t
 
x
, uöt32_à
y
, uöt32_à
z
)

45  
x
 ^ 
y
 ^ 
z
;

46 
	}
}

48 
	#ROUND1
(
a
,
b
,
c
,
d
,
k
,
s
Ë◊ = 
	`lshi·
◊ + 
	`F
(b,c,dË+ k, s))

	)

49 
	#ROUND2
(
a
,
b
,
c
,
d
,
k
,
s
Ë◊ = 
	`lshi·
◊ + 
	`G
(b,c,dË+ k + (
uöt32_t
)0x5A827999,s))

	)

50 
	#ROUND3
(
a
,
b
,
c
,
d
,
k
,
s
Ë◊ = 
	`lshi·
◊ + 
	`H
(b,c,dË+ k + (
uöt32_t
)0x6ED9EBA1,s))

	)

52 
ölöe
 
	$À32_to_˝u_¨øy
(
uöt32_t
 *
buf
, 
w‹ds
)

54 
w‹ds
--) {

55 *
buf
 = 
	`À32_to_˝u
(*buf);

56 
buf
++;

58 
	}
}

60 
ölöe
 
	$˝u_to_À32_¨øy
(
uöt32_t
 *
buf
, 
w‹ds
)

62 
w‹ds
--) {

63 *
buf
 = 
	`˝u_to_À32
(*buf);

64 
buf
++;

66 
	}
}

68 
	$md4_å™sf‹m
(
uöt32_t
 *
hash
, uöt32_àc⁄° *
ö
)

70 
uöt32_t
 
a
, 
b
, 
c
, 
d
;

72 
a
 = 
hash
[0];

73 
b
 = 
hash
[1];

74 
c
 = 
hash
[2];

75 
d
 = 
hash
[3];

77 
	`ROUND1
(
a
, 
b
, 
c
, 
d
, 
ö
[0], 3);

78 
	`ROUND1
(
d
, 
a
, 
b
, 
c
, 
ö
[1], 7);

79 
	`ROUND1
(
c
, 
d
, 
a
, 
b
, 
ö
[2], 11);

80 
	`ROUND1
(
b
, 
c
, 
d
, 
a
, 
ö
[3], 19);

81 
	`ROUND1
(
a
, 
b
, 
c
, 
d
, 
ö
[4], 3);

82 
	`ROUND1
(
d
, 
a
, 
b
, 
c
, 
ö
[5], 7);

83 
	`ROUND1
(
c
, 
d
, 
a
, 
b
, 
ö
[6], 11);

84 
	`ROUND1
(
b
, 
c
, 
d
, 
a
, 
ö
[7], 19);

85 
	`ROUND1
(
a
, 
b
, 
c
, 
d
, 
ö
[8], 3);

86 
	`ROUND1
(
d
, 
a
, 
b
, 
c
, 
ö
[9], 7);

87 
	`ROUND1
(
c
, 
d
, 
a
, 
b
, 
ö
[10], 11);

88 
	`ROUND1
(
b
, 
c
, 
d
, 
a
, 
ö
[11], 19);

89 
	`ROUND1
(
a
, 
b
, 
c
, 
d
, 
ö
[12], 3);

90 
	`ROUND1
(
d
, 
a
, 
b
, 
c
, 
ö
[13], 7);

91 
	`ROUND1
(
c
, 
d
, 
a
, 
b
, 
ö
[14], 11);

92 
	`ROUND1
(
b
, 
c
, 
d
, 
a
, 
ö
[15], 19);

94 
	`ROUND2
(
a
, 
b
, 
c
, 
d
,
ö
[ 0], 3);

95 
	`ROUND2
(
d
, 
a
, 
b
, 
c
, 
ö
[4], 5);

96 
	`ROUND2
(
c
, 
d
, 
a
, 
b
, 
ö
[8], 9);

97 
	`ROUND2
(
b
, 
c
, 
d
, 
a
, 
ö
[12], 13);

98 
	`ROUND2
(
a
, 
b
, 
c
, 
d
, 
ö
[1], 3);

99 
	`ROUND2
(
d
, 
a
, 
b
, 
c
, 
ö
[5], 5);

100 
	`ROUND2
(
c
, 
d
, 
a
, 
b
, 
ö
[9], 9);

101 
	`ROUND2
(
b
, 
c
, 
d
, 
a
, 
ö
[13], 13);

102 
	`ROUND2
(
a
, 
b
, 
c
, 
d
, 
ö
[2], 3);

103 
	`ROUND2
(
d
, 
a
, 
b
, 
c
, 
ö
[6], 5);

104 
	`ROUND2
(
c
, 
d
, 
a
, 
b
, 
ö
[10], 9);

105 
	`ROUND2
(
b
, 
c
, 
d
, 
a
, 
ö
[14], 13);

106 
	`ROUND2
(
a
, 
b
, 
c
, 
d
, 
ö
[3], 3);

107 
	`ROUND2
(
d
, 
a
, 
b
, 
c
, 
ö
[7], 5);

108 
	`ROUND2
(
c
, 
d
, 
a
, 
b
, 
ö
[11], 9);

109 
	`ROUND2
(
b
, 
c
, 
d
, 
a
, 
ö
[15], 13);

111 
	`ROUND3
(
a
, 
b
, 
c
, 
d
,
ö
[ 0], 3);

112 
	`ROUND3
(
d
, 
a
, 
b
, 
c
, 
ö
[8], 9);

113 
	`ROUND3
(
c
, 
d
, 
a
, 
b
, 
ö
[4], 11);

114 
	`ROUND3
(
b
, 
c
, 
d
, 
a
, 
ö
[12], 15);

115 
	`ROUND3
(
a
, 
b
, 
c
, 
d
, 
ö
[2], 3);

116 
	`ROUND3
(
d
, 
a
, 
b
, 
c
, 
ö
[10], 9);

117 
	`ROUND3
(
c
, 
d
, 
a
, 
b
, 
ö
[6], 11);

118 
	`ROUND3
(
b
, 
c
, 
d
, 
a
, 
ö
[14], 15);

119 
	`ROUND3
(
a
, 
b
, 
c
, 
d
, 
ö
[1], 3);

120 
	`ROUND3
(
d
, 
a
, 
b
, 
c
, 
ö
[9], 9);

121 
	`ROUND3
(
c
, 
d
, 
a
, 
b
, 
ö
[5], 11);

122 
	`ROUND3
(
b
, 
c
, 
d
, 
a
, 
ö
[13], 15);

123 
	`ROUND3
(
a
, 
b
, 
c
, 
d
, 
ö
[3], 3);

124 
	`ROUND3
(
d
, 
a
, 
b
, 
c
, 
ö
[11], 9);

125 
	`ROUND3
(
c
, 
d
, 
a
, 
b
, 
ö
[7], 11);

126 
	`ROUND3
(
b
, 
c
, 
d
, 
a
, 
ö
[15], 15);

128 
hash
[0] +
a
;

129 
hash
[1] +
b
;

130 
hash
[2] +
c
;

131 
hash
[3] +
d
;

132 
	}
}

134 
ölöe
 
	$md4_å™sf‹m_hñ≥r
(
md4_˘x
 *
˘x
)

136 
	`À32_to_˝u_¨øy
(
˘x
->
block
, 
	`ARRAY_SIZE
(ctx->block));

137 
	`md4_å™sf‹m
(
˘x
->
hash
.
w‹ds
, ctx->
block
);

138 
	}
}

140 
	$md4_öô
(
md4_˘x
 *
m˘x
)

142 
m˘x
->
hash
.
w‹ds
[0] = 0x67452301;

143 
m˘x
->
hash
.
w‹ds
[1] = 0xefcdab89;

144 
m˘x
->
hash
.
w‹ds
[2] = 0x98badcfe;

145 
m˘x
->
hash
.
w‹ds
[3] = 0x10325476;

146 
m˘x
->
byã_cou¡
 = 0;

147 
	}
}

149 
	$md4_hash
(
md4_˘x
 *
m˘x
, c⁄° *
p
, 
size_t
 
Àn
)

151 c⁄° *
d©a
 = 
p
;

152 c⁄° 
uöt32_t
 
avaû
 = (
m˘x
->
block
Ë- (m˘x->
byã_cou¡
 & 0x3f);

154 
m˘x
->
byã_cou¡
 +
Àn
;

156 i‡(
avaû
 > 
Àn
) {

157 
	`mem˝y
((*)
m˘x
->
block
 + ((m˘x->blockË- 
avaû
),

158 
d©a
, 
Àn
);

162 
	`mem˝y
((*)
m˘x
->
block
 + ((m˘x->blockË- 
avaû
),

163 
d©a
, 
avaû
);

165 
	`md4_å™sf‹m_hñ≥r
(
m˘x
);

166 
d©a
 +
avaû
;

167 
Àn
 -
avaû
;

169 
Àn
 >(
m˘x
->
block
)) {

170 
	`mem˝y
(
m˘x
->
block
, 
d©a
, (mctx->block));

171 
	`md4_å™sf‹m_hñ≥r
(
m˘x
);

172 
d©a
 +(
m˘x
->
block
);

173 
Àn
 -(
m˘x
->
block
);

176 
	`mem˝y
(
m˘x
->
block
, 
d©a
, 
Àn
);

177 
	}
}

179 
	$md4_föish
(
md4_˘x
 *
m˘x
)

181 c⁄° 
off£t
 = 
m˘x
->
byã_cou¡
 & 0x3f;

182 *
p
 = (*)
m˘x
->
block
 + 
off£t
;

183 
∑ddög
 = 56 - (
off£t
 + 1);

185 *
p
++ = 0x80;

186 i‡(
∑ddög
 < 0) {

187 
	`mem£t
(
p
, 0x00, 
∑ddög
 +  (
uöt64_t
));

188 
	`md4_å™sf‹m_hñ≥r
(
m˘x
);

189 
p
 = (*)
m˘x
->
block
;

190 
∑ddög
 = 56;

193 
	`mem£t
(
p
, 0, 
∑ddög
);

194 
m˘x
->
block
[14] = m˘x->
byã_cou¡
 << 3;

195 
m˘x
->
block
[15] = m˘x->
byã_cou¡
 >> 29;

196 
	`À32_to_˝u_¨øy
(
m˘x
->
block
, ((mctx->block) -

197 (
uöt64_t
)Ë/ (
uöt32_t
));

198 
	`md4_å™sf‹m
(
m˘x
->
hash
.
w‹ds
, m˘x->
block
);

199 
	`˝u_to_À32_¨øy
(
m˘x
->
hash
.
w‹ds
, 
	`ARRAY_SIZE
(mctx->hash.words));

200 
	}
}

	@ccan/ccan/md4/md4.h

2 #i‚de‡
CCAN_MD4_H


3 
	#CCAN_MD4_H


	)

4 
	~<°döt.h
>

5 
	~<°dlib.h
>

13 
	smd4_˘x
 {

15 
	mbyãs
[16];

16 
uöt32_t
 
	mw‹ds
[4];

17 } 
	mhash
;

18 
uöt32_t
 
	mblock
[16];

19 
uöt64_t
 
	mbyã_cou¡
;

34 
md4_öô
(
md4_˘x
 *
m˘x
);

50 
md4_hash
(
md4_˘x
 *
m˘x
, c⁄° *
p
, 
size_t
 
Àn
);

63 
md4_föish
(
md4_˘x
 *
m˘x
);

	@ccan/ccan/md4/test/api.c

1 
	~<cˇn/md4/md4.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

6 
	$check_md4
(c⁄° *
°rög
, c⁄° *
ex≥˘ed
)

8 
md4_˘x
 
˘x
;

9 
i
;

10 
ªsu…
[33];

12 
	`md4_öô
(&
˘x
);

13 
	`md4_hash
(&
˘x
, 
°rög
, 
	`°æí
(string));

14 
	`md4_föish
(&
˘x
);

15 
i
 = 0; i < (
˘x
.
hash
.
byãs
); i++)

16 
	`•rötf
(
ªsu…
+
i
*2, "%02x", 
˘x
.
hash
.
byãs
[i]);

17 
	`ok
(
	`°rcmp
(
ªsu…
, 
ex≥˘ed
) == 0,

18 "Ex≥˘ed %s, gŸ %s", 
ex≥˘ed
, 
ªsu…
);

19 
	}
}

21 
	$maö
(
¨gc
, *
¨gv
[])

24 
	`∂™_ã°s
(7);

26 
	`check_md4
("", "31d6cfe0d16ae931b73c59d7e0c089c0");

27 
	`check_md4
("a", "bde52cb31de33e46245e05fbdbd6fb24");

28 
	`check_md4
("abc", "a448017aaf21d8525fc10ae87aa6729d");

29 
	`check_md4
("message digest", "d9130a8164549fe818874806e1c7014b");

30 
	`check_md4
("abcdefghijklmnopqrstuvwxyz",

32 
	`check_md4
("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"

35 
	`check_md4
("1234567890123456789012345678901234567890123456789"

38 
	`exô
(
	`exô_°©us
());

39 
	}
}

	@ccan/ccan/net/net.c

2 
	~<cˇn/√t/√t.h
>

3 
	~<cˇn/n€º/n€º.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/sockë.h
>

6 
	~<pﬁl.h
>

7 
	~<√tdb.h
>

8 
	~<°rög.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

11 
	~<f˙é.h
>

12 
	~<î∫o.h
>

13 
	~<°dboﬁ.h
>

14 
	~<√töë/ö.h
>

15 
	~<as£π.h
>

17 
addröfo
 *
	$√t_˛õ¡_lookup
(c⁄° *
ho°«me
,

18 c⁄° *
£rvi˚
,

19 
Ámûy
,

20 
sockty≥
)

22 
addröfo
 
höts
;

23 
addröfo
 *
ªs
;

25 
	`mem£t
(&
höts
, 0, (hints));

26 
höts
.
ai_Ámûy
 = 
Ámûy
;

27 
höts
.
ai_sockty≥
 = 
sockty≥
;

28 
höts
.
ai_Êags
 = 0;

29 
höts
.
ai_¥Ÿocﬁ
 = 0;

31 i‡(
	`gëaddröfo
(
ho°«me
, 
£rvi˚
, &
höts
, &
ªs
) != 0)

32  
NULL
;

34  
ªs
;

35 
	}
}

37 
boﬁ
 
	$£t_n⁄block
(
fd
, 
boﬁ
 
n⁄block
)

39 
Êags
;

41 
Êags
 = 
	`f˙é
(
fd
, 
F_GETFL
);

42 i‡(
Êags
 == -1)

43  
Ál£
;

45 i‡(
n⁄block
)

46 
Êags
 |
O_NONBLOCK
;

48 
Êags
 &~()
O_NONBLOCK
;

50  (
	`f˙é
(
fd
, 
F_SETFL
, 
Êags
) == 0);

51 
	}
}

53 
	$°¨t_c⁄√˘
(c⁄° 
addröfo
 *
addr
, 
boﬁ
 *
immedüã
)

55 
fd
;

57 *
immedüã
 = 
Ál£
;

59 
fd
 = 
	`sockë
(
addr
->
ai_Ámûy
,áddr->
ai_sockty≥
,áddr->
ai_¥Ÿocﬁ
);

60 i‡(
fd
 == -1)

61  
fd
;

63 i‡(!
	`£t_n⁄block
(
fd
, 
åue
))

64 
˛o£
;

66 i‡(
	`c⁄√˘
(
fd
, 
addr
->
ai_addr
,áddr->
ai_addæí
) == 0) {

68 *
immedüã
 = 
åue
;

69  
fd
;

72 i‡(
î∫o
 =
EINPROGRESS
)

73  
fd
;

75 
˛o£
:

76 
	`˛o£_n€º
(
fd
);

78 
	}
}

81 
	$√t_c⁄√˘_async
(c⁄° 
addröfo
 *addröfo, 
pﬁlfd
 
pfds
[2])

83 c⁄° 
addröfo
 *
addr
[2] = { 
NULL
, NULL };

84 
i
;

86 
pfds
[0].
fd
 =Öfds[1].fd = -1;

87 
pfds
[0].
evíts
 =Öfds[1].evít†
POLLOUT
;

90 ; 
addröfo
;áddröfÿaddröfo->
ai_√xt
) {

91 
addröfo
->
ai_Ámûy
) {

92 
AF_INET
:

93 
addr
[1] = 
addröfo
;

95 
AF_INET6
:

96 
addr
[0] = 
addröfo
;

104 
î∫o
 = 
ENOENT
;

105 
i
 = 0; i < 2; i++) {

106 
boﬁ
 
immedüã
;

108 i‡(!
addr
[
i
])

111 
pfds
[
i
].
fd
 = 
	`°¨t_c⁄√˘
(
addr
[i], &
immedüã
);

112 i‡(
immedüã
) {

113 i‡(
pfds
[!
i
].
fd
 != -1)

114 
	`˛o£
(
pfds
[!
i
].
fd
);

115 i‡(!
	`£t_n⁄block
(
pfds
[
i
].
fd
, 
Ál£
)) {

116 
	`˛o£_n€º
(
pfds
[
i
].
fd
);

119  
pfds
[0].
fd
;

123 i‡(
pfds
[0].
fd
 != -1 ||Öfds[1].fd != -1)

124 
î∫o
 = 
EINPROGRESS
;

126 
	}
}

128 
	$√t_c⁄√˘_ab‹t
(
pﬁlfd
 
pfds
[2])

130 
i
;

132 
i
 = 0; i < 2; i++) {

133 i‡(
pfds
[
i
].
fd
 != -1)

134 
	`˛o£_n€º
(
pfds
[
i
].
fd
);

135 
pfds
[
i
].
fd
 = -1;

137 
	}
}

139 
	$√t_c⁄√˘_com∂ëe
(
pﬁlfd
 
pfds
[2])

141 
i
;

143 
	`as£π
(
pfds
[0].
fd
 != -1 ||Öfds[1].fd != -1);

145 
i
 = 0; i < 2; i++) {

146 
îr
;

147 
sockÀn_t
 
îæí
 = (
îr
);

149 i‡(
pfds
[
i
].
fd
 == -1)

151 i‡(
	`gësock›t
(
pfds
[
i
].
fd
, 
SOL_SOCKET
, 
SO_ERROR
, &
îr
,

152 &
îæí
) != 0) {

153 
	`√t_c⁄√˘_ab‹t
(
pfds
);

156 i‡(
îr
 == 0) {

158 i‡(!
	`£t_n⁄block
(
pfds
[
i
].
fd
, 
Ál£
)) {

159 
	`√t_c⁄√˘_ab‹t
(
pfds
);

163 i‡(
pfds
[!
i
].
fd
 != -1)

164 
	`˛o£
(
pfds
[!
i
].
fd
);

165  
pfds
[
i
].
fd
;

170 
î∫o
 = 
EINPROGRESS
;

172 
	}
}

174 
	$√t_c⁄√˘
(c⁄° 
addröfo
 *addrinfo)

176 
pﬁlfd
 
pfds
[2];

177 
sockfd
;

179 
sockfd
 = 
	`√t_c⁄√˘_async
(
addröfo
, 
pfds
);

181 i‡(
sockfd
 >0 || 
î∫o
 !
EINPROGRESS
)

182  
sockfd
;

184 
	`pﬁl
(
pfds
, 2, -1) != -1) {

185 
sockfd
 = 
	`√t_c⁄√˘_com∂ëe
(
pfds
);

186 i‡(
sockfd
 >0 || 
î∫o
 !
EINPROGRESS
)

187  
sockfd
;

190 
	`√t_c⁄√˘_ab‹t
(
pfds
);

192 
	}
}

194 
addröfo
 *
	$√t_£rvî_lookup
(c⁄° *
£rvi˚
,

195 
Ámûy
,

196 
sockty≥
)

198 
addröfo
 *
ªs
, 
höts
;

200 
	`mem£t
(&
höts
, 0, (hints));

201 
höts
.
ai_Ámûy
 = 
Ámûy
;

202 
höts
.
ai_sockty≥
 = 
sockty≥
;

203 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

204 
höts
.
ai_¥Ÿocﬁ
 = 0;

206 i‡(
	`gëaddröfo
(
NULL
, 
£rvi˚
, &
höts
, &
ªs
) != 0)

207  
NULL
;

209  
ªs
;

210 
	}
}

212 
boﬁ
 
	$should_li°í
(c⁄° 
addröfo
 *addrinfo)

214 #ifde‡
SOCK_SEQPACKET


215 i‡(
addröfo
->
ai_sockty≥
 =
SOCK_SEQPACKET
)

216  
åue
;

218  (
addröfo
->
ai_sockty≥
 =
SOCK_STREAM
);

219 
	}
}

221 
	$make_li°í_fd
(c⁄° 
addröfo
 *addrinfo)

223 
ßved_î∫o
, 
fd
, 
⁄
 = 1;

225 
fd
 = 
	`sockë
(
addröfo
->
ai_Ámûy
,áddröfo->
ai_sockty≥
,

226 
addröfo
->
ai_¥Ÿocﬁ
);

227 i‡(
fd
 < 0)

230 
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (on));

231 i‡(
	`böd
(
fd
, 
addröfo
->
ai_addr
,áddröfo->
ai_addæí
) != 0)

232 
Áû
;

234 i‡(
	`should_li°í
(
addröfo
Ë&& 
	`li°í
(
fd
, 5) != 0)

235 
Áû
;

236  
fd
;

238 
Áû
:

239 
ßved_î∫o
 = 
î∫o
;

240 
	`˛o£
(
fd
);

241 
î∫o
 = 
ßved_î∫o
;

243 
	}
}

245 
	$√t_böd
(c⁄° 
addröfo
 *addröfo, 
fds
[2])

247 c⁄° 
addröfo
 *
ùv6
 = 
NULL
;

248 c⁄° 
addröfo
 *
ùv4
 = 
NULL
;

249 
num
;

251 i‡(
addröfo
->
ai_Ámûy
 =
AF_INET
)

252 
ùv4
 = 
addröfo
;

253 i‡(
addröfo
->
ai_Ámûy
 =
AF_INET6
)

254 
ùv6
 = 
addröfo
;

256 i‡(
addröfo
->
ai_√xt
) {

257 i‡(
addröfo
->
ai_√xt
->
ai_Ámûy
 =
AF_INET
)

258 
ùv4
 = 
addröfo
->
ai_√xt
;

259 i‡(
addröfo
->
ai_√xt
->
ai_Ámûy
 =
AF_INET6
)

260 
ùv6
 = 
addröfo
->
ai_√xt
;

263 
num
 = 0;

265 i‡(
ùv6
) {

266 i‡((
fds
[
num
] = 
	`make_li°í_fd
(
ùv6
)) >= 0)

267 
num
++;

269 
ùv6
 = 
NULL
;

271 i‡(
ùv4
) {

272 i‡((
fds
[
num
] = 
	`make_li°í_fd
(
ùv4
)) >= 0)

273 
num
++;

275 
ùv4
 = 
NULL
;

277 i‡(
num
 == 0)

280  
num
;

281 
	}
}

	@ccan/ccan/net/net.h

2 #i‚de‡
CCAN_NET_H


3 
	#CCAN_NET_H


	)

4 
	~<°dboﬁ.h
>

6 
	gpﬁlfd
;

34 
addröfo
 *
√t_˛õ¡_lookup
(c⁄° *
ho°«me
,

35 c⁄° *
£rvi˚
,

36 
Ámûy
,

37 
sockty≥
);

54 
√t_c⁄√˘
(c⁄° 
addröfo
 *addrinfo);

75 
√t_c⁄√˘_async
(c⁄° 
addröfo
 *addröfo, 
pﬁlfd
 *
pfds
);

96 
√t_c⁄√˘_com∂ëe
(
pﬁlfd
 *
pfds
);

115 
√t_c⁄√˘_ab‹t
(
pﬁlfd
 *
pfds
);

140 
addröfo
 *
√t_£rvî_lookup
(c⁄° *
£rvi˚
,

141 
Ámûy
,

142 
sockty≥
);

166 
√t_böd
(c⁄° 
addröfo
 *addröfo, 
fds
[2]);

	@ccan/ccan/net/test/run-bind.c

1 
	~<cˇn/√t/√t.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<sys/time.h
>

4 
	~<uni°d.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/waô.h
>

7 
	~<°dio.h
>

8 
	~<îr.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/sockë.h
>

11 
	~<√töë/ö.h
>

13 
	gùv6_⁄ly
;

15 #ifde‡
IPV6_V6ONLY


16 
	$my_£tsock›t
(
sockfd
, 
Àvñ
, 
›äame
,

17 c⁄° *
›tvÆ
, 
sockÀn_t
 
›éí
)

19 
ªt
;

20 
	`£tsock›t
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_V6ONLY
, &
ùv6_⁄ly
,

21 (
ùv6_⁄ly
));

22 
ªt
 = 
	`£tsock›t
(
sockfd
, 
Àvñ
, 
›äame
, 
›tvÆ
, 
›éí
);

23  
ªt
;

24 
	}
}

25 
	#£tsock›t
 
my_£tsock›t


	)

28 
	~<cˇn/√t/√t.c
>

30 
	#TEST_PORT
 "65001"

	)

32 
	$do_c⁄√˘
(
Ámûy
, 
ty≥
)

34 
fd
, 
ªt
;

35 
addröfo
 *
addr
;

36 
buf
[8];

39 
	`Æ¨m
(5);

40 
addr
 = 
	`√t_˛õ¡_lookup
(
NULL
, 
TEST_PORT
, 
Ámûy
, 
ty≥
);

41 
fd
 = 
	`√t_c⁄√˘
(
addr
);

42 i‡(
fd
 < 0)

43 
	`îr
(1, "FailedÇet_connect");

44 
	`‰ìaddröfo
(
addr
);

46 
ªt
 = 
	`wrôe
(
fd
, "Yay!", 
	`°æí
("Yay!"));

47 i‡(
ªt
 !
	`°æí
("Yay!"))

48 
	`îr
(1, "Wrôêªtu∫ed %i", 
ªt
);

49 
ªt
 = 
	`ªad
(
fd
, 
buf
, (buf));

50 i‡(
ªt
 != 5)

51 
	`îr
(1, "RódÑëu∫ed %i", 
ªt
);

52 i‡(
	`memcmp
(
buf
, "mëoo", 
ªt
) != 0)

53 
	`îr
(1, "RódÑëu∫ed '%.*s'", 
ªt
, 
buf
);

54 
	`˛o£
(
fd
);

55 
	}
}

57 
	$waô_f‹_ªadabÀ
(
fds
[2], 
num_fds
)

59 
i
, 
max_fd
 = -1;

60 
fd_£t
 
£t
;

62 
	`FD_ZERO
(&
£t
);

63 
i
 = 0; i < 
num_fds
; i++) {

64 i‡(
fds
[
i
] > 
max_fd
)

65 
max_fd
 = 
fds
[
i
];

66 
	`FD_SET
(
fds
[
i
], &
£t
);

69 
	`£À˘
(
max_fd
+1, &
£t
, 
NULL
, NULL, NULL);

70 
i
 = 0; i < 
num_fds
; i++) {

71 i‡(
	`FD_ISSET
(
fds
[
i
], &
£t
))

72  
i
;

74  
num_fds
+1;

75 
	}
}

77 
	$maö
()

79 
addröfo
 *
addr
;

80 
fds
[2], 
num_fds
, 
i
, 
fd
, 
°©us
, 
ªt
;

81 
buf
[20];

83 
sockaddr
 
addr
;

84 
sockaddr_ö
 
ùv4
;

85 
sockaddr_ö6
 
ùv6
;

86 } 
ªmŸe_addr
;

87 
sockÀn_t
 
addÀn
 = (
ªmŸe_addr
);

89 
	`∂™_ã°s
(35);

92 
addr
 = 
	`√t_£rvî_lookup
(
TEST_PORT
, 
AF_UNSPEC
, 
SOCK_STREAM
);

93 
	`ok1
(
addr
);

94 
num_fds
 = 
	`√t_böd
(
addr
, 
fds
);

95 
	`ok1
(
num_fds
 == 1 ||Çum_fds == 2);

97 i‡(!
	`f‹k
()) {

98 
i
 = 0; i < 
num_fds
; i++)

99 
	`˛o£
(
fds
[
i
]);

100 
	`do_c⁄√˘
(
AF_UNSPEC
, 
SOCK_STREAM
);

101 
	`exô
(0);

104 
i
 = 
	`waô_f‹_ªadabÀ
(
fds
, 
num_fds
);

105 
	`ok1
(
i
 < 
num_fds
);

106 
fd
 = 
	`ac˚±
(
fds
[
i
], 
NULL
, NULL);

107 
	`ok1
(
fd
 >= 0);

109 
ªt
 = 
	`ªad
(
fd
, 
buf
, 
	`°æí
("Yay!"));

110 
	`ok1
(
ªt
 =
	`°æí
("Yay!"));

111 
	`ok1
(
	`memcmp
(
buf
, "Yay!", 
ªt
) == 0);

112 
ªt
 = 
	`wrôe
(
fd
, "mëoo", 
	`°æí
("metoo"));

113 
	`ok1
(
ªt
 =
	`°æí
("metoo"));

114 
	`ok1
(
	`waô
(&
°©us
) != -1);

115 
	`ok1
(
	`WIFEXITED
(
°©us
));

116 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

117 
	`˛o£
(
fd
);

118 
i
 = 0; i < 
num_fds
; i++)

119 
	`˛o£
(
fds
[
i
]);

120 
	`‰ìaddröfo
(
addr
);

123 
addr
 = 
	`√t_£rvî_lookup
(
TEST_PORT
, 
AF_UNSPEC
, 
SOCK_DGRAM
);

124 
	`ok1
(
addr
);

125 
num_fds
 = 
	`√t_böd
(
addr
, 
fds
);

126 
	`ok1
(
num_fds
 == 1 ||Çum_fds == 2);

128 i‡(!
	`f‹k
()) {

129 
i
 = 0; i < 
num_fds
; i++)

130 
	`˛o£
(
fds
[
i
]);

131 
	`do_c⁄√˘
(
AF_UNSPEC
, 
SOCK_DGRAM
);

132 
	`exô
(0);

135 
i
 = 
	`waô_f‹_ªadabÀ
(
fds
, 
num_fds
);

136 
	`ok1
(
i
 < 
num_fds
);

137 
fd
 = 
fds
[
i
];

139 
ªt
 = 
	`ªcv‰om
(
fd
, 
buf
, 
	`°æí
("Yay!"), 0,

140 (*)&
ªmŸe_addr
, &
addÀn
);

141 
	`ok1
(
ªt
 =
	`°æí
("Yay!"));

142 
	`ok1
(
	`memcmp
(
buf
, "Yay!", 
ªt
) == 0);

143 
ªt
 = 
	`£ndto
(
fd
, "mëoo", 
	`°æí
("metoo"), 0,

144 (*)&
ªmŸe_addr
, 
addÀn
);

145 
	`ok1
(
ªt
 =
	`°æí
("metoo"));

146 
	`ok1
(
	`waô
(&
°©us
) >= 0);

147 
	`ok1
(
	`WIFEXITED
(
°©us
));

148 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

149 
	`˛o£
(
fd
);

150 
i
 = 0; i < 
num_fds
; i++)

151 
	`˛o£
(
fds
[
i
]);

154 #ifde‡
IPV6_V6ONLY


156 i‡(
addr
->
ai_√xt
)

157 
ùv6_⁄ly
 = 
åue
;

159 
	`‰ìaddröfo
(
addr
);

161 i‡(
ùv6_⁄ly
) {

162 
j
;

164 
addr
 = 
	`√t_£rvî_lookup
(
TEST_PORT
, 
AF_UNSPEC
, 
SOCK_STREAM
);

165 
	`ok1
(
addr
);

166 
num_fds
 = 
	`√t_böd
(
addr
, 
fds
);

167 
	`ok1
(
num_fds
 == 2);

168 
	`‰ìaddröfo
(
addr
);

170 i‡(!
	`f‹k
()) {

171 
i
 = 0; i < 
num_fds
; i++)

172 
	`˛o£
(
fds
[
i
]);

173 
	`do_c⁄√˘
(
AF_INET
, 
SOCK_STREAM
);

174 
	`do_c⁄√˘
(
AF_INET6
, 
SOCK_STREAM
);

175 
	`exô
(0);

178 
i
 = 
	`waô_f‹_ªadabÀ
(
fds
, 
num_fds
);

179 
	`ok1
(
i
 < 
num_fds
);

180 
fd
 = 
	`ac˚±
(
fds
[
i
], 
NULL
, NULL);

181 
	`ok1
(
fd
 >= 0);

183 
ªt
 = 
	`ªad
(
fd
, 
buf
, 
	`°æí
("Yay!"));

184 
	`ok1
(
ªt
 =
	`°æí
("Yay!"));

185 
	`ok1
(
	`memcmp
(
buf
, "Yay!", 
ªt
) == 0);

186 
ªt
 = 
	`wrôe
(
fd
, "mëoo", 
	`°æí
("metoo"));

187 
	`ok1
(
ªt
 =
	`°æí
("metoo"));

188 
	`˛o£
(
fd
);

190 
j
 = 
	`waô_f‹_ªadabÀ
(
fds
, 
num_fds
);

191 
	`ok1
(
j
 < 
num_fds
);

192 
	`ok1
(
j
 !
i
);

193 
fd
 = 
	`ac˚±
(
fds
[
j
], 
NULL
, NULL);

194 
	`ok1
(
fd
 >= 0);

196 
ªt
 = 
	`ªad
(
fd
, 
buf
, 
	`°æí
("Yay!"));

197 
	`ok1
(
ªt
 =
	`°æí
("Yay!"));

198 
	`ok1
(
	`memcmp
(
buf
, "Yay!", 
ªt
) == 0);

199 
ªt
 = 
	`wrôe
(
fd
, "mëoo", 
	`°æí
("metoo"));

200 
	`ok1
(
ªt
 =
	`°æí
("metoo"));

202 
	`ok1
(
	`waô
(&
°©us
) >= 0);

203 
	`ok1
(
	`WIFEXITED
(
°©us
));

204 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

205 
	`˛o£
(
fd
);

207 
	`skù
(16, "No support for IPv6-only binding");

209 
i
 = 0; i < 
num_fds
; i++)

210 
	`˛o£
(
fds
[
i
]);

213  
	`exô_°©us
();

214 
	}
}

	@ccan/ccan/net/test/run.c

1 
	~<cˇn/√t/√t.h
>

2 
	~<cˇn/√t/√t.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/waô.h
>

6 
	~<°dio.h
>

7 
	~<îr.h
>

9 
	$£rvî
(
¥Ÿocﬁ
, 
ty≥
)

11 
sock
;

13 
sockaddr
 
addr
;

14 
sockaddr_ö
 
ùv4
;

15 
sockaddr_ö6
 
ùv6
;

16 } 
addr
;

17 
sockÀn_t
 
addÀn
 = (
addr
);

19 
sock
 = 
	`sockë
(
¥Ÿocﬁ
, 
ty≥
, 0);

20 i‡(
sock
 < 0)

24 i‡(
	`li°í
(
sock
, 0) != 0)

28 
	`gësock«me
(
sock
, &
addr
.addr, &
addÀn
);

29 
	`fÊush
(
°dout
);

31 i‡(
	`f‹k
() == 0) {

32 
ªt
, 
fd
;

34 
	`Æ¨m
(3);

35 
fd
 = 
	`ac˚±
(
sock
, 
NULL
, 0);

36 i‡(
fd
 < 0)

37 
	`îr
(1, "Ac˚±ög from sockë %i", 
sock
);

39 
ªt
 = 
	`wrôe
(
fd
, "Yay!", 
	`°æí
("Yay!"));

40 i‡(
ªt
 !
	`°æí
("Yay!"))

41 
	`îr
(1, "Wrôêªtu∫ed %i", 
ªt
);

42 
	`exô
(0);

44 
	`˛o£
(
sock
);

45  
	`¡ohs
(
¥Ÿocﬁ
 =
AF_INET


46 ? 
addr
.
ùv4
.
sö_p‹t
 :áddr.
ùv6
.
sö6_p‹t
);

47 
	}
}

50 
addröfo
* 
	$doubÀ_addr_lookup
(* 
buf
, 
boﬁ
 *
Áke_doubÀ
)

52 
addröfo
 *
addr
, *
addr2
;

54 
addr
 = 
	`√t_˛õ¡_lookup
("loˇlho°", 
buf
, 
AF_UNSPEC
, 
SOCK_STREAM
);

55 i‡(!
addr
)

56  
addr
;

59 i‡(
addr
->
ai_√xt
) {

60 
addr2
 = 
addr
->
ai_√xt
;

61 *
Áke_doubÀ
 = 
Ál£
;

64 i‡(
addr
->
ai_Ámûy
 =
AF_INET
) {

66 
addr2
 = 
	`√t_˛õ¡_lookup
("ù6-loˇlho°", 
buf
,

67 
AF_UNSPEC
, 
SOCK_STREAM
);

68 i‡(!
addr2
)

69 
addr2
 = 
	`√t_˛õ¡_lookup
("loˇlho°6", 
buf
,

70 
AF_UNSPEC
,

71 
SOCK_STREAM
);

72 i‡(!
addr2
)

73 
addr2
 = 
	`√t_˛õ¡_lookup
("::1", 
buf
,

74 
AF_UNSPEC
,

75 
SOCK_STREAM
);

76 } i‡(
addr
->
ai_Ámûy
 =
AF_INET6
)

78 
addr2
 = 
	`√t_˛õ¡_lookup
("ù4-loˇlho°", 
buf
,

79 
AF_UNSPEC
, 
SOCK_STREAM
);

82 i‡(!
addr2
) {

83 *
Áke_doubÀ
 = 
Ál£
;

84  
addr
;

87 *
Áke_doubÀ
 = 
åue
;

88 
addr
->
ai_√xt
 = 
addr2
;

92 i‡(
addr2
->
ai_√xt
)

93  
NULL
;

95 i‡(
addr
->
ai_Ámûy
 =
AF_INET
 && 
addr2
->ai_Ámûy =
AF_INET6
)

96  
addr
;

97 i‡(
addr
->
ai_Ámûy
 =
AF_INET6
 && 
addr2
->ai_Ámûy =
AF_INET
)

98  
addr
;

99  
NULL
;

100 
	}
}

102 
	$doubÀ_addr_‰ì
(
addröfo
* 
addr
, 
boﬁ
 
Áke_doubÀ
)

104 i‡(
Áke_doubÀ
) {

105 
	`‰ìaddröfo
(
addr
->
ai_√xt
);

106 
addr
->
ai_√xt
 = 
NULL
;

108 
	`‰ìaddröfo
(
addr
);

109 
	}
}

111 
	$maö
()

113 
addröfo
 *
addr
;

114 
fd
, 
°©us
;

115 
sockaddr
 
ßddr
;

116 
sockÀn_t
 
¶í
;

117 
buf
[20];

118 
p‹t
;

119 
boﬁ
 
Áke_doubÀ
;

121 
	`∂™_ã°s
(14);

123 
p‹t
 = 
	`£rvî
(
AF_INET
, 
SOCK_STREAM
);

124 i‡(
p‹t
 == -1) {

126 i‡(
î∫o
 =
EAFNOSUPPORT
)

127 
	`skù
(6, "No IPv4 socket support");

129 
	`Áû
("CouldÇot create IPv4Üistening socket: %s",

130 
	`°ªº‹
(
î∫o
));

132 
	`•rötf
(
buf
, "%u", 
p‹t
);

134 
addr
 = 
	`doubÀ_addr_lookup
(
buf
, &
Áke_doubÀ
);

135 
	`ok1
(
addr
);

136 
fd
 = 
	`√t_c⁄√˘
(
addr
);

137 
	`ok1
(
fd
 >= 0);

139 
¶í
 = (
ßddr
);

140 
	`ok1
(
	`gësock«me
(
fd
, &
ßddr
, &
¶í
) == 0);

141 
	`düg
("Ámûy = %d", 
ßddr
.
ß_Ámûy
);

142 
	`ok1
(
ßddr
.
ß_Ámûy
 =
AF_INET
);

143 
°©us
 = 
	`ªad
(
fd
, 
buf
, (buf));

144 
	`ok
(
°©us
 =
	`°æí
("Yay!"),

145 "RódÑëu∫ed %ò(%s)", 
°©us
, 
	`°ªº‹
(
î∫o
));

146 
	`ok1
(
	`°∫cmp
(
buf
, "Yay!", 
	`°æí
("Yay!")) == 0);

147 
	`˛o£
(
fd
);

148 
	`doubÀ_addr_‰ì
(
addr
, 
Áke_doubÀ
);

151 
p‹t
 = 
	`£rvî
(
AF_INET6
, 
SOCK_STREAM
);

152 i‡(
p‹t
 == -1) {

154 i‡(
î∫o
 =
EAFNOSUPPORT
)

155 
	`skù
(6, "No IPv6 socket support");

157 
	`Áû
("CouldÇot create IPv6Üistening socket: %s",

158 
	`°ªº‹
(
î∫o
));

160 
	`•rötf
(
buf
, "%u", 
p‹t
);

162 
addr
 = 
	`doubÀ_addr_lookup
(
buf
, &
Áke_doubÀ
);

163 
	`ok1
(
addr
);

164 
fd
 = 
	`√t_c⁄√˘
(
addr
);

165 
	`ok1
(
fd
 >= 0);

167 
¶í
 = (
ßddr
);

168 
	`ok1
(
	`gësock«me
(
fd
, &
ßddr
, &
¶í
) == 0);

169 
	`ok1
(
ßddr
.
ß_Ámûy
 =
AF_INET6
);

170 
°©us
 = 
	`ªad
(
fd
, 
buf
, (buf));

171 
	`ok
(
°©us
 =
	`°æí
("Yay!"),

172 "RódÑëu∫ed %ò(%s)", 
°©us
, 
	`°ªº‹
(
î∫o
));

173 
	`ok1
(
	`°∫cmp
(
buf
, "Yay!", 
	`°æí
("Yay!")) == 0);

174 
	`˛o£
(
fd
);

175 
	`doubÀ_addr_‰ì
(
addr
, 
Áke_doubÀ
);

178 
	`waô
(&
°©us
);

179 
	`ok1
(
	`WIFEXITED
(
°©us
));

180 
	`ok1
(
	`WEXITSTATUS
(
°©us
) == 0);

183  
	`exô_°©us
();

184 
	}
}

	@ccan/ccan/net/tools/test-net.c

1 
	~<cˇn/√t/√t.h
>

2 
	~<sys/ty≥s.h
>

3 
	~<sys/sockë.h
>

4 
	~<√tdb.h
>

5 
	~<°dio.h
>

6 
	~<îr.h
>

8 
	$cou¡_addrs
(c⁄° 
addröfo
 *
addr
, 
Ámûy
)

10 
num
 = 0;

12 
addr
) {

13 i‡(
Ámûy
 =
AF_UNSPEC
 || famûy =
addr
->
ai_Ámûy
)

14 
num
++;

15 
addr
 =áddr->
ai_√xt
;

17  
num
;

18 
	}
}

20 
	$maö
(
¨gc
, *
¨gv
[])

22 
addröfo
 *
addr
;

23 c⁄° *
de°
, *
p‹t
;

24 
fd
;

25 
sockaddr
 
ßddr
;

26 
sockÀn_t
 
¶í
 = (
ßddr
);

28 i‡(
¨gc
 == 2) {

29 
de°
 = 
¨gv
[1];

30 
p‹t
 = "http";

31 } i‡(
¨gc
 == 3) {

32 
de°
 = 
¨gv
[1];

33 
p‹t
 = 
¨gv
[2];

35 
	`îrx
(1, "Usage:Åest-net <target> [<port>]");

37 
addr
 = 
	`√t_˛õ¡_lookup
(
de°
, 
p‹t
, 
AF_UNSPEC
, 
SOCK_STREAM
);

38 i‡(!
addr
)

39 
	`îr
(1, "FaûedÅÿlook u∞%s", 
de°
);

41 
	`¥ötf
("Received %u IPv4áddresses, %u IPv6áddresses\n",

42 
	`cou¡_addrs
(
addr
, 
AF_INET
), cou¡_addrs◊ddr, 
AF_INET6
));

44 
fd
 = 
	`√t_c⁄√˘
(
addr
);

45 i‡(
fd
 < 0)

46 
	`îr
(1, "FaûedÅÿc⁄√˘Åÿ%s", 
de°
);

48 i‡(
	`gësock«me
(
fd
, &
ßddr
, &
¶í
) == 0)

49 
	`¥ötf
("Connected via %s\n",

50 
ßddr
.
ß_Ámûy
 =
AF_INET6
 ? "IPv6"

51 : 
ßddr
.
ß_Ámûy
 =
AF_INET
 ? "IPv4"

54 
	`îr
(1, "FailedÅo get socketÅype for connection");

56 
	}
}

	@ccan/ccan/nfs/dlinklist.h

24 #i‚de‡
_DLINKLIST_H


25 
	#_DLINKLIST_H


	)

66 
	#DLIST_ADD
(
li°
, 
p
) \

68 i‡(!(
li°
)) { \

69 (
p
)->
¥ev
 = (
li°
) = (p); \

70 (
p
)->
√xt
 = 
NULL
; \

72 (
p
)->
¥ev
 = (
li°
)->prev; \

73 (
li°
)->
¥ev
 = (
p
); \

74 (
p
)->
√xt
 = (
li°
); \

75 (
li°
Ë(
p
); \

77 } 0)

	)

84 
	#DLIST_REMOVE
(
li°
, 
p
) \

86 i‡((
p
Ë=(
li°
)) { \

87 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p)->prev; \

88 (
li°
Ë(
p
)->
√xt
; \

89 } i‡((
li°
Ë&& (
p
Ë=÷i°)->
¥ev
) { \

90 (
p
)->
¥ev
->
√xt
 = 
NULL
; \

91 (
li°
)->
¥ev
 = (
p
)->prev; \

93 i‡((
p
)->
¥ev
Ë’)->¥ev->
√xt
 = (p)->next; \

94 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p)->prev; \

96 i‡((
p
Ë!(
li°
)Ë’)->
√xt
 = (p)->
¥ev
 = 
NULL
; \

97 } 0)

	)

104 
	#DLIST_HEAD
(
p
, 
ªsu…_hód
) \

106 (
ªsu…_hód
Ë(
p
); \

107 
	`DLIST_PREV
(
ªsu…_hód
)Ë‘esu…_hódË‘esu…_hód)->
¥ev
; \

108 } 0)

	)

111 
	#DLIST_TAIL
(
li°
Ë(÷i°)?÷i°)->
¥ev
:
NULL
)

	)

114 
	#DLIST_PREV
(
p
Ë((’)->
¥ev
 && (p)->¥ev->
√xt
 !
NULL
)?’)->¥ev:NULL)

	)

118 
	#DLIST_ADD_AFTER
(
li°
, 
p
, 
ñ
) \

120 i‡(!(
li°
Ë|| !(
ñ
)) { \

121 
	`DLIST_ADD
(
li°
, 
p
); \

123 (
p
)->
¥ev
 = (
ñ
); \

124 (
p
)->
√xt
 = (
ñ
)->next; \

125 (
ñ
)->
√xt
 = (
p
); \

126 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p); \

127 i‡((
li°
)->
¥ev
 =(
ñ
)Ë÷i°)->¥ev = (
p
); \

129 } 0)

	)

136 
	#DLIST_ADD_END
(
li°
, 
p
, 
ty≥
) \

138 i‡(!(
li°
)) { \

139 
	`DLIST_ADD
(
li°
, 
p
); \

141 
	`DLIST_ADD_AFTER
(
li°
, 
p
, (li°)->
¥ev
); \

143 } 0)

	)

146 
	#DLIST_PROMOTE
(
li°
, 
p
) \

148 
	`DLIST_REMOVE
(
li°
, 
p
); \

149 
	`DLIST_ADD
(
li°
, 
p
); \

150 } 0)

	)

156 
	#DLIST_DEMOTE
(
li°
, 
p
, 
ty≥
) \

158 
	`DLIST_REMOVE
(
li°
, 
p
); \

159 
	`DLIST_ADD_END
(
li°
, 
p
, 
NULL
); \

160 } 0)

	)

167 
	#DLIST_CONCATENATE
(
li°1
, 
li°2
, 
ty≥
) \

169 i‡(!(
li°1
)) { \

170 (
li°1
Ë(
li°2
); \

172 (
li°1
)->
¥ev
->
√xt
 = (
li°2
); \

173 i‡(
li°2
) { \

174 *
_tm∂i°
 = (*)(
li°1
)->
¥ev
; \

175 (
li°1
)->
¥ev
 = (
li°2
)->prev; \

176 (
li°2
)->
¥ev
 = 
_tm∂i°
; \

179 } 0)

	)

	@ccan/ccan/nfs/init.c

18 
	~"c⁄fig.h
"

19 
	~<°dio.h
>

20 
	~<°d¨g.h
>

21 
	~<uni°d.h
>

22 
	~<°rög.h
>

23 
	~<°rögs.h
>

24 
	~<Ωc/xdr.h
>

25 
	~"dlökli°.h
"

26 
	~"nfs.h
"

27 
	~"libnfs-øw.h
"

28 
	~"libnfs-¥iv©e.h
"

30 
Ωc_c⁄ãxt
 *
	$Ωc_öô_c⁄ãxt
()

32 
Ωc_c⁄ãxt
 *
Ωc
;

34 
Ωc
 = 
	`mÆloc
((
Ωc_c⁄ãxt
));

35 i‡(
Ωc
 =
NULL
) {

36 
	`¥ötf
("FailedÅoállocateÑpc context\n");

37  
NULL
;

39 
	`bzîo
(
Ωc
, (
Ωc_c⁄ãxt
));

41 
Ωc
->
ícodebuÊí
 = 65536;

42 
Ωc
->
ícodebuf
 = 
	`mÆloc
‘pc->
ícodebuÊí
);

43 i‡(
Ωc
->
ícodebuf
 =
NULL
) {

44 
	`¥ötf
("FailedÅoállocateá buffer forÑpcÉncoding\n");

45 
	`‰ì
(
Ωc
);

46  
NULL
;

49 
Ωc
->
auth
 = 
	`authunix_¸óã_deÁu…
();

50 i‡(
Ωc
->
auth
 =
NULL
) {

51 
	`¥ötf
("failedÅo createáuthunix\n");

52 
	`‰ì
(
Ωc
->
ícodebuf
);

53 
	`‰ì
(
Ωc
);

54  
NULL
;

56 
Ωc
->
xid
 = 1;

57 
Ωc
->
fd
 = -1;

59  
Ωc
;

60 
	}
}

63 
	$Ωc_£t_auth
(
Ωc_c⁄ãxt
 *
Ωc
, 
AUTH
 *
auth
)

65 i‡(
Ωc
->
auth
 !
NULL
) {

66 
	`auth_de°roy
(
Ωc
->
auth
);

68 
Ωc
->
auth
 =áuth;

69 
	}
}

72 
	$Ωc_£t_îr‹
(
Ωc_c⁄ãxt
 *
Ωc
, *
îr‹_°rög
, ...)

74 
va_li°
 
≠
;

75 *
°r
;

77 i‡(
Ωc
->
îr‹_°rög
 !
NULL
) {

78 
	`‰ì
(
Ωc
->
îr‹_°rög
);

80 
	`va_°¨t
(
≠
, 
îr‹_°rög
);

81 
	`va•rötf
(&
°r
, 
îr‹_°rög
, 
≠
);

82 
Ωc
->
îr‹_°rög
 = 
°r
;

83 
	`va_íd
(
≠
);

84 
	}
}

86 *
	$Ωc_gë_îr‹
(
Ωc_c⁄ãxt
 *
Ωc
)

88  
Ωc
->
îr‹_°rög
;

89 
	}
}

91 
	$Ωc_îr‹_Æl_pdus
(
Ωc_c⁄ãxt
 *
Ωc
, *
îr‹
)

93 
Ωc_pdu
 *
pdu
;

95 (
pdu
 = 
Ωc
->
outqueue
Ë!
NULL
) {

96 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, 
îr‹
,Ödu->
¥iv©e_d©a
);

97 
	`DLIST_REMOVE
(
Ωc
->
outqueue
, 
pdu
);

98 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

100 (
pdu
 = 
Ωc
->
waôpdu
Ë!
NULL
) {

101 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, 
îr‹
,Ödu->
¥iv©e_d©a
);

102 
	`DLIST_REMOVE
(
Ωc
->
waôpdu
, 
pdu
);

103 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

105 
	}
}

108 
	$Ωc_de°roy_c⁄ãxt
(
Ωc_c⁄ãxt
 *
Ωc
)

110 
Ωc_pdu
 *
pdu
;

112 (
pdu
 = 
Ωc
->
outqueue
Ë!
NULL
) {

113 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_CANCEL
, 
NULL
,Ödu->
¥iv©e_d©a
);

114 
	`DLIST_REMOVE
(
Ωc
->
outqueue
, 
pdu
);

115 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

117 (
pdu
 = 
Ωc
->
waôpdu
Ë!
NULL
) {

118 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_CANCEL
, 
NULL
,Ödu->
¥iv©e_d©a
);

119 
	`DLIST_REMOVE
(
Ωc
->
waôpdu
, 
pdu
);

120 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

123 
	`auth_de°roy
(
Ωc
->
auth
);

124 
Ωc
->
auth
 =
NULL
;

126 i‡(
Ωc
->
fd
 != -1) {

127 
	`˛o£
(
Ωc
->
fd
);

130 i‡(
Ωc
->
ícodebuf
 !
NULL
) {

131 
	`‰ì
(
Ωc
->
ícodebuf
);

132 
Ωc
->
ícodebuf
 = 
NULL
;

135 i‡(
Ωc
->
îr‹_°rög
 !
NULL
) {

136 
	`‰ì
(
Ωc
->
îr‹_°rög
);

137 
Ωc
->
îr‹_°rög
 = 
NULL
;

140 
	`‰ì
(
Ωc
);

141 
	}
}

	@ccan/ccan/nfs/libnfs-private.h

1 #i‚de‡
CCAN_NFS_LIBNFS_PRIVATE_H


2 
	#CCAN_NFS_LIBNFS_PRIVATE_H


	)

20 
	~<Ωc/auth.h
>

22 
	sΩc_c⁄ãxt
 {

23 
	mfd
;

24 
	mis_c⁄√˘ed
;

26 *
	mîr‹_°rög
;

28 
Ωc_cb
 
	mc⁄√˘_cb
;

29 *
	mc⁄√˘_d©a
;

31 
AUTH
 *
	mauth
;

32 
	mxid
;

35 *
	mícodebuf
;

36 
	mícodebuÊí
;

38 
Ωc_pdu
 *
	moutqueue
;

39 
Ωc_pdu
 *
	mwaôpdu
;

41 
	mösize
;

42 
	möpos
;

43 *
	möbuf
;

46 
	sΩc_pdu
 {

47 
Ωc_pdu
 *
	m¥ev
, *
	m√xt
;

49 
	mxid
;

50 
XDR
 
	mxdr
;

52 
	mwrôãn
;

53 
Ωc_d©a
 
	moutd©a
;

55 
Ωc_cb
 
	mcb
;

56 *
	m¥iv©e_d©a
;

59 
xdΩroc_t
 
	mxdr_decode_‚
;

60 
ˇddr_t
 
	mxdr_decode_buf
;

61 
	mxdr_decode_bufsize
;

64 
Ωc_pdu
 *
Ωc_Æloˇã_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, 
¥ogøm
, 
vîsi⁄
, 
¥o˚duª
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
, 
xdΩroc_t
 
xdr_decode_‚
, 
xdr_bufsize
);

65 
Ωc_‰ì_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_pdu
 *
pdu
);

66 
Ωc_queue_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_pdu
 *
pdu
);

67 
Ωc_gë_pdu_size
(*
buf
);

68 
Ωc_¥o˚ss_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, *
buf
, 
size
);

69 
Ωc_îr‹_Æl_pdus
(
Ωc_c⁄ãxt
 *
Ωc
, *
îr‹
);

	@ccan/ccan/nfs/libnfs-raw-mount.c

7 
	~"Ωc/mou¡.h
"

9 
boﬁ_t


10 
	$xdr_fh™dÀ3
 (
XDR
 *
xdrs
, 
fh™dÀ3
 *
objp
)

12 
öt32_t
 *
buf
;

14 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
fh™dÀ3_vÆ
, (
u_öt
 *Ë&objp->
fh™dÀ3_Àn
, 
FHSIZE3
))

15  
FALSE
;

16  
TRUE
;

17 
	}
}

19 
boﬁ_t


20 
	$xdr_dú∑th
 (
XDR
 *
xdrs
, 
dú∑th
 *
objp
)

22 
öt32_t
 *
buf
;

24 i‡(!
	`xdr_°rög
 (
xdrs
, 
objp
, 
MNTPATHLEN
))

25  
FALSE
;

26  
TRUE
;

27 
	}
}

29 
boﬁ_t


30 
	$xdr_«me
 (
XDR
 *
xdrs
, 
«me
 *
objp
)

32 
öt32_t
 *
buf
;

34 i‡(!
	`xdr_°rög
 (
xdrs
, 
objp
, 
MNTNAMLEN
))

35  
FALSE
;

36  
TRUE
;

37 
	}
}

39 
boﬁ_t


40 
	$xdr_mou¡°©3
 (
XDR
 *
xdrs
, 
mou¡°©3
 *
objp
)

42 
öt32_t
 *
buf
;

44 i‡(!
	`xdr_íum
 (
xdrs
, (
íum_t
 *Ë
objp
))

45  
FALSE
;

46  
TRUE
;

47 
	}
}

49 
boﬁ_t


50 
	$xdr_mou¡li°
 (
XDR
 *
xdrs
, 
mou¡li°
 *
objp
)

52 
öt32_t
 *
buf
;

54 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)
objp
,  (
mou¡body
), (
xdΩroc_t
Ë
xdr_mou¡body
))

55  
FALSE
;

56  
TRUE
;

57 
	}
}

59 
boﬁ_t


60 
	$xdr_mou¡body
 (
XDR
 *
xdrs
, 
mou¡body
 *
objp
)

62 
öt32_t
 *
buf
;

64 i‡(!
	`xdr_«me
 (
xdrs
, &
objp
->
ml_ho°«me
))

65  
FALSE
;

66 i‡(!
	`xdr_dú∑th
 (
xdrs
, &
objp
->
ml_dúe˘‹y
))

67  
FALSE
;

68 i‡(!
	`xdr_mou¡li°
 (
xdrs
, &
objp
->
ml_√xt
))

69  
FALSE
;

70  
TRUE
;

71 
	}
}

73 
boﬁ_t


74 
	$xdr_groups
 (
XDR
 *
xdrs
, 
groups
 *
objp
)

76 
öt32_t
 *
buf
;

78 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)
objp
,  (
grou≤ode
), (
xdΩroc_t
Ë
xdr_grou≤ode
))

79  
FALSE
;

80  
TRUE
;

81 
	}
}

83 
boﬁ_t


84 
	$xdr_grou≤ode
 (
XDR
 *
xdrs
, 
grou≤ode
 *
objp
)

86 
öt32_t
 *
buf
;

88 i‡(!
	`xdr_«me
 (
xdrs
, &
objp
->
gr_«me
))

89  
FALSE
;

90 i‡(!
	`xdr_groups
 (
xdrs
, &
objp
->
gr_√xt
))

91  
FALSE
;

92  
TRUE
;

93 
	}
}

95 
boﬁ_t


96 
	$xdr_exp‹ts
 (
XDR
 *
xdrs
, 
exp‹ts
 *
objp
)

98 
öt32_t
 *
buf
;

100 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)
objp
,  (
exp‹äode
), (
xdΩroc_t
Ë
xdr_exp‹äode
))

101  
FALSE
;

102  
TRUE
;

103 
	}
}

105 
boﬁ_t


106 
	$xdr_exp‹äode
 (
XDR
 *
xdrs
, 
exp‹äode
 *
objp
)

108 
öt32_t
 *
buf
;

110 i‡(!
	`xdr_dú∑th
 (
xdrs
, &
objp
->
ex_dú
))

111  
FALSE
;

112 i‡(!
	`xdr_groups
 (
xdrs
, &
objp
->
ex_groups
))

113  
FALSE
;

114 i‡(!
	`xdr_exp‹ts
 (
xdrs
, &
objp
->
ex_√xt
))

115  
FALSE
;

116  
TRUE
;

117 
	}
}

119 
boﬁ_t


120 
	$xdr_mou¡ªs3_ok
 (
XDR
 *
xdrs
, 
mou¡ªs3_ok
 *
objp
)

122 
öt32_t
 *
buf
;

124 i‡(!
	`xdr_fh™dÀ3
 (
xdrs
, &
objp
->
fh™dÀ
))

125  
FALSE
;

126 i‡(!
	`xdr_¨øy
 (
xdrs
, (**)&
objp
->
auth_Êav‹s
.
auth_Êav‹s_vÆ
, (
u_öt
 *Ë&objp->auth_Êav‹s.
auth_Êav‹s_Àn
, ~0,

127  (), (
xdΩroc_t
Ë
xdr_öt
))

128  
FALSE
;

129  
TRUE
;

130 
	}
}

132 
boﬁ_t


133 
	$xdr_mou¡ªs3
 (
XDR
 *
xdrs
, 
mou¡ªs3
 *
objp
)

135 
öt32_t
 *
buf
;

137 i‡(!
	`xdr_mou¡°©3
 (
xdrs
, &
objp
->
fhs_°©us
))

138  
FALSE
;

139 
objp
->
fhs_°©us
) {

140 
MNT3_OK
:

141 i‡(!
	`xdr_mou¡ªs3_ok
 (
xdrs
, &
objp
->
mou¡ªs3_u
.
mou¡öfo
))

142  
FALSE
;

147  
TRUE
;

148 
	}
}

	@ccan/ccan/nfs/libnfs-raw-nfs.c

7 
	~"Ωc/nfs.h
"

9 
boﬁ_t


10 
	$xdr_cookõvîf3
 (
XDR
 *
xdrs
, 
cookõvîf3
 
objp
)

12 
öt32_t
 *
buf
;

14 i‡(!
	`xdr_›aque
 (
xdrs
, 
objp
, 
NFS3_COOKIEVERFSIZE
))

15  
FALSE
;

16  
TRUE
;

17 
	}
}

19 
boﬁ_t


20 
	$xdr_uöt64
 (
XDR
 *
xdrs
, 
uöt64
 *
objp
)

22 
öt32_t
 *
buf
;

24 i‡(!
	`xdr_u_quad_t
 (
xdrs
, 
objp
))

25  
FALSE
;

26  
TRUE
;

27 
	}
}

29 
boﬁ_t


30 
	$xdr_cookõ3
 (
XDR
 *
xdrs
, 
cookõ3
 *
objp
)

32 
öt32_t
 *
buf
;

34 i‡(!
	`xdr_uöt64
 (
xdrs
, 
objp
))

35  
FALSE
;

36  
TRUE
;

37 
	}
}

39 
boﬁ_t


40 
	$xdr_nfs_fh3
 (
XDR
 *
xdrs
, 
nfs_fh3
 *
objp
)

42 
öt32_t
 *
buf
;

44 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
d©a
.
d©a_vÆ
, (
u_öt
 *Ë&objp->d©a.
d©a_Àn
, 
NFS3_FHSIZE
))

45  
FALSE
;

46  
TRUE
;

47 
	}
}

49 
boﬁ_t


50 
	$xdr_fûíame3
 (
XDR
 *
xdrs
, 
fûíame3
 *
objp
)

52 
öt32_t
 *
buf
;

54 i‡(!
	`xdr_°rög
 (
xdrs
, 
objp
, ~0))

55  
FALSE
;

56  
TRUE
;

57 
	}
}

59 
boﬁ_t


60 
	$xdr_dú›¨gs3
 (
XDR
 *
xdrs
, 
dú›¨gs3
 *
objp
)

62 
öt32_t
 *
buf
;

64 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
dú
))

65  
FALSE
;

66 i‡(!
	`xdr_fûíame3
 (
xdrs
, &
objp
->
«me
))

67  
FALSE
;

68  
TRUE
;

69 
	}
}

71 
boﬁ_t


72 
	$xdr_·y≥3
 (
XDR
 *
xdrs
, 
·y≥3
 *
objp
)

74 
öt32_t
 *
buf
;

76 i‡(!
	`xdr_íum
 (
xdrs
, (
íum_t
 *Ë
objp
))

77  
FALSE
;

78  
TRUE
;

79 
	}
}

81 
boﬁ_t


82 
	$xdr_uöt32
 (
XDR
 *
xdrs
, 
uöt32
 *
objp
)

84 
öt32_t
 *
buf
;

86 i‡(!
	`xdr_u_l⁄g
 (
xdrs
, 
objp
))

87  
FALSE
;

88  
TRUE
;

89 
	}
}

91 
boﬁ_t


92 
	$xdr_öt32
 (
XDR
 *
xdrs
, 
öt32
 *
objp
)

94 
öt32_t
 *
buf
;

96 i‡(!
	`xdr_l⁄g
 (
xdrs
, 
objp
))

97  
FALSE
;

98  
TRUE
;

99 
	}
}

101 
boﬁ_t


102 
	$xdr_mode3
 (
XDR
 *
xdrs
, 
mode3
 *
objp
)

104 
öt32_t
 *
buf
;

106 i‡(!
	`xdr_uöt32
 (
xdrs
, 
objp
))

107  
FALSE
;

108  
TRUE
;

109 
	}
}

111 
boﬁ_t


112 
	$xdr_uid3
 (
XDR
 *
xdrs
, 
uid3
 *
objp
)

114 
öt32_t
 *
buf
;

116 i‡(!
	`xdr_uöt32
 (
xdrs
, 
objp
))

117  
FALSE
;

118  
TRUE
;

119 
	}
}

121 
boﬁ_t


122 
	$xdr_gid3
 (
XDR
 *
xdrs
, 
gid3
 *
objp
)

124 
öt32_t
 *
buf
;

126 i‡(!
	`xdr_uöt32
 (
xdrs
, 
objp
))

127  
FALSE
;

128  
TRUE
;

129 
	}
}

131 
boﬁ_t


132 
	$xdr_size3
 (
XDR
 *
xdrs
, 
size3
 *
objp
)

134 
öt32_t
 *
buf
;

136 i‡(!
	`xdr_uöt64
 (
xdrs
, 
objp
))

137  
FALSE
;

138  
TRUE
;

139 
	}
}

141 
boﬁ_t


142 
	$xdr_fûeid3
 (
XDR
 *
xdrs
, 
fûeid3
 *
objp
)

144 
öt32_t
 *
buf
;

146 i‡(!
	`xdr_uöt64
 (
xdrs
, 
objp
))

147  
FALSE
;

148  
TRUE
;

149 
	}
}

151 
boﬁ_t


152 
	$xdr_•ecd©a3
 (
XDR
 *
xdrs
, 
•ecd©a3
 *
objp
)

154 
öt32_t
 *
buf
;

156 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
•ecd©a1
))

157  
FALSE
;

158 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
•ecd©a2
))

159  
FALSE
;

160  
TRUE
;

161 
	}
}

163 
boﬁ_t


164 
	$xdr_nf°ime3
 (
XDR
 *
xdrs
, 
nf°ime3
 *
objp
)

166 
öt32_t
 *
buf
;

168 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
£c⁄ds
))

169  
FALSE
;

170 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
n£c⁄ds
))

171  
FALSE
;

172  
TRUE
;

173 
	}
}

175 
boﬁ_t


176 
	$xdr_Áâr3
 (
XDR
 *
xdrs
, 
Áâr3
 *
objp
)

178 
öt32_t
 *
buf
;

180 i‡(!
	`xdr_·y≥3
 (
xdrs
, &
objp
->
ty≥
))

181  
FALSE
;

182 i‡(!
	`xdr_mode3
 (
xdrs
, &
objp
->
mode
))

183  
FALSE
;

184 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
∆ök
))

185  
FALSE
;

186 i‡(!
	`xdr_uid3
 (
xdrs
, &
objp
->
uid
))

187  
FALSE
;

188 i‡(!
	`xdr_gid3
 (
xdrs
, &
objp
->
gid
))

189  
FALSE
;

190 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
size
))

191  
FALSE
;

192 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
u£d
))

193  
FALSE
;

194 i‡(!
	`xdr_•ecd©a3
 (
xdrs
, &
objp
->
rdev
))

195  
FALSE
;

196 i‡(!
	`xdr_uöt64
 (
xdrs
, &
objp
->
fsid
))

197  
FALSE
;

198 i‡(!
	`xdr_fûeid3
 (
xdrs
, &
objp
->
fûeid
))

199  
FALSE
;

200 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
©ime
))

201  
FALSE
;

202 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
mtime
))

203  
FALSE
;

204 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
˘ime
))

205  
FALSE
;

206  
TRUE
;

207 
	}
}

209 
boﬁ_t


210 
	$xdr_po°_›_©å
 (
XDR
 *
xdrs
, 
po°_›_©å
 *
objp
)

212 
öt32_t
 *
buf
;

214 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
©åibuãs_fﬁlow
))

215  
FALSE
;

216 
objp
->
©åibuãs_fﬁlow
) {

217 
TRUE
:

218 i‡(!
	`xdr_Áâr3
 (
xdrs
, &
objp
->
po°_›_©å_u
.
©åibuãs
))

219  
FALSE
;

221 
FALSE
:

224  
FALSE
;

226  
TRUE
;

227 
	}
}

229 
boﬁ_t


230 
	$xdr_nfs°©3
 (
XDR
 *
xdrs
, 
nfs°©3
 *
objp
)

232 
öt32_t
 *
buf
;

234 i‡(!
	`xdr_íum
 (
xdrs
, (
íum_t
 *Ë
objp
))

235  
FALSE
;

236  
TRUE
;

237 
	}
}

239 
boﬁ_t


240 
	$xdr_°abÀ_how
 (
XDR
 *
xdrs
, 
°abÀ_how
 *
objp
)

242 
öt32_t
 *
buf
;

244 i‡(!
	`xdr_íum
 (
xdrs
, (
íum_t
 *Ë
objp
))

245  
FALSE
;

246  
TRUE
;

247 
	}
}

249 
boﬁ_t


250 
	$xdr_off£t3
 (
XDR
 *
xdrs
, 
off£t3
 *
objp
)

252 
öt32_t
 *
buf
;

254 i‡(!
	`xdr_uöt64
 (
xdrs
, 
objp
))

255  
FALSE
;

256  
TRUE
;

257 
	}
}

259 
boﬁ_t


260 
	$xdr_cou¡3
 (
XDR
 *
xdrs
, 
cou¡3
 *
objp
)

262 
öt32_t
 *
buf
;

264 i‡(!
	`xdr_uöt32
 (
xdrs
, 
objp
))

265  
FALSE
;

266  
TRUE
;

267 
	}
}

269 
boﬁ_t


270 
	$xdr_wcc_©å
 (
XDR
 *
xdrs
, 
wcc_©å
 *
objp
)

272 
öt32_t
 *
buf
;

274 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
size
))

275  
FALSE
;

276 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
mtime
))

277  
FALSE
;

278 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
˘ime
))

279  
FALSE
;

280  
TRUE
;

281 
	}
}

283 
boﬁ_t


284 
	$xdr_¥e_›_©å
 (
XDR
 *
xdrs
, 
¥e_›_©å
 *
objp
)

286 
öt32_t
 *
buf
;

288 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
©åibuãs_fﬁlow
))

289  
FALSE
;

290 
objp
->
©åibuãs_fﬁlow
) {

291 
TRUE
:

292 i‡(!
	`xdr_wcc_©å
 (
xdrs
, &
objp
->
¥e_›_©å_u
.
©åibuãs
))

293  
FALSE
;

295 
FALSE
:

298  
FALSE
;

300  
TRUE
;

301 
	}
}

303 
boﬁ_t


304 
	$xdr_wcc_d©a
 (
XDR
 *
xdrs
, 
wcc_d©a
 *
objp
)

306 
öt32_t
 *
buf
;

308 i‡(!
	`xdr_¥e_›_©å
 (
xdrs
, &
objp
->
bef‹e
))

309  
FALSE
;

310 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
a·î
))

311  
FALSE
;

312  
TRUE
;

313 
	}
}

315 
boﬁ_t


316 
	$xdr_WRITE3¨gs
 (
XDR
 *
xdrs
, 
WRITE3¨gs
 *
objp
)

318 
öt32_t
 *
buf
;

320 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
fûe
))

321  
FALSE
;

322 i‡(!
	`xdr_off£t3
 (
xdrs
, &
objp
->
off£t
))

323  
FALSE
;

324 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
cou¡
))

325  
FALSE
;

326 i‡(!
	`xdr_°abÀ_how
 (
xdrs
, &
objp
->
°abÀ
))

327  
FALSE
;

328 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
d©a
.
d©a_vÆ
, (
u_öt
 *Ë&objp->d©a.
d©a_Àn
, ~0))

329  
FALSE
;

330  
TRUE
;

331 
	}
}

333 
boﬁ_t


334 
	$xdr_wrôevîf3
 (
XDR
 *
xdrs
, 
wrôevîf3
 
objp
)

336 
öt32_t
 *
buf
;

338 i‡(!
	`xdr_›aque
 (
xdrs
, 
objp
, 
NFS3_WRITEVERFSIZE
))

339  
FALSE
;

340  
TRUE
;

341 
	}
}

343 
boﬁ_t


344 
	$xdr_WRITE3ªsok
 (
XDR
 *
xdrs
, 
WRITE3ªsok
 *
objp
)

346 
öt32_t
 *
buf
;

348 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
fûe_wcc
))

349  
FALSE
;

350 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
cou¡
))

351  
FALSE
;

352 i‡(!
	`xdr_°abÀ_how
 (
xdrs
, &
objp
->
commôãd
))

353  
FALSE
;

354 i‡(!
	`xdr_wrôevîf3
 (
xdrs
, 
objp
->
vîf
))

355  
FALSE
;

356  
TRUE
;

357 
	}
}

359 
boﬁ_t


360 
	$xdr_WRITE3ªsÁû
 (
XDR
 *
xdrs
, 
WRITE3ªsÁû
 *
objp
)

362 
öt32_t
 *
buf
;

364 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
fûe_wcc
))

365  
FALSE
;

366  
TRUE
;

367 
	}
}

369 
boﬁ_t


370 
	$xdr_WRITE3ªs
 (
XDR
 *
xdrs
, 
WRITE3ªs
 *
objp
)

372 
öt32_t
 *
buf
;

374 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

375  
FALSE
;

376 
objp
->
°©us
) {

377 
NFS3_OK
:

378 i‡(!
	`xdr_WRITE3ªsok
 (
xdrs
, &
objp
->
WRITE3ªs_u
.
ªsok
))

379  
FALSE
;

382 i‡(!
	`xdr_WRITE3ªsÁû
 (
xdrs
, &
objp
->
WRITE3ªs_u
.
ªsÁû
))

383  
FALSE
;

386  
TRUE
;

387 
	}
}

389 
boﬁ_t


390 
	$xdr_LOOKUP3¨gs
 (
XDR
 *
xdrs
, 
LOOKUP3¨gs
 *
objp
)

392 
öt32_t
 *
buf
;

394 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
wh©
))

395  
FALSE
;

396  
TRUE
;

397 
	}
}

399 
boﬁ_t


400 
	$xdr_LOOKUP3ªsok
 (
XDR
 *
xdrs
, 
LOOKUP3ªsok
 *
objp
)

402 
öt32_t
 *
buf
;

404 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
obje˘
))

405  
FALSE
;

406 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

407  
FALSE
;

408 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
dú_©åibuãs
))

409  
FALSE
;

410  
TRUE
;

411 
	}
}

413 
boﬁ_t


414 
	$xdr_LOOKUP3ªsÁû
 (
XDR
 *
xdrs
, 
LOOKUP3ªsÁû
 *
objp
)

416 
öt32_t
 *
buf
;

418 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
dú_©åibuãs
))

419  
FALSE
;

420  
TRUE
;

421 
	}
}

423 
boﬁ_t


424 
	$xdr_LOOKUP3ªs
 (
XDR
 *
xdrs
, 
LOOKUP3ªs
 *
objp
)

426 
öt32_t
 *
buf
;

428 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

429  
FALSE
;

430 
objp
->
°©us
) {

431 
NFS3_OK
:

432 i‡(!
	`xdr_LOOKUP3ªsok
 (
xdrs
, &
objp
->
LOOKUP3ªs_u
.
ªsok
))

433  
FALSE
;

436 i‡(!
	`xdr_LOOKUP3ªsÁû
 (
xdrs
, &
objp
->
LOOKUP3ªs_u
.
ªsÁû
))

437  
FALSE
;

440  
TRUE
;

441 
	}
}

443 
boﬁ_t


444 
	$xdr_COMMIT3¨gs
 (
XDR
 *
xdrs
, 
COMMIT3¨gs
 *
objp
)

446 
öt32_t
 *
buf
;

448 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
fûe
))

449  
FALSE
;

450 i‡(!
	`xdr_off£t3
 (
xdrs
, &
objp
->
off£t
))

451  
FALSE
;

452 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
cou¡
))

453  
FALSE
;

454  
TRUE
;

455 
	}
}

457 
boﬁ_t


458 
	$xdr_COMMIT3ªsok
 (
XDR
 *
xdrs
, 
COMMIT3ªsok
 *
objp
)

460 
öt32_t
 *
buf
;

462 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
fûe_wcc
))

463  
FALSE
;

464 i‡(!
	`xdr_wrôevîf3
 (
xdrs
, 
objp
->
vîf
))

465  
FALSE
;

466  
TRUE
;

467 
	}
}

469 
boﬁ_t


470 
	$xdr_COMMIT3ªsÁû
 (
XDR
 *
xdrs
, 
COMMIT3ªsÁû
 *
objp
)

472 
öt32_t
 *
buf
;

474 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
fûe_wcc
))

475  
FALSE
;

476  
TRUE
;

477 
	}
}

479 
boﬁ_t


480 
	$xdr_COMMIT3ªs
 (
XDR
 *
xdrs
, 
COMMIT3ªs
 *
objp
)

482 
öt32_t
 *
buf
;

484 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

485  
FALSE
;

486 
objp
->
°©us
) {

487 
NFS3_OK
:

488 i‡(!
	`xdr_COMMIT3ªsok
 (
xdrs
, &
objp
->
COMMIT3ªs_u
.
ªsok
))

489  
FALSE
;

492 i‡(!
	`xdr_COMMIT3ªsÁû
 (
xdrs
, &
objp
->
COMMIT3ªs_u
.
ªsÁû
))

493  
FALSE
;

496  
TRUE
;

497 
	}
}

499 
boﬁ_t


500 
	$xdr_ACCESS3¨gs
 (
XDR
 *
xdrs
, 
ACCESS3¨gs
 *
objp
)

502 
öt32_t
 *
buf
;

504 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
obje˘
))

505  
FALSE
;

506 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
ac˚ss
))

507  
FALSE
;

508  
TRUE
;

509 
	}
}

511 
boﬁ_t


512 
	$xdr_ACCESS3ªsok
 (
XDR
 *
xdrs
, 
ACCESS3ªsok
 *
objp
)

514 
öt32_t
 *
buf
;

516 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

517  
FALSE
;

518 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
ac˚ss
))

519  
FALSE
;

520  
TRUE
;

521 
	}
}

523 
boﬁ_t


524 
	$xdr_ACCESS3ªsÁû
 (
XDR
 *
xdrs
, 
ACCESS3ªsÁû
 *
objp
)

526 
öt32_t
 *
buf
;

528 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

529  
FALSE
;

530  
TRUE
;

531 
	}
}

533 
boﬁ_t


534 
	$xdr_ACCESS3ªs
 (
XDR
 *
xdrs
, 
ACCESS3ªs
 *
objp
)

536 
öt32_t
 *
buf
;

538 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

539  
FALSE
;

540 
objp
->
°©us
) {

541 
NFS3_OK
:

542 i‡(!
	`xdr_ACCESS3ªsok
 (
xdrs
, &
objp
->
ACCESS3ªs_u
.
ªsok
))

543  
FALSE
;

546 i‡(!
	`xdr_ACCESS3ªsÁû
 (
xdrs
, &
objp
->
ACCESS3ªs_u
.
ªsÁû
))

547  
FALSE
;

550  
TRUE
;

551 
	}
}

553 
boﬁ_t


554 
	$xdr_GETATTR3¨gs
 (
XDR
 *
xdrs
, 
GETATTR3¨gs
 *
objp
)

556 
öt32_t
 *
buf
;

558 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
obje˘
))

559  
FALSE
;

560  
TRUE
;

561 
	}
}

563 
boﬁ_t


564 
	$xdr_GETATTR3ªsok
 (
XDR
 *
xdrs
, 
GETATTR3ªsok
 *
objp
)

566 
öt32_t
 *
buf
;

568 i‡(!
	`xdr_Áâr3
 (
xdrs
, &
objp
->
obj_©åibuãs
))

569  
FALSE
;

570  
TRUE
;

571 
	}
}

573 
boﬁ_t


574 
	$xdr_GETATTR3ªs
 (
XDR
 *
xdrs
, 
GETATTR3ªs
 *
objp
)

576 
öt32_t
 *
buf
;

578 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

579  
FALSE
;

580 
objp
->
°©us
) {

581 
NFS3_OK
:

582 i‡(!
	`xdr_GETATTR3ªsok
 (
xdrs
, &
objp
->
GETATTR3ªs_u
.
ªsok
))

583  
FALSE
;

588  
TRUE
;

589 
	}
}

591 
boﬁ_t


592 
	$xdr_time_how
 (
XDR
 *
xdrs
, 
time_how
 *
objp
)

594 
öt32_t
 *
buf
;

596 i‡(!
	`xdr_íum
 (
xdrs
, (
íum_t
 *Ë
objp
))

597  
FALSE
;

598  
TRUE
;

599 
	}
}

601 
boﬁ_t


602 
	$xdr_£t_mode3
 (
XDR
 *
xdrs
, 
£t_mode3
 *
objp
)

604 
öt32_t
 *
buf
;

606 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
£t_ô
))

607  
FALSE
;

608 
objp
->
£t_ô
) {

609 
TRUE
:

610 i‡(!
	`xdr_mode3
 (
xdrs
, &
objp
->
£t_mode3_u
.
mode
))

611  
FALSE
;

616  
TRUE
;

617 
	}
}

619 
boﬁ_t


620 
	$xdr_£t_uid3
 (
XDR
 *
xdrs
, 
£t_uid3
 *
objp
)

622 
öt32_t
 *
buf
;

624 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
£t_ô
))

625  
FALSE
;

626 
objp
->
£t_ô
) {

627 
TRUE
:

628 i‡(!
	`xdr_uid3
 (
xdrs
, &
objp
->
£t_uid3_u
.
uid
))

629  
FALSE
;

634  
TRUE
;

635 
	}
}

637 
boﬁ_t


638 
	$xdr_£t_gid3
 (
XDR
 *
xdrs
, 
£t_gid3
 *
objp
)

640 
öt32_t
 *
buf
;

642 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
£t_ô
))

643  
FALSE
;

644 
objp
->
£t_ô
) {

645 
TRUE
:

646 i‡(!
	`xdr_gid3
 (
xdrs
, &
objp
->
£t_gid3_u
.
gid
))

647  
FALSE
;

652  
TRUE
;

653 
	}
}

655 
boﬁ_t


656 
	$xdr_£t_size3
 (
XDR
 *
xdrs
, 
£t_size3
 *
objp
)

658 
öt32_t
 *
buf
;

660 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
£t_ô
))

661  
FALSE
;

662 
objp
->
£t_ô
) {

663 
TRUE
:

664 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
£t_size3_u
.
size
))

665  
FALSE
;

670  
TRUE
;

671 
	}
}

673 
boﬁ_t


674 
	$xdr_£t_©ime
 (
XDR
 *
xdrs
, 
£t_©ime
 *
objp
)

676 
öt32_t
 *
buf
;

678 i‡(!
	`xdr_time_how
 (
xdrs
, &
objp
->
£t_ô
))

679  
FALSE
;

680 
objp
->
£t_ô
) {

681 
SET_TO_CLIENT_TIME
:

682 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
£t_©ime_u
.
©ime
))

683  
FALSE
;

688  
TRUE
;

689 
	}
}

691 
boﬁ_t


692 
	$xdr_£t_mtime
 (
XDR
 *
xdrs
, 
£t_mtime
 *
objp
)

694 
öt32_t
 *
buf
;

696 i‡(!
	`xdr_time_how
 (
xdrs
, &
objp
->
£t_ô
))

697  
FALSE
;

698 
objp
->
£t_ô
) {

699 
SET_TO_CLIENT_TIME
:

700 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
£t_mtime_u
.
mtime
))

701  
FALSE
;

706  
TRUE
;

707 
	}
}

709 
boﬁ_t


710 
	$xdr_ßâr3
 (
XDR
 *
xdrs
, 
ßâr3
 *
objp
)

712 
öt32_t
 *
buf
;

714 i‡(!
	`xdr_£t_mode3
 (
xdrs
, &
objp
->
mode
))

715  
FALSE
;

716 i‡(!
	`xdr_£t_uid3
 (
xdrs
, &
objp
->
uid
))

717  
FALSE
;

718 i‡(!
	`xdr_£t_gid3
 (
xdrs
, &
objp
->
gid
))

719  
FALSE
;

720 i‡(!
	`xdr_£t_size3
 (
xdrs
, &
objp
->
size
))

721  
FALSE
;

722 i‡(!
	`xdr_£t_©ime
 (
xdrs
, &
objp
->
©ime
))

723  
FALSE
;

724 i‡(!
	`xdr_£t_mtime
 (
xdrs
, &
objp
->
mtime
))

725  
FALSE
;

726  
TRUE
;

727 
	}
}

729 
boﬁ_t


730 
	$xdr_¸óãmode3
 (
XDR
 *
xdrs
, 
¸óãmode3
 *
objp
)

732 
öt32_t
 *
buf
;

734 i‡(!
	`xdr_íum
 (
xdrs
, (
íum_t
 *Ë
objp
))

735  
FALSE
;

736  
TRUE
;

737 
	}
}

739 
boﬁ_t


740 
	$xdr_¸óãvîf3
 (
XDR
 *
xdrs
, 
¸óãvîf3
 
objp
)

742 
öt32_t
 *
buf
;

744 i‡(!
	`xdr_›aque
 (
xdrs
, 
objp
, 
NFS3_CREATEVERFSIZE
))

745  
FALSE
;

746  
TRUE
;

747 
	}
}

749 
boﬁ_t


750 
	$xdr_¸óãhow3
 (
XDR
 *
xdrs
, 
¸óãhow3
 *
objp
)

752 
öt32_t
 *
buf
;

754 i‡(!
	`xdr_¸óãmode3
 (
xdrs
, &
objp
->
mode
))

755  
FALSE
;

756 
objp
->
mode
) {

757 
UNCHECKED
:

758 
GUARDED
:

759 i‡(!
	`xdr_ßâr3
 (
xdrs
, &
objp
->
¸óãhow3_u
.
obj_©åibuãs
))

760  
FALSE
;

762 
EXCLUSIVE
:

763 i‡(!
	`xdr_¸óãvîf3
 (
xdrs
, 
objp
->
¸óãhow3_u
.
vîf
))

764  
FALSE
;

767  
FALSE
;

769  
TRUE
;

770 
	}
}

772 
boﬁ_t


773 
	$xdr_CREATE3¨gs
 (
XDR
 *
xdrs
, 
CREATE3¨gs
 *
objp
)

775 
öt32_t
 *
buf
;

777 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
whîe
))

778  
FALSE
;

779 i‡(!
	`xdr_¸óãhow3
 (
xdrs
, &
objp
->
how
))

780  
FALSE
;

781  
TRUE
;

782 
	}
}

784 
boﬁ_t


785 
	$xdr_po°_›_fh3
 (
XDR
 *
xdrs
, 
po°_›_fh3
 *
objp
)

787 
öt32_t
 *
buf
;

789 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
h™dÀ_fﬁlows
))

790  
FALSE
;

791 
objp
->
h™dÀ_fﬁlows
) {

792 
TRUE
:

793 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
po°_›_fh3_u
.
h™dÀ
))

794  
FALSE
;

796 
FALSE
:

799  
FALSE
;

801  
TRUE
;

802 
	}
}

804 
boﬁ_t


805 
	$xdr_CREATE3ªsok
 (
XDR
 *
xdrs
, 
CREATE3ªsok
 *
objp
)

807 
öt32_t
 *
buf
;

809 i‡(!
	`xdr_po°_›_fh3
 (
xdrs
, &
objp
->
obj
))

810  
FALSE
;

811 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

812  
FALSE
;

813 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

814  
FALSE
;

815  
TRUE
;

816 
	}
}

818 
boﬁ_t


819 
	$xdr_CREATE3ªsÁû
 (
XDR
 *
xdrs
, 
CREATE3ªsÁû
 *
objp
)

821 
öt32_t
 *
buf
;

823 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

824  
FALSE
;

825  
TRUE
;

826 
	}
}

828 
boﬁ_t


829 
	$xdr_CREATE3ªs
 (
XDR
 *
xdrs
, 
CREATE3ªs
 *
objp
)

831 
öt32_t
 *
buf
;

833 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

834  
FALSE
;

835 
objp
->
°©us
) {

836 
NFS3_OK
:

837 i‡(!
	`xdr_CREATE3ªsok
 (
xdrs
, &
objp
->
CREATE3ªs_u
.
ªsok
))

838  
FALSE
;

841 i‡(!
	`xdr_CREATE3ªsÁû
 (
xdrs
, &
objp
->
CREATE3ªs_u
.
ªsÁû
))

842  
FALSE
;

845  
TRUE
;

846 
	}
}

848 
boﬁ_t


849 
	$xdr_REMOVE3¨gs
 (
XDR
 *
xdrs
, 
REMOVE3¨gs
 *
objp
)

851 
öt32_t
 *
buf
;

853 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
obje˘
))

854  
FALSE
;

855  
TRUE
;

856 
	}
}

858 
boﬁ_t


859 
	$xdr_REMOVE3ªsok
 (
XDR
 *
xdrs
, 
REMOVE3ªsok
 *
objp
)

861 
öt32_t
 *
buf
;

863 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

864  
FALSE
;

865  
TRUE
;

866 
	}
}

868 
boﬁ_t


869 
	$xdr_REMOVE3ªsÁû
 (
XDR
 *
xdrs
, 
REMOVE3ªsÁû
 *
objp
)

871 
öt32_t
 *
buf
;

873 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

874  
FALSE
;

875  
TRUE
;

876 
	}
}

878 
boﬁ_t


879 
	$xdr_REMOVE3ªs
 (
XDR
 *
xdrs
, 
REMOVE3ªs
 *
objp
)

881 
öt32_t
 *
buf
;

883 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

884  
FALSE
;

885 
objp
->
°©us
) {

886 
NFS3_OK
:

887 i‡(!
	`xdr_REMOVE3ªsok
 (
xdrs
, &
objp
->
REMOVE3ªs_u
.
ªsok
))

888  
FALSE
;

891 i‡(!
	`xdr_REMOVE3ªsÁû
 (
xdrs
, &
objp
->
REMOVE3ªs_u
.
ªsÁû
))

892  
FALSE
;

895  
TRUE
;

896 
	}
}

898 
boﬁ_t


899 
	$xdr_READ3¨gs
 (
XDR
 *
xdrs
, 
READ3¨gs
 *
objp
)

901 
öt32_t
 *
buf
;

903 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
fûe
))

904  
FALSE
;

905 i‡(!
	`xdr_off£t3
 (
xdrs
, &
objp
->
off£t
))

906  
FALSE
;

907 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
cou¡
))

908  
FALSE
;

909  
TRUE
;

910 
	}
}

912 
boﬁ_t


913 
	$xdr_READ3ªsok
 (
XDR
 *
xdrs
, 
READ3ªsok
 *
objp
)

915 
öt32_t
 *
buf
;

917 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
fûe_©åibuãs
))

918  
FALSE
;

919 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
cou¡
))

920  
FALSE
;

921 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
eof
))

922  
FALSE
;

923 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
d©a
.
d©a_vÆ
, (
u_öt
 *Ë&objp->d©a.
d©a_Àn
, ~0))

924  
FALSE
;

925  
TRUE
;

926 
	}
}

928 
boﬁ_t


929 
	$xdr_READ3ªsÁû
 (
XDR
 *
xdrs
, 
READ3ªsÁû
 *
objp
)

931 
öt32_t
 *
buf
;

933 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
fûe_©åibuãs
))

934  
FALSE
;

935  
TRUE
;

936 
	}
}

938 
boﬁ_t


939 
	$xdr_READ3ªs
 (
XDR
 *
xdrs
, 
READ3ªs
 *
objp
)

941 
öt32_t
 *
buf
;

943 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

944  
FALSE
;

945 
objp
->
°©us
) {

946 
NFS3_OK
:

947 i‡(!
	`xdr_READ3ªsok
 (
xdrs
, &
objp
->
READ3ªs_u
.
ªsok
))

948  
FALSE
;

951 i‡(!
	`xdr_READ3ªsÁû
 (
xdrs
, &
objp
->
READ3ªs_u
.
ªsÁû
))

952  
FALSE
;

955  
TRUE
;

956 
	}
}

958 
boﬁ_t


959 
	$xdr_FSINFO3¨gs
 (
XDR
 *
xdrs
, 
FSINFO3¨gs
 *
objp
)

961 
öt32_t
 *
buf
;

963 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
f§oŸ
))

964  
FALSE
;

965  
TRUE
;

966 
	}
}

968 
boﬁ_t


969 
	$xdr_FSINFO3ªsok
 (
XDR
 *
xdrs
, 
FSINFO3ªsok
 *
objp
)

971 
öt32_t
 *
buf
;

973 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

974  
FALSE
;

975 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
πmax
))

976  
FALSE
;

977 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
π¥ef
))

978  
FALSE
;

979 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
πmu…
))

980  
FALSE
;

981 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
wtmax
))

982  
FALSE
;

983 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
wçªf
))

984  
FALSE
;

985 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
wtmu…
))

986  
FALSE
;

987 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
dçªf
))

988  
FALSE
;

989 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
maxfûesize
))

990  
FALSE
;

991 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
time_dñè
))

992  
FALSE
;

993 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
¥›îtõs
))

994  
FALSE
;

995  
TRUE
;

996 
	}
}

998 
boﬁ_t


999 
	$xdr_FSINFO3ªsÁû
 (
XDR
 *
xdrs
, 
FSINFO3ªsÁû
 *
objp
)

1001 
öt32_t
 *
buf
;

1003 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1004  
FALSE
;

1005  
TRUE
;

1006 
	}
}

1008 
boﬁ_t


1009 
	$xdr_FSINFO3ªs
 (
XDR
 *
xdrs
, 
FSINFO3ªs
 *
objp
)

1011 
öt32_t
 *
buf
;

1013 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1014  
FALSE
;

1015 
objp
->
°©us
) {

1016 
NFS3_OK
:

1017 i‡(!
	`xdr_FSINFO3ªsok
 (
xdrs
, &
objp
->
FSINFO3ªs_u
.
ªsok
))

1018  
FALSE
;

1021 i‡(!
	`xdr_FSINFO3ªsÁû
 (
xdrs
, &
objp
->
FSINFO3ªs_u
.
ªsÁû
))

1022  
FALSE
;

1025  
TRUE
;

1026 
	}
}

1028 
boﬁ_t


1029 
	$xdr_FSSTAT3¨gs
 (
XDR
 *
xdrs
, 
FSSTAT3¨gs
 *
objp
)

1031 
öt32_t
 *
buf
;

1033 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
f§oŸ
))

1034  
FALSE
;

1035  
TRUE
;

1036 
	}
}

1038 
boﬁ_t


1039 
	$xdr_FSSTAT3ªsok
 (
XDR
 *
xdrs
, 
FSSTAT3ªsok
 *
objp
)

1041 
öt32_t
 *
buf
;

1043 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1044  
FALSE
;

1045 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
tbyãs
))

1046  
FALSE
;

1047 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
fbyãs
))

1048  
FALSE
;

1049 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
abyãs
))

1050  
FALSE
;

1051 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
tfûes
))

1052  
FALSE
;

1053 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
ffûes
))

1054  
FALSE
;

1055 i‡(!
	`xdr_size3
 (
xdrs
, &
objp
->
afûes
))

1056  
FALSE
;

1057 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
öv¨£c
))

1058  
FALSE
;

1059  
TRUE
;

1060 
	}
}

1062 
boﬁ_t


1063 
	$xdr_FSSTAT3ªsÁû
 (
XDR
 *
xdrs
, 
FSSTAT3ªsÁû
 *
objp
)

1065 
öt32_t
 *
buf
;

1067 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1068  
FALSE
;

1069  
TRUE
;

1070 
	}
}

1072 
boﬁ_t


1073 
	$xdr_FSSTAT3ªs
 (
XDR
 *
xdrs
, 
FSSTAT3ªs
 *
objp
)

1075 
öt32_t
 *
buf
;

1077 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1078  
FALSE
;

1079 
objp
->
°©us
) {

1080 
NFS3_OK
:

1081 i‡(!
	`xdr_FSSTAT3ªsok
 (
xdrs
, &
objp
->
FSSTAT3ªs_u
.
ªsok
))

1082  
FALSE
;

1085 i‡(!
	`xdr_FSSTAT3ªsÁû
 (
xdrs
, &
objp
->
FSSTAT3ªs_u
.
ªsÁû
))

1086  
FALSE
;

1089  
TRUE
;

1090 
	}
}

1092 
boﬁ_t


1093 
	$xdr_PATHCONF3¨gs
 (
XDR
 *
xdrs
, 
PATHCONF3¨gs
 *
objp
)

1095 
öt32_t
 *
buf
;

1097 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
obje˘
))

1098  
FALSE
;

1099  
TRUE
;

1100 
	}
}

1102 
boﬁ_t


1103 
	$xdr_PATHCONF3ªsok
 (
XDR
 *
xdrs
, 
PATHCONF3ªsok
 *
objp
)

1105 
öt32_t
 *
buf
;

1108 i‡(
xdrs
->
x_›
 =
XDR_ENCODE
) {

1109 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1110  
FALSE
;

1111 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
lökmax
))

1112  
FALSE
;

1113 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
«me_max
))

1114  
FALSE
;

1115 
buf
 = 
	`XDR_INLINE
 (
xdrs
, 4 * 
BYTES_PER_XDR_UNIT
);

1116 i‡(
buf
 =
NULL
) {

1117 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
no_åunc
))

1118  
FALSE
;

1119 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
chown_ª°ri˘ed
))

1120  
FALSE
;

1121 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
ˇ£_ö£nsôive
))

1122  
FALSE
;

1123 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
ˇ£_¥e£rvög
))

1124  
FALSE
;

1126 
	`IXDR_PUT_BOOL
(
buf
, 
objp
->
no_åunc
);

1127 
	`IXDR_PUT_BOOL
(
buf
, 
objp
->
chown_ª°ri˘ed
);

1128 
	`IXDR_PUT_BOOL
(
buf
, 
objp
->
ˇ£_ö£nsôive
);

1129 
	`IXDR_PUT_BOOL
(
buf
, 
objp
->
ˇ£_¥e£rvög
);

1131  
TRUE
;

1132 } i‡(
xdrs
->
x_›
 =
XDR_DECODE
) {

1133 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1134  
FALSE
;

1135 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
lökmax
))

1136  
FALSE
;

1137 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
«me_max
))

1138  
FALSE
;

1139 
buf
 = 
	`XDR_INLINE
 (
xdrs
, 4 * 
BYTES_PER_XDR_UNIT
);

1140 i‡(
buf
 =
NULL
) {

1141 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
no_åunc
))

1142  
FALSE
;

1143 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
chown_ª°ri˘ed
))

1144  
FALSE
;

1145 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
ˇ£_ö£nsôive
))

1146  
FALSE
;

1147 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
ˇ£_¥e£rvög
))

1148  
FALSE
;

1150 
objp
->
no_åunc
 = 
	`IXDR_GET_BOOL
(
buf
);

1151 
objp
->
chown_ª°ri˘ed
 = 
	`IXDR_GET_BOOL
(
buf
);

1152 
objp
->
ˇ£_ö£nsôive
 = 
	`IXDR_GET_BOOL
(
buf
);

1153 
objp
->
ˇ£_¥e£rvög
 = 
	`IXDR_GET_BOOL
(
buf
);

1155  
TRUE
;

1158 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1159  
FALSE
;

1160 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
lökmax
))

1161  
FALSE
;

1162 i‡(!
	`xdr_uöt32
 (
xdrs
, &
objp
->
«me_max
))

1163  
FALSE
;

1164 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
no_åunc
))

1165  
FALSE
;

1166 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
chown_ª°ri˘ed
))

1167  
FALSE
;

1168 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
ˇ£_ö£nsôive
))

1169  
FALSE
;

1170 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
ˇ£_¥e£rvög
))

1171  
FALSE
;

1172  
TRUE
;

1173 
	}
}

1175 
boﬁ_t


1176 
	$xdr_PATHCONF3ªsÁû
 (
XDR
 *
xdrs
, 
PATHCONF3ªsÁû
 *
objp
)

1178 
öt32_t
 *
buf
;

1180 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1181  
FALSE
;

1182  
TRUE
;

1183 
	}
}

1185 
boﬁ_t


1186 
	$xdr_PATHCONF3ªs
 (
XDR
 *
xdrs
, 
PATHCONF3ªs
 *
objp
)

1188 
öt32_t
 *
buf
;

1190 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1191  
FALSE
;

1192 
objp
->
°©us
) {

1193 
NFS3_OK
:

1194 i‡(!
	`xdr_PATHCONF3ªsok
 (
xdrs
, &
objp
->
PATHCONF3ªs_u
.
ªsok
))

1195  
FALSE
;

1198 i‡(!
	`xdr_PATHCONF3ªsÁû
 (
xdrs
, &
objp
->
PATHCONF3ªs_u
.
ªsÁû
))

1199  
FALSE
;

1202  
TRUE
;

1203 
	}
}

1205 
boﬁ_t


1206 
	$xdr_nf•©h3
 (
XDR
 *
xdrs
, 
nf•©h3
 *
objp
)

1208 
öt32_t
 *
buf
;

1210 i‡(!
	`xdr_°rög
 (
xdrs
, 
objp
, ~0))

1211  
FALSE
;

1212  
TRUE
;

1213 
	}
}

1215 
boﬁ_t


1216 
	$xdr_symlökd©a3
 (
XDR
 *
xdrs
, 
symlökd©a3
 *
objp
)

1218 
öt32_t
 *
buf
;

1220 i‡(!
	`xdr_ßâr3
 (
xdrs
, &
objp
->
symlök_©åibuãs
))

1221  
FALSE
;

1222 i‡(!
	`xdr_nf•©h3
 (
xdrs
, &
objp
->
symlök_d©a
))

1223  
FALSE
;

1224  
TRUE
;

1225 
	}
}

1227 
boﬁ_t


1228 
	$xdr_SYMLINK3¨gs
 (
XDR
 *
xdrs
, 
SYMLINK3¨gs
 *
objp
)

1230 
öt32_t
 *
buf
;

1232 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
whîe
))

1233  
FALSE
;

1234 i‡(!
	`xdr_symlökd©a3
 (
xdrs
, &
objp
->
symlök
))

1235  
FALSE
;

1236  
TRUE
;

1237 
	}
}

1239 
boﬁ_t


1240 
	$xdr_SYMLINK3ªsok
 (
XDR
 *
xdrs
, 
SYMLINK3ªsok
 *
objp
)

1242 
öt32_t
 *
buf
;

1244 i‡(!
	`xdr_po°_›_fh3
 (
xdrs
, &
objp
->
obj
))

1245  
FALSE
;

1246 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1247  
FALSE
;

1248 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1249  
FALSE
;

1250  
TRUE
;

1251 
	}
}

1253 
boﬁ_t


1254 
	$xdr_SYMLINK3ªsÁû
 (
XDR
 *
xdrs
, 
SYMLINK3ªsÁû
 *
objp
)

1256 
öt32_t
 *
buf
;

1258 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1259  
FALSE
;

1260  
TRUE
;

1261 
	}
}

1263 
boﬁ_t


1264 
	$xdr_SYMLINK3ªs
 (
XDR
 *
xdrs
, 
SYMLINK3ªs
 *
objp
)

1266 
öt32_t
 *
buf
;

1268 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1269  
FALSE
;

1270 
objp
->
°©us
) {

1271 
NFS3_OK
:

1272 i‡(!
	`xdr_SYMLINK3ªsok
 (
xdrs
, &
objp
->
SYMLINK3ªs_u
.
ªsok
))

1273  
FALSE
;

1276 i‡(!
	`xdr_SYMLINK3ªsÁû
 (
xdrs
, &
objp
->
SYMLINK3ªs_u
.
ªsÁû
))

1277  
FALSE
;

1280  
TRUE
;

1281 
	}
}

1283 
boﬁ_t


1284 
	$xdr_READLINK3¨gs
 (
XDR
 *
xdrs
, 
READLINK3¨gs
 *
objp
)

1286 
öt32_t
 *
buf
;

1288 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
symlök
))

1289  
FALSE
;

1290  
TRUE
;

1291 
	}
}

1293 
boﬁ_t


1294 
	$xdr_READLINK3ªsok
 (
XDR
 *
xdrs
, 
READLINK3ªsok
 *
objp
)

1296 
öt32_t
 *
buf
;

1298 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
symlök_©åibuãs
))

1299  
FALSE
;

1300 i‡(!
	`xdr_nf•©h3
 (
xdrs
, &
objp
->
d©a
))

1301  
FALSE
;

1302  
TRUE
;

1303 
	}
}

1305 
boﬁ_t


1306 
	$xdr_READLINK3ªsÁû
 (
XDR
 *
xdrs
, 
READLINK3ªsÁû
 *
objp
)

1308 
öt32_t
 *
buf
;

1310 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
symlök_©åibuãs
))

1311  
FALSE
;

1312  
TRUE
;

1313 
	}
}

1315 
boﬁ_t


1316 
	$xdr_READLINK3ªs
 (
XDR
 *
xdrs
, 
READLINK3ªs
 *
objp
)

1318 
öt32_t
 *
buf
;

1320 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1321  
FALSE
;

1322 
objp
->
°©us
) {

1323 
NFS3_OK
:

1324 i‡(!
	`xdr_READLINK3ªsok
 (
xdrs
, &
objp
->
READLINK3ªs_u
.
ªsok
))

1325  
FALSE
;

1328 i‡(!
	`xdr_READLINK3ªsÁû
 (
xdrs
, &
objp
->
READLINK3ªs_u
.
ªsÁû
))

1329  
FALSE
;

1332  
TRUE
;

1333 
	}
}

1335 
boﬁ_t


1336 
	$xdr_devi˚d©a3
 (
XDR
 *
xdrs
, 
devi˚d©a3
 *
objp
)

1338 
öt32_t
 *
buf
;

1340 i‡(!
	`xdr_ßâr3
 (
xdrs
, &
objp
->
dev_©åibuãs
))

1341  
FALSE
;

1342 i‡(!
	`xdr_•ecd©a3
 (
xdrs
, &
objp
->
•ec
))

1343  
FALSE
;

1344  
TRUE
;

1345 
	}
}

1347 
boﬁ_t


1348 
	$xdr_mknodd©a3
 (
XDR
 *
xdrs
, 
mknodd©a3
 *
objp
)

1350 
öt32_t
 *
buf
;

1352 i‡(!
	`xdr_·y≥3
 (
xdrs
, &
objp
->
ty≥
))

1353  
FALSE
;

1354 
objp
->
ty≥
) {

1355 
NF3CHR
:

1356 
NF3BLK
:

1357 i‡(!
	`xdr_devi˚d©a3
 (
xdrs
, &
objp
->
mknodd©a3_u
.
devi˚
))

1358  
FALSE
;

1360 
NF3SOCK
:

1361 
NF3FIFO
:

1362 i‡(!
	`xdr_ßâr3
 (
xdrs
, &
objp
->
mknodd©a3_u
.
pùe_©åibuãs
))

1363  
FALSE
;

1368  
TRUE
;

1369 
	}
}

1371 
boﬁ_t


1372 
	$xdr_MKNOD3¨gs
 (
XDR
 *
xdrs
, 
MKNOD3¨gs
 *
objp
)

1374 
öt32_t
 *
buf
;

1376 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
whîe
))

1377  
FALSE
;

1378 i‡(!
	`xdr_mknodd©a3
 (
xdrs
, &
objp
->
wh©
))

1379  
FALSE
;

1380  
TRUE
;

1381 
	}
}

1383 
boﬁ_t


1384 
	$xdr_MKNOD3ªsok
 (
XDR
 *
xdrs
, 
MKNOD3ªsok
 *
objp
)

1386 
öt32_t
 *
buf
;

1388 i‡(!
	`xdr_po°_›_fh3
 (
xdrs
, &
objp
->
obj
))

1389  
FALSE
;

1390 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1391  
FALSE
;

1392 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1393  
FALSE
;

1394  
TRUE
;

1395 
	}
}

1397 
boﬁ_t


1398 
	$xdr_MKNOD3ªsÁû
 (
XDR
 *
xdrs
, 
MKNOD3ªsÁû
 *
objp
)

1400 
öt32_t
 *
buf
;

1402 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1403  
FALSE
;

1404  
TRUE
;

1405 
	}
}

1407 
boﬁ_t


1408 
	$xdr_MKNOD3ªs
 (
XDR
 *
xdrs
, 
MKNOD3ªs
 *
objp
)

1410 
öt32_t
 *
buf
;

1412 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1413  
FALSE
;

1414 
objp
->
°©us
) {

1415 
NFS3_OK
:

1416 i‡(!
	`xdr_MKNOD3ªsok
 (
xdrs
, &
objp
->
MKNOD3ªs_u
.
ªsok
))

1417  
FALSE
;

1420 i‡(!
	`xdr_MKNOD3ªsÁû
 (
xdrs
, &
objp
->
MKNOD3ªs_u
.
ªsÁû
))

1421  
FALSE
;

1424  
TRUE
;

1425 
	}
}

1427 
boﬁ_t


1428 
	$xdr_MKDIR3¨gs
 (
XDR
 *
xdrs
, 
MKDIR3¨gs
 *
objp
)

1430 
öt32_t
 *
buf
;

1432 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
whîe
))

1433  
FALSE
;

1434 i‡(!
	`xdr_ßâr3
 (
xdrs
, &
objp
->
©åibuãs
))

1435  
FALSE
;

1436  
TRUE
;

1437 
	}
}

1439 
boﬁ_t


1440 
	$xdr_MKDIR3ªsok
 (
XDR
 *
xdrs
, 
MKDIR3ªsok
 *
objp
)

1442 
öt32_t
 *
buf
;

1444 i‡(!
	`xdr_po°_›_fh3
 (
xdrs
, &
objp
->
obj
))

1445  
FALSE
;

1446 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
obj_©åibuãs
))

1447  
FALSE
;

1448 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1449  
FALSE
;

1450  
TRUE
;

1451 
	}
}

1453 
boﬁ_t


1454 
	$xdr_MKDIR3ªsÁû
 (
XDR
 *
xdrs
, 
MKDIR3ªsÁû
 *
objp
)

1456 
öt32_t
 *
buf
;

1458 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1459  
FALSE
;

1460  
TRUE
;

1461 
	}
}

1463 
boﬁ_t


1464 
	$xdr_MKDIR3ªs
 (
XDR
 *
xdrs
, 
MKDIR3ªs
 *
objp
)

1466 
öt32_t
 *
buf
;

1468 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1469  
FALSE
;

1470 
objp
->
°©us
) {

1471 
NFS3_OK
:

1472 i‡(!
	`xdr_MKDIR3ªsok
 (
xdrs
, &
objp
->
MKDIR3ªs_u
.
ªsok
))

1473  
FALSE
;

1476 i‡(!
	`xdr_MKDIR3ªsÁû
 (
xdrs
, &
objp
->
MKDIR3ªs_u
.
ªsÁû
))

1477  
FALSE
;

1480  
TRUE
;

1481 
	}
}

1483 
boﬁ_t


1484 
	$xdr_RMDIR3¨gs
 (
XDR
 *
xdrs
, 
RMDIR3¨gs
 *
objp
)

1486 
öt32_t
 *
buf
;

1488 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
obje˘
))

1489  
FALSE
;

1490  
TRUE
;

1491 
	}
}

1493 
boﬁ_t


1494 
	$xdr_RMDIR3ªsok
 (
XDR
 *
xdrs
, 
RMDIR3ªsok
 *
objp
)

1496 
öt32_t
 *
buf
;

1498 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1499  
FALSE
;

1500  
TRUE
;

1501 
	}
}

1503 
boﬁ_t


1504 
	$xdr_RMDIR3ªsÁû
 (
XDR
 *
xdrs
, 
RMDIR3ªsÁû
 *
objp
)

1506 
öt32_t
 *
buf
;

1508 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
dú_wcc
))

1509  
FALSE
;

1510  
TRUE
;

1511 
	}
}

1513 
boﬁ_t


1514 
	$xdr_RMDIR3ªs
 (
XDR
 *
xdrs
, 
RMDIR3ªs
 *
objp
)

1516 
öt32_t
 *
buf
;

1518 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1519  
FALSE
;

1520 
objp
->
°©us
) {

1521 
NFS3_OK
:

1522 i‡(!
	`xdr_RMDIR3ªsok
 (
xdrs
, &
objp
->
RMDIR3ªs_u
.
ªsok
))

1523  
FALSE
;

1526 i‡(!
	`xdr_RMDIR3ªsÁû
 (
xdrs
, &
objp
->
RMDIR3ªs_u
.
ªsÁû
))

1527  
FALSE
;

1530  
TRUE
;

1531 
	}
}

1533 
boﬁ_t


1534 
	$xdr_RENAME3¨gs
 (
XDR
 *
xdrs
, 
RENAME3¨gs
 *
objp
)

1536 
öt32_t
 *
buf
;

1538 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
‰om
))

1539  
FALSE
;

1540 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
to
))

1541  
FALSE
;

1542  
TRUE
;

1543 
	}
}

1545 
boﬁ_t


1546 
	$xdr_RENAME3ªsok
 (
XDR
 *
xdrs
, 
RENAME3ªsok
 *
objp
)

1548 
öt32_t
 *
buf
;

1550 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
‰omdú_wcc
))

1551  
FALSE
;

1552 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
todú_wcc
))

1553  
FALSE
;

1554  
TRUE
;

1555 
	}
}

1557 
boﬁ_t


1558 
	$xdr_RENAME3ªsÁû
 (
XDR
 *
xdrs
, 
RENAME3ªsÁû
 *
objp
)

1560 
öt32_t
 *
buf
;

1562 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
‰omdú_wcc
))

1563  
FALSE
;

1564 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
todú_wcc
))

1565  
FALSE
;

1566  
TRUE
;

1567 
	}
}

1569 
boﬁ_t


1570 
	$xdr_RENAME3ªs
 (
XDR
 *
xdrs
, 
RENAME3ªs
 *
objp
)

1572 
öt32_t
 *
buf
;

1574 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1575  
FALSE
;

1576 
objp
->
°©us
) {

1577 
NFS3_OK
:

1578 i‡(!
	`xdr_RENAME3ªsok
 (
xdrs
, &
objp
->
RENAME3ªs_u
.
ªsok
))

1579  
FALSE
;

1582 i‡(!
	`xdr_RENAME3ªsÁû
 (
xdrs
, &
objp
->
RENAME3ªs_u
.
ªsÁû
))

1583  
FALSE
;

1586  
TRUE
;

1587 
	}
}

1589 
boﬁ_t


1590 
	$xdr_READDIRPLUS3¨gs
 (
XDR
 *
xdrs
, 
READDIRPLUS3¨gs
 *
objp
)

1592 
öt32_t
 *
buf
;

1594 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
dú
))

1595  
FALSE
;

1596 i‡(!
	`xdr_cookõ3
 (
xdrs
, &
objp
->
cookõ
))

1597  
FALSE
;

1598 i‡(!
	`xdr_cookõvîf3
 (
xdrs
, 
objp
->
cookõvîf
))

1599  
FALSE
;

1600 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
dúcou¡
))

1601  
FALSE
;

1602 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
maxcou¡
))

1603  
FALSE
;

1604  
TRUE
;

1605 
	}
}

1607 
boﬁ_t


1608 
	$xdr_íåy∂us3
 (
XDR
 *
xdrs
, 
íåy∂us3
 *
objp
)

1610 
öt32_t
 *
buf
;

1612 i‡(!
	`xdr_fûeid3
 (
xdrs
, &
objp
->
fûeid
))

1613  
FALSE
;

1614 i‡(!
	`xdr_fûíame3
 (
xdrs
, &
objp
->
«me
))

1615  
FALSE
;

1616 i‡(!
	`xdr_cookõ3
 (
xdrs
, &
objp
->
cookõ
))

1617  
FALSE
;

1618 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
«me_©åibuãs
))

1619  
FALSE
;

1620 i‡(!
	`xdr_po°_›_fh3
 (
xdrs
, &
objp
->
«me_h™dÀ
))

1621  
FALSE
;

1622 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)&
objp
->
√xã¡ry
,  (
íåy∂us3
), (
xdΩroc_t
Ë
xdr_íåy∂us3
))

1623  
FALSE
;

1624  
TRUE
;

1625 
	}
}

1627 
boﬁ_t


1628 
	$xdr_dúli°∂us3
 (
XDR
 *
xdrs
, 
dúli°∂us3
 *
objp
)

1630 
öt32_t
 *
buf
;

1632 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)&
objp
->
íåõs
,  (
íåy∂us3
), (
xdΩroc_t
Ë
xdr_íåy∂us3
))

1633  
FALSE
;

1634 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
eof
))

1635  
FALSE
;

1636  
TRUE
;

1637 
	}
}

1639 
boﬁ_t


1640 
	$xdr_READDIRPLUS3ªsok
 (
XDR
 *
xdrs
, 
READDIRPLUS3ªsok
 *
objp
)

1642 
öt32_t
 *
buf
;

1644 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
dú_©åibuãs
))

1645  
FALSE
;

1646 i‡(!
	`xdr_cookõvîf3
 (
xdrs
, 
objp
->
cookõvîf
))

1647  
FALSE
;

1648 i‡(!
	`xdr_dúli°∂us3
 (
xdrs
, &
objp
->
ª∂y
))

1649  
FALSE
;

1650  
TRUE
;

1651 
	}
}

1653 
boﬁ_t


1654 
	$xdr_READDIRPLUS3ªsÁû
 (
XDR
 *
xdrs
, 
READDIRPLUS3ªsÁû
 *
objp
)

1656 
öt32_t
 *
buf
;

1658 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
dú_©åibuãs
))

1659  
FALSE
;

1660  
TRUE
;

1661 
	}
}

1663 
boﬁ_t


1664 
	$xdr_READDIRPLUS3ªs
 (
XDR
 *
xdrs
, 
READDIRPLUS3ªs
 *
objp
)

1666 
öt32_t
 *
buf
;

1668 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1669  
FALSE
;

1670 
objp
->
°©us
) {

1671 
NFS3_OK
:

1672 i‡(!
	`xdr_READDIRPLUS3ªsok
 (
xdrs
, &
objp
->
READDIRPLUS3ªs_u
.
ªsok
))

1673  
FALSE
;

1676 i‡(!
	`xdr_READDIRPLUS3ªsÁû
 (
xdrs
, &
objp
->
READDIRPLUS3ªs_u
.
ªsÁû
))

1677  
FALSE
;

1680  
TRUE
;

1681 
	}
}

1683 
boﬁ_t


1684 
	$xdr_READDIR3¨gs
 (
XDR
 *
xdrs
, 
READDIR3¨gs
 *
objp
)

1686 
öt32_t
 *
buf
;

1688 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
dú
))

1689  
FALSE
;

1690 i‡(!
	`xdr_cookõ3
 (
xdrs
, &
objp
->
cookõ
))

1691  
FALSE
;

1692 i‡(!
	`xdr_cookõvîf3
 (
xdrs
, 
objp
->
cookõvîf
))

1693  
FALSE
;

1694 i‡(!
	`xdr_cou¡3
 (
xdrs
, &
objp
->
cou¡
))

1695  
FALSE
;

1696  
TRUE
;

1697 
	}
}

1699 
boﬁ_t


1700 
	$xdr_íåy3
 (
XDR
 *
xdrs
, 
íåy3
 *
objp
)

1702 
öt32_t
 *
buf
;

1704 i‡(!
	`xdr_fûeid3
 (
xdrs
, &
objp
->
fûeid
))

1705  
FALSE
;

1706 i‡(!
	`xdr_fûíame3
 (
xdrs
, &
objp
->
«me
))

1707  
FALSE
;

1708 i‡(!
	`xdr_cookõ3
 (
xdrs
, &
objp
->
cookõ
))

1709  
FALSE
;

1710 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)&
objp
->
√xã¡ry
,  (
íåy3
), (
xdΩroc_t
Ë
xdr_íåy3
))

1711  
FALSE
;

1712  
TRUE
;

1713 
	}
}

1715 
boﬁ_t


1716 
	$xdr_dúli°3
 (
XDR
 *
xdrs
, 
dúli°3
 *
objp
)

1718 
öt32_t
 *
buf
;

1720 i‡(!
	`xdr_poöãr
 (
xdrs
, (**)&
objp
->
íåõs
,  (
íåy3
), (
xdΩroc_t
Ë
xdr_íåy3
))

1721  
FALSE
;

1722 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
eof
))

1723  
FALSE
;

1724  
TRUE
;

1725 
	}
}

1727 
boﬁ_t


1728 
	$xdr_READDIR3ªsok
 (
XDR
 *
xdrs
, 
READDIR3ªsok
 *
objp
)

1730 
öt32_t
 *
buf
;

1732 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
dú_©åibuãs
))

1733  
FALSE
;

1734 i‡(!
	`xdr_cookõvîf3
 (
xdrs
, 
objp
->
cookõvîf
))

1735  
FALSE
;

1736 i‡(!
	`xdr_dúli°3
 (
xdrs
, &
objp
->
ª∂y
))

1737  
FALSE
;

1738  
TRUE
;

1739 
	}
}

1741 
boﬁ_t


1742 
	$xdr_READDIR3ªsÁû
 (
XDR
 *
xdrs
, 
READDIR3ªsÁû
 *
objp
)

1744 
öt32_t
 *
buf
;

1746 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
dú_©åibuãs
))

1747  
FALSE
;

1748  
TRUE
;

1749 
	}
}

1751 
boﬁ_t


1752 
	$xdr_READDIR3ªs
 (
XDR
 *
xdrs
, 
READDIR3ªs
 *
objp
)

1754 
öt32_t
 *
buf
;

1756 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1757  
FALSE
;

1758 
objp
->
°©us
) {

1759 
NFS3_OK
:

1760 i‡(!
	`xdr_READDIR3ªsok
 (
xdrs
, &
objp
->
READDIR3ªs_u
.
ªsok
))

1761  
FALSE
;

1764 i‡(!
	`xdr_READDIR3ªsÁû
 (
xdrs
, &
objp
->
READDIR3ªs_u
.
ªsÁû
))

1765  
FALSE
;

1768  
TRUE
;

1769 
	}
}

1771 
boﬁ_t


1772 
	$xdr_LINK3¨gs
 (
XDR
 *
xdrs
, 
LINK3¨gs
 *
objp
)

1774 
öt32_t
 *
buf
;

1776 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
fûe
))

1777  
FALSE
;

1778 i‡(!
	`xdr_dú›¨gs3
 (
xdrs
, &
objp
->
lök
))

1779  
FALSE
;

1780  
TRUE
;

1781 
	}
}

1783 
boﬁ_t


1784 
	$xdr_LINK3ªsok
 (
XDR
 *
xdrs
, 
LINK3ªsok
 *
objp
)

1786 
öt32_t
 *
buf
;

1788 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
fûe_©åibuãs
))

1789  
FALSE
;

1790 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
lökdú_wcc
))

1791  
FALSE
;

1792  
TRUE
;

1793 
	}
}

1795 
boﬁ_t


1796 
	$xdr_LINK3ªsÁû
 (
XDR
 *
xdrs
, 
LINK3ªsÁû
 *
objp
)

1798 
öt32_t
 *
buf
;

1800 i‡(!
	`xdr_po°_›_©å
 (
xdrs
, &
objp
->
fûe_©åibuãs
))

1801  
FALSE
;

1802 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
lökdú_wcc
))

1803  
FALSE
;

1804  
TRUE
;

1805 
	}
}

1807 
boﬁ_t


1808 
	$xdr_LINK3ªs
 (
XDR
 *
xdrs
, 
LINK3ªs
 *
objp
)

1810 
öt32_t
 *
buf
;

1812 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1813  
FALSE
;

1814 
objp
->
°©us
) {

1815 
NFS3_OK
:

1816 i‡(!
	`xdr_LINK3ªsok
 (
xdrs
, &
objp
->
LINK3ªs_u
.
ªsok
))

1817  
FALSE
;

1820 i‡(!
	`xdr_LINK3ªsÁû
 (
xdrs
, &
objp
->
LINK3ªs_u
.
ªsÁû
))

1821  
FALSE
;

1824  
TRUE
;

1825 
	}
}

1827 
boﬁ_t


1828 
	$xdr_ßârgu¨d3
 (
XDR
 *
xdrs
, 
ßârgu¨d3
 *
objp
)

1830 
öt32_t
 *
buf
;

1832 i‡(!
	`xdr_boﬁ
 (
xdrs
, &
objp
->
check
))

1833  
FALSE
;

1834 
objp
->
check
) {

1835 
TRUE
:

1836 i‡(!
	`xdr_nf°ime3
 (
xdrs
, &
objp
->
ßârgu¨d3_u
.
obj_˘ime
))

1837  
FALSE
;

1839 
FALSE
:

1842  
FALSE
;

1844  
TRUE
;

1845 
	}
}

1847 
boﬁ_t


1848 
	$xdr_SETATTR3¨gs
 (
XDR
 *
xdrs
, 
SETATTR3¨gs
 *
objp
)

1850 
öt32_t
 *
buf
;

1852 i‡(!
	`xdr_nfs_fh3
 (
xdrs
, &
objp
->
obje˘
))

1853  
FALSE
;

1854 i‡(!
	`xdr_ßâr3
 (
xdrs
, &
objp
->
√w_©åibuãs
))

1855  
FALSE
;

1856 i‡(!
	`xdr_ßârgu¨d3
 (
xdrs
, &
objp
->
gu¨d
))

1857  
FALSE
;

1858  
TRUE
;

1859 
	}
}

1861 
boﬁ_t


1862 
	$xdr_SETATTR3ªsok
 (
XDR
 *
xdrs
, 
SETATTR3ªsok
 *
objp
)

1864 
öt32_t
 *
buf
;

1866 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
obj_wcc
))

1867  
FALSE
;

1868  
TRUE
;

1869 
	}
}

1871 
boﬁ_t


1872 
	$xdr_SETATTR3ªsÁû
 (
XDR
 *
xdrs
, 
SETATTR3ªsÁû
 *
objp
)

1874 
öt32_t
 *
buf
;

1876 i‡(!
	`xdr_wcc_d©a
 (
xdrs
, &
objp
->
obj_wcc
))

1877  
FALSE
;

1878  
TRUE
;

1879 
	}
}

1881 
boﬁ_t


1882 
	$xdr_SETATTR3ªs
 (
XDR
 *
xdrs
, 
SETATTR3ªs
 *
objp
)

1884 
öt32_t
 *
buf
;

1886 i‡(!
	`xdr_nfs°©3
 (
xdrs
, &
objp
->
°©us
))

1887  
FALSE
;

1888 
objp
->
°©us
) {

1889 
NFS3_OK
:

1890 i‡(!
	`xdr_SETATTR3ªsok
 (
xdrs
, &
objp
->
SETATTR3ªs_u
.
ªsok
))

1891  
FALSE
;

1894 i‡(!
	`xdr_SETATTR3ªsÁû
 (
xdrs
, &
objp
->
SETATTR3ªs_u
.
ªsÁû
))

1895  
FALSE
;

1898  
TRUE
;

1899 
	}
}

	@ccan/ccan/nfs/libnfs-raw-nfsacl.c

7 
	~"Ωc/nfß˛.h
"

	@ccan/ccan/nfs/libnfs-raw-portmap.c

7 
	~"Ωc/p‹tm≠.h
"

9 
boﬁ_t


10 
	$xdr_m≠pög
 (
XDR
 *
xdrs
, 
m≠pög
 *
objp
)

12 
öt32_t
 *
buf
;

15 i‡(
xdrs
->
x_›
 =
XDR_ENCODE
) {

16 
buf
 = 
	`XDR_INLINE
 (
xdrs
, 4 * 
BYTES_PER_XDR_UNIT
);

17 i‡(
buf
 =
NULL
) {

18 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥og
))

19  
FALSE
;

20 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
vîs
))

21  
FALSE
;

22 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥Ÿ
))

23  
FALSE
;

24 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
p‹t
))

25  
FALSE
;

27 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
¥og
);

28 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
vîs
);

29 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
¥Ÿ
);

30 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
p‹t
);

32  
TRUE
;

33 } i‡(
xdrs
->
x_›
 =
XDR_DECODE
) {

34 
buf
 = 
	`XDR_INLINE
 (
xdrs
, 4 * 
BYTES_PER_XDR_UNIT
);

35 i‡(
buf
 =
NULL
) {

36 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥og
))

37  
FALSE
;

38 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
vîs
))

39  
FALSE
;

40 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥Ÿ
))

41  
FALSE
;

42 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
p‹t
))

43  
FALSE
;

45 
objp
->
¥og
 = 
	`IXDR_GET_U_LONG
(
buf
);

46 
objp
->
vîs
 = 
	`IXDR_GET_U_LONG
(
buf
);

47 
objp
->
¥Ÿ
 = 
	`IXDR_GET_U_LONG
(
buf
);

48 
objp
->
p‹t
 = 
	`IXDR_GET_U_LONG
(
buf
);

50  
TRUE
;

53 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥og
))

54  
FALSE
;

55 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
vîs
))

56  
FALSE
;

57 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥Ÿ
))

58  
FALSE
;

59 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
p‹t
))

60  
FALSE
;

61  
TRUE
;

62 
	}
}

64 
boﬁ_t


65 
	$xdr_ˇŒ_¨gs
 (
XDR
 *
xdrs
, 
ˇŒ_¨gs
 *
objp
)

67 
öt32_t
 *
buf
;

70 i‡(
xdrs
->
x_›
 =
XDR_ENCODE
) {

71 
buf
 = 
	`XDR_INLINE
 (
xdrs
, 3 * 
BYTES_PER_XDR_UNIT
);

72 i‡(
buf
 =
NULL
) {

73 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥og
))

74  
FALSE
;

75 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
vîs
))

76  
FALSE
;

77 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥oc
))

78  
FALSE
;

81 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
¥og
);

82 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
vîs
);

83 
	`IXDR_PUT_U_LONG
(
buf
, 
objp
->
¥oc
);

85 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
¨gs
.
¨gs_vÆ
, (
u_öt
 *Ë&objp->¨gs.
¨gs_Àn
, ~0))

86  
FALSE
;

87  
TRUE
;

88 } i‡(
xdrs
->
x_›
 =
XDR_DECODE
) {

89 
buf
 = 
	`XDR_INLINE
 (
xdrs
, 3 * 
BYTES_PER_XDR_UNIT
);

90 i‡(
buf
 =
NULL
) {

91 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥og
))

92  
FALSE
;

93 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
vîs
))

94  
FALSE
;

95 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥oc
))

96  
FALSE
;

99 
objp
->
¥og
 = 
	`IXDR_GET_U_LONG
(
buf
);

100 
objp
->
vîs
 = 
	`IXDR_GET_U_LONG
(
buf
);

101 
objp
->
¥oc
 = 
	`IXDR_GET_U_LONG
(
buf
);

103 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
¨gs
.
¨gs_vÆ
, (
u_öt
 *Ë&objp->¨gs.
¨gs_Àn
, ~0))

104  
FALSE
;

105  
TRUE
;

108 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥og
))

109  
FALSE
;

110 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
vîs
))

111  
FALSE
;

112 i‡(!
	`xdr_u_öt
 (
xdrs
, &
objp
->
¥oc
))

113  
FALSE
;

114 i‡(!
	`xdr_byãs
 (
xdrs
, (**)&
objp
->
¨gs
.
¨gs_vÆ
, (
u_öt
 *Ë&objp->¨gs.
¨gs_Àn
, ~0))

115  
FALSE
;

116  
TRUE
;

117 
	}
}

	@ccan/ccan/nfs/libnfs-raw.h

1 #i‚de‡
CCAN_NFS_LIBNFS_RAW_H


2 
	#CCAN_NFS_LIBNFS_RAW_H


	)

24 
	~<°döt.h
>

26 
	sΩc_d©a
 {

27 
	msize
;

28 *
	md©a
;

31 
	gΩc_c⁄ãxt
;

32 
Ωc_c⁄ãxt
 *
Ωc_öô_c⁄ãxt
();

33 
Ωc_de°roy_c⁄ãxt
(
Ωc_c⁄ãxt
 *
Ωc
);

35 
	gAUTH
;

36 
Ωc_£t_auth
(
Ωc_c⁄ãxt
 *
Ωc
, 
AUTH
 *
auth
);

38 
Ωc_gë_fd
(
Ωc_c⁄ãxt
 *
Ωc
);

39 
Ωc_which_evíts
(
Ωc_c⁄ãxt
 *
Ωc
);

40 
Ωc_£rvi˚
(
Ωc_c⁄ãxt
 *
Ωc
, 
ªvíts
);

41 *
Ωc_gë_îr‹
(
Ωc_c⁄ãxt
 *
Ωc
);

44 
	#RPC_STATUS_SUCCESS
 0

	)

45 
	#RPC_STATUS_ERROR
 1

	)

46 
	#RPC_STATUS_CANCEL
 2

	)

48 (*
	tΩc_cb
)(
	tΩc_c⁄ãxt
 *
	tΩc
, 
	t°©us
, *
	td©a
, *
	t¥iv©e_d©a
);

64 
	`Ωc_c⁄√˘_async
(
Ωc_c⁄ãxt
 *
Ωc
, c⁄° *
£rvî
, 
p‹t
, 
u£_¥ivûeged_p‹t
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

69 
	`Ωc_disc⁄√˘
(
Ωc_c⁄ãxt
 *
Ωc
, *
îr‹
);

71 
	`Ωc_£t_îr‹
(
Ωc_c⁄ãxt
 *
Ωc
, *
îr‹_°rög
, ...);

92 
	`Ωc_pm≠_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

109 
	`Ωc_pm≠_gëp‹t_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
¥ogøm
, 
vîsi⁄
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

116 *
	`mou¡°©3_to_°r
(
°©
);

117 
	`mou¡°©3_to_î∫o
(
îr‹
);

133 
	`Ωc_mou¡_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

149 
	`Ωc_mou¡_m¡_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
exp‹t
, *
¥iv©e_d©a
);

165 
	`Ωc_mou¡_dump_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

181 
	`Ωc_mou¡_um¡_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
exp‹t
, *
¥iv©e_d©a
);

197 
	`Ωc_mou¡_um¡Æl_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

213 
	`Ωc_mou¡_exp‹t_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

221 
nfs_fh3
;

222 *
	`nfs°©3_to_°r
(
îr‹
);

223 
	`nfs°©3_to_î∫o
(
îr‹
);

239 
	`Ωc_nfs_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

255 
	`Ωc_nfs_gë©å_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
);

271 
	`Ωc_nfs_lookup_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
«me
, *
¥iv©e_d©a
);

287 
	`Ωc_nfs_ac˚ss_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, 
ac˚ss
, *
¥iv©e_d©a
);

303 
	`Ωc_nfs_ªad_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
¥iv©e_d©a
);

319 
	`Ωc_nfs_wrôe_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
buf
, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, 
°abÀ_how
, *
¥iv©e_d©a
);

335 
	`Ωc_nfs_commô_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
);

352 
SETATTR3¨gs
;

353 
	`Ωc_nfs_£èâr_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
SETATTR3¨gs
 *
¨gs
, *
¥iv©e_d©a
);

371 
	`Ωc_nfs_mkdú_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
dú
, *
¥iv©e_d©a
);

391 
	`Ωc_nfs_rmdú_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
dú
, *
¥iv©e_d©a
);

410 
	`Ωc_nfs_¸óã_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
«me
, 
mode
, *
¥iv©e_d©a
);

429 
	`Ωc_nfs_ªmove_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
«me
, *
¥iv©e_d©a
);

447 
	`Ωc_nfs_ªaddú_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, 
uöt64_t
 
cookõ
, *
cookõvîf
, 
cou¡
, *
¥iv©e_d©a
);

463 
	`Ωc_nfs_fs°©_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
);

482 
	`Ωc_nfs_ªadlök_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
);

500 
	`Ωc_nfs_symlök_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
√w«me
, *
ﬁd∑th
, *
¥iv©e_d©a
);

517 
	`Ωc_nfs_ª«me_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
ﬁddú
, *
ﬁd«me
, nfs_fh3 *
√wdú
, *
√w«me
, *
¥iv©e_d©a
);

535 
	`Ωc_nfs_lök_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fûe
, nfs_fh3 *
√wdú
, *
√w«me
, *
¥iv©e_d©a
);

560 
	`Ωc_nfß˛_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
);

	@ccan/ccan/nfs/libnfs-sync.c

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<°rög.h
>

24 
	~<°rögs.h
>

25 
	~<sys/ty≥s.h
>

26 
	~<sys/°©.h
>

27 
	~<sys/°©vfs.h
>

28 
	~<uni°d.h
>

29 
	~<f˙é.h
>

30 
	~<î∫o.h
>

31 
	~<pﬁl.h
>

32 
	~<cˇn/compûî/compûî.h
>

33 
	~"nfs.h
"

34 
	~"libnfs-øw.h
"

35 
	~"Ωc/mou¡.h
"

36 
	~"Ωc/nfs.h
"

38 
	ssync_cb_d©a
 {

39 
	mis_föished
;

40 
	m°©us
;

41 
nfs_off_t
 
	moff£t
;

42 *
	mªtu∫_d©a
;

43 
	mªtu∫_öt
;

47 
	$waô_f‹_ª∂y
(
nfs_c⁄ãxt
 *
nfs
, 
sync_cb_d©a
 *
cb_d©a
)

49 
pﬁlfd
 
pfd
;

52 i‡(
cb_d©a
->
is_föished
) {

55 
pfd
.
fd
 = 
	`nfs_gë_fd
(
nfs
);

56 
pfd
.
evíts
 = 
	`nfs_which_evíts
(
nfs
);

58 i‡(
	`pﬁl
(&
pfd
, 1, -1) < 0) {

59 
	`¥ötf
("Poll failed");

60 
cb_d©a
->
°©us
 = -
EIO
;

63 i‡(
	`nfs_£rvi˚
(
nfs
, 
pfd
.
ªvíts
) < 0) {

64 
	`¥ötf
("nfs_service failed\n");

65 
cb_d©a
->
°©us
 = -
EIO
;

69 
	}
}

79 
	$mou¡_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

81 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

83 
cb_d©a
->
is_föished
 = 1;

84 
cb_d©a
->
°©us
 = status;

86 i‡(
°©us
 < 0) {

87 
	`¥ötf
("mou¡/m¡ cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

90 
	}
}

92 
	$nfs_mou¡_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
£rvî
, c⁄° *
exp‹t
)

94 
sync_cb_d©a
 
cb_d©a
;

96 
cb_d©a
.
is_föished
 = 0;

98 i‡(
	`nfs_mou¡_async
(
nfs
, 
£rvî
, 
exp‹t
, 
mou¡_cb
, &
cb_d©a
) != 0) {

99 
	`¥ötf
("nfs_mount_async failed\n");

103 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

105  
cb_d©a
.
°©us
;

106 
	}
}

112 
	$°©_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

114 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

116 
cb_d©a
->
is_föished
 = 1;

117 
cb_d©a
->
°©us
 = status;

119 i‡(
°©us
 < 0) {

120 
	`¥ötf
("°© cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

124 
	`mem˝y
(
cb_d©a
->
ªtu∫_d©a
, 
d©a
, (
°©
));

125 
	}
}

127 
	$nfs_°©_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
°©
 *
°
)

129 
sync_cb_d©a
 
cb_d©a
;

131 
cb_d©a
.
is_föished
 = 0;

132 
cb_d©a
.
ªtu∫_d©a
 = 
°
;

134 i‡(
	`nfs_°©_async
(
nfs
, 
∑th
, 
°©_cb
, &
cb_d©a
) != 0) {

135 
	`¥ötf
("nfs_stat_async failed\n");

139 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

141  
cb_d©a
.
°©us
;

142 
	}
}

150 
	$›í_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

152 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

153 
nfsfh
 *
fh
, **nfsfh;

155 
cb_d©a
->
is_föished
 = 1;

156 
cb_d©a
->
°©us
 = status;

158 i‡(
°©us
 < 0) {

159 
	`¥ötf
("›í cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

163 
fh
 = 
d©a
;

164 
nfsfh
 = 
cb_d©a
->
ªtu∫_d©a
;

165 *
nfsfh
 = 
fh
;

166 
	}
}

168 
	$nfs_›í_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfsfh
 **nfsfh)

170 
sync_cb_d©a
 
cb_d©a
;

172 
cb_d©a
.
is_föished
 = 0;

173 
cb_d©a
.
ªtu∫_d©a
 = 
nfsfh
;

175 i‡(
	`nfs_›í_async
(
nfs
, 
∑th
, 
mode
, 
›í_cb
, &
cb_d©a
) != 0) {

176 
	`¥ötf
("nfs_open_async failed\n");

180 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

182  
cb_d©a
.
°©us
;

183 
	}
}

191 
	$¥ód_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

193 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

194 *
buf„r
;

195 
cb_d©a
->
is_föished
 = 1;

196 
cb_d©a
->
°©us
 = status;

198 i‡(
°©us
 < 0) {

199 
	`¥ötf
("¥ód cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

203 
buf„r
 = 
cb_d©a
->
ªtu∫_d©a
;

204 
	`mem˝y
(
buf„r
, (*)
d©a
, 
°©us
);

205 
	}
}

207 
	$nfs_¥ód_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
buf„r
)

209 
sync_cb_d©a
 
cb_d©a
;

211 
cb_d©a
.
is_föished
 = 0;

212 
cb_d©a
.
ªtu∫_d©a
 = 
buf„r
;

214 i‡(
	`nfs_¥ód_async
(
nfs
, 
nfsfh
, 
off£t
, 
cou¡
, 
¥ód_cb
, &
cb_d©a
) != 0) {

215 
	`¥ötf
("nfs_pread_async failed\n");

219 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

221  
cb_d©a
.
°©us
;

222 
	}
}

227 
	$nfs_ªad_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, *
buf„r
)

229  
	`nfs_¥ód_sync
(
nfs
, 
nfsfh
, 
	`nfs_gë_cuºít_off£t
“fsfh), 
cou¡
, 
buf„r
);

230 
	}
}

235 
	$˛o£_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

237 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

238 
cb_d©a
->
is_föished
 = 1;

239 
cb_d©a
->
°©us
 = status;

241 i‡(
°©us
 < 0) {

242 
	`¥ötf
("˛o£ cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

245 
	}
}

247 
	$nfs_˛o£_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh)

249 
sync_cb_d©a
 
cb_d©a
;

251 
cb_d©a
.
is_föished
 = 0;

253 i‡(
	`nfs_˛o£_async
(
nfs
, 
nfsfh
, 
˛o£_cb
, &
cb_d©a
) != 0) {

254 
	`¥ötf
("nfs_close_async failed\n");

258 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

260  
cb_d©a
.
°©us
;

261 
	}
}

269 
	$nfs_f°©_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
°©
 *
°
)

271 
sync_cb_d©a
 
cb_d©a
;

273 
cb_d©a
.
is_föished
 = 0;

274 
cb_d©a
.
ªtu∫_d©a
 = 
°
;

276 i‡(
	`nfs_f°©_async
(
nfs
, 
nfsfh
, 
°©_cb
, &
cb_d©a
) != 0) {

277 
	`¥ötf
("nfs_fstat_async failed\n");

281 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

283  
cb_d©a
.
°©us
;

284 
	}
}

290 
	$pwrôe_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

292 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

293 
cb_d©a
->
is_föished
 = 1;

294 
cb_d©a
->
°©us
 = status;

296 i‡(
°©us
 < 0) {

297 
	`¥ötf
("pwrôêˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

300 
	}
}

302 
	$nfs_pwrôe_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
buf
)

304 
sync_cb_d©a
 
cb_d©a
;

306 
cb_d©a
.
is_föished
 = 0;

308 i‡(
	`nfs_pwrôe_async
(
nfs
, 
nfsfh
, 
off£t
, 
cou¡
, 
buf
, 
pwrôe_cb
, &
cb_d©a
) != 0) {

309 
	`¥ötf
("nfs_pwrite_async failed\n");

313 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

315  
cb_d©a
.
°©us
;

316 
	}
}

321 
	$nfs_wrôe_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, *
buf
)

323  
	`nfs_pwrôe_sync
(
nfs
, 
nfsfh
, 
	`nfs_gë_cuºít_off£t
“fsfh), 
cou¡
, 
buf
);

324 
	}
}

330 
	$fsync_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

332 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

333 
cb_d©a
->
is_föished
 = 1;

334 
cb_d©a
->
°©us
 = status;

336 i‡(
°©us
 < 0) {

337 
	`¥ötf
("fsyn¯ˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

340 
	}
}

342 
	$nfs_fsync_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh)

344 
sync_cb_d©a
 
cb_d©a
;

346 
cb_d©a
.
is_föished
 = 0;

348 i‡(
	`nfs_fsync_async
(
nfs
, 
nfsfh
, 
fsync_cb
, &
cb_d©a
) != 0) {

349 
	`¥ötf
("nfs_fsync_async failed\n");

353 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

355  
cb_d©a
.
°©us
;

356 
	}
}

364 
	$·runˇã_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

366 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

367 
cb_d©a
->
is_föished
 = 1;

368 
cb_d©a
->
°©us
 = status;

370 i‡(
°©us
 < 0) {

371 
	`¥ötf
("·runˇã cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

374 
	}
}

376 
	$nfs_·runˇã_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
Àngth
)

378 
sync_cb_d©a
 
cb_d©a
;

380 
cb_d©a
.
is_föished
 = 0;

382 i‡(
	`nfs_·runˇã_async
(
nfs
, 
nfsfh
, 
Àngth
, 
·runˇã_cb
, &
cb_d©a
) != 0) {

383 
	`¥ötf
("nfs_ftruncate_async failed\n");

387 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

389  
cb_d©a
.
°©us
;

390 
	}
}

397 
	$åunˇã_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

399 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

400 
cb_d©a
->
is_föished
 = 1;

401 
cb_d©a
->
°©us
 = status;

403 i‡(
°©us
 < 0) {

404 
	`¥ötf
("åunˇã cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

407 
	}
}

409 
	$nfs_åunˇã_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_off_t
 
Àngth
)

411 
sync_cb_d©a
 
cb_d©a
;

413 
cb_d©a
.
is_föished
 = 0;

415 i‡(
	`nfs_åunˇã_async
(
nfs
, 
∑th
, 
Àngth
, 
åunˇã_cb
, &
cb_d©a
) != 0) {

416 
	`¥ötf
("nfs_ftruncate_async failed\n");

420 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

422  
cb_d©a
.
°©us
;

423 
	}
}

432 
	$mkdú_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

434 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

435 
cb_d©a
->
is_föished
 = 1;

436 
cb_d©a
->
°©us
 = status;

438 i‡(
°©us
 < 0) {

439 
	`¥ötf
("mkdú cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

442 
	}
}

444 
	$nfs_mkdú_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
)

446 
sync_cb_d©a
 
cb_d©a
;

448 
cb_d©a
.
is_föished
 = 0;

450 i‡(
	`nfs_mkdú_async
(
nfs
, 
∑th
, 
mkdú_cb
, &
cb_d©a
) != 0) {

451 
	`¥ötf
("nfs_mkdir_async failed\n");

455 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

457  
cb_d©a
.
°©us
;

458 
	}
}

467 
	$rmdú_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

469 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

470 
cb_d©a
->
is_föished
 = 1;

471 
cb_d©a
->
°©us
 = status;

473 i‡(
°©us
 < 0) {

474 
	`¥ötf
("rmdú cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

477 
	}
}

479 
	$nfs_rmdú_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
)

481 
sync_cb_d©a
 
cb_d©a
;

483 
cb_d©a
.
is_föished
 = 0;

485 i‡(
	`nfs_rmdú_async
(
nfs
, 
∑th
, 
rmdú_cb
, &
cb_d©a
) != 0) {

486 
	`¥ötf
("nfs_rmdir_async failed\n");

490 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

492  
cb_d©a
.
°©us
;

493 
	}
}

500 
	$¸ót_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

502 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

503 
nfsfh
 *
fh
, **nfsfh;

505 
cb_d©a
->
is_föished
 = 1;

506 
cb_d©a
->
°©us
 = status;

508 i‡(
°©us
 < 0) {

509 
	`¥ötf
("¸óàˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

513 
fh
 = 
d©a
;

514 
nfsfh
 = 
cb_d©a
->
ªtu∫_d©a
;

515 *
nfsfh
 = 
fh
;

516 
	}
}

518 
	$nfs_¸ót_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfsfh
 **nfsfh)

520 
sync_cb_d©a
 
cb_d©a
;

522 
cb_d©a
.
is_föished
 = 0;

523 
cb_d©a
.
ªtu∫_d©a
 = 
nfsfh
;

525 i‡(
	`nfs_¸ót_async
(
nfs
, 
∑th
, 
mode
, 
¸ót_cb
, &
cb_d©a
) != 0) {

526 
	`¥ötf
("nfs_creat_async failed\n");

530 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

532  
cb_d©a
.
°©us
;

533 
	}
}

541 
	$u∆ök_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

543 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

545 
cb_d©a
->
is_föished
 = 1;

546 
cb_d©a
->
°©us
 = status;

548 i‡(
°©us
 < 0) {

549 
	`¥ötf
("u∆ök cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

552 
	}
}

554 
	$nfs_u∆ök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
)

556 
sync_cb_d©a
 
cb_d©a
;

558 
cb_d©a
.
is_föished
 = 0;

560 i‡(
	`nfs_u∆ök_async
(
nfs
, 
∑th
, 
u∆ök_cb
, &
cb_d©a
) != 0) {

561 
	`¥ötf
("nfs_unlink_async failed\n");

565 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

567  
cb_d©a
.
°©us
;

568 
	}
}

575 
	$›ídú_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

577 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

578 
nfsdú
 *
dú
, **nfsdir;

580 
cb_d©a
->
is_föished
 = 1;

581 
cb_d©a
->
°©us
 = status;

583 i‡(
°©us
 < 0) {

584 
	`¥ötf
("›ídú cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

588 
dú
 = 
d©a
;

589 
nfsdú
 = 
cb_d©a
->
ªtu∫_d©a
;

590 *
nfsdú
 = 
dú
;

591 
	}
}

593 
	$nfs_›ídú_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfsdú
 **nfsdir)

595 
sync_cb_d©a
 
cb_d©a
;

597 
cb_d©a
.
is_föished
 = 0;

598 
cb_d©a
.
ªtu∫_d©a
 = 
nfsdú
;

600 i‡(
	`nfs_›ídú_async
(
nfs
, 
∑th
, 
›ídú_cb
, &
cb_d©a
) != 0) {

601 
	`¥ötf
("nfs_opendir_async failed\n");

605 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

607  
cb_d©a
.
°©us
;

608 
	}
}

614 
	$l£ek_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

616 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

618 
cb_d©a
->
is_föished
 = 1;

619 
cb_d©a
->
°©us
 = status;

621 i‡(
°©us
 < 0) {

622 
	`¥ötf
("l£ek cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

626 i‡(
cb_d©a
->
ªtu∫_d©a
 !
NULL
) {

627 
	`mem˝y
(
cb_d©a
->
ªtu∫_d©a
, 
d©a
, (
nfs_off_t
));

629 
	}
}

631 
	$nfs_l£ek_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
whí˚
,Çfs_off_à*
cuºít_off£t
)

633 
sync_cb_d©a
 
cb_d©a
;

635 
cb_d©a
.
is_föished
 = 0;

636 
cb_d©a
.
ªtu∫_d©a
 = 
cuºít_off£t
;

638 i‡(
	`nfs_l£ek_async
(
nfs
, 
nfsfh
, 
off£t
, 
whí˚
, 
l£ek_cb
, &
cb_d©a
) != 0) {

639 
	`¥ötf
("nfs_lseek_async failed\n");

643 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

645  
cb_d©a
.
°©us
;

646 
	}
}

653 
	$°©vfs_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

655 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

657 
cb_d©a
->
is_föished
 = 1;

658 
cb_d©a
->
°©us
 = status;

660 i‡(
°©us
 < 0) {

661 
	`¥ötf
("°©vf†ˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

665 
	`mem˝y
(
cb_d©a
->
ªtu∫_d©a
, 
d©a
, (
°©vfs
));

666 
	}
}

668 
	$nfs_°©vfs_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
°©vfs
 *
svfs
)

670 
sync_cb_d©a
 
cb_d©a
;

672 
cb_d©a
.
is_föished
 = 0;

673 
cb_d©a
.
ªtu∫_d©a
 = 
svfs
;

675 i‡(
	`nfs_°©vfs_async
(
nfs
, 
∑th
, 
°©vfs_cb
, &
cb_d©a
) != 0) {

676 
	`¥ötf
("nfs_statvfs_async failed\n");

680 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

682  
cb_d©a
.
°©us
;

683 
	}
}

692 
	$ªadlök_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

694 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

696 
cb_d©a
->
is_föished
 = 1;

697 
cb_d©a
->
°©us
 = status;

699 i‡(
°©us
 < 0) {

700 
	`¥ötf
("ªadlök cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

704 i‡(
	`°æí
(
d©a
Ë> (
size_t
)
cb_d©a
->
ªtu∫_öt
) {

705 
	`¥ötf
("Too small buffer forÑeadlink\n");

706 
cb_d©a
->
°©us
 = -
ENAMETOOLONG
;

710 
	`mem˝y
(
cb_d©a
->
ªtu∫_d©a
, 
d©a
, 
	`°æí
(data)+1);

711 
	}
}

713 
	$nfs_ªadlök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, *
buf
, 
bufsize
)

715 
sync_cb_d©a
 
cb_d©a
;

717 
cb_d©a
.
is_föished
 = 0;

718 
cb_d©a
.
ªtu∫_d©a
 = 
buf
;

719 
cb_d©a
.
ªtu∫_öt
 = 
bufsize
;

721 i‡(
	`nfs_ªadlök_async
(
nfs
, 
∑th
, 
ªadlök_cb
, &
cb_d©a
) != 0) {

722 
	`¥ötf
("nfs_readlink_async failed\n");

726 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

728  
cb_d©a
.
°©us
;

729 
	}
}

736 
	$chmod_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

738 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

740 
cb_d©a
->
is_föished
 = 1;

741 
cb_d©a
->
°©us
 = status;

743 i‡(
°©us
 < 0) {

744 
	`¥ötf
("chmod cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

747 
	}
}

749 
	$nfs_chmod_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
)

751 
sync_cb_d©a
 
cb_d©a
;

753 
cb_d©a
.
is_föished
 = 0;

755 i‡(
	`nfs_chmod_async
(
nfs
, 
∑th
, 
mode
, 
chmod_cb
, &
cb_d©a
) != 0) {

756 
	`¥ötf
("nfs_chmod_async failed\n");

760 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

762  
cb_d©a
.
°©us
;

763 
	}
}

771 
	$fchmod_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

773 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

775 
cb_d©a
->
is_föished
 = 1;

776 
cb_d©a
->
°©us
 = status;

778 i‡(
°©us
 < 0) {

779 
	`¥ötf
("fchmod cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

782 
	}
}

784 
	$nfs_fchmod_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
mode
)

786 
sync_cb_d©a
 
cb_d©a
;

788 
cb_d©a
.
is_föished
 = 0;

790 i‡(
	`nfs_fchmod_async
(
nfs
, 
nfsfh
, 
mode
, 
fchmod_cb
, &
cb_d©a
) != 0) {

791 
	`¥ötf
("nfs_fchmod_async failed\n");

795 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

797  
cb_d©a
.
°©us
;

798 
	}
}

806 
	$chown_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

808 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

810 
cb_d©a
->
is_föished
 = 1;

811 
cb_d©a
->
°©us
 = status;

813 i‡(
°©us
 < 0) {

814 
	`¥ötf
("chow¿ˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

817 
	}
}

819 
	$nfs_chown_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
uid
, 
gid
)

821 
sync_cb_d©a
 
cb_d©a
;

823 
cb_d©a
.
is_föished
 = 0;

825 i‡(
	`nfs_chown_async
(
nfs
, 
∑th
, 
uid
, 
gid
, 
chown_cb
, &
cb_d©a
) != 0) {

826 
	`¥ötf
("nfs_chown_async failed\n");

830 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

832  
cb_d©a
.
°©us
;

833 
	}
}

838 
	$fchown_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

840 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

842 
cb_d©a
->
is_föished
 = 1;

843 
cb_d©a
->
°©us
 = status;

845 i‡(
°©us
 < 0) {

846 
	`¥ötf
("fchow¿ˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

849 
	}
}

851 
	$nfs_fchown_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
uid
, 
gid
)

853 
sync_cb_d©a
 
cb_d©a
;

855 
cb_d©a
.
is_föished
 = 0;

857 i‡(
	`nfs_fchown_async
(
nfs
, 
nfsfh
, 
uid
, 
gid
, 
fchown_cb
, &
cb_d©a
) != 0) {

858 
	`¥ötf
("nfs_fchown_async failed\n");

862 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

864  
cb_d©a
.
°©us
;

865 
	}
}

872 
	$utimes_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

874 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

876 
cb_d©a
->
is_föished
 = 1;

877 
cb_d©a
->
°©us
 = status;

879 i‡(
°©us
 < 0) {

880 
	`¥ötf
("utime†ˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

883 
	}
}

885 
	$nfs_utimes_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
timevÆ
 *
times
)

887 
sync_cb_d©a
 
cb_d©a
;

889 
cb_d©a
.
is_föished
 = 0;

891 i‡(
	`nfs_utimes_async
(
nfs
, 
∑th
, 
times
, 
utimes_cb
, &
cb_d©a
) != 0) {

892 
	`¥ötf
("nfs_utimes_async failed\n");

896 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

898  
cb_d©a
.
°©us
;

899 
	}
}

906 
	$utime_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

908 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

910 
cb_d©a
->
is_föished
 = 1;

911 
cb_d©a
->
°©us
 = status;

913 i‡(
°©us
 < 0) {

914 
	`¥ötf
("utimêˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

917 
	}
}

919 
	$nfs_utime_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
utimbuf
 *
times
)

921 
sync_cb_d©a
 
cb_d©a
;

923 
cb_d©a
.
is_föished
 = 0;

925 i‡(
	`nfs_utime_async
(
nfs
, 
∑th
, 
times
, 
utime_cb
, &
cb_d©a
) != 0) {

926 
	`¥ötf
("nfs_utimes_async failed\n");

930 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

932  
cb_d©a
.
°©us
;

933 
	}
}

941 
	$ac˚ss_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

943 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

945 
cb_d©a
->
is_föished
 = 1;

946 
cb_d©a
->
°©us
 = status;

948 i‡(
°©us
 < 0) {

949 
	`¥ötf
("ac˚s†ˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

952 
	}
}

954 
	$nfs_ac˚ss_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
)

956 
sync_cb_d©a
 
cb_d©a
;

958 
cb_d©a
.
is_föished
 = 0;

960 i‡(
	`nfs_ac˚ss_async
(
nfs
, 
∑th
, 
mode
, 
ac˚ss_cb
, &
cb_d©a
) != 0) {

961 
	`¥ötf
("nfs_access_async failed\n");

965 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

967  
cb_d©a
.
°©us
;

968 
	}
}

975 
	$symlök_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

977 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

979 
cb_d©a
->
is_föished
 = 1;

980 
cb_d©a
->
°©us
 = status;

982 i‡(
°©us
 < 0) {

983 
	`¥ötf
("symlök cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

986 
	}
}

988 
	$nfs_symlök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
)

990 
sync_cb_d©a
 
cb_d©a
;

992 
cb_d©a
.
is_föished
 = 0;

994 i‡(
	`nfs_symlök_async
(
nfs
, 
ﬁd∑th
, 
√w∑th
, 
symlök_cb
, &
cb_d©a
) != 0) {

995 
	`¥ötf
("nfs_symlink_async failed\n");

999 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

1001  
cb_d©a
.
°©us
;

1002 
	}
}

1009 
	$ª«me_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

1011 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

1013 
cb_d©a
->
is_föished
 = 1;

1014 
cb_d©a
->
°©us
 = status;

1016 i‡(
°©us
 < 0) {

1017 
	`¥ötf
("ª«mêˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

1020 
	}
}

1022 
	$nfs_ª«me_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
)

1024 
sync_cb_d©a
 
cb_d©a
;

1026 
cb_d©a
.
is_föished
 = 0;

1028 i‡(
	`nfs_ª«me_async
(
nfs
, 
ﬁd∑th
, 
√w∑th
, 
ª«me_cb
, &
cb_d©a
) != 0) {

1029 
	`¥ötf
("nfs_rename_async failed\n");

1033 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

1035  
cb_d©a
.
°©us
;

1036 
	}
}

1043 
	$lök_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, *
d©a
, *
¥iv©e_d©a
)

1045 
sync_cb_d©a
 *
cb_d©a
 = 
¥iv©e_d©a
;

1047 
cb_d©a
->
is_föished
 = 1;

1048 
cb_d©a
->
°©us
 = status;

1050 i‡(
°©us
 < 0) {

1051 
	`¥ötf
("lök cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

1054 
	}
}

1056 
	$nfs_lök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
)

1058 
sync_cb_d©a
 
cb_d©a
;

1060 
cb_d©a
.
is_föished
 = 0;

1062 i‡(
	`nfs_lök_async
(
nfs
, 
ﬁd∑th
, 
√w∑th
, 
lök_cb
, &
cb_d©a
) != 0) {

1063 
	`¥ötf
("nfs_link_async failed\n");

1067 
	`waô_f‹_ª∂y
(
nfs
, &
cb_d©a
);

1069  
cb_d©a
.
°©us
;

1070 
	}
}

	@ccan/ccan/nfs/libnfs.c

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<°rög.h
>

24 
	~<°rögs.h
>

25 
	~<î∫o.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<sys/°©.h
>

28 
	~<sys/°©vfs.h
>

29 
	~<utime.h
>

30 
	~<uni°d.h
>

31 
	~<f˙é.h
>

32 
	~<cˇn/compûî/compûî.h
>

33 
	~"nfs.h
"

34 
	~"libnfs-øw.h
"

35 
	~"Ωc/mou¡.h
"

36 
	~"Ωc/nfs.h
"

38 
	snfsfh
 {

39 
nfs_fh3
 
	mfh
;

40 
	mis_sync
;

41 
nfs_off_t
 
	moff£t
;

44 
	snfsdú
 {

45 
nfsdúít
 *
	míåõs
;

46 
nfsdúít
 *
	mcuºít
;

49 
	$nfs_‰ì_nfsdú
(
nfsdú
 *nfsdir)

51 
nfsdú
->
íåõs
) {

52 
nfsdúít
 *
dúít
 = 
nfsdú
->
íåõs
->
√xt
;

53 i‡(
nfsdú
->
íåõs
->
«me
 !
NULL
) {

54 
	`‰ì
(
nfsdú
->
íåõs
->
«me
);

56 
	`‰ì
(
nfsdú
->
íåõs
);

57 
nfsdú
->
íåõs
 = 
dúít
;

59 
	`‰ì
(
nfsdú
);

60 
	}
}

62 
	snfs_c⁄ãxt
 {

63 
Ωc_c⁄ãxt
 *
	mΩc
;

64 *
	m£rvî
;

65 *
	mexp‹t
;

66 
nfs_fh3
 
	mroŸfh
;

67 
	ma˛_suµ‹t
;

70 
	gnfs_cb_d©a
;

71 (*
	tc⁄töue_func
)(
	tnfs_c⁄ãxt
 *
	tnfs
, 
	tnfs_cb_d©a
 *
	td©a
);

73 
	snfs_cb_d©a
 {

74 
nfs_c⁄ãxt
 *
nfs
;

75 
nfsfh
 *nfsfh;

76 *
ßved_∑th
, *
∑th
;

78 
nfs_cb
 
cb
;

79 *
¥iv©e_d©a
;

81 
c⁄töue_func
 
c⁄töue_cb
;

82 *
c⁄töue_d©a
;

83 (*
‰ì_c⁄töue_d©a
)(*);

84 
c⁄töue_öt
;

86 
nfs_fh3
 
fh
;

89 
	`nfs_lookup_∑th_async_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
, 
nfs_fh3
 *
fh
);

92 
	$nfs_£t_auth
(
nfs_c⁄ãxt
 *
nfs
, 
AUTH
 *
auth
)

94  
	`Ωc_£t_auth
(
nfs
->
Ωc
, 
auth
);

95 
	}
}

97 
	$nfs_gë_fd
(
nfs_c⁄ãxt
 *
nfs
)

99  
	`Ωc_gë_fd
(
nfs
->
Ωc
);

100 
	}
}

102 
	$nfs_which_evíts
(
nfs_c⁄ãxt
 *
nfs
)

104  
	`Ωc_which_evíts
(
nfs
->
Ωc
);

105 
	}
}

107 
	$nfs_£rvi˚
(
nfs_c⁄ãxt
 *
nfs
, 
ªvíts
)

109  
	`Ωc_£rvi˚
(
nfs
->
Ωc
, 
ªvíts
);

110 
	}
}

112 *
	$nfs_gë_îr‹
(
nfs_c⁄ãxt
 *
nfs
)

114  
	`Ωc_gë_îr‹
(
nfs
->
Ωc
);

115 
	}
};

117 
nfs_c⁄ãxt
 *
	$nfs_öô_c⁄ãxt
()

119 
nfs_c⁄ãxt
 *
nfs
;

121 
nfs
 = 
	`mÆloc
((
nfs_c⁄ãxt
));

122 i‡(
nfs
 =
NULL
) {

123 
	`¥ötf
("FailedÅoállocateÇfs context\n");

124  
NULL
;

126 
nfs
->
Ωc
 = 
	`Ωc_öô_c⁄ãxt
();

127 i‡(
nfs
->
Ωc
 =
NULL
) {

128 
	`¥ötf
("FailedÅoállocateÑpc sub-context\n");

129 
	`‰ì
(
nfs
);

130  
NULL
;

133  
nfs
;

134 
	}
}

136 
	$nfs_de°roy_c⁄ãxt
(
nfs_c⁄ãxt
 *
nfs
)

138 
	`Ωc_de°roy_c⁄ãxt
(
nfs
->
Ωc
);

139 
nfs
->
Ωc
 = 
NULL
;

141 i‡(
nfs
->
£rvî
) {

142 
	`‰ì
(
nfs
->
£rvî
);

143 
nfs
->
£rvî
 = 
NULL
;

146 i‡(
nfs
->
exp‹t
) {

147 
	`‰ì
(
nfs
->
exp‹t
);

148 
nfs
->
exp‹t
 = 
NULL
;

151 i‡(
nfs
->
roŸfh
.
d©a
.
d©a_vÆ
 !
NULL
) {

152 
	`‰ì
(
nfs
->
roŸfh
.
d©a
.
d©a_vÆ
);

153 
nfs
->
roŸfh
.
d©a
.
d©a_vÆ
 = 
NULL
;

156 
	`‰ì
(
nfs
);

157 
	}
}

159 
	$‰ì_nfs_cb_d©a
(
nfs_cb_d©a
 *
d©a
)

161 i‡(
d©a
->
ßved_∑th
 !
NULL
) {

162 
	`‰ì
(
d©a
->
ßved_∑th
);

163 
d©a
->
ßved_∑th
 = 
NULL
;

166 i‡(
d©a
->
c⁄töue_d©a
 !
NULL
) {

167 
d©a
->
	`‰ì_c⁄töue_d©a
(d©a->
c⁄töue_d©a
);

168 
d©a
->
c⁄töue_d©a
 = 
NULL
;

171 i‡(
d©a
->
fh
.d©a.
d©a_vÆ
 !
NULL
) {

172 
	`‰ì
(
d©a
->
fh
.d©a.
d©a_vÆ
);

173 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

176 
	`‰ì
(
d©a
);

177 
	}
}

183 
	$nfs_mou¡_10_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

185 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

186 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

188 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

189 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

190 
	`‰ì_nfs_cb_d©a
(
d©a
);

193 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

194 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

195 
	`‰ì_nfs_cb_d©a
(
d©a
);

199 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

200 
	`‰ì_nfs_cb_d©a
(
d©a
);

201 
	}
}

203 
	$nfs_mou¡_9_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

205 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

206 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

208 
nfs
->
a˛_suµ‹t
 = 1;

209 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

210 
nfs
->
a˛_suµ‹t
 = 0;

212 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

213 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

214 
	`‰ì_nfs_cb_d©a
(
d©a
);

218 i‡(
	`Ωc_nfs_gë©å_async
(
Ωc
, 
nfs_mou¡_10_cb
, &
nfs
->
roŸfh
, 
d©a
) != 0) {

219 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

220 
	`‰ì_nfs_cb_d©a
(
d©a
);

223 
	}
}

225 
	$nfs_mou¡_8_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

227 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

228 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

230 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

231 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

232 
	`‰ì_nfs_cb_d©a
(
d©a
);

235 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

236 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

237 
	`‰ì_nfs_cb_d©a
(
d©a
);

241 i‡(
	`Ωc_nfß˛_nuŒ_async
(
Ωc
, 
nfs_mou¡_9_cb
, 
d©a
) != 0) {

242 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

243 
	`‰ì_nfs_cb_d©a
(
d©a
);

246 
	}
}

248 
	$nfs_mou¡_7_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

250 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

251 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

253 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

254 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

255 
	`‰ì_nfs_cb_d©a
(
d©a
);

258 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

259 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

260 
	`‰ì_nfs_cb_d©a
(
d©a
);

264 i‡(
	`Ωc_nfs_nuŒ_async
(
Ωc
, 
nfs_mou¡_8_cb
, 
d©a
) != 0) {

265 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

266 
	`‰ì_nfs_cb_d©a
(
d©a
);

269 
	}
}

272 
	$nfs_mou¡_6_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

274 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

275 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

276 
mou¡ªs3
 *
ªs
;

278 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

279 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

280 
	`‰ì_nfs_cb_d©a
(
d©a
);

283 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

284 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

285 
	`‰ì_nfs_cb_d©a
(
d©a
);

289 
ªs
 = 
comm™d_d©a
;

290 i‡(
ªs
->
fhs_°©us
 !
MNT3_OK
) {

291 
	`Ωc_£t_îr‹
(
Ωc
, "RPCÉº‹: Mou¡ faûed wôhÉº‹ %s(%dË%s(%d)", 
	`mou¡°©3_to_°r
(
ªs
->
fhs_°©us
),Ñes->fhs_°©us, 
	`°ªº‹
(-
	`mou¡°©3_to_î∫o
(res->fhs_status)), -mountstat3_to_errno(res->fhs_status));

292 
d©a
->
	`cb
(
	`mou¡°©3_to_î∫o
(
ªs
->
fhs_°©us
), 
nfs
, 
	`Ωc_gë_îr‹
(
Ωc
), d©a->
¥iv©e_d©a
);

293 
	`‰ì_nfs_cb_d©a
(
d©a
);

297 
nfs
->
roŸfh
.
d©a
.
d©a_Àn
 = 
ªs
->
mou¡ªs3_u
.
mou¡öfo
.
fh™dÀ
.
fh™dÀ3_Àn
;

298 
nfs
->
roŸfh
.
d©a
.
d©a_vÆ
 = 
	`mÆloc
“fs->roŸfh.d©a.
d©a_Àn
);

299 i‡(
nfs
->
roŸfh
.
d©a
.
d©a_vÆ
 =
NULL
) {

300 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. CouldÇotállocate memoryÅo storeÑoot filehandle");

301 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
(
Ωc
), d©a->
¥iv©e_d©a
);

302 
	`‰ì_nfs_cb_d©a
(
d©a
);

305 
	`mem˝y
(
nfs
->
roŸfh
.
d©a
.
d©a_vÆ
, 
ªs
->
mou¡ªs3_u
.
mou¡öfo
.
fh™dÀ
.
fh™dÀ3_vÆ
,Çfs->roŸfh.d©a.
d©a_Àn
);

307 
	`Ωc_disc⁄√˘
(
Ωc
, "normal disconnect");

308 i‡(
	`Ωc_c⁄√˘_async
(
Ωc
, 
nfs
->
£rvî
, 2049, 1, 
nfs_mou¡_7_cb
, 
d©a
) != 0) {

309 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

310 
	`‰ì_nfs_cb_d©a
(
d©a
);

313 
	}
}

316 
	$nfs_mou¡_5_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

318 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

319 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

321 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

322 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

323 
	`‰ì_nfs_cb_d©a
(
d©a
);

326 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

327 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

328 
	`‰ì_nfs_cb_d©a
(
d©a
);

332 i‡(
	`Ωc_mou¡_m¡_async
(
Ωc
, 
nfs_mou¡_6_cb
, 
nfs
->
exp‹t
, 
d©a
) != 0) {

333 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

334 
	`‰ì_nfs_cb_d©a
(
d©a
);

337 
	}
}

339 
	$nfs_mou¡_4_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

341 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

342 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

344 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

345 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

346 
	`‰ì_nfs_cb_d©a
(
d©a
);

349 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

350 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

351 
	`‰ì_nfs_cb_d©a
(
d©a
);

355 i‡(
	`Ωc_mou¡_nuŒ_async
(
Ωc
, 
nfs_mou¡_5_cb
, 
d©a
) != 0) {

356 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

357 
	`‰ì_nfs_cb_d©a
(
d©a
);

360 
	}
}

362 
	$nfs_mou¡_3_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

364 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

365 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

366 
uöt32_t
 
mou¡_p‹t
;

368 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

369 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

370 
	`‰ì_nfs_cb_d©a
(
d©a
);

373 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

374 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

375 
	`‰ì_nfs_cb_d©a
(
d©a
);

379 
mou¡_p‹t
 = *(
uöt32_t
 *)
comm™d_d©a
;

380 i‡(
mou¡_p‹t
 == 0) {

381 
	`Ωc_£t_îr‹
(
Ωc
, "RPCÉº‹. Mou¡Örogøm i†nŸávaûabÀ o¿%s", 
nfs
->
£rvî
);

382 
d©a
->
	`cb
(-
ENOENT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

383 
	`‰ì_nfs_cb_d©a
(
d©a
);

387 
	`Ωc_disc⁄√˘
(
Ωc
, "normal disconnect");

388 i‡(
	`Ωc_c⁄√˘_async
(
Ωc
, 
nfs
->
£rvî
, 
mou¡_p‹t
, 1, 
nfs_mou¡_4_cb
, 
d©a
) != 0) {

389 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

390 
	`‰ì_nfs_cb_d©a
(
d©a
);

393 
	}
}

396 
	$nfs_mou¡_2_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

398 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

399 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

401 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

402 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

403 
	`‰ì_nfs_cb_d©a
(
d©a
);

406 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

407 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

408 
	`‰ì_nfs_cb_d©a
(
d©a
);

412 i‡(
	`Ωc_pm≠_gëp‹t_async
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
nfs_mou¡_3_cb
, 
¥iv©e_d©a
) != 0) {

413 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

414 
	`‰ì_nfs_cb_d©a
(
d©a
);

417 
	}
}

419 
	$nfs_mou¡_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

421 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

422 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

424 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

425 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

426 
	`‰ì_nfs_cb_d©a
(
d©a
);

429 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

430 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

431 
	`‰ì_nfs_cb_d©a
(
d©a
);

435 i‡(
	`Ωc_pm≠_nuŒ_async
(
Ωc
, 
nfs_mou¡_2_cb
, 
d©a
) != 0) {

436 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

437 
	`‰ì_nfs_cb_d©a
(
d©a
);

440 
	}
}

445 
	$nfs_mou¡_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
£rvî
, c⁄° *
exp‹t
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

447 
nfs_cb_d©a
 *
d©a
;

449 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

450 i‡(
d©a
 =
NULL
) {

451 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory");

452 
	`¥ötf
("failedÅoállocate memory forÇfs mount data\n");

455 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

456 
nfs
->
£rvî
 = 
	`°rdup
(server);

457 
nfs
->
exp‹t
 = 
	`°rdup
(export);

458 
d©a
->
nfs
 =Çfs;

459 
d©a
->
cb
 = cb;

460 
d©a
->
¥iv©e_d©a
 =Örivate_data;

462 i‡(
	`Ωc_c⁄√˘_async
(
nfs
->
Ωc
, 
£rvî
, 111, 0, 
nfs_mou¡_1_cb
, 
d©a
) != 0) {

463 
	`¥ötf
("FailedÅo start connection\n");

464 
	`‰ì_nfs_cb_d©a
(
d©a
);

469 
	}
}

477 
	$nfs_lookup_∑th_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

479 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

480 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

481 
LOOKUP3ªs
 *
ªs
;

483 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

484 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

485 
	`‰ì_nfs_cb_d©a
(
d©a
);

488 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

489 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

490 
	`‰ì_nfs_cb_d©a
(
d©a
);

494 
ªs
 = 
comm™d_d©a
;

495 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

496 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: Looku∞o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

497 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

498 
	`‰ì_nfs_cb_d©a
(
d©a
);

502 i‡(
	`nfs_lookup_∑th_async_öã∫Æ
(
nfs
, 
d©a
, &
ªs
->
LOOKUP3ªs_u
.
ªsok
.
obje˘
) != 0) {

503 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "FailedÅo createÜookupÖdu");

504 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

505 
	`‰ì_nfs_cb_d©a
(
d©a
);

508 
	}
}

510 
	$nfs_lookup_∑th_async_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
, 
nfs_fh3
 *
fh
)

512 *
∑th
, *
°r
;

514 *
d©a
->
∑th
 == '/') {

515 
d©a
->
∑th
++;

518 
∑th
 = 
d©a
->path;

519 
°r
 = 
	`ödex
(
∑th
, '/');

520 i‡(
°r
 !
NULL
) {

521 *
°r
 = 0;

522 
d©a
->
∑th
 = 
°r
+1;

524 *
d©a
->
∑th
 != 0) {

525 
d©a
->
∑th
++;

529 i‡(*
∑th
 == 0) {

530 
d©a
->
fh
.d©a.
d©a_Àn
 = fh->data.data_len;

531 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
	`mÆloc
(d©a->fh.d©a.
d©a_Àn
);

532 i‡(
d©a
->
fh
.d©a.
d©a_vÆ
 =
NULL
) {

533 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "Ouào‡mem‹y: FaûedÅÿÆloˇã fh f‹ %s", 
d©a
->
∑th
);

534 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

535 
	`‰ì_nfs_cb_d©a
(
d©a
);

538 
	`mem˝y
(
d©a
->
fh
.d©a.
d©a_vÆ
, fh->d©a.d©a_vÆ, d©a->fh.d©a.
d©a_Àn
);

539 
d©a
->
	`c⁄töue_cb
(
nfs
, data);

543 i‡(
	`Ωc_nfs_lookup_async
(
nfs
->
Ωc
, 
nfs_lookup_∑th_1_cb
, 
fh
, 
∑th
, 
d©a
) != 0) {

544 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£ndÜooku∞ˇŒ f‹ %s", 
d©a
->
∑th
);

545 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

546 
	`‰ì_nfs_cb_d©a
(
d©a
);

550 
	}
}

552 
nfs_lookuµ©h_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
, 
c⁄töue_func
 
c⁄töue_cb
, *
c⁄töue_d©a
, (*
‰ì_c⁄töue_d©a
)(*), 
c⁄töue_öt
)

554 
nfs_cb_d©a
 *
d©a
;

556 i‡(
∑th
[0] != '/') {

557 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "P©h«mêi†nŸábsuluã %s", 
∑th
);

561 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

562 i‡(
d©a
 =
NULL
) {

563 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅoállocateÇfs_cb_data structure");

564 
	`¥ötf
("failedÅoállocate memory forÇfs cb data\n");

565 
	`‰ì_nfs_cb_d©a
(
d©a
);

568 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

569 
d©a
->
nfs
 =Çfs;

570 
d©a
->
cb
 = cb;

571 
d©a
->
c⁄töue_cb
 = continue_cb;

572 
d©a
->
c⁄töue_d©a
 = continue_data;

573 
d©a
->
‰ì_c⁄töue_d©a
 = free_continue_data;

574 
d©a
->
c⁄töue_öt
 = continue_int;

575 
d©a
->
¥iv©e_d©a
 =Örivate_data;

576 
d©a
->
ßved_∑th
 = 
	`°rdup
(
∑th
);

577 i‡(
d©a
->
ßved_∑th
 =
NULL
) {

578 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅo copyÖath string");

579 
	`¥ötf
("failedÅoállocate memory forÖath string\n");

580 
	`‰ì_nfs_cb_d©a
(
d©a
);

583 
d©a
->
∑th
 = d©a->
ßved_∑th
;

585 i‡(
	`nfs_lookup_∑th_async_öã∫Æ
(
nfs
, 
d©a
, &nfs->
roŸfh
) != 0) {

586 
	`¥ötf
("failedÅoÜookupÖath\n");

591 
	}
}

600 
	$nfs_°©_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

602 
GETATTR3ªs
 *
ªs
;

603 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

604 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

605 
°©
 
°
;

607 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

608 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

609 
	`‰ì_nfs_cb_d©a
(
d©a
);

612 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

613 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

614 
	`‰ì_nfs_cb_d©a
(
d©a
);

618 
ªs
 = 
comm™d_d©a
;

619 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

620 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: GETATTR o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

621 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

622 
	`‰ì_nfs_cb_d©a
(
d©a
);

626 
°
.
°_dev
 = -1;

627 
°
.
°_öo
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
fûeid
;

628 
°
.
°_mode
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
mode
;

629 
°
.
°_∆ök
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
∆ök
;

630 
°
.
°_uid
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
uid
;

631 
°
.
°_gid
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
gid
;

632 
°
.
°_rdev
 = 0;

633 
°
.
°_size
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
size
;

634 
°
.
°_blksize
 = 4096;

635 
°
.
°_blocks
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
size
 / 4096;

636 
°
.
°_©ime
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
©ime
.
£c⁄ds
;

637 
°
.
°_mtime
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
mtime
.
£c⁄ds
;

638 
°
.
°_˘ime
 = 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
˘ime
.
£c⁄ds
;

640 
d©a
->
	`cb
(0, 
nfs
, &
°
, d©a->
¥iv©e_d©a
);

641 
	`‰ì_nfs_cb_d©a
(
d©a
);

642 
	}
}

644 
	$nfs_°©_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

646 i‡(
	`Ωc_nfs_gë©å_async
(
nfs
->
Ωc
, 
nfs_°©_1_cb
, &
d©a
->
fh
, data) != 0) {

647 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd STAT GETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

648 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

649 
	`‰ì_nfs_cb_d©a
(
d©a
);

653 
	}
}

655 
	$nfs_°©_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

657 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_°©_c⁄töue_öã∫Æ
, 
NULL
, NULL, 0) != 0) {

658 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

663 
	}
}

672 
	$nfs_›í_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

674 
ACCESS3ªs
 *
ªs
;

675 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

676 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

677 
nfsfh
 *nfsfh;

678 
nfsmode
 = 0;

680 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

681 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

682 
	`‰ì_nfs_cb_d©a
(
d©a
);

685 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

686 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

687 
	`‰ì_nfs_cb_d©a
(
d©a
);

691 
ªs
 = 
comm™d_d©a
;

692 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

693 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: ACCESS o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

694 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

695 
	`‰ì_nfs_cb_d©a
(
d©a
);

699 i‡(
d©a
->
c⁄töue_öt
 & 
O_WRONLY
) {

700 
nfsmode
 |
ACCESS3_MODIFY
;

702 i‡(
d©a
->
c⁄töue_öt
 & 
O_RDWR
) {

703 
nfsmode
 |
ACCESS3_READ
|
ACCESS3_MODIFY
;

705 i‡(!(
d©a
->
c⁄töue_öt
 & (
O_WRONLY
|
O_RDWR
))) {

706 
nfsmode
 |
ACCESS3_READ
;

710 i‡(
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
 !
nfsmode
) {

711 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: ACCESS denied. Requiredáccess %c%c%c. Allowedáccess %c%c%c",

712 
nfsmode
&
ACCESS3_READ
?'r':'-',

713 
nfsmode
&
ACCESS3_MODIFY
?'w':'-',

714 
nfsmode
&
ACCESS3_EXECUTE
?'x':'-',

715 
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
&
ACCESS3_READ
?'r':'-',

716 
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
&
ACCESS3_MODIFY
?'w':'-',

717 
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
&
ACCESS3_EXECUTE
?'x':'-');

718 
d©a
->
	`cb
(-
EACCES
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

719 
	`‰ì_nfs_cb_d©a
(
d©a
);

723 
nfsfh
 = 
	`mÆloc
((nfsfh));

724 i‡(
nfsfh
 =
NULL
) {

725 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: FailedÅoállocateÇfsfh structure");

726 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

727 
	`‰ì_nfs_cb_d©a
(
d©a
);

730 
	`bzîo
(
nfsfh
, (nfsfh));

732 i‡(
d©a
->
c⁄töue_öt
 & 
O_SYNC
) {

733 
nfsfh
->
is_sync
 = 1;

737 
nfsfh
->
fh
.
d©a
.
d©a_Àn
 = data->fh.data.data_len;

738 
nfsfh
->
fh
.
d©a
.
d©a_vÆ
 = data->fh.data.data_val;

739 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

741 
d©a
->
	`cb
(0, 
nfs
, 
nfsfh
, d©a->
¥iv©e_d©a
);

742 
	`‰ì_nfs_cb_d©a
(
d©a
);

743 
	}
}

745 
	$nfs_›í_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

747 
nfsmode
 = 0;

749 i‡(
d©a
->
c⁄töue_öt
 & 
O_WRONLY
) {

750 
nfsmode
 |
ACCESS3_MODIFY
;

752 i‡(
d©a
->
c⁄töue_öt
 & 
O_RDWR
) {

753 
nfsmode
 |
ACCESS3_READ
|
ACCESS3_MODIFY
;

755 i‡(!(
d©a
->
c⁄töue_öt
 & (
O_WRONLY
|
O_RDWR
))) {

756 
nfsmode
 |
ACCESS3_READ
;

759 i‡(
	`Ωc_nfs_ac˚ss_async
(
nfs
->
Ωc
, 
nfs_›í_cb
, &
d©a
->
fh
, 
nfsmode
, data) != 0) {

760 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd OPEN ACCESS cÆ»f‹ %s", 
d©a
->
∑th
);

761 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

762 
	`‰ì_nfs_cb_d©a
(
d©a
);

766 
	}
}

768 
	$nfs_›í_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

770 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_›í_c⁄töue_öã∫Æ
, 
NULL
, NULL, 
mode
) != 0) {

771 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

776 
	}
}

785 
	$nfs_¥ód_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

787 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

788 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

789 
READ3ªs
 *
ªs
;

791 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

792 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

793 
	`‰ì_nfs_cb_d©a
(
d©a
);

796 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

797 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

798 
	`‰ì_nfs_cb_d©a
(
d©a
);

802 
ªs
 = 
comm™d_d©a
;

803 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

804 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: Ród faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

805 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

806 
	`‰ì_nfs_cb_d©a
(
d©a
);

810 
d©a
->
nfsfh
->
off£t
 +
ªs
->
READ3ªs_u
.
ªsok
.
cou¡
;

811 
d©a
->
	`cb
(
ªs
->
READ3ªs_u
.
ªsok
.
cou¡
, 
nfs
,Ñes->READ3ªs_u.ªsok.d©a.
d©a_vÆ
, d©a->
¥iv©e_d©a
);

812 
	`‰ì_nfs_cb_d©a
(
d©a
);

813 
	}
}

815 
	$nfs_¥ód_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

817 
nfs_cb_d©a
 *
d©a
;

819 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

820 i‡(
d©a
 =
NULL
) {

821 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅoállocateÇfs_cb_data structure");

822 
	`¥ötf
("failedÅoállocate memory forÇfs cb data\n");

823 
	`‰ì_nfs_cb_d©a
(
d©a
);

826 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

827 
d©a
->
nfs
 =Çfs;

828 
d©a
->
cb
 = cb;

829 
d©a
->
¥iv©e_d©a
 =Örivate_data;

830 
d©a
->
nfsfh
 =Çfsfh;

832 
nfsfh
->
off£t
 = offset;

833 i‡(
	`Ωc_nfs_ªad_async
(
nfs
->
Ωc
, 
nfs_¥ód_cb
, &
nfsfh
->
fh
, 
off£t
, 
cou¡
, 
d©a
) != 0) {

834 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd READ cÆ»f‹ %s", 
d©a
->
∑th
);

835 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

836 
	`‰ì_nfs_cb_d©a
(
d©a
);

840 
	}
}

845 
	$nfs_ªad_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

847  
	`nfs_¥ód_async
(
nfs
, 
nfsfh
,Çfsfh->
off£t
, 
cou¡
, 
cb
, 
¥iv©e_d©a
);

848 
	}
}

855 
	$nfs_pwrôe_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

857 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

858 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

859 
WRITE3ªs
 *
ªs
;

861 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

862 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

863 
	`‰ì_nfs_cb_d©a
(
d©a
);

866 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

867 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

868 
	`‰ì_nfs_cb_d©a
(
d©a
);

872 
ªs
 = 
comm™d_d©a
;

873 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

874 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: WrôêÁûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

875 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

876 
	`‰ì_nfs_cb_d©a
(
d©a
);

880 
d©a
->
nfsfh
->
off£t
 +
ªs
->
WRITE3ªs_u
.
ªsok
.
cou¡
;

881 
d©a
->
	`cb
(
ªs
->
WRITE3ªs_u
.
ªsok
.
cou¡
, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

882 
	`‰ì_nfs_cb_d©a
(
d©a
);

883 
	}
}

885 
	$nfs_pwrôe_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
buf
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

887 
nfs_cb_d©a
 *
d©a
;

889 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

890 i‡(
d©a
 =
NULL
) {

891 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅoállocateÇfs_cb_data structure");

892 
	`¥ötf
("failedÅoállocate memory forÇfs cb data\n");

893 
	`‰ì_nfs_cb_d©a
(
d©a
);

896 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

897 
d©a
->
nfs
 =Çfs;

898 
d©a
->
cb
 = cb;

899 
d©a
->
¥iv©e_d©a
 =Örivate_data;

900 
d©a
->
nfsfh
 =Çfsfh;

902 
nfsfh
->
off£t
 = offset;

903 i‡(
	`Ωc_nfs_wrôe_async
(
nfs
->
Ωc
, 
nfs_pwrôe_cb
, &
nfsfh
->
fh
, 
buf
, 
off£t
, 
cou¡
,Çfsfh->
is_sync
?
FILE_SYNC
:
UNSTABLE
, 
d©a
) != 0) {

904 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd WRITE cÆ»f‹ %s", 
d©a
->
∑th
);

905 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

906 
	`‰ì_nfs_cb_d©a
(
d©a
);

910 
	}
}

915 
	$nfs_wrôe_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, *
buf
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

917  
	`nfs_pwrôe_async
(
nfs
, 
nfsfh
,Çfsfh->
off£t
, 
cou¡
, 
buf
, 
cb
, 
¥iv©e_d©a
);

918 
	}
}

927 
	$nfs_˛o£_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

929 i‡(
nfsfh
->
fh
.
d©a
.
d©a_vÆ
 !
NULL
){

930 
	`‰ì
(
nfsfh
->
fh
.
d©a
.
d©a_vÆ
);

931 
nfsfh
->
fh
.
d©a
.
d©a_vÆ
 = 
NULL
;

933 
	`‰ì
(
nfsfh
);

935 
	`cb
(0, 
nfs
, 
NULL
, 
¥iv©e_d©a
);

937 
	}
};

946 
	$nfs_f°©_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

948 
nfs_cb_d©a
 *
d©a
;

950 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

951 i‡(
d©a
 =
NULL
) {

952 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅoállocateÇfs_cb_data structure");

953 
	`¥ötf
("failedÅoállocate memory forÇfs cb data\n");

954 
	`‰ì_nfs_cb_d©a
(
d©a
);

957 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

958 
d©a
->
nfs
 =Çfs;

959 
d©a
->
cb
 = cb;

960 
d©a
->
¥iv©e_d©a
 =Örivate_data;

962 i‡(
	`Ωc_nfs_gë©å_async
(
nfs
->
Ωc
, 
nfs_°©_1_cb
, &
nfsfh
->
fh
, 
d©a
) != 0) {

963 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd STAT GETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

964 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

965 
	`‰ì_nfs_cb_d©a
(
d©a
);

969 
	}
}

976 
	$nfs_fsync_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

978 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

979 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

980 
COMMIT3ªs
 *
ªs
;

982 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

983 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

984 
	`‰ì_nfs_cb_d©a
(
d©a
);

987 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

988 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

989 
	`‰ì_nfs_cb_d©a
(
d©a
);

993 
ªs
 = 
comm™d_d©a
;

994 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

995 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: Commô faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

996 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

997 
	`‰ì_nfs_cb_d©a
(
d©a
);

1001 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1002 
	`‰ì_nfs_cb_d©a
(
d©a
);

1003 
	}
}

1005 
	$nfs_fsync_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1007 
nfs_cb_d©a
 *
d©a
;

1009 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

1010 i‡(
d©a
 =
NULL
) {

1011 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅoállocateÇfs_cb_data structure");

1012 
	`¥ötf
("failedÅoállocate memory forÇfs cb data\n");

1013 
	`‰ì_nfs_cb_d©a
(
d©a
);

1016 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

1017 
d©a
->
nfs
 =Çfs;

1018 
d©a
->
cb
 = cb;

1019 
d©a
->
¥iv©e_d©a
 =Örivate_data;

1021 i‡(
	`Ωc_nfs_commô_async
(
nfs
->
Ωc
, 
nfs_fsync_cb
, &
nfsfh
->
fh
, 
d©a
) != 0) {

1022 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd COMMIT cÆ»f‹ %s", 
d©a
->
∑th
);

1023 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1024 
	`‰ì_nfs_cb_d©a
(
d©a
);

1028 
	}
}

1036 
	$nfs_·runˇã_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1038 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1039 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1040 
SETATTR3ªs
 *
ªs
;

1042 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1043 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1044 
	`‰ì_nfs_cb_d©a
(
d©a
);

1047 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1048 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1049 
	`‰ì_nfs_cb_d©a
(
d©a
);

1053 
ªs
 = 
comm™d_d©a
;

1054 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1055 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: Së©å faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1056 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1057 
	`‰ì_nfs_cb_d©a
(
d©a
);

1061 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1062 
	`‰ì_nfs_cb_d©a
(
d©a
);

1063 
	}
}

1065 
	$nfs_·runˇã_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
Àngth
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1067 
nfs_cb_d©a
 *
d©a
;

1068 
SETATTR3¨gs
 
¨gs
;

1070 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

1071 i‡(
d©a
 =
NULL
) {

1072 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory: failedÅoállocateÇfs_cb_data structure");

1073 
	`¥ötf
("failedÅoállocate memory forÇfs cb data\n");

1074 
	`‰ì_nfs_cb_d©a
(
d©a
);

1077 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

1078 
d©a
->
nfs
 =Çfs;

1079 
d©a
->
cb
 = cb;

1080 
d©a
->
¥iv©e_d©a
 =Örivate_data;

1082 
	`bzîo
(&
¨gs
, (
SETATTR3¨gs
));

1083 
¨gs
.
obje˘
.
d©a
.
d©a_Àn
 = 
nfsfh
->
fh
.data.data_len;

1084 
¨gs
.
obje˘
.
d©a
.
d©a_vÆ
 = 
nfsfh
->
fh
.data.data_val;

1085 
¨gs
.
√w_©åibuãs
.
size
.
£t_ô
 = 1;

1086 
¨gs
.
√w_©åibuãs
.
size
.
£t_size3_u
.sizê
Àngth
;

1088 i‡(
	`Ωc_nfs_£èâr_async
(
nfs
->
Ωc
, 
nfs_·runˇã_cb
, &
¨gs
, 
d©a
) != 0) {

1089 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd SETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

1090 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1091 
	`‰ì_nfs_cb_d©a
(
d©a
);

1095 
	}
}

1101 
	$nfs_åunˇã_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1103 
nfs_off_t
 
off£t
 = 
d©a
->
c⁄töue_öt
;

1104 
nfsfh
Çfsfh;

1106 
nfsfh
.
fh
.
d©a
.
d©a_vÆ
 = data->fh.data.data_val;

1107 
nfsfh
.
fh
.
d©a
.
d©a_Àn
 = data->fh.data.data_len;

1109 i‡(
	`nfs_·runˇã_async
(
nfs
, &
nfsfh
, 
off£t
, 
d©a
->
cb
, d©a->
¥iv©e_d©a
) != 0) {

1110 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd SETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

1111 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1112 
	`‰ì_nfs_cb_d©a
(
d©a
);

1115 
	`‰ì_nfs_cb_d©a
(
d©a
);

1117 
	}
}

1119 
	$nfs_åunˇã_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_off_t
 
Àngth
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1121 
nfs_off_t
 
off£t
;

1123 
off£t
 = 
Àngth
;

1125 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_åunˇã_c⁄töue_öã∫Æ
, 
NULL
, NULL, 
off£t
) != 0) {

1126 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1131 
	}
}

1139 
	$nfs_mkdú_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1141 
MKDIR3ªs
 *
ªs
;

1142 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1143 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1144 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1146 
°r
 = &°r[
	`°æí
(str) + 1];

1148 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1149 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1150 
	`‰ì_nfs_cb_d©a
(
d©a
);

1153 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1154 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1155 
	`‰ì_nfs_cb_d©a
(
d©a
);

1159 
ªs
 = 
comm™d_d©a
;

1160 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1161 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: MKDIR o‡%s/%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
°r
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1162 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1163 
	`‰ì_nfs_cb_d©a
(
d©a
);

1167 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1168 
	`‰ì_nfs_cb_d©a
(
d©a
);

1169 
	}
}

1171 
	$nfs_mkdú_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1173 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1175 
°r
 = &°r[
	`°æí
(str) + 1];

1177 i‡(
	`Ωc_nfs_mkdú_async
(
nfs
->
Ωc
, 
nfs_mkdú_cb
, &
d©a
->
fh
, 
°r
, data) != 0) {

1178 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd MKDIR cÆ»f‹ %s", 
d©a
->
∑th
);

1179 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1180 
	`‰ì_nfs_cb_d©a
(
d©a
);

1184 
	}
}

1186 
	$nfs_mkdú_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1188 *
√w_∑th
;

1189 *
±r
;

1191 
√w_∑th
 = 
	`°rdup
(
∑th
);

1192 i‡(
√w_∑th
 =
NULL
) {

1193 
	`¥ötf
("Out of memory, failedÅoállocate mode buffer forÖath\n");

1197 
±r
 = 
	`rödex
(
√w_∑th
, '/');

1198 i‡(
±r
 =
NULL
) {

1199 
	`¥ötf
("InvÆidÖ©h %s\n", 
∑th
);

1202 *
±r
 = 0;

1205 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
√w_∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_mkdú_c⁄töue_öã∫Æ
,Çew_∑th, 
‰ì
, 0) != 0) {

1206 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1211 
	}
}

1220 
	$nfs_rmdú_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1222 
RMDIR3ªs
 *
ªs
;

1223 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1224 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1225 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1227 
°r
 = &°r[
	`°æí
(str) + 1];

1229 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1230 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1231 
	`‰ì_nfs_cb_d©a
(
d©a
);

1234 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1235 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1236 
	`‰ì_nfs_cb_d©a
(
d©a
);

1240 
ªs
 = 
comm™d_d©a
;

1241 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1242 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: RMDIR o‡%s/%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
°r
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1243 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1244 
	`‰ì_nfs_cb_d©a
(
d©a
);

1248 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1249 
	`‰ì_nfs_cb_d©a
(
d©a
);

1250 
	}
}

1252 
	$nfs_rmdú_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1254 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1256 
°r
 = &°r[
	`°æí
(str) + 1];

1258 i‡(
	`Ωc_nfs_rmdú_async
(
nfs
->
Ωc
, 
nfs_rmdú_cb
, &
d©a
->
fh
, 
°r
, data) != 0) {

1259 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd RMDIR cÆ»f‹ %s", 
d©a
->
∑th
);

1260 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1261 
	`‰ì_nfs_cb_d©a
(
d©a
);

1265 
	}
}

1267 
	$nfs_rmdú_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1269 *
√w_∑th
;

1270 *
±r
;

1272 
√w_∑th
 = 
	`°rdup
(
∑th
);

1273 i‡(
√w_∑th
 =
NULL
) {

1274 
	`¥ötf
("Out of memory, failedÅoállocate mode buffer forÖath\n");

1278 
±r
 = 
	`rödex
(
√w_∑th
, '/');

1279 i‡(
±r
 =
NULL
) {

1280 
	`¥ötf
("InvÆidÖ©h %s\n", 
∑th
);

1283 *
±r
 = 0;

1286 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
√w_∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_rmdú_c⁄töue_öã∫Æ
,Çew_∑th, 
‰ì
, 0) != 0) {

1287 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1292 
	}
}

1300 
	$nfs_¸óã_2_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1302 
LOOKUP3ªs
 *
ªs
;

1303 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1304 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1305 
nfsfh
 *nfsfh;

1306 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1308 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1309 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1310 
	`‰ì_nfs_cb_d©a
(
d©a
);

1313 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1314 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1315 
	`‰ì_nfs_cb_d©a
(
d©a
);

1319 
°r
 = &°r[
	`°æí
(str) + 1];

1320 
ªs
 = 
comm™d_d©a
;

1321 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1322 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: CREATE o‡%s/%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
°r
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1323 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1328 
nfsfh
 = 
	`mÆloc
((nfsfh));

1329 i‡(
nfsfh
 =
NULL
) {

1330 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: FailedÅoállocateÇfsfh structure");

1331 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1332 
	`‰ì_nfs_cb_d©a
(
d©a
);

1335 
	`bzîo
(
nfsfh
, (nfsfh));

1338 
nfsfh
->
fh
.
d©a
.
d©a_Àn
 = data->fh.data.data_len;

1339 
nfsfh
->
fh
.
d©a
.
d©a_vÆ
 = data->fh.data.data_val;

1340 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

1342 
d©a
->
	`cb
(0, 
nfs
, 
nfsfh
, d©a->
¥iv©e_d©a
);

1343 
	`‰ì_nfs_cb_d©a
(
d©a
);

1344 
	}
}

1348 
	$nfs_¸ót_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1350 
CREATE3ªs
 *
ªs
;

1351 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1352 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1353 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1355 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1356 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1357 
	`‰ì_nfs_cb_d©a
(
d©a
);

1360 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1361 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1362 
	`‰ì_nfs_cb_d©a
(
d©a
);

1366 
°r
 = &°r[
	`°æí
(str) + 1];

1367 
ªs
 = 
comm™d_d©a
;

1368 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1369 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: CREATE o‡%s/%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
°r
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1370 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1375 i‡(
	`Ωc_nfs_lookup_async
(
nfs
->
Ωc
, 
nfs_¸óã_2_cb
, &
d©a
->
fh
, 
°r
, data) != 0) {

1376 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£ndÜooku∞ˇŒ f‹ %s/%s", 
d©a
->
ßved_∑th
, 
°r
);

1377 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1378 
	`‰ì_nfs_cb_d©a
(
d©a
);

1382 
	}
}

1384 
	$nfs_¸ót_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1386 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1388 
°r
 = &°r[
	`°æí
(str) + 1];

1390 i‡(
	`Ωc_nfs_¸óã_async
(
nfs
->
Ωc
, 
nfs_¸ót_1_cb
, &
d©a
->
fh
, 
°r
, d©a->
c⁄töue_öt
, data) != 0) {

1391 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd CREATE cÆ»f‹ %s/%s", 
d©a
->
∑th
, 
°r
);

1392 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1393 
	`‰ì_nfs_cb_d©a
(
d©a
);

1397 
	}
}

1399 
	$nfs_¸ót_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1401 *
√w_∑th
;

1402 *
±r
;

1404 
√w_∑th
 = 
	`°rdup
(
∑th
);

1405 i‡(
√w_∑th
 =
NULL
) {

1406 
	`¥ötf
("Out of memory, failedÅoállocate mode buffer forÖath\n");

1410 
±r
 = 
	`rödex
(
√w_∑th
, '/');

1411 i‡(
±r
 =
NULL
) {

1412 
	`¥ötf
("InvÆidÖ©h %s\n", 
∑th
);

1415 *
±r
 = 0;

1418 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
√w_∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_¸ót_c⁄töue_öã∫Æ
,Çew_∑th, 
‰ì
, 
mode
) != 0) {

1419 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1424 
	}
}

1432 
	$nfs_u∆ök_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1434 
REMOVE3ªs
 *
ªs
;

1435 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1436 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1437 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1439 
°r
 = &°r[
	`°æí
(str) + 1];

1441 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1442 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1443 
	`‰ì_nfs_cb_d©a
(
d©a
);

1446 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1447 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1448 
	`‰ì_nfs_cb_d©a
(
d©a
);

1452 
ªs
 = 
comm™d_d©a
;

1453 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1454 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: REMOVE o‡%s/%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
°r
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1455 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1456 
	`‰ì_nfs_cb_d©a
(
d©a
);

1460 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1461 
	`‰ì_nfs_cb_d©a
(
d©a
);

1462 
	}
}

1464 
	$nfs_u∆ök_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1466 *
°r
 = 
d©a
->
c⁄töue_d©a
;

1468 
°r
 = &°r[
	`°æí
(str) + 1];

1470 i‡(
	`Ωc_nfs_ªmove_async
(
nfs
->
Ωc
, 
nfs_u∆ök_cb
, &
d©a
->
fh
, 
°r
, data) != 0) {

1471 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd REMOVE cÆ»f‹ %s", 
d©a
->
∑th
);

1472 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1473 
	`‰ì_nfs_cb_d©a
(
d©a
);

1477 
	}
}

1479 
	$nfs_u∆ök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1481 *
√w_∑th
;

1482 *
±r
;

1484 
√w_∑th
 = 
	`°rdup
(
∑th
);

1485 i‡(
√w_∑th
 =
NULL
) {

1486 
	`¥ötf
("Out of memory, failedÅoállocate mode buffer forÖath\n");

1490 
±r
 = 
	`rödex
(
√w_∑th
, '/');

1491 i‡(
±r
 =
NULL
) {

1492 
	`¥ötf
("InvÆidÖ©h %s\n", 
∑th
);

1495 *
±r
 = 0;

1498 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
√w_∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_u∆ök_c⁄töue_öã∫Æ
,Çew_∑th, 
‰ì
, 0) != 0) {

1499 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1504 
	}
}

1513 
	$nfs_›ídú_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1515 
READDIR3ªs
 *
ªs
;

1516 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1517 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1518 
nfsdú
 *nfsdú = 
d©a
->
c⁄töue_d©a
;;

1519 
íåy3
 *
íåy
;

1520 
uöt64_t
 
cookõ
;

1522 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1523 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1524 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1525 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1526 
	`‰ì_nfs_cb_d©a
(
d©a
);

1529 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1530 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1531 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1532 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1533 
	`‰ì_nfs_cb_d©a
(
d©a
);

1537 
ªs
 = 
comm™d_d©a
;

1538 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1539 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: READDIR o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1540 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1541 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1542 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1543 
	`‰ì_nfs_cb_d©a
(
d©a
);

1547 
íåy
 =
ªs
->
READDIR3ªs_u
.
ªsok
.
ª∂y
.
íåõs
;

1548 
íåy
 !
NULL
) {

1549 
nfsdúít
 *nfsdirent;

1551 
nfsdúít
 = 
	`mÆloc
((nfsdirent));

1552 i‡(
nfsdúít
 =
NULL
) {

1553 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, "FaûedÅÿÆloˇã dúít", d©a->
¥iv©e_d©a
);

1554 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1555 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1556 
	`‰ì_nfs_cb_d©a
(
d©a
);

1559 
	`bzîo
(
nfsdúít
, (nfsdirent));

1560 
nfsdúít
->
«me
 = 
	`°rdup
(
íåy
->name);

1561 i‡(
nfsdúít
->
«me
 =
NULL
) {

1562 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, "FaûedÅÿÆloˇã dúít->«me", d©a->
¥iv©e_d©a
);

1563 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1564 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1565 
	`‰ì_nfs_cb_d©a
(
d©a
);

1568 
nfsdúít
->
öode
 = 
íåy
->
fûeid
;

1569 
nfsdúít
->
√xt
 = 
nfsdú
->
íåõs
;

1570 
nfsdú
->
íåõs
 = 
nfsdúít
;

1572 
cookõ
 = 
íåy
->cookie;

1573 
íåy
 =É¡ry->
√xã¡ry
;

1576 i‡(
ªs
->
READDIR3ªs_u
.
ªsok
.
ª∂y
.
eof
 == 0) {

1577 i‡(
	`Ωc_nfs_ªaddú_async
(
nfs
->
Ωc
, 
nfs_›ídú_cb
, &
d©a
->
fh
, 
cookõ
, 
ªs
->
READDIR3ªs_u
.
ªsok
.
cookõvîf
, 20000, data) != 0) {

1578 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd READDIR cÆ»f‹ %s", 
d©a
->
∑th
);

1579 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1580 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1581 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1582 
	`‰ì_nfs_cb_d©a
(
d©a
);

1589 
d©a
->
c⁄töue_d©a
 = 
NULL
;

1590 
nfsdú
->
cuºít
 =Çfsdú->
íåõs
;

1592 
d©a
->
	`cb
(0, 
nfs
, 
nfsdú
, d©a->
¥iv©e_d©a
);

1593 
	`‰ì_nfs_cb_d©a
(
d©a
);

1594 
	}
}

1596 
	$nfs_›ídú_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1598 
cookõvîf3
 
cv
;

1600 
	`bzîo
(
cv
, (
cookõvîf3
));

1601 i‡(
	`Ωc_nfs_ªaddú_async
(
nfs
->
Ωc
, 
nfs_›ídú_cb
, &
d©a
->
fh
, 0, (*)&
cv
, 20000, data) != 0) {

1602 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd READDIR cÆ»f‹ %s", 
d©a
->
∑th
);

1603 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1604 
	`‰ì_nfs_cb_d©a
(
d©a
);

1608 
	}
}

1610 
	$nfs_›ídú_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1612 
nfsdú
 *nfsdir;

1614 
nfsdú
 = 
	`mÆloc
((nfsdir));

1615 i‡(
nfsdú
 =
NULL
) {

1616 
	`¥ötf
("failedÅoállocate buffer forÇfsdir\n");

1619 
	`bzîo
(
nfsdú
, (nfsdir));

1621 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_›ídú_c⁄töue_öã∫Æ
, 
nfsdú
, 
‰ì
, 0) != 0) {

1622 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1627 
	}
}

1630 
nfsdúít
 *
	$nfs_ªaddú
(
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, 
nfsdú
 *nfsdir)

1632 
nfsdúít
 *nfsdúíà
nfsdú
->
cuºít
;

1634 i‡(
nfsdú
->
cuºít
 !
NULL
) {

1635 
nfsdú
->
cuºít
 =Çfsdú->cuºít->
√xt
;

1637  
nfsdúít
;

1638 
	}
}

1641 
	$nfs_˛o£dú
(
nfs_c⁄ãxt
 *
nfs
 
UNUSED
, 
nfsdú
 *nfsdir)

1643 
	`nfs_‰ì_nfsdú
(
nfsdú
);

1644 
	}
}

1655 
	sl£ek_cb_d©a
 {

1656 
nfs_c⁄ãxt
 *
	mnfs
;

1657 
nfsfh
 *
	mnfsfh
;

1658 
nfs_off_t
 
	moff£t
;

1659 
nfs_cb
 
	mcb
;

1660 *
	m¥iv©e_d©a
;

1663 
	$nfs_l£ek_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1665 
GETATTR3ªs
 *
ªs
;

1666 
l£ek_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1667 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1669 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1670 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1671 
	`‰ì
(
d©a
);

1674 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1675 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1676 
	`‰ì
(
d©a
);

1680 
ªs
 = 
comm™d_d©a
;

1681 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1682 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: GETATTR faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1683 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1684 
	`‰ì
(
d©a
);

1688 
d©a
->
nfsfh
->
off£t
 = d©a->off£à+ 
ªs
->
GETATTR3ªs_u
.
ªsok
.
obj_©åibuãs
.
size
;

1689 
d©a
->
	`cb
(0, 
nfs
, &d©a->
nfsfh
->
off£t
, d©a->
¥iv©e_d©a
);

1690 
	`‰ì
(
d©a
);

1691 
	}
}

1693 
	$nfs_l£ek_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
whí˚
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1695 
l£ek_cb_d©a
 *
d©a
;

1697 i‡(
whí˚
 =
SEEK_SET
) {

1698 
nfsfh
->
off£t
 = offset;

1699 
	`cb
(0, 
nfs
, &
nfsfh
->
off£t
, 
¥iv©e_d©a
);

1702 i‡(
whí˚
 =
SEEK_CUR
) {

1703 
nfsfh
->
off£t
 += offset;

1704 
	`cb
(0, 
nfs
, &
nfsfh
->
off£t
, 
¥iv©e_d©a
);

1708 
d©a
 = 
	`mÆloc
((
l£ek_cb_d©a
));

1709 i‡(
d©a
 =
NULL
) {

1710 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "Out Of Memory: FailedÅo mallocÜseek cb data");

1714 
d©a
->
nfs
 =Çfs;

1715 
d©a
->
nfsfh
 =Çfsfh;

1716 
d©a
->
off£t
 = offset;

1717 
d©a
->
cb
 = cb;

1718 
d©a
->
¥iv©e_d©a
 =Örivate_data;

1720 i‡(
	`Ωc_nfs_gë©å_async
(
nfs
->
Ωc
, 
nfs_l£ek_1_cb
, &
nfsfh
->
fh
, 
d©a
) != 0) {

1721 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉrror: FailedÅo send LSEEK GETATTR call");

1722 
	`‰ì
(
d©a
);

1726 
	}
}

1734 
	$nfs_°©vfs_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1736 
FSSTAT3ªs
 *
ªs
;

1737 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1738 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1739 
°©vfs
 
svfs
;

1741 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1742 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1743 
	`‰ì_nfs_cb_d©a
(
d©a
);

1746 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1747 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1748 
	`‰ì_nfs_cb_d©a
(
d©a
);

1752 
ªs
 = 
comm™d_d©a
;

1753 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1754 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: FSSTAT o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1755 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1756 
	`‰ì_nfs_cb_d©a
(
d©a
);

1760 
svfs
.
f_bsize
 = 4096;

1761 
svfs
.
f_‰size
 = 4096;

1762 
svfs
.
f_blocks
 = 
ªs
->
FSSTAT3ªs_u
.
ªsok
.
tbyãs
/4096;

1763 
svfs
.
f_b‰ì
 = 
ªs
->
FSSTAT3ªs_u
.
ªsok
.
fbyãs
/4096;

1764 
svfs
.
f_bavaû
 = 
ªs
->
FSSTAT3ªs_u
.
ªsok
.
abyãs
/4096;

1765 
svfs
.
f_fûes
 = 
ªs
->
FSSTAT3ªs_u
.
ªsok
.
tfûes
;

1766 
svfs
.
f_f‰ì
 = 
ªs
->
FSSTAT3ªs_u
.
ªsok
.
ffûes
;

1767 
svfs
.
f_Ávaû
 = 
ªs
->
FSSTAT3ªs_u
.
ªsok
.
afûes
;

1768 
svfs
.
f_fsid
 = 0;

1769 
svfs
.
f_Êag
 = 0;

1770 
svfs
.
f_«memax
 = 256;

1772 
d©a
->
	`cb
(0, 
nfs
, &
svfs
, d©a->
¥iv©e_d©a
);

1773 
	`‰ì_nfs_cb_d©a
(
d©a
);

1774 
	}
}

1776 
	$nfs_°©vfs_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1778 i‡(
	`Ωc_nfs_fs°©_async
(
nfs
->
Ωc
, 
nfs_°©vfs_1_cb
, &
d©a
->
fh
, data) != 0) {

1779 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd FSSTAT cÆ»f‹ %s", 
d©a
->
∑th
);

1780 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1781 
	`‰ì_nfs_cb_d©a
(
d©a
);

1785 
	}
}

1787 
	$nfs_°©vfs_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1789 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_°©vfs_c⁄töue_öã∫Æ
, 
NULL
, NULL, 0) != 0) {

1790 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1795 
	}
}

1803 
	$nfs_ªadlök_1_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1805 
READLINK3ªs
 *
ªs
;

1806 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1807 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1809 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1810 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1811 
	`‰ì_nfs_cb_d©a
(
d©a
);

1814 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1815 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1816 
	`‰ì_nfs_cb_d©a
(
d©a
);

1820 
ªs
 = 
comm™d_d©a
;

1821 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1822 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: READLINK o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1823 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1824 
	`‰ì_nfs_cb_d©a
(
d©a
);

1829 
d©a
->
	`cb
(0, 
nfs
, 
ªs
->
READLINK3ªs_u
.
ªsok
.d©a, d©a->
¥iv©e_d©a
);

1830 
	`‰ì_nfs_cb_d©a
(
d©a
);

1831 
	}
}

1833 
	$nfs_ªadlök_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1835 i‡(
	`Ωc_nfs_ªadlök_async
(
nfs
->
Ωc
, 
nfs_ªadlök_1_cb
, &
d©a
->
fh
, data) != 0) {

1836 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd READLINK cÆ»f‹ %s", 
d©a
->
∑th
);

1837 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1838 
	`‰ì_nfs_cb_d©a
(
d©a
);

1842 
	}
}

1844 
	$nfs_ªadlök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1846 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_ªadlök_c⁄töue_öã∫Æ
, 
NULL
, NULL, 0) != 0) {

1847 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1852 
	}
}

1860 
	$nfs_chmod_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1862 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1863 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1864 
SETATTR3ªs
 *
ªs
;

1866 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1867 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1868 
	`‰ì_nfs_cb_d©a
(
d©a
);

1871 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1872 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1873 
	`‰ì_nfs_cb_d©a
(
d©a
);

1877 
ªs
 = 
comm™d_d©a
;

1878 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1879 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: SETATTR faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1880 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1881 
	`‰ì_nfs_cb_d©a
(
d©a
);

1885 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1886 
	`‰ì_nfs_cb_d©a
(
d©a
);

1887 
	}
}

1889 
	$nfs_chmod_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1891 
SETATTR3¨gs
 
¨gs
;

1893 
	`bzîo
(&
¨gs
, (
SETATTR3¨gs
));

1894 
¨gs
.
obje˘
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

1895 
¨gs
.
obje˘
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

1896 
¨gs
.
√w_©åibuãs
.
mode
.
£t_ô
 = 1;

1897 
¨gs
.
√w_©åibuãs
.
mode
.
£t_mode3_u
.modê
d©a
->
c⁄töue_öt
;

1899 i‡(
	`Ωc_nfs_£èâr_async
(
nfs
->
Ωc
, 
nfs_chmod_cb
, &
¨gs
, 
d©a
) != 0) {

1900 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd SETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

1901 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1902 
	`‰ì_nfs_cb_d©a
(
d©a
);

1906 
	}
}

1909 
	$nfs_chmod_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1911 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_chmod_c⁄töue_öã∫Æ
, 
NULL
, NULL, 
mode
) != 0) {

1912 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

1917 
	}
}

1922 
	$nfs_fchmod_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

1924 
nfs_cb_d©a
 *
d©a
;

1926 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

1927 i‡(
d©a
 =
NULL
) {

1928 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory");

1929 
	`¥ötf
("failedÅoállocate memory forÇfs mount data\n");

1932 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

1933 
d©a
->
nfs
 =Çfs;

1934 
d©a
->
cb
 = cb;

1935 
d©a
->
¥iv©e_d©a
 =Örivate_data;

1936 
d©a
->
c⁄töue_öt
 = 
mode
;

1937 
d©a
->
fh
.d©a.
d©a_Àn
 = 
nfsfh
->fh.data.data_len;

1938 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
	`mÆloc
(d©a->fh.d©a.
d©a_Àn
);

1939 i‡(
d©a
->
fh
.d©a.
d©a_vÆ
 =
NULL
) {

1940 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "Out of memory: FailedÅoállocate fh");

1941 
	`‰ì_nfs_cb_d©a
(
d©a
);

1944 
	`mem˝y
(
d©a
->
fh
.d©a.
d©a_vÆ
, 
nfsfh
->fh.d©a.d©a_vÆ, d©a->fh.d©a.
d©a_Àn
);

1946 i‡(
	`nfs_chmod_c⁄töue_öã∫Æ
(
nfs
, 
d©a
) != 0) {

1947 
	`‰ì_nfs_cb_d©a
(
d©a
);

1952 
	}
}

1959 
	$nfs_chown_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

1961 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

1962 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

1963 
SETATTR3ªs
 *
ªs
;

1965 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

1966 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

1967 
	`‰ì_nfs_cb_d©a
(
d©a
);

1970 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

1971 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

1972 
	`‰ì_nfs_cb_d©a
(
d©a
);

1976 
ªs
 = 
comm™d_d©a
;

1977 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

1978 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: SETATTR faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

1979 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

1980 
	`‰ì_nfs_cb_d©a
(
d©a
);

1984 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

1985 
	`‰ì_nfs_cb_d©a
(
d©a
);

1986 
	}
}

1988 
	snfs_chown_d©a
 {

1989 
uid_t
 
	muid
;

1990 
gid_t
 
	mgid
;

1993 
	$nfs_chown_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

1995 
SETATTR3¨gs
 
¨gs
;

1996 
nfs_chown_d©a
 *
chown_d©a
 = 
d©a
->
c⁄töue_d©a
;

1998 
	`bzîo
(&
¨gs
, (
SETATTR3¨gs
));

1999 
¨gs
.
obje˘
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

2000 
¨gs
.
obje˘
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

2001 i‡(
chown_d©a
->
uid
 !(
uid_t
)-1) {

2002 
¨gs
.
√w_©åibuãs
.
uid
.
£t_ô
 = 1;

2003 
¨gs
.
√w_©åibuãs
.
uid
.
£t_uid3_u
.uid = 
chown_d©a
->uid;

2005 i‡(
chown_d©a
->
gid
 !(
gid_t
)-1) {

2006 
¨gs
.
√w_©åibuãs
.
gid
.
£t_ô
 = 1;

2007 
¨gs
.
√w_©åibuãs
.
gid
.
£t_gid3_u
.gid = 
chown_d©a
->gid;

2010 i‡(
	`Ωc_nfs_£èâr_async
(
nfs
->
Ωc
, 
nfs_chown_cb
, &
¨gs
, 
d©a
) != 0) {

2011 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd SETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

2012 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2013 
	`‰ì_nfs_cb_d©a
(
d©a
);

2017 
	}
}

2020 
	$nfs_chown_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
uid
, 
gid
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2022 
nfs_chown_d©a
 *
chown_d©a
;

2024 
chown_d©a
 = 
	`mÆloc
((
nfs_chown_d©a
));

2025 i‡(
chown_d©a
 =
NULL
) {

2026 
	`¥ötf
("FailedÅoállocate memory for chown data structure\n");

2030 
chown_d©a
->
uid
 = uid;

2031 
chown_d©a
->
gid
 = gid;

2033 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_chown_c⁄töue_öã∫Æ
, 
chown_d©a
, 
‰ì
, 0) != 0) {

2034 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2039 
	}
}

2045 
	$nfs_fchown_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
uid
, 
gid
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2047 
nfs_cb_d©a
 *
d©a
;

2048 
nfs_chown_d©a
 *
chown_d©a
;

2050 
chown_d©a
 = 
	`mÆloc
((
nfs_chown_d©a
));

2051 i‡(
chown_d©a
 =
NULL
) {

2052 
	`¥ötf
("FailedÅoállocate memory for chown data structure\n");

2056 
chown_d©a
->
uid
 = uid;

2057 
chown_d©a
->
gid
 = gid;

2060 
d©a
 = 
	`mÆloc
((
nfs_cb_d©a
));

2061 i‡(
d©a
 =
NULL
) {

2062 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "out of memory");

2063 
	`¥ötf
("failedÅoállocate memory for fchown data\n");

2066 
	`bzîo
(
d©a
, (
nfs_cb_d©a
));

2067 
d©a
->
nfs
 =Çfs;

2068 
d©a
->
cb
 = cb;

2069 
d©a
->
¥iv©e_d©a
 =Örivate_data;

2070 
d©a
->
c⁄töue_d©a
 = 
chown_d©a
;

2071 
d©a
->
fh
.d©a.
d©a_Àn
 = 
nfsfh
->fh.data.data_len;

2072 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
	`mÆloc
(d©a->fh.d©a.
d©a_Àn
);

2073 i‡(
d©a
->
fh
.d©a.
d©a_vÆ
 =
NULL
) {

2074 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "Out of memory: FailedÅoállocate fh");

2075 
	`‰ì_nfs_cb_d©a
(
d©a
);

2078 
	`mem˝y
(
d©a
->
fh
.d©a.
d©a_vÆ
, 
nfsfh
->fh.d©a.d©a_vÆ, d©a->fh.d©a.
d©a_Àn
);

2081 i‡(
	`nfs_chown_c⁄töue_öã∫Æ
(
nfs
, 
d©a
) != 0) {

2082 
	`‰ì_nfs_cb_d©a
(
d©a
);

2087 
	}
}

2096 
	$nfs_utimes_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

2098 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

2099 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

2100 
SETATTR3ªs
 *
ªs
;

2102 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

2103 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

2104 
	`‰ì_nfs_cb_d©a
(
d©a
);

2107 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

2108 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

2109 
	`‰ì_nfs_cb_d©a
(
d©a
);

2113 
ªs
 = 
comm™d_d©a
;

2114 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

2115 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: SETATTR faûed wôh %s(%d)", 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

2116 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2117 
	`‰ì_nfs_cb_d©a
(
d©a
);

2121 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

2122 
	`‰ì_nfs_cb_d©a
(
d©a
);

2123 
	}
}

2125 
	$nfs_utimes_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2127 
SETATTR3¨gs
 
¨gs
;

2128 
timevÆ
 *
utimes_d©a
 = 
d©a
->
c⁄töue_d©a
;

2130 
	`bzîo
(&
¨gs
, (
SETATTR3¨gs
));

2131 
¨gs
.
obje˘
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

2132 
¨gs
.
obje˘
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

2133 i‡(
utimes_d©a
 !
NULL
) {

2134 
¨gs
.
√w_©åibuãs
.
©ime
.
£t_ô
 = 
SET_TO_CLIENT_TIME
;

2135 
¨gs
.
√w_©åibuãs
.
©ime
.
£t_©ime_u
.©ime.
£c⁄ds
 = 
utimes_d©a
[0].
tv_£c
;

2136 
¨gs
.
√w_©åibuãs
.
©ime
.
£t_©ime_u
.©ime.
n£c⁄ds
 = 
utimes_d©a
[0].
tv_u£c
 * 1000;

2137 
¨gs
.
√w_©åibuãs
.
mtime
.
£t_ô
 = 
SET_TO_CLIENT_TIME
;

2138 
¨gs
.
√w_©åibuãs
.
mtime
.
£t_mtime_u
.mtime.
£c⁄ds
 = 
utimes_d©a
[1].
tv_£c
;

2139 
¨gs
.
√w_©åibuãs
.
mtime
.
£t_mtime_u
.mtime.
n£c⁄ds
 = 
utimes_d©a
[1].
tv_u£c
 * 1000;

2141 
¨gs
.
√w_©åibuãs
.
©ime
.
£t_ô
 = 
SET_TO_SERVER_TIME
;

2142 
¨gs
.
√w_©åibuãs
.
mtime
.
£t_ô
 = 
SET_TO_SERVER_TIME
;

2145 i‡(
	`Ωc_nfs_£èâr_async
(
nfs
->
Ωc
, 
nfs_utimes_cb
, &
¨gs
, 
d©a
) != 0) {

2146 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd SETATTR cÆ»f‹ %s", 
d©a
->
∑th
);

2147 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2148 
	`‰ì_nfs_cb_d©a
(
d©a
);

2152 
	}
}

2155 
	$nfs_utimes_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
timevÆ
 *
times
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2157 
timevÆ
 *
√w_times
 = 
NULL
;

2159 i‡(
times
 !
NULL
) {

2160 
√w_times
 = 
	`mÆloc
((
timevÆ
)*2);

2161 i‡(
√w_times
 =
NULL
) {

2162 
	`¥ötf
("FailedÅoállocate memory forÅimeval structure\n");

2166 
	`mem˝y
(
√w_times
, 
times
, (
timevÆ
)*2);

2169 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_utimes_c⁄töue_öã∫Æ
, 
√w_times
, 
‰ì
, 0) != 0) {

2170 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2175 
	}
}

2180 
	$nfs_utime_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
utimbuf
 *
times
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2182 
timevÆ
 *
√w_times
 = 
NULL
;

2184 i‡(
times
 !
NULL
) {

2185 
√w_times
 = 
	`mÆloc
((
timevÆ
)*2);

2186 i‡(
√w_times
 =
NULL
) {

2187 
	`¥ötf
("FailedÅoállocate memory forÅimeval structure\n");

2191 
√w_times
[0].
tv_£c
 = 
times
->
a˘ime
;

2192 
√w_times
[0].
tv_u£c
 = 0;

2193 
√w_times
[1].
tv_£c
 = 
times
->
modtime
;

2194 
√w_times
[1].
tv_u£c
 = 0;

2197 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_utimes_c⁄töue_öã∫Æ
, 
√w_times
, 
‰ì
, 0) != 0) {

2198 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2203 
	}
}

2212 
	$nfs_ac˚ss_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

2214 
ACCESS3ªs
 *
ªs
;

2215 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

2216 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

2217 
nfsmode
 = 0;

2219 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

2220 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

2221 
	`‰ì_nfs_cb_d©a
(
d©a
);

2224 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

2225 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

2226 
	`‰ì_nfs_cb_d©a
(
d©a
);

2230 
ªs
 = 
comm™d_d©a
;

2231 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

2232 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: ACCESS o‡%†Áûed wôh %s(%d)", 
d©a
->
ßved_∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

2233 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2234 
	`‰ì_nfs_cb_d©a
(
d©a
);

2238 i‡(
d©a
->
c⁄töue_öt
 & 
R_OK
) {

2239 
nfsmode
 |
ACCESS3_READ
;

2241 i‡(
d©a
->
c⁄töue_öt
 & 
W_OK
) {

2242 
nfsmode
 |
ACCESS3_MODIFY
;

2244 i‡(
d©a
->
c⁄töue_öt
 & 
X_OK
) {

2245 
nfsmode
 |
ACCESS3_EXECUTE
;

2248 i‡(
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
 !
nfsmode
) {

2249 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: ACCESS denied. Requiredáccess %c%c%c. Allowedáccess %c%c%c",

2250 
nfsmode
&
ACCESS3_READ
?'r':'-',

2251 
nfsmode
&
ACCESS3_MODIFY
?'w':'-',

2252 
nfsmode
&
ACCESS3_EXECUTE
?'x':'-',

2253 
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
&
ACCESS3_READ
?'r':'-',

2254 
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
&
ACCESS3_MODIFY
?'w':'-',

2255 
ªs
->
ACCESS3ªs_u
.
ªsok
.
ac˚ss
&
ACCESS3_EXECUTE
?'x':'-');

2256 
d©a
->
	`cb
(-
EACCES
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2257 
	`‰ì_nfs_cb_d©a
(
d©a
);

2261 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

2262 
	`‰ì_nfs_cb_d©a
(
d©a
);

2263 
	}
}

2265 
	$nfs_ac˚ss_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2267 
nfsmode
 = 0;

2269 i‡(
d©a
->
c⁄töue_öt
 & 
R_OK
) {

2270 
nfsmode
 |
ACCESS3_READ
;

2272 i‡(
d©a
->
c⁄töue_öt
 & 
W_OK
) {

2273 
nfsmode
 |
ACCESS3_MODIFY
;

2275 i‡(
d©a
->
c⁄töue_öt
 & 
X_OK
) {

2276 
nfsmode
 |
ACCESS3_EXECUTE
;

2279 i‡(
	`Ωc_nfs_ac˚ss_async
(
nfs
->
Ωc
, 
nfs_ac˚ss_cb
, &
d©a
->
fh
, 
nfsmode
, data) != 0) {

2280 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd OPEN ACCESS cÆ»f‹ %s", 
d©a
->
∑th
);

2281 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2282 
	`‰ì_nfs_cb_d©a
(
d©a
);

2286 
	}
}

2288 
	$nfs_ac˚ss_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2290 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_ac˚ss_c⁄töue_öã∫Æ
, 
NULL
, NULL, 
mode
) != 0) {

2291 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2296 
	}
}

2303 
	snfs_symlök_d©a
 {

2304 *
	mﬁd∑th
;

2305 *
	m√w∑th∑ª¡
;

2306 *
	m√w∑thobje˘
;

2309 
	$‰ì_nfs_symlök_d©a
(*
mem
)

2311 
nfs_symlök_d©a
 *
d©a
 = 
mem
;

2313 i‡(
d©a
->
ﬁd∑th
 !
NULL
) {

2314 
	`‰ì
(
d©a
->
ﬁd∑th
);

2316 i‡(
d©a
->
√w∑th∑ª¡
 !
NULL
) {

2317 
	`‰ì
(
d©a
->
√w∑th∑ª¡
);

2319 i‡(
d©a
->
√w∑thobje˘
 !
NULL
) {

2320 
	`‰ì
(
d©a
->
√w∑thobje˘
);

2322 
	`‰ì
(
d©a
);

2323 
	}
}

2325 
	$nfs_symlök_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

2327 
SYMLINK3ªs
 *
ªs
;

2328 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

2329 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

2330 
nfs_symlök_d©a
 *
symlök_d©a
 = 
d©a
->
c⁄töue_d©a
;

2332 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

2333 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

2334 
	`‰ì_nfs_cb_d©a
(
d©a
);

2337 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

2338 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

2339 
	`‰ì_nfs_cb_d©a
(
d©a
);

2343 
ªs
 = 
comm™d_d©a
;

2344 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

2345 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: SYMLINK %s/%†-> %†Áûed wôh %s(%d)", 
symlök_d©a
->
√w∑th∑ª¡
, symlök_d©a->
√w∑thobje˘
, symlök_d©a->
ﬁd∑th
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

2346 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2347 
	`‰ì_nfs_cb_d©a
(
d©a
);

2351 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

2352 
	`‰ì_nfs_cb_d©a
(
d©a
);

2353 
	}
}

2355 
	$nfs_symlök_c⁄töue_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2357 
nfs_symlök_d©a
 *
symlök_d©a
 = 
d©a
->
c⁄töue_d©a
;

2359 i‡(
	`Ωc_nfs_symlök_async
(
nfs
->
Ωc
, 
nfs_symlök_cb
, &
d©a
->
fh
, 
symlök_d©a
->
√w∑thobje˘
, symlök_d©a->
ﬁd∑th
, data) != 0) {

2360 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd SYMLINK cÆ»f‹ %s", 
d©a
->
∑th
);

2361 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2362 
	`‰ì_nfs_cb_d©a
(
d©a
);

2366 
	}
}

2368 
	$nfs_symlök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2370 *
±r
;

2371 
nfs_symlök_d©a
 *
symlök_d©a
;

2373 
symlök_d©a
 = 
	`mÆloc
((
nfs_symlök_d©a
));

2374 i‡(
symlök_d©a
 =
NULL
) {

2375 
	`¥ötf
("Out of memory, failedÅoállocate buffer for symlink data\n");

2378 
	`bzîo
(
symlök_d©a
, (
nfs_symlök_d©a
));

2380 
symlök_d©a
->
ﬁd∑th
 = 
	`°rdup
(oldpath);

2381 i‡(
symlök_d©a
->
ﬁd∑th
 =
NULL
) {

2382 
	`¥ötf
("Out of memory, failedÅoállocate buffer for oldpath\n");

2383 
	`‰ì_nfs_symlök_d©a
(
symlök_d©a
);

2387 
symlök_d©a
->
√w∑th∑ª¡
 = 
	`°rdup
(
√w∑th
);

2388 i‡(
symlök_d©a
->
√w∑th∑ª¡
 =
NULL
) {

2389 
	`¥ötf
("Out of memory, failedÅoállocate mode buffer forÇewÖath\n");

2390 
	`‰ì_nfs_symlök_d©a
(
symlök_d©a
);

2394 
±r
 = 
	`rödex
(
symlök_d©a
->
√w∑th∑ª¡
, '/');

2395 i‡(
±r
 =
NULL
) {

2396 
	`¥ötf
("InvÆidÖ©h %s\n", 
ﬁd∑th
);

2397 
	`‰ì_nfs_symlök_d©a
(
symlök_d©a
);

2400 *
±r
 = 0;

2401 
±r
++;

2403 
symlök_d©a
->
√w∑thobje˘
 = 
	`°rdup
(
±r
);

2404 i‡(
symlök_d©a
->
√w∑thobje˘
 =
NULL
) {

2405 
	`¥ötf
("Out of memory, failedÅoállocate mode buffer forÇewÖath\n");

2406 
	`‰ì_nfs_symlök_d©a
(
symlök_d©a
);

2410 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
symlök_d©a
->
√w∑th∑ª¡
, 
cb
, 
¥iv©e_d©a
, 
nfs_symlök_c⁄töue_öã∫Æ
, symlök_d©a, 
‰ì_nfs_symlök_d©a
, 0) != 0) {

2411 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2416 
	}
}

2423 
	snfs_ª«me_d©a
 {

2424 *
	mﬁd∑th
;

2425 *
	mﬁdobje˘
;

2426 
nfs_fh3
 
	mﬁddú
;

2427 *
	m√w∑th
;

2428 *
	m√wobje˘
;

2429 
nfs_fh3
 
	m√wdú
;

2432 
	$‰ì_nfs_ª«me_d©a
(*
mem
)

2434 
nfs_ª«me_d©a
 *
d©a
 = 
mem
;

2436 i‡(
d©a
->
ﬁd∑th
 !
NULL
) {

2437 
	`‰ì
(
d©a
->
ﬁd∑th
);

2439 i‡(
d©a
->
ﬁddú
.d©a.
d©a_vÆ
 !
NULL
) {

2440 
	`‰ì
(
d©a
->
ﬁddú
.d©a.
d©a_vÆ
);

2442 i‡(
d©a
->
√w∑th
 !
NULL
) {

2443 
	`‰ì
(
d©a
->
√w∑th
);

2445 i‡(
d©a
->
√wdú
.d©a.
d©a_vÆ
 !
NULL
) {

2446 
	`‰ì
(
d©a
->
√wdú
.d©a.
d©a_vÆ
);

2448 
	`‰ì
(
d©a
);

2449 
	}
}

2451 
	$nfs_ª«me_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

2453 
RENAME3ªs
 *
ªs
;

2454 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

2455 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

2456 
nfs_ª«me_d©a
 *
ª«me_d©a
 = 
d©a
->
c⁄töue_d©a
;

2458 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

2459 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

2460 
	`‰ì_nfs_cb_d©a
(
d©a
);

2463 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

2464 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

2465 
	`‰ì_nfs_cb_d©a
(
d©a
);

2469 
ªs
 = 
comm™d_d©a
;

2470 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

2471 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: RENAME %s/%†-> %s/%†Áûed wôh %s(%d)", 
ª«me_d©a
->
ﬁd∑th
,Ñíame_d©a->
ﬁdobje˘
,Ñíame_d©a->
√w∑th
,Ñíame_d©a->
√wobje˘
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

2472 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2473 
	`‰ì_nfs_cb_d©a
(
d©a
);

2477 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

2478 
	`‰ì_nfs_cb_d©a
(
d©a
);

2479 
	}
}

2481 
	$nfs_ª«me_c⁄töue_2_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2483 
nfs_ª«me_d©a
 *
ª«me_d©a
 = 
d©a
->
c⁄töue_d©a
;

2486 
ª«me_d©a
->
√wdú
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

2487 
ª«me_d©a
->
√wdú
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

2488 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

2490 i‡(
	`Ωc_nfs_ª«me_async
(
nfs
->
Ωc
, 
nfs_ª«me_cb
, &
ª«me_d©a
->
ﬁddú
,Ñíame_d©a->
ﬁdobje˘
, &ª«me_d©a->
√wdú
,Ñíame_d©a->
√wobje˘
, 
d©a
) != 0) {

2491 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd RENAME cÆ»f‹ %s", 
d©a
->
∑th
);

2492 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2493 
	`‰ì_nfs_cb_d©a
(
d©a
);

2497 
	}
}

2500 
	$nfs_ª«me_c⁄töue_1_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2502 
nfs_ª«me_d©a
 *
ª«me_d©a
 = 
d©a
->
c⁄töue_d©a
;

2505 
ª«me_d©a
->
ﬁddú
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

2506 
ª«me_d©a
->
ﬁddú
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

2507 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

2509 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
ª«me_d©a
->
√w∑th
, 
d©a
->
cb
, d©a->
¥iv©e_d©a
, 
nfs_ª«me_c⁄töue_2_öã∫Æ
,Ñíame_d©a, 
‰ì_nfs_ª«me_d©a
, 0) != 0) {

2510 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd LOOKUP cÆ»f‹ %s", 
ª«me_d©a
->
√w∑th
);

2511 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2512 
	`‰ì_nfs_cb_d©a
(
d©a
);

2515 
d©a
->
c⁄töue_d©a
 = 
NULL
;

2516 
	`‰ì_nfs_cb_d©a
(
d©a
);

2519 
	}
}

2522 
	$nfs_ª«me_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2524 *
±r
;

2525 
nfs_ª«me_d©a
 *
ª«me_d©a
;

2527 
ª«me_d©a
 = 
	`mÆloc
((
nfs_ª«me_d©a
));

2528 i‡(
ª«me_d©a
 =
NULL
) {

2529 
	`¥ötf
("Out of memory, failedÅoállocate buffer forÑename data\n");

2532 
	`bzîo
(
ª«me_d©a
, (
nfs_ª«me_d©a
));

2534 
ª«me_d©a
->
ﬁd∑th
 = 
	`°rdup
(oldpath);

2535 i‡(
ª«me_d©a
->
ﬁd∑th
 =
NULL
) {

2536 
	`¥ötf
("Out of memory, failedÅoállocate buffer for oldpath\n");

2537 
	`‰ì_nfs_ª«me_d©a
(
ª«me_d©a
);

2540 
±r
 = 
	`rödex
(
ª«me_d©a
->
ﬁd∑th
, '/');

2541 i‡(
±r
 =
NULL
) {

2542 
	`¥ötf
("InvÆidÖ©h %s\n", 
ﬁd∑th
);

2543 
	`‰ì_nfs_ª«me_d©a
(
ª«me_d©a
);

2546 *
±r
 = 0;

2547 
±r
++;

2548 
ª«me_d©a
->
ﬁdobje˘
 = 
±r
;

2551 
ª«me_d©a
->
√w∑th
 = 
	`°rdup
(newpath);

2552 i‡(
ª«me_d©a
->
√w∑th
 =
NULL
) {

2553 
	`¥ötf
("Out of memory, failedÅoállocate buffer forÇewpath\n");

2554 
	`‰ì_nfs_ª«me_d©a
(
ª«me_d©a
);

2557 
±r
 = 
	`rödex
(
ª«me_d©a
->
√w∑th
, '/');

2558 i‡(
±r
 =
NULL
) {

2559 
	`¥ötf
("InvÆidÖ©h %s\n", 
√w∑th
);

2560 
	`‰ì_nfs_ª«me_d©a
(
ª«me_d©a
);

2563 *
±r
 = 0;

2564 
±r
++;

2565 
ª«me_d©a
->
√wobje˘
 = 
±r
;

2568 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
ª«me_d©a
->
ﬁd∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_ª«me_c⁄töue_1_öã∫Æ
,Ñíame_d©a, 
‰ì_nfs_ª«me_d©a
, 0) != 0) {

2569 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2574 
	}
}

2580 
	snfs_lök_d©a
 {

2581 *
	mﬁd∑th
;

2582 
nfs_fh3
 
	mﬁdfh
;

2583 *
	m√w∑th
;

2584 *
	m√wobje˘
;

2585 
nfs_fh3
 
	m√wdú
;

2588 
	$‰ì_nfs_lök_d©a
(*
mem
)

2590 
nfs_lök_d©a
 *
d©a
 = 
mem
;

2592 i‡(
d©a
->
ﬁd∑th
 !
NULL
) {

2593 
	`‰ì
(
d©a
->
ﬁd∑th
);

2595 i‡(
d©a
->
ﬁdfh
.d©a.
d©a_vÆ
 !
NULL
) {

2596 
	`‰ì
(
d©a
->
ﬁdfh
.d©a.
d©a_vÆ
);

2598 i‡(
d©a
->
√w∑th
 !
NULL
) {

2599 
	`‰ì
(
d©a
->
√w∑th
);

2601 i‡(
d©a
->
√wdú
.d©a.
d©a_vÆ
 !
NULL
) {

2602 
	`‰ì
(
d©a
->
√wdú
.d©a.
d©a_vÆ
);

2604 
	`‰ì
(
d©a
);

2605 
	}
}

2607 
	$nfs_lök_cb
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
°©us
, *
comm™d_d©a
, *
¥iv©e_d©a
)

2609 
LINK3ªs
 *
ªs
;

2610 
nfs_cb_d©a
 *
d©a
 = 
¥iv©e_d©a
;

2611 
nfs_c⁄ãxt
 *
nfs
 = 
d©a
->nfs;

2612 
nfs_lök_d©a
 *
lök_d©a
 = 
d©a
->
c⁄töue_d©a
;

2614 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

2615 
d©a
->
	`cb
(-
EFAULT
, 
nfs
, 
comm™d_d©a
, d©a->
¥iv©e_d©a
);

2616 
	`‰ì_nfs_cb_d©a
(
d©a
);

2619 i‡(
°©us
 =
RPC_STATUS_CANCEL
) {

2620 
d©a
->
	`cb
(-
EINTR
, 
nfs
, "Comm™d wa†ˇn˚Œed", d©a->
¥iv©e_d©a
);

2621 
	`‰ì_nfs_cb_d©a
(
d©a
);

2625 
ªs
 = 
comm™d_d©a
;

2626 i‡(
ªs
->
°©us
 !
NFS3_OK
) {

2627 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "NFS: LINK %†-> %s/%†Áûed wôh %s(%d)", 
lök_d©a
->
ﬁd∑th
,Üök_d©a->
√w∑th
,Üök_d©a->
√wobje˘
, 
	`nfs°©3_to_°r
(
ªs
->
°©us
), 
	`nfs°©3_to_î∫o
(res->status));

2628 
d©a
->
	`cb
(
	`nfs°©3_to_î∫o
(
ªs
->
°©us
), 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2629 
	`‰ì_nfs_cb_d©a
(
d©a
);

2633 
d©a
->
	`cb
(0, 
nfs
, 
NULL
, d©a->
¥iv©e_d©a
);

2634 
	`‰ì_nfs_cb_d©a
(
d©a
);

2635 
	}
}

2637 
	$nfs_lök_c⁄töue_2_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2639 
nfs_lök_d©a
 *
lök_d©a
 = 
d©a
->
c⁄töue_d©a
;

2642 
lök_d©a
->
√wdú
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

2643 
lök_d©a
->
√wdú
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

2644 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

2646 i‡(
	`Ωc_nfs_lök_async
(
nfs
->
Ωc
, 
nfs_lök_cb
, &
lök_d©a
->
ﬁdfh
, &lök_d©a->
√wdú
,Üök_d©a->
√wobje˘
, 
d©a
) != 0) {

2647 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd LINK cÆ»f‹ %s", 
d©a
->
∑th
);

2648 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2649 
	`‰ì_nfs_cb_d©a
(
d©a
);

2653 
	}
}

2656 
	$nfs_lök_c⁄töue_1_öã∫Æ
(
nfs_c⁄ãxt
 *
nfs
, 
nfs_cb_d©a
 *
d©a
)

2658 
nfs_lök_d©a
 *
lök_d©a
 = 
d©a
->
c⁄töue_d©a
;

2661 
lök_d©a
->
ﬁdfh
.
d©a
.
d©a_Àn
 = d©a->
fh
.data.data_len;

2662 
lök_d©a
->
ﬁdfh
.
d©a
.
d©a_vÆ
 = d©a->
fh
.data.data_val;

2663 
d©a
->
fh
.d©a.
d©a_vÆ
 = 
NULL
;

2665 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
lök_d©a
->
√w∑th
, 
d©a
->
cb
, d©a->
¥iv©e_d©a
, 
nfs_lök_c⁄töue_2_öã∫Æ
,Üök_d©a, 
‰ì_nfs_lök_d©a
, 0) != 0) {

2666 
	`Ωc_£t_îr‹
(
nfs
->
Ωc
, "RPCÉº‹: FaûedÅÿ£nd LOOKUP cÆ»f‹ %s", 
lök_d©a
->
√w∑th
);

2667 
d©a
->
	`cb
(-
ENOMEM
, 
nfs
, 
	`Ωc_gë_îr‹
“fs->
Ωc
), d©a->
¥iv©e_d©a
);

2668 
	`‰ì_nfs_cb_d©a
(
d©a
);

2671 
d©a
->
c⁄töue_d©a
 = 
NULL
;

2672 
	`‰ì_nfs_cb_d©a
(
d©a
);

2675 
	}
}

2678 
	$nfs_lök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
)

2680 *
±r
;

2681 
nfs_lök_d©a
 *
lök_d©a
;

2683 
lök_d©a
 = 
	`mÆloc
((
nfs_lök_d©a
));

2684 i‡(
lök_d©a
 =
NULL
) {

2685 
	`¥ötf
("Out of memory, failedÅoállocate buffer forÜink data\n");

2688 
	`bzîo
(
lök_d©a
, (
nfs_lök_d©a
));

2690 
lök_d©a
->
ﬁd∑th
 = 
	`°rdup
(oldpath);

2691 i‡(
lök_d©a
->
ﬁd∑th
 =
NULL
) {

2692 
	`¥ötf
("Out of memory, failedÅoállocate buffer for oldpath\n");

2693 
	`‰ì_nfs_lök_d©a
(
lök_d©a
);

2697 
lök_d©a
->
√w∑th
 = 
	`°rdup
(newpath);

2698 i‡(
lök_d©a
->
√w∑th
 =
NULL
) {

2699 
	`¥ötf
("Out of memory, failedÅoállocate buffer forÇewpath\n");

2700 
	`‰ì_nfs_lök_d©a
(
lök_d©a
);

2703 
±r
 = 
	`rödex
(
lök_d©a
->
√w∑th
, '/');

2704 i‡(
±r
 =
NULL
) {

2705 
	`¥ötf
("InvÆidÖ©h %s\n", 
√w∑th
);

2706 
	`‰ì_nfs_lök_d©a
(
lök_d©a
);

2709 *
±r
 = 0;

2710 
±r
++;

2711 
lök_d©a
->
√wobje˘
 = 
±r
;

2714 i‡(
	`nfs_lookuµ©h_async
(
nfs
, 
lök_d©a
->
ﬁd∑th
, 
cb
, 
¥iv©e_d©a
, 
nfs_lök_c⁄töue_1_öã∫Æ
,Üök_d©a, 
‰ì_nfs_lök_d©a
, 0) != 0) {

2715 
	`¥ötf
("Out of memory: failedÅo startÖarsingÅheÖath components\n");

2720 
	}
}

2724 
nfs_off_t
 
	$nfs_gë_cuºít_off£t
(
nfsfh
 *nfsfh)

2726  
nfsfh
->
off£t
;

2727 
	}
}

	@ccan/ccan/nfs/mount.c

18 
	~<°dio.h
>

19 
	~<î∫o.h
>

20 
	~<Ωc/xdr.h
>

21 
	~"nfs.h
"

22 
	~"libnfs-øw.h
"

23 
	~"libnfs-¥iv©e.h
"

24 
	~"Ωc/mou¡.h
"

27 
	$Ωc_mou¡_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

29 
Ωc_pdu
 *
pdu
;

31 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
MOUNT3_NULL
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_void
, 0);

32 i‡(
pdu
 =
NULL
) {

33 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu for mount/null call");

37 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

38 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu for mount/null call");

39 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

44 
	}
}

46 
	$Ωc_mou¡_m¡_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
exp‹t
, *
¥iv©e_d©a
)

48 
Ωc_pdu
 *
pdu
;

50 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
MOUNT3_MNT
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_mou¡ªs3
, (
mou¡ªs3
));

51 i‡(
pdu
 =
NULL
) {

52 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu for mount/mnt call");

56 i‡(
	`xdr_dú∑th
(&
pdu
->
xdr
, &
exp‹t
) == 0) {

57 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror. FailedÅoÉncode mount/mnt call");

58 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

62 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

63 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu for mount/mnt call");

64 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

69 
	}
}

71 
	$Ωc_mou¡_dump_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

73 
Ωc_pdu
 *
pdu
;

75 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
MOUNT3_DUMP
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_mou¡li°
, (
mou¡li°
));

76 i‡(
pdu
 =
NULL
) {

77 
	`¥ötf
("FailedÅoállocateÖdu for mount/dump\n");

81 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

82 
	`¥ötf
("FailedÅo queue mount/dumpÖdu\n");

83 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

88 
	}
}

90 
	$Ωc_mou¡_um¡_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
exp‹t
, *
¥iv©e_d©a
)

92 
Ωc_pdu
 *
pdu
;

94 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
MOUNT3_UMNT
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_void
, 0);

95 i‡(
pdu
 =
NULL
) {

96 
	`¥ötf
("FailedÅoállocateÖdu for mount/umnt\n");

100 i‡(
	`xdr_dú∑th
(&
pdu
->
xdr
, &
exp‹t
) == 0) {

101 
	`¥ötf
("failedÅoÉncode dirpath for mount/umnt\n");

102 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

106 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

107 
	`¥ötf
("FailedÅo queue mount/umntÖdu\n");

108 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

113 
	}
}

115 
	$Ωc_mou¡_um¡Æl_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

117 
Ωc_pdu
 *
pdu
;

119 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
MOUNT3_UMNTALL
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_void
, 0);

120 i‡(
pdu
 =
NULL
) {

121 
	`¥ötf
("FailedÅoállocateÖdu for mount/umntall\n");

125 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

126 
	`¥ötf
("FailedÅo queue mount/umntallÖdu\n");

127 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

132 
	}
}

134 
	$Ωc_mou¡_exp‹t_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

136 
Ωc_pdu
 *
pdu
;

138 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
MOUNT3_EXPORT
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_exp‹ts
, (
exp‹ts
));

139 i‡(
pdu
 =
NULL
) {

140 
	`¥ötf
("FailedÅoállocateÖdu for mount/export\n");

144 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

145 
	`¥ötf
("FailedÅo queue mount/exportÖdu\n");

146 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

151 
	}
}

153 *
	$mou¡°©3_to_°r
(
°
)

155 
mou¡°©3
 
°©
 = 
°
;

157 *
°r
 = "unknown mount stat";

158 
°©
) {

159 
MNT3_OK
: 
°r
="MNT3_OK"; ;

160 
MNT3ERR_PERM
: 
°r
="MNT3ERR_PERM"; ;

161 
MNT3ERR_NOENT
: 
°r
="MNT3ERR_NOENT"; ;

162 
MNT3ERR_IO
: 
°r
="MNT3ERR_IO"; ;

163 
MNT3ERR_ACCES
: 
°r
="MNT3ERR_ACCES"; ;

164 
MNT3ERR_NOTDIR
: 
°r
="MNT3ERR_NOTDIR"; ;

165 
MNT3ERR_INVAL
: 
°r
="MNT3ERR_INVAL"; ;

166 
MNT3ERR_NAMETOOLONG
: 
°r
="MNT3ERR_NAMETOOLONG"; ;

167 
MNT3ERR_NOTSUPP
: 
°r
="MNT3ERR_NOTSUPP"; ;

168 
MNT3ERR_SERVERFAULT
: 
°r
="MNT3ERR_SERVERFAULT"; ;

170  
°r
;

171 
	}
}

174 
	$mou¡°©3_to_î∫o
(
°
)

176 
mou¡°©3
 
°©
 = 
°
;

178 
°©
) {

179 
MNT3_OK
:  0; ;

180 
MNT3ERR_PERM
:  -
EPERM
; ;

181 
MNT3ERR_NOENT
:  -
EPERM
; ;

182 
MNT3ERR_IO
:  -
EIO
; ;

183 
MNT3ERR_ACCES
:  -
EACCES
; ;

184 
MNT3ERR_NOTDIR
:  -
ENOTDIR
; ;

185 
MNT3ERR_INVAL
:  -
EINVAL
; ;

186 
MNT3ERR_NAMETOOLONG
:  -
E2BIG
; ;

187 
MNT3ERR_NOTSUPP
:  -
EINVAL
; ;

188 
MNT3ERR_SERVERFAULT
:  -
EIO
; ;

190  -
ERANGE
;

191 
	}
}

	@ccan/ccan/nfs/nfs.c

18 
	~<°dio.h
>

19 
	~<î∫o.h
>

20 
	~<sys/°©.h
>

21 
	~<Ωc/xdr.h
>

22 
	~"nfs.h
"

23 
	~"libnfs-øw.h
"

24 
	~"libnfs-¥iv©e.h
"

25 
	~"Ωc/nfs.h
"

29 *
	$nfs°©3_to_°r
(
îr‹
)

31 
îr‹
) {

32 
NFS3_OK
:  "NFS3_OK"; ;

33 
NFS3ERR_PERM
:  "NFS3ERR_PERM"; ;

34 
NFS3ERR_NOENT
:  "NFS3ERR_NOENT"; ;

35 
NFS3ERR_IO
:  "NFS3ERR_IO"; ;

36 
NFS3ERR_NXIO
:  "NFS3ERR_NXIO"; ;

37 
NFS3ERR_ACCES
:  "NFS3ERR_ACCES"; ;

38 
NFS3ERR_EXIST
:  "NFS3ERR_EXIST"; ;

39 
NFS3ERR_XDEV
:  "NFS3ERR_XDEV"; ;

40 
NFS3ERR_NODEV
:  "NFS3ERR_NODEV"; ;

41 
NFS3ERR_NOTDIR
:  "NFS3ERR_NOTDIR"; ;

42 
NFS3ERR_ISDIR
:  "NFS3ERR_ISDIR"; ;

43 
NFS3ERR_INVAL
:  "NFS3ERR_INVAL"; ;

44 
NFS3ERR_FBIG
:  "NFS3ERR_FBIG"; ;

45 
NFS3ERR_NOSPC
:  "NFS3ERR_NOSPC"; ;

46 
NFS3ERR_ROFS
:  "NFS3ERR_ROFS"; ;

47 
NFS3ERR_MLINK
:  "NFS3ERR_MLINK"; ;

48 
NFS3ERR_NAMETOOLONG
:  "NFS3ERR_NAMETOOLONG"; ;

49 
NFS3ERR_NOTEMPTY
:  "NFS3ERR_NOTEMPTY"; ;

50 
NFS3ERR_DQUOT
:  "NFS3ERR_DQUOT"; ;

51 
NFS3ERR_STALE
:  "NFS3ERR_STALE"; ;

52 
NFS3ERR_REMOTE
:  "NFS3ERR_REMOTE"; ;

53 
NFS3ERR_BADHANDLE
:  "NFS3ERR_BADHANDLE"; ;

54 
NFS3ERR_NOT_SYNC
:  "NFS3ERR_NOT_SYNC"; ;

55 
NFS3ERR_BAD_COOKIE
:  "NFS3ERR_BAD_COOKIE"; ;

56 
NFS3ERR_NOTSUPP
:  "NFS3ERR_NOTSUPP"; ;

57 
NFS3ERR_TOOSMALL
:  "NFS3ERR_TOOSMALL"; ;

58 
NFS3ERR_SERVERFAULT
:  "NFS3ERR_SERVERFAULT"; ;

59 
NFS3ERR_BADTYPE
:  "NFS3ERR_BADTYPE"; ;

60 
NFS3ERR_JUKEBOX
:  "NFS3ERR_JUKEBOX"; ;

63 
	}
}

65 
	$nfs°©3_to_î∫o
(
îr‹
)

67 
îr‹
) {

68 
NFS3_OK
:  0; ;

69 
NFS3ERR_PERM
:  -
EPERM
; ;

70 
NFS3ERR_NOENT
:  -
ENOENT
; ;

71 
NFS3ERR_IO
:  -
EIO
; ;

72 
NFS3ERR_NXIO
:  -
ENXIO
; ;

73 
NFS3ERR_ACCES
:  -
EACCES
; ;

74 
NFS3ERR_EXIST
:  -
EEXIST
; ;

75 
NFS3ERR_XDEV
:  -
EXDEV
; ;

76 
NFS3ERR_NODEV
:  -
ENODEV
; ;

77 
NFS3ERR_NOTDIR
:  -
ENOTDIR
; ;

78 
NFS3ERR_ISDIR
:  -
EISDIR
; ;

79 
NFS3ERR_INVAL
:  -
EINVAL
; ;

80 
NFS3ERR_FBIG
:  -
EFBIG
; ;

81 
NFS3ERR_NOSPC
:  -
ENOSPC
; ;

82 
NFS3ERR_ROFS
:  -
EROFS
; ;

83 
NFS3ERR_MLINK
:  -
EMLINK
; ;

84 
NFS3ERR_NAMETOOLONG
:  -
ENAMETOOLONG
; ;

85 
NFS3ERR_NOTEMPTY
:  -
EEXIST
; ;

86 
NFS3ERR_DQUOT
:  -
ERANGE
; ;

87 
NFS3ERR_STALE
:  -
EIO
; ;

88 
NFS3ERR_REMOTE
:  -
EIO
; ;

89 
NFS3ERR_BADHANDLE
:  -
EIO
; ;

90 
NFS3ERR_NOT_SYNC
:  -
EIO
; ;

91 
NFS3ERR_BAD_COOKIE
:  -
EIO
; ;

92 
NFS3ERR_NOTSUPP
:  -
EINVAL
; ;

93 
NFS3ERR_TOOSMALL
:  -
EIO
; ;

94 
NFS3ERR_SERVERFAULT
:  -
EIO
; ;

95 
NFS3ERR_BADTYPE
:  -
EINVAL
; ;

96 
NFS3ERR_JUKEBOX
:  -
EAGAIN
; ;

98  -
ERANGE
;

99 
	}
}

102 
	$Ωc_nfs_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

104 
Ωc_pdu
 *
pdu
;

106 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_NULL
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_void
, 0);

107 i‡(
pdu
 =
NULL
) {

108 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/null call");

112 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

113 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/null call");

114 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

119 
	}
}

121 
	$Ωc_nfs_gë©å_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
)

123 
Ωc_pdu
 *
pdu
;

124 
GETATTR3¨gs
 
¨gs
;

126 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_GETATTR
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_GETATTR3ªs
, (
GETATTR3ªs
));

127 i‡(
pdu
 =
NULL
) {

128 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/null call");

132 
¨gs
.
obje˘
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

133 
¨gs
.
obje˘
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

135 i‡(
	`xdr_GETATTR3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

136 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode GETATTR3args");

137 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

141 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

142 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/null call");

143 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

148 
	}
}

150 
	$Ωc_nfs_lookup_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
«me
, *
¥iv©e_d©a
)

152 
Ωc_pdu
 *
pdu
;

153 
LOOKUP3¨gs
 
¨gs
;

155 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_LOOKUP
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_LOOKUP3ªs
, (
LOOKUP3ªs
));

156 i‡(
pdu
 =
NULL
) {

157 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/lookup call");

161 
¨gs
.
wh©
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

162 
¨gs
.
wh©
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

163 
¨gs
.
wh©
.
«me
 =Çame;

165 i‡(
	`xdr_LOOKUP3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

166 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode LOOKUP3args");

167 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

171 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

172 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/lookup call");

173 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

178 
	}
}

181 
	$Ωc_nfs_ac˚ss_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, 
ac˚ss
, *
¥iv©e_d©a
)

183 
Ωc_pdu
 *
pdu
;

184 
ACCESS3¨gs
 
¨gs
;

186 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_ACCESS
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_ACCESS3ªs
, (
ACCESS3ªs
));

187 i‡(
pdu
 =
NULL
) {

188 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/access call");

192 
¨gs
.
obje˘
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

193 
¨gs
.
obje˘
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

194 
¨gs
.
ac˚ss
 =áccess;

196 i‡(
	`xdr_ACCESS3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

197 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode ACCESS3args");

198 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

202 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

203 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/access call");

204 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

209 
	}
}

213 
	$Ωc_nfs_ªad_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
¥iv©e_d©a
)

215 
Ωc_pdu
 *
pdu
;

216 
READ3¨gs
 
¨gs
;

218 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_READ
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_READ3ªs
, (
READ3ªs
));

219 i‡(
pdu
 =
NULL
) {

220 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/read call");

224 
¨gs
.
fûe
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

225 
¨gs
.
fûe
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

226 
¨gs
.
off£t
 = offset;

227 
¨gs
.
cou¡
 = count;

229 i‡(
	`xdr_READ3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

230 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode READ3args");

231 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

235 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

236 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/read call");

237 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

242 
	}
}

245 
	$Ωc_nfs_wrôe_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
buf
, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, 
°abÀ_how
, *
¥iv©e_d©a
)

247 
Ωc_pdu
 *
pdu
;

248 
WRITE3¨gs
 
¨gs
;

250 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_WRITE
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_WRITE3ªs
, (
WRITE3ªs
));

251 i‡(
pdu
 =
NULL
) {

252 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/write call");

256 
¨gs
.
fûe
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

257 
¨gs
.
fûe
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

258 
¨gs
.
off£t
 = offset;

259 
¨gs
.
cou¡
 = count;

260 
¨gs
.
°abÀ
 = 
°abÀ_how
;;

261 
¨gs
.
d©a
.
d©a_Àn
 = 
cou¡
;

262 
¨gs
.
d©a
.
d©a_vÆ
 = 
buf
;

264 i‡(
	`xdr_WRITE3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

265 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode WRITE3args");

266 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

270 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

271 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/write call");

272 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

277 
	}
}

281 
	$Ωc_nfs_commô_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
)

283 
Ωc_pdu
 *
pdu
;

284 
COMMIT3¨gs
 
¨gs
;

286 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_COMMIT
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_COMMIT3ªs
, (
COMMIT3ªs
));

287 i‡(
pdu
 =
NULL
) {

288 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/commit call");

292 
¨gs
.
fûe
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

293 
¨gs
.
fûe
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

294 
¨gs
.
off£t
 = 0;

295 
¨gs
.
cou¡
 = 0;

297 i‡(
	`xdr_COMMIT3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

298 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode WRITE3args");

299 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

303 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

304 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/commit call");

305 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

310 
	}
}

313 
	$Ωc_nfs_£èâr_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
SETATTR3¨gs
 *
¨gs
, *
¥iv©e_d©a
)

315 
Ωc_pdu
 *
pdu
;

317 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_SETATTR
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_SETATTR3ªs
, (
SETATTR3ªs
));

318 i‡(
pdu
 =
NULL
) {

319 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/setattr call");

323 i‡(
	`xdr_SETATTR3¨gs
(&
pdu
->
xdr
, 
¨gs
) == 0) {

324 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode SETATTR3args");

325 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

329 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

330 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/setattr call");

331 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

336 
	}
}

340 
	$Ωc_nfs_mkdú_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
dú
, *
¥iv©e_d©a
)

342 
Ωc_pdu
 *
pdu
;

343 
MKDIR3¨gs
 
¨gs
;

345 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_MKDIR
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_MKDIR3ªs
, (
MKDIR3ªs
));

346 i‡(
pdu
 =
NULL
) {

347 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/setattr call");

351 
	`bzîo
(&
¨gs
, (
MKDIR3¨gs
));

352 
¨gs
.
whîe
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

353 
¨gs
.
whîe
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

354 
¨gs
.
whîe
.
«me
 = 
dú
;

355 
¨gs
.
©åibuãs
.
mode
.
£t_ô
 = 1;

356 
¨gs
.
©åibuãs
.
mode
.
£t_mode3_u
.mode = 0755;

358 i‡(
	`xdr_MKDIR3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

359 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode MKDIR3args");

360 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

364 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

365 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/mkdir call");

366 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

371 
	}
}

376 
	$Ωc_nfs_rmdú_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
dú
, *
¥iv©e_d©a
)

378 
Ωc_pdu
 *
pdu
;

379 
RMDIR3¨gs
 
¨gs
;

381 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_RMDIR
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_RMDIR3ªs
, (
RMDIR3ªs
));

382 i‡(
pdu
 =
NULL
) {

383 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/rmdir call");

387 
	`bzîo
(&
¨gs
, (
RMDIR3¨gs
));

388 
¨gs
.
obje˘
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

389 
¨gs
.
obje˘
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

390 
¨gs
.
obje˘
.
«me
 = 
dú
;

392 i‡(
	`xdr_RMDIR3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

393 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode RMDIR3args");

394 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

398 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

399 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/rmdir call");

400 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

405 
	}
}

409 
	$Ωc_nfs_¸óã_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
fûe
, 
mode
, *
¥iv©e_d©a
)

411 
Ωc_pdu
 *
pdu
;

412 
CREATE3¨gs
 
¨gs
;

414 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_CREATE
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_CREATE3ªs
, (
CREATE3ªs
));

415 i‡(
pdu
 =
NULL
) {

416 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/create call");

420 
	`bzîo
(&
¨gs
, (
CREATE3¨gs
));

421 
¨gs
.
whîe
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

422 
¨gs
.
whîe
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

423 
¨gs
.
whîe
.
«me
 = 
fûe
;

424 
¨gs
.
how
.
mode
 = 
UNCHECKED
;

425 
¨gs
.
how
.
¸óãhow3_u
.
obj_©åibuãs
.
mode
.
£t_ô
 = 1;

426 
¨gs
.
how
.
¸óãhow3_u
.
obj_©åibuãs
.
mode
.
£t_mode3_u
.mode = mode;

428 i‡(
	`xdr_CREATE3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

429 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode CREATE3args");

430 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

434 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

435 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/create call");

436 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

441 
	}
}

446 
	$Ωc_nfs_ªmove_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
fûe
, *
¥iv©e_d©a
)

448 
Ωc_pdu
 *
pdu
;

449 
REMOVE3¨gs
 
¨gs
;

451 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_REMOVE
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_REMOVE3ªs
, (
REMOVE3ªs
));

452 i‡(
pdu
 =
NULL
) {

453 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/remove call");

457 
	`bzîo
(&
¨gs
, (
REMOVE3¨gs
));

458 
¨gs
.
obje˘
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

459 
¨gs
.
obje˘
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

460 
¨gs
.
obje˘
.
«me
 = 
fûe
;

462 i‡(
	`xdr_REMOVE3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

463 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode REMOVE3args");

464 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

468 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

469 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/remove call");

470 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

475 
	}
}

478 
	$Ωc_nfs_ªaddú_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, 
uöt64_t
 
cookõ
, *
cookõvîf
, 
cou¡
, *
¥iv©e_d©a
)

480 
Ωc_pdu
 *
pdu
;

481 
READDIR3¨gs
 
¨gs
;

483 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_READDIR
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_READDIR3ªs
, (
READDIR3ªs
));

484 i‡(
pdu
 =
NULL
) {

485 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/readdir call");

489 
	`bzîo
(&
¨gs
, (
READDIR3¨gs
));

490 
¨gs
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

491 
¨gs
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

492 
¨gs
.
cookõ
 = cookie;

493 
	`mem˝y
(&
¨gs
.
cookõvîf
, cookõvîf, (
cookõvîf3
));

494 
¨gs
.
cou¡
 = count;

496 i‡(
	`xdr_READDIR3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

497 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode READDIR3args");

498 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

502 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

503 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/readdir call");

504 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

509 
	}
}

511 
	$Ωc_nfs_fs°©_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
)

513 
Ωc_pdu
 *
pdu
;

514 
FSSTAT3¨gs
 
¨gs
;

516 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_FSSTAT
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_FSSTAT3ªs
, (
FSSTAT3ªs
));

517 i‡(
pdu
 =
NULL
) {

518 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/fsstat call");

522 
¨gs
.
f§oŸ
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

523 
¨gs
.
f§oŸ
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

525 i‡(
	`xdr_FSSTAT3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

526 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode FSSTAT3args");

527 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

531 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

532 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/fsstat call");

533 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

538 
	}
}

541 
	$Ωc_nfs_ªadlök_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
¥iv©e_d©a
)

543 
Ωc_pdu
 *
pdu
;

544 
READLINK3¨gs
 
¨gs
;

546 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_READLINK
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_READLINK3ªs
, (
READLINK3ªs
));

547 i‡(
pdu
 =
NULL
) {

548 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/readlink call");

552 
¨gs
.
symlök
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

553 
¨gs
.
symlök
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

555 i‡(
	`xdr_READLINK3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

556 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode READLINK3args");

557 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

561 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

562 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/readlink call");

563 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

568 
	}
}

571 
	$Ωc_nfs_symlök_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fh
, *
√w«me
, *
ﬁd∑th
, *
¥iv©e_d©a
)

573 
Ωc_pdu
 *
pdu
;

574 
SYMLINK3¨gs
 
¨gs
;

576 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_SYMLINK
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_SYMLINK3ªs
, (
SYMLINK3ªs
));

577 i‡(
pdu
 =
NULL
) {

578 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/symlink call");

582 
	`bzîo
(&
¨gs
, (
SYMLINK3¨gs
));

583 
¨gs
.
whîe
.
dú
.
d©a
.
d©a_Àn
 = 
fh
->data.data_len;

584 
¨gs
.
whîe
.
dú
.
d©a
.
d©a_vÆ
 = 
fh
->data.data_val;

585 
¨gs
.
whîe
.
«me
 = 
√w«me
;

586 
¨gs
.
symlök
.
symlök_©åibuãs
.
mode
.
£t_ô
 = 1;

587 
¨gs
.
symlök
.
symlök_©åibuãs
.
mode
.
£t_mode3_u
.modê
S_IRUSR
|
S_IWUSR
|
S_IXUSR
|
S_IRGRP
|
S_IWGRP
|
S_IXGRP
|
S_IROTH
|
S_IWOTH
|
S_IXOTH
;

588 
¨gs
.
symlök
.
symlök_d©a
 = 
ﬁd∑th
;

590 i‡(
	`xdr_SYMLINK3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

591 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode SYMLINK3args");

592 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

596 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

597 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/symlink call");

598 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

603 
	}
}

608 
	$Ωc_nfs_ª«me_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
ﬁddú
, *
ﬁd«me
, nfs_fh3 *
√wdú
, *
√w«me
, *
¥iv©e_d©a
)

610 
Ωc_pdu
 *
pdu
;

611 
RENAME3¨gs
 
¨gs
;

613 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_RENAME
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_RENAME3ªs
, (
RENAME3ªs
));

614 i‡(
pdu
 =
NULL
) {

615 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/rename call");

619 
	`bzîo
(&
¨gs
, (
RENAME3¨gs
));

620 
¨gs
.
‰om
.
dú
.
d©a
.
d©a_Àn
 = 
ﬁddú
->data.data_len;

621 
¨gs
.
‰om
.
dú
.
d©a
.
d©a_vÆ
 = 
ﬁddú
->data.data_val;

622 
¨gs
.
‰om
.
«me
 = 
ﬁd«me
;

623 
¨gs
.
to
.
dú
.
d©a
.
d©a_Àn
 = 
√wdú
->data.data_len;

624 
¨gs
.
to
.
dú
.
d©a
.
d©a_vÆ
 = 
√wdú
->data.data_val;

625 
¨gs
.
to
.
«me
 = 
√w«me
;

627 i‡(
	`xdr_RENAME3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

628 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode RENAME3args");

629 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

633 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

634 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/rename call");

635 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

640 
	}
}

645 
	$Ωc_nfs_lök_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, 
nfs_fh3
 *
fûe
, nfs_fh3 *
√wdú
, *
√w«me
, *
¥iv©e_d©a
)

647 
Ωc_pdu
 *
pdu
;

648 
LINK3¨gs
 
¨gs
;

650 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFS_PROGRAM
, 
NFS_V3
, 
NFS3_LINK
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_LINK3ªs
, (
LINK3ªs
));

651 i‡(
pdu
 =
NULL
) {

652 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfs/link call");

656 
	`bzîo
(&
¨gs
, (
LINK3¨gs
));

657 
¨gs
.
fûe
.
d©a
.
d©a_Àn
 = file->data.data_len;

658 
¨gs
.
fûe
.
d©a
.
d©a_vÆ
 = file->data.data_val;

659 
¨gs
.
lök
.
dú
.
d©a
.
d©a_Àn
 = 
√wdú
->data.data_len;

660 
¨gs
.
lök
.
dú
.
d©a
.
d©a_vÆ
 = 
√wdú
->data.data_val;

661 
¨gs
.
lök
.
«me
 = 
√w«me
;

663 i‡(
	`xdr_LINK3¨gs
(&
pdu
->
xdr
, &
¨gs
) == 0) {

664 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode LINK3args");

665 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

669 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

670 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfs/link call");

671 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

676 
	}
}

	@ccan/ccan/nfs/nfs.h

1 #i‚de‡
CCAN_NFS_H


2 
	#CCAN_NFS_H


	)

22 
	~<sys/ty≥s.h
>

23 
	~<°döt.h
>

25 
uöt64_t
 
	tnfs_off_t
;

27 
	gnfs_c⁄ãxt
;

32 
nfs_gë_fd
(
nfs_c⁄ãxt
 *
nfs
);

33 
nfs_which_evíts
(
nfs_c⁄ãxt
 *
nfs
);

34 
nfs_£rvi˚
(
nfs_c⁄ãxt
 *
nfs
, 
ªvíts
);

39 
	gAUTH
;

40 
nfs_£t_auth
(
nfs_c⁄ãxt
 *
nfs
, 
AUTH
 *
auth
);

46 *
nfs_gë_îr‹
(
nfs_c⁄ãxt
 *
nfs
);

52 (*
	tnfs_cb
)(
	tîr
, 
	tnfs_c⁄ãxt
 *
	tnfs
, *
	td©a
, *
	t¥iv©e_d©a
);

66 
nfs_c⁄ãxt
 *
	`nfs_öô_c⁄ãxt
();

70 
	`nfs_de°roy_c⁄ãxt
(
nfs_c⁄ãxt
 *
nfs
);

76 
nfsfh
;

96 
	`nfs_mou¡_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
£rvî
, c⁄° *
exp‹t
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

103 
	`nfs_mou¡_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
£rvî
, c⁄° *
exp‹t
);

123 
°©
;

124 
	`nfs_°©_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

131 
	`nfs_°©_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
°©
 *
°
);

149 
	`nfs_f°©_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

156 
	`nfs_f°©_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
°©
 *
°
);

179 
	`nfs_›í_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

186 
	`nfs_›í_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfsfh
 **nfsfh);

207 
	`nfs_˛o£_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

214 
	`nfs_˛o£_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh);

234 
	`nfs_¥ód_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

241 
	`nfs_¥ód_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
buf
);

262 
	`nfs_ªad_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

269 
	`nfs_ªad_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, *
buf
);

290 
	`nfs_pwrôe_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
buf
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

297 
	`nfs_pwrôe_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
size_t
 
cou¡
, *
buf
);

316 
	`nfs_wrôe_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, *
buf
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

323 
	`nfs_wrôe_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
size_t
 
cou¡
, *
buf
);

342 
	`nfs_l£ek_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
whí˚
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

349 
	`nfs_l£ek_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
off£t
, 
whí˚
,Çfs_off_à*
cuºít_off£t
);

367 
	`nfs_fsync_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

374 
	`nfs_fsync_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh);

393 
	`nfs_åunˇã_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_off_t
 
Àngth
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

400 
	`nfs_åunˇã_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_off_t
 
Àngth
);

419 
	`nfs_·runˇã_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
Àngth
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

426 
	`nfs_·runˇã_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
nfs_off_t
 
Àngth
);

448 
	`nfs_mkdú_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

455 
	`nfs_mkdú_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
);

474 
	`nfs_rmdú_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

481 
	`nfs_rmdú_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
);

502 
	`nfs_¸ót_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

509 
	`nfs_¸ót_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfsfh
 **nfsfh);

531 
	`nfs_u∆ök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

538 
	`nfs_u∆ök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
);

546 
nfsdú
;

562 
	`nfs_›ídú_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

569 
	`nfs_›ídú_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfsdú
 **nfsdir);

576 
	snfsdúít
 {

577 
nfsdúít
 *
√xt
;

578 *
«me
;

579 
uöt64_t
 
öode
;

584 
nfsdúít
 *
	`nfs_ªaddú
(
nfs_c⁄ãxt
 *
nfs
, 
nfsdú
 *nfsdir);

594 
	`nfs_˛o£dú
(
nfs_c⁄ãxt
 *
nfs
, 
nfsdú
 *nfsdir);

613 
°©vfs
;

614 
	`nfs_°©vfs_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

621 
	`nfs_°©vfs_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
°©vfs
 *
svfs
);

640 
°©vfs
;

641 
	`nfs_ªadlök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

648 
	`nfs_ªadlök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, *
buf
, 
bufsize
);

667 
	`nfs_chmod_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

674 
	`nfs_chmod_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
);

693 
	`nfs_fchmod_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

700 
	`nfs_fchmod_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
mode
);

719 
	`nfs_chown_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
uid
, 
gid
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

726 
	`nfs_chown_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
uid
, 
gid
);

745 
	`nfs_fchown_async
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
uid
, 
gid
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

752 
	`nfs_fchown_sync
(
nfs_c⁄ãxt
 *
nfs
, 
nfsfh
 *nfsfh, 
uid
, 
gid
);

772 
	`nfs_utimes_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
timevÆ
 *
times
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

779 
	`nfs_utimes_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
timevÆ
 *
times
);

797 
utimbuf
;

798 
	`nfs_utime_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
utimbuf
 *
times
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

805 
	`nfs_utime_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
utimbuf
 *
times
);

825 
	`nfs_ac˚ss_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

832 
	`nfs_ac˚ss_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
∑th
, 
mode
);

852 
	`nfs_symlök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

859 
	`nfs_symlök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
);

877 
	`nfs_ª«me_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

884 
	`nfs_ª«me_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
);

903 
	`nfs_lök_async
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
, 
nfs_cb
 
cb
, *
¥iv©e_d©a
);

910 
	`nfs_lök_sync
(
nfs_c⁄ãxt
 *
nfs
, c⁄° *
ﬁd∑th
, c⁄° *
√w∑th
);

915 
nfs_off_t
 
	`nfs_gë_cuºít_off£t
(
nfsfh
 *nfsfh);

	@ccan/ccan/nfs/nfsacl.c

18 
	~<°dio.h
>

19 
	~<î∫o.h
>

20 
	~<Ωc/xdr.h
>

21 
	~"nfs.h
"

22 
	~"libnfs-øw.h
"

23 
	~"libnfs-¥iv©e.h
"

24 
	~"Ωc/nfß˛.h
"

27 
	$Ωc_nfß˛_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

29 
Ωc_pdu
 *
pdu
;

31 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
NFSACL_PROGRAM
, 
NFSACL_V3
, 
NFSACL3_NULL
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_void
, 0);

32 i‡(
pdu
 =
NULL
) {

33 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÇfsacl/null call");

37 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

38 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÇfsacl/null call");

39 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

44 
	}
}

	@ccan/ccan/nfs/pdu.c

18 
	~<°dio.h
>

19 
	~<°rögs.h
>

20 
	~<Ωc/xdr.h
>

21 
	~<Ωc/Ωc_msg.h
>

22 
	~<cˇn/compûî/compûî.h
>

23 
	~"dlökli°.h
"

24 
	~"nfs.h
"

25 
	~"libnfs-øw.h
"

26 
	~"libnfs-¥iv©e.h
"

28 
Ωc_pdu
 *
	$Ωc_Æloˇã_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, 
¥ogøm
, 
vîsi⁄
, 
¥o˚duª
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
, 
xdΩroc_t
 
xdr_decode_‚
, 
xdr_decode_bufsize
)

30 
Ωc_pdu
 *
pdu
;

31 
Ωc_msg
 
msg
;

33 i‡(
Ωc
 =
NULL
) {

34 
	`¥ötf
("tryingÅoállocateÑpcÖdu on NULL context\n");

35  
NULL
;

38 
pdu
 = 
	`mÆloc
((
Ωc_pdu
));

39 i‡(
pdu
 =
NULL
) {

40 
	`¥ötf
("FailedÅoállocateÖdu structure\n");

41  
NULL
;

43 
	`bzîo
(
pdu
, (
Ωc_pdu
));

44 
pdu
->
xid
 = 
Ωc
->xid++;

45 
pdu
->
cb
 = cb;

46 
pdu
->
¥iv©e_d©a
 =Örivate_data;

47 
pdu
->
xdr_decode_‚
 = xdr_decode_fn;

48 
pdu
->
xdr_decode_bufsize
 = xdr_decode_bufsize;

50 
	`xdrmem_¸óã
(&
pdu
->
xdr
, 
Ωc
->
ícodebuf
,Ñpc->
ícodebuÊí
, 
XDR_ENCODE
);

51 
	`xdr_£ços
(&
pdu
->
xdr
, 4);

53 
	`bzîo
(&
msg
, (
Ωc_msg
));

54 
msg
.
rm_xid
 = 
pdu
->
xid
;

55 
msg
.
rm_dúe˘i⁄
 = 
CALL
;

56 
msg
.
rm_ˇŒ
.
cb_Ωcvîs
 = 
RPC_MSG_VERSION
;

57 
msg
.
rm_ˇŒ
.
cb_¥og
 = 
¥ogøm
;

58 
msg
.
rm_ˇŒ
.
cb_vîs
 = 
vîsi⁄
;

59 
msg
.
rm_ˇŒ
.
cb_¥oc
 = 
¥o˚duª
;

60 
msg
.
rm_ˇŒ
.
cb_¸ed
 = 
Ωc
->
auth
->
ah_¸ed
;

61 
msg
.
rm_ˇŒ
.
cb_vîf
 = 
Ωc
->
auth
->
ah_vîf
;

63 i‡(
	`xdr_ˇŒmsg
(&
pdu
->
xdr
, &
msg
) == 0) {

64 
	`¥ötf
("xdr_callmsg failed\n");

65 
	`xdr_de°roy
(&
pdu
->
xdr
);

66 
	`‰ì
(
pdu
);

67  
NULL
;

70  
pdu
;

71 
	}
}

73 
	$Ωc_‰ì_pdu
(
Ωc_c⁄ãxt
 *
Ωc
 
UNUSED
, 
Ωc_pdu
 *
pdu
)

75 i‡(
pdu
->
outd©a
.
d©a
 !
NULL
) {

76 
	`‰ì
(
pdu
->
outd©a
.
d©a
);

77 
pdu
->
outd©a
.
d©a
 = 
NULL
;

80 i‡(
pdu
->
xdr_decode_buf
 !
NULL
) {

81 
	`xdr_‰ì
(
pdu
->
xdr_decode_‚
,Ödu->
xdr_decode_buf
);

82 
	`‰ì
(
pdu
->
xdr_decode_buf
);

83 
pdu
->
xdr_decode_buf
 = 
NULL
;

86 
	`xdr_de°roy
(&
pdu
->
xdr
);

87 
	`‰ì
(
pdu
);

88 
	}
}

91 
	$Ωc_queue_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_pdu
 *
pdu
)

93 
size
, 
ªc‹dm¨kî
;

95 
size
 = 
	`xdr_gëpos
(&
pdu
->
xdr
);

98 
	`xdr_£ços
(&
pdu
->
xdr
, 0);

99 
ªc‹dm¨kî
 = (
size
 - 4) | 0x80000000;

100 
	`xdr_öt
(&
pdu
->
xdr
, &
ªc‹dm¨kî
);

102 
pdu
->
outd©a
.
size
 = size;

103 
pdu
->
outd©a
.
d©a
 = 
	`mÆloc
’du->outd©a.
size
);

104 i‡(
pdu
->
outd©a
.
d©a
 =
NULL
) {

105 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocate buffer forÖdu\n");

106 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

110 
	`mem˝y
(
pdu
->
outd©a
.
d©a
, 
Ωc
->
ícodebuf
,Ödu->outd©a.
size
);

111 
	`DLIST_ADD_END
(
Ωc
->
outqueue
, 
pdu
, 
NULL
);

114 
	}
}

116 
	$Ωc_gë_pdu_size
(*
buf
)

118 
uöt32_t
 
size
;

120 
size
 = 
	`¡ohl
(*(
uöt32_t
 *)
buf
);

122 i‡((
size
 & 0x80000000) == 0) {

123 
	`¥ötf
("cant handle oncrpc fragments\n");

127  (
size
 & 0x7fffffff) + 4;

128 
	}
}

130 
	$Ωc_¥o˚ss_ª∂y
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_pdu
 *
pdu
, 
XDR
 *
xdr
)

132 
Ωc_msg
 
msg
;

134 
	`bzîo
(&
msg
, (
Ωc_msg
));

135 
msg
.
a˝ãd_Ωly
.
¨_vîf
 = 
_nuŒ_auth
;

136 i‡(
pdu
->
xdr_decode_bufsize
 > 0) {

137 
pdu
->
xdr_decode_buf
 = 
	`mÆloc
’du->
xdr_decode_bufsize
);

138 i‡(
pdu
->
xdr_decode_buf
 =
NULL
) {

139 
	`¥ötf
("xdr_replymsg failed inÖortmap_getport_reply\n");

140 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "FaûedÅÿÆloˇã buf„∏f‹ decodög o‡XDRÑïly",Ödu->
¥iv©e_d©a
);

143 
	`bzîo
(
pdu
->
xdr_decode_buf
,Ödu->
xdr_decode_bufsize
);

145 
msg
.
a˝ãd_Ωly
.
¨_ªsu…s
.
whîe
 = 
pdu
->
xdr_decode_buf
;

146 
msg
.
a˝ãd_Ωly
.
¨_ªsu…s
.
¥oc
 = 
pdu
->
xdr_decode_‚
;

148 i‡(
	`xdr_ª∂ymsg
(
xdr
, &
msg
) == 0) {

149 
	`¥ötf
("xdr_replymsg failed inÖortmap_getport_reply\n");

150 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "Mesßgêªje˘ed by sîvî",Ödu->
¥iv©e_d©a
);

151 i‡(
pdu
->
xdr_decode_buf
 !
NULL
) {

152 
	`‰ì
(
pdu
->
xdr_decode_buf
);

153 
pdu
->
xdr_decode_buf
 = 
NULL
;

157 i‡(
msg
.
rm_ª∂y
.
Ω_°©
 !
MSG_ACCEPTED
) {

158 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "RPC PackëÇŸác˚±ed byÅhê£rvî",Ödu->
¥iv©e_d©a
);

161 
msg
.
rm_ª∂y
.
Ω_a˝t
.
¨_°©
) {

162 
SUCCESS
:

163 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_SUCCESS
,Ödu->
xdr_decode_buf
,Ödu->
¥iv©e_d©a
);

165 
PROG_UNAVAIL
:

166 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "SîvîÑe•⁄ded: ProgømÇŸávaûabÀ",Ödu->
¥iv©e_d©a
);

168 
PROG_MISMATCH
:

169 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "SîvîÑe•⁄ded: Progøm vîsi⁄ mism©ch",Ödu->
¥iv©e_d©a
);

171 
PROC_UNAVAIL
:

172 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "SîvîÑe•⁄ded: Pro˚duªÇŸávaûabÀ",Ödu->
¥iv©e_d©a
);

174 
GARBAGE_ARGS
:

175 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "SîvîÑe•⁄ded: G¨bagê¨gumíts",Ödu->
¥iv©e_d©a
);

177 
SYSTEM_ERR
:

178 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "SîvîÑe•⁄ded: Sy°em Eº‹",Ödu->
¥iv©e_d©a
);

181 
pdu
->
	`cb
(
Ωc
, 
RPC_STATUS_ERROR
, "Unknow¿Ω¯ª•⁄£ from sîvî",Ödu->
¥iv©e_d©a
);

186 
	}
}

188 
	$Ωc_¥o˚ss_pdu
(
Ωc_c⁄ãxt
 *
Ωc
, *
buf
, 
size
)

190 
Ωc_pdu
 *
pdu
;

191 
XDR
 
xdr
;

192 
pos
, 
ªc‹dm¨kî
;

193 
xid
;

195 
	`bzîo
(&
xdr
, (
XDR
));

197 
	`xdrmem_¸óã
(&
xdr
, 
buf
, 
size
, 
XDR_DECODE
);

198 i‡(
	`xdr_öt
(&
xdr
, &
ªc‹dm¨kî
) == 0) {

199 
	`¥ötf
("xdr_intÑeadingÑecordmarker failed\n");

200 
	`xdr_de°roy
(&
xdr
);

203 
pos
 = 
	`xdr_gëpos
(&
xdr
);

204 i‡(
	`xdr_öt
(&
xdr
, (*)&
xid
) == 0) {

205 
	`¥ötf
("xdr_intÑeading xid failed\n");

206 
	`xdr_de°roy
(&
xdr
);

209 
	`xdr_£ços
(&
xdr
, 
pos
);

211 
pdu
=
Ωc
->
waôpdu
;Ödu;Öduıdu->
√xt
) {

212 i‡(
pdu
->
xid
 != xid) {

215 
	`DLIST_REMOVE
(
Ωc
->
waôpdu
, 
pdu
);

216 i‡(
	`Ωc_¥o˚ss_ª∂y
(
Ωc
, 
pdu
, &
xdr
) != 0) {

217 
	`¥ötf
("rpc_procdess_reply failed\n");

219 
	`xdr_de°roy
(&
xdr
);

220 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

223 
	`¥ötf
("Nÿm©chögÖdu found f‹ xid:%d\n", 
xid
);

224 
	`xdr_de°roy
(&
xdr
);

226 
	}
}

	@ccan/ccan/nfs/portmap.c

18 
	~<°dio.h
>

19 
	~<Ωc/xdr.h
>

20 
	~"nfs.h
"

21 
	~"libnfs-øw.h
"

22 
	~"libnfs-¥iv©e.h
"

23 
	~"Ωc/p‹tm≠.h
"

26 
	$Ωc_pm≠_nuŒ_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

28 
Ωc_pdu
 *
pdu
;

30 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
PMAP_PROGRAM
, 
PMAP_V2
, 
PMAP_NULL
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_void
, 0);

31 i‡(
pdu
 =
NULL
) {

32 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÖortmap/null call");

36 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

37 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅo queueÖdu forÖortmap/null call");

38 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

43 
	}
}

45 
	$Ωc_pm≠_gëp‹t_async
(
Ωc_c⁄ãxt
 *
Ωc
, 
¥ogøm
, 
vîsi⁄
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

47 
Ωc_pdu
 *
pdu
;

48 
m≠pög
 
m
;

50 
pdu
 = 
	`Ωc_Æloˇã_pdu
(
Ωc
, 
PMAP_PROGRAM
, 
PMAP_V2
, 
PMAP_GETPORT
, 
cb
, 
¥iv©e_d©a
, (
xdΩroc_t
)
xdr_öt
, (
uöt32_t
));

51 i‡(
pdu
 =
NULL
) {

52 
	`Ωc_£t_îr‹
(
Ωc
, "Out of memory. FailedÅoállocateÖdu forÖortmap/getport call");

56 
m
.
¥og
 = 
¥ogøm
;

57 
m
.
vîs
 = 
vîsi⁄
;

58 
m
.
¥Ÿ
 = 
IPPROTO_TCP
;

59 
m
.
p‹t
 = 0;

60 i‡(
	`xdr_m≠pög
(&
pdu
->
xdr
, &
m
) == 0) {

61 
	`Ωc_£t_îr‹
(
Ωc
, "XDRÉrror: FailedÅoÉncode data forÖortmap/getport call");

62 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

66 i‡(
	`Ωc_queue_pdu
(
Ωc
, 
pdu
) != 0) {

67 
	`¥ötf
("FailedÅo queueÖortmap/getportÖdu\n");

68 
	`Ωc_‰ì_pdu
(
Ωc
, 
pdu
);

73 
	}
}

	@ccan/ccan/nfs/rpc/mount.h

7 #i‚de‡
_MOUNT_H_RPCGEN


8 
	#_MOUNT_H_RPCGEN


	)

10 
	~<Ωc/Ωc.h
>

13 #ifde‡
__˝lu•lus


17 
	#MNTPATHLEN
 1024

	)

18 
	#MNTNAMLEN
 255

	)

19 
	#FHSIZE3
 64

	)

22 
u_öt
 
fh™dÀ3_Àn
;

23 *
fh™dÀ3_vÆ
;

24 } 
	tfh™dÀ3
;

26 *
	tdú∑th
;

28 *
	t«me
;

30 
	emou¡°©3
 {

31 
MNT3_OK
 = 0,

32 
MNT3ERR_PERM
 = 1,

33 
MNT3ERR_NOENT
 = 2,

34 
MNT3ERR_IO
 = 5,

35 
MNT3ERR_ACCES
 = 13,

36 
MNT3ERR_NOTDIR
 = 20,

37 
MNT3ERR_INVAL
 = 22,

38 
MNT3ERR_NAMETOOLONG
 = 63,

39 
MNT3ERR_NOTSUPP
 = 10004,

40 
MNT3ERR_SERVERFAULT
 = 10006,

42 
mou¡°©3
 
	tmou¡°©3
;

44 
mou¡body
 *
	tmou¡li°
;

46 
	smou¡body
 {

47 
«me
 
ml_ho°«me
;

48 
dú∑th
 
ml_dúe˘‹y
;

49 
mou¡li°
 
ml_√xt
;

51 
mou¡body
 
	tmou¡body
;

53 
grou≤ode
 *
	tgroups
;

55 
	sgrou≤ode
 {

56 
«me
 
gr_«me
;

57 
groups
 
gr_√xt
;

59 
grou≤ode
 
	tgrou≤ode
;

61 
exp‹äode
 *
	texp‹ts
;

63 
	sexp‹äode
 {

64 
dú∑th
 
ex_dú
;

65 
groups
 
ex_groups
;

66 
exp‹ts
 
ex_√xt
;

68 
exp‹äode
 
	texp‹äode
;

70 
	smou¡ªs3_ok
 {

71 
fh™dÀ3
 
fh™dÀ
;

73 
u_öt
 
auth_Êav‹s_Àn
;

74 *
auth_Êav‹s_vÆ
;

75 } 
auth_Êav‹s
;

77 
mou¡ªs3_ok
 
	tmou¡ªs3_ok
;

79 
	smou¡ªs3
 {

80 
mou¡°©3
 
fhs_°©us
;

82 
mou¡ªs3_ok
 
mou¡öfo
;

83 } 
mou¡ªs3_u
;

85 
mou¡ªs3
 
	tmou¡ªs3
;

87 
	#MOUNT_PROGRAM
 100005

	)

88 
	#MOUNT_V3
 3

	)

90 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

91 
	#MOUNT3_NULL
 0

	)

92 * 
mou¡3_nuŒ_3
(*, 
CLIENT
 *);

93 * 
mou¡3_nuŒ_3_svc
(*, 
svc_ªq
 *);

94 
	#MOUNT3_MNT
 1

	)

95 
mou¡ªs3
 * 
mou¡3_m¡_3
(
dú∑th
 *, 
CLIENT
 *);

96 
mou¡ªs3
 * 
mou¡3_m¡_3_svc
(
dú∑th
 *, 
svc_ªq
 *);

97 
	#MOUNT3_DUMP
 2

	)

98 
mou¡li°
 * 
mou¡3_dump_3
(*, 
CLIENT
 *);

99 
mou¡li°
 * 
mou¡3_dump_3_svc
(*, 
svc_ªq
 *);

100 
	#MOUNT3_UMNT
 3

	)

101 * 
mou¡3_um¡_3
(
dú∑th
 *, 
CLIENT
 *);

102 * 
mou¡3_um¡_3_svc
(
dú∑th
 *, 
svc_ªq
 *);

103 
	#MOUNT3_UMNTALL
 4

	)

104 * 
mou¡3_um¡Æl_3
(*, 
CLIENT
 *);

105 * 
mou¡3_um¡Æl_3_svc
(*, 
svc_ªq
 *);

106 
	#MOUNT3_EXPORT
 5

	)

107 
exp‹ts
 * 
mou¡3_exp‹t_3
(*, 
CLIENT
 *);

108 
exp‹ts
 * 
mou¡3_exp‹t_3_svc
(*, 
svc_ªq
 *);

109 
mou¡_¥ogøm_3_‰ìªsu…
 (
SVCXPRT
 *, 
xdΩroc_t
, 
ˇddr_t
);

112 
	#MOUNT3_NULL
 0

	)

113 * 
mou¡3_nuŒ_3
();

114 * 
mou¡3_nuŒ_3_svc
();

115 
	#MOUNT3_MNT
 1

	)

116 
mou¡ªs3
 * 
mou¡3_m¡_3
();

117 
mou¡ªs3
 * 
mou¡3_m¡_3_svc
();

118 
	#MOUNT3_DUMP
 2

	)

119 
mou¡li°
 * 
mou¡3_dump_3
();

120 
mou¡li°
 * 
mou¡3_dump_3_svc
();

121 
	#MOUNT3_UMNT
 3

	)

122 * 
mou¡3_um¡_3
();

123 * 
mou¡3_um¡_3_svc
();

124 
	#MOUNT3_UMNTALL
 4

	)

125 * 
mou¡3_um¡Æl_3
();

126 * 
mou¡3_um¡Æl_3_svc
();

127 
	#MOUNT3_EXPORT
 5

	)

128 
exp‹ts
 * 
mou¡3_exp‹t_3
();

129 
exp‹ts
 * 
mou¡3_exp‹t_3_svc
();

130 
mou¡_¥ogøm_3_‰ìªsu…
 ();

135 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

136 
boﬁ_t
 
xdr_fh™dÀ3
 (
XDR
 *, 
fh™dÀ3
*);

137 
boﬁ_t
 
xdr_dú∑th
 (
XDR
 *, 
dú∑th
*);

138 
boﬁ_t
 
xdr_«me
 (
XDR
 *, 
«me
*);

139 
boﬁ_t
 
xdr_mou¡°©3
 (
XDR
 *, 
mou¡°©3
*);

140 
boﬁ_t
 
xdr_mou¡li°
 (
XDR
 *, 
mou¡li°
*);

141 
boﬁ_t
 
xdr_mou¡body
 (
XDR
 *, 
mou¡body
*);

142 
boﬁ_t
 
xdr_groups
 (
XDR
 *, 
groups
*);

143 
boﬁ_t
 
xdr_grou≤ode
 (
XDR
 *, 
grou≤ode
*);

144 
boﬁ_t
 
xdr_exp‹ts
 (
XDR
 *, 
exp‹ts
*);

145 
boﬁ_t
 
xdr_exp‹äode
 (
XDR
 *, 
exp‹äode
*);

146 
boﬁ_t
 
xdr_mou¡ªs3_ok
 (
XDR
 *, 
mou¡ªs3_ok
*);

147 
boﬁ_t
 
xdr_mou¡ªs3
 (
XDR
 *, 
mou¡ªs3
*);

150 
boﬁ_t
 
xdr_fh™dÀ3
 ();

151 
boﬁ_t
 
xdr_dú∑th
 ();

152 
boﬁ_t
 
xdr_«me
 ();

153 
boﬁ_t
 
xdr_mou¡°©3
 ();

154 
boﬁ_t
 
xdr_mou¡li°
 ();

155 
boﬁ_t
 
xdr_mou¡body
 ();

156 
boﬁ_t
 
xdr_groups
 ();

157 
boﬁ_t
 
xdr_grou≤ode
 ();

158 
boﬁ_t
 
xdr_exp‹ts
 ();

159 
boﬁ_t
 
xdr_exp‹äode
 ();

160 
boﬁ_t
 
xdr_mou¡ªs3_ok
 ();

161 
boﬁ_t
 
xdr_mou¡ªs3
 ();

165 #ifde‡
__˝lu•lus


	@ccan/ccan/nfs/rpc/nfs.h

7 #i‚de‡
_NFS_H_RPCGEN


8 
	#_NFS_H_RPCGEN


	)

10 
	~<Ωc/Ωc.h
>

13 #ifde‡
__˝lu•lus


17 
	#NFS3_FHSIZE
 64

	)

18 
	#NFS3_WRITEVERFSIZE
 8

	)

19 
	#NFS3_CREATEVERFSIZE
 8

	)

20 
	#NFS3_COOKIEVERFSIZE
 8

	)

22 
	tcookõvîf3
[
NFS3_COOKIEVERFSIZE
];

24 
u_quad_t
 
	tuöt64
;

26 
uöt64
 
	tcookõ3
;

28 
	snfs_fh3
 {

30 
u_öt
 
d©a_Àn
;

31 *
d©a_vÆ
;

32 } 
d©a
;

34 
nfs_fh3
 
	tnfs_fh3
;

36 *
	tfûíame3
;

38 
	sdú›¨gs3
 {

39 
nfs_fh3
 
dú
;

40 
fûíame3
 
«me
;

42 
dú›¨gs3
 
	tdú›¨gs3
;

44 
	e·y≥3
 {

45 
NF3REG
 = 1,

46 
NF3DIR
 = 2,

47 
NF3BLK
 = 3,

48 
NF3CHR
 = 4,

49 
NF3LNK
 = 5,

50 
NF3SOCK
 = 6,

51 
NF3FIFO
 = 7,

53 
·y≥3
 
	t·y≥3
;

55 
u_l⁄g
 
	tuöt32
;

57 
	töt32
;

59 
uöt32
 
	tmode3
;

61 
uöt32
 
	tuid3
;

63 
uöt32
 
	tgid3
;

65 
uöt64
 
	tsize3
;

67 
uöt64
 
	tfûeid3
;

69 
	s•ecd©a3
 {

70 
uöt32
 
•ecd©a1
;

71 
uöt32
 
•ecd©a2
;

73 
•ecd©a3
 
	t•ecd©a3
;

75 
	snf°ime3
 {

76 
uöt32
 
£c⁄ds
;

77 
uöt32
 
n£c⁄ds
;

79 
nf°ime3
 
	tnf°ime3
;

81 
	sÁâr3
 {

82 
·y≥3
 
ty≥
;

83 
mode3
 
mode
;

84 
uöt32
 
∆ök
;

85 
uid3
 
uid
;

86 
gid3
 
gid
;

87 
size3
 
size
;

88 
size3
 
u£d
;

89 
•ecd©a3
 
rdev
;

90 
uöt64
 
fsid
;

91 
fûeid3
 
fûeid
;

92 
nf°ime3
 
©ime
;

93 
nf°ime3
 
mtime
;

94 
nf°ime3
 
˘ime
;

96 
Áâr3
 
	tÁâr3
;

98 
	spo°_›_©å
 {

99 
boﬁ_t
 
©åibuãs_fﬁlow
;

101 
Áâr3
 
©åibuãs
;

102 } 
po°_›_©å_u
;

104 
po°_›_©å
 
	tpo°_›_©å
;

106 
	enfs°©3
 {

107 
NFS3_OK
 = 0,

108 
NFS3ERR_PERM
 = 1,

109 
NFS3ERR_NOENT
 = 2,

110 
NFS3ERR_IO
 = 5,

111 
NFS3ERR_NXIO
 = 6,

112 
NFS3ERR_ACCES
 = 13,

113 
NFS3ERR_EXIST
 = 17,

114 
NFS3ERR_XDEV
 = 18,

115 
NFS3ERR_NODEV
 = 19,

116 
NFS3ERR_NOTDIR
 = 20,

117 
NFS3ERR_ISDIR
 = 21,

118 
NFS3ERR_INVAL
 = 22,

119 
NFS3ERR_FBIG
 = 27,

120 
NFS3ERR_NOSPC
 = 28,

121 
NFS3ERR_ROFS
 = 30,

122 
NFS3ERR_MLINK
 = 31,

123 
NFS3ERR_NAMETOOLONG
 = 63,

124 
NFS3ERR_NOTEMPTY
 = 66,

125 
NFS3ERR_DQUOT
 = 69,

126 
NFS3ERR_STALE
 = 70,

127 
NFS3ERR_REMOTE
 = 71,

128 
NFS3ERR_BADHANDLE
 = 10001,

129 
NFS3ERR_NOT_SYNC
 = 10002,

130 
NFS3ERR_BAD_COOKIE
 = 10003,

131 
NFS3ERR_NOTSUPP
 = 10004,

132 
NFS3ERR_TOOSMALL
 = 10005,

133 
NFS3ERR_SERVERFAULT
 = 10006,

134 
NFS3ERR_BADTYPE
 = 10007,

135 
NFS3ERR_JUKEBOX
 = 10008,

137 
nfs°©3
 
	tnfs°©3
;

139 
	e°abÀ_how
 {

140 
UNSTABLE
 = 0,

141 
DATA_SYNC
 = 1,

142 
FILE_SYNC
 = 2,

144 
°abÀ_how
 
	t°abÀ_how
;

146 
uöt64
 
	toff£t3
;

148 
uöt32
 
	tcou¡3
;

150 
	swcc_©å
 {

151 
size3
 
size
;

152 
nf°ime3
 
mtime
;

153 
nf°ime3
 
˘ime
;

155 
wcc_©å
 
	twcc_©å
;

157 
	s¥e_›_©å
 {

158 
boﬁ_t
 
©åibuãs_fﬁlow
;

160 
wcc_©å
 
©åibuãs
;

161 } 
¥e_›_©å_u
;

163 
¥e_›_©å
 
	t¥e_›_©å
;

165 
	swcc_d©a
 {

166 
¥e_›_©å
 
bef‹e
;

167 
po°_›_©å
 
a·î
;

169 
wcc_d©a
 
	twcc_d©a
;

171 
	sWRITE3¨gs
 {

172 
nfs_fh3
 
fûe
;

173 
off£t3
 
off£t
;

174 
cou¡3
 
cou¡
;

175 
°abÀ_how
 
°abÀ
;

177 
u_öt
 
d©a_Àn
;

178 *
d©a_vÆ
;

179 } 
d©a
;

181 
WRITE3¨gs
 
	tWRITE3¨gs
;

183 
	twrôevîf3
[
NFS3_WRITEVERFSIZE
];

185 
	sWRITE3ªsok
 {

186 
wcc_d©a
 
fûe_wcc
;

187 
cou¡3
 
cou¡
;

188 
°abÀ_how
 
commôãd
;

189 
wrôevîf3
 
vîf
;

191 
WRITE3ªsok
 
	tWRITE3ªsok
;

193 
	sWRITE3ªsÁû
 {

194 
wcc_d©a
 
fûe_wcc
;

196 
WRITE3ªsÁû
 
	tWRITE3ªsÁû
;

198 
	sWRITE3ªs
 {

199 
nfs°©3
 
°©us
;

201 
WRITE3ªsok
 
ªsok
;

202 
WRITE3ªsÁû
 
ªsÁû
;

203 } 
WRITE3ªs_u
;

205 
WRITE3ªs
 
	tWRITE3ªs
;

207 
	sLOOKUP3¨gs
 {

208 
dú›¨gs3
 
wh©
;

210 
LOOKUP3¨gs
 
	tLOOKUP3¨gs
;

212 
	sLOOKUP3ªsok
 {

213 
nfs_fh3
 
obje˘
;

214 
po°_›_©å
 
obj_©åibuãs
;

215 
po°_›_©å
 
dú_©åibuãs
;

217 
LOOKUP3ªsok
 
	tLOOKUP3ªsok
;

219 
	sLOOKUP3ªsÁû
 {

220 
po°_›_©å
 
dú_©åibuãs
;

222 
LOOKUP3ªsÁû
 
	tLOOKUP3ªsÁû
;

224 
	sLOOKUP3ªs
 {

225 
nfs°©3
 
°©us
;

227 
LOOKUP3ªsok
 
ªsok
;

228 
LOOKUP3ªsÁû
 
ªsÁû
;

229 } 
LOOKUP3ªs_u
;

231 
LOOKUP3ªs
 
	tLOOKUP3ªs
;

233 
	sCOMMIT3¨gs
 {

234 
nfs_fh3
 
fûe
;

235 
off£t3
 
off£t
;

236 
cou¡3
 
cou¡
;

238 
COMMIT3¨gs
 
	tCOMMIT3¨gs
;

240 
	sCOMMIT3ªsok
 {

241 
wcc_d©a
 
fûe_wcc
;

242 
wrôevîf3
 
vîf
;

244 
COMMIT3ªsok
 
	tCOMMIT3ªsok
;

246 
	sCOMMIT3ªsÁû
 {

247 
wcc_d©a
 
fûe_wcc
;

249 
COMMIT3ªsÁû
 
	tCOMMIT3ªsÁû
;

251 
	sCOMMIT3ªs
 {

252 
nfs°©3
 
°©us
;

254 
COMMIT3ªsok
 
ªsok
;

255 
COMMIT3ªsÁû
 
ªsÁû
;

256 } 
COMMIT3ªs_u
;

258 
COMMIT3ªs
 
	tCOMMIT3ªs
;

259 
	#ACCESS3_READ
 0x0001

	)

260 
	#ACCESS3_LOOKUP
 0x0002

	)

261 
	#ACCESS3_MODIFY
 0x0004

	)

262 
	#ACCESS3_EXTEND
 0x0008

	)

263 
	#ACCESS3_DELETE
 0x0010

	)

264 
	#ACCESS3_EXECUTE
 0x0020

	)

266 
	sACCESS3¨gs
 {

267 
nfs_fh3
 
obje˘
;

268 
uöt32
 
ac˚ss
;

270 
ACCESS3¨gs
 
	tACCESS3¨gs
;

272 
	sACCESS3ªsok
 {

273 
po°_›_©å
 
obj_©åibuãs
;

274 
uöt32
 
ac˚ss
;

276 
ACCESS3ªsok
 
	tACCESS3ªsok
;

278 
	sACCESS3ªsÁû
 {

279 
po°_›_©å
 
obj_©åibuãs
;

281 
ACCESS3ªsÁû
 
	tACCESS3ªsÁû
;

283 
	sACCESS3ªs
 {

284 
nfs°©3
 
°©us
;

286 
ACCESS3ªsok
 
ªsok
;

287 
ACCESS3ªsÁû
 
ªsÁû
;

288 } 
ACCESS3ªs_u
;

290 
ACCESS3ªs
 
	tACCESS3ªs
;

292 
	sGETATTR3¨gs
 {

293 
nfs_fh3
 
obje˘
;

295 
GETATTR3¨gs
 
	tGETATTR3¨gs
;

297 
	sGETATTR3ªsok
 {

298 
Áâr3
 
obj_©åibuãs
;

300 
GETATTR3ªsok
 
	tGETATTR3ªsok
;

302 
	sGETATTR3ªs
 {

303 
nfs°©3
 
°©us
;

305 
GETATTR3ªsok
 
ªsok
;

306 } 
GETATTR3ªs_u
;

308 
GETATTR3ªs
 
	tGETATTR3ªs
;

310 
	etime_how
 {

311 
DONT_CHANGE
 = 0,

312 
SET_TO_SERVER_TIME
 = 1,

313 
SET_TO_CLIENT_TIME
 = 2,

315 
time_how
 
	ttime_how
;

317 
	s£t_mode3
 {

318 
boﬁ_t
 
£t_ô
;

320 
mode3
 
mode
;

321 } 
£t_mode3_u
;

323 
£t_mode3
 
	t£t_mode3
;

325 
	s£t_uid3
 {

326 
boﬁ_t
 
£t_ô
;

328 
uid3
 
uid
;

329 } 
£t_uid3_u
;

331 
£t_uid3
 
	t£t_uid3
;

333 
	s£t_gid3
 {

334 
boﬁ_t
 
£t_ô
;

336 
gid3
 
gid
;

337 } 
£t_gid3_u
;

339 
£t_gid3
 
	t£t_gid3
;

341 
	s£t_size3
 {

342 
boﬁ_t
 
£t_ô
;

344 
size3
 
size
;

345 } 
£t_size3_u
;

347 
£t_size3
 
	t£t_size3
;

349 
	s£t_©ime
 {

350 
time_how
 
£t_ô
;

352 
nf°ime3
 
©ime
;

353 } 
£t_©ime_u
;

355 
£t_©ime
 
	t£t_©ime
;

357 
	s£t_mtime
 {

358 
time_how
 
£t_ô
;

360 
nf°ime3
 
mtime
;

361 } 
£t_mtime_u
;

363 
£t_mtime
 
	t£t_mtime
;

365 
	sßâr3
 {

366 
£t_mode3
 
mode
;

367 
£t_uid3
 
uid
;

368 
£t_gid3
 
gid
;

369 
£t_size3
 
size
;

370 
£t_©ime
 
©ime
;

371 
£t_mtime
 
mtime
;

373 
ßâr3
 
	tßâr3
;

375 
	e¸óãmode3
 {

376 
UNCHECKED
 = 0,

377 
GUARDED
 = 1,

378 
EXCLUSIVE
 = 2,

380 
¸óãmode3
 
	t¸óãmode3
;

382 
	t¸óãvîf3
[
NFS3_CREATEVERFSIZE
];

384 
	s¸óãhow3
 {

385 
¸óãmode3
 
mode
;

387 
ßâr3
 
obj_©åibuãs
;

388 
¸óãvîf3
 
vîf
;

389 } 
¸óãhow3_u
;

391 
¸óãhow3
 
	t¸óãhow3
;

393 
	sCREATE3¨gs
 {

394 
dú›¨gs3
 
whîe
;

395 
¸óãhow3
 
how
;

397 
CREATE3¨gs
 
	tCREATE3¨gs
;

399 
	spo°_›_fh3
 {

400 
boﬁ_t
 
h™dÀ_fﬁlows
;

402 
nfs_fh3
 
h™dÀ
;

403 } 
po°_›_fh3_u
;

405 
po°_›_fh3
 
	tpo°_›_fh3
;

407 
	sCREATE3ªsok
 {

408 
po°_›_fh3
 
obj
;

409 
po°_›_©å
 
obj_©åibuãs
;

410 
wcc_d©a
 
dú_wcc
;

412 
CREATE3ªsok
 
	tCREATE3ªsok
;

414 
	sCREATE3ªsÁû
 {

415 
wcc_d©a
 
dú_wcc
;

417 
CREATE3ªsÁû
 
	tCREATE3ªsÁû
;

419 
	sCREATE3ªs
 {

420 
nfs°©3
 
°©us
;

422 
CREATE3ªsok
 
ªsok
;

423 
CREATE3ªsÁû
 
ªsÁû
;

424 } 
CREATE3ªs_u
;

426 
CREATE3ªs
 
	tCREATE3ªs
;

428 
	sREMOVE3¨gs
 {

429 
dú›¨gs3
 
obje˘
;

431 
REMOVE3¨gs
 
	tREMOVE3¨gs
;

433 
	sREMOVE3ªsok
 {

434 
wcc_d©a
 
dú_wcc
;

436 
REMOVE3ªsok
 
	tREMOVE3ªsok
;

438 
	sREMOVE3ªsÁû
 {

439 
wcc_d©a
 
dú_wcc
;

441 
REMOVE3ªsÁû
 
	tREMOVE3ªsÁû
;

443 
	sREMOVE3ªs
 {

444 
nfs°©3
 
°©us
;

446 
REMOVE3ªsok
 
ªsok
;

447 
REMOVE3ªsÁû
 
ªsÁû
;

448 } 
REMOVE3ªs_u
;

450 
REMOVE3ªs
 
	tREMOVE3ªs
;

452 
	sREAD3¨gs
 {

453 
nfs_fh3
 
fûe
;

454 
off£t3
 
off£t
;

455 
cou¡3
 
cou¡
;

457 
READ3¨gs
 
	tREAD3¨gs
;

459 
	sREAD3ªsok
 {

460 
po°_›_©å
 
fûe_©åibuãs
;

461 
cou¡3
 
cou¡
;

462 
boﬁ_t
 
eof
;

464 
u_öt
 
d©a_Àn
;

465 *
d©a_vÆ
;

466 } 
d©a
;

468 
READ3ªsok
 
	tREAD3ªsok
;

470 
	sREAD3ªsÁû
 {

471 
po°_›_©å
 
fûe_©åibuãs
;

473 
READ3ªsÁû
 
	tREAD3ªsÁû
;

475 
	sREAD3ªs
 {

476 
nfs°©3
 
°©us
;

478 
READ3ªsok
 
ªsok
;

479 
READ3ªsÁû
 
ªsÁû
;

480 } 
READ3ªs_u
;

482 
READ3ªs
 
	tREAD3ªs
;

483 
	#FSF3_LINK
 0x0001

	)

484 
	#FSF3_SYMLINK
 0x0002

	)

485 
	#FSF3_HOMOGENEOUS
 0x0008

	)

486 
	#FSF3_CANSETTIME
 0x0010

	)

488 
	sFSINFO3¨gs
 {

489 
nfs_fh3
 
f§oŸ
;

491 
FSINFO3¨gs
 
	tFSINFO3¨gs
;

493 
	sFSINFO3ªsok
 {

494 
po°_›_©å
 
obj_©åibuãs
;

495 
uöt32
 
πmax
;

496 
uöt32
 
π¥ef
;

497 
uöt32
 
πmu…
;

498 
uöt32
 
wtmax
;

499 
uöt32
 
wçªf
;

500 
uöt32
 
wtmu…
;

501 
uöt32
 
dçªf
;

502 
size3
 
maxfûesize
;

503 
nf°ime3
 
time_dñè
;

504 
uöt32
 
¥›îtõs
;

506 
FSINFO3ªsok
 
	tFSINFO3ªsok
;

508 
	sFSINFO3ªsÁû
 {

509 
po°_›_©å
 
obj_©åibuãs
;

511 
FSINFO3ªsÁû
 
	tFSINFO3ªsÁû
;

513 
	sFSINFO3ªs
 {

514 
nfs°©3
 
°©us
;

516 
FSINFO3ªsok
 
ªsok
;

517 
FSINFO3ªsÁû
 
ªsÁû
;

518 } 
FSINFO3ªs_u
;

520 
FSINFO3ªs
 
	tFSINFO3ªs
;

522 
	sFSSTAT3¨gs
 {

523 
nfs_fh3
 
f§oŸ
;

525 
FSSTAT3¨gs
 
	tFSSTAT3¨gs
;

527 
	sFSSTAT3ªsok
 {

528 
po°_›_©å
 
obj_©åibuãs
;

529 
size3
 
tbyãs
;

530 
size3
 
fbyãs
;

531 
size3
 
abyãs
;

532 
size3
 
tfûes
;

533 
size3
 
ffûes
;

534 
size3
 
afûes
;

535 
uöt32
 
öv¨£c
;

537 
FSSTAT3ªsok
 
	tFSSTAT3ªsok
;

539 
	sFSSTAT3ªsÁû
 {

540 
po°_›_©å
 
obj_©åibuãs
;

542 
FSSTAT3ªsÁû
 
	tFSSTAT3ªsÁû
;

544 
	sFSSTAT3ªs
 {

545 
nfs°©3
 
°©us
;

547 
FSSTAT3ªsok
 
ªsok
;

548 
FSSTAT3ªsÁû
 
ªsÁû
;

549 } 
FSSTAT3ªs_u
;

551 
FSSTAT3ªs
 
	tFSSTAT3ªs
;

553 
	sPATHCONF3¨gs
 {

554 
nfs_fh3
 
obje˘
;

556 
PATHCONF3¨gs
 
	tPATHCONF3¨gs
;

558 
	sPATHCONF3ªsok
 {

559 
po°_›_©å
 
obj_©åibuãs
;

560 
uöt32
 
lökmax
;

561 
uöt32
 
«me_max
;

562 
boﬁ_t
 
no_åunc
;

563 
boﬁ_t
 
chown_ª°ri˘ed
;

564 
boﬁ_t
 
ˇ£_ö£nsôive
;

565 
boﬁ_t
 
ˇ£_¥e£rvög
;

567 
PATHCONF3ªsok
 
	tPATHCONF3ªsok
;

569 
	sPATHCONF3ªsÁû
 {

570 
po°_›_©å
 
obj_©åibuãs
;

572 
PATHCONF3ªsÁû
 
	tPATHCONF3ªsÁû
;

574 
	sPATHCONF3ªs
 {

575 
nfs°©3
 
°©us
;

577 
PATHCONF3ªsok
 
ªsok
;

578 
PATHCONF3ªsÁû
 
ªsÁû
;

579 } 
PATHCONF3ªs_u
;

581 
PATHCONF3ªs
 
	tPATHCONF3ªs
;

583 *
	tnf•©h3
;

585 
	ssymlökd©a3
 {

586 
ßâr3
 
symlök_©åibuãs
;

587 
nf•©h3
 
symlök_d©a
;

589 
symlökd©a3
 
	tsymlökd©a3
;

591 
	sSYMLINK3¨gs
 {

592 
dú›¨gs3
 
whîe
;

593 
symlökd©a3
 
symlök
;

595 
SYMLINK3¨gs
 
	tSYMLINK3¨gs
;

597 
	sSYMLINK3ªsok
 {

598 
po°_›_fh3
 
obj
;

599 
po°_›_©å
 
obj_©åibuãs
;

600 
wcc_d©a
 
dú_wcc
;

602 
SYMLINK3ªsok
 
	tSYMLINK3ªsok
;

604 
	sSYMLINK3ªsÁû
 {

605 
wcc_d©a
 
dú_wcc
;

607 
SYMLINK3ªsÁû
 
	tSYMLINK3ªsÁû
;

609 
	sSYMLINK3ªs
 {

610 
nfs°©3
 
°©us
;

612 
SYMLINK3ªsok
 
ªsok
;

613 
SYMLINK3ªsÁû
 
ªsÁû
;

614 } 
SYMLINK3ªs_u
;

616 
SYMLINK3ªs
 
	tSYMLINK3ªs
;

618 
	sREADLINK3¨gs
 {

619 
nfs_fh3
 
symlök
;

621 
READLINK3¨gs
 
	tREADLINK3¨gs
;

623 
	sREADLINK3ªsok
 {

624 
po°_›_©å
 
symlök_©åibuãs
;

625 
nf•©h3
 
d©a
;

627 
READLINK3ªsok
 
	tREADLINK3ªsok
;

629 
	sREADLINK3ªsÁû
 {

630 
po°_›_©å
 
symlök_©åibuãs
;

632 
READLINK3ªsÁû
 
	tREADLINK3ªsÁû
;

634 
	sREADLINK3ªs
 {

635 
nfs°©3
 
°©us
;

637 
READLINK3ªsok
 
ªsok
;

638 
READLINK3ªsÁû
 
ªsÁû
;

639 } 
READLINK3ªs_u
;

641 
READLINK3ªs
 
	tREADLINK3ªs
;

643 
	sdevi˚d©a3
 {

644 
ßâr3
 
dev_©åibuãs
;

645 
•ecd©a3
 
•ec
;

647 
devi˚d©a3
 
	tdevi˚d©a3
;

649 
	smknodd©a3
 {

650 
·y≥3
 
ty≥
;

652 
devi˚d©a3
 
devi˚
;

653 
ßâr3
 
pùe_©åibuãs
;

654 } 
mknodd©a3_u
;

656 
mknodd©a3
 
	tmknodd©a3
;

658 
	sMKNOD3¨gs
 {

659 
dú›¨gs3
 
whîe
;

660 
mknodd©a3
 
wh©
;

662 
MKNOD3¨gs
 
	tMKNOD3¨gs
;

664 
	sMKNOD3ªsok
 {

665 
po°_›_fh3
 
obj
;

666 
po°_›_©å
 
obj_©åibuãs
;

667 
wcc_d©a
 
dú_wcc
;

669 
MKNOD3ªsok
 
	tMKNOD3ªsok
;

671 
	sMKNOD3ªsÁû
 {

672 
wcc_d©a
 
dú_wcc
;

674 
MKNOD3ªsÁû
 
	tMKNOD3ªsÁû
;

676 
	sMKNOD3ªs
 {

677 
nfs°©3
 
°©us
;

679 
MKNOD3ªsok
 
ªsok
;

680 
MKNOD3ªsÁû
 
ªsÁû
;

681 } 
MKNOD3ªs_u
;

683 
MKNOD3ªs
 
	tMKNOD3ªs
;

685 
	sMKDIR3¨gs
 {

686 
dú›¨gs3
 
whîe
;

687 
ßâr3
 
©åibuãs
;

689 
MKDIR3¨gs
 
	tMKDIR3¨gs
;

691 
	sMKDIR3ªsok
 {

692 
po°_›_fh3
 
obj
;

693 
po°_›_©å
 
obj_©åibuãs
;

694 
wcc_d©a
 
dú_wcc
;

696 
MKDIR3ªsok
 
	tMKDIR3ªsok
;

698 
	sMKDIR3ªsÁû
 {

699 
wcc_d©a
 
dú_wcc
;

701 
MKDIR3ªsÁû
 
	tMKDIR3ªsÁû
;

703 
	sMKDIR3ªs
 {

704 
nfs°©3
 
°©us
;

706 
MKDIR3ªsok
 
ªsok
;

707 
MKDIR3ªsÁû
 
ªsÁû
;

708 } 
MKDIR3ªs_u
;

710 
MKDIR3ªs
 
	tMKDIR3ªs
;

712 
	sRMDIR3¨gs
 {

713 
dú›¨gs3
 
obje˘
;

715 
RMDIR3¨gs
 
	tRMDIR3¨gs
;

717 
	sRMDIR3ªsok
 {

718 
wcc_d©a
 
dú_wcc
;

720 
RMDIR3ªsok
 
	tRMDIR3ªsok
;

722 
	sRMDIR3ªsÁû
 {

723 
wcc_d©a
 
dú_wcc
;

725 
RMDIR3ªsÁû
 
	tRMDIR3ªsÁû
;

727 
	sRMDIR3ªs
 {

728 
nfs°©3
 
°©us
;

730 
RMDIR3ªsok
 
ªsok
;

731 
RMDIR3ªsÁû
 
ªsÁû
;

732 } 
RMDIR3ªs_u
;

734 
RMDIR3ªs
 
	tRMDIR3ªs
;

736 
	sRENAME3¨gs
 {

737 
dú›¨gs3
 
‰om
;

738 
dú›¨gs3
 
to
;

740 
RENAME3¨gs
 
	tRENAME3¨gs
;

742 
	sRENAME3ªsok
 {

743 
wcc_d©a
 
‰omdú_wcc
;

744 
wcc_d©a
 
todú_wcc
;

746 
RENAME3ªsok
 
	tRENAME3ªsok
;

748 
	sRENAME3ªsÁû
 {

749 
wcc_d©a
 
‰omdú_wcc
;

750 
wcc_d©a
 
todú_wcc
;

752 
RENAME3ªsÁû
 
	tRENAME3ªsÁû
;

754 
	sRENAME3ªs
 {

755 
nfs°©3
 
°©us
;

757 
RENAME3ªsok
 
ªsok
;

758 
RENAME3ªsÁû
 
ªsÁû
;

759 } 
RENAME3ªs_u
;

761 
RENAME3ªs
 
	tRENAME3ªs
;

763 
	sREADDIRPLUS3¨gs
 {

764 
nfs_fh3
 
dú
;

765 
cookõ3
 
cookõ
;

766 
cookõvîf3
 
cookõvîf
;

767 
cou¡3
 
dúcou¡
;

768 
cou¡3
 
maxcou¡
;

770 
READDIRPLUS3¨gs
 
	tREADDIRPLUS3¨gs
;

772 
	síåy∂us3
 {

773 
fûeid3
 
fûeid
;

774 
fûíame3
 
«me
;

775 
cookõ3
 
cookõ
;

776 
po°_›_©å
 
«me_©åibuãs
;

777 
po°_›_fh3
 
«me_h™dÀ
;

778 
íåy∂us3
 *
√xã¡ry
;

780 
íåy∂us3
 
	tíåy∂us3
;

782 
	sdúli°∂us3
 {

783 
íåy∂us3
 *
íåõs
;

784 
boﬁ_t
 
eof
;

786 
dúli°∂us3
 
	tdúli°∂us3
;

788 
	sREADDIRPLUS3ªsok
 {

789 
po°_›_©å
 
dú_©åibuãs
;

790 
cookõvîf3
 
cookõvîf
;

791 
dúli°∂us3
 
ª∂y
;

793 
READDIRPLUS3ªsok
 
	tREADDIRPLUS3ªsok
;

795 
	sREADDIRPLUS3ªsÁû
 {

796 
po°_›_©å
 
dú_©åibuãs
;

798 
READDIRPLUS3ªsÁû
 
	tREADDIRPLUS3ªsÁû
;

800 
	sREADDIRPLUS3ªs
 {

801 
nfs°©3
 
°©us
;

803 
READDIRPLUS3ªsok
 
ªsok
;

804 
READDIRPLUS3ªsÁû
 
ªsÁû
;

805 } 
READDIRPLUS3ªs_u
;

807 
READDIRPLUS3ªs
 
	tREADDIRPLUS3ªs
;

809 
	sREADDIR3¨gs
 {

810 
nfs_fh3
 
dú
;

811 
cookõ3
 
cookõ
;

812 
cookõvîf3
 
cookõvîf
;

813 
cou¡3
 
cou¡
;

815 
READDIR3¨gs
 
	tREADDIR3¨gs
;

817 
	síåy3
 {

818 
fûeid3
 
fûeid
;

819 
fûíame3
 
«me
;

820 
cookõ3
 
cookõ
;

821 
íåy3
 *
√xã¡ry
;

823 
íåy3
 
	tíåy3
;

825 
	sdúli°3
 {

826 
íåy3
 *
íåõs
;

827 
boﬁ_t
 
eof
;

829 
dúli°3
 
	tdúli°3
;

831 
	sREADDIR3ªsok
 {

832 
po°_›_©å
 
dú_©åibuãs
;

833 
cookõvîf3
 
cookõvîf
;

834 
dúli°3
 
ª∂y
;

836 
READDIR3ªsok
 
	tREADDIR3ªsok
;

838 
	sREADDIR3ªsÁû
 {

839 
po°_›_©å
 
dú_©åibuãs
;

841 
READDIR3ªsÁû
 
	tREADDIR3ªsÁû
;

843 
	sREADDIR3ªs
 {

844 
nfs°©3
 
°©us
;

846 
READDIR3ªsok
 
ªsok
;

847 
READDIR3ªsÁû
 
ªsÁû
;

848 } 
READDIR3ªs_u
;

850 
READDIR3ªs
 
	tREADDIR3ªs
;

852 
	sLINK3¨gs
 {

853 
nfs_fh3
 
fûe
;

854 
dú›¨gs3
 
lök
;

856 
LINK3¨gs
 
	tLINK3¨gs
;

858 
	sLINK3ªsok
 {

859 
po°_›_©å
 
fûe_©åibuãs
;

860 
wcc_d©a
 
lökdú_wcc
;

862 
LINK3ªsok
 
	tLINK3ªsok
;

864 
	sLINK3ªsÁû
 {

865 
po°_›_©å
 
fûe_©åibuãs
;

866 
wcc_d©a
 
lökdú_wcc
;

868 
LINK3ªsÁû
 
	tLINK3ªsÁû
;

870 
	sLINK3ªs
 {

871 
nfs°©3
 
°©us
;

873 
LINK3ªsok
 
ªsok
;

874 
LINK3ªsÁû
 
ªsÁû
;

875 } 
LINK3ªs_u
;

877 
LINK3ªs
 
	tLINK3ªs
;

879 
	sßârgu¨d3
 {

880 
boﬁ_t
 
check
;

882 
nf°ime3
 
obj_˘ime
;

883 } 
ßârgu¨d3_u
;

885 
ßârgu¨d3
 
	tßârgu¨d3
;

887 
	sSETATTR3¨gs
 {

888 
nfs_fh3
 
obje˘
;

889 
ßâr3
 
√w_©åibuãs
;

890 
ßârgu¨d3
 
gu¨d
;

892 
SETATTR3¨gs
 
	tSETATTR3¨gs
;

894 
	sSETATTR3ªsok
 {

895 
wcc_d©a
 
obj_wcc
;

897 
SETATTR3ªsok
 
	tSETATTR3ªsok
;

899 
	sSETATTR3ªsÁû
 {

900 
wcc_d©a
 
obj_wcc
;

902 
SETATTR3ªsÁû
 
	tSETATTR3ªsÁû
;

904 
	sSETATTR3ªs
 {

905 
nfs°©3
 
°©us
;

907 
SETATTR3ªsok
 
ªsok
;

908 
SETATTR3ªsÁû
 
ªsÁû
;

909 } 
SETATTR3ªs_u
;

911 
SETATTR3ªs
 
	tSETATTR3ªs
;

913 
	#NFS_PROGRAM
 100003

	)

914 
	#NFS_V3
 3

	)

916 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

917 
	#NFS3_NULL
 0

	)

918 * 
nfs3_nuŒ_3
(*, 
CLIENT
 *);

919 * 
nfs3_nuŒ_3_svc
(*, 
svc_ªq
 *);

920 
	#NFS3_GETATTR
 1

	)

921 
GETATTR3ªs
 * 
nfs3_gë©å_3
(
GETATTR3¨gs
 *, 
CLIENT
 *);

922 
GETATTR3ªs
 * 
nfs3_gë©å_3_svc
(
GETATTR3¨gs
 *, 
svc_ªq
 *);

923 
	#NFS3_SETATTR
 2

	)

924 
SETATTR3ªs
 * 
nfs3_£èâr_3
(
SETATTR3¨gs
 *, 
CLIENT
 *);

925 
SETATTR3ªs
 * 
nfs3_£èâr_3_svc
(
SETATTR3¨gs
 *, 
svc_ªq
 *);

926 
	#NFS3_LOOKUP
 3

	)

927 
LOOKUP3ªs
 * 
nfs3_lookup_3
(
LOOKUP3¨gs
 *, 
CLIENT
 *);

928 
LOOKUP3ªs
 * 
nfs3_lookup_3_svc
(
LOOKUP3¨gs
 *, 
svc_ªq
 *);

929 
	#NFS3_ACCESS
 4

	)

930 
ACCESS3ªs
 * 
nfs3_ac˚ss_3
(
ACCESS3¨gs
 *, 
CLIENT
 *);

931 
ACCESS3ªs
 * 
nfs3_ac˚ss_3_svc
(
ACCESS3¨gs
 *, 
svc_ªq
 *);

932 
	#NFS3_READLINK
 5

	)

933 
READLINK3ªs
 * 
nfs3_ªadlök_3
(
READLINK3¨gs
 *, 
CLIENT
 *);

934 
READLINK3ªs
 * 
nfs3_ªadlök_3_svc
(
READLINK3¨gs
 *, 
svc_ªq
 *);

935 
	#NFS3_READ
 6

	)

936 
READ3ªs
 * 
nfs3_ªad_3
(
READ3¨gs
 *, 
CLIENT
 *);

937 
READ3ªs
 * 
nfs3_ªad_3_svc
(
READ3¨gs
 *, 
svc_ªq
 *);

938 
	#NFS3_WRITE
 7

	)

939 
WRITE3ªs
 * 
nfs3_wrôe_3
(
WRITE3¨gs
 *, 
CLIENT
 *);

940 
WRITE3ªs
 * 
nfs3_wrôe_3_svc
(
WRITE3¨gs
 *, 
svc_ªq
 *);

941 
	#NFS3_CREATE
 8

	)

942 
CREATE3ªs
 * 
nfs3_¸óã_3
(
CREATE3¨gs
 *, 
CLIENT
 *);

943 
CREATE3ªs
 * 
nfs3_¸óã_3_svc
(
CREATE3¨gs
 *, 
svc_ªq
 *);

944 
	#NFS3_MKDIR
 9

	)

945 
MKDIR3ªs
 * 
nfs3_mkdú_3
(
MKDIR3¨gs
 *, 
CLIENT
 *);

946 
MKDIR3ªs
 * 
nfs3_mkdú_3_svc
(
MKDIR3¨gs
 *, 
svc_ªq
 *);

947 
	#NFS3_SYMLINK
 10

	)

948 
SYMLINK3ªs
 * 
nfs3_symlök_3
(
SYMLINK3¨gs
 *, 
CLIENT
 *);

949 
SYMLINK3ªs
 * 
nfs3_symlök_3_svc
(
SYMLINK3¨gs
 *, 
svc_ªq
 *);

950 
	#NFS3_REMOVE
 12

	)

951 
REMOVE3ªs
 * 
nfs3_ªmove_3
(
REMOVE3¨gs
 *, 
CLIENT
 *);

952 
REMOVE3ªs
 * 
nfs3_ªmove_3_svc
(
REMOVE3¨gs
 *, 
svc_ªq
 *);

953 
	#NFS3_RMDIR
 13

	)

954 
RMDIR3ªs
 * 
nfs3_rmdú_3
(
RMDIR3¨gs
 *, 
CLIENT
 *);

955 
RMDIR3ªs
 * 
nfs3_rmdú_3_svc
(
RMDIR3¨gs
 *, 
svc_ªq
 *);

956 
	#NFS3_RENAME
 14

	)

957 
RENAME3ªs
 * 
nfs3_ª«me_3
(
RENAME3¨gs
 *, 
CLIENT
 *);

958 
RENAME3ªs
 * 
nfs3_ª«me_3_svc
(
RENAME3¨gs
 *, 
svc_ªq
 *);

959 
	#NFS3_LINK
 15

	)

960 
LINK3ªs
 * 
nfs3_lök_3
(
LINK3¨gs
 *, 
CLIENT
 *);

961 
LINK3ªs
 * 
nfs3_lök_3_svc
(
LINK3¨gs
 *, 
svc_ªq
 *);

962 
	#NFS3_READDIR
 16

	)

963 
READDIR3ªs
 * 
nfs3_ªaddú_3
(
READDIR3¨gs
 *, 
CLIENT
 *);

964 
READDIR3ªs
 * 
nfs3_ªaddú_3_svc
(
READDIR3¨gs
 *, 
svc_ªq
 *);

965 
	#NFS3_READDIRPLUS
 17

	)

966 
READDIRPLUS3ªs
 * 
nfs3_ªaddú∂us_3
(
READDIRPLUS3¨gs
 *, 
CLIENT
 *);

967 
READDIRPLUS3ªs
 * 
nfs3_ªaddú∂us_3_svc
(
READDIRPLUS3¨gs
 *, 
svc_ªq
 *);

968 
	#NFS3_FSSTAT
 18

	)

969 
FSSTAT3ªs
 * 
nfs3_fs°©_3
(
FSSTAT3¨gs
 *, 
CLIENT
 *);

970 
FSSTAT3ªs
 * 
nfs3_fs°©_3_svc
(
FSSTAT3¨gs
 *, 
svc_ªq
 *);

971 
	#NFS3_FSINFO
 19

	)

972 
FSINFO3ªs
 * 
nfs3_fsöfo_3
(
FSINFO3¨gs
 *, 
CLIENT
 *);

973 
FSINFO3ªs
 * 
nfs3_fsöfo_3_svc
(
FSINFO3¨gs
 *, 
svc_ªq
 *);

974 
	#NFS3_PATHCONF
 20

	)

975 
PATHCONF3ªs
 * 
nfs3_∑thc⁄f_3
(
PATHCONF3¨gs
 *, 
CLIENT
 *);

976 
PATHCONF3ªs
 * 
nfs3_∑thc⁄f_3_svc
(
PATHCONF3¨gs
 *, 
svc_ªq
 *);

977 
	#NFS3_COMMIT
 21

	)

978 
COMMIT3ªs
 * 
nfs3_commô_3
(
COMMIT3¨gs
 *, 
CLIENT
 *);

979 
COMMIT3ªs
 * 
nfs3_commô_3_svc
(
COMMIT3¨gs
 *, 
svc_ªq
 *);

980 
nfs_¥ogøm_3_‰ìªsu…
 (
SVCXPRT
 *, 
xdΩroc_t
, 
ˇddr_t
);

983 
	#NFS3_NULL
 0

	)

984 * 
nfs3_nuŒ_3
();

985 * 
nfs3_nuŒ_3_svc
();

986 
	#NFS3_GETATTR
 1

	)

987 
GETATTR3ªs
 * 
nfs3_gë©å_3
();

988 
GETATTR3ªs
 * 
nfs3_gë©å_3_svc
();

989 
	#NFS3_SETATTR
 2

	)

990 
SETATTR3ªs
 * 
nfs3_£èâr_3
();

991 
SETATTR3ªs
 * 
nfs3_£èâr_3_svc
();

992 
	#NFS3_LOOKUP
 3

	)

993 
LOOKUP3ªs
 * 
nfs3_lookup_3
();

994 
LOOKUP3ªs
 * 
nfs3_lookup_3_svc
();

995 
	#NFS3_ACCESS
 4

	)

996 
ACCESS3ªs
 * 
nfs3_ac˚ss_3
();

997 
ACCESS3ªs
 * 
nfs3_ac˚ss_3_svc
();

998 
	#NFS3_READLINK
 5

	)

999 
READLINK3ªs
 * 
nfs3_ªadlök_3
();

1000 
READLINK3ªs
 * 
nfs3_ªadlök_3_svc
();

1001 
	#NFS3_READ
 6

	)

1002 
READ3ªs
 * 
nfs3_ªad_3
();

1003 
READ3ªs
 * 
nfs3_ªad_3_svc
();

1004 
	#NFS3_WRITE
 7

	)

1005 
WRITE3ªs
 * 
nfs3_wrôe_3
();

1006 
WRITE3ªs
 * 
nfs3_wrôe_3_svc
();

1007 
	#NFS3_CREATE
 8

	)

1008 
CREATE3ªs
 * 
nfs3_¸óã_3
();

1009 
CREATE3ªs
 * 
nfs3_¸óã_3_svc
();

1010 
	#NFS3_MKDIR
 9

	)

1011 
MKDIR3ªs
 * 
nfs3_mkdú_3
();

1012 
MKDIR3ªs
 * 
nfs3_mkdú_3_svc
();

1013 
	#NFS3_SYMLINK
 10

	)

1014 
SYMLINK3ªs
 * 
nfs3_symlök_3
();

1015 
SYMLINK3ªs
 * 
nfs3_symlök_3_svc
();

1016 
	#NFS3_REMOVE
 12

	)

1017 
REMOVE3ªs
 * 
nfs3_ªmove_3
();

1018 
REMOVE3ªs
 * 
nfs3_ªmove_3_svc
();

1019 
	#NFS3_RMDIR
 13

	)

1020 
RMDIR3ªs
 * 
nfs3_rmdú_3
();

1021 
RMDIR3ªs
 * 
nfs3_rmdú_3_svc
();

1022 
	#NFS3_RENAME
 14

	)

1023 
RENAME3ªs
 * 
nfs3_ª«me_3
();

1024 
RENAME3ªs
 * 
nfs3_ª«me_3_svc
();

1025 
	#NFS3_LINK
 15

	)

1026 
LINK3ªs
 * 
nfs3_lök_3
();

1027 
LINK3ªs
 * 
nfs3_lök_3_svc
();

1028 
	#NFS3_READDIR
 16

	)

1029 
READDIR3ªs
 * 
nfs3_ªaddú_3
();

1030 
READDIR3ªs
 * 
nfs3_ªaddú_3_svc
();

1031 
	#NFS3_READDIRPLUS
 17

	)

1032 
READDIRPLUS3ªs
 * 
nfs3_ªaddú∂us_3
();

1033 
READDIRPLUS3ªs
 * 
nfs3_ªaddú∂us_3_svc
();

1034 
	#NFS3_FSSTAT
 18

	)

1035 
FSSTAT3ªs
 * 
nfs3_fs°©_3
();

1036 
FSSTAT3ªs
 * 
nfs3_fs°©_3_svc
();

1037 
	#NFS3_FSINFO
 19

	)

1038 
FSINFO3ªs
 * 
nfs3_fsöfo_3
();

1039 
FSINFO3ªs
 * 
nfs3_fsöfo_3_svc
();

1040 
	#NFS3_PATHCONF
 20

	)

1041 
PATHCONF3ªs
 * 
nfs3_∑thc⁄f_3
();

1042 
PATHCONF3ªs
 * 
nfs3_∑thc⁄f_3_svc
();

1043 
	#NFS3_COMMIT
 21

	)

1044 
COMMIT3ªs
 * 
nfs3_commô_3
();

1045 
COMMIT3ªs
 * 
nfs3_commô_3_svc
();

1046 
nfs_¥ogøm_3_‰ìªsu…
 ();

1051 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

1052 
boﬁ_t
 
xdr_cookõvîf3
 (
XDR
 *, 
cookõvîf3
);

1053 
boﬁ_t
 
xdr_uöt64
 (
XDR
 *, 
uöt64
*);

1054 
boﬁ_t
 
xdr_cookõ3
 (
XDR
 *, 
cookõ3
*);

1055 
boﬁ_t
 
xdr_nfs_fh3
 (
XDR
 *, 
nfs_fh3
*);

1056 
boﬁ_t
 
xdr_fûíame3
 (
XDR
 *, 
fûíame3
*);

1057 
boﬁ_t
 
xdr_dú›¨gs3
 (
XDR
 *, 
dú›¨gs3
*);

1058 
boﬁ_t
 
xdr_·y≥3
 (
XDR
 *, 
·y≥3
*);

1059 
boﬁ_t
 
xdr_uöt32
 (
XDR
 *, 
uöt32
*);

1060 
boﬁ_t
 
xdr_öt32
 (
XDR
 *, 
öt32
*);

1061 
boﬁ_t
 
xdr_mode3
 (
XDR
 *, 
mode3
*);

1062 
boﬁ_t
 
xdr_uid3
 (
XDR
 *, 
uid3
*);

1063 
boﬁ_t
 
xdr_gid3
 (
XDR
 *, 
gid3
*);

1064 
boﬁ_t
 
xdr_size3
 (
XDR
 *, 
size3
*);

1065 
boﬁ_t
 
xdr_fûeid3
 (
XDR
 *, 
fûeid3
*);

1066 
boﬁ_t
 
xdr_•ecd©a3
 (
XDR
 *, 
•ecd©a3
*);

1067 
boﬁ_t
 
xdr_nf°ime3
 (
XDR
 *, 
nf°ime3
*);

1068 
boﬁ_t
 
xdr_Áâr3
 (
XDR
 *, 
Áâr3
*);

1069 
boﬁ_t
 
xdr_po°_›_©å
 (
XDR
 *, 
po°_›_©å
*);

1070 
boﬁ_t
 
xdr_nfs°©3
 (
XDR
 *, 
nfs°©3
*);

1071 
boﬁ_t
 
xdr_°abÀ_how
 (
XDR
 *, 
°abÀ_how
*);

1072 
boﬁ_t
 
xdr_off£t3
 (
XDR
 *, 
off£t3
*);

1073 
boﬁ_t
 
xdr_cou¡3
 (
XDR
 *, 
cou¡3
*);

1074 
boﬁ_t
 
xdr_wcc_©å
 (
XDR
 *, 
wcc_©å
*);

1075 
boﬁ_t
 
xdr_¥e_›_©å
 (
XDR
 *, 
¥e_›_©å
*);

1076 
boﬁ_t
 
xdr_wcc_d©a
 (
XDR
 *, 
wcc_d©a
*);

1077 
boﬁ_t
 
xdr_WRITE3¨gs
 (
XDR
 *, 
WRITE3¨gs
*);

1078 
boﬁ_t
 
xdr_wrôevîf3
 (
XDR
 *, 
wrôevîf3
);

1079 
boﬁ_t
 
xdr_WRITE3ªsok
 (
XDR
 *, 
WRITE3ªsok
*);

1080 
boﬁ_t
 
xdr_WRITE3ªsÁû
 (
XDR
 *, 
WRITE3ªsÁû
*);

1081 
boﬁ_t
 
xdr_WRITE3ªs
 (
XDR
 *, 
WRITE3ªs
*);

1082 
boﬁ_t
 
xdr_LOOKUP3¨gs
 (
XDR
 *, 
LOOKUP3¨gs
*);

1083 
boﬁ_t
 
xdr_LOOKUP3ªsok
 (
XDR
 *, 
LOOKUP3ªsok
*);

1084 
boﬁ_t
 
xdr_LOOKUP3ªsÁû
 (
XDR
 *, 
LOOKUP3ªsÁû
*);

1085 
boﬁ_t
 
xdr_LOOKUP3ªs
 (
XDR
 *, 
LOOKUP3ªs
*);

1086 
boﬁ_t
 
xdr_COMMIT3¨gs
 (
XDR
 *, 
COMMIT3¨gs
*);

1087 
boﬁ_t
 
xdr_COMMIT3ªsok
 (
XDR
 *, 
COMMIT3ªsok
*);

1088 
boﬁ_t
 
xdr_COMMIT3ªsÁû
 (
XDR
 *, 
COMMIT3ªsÁû
*);

1089 
boﬁ_t
 
xdr_COMMIT3ªs
 (
XDR
 *, 
COMMIT3ªs
*);

1090 
boﬁ_t
 
xdr_ACCESS3¨gs
 (
XDR
 *, 
ACCESS3¨gs
*);

1091 
boﬁ_t
 
xdr_ACCESS3ªsok
 (
XDR
 *, 
ACCESS3ªsok
*);

1092 
boﬁ_t
 
xdr_ACCESS3ªsÁû
 (
XDR
 *, 
ACCESS3ªsÁû
*);

1093 
boﬁ_t
 
xdr_ACCESS3ªs
 (
XDR
 *, 
ACCESS3ªs
*);

1094 
boﬁ_t
 
xdr_GETATTR3¨gs
 (
XDR
 *, 
GETATTR3¨gs
*);

1095 
boﬁ_t
 
xdr_GETATTR3ªsok
 (
XDR
 *, 
GETATTR3ªsok
*);

1096 
boﬁ_t
 
xdr_GETATTR3ªs
 (
XDR
 *, 
GETATTR3ªs
*);

1097 
boﬁ_t
 
xdr_time_how
 (
XDR
 *, 
time_how
*);

1098 
boﬁ_t
 
xdr_£t_mode3
 (
XDR
 *, 
£t_mode3
*);

1099 
boﬁ_t
 
xdr_£t_uid3
 (
XDR
 *, 
£t_uid3
*);

1100 
boﬁ_t
 
xdr_£t_gid3
 (
XDR
 *, 
£t_gid3
*);

1101 
boﬁ_t
 
xdr_£t_size3
 (
XDR
 *, 
£t_size3
*);

1102 
boﬁ_t
 
xdr_£t_©ime
 (
XDR
 *, 
£t_©ime
*);

1103 
boﬁ_t
 
xdr_£t_mtime
 (
XDR
 *, 
£t_mtime
*);

1104 
boﬁ_t
 
xdr_ßâr3
 (
XDR
 *, 
ßâr3
*);

1105 
boﬁ_t
 
xdr_¸óãmode3
 (
XDR
 *, 
¸óãmode3
*);

1106 
boﬁ_t
 
xdr_¸óãvîf3
 (
XDR
 *, 
¸óãvîf3
);

1107 
boﬁ_t
 
xdr_¸óãhow3
 (
XDR
 *, 
¸óãhow3
*);

1108 
boﬁ_t
 
xdr_CREATE3¨gs
 (
XDR
 *, 
CREATE3¨gs
*);

1109 
boﬁ_t
 
xdr_po°_›_fh3
 (
XDR
 *, 
po°_›_fh3
*);

1110 
boﬁ_t
 
xdr_CREATE3ªsok
 (
XDR
 *, 
CREATE3ªsok
*);

1111 
boﬁ_t
 
xdr_CREATE3ªsÁû
 (
XDR
 *, 
CREATE3ªsÁû
*);

1112 
boﬁ_t
 
xdr_CREATE3ªs
 (
XDR
 *, 
CREATE3ªs
*);

1113 
boﬁ_t
 
xdr_REMOVE3¨gs
 (
XDR
 *, 
REMOVE3¨gs
*);

1114 
boﬁ_t
 
xdr_REMOVE3ªsok
 (
XDR
 *, 
REMOVE3ªsok
*);

1115 
boﬁ_t
 
xdr_REMOVE3ªsÁû
 (
XDR
 *, 
REMOVE3ªsÁû
*);

1116 
boﬁ_t
 
xdr_REMOVE3ªs
 (
XDR
 *, 
REMOVE3ªs
*);

1117 
boﬁ_t
 
xdr_READ3¨gs
 (
XDR
 *, 
READ3¨gs
*);

1118 
boﬁ_t
 
xdr_READ3ªsok
 (
XDR
 *, 
READ3ªsok
*);

1119 
boﬁ_t
 
xdr_READ3ªsÁû
 (
XDR
 *, 
READ3ªsÁû
*);

1120 
boﬁ_t
 
xdr_READ3ªs
 (
XDR
 *, 
READ3ªs
*);

1121 
boﬁ_t
 
xdr_FSINFO3¨gs
 (
XDR
 *, 
FSINFO3¨gs
*);

1122 
boﬁ_t
 
xdr_FSINFO3ªsok
 (
XDR
 *, 
FSINFO3ªsok
*);

1123 
boﬁ_t
 
xdr_FSINFO3ªsÁû
 (
XDR
 *, 
FSINFO3ªsÁû
*);

1124 
boﬁ_t
 
xdr_FSINFO3ªs
 (
XDR
 *, 
FSINFO3ªs
*);

1125 
boﬁ_t
 
xdr_FSSTAT3¨gs
 (
XDR
 *, 
FSSTAT3¨gs
*);

1126 
boﬁ_t
 
xdr_FSSTAT3ªsok
 (
XDR
 *, 
FSSTAT3ªsok
*);

1127 
boﬁ_t
 
xdr_FSSTAT3ªsÁû
 (
XDR
 *, 
FSSTAT3ªsÁû
*);

1128 
boﬁ_t
 
xdr_FSSTAT3ªs
 (
XDR
 *, 
FSSTAT3ªs
*);

1129 
boﬁ_t
 
xdr_PATHCONF3¨gs
 (
XDR
 *, 
PATHCONF3¨gs
*);

1130 
boﬁ_t
 
xdr_PATHCONF3ªsok
 (
XDR
 *, 
PATHCONF3ªsok
*);

1131 
boﬁ_t
 
xdr_PATHCONF3ªsÁû
 (
XDR
 *, 
PATHCONF3ªsÁû
*);

1132 
boﬁ_t
 
xdr_PATHCONF3ªs
 (
XDR
 *, 
PATHCONF3ªs
*);

1133 
boﬁ_t
 
xdr_nf•©h3
 (
XDR
 *, 
nf•©h3
*);

1134 
boﬁ_t
 
xdr_symlökd©a3
 (
XDR
 *, 
symlökd©a3
*);

1135 
boﬁ_t
 
xdr_SYMLINK3¨gs
 (
XDR
 *, 
SYMLINK3¨gs
*);

1136 
boﬁ_t
 
xdr_SYMLINK3ªsok
 (
XDR
 *, 
SYMLINK3ªsok
*);

1137 
boﬁ_t
 
xdr_SYMLINK3ªsÁû
 (
XDR
 *, 
SYMLINK3ªsÁû
*);

1138 
boﬁ_t
 
xdr_SYMLINK3ªs
 (
XDR
 *, 
SYMLINK3ªs
*);

1139 
boﬁ_t
 
xdr_READLINK3¨gs
 (
XDR
 *, 
READLINK3¨gs
*);

1140 
boﬁ_t
 
xdr_READLINK3ªsok
 (
XDR
 *, 
READLINK3ªsok
*);

1141 
boﬁ_t
 
xdr_READLINK3ªsÁû
 (
XDR
 *, 
READLINK3ªsÁû
*);

1142 
boﬁ_t
 
xdr_READLINK3ªs
 (
XDR
 *, 
READLINK3ªs
*);

1143 
boﬁ_t
 
xdr_devi˚d©a3
 (
XDR
 *, 
devi˚d©a3
*);

1144 
boﬁ_t
 
xdr_mknodd©a3
 (
XDR
 *, 
mknodd©a3
*);

1145 
boﬁ_t
 
xdr_MKNOD3¨gs
 (
XDR
 *, 
MKNOD3¨gs
*);

1146 
boﬁ_t
 
xdr_MKNOD3ªsok
 (
XDR
 *, 
MKNOD3ªsok
*);

1147 
boﬁ_t
 
xdr_MKNOD3ªsÁû
 (
XDR
 *, 
MKNOD3ªsÁû
*);

1148 
boﬁ_t
 
xdr_MKNOD3ªs
 (
XDR
 *, 
MKNOD3ªs
*);

1149 
boﬁ_t
 
xdr_MKDIR3¨gs
 (
XDR
 *, 
MKDIR3¨gs
*);

1150 
boﬁ_t
 
xdr_MKDIR3ªsok
 (
XDR
 *, 
MKDIR3ªsok
*);

1151 
boﬁ_t
 
xdr_MKDIR3ªsÁû
 (
XDR
 *, 
MKDIR3ªsÁû
*);

1152 
boﬁ_t
 
xdr_MKDIR3ªs
 (
XDR
 *, 
MKDIR3ªs
*);

1153 
boﬁ_t
 
xdr_RMDIR3¨gs
 (
XDR
 *, 
RMDIR3¨gs
*);

1154 
boﬁ_t
 
xdr_RMDIR3ªsok
 (
XDR
 *, 
RMDIR3ªsok
*);

1155 
boﬁ_t
 
xdr_RMDIR3ªsÁû
 (
XDR
 *, 
RMDIR3ªsÁû
*);

1156 
boﬁ_t
 
xdr_RMDIR3ªs
 (
XDR
 *, 
RMDIR3ªs
*);

1157 
boﬁ_t
 
xdr_RENAME3¨gs
 (
XDR
 *, 
RENAME3¨gs
*);

1158 
boﬁ_t
 
xdr_RENAME3ªsok
 (
XDR
 *, 
RENAME3ªsok
*);

1159 
boﬁ_t
 
xdr_RENAME3ªsÁû
 (
XDR
 *, 
RENAME3ªsÁû
*);

1160 
boﬁ_t
 
xdr_RENAME3ªs
 (
XDR
 *, 
RENAME3ªs
*);

1161 
boﬁ_t
 
xdr_READDIRPLUS3¨gs
 (
XDR
 *, 
READDIRPLUS3¨gs
*);

1162 
boﬁ_t
 
xdr_íåy∂us3
 (
XDR
 *, 
íåy∂us3
*);

1163 
boﬁ_t
 
xdr_dúli°∂us3
 (
XDR
 *, 
dúli°∂us3
*);

1164 
boﬁ_t
 
xdr_READDIRPLUS3ªsok
 (
XDR
 *, 
READDIRPLUS3ªsok
*);

1165 
boﬁ_t
 
xdr_READDIRPLUS3ªsÁû
 (
XDR
 *, 
READDIRPLUS3ªsÁû
*);

1166 
boﬁ_t
 
xdr_READDIRPLUS3ªs
 (
XDR
 *, 
READDIRPLUS3ªs
*);

1167 
boﬁ_t
 
xdr_READDIR3¨gs
 (
XDR
 *, 
READDIR3¨gs
*);

1168 
boﬁ_t
 
xdr_íåy3
 (
XDR
 *, 
íåy3
*);

1169 
boﬁ_t
 
xdr_dúli°3
 (
XDR
 *, 
dúli°3
*);

1170 
boﬁ_t
 
xdr_READDIR3ªsok
 (
XDR
 *, 
READDIR3ªsok
*);

1171 
boﬁ_t
 
xdr_READDIR3ªsÁû
 (
XDR
 *, 
READDIR3ªsÁû
*);

1172 
boﬁ_t
 
xdr_READDIR3ªs
 (
XDR
 *, 
READDIR3ªs
*);

1173 
boﬁ_t
 
xdr_LINK3¨gs
 (
XDR
 *, 
LINK3¨gs
*);

1174 
boﬁ_t
 
xdr_LINK3ªsok
 (
XDR
 *, 
LINK3ªsok
*);

1175 
boﬁ_t
 
xdr_LINK3ªsÁû
 (
XDR
 *, 
LINK3ªsÁû
*);

1176 
boﬁ_t
 
xdr_LINK3ªs
 (
XDR
 *, 
LINK3ªs
*);

1177 
boﬁ_t
 
xdr_ßârgu¨d3
 (
XDR
 *, 
ßârgu¨d3
*);

1178 
boﬁ_t
 
xdr_SETATTR3¨gs
 (
XDR
 *, 
SETATTR3¨gs
*);

1179 
boﬁ_t
 
xdr_SETATTR3ªsok
 (
XDR
 *, 
SETATTR3ªsok
*);

1180 
boﬁ_t
 
xdr_SETATTR3ªsÁû
 (
XDR
 *, 
SETATTR3ªsÁû
*);

1181 
boﬁ_t
 
xdr_SETATTR3ªs
 (
XDR
 *, 
SETATTR3ªs
*);

1184 
boﬁ_t
 
xdr_cookõvîf3
 ();

1185 
boﬁ_t
 
xdr_uöt64
 ();

1186 
boﬁ_t
 
xdr_cookõ3
 ();

1187 
boﬁ_t
 
xdr_nfs_fh3
 ();

1188 
boﬁ_t
 
xdr_fûíame3
 ();

1189 
boﬁ_t
 
xdr_dú›¨gs3
 ();

1190 
boﬁ_t
 
xdr_·y≥3
 ();

1191 
boﬁ_t
 
xdr_uöt32
 ();

1192 
boﬁ_t
 
xdr_öt32
 ();

1193 
boﬁ_t
 
xdr_mode3
 ();

1194 
boﬁ_t
 
xdr_uid3
 ();

1195 
boﬁ_t
 
xdr_gid3
 ();

1196 
boﬁ_t
 
xdr_size3
 ();

1197 
boﬁ_t
 
xdr_fûeid3
 ();

1198 
boﬁ_t
 
xdr_•ecd©a3
 ();

1199 
boﬁ_t
 
xdr_nf°ime3
 ();

1200 
boﬁ_t
 
xdr_Áâr3
 ();

1201 
boﬁ_t
 
xdr_po°_›_©å
 ();

1202 
boﬁ_t
 
xdr_nfs°©3
 ();

1203 
boﬁ_t
 
xdr_°abÀ_how
 ();

1204 
boﬁ_t
 
xdr_off£t3
 ();

1205 
boﬁ_t
 
xdr_cou¡3
 ();

1206 
boﬁ_t
 
xdr_wcc_©å
 ();

1207 
boﬁ_t
 
xdr_¥e_›_©å
 ();

1208 
boﬁ_t
 
xdr_wcc_d©a
 ();

1209 
boﬁ_t
 
xdr_WRITE3¨gs
 ();

1210 
boﬁ_t
 
xdr_wrôevîf3
 ();

1211 
boﬁ_t
 
xdr_WRITE3ªsok
 ();

1212 
boﬁ_t
 
xdr_WRITE3ªsÁû
 ();

1213 
boﬁ_t
 
xdr_WRITE3ªs
 ();

1214 
boﬁ_t
 
xdr_LOOKUP3¨gs
 ();

1215 
boﬁ_t
 
xdr_LOOKUP3ªsok
 ();

1216 
boﬁ_t
 
xdr_LOOKUP3ªsÁû
 ();

1217 
boﬁ_t
 
xdr_LOOKUP3ªs
 ();

1218 
boﬁ_t
 
xdr_COMMIT3¨gs
 ();

1219 
boﬁ_t
 
xdr_COMMIT3ªsok
 ();

1220 
boﬁ_t
 
xdr_COMMIT3ªsÁû
 ();

1221 
boﬁ_t
 
xdr_COMMIT3ªs
 ();

1222 
boﬁ_t
 
xdr_ACCESS3¨gs
 ();

1223 
boﬁ_t
 
xdr_ACCESS3ªsok
 ();

1224 
boﬁ_t
 
xdr_ACCESS3ªsÁû
 ();

1225 
boﬁ_t
 
xdr_ACCESS3ªs
 ();

1226 
boﬁ_t
 
xdr_GETATTR3¨gs
 ();

1227 
boﬁ_t
 
xdr_GETATTR3ªsok
 ();

1228 
boﬁ_t
 
xdr_GETATTR3ªs
 ();

1229 
boﬁ_t
 
xdr_time_how
 ();

1230 
boﬁ_t
 
xdr_£t_mode3
 ();

1231 
boﬁ_t
 
xdr_£t_uid3
 ();

1232 
boﬁ_t
 
xdr_£t_gid3
 ();

1233 
boﬁ_t
 
xdr_£t_size3
 ();

1234 
boﬁ_t
 
xdr_£t_©ime
 ();

1235 
boﬁ_t
 
xdr_£t_mtime
 ();

1236 
boﬁ_t
 
xdr_ßâr3
 ();

1237 
boﬁ_t
 
xdr_¸óãmode3
 ();

1238 
boﬁ_t
 
xdr_¸óãvîf3
 ();

1239 
boﬁ_t
 
xdr_¸óãhow3
 ();

1240 
boﬁ_t
 
xdr_CREATE3¨gs
 ();

1241 
boﬁ_t
 
xdr_po°_›_fh3
 ();

1242 
boﬁ_t
 
xdr_CREATE3ªsok
 ();

1243 
boﬁ_t
 
xdr_CREATE3ªsÁû
 ();

1244 
boﬁ_t
 
xdr_CREATE3ªs
 ();

1245 
boﬁ_t
 
xdr_REMOVE3¨gs
 ();

1246 
boﬁ_t
 
xdr_REMOVE3ªsok
 ();

1247 
boﬁ_t
 
xdr_REMOVE3ªsÁû
 ();

1248 
boﬁ_t
 
xdr_REMOVE3ªs
 ();

1249 
boﬁ_t
 
xdr_READ3¨gs
 ();

1250 
boﬁ_t
 
xdr_READ3ªsok
 ();

1251 
boﬁ_t
 
xdr_READ3ªsÁû
 ();

1252 
boﬁ_t
 
xdr_READ3ªs
 ();

1253 
boﬁ_t
 
xdr_FSINFO3¨gs
 ();

1254 
boﬁ_t
 
xdr_FSINFO3ªsok
 ();

1255 
boﬁ_t
 
xdr_FSINFO3ªsÁû
 ();

1256 
boﬁ_t
 
xdr_FSINFO3ªs
 ();

1257 
boﬁ_t
 
xdr_FSSTAT3¨gs
 ();

1258 
boﬁ_t
 
xdr_FSSTAT3ªsok
 ();

1259 
boﬁ_t
 
xdr_FSSTAT3ªsÁû
 ();

1260 
boﬁ_t
 
xdr_FSSTAT3ªs
 ();

1261 
boﬁ_t
 
xdr_PATHCONF3¨gs
 ();

1262 
boﬁ_t
 
xdr_PATHCONF3ªsok
 ();

1263 
boﬁ_t
 
xdr_PATHCONF3ªsÁû
 ();

1264 
boﬁ_t
 
xdr_PATHCONF3ªs
 ();

1265 
boﬁ_t
 
xdr_nf•©h3
 ();

1266 
boﬁ_t
 
xdr_symlökd©a3
 ();

1267 
boﬁ_t
 
xdr_SYMLINK3¨gs
 ();

1268 
boﬁ_t
 
xdr_SYMLINK3ªsok
 ();

1269 
boﬁ_t
 
xdr_SYMLINK3ªsÁû
 ();

1270 
boﬁ_t
 
xdr_SYMLINK3ªs
 ();

1271 
boﬁ_t
 
xdr_READLINK3¨gs
 ();

1272 
boﬁ_t
 
xdr_READLINK3ªsok
 ();

1273 
boﬁ_t
 
xdr_READLINK3ªsÁû
 ();

1274 
boﬁ_t
 
xdr_READLINK3ªs
 ();

1275 
boﬁ_t
 
xdr_devi˚d©a3
 ();

1276 
boﬁ_t
 
xdr_mknodd©a3
 ();

1277 
boﬁ_t
 
xdr_MKNOD3¨gs
 ();

1278 
boﬁ_t
 
xdr_MKNOD3ªsok
 ();

1279 
boﬁ_t
 
xdr_MKNOD3ªsÁû
 ();

1280 
boﬁ_t
 
xdr_MKNOD3ªs
 ();

1281 
boﬁ_t
 
xdr_MKDIR3¨gs
 ();

1282 
boﬁ_t
 
xdr_MKDIR3ªsok
 ();

1283 
boﬁ_t
 
xdr_MKDIR3ªsÁû
 ();

1284 
boﬁ_t
 
xdr_MKDIR3ªs
 ();

1285 
boﬁ_t
 
xdr_RMDIR3¨gs
 ();

1286 
boﬁ_t
 
xdr_RMDIR3ªsok
 ();

1287 
boﬁ_t
 
xdr_RMDIR3ªsÁû
 ();

1288 
boﬁ_t
 
xdr_RMDIR3ªs
 ();

1289 
boﬁ_t
 
xdr_RENAME3¨gs
 ();

1290 
boﬁ_t
 
xdr_RENAME3ªsok
 ();

1291 
boﬁ_t
 
xdr_RENAME3ªsÁû
 ();

1292 
boﬁ_t
 
xdr_RENAME3ªs
 ();

1293 
boﬁ_t
 
xdr_READDIRPLUS3¨gs
 ();

1294 
boﬁ_t
 
xdr_íåy∂us3
 ();

1295 
boﬁ_t
 
xdr_dúli°∂us3
 ();

1296 
boﬁ_t
 
xdr_READDIRPLUS3ªsok
 ();

1297 
boﬁ_t
 
xdr_READDIRPLUS3ªsÁû
 ();

1298 
boﬁ_t
 
xdr_READDIRPLUS3ªs
 ();

1299 
boﬁ_t
 
xdr_READDIR3¨gs
 ();

1300 
boﬁ_t
 
xdr_íåy3
 ();

1301 
boﬁ_t
 
xdr_dúli°3
 ();

1302 
boﬁ_t
 
xdr_READDIR3ªsok
 ();

1303 
boﬁ_t
 
xdr_READDIR3ªsÁû
 ();

1304 
boﬁ_t
 
xdr_READDIR3ªs
 ();

1305 
boﬁ_t
 
xdr_LINK3¨gs
 ();

1306 
boﬁ_t
 
xdr_LINK3ªsok
 ();

1307 
boﬁ_t
 
xdr_LINK3ªsÁû
 ();

1308 
boﬁ_t
 
xdr_LINK3ªs
 ();

1309 
boﬁ_t
 
xdr_ßârgu¨d3
 ();

1310 
boﬁ_t
 
xdr_SETATTR3¨gs
 ();

1311 
boﬁ_t
 
xdr_SETATTR3ªsok
 ();

1312 
boﬁ_t
 
xdr_SETATTR3ªsÁû
 ();

1313 
boﬁ_t
 
xdr_SETATTR3ªs
 ();

1317 #ifde‡
__˝lu•lus


	@ccan/ccan/nfs/rpc/nfsacl.h

7 #i‚de‡
_NFSACL_H_RPCGEN


8 
	#_NFSACL_H_RPCGEN


	)

10 
	~<Ωc/Ωc.h
>

13 #ifde‡
__˝lu•lus


18 
	#NFSACL_PROGRAM
 100227

	)

19 
	#NFSACL_V3
 3

	)

21 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

22 
	#NFSACL3_NULL
 0

	)

23 * 
nfß˛3_nuŒ_3
(*, 
CLIENT
 *);

24 * 
nfß˛3_nuŒ_3_svc
(*, 
svc_ªq
 *);

25 
nfß˛_¥ogøm_3_‰ìªsu…
 (
SVCXPRT
 *, 
xdΩroc_t
, 
ˇddr_t
);

28 
	#NFSACL3_NULL
 0

	)

29 * 
nfß˛3_nuŒ_3
();

30 * 
nfß˛3_nuŒ_3_svc
();

31 
nfß˛_¥ogøm_3_‰ìªsu…
 ();

34 #ifde‡
__˝lu•lus


	@ccan/ccan/nfs/rpc/portmap.h

7 #i‚de‡
_PORTMAP_H_RPCGEN


8 
	#_PORTMAP_H_RPCGEN


	)

10 
	~<Ωc/Ωc.h
>

13 #ifde‡
__˝lu•lus


17 
	#PMAP_PORT
 111

	)

19 
	sm≠pög
 {

20 
u_öt
 
¥og
;

21 
u_öt
 
vîs
;

22 
u_öt
 
¥Ÿ
;

23 
u_öt
 
p‹t
;

25 
m≠pög
 
	tm≠pög
;

27 
	sˇŒ_¨gs
 {

28 
u_öt
 
¥og
;

29 
u_öt
 
vîs
;

30 
u_öt
 
¥oc
;

32 
u_öt
 
¨gs_Àn
;

33 *
¨gs_vÆ
;

34 } 
¨gs
;

36 
ˇŒ_¨gs
 
	tˇŒ_¨gs
;

38 
	#PMAP_PROGRAM
 100000

	)

39 
	#PMAP_V2
 2

	)

41 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

42 
	#PMAP_NULL
 0

	)

43 * 
pm≠_nuŒ_2
(*, 
CLIENT
 *);

44 * 
pm≠_nuŒ_2_svc
(*, 
svc_ªq
 *);

45 
	#PMAP_SET
 1

	)

46 
boﬁ_t
 * 
pm≠_£t_2
(
m≠pög
 *, 
CLIENT
 *);

47 
boﬁ_t
 * 
pm≠_£t_2_svc
(
m≠pög
 *, 
svc_ªq
 *);

48 
	#PMAP_UNSET
 2

	)

49 
boﬁ_t
 * 
pm≠_un£t_2
(
m≠pög
 *, 
CLIENT
 *);

50 
boﬁ_t
 * 
pm≠_un£t_2_svc
(
m≠pög
 *, 
svc_ªq
 *);

51 
	#PMAP_GETPORT
 3

	)

52 
u_öt
 * 
pm≠_gëp‹t_2
(
m≠pög
 *, 
CLIENT
 *);

53 
u_öt
 * 
pm≠_gëp‹t_2_svc
(
m≠pög
 *, 
svc_ªq
 *);

54 
pm≠_¥ogøm_2_‰ìªsu…
 (
SVCXPRT
 *, 
xdΩroc_t
, 
ˇddr_t
);

57 
	#PMAP_NULL
 0

	)

58 * 
pm≠_nuŒ_2
();

59 * 
pm≠_nuŒ_2_svc
();

60 
	#PMAP_SET
 1

	)

61 
boﬁ_t
 * 
pm≠_£t_2
();

62 
boﬁ_t
 * 
pm≠_£t_2_svc
();

63 
	#PMAP_UNSET
 2

	)

64 
boﬁ_t
 * 
pm≠_un£t_2
();

65 
boﬁ_t
 * 
pm≠_un£t_2_svc
();

66 
	#PMAP_GETPORT
 3

	)

67 
u_öt
 * 
pm≠_gëp‹t_2
();

68 
u_öt
 * 
pm≠_gëp‹t_2_svc
();

69 
pm≠_¥ogøm_2_‰ìªsu…
 ();

74 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

75 
boﬁ_t
 
xdr_m≠pög
 (
XDR
 *, 
m≠pög
*);

76 
boﬁ_t
 
xdr_ˇŒ_¨gs
 (
XDR
 *, 
ˇŒ_¨gs
*);

79 
boﬁ_t
 
xdr_m≠pög
 ();

80 
boﬁ_t
 
xdr_ˇŒ_¨gs
 ();

84 #ifde‡
__˝lu•lus


	@ccan/ccan/nfs/socket.c

18 
	~<°dio.h
>

19 
	~<uni°d.h
>

20 
	~<f˙é.h
>

21 
	~<pﬁl.h
>

22 
	~<°rög.h
>

23 
	~<î∫o.h
>

24 
	~<time.h
>

25 
	~<Ωc/xdr.h
>

26 
	~<¨∑/öë.h
>

27 
	~<sys/io˘l.h
>

28 
	~"nfs.h
"

29 
	~"libnfs-øw.h
"

30 
	~"libnfs-¥iv©e.h
"

31 
	~"dlökli°.h
"

33 
	$£t_n⁄blockög
(
fd
)

35 
v
;

36 
v
 = 
	`f˙é
(
fd
, 
F_GETFL
, 0);

37 
	`f˙é
(
fd
, 
F_SETFL
, 
v
 | 
O_NONBLOCK
);

38 
	}
}

40 
	$Ωc_gë_fd
(
Ωc_c⁄ãxt
 *
Ωc
)

42  
Ωc
->
fd
;

43 
	}
}

45 
	$Ωc_which_evíts
(
Ωc_c⁄ãxt
 *
Ωc
)

47 
evíts
 = 
POLLIN
;

49 i‡(
Ωc
->
is_c⁄√˘ed
 == 0) {

50 
evíts
 |
POLLOUT
;

53 i‡(
Ωc
->
outqueue
) {

54 
evíts
 |
POLLOUT
;

56  
evíts
;

57 
	}
}

59 
	$Ωc_wrôe_to_sockë
(
Ωc_c⁄ãxt
 *
Ωc
)

61 
ssize_t
 
cou¡
;

63 i‡(
Ωc
 =
NULL
) {

64 
	`¥ötf
("tryingÅo writeÅo socket for NULL context\n");

67 i‡(
Ωc
->
fd
 == -1) {

68 
	`¥ötf
("tryingÅo write butÇot connected\n");

72 
Ωc
->
outqueue
 !
NULL
) {

73 
ssize_t
 
tŸÆ
;

75 
tŸÆ
 = 
Ωc
->
outqueue
->
outd©a
.
size
;

77 
cou¡
 = 
	`wrôe
(
Ωc
->
fd
,Ñpc->
outqueue
->
outd©a
.
d©a
 +Ñpc->outqueue->
wrôãn
, 
tŸÆ
 -Ñpc->outqueue->written);

78 i‡(
cou¡
 == -1) {

79 i‡(
î∫o
 =
EAGAIN
 ||Éºnÿ=
EWOULDBLOCK
) {

80 
	`¥ötf
("socket would block,Ñeturn from writeÅo socket\n");

83 
	`¥ötf
("Eº‹ whí wrôögÅÿsockë :%s(%d)\n", 
	`°ªº‹
(
î∫o
),Érrno);

87 
Ωc
->
outqueue
->
wrôãn
 +
cou¡
;

88 i‡(
Ωc
->
outqueue
->
wrôãn
 =
tŸÆ
) {

89 
Ωc_pdu
 *
pdu
 = 
Ωc
->
outqueue
;

91 
	`DLIST_REMOVE
(
Ωc
->
outqueue
, 
pdu
);

92 
	`DLIST_ADD_END
(
Ωc
->
waôpdu
, 
pdu
, 
NULL
);

96 
	}
}

98 
	$Ωc_ªad_‰om_sockë
(
Ωc_c⁄ãxt
 *
Ωc
)

100 
avaûabÀ
;

101 
size
;

102 *
buf
;

103 
ssize_t
 
cou¡
;

105 i‡(
	`io˘l
(
Ωc
->
fd
, 
FIONREAD
, &
avaûabÀ
) != 0) {

106 
	`Ωc_£t_îr‹
(
Ωc
, "Io˘»FIONREADÑëu∫edÉº‹ : %d. Closög sockë.", 
î∫o
);

109 i‡(
avaûabÀ
 == 0) {

110 
	`Ωc_£t_îr‹
(
Ωc
, "Socket has been closed");

113 
size
 = 
Ωc
->
ösize
 -Ñpc->
öpos
 + 
avaûabÀ
;

114 
buf
 = 
	`mÆloc
(
size
);

115 i‡(
buf
 =
NULL
) {

116 
	`Ωc_£t_îr‹
(
Ωc
, "Ouào‡mem‹y: faûedÅÿÆloˇã %d byã†f‹ i≈uàbuf„r. Closög sockë.", 
size
);

119 i‡(
Ωc
->
ösize
 >Ñpc->
öpos
) {

120 
	`mem˝y
(
buf
, 
Ωc
->
öbuf
 +Ñpc->
öpos
,Ñpc->
ösize
 -Ñpc->inpos);

121 
Ωc
->
ösize
 -Ωc->
öpos
;

122 
Ωc
->
öpos
 = 0;

125 
cou¡
 = 
	`ªad
(
Ωc
->
fd
, 
buf
 +Ñpc->
ösize
, 
avaûabÀ
);

126 i‡(
cou¡
 == -1) {

127 i‡(
î∫o
 =
EINTR
) {

128 
	`‰ì
(
buf
);

129 
buf
 = 
NULL
;

132 
	`Ωc_£t_îr‹
(
Ωc
, "Ród from sockë faûed,Éºno:%d. Closög sockë.", 
î∫o
);

133 
	`‰ì
(
buf
);

134 
buf
 = 
NULL
;

138 i‡(
Ωc
->
öbuf
 !
NULL
) {

139 
	`‰ì
(
Ωc
->
öbuf
);

141 
Ωc
->
öbuf
 = (*)
buf
;

142 
Ωc
->
ösize
 +
cou¡
;

145 i‡(
Ωc
->
ösize
 -Ñpc->
öpos
 < 4) {

148 
cou¡
 = 
	`Ωc_gë_pdu_size
(
Ωc
->
öbuf
 +Ñpc->
öpos
);

149 i‡(
Ωc
->
ösize
 +Ñpc->
öpos
 < 
cou¡
) {

152 i‡(
	`Ωc_¥o˚ss_pdu
(
Ωc
,Ñpc->
öbuf
 +Ñpc->
öpos
, 
cou¡
) != 0) {

153 
	`Ωc_£t_îr‹
(
Ωc
, "Invalid/garbageÖduÑeceived from server. Closing socket");

156 
Ωc
->
öpos
 +
cou¡
;

157 i‡(
Ωc
->
öpos
 =Ωc->
ösize
) {

158 
	`‰ì
(
Ωc
->
öbuf
);

159 
Ωc
->
öbuf
 = 
NULL
;

160 
Ωc
->
ösize
 = 0;

161 
Ωc
->
öpos
 = 0;

165 
	}
}

169 
	$Ωc_£rvi˚
(
Ωc_c⁄ãxt
 *
Ωc
, 
ªvíts
)

171 i‡(
ªvíts
 & 
POLLERR
) {

172 
	`¥ötf
("rpc_service: POLLERR, socketÉrror\n");

173 i‡(
Ωc
->
is_c⁄√˘ed
 == 0) {

174 
	`Ωc_£t_îr‹
(
Ωc
, "FailedÅo connectÅo server socket.");

176 
	`Ωc_£t_îr‹
(
Ωc
, "Socket closed with POLLERR");

178 
Ωc
->
	`c⁄√˘_cb
‘pc, 
RPC_STATUS_ERROR
,Ñpc->
îr‹_°rög
,Ñpc->
c⁄√˘_d©a
);

181 i‡(
ªvíts
 & 
POLLHUP
) {

182 
	`¥ötf
("rpc_service: POLLHUP, socketÉrror\n");

183 
	`Ωc_£t_îr‹
(
Ωc
, "Socket failed with POLLHUP");

184 
Ωc
->
	`c⁄√˘_cb
‘pc, 
RPC_STATUS_ERROR
,Ñpc->
îr‹_°rög
,Ñpc->
c⁄√˘_d©a
);

188 i‡(
Ωc
->
is_c⁄√˘ed
 =0 &&Ñpc->
fd
 !-1 && 
ªvíts
&
POLLOUT
) {

189 
Ωc
->
is_c⁄√˘ed
 = 1;

190 
Ωc
->
	`c⁄√˘_cb
‘pc, 
RPC_STATUS_SUCCESS
, 
NULL
,Ñpc->
c⁄√˘_d©a
);

194 i‡(
ªvíts
 & 
POLLOUT
 && 
Ωc
->
outqueue
 !
NULL
) {

195 i‡(
	`Ωc_wrôe_to_sockë
(
Ωc
) != 0) {

196 
	`¥ötf
("writeÅo socket failed\n");

201 i‡(
ªvíts
 & 
POLLIN
) {

202 i‡(
	`Ωc_ªad_‰om_sockë
(
Ωc
) != 0) {

203 
	`Ωc_disc⁄√˘
(
Ωc
, 
	`Ωc_gë_îr‹
(rpc));

209 
	}
}

212 
	$Ωc_c⁄√˘_async
(
Ωc_c⁄ãxt
 *
Ωc
, c⁄° *
£rvî
, 
p‹t
, 
u£_¥ivûeged_p‹t
, 
Ωc_cb
 
cb
, *
¥iv©e_d©a
)

214 
sockaddr_°‹age
 
s
;

215 
sockaddr_ö
 *
sö
 = (sockaddr_ö *)&
s
;

216 
socksize
;

218 i‡(
Ωc
->
fd
 != -1) {

219 
	`Ωc_£t_îr‹
(
Ωc
, "TryingÅo connect whileálready connected");

220 
	`¥ötf
("%s\n", 
Ωc
->
îr‹_°rög
);

224 
sö
->
sö_Ámûy
 = 
AF_INET
;

225 
sö
->
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

226 i‡(
	`öë_±⁄
(
AF_INET
, 
£rvî
, &
sö
->
sö_addr
) != 1) {

227 
	`Ωc_£t_îr‹
(
Ωc
, "Notá valid server ipáddress");

228 
	`¥ötf
("%s\n", 
Ωc
->
îr‹_°rög
);

232 
s
.
ss_Ámûy
) {

233 
AF_INET
:

234 
Ωc
->
fd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

235 
socksize
 = (
sockaddr_ö
);

239 i‡(
Ωc
->
fd
 == -1) {

240 
	`Ωc_£t_îr‹
(
Ωc
, "FailedÅo open socket");

241 
	`¥ötf
("%s\n", 
Ωc
->
îr‹_°rög
);

246 i‡(
	`gëeuid
(Ë=0 && 
u£_¥ivûeged_p‹t
 != 0) {

247 
sockaddr_°‹age
 
ls
;

248 
ªt
, 
cou¡
 = 0;

249 
loˇl_p‹t
 = 0;

251 i‡(
loˇl_p‹t
 == 0) {

252 
	`§™dom
(
	`gëpid
(Ë^ 
	`time
(
NULL
));

253 
loˇl_p‹t
 = 
	`øndom
()%512 + 512;

257 
cou¡
 ++;

258 i‡(
loˇl_p‹t
 >= 1024) {

259 
loˇl_p‹t
 = 512;

261 
s
.
ss_Ámûy
) {

262 
AF_INET
:

263 
	`bzîo
(&
ls
, 
socksize
);

264 ((
sockaddr_ö
 *)&
ls
)->
sö_Ámûy
 = 
AF_INET
;

265 ((
sockaddr_ö
 *)&
ls
)->
sö_addr
.
s_addr
 = 
INADDR_ANY
;

266 ((
sockaddr_ö
 *)&
ls
)->
sö_p‹t
 = 
	`ht⁄s
(
loˇl_p‹t
++);

270 
ªt
 = 
	`böd
(
Ωc
->
fd
, (
sockaddr
 *)&
ls
, 
socksize
);

271 } 
ªt
 !0 && 
cou¡
 < 50);

274 
Ωc
->
c⁄√˘_cb
 = 
cb
;

275 
Ωc
->
c⁄√˘_d©a
 = 
¥iv©e_d©a
;

277 
	`£t_n⁄blockög
(
Ωc
->
fd
);

279 i‡(
	`c⁄√˘
(
Ωc
->
fd
, (
sockaddr
 *)&
s
, 
socksize
Ë!0 && 
î∫o
 !
EINPROGRESS
) {

280 
	`Ωc_£t_îr‹
(
Ωc
, "connect()Åo server failed");

281 
	`¥ötf
("%s\n", 
Ωc
->
îr‹_°rög
);

286 
	}
}

288 
	$Ωc_disc⁄√˘
(
Ωc_c⁄ãxt
 *
Ωc
, *
îr‹
)

290 i‡(
Ωc
->
fd
 != -1) {

291 
	`˛o£
(
Ωc
->
fd
);

293 
Ωc
->
fd
 = -1;

295 
Ωc
->
is_c⁄√˘ed
 = 0;

297 
	`Ωc_îr‹_Æl_pdus
(
Ωc
, 
îr‹
);

300 
	}
}

	@ccan/ccan/nfs/tools/nfsclient-async.c

21 
	#SERVER
 "10.1.1.27"

	)

22 
	#EXPORT
 "/VIRTUAL"

	)

23 
	#NFSFILE
 "/BOOKS/Cœssics/Døcuœ.djvu"

	)

24 
	#NFSDIR
 "/BOOKS/Cœssics/"

	)

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°döt.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/°©.h
>

31 
	~<uni°d.h
>

32 
	~<f˙é.h
>

33 
	~<pﬁl.h
>

34 
	~<cˇn/nfs/nfs.h
>

36 
	s˛õ¡
 {

37 *
	m£rvî
;

38 *
	mexp‹t
;

39 
uöt32_t
 
	mmou¡_p‹t
;

40 
nfsfh
 *
	mnfsfh
;

41 
	mis_föished
;

44 
	$nfs_›ídú_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

46 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

47 
nfsdú
 *nfsdú = 
d©a
;

48 
nfsdúít
 *nfsdirent;

50 i‡(
°©us
 < 0) {

51 
	`¥ötf
("›ídú faûed wôh \"%s\"\n", (*)
d©a
);

52 
	`exô
(10);

55 
	`¥ötf
("opendir successful\n");

56 (
nfsdúít
 = 
	`nfs_ªaddú
(
nfs
, 
nfsdú
)Ë!
NULL
) {

57 
	`¥ötf
("Inode:%d Name:%s\n", ()
nfsdúít
->
öode
,Çfsdúít->
«me
);

59 
	`nfs_˛o£dú
(
nfs
, 
nfsdú
);

61 
˛õ¡
->
is_föished
 = 1;

62 
	}
}

64 
	$nfs_˛o£_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

66 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

68 i‡(
°©us
 < 0) {

69 
	`¥ötf
("˛o£ faûed wôh \"%s\"\n", (*)
d©a
);

70 
	`exô
(10);

73 
	`¥ötf
("close successful\n");

74 
	`¥ötf
("ˇŒ o≥ndú(%s)\n", 
NFSDIR
);

75 i‡(
	`nfs_›ídú_async
(
nfs
, 
NFSDIR
, 
nfs_›ídú_cb
, 
˛õ¡
) != 0) {

76 
	`¥ötf
("FailedÅo startásyncÇfs close\n");

77 
	`exô
(10);

79 
	}
}

81 
	$nfs_f°©_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

83 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

84 
°©
 *
°
;

86 i‡(
°©us
 < 0) {

87 
	`¥ötf
("f°© cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

88 
	`exô
(10);

91 
	`¥ötf
("GŸÑïly from sîvî f‹ f°©(%s).\n", 
NFSFILE
);

92 
°
 = (
°©
 *)
d©a
;

93 
	`¥ötf
("Modê%04o\n", 
°
->
°_mode
);

94 
	`¥ötf
("Sizê%d\n", ()
°
->
°_size
);

95 
	`¥ötf
("Inodê%04o\n", ()
°
->
°_öo
);

97 
	`¥ötf
("Close file\n");

98 i‡(
	`nfs_˛o£_async
(
nfs
, 
˛õ¡
->
nfsfh
, 
nfs_˛o£_cb
, client) != 0) {

99 
	`¥ötf
("FailedÅo startásyncÇfs close\n");

100 
	`exô
(10);

102 
	}
}

104 
	$nfs_ªad_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

106 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

107 *
ªad_d©a
;

108 
i
;

110 i‡(
°©us
 < 0) {

111 
	`¥ötf
("ªad faûed wôh \"%s\"\n", (*)
d©a
);

112 
	`exô
(10);

115 
	`¥ötf
("ªad suc˚ssfu»wôh %d byã†o‡d©a\n", 
°©us
);

116 
ªad_d©a
 = 
d©a
;

117 
i
=0;i<16;i++) {

118 
	`¥ötf
("%02x ", 
ªad_d©a
[
i
]&0xff);

120 
	`¥ötf
("\n");

121 
	`¥ötf
("F°© fûê:%s\n", 
NFSFILE
);

122 i‡(
	`nfs_f°©_async
(
nfs
, 
˛õ¡
->
nfsfh
, 
nfs_f°©_cb
, client) != 0) {

123 
	`¥ötf
("FailedÅo startásyncÇfs fstat\n");

124 
	`exô
(10);

126 
	}
}

128 
	$nfs_›í_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

130 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

131 
nfsfh
 *nfsfh;

133 i‡(
°©us
 < 0) {

134 
	`¥ötf
("›í cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

135 
	`exô
(10);

138 
nfsfh
 = 
d©a
;

139 
˛õ¡
->
nfsfh
 =Çfsfh;

140 
	`¥ötf
("GŸÑïly from sîvî f‹ o≥n(%s). H™dÀ:%p\n", 
NFSFILE
, 
d©a
);

141 
	`¥ötf
("Read first 16 bytes\n");

142 i‡(
	`nfs_¥ód_async
(
nfs
, 
nfsfh
, 0, 16, 
nfs_ªad_cb
, 
˛õ¡
) != 0) {

143 
	`¥ötf
("FailedÅo startásyncÇfs open\n");

144 
	`exô
(10);

146 
	}
}

148 
	$nfs_°©_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

150 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

151 
°©
 *
°
;

153 i‡(
°©us
 < 0) {

154 
	`¥ötf
("°© cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

155 
	`exô
(10);

158 
	`¥ötf
("GŸÑïly from sîvî f‹ sèt(%s).\n", 
NFSFILE
);

159 
°
 = (
°©
 *)
d©a
;

160 
	`¥ötf
("Modê%04o\n", 
°
->
°_mode
);

161 
	`¥ötf
("Sizê%d\n", ()
°
->
°_size
);

162 
	`¥ötf
("Inodê%04o\n", ()
°
->
°_öo
);

164 
	`¥ötf
("O≥¿fûêf‹Ñódög :%s\n", 
NFSFILE
);

165 i‡(
	`nfs_›í_async
(
nfs
, 
NFSFILE
, 
O_RDONLY
, 
nfs_›í_cb
, 
˛õ¡
) != 0) {

166 
	`¥ötf
("FailedÅo startásyncÇfs open\n");

167 
	`exô
(10);

169 
	}
}

171 
	$nfs_mou¡_cb
(
°©us
, 
nfs_c⁄ãxt
 *
nfs
, *
d©a
, *
¥iv©e_d©a
)

173 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

175 i‡(
°©us
 < 0) {

176 
	`¥ötf
("mou¡/m¡ cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

177 
	`exô
(10);

180 
	`¥ötf
("GotÑeply from server for MOUNT/MNTÖrocedure.\n");

181 
	`¥ötf
("Sèàfûê:%s\n", 
NFSFILE
);

182 i‡(
	`nfs_°©_async
(
nfs
, 
NFSFILE
, 
nfs_°©_cb
, 
˛õ¡
) != 0) {

183 
	`¥ötf
("FailedÅo startásyncÇfs stat\n");

184 
	`exô
(10);

186 
	}
}

190 
	$maö
(
¨gc
, *
¨gv
[])

192 
nfs_c⁄ãxt
 *
nfs
;

193 
pﬁlfd
 
pfd
;

194 
ªt
;

195 
˛õ¡
 client;

197 
˛õ¡
.
£rvî
 = 
SERVER
;

198 
˛õ¡
.
exp‹t
 = 
EXPORT
;

199 
˛õ¡
.
is_föished
 = 0;

201 
nfs
 = 
	`nfs_öô_c⁄ãxt
();

202 i‡(
nfs
 =
NULL
) {

203 
	`¥ötf
("failedÅo init context\n");

204 
	`exô
(10);

207 
ªt
 = 
	`nfs_mou¡_async
(
nfs
, 
˛õ¡
.
£rvî
, clõ¡.
exp‹t
, 
nfs_mou¡_cb
, &client);

208 i‡(
ªt
 != 0) {

209 
	`¥ötf
("FailedÅo startásyncÇfs mount\n");

210 
	`exô
(10);

214 
pfd
.
fd
 = 
	`nfs_gë_fd
(
nfs
);

215 
pfd
.
evíts
 = 
	`nfs_which_evíts
(
nfs
);

217 i‡(
	`pﬁl
(&
pfd
, 1, -1) < 0) {

218 
	`¥ötf
("Poll failed");

219 
	`exô
(10);

221 i‡(
	`nfs_£rvi˚
(
nfs
, 
pfd
.
ªvíts
) < 0) {

222 
	`¥ötf
("nfs_service failed\n");

225 i‡(
˛õ¡
.
is_föished
) {

230 
	`nfs_de°roy_c⁄ãxt
(
nfs
);

231 
	`¥ötf
("nfsclient finished\n");

233 
	}
}

	@ccan/ccan/nfs/tools/nfsclient-raw.c

22 
	#SERVER
 "10.1.1.27"

	)

23 
	#EXPORT
 "/VIRTUAL"

	)

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<pﬁl.h
>

28 
	~<cˇn/nfs/nfs.h
>

29 
	~<cˇn/nfs/libnfs-øw.h
>

30 
	~<cˇn/nfs/Ωc/mou¡.h
>

32 
	s˛õ¡
 {

33 *
	m£rvî
;

34 *
	mexp‹t
;

35 
uöt32_t
 
	mmou¡_p‹t
;

36 
	mis_föished
;

39 
	$mou¡_m¡_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
d©a
, *
¥iv©e_d©a
)

41 
mou¡ªs3
 *
ªs
;

42 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

44 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

45 
	`¥ötf
("mou¡/m¡ cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

46 
	`exô
(10);

48 i‡(
°©us
 !
RPC_STATUS_SUCCESS
) {

49 
	`¥ötf
("mou¡/m¡ cÆ»tÿ£rvî %†Áûed, sètus:%d\n", 
˛õ¡
->
£rvî
, 
°©us
);

50 
	`exô
(10);

53 
ªs
 = 
d©a
;

54 i‡(
ªs
->
fhs_°©us
 !
MNT3_OK
) {

55 
	`¥ötf
("RPCÉº‹: Mou¡ faûed wôhÉº‹ %s(%dË%s(%d)", 
	`mou¡°©3_to_°r
(
ªs
->
fhs_°©us
),Ñes->fhs_°©us, 
	`°ªº‹
(-
	`mou¡°©3_to_î∫o
(res->fhs_status)), -mountstat3_to_errno(res->fhs_status));

56 
	`exô
(10);

59 
	`¥ötf
("GotÑeply from server for MOUNT/MNTÖrocedure.\n");

60 
˛õ¡
->
is_föished
 = 1;

61 
	}
}

64 
	$mou¡_nuŒ_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
d©a
, *
¥iv©e_d©a
)

66 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

68 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

69 
	`¥ötf
("mou¡ÇuŒ cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

70 
	`exô
(10);

72 i‡(
°©us
 !
RPC_STATUS_SUCCESS
) {

73 
	`¥ötf
("mou¡ÇuŒ cÆ»tÿ£rvî %†Áûed, sètus:%d\n", 
˛õ¡
->
£rvî
, 
°©us
);

74 
	`exô
(10);

77 
	`¥ötf
("GotÑeply from server for MOUNT/NULLÖrocedure.\n");

78 
	`¥ötf
("Síd MOUNT/MNT comm™d f‹ %s\n", 
˛õ¡
->
exp‹t
);

79 i‡(
	`Ωc_mou¡_m¡_async
(
Ωc
, 
mou¡_m¡_cb
, 
˛õ¡
->
exp‹t
, client) != 0) {

80 
	`¥ötf
("FailedÅo send mntÑequest\n");

81 
	`exô
(10);

84 
	}
}

86 
	$mou¡_c⁄√˘_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
d©a
, *
¥iv©e_d©a
)

88 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

90 i‡(
°©us
 !
RPC_STATUS_SUCCESS
) {

91 
	`¥ötf
("c⁄√˘i⁄ÅÿRPC.MOUNTD o¿£rvî %†Áûed\n", 
˛õ¡
->
£rvî
);

92 
	`exô
(10);

95 
	`¥ötf
("C⁄√˘edÅÿRPC.MOUNTD o¿%s:%d\n", 
˛õ¡
->
£rvî
, clõ¡->
mou¡_p‹t
);

96 
	`¥ötf
("Send NULLÑequestÅo check if RPC.MOUNTD isáctuallyÑunning\n");

97 i‡(
	`Ωc_mou¡_nuŒ_async
(
Ωc
, 
mou¡_nuŒ_cb
, 
˛õ¡
) != 0) {

98 
	`¥ötf
("FailedÅo sendÇullÑequest\n");

99 
	`exô
(10);

101 
	}
}

104 
	$pm≠_gëp‹t_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
d©a
, *
¥iv©e_d©a
)

106 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

107 
uöt32_t
 
p‹t
;

109 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

110 
	`¥ötf
("p‹tm≠≥∏gëp‹àˇŒ faûed wôh \"%s\"\n", (*)
d©a
);

111 
	`exô
(10);

113 i‡(
°©us
 !
RPC_STATUS_SUCCESS
) {

114 
	`¥ötf
("p‹tm≠≥∏gëp‹àˇŒÅÿ£rvî %†Áûed, sètus:%d\n", 
˛õ¡
->
£rvî
, 
°©us
);

115 
	`exô
(10);

118 
˛õ¡
->
mou¡_p‹t
 = *(
uöt32_t
 *)
d©a
;

119 
	`¥ötf
("GETPORTÑëu∫ed P‹t:%d\n", 
˛õ¡
->
mou¡_p‹t
);

120 i‡(
˛õ¡
->
mou¡_p‹t
 == 0) {

121 
	`¥ötf
("RPC.MOUNTD i†nŸávaûabÀ o¿£rvî : %s\n", 
˛õ¡
->
£rvî
, clõ¡->
mou¡_p‹t
);

122 
	`exô
(10);

125 
	`¥ötf
("Disconnect socket fromÖortmap server\n");

126 i‡(
	`Ωc_disc⁄√˘
(
Ωc
, "normal disconnect") != 0) {

127 
	`¥ötf
("FailedÅo disconnect socketÅoÖortmapper\n");

128 
	`exô
(10);

131 
	`¥ötf
("C⁄√˘ÅÿRPC.MOUNTD o¿%s:%d\n", 
˛õ¡
->
£rvî
, clõ¡->
mou¡_p‹t
);

132 i‡(
	`Ωc_c⁄√˘_async
(
Ωc
, 
˛õ¡
->
£rvî
, clõ¡->
mou¡_p‹t
, 1, 
mou¡_c⁄√˘_cb
, client) != 0) {

133 
	`¥ötf
("FailedÅo start connection\n");

134 
	`exô
(10);

136 
	}
}

139 
	$pm≠_nuŒ_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
d©a
, *
¥iv©e_d©a
)

141 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

143 i‡(
°©us
 =
RPC_STATUS_ERROR
) {

144 
	`¥ötf
("p‹tm≠≥∏nuŒ cÆ»Áûed wôh \"%s\"\n", (*)
d©a
);

145 
	`exô
(10);

147 i‡(
°©us
 !
RPC_STATUS_SUCCESS
) {

148 
	`¥ötf
("p‹tm≠≥∏nuŒ cÆ»tÿ£rvî %†Áûed, sètus:%d\n", 
˛õ¡
->
£rvî
, 
°©us
);

149 
	`exô
(10);

152 
	`¥ötf
("GotÑeply from server for PORTMAP/NULLÖrocedure.\n");

153 
	`¥ötf
("Send getportÑequestásking for MOUNTÖort\n");

154 i‡(
	`Ωc_pm≠_gëp‹t_async
(
Ωc
, 
MOUNT_PROGRAM
, 
MOUNT_V3
, 
pm≠_gëp‹t_cb
, 
˛õ¡
) != 0) {

155 
	`¥ötf
("FailedÅo send getportÑequest\n");

156 
	`exô
(10);

158 
	}
}

160 
	$pm≠_c⁄√˘_cb
(
Ωc_c⁄ãxt
 *
Ωc
, 
°©us
, *
d©a
, *
¥iv©e_d©a
)

162 
˛õ¡
 *˛õ¡ = 
¥iv©e_d©a
;

164 
	`¥ötf
("pm≠_c⁄√˘_cb sètus:%d.\n", 
°©us
);

165 i‡(
°©us
 !
RPC_STATUS_SUCCESS
) {

166 
	`¥ötf
("c⁄√˘i⁄Åÿp‹tm≠≥∏⁄ sîvî %†Áûed\n", 
˛õ¡
->
£rvî
);

167 
	`exô
(10);

170 
	`¥ötf
("Send NULLÑequestÅo check ifÖortmapper isáctuallyÑunning\n");

171 i‡(
	`Ωc_pm≠_nuŒ_async
(
Ωc
, 
pm≠_nuŒ_cb
, 
˛õ¡
) != 0) {

172 
	`¥ötf
("FailedÅo sendÇullÑequest\n");

173 
	`exô
(10);

175 
	}
}

178 
	$maö
(
¨gc
, *
¨gv
[])

180 
Ωc_c⁄ãxt
 *
Ωc
;

181 
pﬁlfd
 
pfd
;

182 
ªt
;

183 
˛õ¡
 client;

185 
Ωc
 = 
	`Ωc_öô_c⁄ãxt
();

186 i‡(
Ωc
 =
NULL
) {

187 
	`¥ötf
("failedÅo init context\n");

188 
	`exô
(10);

191 
˛õ¡
.
£rvî
 = 
SERVER
;

192 
˛õ¡
.
exp‹t
 = 
EXPORT
;

193 
˛õ¡
.
is_föished
 = 0;

194 i‡(
	`Ωc_c⁄√˘_async
(
Ωc
, 
˛õ¡
.
£rvî
, 111, 0, 
pm≠_c⁄√˘_cb
, &client) != 0) {

195 
	`¥ötf
("FailedÅo start connection\n");

196 
	`exô
(10);

200 
pfd
.
fd
 = 
	`Ωc_gë_fd
(
Ωc
);

201 
pfd
.
evíts
 = 
	`Ωc_which_evíts
(
Ωc
);

203 i‡(
	`pﬁl
(&
pfd
, 1, -1) < 0) {

204 
	`¥ötf
("Poll failed");

205 
	`exô
(10);

207 i‡(
	`Ωc_£rvi˚
(
Ωc
, 
pfd
.
ªvíts
) < 0) {

208 
	`¥ötf
("rpc_service failed\n");

211 i‡(
˛õ¡
.
is_föished
) {

216 
	`Ωc_de°roy_c⁄ãxt
(
Ωc
);

217 
Ωc
=
NULL
;

218 
	`¥ötf
("nfsclient finished\n");

220 
	}
}

	@ccan/ccan/nfs/tools/nfsclient-sync.c

21 
	#SERVER
 "10.1.1.27"

	)

22 
	#EXPORT
 "/VIRTUAL"

	)

23 
	#NFSFILE
 "/BOOKS/Cœssics/Døcuœ.djvu"

	)

24 
	#NFSFILER
 "/BOOKS/Cœssics/Døcuœ.djvu.ª«med"

	)

25 
	#NFSFILEW
 "/BOOKS/Cœssics/foo"

	)

26 
	#NFSDIR
 "/BOOKS/Cœssics/"

	)

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°döt.h
>

31 
	~<sys/ty≥s.h
>

32 
	~<sys/°©.h
>

33 
	~<sys/°©vfs.h
>

34 
	~<uni°d.h
>

35 
	~<f˙é.h
>

36 
	~<cˇn/nfs/nfs.h
>

37 
	~<Ωc/Ωc.h
>

39 
	s˛õ¡
 {

40 *
	m£rvî
;

41 *
	mexp‹t
;

42 
uöt32_t
 
	mmou¡_p‹t
;

43 
	mis_föished
;

47 
	$maö
(
¨gc
, *
¨gv
[])

49 
nfs_c⁄ãxt
 *
nfs
;

50 
i
, 
ªt
;

51 
˛õ¡
 client;

52 
°©
 
°
;

53 
nfsfh
 *nfsfh;

54 
nfsdú
 *nfsdir;

55 
nfsdúít
 *nfsdirent;

56 
˛õ¡
.
£rvî
 = 
SERVER
;

57 
˛õ¡
.
exp‹t
 = 
EXPORT
;

58 
˛õ¡
.
is_föished
 = 0;

59 
buf
[16];

60 
nfs_off_t
 
off£t
;

61 
°©vfs
 
svfs
;

63 
nfs
 = 
	`nfs_öô_c⁄ãxt
();

64 i‡(
nfs
 =
NULL
) {

65 
	`¥ötf
("failedÅo init context\n");

66 
	`exô
(10);

69 
ªt
 = 
	`nfs_mou¡_sync
(
nfs
, 
˛õ¡
.
£rvî
, clõ¡.
exp‹t
);

70 i‡(
ªt
 != 0) {

71 
	`¥ötf
("FaûedÅÿmou¡Çf†sh¨ê: %s\n", 
	`nfs_gë_îr‹
(
nfs
));

72 
	`exô
(10);

74 
	`¥ötf
("mounted share successfully\n");

75 
	`exô
(10);

77 
ªt
 = 
	`nfs_°©_sync
(
nfs
, 
NFSFILE
, &
°
);

78 i‡(
ªt
 != 0) {

79 
	`¥ötf
("FaûedÅÿ°©(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

80 
	`exô
(10);

82 
	`¥ötf
("Modê%04o\n", 
°
.
°_mode
);

83 
	`¥ötf
("Sizê%d\n", ()
°
.
°_size
);

84 
	`¥ötf
("Inodê%04o\n", ()
°
.
°_öo
);

86 
ªt
 = 
	`nfs_›í_sync
(
nfs
, 
NFSFILE
, 
O_RDONLY
, &
nfsfh
);

87 i‡(
ªt
 != 0) {

88 
	`¥ötf
("FaûedÅÿ›í(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

89 
	`exô
(10);

92 
ªt
 = 
	`nfs_ªad_sync
(
nfs
, 
nfsfh
, 16, 
buf
);

93 i‡(
ªt
 < 0) {

94 
	`¥ötf
("FaûedÅÿ¥ód(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

95 
	`exô
(10);

97 
	`¥ötf
("ªad %d byãs\n", 
ªt
);

98 
i
=0;i<16;i++) {

99 
	`¥ötf
("%02x ", 
buf
[
i
]&0xff);

101 
	`¥ötf
("\n");

102 
ªt
 = 
	`nfs_ªad_sync
(
nfs
, 
nfsfh
, 16, 
buf
);

103 i‡(
ªt
 < 0) {

104 
	`¥ötf
("FaûedÅÿ¥ód(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

105 
	`exô
(10);

107 
	`¥ötf
("ªad %d byãs\n", 
ªt
);

108 
i
=0;i<16;i++) {

109 
	`¥ötf
("%02x ", 
buf
[
i
]&0xff);

111 
	`¥ötf
("\n");

113 
ªt
 = ()
	`nfs_l£ek_sync
(
nfs
, 
nfsfh
, 0, 
SEEK_CUR
, &
off£t
);

114 i‡(
ªt
 < 0) {

115 
	`¥ötf
("FaûedÅÿl£ek(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

116 
	`exô
(10);

118 
	`¥ötf
("Fûêposôi⁄ i†%d\n", ()
off£t
);

120 
	`¥ötf
("seekÅoÉnd of file\n");

121 
ªt
 = ()
	`nfs_l£ek_sync
(
nfs
, 
nfsfh
, 0, 
SEEK_END
, &
off£t
);

122 i‡(
ªt
 < 0) {

123 
	`¥ötf
("FaûedÅÿl£ek(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

124 
	`exô
(10);

126 
	`¥ötf
("Fûêposôi⁄ i†%d\n", ()
off£t
);

128 
ªt
 = 
	`nfs_f°©_sync
(
nfs
, 
nfsfh
, &
°
);

129 i‡(
ªt
 != 0) {

130 
	`¥ötf
("FaûedÅÿ°©(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

131 
	`exô
(10);

133 
	`¥ötf
("Modê%04o\n", 
°
.
°_mode
);

134 
	`¥ötf
("Sizê%d\n", ()
°
.
°_size
);

135 
	`¥ötf
("Inodê%04o\n", ()
°
.
°_öo
);

138 
ªt
 = 
	`nfs_˛o£_sync
(
nfs
, 
nfsfh
);

139 i‡(
ªt
 < 0) {

140 
	`¥ötf
("FaûedÅÿ˛o£(%s)\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

141 
	`exô
(10);

144 
ªt
 = 
	`nfs_›ídú_sync
(
nfs
, 
NFSDIR
, &
nfsdú
);

145 i‡(
ªt
 != 0) {

146 
	`¥ötf
("FaûedÅÿ›í(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

147 
	`exô
(10);

149 (
nfsdúít
 = 
	`nfs_ªaddú
(
nfs
, 
nfsdú
)Ë!
NULL
) {

150 
	`¥ötf
("Inode:%d Name:%s\n", ()
nfsdúít
->
öode
,Çfsdúít->
«me
);

152 
	`nfs_˛o£dú
(
nfs
, 
nfsdú
);

155 
ªt
 = 
	`nfs_›í_sync
(
nfs
, 
NFSFILEW
, 
O_WRONLY
, &
nfsfh
);

156 i‡(
ªt
 != 0) {

157 
	`¥ötf
("FaûedÅÿ›í(%sË%s\n", 
NFSFILEW
, 
	`nfs_gë_îr‹
(
nfs
));

158 
	`exô
(10);

160 
ªt
 = 
	`nfs_pwrôe_sync
(
nfs
, 
nfsfh
, 0, 16, 
buf
);

161 i‡(
ªt
 < 0) {

162 
	`¥ötf
("FaûedÅÿpwrôe(%sË%s\n", 
NFSFILEW
, 
	`nfs_gë_îr‹
(
nfs
));

163 
	`exô
(10);

165 
ªt
 = 
	`nfs_fsync_sync
(
nfs
, 
nfsfh
);

166 i‡(
ªt
 < 0) {

167 
	`¥ötf
("FaûedÅÿfsync(%sË%s\n", 
NFSFILEW
, 
	`nfs_gë_îr‹
(
nfs
));

168 
	`exô
(10);

170 
ªt
 = 
	`nfs_˛o£_sync
(
nfs
, 
nfsfh
);

171 i‡(
ªt
 < 0) {

172 
	`¥ötf
("FaûedÅÿ˛o£(%s)\n", 
NFSFILEW
, 
	`nfs_gë_îr‹
(
nfs
));

173 
	`exô
(10);

177 
ªt
 = 
	`nfs_°©vfs_sync
(
nfs
, 
NFSDIR
, &
svfs
);

178 i‡(
ªt
 < 0) {

179 
	`¥ötf
("FaûedÅÿ°©vfs(%s)\n", 
NFSDIR
, 
	`nfs_gë_îr‹
(
nfs
));

180 
	`exô
(10);

182 
	`¥ötf
("fûe†%d/%d/%d\n", ()
svfs
.
f_fûes
, ()svfs.
f_f‰ì
, ()svfs.
f_Ávaû
);

185 
ªt
 = 
	`nfs_ac˚ss_sync
(
nfs
, 
NFSFILE
, 
R_OK
);

186 i‡(
ªt
 != 0) {

187 
	`¥ötf
("FaûedÅÿac˚ss(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

191 
	`nfs_£t_auth
(
nfs
, 
	`authunix_¸óã
("R⁄nõs-L≠t›", 0, 0, 0, 
NULL
));

193 
ªt
 = 
	`nfs_lök_sync
(
nfs
, 
NFSFILE
, 
NFSFILER
);

194 i‡(
ªt
 != 0) {

195 
	`¥ötf
("FaûedÅÿlök(%sË%s\n", 
NFSFILE
, 
	`nfs_gë_îr‹
(
nfs
));

199 
	`nfs_de°roy_c⁄ãxt
(
nfs
);

200 
	`¥ötf
("nfsclient finished\n");

202 
	}
}

	@ccan/ccan/noerr/noerr.c

2 
	~"n€º.h
"

3 
	~<uni°d.h
>

4 
	~<î∫o.h
>

6 
	$˛o£_n€º
(
fd
)

8 
ßved_î∫o
 = 
î∫o
, 
ªt
;

10 i‡(
	`˛o£
(
fd
) != 0)

11 
ªt
 = 
î∫o
;

13 
ªt
 = 0;

15 
î∫o
 = 
ßved_î∫o
;

16  
ªt
;

17 
	}
}

19 
	$f˛o£_n€º
(
FILE
 *
Â
)

21 
ßved_î∫o
 = 
î∫o
, 
ªt
;

23 i‡(
	`f˛o£
(
Â
) != 0)

24 
ªt
 = 
î∫o
;

26 
ªt
 = 0;

28 
î∫o
 = 
ßved_î∫o
;

29  
ªt
;

30 
	}
}

32 
	$u∆ök_n€º
(c⁄° *
∑th«me
)

34 
ßved_î∫o
 = 
î∫o
, 
ªt
;

36 i‡(
	`u∆ök
(
∑th«me
) != 0)

37 
ªt
 = 
î∫o
;

39 
ªt
 = 0;

41 
î∫o
 = 
ßved_î∫o
;

42  
ªt
;

43 
	}
}

	@ccan/ccan/noerr/noerr.h

2 #i‚de‡
NOERR_H


3 
	#NOERR_H


	)

4 
	~<°dio.h
>

13 
˛o£_n€º
(
fd
);

22 
f˛o£_n€º
(
FILE
 *
Â
);

31 
u∆ök_n€º
(c⁄° *
∑th«me
);

	@ccan/ccan/noerr/test/run.c

1 
	~<cˇn/n€º/n€º.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/n€º/n€º.c
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<°dio.h
>

8 
	~<as£π.h
>

10 
	$maö
(
¨gc
, *
¨gv
[])

12 c⁄° *
«me
 = "noerr.file";

13 
fd
;

14 
FILE
 *
Â
;

16 
	`∂™_ã°s
(15);

18 
	`ok1
(
	`u∆ök
(
«me
) != 0);

19 
	`ok1
(
î∫o
 =
ENOENT
);

22 
î∫o
 = 100;

23 
	`ok1
(
	`u∆ök_n€º
(
«me
Ë=
ENOENT
);

24 
	`ok1
(
î∫o
 == 100);

27 
	`ok1
(
	`˛o£
(-1) != 0);

28 
	`ok1
(
î∫o
 =
EBADF
);

31 
î∫o
 = 100;

32 
	`ok1
(
	`˛o£_n€º
(-1Ë=
EBADF
);

33 
	`ok1
(
î∫o
 == 100);

36 
fd
 = 
	`›í
(
«me
, 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0600);

37 
	`as£π
(
fd
 >= 0);

39 
î∫o
 = 100;

40 
	`ok1
(
	`˛o£_n€º
(
fd
) == 0);

41 
	`ok1
(
î∫o
 == 100);

43 
î∫o
 = 100;

44 
	`ok1
(
	`u∆ök_n€º
(
«me
) == 0);

45 
	`ok1
(
î∫o
 == 100);

48 
Â
 = 
	`f›í
(
«me
, "wb");

49 
	`as£π
(
Â
);

50 
	`˛o£
(
	`fûío
(
Â
));

51 
	`ok1
(
	`f˛o£_n€º
(
Â
Ë=
EBADF
);

54 
Â
 = 
	`f›í
(
«me
, "wb");

55 
	`as£π
(
Â
);

57 
î∫o
 = 100;

58 
	`ok1
(
	`f˛o£_n€º
(
Â
) == 0);

59 
	`ok1
(
î∫o
 == 100);

60 
	`u∆ök
(
«me
);

62  
	`exô_°©us
();

63 
	}
}

	@ccan/ccan/objset/objset.h

2 #i‚de‡
CCAN_OBJSET_H


3 
	#CCAN_OBJSET_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

6 
	~<cˇn/hash/hash.h
>

7 
	~<cˇn/tc⁄/tc⁄.h
>

8 
	~<°dlib.h
>

9 
	~<°dboﬁ.h
>

11 
ölöe
 c⁄° *
	$obj£t_key_
(c⁄° *
ñem
)

13  
ñem
;

14 
	}
}

15 
ölöe
 
size_t
 
	$obj£t_hash‚_
(c⁄° *
ñem
)

17  
	`hash_poöãr
(
ñem
, 0);

18 
	}
}

19 
ölöe
 
boﬁ
 
	$obj£t_eq‚_
(c⁄° *
e1
, c⁄° *
e2
)

21  
e1
 =
e2
;

22 
	}
}

23 
HTABLE_DEFINE_TYPE
(, 
obj£t_key_
, 
obj£t_hash‚_
, 
obj£t_eq‚_
, 
obj£t_h
);

38 
	#OBJSET_MEMBERS
(
ty≥
) \

39 
obj£t_h
 
øw
; \

40 
	`TCON
(
ty≥
 
ˇ«ry
)

	)

51 
	#obj£t_öô
(
£t
Ë
	`obj£t_h_öô
(&(£t)->
øw
)

	)

61 
	#obj£t_em±y
(
£t
Ë
	`obj£t_em±y_
(&(£t)->
øw
)

	)

63 
ölöe
 
boﬁ
 
	$obj£t_em±y_
(c⁄° 
obj£t_h
 *
£t
)

65 
obj£t_h_ôî
 
i
;

66  
	`obj£t_h_fú°
(
£t
, &
i
Ë=
NULL
;

67 
	}
}

85 
	#obj£t_add
(
£t
, 
vÆue
) \

86 
	`obj£t_h_add
(&
	`tc⁄_check
((
£t
), 
ˇ«ry
, (
vÆue
))->
øw
, (*)(vÆue))

	)

99 
	#obj£t_gë
(
£t
, 
membî
) \

100 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`obj£t_h_gë
(&(£t)->
øw
, (
membî
)))

	)

114 
	#obj£t_dñ
(
£t
, 
vÆue
) \

115 
	`obj£t_h_dñ
(&
	`tc⁄_check
((
£t
), 
ˇ«ry
, 
vÆue
)->
øw
, \

116 (c⁄° *)
vÆue
)

	)

127 
	#obj£t_˛ór
(
£t
Ë
	`obj£t_h_˛ór
(&(£t)->
øw
)

	)

135 
	sobj£t_ôî
 {

136 
obj£t_h_ôî
 
	môî
;

152 
	#obj£t_fú°
(
£t
, 
i
) \

153 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`obj£t_h_fú°
(&(£t)->
øw
, &(
i
)->
ôî
))

	)

170 
	#obj£t_√xt
(
£t
, 
i
) \

171 
	`tc⁄_ˇ°
((
£t
), 
ˇ«ry
, 
	`obj£t_h_√xt
(&(£t)->
øw
, &(
i
)->
ôî
))

	)

	@ccan/ccan/objset/test/run.c

1 
	~<cˇn/obj£t/obj£t.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	sobj£t_ch¨p
 {

5 
OBJSET_MEMBERS
(*);

8 
	sobj£t_öt
 {

9 
OBJSET_MEMBERS
(*);

12 
	$maö
()

14 
obj£t_ch¨p
 
o£tc
;

15 
obj£t_öt
 
o£ti
;

16 
obj£t_ôî
 
i
;

17 
i1
 = 1, 
i2
 = 2;

18 
c1
 = 1, 
c2
 = 2;

21 
	`∂™_ã°s
(46);

23 
	`obj£t_öô
(&
o£tc
);

24 
	`obj£t_öô
(&
o£ti
);

25 
	`ok1
(
	`obj£t_em±y
(&
o£tc
));

26 
	`ok1
(
	`obj£t_em±y
(&
o£ti
));

27 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i1
Ë=
NULL
);

28 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i2
Ë=
NULL
);

29 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c1
Ë=
NULL
);

30 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c2
Ë=
NULL
);

32 
	`ok1
(!
	`obj£t_dñ
(&
o£ti
, &
i1
));

33 
	`ok1
(!
	`obj£t_dñ
(&
o£ti
, &
i2
));

34 
	`ok1
(!
	`obj£t_dñ
(&
o£tc
, &
c1
));

35 
	`ok1
(!
	`obj£t_dñ
(&
o£tc
, &
c2
));

37 
	`obj£t_add
(&
o£ti
, &
i1
);

38 
	`ok1
(!
	`obj£t_em±y
(&
o£ti
));

39 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i1
) == &i1);

40 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i2
Ë=
NULL
);

42 
	`obj£t_add
(&
o£tc
, &
c1
);

43 
	`ok1
(!
	`obj£t_em±y
(&
o£tc
));

44 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c1
) == &c1);

45 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c2
Ë=
NULL
);

47 
	`obj£t_add
(&
o£ti
, &
i2
);

48 
	`ok1
(!
	`obj£t_em±y
(&
o£ti
));

49 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i1
) == &i1);

50 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i2
) == &i2);

52 
	`obj£t_add
(&
o£tc
, &
c2
);

53 
	`ok1
(!
	`obj£t_em±y
(&
o£tc
));

54 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c1
) == &c1);

55 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c2
) == &c2);

57 
	`ok1
((
	`obj£t_fú°
(&
o£ti
, &
i
Ë=&
i1


58 && 
	`obj£t_√xt
(&
o£ti
, &
i
Ë=&
i2
)

59 || (
	`obj£t_fú°
(&
o£ti
, &
i
Ë=&
i2


60 && 
	`obj£t_√xt
(&
o£ti
, &
i
Ë=&
i1
));

61 
	`ok1
(
	`obj£t_√xt
(&
o£ti
, &
i
Ë=
NULL
);

63 
	`ok1
((
	`obj£t_fú°
(&
o£tc
, &
i
Ë=&
c1


64 && 
	`obj£t_√xt
(&
o£tc
, &
i
Ë=&
c2
)

65 || (
	`obj£t_fú°
(&
o£tc
, &
i
Ë=&
c2


66 && 
	`obj£t_√xt
(&
o£tc
, &
i
Ë=&
c1
));

67 
	`ok1
(
	`obj£t_√xt
(&
o£tc
, &
i
Ë=
NULL
);

69 
	`ok1
(
	`obj£t_dñ
(&
o£ti
, &
i1
));

70 
	`ok1
(!
	`obj£t_dñ
(&
o£ti
, &
i1
));

71 
	`ok1
(
	`obj£t_dñ
(&
o£tc
, &
c1
));

72 
	`ok1
(!
	`obj£t_dñ
(&
o£tc
, &
c1
));

74 
	`ok1
(
	`obj£t_fú°
(&
o£ti
, &
i
Ë=&
i2
);

75 
	`ok1
(
	`obj£t_√xt
(&
o£ti
, &
i
Ë=
NULL
);

76 
	`ok1
(
	`obj£t_fú°
(&
o£tc
, &
i
Ë=&
c2
);

77 
	`ok1
(
	`obj£t_√xt
(&
o£tc
, &
i
Ë=
NULL
);

79 
	`obj£t_˛ór
(&
o£ti
);

80 
	`ok1
(
	`obj£t_fú°
(&
o£ti
, &
i
Ë=
NULL
);

81 
	`ok1
(
	`obj£t_em±y
(&
o£ti
));

82 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i1
Ë=
NULL
);

83 
	`ok1
(
	`obj£t_gë
(&
o£ti
, &
i2
Ë=
NULL
);

84 
	`ok1
(!
	`obj£t_dñ
(&
o£ti
, &
i1
));

85 
	`ok1
(!
	`obj£t_dñ
(&
o£ti
, &
i2
));

87 
	`obj£t_˛ór
(&
o£tc
);

88 
	`ok1
(
	`obj£t_fú°
(&
o£tc
, &
i
Ë=
NULL
);

89 
	`ok1
(
	`obj£t_em±y
(&
o£tc
));

90 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c1
Ë=
NULL
);

91 
	`ok1
(
	`obj£t_gë
(&
o£tc
, &
c2
Ë=
NULL
);

92 
	`ok1
(!
	`obj£t_dñ
(&
o£tc
, &
c1
));

93 
	`ok1
(!
	`obj£t_dñ
(&
o£tc
, &
c2
));

96  
	`exô_°©us
();

97 
	}
}

	@ccan/ccan/ogg_to_pcm/ogg_to_pcm.c

20 
	~<°dlib.h
>

21 
	~<°dio.h
>

22 
	~<î∫o.h
>

23 
	~<°rög.h
>

24 
	~<°döt.h
>

25 
	~<î∫o.h
>

26 #i‡!
deföed
(
__APPLE__
)

28 
	~<mÆloc.h
>

31 
	~<v‹bis/v‹bisfûe.h
>

33 
	#DEFINE_OGG_TO_PCM_GLOBALS


	)

34 
	~"ogg_to_pcm.h
"

36 c⁄° 
	gbôs
 = 16;

43 
	$ogg_to_pcm
(*
öfûe
, 
öt16_t
 **
pcmbuf„r
,

44 *
ßm∂esize
, *
ßm∂e_øã
, *
nch™√ls
,

45 
uöt64_t
 *
nßm∂es
)

47 
FILE
 *
ö
;

48 
OggV‹bis_Fûe
 
vf
;

49 
buf
[8192];

50 *
buf„Ωå
;

51 
lök
, 
ªt
, 
chaößŒowed
 = 0, 
bs
 = 0;

54 c⁄° 
uöt32_t
 
dummy
 = 0x01020304;

55 c⁄° *
ídün
 = (*Ë&
dummy
;

57 
ö
 = 
	`f›í
(
öfûe
, "r");

58 i‡(
ö
 =
NULL
) {

59 
	`Ârötf
(
°dîr
, "%s:%d ERROR: FailedÅo open '%s' forÑead: '%s'\n",

60 
__FILE__
, 
__LINE__
, 
öfûe
, 
	`°ªº‹
(
î∫o
));

63 i‡(
	`ov_›í
(
ö
, &
vf
, 
NULL
, 0) < 0) {

64 
	`Ârötf
(
°dîr
, "%s:%d: ERROR: FailedÅo open '%s'ás vorbis\n",

65 
__FILE__
, 
__LINE__
, 
öfûe
);

66 
	`f˛o£
(
ö
);

69 i‡(!
	`ov_£ekabÀ
(&
vf
)) {

70 
	`Ârötf
(
°dîr
, "%s:%d: %s isÇot seekable.\n",

71 
__FILE__
, 
__LINE__
, 
öfûe
);

72 
	`f˛o£
(
ö
);

76 *
nch™√ls
 = 
	`ov_öfo
(&
vf
,0)->
ch™√ls
;

77 *
ßm∂e_øã
 = 
	`ov_öfo
(&
vf
,0)->
øã
;

79 
lök
 = 0;Üök < 
	`ov_°ªams
(&
vf
);Üink++) {

80 i‡(
	`ov_öfo
(&
vf
, 
lök
)->
ch™√ls
 =*
nch™√ls
 &&

81 
	`ov_öfo
(&
vf
, 
lök
)->
øã
 =*
ßm∂e_øã
) {

82 
chaößŒowed
 = 1;

86 i‡(
chaößŒowed
)

87 *
nßm∂es
 = 
	`ov_pcm_tŸÆ
(&
vf
, -1);

89 *
nßm∂es
 = 
	`ov_pcm_tŸÆ
(&
vf
, 0);

91 *
pcmbuf„r
 = (*Ë
	`mÆloc
((
öt16_t
Ë* *
nßm∂es
 * *
nch™√ls
);

92 
	`mem£t
(*
pcmbuf„r
, 0, (
öt16_t
Ë* *
nßm∂es
 * *
nch™√ls
);

93 i‡(*
pcmbuf„r
 =
NULL
) {

94 
	`Ârötf
(
°dîr
, "%s:%d: FailedÅoállocate memory for '%s'\n",

95 
__FILE__
, 
__LINE__
, 
öfûe
);

96 
	`f˛o£
(
ö
);

99 
buf„Ωå
 = (*Ë*
pcmbuf„r
;

101 (
ªt
 = 
	`ov_ªad
(&
vf
, 
buf
, (buf), 
ídün
[0] =0x01, 
bôs
/8, 1, &
bs
)) != 0) {

102 i‡(
bs
 != 0) {

103 
v‹bis_öfo
 *
vi
 = 
	`ov_öfo
(&
vf
, -1);

104 i‡(*
nch™√ls
 !
vi
->
ch™√ls
 || *
ßm∂e_øã
 !vi->
øã
) {

105 
	`Ârötf
(
°dîr
, "%s:%d: Logical bitstreams with changing "

107 
__FILE__
, 
__LINE__
);

112 if(
ªt
 < 0 ) {

113 
	`Ârötf
(
°dîr
, "%s:%d: Warning: hole in data (%d)\n",

114 
__FILE__
, 
__LINE__
, 
ªt
);

119 
	`mem˝y
(
buf„Ωå
, 
buf
, 
ªt
);

120 
buf„Ωå
 +
ªt
;

126 
	`ov_˛ór
(&
vf
);

129 
	}
}

	@ccan/ccan/ogg_to_pcm/ogg_to_pcm.h

1 #i‚de‡
__OGG_TO_PCM_H__


2 
	#__OGG_TO_PCM_H__


	)

3 
	~<°döt.h
>

4 #ifde‡
DEFINE_OGG_TO_PCM_GLOBALS


5 
	#GLOBAL


	)

7 
	#GLOBAL
 

	)

34 
GLOBAL
 
ogg_to_pcm
(*
öfûe
, 
öt16_t
 **
pcmbuf„r
,

35 *
ßm∂esize
, *
ßm∂e_øã
, *
nch™√ls
,

36 
uöt64_t
 *
nßm∂es
);

38 #unde‡
GLOBAL


	@ccan/ccan/opt/helpers.c

2 
	~<cˇn/›t/›t.h
>

3 
	~<cˇn/ˇ°/ˇ°.h
>

4 
	~<°rög.h
>

5 
	~<°dlib.h
>

6 
	~<î∫o.h
>

7 
	~<°dio.h
>

8 
	~<limôs.h
>

9 
	~"¥iv©e.h
"

12 
	#CHAR_SIZE
(
ty≥
Ë(((—y≥)*
CHAR_BIT
 + 2Ë/ 3Ë+ 1)

	)

15 *
	$¨g_bad
(c⁄° *
fmt
, c⁄° *
¨g
)

17 *
°r
 = 
	`mÆloc
(
	`°æí
(
fmt
Ë+ såÀn(
¨g
));

18 
	`•rötf
(
°r
, 
fmt
, 
¨g
);

19  
°r
;

20 
	}
}

22 *
	$›t_£t_boﬁ
(
boﬁ
 *
b
)

24 *
b
 = 
åue
;

25  
NULL
;

26 
	}
}

28 *
	$›t_£t_övboﬁ
(
boﬁ
 *
b
)

30 *
b
 = 
Ál£
;

31  
NULL
;

32 
	}
}

34 *
	$›t_£t_boﬁ_¨g
(c⁄° *
¨g
, 
boﬁ
 *
b
)

36 i‡(!
	`°rˇ£cmp
(
¨g
, "yes") || !strcasecmp(arg, "true"))

37  
	`›t_£t_boﬁ
(
b
);

38 i‡(!
	`°rˇ£cmp
(
¨g
, "no") || !strcasecmp(arg, "false"))

39  
	`›t_£t_övboﬁ
(
b
);

41  
	`›t_övÆid_¨gumít
(
¨g
);

42 
	}
}

44 *
	$›t_£t_övboﬁ_¨g
(c⁄° *
¨g
, 
boﬁ
 *
b
)

46 *
îr
 = 
	`›t_£t_boﬁ_¨g
(
¨g
, 
b
);

48 i‡(!
îr
)

49 *
b
 = !*b;

50  
îr
;

51 
	}
}

54 *
	$›t_£t_ch¨p
(c⁄° *
¨g
, **
p
)

56 *
p
 = 
	`ˇ°_c⁄°
(*, 
¨g
);

57  
NULL
;

58 
	}
}

62 *
	$›t_£t_ötvÆ
(c⁄° *
¨g
, *
i
)

64 
l
;

65 *
îr
 = 
	`›t_£t_l⁄gvÆ
(
¨g
, &
l
);

67 i‡(
îr
)

68  
îr
;

69 *
i
 = 
l
;

71 i‡((*
i
Ë!(
l
) && *i !=Ü)

72  
	`¨g_bad
("vÆuê'%s' d€†nŸ fô i¡ÿ™ i¡egî", 
¨g
);

73  
îr
;

74 
	}
}

76 *
	$›t_£t_uötvÆ
(c⁄° *
¨g
, *
ui
)

78 
i
;

79 *
îr
 = 
	`›t_£t_ötvÆ
(
¨g
, &
i
);

81 i‡(
îr
)

82  
îr
;

83 i‡(
i
 < 0)

84  
	`¨g_bad
("'%s' i†√g©ivêbuàde°ö©i⁄ i†unsig√d", 
¨g
);

85 *
ui
 = 
i
;

86  
NULL
;

87 
	}
}

89 *
	$›t_£t_l⁄gvÆ
(c⁄° *
¨g
, *
l
)

91 *
ídp
;

94 
î∫o
 = 0;

95 *
l
 = 
	`°πﬁ
(
¨g
, &
ídp
, 0);

96 i‡(*
ídp
 || !
¨g
[0])

97  
	`¨g_bad
("'%s' i†nŸáÇumbî", 
¨g
);

98 i‡(
î∫o
)

99  
	`¨g_bad
("'%s' i†ouào‡ønge", 
¨g
);

100  
NULL
;

101 
	}
}

103 *
	$›t_£t_ul⁄gvÆ
(c⁄° *
¨g
, *
ul
)

105 
l
;

106 *
îr
;

108 
îr
 = 
	`›t_£t_l⁄gvÆ
(
¨g
, &
l
);

109 i‡(
îr
)

110  
îr
;

111 *
ul
 = 
l
;

112 i‡(
l
 < 0)

113  
	`¨g_bad
("'%s' i†√g©ivêbuàde°ö©i⁄ i†unsig√d", 
¨g
);

114  
NULL
;

115 
	}
}

117 *
	$›t_öc_ötvÆ
(*
i
)

119 (*
i
)++;

120  
NULL
;

121 
	}
}

124 *
	$›t_vîsi⁄_™d_exô
(c⁄° *
vîsi⁄
)

126 
	`¥ötf
("%s\n", 
vîsi⁄
);

128 
	`›t_‰ì_èbÀ
();

129 
	`exô
(0);

130 
	}
}

132 *
	$›t_ußge_™d_exô
(c⁄° *
exåa
)

134 *
ußge
 = 
	`›t_ußge
(
›t_¨gv0
, 
exåa
);

135 
	`¥ötf
("%s", 
ußge
);

137 
›t_Æloc
.
	`‰ì
(
ußge
);

138 
	`›t_‰ì_èbÀ
();

139 
	`exô
(0);

140 
	}
}

142 
	$›t_show_boﬁ
(
buf
[
OPT_SHOW_LEN
], c⁄° 
boﬁ
 *
b
)

144 
	`°∫˝y
(
buf
, *
b
 ? "åue" : "Ál£", 
OPT_SHOW_LEN
);

145 
	}
}

147 
	$›t_show_övboﬁ
(
buf
[
OPT_SHOW_LEN
], c⁄° 
boﬁ
 *
b
)

149 
	`°∫˝y
(
buf
, *
b
 ? "Ál£" : "åue", 
OPT_SHOW_LEN
);

150 
	}
}

152 
	$›t_show_ch¨p
(
buf
[
OPT_SHOW_LEN
], *c⁄° *
p
)

154 
size_t
 
Àn
 = 
	`°æí
(*
p
);

155 
buf
[0] = '"';

156 i‡(
Àn
 > 
OPT_SHOW_LEN
 - 2)

157 
Àn
 = 
OPT_SHOW_LEN
 - 2;

158 
	`°∫˝y
(
buf
+1, *
p
, 
Àn
);

159 
buf
[1+
Àn
] = '"';

160 i‡(
Àn
 < 
OPT_SHOW_LEN
 - 2)

161 
buf
[2+
Àn
] = '\0';

162 
	}
}

165 
	$›t_show_ötvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
i
)

167 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%i", *
i
);

168 
	}
}

170 
	$›t_show_uötvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
ui
)

172 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%u", *
ui
);

173 
	}
}

175 
	$›t_show_l⁄gvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
l
)

177 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%li", *
l
);

178 
	}
}

180 
	$›t_show_ul⁄gvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
ul
)

182 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%lu", *
ul
);

183 
	}
}

192 *
	$£t_Œ⁄g_wôh_suffix
(c⁄° *
¨g
, *
Œ
,

193 c⁄° 
ba£
)

195 *
ídp
;

196 i‡(!
¨g
[0])

197  
	`¨g_bad
("'%s' (™Ém±y såögËi†nŸáÇumbî", 
¨g
);

199 
î∫o
 = 0;

200 *
Œ
 = 
	`°πﬁl
(
¨g
, &
ídp
, 0);

201 i‡(
î∫o
)

202  
	`¨g_bad
("'%s' i†ouào‡ønge", 
¨g
);

203 i‡(*
ídp
){

206 i‡(
ídp
[1])

207  
	`¨g_bad
("'%s' i†nŸáÇumbî (suffixÅoÿl⁄g)", 
¨g
);

208 
mul
;

209 *
ídp
){

212 
mul
 = 
ba£
;

216 
mul
 = 
ba£
 * base;

220 
mul
 = 
ba£
 * base * base;

224 
mul
 = 
ba£
 * base * base * base;

227 
mul
 = 
ba£
 * base * base * base * base;

230 
mul
 = 
ba£
 * base * base * base * base * base;

234  
	`¨g_bad
("'%s' isÇotáÇumber (unknown suffix)",

235 
¨g
);

237 i‡(*
Œ
 > 
LLONG_MAX
 / 
mul
 || *Œ < 
LLONG_MIN
 / mul)

238  
	`¨g_bad
("'%s' i†ouào‡ønge", 
¨g
);

239 *
Œ
 *
mul
;

241  
NULL
;

242 
	}
}

247 * 
	$£t_ul⁄gl⁄g_wôh_suffix
(c⁄° *
¨g
, *
uŒ
,

248 c⁄° 
ba£
)

250 
Œ
;

251 *
îr
 = 
	`£t_Œ⁄g_wôh_suffix
(
¨g
, &
Œ
, 
ba£
);

252 i‡(
îr
 !
NULL
)

253  
îr
;

254 i‡(
Œ
 < 0)

255  
	`¨g_bad
("'%s' i†√g©ivêbuàde°ö©i⁄ i†unsig√d", 
¨g
);

256 *
uŒ
 = 
Œ
;

257  
NULL
;

258 
	}
}

260 * 
	$£t_l⁄g_wôh_suffix
(c⁄° *
¨g
, *
l
, c⁄° 
ba£
)

262 
Œ
;

263 *
îr
 = 
	`£t_Œ⁄g_wôh_suffix
(
¨g
, &
Œ
, 
ba£
);

264 i‡(
îr
 !
NULL
)

265  
îr
;

267 *
l
 = 
Œ
;

269 i‡((*
l
Ë!(
Œ
) && *l !=Ül)

270  
	`¨g_bad
("vÆuê'%s' d€†nŸ fô i¡ÿ®l⁄g", 
¨g
);

271  
NULL
;

272 
	}
}

274 * 
	$£t_ul⁄g_wôh_suffix
(c⁄° *
¨g
, *
ul
, c⁄° 
ba£
)

276 
Œ
;

277 *
îr
 = 
	`£t_Œ⁄g_wôh_suffix
(
¨g
, &
Œ
, 
ba£
);

278 i‡(
îr
 !
NULL
)

279  
îr
;

280 i‡(
Œ
 < 0)

281  
	`¨g_bad
("'%s' i†√g©ivêbuàde°ö©i⁄ i†unsig√d", 
¨g
);

282 *
ul
 = 
Œ
;

284 i‡((*
ul
Ë!(
Œ
) && *ul !=Ül)

285  
	`¨g_bad
("vÆuê'%s' d€†nŸ fô i¡ÿ™ unsig√dÜ⁄g", 
¨g
);

286  
NULL
;

287 
	}
}

289 * 
	$£t_öt_wôh_suffix
(c⁄° *
¨g
, *
i
, c⁄° 
ba£
)

291 
Œ
;

292 *
îr
 = 
	`£t_Œ⁄g_wôh_suffix
(
¨g
, &
Œ
, 
ba£
);

293 i‡(
îr
 !
NULL
)

294  
îr
;

296 *
i
 = 
Œ
;

297 i‡(*
i
 !
Œ
)

298  
	`¨g_bad
("vÆuê'%s' d€†nŸ fô i¡ÿ™ i¡", 
¨g
);

299  
NULL
;

300 
	}
}

302 * 
	$£t_uöt_wôh_suffix
(c⁄° *
¨g
, *
u
, c⁄° 
ba£
)

304 
Œ
;

305 *
îr
 = 
	`£t_Œ⁄g_wôh_suffix
(
¨g
, &
Œ
, 
ba£
);

306 i‡(
îr
 !
NULL
)

307  
îr
;

308 i‡(
Œ
 < 0)

309  
	`¨g_bad
("'%s' i†√g©ivêbuàde°ö©i⁄ i†unsig√d", 
¨g
);

310 *
u
 = 
Œ
;

311 i‡(*
u
 !
Œ
)

312  
	`¨g_bad
("vÆuê'%s' d€†nŸ fô i¡ÿ™ unsig√d i¡", 
¨g
);

313  
NULL
;

314 
	}
}

323 * 
	$›t_£t_ul⁄gl⁄gvÆ_bi
(c⁄° *
¨g
, *
Œ
)

325  
	`£t_ul⁄gl⁄g_wôh_suffix
(
¨g
, 
Œ
, 1024);

326 
	}
}

328 * 
	$›t_£t_ul⁄gl⁄gvÆ_si
(c⁄° *
¨g
, *
Œ
)

330  
	`£t_ul⁄gl⁄g_wôh_suffix
(
¨g
, 
Œ
, 1000);

331 
	}
}

333 * 
	$›t_£t_l⁄gl⁄gvÆ_bi
(c⁄° *
¨g
, *
Œ
)

335  
	`£t_Œ⁄g_wôh_suffix
(
¨g
, 
Œ
, 1024);

336 
	}
}

338 * 
	$›t_£t_l⁄gl⁄gvÆ_si
(c⁄° *
¨g
, *
Œ
)

340  
	`£t_Œ⁄g_wôh_suffix
(
¨g
, 
Œ
, 1000);

341 
	}
}

343 * 
	$›t_£t_l⁄gvÆ_bi
(c⁄° *
¨g
, *
l
)

345  
	`£t_l⁄g_wôh_suffix
(
¨g
, 
l
, 1024);

346 
	}
}

348 * 
	$›t_£t_l⁄gvÆ_si
(c⁄° *
¨g
, *
l
)

350  
	`£t_l⁄g_wôh_suffix
(
¨g
, 
l
, 1000);

351 
	}
}

353 * 
	$›t_£t_ul⁄gvÆ_bi
(c⁄° *
¨g
, *
ul
)

355  
	`£t_ul⁄g_wôh_suffix
(
¨g
, 
ul
, 1024);

356 
	}
}

358 * 
	$›t_£t_ul⁄gvÆ_si
(c⁄° *
¨g
, *
ul
)

360  
	`£t_ul⁄g_wôh_suffix
(
¨g
, 
ul
, 1000);

361 
	}
}

363 * 
	$›t_£t_ötvÆ_bi
(c⁄° *
¨g
, *
i
)

365  
	`£t_öt_wôh_suffix
(
¨g
, 
i
, 1024);

366 
	}
}

368 * 
	$›t_£t_ötvÆ_si
(c⁄° *
¨g
, *
i
)

370  
	`£t_öt_wôh_suffix
(
¨g
, 
i
, 1000);

371 
	}
}

373 * 
	$›t_£t_uötvÆ_bi
(c⁄° *
¨g
, *
u
)

375  
	`£t_uöt_wôh_suffix
(
¨g
, 
u
, 1024);

376 
	}
}

378 * 
	$›t_£t_uötvÆ_si
(c⁄° *
¨g
, *
u
)

380  
	`£t_uöt_wôh_suffix
(
¨g
, 
u
, 1000);

381 
	}
}

387 
	$show_Œ⁄g_wôh_suffix
(
buf
[
OPT_SHOW_LEN
], 
Œ
,

388 c⁄° 
ba£
)

390 c⁄° *
suffixes
 = "kMGTPE";

391 
i
;

392 i‡(
Œ
 == 0){

394 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "0");

397 
i
 = 0; i < 
	`°æí
(
suffixes
); i++){

398 
tmp
 = 
Œ
 / 
ba£
;

399 i‡(
tmp
 * 
ba£
 !
Œ
)

401 
Œ
 = 
tmp
;

403 i‡(
i
 == 0)

404 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%Œd", 
Œ
);

406 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%Œd%c", 
Œ
, 
suffixes
[
i
 - 1]);

407 
	}
}

409 
	$show_uŒ⁄g_wôh_suffix
(
buf
[
OPT_SHOW_LEN
], 
uŒ
,

410 c⁄° 
ba£
)

412 c⁄° *
suffixes
 = "kMGTPE";

413 
i
;

414 i‡(
uŒ
 == 0){

416 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "0");

419 
i
 = 0; i < 
	`°æí
(
suffixes
); i++){

420 
tmp
 = 
uŒ
 / 
ba£
;

421 i‡(
tmp
 * 
ba£
 !
uŒ
)

423 
uŒ
 = 
tmp
;

425 i‡(
i
 == 0)

426 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%Œu", 
uŒ
);

428 
	`¢¥ötf
(
buf
, 
OPT_SHOW_LEN
, "%Œu%c", 
uŒ
, 
suffixes
[
i
 - 1]);

429 
	}
}

432 
	$›t_show_ötvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

434 
	`show_Œ⁄g_wôh_suffix
(
buf
, *
x
, 1024);

435 
	}
}

437 
	$›t_show_l⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

439 
	`show_Œ⁄g_wôh_suffix
(
buf
, *
x
, 1024);

440 
	}
}

442 
	$›t_show_l⁄gl⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

444 
	`show_Œ⁄g_wôh_suffix
(
buf
, *
x
, 1024);

445 
	}
}

448 
	$›t_show_uötvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

450 
	`show_uŒ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1024);

451 
	}
}

453 
	$›t_show_ul⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

455 
	`show_uŒ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1024);

456 
	}
}

458 
	$›t_show_ul⁄gl⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

460 
	`show_uŒ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1024);

461 
	}
}

464 
	$›t_show_ötvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

466 
	`show_Œ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1000);

467 
	}
}

469 
	$›t_show_l⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

471 
	`show_Œ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1000);

472 
	}
}

474 
	$›t_show_l⁄gl⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

476 
	`show_Œ⁄g_wôh_suffix
(
buf
, *
x
, 1000);

477 
	}
}

480 
	$›t_show_uötvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

482 
	`show_uŒ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1000);

483 
	}
}

485 
	$›t_show_ul⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

487 
	`show_uŒ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1000);

488 
	}
}

490 
	$›t_show_ul⁄gl⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
)

492 
	`show_uŒ⁄g_wôh_suffix
(
buf
, (Ë*
x
, 1000);

493 
	}
}

	@ccan/ccan/opt/opt.c

2 
	~<cˇn/›t/›t.h
>

3 
	~<°rög.h
>

4 
	~<î∫o.h
>

5 
	~<°dlib.h
>

6 
	~<°dio.h
>

7 
	~<as£π.h
>

8 
	~<°d¨g.h
>

9 
	~<°döt.h
>

10 
	~"¥iv©e.h
"

12 
›t_èbÀ
 *
	g›t_èbÀ
;

13 
	g›t_cou¡
, 
	g›t_num_sh‹t
, 
	g›t_num_sh‹t_¨g
, 
	g›t_num_l⁄g
;

14 c⁄° *
	g›t_¨gv0
;

15 
›t_Æloc
 
	g›t_Æloc
 = {

16 
mÆloc
, 
ªÆloc
, 
‰ì


20 c⁄° *
	$fú°_«me
(c⁄° *
«mes
, *
Àn
)

22 *
Àn
 = 
	`°rc•n
(
«mes
 + 1, "|= ");

23  
«mes
 + 1;

24 
	}
}

26 c⁄° *
	$√xt_«me
(c⁄° *
«mes
, *
Àn
)

28 
«mes
 +*
Àn
;

29 i‡(
«mes
[0] == ' ' ||Çames[0] == '=' ||Çames[0] == '\0')

30  
NULL
;

31  
	`fú°_«me
(
«mes
 + 1, 
Àn
);

32 
	}
}

34 c⁄° *
	$fú°_›t
(*
i
, *
Àn
)

36 *
i
 = 0; *ò< 
›t_cou¡
; (*i)++) {

37 i‡(
›t_èbÀ
[*
i
].
ty≥
 =
OPT_SUBTABLE
)

39  
	`fú°_«me
(
›t_èbÀ
[*
i
].
«mes
, 
Àn
);

41  
NULL
;

42 
	}
}

44 c⁄° *
	$√xt_›t
(c⁄° *
p
, *
i
, *
Àn
)

46 ; *
i
 < 
›t_cou¡
; (*i)++) {

47 i‡(
›t_èbÀ
[*
i
].
ty≥
 =
OPT_SUBTABLE
)

49 i‡(!
p
)

50  
	`fú°_«me
(
›t_èbÀ
[*
i
].
«mes
, 
Àn
);

51 
p
 = 
	`√xt_«me
’, 
Àn
);

52 i‡(
p
)

53  
p
;

55  
NULL
;

56 
	}
}

58 c⁄° *
	$fú°_l›t
(*
i
, *
Àn
)

60 c⁄° *
p
;

61 
p
 = 
	`fú°_›t
(
i
, 
Àn
);Ö;Ö = 
	`√xt_›t
(p, i,Üen)) {

62 i‡(
p
[0] == '-') {

64 (*
Àn
)--;

65 
p
++;

69  
p
;

70 
	}
}

72 c⁄° *
	$√xt_l›t
(c⁄° *
p
, *
i
, *
Àn
)

74 
p
 = 
	`√xt_›t
’, 
i
, 
Àn
);Ö;Ö =Çext_opt(p, i,Üen)) {

75 i‡(
p
[0] == '-') {

77 (*
Àn
)--;

78 
p
++;

82  
p
;

83 
	}
}

85 c⁄° *
	$fú°_s›t
(*
i
)

87 c⁄° *
p
;

88 
Àn
 = 0 ;

90 
p
 = 
	`fú°_›t
(
i
, &
Àn
);Ö;Ö = 
	`√xt_›t
(p, i, &len)) {

91 i‡(
p
[0] != '-')

94  
p
;

95 
	}
}

97 c⁄° *
	$√xt_s›t
(c⁄° *
p
, *
i
)

99 
Àn
 = 1;

100 
p
 = 
	`√xt_›t
’, 
i
, &
Àn
);Ö;Ö =Çext_opt(p, i, &len)) {

101 i‡(
p
[0] != '-')

104  
p
;

105 
	}
}

108 #i‚de‡
Áûmsg


109 
	#Áûmsg
(
fmt
, ...) \

110 dÿ{ 
	`Ârötf
(
°dîr
, 
fmt
, 
__VA_ARGS__
); 
	`exô
(1); } 0)

	)

113 
	$check_›t
(c⁄° 
›t_èbÀ
 *
íåy
)

115 c⁄° *
p
;

116 
Àn
;

118 i‡(
íåy
->
ty≥
 !
OPT_HASARG
 &&É¡ry->ty≥ !
OPT_NOARG


119 && 
íåy
->
ty≥
 !(
OPT_EARLY
|
OPT_HASARG
)

120 && 
íåy
->
ty≥
 !(
OPT_EARLY
|
OPT_NOARG
))

121 
	`Áûmsg
("Option %s: unknownÉntryÅype %u",

122 
íåy
->
«mes
,É¡ry->
ty≥
);

124 i‡(!
íåy
->
desc
)

125 
	`Áûmsg
("O±i⁄ %s: des¸ùti⁄ c™nŸ bêNULL", 
íåy
->
«mes
);

128 i‡(
íåy
->
«mes
[0] != '-')

129 
	`Áûmsg
("O±i⁄ %s: d€†nŸ begö wôh '-'", 
íåy
->
«mes
);

131 
p
 = 
	`fú°_«me
(
íåy
->
«mes
, &
Àn
);Ö;Ö = 
	`√xt_«me
(p, &len)) {

132 i‡(*
p
 == '-') {

133 i‡(
Àn
 == 1)

134 
	`Áûmsg
("Option %s: invalidÜong option '--'",

135 
íåy
->
«mes
);

136 
›t_num_l⁄g
++;

138 i‡(
Àn
 != 1)

139 
	`Áûmsg
("Option %s: invalid short option"

140 " '%.*s'", 
íåy
->
«mes
, 
Àn
+1, 
p
-1);

141 
›t_num_sh‹t
++;

142 i‡(
íåy
->
ty≥
 =
OPT_HASARG
)

143 
›t_num_sh‹t_¨g
++;

146 i‡(
íåy
->
ty≥
 =
OPT_NOARG
) {

147 i‡(
p
[
Àn
] == ' ' ||Ö[len] == '=')

148 
	`Áûmsg
("Option %s: doesÇotÅakeárguments"

149 " '%s'", 
íåy
->
«mes
, 
p
+
Àn
+1);

152 
	}
}

154 
	$add_›t
(c⁄° 
›t_èbÀ
 *
íåy
)

156 
›t_èbÀ
 = 
›t_Æloc
.
	`ªÆloc
(opt_table,

157 (
›t_èbÀ
[0]Ë* (
›t_cou¡
+1));

158 
›t_èbÀ
[
›t_cou¡
++] = *
íåy
;

159 
	}
}

161 
_›t_ªgi°î
(c⁄° *
«mes
, 
›t_ty≥
 
ty≥
,

162 *(*
cb
)(*
¨g
),

163 *(*
cb_¨g
)(c⁄° *
›èrg
, *
¨g
),

164 (*
show
)(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
),

165 c⁄° *
¨g
, c⁄° *
desc
)

167 
›t_èbÀ
 
›t
;

168 
›t
.
«mes
 =Çames;

169 
›t
.
ty≥
 =Åype;

170 
›t
.
cb
 = cb;

171 
›t
.
cb_¨g
 = cb_arg;

172 
›t
.
show
 = show;

173 
›t
.
u
.
ˇrg
 = 
¨g
;

174 
›t
.
desc
 = desc;

175 
	`check_›t
(&
›t
);

176 
	`add_›t
(&
›t
);

177 
	}
}

179 
	$›t_ªgi°î_èbÀ
(c⁄° 
›t_èbÀ
 
íåy
[], c⁄° *
desc
)

181 
i
, 
°¨t
 = 
›t_cou¡
;

183 i‡(
desc
) {

184 
›t_èbÀ
 
hódög
 = 
	`OPT_SUBTABLE
(
NULL
, 
desc
);

185 
	`add_›t
(&
hódög
);

187 
i
 = 0; 
íåy
[i].
ty≥
 !
OPT_END
; i++) {

188 i‡(
íåy
[
i
].
ty≥
 =
OPT_SUBTABLE
)

189 
	`›t_ªgi°î_èbÀ
(
	`subèbÀ_of
(&
íåy
[
i
]),

190 
íåy
[
i
].
desc
);

192 
	`check_›t
(&
íåy
[
i
]);

193 
	`add_›t
(&
íåy
[
i
]);

197 i‡(
desc
)

198 
›t_èbÀ
[
°¨t
].
u
.
éí
 = (
›t_cou¡
 - start);

199 
	}
}

202 
boﬁ
 
›t_∑r£
(*
¨gc
, *
¨gv
[], (*
îæog
)(c⁄° *
fmt
, ...))

204 
ªt
;

205 
off£t
 = 0;

208 
›t_¨gv0
 = 
¨gv
[0];

210 (
ªt
 = 
	`∑r£_⁄e
(
¨gc
, 
¨gv
, 0, &
off£t
, 
îæog
)) == 1);

213  (
ªt
 == 0);

214 
	}
}

216 
boﬁ
 
›t_óæy_∑r£
(
¨gc
, *
¨gv
[],

217 (*
îæog
)(c⁄° *
fmt
, ...))

219 
ªt
;

220 
off
 = 0;

221 **
tm∑rgv
 = 
›t_Æloc
.
	`Æloc
((
¨gv
[0]Ë* (
¨gc
 + 1));

224 
	`mem˝y
(
tm∑rgv
, 
¨gv
, ◊rgv[0]Ë* (
¨gc
 + 1));

227 
›t_¨gv0
 = 
¨gv
[0];

229 (
ªt
 = 
	`∑r£_⁄e
(&
¨gc
, 
tm∑rgv
, 
OPT_EARLY
, &
off
, 
îæog
)) == 1);

231 
›t_Æloc
.
	`‰ì
(
tm∑rgv
);

234  (
ªt
 == 0);

235 
	}
}

237 
	$›t_‰ì_èbÀ
()

239 
›t_Æloc
.
	`‰ì
(
›t_èbÀ
);

240 
›t_èbÀ
 = 
NULL
;

241 
›t_cou¡
 = 
›t_num_sh‹t
 = 
›t_num_sh‹t_¨g
 = 
›t_num_l⁄g
 = 0;

242 
	}
}

244 
	$›t_log_°dîr
(c⁄° *
fmt
, ...)

246 
va_li°
 
≠
;

248 
	`va_°¨t
(
≠
, 
fmt
);

249 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

250 
	`Ârötf
(
°dîr
, "\n");

251 
	`va_íd
(
≠
);

252 
	}
}

254 
	$›t_log_°dîr_exô
(c⁄° *
fmt
, ...)

256 
va_li°
 
≠
;

258 
	`va_°¨t
(
≠
, 
fmt
);

259 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

260 
	`Ârötf
(
°dîr
, "\n");

261 
	`va_íd
(
≠
);

262 
	`exô
(1);

263 
	}
}

265 *
	$›t_övÆid_¨gumít
(c⁄° *
¨g
)

267 *
°r
 = 
›t_Æloc
.
	`Æloc
(("InvÆidárgumíà'%s'"Ë+ 
	`°æí
(
¨g
));

268 
	`•rötf
(
°r
, "InvÆidárgumíà'%s'", 
¨g
);

269  
°r
;

270 
	}
}

272 
›t_£t_Æloc
(*(*
Æloc‚
)(
size_t
 
size
),

273 *(*
ªÆloc‚
)(*
±r
, 
size_t
 
size
),

274 (*
‰ì‚
)(*
±r
))

276 
›t_Æloc
.
Æloc
 = 
Æloc‚
;

277 
›t_Æloc
.
ªÆloc
 = 
ªÆloc‚
;

278 
›t_Æloc
.
‰ì
 = 
‰ì‚
;

279 
	}
}

	@ccan/ccan/opt/opt.h

2 #i‚de‡
CCAN_OPT_H


3 
	#CCAN_OPT_H


	)

4 
	~<cˇn/compûî/compûî.h
>

5 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

6 
	~<°dboﬁ.h
>

7 
	~<°dlib.h
>

9 
	g›t_èbÀ
;

33 
	#OPT_WITHOUT_ARG
(
«mes
, 
cb
, 
¨g
, 
desc
) \

34 { (
«mes
), 
	`OPT_CB_NOARG
((
cb
), 0, (
¨g
)), { (¨gË}, (
desc
Ë}

	)

68 
	#OPT_WITH_ARG
(
«me
, 
cb
, 
show
, 
¨g
, 
desc
) \

69 { (
«me
), 
	`OPT_CB_ARG
((
cb
), 0, (
show
), (
¨g
)), { (¨gË}, (
desc
Ë}

	)

76 
	#OPT_SUBTABLE
(
èbÀ
, 
desc
) \

77 { (c⁄° *)(
èbÀ
), 
OPT_SUBTABLE
, \

78 (
	`_check_is_íåy
(
èbÀ
)Ë? 
NULL
 : NULL, NULL, NULL, \

79 { 
NULL
 }, (
desc
Ë}

	)

94 
	#OPT_EARLY_WITHOUT_ARG
(
«mes
, 
cb
, 
¨g
, 
desc
) \

95 { (
«mes
), 
	`OPT_CB_NOARG
((
cb
), 
OPT_EARLY
, (
¨g
)), { (¨gË}, (
desc
Ë}

	)

111 
	#OPT_EARLY_WITH_ARG
(
«me
, 
cb
, 
show
, 
¨g
, 
desc
) \

112 { (
«me
), 
	`OPT_CB_ARG
((
cb
), 
OPT_EARLY
, (
show
), (
¨g
)), { (¨gË}, (
desc
Ë}

	)

119 
	#OPT_ENDTABLE
 { 
NULL
, 
OPT_END
, NULL, NULL, NULL, { NULL }, NULL }

	)

144 
›t_ªgi°î_èbÀ
(c⁄° 
›t_èbÀ
 *
èbÀ
, c⁄° *
desc
);

164 
	#›t_ªgi°î_nﬂrg
(
«mes
, 
cb
, 
¨g
, 
desc
) \

165 
	`_›t_ªgi°î
((
«mes
), 
	`OPT_CB_NOARG
((
cb
), 0, (
¨g
)), (¨g), (
desc
))

	)

195 
	#›t_ªgi°î_¨g
(
«mes
, 
cb
, 
show
, 
¨g
, 
desc
) \

196 
	`_›t_ªgi°î
((
«mes
), 
	`OPT_CB_ARG
((
cb
),0,(
show
), (
¨g
)), (¨g), (
desc
))

	)

210 
	#›t_ªgi°î_óæy_nﬂrg
(
«mes
, 
cb
, 
¨g
, 
desc
) \

211 
	`_›t_ªgi°î
((
«mes
), 
	`OPT_CB_NOARG
((
cb
), 
OPT_EARLY
, (
¨g
)), \

212 (
¨g
), (
desc
))

	)

227 
	#›t_ªgi°î_óæy_¨g
(
«mes
, 
cb
, 
show
, 
¨g
, 
desc
) \

228 
	`_›t_ªgi°î
((
«mes
), 
	`OPT_CB_ARG
((
cb
), 
OPT_EARLY
, (
show
),(
¨g
)), \

229 (
¨g
), (
desc
))

	)

258 
boﬁ
 
›t_∑r£
(*
¨gc
, *
¨gv
[], (*
îæog
)(c⁄° *
fmt
, ...));

286 
boﬁ
 
	`›t_óæy_∑r£
(
¨gc
, *
¨gv
[],

287 (*
îæog
)(c⁄° *
fmt
, ...));

297 
	`›t_‰ì_èbÀ
();

308 
	`›t_£t_Æloc
(*(*
Æloc‚
)(
size_t
 
size
),

309 *(*
ªÆloc‚
)(*
±r
, 
size_t
 
size
),

310 (*
‰ì‚
)(*
±r
));

321 
	`›t_log_°dîr
(c⁄° *
fmt
, ...);

334 
	`›t_log_°dîr_exô
(c⁄° *
fmt
, ...);

342 *
	`›t_övÆid_¨gumít
(c⁄° *
¨g
);

359 *
	`›t_ußge
(c⁄° *
¨gv0
, c⁄° *
exåa
);

367 c⁄° 
›t_hiddí
[];

370 
	#OPT_SHOW_LEN
 80

	)

374 *
	`›t_£t_boﬁ
(
boﬁ
 *
b
);

376 *
	`›t_£t_boﬁ_¨g
(c⁄° *
¨g
, 
boﬁ
 *
b
);

377 
	`›t_show_boﬁ
(
buf
[
OPT_SHOW_LEN
], c⁄° 
boﬁ
 *
b
);

379 *
	`›t_£t_övboﬁ
(
boﬁ
 *
b
);

380 
	`›t_show_övboﬁ
(
buf
[
OPT_SHOW_LEN
], c⁄° 
boﬁ
 *
b
);

382 *
	`›t_£t_övboﬁ_¨g
(c⁄° *
¨g
, 
boﬁ
 *
b
);

385 *
	`›t_£t_ch¨p
(c⁄° *
¨g
, **
p
);

386 
	`›t_show_ch¨p
(
buf
[
OPT_SHOW_LEN
], *c⁄° *
p
);

389 *
	`›t_£t_ötvÆ
(c⁄° *
¨g
, *
i
);

390 
	`›t_show_ötvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
i
);

391 *
	`›t_£t_uötvÆ
(c⁄° *
¨g
, *
ui
);

392 
	`›t_show_uötvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
ui
);

393 *
	`›t_£t_l⁄gvÆ
(c⁄° *
¨g
, *
l
);

394 
	`›t_show_l⁄gvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
l
);

395 *
	`›t_£t_ul⁄gvÆ
(c⁄° *
¨g
, *
ul
);

396 
	`›t_show_ul⁄gvÆ
(
buf
[
OPT_SHOW_LEN
], c⁄° *
ul
);

402 *
	`›t_£t_ötvÆ_bi
(c⁄° *
¨g
, *
i
);

403 *
	`›t_£t_ötvÆ_si
(c⁄° *
¨g
, *
i
);

404 *
	`›t_£t_uötvÆ_bi
(c⁄° *
¨g
, *
u
);

405 *
	`›t_£t_uötvÆ_si
(c⁄° *
¨g
, *
u
);

406 *
	`›t_£t_l⁄gvÆ_bi
(c⁄° *
¨g
, *
l
);

407 *
	`›t_£t_l⁄gvÆ_si
(c⁄° *
¨g
, *
l
);

408 *
	`›t_£t_ul⁄gvÆ_bi
(c⁄° *
¨g
, *
ul
);

409 *
	`›t_£t_ul⁄gvÆ_si
(c⁄° *
¨g
, *
ul
);

410 *
	`›t_£t_l⁄gl⁄gvÆ_bi
(c⁄° *
¨g
, *
Œ
);

411 *
	`›t_£t_l⁄gl⁄gvÆ_si
(c⁄° *
¨g
, *
Œ
);

412 *
	`›t_£t_ul⁄gl⁄gvÆ_bi
(c⁄° *
¨g
, *
Œ
);

413 *
	`›t_£t_ul⁄gl⁄gvÆ_si
(c⁄° *
¨g
, *
Œ
);

416 
	`›t_show_ötvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

417 
	`›t_show_l⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

418 
	`›t_show_l⁄gl⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

419 
	`›t_show_uötvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

420 
	`›t_show_ul⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

421 
	`›t_show_ul⁄gl⁄gvÆ_bi
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

423 
	`›t_show_ötvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

424 
	`›t_show_l⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

425 
	`›t_show_l⁄gl⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

426 
	`›t_show_uötvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

427 
	`›t_show_ul⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

428 
	`›t_show_ul⁄gl⁄gvÆ_si
(
buf
[
OPT_SHOW_LEN
], c⁄° *
x
);

434 *
	`›t_öc_ötvÆ
(*
i
);

437 *
	`›t_vîsi⁄_™d_exô
(c⁄° *
vîsi⁄
);

440 *
	`›t_ußge_™d_exô
(c⁄° *
exåa
);

445 
	e›t_ty≥
 {

446 
OPT_NOARG
 = 1,

447 
OPT_HASARG
 = 2,

448 
OPT_SUBTABLE
 = 4,

449 
OPT_EARLY
 = 8,

450 
OPT_END
 = 16,

453 
	s›t_èbÀ
 {

454 c⁄° *
«mes
;

455 
›t_ty≥
 
ty≥
;

456 *(*
cb
)(*
¨g
);

457 *(*
cb_¨g
)(c⁄° *
›èrg
, *
¨g
);

458 (*
show
)(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
);

460 c⁄° *
ˇrg
;

461 *
¨g
;

462 
size_t
 
éí
;

463 } 
u
;

464 c⁄° *
desc
;

468 
	#OPT_CB_NOARG
(
cb
, 
¥e
, 
¨g
) \

469 
OPT_NOARG
|(
¥e
), \

470 
	`ty≥ß„_cb_ˇ°3
(*(*)(*), \

471 *(*)(
	`ty≥of
(*(
¨g
))*), \

472 *(*)(c⁄° 
	`ty≥of
(*(
¨g
))*), \

473 *(*)(c⁄° *), (
cb
)), \

474 
NULL
, 
	)
NULL

477 
	#OPT_CB_ARG
(
cb
, 
¥e
, 
show
, 
¨g
) \

478 
OPT_HASARG
|(
¥e
), 
NULL
, \

479 
	`ty≥ß„_cb_ˇ°3
(*(*)(const *,*), \

480 *(*)(c⁄° *, 
	`ty≥of
(*(
¨g
))*), \

481 *(*)(c⁄° *, c⁄° 
	`ty≥of
(*(
¨g
))*), \

483 (
cb
)), \

484 
	`ty≥ß„_cb_ˇ°
((*)(
buf
[], const *), \

485 (*)(
buf
[], c⁄° 
	`ty≥of
(*(
¨g
))*), (
show
))

	)

488 
	`_›t_ªgi°î
(c⁄° *
«mes
, 
›t_ty≥
 
ty≥
,

489 *(*
cb
)(*
¨g
),

490 *(*
cb_¨g
)(c⁄° *
›èrg
, *
¨g
),

491 (*
show
)(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
),

492 c⁄° *
¨g
, c⁄° *
desc
);

495 
ölöe
 
	$_check_is_íåy
(
›t_èbÀ
 *
e
 
UNUSED
Ë{  0; 
	}
}

	@ccan/ccan/opt/parse.c

3 
	~<cˇn/›t/›t.h
>

4 
	~<°rög.h
>

5 
	~<°dlib.h
>

6 
	~<as£π.h
>

7 
	~"¥iv©e.h
"

16 
∑r£_îr
((*
îæog
)(c⁄° *
fmt
, ...),

17 c⁄° *
¨gv0
, c⁄° *
¨g
, 
Àn
,

18 c⁄° *
¥obÀm
)

20 
	`îæog
("%s: %.*s: %s", 
¨gv0
, 
Àn
, 
¨g
, 
¥obÀm
);

22 
	}
}

24 
	$c⁄sume_›ti⁄
(*
¨gc
, *
¨gv
[], 
›äum
)

26 
	`memmove
(&
¨gv
[
›äum
], &argv[optnum+1],

27 (
¨gv
[
›äum
]Ë* (*
¨gc
-optnum));

28 (*
¨gc
)--;

29 
	}
}

32 
∑r£_⁄e
(*
¨gc
, *
¨gv
[], 
›t_ty≥
 
is_óæy
, *
off£t
,

33 (*
îæog
)(c⁄° *
fmt
, ...))

35 
i
, 
¨g
, 
Àn
;

36 c⁄° *
o
, *
›èrg
 = 
NULL
;

37 *
¥obÀm
 = 
NULL
;

39 i‡(
	`gëív
("POSIXLY_CORRECT")) {

41 
¨g
 = 1;

43 
¨g
 = 1; 
¨gv
[arg];árg++) {

44 i‡(
¨gv
[
¨g
][0] == '-')

49 i‡(!
¨gv
[
¨g
] ||árgv[arg][0] != '-')

53 i‡(
	`°rcmp
(
¨gv
[
¨g
], "--") == 0) {

54 
	`c⁄sume_›ti⁄
(
¨gc
, 
¨gv
, 
¨g
);

59 i‡(
¨gv
[
¨g
][1] == '-') {

60 
	`as£π
(*
off£t
 == 0);

61 
o
 = 
	`fú°_l›t
(&
i
, &
Àn
); o; o = 
	`√xt_l›t
(o, &i, &len)) {

62 i‡(
	`°∫cmp
(
¨gv
[
¨g
] + 2, 
o
, 
Àn
) != 0)

64 i‡(
¨gv
[
¨g
][2 + 
Àn
] == '=')

65 
›èrg
 = 
¨gv
[
¨g
] + 2 + 
Àn
 + 1;

66 i‡(
¨gv
[
¨g
][2 + 
Àn
] != '\0')

70 i‡(!
o
)

71  
	`∑r£_îr
(
îæog
, 
¨gv
[0],

72 
¨gv
[
¨g
], 
	`°æí
(argv[arg]),

75 
o
 -= 2;

76 
Àn
 += 2;

79 
o
 = 
	`fú°_s›t
(&
i
); o; o = 
	`√xt_s›t
(o, &i)) {

80 i‡(
¨gv
[
¨g
][*
off£t
 + 1] !*
o
)

82 (*
off£t
)++;

85 i‡(!
o
)

86  
	`∑r£_îr
(
îæog
, 
¨gv
[0],

87 
¨gv
[
¨g
], 
	`°æí
(argv[arg]),

90 
o
--;

91 
Àn
 = 2;

94 i‡((
›t_èbÀ
[
i
].
ty≥
 & ~
OPT_EARLY
Ë=
OPT_NOARG
) {

95 i‡(
›èrg
)

96  
	`∑r£_îr
(
îæog
, 
¨gv
[0], 
o
, 
Àn
,

98 i‡((
›t_èbÀ
[
i
].
ty≥
 & 
OPT_EARLY
Ë=
is_óæy
)

99 
¥obÀm
 = 
›t_èbÀ
[
i
].
	`cb
(›t_èbÀ[i].
u
.
¨g
);

101 i‡(!
›èrg
) {

103 i‡(*
off£t
 && 
¨gv
[
¨g
][*offset + 1]) {

104 
›èrg
 = 
¨gv
[
¨g
] + *
off£t
 + 1;

105 *
off£t
 = 0;

107 
›èrg
 = 
¨gv
[
¨g
+1];

109 i‡(!
›èrg
)

110  
	`∑r£_îr
(
îæog
, 
¨gv
[0], 
o
, 
Àn
,

112 i‡((
›t_èbÀ
[
i
].
ty≥
 & 
OPT_EARLY
Ë=
is_óæy
)

113 
¥obÀm
 = 
›t_èbÀ
[
i
].
	`cb_¨g
(
›èrg
,

114 
›t_èbÀ
[
i
].
u
.
¨g
);

117 i‡(
¥obÀm
) {

118 
	`∑r£_îr
(
îæog
, 
¨gv
[0], 
o
, 
Àn
, 
¥obÀm
);

119 
›t_Æloc
.
	`‰ì
(
¥obÀm
);

124 i‡(*
off£t
 && !
¨gv
[
¨g
][*offset + 1])

125 *
off£t
 = 0;

128 i‡(*
off£t
 == 0) {

129 
	`c⁄sume_›ti⁄
(
¨gc
, 
¨gv
, 
¨g
);

130 i‡(
›èrg
 && o±¨g =
¨gv
[
¨g
])

131 
	`c⁄sume_›ti⁄
(
¨gc
, 
¨gv
, 
¨g
);

134 
	}
}

	@ccan/ccan/opt/private.h

2 #i‚de‡
CCAN_OPT_PRIVATE_H


3 
	#CCAN_OPT_PRIVATE_H


	)

5 
›t_èbÀ
 *opt_table;

6 
›t_cou¡
, 
›t_num_sh‹t
, 
›t_num_sh‹t_¨g
, 
›t_num_l⁄g
;

8 c⁄° *
›t_¨gv0
;

10 
	#subèbÀ_of
(
íåy
Ë((c⁄° 
›t_èbÀ
 *)(”¡ry)->
«mes
))

	)

12 c⁄° *
fú°_s›t
(*
i
);

13 c⁄° *
√xt_s›t
(c⁄° *
«mes
, *
i
);

14 c⁄° *
fú°_l›t
(*
i
, *
Àn
);

15 c⁄° *
√xt_l›t
(c⁄° *
p
, *
i
, *
Àn
);

17 
	s›t_Æloc
 {

18 *(*
	mÆloc
)(
size_t
 
	msize
);

19 *(*
	mªÆloc
)(*
	m±r
, 
size_t
 
	msize
);

20 (*
	m‰ì
)(*
	m±r
);

22 
›t_Æloc
 opt_alloc;

24 
∑r£_⁄e
(*
¨gc
, *
¨gv
[], 
›t_ty≥
 
is_óæy
, *
off£t
,

25 (*
îæog
)(c⁄° *
fmt
, ...));

	@ccan/ccan/opt/test/compile_ok-const-arg.c

1 
	~<cˇn/›t/›t.h
>

2 
	~<cˇn/›t/›t.c
>

3 
	~<cˇn/›t/hñ≥rs.c
>

4 
	~<cˇn/›t/∑r£.c
>

5 
	~<cˇn/›t/ußge.c
>

7 
	$maö
(
¨gc
, *
¨gv
[])

9 
	`›t_ªgi°î_nﬂrg
("-v", 
›t_vîsi⁄_™d_exô
,

13 
	}
}

	@ccan/ccan/opt/test/run-add_desc.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/›t/›t.c
>

3 
	~<cˇn/›t/ußge.c
>

4 
	~<cˇn/›t/hñ≥rs.c
>

5 
	~<cˇn/›t/∑r£.c
>

7 
	$show_10
(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
)

9 
	`mem£t
(
buf
, 'X', 10);

10 
buf
[10] = '\0';

11 
	}
}

13 
	$show_max
(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
)

15 
	`mem£t
(
buf
, 'X', 
OPT_SHOW_LEN
);

16 
	}
}

19 
	$maö
(
¨gc
, *
¨gv
[])

21 
›t_èbÀ
 
›t
;

22 *
ªt
;

23 
size_t
 
Àn
, 
max
;

25 
	`∂™_ã°s
(30);

27 
›t
.
show
 = 
NULL
;

28 
›t
.
«mes
 = "01234";

29 
›t
.
desc
 = "0123456789 0";

30 
›t
.
ty≥
 = 
OPT_NOARG
;

31 
Àn
 = 
max
 = 0;

34 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 10, 30, &
›t
);

35 
	`ok1
(
Àn
 < 
max
);

36 
ªt
[
Àn
] = '\0';

37 
	`ok1
(
	`°rcmp
(
ªt
, "01234 0123456789 0\n") == 0);

38 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

41 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 30, &
›t
);

42 
	`ok1
(
Àn
 < 
max
);

43 
ªt
[
Àn
] = '\0';

44 
	`ok1
(
	`°rcmp
(
ªt
, "01234 0123456789 0\n") == 0);

45 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

48 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 6, 30, &
›t
);

49 
	`ok1
(
Àn
 < 
max
);

50 
ªt
[
Àn
] = '\0';

51 
	`ok1
(
	`°rcmp
(
ªt
,

54 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

57 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 19, &
›t
);

58 
	`ok1
(
Àn
 < 
max
);

59 
ªt
[
Àn
] = '\0';

60 
	`ok1
(
	`°rcmp
(
ªt
, "01234 0123456789 0\n") == 0);

61 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

64 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 18, &
›t
);

65 
	`ok1
(
Àn
 < 
max
);

66 
ªt
[
Àn
] = '\0';

67 
	`ok1
(
	`°rcmp
(
ªt
,

70 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

73 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 6, 17, &
›t
);

74 
	`ok1
(
Àn
 < 
max
);

75 
ªt
[
Àn
] = '\0';

76 
	`ok1
(
	`°rcmp
(
ªt
,

80 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

83 
›t
.
show
 = 
show_10
;

84 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 41, &
›t
);

85 
	`ok1
(
Àn
 < 
max
);

86 
ªt
[
Àn
] = '\0';

87 
	`ok1
(
	`°rcmp
(
ªt
, "01234 0123456789 0 (default: XXXXXXXXXX)\n") == 0);

88 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

91 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 40, &
›t
);

92 
	`ok1
(
Àn
 < 
max
);

93 
ªt
[
Àn
] = '\0';

94 
	`ok1
(
	`°rcmp
(
ªt
,

97 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

100 
›t
.
show
 = 
show_max
;

101 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 114, &
›t
);

102 
	`ok1
(
Àn
 < 
max
);

103 
ªt
[
Àn
] = '\0';

104 
	`ok1
(
	`°rcmp
(
ªt
, "01234 0123456789 0 (default: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...)\n") == 0);

105 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

108 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 7, 113, &
›t
);

109 
	`ok1
(
Àn
 < 
max
);

110 
ªt
[
Àn
] = '\0';

111 
	`ok1
(
	`°rcmp
(
ªt
,

114 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

117 
›t
.
show
 = 
NULL
;

118 
›t
.
ty≥
 = 
OPT_HASARG
;

119 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 13, 25, &
›t
);

120 
	`ok1
(
Àn
 < 
max
);

121 
ªt
[
Àn
] = '\0';

122 
	`ok1
(
	`°rcmp
(
ªt
, "01234 <arg> 0123456789 0\n") == 0);

123 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

126 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 12, 25, &
›t
);

127 
	`ok1
(
Àn
 < 
max
);

128 
ªt
[
Àn
] = '\0';

129 
	`ok1
(
	`°rcmp
(
ªt
,

132 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

135 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 13, 24, &
›t
);

136 
	`ok1
(
Àn
 < 
max
);

137 
ªt
[
Àn
] = '\0';

138 
	`ok1
(
	`°rcmp
(
ªt
,

141 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

144 
›t
.
show
 = 
show_10
;

145 
›t
.
desc
 = "";

146 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 13, 35, &
›t
);

147 
	`ok1
(
Àn
 < 
max
);

148 
ªt
[
Àn
] = '\0';

149 
	`ok1
(
	`°rcmp
(
ªt
, "01234 <arg> (default: XXXXXXXXXX)\n") == 0);

150 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

153 
›t
.
show
 = 
show_10
;

154 
›t
.
desc
 = "";

155 
ªt
 = 
	`add_desc
(
NULL
, &
Àn
, &
max
, 13, 34, &
›t
);

156 
	`ok1
(
Àn
 < 
max
);

157 
ªt
[
Àn
] = '\0';

158 
	`ok1
(
	`°rcmp
(
ªt
,

161 
	`‰ì
(
ªt
); 
Àn
 = 
max
 = 0;

163  
	`exô_°©us
();

164 
	}
}

	@ccan/ccan/opt/test/run-checkopt.c

1 
	~"c⁄fig.h
"

2 
	~<°dio.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<£tjmp.h
>

5 
	~<°dlib.h
>

6 
	~<limôs.h
>

7 
	~<îr.h
>

8 
	~"utûs.h
"

11 
jmp_buf
 
	gexôed
;

12 
	#Áûmsg
 
ßve_™d_jump


	)

14 
ßve_™d_jump
(c⁄° *
fmt
, ...);

16 
	~<cˇn/›t/hñ≥rs.c
>

17 
	~<cˇn/›t/›t.c
>

18 
	~<cˇn/›t/ußge.c
>

19 
	~<cˇn/›t/∑r£.c
>

21 *
	gouçut
 = 
NULL
;

23 
	$ßved_v¥ötf
(c⁄° *
fmt
, 
va_li°
 
≠
)

25 *
p
;

26 
ªt
 = 
	`va•rötf
(&
p
, 
fmt
, 
≠
);

28 i‡(
ouçut
) {

29 
ouçut
 = 
	`ªÆloc
(ouçut, 
	`°æí
(ouçutË+ såÀn(
p
) + 1);

30 
	`°rˇt
(
ouçut
, 
p
);

31 
	`‰ì
(
p
);

33 
ouçut
 = 
p
;

34  
ªt
;

35 
	}
}

37 
	$ßve_™d_jump
(c⁄° *
fmt
, ...)

39 
va_li°
 
≠
;

41 
	`va_°¨t
(
≠
, 
fmt
);

42 
	`ßved_v¥ötf
(
fmt
, 
≠
);

43 
	`va_íd
(
≠
);

44 
	`l⁄gjmp
(
exôed
, 1);

45 
	}
}

47 
	$ª£t
()

49 
	`‰ì
(
ouçut
);

50 
ouçut
 = 
NULL
;

51 
	`‰ì
(
›t_èbÀ
);

52 
›t_èbÀ
 = 
NULL
;

53 
›t_cou¡
 = 
›t_num_sh‹t
 = 
›t_num_sh‹t_¨g
 = 
›t_num_l⁄g
 = 0;

54 
	}
}

56 
	$maö
(
¨gc
, *
¨gv
[])

58 
exôvÆ
;

60 
	`∂™_ã°s
(14);

62 
exôvÆ
 = 
	`£tjmp
(
exôed
);

63 i‡(
exôvÆ
 == 0) {

65 
	`_›t_ªgi°î
("-a", 
OPT_SUBTABLE
, (*)
›t_vîsi⁄_™d_exô
,

66 
NULL
, NULL, "1.2.3", "");

67 
	`Áû
("_opt_registerÑeturned?");

69 
	`ok1
(
exôvÆ
 == 1);

70 
	`ok1
(
	`°r°r
(
ouçut
, "Option -a: unknownÉntryÅype"));

72 
	`ª£t
();

74 
exôvÆ
 = 
	`£tjmp
(
exôed
);

75 i‡(
exôvÆ
 == 0) {

77 
	`›t_ªgi°î_nﬂrg
("-a", 
ã°_nﬂrg
, "", 
NULL
);

78 
	`Áû
("_opt_registerÑeturned?");

80 
	`ok1
(
exôvÆ
 == 1);

81 
	`ok1
(
	`°r°r
(
ouçut
, "Option -a: description cannot be NULL"));

83 
	`ª£t
();

85 
exôvÆ
 = 
	`£tjmp
(
exôed
);

86 i‡(
exôvÆ
 == 0) {

88 
	`›t_ªgi°î_nﬂrg
("a", 
ã°_nﬂrg
, "", "");

89 
	`Áû
("_opt_registerÑeturned?");

91 
	`ok1
(
exôvÆ
 == 1);

92 
	`ok1
(
	`°r°r
(
ouçut
, "Optioná: doesÇot begin with '-'"));

95 
	`ª£t
();

97 
exôvÆ
 = 
	`£tjmp
(
exôed
);

98 i‡(
exôvÆ
 == 0) {

100 
	`›t_ªgi°î_nﬂrg
("--", 
ã°_nﬂrg
, "", "");

101 
	`Áû
("_opt_registerÑeturned?");

103 
	`ok1
(
exôvÆ
 == 1);

104 
	`ok1
(
	`°r°r
(
ouçut
, "Option --: invalidÜong option '--'"));

107 
	`ª£t
();

109 
exôvÆ
 = 
	`£tjmp
(
exôed
);

110 i‡(
exôvÆ
 == 0) {

112 
	`›t_ªgi°î_nﬂrg
("--a|-Øa", 
ã°_nﬂrg
, "", "");

113 
	`Áû
("_opt_registerÑeturned?");

115 
	`ok1
(
exôvÆ
 == 1);

116 
	`ok1
(
	`°r°r
(
ouçut
,

119 
	`ª£t
();

121 
exôvÆ
 = 
	`£tjmp
(
exôed
);

122 i‡(
exôvÆ
 == 0) {

124 
	`›t_ªgi°î_nﬂrg
("--®foo", 
ã°_nﬂrg
, "", "");

125 
	`Áû
("_opt_registerÑeturned?");

127 
	`ok1
(
exôvÆ
 == 1);

128 
	`ok1
(
	`°r°r
(
ouçut
,

131 
	`ª£t
();

133 
exôvÆ
 = 
	`£tjmp
(
exôed
);

134 i‡(
exôvÆ
 == 0) {

136 
	`›t_ªgi°î_nﬂrg
("--a=foo", 
ã°_nﬂrg
, "", "");

137 
	`Áû
("_opt_registerÑeturned?");

139 
	`ok1
(
exôvÆ
 == 1);

140 
	`ok1
(
	`°r°r
(
ouçut
,

143  
	`exô_°©us
();

144 
	}
}

	@ccan/ccan/opt/test/run-consume_words.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<cˇn/›t/›t.c
>

3 
	~<cˇn/›t/ußge.c
>

4 
	~<cˇn/›t/hñ≥rs.c
>

5 
	~<cˇn/›t/∑r£.c
>

8 
	$maö
(
¨gc
, *
¨gv
[])

10 
°¨t
, 
Àn
;

12 
	`∂™_ã°s
(13);

15 
Àn
 = 
	`c⁄sume_w‹ds
("hñlÿw‹ld", 1, &
°¨t
);

16 
	`ok1
(
°¨t
 == 0);

17 
	`ok1
(
Àn
 =
	`°æí
("hello"));

18 
Àn
 = 
	`c⁄sume_w‹ds
(" w‹ld", 1, &
°¨t
);

19 
	`ok1
(
°¨t
 == 1);

20 
	`ok1
(
Àn
 =
	`°æí
("world"));

21 
	`ok1
(
	`c⁄sume_w‹ds
("", 1, &
°¨t
) == 0);

24 
Àn
 = 
	`c⁄sume_w‹ds
("hñlÿw‹ld", 5, &
°¨t
);

25 
	`ok1
(
°¨t
 == 0);

26 
	`ok1
(
Àn
 =
	`°æí
("hello"));

27 
Àn
 = 
	`c⁄sume_w‹ds
(" w‹ld", 5, &
°¨t
);

28 
	`ok1
(
°¨t
 == 1);

29 
	`ok1
(
Àn
 =
	`°æí
("world"));

30 
	`ok1
(
	`c⁄sume_w‹ds
("", 5, &
°¨t
) == 0);

32 
Àn
 = 
	`c⁄sume_w‹ds
("hñlÿw‹ld", 11, &
°¨t
);

33 
	`ok1
(
°¨t
 == 0);

34 
	`ok1
(
Àn
 =
	`°æí
("hello world"));

35 
	`ok1
(
	`c⁄sume_w‹ds
("", 11, &
°¨t
) == 0);

36  
	`exô_°©us
();

37 
	}
}

	@ccan/ccan/opt/test/run-correct-reporting.c

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

5 
	~<cˇn/›t/›t.c
>

6 
	~<cˇn/›t/ußge.c
>

7 
	~<cˇn/›t/hñ≥rs.c
>

8 
	~<cˇn/›t/∑r£.c
>

9 
	~"utûs.h
"

11 
	$maö
(
¨gc
, *
¨gv
[])

13 
	`∂™_ã°s
(12);

16 
	`›t_ªgi°î_¨g
("-a|--Øa", 
ã°_¨g
, 
NULL
, "aaa", "");

17 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", 
NULL
));

18 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaa:Ñequiresánárgument"));

19 
	`‰ì
(
îr_ouçut
);

20 
îr_ouçut
 = 
NULL
;

21 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

22 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -a:Ñequiresánárgument"));

23 
	`‰ì
(
îr_ouçut
);

24 
îr_ouçut
 = 
NULL
;

27 
	`›t_ªgi°î_¨g
("--bbb|-b|-c|--ccc", 
ã°_¨g
, 
NULL
, "aaa", "");

28 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--bbb", 
NULL
));

29 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --bbb:Ñequiresánárgument"));

30 
	`‰ì
(
îr_ouçut
);

31 
îr_ouçut
 = 
NULL
;

32 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", 
NULL
));

33 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -b:Ñequiresánárgument"));

34 
	`‰ì
(
îr_ouçut
);

35 
îr_ouçut
 = 
NULL
;

36 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-c", 
NULL
));

37 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -c:Ñequiresánárgument"));

38 
	`‰ì
(
îr_ouçut
);

39 
îr_ouçut
 = 
NULL
;

40 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ccc", 
NULL
));

41 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --ccc:Ñequiresánárgument"));

42 
	`‰ì
(
îr_ouçut
);

43 
îr_ouçut
 = 
NULL
;

46 
	`‰ì
(
¨gv
);

47  
	`exô_°©us
();

48 
	}
}

	@ccan/ccan/opt/test/run-early.c

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dlib.h
>

4 
	~<cˇn/›t/›t.c
>

5 
	~<cˇn/›t/ußge.c
>

6 
	~<cˇn/›t/hñ≥rs.c
>

7 
	~<cˇn/›t/∑r£.c
>

8 
	~"utûs.h
"

10 
›t_èbÀ
 
	gsome_óæy_èbÀ
[] = {

11 
OPT_EARLY_WITHOUT_ARG
("--vîbo£|-v", 
ã°_nﬂrg
,

13 
OPT_EARLY_WITH_ARG
("--debug|-d", 
ã°_¨g
, 
show_¨g
,

15 
OPT_WITHOUT_ARG
("-h|--hhh", 
ã°_nﬂrg
, "hhh", "Description of hhh"),

16 
OPT_ENDTABLE


19 
	$maö
(
¨gc
, *
¨gv
[])

21 c⁄° *
my«me
 = 
¨gv
[0];

23 
	`∂™_ã°s
(37);

26 
	`›t_ªgi°î_nﬂrg
("-a", 
ã°_nﬂrg
, 
NULL
, "All");

27 
	`›t_ªgi°î_óæy_nﬂrg
("-b", 
ã°_nﬂrg
, 
NULL
, "All");

30 
	`ok1
(
	`∑r£_óæy_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

31 
	`ok1
(
¨gc
 == 2);

32 
	`ok1
(
¨gv
[0] =
my«me
);

33 
	`ok1
(
	`°rcmp
(
¨gv
[1], "-a") == 0);

34 
	`ok1
(
¨gv
[2] =
NULL
);

35 
	`ok1
(
ã°_cb_ˇŒed
 == 0);

38 
	`ok1
(
	`∑r£_óæy_¨gs
(&
¨gc
, &
¨gv
, "-b", 
NULL
));

39 
	`ok1
(
¨gc
 == 2);

40 
	`ok1
(
¨gv
[0] =
my«me
);

41 
	`ok1
(
	`°rcmp
(
¨gv
[1], "-b") == 0);

42 
	`ok1
(
¨gv
[2] =
NULL
);

43 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

45 
	`ok1
(
	`∑r£_óæy_¨gs
(&
¨gc
, &
¨gv
, "-ab", 
NULL
));

46 
	`ok1
(
¨gc
 == 2);

47 
	`ok1
(
¨gv
[0] =
my«me
);

48 
	`ok1
(
	`°rcmp
(
¨gv
[1], "-ab") == 0);

49 
	`ok1
(
¨gv
[2] =
NULL
);

50 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

52 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-ab", 
NULL
));

53 
	`ok1
(
¨gc
 == 1);

54 
	`ok1
(
¨gv
[0] =
my«me
);

55 
	`ok1
(
¨gv
[1] =
NULL
);

56 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

58 
	`›t_ªgi°î_èbÀ
(
some_óæy_èbÀ
, "SomeÉarlyárgs");

59 
	`ok1
(
	`∑r£_óæy_¨gs
(&
¨gc
, &
¨gv
, "--vîbo£", "-dddd", "-h", 
NULL
));

60 
	`ok1
(
¨gc
 == 4);

61 
	`ok1
(
¨gv
[0] =
my«me
);

62 
	`ok1
(
	`°rcmp
(
¨gv
[1], "--verbose") == 0);

63 
	`ok1
(
	`°rcmp
(
¨gv
[2], "-dddd") == 0);

64 
	`ok1
(
	`°rcmp
(
¨gv
[3], "-h") == 0);

65 
	`ok1
(
¨gv
[4] =
NULL
);

66 
	`ok1
(
ã°_cb_ˇŒed
 == 5);

68 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--vîbo£", "-d", "ddd", "-h", 
NULL
));

69 
	`ok1
(
¨gc
 == 1);

70 
	`ok1
(
¨gv
[0] =
my«me
);

71 
	`ok1
(
¨gv
[1] =
NULL
);

72 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

75 
	`‰ì
(
¨gv
);

76  
	`exô_°©us
();

77 
	}
}

	@ccan/ccan/opt/test/run-helpers.c

1 
	~"c⁄fig.h
"

2 
	~<°dio.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<£tjmp.h
>

5 
	~<°dlib.h
>

6 
	~<limôs.h
>

7 
	~"utûs.h
"

10 
jmp_buf
 
	gexôed
;

11 
	#exô
(
°©us
Ë
	`l⁄gjmp
(
exôed
, (°©usË+ 1)

	)

13 
	#¥ötf
 
ßved_¥ötf


	)

14 
ßved_¥ötf
(c⁄° *
fmt
, ...);

16 
	#Ârötf
 
ßved_Ârötf


	)

17 
ßved_Ârötf
(
FILE
 *
ign‹ed
, c⁄° *
fmt
, ...);

19 
	#vÂrötf
(
f
, 
fmt
, 
≠
Ë
	`ßved_v¥ötf
(fmt,áp)

	)

20 
ßved_v¥ötf
(c⁄° *
fmt
, 
va_li°
 
≠
);

22 
	~<cˇn/›t/hñ≥rs.c
>

23 
	~<cˇn/›t/›t.c
>

24 
	~<cˇn/›t/ußge.c
>

25 
	~<cˇn/›t/∑r£.c
>

27 *
	gouçut
 = 
NULL
;

29 
	$ßved_v¥ötf
(c⁄° *
fmt
, 
va_li°
 
≠
)

31 *
p
;

32 
ªt
 = 
	`va•rötf
(&
p
, 
fmt
, 
≠
);

34 i‡(
ouçut
) {

35 
ouçut
 = 
	`ªÆloc
(ouçut, 
	`°æí
(ouçutË+ såÀn(
p
) + 1);

36 
	`°rˇt
(
ouçut
, 
p
);

37 
	`‰ì
(
p
);

39 
ouçut
 = 
p
;

40  
ªt
;

41 
	}
}

43 
	$ßved_¥ötf
(c⁄° *
fmt
, ...)

45 
va_li°
 
≠
;

46 
ªt
;

48 
	`va_°¨t
(
≠
, 
fmt
);

49 
ªt
 = 
	`ßved_v¥ötf
(
fmt
, 
≠
);

50 
	`va_íd
(
≠
);

51  
ªt
;

52 
	}
}

54 
	$ßved_Ârötf
(
FILE
 *
ign‹ed
, c⁄° *
fmt
, ...)

56 
va_li°
 
≠
;

57 
ªt
;

59 
	`va_°¨t
(
≠
, 
fmt
);

60 
ªt
 = 
	`ßved_v¥ötf
(
fmt
, 
≠
);

61 
	`va_íd
(
≠
);

62  
ªt
;

63 
	}
}

65 
	$£t_¨gs
(*
¨gc
, ***
¨gv
, ...)

67 
va_li°
 
≠
;

68 *
¨gv
 = 
	`mÆloc
((**argv) * 20);

70 
	`va_°¨t
(
≠
, 
¨gv
);

71 *
¨gc
 = 0;

72 ((*
¨gv
)[*
¨gc
] = 
	`va_¨g
(
≠
, *)Ë!
NULL
;

73 (*
¨gc
)++);

74 
	`va_íd
(
≠
);

75 
	}
}

78 
	$maö
(
¨gc
, *
¨gv
[])

80 
	`∂™_ã°s
(454);

84 
boﬁ
 
¨g
 = 
Ál£
;

85 
	`ª£t_›ti⁄s
();

86 
	`›t_ªgi°î_nﬂrg
("-a", 
›t_£t_boﬁ
, &
¨g
, "");

87 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

88 
	`ok1
(
¨g
);

89 
	`›t_ªgi°î_¨g
("-b", 
›t_£t_boﬁ_¨g
, 
NULL
, &
¨g
, "");

90 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "no", 
NULL
));

91 
	`ok1
(!
¨g
);

92 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "yes", 
NULL
));

93 
	`ok1
(
¨g
);

94 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "Ál£", 
NULL
));

95 
	`ok1
(!
¨g
);

96 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "åue", 
NULL
));

97 
	`ok1
(
¨g
);

98 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "unknown", 
NULL
));

99 
	`ok1
(
¨g
);

100 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -b: Invalidárgument 'unknown'"));

104 
boﬁ
 
¨g
 = 
åue
;

105 
	`ª£t_›ti⁄s
();

106 
	`›t_ªgi°î_nﬂrg
("-a", 
›t_£t_övboﬁ
, &
¨g
, "");

107 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

108 
	`ok1
(!
¨g
);

109 
	`›t_ªgi°î_¨g
("-b", 
›t_£t_övboﬁ_¨g
, 
NULL
,

110 &
¨g
, "");

111 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "no", 
NULL
));

112 
	`ok1
(
¨g
);

113 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "yes", 
NULL
));

114 
	`ok1
(!
¨g
);

115 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "Ál£", 
NULL
));

116 
	`ok1
(
¨g
);

117 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "åue", 
NULL
));

118 
	`ok1
(!
¨g
);

119 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "unknown", 
NULL
));

120 
	`ok1
(!
¨g
);

121 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -b: Invalidárgument 'unknown'"));

125 *
¨g
 = 
	`ˇ°_c⁄°
(*, "wrong");

126 
	`ª£t_›ti⁄s
();

127 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ch¨p
, 
NULL
, &
¨g
, "All");

128 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "°rög", 
NULL
));

129 
	`ok1
(
	`°rcmp
(
¨g
, "string") == 0);

133 
¨g
 = 1000;

134 
	`ª£t_›ti⁄s
();

135 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ötvÆ
, 
NULL
, &
¨g
, "All");

136 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

137 
	`ok1
(
¨g
 == 9999);

138 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

139 
	`ok1
(
¨g
 == -9999);

140 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

141 
	`ok1
(
¨g
 == 0);

142 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

144 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4294967296", 
NULL
));

146 
	`Áû
("Handle other int sizes");

150 
¨g
 = 1000;

151 
	`ª£t_›ti⁄s
();

152 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_uötvÆ
, 
NULL
, &
¨g
, "All");

153 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

154 
	`ok1
(
¨g
 == 9999);

155 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

156 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

157 
	`ok1
(
¨g
 == 0);

158 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

159 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4294967296", 
NULL
));

160 i‡(
ULONG_MAX
 =
UINT_MAX
) {

161 
	`∑ss
("Can'tÅest overflow");

162 
	`∑ss
("Can'tÅestÉrror message");

164 
buf
[30];

165 
	`•rötf
(
buf
, "%lu", 
ULONG_MAX
);

166 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
buf
, 
NULL
));

167 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -a: value '")

168 && 
	`°r°r
(
îr_ouçut
, 
buf
)

169 && 
	`°r°r
(
îr_ouçut
, "' doesÇot fit intoán integer"));

174 
¨g
 = 1000;

175 
	`ª£t_›ti⁄s
();

176 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_l⁄gvÆ
, 
NULL
, &
¨g
, "All");

177 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

178 
	`ok1
(
¨g
 == 9999);

179 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

180 
	`ok1
(
¨g
 == -9999);

181 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

182 
	`ok1
(
¨g
 == 0);

183 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

185 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4294967296", 
NULL
));

187 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "18446744073709551616", 
NULL
));

189 
	`Áû
("FIXME: Handle otherÜong sizes");

193 
¨g
 = 1000;

194 
	`ª£t_›ti⁄s
();

195 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ul⁄gvÆ
, 
NULL
, &
¨g
, "All");

196 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

197 
	`ok1
(
¨g
 == 9999);

198 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

199 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

200 
	`ok1
(
¨g
 == 0);

201 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

203 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4294967296", 
NULL
));

205 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "18446744073709551616", 
NULL
));

207 
	`Áû
("FIXME: Handle otherÜong sizes");

211 c⁄° 
k
 = 1024;

212 c⁄° 
M
 = 
k
 * k;

213 c⁄° 
G
 = 
k
 * k * k;

214 c⁄° 
T
 = 
k
 * k * k * k;

215 c⁄° 
P
 = 
k
 * k * k * k * k;

216 c⁄° 
E
 = 
k
 * k * k * k * k * k;

220 
¨g
 = 1000;

221 
	`ª£t_›ti⁄s
();

222 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_uötvÆ_bi
, 
NULL
,

223 &
¨g
, "All");

224 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

225 
	`ok1
(
¨g
 == 9999);

226 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

227 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

228 
	`ok1
(
¨g
 == 0);

229 
¨g
 = 1;

230 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0k", 
NULL
));

231 
	`ok1
(
¨g
 == 0);

232 
¨g
 = 1;

233 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

234 
	`ok1
(
¨g
 == 0);

235 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "3Q", 
NULL
));

236 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "30k", 
NULL
));

237 
	`ok1
(
¨g
 =30 * 
k
);

238 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1K", 
NULL
));

243 
¨g
 = 1000;

244 
	`ª£t_›ti⁄s
();

245 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ötvÆ_bi
, 
NULL
,

246 &
¨g
, "All");

247 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

248 
	`ok1
(
¨g
 == 9999);

249 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

250 
	`ok1
(
¨g
 == -9999);

251 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

252 
	`ok1
(
¨g
 == 0);

253 
¨g
 = 1;

254 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0k", 
NULL
));

255 
	`ok1
(
¨g
 == 0);

256 
¨g
 = 1;

257 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

258 
	`ok1
(
¨g
 == 0);

259 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "3Q", 
NULL
));

260 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "30k", 
NULL
));

261 
	`ok1
(
¨g
 =30 * 
k
);

262 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1K", 
NULL
));

263 
	`ok1
(
¨g
 =-1 * 
k
);

269 
¨g
 = 1000;

271 
	`ª£t_›ti⁄s
();

272 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ul⁄gvÆ_bi
, 
NULL
,

273 &
¨g
, "All");

274 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

275 
	`ok1
(
¨g
 == 9999);

276 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

277 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

278 
	`ok1
(
¨g
 == 0);

279 
¨g
 = 1;

280 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

281 
	`ok1
(
¨g
 == 0);

282 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

283 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100k", 
NULL
));

284 
	`ok1
(
¨g
 =100 * 
k
);

285 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1K", 
NULL
));

286 
	`ok1
(
¨g
 =1 * 
k
);

287 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "99M", 
NULL
));

288 
	`ok1
(
¨g
 =99 * 
M
);

290 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "2999m", 
NULL
));

291 
	`ok1
(
¨g
 =2999 * 
M
);

292 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1G", 
NULL
));

293 
	`ok1
(
¨g
 =1 * 
G
);

294 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1G", 
NULL
));

296 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4294967296", 
NULL
));

297 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1T", 
NULL
));

298 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1E", 
NULL
));

301 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

302 "18446744073709551616", 
NULL
));

303 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "8E", 
NULL
));

304 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "3E", 
NULL
));

307 
	`Áû
("FIXME: Handle otherÜong sizes");

312 
¨g
 = 1000;

314 
	`ª£t_›ti⁄s
();

315 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_l⁄gvÆ_bi
, 
NULL
,

316 &
¨g
, "All");

317 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

318 
	`ok1
(
¨g
 == 9999);

319 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

320 
	`ok1
(
¨g
 == -9999);

321 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

322 
	`ok1
(
¨g
 == 0);

323 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

324 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

325 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100k", 
NULL
));

326 
	`ok1
(
¨g
 =100 * 
k
);

327 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-100k", 
NULL
));

328 
	`ok1
(
¨g
 =-100 * 
k
);

329 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1K", 
NULL
));

330 
	`ok1
(
¨g
 =1 * 
k
);

331 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "99M", 
NULL
));

332 
	`ok1
(
¨g
 =99 * 
M
);

333 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1G", 
NULL
));

334 
	`ok1
(
¨g
 =1 * 
G
);

335 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1G", 
NULL
));

336 
	`ok1
(
¨g
 =-1 * 
G
);

338 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "2147483648", 
NULL
));

339 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "2G", 
NULL
));

340 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "2048m", 
NULL
));

341 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1T", 
NULL
));

342 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1E", 
NULL
));

345 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

346 "9223372036854775808", 
NULL
));

347 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "3E", 
NULL
));

348 
	`ok1
(
¨g
 =3 * 
E
);

349 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "123T", 
NULL
));

350 
	`ok1
(
¨g
 =123 * 
T
);

353 
	`Áû
("FIXME: Handle otherÜong sizes");

359 
¨g
 = 1000;

360 
	`ª£t_›ti⁄s
();

361 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_l⁄gl⁄gvÆ_bi
, 
NULL
,

362 &
¨g
, "All");

363 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

364 
	`ok1
(
¨g
 == 9999);

365 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

366 
	`ok1
(
¨g
 == -9999);

367 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

368 
	`ok1
(
¨g
 == 0);

369 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

370 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

371 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1kk", 
NULL
));

372 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100k", 
NULL
));

373 
	`ok1
(
¨g
 =100 * 
k
);

374 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-100k", 
NULL
));

375 
	`ok1
(
¨g
 =-100 * 
k
);

376 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1K", 
NULL
));

377 
	`ok1
(
¨g
 =1 * 
k
);

378 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-333333M", 
NULL
));

379 
	`ok1
(
¨g
 =-333333 * 
M
);

380 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1G", 
NULL
));

381 
	`ok1
(
¨g
 =1 * 
G
);

382 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1024t", 
NULL
));

383 
	`ok1
(
¨g
 =1024 * 
T
);

384 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "123P", 
NULL
));

385 
	`ok1
(
¨g
 =123 * 
P
);

386 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-3E", 
NULL
));

387 
	`ok1
(
¨g
 =-3 * 
E
);

390 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

391 "9223372036854775808", 
NULL
));

393 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "8E", 
NULL
));

396 
	`Áû
("FIXME: Handle otherÜongÜong int"

402 
¨g
 = 1000;

403 
	`ª£t_›ti⁄s
();

404 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ul⁄gl⁄gvÆ_bi
, 
NULL
,

405 &
¨g
, "All");

406 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

407 
	`ok1
(
¨g
 == 9999);

408 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

409 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

410 
	`ok1
(
¨g
 == 0);

411 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

412 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1kk", 
NULL
));

413 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100G", 
NULL
));

414 
	`ok1
(
¨g
 =100 * 
G
);

415 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-100G", 
NULL
));

416 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "8191P", 
NULL
));

417 
	`ok1
(
¨g
 =8191 * 
P
);

422 
i
;

423 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

424 
buf
[
OPT_SHOW_LEN
] = '!';

425 
i
 = -77;

426 
	`›t_show_ötvÆ_bi
(
buf
, &
i
);

427 
	`ok1
(
	`°rcmp
(
buf
, "-77") == 0);

428 
i
 = 0;

429 
	`›t_show_ötvÆ_bi
(
buf
, &
i
);

430 
	`ok1
(
	`°rcmp
(
buf
, "0") == 0);

431 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

432 
i
 = 77;

433 
	`›t_show_ötvÆ_bi
(
buf
, &
i
);

434 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

435 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

436 
i
 = -1234 * 
k
;

437 
	`›t_show_ötvÆ_bi
(
buf
, &
i
);

438 
	`ok1
(
	`°rcmp
(
buf
, "-1234k") == 0);

439 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

440 
i
 = 500 * 
M
;

441 
	`›t_show_ötvÆ_bi
(
buf
, &
i
);

442 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

443 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

444 
i
 = 1024 * 
M
;

445 
	`›t_show_ötvÆ_bi
(
buf
, &
i
);

446 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

447 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

452 
i
;

453 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

454 
buf
[
OPT_SHOW_LEN
] = '!';

455 
i
 = -77;

456 
	`›t_show_l⁄gvÆ_bi
(
buf
, &
i
);

457 
	`ok1
(
	`°rcmp
(
buf
, "-77") == 0);

458 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

459 
i
 = 77;

460 
	`›t_show_l⁄gvÆ_bi
(
buf
, &
i
);

461 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

462 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

463 
i
 = -1 * 
k
;

464 
	`›t_show_l⁄gvÆ_bi
(
buf
, &
i
);

465 
	`ok1
(
	`°rcmp
(
buf
, "-1k") == 0);

466 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

467 
i
 = 500 * 
M
;

468 
	`›t_show_l⁄gvÆ_bi
(
buf
, &
i
);

469 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

470 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

471 
i
 = 1024 * 
M
;

472 
	`›t_show_l⁄gvÆ_bi
(
buf
, &
i
);

473 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

474 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

475 
i
 = 0;

476 
	`›t_show_l⁄gvÆ_bi
(
buf
, &
i
);

477 
	`ok1
(
	`°rcmp
(
buf
, "0") == 0);

478 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

483 
i
;

484 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

485 
buf
[
OPT_SHOW_LEN
] = '!';

486 
i
 = -7777;

487 
	`›t_show_l⁄gl⁄gvÆ_bi
(
buf
, &
i
);

488 
	`ok1
(
	`°rcmp
(
buf
, "-7777") == 0);

489 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

490 
i
 = 7777;

491 
	`›t_show_l⁄gl⁄gvÆ_bi
(
buf
, &
i
);

492 
	`ok1
(
	`°rcmp
(
buf
, "7777") == 0);

493 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

494 
i
 = -10240000 * 
k
;

495 
	`›t_show_l⁄gl⁄gvÆ_bi
(
buf
, &
i
);

496 
	`ok1
(
	`°rcmp
(
buf
, "-10000M") == 0);

497 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

498 
i
 = 5 * 
P
;

499 
	`›t_show_l⁄gl⁄gvÆ_bi
(
buf
, &
i
);

500 
	`ok1
(
	`°rcmp
(
buf
, "5P") == 0);

501 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

502 
i
 = 1024 * 
P
;

503 
	`›t_show_l⁄gl⁄gvÆ_bi
(
buf
, &
i
);

504 
	`ok1
(
	`°rcmp
(
buf
, "1E") == 0);

505 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

510 
i
;

511 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

512 
buf
[
OPT_SHOW_LEN
] = '!';

513 
i
 = 77;

514 
	`›t_show_uötvÆ_bi
(
buf
, &
i
);

515 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

516 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

517 
i
 = 1234 * 
k
;

518 
	`›t_show_uötvÆ_bi
(
buf
, &
i
);

519 
	`ok1
(
	`°rcmp
(
buf
, "1234k") == 0);

520 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

521 
i
 = 500 * 
M
;

522 
	`›t_show_uötvÆ_bi
(
buf
, &
i
);

523 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

524 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

525 
i
 = 1024 * 
M
;

526 
	`›t_show_uötvÆ_bi
(
buf
, &
i
);

527 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

528 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

533 
i
;

534 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

535 
buf
[
OPT_SHOW_LEN
] = '!';

536 
i
 = 77;

537 
	`›t_show_ul⁄gvÆ_bi
(
buf
, &
i
);

538 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

539 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

540 
i
 = 
k
;

541 
	`›t_show_ul⁄gvÆ_bi
(
buf
, &
i
);

542 
	`ok1
(
	`°rcmp
(
buf
, "1k") == 0);

543 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

544 
i
 = 500 * 
M
;

545 
	`›t_show_ul⁄gvÆ_bi
(
buf
, &
i
);

546 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

547 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

548 
i
 = 1024 * 
M
;

549 
	`›t_show_ul⁄gvÆ_bi
(
buf
, &
i
);

550 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

551 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

552 
i
 = 0;

553 
	`›t_show_ul⁄gvÆ_bi
(
buf
, &
i
);

554 
	`ok1
(
	`°rcmp
(
buf
, "0") == 0);

555 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

560 
i
;

561 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

562 
buf
[
OPT_SHOW_LEN
] = '!';

563 
i
 = 7777;

564 
	`›t_show_ul⁄gl⁄gvÆ_bi
(
buf
, (*)&
i
);

565 
	`ok1
(
	`°rcmp
(
buf
, "7777") == 0);

566 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

567 
i
 = 10240000 * 
k
;

568 
	`›t_show_ul⁄gl⁄gvÆ_bi
(
buf
, (*)&
i
);

569 
	`ok1
(
	`°rcmp
(
buf
, "10000M") == 0);

570 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

571 
i
 = 5 * 
P
;

572 
	`›t_show_ul⁄gl⁄gvÆ_bi
(
buf
, (*)&
i
);

573 
	`ok1
(
	`°rcmp
(
buf
, "5P") == 0);

574 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

575 
i
 = 1024 * 
P
;

576 
	`›t_show_ul⁄gl⁄gvÆ_bi
(
buf
, (*)&
i
);

577 
	`ok1
(
	`°rcmp
(
buf
, "1E") == 0);

578 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

583 c⁄° 
k
 = 1000;

584 c⁄° 
M
 = 
k
 * k;

585 c⁄° 
G
 = 
k
 * k * k;

586 c⁄° 
T
 = 
k
 * k * k * k;

587 c⁄° 
P
 = 
k
 * k * k * k * k;

588 c⁄° 
E
 = 
k
 * k * k * k * k * k;

592 
¨g
 = 1000;

593 
	`ª£t_›ti⁄s
();

594 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_uötvÆ_si
, 
NULL
,

595 &
¨g
, "All");

596 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

597 
	`ok1
(
¨g
 == 9999);

598 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

599 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

600 
	`ok1
(
¨g
 == 0);

601 
¨g
 = 1;

602 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0k", 
NULL
));

603 
	`ok1
(
¨g
 == 0);

604 
¨g
 = 1;

605 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

606 
	`ok1
(
¨g
 == 0);

607 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "3Q", 
NULL
));

608 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "30k", 
NULL
));

609 
	`ok1
(
¨g
 =30 * 
k
);

610 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1K", 
NULL
));

612 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1E", 
NULL
));

614 
	`∑ss
("can'tÅest intÅruncation when int is so huge");

619 
¨g
 = 1000;

620 
	`ª£t_›ti⁄s
();

621 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ötvÆ_si
, 
NULL
,

622 &
¨g
, "All");

623 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

624 
	`ok1
(
¨g
 == 9999);

625 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

626 
	`ok1
(
¨g
 == -9999);

627 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

628 
	`ok1
(
¨g
 == 0);

629 
¨g
 = 1;

630 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0k", 
NULL
));

631 
	`ok1
(
¨g
 == 0);

632 
¨g
 = 1;

633 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

634 
	`ok1
(
¨g
 == 0);

635 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "", 
NULL
));

636 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "3Q", 
NULL
));

637 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "30k", 
NULL
));

638 
	`ok1
(
¨g
 =30 * 
k
);

639 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1K", 
NULL
));

640 
	`ok1
(
¨g
 =-1 * 
k
);

642 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1E", 
NULL
));

644 
	`∑ss
("can'tÅest intÅruncation when int is so huge");

650 
¨g
 = 1000;

652 
	`ª£t_›ti⁄s
();

653 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ul⁄gvÆ_si
, 
NULL
,

654 &
¨g
, "All");

655 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

656 
	`ok1
(
¨g
 == 9999);

657 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

658 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

659 
	`ok1
(
¨g
 == 0);

660 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

661 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

662 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100k", 
NULL
));

663 
	`ok1
(
¨g
 =100 * 
k
);

664 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1K", 
NULL
));

665 
	`ok1
(
¨g
 =1 * 
k
);

666 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "99M", 
NULL
));

667 
	`ok1
(
¨g
 =99 * 
M
);

669 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "2999m", 
NULL
));

670 
	`ok1
(
¨g
 =2999 * 
M
);

671 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1G", 
NULL
));

672 
	`ok1
(
¨g
 =1 * 
G
);

673 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1G", 
NULL
));

674 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4G", 
NULL
));

675 
	`ok1
(
¨g
 == 4000000000U);

677 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4294967296", 
NULL
));

678 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4295M", 
NULL
));

679 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1T", 
NULL
));

680 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1E", 
NULL
));

683 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

684 "18446744073709551616", 
NULL
));

685 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9E", 
NULL
));

686 
	`ok1
(
¨g
 == 9000000000000000000ULL);

687 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "19E", 
NULL
));

690 
	`Áû
("FIXME: Handle otherÜong sizes");

695 
¨g
 = 1000;

697 
	`ª£t_›ti⁄s
();

698 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_l⁄gvÆ_si
, 
NULL
,

699 &
¨g
, "All");

700 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

701 
	`ok1
(
¨g
 == 9999);

702 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

703 
	`ok1
(
¨g
 == -9999);

704 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0P", 
NULL
));

705 
	`ok1
(
¨g
 == 0);

706 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

707 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

708 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100k", 
NULL
));

709 
	`ok1
(
¨g
 =100 * 
k
);

710 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-100k", 
NULL
));

711 
	`ok1
(
¨g
 =-100 * 
k
);

712 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1K", 
NULL
));

713 
	`ok1
(
¨g
 =1 * 
k
);

714 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "99M", 
NULL
));

715 
	`ok1
(
¨g
 =99 * 
M
);

716 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1G", 
NULL
));

717 
	`ok1
(
¨g
 =1 * 
G
);

718 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-1G", 
NULL
));

719 
	`ok1
(
¨g
 =-1 * 
G
);

721 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "2147483648", 
NULL
));

722 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "4G", 
NULL
));

723 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1T", 
NULL
));

724 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1E", 
NULL
));

725 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1999m", 
NULL
));

726 
	`ok1
(
¨g
 =1999 * 
M
);

729 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

730 "9223372036854775808", 
NULL
));

731 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9224P", 
NULL
));

732 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9E", 
NULL
));

733 
	`ok1
(
¨g
 =9 * 
E
);

734 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "123T", 
NULL
));

735 
	`ok1
(
¨g
 =123 * 
T
);

738 
	`Áû
("FIXME: Handle otherÜong sizes");

744 
¨g
 = 1000;

745 
	`ª£t_›ti⁄s
();

746 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_l⁄gl⁄gvÆ_si
, 
NULL
,

747 &
¨g
, "All");

748 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

749 
	`ok1
(
¨g
 == 9999);

750 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

751 
	`ok1
(
¨g
 == -9999);

752 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0T", 
NULL
));

753 
	`ok1
(
¨g
 == 0);

754 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100¸≠", 
NULL
));

755 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

756 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1kk", 
NULL
));

757 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100k", 
NULL
));

758 
	`ok1
(
¨g
 =100 * 
k
);

759 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-100k", 
NULL
));

760 
	`ok1
(
¨g
 =-100 * 
k
);

761 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1K", 
NULL
));

762 
	`ok1
(
¨g
 =1 * 
k
);

763 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-333333M", 
NULL
));

764 
	`ok1
(
¨g
 =-333333 * 
M
);

765 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1G", 
NULL
));

766 
	`ok1
(
¨g
 =1 * 
G
);

767 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1024t", 
NULL
));

768 
	`ok1
(
¨g
 =1024 * 
T
);

769 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "123P", 
NULL
));

770 
	`ok1
(
¨g
 =123 * 
P
);

771 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-3E", 
NULL
));

772 
	`ok1
(
¨g
 =-3 * 
E
);

773 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "8E", 
NULL
));

775 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

776 "9223372036854775808", 
NULL
));

777 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a",

778 "10E", 
NULL
));

781 
	`Áû
("FIXME: Handle otherÜongÜong int"

788 
¨g
 = 1000;

789 
	`ª£t_›ti⁄s
();

790 
	`›t_ªgi°î_¨g
("-a", 
›t_£t_ul⁄gl⁄gvÆ_si
, 
NULL
,

791 &
¨g
, "All");

792 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "9999", 
NULL
));

793 
	`ok1
(
¨g
 == 9999);

794 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-9999", 
NULL
));

795 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "0", 
NULL
));

796 
	`ok1
(
¨g
 == 0);

797 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1Q", 
NULL
));

798 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "1kk", 
NULL
));

799 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "100G", 
NULL
));

800 
	`ok1
(
¨g
 =100 * 
G
);

801 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-100G", 
NULL
));

802 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "8E", 
NULL
));

806 
i
;

807 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

808 
buf
[
OPT_SHOW_LEN
] = '!';

809 
i
 = -77;

810 
	`›t_show_ötvÆ_si
(
buf
, &
i
);

811 
	`ok1
(
	`°rcmp
(
buf
, "-77") == 0);

812 
i
 = 0;

813 
	`›t_show_ötvÆ_si
(
buf
, &
i
);

814 
	`ok1
(
	`°rcmp
(
buf
, "0") == 0);

815 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

816 
i
 = 77;

817 
	`›t_show_ötvÆ_si
(
buf
, &
i
);

818 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

819 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

820 
i
 = -1234 * 
k
;

821 
	`›t_show_ötvÆ_si
(
buf
, &
i
);

822 
	`ok1
(
	`°rcmp
(
buf
, "-1234k") == 0);

823 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

824 
i
 = 500 * 
M
;

825 
	`›t_show_ötvÆ_si
(
buf
, &
i
);

826 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

827 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

828 
i
 = 1000 * 
M
;

829 
	`›t_show_ötvÆ_si
(
buf
, &
i
);

830 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

831 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

836 
i
;

837 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

838 
buf
[
OPT_SHOW_LEN
] = '!';

839 
i
 = -77;

840 
	`›t_show_l⁄gvÆ_si
(
buf
, &
i
);

841 
	`ok1
(
	`°rcmp
(
buf
, "-77") == 0);

842 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

843 
i
 = 77;

844 
	`›t_show_l⁄gvÆ_si
(
buf
, &
i
);

845 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

846 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

847 
i
 = -1 * 
k
;

848 
	`›t_show_l⁄gvÆ_si
(
buf
, &
i
);

849 
	`ok1
(
	`°rcmp
(
buf
, "-1k") == 0);

850 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

851 
i
 = 500 * 
M
;

852 
	`›t_show_l⁄gvÆ_si
(
buf
, &
i
);

853 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

854 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

855 
i
 = 1000 * 
M
;

856 
	`›t_show_l⁄gvÆ_si
(
buf
, &
i
);

857 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

858 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

859 
i
 = 0;

860 
	`›t_show_l⁄gvÆ_si
(
buf
, &
i
);

861 
	`ok1
(
	`°rcmp
(
buf
, "0") == 0);

862 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

867 
i
;

868 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

869 
buf
[
OPT_SHOW_LEN
] = '!';

870 
i
 = -7777;

871 
	`›t_show_l⁄gl⁄gvÆ_si
(
buf
, &
i
);

872 
	`ok1
(
	`°rcmp
(
buf
, "-7777") == 0);

873 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

874 
i
 = 7777;

875 
	`›t_show_l⁄gl⁄gvÆ_si
(
buf
, &
i
);

876 
	`ok1
(
	`°rcmp
(
buf
, "7777") == 0);

877 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

878 
i
 = -10240000 * 
k
;

879 
	`›t_show_l⁄gl⁄gvÆ_si
(
buf
, &
i
);

880 
	`ok1
(
	`°rcmp
(
buf
, "-10240M") == 0);

881 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

882 
i
 = 5 * 
P
;

883 
	`›t_show_l⁄gl⁄gvÆ_si
(
buf
, &
i
);

884 
	`ok1
(
	`°rcmp
(
buf
, "5P") == 0);

885 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

886 
i
 = 2000 * 
P
;

887 
	`›t_show_l⁄gl⁄gvÆ_si
(
buf
, &
i
);

888 
	`ok1
(
	`°rcmp
(
buf
, "2E") == 0);

889 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

894 
i
;

895 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

896 
buf
[
OPT_SHOW_LEN
] = '!';

897 
i
 = 77;

898 
	`›t_show_uötvÆ_si
(
buf
, &
i
);

899 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

900 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

901 
i
 = 1234 * 
k
;

902 
	`›t_show_uötvÆ_si
(
buf
, &
i
);

903 
	`ok1
(
	`°rcmp
(
buf
, "1234k") == 0);

904 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

905 
i
 = 500 * 
M
;

906 
	`›t_show_uötvÆ_si
(
buf
, &
i
);

907 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

908 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

909 
i
 = 1000 * 
M
;

910 
	`›t_show_uötvÆ_si
(
buf
, &
i
);

911 
	`ok1
(
	`°rcmp
(
buf
, "1G") == 0);

912 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

917 
i
;

918 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

919 
buf
[
OPT_SHOW_LEN
] = '!';

920 
i
 = 77;

921 
	`›t_show_ul⁄gvÆ_si
(
buf
, &
i
);

922 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

923 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

924 
i
 = 
k
;

925 
	`›t_show_ul⁄gvÆ_si
(
buf
, &
i
);

926 
	`ok1
(
	`°rcmp
(
buf
, "1k") == 0);

927 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

928 
i
 = 500 * 
M
;

929 
	`›t_show_ul⁄gvÆ_si
(
buf
, &
i
);

930 
	`ok1
(
	`°rcmp
(
buf
, "500M") == 0);

931 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

932 
i
 = 1024 * 
M
;

933 
	`›t_show_ul⁄gvÆ_si
(
buf
, &
i
);

934 
	`ok1
(
	`°rcmp
(
buf
, "1024M") == 0);

935 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

936 
i
 = 0;

937 
	`›t_show_ul⁄gvÆ_si
(
buf
, &
i
);

938 
	`ok1
(
	`°rcmp
(
buf
, "0") == 0);

939 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

944 
i
;

945 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

946 
buf
[
OPT_SHOW_LEN
] = '!';

947 
i
 = 7777;

948 
	`›t_show_ul⁄gl⁄gvÆ_si
(
buf
, (*)&
i
);

949 
	`ok1
(
	`°rcmp
(
buf
, "7777") == 0);

950 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

951 
i
 = 10240000 * 
k
;

952 
	`›t_show_ul⁄gl⁄gvÆ_si
(
buf
, (*)&
i
);

953 
	`ok1
(
	`°rcmp
(
buf
, "10240M") == 0);

954 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

955 
i
 = 5 * 
P
;

956 
	`›t_show_ul⁄gl⁄gvÆ_si
(
buf
, (*)&
i
);

957 
	`ok1
(
	`°rcmp
(
buf
, "5P") == 0);

958 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

959 
i
 = 1000 * 
P
;

960 
	`›t_show_ul⁄gl⁄gvÆ_si
(
buf
, (*)&
i
);

961 
	`ok1
(
	`°rcmp
(
buf
, "1E") == 0);

962 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

970 
¨g
 = 1000;

971 
	`ª£t_›ti⁄s
();

972 
	`›t_ªgi°î_nﬂrg
("-a", 
›t_öc_ötvÆ
, &
¨g
, "");

973 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

974 
	`ok1
(
¨g
 == 1001);

975 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "-a", 
NULL
));

976 
	`ok1
(
¨g
 == 1003);

977 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Ø", 
NULL
));

978 
	`ok1
(
¨g
 == 1005);

983 
exôvÆ
;

984 
	`ª£t_›ti⁄s
();

985 
	`›t_ªgi°î_nﬂrg
("-a",

986 
›t_vîsi⁄_™d_exô
, "1.2.3", "");

988 
	`‰ì
(
¨gv
);

990 
	`£t_¨gs
(&
¨gc
, &
¨gv
, "thi•rog", "-a", 
NULL
);

992 
exôvÆ
 = 
	`£tjmp
(
exôed
);

993 i‡(
exôvÆ
 == 0) {

994 
	`›t_∑r£
(&
¨gc
, 
¨gv
, 
ßve_îr_ouçut
);

995 
	`Áû
("opt_show_version_and_exitÑeturned?");

997 
	`ok1
(
exôvÆ
 - 1 == 0);

999 
	`ok1
(
›t_èbÀ
 =
NULL
);

1001 
	`ok1
(
	`°rcmp
(
ouçut
, "1.2.3\n") == 0);

1002 
	`‰ì
(
ouçut
);

1003 
	`‰ì
(
¨gv
);

1004 
ouçut
 = 
NULL
;

1009 
exôvÆ
;

1010 
	`ª£t_›ti⁄s
();

1011 
	`›t_ªgi°î_nﬂrg
("-a",

1012 
›t_ußge_™d_exô
, "[args]", "");

1014 
	`£t_¨gs
(&
¨gc
, &
¨gv
, "thi•rog", "-a", 
NULL
);

1016 
exôvÆ
 = 
	`£tjmp
(
exôed
);

1017 i‡(
exôvÆ
 == 0) {

1018 
	`›t_∑r£
(&
¨gc
, 
¨gv
, 
ßve_îr_ouçut
);

1019 
	`Áû
("opt_usage_and_exitÑeturned?");

1021 
	`ok1
(
exôvÆ
 - 1 == 0);

1023 
	`ok1
(
›t_èbÀ
 =
NULL
);

1025 
	`ok1
(
	`°r°r
(
ouçut
, "[args]"));

1026 
	`ok1
(
	`°r°r
(
ouçut
, 
¨gv
[0]));

1027 
	`ok1
(
	`°r°r
(
ouçut
, "\n-a"));

1028 
	`‰ì
(
ouçut
);

1029 
	`‰ì
(
¨gv
);

1030 
ouçut
 = 
NULL
;

1035 
boﬁ
 
b
;

1036 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1037 
buf
[
OPT_SHOW_LEN
] = '!';

1039 
b
 = 
åue
;

1040 
	`›t_show_boﬁ
(
buf
, &
b
);

1041 
	`ok1
(
	`°rcmp
(
buf
, "true") == 0);

1042 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1044 
b
 = 
Ál£
;

1045 
	`›t_show_boﬁ
(
buf
, &
b
);

1046 
	`ok1
(
	`°rcmp
(
buf
, "false") == 0);

1047 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1052 
boﬁ
 
b
;

1053 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1054 
buf
[
OPT_SHOW_LEN
] = '!';

1056 
b
 = 
åue
;

1057 
	`›t_show_övboﬁ
(
buf
, &
b
);

1058 
	`ok1
(
	`°rcmp
(
buf
, "false") == 0);

1059 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1061 
b
 = 
Ál£
;

1062 
	`›t_show_övboﬁ
(
buf
, &
b
);

1063 
	`ok1
(
	`°rcmp
(
buf
, "true") == 0);

1064 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1069 
°r
[
OPT_SHOW_LEN
*2], *
p
;

1070 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1071 
buf
[
OPT_SHOW_LEN
] = '!';

1074 
p
 = 
°r
;

1075 
	`°r˝y
(
p
, "short");

1076 
	`›t_show_ch¨p
(
buf
, &
p
);

1077 
	`ok1
(
	`°rcmp
(
buf
, "\"short\"") == 0);

1078 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1081 
	`mem£t
(
p
, 'x', 
OPT_SHOW_LEN
*2);

1082 
p
[
OPT_SHOW_LEN
*2-1] = '\0';

1083 
	`›t_show_ch¨p
(
buf
, &
p
);

1084 
	`ok1
(
buf
[0] == '"');

1085 
	`ok1
(
buf
[
OPT_SHOW_LEN
-1] == '"');

1086 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1087 
	`ok1
(
	`°r•n
(
buf
+1, "x"Ë=
OPT_SHOW_LEN
-2);

1092 
i
;

1093 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1094 
buf
[
OPT_SHOW_LEN
] = '!';

1096 
i
 = -77;

1097 
	`›t_show_ötvÆ
(
buf
, &
i
);

1098 
	`ok1
(
	`°rcmp
(
buf
, "-77") == 0);

1099 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1101 
i
 = 77;

1102 
	`›t_show_ötvÆ
(
buf
, &
i
);

1103 
	`ok1
(
	`°rcmp
(
buf
, "77") == 0);

1104 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1109 
ui
;

1110 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1111 
buf
[
OPT_SHOW_LEN
] = '!';

1113 
ui
 = 4294967295U;

1114 
	`›t_show_uötvÆ
(
buf
, &
ui
);

1115 
	`ok1
(
	`°rcmp
(
buf
, "4294967295") == 0);

1116 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1121 
l
;

1122 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1123 
buf
[
OPT_SHOW_LEN
] = '!';

1125 
l
 = 1234567890L;

1126 
	`›t_show_l⁄gvÆ
(
buf
, &
l
);

1127 
	`ok1
(
	`°rcmp
(
buf
, "1234567890") == 0);

1128 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1133 
ul
;

1134 
buf
[
OPT_SHOW_LEN
+2] = { 0 };

1135 
buf
[
OPT_SHOW_LEN
] = '!';

1137 
ul
 = 4294967295UL;

1138 
	`›t_show_ul⁄gvÆ
(
buf
, &
ul
);

1139 
	`ok1
(
	`°rcmp
(
buf
, "4294967295") == 0);

1140 
	`ok1
(
buf
[
OPT_SHOW_LEN
] == '!');

1145 
	`ª£t_›ti⁄s
();

1146 
	`›t_ªgi°î_nﬂrg
("-a",

1147 
›t_ußge_™d_exô
, "[args]", "");

1149 
	`£t_¨gs
(&
¨gc
, &
¨gv
, "thi•rog", "--g¨bage", 
NULL
);

1150 
	`ok1
(!
	`›t_∑r£
(&
¨gc
, 
¨gv
, 
›t_log_°dîr
));

1151 
	`ok1
(!
	`°rcmp
(
ouçut
,

1153 
	`‰ì
(
ouçut
);

1154 
	`‰ì
(
¨gv
);

1155 
ouçut
 = 
NULL
;

1160 
exôvÆ
;

1161 
	`ª£t_›ti⁄s
();

1162 
	`›t_ªgi°î_nﬂrg
("-a",

1163 
›t_ußge_™d_exô
, "[args]", "");

1164 
	`£t_¨gs
(&
¨gc
, &
¨gv
, "thi•rog", "--g¨bage", 
NULL
);

1165 
exôvÆ
 = 
	`£tjmp
(
exôed
);

1166 i‡(
exôvÆ
 == 0) {

1167 
	`›t_∑r£
(&
¨gc
, 
¨gv
, 
›t_log_°dîr_exô
);

1168 
	`Áû
("opt_log_stderr_exitÑeturned?");

1170 
	`ok1
(
exôvÆ
 - 1 == 1);

1172 
	`‰ì
(
¨gv
);

1173 
	`ok1
(!
	`°rcmp
(
ouçut
,

1175 
	`‰ì
(
ouçut
);

1176 
ouçut
 = 
NULL
;

1180  
	`exô_°©us
();

1181 
	}
}

	@ccan/ccan/opt/test/run-iter.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<°d¨g.h
>

3 
	~<£tjmp.h
>

4 
	~<°dlib.h
>

5 
	~<°d¨g.h
>

6 
	~"utûs.h
"

7 
	~<cˇn/›t/›t.c
>

8 
	~<cˇn/›t/ußge.c
>

9 
	~<cˇn/›t/hñ≥rs.c
>

10 
	~<cˇn/›t/∑r£.c
>

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
j
, 
i
, 
Àn
 = 0;

16 c⁄° *
p
;

18 
	`∂™_ã°s
(37 * 2);

19 
j
 = 0; j < 2; j ++) {

20 
	`ª£t_›ti⁄s
();

22 
	`›t_ªgi°î_èbÀ
(
subèbÀs
, 
j
 =0 ? 
NULL
 : "subtable");

24 
p
 = 
	`fú°_l›t
(&
i
, &
Àn
);

25 
	`ok1
(
i
 =
j
 + 0);

26 
	`ok1
(
Àn
 == 3);

27 
	`ok1
(
	`°∫cmp
(
p
, "jjj", 
Àn
) == 0);

28 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

29 
	`ok1
(
i
 =
j
 + 0);

30 
	`ok1
(
Àn
 == 3);

31 
	`ok1
(
	`°∫cmp
(
p
, "Œl", 
Àn
) == 0);

32 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

33 
	`ok1
(
i
 =
j
 + 1);

34 
	`ok1
(
Àn
 == 3);

35 
	`ok1
(
	`°∫cmp
(
p
, "mmm", 
Àn
) == 0);

36 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

37 
	`ok1
(
i
 =
j
 + 5);

38 
	`ok1
(
Àn
 == 3);

39 
	`ok1
(
	`°∫cmp
(
p
, "ddd", 
Àn
) == 0);

40 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

41 
	`ok1
(
i
 =
j
 + 6);

42 
	`ok1
(
Àn
 == 3);

43 
	`ok1
(
	`°∫cmp
(
p
, "ìe", 
Àn
) == 0);

44 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

45 
	`ok1
(
i
 =
j
 + 7);

46 
	`ok1
(
Àn
 == 3);

47 
	`ok1
(
	`°∫cmp
(
p
, "ggg", 
Àn
) == 0);

48 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

49 
	`ok1
(
i
 =
j
 + 8);

50 
	`ok1
(
Àn
 == 3);

51 
	`ok1
(
	`°∫cmp
(
p
, "hhh", 
Àn
) == 0);

52 
p
 = 
	`√xt_l›t
’, &
i
, &
Àn
);

53 
	`ok1
(!
p
);

55 
p
 = 
	`fú°_s›t
(&
i
);

56 
	`ok1
(
i
 =
j
 + 0);

57 
	`ok1
(*
p
 == 'j');

58 
p
 = 
	`√xt_s›t
’, &
i
);

59 
	`ok1
(
i
 =
j
 + 0);

60 
	`ok1
(*
p
 == 'l');

61 
p
 = 
	`√xt_s›t
’, &
i
);

62 
	`ok1
(
i
 =
j
 + 1);

63 
	`ok1
(*
p
 == 'm');

64 
p
 = 
	`√xt_s›t
’, &
i
);

65 
	`ok1
(
i
 =
j
 + 2);

66 
	`ok1
(*
p
 == 'a');

67 
p
 = 
	`√xt_s›t
’, &
i
);

68 
	`ok1
(
i
 =
j
 + 3);

69 
	`ok1
(*
p
 == 'b');

70 
p
 = 
	`√xt_s›t
’, &
i
);

71 
	`ok1
(
i
 =
j
 + 7);

72 
	`ok1
(*
p
 == 'g');

73 
p
 = 
	`√xt_s›t
’, &
i
);

74 
	`ok1
(
i
 =
j
 + 8);

75 
	`ok1
(*
p
 == 'h');

76 
p
 = 
	`√xt_s›t
’, &
i
);

77 
	`ok1
(!
p
);

80  
	`exô_°©us
();

81 
	}
}

	@ccan/ccan/opt/test/run-no-options.c

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dlib.h
>

4 
	~<cˇn/›t/›t.c
>

5 
	~<cˇn/›t/ußge.c
>

6 
	~<cˇn/›t/hñ≥rs.c
>

7 
	~<cˇn/›t/∑r£.c
>

8 
	~"utûs.h
"

10 
	$maö
(
¨gc
, *
¨gv
[])

12 c⁄° *
my«me
 = 
¨gv
[0];

14 
	`∂™_ã°s
(7);

17 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

19 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", 
NULL
));

22 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "exåa", "¨gs", 
NULL
));

23 
	`ok1
(
¨gc
 == 3);

24 
	`ok1
(
¨gv
[0] =
my«me
);

25 
	`ok1
(
	`°rcmp
(
¨gv
[1], "extra") == 0);

26 
	`ok1
(
	`°rcmp
(
¨gv
[2], "args") == 0);

29 
	`‰ì
(
¨gv
);

31  
	`exô_°©us
();

32 
	}
}

	@ccan/ccan/opt/test/run-set_alloc.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<°dlib.h
>

5 *
	$no_mÆloc
(
size_t
 
size
)

7 
	`ab‹t
();

8 
	}
}

9 *
	$no_ªÆloc
(*
p
, 
size_t
 
size
)

11 
	`ab‹t
();

12 
	}
}

13 
	$no_‰ì
(*
p
)

15 
	`ab‹t
();

16 
	}
}

17 
	#mÆloc
 
no_mÆloc


	)

18 
	#ªÆloc
 
no_ªÆloc


	)

19 
	#‰ì
 
no_‰ì


	)

21 
	~<cˇn/›t/›t.c
>

22 
	~<cˇn/›t/ußge.c
>

23 
	~<cˇn/›t/hñ≥rs.c
>

24 
	~<cˇn/›t/∑r£.c
>

25 
	~"utûs.h
"

27 #unde‡
mÆloc


28 #unde‡
ªÆloc


29 #unde‡
‰ì


31 
	gÆloc_cou¡
, 
	gªÆloc_cou¡
, 
	g‰ì_cou¡
;

32 *
	g±rs
[100];

34 **
	$föd_±r
(*
p
)

36 
i
;

38 
i
 = 0; i < 100; i++)

39 i‡(
±rs
[
i
] =
p
)

40  
±rs
 + 
i
;

41  
NULL
;

42 
	}
}

44 *
	$Æloc‚
(
size_t
 
size
)

46 
Æloc_cou¡
++;

47  *
	`föd_±r
(
NULL
Ë
	`mÆloc
(
size
);

48 
	}
}

50 *
	$ªÆloc‚
(*
±r
, 
size_t
 
size
)

52 
ªÆloc_cou¡
++;

53 i‡(!
±r
)

54 
Æloc_cou¡
++;

56  *
	`föd_±r
(
±r
Ë
	`ªÆloc
’å, 
size
);

57 
	}
}

59 
	$‰ì‚
(*
±r
)

61 
‰ì_cou¡
++;

62 
	`‰ì
(
±r
);

63 *
	`föd_±r
(
±r
Ë
NULL
;

64 
	}
}

66 
	$maö
(
¨gc
, *
¨gv
[])

68 c⁄° *
my«me
 = 
¨gv
[0];

70 
	`∂™_ã°s
(220);

72 
	`›t_£t_Æloc
(
Æloc‚
, 
ªÆloc‚
, 
‰ì‚
);

75 
	`›t_ªgi°î_nﬂrg
("-a", 
ã°_nﬂrg
, 
NULL
, "All");

76 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

77 
	`ok1
(
¨gc
 == 1);

78 
	`ok1
(
¨gv
[0] =
my«me
);

79 
	`ok1
(
¨gv
[1] =
NULL
);

80 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

83 
	`›t_ªgi°î_nﬂrg
("--Øa", 
ã°_nﬂrg
, 
NULL
, "AAAAll");

84 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", 
NULL
));

85 
	`ok1
(
¨gc
 == 1);

86 
	`ok1
(
¨gv
[0] =
my«me
);

87 
	`ok1
(
¨gv
[1] =
NULL
);

88 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

91 
	`›t_ªgi°î_nﬂrg
("--Øa|-a", 
ã°_nﬂrg
, 
NULL
, "AAAAAAll");

92 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", "-a", 
NULL
));

93 
	`ok1
(
¨gc
 == 1);

94 
	`ok1
(
¨gv
[0] =
my«me
);

95 
	`ok1
(
¨gv
[1] =
NULL
);

96 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

99 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", "-a", "exåa", "¨gs", 
NULL
));

100 
	`ok1
(
¨gc
 == 3);

101 
	`ok1
(
¨gv
[0] =
my«me
);

102 
	`ok1
(
	`°rcmp
(
¨gv
[1], "extra") == 0);

103 
	`ok1
(
	`°rcmp
(
¨gv
[2], "args") == 0);

104 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

107 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa˜rg", 
NULL
));

108 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaa: doesn'tállowánárgument"));

109 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø", 
NULL
));

110 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aa: unrecognized option"));

111 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø¨gh", 
NULL
));

112 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaargh: unrecognized option"));

115 
	`ª£t_›ti⁄s
();

116 
ã°_cb_ˇŒed
 = 0;

117 
	`›t_ªgi°î_¨g
("-a|--Øa", 
ã°_¨g
, 
NULL
, "aaa", "AAAAAAll");

118 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", "Øa", 
NULL
));

119 
	`ok1
(
¨gc
 == 1);

120 
	`ok1
(
¨gv
[0] =
my«me
);

121 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

123 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa˜Ø", 
NULL
));

124 
	`ok1
(
¨gc
 == 1);

125 
	`ok1
(
¨gv
[0] =
my«me
);

126 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

128 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "Øa", 
NULL
));

129 
	`ok1
(
¨gc
 == 1);

130 
	`ok1
(
¨gv
[0] =
my«me
);

131 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

134 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

135 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -a:Ñequiresánárgument"));

136 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", 
NULL
));

137 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaa:Ñequiresánárgument"));

138 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø", 
NULL
));

139 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aa: unrecognized option"));

140 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø¨gh", 
NULL
));

141 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaargh: unrecognized option"));

145 
	`ª£t_›ti⁄s
();

146 
ã°_cb_ˇŒed
 = 0;

147 
	`›t_ªgi°î_èbÀ
(
sh‹t_èbÀ
, 
NULL
);

148 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

149 
	`ok1
(
¨gc
 == 1);

150 
	`ok1
(
¨gv
[0] =
my«me
);

151 
	`ok1
(
¨gv
[1] =
NULL
);

152 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

154 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", 
NULL
Ë=
Ál£
);

155 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

156 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "b", 
NULL
));

157 
	`ok1
(
¨gc
 == 1);

158 
	`ok1
(
¨gv
[0] =
my«me
);

159 
	`ok1
(
¨gv
[1] =
NULL
);

160 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

163 
	`ª£t_›ti⁄s
();

164 
ã°_cb_ˇŒed
 = 0;

165 
	`›t_ªgi°î_èbÀ
(
l⁄g_èbÀ
, 
NULL
);

166 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ddd", 
NULL
));

167 
	`ok1
(
¨gc
 == 1);

168 
	`ok1
(
¨gv
[0] =
my«me
);

169 
	`ok1
(
¨gv
[1] =
NULL
);

170 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

172 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", 
NULL
Ë=
Ál£
);

173 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

174 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", "ìe", 
NULL
));

175 
	`ok1
(
¨gc
 == 1);

176 
	`ok1
(
¨gv
[0] =
my«me
);

177 
	`ok1
(
¨gv
[1] =
NULL
);

178 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

181 
	`ª£t_›ti⁄s
();

182 
ã°_cb_ˇŒed
 = 0;

183 
	`›t_ªgi°î_èbÀ
(
l⁄g_™d_sh‹t_èbÀ
, 
NULL
);

184 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-g", 
NULL
));

185 
	`ok1
(
¨gc
 == 1);

186 
	`ok1
(
¨gv
[0] =
my«me
);

187 
	`ok1
(
¨gv
[1] =
NULL
);

188 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

189 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ggg", 
NULL
));

190 
	`ok1
(
¨gc
 == 1);

191 
	`ok1
(
¨gv
[0] =
my«me
);

192 
	`ok1
(
¨gv
[1] =
NULL
);

193 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

195 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", 
NULL
Ë=
Ál£
);

196 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

197 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", "hhh", 
NULL
));

198 
	`ok1
(
¨gc
 == 1);

199 
	`ok1
(
¨gv
[0] =
my«me
);

200 
	`ok1
(
¨gv
[1] =
NULL
);

201 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

202 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", 
NULL
Ë=
Ál£
);

203 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

204 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", "hhh", 
NULL
));

205 
	`ok1
(
¨gc
 == 1);

206 
	`ok1
(
¨gv
[0] =
my«me
);

207 
	`ok1
(
¨gv
[1] =
NULL
);

208 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

211 
ã°_cb_ˇŒed
 = 0;

212 
	`ª£t_›ti⁄s
();

213 
	`›t_ªgi°î_èbÀ
(
subèbÀs
, 
NULL
);

214 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

215 
	`ok1
(
¨gc
 == 1);

216 
	`ok1
(
¨gv
[0] =
my«me
);

217 
	`ok1
(
¨gv
[1] =
NULL
);

218 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

220 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", 
NULL
Ë=
Ál£
);

221 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

222 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "b", 
NULL
));

223 
	`ok1
(
¨gc
 == 1);

224 
	`ok1
(
¨gv
[0] =
my«me
);

225 
	`ok1
(
¨gv
[1] =
NULL
);

226 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

228 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ddd", 
NULL
));

229 
	`ok1
(
¨gc
 == 1);

230 
	`ok1
(
¨gv
[0] =
my«me
);

231 
	`ok1
(
¨gv
[1] =
NULL
);

232 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

234 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", 
NULL
Ë=
Ál£
);

235 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

236 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", "ìe", 
NULL
));

237 
	`ok1
(
¨gc
 == 1);

238 
	`ok1
(
¨gv
[0] =
my«me
);

239 
	`ok1
(
¨gv
[1] =
NULL
);

240 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

243 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-g", 
NULL
));

244 
	`ok1
(
¨gc
 == 1);

245 
	`ok1
(
¨gv
[0] =
my«me
);

246 
	`ok1
(
¨gv
[1] =
NULL
);

247 
	`ok1
(
ã°_cb_ˇŒed
 == 5);

248 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ggg", 
NULL
));

249 
	`ok1
(
¨gc
 == 1);

250 
	`ok1
(
¨gv
[0] =
my«me
);

251 
	`ok1
(
¨gv
[1] =
NULL
);

252 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

254 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", 
NULL
Ë=
Ál£
);

255 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

256 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", "hhh", 
NULL
));

257 
	`ok1
(
¨gc
 == 1);

258 
	`ok1
(
¨gv
[0] =
my«me
);

259 
	`ok1
(
¨gv
[1] =
NULL
);

260 
	`ok1
(
ã°_cb_ˇŒed
 == 7);

261 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", 
NULL
Ë=
Ál£
);

262 
	`ok1
(
ã°_cb_ˇŒed
 == 7);

263 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", "hhh", 
NULL
));

264 
	`ok1
(
¨gc
 == 1);

265 
	`ok1
(
¨gv
[0] =
my«me
);

266 
	`ok1
(
¨gv
[1] =
NULL
);

267 
	`ok1
(
ã°_cb_ˇŒed
 == 8);

270 
ã°_cb_ˇŒed
 = 0;

271 
	`ª£t_›ti⁄s
();

274 
	`›t_ªgi°î_nﬂrg
("-?", 
ã°_nﬂrg
, 
NULL
, "Help");

275 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-?", 
NULL
));

276 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

277 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
Ë=
Ál£
);

278 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

279 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -a: unrecognized option"));

280 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ØØ", 
NULL
Ë=
Ál£
);

281 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

282 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaaa: unrecognized option"));

284 
ã°_cb_ˇŒed
 = 0;

285 
	`ª£t_›ti⁄s
();

288 
	`›t_ªgi°î_nﬂrg
("-a|--Øa", 
ã°_nﬂrg
, 
NULL
, "a");

289 
	`›t_ªgi°î_¨g
("-b|--bbb", 
ã°_¨g
, 
NULL
, "bbb", "b");

290 
	`›t_ªgi°î_¨g
("-c|--ccc", 
ã°_¨g
, 
NULL
, "aaa", "c");

292 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Ø", 
NULL
));

293 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

294 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øb", 
NULL
Ë=
Ál£
);

295 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

296 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -b:Ñequiresánárgument"));

297 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-bbbb", 
NULL
));

298 
	`ok1
(
ã°_cb_ˇŒed
 == 5);

299 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", 
NULL
));

300 
	`ok1
(
ã°_cb_ˇŒed
 == 8);

301 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", "-b", "bbb", 
NULL
));

302 
	`ok1
(
ã°_cb_ˇŒed
 == 12);

303 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", "--bbb", "bbb", 
NULL
));

304 
	`ok1
(
ã°_cb_ˇŒed
 == 16);

305 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", "--bbb=bbb", 
NULL
));

306 
	`ok1
(
ã°_cb_ˇŒed
 == 20);

307 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-ØˇØ", 
NULL
));

308 
	`ok1
(
ã°_cb_ˇŒed
 == 23);

309 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-ØˇØ", "-a", 
NULL
));

310 
	`ok1
(
ã°_cb_ˇŒed
 == 27);

311 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-aacaaa", "--bbb", "bbb", "-aacaaa",

312 
NULL
));

313 
	`ok1
(
ã°_cb_ˇŒed
 == 34);

315 
ã°_cb_ˇŒed
 = 0;

316 
	`ª£t_›ti⁄s
();

319 
	`›t_ªgi°î_nﬂrg
("-a|--Øa", 
ã°_nﬂrg
, 
NULL
, "a");

320 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "--", "-a", 
NULL
));

321 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

322 
	`ok1
(
¨gc
 == 2);

323 
	`ok1
(
	`°rcmp
(
¨gv
[1], "-a") == 0);

324 
	`ok1
(!
¨gv
[2]);

326 
	`un£ãnv
("POSIXLY_CORRECT");

327 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "somórg", "-a", "--", "-a", 
NULL
));

328 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

329 
	`ok1
(
¨gc
 == 3);

330 
	`ok1
(
	`°rcmp
(
¨gv
[1], "somearg") == 0);

331 
	`ok1
(
	`°rcmp
(
¨gv
[2], "-a") == 0);

332 
	`ok1
(!
¨gv
[3]);

334 
	`£ãnv
("POSIXLY_CORRECT", "1", 1);

335 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "somórg", "-a", "--", "-a", 
NULL
));

336 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

337 
	`ok1
(
¨gc
 == 5);

338 
	`ok1
(
	`°rcmp
(
¨gv
[1], "somearg") == 0);

339 
	`ok1
(
	`°rcmp
(
¨gv
[2], "-a") == 0);

340 
	`ok1
(
	`°rcmp
(
¨gv
[3], "--") == 0);

341 
	`ok1
(
	`°rcmp
(
¨gv
[4], "-a") == 0);

342 
	`ok1
(!
¨gv
[5]);

345 
	`ok1
(
ªÆloc_cou¡
);

346 
	`ok1
(
Æloc_cou¡
);

347 
	`ok1
(
‰ì_cou¡
);

349 
	`ok1
(
‰ì_cou¡
 < 
Æloc_cou¡
);

350 
	`ª£t_›ti⁄s
();

351 
	`ok1
(
‰ì_cou¡
 =
Æloc_cou¡
);

354 
	`‰ì
(
¨gv
);

355  
	`exô_°©us
();

356 
	}
}

	@ccan/ccan/opt/test/run-usage.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<°d¨g.h
>

3 
	~<£tjmp.h
>

4 
	~<°dlib.h
>

5 
	~<°d¨g.h
>

6 
	~"utûs.h
"

9 c⁄° *
	$gëív_ovîride
(c⁄° *
«me
)

12 
	}
}

14 
	#gëív
 
gëív_ovîride


	)

16 
	~<cˇn/›t/›t.c
>

17 
	~<cˇn/›t/ußge.c
>

18 
	~<cˇn/›t/hñ≥rs.c
>

19 
	~<cˇn/›t/∑r£.c
>

21 *
	$my_cb
(*
p
)

23  
NULL
;

24 
	}
}

27 
	$maö
(
¨gc
, *
¨gv
[])

29 *
ouçut
;

30 *
l⁄g«me
 = 
	`°rdup
("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa");

31 *
sh‹äame
 = 
	`°rdup
("shortname");

33 
	`∂™_ã°s
(48);

34 
	`›t_ªgi°î_èbÀ
(
subèbÀs
, 
NULL
);

35 
	`›t_ªgi°î_nﬂrg
("--kkk|-k", 
my_cb
, 
NULL
, "magic kkk option");

36 
	`›t_ªgi°î_nﬂrg
("-?", 
›t_ußge_™d_exô
, "<MyArgs>...",

38 
	`›t_ªgi°î_¨g
("--l⁄g«me", 
›t_£t_ch¨p
, 
›t_show_ch¨p
,

39 &
l⁄g«me
, "aÑeallyÜong option default");

40 
	`›t_ªgi°î_¨g
("--sh‹äame", 
›t_£t_ch¨p
, 
›t_show_ch¨p
,

41 &
sh‹äame
, "a short option default");

42 
ouçut
 = 
	`›t_ußge
("myÇame", "ExTrA Args");

43 
	`düg
("%s", 
ouçut
);

44 
	`ok1
(
	`°r°r
(
ouçut
, "Usage: myÇame"));

45 
	`ok1
(
	`°r°r
(
ouçut
, "--jjj|-j|--lll|-l <arg>"));

46 
	`ok1
(
	`°r°r
(
ouçut
, "ExTrA Args"));

47 
	`ok1
(
	`°r°r
(
ouçut
, "-a "));

48 
	`ok1
(
	`°r°r
(
ouçut
, " Description ofá\n"));

49 
	`ok1
(
	`°r°r
(
ouçut
, "-b <arg>"));

50 
	`ok1
(
	`°r°r
(
ouçut
, " Description of b (default: b)\n"));

51 
	`ok1
(
	`°r°r
(
ouçut
, "--ddd "));

52 
	`ok1
(
	`°r°r
(
ouçut
, " Description of ddd\n"));

53 
	`ok1
(
	`°r°r
(
ouçut
, "--eee <filename> "));

54 
	`ok1
(
	`°r°r
(
ouçut
, " (default:Éee)\n"));

55 
	`ok1
(
	`°r°r
(
ouçut
, "longÅable options:\n"));

56 
	`ok1
(
	`°r°r
(
ouçut
, "--ggg|-g "));

57 
	`ok1
(
	`°r°r
(
ouçut
, " Description of ggg\n"));

58 
	`ok1
(
	`°r°r
(
ouçut
, "-h|--hhh <arg>"));

59 
	`ok1
(
	`°r°r
(
ouçut
, " Description of hhh\n"));

60 
	`ok1
(
	`°r°r
(
ouçut
, "--kkk|-k"));

61 
	`ok1
(
	`°r°r
(
ouçut
, "magic kkk option"));

63 
	`ok1
(!
	`°r°r
(
ouçut
, "--mmm|-m"));

64 
	`‰ì
(
ouçut
);

67 
ouçut
 = 
	`›t_ußge
("myÇame", 
NULL
);

68 
	`düg
("%s", 
ouçut
);

69 
	`ok1
(
	`°r°r
(
ouçut
, "Usage: myÇame"));

70 
	`ok1
(
	`°r°r
(
ouçut
, "--jjj|-j|--lll|-l <arg>"));

71 
	`ok1
(
	`°r°r
(
ouçut
, "<MyArgs>..."));

72 
	`ok1
(
	`°r°r
(
ouçut
, "-a "));

73 
	`ok1
(
	`°r°r
(
ouçut
, " Description ofá\n"));

74 
	`ok1
(
	`°r°r
(
ouçut
, "-b <arg>"));

75 
	`ok1
(
	`°r°r
(
ouçut
, " Description of b (default: b)\n"));

76 
	`ok1
(
	`°r°r
(
ouçut
, "--ddd "));

77 
	`ok1
(
	`°r°r
(
ouçut
, " Description of ddd\n"));

78 
	`ok1
(
	`°r°r
(
ouçut
, "--eee <filename> "));

79 
	`ok1
(
	`°r°r
(
ouçut
, " (default:Éee)\n"));

80 
	`ok1
(
	`°r°r
(
ouçut
, "longÅable options:\n"));

81 
	`ok1
(
	`°r°r
(
ouçut
, "--ggg|-g "));

82 
	`ok1
(
	`°r°r
(
ouçut
, " Description of ggg\n"));

83 
	`ok1
(
	`°r°r
(
ouçut
, "-h|--hhh <arg>"));

84 
	`ok1
(
	`°r°r
(
ouçut
, " Description of hhh\n"));

85 
	`ok1
(
	`°r°r
(
ouçut
, "--kkk|-k"));

86 
	`ok1
(
	`°r°r
(
ouçut
, "magic kkk option"));

87 
	`ok1
(
	`°r°r
(
ouçut
, "--longname"));

88 
	`ok1
(
	`°r°r
(
ouçut
, "aÑeallyÜong option default"));

89 
	`ok1
(
	`°r°r
(
ouçut
, "(default: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"...)"));

90 
	`ok1
(
	`°r°r
(
ouçut
, "--shortname"));

91 
	`ok1
(
	`°r°r
(
ouçut
, "a short option default"));

92 
	`ok1
(
	`°r°r
(
ouçut
, "(default: \"shortname\")"));

94 
	`ok1
(!
	`°r°r
(
ouçut
, "--mmm|-m"));

95 
	`‰ì
(
ouçut
);

97 
	`ª£t_›ti⁄s
();

99 
ouçut
 = 
	`›t_ußge
("nŸhög", 
NULL
);

100 
	`ok1
(
	`°r°r
(
ouçut
, "Usage:Çothing \n"));

101 
	`‰ì
(
ouçut
);

104 
	`›t_ªgi°î_nﬂrg
("--Øa", 
ã°_nﬂrg
, 
NULL
, "AAAAll");

105 
ouçut
 = 
	`›t_ußge
("⁄órg", 
NULL
);

106 
	`ok1
(
	`°r°r
(
ouçut
, "Usage: onearg \n"));

107 
	`ok1
(
	`°r°r
(
ouçut
, "--aaa"));

108 
	`ok1
(
	`°r°r
(
ouçut
, "AAAAll"));

109 
	`‰ì
(
ouçut
);

111 
	`‰ì
(
sh‹äame
);

112 
	`‰ì
(
l⁄g«me
);

113  
	`exô_°©us
();

114 
	}
}

	@ccan/ccan/opt/test/run.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<°dlib.h
>

3 
	~<cˇn/›t/›t.c
>

4 
	~<cˇn/›t/ußge.c
>

5 
	~<cˇn/›t/hñ≥rs.c
>

6 
	~<cˇn/›t/∑r£.c
>

7 
	~"utûs.h
"

9 
	$maö
(
¨gc
, *
¨gv
[])

11 c⁄° *
my«me
 = 
¨gv
[0];

13 
	`∂™_ã°s
(215);

16 
	`›t_ªgi°î_nﬂrg
("-a", 
ã°_nﬂrg
, 
NULL
, "All");

17 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

18 
	`ok1
(
¨gc
 == 1);

19 
	`ok1
(
¨gv
[0] =
my«me
);

20 
	`ok1
(
¨gv
[1] =
NULL
);

21 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

24 
	`›t_ªgi°î_nﬂrg
("--Øa", 
ã°_nﬂrg
, 
NULL
, "AAAAll");

25 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", 
NULL
));

26 
	`ok1
(
¨gc
 == 1);

27 
	`ok1
(
¨gv
[0] =
my«me
);

28 
	`ok1
(
¨gv
[1] =
NULL
);

29 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

32 
	`›t_ªgi°î_nﬂrg
("--Øa|-a", 
ã°_nﬂrg
, 
NULL
, "AAAAAAll");

33 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", "-a", 
NULL
));

34 
	`ok1
(
¨gc
 == 1);

35 
	`ok1
(
¨gv
[0] =
my«me
);

36 
	`ok1
(
¨gv
[1] =
NULL
);

37 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

40 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", "-a", "exåa", "¨gs", 
NULL
));

41 
	`ok1
(
¨gc
 == 3);

42 
	`ok1
(
¨gv
[0] =
my«me
);

43 
	`ok1
(
	`°rcmp
(
¨gv
[1], "extra") == 0);

44 
	`ok1
(
	`°rcmp
(
¨gv
[2], "args") == 0);

45 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

48 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa˜rg", 
NULL
));

49 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaa: doesn'tállowánárgument"));

50 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø", 
NULL
));

51 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aa: unrecognized option"));

52 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø¨gh", 
NULL
));

53 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaargh: unrecognized option"));

56 
	`ª£t_›ti⁄s
();

57 
ã°_cb_ˇŒed
 = 0;

58 
	`›t_ªgi°î_¨g
("-a|--Øa", 
ã°_¨g
, 
NULL
, "aaa", "AAAAAAll");

59 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", "Øa", 
NULL
));

60 
	`ok1
(
¨gc
 == 1);

61 
	`ok1
(
¨gv
[0] =
my«me
);

62 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

64 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa˜Ø", 
NULL
));

65 
	`ok1
(
¨gc
 == 1);

66 
	`ok1
(
¨gv
[0] =
my«me
);

67 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

69 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "Øa", 
NULL
));

70 
	`ok1
(
¨gc
 == 1);

71 
	`ok1
(
¨gv
[0] =
my«me
);

72 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

75 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

76 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -a:Ñequiresánárgument"));

77 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Øa", 
NULL
));

78 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaa:Ñequiresánárgument"));

79 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø", 
NULL
));

80 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aa: unrecognized option"));

81 
	`ok1
(!
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--Ø¨gh", 
NULL
));

82 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaargh: unrecognized option"));

86 
	`ª£t_›ti⁄s
();

87 
ã°_cb_ˇŒed
 = 0;

88 
	`›t_ªgi°î_èbÀ
(
sh‹t_èbÀ
, 
NULL
);

89 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

90 
	`ok1
(
¨gc
 == 1);

91 
	`ok1
(
¨gv
[0] =
my«me
);

92 
	`ok1
(
¨gv
[1] =
NULL
);

93 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

95 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", 
NULL
Ë=
Ál£
);

96 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

97 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "b", 
NULL
));

98 
	`ok1
(
¨gc
 == 1);

99 
	`ok1
(
¨gv
[0] =
my«me
);

100 
	`ok1
(
¨gv
[1] =
NULL
);

101 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

104 
	`ª£t_›ti⁄s
();

105 
ã°_cb_ˇŒed
 = 0;

106 
	`›t_ªgi°î_èbÀ
(
l⁄g_èbÀ
, 
NULL
);

107 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ddd", 
NULL
));

108 
	`ok1
(
¨gc
 == 1);

109 
	`ok1
(
¨gv
[0] =
my«me
);

110 
	`ok1
(
¨gv
[1] =
NULL
);

111 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

113 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", 
NULL
Ë=
Ál£
);

114 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

115 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", "ìe", 
NULL
));

116 
	`ok1
(
¨gc
 == 1);

117 
	`ok1
(
¨gv
[0] =
my«me
);

118 
	`ok1
(
¨gv
[1] =
NULL
);

119 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

122 
	`ª£t_›ti⁄s
();

123 
ã°_cb_ˇŒed
 = 0;

124 
	`›t_ªgi°î_èbÀ
(
l⁄g_™d_sh‹t_èbÀ
, 
NULL
);

125 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-g", 
NULL
));

126 
	`ok1
(
¨gc
 == 1);

127 
	`ok1
(
¨gv
[0] =
my«me
);

128 
	`ok1
(
¨gv
[1] =
NULL
);

129 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

130 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ggg", 
NULL
));

131 
	`ok1
(
¨gc
 == 1);

132 
	`ok1
(
¨gv
[0] =
my«me
);

133 
	`ok1
(
¨gv
[1] =
NULL
);

134 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

136 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", 
NULL
Ë=
Ál£
);

137 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

138 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", "hhh", 
NULL
));

139 
	`ok1
(
¨gc
 == 1);

140 
	`ok1
(
¨gv
[0] =
my«me
);

141 
	`ok1
(
¨gv
[1] =
NULL
);

142 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

143 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", 
NULL
Ë=
Ál£
);

144 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

145 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", "hhh", 
NULL
));

146 
	`ok1
(
¨gc
 == 1);

147 
	`ok1
(
¨gv
[0] =
my«me
);

148 
	`ok1
(
¨gv
[1] =
NULL
);

149 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

152 
ã°_cb_ˇŒed
 = 0;

153 
	`ª£t_›ti⁄s
();

154 
	`›t_ªgi°î_èbÀ
(
subèbÀs
, 
NULL
);

155 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
));

156 
	`ok1
(
¨gc
 == 1);

157 
	`ok1
(
¨gv
[0] =
my«me
);

158 
	`ok1
(
¨gv
[1] =
NULL
);

159 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

161 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", 
NULL
Ë=
Ál£
);

162 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

163 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-b", "b", 
NULL
));

164 
	`ok1
(
¨gc
 == 1);

165 
	`ok1
(
¨gv
[0] =
my«me
);

166 
	`ok1
(
¨gv
[1] =
NULL
);

167 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

169 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ddd", 
NULL
));

170 
	`ok1
(
¨gc
 == 1);

171 
	`ok1
(
¨gv
[0] =
my«me
);

172 
	`ok1
(
¨gv
[1] =
NULL
);

173 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

175 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", 
NULL
Ë=
Ál£
);

176 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

177 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ìe", "ìe", 
NULL
));

178 
	`ok1
(
¨gc
 == 1);

179 
	`ok1
(
¨gv
[0] =
my«me
);

180 
	`ok1
(
¨gv
[1] =
NULL
);

181 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

184 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-g", 
NULL
));

185 
	`ok1
(
¨gc
 == 1);

186 
	`ok1
(
¨gv
[0] =
my«me
);

187 
	`ok1
(
¨gv
[1] =
NULL
);

188 
	`ok1
(
ã°_cb_ˇŒed
 == 5);

189 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ggg", 
NULL
));

190 
	`ok1
(
¨gc
 == 1);

191 
	`ok1
(
¨gv
[0] =
my«me
);

192 
	`ok1
(
¨gv
[1] =
NULL
);

193 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

195 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", 
NULL
Ë=
Ál£
);

196 
	`ok1
(
ã°_cb_ˇŒed
 == 6);

197 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-h", "hhh", 
NULL
));

198 
	`ok1
(
¨gc
 == 1);

199 
	`ok1
(
¨gv
[0] =
my«me
);

200 
	`ok1
(
¨gv
[1] =
NULL
);

201 
	`ok1
(
ã°_cb_ˇŒed
 == 7);

202 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", 
NULL
Ë=
Ál£
);

203 
	`ok1
(
ã°_cb_ˇŒed
 == 7);

204 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--hhh", "hhh", 
NULL
));

205 
	`ok1
(
¨gc
 == 1);

206 
	`ok1
(
¨gv
[0] =
my«me
);

207 
	`ok1
(
¨gv
[1] =
NULL
);

208 
	`ok1
(
ã°_cb_ˇŒed
 == 8);

211 
ã°_cb_ˇŒed
 = 0;

212 
	`ª£t_›ti⁄s
();

215 
	`›t_ªgi°î_nﬂrg
("-?", 
ã°_nﬂrg
, 
NULL
, "Help");

216 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-?", 
NULL
));

217 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

218 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", 
NULL
Ë=
Ál£
);

219 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

220 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -a: unrecognized option"));

221 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "--ØØ", 
NULL
Ë=
Ál£
);

222 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

223 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": --aaaa: unrecognized option"));

225 
ã°_cb_ˇŒed
 = 0;

226 
	`ª£t_›ti⁄s
();

229 
	`›t_ªgi°î_nﬂrg
("-a|--Øa", 
ã°_nﬂrg
, 
NULL
, "a");

230 
	`›t_ªgi°î_¨g
("-b|--bbb", 
ã°_¨g
, 
NULL
, "bbb", "b");

231 
	`›t_ªgi°î_¨g
("-c|--ccc", 
ã°_¨g
, 
NULL
, "aaa", "c");

233 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Ø", 
NULL
));

234 
	`ok1
(
ã°_cb_ˇŒed
 == 2);

235 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øb", 
NULL
Ë=
Ál£
);

236 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

237 
	`ok1
(
	`°r°r
(
îr_ouçut
, ": -b:Ñequiresánárgument"));

238 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-bbbb", 
NULL
));

239 
	`ok1
(
ã°_cb_ˇŒed
 == 5);

240 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", 
NULL
));

241 
	`ok1
(
ã°_cb_ˇŒed
 == 8);

242 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", "-b", "bbb", 
NULL
));

243 
	`ok1
(
ã°_cb_ˇŒed
 == 12);

244 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", "--bbb", "bbb", 
NULL
));

245 
	`ok1
(
ã°_cb_ˇŒed
 == 16);

246 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-Øbbbb", "--bbb=bbb", 
NULL
));

247 
	`ok1
(
ã°_cb_ˇŒed
 == 20);

248 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-ØˇØ", 
NULL
));

249 
	`ok1
(
ã°_cb_ˇŒed
 == 23);

250 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-ØˇØ", "-a", 
NULL
));

251 
	`ok1
(
ã°_cb_ˇŒed
 == 27);

252 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-aacaaa", "--bbb", "bbb", "-aacaaa",

253 
NULL
));

254 
	`ok1
(
ã°_cb_ˇŒed
 == 34);

256 
ã°_cb_ˇŒed
 = 0;

257 
	`ª£t_›ti⁄s
();

260 
	`›t_ªgi°î_nﬂrg
("-a|--Øa", 
ã°_nﬂrg
, 
NULL
, "a");

261 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "--", "-a", 
NULL
));

262 
	`ok1
(
ã°_cb_ˇŒed
 == 1);

263 
	`ok1
(
¨gc
 == 2);

264 
	`ok1
(
	`°rcmp
(
¨gv
[1], "-a") == 0);

265 
	`ok1
(!
¨gv
[2]);

267 
	`un£ãnv
("POSIXLY_CORRECT");

268 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "somórg", "-a", "--", "-a", 
NULL
));

269 
	`ok1
(
ã°_cb_ˇŒed
 == 3);

270 
	`ok1
(
¨gc
 == 3);

271 
	`ok1
(
	`°rcmp
(
¨gv
[1], "somearg") == 0);

272 
	`ok1
(
	`°rcmp
(
¨gv
[2], "-a") == 0);

273 
	`ok1
(!
¨gv
[3]);

275 
	`£ãnv
("POSIXLY_CORRECT", "1", 1);

276 
	`ok1
(
	`∑r£_¨gs
(&
¨gc
, &
¨gv
, "-a", "somórg", "-a", "--", "-a", 
NULL
));

277 
	`ok1
(
ã°_cb_ˇŒed
 == 4);

278 
	`ok1
(
¨gc
 == 5);

279 
	`ok1
(
	`°rcmp
(
¨gv
[1], "somearg") == 0);

280 
	`ok1
(
	`°rcmp
(
¨gv
[2], "-a") == 0);

281 
	`ok1
(
	`°rcmp
(
¨gv
[3], "--") == 0);

282 
	`ok1
(
	`°rcmp
(
¨gv
[4], "-a") == 0);

283 
	`ok1
(!
¨gv
[5]);

286 
	`‰ì
(
¨gv
);

287  
	`exô_°©us
();

288 
	}
}

	@ccan/ccan/opt/test/utils.c

1 
	~"c⁄fig.h
"

2 
	~<cˇn/èp/èp.h
>

3 
	~<°d¨g.h
>

4 
	~<°dlib.h
>

5 
	~<cˇn/›t/›t.h
>

6 
	~<°rög.h
>

7 
	~<°dio.h
>

8 
	~"utûs.h
"

10 
	gã°_cb_ˇŒed
;

11 *
	$ã°_nﬂrg
(*
¨g
)

13 
ã°_cb_ˇŒed
++;

14  
NULL
;

15 
	}
}

17 *
	$ã°_¨g
(c⁄° *
›èrg
, c⁄° *
¨g
)

19 
ã°_cb_ˇŒed
++;

20 
	`ok1
(
	`°rcmp
(
›èrg
, 
¨g
) == 0);

21  
NULL
;

22 
	}
}

24 
	$show_¨g
(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
)

26 
	`°∫˝y
(
buf
, 
¨g
, 
OPT_SHOW_LEN
);

27 
	}
}

29 *
	gîr_ouçut
 = 
NULL
;

31 
	$ßve_îr_ouçut
(c⁄° *
fmt
, ...)

33 
va_li°
 
≠
;

34 *
p
;

36 
	`va_°¨t
(
≠
, 
fmt
);

38 i‡(
	`va•rötf
(&
p
, 
fmt
, 
≠
) == -1)

39 
p
 = 
NULL
;

40 
	`va_íd
(
≠
);

42 i‡(
îr_ouçut
) {

43 
îr_ouçut
 = 
	`ªÆloc
(err_output,

44 
	`°æí
(
îr_ouçut
Ë+ såÀn(
p
) + 1);

45 
	`°rˇt
(
îr_ouçut
, 
p
);

46 
	`‰ì
(
p
);

48 
îr_ouçut
 = 
p
;

49 
	}
}

51 
	$ª£t_›ti⁄s
()

53 
	`›t_‰ì_èbÀ
();

54 
	`‰ì
(
îr_ouçut
);

55 
îr_ouçut
 = 
NULL
;

56 
	}
}

58 
boﬁ
 
	gÆloˇãd
 = 
Ál£
;

60 
boﬁ
 
	$∑r£_¨gs
(*
¨gc
, ***
¨gv
, ...)

62 **
a
;

63 
va_li°
 
≠
;

65 
	`va_°¨t
(
≠
, 
¨gv
);

66 *
¨gc
 = 1;

67 
a
 = 
	`mÆloc
((*aË* (*
¨gc
 + 1));

68 
a
[0] = (*
¨gv
)[0];

69 (
a
[*
¨gc
] = 
	`va_¨g
(
≠
, *)Ë!
NULL
) {

70 (*
¨gc
)++;

71 
a
 = 
	`ªÆloc
◊, (*aË* (*
¨gc
 + 1));

74 i‡(
Æloˇãd
)

75 
	`‰ì
(*
¨gv
);

77 *
¨gv
 = 
a
;

78 
Æloˇãd
 = 
åue
;

80  
	`›t_∑r£
(
¨gc
, *
¨gv
, 
ßve_îr_ouçut
);

81 
	}
}

83 
boﬁ
 
	$∑r£_óæy_¨gs
(*
¨gc
, ***
¨gv
, ...)

85 **
a
;

86 
va_li°
 
≠
;

88 
	`va_°¨t
(
≠
, 
¨gv
);

89 *
¨gc
 = 1;

90 
a
 = 
	`mÆloc
((*aË* (*
¨gc
 + 1));

91 
a
[0] = (*
¨gv
)[0];

92 (
a
[*
¨gc
] = 
	`va_¨g
(
≠
, *)Ë!
NULL
) {

93 (*
¨gc
)++;

94 
a
 = 
	`ªÆloc
◊, (*aË* (*
¨gc
 + 1));

97 i‡(
Æloˇãd
)

98 
	`‰ì
(*
¨gv
);

100 *
¨gv
 = 
a
;

101 
Æloˇãd
 = 
åue
;

103  
	`›t_óæy_∑r£
(*
¨gc
, *
¨gv
, 
ßve_îr_ouçut
);

104 
	}
}

106 
›t_èbÀ
 
	gsh‹t_èbÀ
[] = {

108 
OPT_WITHOUT_ARG
("-a", 
ã°_nﬂrg
, "a", "Description ofá"),

109 
OPT_WITH_ARG
("-b", 
ã°_¨g
, 
show_¨g
, "b", "Description of b"),

110 
OPT_ENDTABLE


113 
›t_èbÀ
 
	gl⁄g_èbÀ
[] = {

115 
OPT_WITHOUT_ARG
("--ddd", 
ã°_nﬂrg
, "ddd", "Description of ddd"),

116 
OPT_WITH_ARG
("--ìê<fûíame>", 
ã°_¨g
, 
show_¨g
, "eee", ""),

117 
OPT_ENDTABLE


120 
›t_èbÀ
 
	gl⁄g_™d_sh‹t_èbÀ
[] = {

122 
OPT_WITHOUT_ARG
("--ggg|-g", 
ã°_nﬂrg
, "ggg", "Description of ggg"),

123 
OPT_WITH_ARG
("-h|--hhh", 
ã°_¨g
, 
NULL
, "hhh", "Description of hhh"),

124 
OPT_ENDTABLE


128 
›t_èbÀ
 
	gsubèbÀs
[] = {

130 
OPT_WITH_ARG
("--jjj|-j|--Œl|-l", 
ã°_¨g
, 
show_¨g
, "jjj", ""),

132 
OPT_WITH_ARG
("--mmm|-m", 
ã°_¨g
, 
show_¨g
, "mmm", 
›t_hiddí
),

133 
OPT_SUBTABLE
(
sh‹t_èbÀ
, 
NULL
),

134 
OPT_SUBTABLE
(
l⁄g_èbÀ
, "longÅable options"),

135 
OPT_SUBTABLE
(
l⁄g_™d_sh‹t_èbÀ
, 
NULL
),

136 
OPT_ENDTABLE


	@ccan/ccan/opt/test/utils.h

1 #i‚de‡
CCAN_OPT_TEST_UTILS_H


2 
	#CCAN_OPT_TEST_UTILS_H


	)

3 
	~<cˇn/›t/›t.h
>

4 
	~<°dboﬁ.h
>

6 
boﬁ
 
∑r£_¨gs
(*
¨gc
, ***
¨gv
, ...);

7 
boﬁ
 
∑r£_óæy_¨gs
(*
¨gc
, ***
¨gv
, ...);

8 *
îr_ouçut
;

9 
ßve_îr_ouçut
(c⁄° *
fmt
, ...);

10 
ª£t_›ti⁄s
();

12 
ã°_cb_ˇŒed
;

13 *
ã°_nﬂrg
(*
¨g
);

14 *
ã°_¨g
(c⁄° *
›èrg
, c⁄° *
¨g
);

15 
show_¨g
(
buf
[
OPT_SHOW_LEN
], c⁄° *
¨g
);

17 
›t_èbÀ
 
sh‹t_èbÀ
[];

18 
›t_èbÀ
 
l⁄g_èbÀ
[];

19 
›t_èbÀ
 
l⁄g_™d_sh‹t_èbÀ
[];

20 
›t_èbÀ
 
subèbÀs
[];

	@ccan/ccan/opt/usage.c

2 
	~<cˇn/›t/›t.h
>

3 
	~<sys/io˘l.h
>

4 
	~<sys/ãrmios.h
>

5 
	~<sys/uni°d.h
>

6 
	~<°rög.h
>

7 
	~<°dlib.h
>

8 
	~<°dio.h
>

9 
	~<°döt.h
>

10 
	~"¥iv©e.h
"

13 c⁄° 
	g›t_hiddí
[1];

15 
	#MIN_DESC_WIDTH
 40

	)

16 
	#MIN_TOTAL_WIDTH
 50

	)

18 
	$gë_cﬁumns
()

20 
wösize
 
w
;

21 c⁄° *
ív
 = 
	`gëív
("COLUMNS");

23 
w
.
ws_cﬁ
 = 0;

24 i‡(
ív
)

25 
w
.
ws_cﬁ
 = 
	`©oi
(
ív
);

26 i‡(!
w
.
ws_cﬁ
)

27 i‡(
	`io˘l
(0, 
TIOCGWINSZ
, &
w
) == -1)

28 
w
.
ws_cﬁ
 = 0;

29 i‡(!
w
.
ws_cﬁ
)

30 
w
.
ws_cﬁ
 = 80;

32  
w
.
ws_cﬁ
;

33 
	}
}

38 
size_t
 
	$c⁄sume_w‹ds
(c⁄° *
w‹ds
, 
size_t
 
maxÀn
, size_à*
¥efix
)

40 
size_t
 
ﬁdÀn
, 
Àn
;

43 *
¥efix
 = 
	`°r•n
(
w‹ds
, " ");

44 
w‹ds
 +*
¥efix
;

47 
ﬁdÀn
 = 
Àn
 = 
	`°rc•n
(
w‹ds
, " ");

48 
Àn
 <
maxÀn
) {

49 
ﬁdÀn
 = 
Àn
;

50 
Àn
 +
	`°r•n
(
w‹ds
+len, " ");

51 
Àn
 +
	`°rc•n
(
w‹ds
+len, " ");

52 i‡(
Àn
 =
ﬁdÀn
)

56  
ﬁdÀn
;

57 
	}
}

59 *
	$add_°r_Àn
(*
ba£
, 
size_t
 *
Àn
, size_à*
max
,

60 c⁄° *
°r
, 
size_t
 
¶í
)

62 i‡(
¶í
 >*
max
 - *
Àn
)

63 
ba£
 = 
›t_Æloc
.
	`ªÆloc
(ba£, *
max
 = (*max * 2 + 
¶í
 + 1));

64 
	`mem˝y
(
ba£
 + *
Àn
, 
°r
, 
¶í
);

65 *
Àn
 +
¶í
;

66  
ba£
;

67 
	}
}

69 *
	$add_°r
(*
ba£
, 
size_t
 *
Àn
, size_à*
max
, c⁄° *
°r
)

71  
	`add_°r_Àn
(
ba£
, 
Àn
, 
max
, 
°r
, 
	`°æí
(str));

72 
	}
}

74 *
	$add_ödít
(*
ba£
, 
size_t
 *
Àn
, size_à*
max
, size_à
ödít
)

76 i‡(
ödít
 >*
max
 - *
Àn
)

77 
ba£
 = 
›t_Æloc
.
	`ªÆloc
(ba£, *
max
 = (*max * 2 + 
ödít
 + 1));

78 
	`mem£t
(
ba£
 + *
Àn
, ' ', 
ödít
);

79 *
Àn
 +
ödít
;

80  
ba£
;

81 
	}
}

83 *
	$add_desc
(*
ba£
, 
size_t
 *
Àn
, size_à*
max
,

84 
ödít
, 
width
,

85 c⁄° 
›t_èbÀ
 *
›t
)

87 
size_t
 
off
, 
¥efix
, 
l
;

88 c⁄° *
p
;

89 
boﬁ
 
ßme_löe
 = 
Ál£
;

91 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, 
›t
->
«mes
);

92 
off
 = 
	`°æí
(
›t
->
«mes
);

93 i‡(
›t
->
ty≥
 =
OPT_HASARG


94 && !
	`°rchr
(
›t
->
«mes
, ' ')

95 && !
	`°rchr
(
›t
->
«mes
, '=')) {

96 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, " <arg>");

97 
off
 +
	`°æí
(" <arg>");

101 i‡(
off
 + 2 > 
ödít
) {

102 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, "\n");

103 
off
 = 0;

105 
ba£
 = 
	`add_ödít
(ba£, 
Àn
, 
max
, 
ödít
 - 
off
);

106 
off
 = 
ödít
;

107 
ßme_löe
 = 
åue
;

111 
p
 = 
›t
->
desc
;

112 (
l
 = 
	`c⁄sume_w‹ds
(
p
, 
width
 - 
ödít
, &
¥efix
)) != 0) {

113 i‡(!
ßme_löe
)

114 
ba£
 = 
	`add_ödít
(ba£, 
Àn
, 
max
, 
ödít
);

115 
p
 +
¥efix
;

116 
ba£
 = 
	`add_°r_Àn
(ba£, 
Àn
, 
max
, 
p
, 
l
);

117 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, "\n");

118 
off
 = 
ödít
 + 
l
;

119 
p
 +
l
;

120 
ßme_löe
 = 
Ál£
;

124 i‡(
ßme_löe
)

125 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, "\n");

127 i‡(
›t
->
show
) {

128 
buf
[
OPT_SHOW_LEN
 + ("...")];

129 
	`°r˝y
(
buf
 + 
OPT_SHOW_LEN
, "...");

130 
›t
->
	`show
(
buf
, o±->
u
.
¨g
);

133 i‡(
off
 + 
	`°æí
(" (deÁu…: "Ë+ såÀn(
buf
) + strlen(")")

134 > 
width
) {

135 
ba£
 = 
	`add_ödít
(ba£, 
Àn
, 
max
, 
ödít
);

138 (*
Àn
)--;

141 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, " (default: ");

142 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, 
buf
);

143 
ba£
 = 
	`add_°r
(ba£, 
Àn
, 
max
, ")\n");

145  
ba£
;

146 
	}
}

148 *
	$›t_ußge
(c⁄° *
¨gv0
, c⁄° *
exåa
)

150 
i
;

151 
size_t
 
max
, 
Àn
, 
width
, 
ödít
;

152 *
ªt
;

154 
width
 = 
	`gë_cﬁumns
();

155 i‡(
width
 < 
MIN_TOTAL_WIDTH
)

156 
width
 = 
MIN_TOTAL_WIDTH
;

159 
ödít
 = 0;

160 
i
 = 0; i < 
›t_cou¡
; i++) {

161 
size_t
 
l
;

162 i‡(
›t_èbÀ
[
i
].
desc
 =
›t_hiddí
)

164 i‡(
›t_èbÀ
[
i
].
ty≥
 =
OPT_SUBTABLE
)

166 
l
 = 
	`°æí
(
›t_èbÀ
[
i
].
«mes
);

167 i‡(
›t_èbÀ
[
i
].
ty≥
 =
OPT_HASARG


168 && !
	`°rchr
(
›t_èbÀ
[
i
].
«mes
, ' ')

169 && !
	`°rchr
(
›t_èbÀ
[
i
].
«mes
, '='))

170 
l
 +
	`°æí
(" <arg>");

171 i‡(
l
 + 2 > 
ödít
)

172 
ödít
 = 
l
 + 2;

176 i‡(
ödít
 + 
MIN_DESC_WIDTH
 > 
width
)

177 
ödít
 = 
width
 - 
MIN_DESC_WIDTH
;

179 
Àn
 = 
max
 = 0;

180 
ªt
 = 
NULL
;

182 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, "Usage: ");

183 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, 
¨gv0
);

186 i‡(!
exåa
) {

187 
exåa
 = "";

188 
i
 = 0; i < 
›t_cou¡
; i++) {

189 i‡(
›t_èbÀ
[
i
].
cb
 =(*)
›t_ußge_™d_exô


190 && 
›t_èbÀ
[
i
].
u
.
ˇrg
) {

191 
exåa
 = 
›t_èbÀ
[
i
].
u
.
ˇrg
;

196 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, " ");

197 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, 
exåa
);

198 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, "\n");

200 
i
 = 0; i < 
›t_cou¡
; i++) {

201 i‡(
›t_èbÀ
[
i
].
desc
 =
›t_hiddí
)

203 i‡(
›t_èbÀ
[
i
].
ty≥
 =
OPT_SUBTABLE
) {

204 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, 
›t_èbÀ
[
i
].
desc
);

205 
ªt
 = 
	`add_°r
‘ë, &
Àn
, &
max
, ":\n");

208 
ªt
 = 
	`add_desc
‘ë, &
Àn
, &
max
, 
ödít
, 
width
, &
›t_èbÀ
[
i
]);

210 
ªt
[
Àn
] = '\0';

211  
ªt
;

212 
	}
}

	@ccan/ccan/ptr_valid/ptr_valid.c

2 
	~"±r_vÆid.h
"

3 
	~<sys/ty≥s.h
>

4 
	~<sys/waô.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<cˇn/n€º/n€º.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<as£π.h
>

11 
	~<°rög.h
>

13 #i‡
HAVE_PROC_SELF_MAPS


14 *
	$gøb
(c⁄° *
fûíame
)

16 
ªt
, 
fd
;

17 
size_t
 
max
 = 16384, 
s
 = 0;

18 *
buf„r
;

20 
fd
 = 
	`›í
(
fûíame
, 
O_RDONLY
);

21 i‡(
fd
 < 0)

22  
NULL
;

24 
buf„r
 = 
	`mÆloc
(
max
+1);

25 i‡(!
buf„r
)

26 
˛o£
;

28 (
ªt
 = 
	`ªad
(
fd
, 
buf„r
 + 
s
, 
max
 - s)) > 0) {

29 
s
 +
ªt
;

30 i‡(
s
 =
max
) {

31 
buf„r
 = 
	`ªÆloc
(buf„r, 
max
*2+1);

32 i‡(!
buf„r
)

33 
˛o£
;

34 
max
 *= 2;

37 i‡(
ªt
 < 0)

38 
‰ì
;

40 
	`˛o£
(
fd
);

41 
buf„r
[
s
] = '\0';

42  
buf„r
;

44 
‰ì
:

45 
	`‰ì
(
buf„r
);

46 
˛o£
:

47 
	`˛o£_n€º
(
fd
);

48  
NULL
;

49 
	}
}

51 *
	$skù_löe
(*
p
)

53 *
∆
 = 
	`°rchr
(
p
, '\n');

54 i‡(!
∆
)

55  
NULL
;

56  
∆
 + 1;

57 
	}
}

59 
±r_vÆid_m≠
 *
	$add_m≠
(
±r_vÆid_m≠
 *
m≠
,

60 *
num
,

61 *
max
,

62 
°¨t
, 
íd
, 
boﬁ
 
is_wrôe
)

64 i‡(*
num
 =*
max
) {

65 *
max
 *= 2;

66 
m≠
 = 
	`ªÆloc
(m≠, (*m≠Ë* *
max
);

67 i‡(!
m≠
)

68  
NULL
;

70 
m≠
[*
num
].
°¨t
 = (*)start;

71 
m≠
[*
num
].
íd
 = (*)end;

72 
m≠
[*
num
].
is_wrôe
 = is_write;

73 (*
num
)++;

74  
m≠
;

75 
	}
}

77 
±r_vÆid_m≠
 *
	$gë_¥oc_m≠s
(*
num
)

79 *
buf
, *
p
;

80 
±r_vÆid_m≠
 *
m≠
;

81 
max
 = 16;

83 
buf
 = 
	`gøb
("/proc/self/maps");

84 i‡(!
buf
) {

85 *
num
 = 0;

86  
NULL
;

89 
m≠
 = 
	`mÆloc
((*m≠Ë* 
max
);

90 i‡(!
m≠
)

91 
‰ì_buf
;

93 *
num
 = 0;

94 
p
 = 
buf
;Ö && *p;Ö = 
	`skù_löe
(p)) {

95 
°¨t
, 
íd
;

96 *
ídp
;

99 
°¨t
 = 
	`°πoul
(
p
, &
ídp
, 16);

100 i‡(*
ídp
 != '-')

101 
mÆf‹med
;

102 
íd
 = 
	`°πoul
(
ídp
+1, &endp, 16);

103 i‡(*
ídp
 != ' ')

104 
mÆf‹med
;

106 
ídp
++;

107 i‡(
ídp
[0] != 'r' &&Éndp[0] != '-')

108 
mÆf‹med
;

109 i‡(
ídp
[1] != 'w' &&Éndp[1] != '-')

110 
mÆf‹med
;

113 i‡(
ídp
[0] == 'r') {

114 
m≠
 = 
	`add_m≠
(m≠, 
num
, &
max
, 
°¨t
, 
íd
,

115 
ídp
[1] == 'w');

116 i‡(!
m≠
)

117 
‰ì_buf
;

121 
	`‰ì
(
buf
);

122  
m≠
;

125 
mÆf‹med
:

126 
	`‰ì
(
m≠
);

127 
‰ì_buf
:

128 
	`‰ì
(
buf
);

129 *
num
 = 0;

130  
NULL
;

131 
	}
}

133 
±r_vÆid_m≠
 *
	$gë_¥oc_m≠s
(*
num
)

135 *
num
 = 0;

136  
NULL
;

137 
	}
}

140 
boﬁ
 
	$check_wôh_m≠s
(
±r_vÆid_b©ch
 *
b©ch
,

141 c⁄° *
p
, 
size_t
 
size
, 
boﬁ
 
is_wrôe
)

143 
i
;

145 
i
 = 0; i < 
b©ch
->
num_m≠s
; i++) {

146 i‡(
p
 >
b©ch
->
m≠s
[
i
].
°¨t
 &&Ö < b©ch->m≠s[i].
íd
) {

148 i‡(
p
 + 
size
 > 
b©ch
->
m≠s
[
i
].
íd
) {

149 
size_t
 
Àn
 = 
p
 + 
size
 - 
b©ch
->
m≠s
[
i
].
íd
;

150 i‡(!
	`check_wôh_m≠s
(
b©ch
, b©ch->
m≠s
[
i
].
íd
,

151 
Àn
, 
is_wrôe
))

152  
Ál£
;

154  !
is_wrôe
 || 
b©ch
->
m≠s
[
i
].is_write;

157  
Ál£
;

158 
	}
}

160 
	$föish_chûd
(
±r_vÆid_b©ch
 *
b©ch
)

162 
	`˛o£
(
b©ch
->
to_chûd
);

163 
	`˛o£
(
b©ch
->
‰om_chûd
);

164 
	`waôpid
(
b©ch
->
chûd_pid
, 
NULL
, 0);

165 
b©ch
->
chûd_pid
 = 0;

166 
	}
}

168 
boﬁ
 
	$chûd_Æive
(
±r_vÆid_b©ch
 *
b©ch
)

170  
b©ch
->
chûd_pid
 != 0;

171 
	}
}

173 
	$run_chûd
(
öfd
, 
outfd
)

175 vﬁ©ûê*
p
;

178 
	`ªad
(
öfd
, &
p
, (p)) == (p)) {

179 
size_t
 
i
, 
size
;

180 
boﬁ
 
is_wrôe
;

181 
ªt
 = 0;

184 i‡(
	`ªad
(
öfd
, &
size
, (size)) != (size))

185 
	`exô
(1);

186 i‡(
	`ªad
(
öfd
, &
is_wrôe
, (is_write)) != (is_write))

187 
	`exô
(2);

189 
i
 = 0; i < 
size
; i++) {

190 
ªt
 = 
p
[
i
];

191 i‡(
is_wrôe
)

192 
p
[
i
] = 
ªt
;

196 i‡(
	`wrôe
(
outfd
, &
ªt
, 1) != 1)

197 
	`exô
(3);

199 
	`exô
(0);

200 
	}
}

202 
boﬁ
 
	$¸óã_chûd
(
±r_vÆid_b©ch
 *
b©ch
)

204 
ouçùe
[2], 
öpùe
[2];

206 i‡(
	`pùe
(
ouçùe
) != 0)

207  
Ál£
;

208 i‡(
	`pùe
(
öpùe
) != 0)

209 
˛o£_ouçùe
;

211 
	`fÊush
(
°dout
);

212 
b©ch
->
chûd_pid
 = 
	`f‹k
();

213 i‡(
b©ch
->
chûd_pid
 == 0) {

214 
	`˛o£
(
ouçùe
[1]);

215 
	`˛o£
(
öpùe
[0]);

216 
	`run_chûd
(
ouçùe
[0], 
öpùe
[1]);

219 i‡(
b©ch
->
chûd_pid
 == -1)

220 
˛ónup_pid
;

222 
	`˛o£
(
ouçùe
[0]);

223 
	`˛o£
(
öpùe
[1]);

225 
b©ch
->
to_chûd
 = 
ouçùe
[1];

226 
b©ch
->
‰om_chûd
 = 
öpùe
[0];

227  
åue
;

229 
˛ónup_pid
:

230 
b©ch
->
chûd_pid
 = 0;

231 
	`˛o£_n€º
(
öpùe
[0]);

232 
	`˛o£_n€º
(
öpùe
[1]);

233 
˛o£_ouçùe
:

234 
	`˛o£_n€º
(
ouçùe
[0]);

235 
	`˛o£_n€º
(
ouçùe
[1]);

236  
Ál£
;

237 
	}
}

239 
boﬁ
 
	$check_wôh_chûd
(
±r_vÆid_b©ch
 *
b©ch
,

240 c⁄° *
p
, 
size_t
 
size
, 
boﬁ
 
is_wrôe
)

242 
ªt
;

244 i‡(!
	`chûd_Æive
(
b©ch
)) {

245 i‡(!
	`¸óã_chûd
(
b©ch
))

246  
Ál£
;

249 
	`wrôe
(
b©ch
->
to_chûd
, &
p
, (p));

250 
	`wrôe
(
b©ch
->
to_chûd
, &
size
, (size));

251 
	`wrôe
(
b©ch
->
to_chûd
, &
is_wrôe
, (is_write));

253 i‡(
	`ªad
(
b©ch
->
‰om_chûd
, &
ªt
, (ret)) != (ret)) {

254 
	`föish_chûd
(
b©ch
);

255 
î∫o
 = 
EFAULT
;

256  
Ál£
;

258  
åue
;

259 
	}
}

263 
boﬁ
 
	$±r_vÆid_b©ch
(
±r_vÆid_b©ch
 *
b©ch
,

264 c⁄° *
p
, 
size_t
 
Æignmít
, size_à
size
, 
boﬁ
 
wrôe
)

266 *
°¨t
, *
íd
;

267 
boﬁ
 
ªt
;

269 i‡((
öçå_t
)
p
 & (
Æignmít
 - 1))

270  
Ál£
;

272 
°¨t
 = (*)((
öçå_t
)
p
 & ~(
	`gë∑gesize
() - 1));

273 
íd
 = (*)(((
öçå_t
)
p
 + 
size
 - 1Ë& ~(
	`gë∑gesize
() - 1));

276 i‡(
°¨t
 =
íd
) {

277 i‡(
b©ch
->
œ°
 && b©ch->œ° =
°¨t
)

278  
b©ch
->
œ°_ok
;

281 i‡(
b©ch
->
num_m≠s
)

282 
ªt
 = 
	`check_wôh_m≠s
(
b©ch
, 
p
, 
size
, 
wrôe
);

284 
ªt
 = 
	`check_wôh_chûd
(
b©ch
, 
p
, 
size
, 
wrôe
);

286 i‡(
°¨t
 =
íd
) {

287 
b©ch
->
œ°
 = 
°¨t
;

288 
b©ch
->
œ°_ok
 = 
ªt
;

291  
ªt
;

292 
	}
}

294 
boﬁ
 
	$±r_vÆid_b©ch_°rög
(
±r_vÆid_b©ch
 *
b©ch
, c⁄° *
p
)

296 
	`±r_vÆid_b©ch
(
b©ch
, 
p
, 1, 1, 
Ál£
)) {

297 i‡(*
p
 == '\0')

298  
åue
;

299 
p
++;

301  
Ál£
;

302 
	}
}

304 
boﬁ
 
	$±r_vÆid
(c⁄° *
p
, 
size_t
 
Æignmít
, size_à
size
, 
boﬁ
 
wrôe
)

306 
boﬁ
 
ªt
;

307 
±r_vÆid_b©ch
 
b©ch
;

308 i‡(!
	`±r_vÆid_b©ch_°¨t
(&
b©ch
))

309  
Ál£
;

310 
ªt
 = 
	`±r_vÆid_b©ch
(&
b©ch
, 
p
, 
Æignmít
, 
size
, 
wrôe
);

311 
	`±r_vÆid_b©ch_íd
(&
b©ch
);

312  
ªt
;

313 
	}
}

315 
boﬁ
 
	$±r_vÆid_°rög
(c⁄° *
p
)

317 
boﬁ
 
ªt
;

318 
±r_vÆid_b©ch
 
b©ch
;

319 i‡(!
	`±r_vÆid_b©ch_°¨t
(&
b©ch
))

320  
Ál£
;

321 
ªt
 = 
	`±r_vÆid_b©ch_°rög
(&
b©ch
, 
p
);

322 
	`±r_vÆid_b©ch_íd
(&
b©ch
);

323  
ªt
;

324 
	}
}

326 
boﬁ
 
	$±r_vÆid_b©ch_°¨t
(
±r_vÆid_b©ch
 *
b©ch
)

328 
b©ch
->
chûd_pid
 = 0;

329 
b©ch
->
m≠s
 = 
	`gë_¥oc_m≠s
(&b©ch->
num_m≠s
);

330 
b©ch
->
œ°
 = 
NULL
;

331  
åue
;

332 
	}
}

334 
	$±r_vÆid_b©ch_íd
(
±r_vÆid_b©ch
 *
b©ch
)

336 i‡(
	`chûd_Æive
(
b©ch
))

337 
	`föish_chûd
(
b©ch
);

338 
	`‰ì
(
b©ch
->
m≠s
);

339 
	}
}

	@ccan/ccan/ptr_valid/ptr_valid.h

2 #i‚de‡
CCAN_PTR_VALID_H


3 
	#CCAN_PTR_VALID_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°dboﬁ.h
>

6 
	~<°dlib.h
>

20 
	#±r_vÆid_ªad
(
p
) \

21 
	`±r_vÆid_r
((
p
), 
	`PTR_VALID_ALIGNOF
(*’)), (*’)))

	)

36 
	#±r_vÆid_wrôe
(
p
) \

37 
	`±r_vÆid_w
((
p
), 
	`PTR_VALID_ALIGNOF
(*’)), (*’)))

	)

52 
boﬁ
 
±r_vÆid_°rög
(c⁄° *
p
);

69 
boﬁ
 
±r_vÆid
(c⁄° *
p
, 
size_t
 
Æign
, size_à
size
, boﬁ 
wrôe
);

76 
	s±r_vÆid_b©ch
 {

77 
	mnum_m≠s
;

78 
±r_vÆid_m≠
 *
	mm≠s
;

79 
	mchûd_pid
;

80 
	mto_chûd
, 
	m‰om_chûd
;

81 *
	mœ°
;

82 
boﬁ
 
	mœ°_ok
;

137 
boﬁ
 
±r_vÆid_b©ch_°¨t
(
±r_vÆid_b©ch
 *
b©ch
);

146 
	#±r_vÆid_b©ch_ªad
(
b©ch
, 
p
) \

147 
	`±r_vÆid_b©ch_r
((
b©ch
), \

148 (
p
), 
	`PTR_VALID_ALIGNOF
(*’)), (*’)))

	)

157 
	#±r_vÆid_b©ch_wrôe
(
b©ch
, 
p
) \

158 
	`±r_vÆid_b©ch_w
((
b©ch
), \

159 (
p
), 
	`PTR_VALID_ALIGNOF
(*’)), (*’)))

	)

168 
boﬁ
 
±r_vÆid_b©ch_°rög
(
±r_vÆid_b©ch
 *
b©ch
, c⁄° *
p
);

180 
boﬁ
 
±r_vÆid_b©ch
(±r_vÆid_b©ch *
b©ch
,

181 c⁄° *
p
, 
size_t
 
Æignmít
, size_à
size
, 
boﬁ
 
wrôe
);

192 
±r_vÆid_b©ch_íd
(
±r_vÆid_b©ch
 *
b©ch
);

196 
ölöe
 
boﬁ
 
	$±r_vÆid_r
(c⁄° *
p
, 
size_t
 
Æign
, size_à
size
)

198  
	`±r_vÆid
(
p
, 
Æign
, 
size
, 
Ál£
);

199 
	}
}

201 
ölöe
 
boﬁ
 
	$±r_vÆid_w
(*
p
, 
size_t
 
Æign
, size_à
size
)

203  
	`±r_vÆid
(
p
, 
Æign
, 
size
, 
åue
);

204 
	}
}

206 
ölöe
 
boﬁ
 
	$±r_vÆid_b©ch_r
(
±r_vÆid_b©ch
 *
b©ch
,

207 c⁄° *
p
, 
size_t
 
Æign
, size_à
size
)

209  
	`±r_vÆid_b©ch
(
b©ch
, 
p
, 
Æign
, 
size
, 
Ál£
);

210 
	}
}

212 
ölöe
 
boﬁ
 
	$±r_vÆid_b©ch_w
(
±r_vÆid_b©ch
 *
b©ch
,

213 *
p
, 
size_t
 
Æign
, size_à
size
)

215  
	`±r_vÆid_b©ch
(
b©ch
, 
p
, 
Æign
, 
size
, 
åue
);

216 
	}
}

218 
	s±r_vÆid_m≠
 {

219 c⁄° *
	m°¨t
, *
	míd
;

220 
boﬁ
 
	mis_wrôe
;

223 #i‡
HAVE_ALIGNOF


224 
	#PTR_VALID_ALIGNOF
(
v¨
Ë
	`__Æignof__
(v¨)

	)

227 
	#PTR_VALID_ALIGNOF
(
v¨
Ë1

	)

	@ccan/ccan/ptr_valid/test/run-string.c

1 
	~<cˇn/±r_vÆid/±r_vÆid.h
>

3 
	~<cˇn/±r_vÆid/±r_vÆid.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<sys/mm™.h
>

7 
	$maö
()

9 *
∑ge
;

10 
±r_vÆid_b©ch
 *
b©ch
 = 
	`mÆloc
( *batch);

13 
	`∂™_ã°s
(14);

15 
∑ge
 = 
	`mm≠
(
NULL
, 
	`gë∑gesize
(), 
PROT_READ
|
PROT_WRITE
,

16 
MAP_ANONYMOUS
|
MAP_PRIVATE
, -1, 0);

17 
	`°r˝y
(
∑ge
, "hello");

18 
	`ok1
(
	`±r_vÆid_ªad
(
∑ge
));

19 
	`ok1
(
	`±r_vÆid_wrôe
(
∑ge
));

20 
	`ok1
(
	`±r_vÆid_°rög
(
∑ge
));

22 
	`ok1
(
	`±r_vÆid_b©ch_°¨t
(
b©ch
));

23 
	`ok1
(
	`±r_vÆid_b©ch_°rög
(
b©ch
, 
∑ge
));

24 
	`±r_vÆid_b©ch_íd
(
b©ch
);

27 
	`munm≠
(
∑ge
, 
	`gë∑gesize
());

28 
	`ok1
(!
	`±r_vÆid_°rög
(
∑ge
));

30 
	`ok1
(
	`±r_vÆid_b©ch_°¨t
(
b©ch
));

31 
	`ok1
(!
	`±r_vÆid_b©ch_°rög
(
b©ch
, 
∑ge
));

32 
	`±r_vÆid_b©ch_íd
(
b©ch
);

35 
∑ge
 = 
	`mm≠
(
NULL
, 
	`gë∑gesize
()*2, 
PROT_READ
|
PROT_WRITE
,

36 
MAP_ANONYMOUS
|
MAP_PRIVATE
, -1, 0);

37 
	`munm≠
(
∑ge
 + 
	`gë∑gesize
(), getpagesize());

39 
	`mem£t
(
∑ge
, 'a', 
	`gë∑gesize
());

40 
	`ok1
(!
	`±r_vÆid_°rög
(
∑ge
));

41 
	`ok1
(
	`±r_vÆid_b©ch_°¨t
(
b©ch
));

42 
	`ok1
(!
	`±r_vÆid_b©ch_°rög
(
b©ch
, 
∑ge
));

43 
	`±r_vÆid_b©ch_íd
(
b©ch
);

45 
∑ge
[
	`gë∑gesize
()-1] = '\0';

46 
	`ok1
(
	`±r_vÆid_°rög
(
∑ge
));

48 
	`ok1
(
	`±r_vÆid_b©ch_°¨t
(
b©ch
));

49 
	`ok1
(
	`±r_vÆid_b©ch_°rög
(
b©ch
, 
∑ge
));

50 
	`±r_vÆid_b©ch_íd
(
b©ch
);

51 
	`munm≠
(
∑ge
, 
	`gë∑gesize
());

53 
	`‰ì
(
b©ch
);

55  
	`exô_°©us
();

56 
	}
}

	@ccan/ccan/ptr_valid/test/run.c

1 
	~<cˇn/±r_vÆid/±r_vÆid.h
>

3 
	~<cˇn/±r_vÆid/±r_vÆid.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<sys/mm™.h
>

7 
boﬁ
 
	$check_b©ch
(*
p
, 
num
, 
boﬁ
 
ex≥˘
)

9 
±r_vÆid_b©ch
 
b©ch
;

10 
i
;

12 i‡(!
	`±r_vÆid_b©ch_°¨t
(&
b©ch
))

13  
Ál£
;

14 
i
 = 0; i < 
num
; i++) {

15 i‡(
	`±r_vÆid_b©ch
(&
b©ch
, 
p
 + 
i
, 1, 1, 
Ál£
Ë!
ex≥˘
)

16  
Ál£
;

17 i‡(
	`±r_vÆid_b©ch
(&
b©ch
, 
p
 + 
i
, 1, 1, 
åue
Ë!
ex≥˘
)

18  
Ál£
;

20 
	`±r_vÆid_b©ch_íd
(&
b©ch
);

21  
åue
;

22 
	}
}

24 
	$maö
()

26 *
∑ge
;

29 
	`∂™_ã°s
(30);

31 
∑ge
 = 
	`mm≠
(
NULL
, 
	`gë∑gesize
(), 
PROT_READ
|
PROT_WRITE
,

32 
MAP_ANONYMOUS
|
MAP_PRIVATE
, -1, 0);

33 
	`ok1
(
	`±r_vÆid_ªad
(
∑ge
));

34 
	`ok1
(
	`±r_vÆid_wrôe
(
∑ge
));

35 
	`ok1
(
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
Ál£
));

36 
	`ok1
(
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
åue
));

39 
	`ok1
(
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), gë∑gesize(), 
Ál£
));

40 
	`ok1
(
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), gë∑gesize(), 
åue
));

41 
	`ok1
(!
	`±r_vÆid
(
∑ge
+1, 
	`gë∑gesize
(), 1, 
Ál£
));

42 
	`ok1
(!
	`±r_vÆid
(
∑ge
+1, 
	`gë∑gesize
(), 1, 
åue
));

45 
	`ok1
(
	`check_b©ch
(
∑ge
, 
	`gë∑gesize
(), 
åue
));

48 
	`munm≠
(
∑ge
, 
	`gë∑gesize
());

49 
	`ok1
(!
	`±r_vÆid_ªad
(
∑ge
));

50 
	`ok1
(!
	`±r_vÆid_wrôe
(
∑ge
));

51 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
Ál£
));

52 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
åue
));

55 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), gë∑gesize(), 
Ál£
));

56 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), gë∑gesize(), 
åue
));

57 
	`ok1
(!
	`±r_vÆid
(
∑ge
+1, 
	`gë∑gesize
(), 1, 
Ál£
));

58 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), 1, 
åue
));

61 
	`ok1
(
	`check_b©ch
(
∑ge
, 4, 
Ál£
));

64 
∑ge
 = 
	`mm≠
(
NULL
, 
	`gë∑gesize
(), 
PROT_READ
,

65 
MAP_ANONYMOUS
|
MAP_PRIVATE
, -1, 0);

66 
	`ok1
(
	`±r_vÆid_ªad
(
∑ge
));

67 
	`ok1
(!
	`±r_vÆid_wrôe
(
∑ge
));

68 
	`ok1
(
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
Ál£
));

69 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
åue
));

72 
	`ok1
(
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), gë∑gesize(), 
Ál£
));

73 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 
	`gë∑gesize
(), gë∑gesize(), 
åue
));

74 
	`ok1
(!
	`±r_vÆid
(
∑ge
+1, 
	`gë∑gesize
(), 1, 
Ál£
));

75 
	`ok1
(!
	`±r_vÆid
(
∑ge
+1, 
	`gë∑gesize
(), 1, 
åue
));

76 
	`munm≠
(
∑ge
, 
	`gë∑gesize
());

79 
∑ge
 = 
	`mm≠
(
NULL
, 
	`gë∑gesize
()*2, 
PROT_READ
|
PROT_WRITE
,

80 
MAP_ANONYMOUS
|
MAP_PRIVATE
, -1, 0);

81 
	`munm≠
(
∑ge
 + 
	`gë∑gesize
(), getpagesize());

83 
	`ok1
(
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
Ál£
));

84 
	`ok1
(
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
(), 
åue
));

85 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
()+1, 
Ál£
));

86 
	`ok1
(!
	`±r_vÆid
(
∑ge
, 1, 
	`gë∑gesize
()+1, 
åue
));

89  
	`exô_°©us
();

90 
	}
}

	@ccan/ccan/rbtree/rbtree.c

19 
	~<cˇn/rbåì/rbåì.h
>

22 
	$åì_de°ru˘‹_åavî£_node
(
åbt_node_t
 *
node
)

24 
	`èŒoc_£t_de°ru˘‹
(
node
, 
NULL
);

25 i‡(
node
->
À·
) {

26 
	`åì_de°ru˘‹_åavî£_node
(
node
->
À·
);

28 i‡(
node
->
right
) {

29 
	`åì_de°ru˘‹_åavî£_node
(
node
->
right
);

31 
	`èŒoc_‰ì
(
node
);

32 
	}
}

37 
	$åì_de°ru˘‹
(
åbt_åì_t
 *
åì
)

39 
åbt_node_t
 *
node
;

41 i‡(
åì
 =
NULL
) {

45 
node
=
åì
->
roŸ
;

46 i‡(
node
 =
NULL
) {

57 
	`åì_de°ru˘‹_åavî£_node
(
node
);

60 
	}
}

64 
åbt_åì_t
 *

65 
	$åbt_¸óã
(
TALLOC_CTX
 *
mem˘x
, 
uöt32_t
 
Êags
)

67 
åbt_åì_t
 *
åì
;

69 
åì
 = 
	`èŒoc_zîo
(
mem˘x
, 
åbt_åì_t
);

70 i‡(
åì
 =
NULL
) {

71 
	`Ârötf
(
°dîr
, "FailedÅoállocate memory forÑbÅree\n");

72  
NULL
;

80 
	`èŒoc_£t_de°ru˘‹
(
åì
, 
åì_de°ru˘‹
);

81 
åì
->
Êags
 = flags;

83  
åì
;

84 
	}
}

86 
ölöe
 
åbt_node_t
 *

87 
	$åbt_∑ª¡
(
åbt_node_t
 *
node
)

89  
node
->
∑ª¡
;

90 
	}
}

92 
ölöe
 
åbt_node_t
 *

93 
	$åbt_gønd∑ª¡
(
åbt_node_t
 *
node
)

95 
åbt_node_t
 *
∑ª¡
;

97 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

98 if(
∑ª¡
){

99  
∑ª¡
->parent;

101  
NULL
;

102 
	}
}

104 
ölöe
 
åbt_node_t
 *

105 
	$åbt_un˛e
(
åbt_node_t
 *
node
)

107 
åbt_node_t
 *
∑ª¡
, *
gønd∑ª¡
;

109 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

110 if(!
∑ª¡
){

111  
NULL
;

113 
gønd∑ª¡
=
	`åbt_∑ª¡
(
∑ª¡
);

114 if(!
gønd∑ª¡
){

115  
NULL
;

117 if(
∑ª¡
==
gønd∑ª¡
->
À·
){

118  
gønd∑ª¡
->
right
;

120  
gønd∑ª¡
->
À·
;

121 
	}
}

124 
ölöe
 
åbt_ö£π_ˇ£1
(
åbt_åì_t
 *
åì
, 
åbt_node_t
 *
node
);

125 
ölöe
 
åbt_ö£π_ˇ£2
(
åbt_åì_t
 *
åì
, 
åbt_node_t
 *
node
);

127 
ölöe
 

128 
	$åbt_rŸ©e_À·
(
åbt_node_t
 *
node
)

130 
åbt_åì_t
 *
åì
 = 
node
->tree;

132 if(
node
->
∑ª¡
){

133 if(
node
->
∑ª¡
->
À·
==node){

134 
node
->
∑ª¡
->
À·
Úode->
right
;

136 
node
->
∑ª¡
->
right
=node->right;

139 
åì
->
roŸ
=
node
->
right
;

141 
node
->
right
->
∑ª¡
=node->parent;

142 
node
->
∑ª¡
Úode->
right
;

143 
node
->
right
Úode->right->
À·
;

144 if(
node
->
right
){

145 
node
->
right
->
∑ª¡
=node;

147 
node
->
∑ª¡
->
À·
=node;

148 
	}
}

150 
ölöe
 

151 
	$åbt_rŸ©e_right
(
åbt_node_t
 *
node
)

153 
åbt_åì_t
 *
åì
 = 
node
->tree;

155 if(
node
->
∑ª¡
){

156 if(
node
->
∑ª¡
->
À·
==node){

157 
node
->
∑ª¡
->
À·
=node->left;

159 
node
->
∑ª¡
->
right
Úode->
À·
;

162 
åì
->
roŸ
=
node
->
À·
;

164 
node
->
À·
->
∑ª¡
=node->parent;

165 
node
->
∑ª¡
Úode->
À·
;

166 
node
->
À·
Úode->À·->
right
;

167 if(
node
->
À·
){

168 
node
->
À·
->
∑ª¡
=node;

170 
node
->
∑ª¡
->
right
=node;

171 
	}
}

174 
ölöe
 
	$åbt_gë_cﬁ‹
(
åbt_node_t
 *
node
)

176 i‡(
node
==
NULL
) {

177  
TRBT_BLACK
;

179  
node
->
rb_cﬁ‹
;

180 
	}
}

181 
ölöe
 
	$åbt_gë_cﬁ‹_À·
(
åbt_node_t
 *
node
)

183 i‡(
node
==
NULL
) {

184  
TRBT_BLACK
;

186 i‡(
node
->
À·
==
NULL
) {

187  
TRBT_BLACK
;

189  
node
->
À·
->
rb_cﬁ‹
;

190 
	}
}

191 
ölöe
 
	$åbt_gë_cﬁ‹_right
(
åbt_node_t
 *
node
)

193 i‡(
node
==
NULL
) {

194  
TRBT_BLACK
;

196 i‡(
node
->
right
==
NULL
) {

197  
TRBT_BLACK
;

199  
node
->
right
->
rb_cﬁ‹
;

200 
	}
}

202 
ölöe
 
	$åbt_£t_cﬁ‹
(
åbt_node_t
 *
node
, 
cﬁ‹
)

204 i‡–(
node
==
NULL
Ë&& (
cﬁ‹
==
TRBT_BLACK
) ) {

207 
node
->
rb_cﬁ‹
 = 
cﬁ‹
;

208 
	}
}

209 
ölöe
 
	$åbt_£t_cﬁ‹_À·
(
åbt_node_t
 *
node
, 
cﬁ‹
)

211 i‡–((
node
==
NULL
)||“ode->
À·
==NULL)Ë&& (
cﬁ‹
==
TRBT_BLACK
) ) {

214 
node
->
À·
->
rb_cﬁ‹
 = 
cﬁ‹
;

215 
	}
}

216 
ölöe
 
	$åbt_£t_cﬁ‹_right
(
åbt_node_t
 *
node
, 
cﬁ‹
)

218 i‡–((
node
==
NULL
)||“ode->
right
==NULL)Ë&& (
cﬁ‹
==
TRBT_BLACK
) ) {

221 
node
->
right
->
rb_cﬁ‹
 = 
cﬁ‹
;

222 
	}
}

224 
ölöe
 

225 
	$åbt_ö£π_ˇ£5
(
åbt_node_t
 *
node
)

227 
åbt_node_t
 *
gønd∑ª¡
;

228 
åbt_node_t
 *
∑ª¡
;

230 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

231 
gønd∑ª¡
=
	`åbt_∑ª¡
(
∑ª¡
);

232 
∑ª¡
->
rb_cﬁ‹
=
TRBT_BLACK
;

233 
gønd∑ª¡
->
rb_cﬁ‹
=
TRBT_RED
;

234 if–(
node
==
∑ª¡
->
À·
Ë&& (∑ª¡==
gønd∑ª¡
->left) ){

235 
	`åbt_rŸ©e_right
(
gønd∑ª¡
);

237 
	`åbt_rŸ©e_À·
(
gønd∑ª¡
);

239 
	}
}

241 
ölöe
 

242 
	$åbt_ö£π_ˇ£4
(
åbt_node_t
 *
node
)

244 
åbt_node_t
 *
gønd∑ª¡
;

245 
åbt_node_t
 *
∑ª¡
;

247 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

248 
gønd∑ª¡
=
	`åbt_∑ª¡
(
∑ª¡
);

249 if(!
gønd∑ª¡
){

252 if–(
node
==
∑ª¡
->
right
Ë&& (∑ª¡==
gønd∑ª¡
->
À·
) ){

253 
	`åbt_rŸ©e_À·
(
∑ª¡
);

254 
node
Úode->
À·
;

255 } if–(
node
==
∑ª¡
->
À·
Ë&& (∑ª¡==
gønd∑ª¡
->
right
) ){

256 
	`åbt_rŸ©e_right
(
∑ª¡
);

257 
node
Úode->
right
;

259 
	`åbt_ö£π_ˇ£5
(
node
);

260 
	}
}

262 
ölöe
 

263 
	$åbt_ö£π_ˇ£3
(
åbt_åì_t
 *
åì
, 
åbt_node_t
 *
node
)

265 
åbt_node_t
 *
gønd∑ª¡
;

266 
åbt_node_t
 *
∑ª¡
;

267 
åbt_node_t
 *
un˛e
;

269 
un˛e
=
	`åbt_un˛e
(
node
);

270 if(
un˛e
 && (un˛e->
rb_cﬁ‹
==
TRBT_RED
)){

271 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

272 
∑ª¡
->
rb_cﬁ‹
=
TRBT_BLACK
;

273 
un˛e
->
rb_cﬁ‹
=
TRBT_BLACK
;

274 
gønd∑ª¡
=
	`åbt_gønd∑ª¡
(
node
);

275 
gønd∑ª¡
->
rb_cﬁ‹
=
TRBT_RED
;

276 
	`åbt_ö£π_ˇ£1
(
åì
, 
gønd∑ª¡
);

278 
	`åbt_ö£π_ˇ£4
(
node
);

280 
	}
}

282 
ölöe
 

283 
	$åbt_ö£π_ˇ£2
(
åbt_åì_t
 *
åì
, 
åbt_node_t
 *
node
)

285 
åbt_node_t
 *
∑ª¡
;

287 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

289 if(
∑ª¡
->
rb_cﬁ‹
==
TRBT_BLACK
){

292 
	`åbt_ö£π_ˇ£3
(
åì
, 
node
);

293 
	}
}

295 
ölöe
 

296 
	$åbt_ö£π_ˇ£1
(
åbt_åì_t
 *
åì
, 
åbt_node_t
 *
node
)

298 
åbt_node_t
 *
∑ª¡
;

300 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

301 if(!
∑ª¡
){

302 
node
->
rb_cﬁ‹
=
TRBT_BLACK
;

305 
	`åbt_ö£π_ˇ£2
(
åì
, 
node
);

306 
	}
}

308 
ölöe
 
åbt_node_t
 *

309 
	$åbt_siblög
(
åbt_node_t
 *
node
)

311 
åbt_node_t
 *
∑ª¡
;

313 
∑ª¡
=
	`åbt_∑ª¡
(
node
);

314 if(!
∑ª¡
){

315  
NULL
;

318 i‡(
node
 =
∑ª¡
->
À·
) {

319  
∑ª¡
->
right
;

321  
∑ª¡
->
À·
;

323 
	}
}

325 
ölöe
 

326 
	$åbt_dñëe_ˇ£6
(
åbt_node_t
 *
node
)

328 
åbt_node_t
 *
siblög
, *
∑ª¡
;

330 
siblög
 = 
	`åbt_siblög
(
node
);

331 
∑ª¡
 = 
	`åbt_∑ª¡
(
node
);

333 
	`åbt_£t_cﬁ‹
(
siblög
, 
∑ª¡
->
rb_cﬁ‹
);

334 
	`åbt_£t_cﬁ‹
(
∑ª¡
, 
TRBT_BLACK
);

335 i‡(
node
 =
∑ª¡
->
À·
) {

336 
	`åbt_£t_cﬁ‹_right
(
siblög
, 
TRBT_BLACK
);

337 
	`åbt_rŸ©e_À·
(
∑ª¡
);

339 
	`åbt_£t_cﬁ‹_À·
(
siblög
, 
TRBT_BLACK
);

340 
	`åbt_rŸ©e_right
(
∑ª¡
);

342 
	}
}

345 
ölöe
 

346 
	$åbt_dñëe_ˇ£5
(
åbt_node_t
 *
node
)

348 
åbt_node_t
 *
∑ª¡
, *
siblög
;

350 
∑ª¡
 = 
	`åbt_∑ª¡
(
node
);

351 
siblög
 = 
	`åbt_siblög
(
node
);

352 i‡–(
node
 =
∑ª¡
->
À·
)

353 &&(
	`åbt_gë_cﬁ‹
(
siblög
Ë=
TRBT_BLACK
)

354 &&(
	`åbt_gë_cﬁ‹_À·
(
siblög
Ë=
TRBT_RED
)

355 &&(
	`åbt_gë_cﬁ‹_right
(
siblög
Ë=
TRBT_BLACK
) ){

356 
	`åbt_£t_cﬁ‹
(
siblög
, 
TRBT_RED
);

357 
	`åbt_£t_cﬁ‹_À·
(
siblög
, 
TRBT_BLACK
);

358 
	`åbt_rŸ©e_right
(
siblög
);

359 
	`åbt_dñëe_ˇ£6
(
node
);

362 i‡–(
node
 =
∑ª¡
->
right
)

363 &&(
	`åbt_gë_cﬁ‹
(
siblög
Ë=
TRBT_BLACK
)

364 &&(
	`åbt_gë_cﬁ‹_right
(
siblög
Ë=
TRBT_RED
)

365 &&(
	`åbt_gë_cﬁ‹_À·
(
siblög
Ë=
TRBT_BLACK
) ){

366 
	`åbt_£t_cﬁ‹
(
siblög
, 
TRBT_RED
);

367 
	`åbt_£t_cﬁ‹_right
(
siblög
, 
TRBT_BLACK
);

368 
	`åbt_rŸ©e_À·
(
siblög
);

369 
	`åbt_dñëe_ˇ£6
(
node
);

373 
	`åbt_dñëe_ˇ£6
(
node
);

374 
	}
}

376 
ölöe
 

377 
	$åbt_dñëe_ˇ£4
(
åbt_node_t
 *
node
)

379 
åbt_node_t
 *
siblög
;

381 
siblög
 = 
	`åbt_siblög
(
node
);

382 i‡–(
	`åbt_gë_cﬁ‹
(
node
->
∑ª¡
Ë=
TRBT_RED
)

383 &&(
	`åbt_gë_cﬁ‹
(
siblög
Ë=
TRBT_BLACK
)

384 &&(
	`åbt_gë_cﬁ‹_À·
(
siblög
Ë=
TRBT_BLACK
)

385 &&(
	`åbt_gë_cﬁ‹_right
(
siblög
Ë=
TRBT_BLACK
) ){

386 
	`åbt_£t_cﬁ‹
(
siblög
, 
TRBT_RED
);

387 
	`åbt_£t_cﬁ‹
(
node
->
∑ª¡
, 
TRBT_BLACK
);

389 
	`åbt_dñëe_ˇ£5
(
node
);

391 
	}
}

393 
åbt_dñëe_ˇ£1
(
åbt_node_t
 *
node
);

395 
ölöe
 

396 
	$åbt_dñëe_ˇ£3
(
åbt_node_t
 *
node
)

398 
åbt_node_t
 *
siblög
;

400 
siblög
 = 
	`åbt_siblög
(
node
);

401 i‡–(
	`åbt_gë_cﬁ‹
(
node
->
∑ª¡
Ë=
TRBT_BLACK
)

402 &&(
	`åbt_gë_cﬁ‹
(
siblög
Ë=
TRBT_BLACK
)

403 &&(
	`åbt_gë_cﬁ‹_À·
(
siblög
Ë=
TRBT_BLACK
)

404 &&(
	`åbt_gë_cﬁ‹_right
(
siblög
Ë=
TRBT_BLACK
) ){

405 
	`åbt_£t_cﬁ‹
(
siblög
, 
TRBT_RED
);

406 
	`åbt_dñëe_ˇ£1
(
node
->
∑ª¡
);

408 
	`åbt_dñëe_ˇ£4
(
node
);

410 
	}
}

412 
ölöe
 

413 
	$åbt_dñëe_ˇ£2
(
åbt_node_t
 *
node
)

415 
åbt_node_t
 *
siblög
;

417 
siblög
 = 
	`åbt_siblög
(
node
);

418 i‡(
	`åbt_gë_cﬁ‹
(
siblög
Ë=
TRBT_RED
) {

419 
	`åbt_£t_cﬁ‹
(
node
->
∑ª¡
, 
TRBT_RED
);

420 
	`åbt_£t_cﬁ‹
(
siblög
, 
TRBT_BLACK
);

421 i‡(
node
 =node->
∑ª¡
->
À·
) {

422 
	`åbt_rŸ©e_À·
(
node
->
∑ª¡
);

424 
	`åbt_rŸ©e_right
(
node
->
∑ª¡
);

427 
	`åbt_dñëe_ˇ£3
(
node
);

428 
	}
}

431 
	$åbt_dñëe_ˇ£1
(
åbt_node_t
 *
node
)

433 i‡(!
node
->
∑ª¡
) {

436 
	`åbt_dñëe_ˇ£2
(
node
);

438 
	}
}

441 
	$dñëe_node
(
åbt_node_t
 *
node
)

443 
åbt_node_t
 *
∑ª¡
, *
chûd
, 
dc
;

444 
åbt_node_t
 *
ãmp
 = 
NULL
;

454 i‡(
node
->
À·
 !
NULL
 &&Çode->
right
 != NULL) {

457 
ãmp
 = 
node
->
À·
;

459 
ãmp
->
right
 !
NULL
) {

460 
ãmp
 =Åemp->
right
;

466 
node
->
key32
 = 
ãmp
->key32;

467 
node
->
d©a
 = 
ãmp
->data;

469 
	`èŒoc_°ól
(
node
->
d©a
,Çode);

471 
ãmp
->
d©a
 = 
NULL
;

472 
ãmp
->
key32
 = -1;

476 
	`dñëe_node
(
ãmp
);

477 
föished
;

482 
chûd
 = 
node
->
À·
;

483 i‡(
node
->
right
) {

484 
chûd
 = 
node
->
right
;

495 i‡(!
chûd
) {

496 
chûd
 = &
dc
;

497 
chûd
->
åì
 = 
node
->tree;

498 
chûd
->
À·
=
NULL
;

499 
chûd
->
right
=
NULL
;

500 
chûd
->
rb_cﬁ‹
=
TRBT_BLACK
;

501 
chûd
->
d©a
=
NULL
;

505 
∑ª¡
 = 
	`åbt_∑ª¡
(
node
);

506 i‡(
∑ª¡
) {

507 i‡(
∑ª¡
->
À·
 =
node
) {

508 
∑ª¡
->
À·
 = 
chûd
;

510 
∑ª¡
->
right
 = 
chûd
;

513 
node
->
åì
->
roŸ
 = 
chûd
;

515 
chûd
->
∑ª¡
 = 
node
->parent;

518 i‡(
node
->
rb_cﬁ‹
 =
TRBT_BLACK
) {

519 i‡(
	`åbt_gë_cﬁ‹
(
chûd
Ë=
TRBT_RED
) {

520 
chûd
->
rb_cﬁ‹
 = 
TRBT_BLACK
;

522 
	`åbt_dñëe_ˇ£1
(
chûd
);

538 i‡(
chûd
 =&
dc
) {

539 i‡(
chûd
->
∑ª¡
 =
NULL
) {

540 
node
->
åì
->
roŸ
 = 
NULL
;

541 } i‡(
chûd
 =chûd->
∑ª¡
->
À·
) {

542 
chûd
->
∑ª¡
->
À·
 = 
NULL
;

544 
chûd
->
∑ª¡
->
right
 = 
NULL
;

548 
föished
:

553 i‡(
ãmp
) {

554 
ãmp
->
key32
 = 
node
->key32;

555 
ãmp
->
rb_cﬁ‹
 = 
node
->rb_color;

557 
ãmp
->
d©a
 = 
node
->data;

558 
	`èŒoc_°ól
(
ãmp
->
d©a
,Åemp);

560 
ãmp
->
∑ª¡
 = 
node
->parent;

561 i‡(
ãmp
->
∑ª¡
) {

562 i‡(
ãmp
->
∑ª¡
->
À·
 =
node
) {

563 
ãmp
->
∑ª¡
->
À·
 =Åemp;

565 
ãmp
->
∑ª¡
->
right
 =Åemp;

569 
ãmp
->
À·
 = 
node
->left;

570 i‡(
ãmp
->
À·
) {

571 
ãmp
->
À·
->
∑ª¡
 =Åemp;

573 
ãmp
->
right
 = 
node
->right;

574 i‡(
ãmp
->
right
) {

575 
ãmp
->
right
->
∑ª¡
 =Åemp;

578 i‡(
ãmp
->
åì
->
roŸ
 =
node
) {

579 
ãmp
->
åì
->
roŸ
 =Åemp;

583 i‡–(
node
->
åì
->
Êags
 & 
TRBT_AUTOFREE
)

584 && (
node
->
åì
->
roŸ
 =
NULL
) ) {

585 
	`èŒoc_‰ì
(
node
->
åì
);

589 
	}
}

594 
	$node_de°ru˘‹
(
åbt_node_t
 *
node
)

596 
	`dñëe_node
(
node
);

599 
	}
}

601 
ölöe
 
åbt_node_t
 *

602 
	$åbt_¸óã_node
(
åbt_åì_t
 *
åì
, 
åbt_node_t
 *
∑ª¡
, 
uöt32_t
 
key
, *
d©a
)

604 
åbt_node_t
 *
node
;

606 
node
=
	`èŒoc_zîo
(
åì
, 
åbt_node_t
);

607 i‡(
node
 =
NULL
) {

608 
	`Ârötf
(
°dîr
, "FailedÅoállocate memory forÑbÇode\n");

609  
NULL
;

612 
node
->
åì
=tree;

613 
node
->
rb_cﬁ‹
=
TRBT_BLACK
;

614 
node
->
∑ª¡
=parent;

615 
node
->
À·
=
NULL
;

616 
node
->
right
=
NULL
;

617 
node
->
key32
=
key
;

618 
node
->
d©a
 = data;

623 
	`èŒoc_°ól
(
d©a
, 
node
);

624 
	`èŒoc_£t_de°ru˘‹
(
node
, 
node_de°ru˘‹
);

626  
node
;

627 
	}
}

635 
	$åbt_ö£π32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
, *
d©a
)

637 
åbt_node_t
 *
node
;

639 
node
=
åì
->
roŸ
;

642 if(!
node
){

643 
node
 = 
	`åbt_¸óã_node
(
åì
, 
NULL
, 
key
, 
d©a
);

645 
åì
->
roŸ
=
node
;

646  
NULL
;

656 if(
key
==
node
->
key32
){

657 *
ﬁd_d©a
;

659 
ﬁd_d©a
 = 
node
->
d©a
;

660 
node
->
d©a
 = data;

664 
	`èŒoc_°ól
(
node
->
d©a
,Çode);

666  
ﬁd_d©a
;

668 if(
key
<
node
->
key32
) {

669 if(!
node
->
À·
){

671 
åbt_node_t
 *
√w_node
;

673 
√w_node
 = 
	`åbt_¸óã_node
(
åì
, 
node
, 
key
, 
d©a
);

674 i‡(!
√w_node
)

675  
NULL
;

676 
node
->
À·
=
√w_node
;

677 
node
=
√w_node
;

681 
node
Úode->
À·
;

684 if(
key
>
node
->
key32
) {

685 if(!
node
->
right
){

687 
åbt_node_t
 *
√w_node
;

689 
√w_node
 = 
	`åbt_¸óã_node
(
åì
, 
node
, 
key
, 
d©a
);

690 i‡(!
√w_node
)

691  
NULL
;

692 
node
->
right
=
√w_node
;

693 
node
=
√w_node
;

696 
node
Úode->
right
;

702 
node
->
rb_cﬁ‹
=
TRBT_RED
;

703 
	`åbt_ö£π_ˇ£1
(
åì
, 
node
);

704  
NULL
;

705 
	}
}

708 
	$åbt_lookup32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
)

710 
åbt_node_t
 *
node
;

712 
node
=
åì
->
roŸ
;

714 
node
){

715 if(
key
==
node
->
key32
){

716  
node
->
d©a
;

718 if(
key
<
node
->
key32
){

719 
node
Úode->
À·
;

722 if(
key
>
node
->
key32
){

723 
node
Úode->
right
;

727  
NULL
;

728 
	}
}

735 
	$åbt_dñëe32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
)

737 
åbt_node_t
 *
node
;

739 
node
=
åì
->
roŸ
;

741 
node
){

742 if(
key
==
node
->
key32
){

743 
	`èŒoc_‰ì
(
node
);

746 if(
key
<
node
->
key32
){

747 
node
Úode->
À·
;

750 if(
key
>
node
->
key32
){

751 
node
Úode->
right
;

755 
	}
}

759 
åbt_ö£π32_ˇŒback
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
, *(*
ˇŒback
)(*
∑øm
, *
d©a
), *param)

761 
åbt_node_t
 *
	gnode
;

763 
	gnode
=
åì
->
roŸ
;

766 if(!
	gnode
){

767 
	gnode
 = 
åbt_¸óã_node
(
åì
, 
NULL
, 
key
,

768 
ˇŒback
(
∑øm
, 
NULL
));

770 
	gåì
->
	groŸ
=
node
;

780 if(
	gkey
==
node
->
key32
){

781 
node
->
d©a
 = 
ˇŒback
(
∑øm
,Çode->data);

782 
èŒoc_°ól
(
node
->
d©a
,Çode);

786 if(
	gkey
<
	gnode
->
	gkey32
) {

787 if(!
	gnode
->
	gÀ·
){

789 
åbt_node_t
 *
	g√w_node
;

791 
	g√w_node
 = 
åbt_¸óã_node
(
åì
, 
node
, 
key
,

792 
ˇŒback
(
∑øm
, 
NULL
));

793 
	gnode
->
	gÀ·
=
√w_node
;

794 
	gnode
=
√w_node
;

798 
	gnode
=
node
->
À·
;

801 if(
	gkey
>
	gnode
->
	gkey32
) {

802 if(!
	gnode
->
	gright
){

804 
åbt_node_t
 *
	g√w_node
;

806 
	g√w_node
 = 
åbt_¸óã_node
(
åì
, 
node
, 
key
,

807 
ˇŒback
(
∑øm
, 
NULL
));

808 
	gnode
->
	gright
=
√w_node
;

809 
	gnode
=
√w_node
;

812 
	gnode
=
node
->
right
;

818 
	gnode
->
	grb_cﬁ‹
=
TRBT_RED
;

819 
åbt_ö£π_ˇ£1
(
åì
, 
node
);

824 
	såbt_¨øy_∑øm
 {

825 *(*
	mˇŒback
)(*
	m∑øm
, *
	md©a
);

826 *
	m∑øm
;

827 
uöt32_t
 
	mkeyÀn
;

828 
uöt32_t
 *
	mkey
;

829 
åbt_åì_t
 *
	måì
;

831 *
	$¨øy_ö£π_ˇŒback
(*
p
, *
d©a
)

833 
åbt_¨øy_∑øm
 *
∑øm
 = (åbt_¨øy_∑øm *)
p
;

834 
åbt_åì_t
 *
åì
 = 
NULL
;

840 i‡(
∑øm
->
keyÀn
 == 0) {

841  
∑øm
->
	`ˇŒback
’¨am->∑øm, 
d©a
);

849 i‡(
d©a
 =
NULL
) {

854 
åì
 = 
	`åbt_¸óã
(
∑øm
->åì, 
TRBT_AUTOFREE
);

857 
åì
 = (
åbt_åì_t
 *)
d©a
;

860 
	`åbt_ö£π¨øy32_ˇŒback
(
åì
, 
∑øm
->
keyÀn
,Ö¨am->
key
,Ö¨am->
ˇŒback
,Öaram->param);

866  
åì
;

867 
	}
}

873 
åbt_ö£π¨øy32_ˇŒback
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
, uöt32_à*
key
, *(*
cb
)(*
∑øm
, *
d©a
), *
pm
)

875 
åbt_¨øy_∑øm
 
	gèp
;

880 
	gèp
.
	gˇŒback

cb
;

881 
	gèp
.
	g∑øm
 = 
pm
;

882 
	gèp
.
	gkeyÀn
 = 
keyÀn
-1;

883 
	gèp
.
	gkey
 = &
key
[1];

884 
	gèp
.
	gåì
 = 
åì
;

886 
åbt_ö£π32_ˇŒback
(
åì
, 
key
[0], 
¨øy_ö£π_ˇŒback
, &
èp
);

891 
	$åbt_looku∑ºay32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
, uöt32_à*
key
)

896 i‡(
keyÀn
 == 1) {

897  
	`åbt_lookup32
(
åì
, 
key
[0]);

901 
åì
 = 
	`åbt_lookup32
—ªe, 
key
[0]);

902 i‡(
åì
 =
NULL
) {

904  
NULL
;

908  
	`åbt_looku∑ºay32
(
åì
, 
keyÀn
-1, &
key
[1]);

909 
	}
}

914 
åbt_åavî£¨øy32_node
(
åbt_node_t
 *
node
, 
uöt32_t
 
keyÀn
,

915 (*
ˇŒback
)(*
∑øm
, *
d©a
),

916 *
∑øm
)

918 i‡(
node
->
À·
) {

919 
	`åbt_åavî£¨øy32_node
(
node
->
À·
, 
keyÀn
, 
ˇŒback
, 
∑øm
);

926 i‡(
keyÀn
 == 0) {

927 
	`ˇŒback
(
∑øm
, 
node
->
d©a
);

929 
	`åbt_åavî£¨øy32
(
node
->
d©a
, 
keyÀn
, 
ˇŒback
, 
∑øm
);

932 i‡(
node
->
right
) {

933 
	`åbt_åavî£¨øy32_node
(
node
->
right
, 
keyÀn
, 
ˇŒback
, 
∑øm
);

935 
	}
}

940 
åbt_åavî£¨øy32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
,

941 (*
ˇŒback
)(*
∑øm
, *
d©a
),

942 *
∑øm
)

944 
åbt_node_t
 *
node
;

946 i‡(
åì
 =
NULL
) {

950 
node
=
åì
->
roŸ
;

951 i‡(
node
 =
NULL
) {

955 
	`åbt_åavî£¨øy32_node
(
node
, 
keyÀn
-1, 
ˇŒback
, 
∑øm
);

956 
	}
}

963 
	$åbt_födfú°¨øy32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
)

965 
åbt_node_t
 *
node
;

967 i‡(
keyÀn
 < 1) {

968  
NULL
;

971 i‡(
åì
 =
NULL
) {

972  
NULL
;

975 
node
=
åì
->
roŸ
;

976 i‡(
node
 =
NULL
) {

977  
NULL
;

980 
node
->
À·
) {

981 
node
 =Çode->
À·
;

985 i‡(
keyÀn
 == 1) {

986  
node
->
d©a
;

992  
	`åbt_födfú°¨øy32
(
node
->
d©a
, 
keyÀn
-1);

993 
	}
}

	@ccan/ccan/rbtree/rbtree.h

19 #i‚de‡
CCAN_RBTREE_H


20 
	#CCAN_RBTREE_H


	)

21 
	~<°döt.h
>

22 
	~<cˇn/èŒoc/èŒoc.h
>

24 
	#TRBT_RED
 0x00

	)

25 
	#TRBT_BLACK
 0x01

	)

26 
	såbt_node
 {

27 
åbt_åì
 *
	måì
;

28 
åbt_node
 *
	m∑ª¡
;

29 
åbt_node
 *
	mÀ·
;

30 
åbt_node
 *
	mright
;

31 
uöt32_t
 
	mrb_cﬁ‹
;

32 
uöt32_t
 
	mkey32
;

33 *
	md©a
;

34 } 
	tåbt_node_t
;

36 
	såbt_åì
 {

37 
åbt_node_t
 *
	mroŸ
;

39 
	#TRBT_AUTOFREE
 0x00000001

	)

40 
uöt32_t
 
	mÊags
;

41 } 
	tåbt_åì_t
;

46 
åbt_åì_t
 *
åbt_¸óã
(
TALLOC_CTX
 *
mem˘x
, 
uöt32_t
 
Êags
);

49 *
åbt_lookup32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
);

55 *
åbt_ö£π32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
, *
d©a
);

66 
åbt_ö£π32_ˇŒback
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
, *(*
ˇŒback
)(*
∑øm
, *
d©a
), *param);

69 
åbt_dñëe32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
key
);

73 
åbt_ö£π¨øy32_ˇŒback
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
, uöt32_à*
key
, *(*
ˇŒback
)(*
∑øm
, *
d©a
), *param);

77 *
åbt_looku∑ºay32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
, uöt32_à*
key
);

80 
åbt_åavî£¨øy32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
, (*
ˇŒback
)(*
∑øm
, *
d©a
), *param);

84 *
	`åbt_födfú°¨øy32
(
åbt_åì_t
 *
åì
, 
uöt32_t
 
keyÀn
);

	@ccan/ccan/rbtree/test/run-many.c

1 
	~<cˇn/rbåì/rbåì.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/èŒoc/èŒoc.h
>

4 
	~<°rög.h
>

5 
	~<°dboﬁ.h
>

6 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

7 
	~<cˇn/Áûã°/Áûã°.h
>

8 
	#NUM_ELEMS
 100

	)

11 *
	$my_mÆloc
(
size_t
 
size
)

13  
	`mÆloc
(
size
);

14 
	}
}

16 
	$my_‰ì
(*
±r
)

18 
	`‰ì
(
±r
);

19 
	}
}

21 *
	$my_ªÆloc
(*
±r
, 
size_t
 
size
)

23  
	`ªÆloc
(
±r
, 
size
);

24 
	}
}

26 
boﬁ
 
	$lookup_Æl
(
åbt_åì_t
 *
rb
, 
boﬁ
 
exi°
)

28 
i
;

30 
i
 = 0; i < 
NUM_ELEMS
; i++) {

31 *
p
 = 
	`åbt_lookup32
(
rb
, 
i
);

32 i‡(
p
) {

33 i‡(!
exi°
)

34  
Ál£
;

35 i‡(*
p
 !
i
)

36  
Ál£
;

38 i‡(
exi°
)

39  
Ál£
;

41  
åue
;

42 
	}
}

44 
boﬁ
 
	$add_⁄e
(
åbt_åì_t
 *
rb
, 
boﬁ
 
exi°
, 
i
)

46 *
√w
 = 
	`èŒoc_memdup
(
rb
, &
i
, (i));

47 *
p
;

49 i‡(!
√w
)

50  
Ál£
;

52 
p
 = 
	`åbt_ö£π32
(
rb
, 
i
, 
√w
);

53 i‡(
p
) {

54 i‡(!
exi°
)

55  
Ál£
;

56 i‡(*
p
 !
i
)

57  
Ál£
;

59 i‡(
exi°
)

60  
Ál£
;

62 i‡(!
	`åbt_lookup32
(
rb
, 
i
))

63  
Ál£
;

65  
åue
;

66 
	}
}

68 
boﬁ
 
	$ö£π_Æl
(
åbt_åì_t
 *
rb
, 
boﬁ
 
exi°
)

70 
i
;

72 
i
 = 0; i < 
NUM_ELEMS
; i++) {

73 i‡(!
	`add_⁄e
(
rb
, 
exi°
, 
i
))

74  
Ál£
;

76  
åue
;

77 
	}
}

79 
	$dñëe_Æl
(
åbt_åì_t
 *
rb
)

81 
i
;

84 
i
 = 0; i < 
NUM_ELEMS
 / 2; i++) {

85 
	`åbt_dñëe32
(
rb
, 
i
);

88 
i
 = 
NUM_ELEMS
-1; i >= NUM_ELEMS / 2; i--) {

89 
	`åbt_dñëe32
(
rb
, 
i
);

91 
	}
}

93 *
	g˘x
;

94 
åbt_åì_t
 *
	grb
;

96 
	$exô_ã°
()

98 
	`èŒoc_‰ì
(
rb
);

99 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
˘x
) == 1);

100 
	`èŒoc_‰ì
(
˘x
);

101 
	`Áûã°_exô
(
	`exô_°©us
());

102 
	}
}

104 
	$maö
(
¨gc
, *
¨gv
[])

106 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

107 
èp_Áû_ˇŒback
 = 
exô_ã°
;

108 
	`∂™_ã°s
(8);

110 
˘x
 = 
	`èŒoc_°rdup
(
NULL
, "toplevel");

112 
	`èŒoc_£t_Æloˇt‹
(
my_mÆloc
, 
my_‰ì
, 
my_ªÆloc
);

114 
rb
 = 
	`åbt_¸óã
(
˘x
, 0);

115 
	`ok1
(
rb
);

118 
	`ok1
(
	`lookup_Æl
(
rb
, 
Ál£
));

121 
	`ok1
(
	`ö£π_Æl
(
rb
, 
Ál£
));

124 
	`ok1
(
	`lookup_Æl
(
rb
, 
åue
));

127 
	`ok1
(
	`ö£π_Æl
(
rb
, 
åue
));

130 
	`dñëe_Æl
(
rb
);

133 
	`ok1
(
	`lookup_Æl
(
rb
, 
Ál£
));

134 
	`ok1
(
	`ö£π_Æl
(
rb
, 
Ál£
));

137 
	`èŒoc_‰ì
(
rb
);

140 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
˘x
) == 1);

141 
	`èŒoc_‰ì
(
˘x
);

144 
	`Áûã°_exô
(
	`exô_°©us
());

145 
	}
}

	@ccan/ccan/rbtree/test/run.c

1 
	~<cˇn/Áûã°/Áûã°.h
>

2 
	~<cˇn/rbåì/rbåì.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<cˇn/èŒoc/èŒoc.h
>

5 
	~<°rög.h
>

8 *
	$my_mÆloc
(
size_t
 
size
)

10  
	`mÆloc
(
size
);

11 
	}
}

13 
	$my_‰ì
(*
±r
)

15 
	`‰ì
(
±r
);

16 
	}
}

18 *
	$my_ªÆloc
(*
±r
, 
size_t
 
size
)

20  
	`ªÆloc
(
±r
, 
size
);

21 
	}
}

23 *
	$ö£π_ˇŒback
(*
∑øm
, *
d©a
)

25 
	`ok1
(
d©a
 =
∑øm
);

26  
	`èŒoc_°rdup
(
NULL
, "insert_callback");

27 
	}
}

29 
	$maö
()

31 
åbt_åì_t
 *
rb
;

32 *
˘x
 = 
	`èŒoc_°rdup
(
NULL
, "toplevel");

33 *
d©a
, *
d©a2
;

36 
	`∂™_ã°s
(19);

38 
	`èŒoc_£t_Æloˇt‹
(
my_mÆloc
, 
my_‰ì
, 
my_ªÆloc
);

40 
rb
 = 
	`åbt_¸óã
(
˘x
, 0);

41 
	`ok1
(
rb
);

42 
	`ok1
(
	`èŒoc_is_∑ª¡
(
rb
, 
˘x
));

45 
	`ok1
(
	`åbt_lookup32
(
rb
, 0Ë=
NULL
);

46 
	`ok1
(
	`åbt_lookup32
(
rb
, -1Ë=
NULL
);

49 
d©a
 = 
	`èŒoc_°rdup
(
NULL
, "data");

50 
	`ok1
(
	`åbt_ö£π32
(
rb
, 0, 
d©a
Ë=
NULL
);

51 
	`ok1
(
	`åbt_lookup32
(
rb
, 0Ë=
d©a
);

52 
	`ok1
(
	`åbt_lookup32
(
rb
, -1Ë=
NULL
);

55 
	`èŒoc_‰ì
(
d©a
);

56 
	`ok1
(
	`åbt_lookup32
(
rb
, 0Ë=
NULL
);

59 
d©a
 = 
	`èŒoc_°rdup
(
NULL
, "data");

60 
	`ok1
(
	`åbt_ö£π32
(
rb
, 0, 
d©a
Ë=
NULL
);

63 
d©a2
 = 
	`èŒoc_°rdup
(
NULL
, "data2");

64 
	`ok1
(
	`åbt_ö£π32
(
rb
, 0, 
d©a2
Ë=
d©a
);

65 
	`ok1
(
	`åbt_lookup32
(
rb
, 0Ë=
d©a2
);

68 
	`èŒoc_‰ì
(
d©a
);

69 
	`ok1
(
	`åbt_lookup32
(
rb
, 0Ë=
d©a2
);

72 
	`åbt_ö£π32_ˇŒback
(
rb
, 1, 
ö£π_ˇŒback
, 
NULL
);

73 
	`ok1
(
	`°rcmp
(
	`åbt_lookup32
(
rb
, 1), "insert_callback") == 0);

75 
	`åbt_ö£π32_ˇŒback
(
rb
, 0, 
ö£π_ˇŒback
, 
d©a2
);

76 
	`ok1
(
	`°rcmp
(
	`åbt_lookup32
(
rb
, 0), "insert_callback") == 0);

77 
	`èŒoc_‰ì
(
d©a2
);

80 
d©a2
 = 
	`åbt_lookup32
(
rb
, 1);

81 
	`åbt_dñëe32
(
rb
, 1);

82 
	`ok1
(
	`åbt_lookup32
(
rb
, 1Ë=
NULL
);

83 
	`ok1
(
	`åbt_lookup32
(
rb
, 0));

84 
	`èŒoc_‰ì
(
d©a2
);

87 
	`èŒoc_‰ì
(
	`åbt_lookup32
(
rb
, 0));

88 
	`èŒoc_‰ì
(
rb
);

91 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
˘x
) == 1);

92 
	`èŒoc_‰ì
(
˘x
);

95 
	`Áûã°_exô
(
	`exô_°©us
());

96 
	}
}

	@ccan/ccan/rbuf/rbuf.c

2 
	~<cˇn/rbuf/rbuf.h
>

3 
	~<sys/ty≥s.h
>

4 
	~<sys/°©.h
>

5 
	~<uni°d.h
>

6 
	~<î∫o.h
>

7 
	~<°rög.h
>

8 
	~<f˙é.h
>

10 
boﬁ
 
	$rbuf_›í
(
rbuf
 *rbuf, c⁄° *
«me
, *
buf
, 
size_t
 
buf_max
)

12 
fd
 = 
	`›í
(
«me
, 
O_RDONLY
);

13 i‡(
fd
 >= 0) {

14 
	`rbuf_öô
(
rbuf
, 
fd
, 
buf
, 
buf_max
);

15  
åue
;

17  
Ál£
;

18 
	}
}

20 
size_t
 
	$ªm
(c⁄° 
rbuf
 *
buf
)

22  
buf
->
buf_íd
 - (buf->
°¨t
 + buf->
Àn
);

23 
	}
}

25 
size_t
 
	$rbuf_good_size
(
fd
)

27 
°©
 
°
;

29 i‡(
	`f°©
(
fd
, &
°
Ë=0 && st.
°_blksize
 >= 4096)

30  
°
.
°_blksize
;

32 
	}
}

34 
boﬁ
 
íœrge_buf
(
rbuf
 *
buf
, 
size_t
 
Àn
,

35 *(*
ªsize
)(*
buf
, 
size_t
 
Àn
))

37 *
	g√w
;

38 i‡(!
	gªsize
) {

39 
	gî∫o
 = 
ENOMEM
;

40  
	gÁl£
;

42 i‡(!
	gÀn
)

43 
	gÀn
 = 
rbuf_good_size
(
buf
->
fd
);

44 
	g√w
 = 
ªsize
(
buf
->buf, 
Àn
);

45 i‡(!
	g√w
)

46  
	gÁl£
;

47 
	gbuf
->
	g°¨t
 +(
√w
 - 
buf
->buf);

48 
	gbuf
->bu‡
√w
;

49 
	gbuf
->
	gbuf_íd
 = 
√w
 + 
Àn
;

50  
	gåue
;

53 
ssize_t
 
gë_m‹e
(
rbuf
 *rbuf,

54 *(*
ªsize
)(*
buf
, 
size_t
 
Àn
))

56 
size_t
 
	gr
;

58 i‡(
	grbuf
->
	g°¨t
 +Ñbuf->
	gÀn
 =
rbuf
->
buf_íd
) {

59 i‡(!
íœrge_buf
(
rbuf
, (rbuf->
buf_íd
 -Ñbuf->
buf
Ë* 2, 
ªsize
))

63 
	gr
 = 
ªad
(
rbuf
->
fd
,Ñbuf->
°¨t
 +Ñbuf->
Àn
, 
ªm
(rbuf));

64 i‡(
	gr
 <= 0)

65  
r
;

67 
	grbuf
->
	gÀn
 +
r
;

68  
	gr
;

71 *
rbuf_fûl_Æl
(
rbuf
 *rbuf, *(*
ªsize
)(*
buf
, 
size_t
 
Àn
))

73 
ssize_t
 
	gr
;

76 i‡(!
	grbuf
->
	gÀn
)

77 
	grbuf
->
	g°¨t
 = 
rbuf
->
buf
;

79 (
	gr
 = 
gë_m‹e
(
rbuf
, 
ªsize
)) != 0)

80 i‡(
r
 < 0)

81  
NULL
;

82  
	grbuf
->
	g°¨t
;

85 *
rbuf_fûl
(
rbuf
 *rbuf, *(*
ªsize
)(*
buf
, 
size_t
 
Àn
))

87 i‡(!
	grbuf
->
	gÀn
) {

88 
	grbuf
->
	g°¨t
 = 
rbuf
->
buf
;

89 i‡(
gë_m‹e
(
rbuf
, 
ªsize
) < 0)

90  
	gNULL
;

92  
	grbuf
->
	g°¨t
;

95 *
rbuf_ªad_°r
(
rbuf
 *rbuf, 
ãrm
,

96 *(*
ªsize
)(*
buf
, 
size_t
 
Àn
))

98 *
	gp
, *
	gªt
;

99 
ssize_t
 
	gr
 = 0;

100 
size_t
 
	g¥ev
 = 0;

103 i‡(!
	grbuf
->
	gÀn
)

104 
	grbuf
->
	g°¨t
 = 
rbuf
->
buf
;

106 !(
	gp
 = 
memchr
(
rbuf
->
°¨t
 + 
¥ev
, 
ãrm
,Ñbuf->
Àn
 -Örev))) {

107 
	g¥ev
 +
r
;

108 
	gr
 = 
gë_m‹e
(
rbuf
, 
ªsize
);

109 i‡(
	gr
 < 0)

110  
	gNULL
;

112 i‡(
	gr
 == 0) {

114 i‡(!
rbuf
->
Àn
 && 
ãrm
) {

115 
î∫o
 = 0;

116  
	gNULL
;

119 
as£π
(
rbuf
->
°¨t
 +Ñbuf->
Àn
 <Ñbuf->
buf_íd
);

120 
	grbuf
->
	g°¨t
[
rbuf
->
Àn
] = '\0';

121 
	gªt
 = 
rbuf
->
°¨t
;

122 
rbuf_c⁄sume
(
rbuf
,Ñbuf->
Àn
);

123  
	gªt
;

126 *
	gp
 = '\0';

127 
	gªt
 = 
rbuf
->
°¨t
;

128 
rbuf_c⁄sume
(
rbuf
, 
p
 + 1 - 
ªt
);

129  
	gªt
;

	@ccan/ccan/rbuf/rbuf.h

2 #i‚de‡
CCAN_RBUF_H


3 
	#CCAN_RBUF_H


	)

4 
	~<°dio.h
>

5 
	~<limôs.h
>

6 
	~<as£π.h
>

7 
	~<°dboﬁ.h
>

9 
	srbuf
 {

10 
	mfd
;

13 *
	m°¨t
;

15 
size_t
 
	mÀn
;

18 *
	mbuf
, *
	mbuf_íd
;

28 
ölöe
 
	$rbuf_öô
(
rbuf
 *
buf
,

29 
fd
, *
buf„r
, 
size_t
 
buf_max
)

31 
buf
->
fd
 = fd;

32 
buf
->
°¨t
 = buf->bu‡
buf„r
;

33 
buf
->
Àn
 = 0;

34 
buf
->
buf_íd
 = 
buf„r
 + 
buf_max
;

35 
	}
}

53 
boﬁ
 
rbuf_›í
(
rbuf
 *rbuf, c⁄° *
«me
, *
buf
, 
size_t
 
buf_max
);

61 
size_t
 
rbuf_good_size
(
fd
);

85 *
rbuf_fûl
(
rbuf
 *rbuf, *(*
ªsize
)(*
buf
, 
size_t
 
Àn
));

96 
ölöe
 
	$rbuf_c⁄sume
(
rbuf
 *
buf
, 
size_t
 
Àn
)

98 
buf
->
Àn
 -=Üen;

99 
buf
->
°¨t
 +
Àn
;

100 
	}
}

117 *
rbuf_fûl_Æl
(
rbuf
 *rbuf, *(*
ªsize
)(*
buf
, 
size_t
 
Àn
));

153 *
rbuf_ªad_°r
(
rbuf
 *rbuf, 
ãrm
,

154 *(*
ªsize
)(*
buf
, 
size_t
 
Àn
));

	@ccan/ccan/rbuf/test/run-all.c

1 
	~<cˇn/rbuf/rbuf.h
>

3 
	~<cˇn/rbuf/rbuf.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<°dlib.h
>

10 
	$maö
()

12 
rbuf
 
ö
;

13 
buf
[4096];

14 
i
, 
size
, 
fd
 = 
	`›í
("run-Æl-fûe", 
O_WRONLY
|
O_CREAT
, 0600);

17 
	`∂™_ã°s
(8);

20 
size
 = 
	`rbuf_good_size
(
fd
)*2;

21 
i
 = 0; i * (
buf
Ë< 
size
; i++) {

22 
	`mem£t
(
buf
, 0x42 + 
i
, (buf));

23 
	`wrôe
(
fd
, 
buf
, (buf));

25 
	`˛o£
(
fd
);

27 
	`ok1
(
	`rbuf_›í
(&
ö
, "run-Æl-fûe", 
NULL
, 0));

29 
	`ok1
(!
	`rbuf_fûl
(&
ö
, 
NULL
));

30 
	`ok1
(
î∫o
 =
ENOMEM
);

31 
	`ok1
(
	`rbuf_fûl
(&
ö
, 
ªÆloc
));

33 
	`ok1
(!
	`rbuf_fûl_Æl
(&
ö
, 
NULL
));

34 
	`ok1
(
î∫o
 =
ENOMEM
);

35 
	`ok1
(
	`rbuf_fûl_Æl
(&
ö
, 
ªÆloc
));

36 
	`ok1
(
ö
.
Àn
 =
size
);

37 
i
 = 0; i * (
buf
Ë< 
size
; i++) {

38 
	`mem£t
(
buf
, 0x42 + 
i
, (buf));

39 i‡(
	`memcmp
(
buf
, 
ö
.
°¨t
, (buf)) != 0) {

40 
	`Áû
("Bad buffer contents");

43 
	`rbuf_c⁄sume
(&
ö
, (
buf
));

45 
	`‰ì
(
ö
.
buf
);

48  
	`exô_°©us
();

49 
	}
}

	@ccan/ccan/rbuf/test/run-open.c

1 
	~<cˇn/rbuf/rbuf.h
>

3 
	~<cˇn/rbuf/rbuf.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<°dlib.h
>

10 
	$maö
()

12 
rbuf
 
ö
;

15 
	`∂™_ã°s
(5);

17 
	`ok1
(!
	`rbuf_›í
(&
ö
, "n⁄exi°ít-fûe", 
NULL
, 0));

18 
	`ok1
(
î∫o
 =
ENOENT
);

19 
	`ok1
(
	`rbuf_›í
(&
ö
, "ã°/run-›í.c", 
NULL
, 0));

20 
	`ok1
(
	`˛o£
(
ö
.
fd
) == 0);

22 
	`ok1
(
	`rbuf_good_size
(
ö
.
fd
) == 4096);

24  
	`exô_°©us
();

25 
	}
}

	@ccan/ccan/rbuf/test/run-partial-read.c

1 
	~<uni°d.h
>

3 
ssize_t
 
	$∑πül_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
)

5  
	`ªad
(
fd
, 
buf
, 1);

6 
	}
}

7 
ssize_t
 
	$fuŒ_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
)

9  
	`ªad
(
fd
, 
buf
, 
cou¡
);

10 
	}
}

11 
	#ªad
 
∑πül_ªad


	)

13 
	~<cˇn/rbuf/rbuf.h
>

15 
	~<cˇn/rbuf/rbuf.c
>

16 
	~<cˇn/èp/èp.h
>

17 
	~<sys/ty≥s.h
>

18 
	~<sys/°©.h
>

19 
	~<f˙é.h
>

20 
	~<°dlib.h
>

22 
	$maö
()

24 
rbuf
 
ö
;

25 
buf
[4096];

26 *
löes
[100], *
p
;

27 
i
, 
fd
 = 
	`›í
("ã°/run.c", 
O_RDONLY
);

30 
	`∂™_ã°s
(140);

33 
buf
[
	`fuŒ_ªad
(
fd
, buf, (buf))] = '\0';

34 
	`l£ek
(
fd
, 
SEEK_SET
, 0);

36 
i
 = 0, 
p
 = 
buf
; *p; i++) {

37 
löes
[
i
] = 
p
;

38 
p
 = 
	`°rchr
(p, '\n');

39 *
p
 = '\0';

40 
p
++;

42 
löes
[
i
] = 
NULL
;

44 
	`rbuf_öô
(&
ö
, 
fd
, 
	`mÆloc
(31), 31);

45 
	`ok1
(
ö
.
fd
 == fd);

46 
	`ok1
(
ö
.
buf_íd
 - in.
buf
 == 31);

47 
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
NULL
);

48 
	`ok1
(
p
);

49 
	`ok1
(
	`°rcmp
(
p
, 
löes
[0]) == 0);

51 
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
ªÆloc
);

52 
	`ok1
(
p
);

53 
	`ok1
(
	`°rcmp
(
p
, 
löes
[1]) == 0);

55 
i
 = 2; 
löes
[i]; i++) {

56 
	`ok1
(
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
ªÆloc
));

57 
	`ok1
(
	`°rcmp
(
p
, 
löes
[
i
]) == 0);

60 
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
ªÆloc
);

61 
	`ok1
(
î∫o
 == 0);

62 
	`ok1
(
p
 =
NULL
);

63 
	`‰ì
(
ö
.
buf
);

66  
	`exô_°©us
();

67 
	}
}

	@ccan/ccan/rbuf/test/run-term-eof.c

1 
	~<cˇn/rbuf/rbuf.h
>

3 
	~<cˇn/rbuf/rbuf.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<°dlib.h
>

10 
	$maö
()

12 
rbuf
 
ö
;

13 
buf
[4096], *
p
;

14 
fd
 = 
	`›í
("ã°/run-ãrm-eof.c", 
O_RDONLY
), 
Àn
;

17 
	`∂™_ã°s
(6);

20 
Àn
 = 
	`ªad
(
fd
, 
buf
, (buf));

21 
buf
[
Àn
] = '\0';

22 
	`l£ek
(
fd
, 
SEEK_SET
, 0);

25 
	`rbuf_öô
(&
ö
, 
fd
, 
	`mÆloc
(
Àn
),Üen);

26 
p
 = 
	`rbuf_ªad_°r
(&
ö
, 64, 
NULL
);

27 
	`ok1
(
î∫o
 =
ENOMEM
);

28 
	`ok1
(!
p
);

30 
p
 = 
	`rbuf_ªad_°r
(&
ö
, 64, 
ªÆloc
);

31 
	`ok1
(
p
);

32 
	`ok1
(
	`°rcmp
(
p
, 
buf
) == 0);

33 
	`‰ì
(
ö
.
buf
);

36 
	`l£ek
(
fd
, 
SEEK_SET
, 0);

37 
	`rbuf_öô
(&
ö
, 
fd
, 
	`mÆloc
(
Àn
),Üen);

38 
p
 = 
	`rbuf_ªad_°r
(&
ö
, 64, 
ªÆloc
);

39 
	`ok1
(
p
);

40 
	`ok1
(
	`°rcmp
(
p
, 
buf
) == 0);

41 
	`‰ì
(
ö
.
buf
);

43  
	`exô_°©us
();

44 
	}
}

	@ccan/ccan/rbuf/test/run.c

1 
	~<cˇn/rbuf/rbuf.h
>

3 
	~<cˇn/rbuf/rbuf.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<°dlib.h
>

10 
	$maö
()

12 
rbuf
 
ö
;

13 
buf
[4096];

14 *
löes
[100], *
p
;

15 
i
, 
fd
 = 
	`›í
("ã°/run.c", 
O_RDONLY
), 
Àn
;

18 
	`∂™_ã°s
(144);

21 
Àn
 = 
	`ªad
(
fd
, 
buf
, (buf));

22 
buf
[
Àn
] = '\0';

23 
	`l£ek
(
fd
, 
SEEK_SET
, 0);

25 
i
 = 0, 
p
 = 
buf
; *p; i++) {

26 
löes
[
i
] = 
p
;

27 
p
 = 
	`°rchr
(p, '\n');

28 *
p
 = '\0';

29 
p
++;

31 
löes
[
i
] = 
NULL
;

33 
	`rbuf_öô
(&
ö
, 
fd
, 
	`mÆloc
(31), 31);

34 
	`ok1
(
ö
.
fd
 == fd);

35 
	`ok1
(
ö
.
buf_íd
 - in.
buf
 == 31);

36 
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
NULL
);

37 
	`ok1
(
p
);

38 
	`ok1
(
	`°rcmp
(
p
, 
löes
[0]) == 0);

40 
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
ªÆloc
);

41 
	`ok1
(
p
);

42 
	`ok1
(
	`°rcmp
(
p
, 
löes
[1]) == 0);

44 
i
 = 2; 
löes
[i]; i++) {

45 
	`ok1
(
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
ªÆloc
));

46 
	`ok1
(
	`°rcmp
(
p
, 
löes
[
i
]) == 0);

49 
p
 = 
	`rbuf_ªad_°r
(&
ö
, '\n', 
ªÆloc
);

50 
	`ok1
(
î∫o
 == 0);

51 
	`ok1
(
p
 =
NULL
);

52 
	`‰ì
(
ö
.
buf
);

55 
	`l£ek
(
fd
, 
SEEK_SET
, 0);

56 
	`rbuf_öô
(&
ö
, 
fd
, 
NULL
, 0);

57 
p
 = 
	`rbuf_ªad_°r
(&
ö
, 0, 
ªÆloc
);

58 
	`ok1
(
p
);

59 
	`ok1
(
	`°æí
(
p
Ë=
Àn
);

61 
	`˛o£
(
fd
);

62 
p
 = 
	`rbuf_ªad_°r
(&
ö
, 0, 
ªÆloc
);

63 
	`ok1
(
î∫o
 =
EBADF
);

64 
	`ok1
(!
p
);

65 
	`‰ì
(
ö
.
buf
);

67  
	`exô_°©us
();

68 
	}
}

	@ccan/ccan/read_write_all/read_write_all.c

2 
	~"ªad_wrôe_Æl.h
"

3 
	~<uni°d.h
>

4 
	~<î∫o.h
>

6 
boﬁ
 
	$wrôe_Æl
(
fd
, c⁄° *
d©a
, 
size_t
 
size
)

8 
size
) {

9 
ssize_t
 
d⁄e
;

11 
d⁄e
 = 
	`wrôe
(
fd
, 
d©a
, 
size
);

12 i‡(
d⁄e
 < 0 && 
î∫o
 =
EINTR
)

14 i‡(
d⁄e
 <= 0)

15  
Ál£
;

16 
d©a
 = (c⁄° *)d©®+ 
d⁄e
;

17 
size
 -
d⁄e
;

20  
åue
;

21 
	}
}

23 
boﬁ
 
	$ªad_Æl
(
fd
, *
d©a
, 
size_t
 
size
)

25 
size
) {

26 
ssize_t
 
d⁄e
;

28 
d⁄e
 = 
	`ªad
(
fd
, 
d©a
, 
size
);

29 i‡(
d⁄e
 < 0 && 
î∫o
 =
EINTR
)

31 i‡(
d⁄e
 <= 0)

32  
Ál£
;

33 
d©a
 = (*)d©®+ 
d⁄e
;

34 
size
 -
d⁄e
;

37  
åue
;

38 
	}
}

	@ccan/ccan/read_write_all/read_write_all.h

2 #i‚de‡
_CCAN_READ_WRITE_H


3 
	#_CCAN_READ_WRITE_H


	)

4 
	~<°ddef.h
>

5 
	~<°dboﬁ.h
>

7 
boﬁ
 
wrôe_Æl
(
fd
, c⁄° *
d©a
, 
size_t
 
size
);

8 
boﬁ
 
ªad_Æl
(
fd
, *
d©a
, 
size_t
 
size
);

	@ccan/ccan/read_write_all/test/run-read_all.c

3 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

4 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~<uni°d.h
>

7 
	~<sys/ty≥s.h
>

8 
	~<sig«l.h
>

9 
	~<sys/waô.h
>

10 
	~<limôs.h
>

11 
	~<îr.h
>

12 
	~<°dlib.h
>

13 
	~<°rög.h
>

15 vﬁ©ûê
	gsigcou¡
;

16 
	gp2c
[2], 
	gc2p
[2];

17 
	$gŸ_sig«l
(
sig
)

19 
c
 = 0;

20 i‡(
	`wrôe
(
p2c
[1], &
c
, 1) == 1)

21 
sigcou¡
++;

22 
	}
}

25 
	#BUFSZ
 (1024*1024)

	)

27 
	$maö
(
¨gc
, *
¨gv
[])

29 *
buf„r
;

30 
c
 = 0;

31 
°©us
;

32 
pid_t
 
chûd
;

34 
buf„r
 = 
	`ˇŒoc
(
BUFSZ
, 2);

35 
	`∂™_ã°s
(6);

38 i‡(
	`pùe
(
p2c
Ë!0 ||Öùe(
c2p
) != 0)

39 
	`îr
(1, "pipe");

40 
chûd
 = 
	`f‹k
();

42 i‡(!
chûd
) {

43 
	`˛o£
(
p2c
[1]);

44 
	`˛o£
(
c2p
[0]);

46 i‡(
	`ªad
(
p2c
[0], &
c
, 1) != 1)

47 
	`exô
(1);

48 
	`mem£t
(
buf„r
, 0xff, 
BUFSZ
*2);

49 i‡(!
	`wrôe_Æl
(
c2p
[1], 
buf„r
, 
BUFSZ
))

50 
	`exô
(2);

51 i‡(
	`kûl
(
	`gëµid
(), 
SIGUSR1
) != 0)

52 
	`exô
(3);

54 i‡(
	`ªad
(
p2c
[0], &
c
, 1) != 1)

55 
	`exô
(4);

56 i‡(
	`wrôe
(
c2p
[1], 
buf„r
, 
BUFSZ
) != BUFSZ)

57 
	`exô
(5);

58 
	`exô
(0);

60 i‡(
chûd
 == -1)

61 
	`îr
(1, "forking");

63 
	`˛o£
(
p2c
[0]);

64 
	`˛o£
(
c2p
[1]);

65 
	`sig«l
(
SIGUSR1
, 
gŸ_sig«l
);

66 
	`ok1
(
	`wrôe
(
p2c
[1], &
c
, 1) == 1);

67 
	`ok1
(
	`ªad_Æl
(
c2p
[0], 
buf„r
, 
BUFSZ
*2));

68 
	`ok1
(
	`memchr
(
buf„r
, 0, 
BUFSZ
*2Ë=
NULL
);

69 
	`ok1
(
sigcou¡
 == 1);

70 
	`ok1
(
	`waô
(&
°©us
Ë=
chûd
);

71 
	`ok
(
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(status) == 0,

73 
	`WIFEXITED
(
°©us
), 
	`WEXITSTATUS
(status));

74 
	`‰ì
(
buf„r
);

75  
	`exô_°©us
();

76 
	}
}

	@ccan/ccan/read_write_all/test/run-write_all.c

1 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<uni°d.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sig«l.h
>

6 
	~<limôs.h
>

7 
	~<sys/waô.h
>

8 
	~<îr.h
>

9 
	~<°dlib.h
>

10 
	~<°rög.h
>

11 
	~<°dio.h
>

13 
ssize_t
 
ã°_wrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
);

14 
	#wrôe
 
ã°_wrôe


	)

15 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.c
>

16 #unde‡
wrôe


18 
ssize_t
 
	gwrôe_ªtu∫
;

20 
ssize_t
 
	$ã°_wrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
)

22 i‡(
wrôe_ªtu∫
 == 0) {

23 
î∫o
 = 
ENOSPC
;

27 i‡(
wrôe_ªtu∫
 < 0) {

28 
î∫o
 = -
wrôe_ªtu∫
;

30 i‡(
î∫o
 =
EINTR
)

31 
wrôe_ªtu∫
 = 
cou¡
;

35 i‡(
wrôe_ªtu∫
 < 
cou¡
)

36  
wrôe_ªtu∫
;

37  
cou¡
;

38 
	}
}

40 
	#BUFSZ
 1024

	)

42 
	$maö
(
¨gc
, *
¨gv
[])

44 *
buf„r
;

46 
buf„r
 = 
	`mÆloc
(
BUFSZ
);

47 
	`∂™_ã°s
(8);

49 
wrôe_ªtu∫
 = -
ENOSPC
;

50 
	`ok1
(!
	`wrôe_Æl
(100, 
buf„r
, 
BUFSZ
));

51 
	`ok1
(
î∫o
 =
ENOSPC
);

53 
wrôe_ªtu∫
 = -
EINTR
;

54 
	`ok1
(
	`wrôe_Æl
(100, 
buf„r
, 
BUFSZ
));

55 
	`ok1
(
î∫o
 =
EINTR
);

57 
wrôe_ªtu∫
 = 1;

58 
î∫o
 = 0;

59 
	`ok1
(
	`wrôe_Æl
(100, 
buf„r
, 
BUFSZ
));

60 
	`ok1
(
î∫o
 == 0);

62 
wrôe_ªtu∫
 = 
BUFSZ
;

63 
	`ok1
(
	`wrôe_Æl
(100, 
buf„r
, 
BUFSZ
));

64 
	`ok1
(
î∫o
 == 0);

65 
	`‰ì
(
buf„r
);

67  
	`exô_°©us
();

68 
	}
}

	@ccan/ccan/rfc822/examples/headernames.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<°d¨g.h
>

4 
	~<°rög.h
>

6 
	~<î∫o.h
>

7 
	~<uni°d.h
>

9 
	~<cˇn/èŒoc/èŒoc.h
>

10 
	~<cˇn/gøb_fûe/gøb_fûe.h
>

11 
	~<cˇn/rfc822/rfc822.h
>

13 
	$¥o˚ss_fûe
(c⁄° *
«me
)

15 *
˘x
 = 
	`èŒoc_√w
(
NULL
);

16 
size_t
 
size
;

17 *
buf
;

18 
rfc822_msg
 *
msg
;

19 
rfc822_hódî
 *
hdr
;

21 
buf
 = 
	`gøb_fûe
(
˘x
, 
«me
, &
size
);

23 
msg
 = 
	`rfc822_°¨t
(
˘x
, 
buf
, 
size
);

25 
	`rfc822_f‹_óch_hódî
(
msg
, 
hdr
) {

26 
byã°rög
 
h«me
 = 
	`rfc822_hódî_øw_«me
(
msg
, 
hdr
);

28 
	`¥ötf
("%.*s\n", 
h«me
.
Àn
, h«me.
±r
);

31 
	`èŒoc_‰ì
(
˘x
);

32 
	}
}

34 
	$maö
(
¨gc
, *
¨gv
[])

36 
i
;

38 
i
 = 0; i < (
¨gc
 - 1); i++)

39 
	`¥o˚ss_fûe
(
¨gv
[
i
 + 1]);

41 
	`exô
(0);

42 
	}
}

	@ccan/ccan/rfc822/rfc822.c

3 
	~"c⁄fig.h
"

5 
	~<°rög.h
>

7 
	~<cˇn/°r/°r.h
>

8 
	~<cˇn/li°/li°.h
>

9 
	~<°dio.h
>

11 
	~<cˇn/rfc822/rfc822.h
>

13 #ifde‡
TAL_USE_TALLOC


14 
	~<cˇn/èl/èŒoc/èŒoc.h
>

16 
	~<cˇn/èl/èl.h
>

19 #i‡!
HAVE_MEMMEM


20 *
	$memmem
(c⁄° *
hay°ack
, 
size_t
 
hay°ackÀn
,

21 c⁄° *
√edÀ
, 
size_t
 
√edÀÀn
)

23 c⁄° *
p
, *
œ°
;

25 
p
 = 
hay°ack
;

26 
œ°
 = 
p
 + 
hay°ackÀn
 - 
√edÀÀn
;

29 i‡(
	`memcmp
(
p
, 
√edÀ
, 
√edÀÀn
) == 0)

30  (*)
p
;

31 } 
p
++ <
œ°
);

33  
NULL
;

34 
	}
}

37 (*
Æloˇti⁄_Áûuª_hook
)(const *);

39 
NORETURN
 
	$deÁu…_Æloˇti⁄_Áûuª
(c⁄° *
s
)

41 
	`Ârötf
(
°dîr
, "cˇn/rfc822: AŒoˇti⁄ faûuª: %s", 
s
);

42 
	`ab‹t
();

43 
	}
}

45 
	$Æloˇti⁄_Áûuª
(c⁄° *
s
)

47 i‡(
Æloˇti⁄_Áûuª_hook
)

48 (*
Æloˇti⁄_Áûuª_hook
)(
s
);

50 
	`deÁu…_Æloˇti⁄_Áûuª
(
s
);

51 
	}
}

53 
rfc822_£t_Æloˇti⁄_Áûuª_h™dÀr
((*
h
)(const *))

55 
Æloˇti⁄_Áûuª_hook
 = 
h
;

56 
	}
}

58 
	#ALLOC_CHECK
(
p
, 
r
) \

60 i‡(!(
p
)) { \

61 
	`Æloˇti⁄_Áûuª
(
__FILE__
 ":" 
	`°rögify
(
__LINE__
)); \

62  (
r
); \

64 } 0)

	)

71 
	#INDEX_HASH_SIZE
 63

	)

73 
	srfc822_msg
 {

74 c⁄° *
	md©a
, *
	míd
;

75 c⁄° *
	mªmaödî
;

76 
li°_hód
 
	mhódîs
;

77 
li°_hód
 
	mhódî_ödex
[
INDEX_HASH_SIZE
];

78 c⁄° *
	mbody
;

81 
	srfc822_hódî
 {

82 
byã°rög
 
	mÆl
, 
	møw«me
, 
	møwvÆue
;

83 
byã°rög
 
	munfﬁded
;

84 
li°_node
 
	mli°
;

85 
rfc822_hódî
 *
	m«me_√xt
;

88 
	srfc822_hódîs_of_«me
 {

89 
byã°rög
 
	m«me
;

90 
rfc822_hódî
 *
	mfú°
;

91 
rfc822_hódî
 **
	mœ°±r
;

92 
li°_node
 
	mbuckë
;

95 
rfc822_msg
 *
	$rfc822_check
(c⁄° 
rfc822_msg
 *
msg
,

96 c⁄° *
ab‹t°r
)

98 
	`as£π
(
msg
);

99 i‡(!
	`li°_check
(&
msg
->
hódîs
, 
ab‹t°r
))

100  
NULL
;

101 i‡(!
	`èl_check
(
msg
, 
ab‹t°r
))

102  
NULL
;

103  (
rfc822_msg
 *)
msg
;

104 
	}
}

106 #ifde‡
CCAN_RFC822_DEBUG


107 
	#CHECK
(
msg
, 
°r
Ëdÿ{ 
	`rfc822_check
((msg), (°r)); } 0)

	)

109 
	#CHECK
(
msg
, 
°r
Ëdÿ{ } 0)

	)

112 
rfc822_msg
 *
	$rfc822_°¨t
(c⁄° *
˘x
, c⁄° *
p
, 
size_t
 
Àn
)

114 
rfc822_msg
 *
msg
;

115 
i
;

117 
msg
 = 
	`èl
(
˘x
, 
rfc822_msg
);

118 
	`ALLOC_CHECK
(
msg
, 
NULL
);

120 
msg
->
d©a
 = 
p
;

121 
msg
->
íd
 = 
p
 + 
Àn
;

123 
msg
->
ªmaödî
 = msg->
d©a
;

124 
msg
->
body
 = 
NULL
;

126 
	`li°_hód_öô
(&
msg
->
hódîs
);

128 
i
 = 0; i < 
INDEX_HASH_SIZE
; i++)

129 
	`li°_hód_öô
(&
msg
->
hódî_ödex
[
i
]);

131 
	`CHECK
(
msg
, "<rfc22_start");

133  
msg
;

134 
	}
}

136 
	$rfc822_‰ì
(
rfc822_msg
 *
msg
)

138 
	`CHECK
(
msg
, ">rfc822_free");

139 
	`èl_‰ì
(
msg
);

140 
	}
}

142 
rfc822_hódî
 *
	$√xt_hódî_ˇched
(
rfc822_msg
 *
msg
,

143 
rfc822_hódî
 *
hdr
)

145 
li°_node
 *
h
 = &
msg
->
hódîs
.
n
;

146 c⁄° 
li°_node
 *
n
 = 
h
;

148 
	`CHECK
(
msg
, ">next_header_cached");

150 i‡(
hdr
)

151 
n
 = &
hdr
->
li°
;

153 i‡(
n
->
√xt
 =
h
)

154  
NULL
;

156 
	`CHECK
(
msg
, "<next_header_cached");

158  
	`li°_íåy
(
n
->
√xt
, 
rfc822_hódî
, 
li°
);

159 
	}
}

161 c⁄° *
	$√xt_löe
(c⁄° *
°¨t
, c⁄° *
íd
)

163 c⁄° *
p
 = 
	`memchr
(
°¨t
, '\n', 
íd
 - start);

165  
p
 ? (∞+ 1Ë: 
íd
;

166 
	}
}

168 
rfc822_hódî
 *
ödex_hódî
(
rfc822_msg
 *
msg
,

169 
rfc822_hódî
 *
hdr
);

171 
rfc822_hódî
 *
	$√xt_hódî_∑r£
(
rfc822_msg
 *
msg
)

173 c⁄° *
h
, *
eh
, *
ev
, *
cﬁ⁄
;

174 
rfc822_hódî
 *
hi
;

176 
	`CHECK
(
msg
, ">next_header_parse");

178 i‡(!
msg
->
ªmaödî
)

179  
NULL
;

181 i‡(
msg
->
body
 && (msg->
ªmaödî
 >= msg->body))

182  
NULL
;

184 
h
 = 
msg
->
ªmaödî
;

185 
eh
 = 
	`√xt_löe
(
h
, 
msg
->
íd
);

187 
ev
 = 
eh
;

188 i‡((
ev
 > 
h
) && (ev[-1] == '\n'))

189 
ev
--;

190 i‡((
ev
 > 
h
) && (ev[-1] == '\r'))

191 
ev
--;

192 i‡(
ev
 =
h
) {

195 
	`as£π
(!
msg
->
body
 || (msg->body =
eh
));

197 i‡(
eh
 < 
msg
->
íd
)

198 
msg
->
body
 = 
eh
;

199  
NULL
;

202 (
eh
 < 
msg
->
íd
Ë&& 
	`rfc822_isw•
(*eh))

203 
eh
 = 
	`√xt_löe
”h, 
msg
->
íd
);

205 i‡(
eh
 >
msg
->
íd
)

206 
msg
->
ªmaödî
 = 
NULL
;

208 
msg
->
ªmaödî
 = 
eh
;

211 
hi
 = 
	`èlz
(
msg
, 
rfc822_hódî
);

212 
	`ALLOC_CHECK
(
hi
, 
NULL
);

214 
hi
->
Æl
 = 
	`byã°rög
(
h
, 
eh
 - h);

215 
	`li°_add_èû
(&
msg
->
hódîs
, &
hi
->
li°
);

217 
cﬁ⁄
 = 
	`memchr
(
h
, ':', 
hi
->
Æl
.
Àn
);

218 i‡(
cﬁ⁄
) {

219 
hi
->
øw«me
 = 
	`byã°rög
(
h
, 
cﬁ⁄
 - h);

220 
hi
->
øwvÆue
 = 
	`byã°rög
(
cﬁ⁄
 + 1, 
eh
 - colon - 1);

222 
hi
->
øw«me
 = 
byã°rög_NULL
;

223 
hi
->
øwvÆue
 = 
byã°rög_NULL
;

226 
	`CHECK
(
msg
, "<next_header_parse");

228  
	`ödex_hódî
(
msg
, 
hi
);

229 
	}
}

231 
rfc822_hódî
 *
	$rfc822_√xt_hódî
(
rfc822_msg
 *
msg
,

232 
rfc822_hódî
 *
hdr
)

234 
rfc822_hódî
 *
h
;

236 
	`CHECK
(
msg
, ">rfc822_next_header");

238 
h
 = 
	`√xt_hódî_ˇched
(
msg
, 
hdr
);

239 i‡(
h
)

240  
h
;

242  
	`√xt_hódî_∑r£
(
msg
);

243 
	}
}

245 
byã°rög
 
	$rfc822_body
(
rfc822_msg
 *
msg
)

247 
	`CHECK
(
msg
, ">rfc822_body");

249 i‡(!
msg
->
body
 && msg->
ªmaödî
) {

250 c⁄° *
p
, *
q
;

252 
p
 = 
	`memmem
(
msg
->
ªmaödî
, msg->
íd
 - msg->remainder,

254 
q
 = 
	`memmem
(
msg
->
ªmaödî
, msg->
íd
 - msg->remainder,

257 i‡(
p
 && (!
q
 || (p < q)))

258 
msg
->
body
 = 
p
 + 3;

259 i‡(
q
 && (!
p
 || (q <Ö)))

260 
msg
->
body
 = 
q
 + 2;

262 i‡(
msg
->
body
 >msg->
íd
) {

263 
	`as£π
(
msg
->
body
 =msg->
íd
);

264 
msg
->
body
 = 
NULL
;

268 
	`CHECK
(
msg
, "<rfc822_body");

270 i‡(
msg
->
body
)

271  
	`byã°rög
(
msg
->
body
, msg->
íd
 - msg->body);

273  
byã°rög_NULL
;

274 
	}
}

276 
rfc822_hódî_îr‹s
 
	$rfc822_hódî_îr‹s
(
rfc822_msg
 *
msg
,

277 
rfc822_hódî
 *
hdr
)

279 
rfc822_hódî_îr‹s
 
îr
 = 0;

280 
i
;

282 i‡(!
hdr
->
øw«me
.
±r
) {

283 
îr
 |
RFC822_HDR_NO_COLON
;

285 
i
 = 0; i < 
hdr
->
øw«me
.
Àn
; i++) {

286 
c
 = 
hdr
->
øw«me
.
±r
[
i
];

288 
	`as£π
(
c
 != ':');

290 i‡((
c
 < 33) || (c > 126)) {

291 
îr
 |
RFC822_HDR_BAD_NAME_CHARS
;

296  
îr
;

297 
	}
}

299 
byã°rög
 
	$rfc822_hódî_øw_c⁄ã¡
(
rfc822_msg
 *
msg
,

300 
rfc822_hódî
 *
hdr
)

302  
hdr
->
Æl
;

303 
	}
}

305 
byã°rög
 
	$rfc822_hódî_øw_«me
(
rfc822_msg
 *
msg
,

306 
rfc822_hódî
 *
hdr
)

308  
hdr
->
øw«me
;

309 
	}
}

311 
byã°rög
 
	$rfc822_hódî_øw_vÆue
(
rfc822_msg
 *
msg
,

312 
rfc822_hódî
 *
hdr
)

314  
hdr
->
øwvÆue
;

315 
	}
}

317 
	$gë_löe
(
byã°rög
 
ö
, byã°rög *
fú°
,

318 
byã°rög
 *
ª°
)

320 
size_t
 
øwÀn
, 
åimÀn
;

321 c⁄° *
öp
 = 
ö
.
±r
;

322 c⁄° *
∆
;

324 
∆
 = 
	`memchr
(
öp
, '\n', 
ö
.
Àn
);

325 i‡(!
∆
)

326 
øwÀn
 = 
ö
.
Àn
;

328 
øwÀn
 = 
∆
 - 
öp
 + 1;

330 
åimÀn
 = 
øwÀn
;

331 i‡((
åimÀn
 > 0Ë&& (
öp
[trimlen-1] == '\n')) {

332 
åimÀn
--;

333 i‡((
åimÀn
 > 0Ë&& (
öp
[trimlen-1] == '\r'))

334 
åimÀn
--;

337 *
fú°
 = 
	`byã°rög
(
ö
.
±r
, 
åimÀn
);

339 i‡(
øwÀn
 < 
ö
.
Àn
)

340 *
ª°
 = 
	`byã°rög
(
ö
.
±r
 + 
øwÀn
, in.
Àn
 -Ñawlen);

342 *
ª°
 = 
byã°rög_NULL
;

343 
	}
}

346 
byã°rög
 
	$rfc822_hódî_unfﬁded_vÆue
(
rfc822_msg
 *
msg
,

347 
rfc822_hódî
 *
hdr
)

349 
byã°rög
 
øw
 = 
	`rfc822_hódî_øw_vÆue
(
msg
, 
hdr
);

350 
byã°rög
 
√xt
, 
ª°
;

351 
löes
 = 0;

352 
size_t
 
Àn
 = 0;

354 i‡(!
hdr
->
unfﬁded
.
±r
) {

355 
ª°
 = 
øw
;

356 
ª°
.
±r
) {

357 
	`gë_löe
(
ª°
, &
√xt
, &rest);

358 
löes
++;

359 
Àn
 +
√xt
.len;

362 i‡(
löes
 <= 1) {

363 
hdr
->
unfﬁded
 = 
	`byã°rög
(
øw
.
±r
, 
Àn
);

365 *
unfﬁd
 = 
	`èl_¨r
(
msg
, , 
Àn
);

366 *
p
 = 
unfﬁd
;

368 
	`ALLOC_CHECK
(
unfﬁd
, 
byã°rög_NULL
);

370 
ª°
 = 
øw
;

371 
ª°
.
±r
) {

372 
	`gë_löe
(
ª°
, &
√xt
, &rest);

373 
	`mem˝y
(
p
, 
√xt
.
±r
,Çext.
Àn
);

374 
p
 +
√xt
.
Àn
;

377 
	`as£π
(
p
 =(
unfﬁd
 + 
Àn
));

378 
hdr
->
unfﬁded
 = 
	`byã°rög
(
unfﬁd
, 
Àn
);

382  
hdr
->
unfﬁded
;

383 
	}
}

387 
	$xtﬁowî
(
c
)

389 i‡((
c
 >= 'A') && (c <= 'Z'))

390  'a' + (
c
 - 'A');

392  
c
;

393 
	}
}

395 
boﬁ
 
	$hdr_«me_eq
(
byã°rög
 
a
, byã°rög 
b
)

397 
i
;

399 i‡(
a
.
Àn
 !
b
.len)

400  
Ál£
;

402 
i
 = 0; i < 
a
.
Àn
; i++)

403 i‡(
	`xtﬁowî
(
a
.
±r
[
i
]Ë!xtﬁowî(
b
.ptr[i]))

404  
Ál£
;

406  
åue
;

407 
	}
}

409 
boﬁ
 
	$rfc822_hódî_is
(
rfc822_msg
 *
msg
, 
rfc822_hódî
 *
hdr
,

410 c⁄° *
«me
)

412 
byã°rög
 
h«me
 = 
	`rfc822_hódî_øw_«me
(
msg
, 
hdr
);

414 i‡(!
h«me
.
±r
 || !
«me
)

415  
Ál£
;

417  
	`hdr_«me_eq
(
h«me
, 
	`byã°rög_‰om_°rög
(
«me
));

418 
	}
}

420 
	$hódîhash
(
byã°rög
 
«me
)

426 
ªt
 = 0;

427 
size_t
 
i
;

429 
i
 = 0; i < 
«me
.
Àn
; i++)

430 
ªt
 = (ªà<< 5Ë-Ñë + 
	`xtﬁowî
(
«me
.
±r
[
i
]);

432  
ªt
 % 
INDEX_HASH_SIZE
;

433 
	}
}

435 
rfc822_hódîs_of_«me
 *
	$hódîs_of_«me
(
rfc822_msg
 *
msg
,

436 
byã°rög
 
«me
)

438 
hash
 = 
	`hódîhash
(
«me
);

439 
rfc822_hódîs_of_«me
 *
hn
;

441 
	`li°_f‹_óch
(&
msg
->
hódî_ödex
[
hash
], 
hn
, 
buckë
) {

442 i‡(
	`hdr_«me_eq
(
hn
->
«me
,Çame))

443  
hn
;

446  
NULL
;

447 
	}
}

449 
rfc822_hódî
 *
	$ödex_hódî
(
rfc822_msg
 *
msg
,

450 
rfc822_hódî
 *
hdr
)

452 
byã°rög
 
h«me
 = 
	`rfc822_hódî_øw_«me
(
msg
, 
hdr
);

453 
rfc822_hódîs_of_«me
 *
hn
 = 
	`hódîs_of_«me
(
msg
, 
h«me
);

455 i‡(!
hn
) {

456 
hash
 = 
	`hódîhash
(
h«me
);

458 
hn
 = 
	`èlz
(
msg
, 
rfc822_hódîs_of_«me
);

459 
	`ALLOC_CHECK
(
hn
, 
NULL
);

461 
hn
->
«me
 = 
h«me
;

462 
hn
->
fú°
 = 
NULL
;

463 
hn
->
œ°±r
 = &hn->
fú°
;

464 
	`li°_add_èû
(&
msg
->
hódî_ödex
[
hash
], &
hn
->
buckë
);

467 
hdr
->
«me_√xt
 = 
NULL
;

468 *(
hn
->
œ°±r
Ë
hdr
;

469 
hn
->
œ°±r
 = &
hdr
->
«me_√xt
;

470  
hdr
;

471 
	}
}

473 
rfc822_hódî
 *
	$rfc822_fú°_hódî_of_«me
(
rfc822_msg
 *
msg
,

474 c⁄° *
«me
)

476 
byã°rög
 
«mebs
 = 
	`byã°rög_‰om_°rög
(
«me
);

477 
rfc822_hódîs_of_«me
 *
hn
 = 
	`hódîs_of_«me
(
msg
, 
«mebs
);

478 
rfc822_hódî
 *
hdr
;

480 i‡(
hn
)

481  
hn
->
fú°
;

484 
hdr
 = 
	`√xt_hódî_∑r£
(
msg
);

485 i‡(
hdr
 && 
	`rfc822_hódî_is
(
msg
, hdr, 
«me
))

486  
hdr
;

487 } 
hdr
);

489  
NULL
;

490 
	}
}

492 
rfc822_hódî
 *
	$rfc822_√xt_hódî_of_«me
(
rfc822_msg
 *
msg
,

493 
rfc822_hódî
 *
hdr
,

494 c⁄° *
«me
)

496 i‡(!
hdr
)

497  
	`rfc822_fú°_hódî_of_«me
(
msg
, 
«me
);

499 i‡(
hdr
->
«me_√xt
) {

500 
	`as£π
(
	`rfc822_hódî_is
(
msg
, 
hdr
->
«me_√xt
, 
«me
));

501  
hdr
->
«me_√xt
;

505 
hdr
 = 
	`√xt_hódî_∑r£
(
msg
);

506 i‡(
hdr
 && 
	`rfc822_hódî_is
(
msg
, hdr, 
«me
))

507  
hdr
;

508 } 
hdr
);

510  
NULL
;

511 
	}
}

	@ccan/ccan/rfc822/rfc822.h

2 #i‚de‡
CCAN_RFC822_H_


3 
	#CCAN_RFC822_H_


	)

5 
	~<°dlib.h
>

7 
	~<cˇn/byã°rög/byã°rög.h
>

11 
	grfc822_hódî
;

12 
	grfc822_msg
;

41 
rfc822_£t_Æloˇti⁄_Áûuª_h™dÀr
((*
h
)(const *));

44 
ölöe
 
boﬁ
 
	$rfc822_isw•
(
c
)

46  (
c
 == ' ') || (c == '\t');

47 
	}
}

62 
rfc822_msg
 *
rfc822_check
(c⁄° rfc822_msg *
msg
,

63 c⁄° *
ab‹t°r
);

75 
rfc822_msg
 *
rfc822_°¨t
(c⁄° *
˘x
, c⁄° *
p
, 
size_t
 
Àn
);

84 
rfc822_‰ì
(
rfc822_msg
 *
msg
);

93 
	#rfc822_fú°_hódî
(
msg
Ë(
	`rfc822_√xt_hódî
((msg), 
NULL
))

	)

104 
rfc822_hódî
 *
rfc822_√xt_hódî
(
rfc822_msg
 *
msg
,

105 
rfc822_hódî
 *
hdr
);

107 
	#rfc822_f‹_óch_hódî
(
msg
, 
hdr
) \

108 (
hdr
Ë
	`rfc822_fú°_hódî
((
msg
)); \

109 (
hdr
); \

110 (
hdr
Ë
	`rfc822_√xt_hódî
((
msg
), (hdr)))

	)

119 
byã°rög
 
rfc822_body
(
rfc822_msg
 *
msg
);

121 
	erfc822_hódî_îr‹s
 {

122 
	mRFC822_HDR_NO_COLON
 = 1,

123 
	mRFC822_HDR_BAD_NAME_CHARS
 = 2,

126 
rfc822_hódî_îr‹s
Ñfc822_hódî_îr‹s(
rfc822_msg
 *
msg
,

127 
rfc822_hódî
 *
hdr
);

137 
byã°rög
 
rfc822_hódî_øw_c⁄ã¡
(
rfc822_msg
 *
msg
,

138 
rfc822_hódî
 *
hdr
);

149 
byã°rög
 
rfc822_hódî_øw_«me
(
rfc822_msg
 *
msg
,

150 
rfc822_hódî
 *
hdr
);

160 
byã°rög
 
rfc822_hódî_øw_vÆue
(
rfc822_msg
 *
msg
,

161 
rfc822_hódî
 *
hdr
);

171 
byã°rög
 
rfc822_hódî_unfﬁded_vÆue
(
rfc822_msg
 *
msg
,

172 
rfc822_hódî
 *
hdr
);

183 
boﬁ
 
rfc822_hódî_is
(
rfc822_msg
 *
msg
, 
rfc822_hódî
 *
hdr
,

184 c⁄° *
«me
);

186 
rfc822_hódî
 *
rfc822_fú°_hódî_of_«me
(
rfc822_msg
 *
msg
,

187 c⁄° *
«me
);

188 
rfc822_hódî
 *
rfc822_√xt_hódî_of_«me
(
rfc822_msg
 *
msg
,

189 
rfc822_hódî
 *
hdr
,

190 c⁄° *
«me
);

	@ccan/ccan/rfc822/test/helper.c

1 
	~<°dlib.h
>

2 
	~<°dio.h
>

4 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

5 
	~<cˇn/Áûã°/Áûã°.h
>

7 
	~<cˇn/rfc822/rfc822.h
>

9 
	~"hñ≥r.h
"

13 #i‚de‡
TAL_USE_TALLOC


14 *
	$mÆloc_wøµî
(
size_t
 
size
)

16  
	`mÆloc
(
size
);

17 
	}
}

19 
	$‰ì_wøµî
(*
±r
)

21 
	`‰ì
(
±r
);

22 
	}
}

24 *
	$ªÆloc_wøµî
(*
±r
, 
size_t
 
size
)

26  
	`ªÆloc
(
±r
, 
size
);

27 
	}
}

31 
	$Æloˇti⁄_Áûuª_exô
(c⁄° *
s
)

33 
	`Ârötf
(
°dîr
, "AŒoˇti⁄ faûuª: %s", 
s
);

34 
	`exô
(0);

35 
	}
}

38 
boﬁ
 
	gÆloˇti⁄_Áûed
 = 
Ál£
;

40 
	$Æloˇti⁄_Áûuª_c⁄töue
(c⁄° *
s
)

42 
	`Ârötf
(
°dîr
, "AŒoˇti⁄ faûuª: %s", 
s
);

43 
Æloˇti⁄_Áûed
 = 
åue
;

44 
	}
}

46 
	$Æloˇti⁄_Áûuª_check
()

48 i‡(
Æloˇti⁄_Áûed
) {

49 
	`Ârötf
(
°dîr
, "Exiting dueÅoÉarlier failedállocation\n");

50 
	`exô
(0);

52 
	}
}

54 #ifde‡
TAL_USE_TALLOC


55 
	~<cˇn/èl/èŒoc/èŒoc.h
>

57 
	~<cˇn/èl/èl.h
>

61 
	$nﬂb‹t_wøµî
(c⁄° *
why
)

64 
	}
}

66 
	$Áûã°_£tup
(
¨gc
, *
¨gv
[])

68 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

69 
	`rfc822_£t_Æloˇti⁄_Áûuª_h™dÀr
(
Æloˇti⁄_Áûuª_c⁄töue
);

70 #ifde‡
TAL_USE_TALLOC


72 
	`èl_£t_backíd
(
NULL
, NULL, NULL, 
nﬂb‹t_wøµî
);

74 
	`èl_£t_backíd
(
mÆloc_wøµî
, 
ªÆloc_wøµî
, 
‰ì_wøµî
,

75 
nﬂb‹t_wøµî
);

77 
	}
}

79 
	$check_hódî
(
rfc822_msg
 *
msg
,

80 
rfc822_hódî
 *
h
,

81 c⁄° *
«me
, c⁄° *
vÆ
,

82 
rfc822_hódî_îr‹s
 
ex≥º
, 
¸lf
)

84 
rfc822_hódî_îr‹s
 
îrs
;

85 
byã°rög
 
h«me
, 
hvÆue
, 
hfuŒ
;

86 
size_t
 
«mñí
 = 
	`°æí
(
«me
);

87 
size_t
 
vÆuñí
 = 
	`°æí
(
vÆ
);

88 
size_t
 
∆n
 = 
¸lf
 ? 2 : 1;

89 
size_t
 
fuŒÀn
 = 
«mñí
 + 
vÆuñí
 + 1 + 
∆n
;

91 
îrs
 = 
	`rfc822_hódî_îr‹s
(
msg
, 
h
);

92 
	`ok
(
îrs
 =
ex≥º
, "HeaderÉrrors 0x%x != 0x%x",Érrs,Éxperr);

93 
	`Æloˇti⁄_Áûuª_check
();

95 
h«me
 = 
	`rfc822_hódî_øw_«me
(
msg
, 
h
);

96 
	`Æloˇti⁄_Áûuª_check
();

98 
	`ok
(
h«me
.
±r
 && 
	`byã°rög_eq
(h«me, 
	`byã°rög_‰om_°rög
(
«me
)),

99 "HódîÇamê\"%.*s\"", ()
h«me
.
Àn
, h«me.
±r
);

101 
hvÆue
 = 
	`rfc822_hódî_øw_vÆue
(
msg
, 
h
);

102 
	`Æloˇti⁄_Áûuª_check
();

104 
	`ok
(
hvÆue
.
±r
 && ((
vÆuñí
 + 
∆n
Ë=hvÆue.
Àn
)

105 && (
	`memcmp
(
vÆ
, 
hvÆue
.
±r
, 
vÆuñí
) == 0)

106 && (!
¸lf
 || (
hvÆue
.
±r
[hvÆue.
Àn
 - 2] == '\r'))

107 && (
hvÆue
.
±r
[hvÆue.
Àn
 - 1] == '\n'),

110 
hfuŒ
 = 
	`rfc822_hódî_øw_c⁄ã¡
(
msg
, 
h
);

111 
	`Æloˇti⁄_Áûuª_check
();

113 
	`ok
(
hfuŒ
.
±r
 && (
fuŒÀn
 =hfuŒ.
Àn
)

114 && (
	`memcmp
(
«me
, 
hfuŒ
.
±r
, 
«mñí
) == 0)

115 && (
hfuŒ
.
±r
[
«mñí
] == ':')

116 && (
	`memcmp
(
vÆ
, 
hfuŒ
.
±r
 + 
«mñí
 + 1, 
vÆuñí
) == 0)

117 && (!
¸lf
 || (
hfuŒ
.
±r
[
fuŒÀn
-2] == '\r'))

118 && (
hfuŒ
.
±r
[
fuŒÀn
-1] == '\n'),

120 
	}
}

	@ccan/ccan/rfc822/test/helper.h

1 
	~<cˇn/èp/èp.h
>

3 
Áûã°_£tup
(
¨gc
, *
¨gv
[]);

4 
Æloˇti⁄_Áûuª_check
();

6 
	#CHECK_HEADER_NUMTESTS
 4

	)

7 
check_hódî
(
rfc822_msg
 *
msg
, 
rfc822_hódî
 *
h
,

8 c⁄° *
«me
, c⁄° *
vÆ
,

9 
rfc822_hódî_îr‹s
 
ex≥º
, 
¸lf
);

	@ccan/ccan/rfc822/test/run-bad-header-name-chars.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

3 
	~<cˇn/Áûã°/Áûã°.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 
	#CCAN_RFC822_DEBUG


	)

10 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

15 
	~"hñ≥r.h
"

17 
	#NAME_TEMPLATE
 "X-Bad-Hódî"

	)

18 
	#NAME_TEMPLATE_LEN
 (
	`°æí
(
NAME_TEMPLATE
))

	)

20 c⁄° 
	gbad_«me_ãm∂©e
[] =

21 
NAME_TEMPLATE
 ": This isá good headerÅhat will become bad\n";

23 
boﬁ
 
	$bad_«me
(c⁄° *
buf
, 
c
)

25 
rfc822_msg
 *
msg
;

26 
rfc822_hódî
 *
hdr
;

27 
rfc822_hódî_îr‹s
 
îrs
;

28 
byã°rög
 
h«me
;

30 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
	`°æí
(buf));

32 
	`Æloˇti⁄_Áûuª_check
();

34 
hdr
 = 
	`rfc822_fú°_hódî
(
msg
);

35 
	`ok1
(
hdr
);

37 
	`Æloˇti⁄_Áûuª_check
();

39 
îrs
 = 
	`rfc822_hódî_îr‹s
(
msg
, 
hdr
);

41 
	`Æloˇti⁄_Áûuª_check
();

43 
	`ok1
(!(
îrs
 & ~
RFC822_HDR_BAD_NAME_CHARS
));

46 
h«me
 = 
	`rfc822_hódî_øw_«me
(
msg
, 
hdr
);

48 
	`Æloˇti⁄_Áûuª_check
();

50 
	`ok1
(
h«me
.
±r
 && h«me.
Àn
 =
NAME_TEMPLATE_LEN
);

51 
	`ok1
((
h«me
.
±r
[0] =
c
) &&

52 (
	`memcmp
(
h«me
.
±r
 + 1, 
NAME_TEMPLATE
 + 1, 
NAME_TEMPLATE_LEN
 - 1) == 0));

54 
	`rfc822_‰ì
(
msg
);

56 
	`Æloˇti⁄_Áûuª_check
();

58  !!(
îrs
 & 
RFC822_HDR_BAD_NAME_CHARS
);

59 
	}
}

61 
	$maö
(
¨gc
, *
¨gv
[])

63 
c
;

65 
	`Áûã°_£tup
(
¨gc
, 
¨gv
);

67 
	`∂™_ã°s
(5 * (1 + 3 + 4));

69 
	`ok1
(!
	`bad_«me
(
bad_«me_ãm∂©e
, bad_name_template[0]));

72 
	`f‹óch_öt
(
c
, 'a', 'Z', '3') {

73 *
tmp
 = 
	`°rdup
(
bad_«me_ãm∂©e
);

75 
tmp
[0] = 
c
;

77 
	`ok1
(!
	`bad_«me
(
tmp
, 
c
));

79 
	`‰ì
(
tmp
);

83 
	`f‹óch_öt
(
c
, ' ', '\t', '\b', '\x80') {

84 *
tmp
 = 
	`°rdup
(
bad_«me_ãm∂©e
);

86 
tmp
[0] = 
c
;

88 
	`ok1
(
	`bad_«me
(
tmp
, 
c
));

90 
	`‰ì
(
tmp
);

94 
	`Áûã°_exô
(
	`exô_°©us
());

95 
	}
}

	@ccan/ccan/rfc822/test/run-check-check.c

1 
	~<cˇn/èp/èp.h
>

2 
	~<°dlib.h
>

3 
	~<°rög.h
>

5 
	~<sig«l.h
>

6 
	~<î∫o.h
>

8 
	#CCAN_RFC822_DEBUG


	)

10 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

16 
	$m™gÀ_li°
(
rfc822_msg
 *
msg
)

18 
msg
->
hódîs
.
n
.
¥ev
 = 
NULL
;

19 
	}
}

21 
	$maö
(
¨gc
, *
¨gv
[])

23 (*
m™gÀr
)(
rfc822_msg
 *
msg
);

25 
	`∂™_ã°s
(3 * 1);

27 
	`f‹óch_±r
(
m™gÀr
, 
m™gÀ_li°
) {

28 c⁄° *
buf
;

29 
size_t
 
Àn
;

30 
rfc822_msg
 *
msg
, *
check
;

32 
buf
 = 
	`as£mbÀ_msg
(&
ã°_msg_1
, &
Àn
, 0);

34 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

35 
	`Ârötf
(
°dîr
, "msg = %p\n", 
msg
);

37 
	`ok1
(
msg
 !
NULL
);

39 (Ë
	`rfc822_√xt_hódî
(
msg
, 
NULL
);

41 
check
 = 
	`rfc822_check
(
msg
, 
NULL
);

42 
	`Ârötf
(
°dîr
, "check = %∞(1)\n", 
check
);

43 
	`ok1
(
check
 =
msg
);

45 
	`m™gÀr
(
msg
);

47 
check
 = 
	`rfc822_check
(
msg
, 
NULL
);

48 
	`Ârötf
(
°dîr
, "check = %∞(2)\n", 
check
);

49 
	`ok1
(
check
 =
NULL
);

52 
	`exô
(
	`exô_°©us
());

53 
	}
}

	@ccan/ccan/rfc822/test/run-default-alloc-failure.c

1 
	~"c⁄fig.h
"

2 
	~<°dlib.h
>

3 
	~<°rög.h
>

4 
	~<as£π.h
>

6 
	~<sig«l.h
>

7 
	~<î∫o.h
>

9 
	#CCAN_RFC822_DEBUG


	)

11 
	~<cˇn/rfc822/rfc822.h
>

13 #ifde‡
TAL_USE_TALLOC


14 
	~<cˇn/èl/èŒoc/èŒoc.h
>

16 
	~<cˇn/èl/èl.h
>

19 
boﬁ
 
	gshould_Áû
 = 
Ál£
;

21 *
	$mayÁû_Æloc
(c⁄° *
˘x
, 
size_t
 
size
)

23 i‡(
should_Áû
)

24  
NULL
;

25  
	`èl_¨rz
(
˘x
, , 
size
);

26 
	}
}

29 #unde‡
èl


30 #unde‡
èlz


31 #unde‡
èl_¨r


32 
	#èl
(
˘x
, 
ty≥
Ë
	`mayÁû_Æloc
((˘x), —y≥))

	)

33 
	#èlz
(
˘x
, 
ty≥
Ë
	`mayÁû_Æloc
((˘x), —y≥))

	)

34 
	#èl_¨r
(
˘x
, 
ty≥
, 
num
Ë
	`mayÁû_Æloc
((˘x), —y≥)*“um))

	)

36 
	~<cˇn/rfc822/rfc822.c
>

38 
	~"ã°d©a.h
"

40 
	$ab‹t_h™dÀr
(
signum
)

42 
	`¥ötf
("Aborted");

43 
	`exô
(0);

44 
	}
}

46 
	$maö
(
¨gc
, *
¨gv
[])

48 c⁄° *
buf
;

49 
size_t
 
Àn
;

50 
rfc822_msg
 *
msg
;

51 
siga˘i⁄
 
ß
 = {

52 .
ß_h™dÀr
 = 
ab‹t_h™dÀr
,

54 
ªt
;

56 
ªt
 = 
	`siga˘i⁄
(
SIGABRT
, &
ß
, 
NULL
);

57 
	`as£π
(
ªt
 == 0);

59 
buf
 = 
	`as£mbÀ_msg
(&
ã°_msg_1
, &
Àn
, 0);

61 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

62 
should_Áû
 = 
åue
;

63 (Ë
	`rfc822_√xt_hódî
(
msg
, 
NULL
);

66 
	`ab‹t
();

67 
	}
}

	@ccan/ccan/rfc822/test/run-hdr-and-body.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

3 
	~<cˇn/Áûã°/Áûã°.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 
	#CCAN_RFC822_DEBUG


	)

10 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

15 
	~"hñ≥r.h
"

17 
	#CHECK_HEADERS
(
_e
, 
_msg
, 
_h
, 
_n
, 
_¸lf
) \

19 
_i
; \

20 
_i
 = 0; _ò< (
_e
)->
nhdrs
; _i++) { \

21 (
_h
Ë
	`rfc822_√xt_hódî
((
_msg
), (_h)); \

22 
	`ok
((
_h
), "hódî %dÉxi°†%s", 
_i
, (
_n
)); \

23 i‡(!(
_h
)) \

25 
	`check_hódî
((
_msg
), (
_h
), (
_e
)->
hdrs
[
_i
].
«me
, \

26 (
_e
)->
hdrs
[
_i
].
vÆ
, \

27 (
_e
)->
hdrs
[
_i
].
îr‹s
, 
¸lf
); \

29 } 0)

	)

31 
	$ã°_bodyhdr
(c⁄° 
´xam∂e
 *
e
, c⁄° *
buf
, 
size_t
 
Àn
,

32 c⁄° *
ex«me
, 
¸lf
)

34 
rfc822_msg
 *
msg
;

35 
rfc822_hódî
 *
h
 = 
NULL
;

36 
byã°rög
 
body
;

38 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

39 
	`Æloˇti⁄_Áûuª_check
();

41 
	`ok
(
msg
, "›íed %s", 
ex«me
);

43 
body
 = 
	`rfc822_body
(
msg
);

44 
	`Æloˇti⁄_Áûuª_check
();

45 
	`ok
(
	`byã°rög_eq
(
body
, 
	`byã°rög_‰om_°rög
(
e
->body)),

46 "body c⁄ã¡ %s", 
ex«me
);

48 
	`CHECK_HEADERS
(
e
, 
msg
, 
h
, 
ex«me
, 
¸lf
);

49 
h
 = 
	`rfc822_√xt_hódî
(
msg
, h);

50 
	`Æloˇti⁄_Áûuª_check
();

51 
	`ok
(!
h
, "Toÿm™y hódî†f‹ %s", 
ex«me
);

53 
	`rfc822_‰ì
(
msg
);

54 
	`Æloˇti⁄_Áûuª_check
();

55 
	}
}

57 
	$ã°_hdrbody
(c⁄° 
´xam∂e
 *
e
, c⁄° *
buf
, 
size_t
 
Àn
,

58 c⁄° *
ex«me
, 
¸lf
)

60 
rfc822_msg
 *
msg
;

61 
rfc822_hódî
 *
h
 = 
NULL
;

62 
byã°rög
 
body
;

64 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

65 
	`Æloˇti⁄_Áûuª_check
();

66 
	`ok
(
msg
, "›íed %s", 
ex«me
);

68 
	`CHECK_HEADERS
(
e
, 
msg
, 
h
, 
ex«me
, 
¸lf
);

69 
h
 = 
	`rfc822_√xt_hódî
(
msg
, h);

70 
	`Æloˇti⁄_Áûuª_check
();

71 
	`ok
(!
h
, "Toÿm™y hódî†f‹ %s", 
ex«me
);

73 
body
 = 
	`rfc822_body
(
msg
);

74 
	`Æloˇti⁄_Áûuª_check
();

75 
	`ok
(
	`byã°rög_eq
(
body
, 
	`byã°rög_‰om_°rög
(
e
->body)),

76 "body c⁄ã¡ %s", 
ex«me
);

78 
	`rfc822_‰ì
(
msg
);

79 
	`Æloˇti⁄_Áûuª_check
();

80 
	}
}

82 
	$ã°_hdrhdr
(c⁄° 
´xam∂e
 *
e
, c⁄° *
buf
, 
size_t
 
Àn
,

83 c⁄° *
ex«me
, 
¸lf
)

85 
rfc822_msg
 *
msg
;

86 
rfc822_hódî
 *
h
;

88 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

89 
	`Æloˇti⁄_Áûuª_check
();

90 
	`ok
(
msg
, "›íed %s", 
ex«me
);

92 
h
 = 
NULL
;

93 
	`CHECK_HEADERS
(
e
, 
msg
, 
h
, 
ex«me
, 
¸lf
);

95 
h
 = 
	`rfc822_√xt_hódî
(
msg
, h);

96 
	`Æloˇti⁄_Áûuª_check
();

97 
	`ok
(!
h
, "Toÿm™y hódî†f‹ %s", 
ex«me
);

100 
h
 = 
NULL
;

101 
	`CHECK_HEADERS
(
e
, 
msg
, 
h
, 
ex«me
, 
¸lf
);

103 
h
 = 
	`rfc822_√xt_hódî
(
msg
, h);

104 
	`Æloˇti⁄_Áûuª_check
();

105 
	`ok
(!
h
, "Toÿm™y hódî†f‹ %s", 
ex«me
);

107 
	`rfc822_‰ì
(
msg
);

108 
	`Æloˇti⁄_Áûuª_check
();

109 
	}
}

111 
	$maö
(
¨gc
, *
¨gv
[])

113 
´xam∂e
 *
e
;

116 
	`∂™_ã°s
(20*
	`num_´xam∂es
()

117 + (36 + 
CHECK_HEADER_NUMTESTS
)*
	`num_´xam∂e_hdrs
());

119 
	`Áûã°_£tup
(
¨gc
, 
¨gv
);

121 
	`f‹_óch_´xam∂e
(
e
) {

122 
¸lf
;

124 
	`f‹óch_öt
(
¸lf
, 0, 1) {

125 c⁄° *
buf
;

126 
size_t
 
Àn
;

127 
ex«me
[256];

129 
	`•rötf
(
ex«me
, "%s[%s]", 
e
->
«me
, 
	`NLT
(
¸lf
));

131 
buf
 = 
	`as£mbÀ_msg
(
e
, &
Àn
, 
¸lf
);

132 
	`ok
((
buf
), "as£mbÀd %s", 
ex«me
);

133 i‡(!
buf
)

136 
	`ã°_bodyhdr
(
e
, 
buf
, 
Àn
, 
ex«me
, 
¸lf
);

137 
	`ã°_hdrbody
(
e
, 
buf
, 
Àn
, 
ex«me
, 
¸lf
);

138 
	`ã°_hdrhdr
(
e
, 
buf
, 
Àn
, 
ex«me
, 
¸lf
);

140 
	`èl_‰ì
(
buf
);

145 
	`Áûã°_exô
(
	`exô_°©us
());

146 
	}
}

	@ccan/ccan/rfc822/test/run-hdr-no-colon.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

3 
	~<cˇn/Áûã°/Áûã°.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 
	#CCAN_RFC822_DEBUG


	)

10 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

15 
	~"hñ≥r.h
"

17 
	#NO_COLON_STR
 "Thi†i†®bad hódî\n"

	)

18 c⁄° 
	gno_cﬁ⁄_msg
[] =

20 
NO_COLON_STR


26 
	$ã°_no_cﬁ⁄
(c⁄° *
buf
, 
size_t
 
Àn
)

28 
rfc822_msg
 *
msg
;

29 
rfc822_hódî
 *
hdr
;

30 
byã°rög
 
hfuŒ
;

32 
	`∂™_ã°s
(6);

34 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

36 
	`Æloˇti⁄_Áûuª_check
();

38 
hdr
 = 
	`rfc822_fú°_hódî
(
msg
);

39 
	`Æloˇti⁄_Áûuª_check
();

41 
	`ok
(
hdr
 && (
	`rfc822_hódî_îr‹s
(
msg
, hdr) == 0), "First header valid");

42 
	`Æloˇti⁄_Áûuª_check
();

44 
hdr
 = 
	`rfc822_√xt_hódî
(
msg
, hdr);

45 
	`Æloˇti⁄_Áûuª_check
();

47 
	`ok
(
hdr
 && (
	`rfc822_hódî_îr‹s
(
msg
, hdrË=
RFC822_HDR_NO_COLON
),

50 
	`ok1
(
hdr
 && !
	`rfc822_hódî_is
(
msg
, hdr, 
NULL
));

51 
	`ok1
(
hdr
 && !
	`rfc822_hódî_is
(
msg
, hdr, ""));

52 
	`ok1
(
hdr
 && !
	`rfc822_hódî_is
(
msg
, hdr, 
NO_COLON_STR
));

54 
hfuŒ
 = 
	`rfc822_hódî_øw_c⁄ã¡
(
msg
, 
hdr
);

55 
	`Æloˇti⁄_Áûuª_check
();

57 
	`ok
(
	`byã°rög_eq
(
hfuŒ
, 
	`BYTESTRING
(
NO_COLON_STR
)),

60 
	`rfc822_‰ì
(
msg
);

61 
	`Æloˇti⁄_Áûuª_check
();

62 
	}
}

64 
	$maö
(
¨gc
, *
¨gv
[])

66 
	`Áûã°_£tup
(
¨gc
, 
¨gv
);

68 
	`ã°_no_cﬁ⁄
(
no_cﬁ⁄_msg
, (no_colon_msg));

71 
	`Áûã°_exô
(
	`exô_°©us
());

72 
	}
}

	@ccan/ccan/rfc822/test/run-hdr-of-name.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

3 
	~<cˇn/Áûã°/Áûã°.h
>

4 
	~<°dlib.h
>

5 
	~<°rög.h
>

7 
	#CCAN_RFC822_DEBUG


	)

9 
	~<cˇn/rfc822/rfc822.h
>

11 
	~<cˇn/rfc822/rfc822.c
>

13 
	~"ã°d©a.h
"

14 
	~"hñ≥r.h
"

16 
	$ã°_hdrby«me
(c⁄° 
´xam∂e
 *
e
, c⁄° *
buf
, 
size_t
 
Àn
,

17 c⁄° *
ex«me
, 
¸lf
)

19 
rfc822_msg
 *
msg
;

20 
rfc822_hódî
 *
h
, *
hx
;

21 
i
, 
j
;

23 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

24 
	`Æloˇti⁄_Áûuª_check
();

25 
	`ok
(
msg
, "›íed %s", 
ex«me
);

27 
i
 = 0; i < 
e
->
nhdrs
; i++) {

28 
ã°hdr
 *
eh
 = &
e
->
hdrs
[
i
];

30 
h
 = 
	`rfc822_fú°_hódî_of_«me
(
msg
, 
eh
->
«me
);

31 
hx
 = 
	`rfc822_√xt_hódî_of_«me
(
msg
, 
NULL
, 
eh
->
«me
);

32 
	`ok1
(
h
 =
hx
);

34 
j
 = 0; 
h
 && j < 
eh
->
ödex
; j++)

35 
h
 = 
	`rfc822_√xt_hódî_of_«me
(
msg
, h, 
eh
->
«me
);

36 
	`ok
(
h
, "hódî \"%s\" (#%dËexi°s", 
eh
->
«me
,Éh->
ödex
);

37 i‡(!
h
)

39 
	`check_hódî
(
msg
, 
h
, 
eh
->
«me
,Éh->
vÆ
,Éh->
îr‹s
, 
¸lf
);

41 
h
 = 
	`rfc822_√xt_hódî_of_«me
(
msg
, h, 
eh
->
«me
);

42 
	`ok1
((
eh
->
ödex
 !eh->
œ°
Ë^ !
h
);

45 
h
 = 
	`rfc822_fú°_hódî_of_«me
(
msg
, 
NULL
);

46 
	`ok
(!
h
, "Never match NULLÇame");

48 
	`rfc822_‰ì
(
msg
);

49 
	`Æloˇti⁄_Áûuª_check
();

50 
	}
}

52 
	$maö
(
¨gc
, *
¨gv
[])

54 
´xam∂e
 *
e
;

57 
	`∂™_ã°s
(6*
	`num_´xam∂es
(Ë+ 14*
	`num_´xam∂e_hdrs
());

59 
	`Áûã°_£tup
(
¨gc
, 
¨gv
);

61 
	`f‹_óch_´xam∂e
(
e
) {

62 
¸lf
;

64 
	`f‹óch_öt
(
¸lf
, 0, 1) {

65 c⁄° *
buf
;

66 
size_t
 
Àn
;

67 
ex«me
[256];

69 
	`•rötf
(
ex«me
, "%s[%s]", 
e
->
«me
, 
	`NLT
(
¸lf
));

71 
buf
 = 
	`as£mbÀ_msg
(
e
, &
Àn
, 
¸lf
);

72 
	`ok
((
buf
), "as£mbÀd %s", 
ex«me
);

73 i‡(!
buf
)

76 
	`ã°_hdrby«me
(
e
, 
buf
, 
Àn
, 
ex«me
, 
¸lf
);

78 
	`èl_‰ì
(
buf
);

83 
	`Áûã°_exô
(
	`exô_°©us
());

84 
	}
}

	@ccan/ccan/rfc822/test/run-no-body.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

3 
	~<cˇn/Áûã°/Áûã°.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 
	#CCAN_RFC822_DEBUG


	)

10 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

15 
	~"hñ≥r.h
"

17 c⁄° 
	gno_body
[] =

24 c⁄° 
	gåunˇãd
[] =

29 
	$ã°_no_body
(c⁄° *
buf
, 
size_t
 
Àn
)

31 
rfc822_msg
 *
msg
;

32 
byã°rög
 
body
;

33 
ok
 = 1;

35 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

36 
	`Æloˇti⁄_Áûuª_check
();

38 
body
 = 
	`rfc822_body
(
msg
);

39 
	`Æloˇti⁄_Áûuª_check
();

40 i‡(
body
.
±r
)

41 
ok
 = 0;

43 
	`rfc822_‰ì
(
msg
);

44 
	`Æloˇti⁄_Áûuª_check
();

45  
ok
;

46 
	}
}

48 
	$ã°_åunˇãd
(c⁄° *
buf
, 
size_t
 
Àn
)

50 
rfc822_msg
 *
msg
;

51 
rfc822_hódî
 *
h
 = 
NULL
;

52 
byã°rög
 
body
;

53 
ok
 = 1;

55 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

56 
	`Æloˇti⁄_Áûuª_check
();

59 
h
 = 
	`rfc822_√xt_hódî
(
msg
, h);

60 
	`Æloˇti⁄_Áûuª_check
();

61 } 
h
);

63 
body
 = 
	`rfc822_body
(
msg
);

64 
	`Æloˇti⁄_Áûuª_check
();

65 i‡(
body
.
±r
)

66 
ok
 = 0;

68 
	`rfc822_‰ì
(
msg
);

69 
	`Æloˇti⁄_Áûuª_check
();

70  
ok
;

71 
	}
}

73 
	$maö
(
¨gc
, *
¨gv
[])

75 
	`Áûã°_£tup
(
¨gc
, 
¨gv
);

78 
	`∂™_ã°s
(3);

80 
	`ok1
(
	`ã°_no_body
(
no_body
, (no_body)));

81 
	`ok1
(
	`ã°_no_body
(
åunˇãd
, (truncated)));

82 
	`ok1
(
	`ã°_åunˇãd
(
åunˇãd
, (truncated)));

85 
	`Áûã°_exô
(
	`exô_°©us
());

86 
	}
}

	@ccan/ccan/rfc822/test/run-testdata.c

1 
	~<c⁄fig.h
>

3 
	~<°dlib.h
>

4 
	~<°rög.h
>

6 
	~<cˇn/èp/èp.h
>

7 
	~<cˇn/¨øy_size/¨øy_size.h
>

9 
	#CCAN_RFC822_DEBUG


	)

11 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

18 c⁄° 
	gã°_msg_1_cmp
[] =

30 
	$ã°_as£mbÀ
(c⁄° 
´xam∂e
 *
e
, 
¸lf
,

31 c⁄° *
cmp
, 
size_t
 
cm∂í
)

33 c⁄° *
msg
;

34 
size_t
 
Àn
;

36 
msg
 = 
	`as£mbÀ_msg
(
e
, &
Àn
, 
¸lf
);

37 
	`ok1
(
msg
 !
NULL
);

38 
	`Ârötf
(
°dîr
, "Assembled message %zd bytes (versus %zd bytes)\n",

39 
Àn
, 
cm∂í
);

40 
	`ok1
(
Àn
 =
cm∂í
);

41 
	`ok1
(
	`memcmp
(
msg
, 
cmp
, 
cm∂í
) == 0);

42 
	`èl_‰ì
(
msg
);

43 
	}
}

45 
	$maö
(
¨gc
, *
¨gv
[])

47 
	`∂™_ã°s
(3);

49 
	`ã°_as£mbÀ
(&
ã°_msg_1
, 0, 
ã°_msg_1_cmp
, (test_msg_1_cmp) - 1);

50 
	`exô
(
	`exô_°©us
());

51 
	}
}

	@ccan/ccan/rfc822/test/run-unfold.c

1 
	~<cˇn/f‹óch/f‹óch.h
>

2 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

3 
	~<cˇn/Áûã°/Áûã°.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 
	#CCAN_RFC822_DEBUG


	)

10 
	~<cˇn/rfc822/rfc822.h
>

12 
	~<cˇn/rfc822/rfc822.c
>

14 
	~"ã°d©a.h
"

15 
	~"hñ≥r.h
"

17 
	#UNFOLDED
 " Thi†i†®°rög wôh\éŸ†o‡\çœ˚†tÿfﬁd"

	)

18 
	#FOLD_POINTS
 11

	)

20 
	#BEFORE
 "Date: Tue, 22 Feb 2011 00:15:59 +1100\n" \

23 "Subje˘:"

	)

25 
	#AFTER
 "Message-ID: <20110221131559.GA28327@example>\n" \

27 "body"

	)

29 
byã°rög
 
	$fﬁd_™d_as£mbÀ
(
fﬁd©
, 
¸lf
, 
åunˇãd
)

31 *
buf
, *
p
;

32 
i
, 
n
 = 0;

34 
buf
 = 
	`èl_¨r
(
NULL
, , 
	`°æí
(
BEFORE
Ë+ såÀn(
AFTER
Ë+ 3*°æí(
UNFOLDED
) + 2);

35 i‡(!
buf
)

36 
	`exô
(0);

38 
	`mem˝y
(
buf
, 
BEFORE
, 
	`°æí
(BEFORE));

40 
p
 = 
buf
 + 
	`°æí
(
BEFORE
);

42 
i
 = 0; i < 
	`°æí
(
UNFOLDED
); i++) {

43 i‡(
	`rfc822_isw•
(
UNFOLDED
[
i
])) {

44 
n
++;

45 i‡((
fﬁd©
 =-1Ë|| (fﬁd© =
n
)) {

46 i‡(
¸lf
)

47 *
p
++ = '\r';

48 *
p
++ = '\n';

51 *
p
++ = 
UNFOLDED
[
i
];

54 i‡(!
åunˇãd
) {

55 i‡(
¸lf
)

56 *
p
++ = '\r';

57 *
p
++ = '\n';

59 
	`mem˝y
(
p
, 
AFTER
, 
	`°æí
(AFTER));

60 
p
 +
	`°æí
(
AFTER
);

63  
	`byã°rög
(
buf
, 
p
 - buf);

64 
	}
}

66 
	$check_fﬁded_hódî
(c⁄° *
buf
, 
size_t
 
Àn
)

68 
rfc822_msg
 *
msg
;

69 
rfc822_hódî
 *
hdr
;

70 
byã°rög
 
hunfﬁd
;

72 
msg
 = 
	`rfc822_°¨t
(
NULL
, 
buf
, 
Àn
);

73 
	`Æloˇti⁄_Áûuª_check
();

75 
hdr
 = 
	`rfc822_fú°_hódî
(
msg
);

76 
	`Æloˇti⁄_Áûuª_check
();

77 
hdr
 = 
	`rfc822_√xt_hódî
(
msg
, hdr);

78 
	`Æloˇti⁄_Áûuª_check
();

79 
hdr
 = 
	`rfc822_√xt_hódî
(
msg
, hdr);

80 
	`Æloˇti⁄_Áûuª_check
();

83 
hdr
 = 
	`rfc822_√xt_hódî
(
msg
, hdr);

84 
	`Æloˇti⁄_Áûuª_check
();

86 
	`ok
(
hdr
 && (
	`rfc822_hódî_îr‹s
(
msg
, hdr) == 0), "Folded header valid");

87 
	`Æloˇti⁄_Áûuª_check
();

89 
hunfﬁd
 = 
	`rfc822_hódî_unfﬁded_vÆue
(
msg
, 
hdr
);

90 
	`Æloˇti⁄_Áûuª_check
();

92 
	`ok
(
hunfﬁd
.
Àn
 =
	`°æí
(
UNFOLDED
), "UnfoldedÜength %zd, should be %zd",

93 
hunfﬁd
.
Àn
, 
	`°æí
(
UNFOLDED
));

94 
	`ok1
(
	`memcmp
(
hunfﬁd
.
±r
, 
UNFOLDED
, hunfﬁd.
Àn
) == 0);

96 
	`rfc822_‰ì
(
msg
);

97 
	`Æloˇti⁄_Áûuª_check
();

98 
	}
}

100 
	$maö
(
¨gc
, *
¨gv
[])

102 
byã°rög
 
msgbuf
;

103 
¸lf
, 
åunˇãd
, 
i
;

105 
	`Áûã°_£tup
(
¨gc
, 
¨gv
);

107 
	`∂™_ã°s
(3 * 2 * 2 * (
FOLD_POINTS
 + 2));

109 
	`f‹óch_öt
(
¸lf
, 0, 1) {

110 
	`f‹óch_öt
(
åunˇãd
, 0, 1) {

111 
i
 = -1; i <
FOLD_POINTS
; i++) {

112 
msgbuf
 = 
	`fﬁd_™d_as£mbÀ
(
i
, 
¸lf
, 
åunˇãd
);

113 
	`check_fﬁded_hódî
(
msgbuf
.
±r
, msgbuf.
Àn
);

114 
	`èl_‰ì
(
msgbuf
.
±r
);

120 
	`Áûã°_exô
(
	`exô_°©us
());

121 
	}
}

	@ccan/ccan/rfc822/test/testdata.h

1 #i‚de‡
RFC822_TESTDATA_H


2 
	#RFC822_TESTDATA_H


	)

4 
	~<cˇn/èl/°r/°r.h
>

5 
	~<cˇn/¨øy_size/¨øy_size.h
>

6 
	~<cˇn/f‹óch/f‹óch.h
>

8 
	sã°hdr
 {

9 c⁄° *
	m«me
, *
	mvÆ
;

10 
	mödex
, 
	mœ°
;

11 
rfc822_hódî_îr‹s
 
	mîr‹s
;

14 
	s´xam∂e
 {

15 c⁄° *
	m«me
;

16 
ã°hdr
 *
	mhdrs
;

17 
size_t
 
	mnhdrs
;

18 c⁄° *
	mbody
;

21 
	#AEXAMPLE
(
s
) \

22 
´xam∂e
 
s
 = { \

23 .
«me
 = #s, \

24 .
hdrs
 = 
s
##
_hdrs
, \

25 .
nhdrs
 = 
	`ARRAY_SIZE
(
s
##
_hdrs
), \

26 .
body
 = 
s
##
_body
, \

27 };

	)

29 
ã°hdr
 
	gã°_msg_1_hdrs
[] = {

39 c⁄° 
	gã°_msg_1_body
[] = "Test message\n";

40 
AEXAMPLE
(
ã°_msg_1
);

42 
	#ã°_msg_em±y_body_hdrs
 
ã°_msg_1_hdrs


	)

43 c⁄° 
	gã°_msg_em±y_body_body
[] = "";

44 
AEXAMPLE
(
ã°_msg_em±y_body
);

46 
	#ã°_msg_∆∆_lf_hdrs
 
ã°_msg_1_hdrs


	)

47 c⁄° 
	gã°_msg_∆∆_lf_body
[] = "Message containing \n\n inside body\n";

48 
AEXAMPLE
(
ã°_msg_∆∆_lf
);

50 
	#ã°_msg_∆∆_¸lf_hdrs
 
ã°_msg_1_hdrs


	)

51 c⁄° 
	gã°_msg_∆∆_¸lf_body
[] = "Message containing \r\n\r\n inside body\r\n";

52 
AEXAMPLE
(
ã°_msg_∆∆_¸lf
);

54 
	#ã°_msg_∆∆_mixed_hdrs
 
ã°_msg_1_hdrs


	)

55 c⁄° 
	gã°_msg_∆∆_mixed_body
[] = "Message containing both \n\nánd \r\n\r\n inside body\n\r\n";

56 
AEXAMPLE
(
ã°_msg_∆∆_mixed
);

58 
	#ã°_msg_•a˚_body_hdrs
 
ã°_msg_1_hdrs


	)

59 c⁄° 
	gã°_msg_•a˚_body_body
[] = " Message with LWSát start of body\n";

60 
AEXAMPLE
(
ã°_msg_•a˚_body
);

62 
ã°hdr
 
	gbad_hdrs_hdrs
[] = {

66 .
îr‹s
 = 
RFC822_HDR_BAD_NAME_CHARS
},

70 
	#bad_hdrs_body
 
ã°_msg_1_body


	)

71 
	$AEXAMPLE
(
bad_hdrs
)

73 
ã°hdr
 
ª≥©ed_hdrs_1_hdrs
[] = {

79 
	}
};

80 
	#ª≥©ed_hdrs_1_body
 
ã°_msg_1_body


	)

81 
AEXAMPLE
(
ª≥©ed_hdrs_1
);

83 
ã°hdr
 
	g¥efix_hdr_hdrs
[] = {

87 
	#¥efix_hdr_body
 
ã°_msg_1_body


	)

88 
AEXAMPLE
(
¥efix_hdr
);

90 
	#f‹_óch_´xam∂e
(
_e
) \

91 
	`f‹óch_±r
((
_e
), &
ã°_msg_1
, &
ã°_msg_em±y_body
, \

92 &
ã°_msg_∆∆_lf
, &
ã°_msg_∆∆_¸lf
, \

93 &
ã°_msg_∆∆_mixed
, \

94 &
ã°_msg_•a˚_body
, \

95 &
bad_hdrs
, \

96 &
ª≥©ed_hdrs_1
, \

97 &
¥efix_hdr
)

	)

99 
	#f‹_óch_´xam∂e_buf
(
_e
, 
_buf
, 
_Àn
) \

100 
	`f‹_óch_´xam∂e
((
_e
)) \

101 i‡(((
_buf
Ë
	`as£mbÀ_msg
((
_e
), &(
_Àn
))Ë!
NULL
)

	)

103 
ölöe
 
	$num_´xam∂es
()

105 c⁄° 
´xam∂e
 *
e
;

106 
n
 = 0;

108 
	`f‹_óch_´xam∂e
(
e
)

109 
n
++;

111  
n
;

112 
	}
}

114 
ölöe
 
	$num_´xam∂e_hdrs
()

116 c⁄° 
´xam∂e
 *
e
;

117 
n
 = 0;

119 
	`f‹_óch_´xam∂e
(
e
)

120 
n
 +
e
->
nhdrs
;

122  
n
;

123 
	}
}

125 
ölöe
 c⁄° *
	$as£mbÀ_msg
(c⁄° 
´xam∂e
 *
e
,

126 
size_t
 *
Àn
, 
¸lf
)

128 c⁄° *
∆
 = 
¸lf
 ? "\r\n" : "\n";

129 
∆n
 = 
¸lf
 ? 2 : 1;

130 *
msg
;

131 
size_t
 
n
 = 0;

132 
i
;

134 
msg
 = 
	`èl_°rdup
(
NULL
, "");

135 i‡(!
msg
)

136  
NULL
;

138 
i
 = 0; i < 
e
->
nhdrs
; i++) {

139 i‡(!
	`èl_≠≥nd_fmt
(&
msg
, "%s:%s%s", 
e
->
hdrs
[
i
].
«me
,

140 
e
->
hdrs
[
i
].
vÆ
, 
∆
)) {

141 
	`èl_‰ì
(
msg
);

142  
NULL
;

144 
n
 +
	`°æí
(
e
->
hdrs
[
i
].
«me
Ë+ såÀn”->hdrs[i].
vÆ
Ë+ 1 + 
∆n
;

146 i‡(!
	`èl_≠≥nd_fmt
(&
msg
, "%s%s", 
∆
, 
e
->
body
)) {

147 
	`èl_‰ì
(
msg
);

148  
NULL
;

150 
n
 +
	`°æí
(
e
->
body
Ë+ 
∆n
;

151 *
Àn
 = 
n
;

152  
msg
;

153 
	}
}

155 
	#NLT
(
¸lf
Ë((¸lfË? "CRLF" : "LF")

	)

	@ccan/ccan/short_types/short_types.h

2 #i‚de‡
CCAN_SHORT_TYPES_H


3 
	#CCAN_SHORT_TYPES_H


	)

4 
	~<°döt.h
>

9 
uöt64_t
 
	tu64
;

10 
öt64_t
 
	ts64
;

11 
uöt32_t
 
	tu32
;

12 
öt32_t
 
	ts32
;

13 
uöt16_t
 
	tu16
;

14 
öt16_t
 
	ts16
;

15 
uöt8_t
 
	tu8
;

16 
öt8_t
 
	ts8
;

19 #ifde‡
CCAN_ENDIAN_H


23 
beöt64_t
 
	tbe64
;

24 
beöt32_t
 
	tbe32
;

25 
beöt16_t
 
	tbe16
;

30 
Àöt64_t
 
	tÀ64
;

31 
Àöt32_t
 
	tÀ32
;

32 
Àöt16_t
 
	tÀ16
;

	@ccan/ccan/short_types/test/run-endian.c

1 
	~<cˇn/ídün/ídün.h
>

2 
	~<cˇn/sh‹t_ty≥s/sh‹t_ty≥s.h
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dlib.h
>

5 
	~<îr.h
>

7 
	$maö
(
¨gc
, *
¨gv
[])

9 
	`∂™_ã°s
(6);

11 
	`ok1
((
be64
) == 8);

12 
	`ok1
((
be32
) == 4);

13 
	`ok1
((
be16
) == 2);

15 
	`ok1
((
À64
) == 8);

16 
	`ok1
((
À32
) == 4);

17 
	`ok1
((
À16
) == 2);

19  
	`exô_°©us
();

20 
	}
}

	@ccan/ccan/short_types/test/run.c

1 
	~<cˇn/sh‹t_ty≥s/sh‹t_ty≥s.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dlib.h
>

4 
	~<îr.h
>

6 
	$maö
(
¨gc
, *
¨gv
[])

8 
	`∂™_ã°s
(16);

10 
	`ok1
((
u64
) == 8);

11 
	`ok1
((
s64
) == 8);

12 
	`ok1
((
u32
) == 4);

13 
	`ok1
((
s32
) == 4);

14 
	`ok1
((
u16
) == 2);

15 
	`ok1
((
s16
) == 2);

16 
	`ok1
((
u8
) == 1);

17 
	`ok1
((
s8
) == 1);

20 
	`ok1
((
u64
)-1 > 0);

21 
	`ok1
((
u32
)-1 > 0);

22 
	`ok1
((
u16
)-1 > 0);

23 
	`ok1
((
u8
)-1 > 0);

24 
	`ok1
((
s64
)-1 < 0);

25 
	`ok1
((
s32
)-1 < 0);

26 
	`ok1
((
s16
)-1 < 0);

27 
	`ok1
((
s8
)-1 < 0);

29  
	`exô_°©us
();

30 
	}
}

	@ccan/ccan/siphash/siphash.c

3 
	~<cˇn/ídün/ídün.h
>

5 
	~<°rög.h
>

7 
	~"sùhash.h
"

9 
	esù_ödex
 { 
	mA
=0, 
	mB
=2, 
	mC
=1, 
	mD
=3, 
	mE
=4 };

11 
	#rﬁ
(
x
,
l
Ë(((xË<< (l)Ë| ((xË>> (64-÷))))

	)

13 
	#SIP_HALF_ROUND
(
a
,
b
,
c
,
d
,
L1
,
L2
) \

14 (
a
Ë+(
b
); \

15 (
c
Ë+(
d
); \

16 (
b
Ë(
a
Ë^ 
	`rﬁ
((b),
L1
); \

17 (
d
Ë(
c
Ë^ 
	`rﬁ
((d),
L2
); \

18 (
a
Ë
	`rﬁ
(◊),32);

	)

20 
	#SIP_ROUND
(
W
) \

22 
	`SIP_HALF_ROUND
((
W
)[
A
], (W)[
B
], (W)[
C
], (W)[
D
], 13, 16); \

23 
	`SIP_HALF_ROUND
((
W
)[
C
], (W)[
B
], (W)[
A
], (W)[
D
], 17, 21); \

24 } 0)

	)

27 
ölöe
 
uöt64_t
 
	$W64
(c⁄° *
p
, 
size_t
 
j
)

29 
uöt64_t
 
x
;

30 
	`mem˝y
(&
x
, 
p
 + 
j
*(x), (x));

31  
	`À64_to_˝u
(
x
);

32 
	}
}

34 
	$sùhash_öô
(
uöt64_t
 
v
[5], c⁄° 
key
[16])

36 
v
[
A
] = 
	`W64
(
key
, 0Ë^ 
	`UINT64_C
(0x736f6d6570736575);

37 
v
[
B
] = 
	`W64
(
key
, 1Ë^ 
	`UINT64_C
(0x646f72616e646f6d);

38 
v
[
C
] = 
	`W64
(
key
, 0Ë^ 
	`UINT64_C
(0x6c7967656e657261);

39 
v
[
D
] = 
	`W64
(
key
, 1Ë^ 
	`UINT64_C
(0x7465646279746573);

40 
v
[
E
] = 0;

41 
	}
}

44 
	$sùhash_ïûogue
(
uöt64_t
 *
m
, c⁄° *
ö
, 
size_t
 
Àn
)

46 
ö
 +
Àn
 & ~(
size_t
)7;

47 *
m
 = (
uöt64_t
)(
Àn
 & 255) << 56;

48 
Àn
 & 7) {

49 7: *
m
 |(
uöt64_t
Ë
ö
[6] << 48;

50 6: *
m
 |(
uöt64_t
Ë
ö
[5] << 40;

51 5: *
m
 |(
uöt64_t
Ë
ö
[4] << 32;

52 4: *
m
 |(
uöt64_t
Ë
ö
[3] << 24;

53 3: *
m
 |(
uöt64_t
Ë
ö
[2] << 16;

54 2: *
m
 |(
uöt64_t
Ë
ö
[1] << 8;

55 1: *
m
 |(
uöt64_t
Ë
ö
[0];

58 
	}
}

60 
uöt64_t
 
	$sùhash_2_4
(c⁄° *
ö
, 
size_t
 
Àn
, c⁄° 
key
[16])

62 
uöt64_t
 
v
[5];

63 
size_t
 
j
;

65 
	`sùhash_öô
(
v
, 
key
);

67 
j
 = 0; j < 
Àn
/8; j++) {

68 
v
[
E
] = 
	`W64
(
ö
, 
j
);

69 
v
[
D
] ^v[
E
];

70 
	`SIP_ROUND
(
v
);

71 
	`SIP_ROUND
(
v
);

72 
v
[
A
] ^v[
E
];

74 
	`sùhash_ïûogue
(&
v
[
E
], 
ö
, 
Àn
);

76 
v
[
D
] ^v[
E
];

77 
	`SIP_ROUND
(
v
);

78 
	`SIP_ROUND
(
v
);

79 
v
[
A
] ^v[
E
];

82 
v
[
C
] ^= 0xff;

83 
	`SIP_ROUND
(
v
);

84 
	`SIP_ROUND
(
v
);

85 
	`SIP_ROUND
(
v
);

86 
	`SIP_ROUND
(
v
);

88  
v
[
A
]^v[
B
]^v[
C
]^v[
D
];

89 
	}
}

	@ccan/ccan/siphash/siphash.h

1 #i‚de‡
CCAN_SIPHASH_H_


2 
	#CCAN_SIPHASH_H_


	)

7 
	~<°döt.h
>

8 
	~<°ddef.h
>

47 
uöt64_t
 
sùhash_2_4
(c⁄° *
ö
, 
size_t
 
Àn
, c⁄° 
key
[16]);

	@ccan/ccan/siphash/test/api.c

1 
	~<cˇn/sùhash/sùhash.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	~<öây≥s.h
>

5 
	~<°dio.h
>

7 
uöt64_t
 
	tu64
;

10 c⁄° 
	gt_key
[16] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};

11 c⁄° 
u64
 
	gt_s24exp
[64] = {

46 
	#CHECK_RET
(
MSG
,
IDX
,
EXP
,
GOT
) \

47 i‡((
EXP
Ë!(
GOT
)) { \

48 
	`¥ötf
(
MSG
 " %3d FAIL: Ex≥˘=%016"
PRIx64
" Got=%016"PRIx64"\n", \

49 (
IDX
), (
EXP
), (
GOT
)); \

51 }

	)

53 #ifde‡
SPEEDTEST


54 
	#PRT
(...)

	)

55 
	#N
 10000

	)

57 
	#PRT
(...Ë
	`¥ötf
(
__VA_ARGS__
)

	)

58 
	#N
 1

	)

61 
	$sùhash_sù24_ã°
()

63 
buf
[64] = {0};

64 
j
;

65 
u64
 
hash
;

66 
j
 = 0; j < 64; j++) {

67 
buf
[
j
] = j;

68 
hash
 = 
	`sùhash_2_4
(
buf
, 
j
, 
t_key
);

70 
	`CHECK_RET
("sùhash_2_4", 
j
, 
t_s24exp
[j], 
hash
);

72 
	`PRT
("SipHash-2-4ÖassedállÅests.\n");

74 
	}
}

76 
	$maö
()

78  !
	`sùhash_sù24_ã°
();

79 
	}
}

	@ccan/ccan/sparse_bsearch/sparse_bsearch.c

2 
	~<sys/ty≥s.h
>

3 
	~"•¨£_b£¨ch.h
"

5 *
_•¨£_b£¨ch
(c⁄° *
key
, c⁄° *
ba£
,

6 
size_t
 
nmemb
, size_à
size
,

7 (*
cmp‚
)(const *, const *),

8 
	$boﬁ
 (*
vÆid‚
)(const *))

10 
ssize_t
 
°¨t
 = 0, 
íd
 = 
nmemb
 - 1;

11 c⁄° *
p
 = 
ba£
;

13 
°¨t
 <
íd
) {

14 
ssize_t
 
√xt
 = (
°¨t
 + 
íd
) / 2;

15 
ªsu…
;

17 !
	`vÆid‚
(
p
 + 
√xt
 * 
size
)) {

19 
√xt
++;

20 i‡(
√xt
 > 
íd
) {

22 
√xt
 = (
°¨t
 + 
íd
) / 2;

23 
åim
;

27 
ªsu…
 = 
	`cmp‚
(
key
, 
p
 + 
√xt
 * 
size
);

28 i‡(
ªsu…
 == 0)

29  (*)(
p
 + 
√xt
 * 
size
);

30 i‡(
ªsu…
 > 0)

31 
°¨t
 = 
√xt
 + 1;

33 
åim
:

34 
íd
 = 
√xt
 - 1;

37  
NULL
;

38 
	}
}

	@ccan/ccan/sparse_bsearch/sparse_bsearch.h

2 #i‚de‡
SPARSE_BSEARCH_H


3 
	#SPARSE_BSEARCH_H


	)

4 
	~<°dboﬁ.h
>

5 
	~<°dlib.h
>

6 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

7 
	~<cˇn/check_ty≥/check_ty≥.h
>

42 
	#•¨£_b£¨ch
(
key
, 
ba£
, 
nmemb
, 
cmp‚
, 
vÆid‚
) \

43 
	`_•¨£_b£¨ch
((
key
)+
	`check_ty≥s_m©ch
((key), &(
ba£
)[0]), \

44 (
ba£
), (
nmemb
), ((base)[0]), \

45 
	`ty≥ß„_cb_ˇ°
((*)(const *, const *), \

46 (*)(c⁄° 
	`__ty≥of__
(*(
ba£
)) *, \

47 c⁄° 
	`__ty≥of__
(*(
ba£
)) *), \

48 (
cmp‚
)), \

49 
	`ty≥ß„_cb_ˇ°
(
	`boﬁ
 (*)(const *), \

50 
	`boﬁ
 (*)(c⁄° 
	`__ty≥of__
(*(
ba£
)) *), \

51 (
vÆid‚
)))

	)

53 *
_•¨£_b£¨ch
(c⁄° *
key
, c⁄° *
ba£
,

54 
size_t
 
nmemb
, size_à
size
,

55 (*
cmp‚
)(const *, const *),

56 
	$boﬁ
 (*
vÆid‚
)(const *));

	@ccan/ccan/sparse_bsearch/test/run.c

2 
	~<cˇn/•¨£_b£¨ch/•¨£_b£¨ch.h
>

4 
	~<cˇn/•¨£_b£¨ch/•¨£_b£¨ch.c
>

5 
	~<cˇn/èp/èp.h
>

7 
	$cmp
(c⁄° *
a
, c⁄° *
b
)

9  (*
a
Ë- (*
b
);

10 
	}
}

12 
boﬁ
 
	$vÆid
(c⁄° *
a
)

14  *
a
 != 0;

15 
	}
}

17 
	$maö
()

19 
i
, 
j
, 
ma°î
[4] = { 1, 2, 3, 4 }, 
¨r
[4];

21 
	`∂™_ã°s
((1 << 4) * 4+ (1 << 3) * 3);

24 
i
 = 0; i < (1 << 4); i++) {

26 
j
 = 0; j < 4; j++) {

27 i‡(
i
 & (1 << 
j
))

28 
¨r
[
j
] = 
ma°î
[j];

30 
¨r
[
j
] = 0;

33 
j
 = 1; j <= 4; j++) {

34 *
±r
;

35 
±r
 = 
	`•¨£_b£¨ch
(&
j
, 
¨r
, 4, 
cmp
, 
vÆid
);

36 i‡(
i
 & (1 << (
j
-1)))

37 
	`ok1
(
±r
 && *±∏=
j
);

39 
	`ok1
(!
±r
);

43 
i
 = 0; i < (1 << 3); i++) {

45 
j
 = 0; j < 3; j++) {

46 i‡(
i
 & (1 << 
j
))

47 
¨r
[
j
] = 
ma°î
[j];

49 
¨r
[
j
] = 0;

52 
j
 = 1; j <= 3; j++) {

53 *
±r
;

54 
±r
 = 
	`•¨£_b£¨ch
(&
j
, 
¨r
, 3, 
cmp
, 
vÆid
);

55 i‡(
i
 & (1 << (
j
-1)))

56 
	`ok1
(
±r
 && *±∏=
j
);

58 
	`ok1
(!
±r
);

63  
	`exô_°©us
();

64 
	}
}

	@ccan/ccan/str/debug.c

2 
	~"c⁄fig.h
"

3 
	~<cˇn/°r/°r_debug.h
>

4 
	~<as£π.h
>

5 
	~<˘y≥.h
>

6 
	~<°rög.h
>

8 #ifde‡
CCAN_STR_DEBUG


10 
	$°r_iß um
(
i
)

12 
	`as£π
(
i
 >= -1 && i < 256);

13  
	`iß um
(
i
);

14 
	}
}

16 
	$°r_ißÕha
(
i
)

18 
	`as£π
(
i
 >= -1 && i < 256);

19  
	`ißÕha
(
i
);

20 
	}
}

22 
	$°r_ißscii
(
i
)

24 
	`as£π
(
i
 >= -1 && i < 256);

25  
	`ißscii
(
i
);

26 
	}
}

28 #i‡
HAVE_ISBLANK


29 
	$°r_isbœnk
(
i
)

31 
	`as£π
(
i
 >= -1 && i < 256);

32  
	`isbœnk
(
i
);

33 
	}
}

36 
	$°r_is˙ål
(
i
)

38 
	`as£π
(
i
 >= -1 && i < 256);

39  
	`is˙ål
(
i
);

40 
	}
}

42 
	$°r_isdigô
(
i
)

44 
	`as£π
(
i
 >= -1 && i < 256);

45  
	`isdigô
(
i
);

46 
	}
}

48 
	$°r_isgøph
(
i
)

50 
	`as£π
(
i
 >= -1 && i < 256);

51  
	`isgøph
(
i
);

52 
	}
}

54 
	$°r_i¶owî
(
i
)

56 
	`as£π
(
i
 >= -1 && i < 256);

57  
	`i¶owî
(
i
);

58 
	}
}

60 
	$°r_i•röt
(
i
)

62 
	`as£π
(
i
 >= -1 && i < 256);

63  
	`i•röt
(
i
);

64 
	}
}

66 
	$°r_i•un˘
(
i
)

68 
	`as£π
(
i
 >= -1 && i < 256);

69  
	`i•un˘
(
i
);

70 
	}
}

72 
	$°r_is•a˚
(
i
)

74 
	`as£π
(
i
 >= -1 && i < 256);

75  
	`is•a˚
(
i
);

76 
	}
}

78 
	$°r_isuµî
(
i
)

80 
	`as£π
(
i
 >= -1 && i < 256);

81  
	`isuµî
(
i
);

82 
	}
}

84 
	$°r_isxdigô
(
i
)

86 
	`as£π
(
i
 >= -1 && i < 256);

87  
	`isxdigô
(
i
);

88 
	}
}

90 #unde‡
°r°r


91 #unde‡
°rchr


92 #unde‡
°ºchr


94 *
	$°r_°r°r
(c⁄° *
hay°ack
, c⁄° *
√edÀ
)

96  
	`°r°r
(
hay°ack
, 
√edÀ
);

97 
	}
}

99 *
	$°r_°rchr
(c⁄° *
hay°ack
, 
c
)

101  
	`°rchr
(
hay°ack
, 
c
);

102 
	}
}

104 *
	$°r_°ºchr
(c⁄° *
hay°ack
, 
c
)

106  
	`°ºchr
(
hay°ack
, 
c
);

107 
	}
}

	@ccan/ccan/str/str.c

2 
	~<cˇn/°r/°r.h
>

4 
size_t
 
	$°rcou¡
(c⁄° *
hay°ack
, c⁄° *
√edÀ
)

6 
size_t
 
i
 = 0, 
∆í
 = 
	`°æí
(
√edÀ
);

8 (
hay°ack
 = 
	`°r°r
(hay°ack, 
√edÀ
)Ë!
NULL
) {

9 
i
++;

10 
hay°ack
 +
∆í
;

12  
i
;

13 
	}
}

	@ccan/ccan/str/str.h

2 #i‚de‡
CCAN_STR_H


3 
	#CCAN_STR_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°rög.h
>

6 
	~<°dboﬁ.h
>

7 
	~<limôs.h
>

8 
	~<˘y≥.h
>

21 
	#°ªq
(
a
,
b
Ë(
	`°rcmp
(◊),(b)Ë=0)

	)

32 
	#°r°¨ts
(
°r
,
¥efix
Ë(
	`°∫cmp
((°r),’ªfix),
	`°æí
’ªfix)Ë=0)

	)

43 
ölöe
 
boﬁ
 
	$°ªnds
(c⁄° *
°r
, c⁄° *
po°fix
)

45 i‡(
	`°æí
(
°r
Ë< såÀn(
po°fix
))

46  
Ál£
;

48  
	`°ªq
(
°r
 + 
	`°æí
(°rË- såÀn(
po°fix
),Öostfix);

49 
	}
}

59 
	#°rögify
(
ex¥
Ë
	`°rögify_1
”x¥)

	)

61 
	#°rögify_1
(
ex¥
Ë#ex¥

	)

73 
size_t
 
°rcou¡
(c⁄° *
hay°ack
, c⁄° *
√edÀ
);

90 
	#STR_MAX_CHARS
(
ty≥_‹_ex¥
) \

91 (((
ty≥_‹_ex¥
Ë* 
CHAR_BIT
 + 8) / 9 * 3 + 2 \

92 + 
	`STR_MAX_CHARS_TCHECK_
(
ty≥_‹_ex¥
))

	)

94 #i‡
HAVE_TYPEOF


96 
	#STR_MAX_CHARS_TCHECK_
(
ty≥_‹_ex¥
) \

97 ({ 
	`ty≥of
(
ty≥_‹_ex¥
Ë
x
 = 0; ()x; 0; })

	)

99 
	#STR_MAX_CHARS_TCHECK_
(
ty≥_‹_ex¥
Ë0

	)

110 
ölöe
 
boﬁ
 
	$ciß um
(
c
)

112  
	`iß um
(()
c
);

113 
	}
}

114 
ölöe
 
boﬁ
 
	$cißÕha
(
c
)

116  
	`ißÕha
(()
c
);

117 
	}
}

118 
ölöe
 
boﬁ
 
	$cißscii
(
c
)

120  
	`ißscii
(()
c
);

121 
	}
}

122 #i‡
HAVE_ISBLANK


123 
ölöe
 
boﬁ
 
	$cisbœnk
(
c
)

125  
	`isbœnk
(()
c
);

126 
	}
}

128 
ölöe
 
boﬁ
 
	$cis˙ål
(
c
)

130  
	`is˙ål
(()
c
);

131 
	}
}

132 
ölöe
 
boﬁ
 
	$cisdigô
(
c
)

134  
	`isdigô
(()
c
);

135 
	}
}

136 
ölöe
 
boﬁ
 
	$cisgøph
(
c
)

138  
	`isgøph
(()
c
);

139 
	}
}

140 
ölöe
 
boﬁ
 
	$ci¶owî
(
c
)

142  
	`i¶owî
(()
c
);

143 
	}
}

144 
ölöe
 
boﬁ
 
	$ci•röt
(
c
)

146  
	`i•röt
(()
c
);

147 
	}
}

148 
ölöe
 
boﬁ
 
	$ci•un˘
(
c
)

150  
	`i•un˘
(()
c
);

151 
	}
}

152 
ölöe
 
boﬁ
 
	$cis•a˚
(
c
)

154  
	`is•a˚
(()
c
);

155 
	}
}

156 
ölöe
 
boﬁ
 
	$cisuµî
(
c
)

158  
	`isuµî
(()
c
);

159 
	}
}

160 
ölöe
 
boﬁ
 
	$cisxdigô
(
c
)

162  
	`isxdigô
(()
c
);

163 
	}
}

165 
	~<cˇn/°r/°r_debug.h
>

168 #ifde‡
CCAN_STR_DEBUG


169 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

172 #unde‡
iß um


173 #unde‡
ißÕha


174 #unde‡
ißscii


175 #unde‡
isbœnk


176 #unde‡
is˙ål


177 #unde‡
isdigô


178 #unde‡
isgøph


179 #unde‡
i¶owî


180 #unde‡
i•röt


181 #unde‡
i•un˘


182 #unde‡
is•a˚


183 #unde‡
isuµî


184 #unde‡
isxdigô


187 #i‡
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 && 
HAVE_TYPEOF


188 
	#°r_check_¨g_
(
i
) \

189 ((
i
Ë+ 
	`BUILD_ASSERT_OR_ZERO
(!
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`ty≥of
(i), \

191 || ()255 > 0))

	)

193 
	#°r_check_¨g_
(
i
Ë(i)

	)

196 
	#iß um
(
i
Ë
	`°r_iß um
(
	`°r_check_¨g_
(i))

	)

197 
	#ißÕha
(
i
Ë
	`°r_ißÕha
(
	`°r_check_¨g_
(i))

	)

198 
	#ißscii
(
i
Ë
	`°r_ißscii
(
	`°r_check_¨g_
(i))

	)

199 #i‡
HAVE_ISBLANK


200 
	#isbœnk
(
i
Ë
	`°r_isbœnk
(
	`°r_check_¨g_
(i))

	)

202 
	#is˙ål
(
i
Ë
	`°r_is˙ål
(
	`°r_check_¨g_
(i))

	)

203 
	#isdigô
(
i
Ë
	`°r_isdigô
(
	`°r_check_¨g_
(i))

	)

204 
	#isgøph
(
i
Ë
	`°r_isgøph
(
	`°r_check_¨g_
(i))

	)

205 
	#i¶owî
(
i
Ë
	`°r_i¶owî
(
	`°r_check_¨g_
(i))

	)

206 
	#i•röt
(
i
Ë
	`°r_i•röt
(
	`°r_check_¨g_
(i))

	)

207 
	#i•un˘
(
i
Ë
	`°r_i•un˘
(
	`°r_check_¨g_
(i))

	)

208 
	#is•a˚
(
i
Ë
	`°r_is•a˚
(
	`°r_check_¨g_
(i))

	)

209 
	#isuµî
(
i
Ë
	`°r_isuµî
(
	`°r_check_¨g_
(i))

	)

210 
	#isxdigô
(
i
Ë
	`°r_isxdigô
(
	`°r_check_¨g_
(i))

	)

212 #i‡
HAVE_TYPEOF


214 #unde‡
°r°r


215 #unde‡
°rchr


216 #unde‡
°ºchr


219 
	#°r°r
(
hay°ack
, 
√edÀ
) \

220 ((
	`ty≥of
((
hay°ack
Ë+ 0))
	`°r_°r°r
((hay°ack), (
√edÀ
)))

	)

221 
	#°rchr
(
hay°ack
, 
c
) \

222 ((
	`ty≥of
((
hay°ack
Ë+ 0))
	`°r_°rchr
((hay°ack), (
c
)))

	)

223 
	#°ºchr
(
hay°ack
, 
c
) \

224 ((
	`ty≥of
((
hay°ack
Ë+ 0))
	`°r_°ºchr
((hay°ack), (
c
)))

	)

	@ccan/ccan/str/str_debug.h

2 #i‚de‡
CCAN_STR_DEBUG_H


3 
	#CCAN_STR_DEBUG_H


	)

7 #ifde‡
CCAN_STR_DEBUG


9 
°r_iß um
(
i
);

10 
°r_ißÕha
(
i
);

11 
°r_ißscii
(
i
);

12 #i‡
HAVE_ISBLANK


13 
°r_isbœnk
(
i
);

15 
°r_is˙ål
(
i
);

16 
°r_isdigô
(
i
);

17 
°r_isgøph
(
i
);

18 
°r_i¶owî
(
i
);

19 
°r_i•röt
(
i
);

20 
°r_i•un˘
(
i
);

21 
°r_is•a˚
(
i
);

22 
°r_isuµî
(
i
);

23 
°r_isxdigô
(
i
);

25 *
°r_°r°r
(c⁄° *
hay°ack
, c⁄° *
√edÀ
);

26 *
°r_°rchr
(c⁄° *
s
, 
c
);

27 *
°r_°ºchr
(c⁄° *
s
, 
c
);

	@ccan/ccan/str/test/compile_fail-STR_MAX_CHARS.c

1 
	~<cˇn/°r/°r.h
>

3 
	ss
 {

4 
	mvÆ
;

7 
	$maö
(
¨gc
, *
¨gv
[])

9 
s


10 #ifde‡
FAIL


11 #i‡!
HAVE_TYPEOF


12 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
STR_MAX_CHARS
.

18 
vÆ
;

19 
°r
[
	`STR_MAX_CHARS
(
vÆ
)];

21 
°r
[0] = '\0';

22  
°r
[0] ? 0 : 1;

23 
	}
}

	@ccan/ccan/str/test/compile_fail-isalnum.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
iß um
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`iß um
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isalpha.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
ißÕha
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`ißÕha
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isascii.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
ißscii
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`ißscii
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isblank.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF
 || !
HAVE_ISBLANK


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
isbœnk
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21 #i‡
HAVE_ISBLANK


22  
	`isbœnk
(
c
);

24  
c
;

26 
	}
}

	@ccan/ccan/str/test/compile_fail-iscntrl.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
is˙ål
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`is˙ål
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isdigit.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
isdigô
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`isdigô
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-islower.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
i¶owî
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`i¶owî
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isprint.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
i•röt
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`i•röt
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-ispunct.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
i•un˘
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`i•un˘
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isspace.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
is•a˚
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`is•a˚
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isupper.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
isuµî
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`isuµî
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-isxdigit.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_BUILTIN_TYPES_COMPATIBLE_P
 || !
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
isxdigô
.

14 
c
 = 
¨gv
[0][0];

16 #ifde‡
FAIL


18 
	`BUILD_ASSERT
(()255 < 0);

21  
	`isxdigô
(
c
);

22 
	}
}

	@ccan/ccan/str/test/compile_fail-strchr.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
°r°r
.

13 *
ªt
;

14 c⁄° *
°r
 = "hello";

16 
ªt
 = 
	`°rchr
(
°r
, 'l');

17  
ªt
 ? 0 : 1;

18 
	}
}

	@ccan/ccan/str/test/compile_fail-strrchr.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
°r°r
.

13 *
ªt
;

14 c⁄° *
°r
 = "hello";

16 
ªt
 = 
	`°ºchr
(
°r
, 'l');

17  
ªt
 ? 0 : 1;

18 
	}
}

	@ccan/ccan/str/test/compile_fail-strstr.c

1 
	#CCAN_STR_DEBUG
 1

	)

2 
	~<cˇn/°r/°r.h
>

4 
	$maö
(
¨gc
, *
¨gv
[])

6 #ifde‡
FAIL


7 #i‡!
HAVE_TYPEOF


8 #îr‹ 
We
 
√ed
 
ty≥of
 
to
 
check
 
°r°r
.

13 *
ªt
;

14 c⁄° *
°r
 = "hello";

16 
ªt
 = 
	`°r°r
(
°r
, "hell");

17  
ªt
 ? 0 : 1;

18 
	}
}

	@ccan/ccan/str/test/debug.c

4 
	#CCAN_STR_DEBUG
 1

	)

5 
	~<cˇn/°r/debug.c
>

	@ccan/ccan/str/test/run-STR_MAX_CHARS.c

1 
	~<cˇn/°r/°r.h
>

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<°döt.h
>

7 
	$maö
(
¨gc
, *
¨gv
[])

9 
°r
[1000];

11 
uöt8_t
 
u1byã
;

12 
öt8_t
 
s1byã
;

13 
uöt16_t
 
u2byã
;

14 
öt16_t
 
s2byã
;

15 
uöt32_t
 
u4byã
;

16 
öt32_t
 
s4byã
;

17 
uöt64_t
 
u8byã
;

18 
öt64_t
 
s8byã
;

19 *
±r
;

20 } 
ty≥s
;

22 
	`∂™_ã°s
(13);

24 
	`mem£t
(&
ty≥s
, 0xFF, (types));

27 
	`•rötf
(
°r
, "0x%Œx", ()
ty≥s
.
u1byã
);

28 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u1byã
));

29 
	`•rötf
(
°r
, "0x%Œx", ()
ty≥s
.
u2byã
);

30 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u2byã
));

31 
	`•rötf
(
°r
, "0x%Œx", ()
ty≥s
.
u4byã
);

32 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u4byã
));

33 
	`•rötf
(
°r
, "0x%Œx", ()
ty≥s
.
u8byã
);

34 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u8byã
));

37 
	`•rötf
(
°r
, "%u", 
ty≥s
.
u1byã
);

38 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u1byã
));

39 
	`•rötf
(
°r
, "%d", 
ty≥s
.
s1byã
);

40 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
s1byã
));

41 
	`•rötf
(
°r
, "%u", 
ty≥s
.
u2byã
);

42 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u2byã
));

43 
	`•rötf
(
°r
, "%d", 
ty≥s
.
s2byã
);

44 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
s2byã
));

45 
	`•rötf
(
°r
, "%u", 
ty≥s
.
u4byã
);

46 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u4byã
));

47 
	`•rötf
(
°r
, "%d", 
ty≥s
.
s4byã
);

48 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
s4byã
));

49 
	`•rötf
(
°r
, "%Œu", ()
ty≥s
.
u8byã
);

50 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
u8byã
));

51 
	`•rötf
(
°r
, "%Œd", ()
ty≥s
.
s8byã
);

52 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
s8byã
));

55 
	`•rötf
(
°r
, "%p", 
ty≥s
.
±r
);

56 
	`ok1
(
	`°æí
(
°r
Ë< 
	`STR_MAX_CHARS
(
ty≥s
.
±r
));

58  
	`exô_°©us
();

59 
	}
}

	@ccan/ccan/str/test/run.c

1 
	~<cˇn/°r/°r.h
>

2 
	~<cˇn/°r/°r.c
>

3 
	~<°dlib.h
>

4 
	~<°dio.h
>

5 
	~<cˇn/èp/èp.h
>

7 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ ◊º[0]))

	)

9 c⁄° *
	gsub°rögs
[] = { "far", "bar", "baz", "b", "ba", "z", "ar",

10 
NULL
 };

12 
	#NUM_SUBSTRINGS
 (
	`ARRAY_SIZE
(
sub°rögs
Ë- 1)

	)

14 *
	$°rdup_ªv
(c⁄° *
s
)

16 *
ªt
 = 
	`°rdup
(
s
);

17 
i
;

19 
i
 = 0; i < 
	`°æí
(
s
); i++)

20 
ªt
[
i
] = 
s
[
	`°æí
(s) - i - 1];

21  
ªt
;

22 
	}
}

24 
	$maö
(
¨gc
, *
¨gv
[])

26 
i
, 
j
, 
n
;

27 *
°rögs
[
NUM_SUBSTRINGS
 * NUM_SUBSTRINGS];

29 
n
 = 0;

30 
i
 = 0; i < 
NUM_SUBSTRINGS
; i++) {

31 
j
 = 0; j < 
NUM_SUBSTRINGS
; j++) {

32 
°rögs
[
n
] = 
	`mÆloc
(
	`°æí
(
sub°rögs
[
i
])

33 + 
	`°æí
(
sub°rögs
[
j
]) + 1);

34 
	`•rötf
(
°rögs
[
n
++], "%s%s",

35 
sub°rögs
[
i
], sub°rögs[
j
]);

39 
	`∂™_ã°s
(
n
 *Ç * 5 + 16);

40 
i
 = 0; i < 
n
; i++) {

41 
j
 = 0; j < 
n
; j++) {

42 
k
, 
idítiˇl
 = 0;

43 *
ªva
, *
ªvb
;

46 
k
 = 0; 
°rögs
[
i
][k]==°rögs[
j
][k]; k++) {

47 i‡(
k
 =
	`°æí
(
°rögs
[
i
])) {

48 
idítiˇl
 = 1;

53 i‡(
idítiˇl
)

54 
	`ok1
(
	`°ªq
(
°rögs
[
i
], såögs[
j
]));

56 
	`ok1
(!
	`°ªq
(
°rögs
[
i
], såögs[
j
]));

60 
ªva
 = 
	`°rdup_ªv
(
°rögs
[
i
]);

61 
ªvb
 = 
	`°rdup_ªv
(
°rögs
[
j
]);

63 i‡(!
°rögs
[
i
][
k
]) {

64 
	`ok1
(
	`°r°¨ts
(
°rögs
[
j
], såögs[
i
]));

65 
	`ok1
(
	`°ªnds
(
ªvb
, 
ªva
));

67 
	`ok1
(!
	`°r°¨ts
(
°rögs
[
j
], såögs[
i
]));

68 
	`ok1
(!
	`°ªnds
(
ªvb
, 
ªva
));

70 i‡(!
°rögs
[
j
][
k
]) {

71 
	`ok1
(
	`°r°¨ts
(
°rögs
[
i
], såögs[
j
]));

72 
	`ok1
(
	`°ªnds
(
ªva
, 
ªvb
));

74 
	`ok1
(!
	`°r°¨ts
(
°rögs
[
i
], såögs[
j
]));

75 
	`ok1
(!
	`°ªnds
(
ªva
, 
ªvb
));

77 
	`‰ì
(
ªva
);

78 
	`‰ì
(
ªvb
);

82 
i
 = 0; i < 
n
; i++)

83 
	`‰ì
(
°rögs
[
i
]);

85 
	`ok1
(
	`°ªq
(
	`°rögify
(
NUM_SUBSTRINGS
),

87 
	`ok1
(
	`°ªq
(
	`°rögify
(
	`ARRAY_SIZE
(
sub°rögs
)),

89 
	`ok1
(
	`°ªq
(
	`°rögify
(
i
 == 0), "i == 0"));

91 
	`ok1
(
	`°rcou¡
("aaaaaa", "b") == 0);

92 
	`ok1
(
	`°rcou¡
("aaaaaa", "a") == 6);

93 
	`ok1
(
	`°rcou¡
("aaaaaa", "aa") == 3);

94 
	`ok1
(
	`°rcou¡
("aaaaaa", "aaa") == 2);

95 
	`ok1
(
	`°rcou¡
("aaaaaa", "aaaa") == 1);

96 
	`ok1
(
	`°rcou¡
("aaaaaa", "aaaaa") == 1);

97 
	`ok1
(
	`°rcou¡
("aaaaaa", "aaaaaa") == 1);

98 
	`ok1
(
	`°rcou¡
("aaaáaa", "b") == 0);

99 
	`ok1
(
	`°rcou¡
("aaaáaa", "a") == 6);

100 
	`ok1
(
	`°rcou¡
("aaaáaa", "aa") == 2);

101 
	`ok1
(
	`°rcou¡
("aaaáaa", "aaa") == 2);

102 
	`ok1
(
	`°rcou¡
("aaaáaa", "aaaa") == 0);

103 
	`ok1
(
	`°rcou¡
("aaaáaa", "aaaaa") == 0);

105  
	`exô_°©us
();

106 
	}
}

	@ccan/ccan/str_talloc/str_talloc.c

2 
	~<uni°d.h
>

3 
	~<°döt.h
>

4 
	~<°rög.h
>

5 
	~<limôs.h
>

6 
	~<°dlib.h
>

7 
	~"°r_èŒoc.h
"

8 
	~<sys/ty≥s.h
>

9 
	~<ªgex.h
>

10 
	~<°d¨g.h
>

11 
	~<uni°d.h
>

12 
	~<cˇn/èŒoc/èŒoc.h
>

13 
	~<cˇn/°r/°r.h
>

15 **
	$°r•lô
(c⁄° *
˘x
, c⁄° *
°rög
, c⁄° *
dñims
)

17 **
löes
 = 
NULL
;

18 
max
 = 64, 
num
 = 0;

20 
löes
 = 
	`èŒoc_¨øy
(
˘x
, *, 
max
+1);

22 *
°rög
 != '\0') {

23 
Àn
 = 
	`°rc•n
(
°rög
, 
dñims
);

24 
löes
[
num
] = 
	`èŒoc_¨øy
÷öes, , 
Àn
 + 1);

25 
	`mem˝y
(
löes
[
num
], 
°rög
, 
Àn
);

26 
löes
[
num
][
Àn
] = '\0';

27 
°rög
 +
Àn
;

28 
°rög
 +
	`°r•n
(°rög, 
dñims
) ? 1 : 0;

29 i‡(++
num
 =
max
)

30 
löes
 = 
	`èŒoc_ªÆloc
(
˘x
,Üöes, *, 
max
*=2 + 1);

32 
löes
[
num
] = 
NULL
;

35  
	`èŒoc_ªÆloc
(
˘x
, 
löes
, *, 
num
+1);

36 
	}
}

38 *
	$°rjoö
(c⁄° *
˘x
, *
°rögs
[], c⁄° *
dñim
)

40 
i
;

41 *
ªt
 = 
	`èŒoc_°rdup
(
˘x
, "");

42 
size_t
 
tŸÀn
 = 0, 
dÀn
 = 
	`°æí
(
dñim
);

44 
i
 = 0; 
°rögs
[i]; i++) {

45 
size_t
 
Àn
 = 
	`°æí
(
°rögs
[
i
]);

46 
ªt
 = 
	`èŒoc_ªÆloc
(
˘x
,Ñë, , 
tŸÀn
 + 
Àn
 + 
dÀn
 + 1);

47 
	`mem˝y
(
ªt
 + 
tŸÀn
, 
°rögs
[
i
], 
Àn
);

48 
tŸÀn
 +
Àn
;

49 
	`mem˝y
(
ªt
 + 
tŸÀn
, 
dñim
, 
dÀn
);

50 
tŸÀn
 +
dÀn
;

52 
ªt
[
tŸÀn
] = '\0';

53  
ªt
;

54 
	}
}

56 
boﬁ
 
	$°ºeg
(c⁄° *
˘x
, c⁄° *
°rög
, c⁄° *
ªgex
, ...)

58 
size_t
 
nm©ch
 = 1 + 
	`°rcou¡
(
ªgex
, "(");

59 
ªgm©ch_t
 *
m©ches
 = 
	`èŒoc_¨øy
(
˘x
,Ñegm©ch_t, 
nm©ch
);

60 
ªgex_t
 
r
;

61 
boﬁ
 
ªt
;

63 i‡(!
m©ches
 || 
	`ªgcomp
(&
r
, 
ªgex
, 
REG_EXTENDED
) != 0)

64  
Ál£
;

66 i‡(
	`ªgexec
(&
r
, 
°rög
, 
nm©ch
, 
m©ches
, 0) == 0) {

67 
i
;

68 
va_li°
 
≠
;

70 
ªt
 = 
åue
;

71 
	`va_°¨t
(
≠
, 
ªgex
);

72 
i
 = 1; i < 
nm©ch
; i++) {

73 **
¨g
;

74 
¨g
 = 
	`va_¨g
(
≠
, **);

75 i‡(
¨g
) {

77 i‡(
m©ches
[
i
].
rm_so
 == -1)

78 *
¨g
 = 
NULL
;

80 *
¨g
 = 
	`èŒoc_°∫dup
(
˘x
,

81 
°rög
 + 
m©ches
[
i
].
rm_so
,

82 
m©ches
[
i
].
rm_eo


83 - 
m©ches
[
i
].
rm_so
);

84 i‡(!*
¨g
) {

85 
ªt
 = 
Ál£
;

91 
	`va_íd
(
≠
);

93 
ªt
 = 
Ál£
;

94 
	`èŒoc_‰ì
(
m©ches
);

95 
	`ªg‰ì
(&
r
);

96  
ªt
;

97 
	}
}

	@ccan/ccan/str_talloc/str_talloc.h

2 #i‚de‡
CCAN_STR_TALLOC_H


3 
	#CCAN_STR_TALLOC_H


	)

4 
	~<°rög.h
>

5 
	~<°dboﬁ.h
>

41 **
°r•lô
(c⁄° *
˘x
, c⁄° *
°rög
, c⁄° *
dñims
);

65 *
°rjoö
(c⁄° *
˘x
, *
°rögs
[], c⁄° *
dñim
);

108 
boﬁ
 
°ºeg
(c⁄° *
˘x
, c⁄° *
°rög
, c⁄° *
ªgex
, ...);

	@ccan/ccan/str_talloc/test/run-strreg.c

1 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

2 
	~<cˇn/°r_èŒoc/°r_èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
(
¨gc
, *
¨gv
[])

7 *
˘x
 = 
	`èŒoc_öô
("toplevel");

8 
t›_blocks
 = 
	`èŒoc_tŸÆ_blocks
(
˘x
);

9 *
a
, *
b
;

11 **
övÆid
 = (**)1L;

13 
	`∂™_ã°s
(25);

15 
	`ok1
(
	`°ºeg
(
˘x
, "hñlÿw‹ld!", "hñlo"Ë=
åue
);

16 
	`ok1
(
	`°ºeg
(
˘x
, "hñlÿw‹ld!", "hi"Ë=
Ál£
);

19 
	`ok1
(
	`°ºeg
(
˘x
, "hñlÿw‹ld!", "hñlo", 
övÆid
Ë=
åue
);

20 
	`ok1
(
	`°ºeg
(
˘x
, "hñlÿw‹ld!", "hi", 
övÆid
Ë=
Ál£
);

22 
	`ok1
(
	`°ºeg
(
˘x
, "hñlÿw‹ld!", "[a-z]+", 
övÆid
Ë=
åue
);

23 
	`ok1
(
	`°ºeg
(
˘x
, "hñlÿw‹ld!", "([a-z]+)", &
a
, 
övÆid
Ë=
åue
);

25 
	`ok1
(
	`°ªq
(
a
, "hello"));

27 
	`ok1
(
	`èŒoc_föd_∑ª¡_by«me
(
a
, "t›Àvñ"Ë=
˘x
);

28 
	`èŒoc_‰ì
(
a
);

30 
	`ok1
(
	`°ºeg
(
˘x
, "hello world!", "([a-z]*) ([a-z]+)",

31 &
a
, &
b
, 
övÆid
Ë=
åue
);

32 
	`ok1
(
	`°ªq
(
a
, "hello"));

33 
	`ok1
(
	`°ªq
(
b
, "world"));

34 
	`ok1
(
	`èŒoc_föd_∑ª¡_by«me
(
a
, "t›Àvñ"Ë=
˘x
);

35 
	`ok1
(
	`èŒoc_föd_∑ª¡_by«me
(
b
, "t›Àvñ"Ë=
˘x
);

36 
	`èŒoc_‰ì
(
a
);

37 
	`èŒoc_‰ì
(
b
);

40 
	`ok1
(
	`°ºeg
(
˘x
, "hello world!", "([a-z])* ([a-z]+)",

41 &
a
, &
b
, 
övÆid
Ë=
åue
);

42 
	`ok1
(
	`°ªq
(
a
, "o"));

43 
	`ok1
(
	`°ªq
(
b
, "world"));

44 
	`èŒoc_‰ì
(
a
);

45 
	`èŒoc_‰ì
(
b
);

48 
	`ok1
(
	`°ºeg
(
˘x
, "hello world!", "(([a-z]*) world)",

49 &
a
, &
b
, 
övÆid
Ë=
åue
);

50 
	`ok1
(
	`°ªq
(
a
, "hello world"));

51 
	`ok1
(
	`°ªq
(
b
, "hello"));

52 
	`èŒoc_‰ì
(
a
);

53 
	`èŒoc_‰ì
(
b
);

56 
	`ok1
(
	`°ºeg
(
˘x
, "hello world!", "(([a-z]*) world)",

57 &
a
, &
b
, 
övÆid
Ë=
åue
);

58 
	`ok1
(
	`°ªq
(
a
, "hello world"));

59 
	`ok1
(
	`°ªq
(
b
, "hello"));

60 
	`èŒoc_‰ì
(
a
);

61 
	`èŒoc_‰ì
(
b
);

64 
	`ok1
(
	`°ºeg
(
˘x
, "hello world!", "((hello|goodbye) world)",

65 &
a
, 
NULL
, 
övÆid
Ë=
åue
);

66 
	`ok1
(
	`°ªq
(
a
, "hello world"));

67 
	`èŒoc_‰ì
(
a
);

70 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
˘x
Ë=
t›_blocks
);

71 
	`èŒoc_‰ì
(
˘x
);

72 
	`èŒoc_dißbÀ_nuŒ_åackög
();

74  
	`exô_°©us
();

75 
	}
}

	@ccan/ccan/str_talloc/test/run.c

1 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<cˇn/°r_èŒoc/°r_èŒoc.c
>

5 
	~<cˇn/èp/èp.h
>

7 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ ◊º[0]))

	)

9 c⁄° *
	gsub°rögs
[]

10 { "Ár", "b¨", "baz", "b", "ba", "z", "¨", 
NULL
 };

12 
	$maö
(
¨gc
, *
¨gv
[])

14 **
•lô
, *
°r
;

15 *
˘x
;

17 
	`∂™_ã°s
(16);

18 
•lô
 = 
	`°r•lô
(
NULL
, "hello world", " ");

19 
	`ok1
(
	`èŒoc_¨øy_Àngth
(
•lô
) == 4);

20 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

21 
	`ok1
(!
	`°rcmp
(
•lô
[1], ""));

22 
	`ok1
(!
	`°rcmp
(
•lô
[2], "world"));

23 
	`ok1
(
•lô
[3] =
NULL
);

24 
	`èŒoc_‰ì
(
•lô
);

26 
•lô
 = 
	`°r•lô
(
NULL
, "hello world", "o ");

27 
	`ok1
(
	`èŒoc_¨øy_Àngth
(
•lô
) == 6);

28 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hell"));

29 
	`ok1
(!
	`°rcmp
(
•lô
[1], ""));

30 
	`ok1
(!
	`°rcmp
(
•lô
[2], ""));

31 
	`ok1
(!
	`°rcmp
(
•lô
[3], "w"));

32 
	`ok1
(!
	`°rcmp
(
•lô
[4], "rld"));

33 
	`ok1
(
•lô
[5] =
NULL
);

35 
˘x
 = 
•lô
;

36 
•lô
 = 
	`°r•lô
(
˘x
, "hello world", "o ");

37 
	`ok1
(
	`èŒoc_∑ª¡
(
•lô
Ë=
˘x
);

38 
	`èŒoc_‰ì
(
˘x
);

40 
°r
 = 
	`°rjoö
(
NULL
, (**)
sub°rögs
, ", ");

41 
	`ok1
(!
	`°rcmp
(
°r
, "far, bar, baz, b, ba, z,ár, "));

42 
˘x
 = 
°r
;

43 
°r
 = 
	`°rjoö
(
˘x
, (**)
sub°rögs
, "");

44 
	`ok1
(!
	`°rcmp
(
°r
, "farbarbazbbazar"));

45 
	`ok1
(
	`èŒoc_∑ª¡
(
°r
Ë=
˘x
);

46 
	`èŒoc_‰ì
(
˘x
);

48  
	`exô_°©us
();

49 
	}
}

	@ccan/ccan/stringmap/stringmap.c

32 
	~<cˇn/°rögm≠/°rögm≠.h
>

37 
	~<as£π.h
>

39 
	#as£π
(...Ëdÿ{} 0)

	)

42 
	#PEEK_BIT
(
key
, 
bô
Ë((key[bô >> 3] >> (~bô & 7)Ë& 1)

	)

44 
	s°rögm≠_node
 {

45 
uöt32_t
 
	mÀ·_is_Àaf
:1, 
	mright_is_Àaf
:1, 
	mbôno
:30;

46 
°rögm≠_node
 *
	mÃ
[2];

49 
	sT
 {

50 *
	m°r
;

51 
size_t
 
	mÀn
;

54 
ölöe
 
T
 *
	$Àaf
(
°rögm≠_node
 *
n
, 
Ã
) {

55 
	`as£π
(
Ã
 ? 
n
->
right_is_Àaf
 :Ç->
À·_is_Àaf
);

56  (
T
*)
n
->
Ã
[lr];

57 
	}
}

61 
ölöe
 
	$À·_íds
(
°rögm≠_node
 *
n
) {

62  (
n
->
À·_is_Àaf
 && (
	`Àaf
“,0)->
Àn
 << 3)=Ú->
bôno
);

63 
	}
}

65 *
	$T_√w
(
block_poﬁ
 *
bp
, c⁄° *
key
, 
size_t
 
Àn
, size_à
T_size
) {

66 
T
 *
Àaf
 = 
	`block_poﬁ_Æloc
(
bp
, 
T_size
);

67 
	`mem£t
(
Àaf
, 0, 
T_size
);

69 
Àaf
->
°r
 = 
	`block_poﬁ_Æloc_Æign
(
bp
, 
Àn
+1, 1);

70 
	`mem˝y
(
Àaf
->
°r
, 
key
, 
Àn
);

71 
Àaf
->
°r
[
Àn
] = 0;

72 
Àaf
->
Àn
 =Üen;

74  
Àaf
;

75 
	}
}

78 
c⁄si°ícy_check
(
°rögm≠
 *
t
);

79 
emô_dŸ
(
°rögm≠
 *
t
);

80 
emô_subåì
(
°rögm≠_node
 *
n
, 
is_Àaf
);

82 *
	$°rögm≠_lookup_ªÆ
(
°rögm≠
 *
t
, c⁄° *
key
, 
size_t
 
Àn
, 
íãrf
, size_à
T_size
) {

83 
T
 *
•
;

84 
°rögm≠_node
 *
w
, *
√w
, *
œ°
;

85 
uöt32_t
 
cix
, 
bô
, 
svbô
, 
ix
, 
bôno
, 
íd_bô
;

86 c⁄° *
k
, *
m
;

88 (Ë
c⁄si°ícy_check
;

89 (Ë
emô_dŸ
;

90 #ifde‡
STRINGMAP_EMIT_DOT


91 
	`emô_dŸ
(
t
);

93 #ifde‡
CONSISTENCY_CHECK


94 
	`c⁄si°ícy_check
(
t
);

98 i‡(
Àn
 =(
size_t
)-1)

99 
Àn
 = 
	`°æí
(
key
);

100 
íd_bô
 = 
Àn
 << 3;

103 i‡(!
t
->
roŸ
) {

104 i‡(!
íãrf
)

105  
NULL
;

107 
t
->
bp
 = 
	`block_poﬁ_√w
(t->bp);

109 
t
->
roŸ
 = 
	`T_√w
—->
bp
, 
key
, 
Àn
, 
T_size
);

110 
t
->
cou¡
 = 1;

112  
t
->
roŸ
;

116 i‡(
t
->
cou¡
 == 1) {

117 
w
 = 
t
->
roŸ
;

118 
svbô
 = 0;

120 
w
 = 
t
->
roŸ
;

122 i‡(!
	`À·_íds
(
w
))

123 
bô
 = 
w
->
bôno
 < 
íd_bô
 ? 
	`PEEK_BIT
(
key
, w->bitno) : 0;

125 
bô
 = (
w
->
bôno
 !
íd_bô
);

126 
svbô
 = 
bô
 ? 
w
->
right_is_Àaf
 : w->
À·_is_Àaf
;

127 
w
 = w->
Ã
[
bô
];

128 i‡(
svbô
)

136 
•
 = (
T
 *)
w
;

137 
m
 = 
•
->
°r
;

138 
k
 = 
key
;

139 
cix
 = 0; ; 
m
++, 
k
++, cix++) {

140 i‡(
cix
>=
•
->
Àn
 || cix>=len) {

141 i‡(
cix
==
•
->
Àn
 && cix==len) {

144  
•
;

146 
cix
 <<= 3;

149 
bô
 = 
Àn
 > 
•
->len;

153 i‡(*
m
 !*
k
) {

154 
cix
 <<= 3;

157 
ix
 = *
m
 ^ *
k
;

158 (
ix
 & 128) == 0)

159 
ix
 <<1, 
cix
++;

162 
bô
 = 
	`PEEK_BIT
(
key
, 
cix
);

168 i‡(!
íãrf
)

169  
NULL
;

172 
√w
 = 
	`block_poﬁ_Æloc
(
t
->
bp
,  *new);

174 
√w
->
right_is_Àaf
 = 
bô
;

175 
√w
->
À·_is_Àaf
 = !
bô
;

176 
√w
->
bôno
 = 
cix
;

178 
√w
->
Ã
[
bô
] = 
	`T_√w
(
t
->
bp
, 
key
, 
Àn
, 
T_size
);

180 i‡(
t
->
cou¡
++ == 1) {

181 
√w
->
Ã
[!
bô
] = 
t
->
roŸ
;

182 
√w
->
right_is_Àaf
 = 1;

183 
√w
->
À·_is_Àaf
 = 1;

184 
t
->
roŸ
 = 
√w
;

185  (
T
 *)
√w
->
Ã
[
bô
];

188 
w
 = 
t
->
roŸ
;

189 
œ°
 = 
NULL
;

191 
bôno
 = 
w
->bitno;

192 i‡(
bôno
 > 
cix
)

195 i‡(!
	`À·_íds
(
w
)) {

196 i‡(
bôno
 =
cix
)

198 
svbô
 = 
	`PEEK_BIT
(
key
, 
bôno
);

202 
svbô
 = 1;

205 
œ°
 = 
w
;

206 
w
 = w->
Ã
[
svbô
];

207 i‡(
svbô
 ? 
œ°
->
right_is_Àaf
 :Üa°->
À·_is_Àaf
) {

209 i‡(!
bô
)

210 
√w
->
right_is_Àaf
 = 1;

212 
√w
->
À·_is_Àaf
 = 1;

218 
√w
->
Ã
[!
bô
] = 
w
;

219 i‡(
œ°
 =
NULL
) {

220 
t
->
roŸ
 = 
√w
;

222 
œ°
->
Ã
[
svbô
] = 
√w
;

223 i‡(
svbô
)

224 
œ°
->
right_is_Àaf
 = 0;

226 
œ°
->
À·_is_Àaf
 = 0;

229  (
T
 *)
√w
->
Ã
[
bô
];

230 
	}
}

232 
	$c⁄si°ícy_check_subåì
(
°rögm≠_node
 *
n
) {

233 
uöt32_t
 
bôno
 = 
n
->bitno;

234 
suc˚ss
 = 1;

237 i‡(!
n
->
À·_is_Àaf
 && 
bôno
 >n->
Ã
[0]->bitno) {

238 
	`¥ötf
("LeftÜeaf has bitno >=ÅhanÖarent\n");

239 
suc˚ss
 = 0;

241 i‡(!
n
->
right_is_Àaf
 && 
bôno
 >n->
Ã
[1]->bitno) {

242 i‡(
	`À·_íds
(
n
Ë&& 
bôno
 =n->
Ã
[1]->bitno) {

245 
	`¥ötf
("RightÜeaf has bitno >=ÅhanÖarent\n");

246 
suc˚ss
 = 0;

251 i‡(
n
->
À·_is_Àaf
) {

252 
T
 *
lf
 = 
	`Àaf
(
n
, 0);

253 
size_t
 
Àn
 = 
lf
->len << 3;

254 i‡(
Àn
 =
n
->
bôno
) {

256 } i‡(
Àn
 <
n
->
bôno
) {

257 
	`¥ötf
("LeftÜeaf isÅoo short\n");

258 
suc˚ss
 = 0;

259 } i‡(
	`PEEK_BIT
(
lf
->
°r
, 
n
->
bôno
) == 1) {

260 
	`¥ötf
("LeftÜeaf has incorrect bit\n");

261 
suc˚ss
 = 0;

264 i‡(
n
->
right_is_Àaf
) {

265 
T
 *
lf
 = 
	`Àaf
(
n
, 1);

266 
size_t
 
Àn
 = 
lf
->len << 3;

267 i‡(
Àn
 <
n
->
bôno
) {

268 
	`¥ötf
("RightÜeaf isÅoo short\n");

269 
suc˚ss
 = 0;

270 } i‡(
	`PEEK_BIT
(
lf
->
°r
, 
n
->
bôno
Ë=0 && !
	`À·_íds
(n)) {

271 
	`¥ötf
("RightÜeaf has incorrect bit\n");

272 
suc˚ss
 = 0;

276 i‡(!
suc˚ss
) {

278 
	`ab‹t
();

282  (!
n
->
À·_is_Àaf
 ? 
	`c⁄si°ícy_check_subåì
“->
Ã
[0]) : 1) &&

283 (!
n
->
right_is_Àaf
 ? 
	`c⁄si°ícy_check_subåì
“->
Ã
[1]) : 1);

284 
	}
}

286 
	$c⁄si°ícy_check
(
°rögm≠
 *
t
) {

287 i‡(
t
->
cou¡
 < 2)

289  
	`c⁄si°ícy_check_subåì
(
t
->
roŸ
);

290 
	}
}

294 
	$Àaf_to_dŸ
(*
Õ
, 
FILE
 *
f
) {

295 
T
 *
Àaf
 = 
Õ
;

296 
size_t
 
bô_cou¡
 = 
Àaf
->
Àn
 << 3;

297 
size_t
 
i
;

299 
	`Âuts
("\"", 
f
);

301 
i
=0; i<
bô_cou¡
; i++) {

302 
	`putc
(
	`PEEK_BIT
(
Àaf
->
°r
, 
i
Ë? '1' : '0', 
f
);

303 i‡(((
i
+1) & 7) == 0)

304 
	`Âuts
("\\n", 
f
);

306 
	`putc
(' ', 
f
);

308 
	`Ârötf
(
f
, "(%s)\"\n", 
Àaf
->
°r
);

309 
	}
}

311 
	$node_to_dŸ
(
°rögm≠_node
 *
n
, 
FILE
 *
f
, 
size_t
 
Àvñ
) {

313 i‡(
Àvñ
 > 4)

316 
	`Ârötf
(
f
, "%zu [œbñ=\"[%zu] %u\"]\n", (
size_t
)
n
, 
Àvñ
,Ç->
bôno
);

318 i‡(
n
->
À·_is_Àaf
) {

319 
	`Ârötf
(
f
, "%zu -> ", (
size_t
)
n
);

320 
	`Àaf_to_dŸ
(
n
->
Ã
[0], 
f
);

322 
	`Ârötf
(
f
, "%zu -> %zu \n", (
size_t
)
n
, (size_tÍ->
Ã
[0]);

323 
	`node_to_dŸ
(
n
->
Ã
[0], 
f
, 
Àvñ
+1);

326 i‡(
n
->
right_is_Àaf
) {

327 
	`Ârötf
(
f
, "%zu -> ", (
size_t
)
n
);

328 
	`Àaf_to_dŸ
(
n
->
Ã
[1], 
f
);

330 
	`Ârötf
(
f
, "%zu -> %zu \n", (
size_t
)
n
, (size_tÍ->
Ã
[1]);

331 
	`node_to_dŸ
(
n
->
Ã
[1], 
f
, 
Àvñ
+1);

333 
	}
}

335 
	$°rögm≠_subåì_to_dŸ
(
°rögm≠_node
 *
n
, 
is_Àaf
, c⁄° *
fûíame_out
) {

336 
FILE
 *
f
 = 
	`f›í
(
fûíame_out
, "w");

338 
	`Âuts
("digøph G {\n", 
f
);

340 i‡(
is_Àaf
)

341 
	`Àaf_to_dŸ
(
n
, 
f
);

343 
	`node_to_dŸ
(
n
, 
f
, 0);

345 
	`Âuts
("}\n", 
f
);

346 
	`f˛o£
(
f
);

347 
	}
}

349 
size_t
 
	gdŸ_fûe_numbî
 = 0;

351 
	$emô_subåì
(
°rögm≠_node
 *
n
, 
is_Àaf
) {

352 
buf
[64];

353 
	`•rötf
(
buf
, "dŸ/%04zu.dŸ", 
dŸ_fûe_numbî
++);

354 
	`°rögm≠_subåì_to_dŸ
(
n
, 
is_Àaf
, 
buf
);

355 
	}
}

357 
	$emô_dŸ
(
°rögm≠
 *
t
) {

358 i‡(
t
->
cou¡
)

359 
	`emô_subåì
(
t
->
roŸ
,Å->
cou¡
==1);

360 
	}
}

	@ccan/ccan/stringmap/stringmap.h

29 #i‚de‡
CCAN_STRINGMAP_H


30 
	#CCAN_STRINGMAP_H


	)

32 
	~<cˇn/block_poﬁ/block_poﬁ.h
>

33 
	~<°döt.h
>

35 
	#°rögm≠
(
theTy≥
Ë°ru˘ {
°rögm≠
 
t
; såu˘ {*
°r
; 
size_t
 
Àn
;ÅheTy≥ 
vÆue
;} *
œ°
;}

	)

38 
	#°rögm≠_√w
(
˘x
Ë{{0,0,(
block_poﬁ
*)(˘x)},0}

	)

39 
	#°rögm≠_öô
(
sm
, 
˘x
) do { \

40 (
sm
).
t
.
roŸ
 = 0; \

41 (
sm
).
t
.
cou¡
 = 0; \

42 (
sm
).
t
.
bp
 = (
block_poﬁ
*)(
˘x
); \

43 (
sm
).
œ°
 = 0; \

44 } 0)

	)

45 
	#°rögm≠_‰ì
(
sm
) do { \

46 i‡((
sm
).
t
.
roŸ
) \

47 
	`block_poﬁ_‰ì
((
sm
).
t
.
bp
); \

48 } 0)

	)

50 
	#°rögm≠_lookup
(
sm
, 
key
Ë
	`°rögm≠_À
(sm, key, 0)

	)

51 
	#°rögm≠_íãr
(
sm
, 
key
Ë
	`°rögm≠_À
(sm, key, 1)

	)

56 
	#°rögm≠_lookup_n
(
sm
, 
key
, 
Àn
Ë
	`°rögm≠_À_n
(sm, key,Üí, 0)

	)

57 
	#°rögm≠_íãr_n
(
sm
, 
key
, 
Àn
Ë
	`°rögm≠_À_n
(sm, key,Üí, 1)

	)

59 
	#°rögm≠_À
(
sm
, 
key
, 
íãrf
Ë
	`°rögm≠_À_n
(sm, key, (
size_t
)-1,É¡îf)

	)

62 
	#°rögm≠_À_n
(
sm
, 
key
, 
Àn
, 
íãrf
Ë((((sm).
œ°
Ë
	`°rögm≠_lookup_ªÆ
(&(sm).
t
, key,Üí,É¡îf, (*(sm).œ°))Ë? &(sm).œ°->
vÆue
 : 
NULL
)

	)

65 
	g°rögm≠_node
;

67 
	s°rögm≠
 {

68 
°rögm≠_node
 *
	mroŸ
;

69 
size_t
 
	mcou¡
;

70 
block_poﬁ
 *
	mbp
;

74 *
°rögm≠_lookup_ªÆ
(
°rögm≠
 *
t
, c⁄° *
key
, 
size_t
 
Àn
, 
íãrf
, size_à
T_size
);

	@ccan/ccan/stringmap/test/run.c

1 
	~<cˇn/°rögm≠/°rögm≠.h
>

2 
	~<cˇn/°rögm≠/°rögm≠.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$ã°_åivül
() {

7 
	`°rögm≠
(Ë
m≠
 = 
	`°rögm≠_√w
(
NULL
);

9 
	`ok1
(
	`°rögm≠_lookup
(
m≠
, ""Ë=
NULL
);

10 *
	`°rögm≠_íãr
(
m≠
, "") = -1;

12 
	`ok1
(
	`°rögm≠_lookup
(
m≠
, "0"Ë=
NULL
);

13 *
	`°rögm≠_íãr
(
m≠
, "0") = 0;

15 
	`ok1
(
	`°rögm≠_lookup
(
m≠
, "⁄e"Ë=
NULL
);

16 *
	`°rögm≠_íãr
(
m≠
, "one") = 1;

18 
	`ok1
(
	`°rögm≠_lookup
(
m≠
, "two"Ë=
NULL
);

19 *
	`°rögm≠_íãr
(
m≠
, "two") = 2;

21 
	`ok1
(
	`°rögm≠_lookup
(
m≠
, "thªe"Ë=
NULL
);

22 *
	`°rögm≠_íãr
(
m≠
, "three") = 3;

24 
	`ok1
(
	`°rögm≠_lookup
(
m≠
, "four"Ë=
NULL
);

25 *
	`°rögm≠_íãr
(
m≠
, "four") = 4;

27 
	`ok1
(*
	`°rögm≠_lookup
(
m≠
, "three") == 3);

28 
	`ok1
(*
	`°rögm≠_lookup
(
m≠
, "one") == 1);

29 
	`ok1
(*
	`°rögm≠_lookup
(
m≠
, "four") == 4);

30 
	`ok1
(*
	`°rögm≠_lookup
(
m≠
, "two") == 2);

31 
	`ok1
(*
	`°rögm≠_lookup
(
m≠
, "") == -1);

32 
	`ok1
(*
	`°rögm≠_lookup
(
m≠
, "0") == 0);

34 
	`ok1
(
m≠
.
t
.
cou¡
 == 6);

36 
	`°rögm≠_‰ì
(
m≠
);

37 
	}
}

40 
	$s¸ambÀ
(*
ba£
, 
size_t
 
nmemb
, size_à
size
) {

41 *
i
 = 
ba£
;

42 *
o
;

43 
size_t
 
sd
;

44 ;
nmemb
>1;nmemb--) {

45 
o
 = 
i
 + 
size
*(
	`øndom
()%
nmemb
);

46 
sd
=
size
;sd--;) {

47 
tmp
 = *
o
;

48 *
o
++ = *
i
;

49 *
i
++ = 
tmp
;

52 
	}
}

56 *
	$øndom_°rög
(
block_poﬁ
 *
bp
, 
size_t
 *
Àn_out
) {

57 #i‚de‡
RANDOM_STRING_READABLE


58 
size_t
 
Àn
 = 
	`øndom
()%5 ?Ñandom()%10 :Ñandom()%1000;

60 
size_t
 
Àn
 = 
	`øndom
() % 10;

62 *
°r
 = 
	`block_poﬁ_Æloc
(
bp
, 
Àn
);

63 *
i
;

65 *
Àn_out
 = 
Àn
;

67 
i
=
°r
; 
Àn
--; i++) {

68 #i‚de‡
RANDOM_STRING_READABLE


69 
c
 = 
	`øndom
();

70 *
i
 = 
c
;

73 
c
 = 
	`øndom
()%26 + 'a';

74 *
i
 = 
c
;

78  
°r
;

79 
	}
}

81 
	sã°_íåy
 {

83 c⁄° *
	m°r
;

84 
size_t
 
	mÀn
;

86 *
	mvÆue
;

91 
	$ãcmp
(c⁄° 
ã°_íåy
 *
≠
, c⁄° ã°_íåy *
bp
) {

92 c⁄° *
a
 = (*)
≠
->
°r
, *
´
 =á+≠->
Àn
;

93 c⁄° *
b
 = (*)
bp
->
°r
, *
be
 = b+bp->
Àn
;

95 ;;
a
++, 
b
++) {

96 i‡(
a
 >
´
) {

97 i‡(
b
 >
be
)

101 i‡(
b
 >
be
)

103 i‡(*
a
 !*
b
)

104  ()*
a
 - ()*
b
;

106 
	}
}

108 
	$by_°r
(c⁄° *
a
, c⁄° *
b
) {

109  
	`ãcmp
(
a
, 
b
);

110 
	}
}

112 
	$cuŒ_du∂iˇãs
(
ã°_íåy
 *
íåõs
, 
size_t
 *
cou¡
) {

113 
ã°_íåy
 *
i
, *
o
, *
e
 = 
íåõs
 + *
cou¡
;

115 
	`qs‹t
(
íåõs
, *
cou¡
, (*íåõs), 
by_°r
);

117 
i
=
íåõs
, 
o
Û¡rõs; i<
e
;) {

119 i‡(
o
>
íåõs
) {

120 
ã°_íåy
 *
œ°
 = &
o
[-1];

121 i‡(!
	`ãcmp
(
œ°
, 
i
)) {

122 dÿ
i
++; i<
e
 && !
	`ãcmp
(
œ°
, i));

129 *
vÆue
 = 
i
->value;

130 dÿ*
o
++ = *
i
++; i<
e
 && i->
vÆue
 == value);

134 *
cou¡
 = 
o
-
íåõs
;

135 
	}
}

137 
	#¥öt
(
èg
, 
fmt
, ...) do { \

138 i‡(
out
) \

139 
	`Ârötf
(
out
, 
èg
 
fmt
 "\n", ##
__VA_ARGS__
); \

140 } 0)

	)

141 
	#îr
(...) do { \

142 
	`¥öt
("îr‹: ", 
__VA_ARGS__
); \

143 
Áû
; \

144 } 0)

	)

146 
	#debug
(...Ëdÿ{} 0)

	)

147 
	#msg
(...Ë
	`¥öt
("öfo: ", 
__VA_ARGS__
)

	)

149 
	$ã°_åavî£
(
°rögm≠
 *
m≠
, 
ã°_íåy
 *
°rögs
, 
size_t
 
size
, 
FILE
 *
out
) {

150 
size_t
 
•
 = 0;

151 
size_t
 
°ack_Æloc
 = 16;

152 
°rögm≠_node
 **
°ack
 = 
NULL
;

153 
°rögm≠_node
 *
n
;

154 *
Àaf
;

155 
	#check
(
Ãi
) do { \

156 
Àaf
 = 
n
->
Ã
[
Ãi
]; \

157 i‡(!
size
--) \

158 
	`îr
("Fewer items inÅreeÅhan counted"); \

159 i‡(
	`ãcmp
(
Àaf
, 
°rögs
++)) \

160 
	`îr
("%†Àa‡ha†öc‹ª˘ såög", 
Ãi
 ? "Left" : "Right"); \

161 } 0)

	)

162 
	#check_À·
(Ë
	`check
(0)

	)

163 
	#check_right
(Ë
	`check
(1)

	)

165 i‡(
m≠
->
cou¡
 !
size
)

166 
	`îr
("map->count != size");

168 i‡(
m≠
->
cou¡
 == 0)

171 i‡(
m≠
->
cou¡
 == 1) {

172 
Àaf
 = (
ã°_íåy
*)
m≠
->
roŸ
;

173 i‡(!
	`ãcmp
(
Àaf
, &
°rögs
[0]))

176 
	`îr
("OnlyÜeaf inÅree has incorrect value");

179 
°ack
 = 
	`mÆloc
((*°ackË* 
°ack_Æloc
);

180 
n
 = 
m≠
->
roŸ
;

184 !
n
->
À·_is_Àaf
) {

185 
°ack
[
•
++] = 
n
;

186 
n
 =Ç->
Ã
[0];

188 i‡(
•
 >
°ack_Æloc
) {

189 
°ack_Æloc
 += stack_alloc;

190 
°ack
 = 
	`ªÆloc
(°ack, (*°ackË* 
°ack_Æloc
);

194 
	`check_À·
();

196 
as˚nd_right
:

197 
n
->
right_is_Àaf
) {

198 
	`check_right
();

200 i‡(!
•
)

201 
d⁄e
;

202 
n
 = 
°ack
[--
•
];

206 
n
 =Ç->
Ã
[1];

207 
n
->
À·_is_Àaf
) {

208 
	`check_À·
();

210 i‡(
n
->
right_is_Àaf
) {

211 
	`check_right
();

213 i‡(!
•
)

214 
d⁄e
;

215 
n
 = 
°ack
[--
•
];

216 
as˚nd_right
;

218 
n
 =Ç->
Ã
[1];

222 
d⁄e
:

223 i‡(
size
 != 0)

224 
	`îr
("More items inÅreeÅhan counted");

226 
	`‰ì
(
°ack
);

229 
Áû
:

230 i‡(
°ack
)

231 
	`‰ì
(
°ack
);

234 #unde‡
check


235 #unde‡
check_À·


236 #unde‡
check_right


237 
	}
}

239 
	$ã°_°rögm≠
(
size_t
 
cou¡
, 
FILE
 *
out
) {

240 
	`°rögm≠
(*Ë
m≠
 = 
	`°rögm≠_√w
(
NULL
);

242 
block_poﬁ
 *
bp
 = 
	`block_poﬁ_√w
(
NULL
);

243 
ã°_íåy
 *
íåõs
 = 
	`block_poﬁ_Æloc
(
bp
, (*íåõsË* 
cou¡
);

244 
ã°_íåy
 *
i
, *
e
 = 
íåõs
+
cou¡
, *
o
;

245 *
vÆue_ba£
 = 
	`block_poﬁ_Æloc
(
bp
, 
cou¡
), *
vÆue
 = value_base;

246 
size_t
 
unique_cou¡
 = 0;

249 
	`mem£t
(
vÆue
, 0, 
cou¡
);

251 
	`msg
("Gíî©ög %zuÅe°É¡rõs...", 
cou¡
);

253 
i
=
íåõs
; i<
e
; 
vÆue
++) {

254 
size_t
 
Àn
;

255 *
°r
 = 
	`øndom_°rög
(
bp
, &
Àn
);

256 
size_t
 
ßme_cou¡
 = (
	`øndom
()%5 ?Ñandom()%3 :Ñandom()%10) + 1;

258 ;
ßme_cou¡
-- && 
i
<
e
; i++) {

259 
i
->
°r
 = str;

260 
i
->
Àn
 =Üen;

261 
i
->
vÆue
 = value;

265 
	`cuŒ_du∂iˇãs
(
íåõs
, &
cou¡
);

266 
e
 = 
íåõs
+
cou¡
;

267 
	`s¸ambÀ
(
íåõs
, 
cou¡
, (*entries));

269 
	`msg
("In£πög/lookög u∞%zuÉ¡rõs...", 
cou¡
);

271 
i
=
íåõs
, 
o
Û¡rõs; i<
e
; i++) {

272 **
node
;

274 
	`debug
("Lookög u∞%s", 
i
->
°r
);

276 
node
 = 
	`°rögm≠_lookup_n
(
m≠
, 
i
->
°r
, i->
Àn
);

278 i‡(!
node
) {

279 i‡(*
i
->
vÆue
)

280 
	`îr
("Previously insertedÉntryÇot found");

282 
	`debug
("NŸ found;É¡îög %s", 
i
->
°r
);

284 
node
 = 
	`°rögm≠_íãr_n
(
m≠
, 
i
->
°r
, i->
Àn
);

285 i‡(!
node
 || 
	`ãcmp
(
i
, (*)
m≠
.
œ°
))

286 
	`îr
("NodeÇotÖroperlyÉntered");

287 i‡(
m≠
.
œ°
->
°r
[m≠.œ°->
Àn
])

288 
	`îr
("Entered stringÇot zero-terminated");

289 *
node
 = 
i
->
vÆue
;

290 *
i
->
vÆue
 = 1;

293 *
o
++ = *
i
;

295 i‡(
	`ãcmp
(
i
, (*)
m≠
.
œ°
))

296 
	`îr
("lookupÑeturned incorrect string");

297 i‡(
m≠
.
œ°
->
°r
[m≠.œ°->
Àn
])

298 
	`îr
("Looked-up stringÇot zero-terminated");

299 i‡(
i
->
vÆue
 !*
node
)

300 
	`îr
("lookupÑeturned incorrect value");

301 i‡(!*
i
->
vÆue
)

302 
	`îr
("lookupÑeturned bogus value");

306 
unique_cou¡
 = 
o
-
íåõs
;

308 i‡(
m≠
.
t
.
cou¡
 !
unique_cou¡
)

309 
	`îr
("Map has incorrect count");

311 
	`qs‹t
(
íåõs
, 
unique_cou¡
, (*íåõs), 
by_°r
);

313 
	`msg
("Tøvîsög f‹w¨dÅhrough %zu iãms", 
unique_cou¡
);

314 i‡(!
	`ã°_åavî£
(&
m≠
.
t
, 
íåõs
, 
unique_cou¡
, 
out
))

315 
	`îr
("Traversal doesÇotÖroduceÅhe strings in order");

317 
	`¥ötf
("stringmapÅestÖassedáfter %zu inserts, %zuÜookups (%zuÅotal operations)\n",

318 
unique_cou¡
, (
i
-
íåõs
)-unique_count, i-entries);

320 
	`block_poﬁ_‰ì
(
bp
);

321 
	`°rögm≠_‰ì
(
m≠
);

324 
Áû
:

325 
	`¥ötf
("stringmapÅest failedáfter %zu inserts, %zuÜookups (%zuÅotal operations)\n",

326 
unique_cou¡
, (
i
-
íåõs
)-unique_count, i-entries);

328 
	`block_poﬁ_‰ì
(
bp
);

329 
	`°rögm≠_‰ì
(
m≠
);

331 
	}
}

333 #unde‡
¥öt


334 #unde‡
îr


335 #unde‡
debug


336 #unde‡
msg


338 
	$maö
()

340 
	`∂™_ã°s
(14);

342 
	`ã°_åivül
();

343 
	`ok1
(
	`ã°_°rögm≠
(10000, 
°dout
));

345  
	`exô_°©us
();

346 
	}
}

	@ccan/ccan/strmap/strmap.c

2 
	~<cˇn/°rm≠/°rm≠.h
>

3 
	~<cˇn/sh‹t_ty≥s/sh‹t_ty≥s.h
>

4 
	~<cˇn/°r/°r.h
>

5 
	~<cˇn/ûog/ûog.h
>

6 
	~<as£π.h
>

7 
	~<°dlib.h
>

8 
	~<î∫o.h
>

10 
	snode
 {

12 
°rm≠
 
	mchûd
[2];

14 
size_t
 
	mbyã_num
;

16 
u8
 
	mbô_num
;

20 
°rm≠
 *
	$˛o£°
(
°rm≠
 *
n
, c⁄° *
membî
)

22 
size_t
 
Àn
 = 
	`°æí
(
membî
);

23 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
membî
;

26 !
n
->
v
) {

27 
u8
 
dúe˘i⁄
 = 0;

29 i‡(
n
->
u
.n->
byã_num
 < 
Àn
) {

30 
u8
 
c
 = 
byãs
[
n
->
u
.n->
byã_num
];

31 
dúe˘i⁄
 = (
c
 >> 
n
->
u
.n->
bô_num
) & 1;

33 
n
 = &n->
u
.n->
chûd
[
dúe˘i⁄
];

35  
n
;

36 
	}
}

38 *
	$°rm≠_gë_
(c⁄° 
°rm≠
 *
m≠
, c⁄° *
membî
)

40 
°rm≠
 *
n
;

43 i‡(
m≠
->
u
.
n
) {

44 
n
 = 
	`˛o£°
((
°rm≠
 *)
m≠
, 
membî
);

45 i‡(
	`°ªq
(
membî
, 
n
->
u
.
s
))

46  
n
->
v
;

48 
î∫o
 = 
ENOENT
;

49  
NULL
;

50 
	}
}

52 
boﬁ
 
	$°rm≠_add_
(
°rm≠
 *
m≠
, c⁄° *
membî
, c⁄° *
vÆue
)

54 
size_t
 
Àn
 = 
	`°æí
(
membî
);

55 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
membî
;

56 
°rm≠
 *
n
;

57 
node
 *
√wn
;

58 
size_t
 
byã_num
;

59 
u8
 
bô_num
, 
√w_dú
;

61 
	`as£π
(
vÆue
);

64 i‡(!
m≠
->
u
.
n
) {

65 
m≠
->
u
.
s
 = 
membî
;

66 
m≠
->
v
 = (*)
vÆue
;

67  
åue
;

71 
n
 = 
	`˛o£°
(
m≠
, 
membî
);

74 
byã_num
 = 0; 
n
->
u
.
s
[byã_num] =
membî
[byte_num]; byte_num++) {

75 i‡(
membî
[
byã_num
] == '\0') {

77 
î∫o
 = 
EEXIST
;

78  
Ál£
;

83 
bô_num
 = 
	`ûog32_nz
((
u8
)
n
->
u
.
s
[
byã_num
] ^ 
byãs
[byte_num]) - 1;

84 
	`as£π
(
bô_num
 < 
CHAR_BIT
);

87 
√w_dú
 = ((
byãs
[
byã_num
]Ë>> 
bô_num
) & 1;

90 
√wn
 = 
	`mÆloc
((*newn));

91 i‡(!
√wn
) {

92 
î∫o
 = 
ENOMEM
;

93  
Ál£
;

95 
√wn
->
byã_num
 = byte_num;

96 
√wn
->
bô_num
 = bit_num;

97 
√wn
->
chûd
[
√w_dú
].
v
 = (*)
vÆue
;

98 
√wn
->
chûd
[
√w_dú
].
u
.
s
 = 
membî
;

101 
n
 = 
m≠
;

102 !
n
->
v
) {

103 
u8
 
dúe˘i⁄
 = 0;

105 i‡(
n
->
u
.n->
byã_num
 > byte_num)

108 i‡(
n
->
u
.n->
byã_num
 =byã_num &&Ç->u.n->
bô_num
 < bit_num)

111 i‡(
n
->
u
.n->
byã_num
 < 
Àn
) {

112 
u8
 
c
 = 
byãs
[
n
->
u
.n->
byã_num
];

113 
dúe˘i⁄
 = (
c
 >> 
n
->
u
.n->
bô_num
) & 1;

115 
n
 = &n->
u
.n->
chûd
[
dúe˘i⁄
];

118 
√wn
->
chûd
[!
√w_dú
] = *
n
;

119 
n
->
u
.¿
√wn
;

120 
n
->
v
 = 
NULL
;

121  
åue
;

122 
	}
}

124 *
	$°rm≠_dñ_
(
°rm≠
 *
m≠
, c⁄° *
membî
, **
vÆuï
)

126 
size_t
 
Àn
 = 
	`°æí
(
membî
);

127 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
membî
;

128 
°rm≠
 *
∑ª¡
 = 
NULL
, *
n
;

129 c⁄° *
ªt
 = 
NULL
;

130 
u8
 
dúe˘i⁄
 = 0;

133 i‡(!
m≠
->
u
.
n
) {

134 
î∫o
 = 
ENOENT
;

135  
NULL
;

139 
n
 = 
m≠
;

141 !
n
->
v
) {

142 
u8
 
c
 = 0;

144 
∑ª¡
 = 
n
;

145 i‡(
n
->
u
.n->
byã_num
 < 
Àn
) {

146 
c
 = 
byãs
[
n
->
u
.n->
byã_num
];

147 
dúe˘i⁄
 = (
c
 >> 
n
->
u
.n->
bô_num
) & 1;

149 
dúe˘i⁄
 = 0;

150 
n
 = &n->
u
.n->
chûd
[
dúe˘i⁄
];

154 i‡(!
	`°ªq
(
membî
, 
n
->
u
.
s
)) {

155 
î∫o
 = 
ENOENT
;

156  
NULL
;

159 
ªt
 = 
n
->
u
.
s
;

160 i‡(
vÆuï
)

161 *
vÆuï
 = 
n
->
v
;

163 i‡(!
∑ª¡
) {

165 
m≠
->
u
.
n
 = 
NULL
;

167 
node
 *
ﬁd
 = 
∑ª¡
->
u
.
n
;

169 *
∑ª¡
 = 
ﬁd
->
chûd
[!
dúe˘i⁄
];

170 
	`‰ì
(
ﬁd
);

173  (*)
ªt
;

174 
	}
}

176 
boﬁ
 
ôî©e
(
°rm≠
 
n
,

177 
	$boﬁ
 (*
h™dÀ
)(const *, *, *),

178 c⁄° *
d©a
)

180 i‡(
n
.
v
)

181  
	`h™dÀ
(
n
.
u
.
s
,Ç.
v
, (*)
d©a
);

183  
	`ôî©e
(
n
.
u
.n->
chûd
[0], 
h™dÀ
, 
d©a
)

184 && 
	`ôî©e
(
n
.
u
.n->
chûd
[1], 
h™dÀ
, 
d©a
);

185 
	}
}

187 
°rm≠_ôî©e_
(c⁄° 
°rm≠
 *
m≠
,

188 
	$boﬁ
 (*
h™dÀ
)(const *, *, *),

189 c⁄° *
d©a
)

192 i‡(!
m≠
->
u
.
n
)

195 
	`ôî©e
(*
m≠
, 
h™dÀ
, 
d©a
);

196 
	}
}

198 c⁄° 
°rm≠
 *
	$°rm≠_¥efix_
(c⁄° 
°rm≠
 *
m≠
,

199 c⁄° *
¥efix
)

201 c⁄° 
°rm≠
 *
n
, *
t›
;

202 
size_t
 
Àn
 = 
	`°æí
(
¥efix
);

203 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
¥efix
;

206 i‡(!
m≠
->
u
.
n
)

207  
m≠
;

209 
t›
 = 
n
 = 
m≠
;

212 !
n
->
v
) {

213 
u8
 
c
 = 0, 
dúe˘i⁄
;

215 i‡(
n
->
u
.n->
byã_num
 < 
Àn
)

216 
c
 = 
byãs
[
n
->
u
.n->
byã_num
];

218 
dúe˘i⁄
 = (
c
 >> 
n
->
u
.n->
bô_num
) & 1;

219 
n
 = &n->
u
.n->
chûd
[
dúe˘i⁄
];

220 i‡(
c
)

221 
t›
 = 
n
;

224 i‡(!
	`°r°¨ts
(
n
->
u
.
s
, 
¥efix
)) {

226 c⁄° 
°rm≠
 
em±y_m≠
;

227  &
em±y_m≠
;

230  
t›
;

231 
	}
}

233 
	$˛ór
(
°rm≠
 
n
)

235 i‡(!
n
.
v
) {

236 
	`˛ór
(
n
.
u
.n->
chûd
[0]);

237 
	`˛ór
(
n
.
u
.n->
chûd
[1]);

238 
	`‰ì
(
n
.
u
.n);

240 
	}
}

242 
	$°rm≠_˛ór_
(
°rm≠
 *
m≠
)

244 i‡(
m≠
->
u
.
n
)

245 
	`˛ór
(*
m≠
);

246 
m≠
->
u
.
n
 = 
NULL
;

247 
	}
}

	@ccan/ccan/strmap/strmap.h

1 #i‚de‡
CCAN_STRMAP_H


2 
	#CCAN_STRMAP_H


	)

3 
	~"c⁄fig.h
"

4 
	~<cˇn/tc⁄/tc⁄.h
>

5 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

6 
	~<°dlib.h
>

7 
	~<°dboﬁ.h
>

15 
	s°rm≠
 {

17 
node
 *
	mn
;

18 c⁄° *
	ms
;

19 } 
	mu
;

20 *
	mv
;

36 
	#STRMAP_MEMBERS
(
ty≥
) \

37 
°rm≠
 
øw
; \

38 
	`TCON
(
ty≥
 
ˇ«ry
)

	)

53 
	#°rm≠_öô
(
m≠
Ë
	`°rm≠_öô_
(&(m≠)->
øw
)

	)

55 
ölöe
 
	$°rm≠_öô_
(
°rm≠
 *
m≠
)

57 
m≠
->
u
.
n
 = 
NULL
;

58 
	}
}

68 
	#°rm≠_em±y
(
m≠
Ë
	`°rm≠_em±y_
(&(m≠)->
øw
)

	)

70 
ölöe
 
boﬁ
 
	$°rm≠_em±y_
(c⁄° 
°rm≠
 *
m≠
)

72  
m≠
->
u
.
n
 =
NULL
;

73 
	}
}

87 
	#°rm≠_gë
(
m≠
, 
membî
) \

88 
	`tc⁄_ˇ°
((
m≠
), 
ˇ«ry
, 
	`°rm≠_gë_
(&(m≠)->
øw
, (
membî
)))

	)

89 *
°rm≠_gë_
(c⁄° 
°rm≠
 *
m≠
, c⁄° *
membî
);

109 
	#°rm≠_add
(
m≠
, 
membî
, 
vÆue
) \

110 
	`°rm≠_add_
(&
	`tc⁄_check
((
m≠
), 
ˇ«ry
, (
vÆue
))->
øw
, \

111 (
membî
), (*)(
vÆue
))

	)

113 
boﬁ
 
°rm≠_add_
(
°rm≠
 *
m≠
, c⁄° *
membî
, c⁄° *
vÆue
);

132 
	#°rm≠_dñ
(
m≠
, 
membî
, 
vÆuï
) \

133 
	`°rm≠_dñ_
(&
	`tc⁄_check_±r
((
m≠
), 
ˇ«ry
, 
vÆuï
)->
øw
, \

134 (
membî
), (**)
vÆuï
)

	)

135 *
°rm≠_dñ_
(
°rm≠
 *
m≠
, c⁄° *
membî
, **
vÆuï
);

146 
	#°rm≠_˛ór
(
m≠
Ë
	`°rm≠_˛ór_
(&(m≠)->
øw
)

	)

148 
°rm≠_˛ór_
(
°rm≠
 *
m≠
);

183 
	#°rm≠_ôî©e
(
m≠
, 
h™dÀ
, 
¨g
) \

184 
	`°rm≠_ôî©e_
(&(
m≠
)->
øw
, \

185 
	`ty≥ß„_cb_ˇ°
(
	`boﬁ
 (*)(const *, \

187 
	`boﬁ
 (*)(const *, \

188 
	`tc⁄_ty≥
((
m≠
), 
ˇ«ry
), \

189 
	`__ty≥of__
(
¨g
)), (
h™dÀ
)), \

190 (
¨g
))

	)

191 
°rm≠_ôî©e_
(c⁄° 
°rm≠
 *
m≠
,

192 
	$boﬁ
 (*
h™dÀ
)(const *, *, *),

193 c⁄° *
d©a
);

215 #i‡
HAVE_TYPEOF


216 
	#°rm≠_¥efix
(
m≠
, 
¥efix
) \

217 ((c⁄° 
	`__ty≥of__
(
m≠
))
	`°rm≠_¥efix_
(&(m≠)->
øw
, (
¥efix
)))

	)

219 
	#°rm≠_¥efix
(
m≠
, 
¥efix
) \

220 ((c⁄° *)
	`°rm≠_¥efix_
(&(
m≠
)->
øw
, (
¥efix
)))

	)

223 c⁄° 
°rm≠
 *
	`°rm≠_¥efix_
(c⁄° °rm≠ *
m≠
,

224 c⁄° *
¥efix
);

	@ccan/ccan/strmap/test/run-iterate-const.c

1 
	~<cˇn/°rm≠/°rm≠.h
>

2 
	~<cˇn/°rm≠/°rm≠.c
>

3 
	~<cˇn/èp/èp.h
>

5 
boﬁ
 
	gfound
 = 
Ál£
;

8 
boﬁ
 
	$föd_°rög
(c⁄° *
°r
, *
membî
, c⁄° *
cmp
)

10 i‡(
	`°rcmp
(
membî
, 
cmp
) == 0)

11 
found
 = 
åue
;

12  
Ál£
;

13 
	}
}

15 
	$maö
()

17 
	s°rm≠_ch¨p
 {

18 
	`STRMAP_MEMBERS
(*);

19 } 
m≠
;

21 
	`∂™_ã°s
(3);

23 
	`°rm≠_öô
(&
m≠
);

24 
	`ok1
(
	`°rm≠_add
(&
m≠
, "hello", "hello"));

25 
	`ok1
(
	`°rm≠_add
(&
m≠
, "world", "world"));

26 
	`°rm≠_ôî©e
(&
m≠
, 
föd_°rög
, (const *)"hello");

27 
	`ok1
(
found
);

28 
	`°rm≠_˛ór
(&
m≠
);

31  
	`exô_°©us
();

32 
	}
}

	@ccan/ccan/strmap/test/run-order.c

1 
	~<cˇn/°rm≠/°rm≠.h
>

2 
	~<cˇn/°rm≠/°rm≠.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dio.h
>

6 
	#NUM
 1000

	)

8 
boﬁ
 
	$ö_‹dî
(c⁄° *
membî
, *
vÆue
, *
cou¡
)

10 
i
 = 
	`©oi
(
membî
);

11 
	`ok1
(
i
 =
	`©oi
(
vÆue
));

12 
	`ok1
(*
cou¡
 =
i
);

13 (*
cou¡
)++;

14  
åue
;

15 
	}
}

17 
boﬁ
 
	$ö_‹dî_by_2
(c⁄° *
membî
, *
vÆue
, *
cou¡
)

19 
i
 = 
	`©oi
(
membî
);

20 
	`ok1
(
i
 =
	`©oi
(
vÆue
));

21 
	`ok1
(*
cou¡
 =
i
);

22 (*
cou¡
) += 2;

23  
åue
;

24 
	}
}

26 
boﬁ
 
	$dump
(c⁄° *
membî
, *
vÆue
, 
boﬁ
 *
ok
)

28 
	`düg
("%s=>%s", 
membî
, 
vÆue
);

29 i‡(
vÆue
 !
membî
 + 1)

30 *
ok
 = 
Ál£
;

31  
åue
;

32 
	}
}

34 
	$maö
()

36 
	s°rm≠_ch¨p
 {

37 
	`STRMAP_MEMBERS
(*);

38 } 
m≠
;

39 
i
;

40 *
°r
[
NUM
];

41 
boﬁ
 
dump_ok
;

43 
	`∂™_ã°s
(1 + 
NUM
 * 4 + 3 * NUM);

44 
	`°rm≠_öô
(&
m≠
);

46 
i
 = 0; i < 
NUM
; i++) {

47 
ãm∂©e
[10];

48 
	`•rötf
(
ãm∂©e
, "%08u", 
i
);

49 
°r
[
i
] = 
	`°rdup
(
ãm∂©e
);

52 
i
 = 0; i < 
NUM
; i++)

53 
	`°rm≠_add
(&
m≠
, 
°r
[
i
], str[i]+1);

55 
dump_ok
 = 
åue
;

56 
	`°rm≠_ôî©e
(&
m≠
, 
dump
, &
dump_ok
);

57 
	`ok1
(
dump_ok
);

60 
i
 = 0;

61 
	`°rm≠_ôî©e
(&
m≠
, 
ö_‹dî
, &
i
);

64 
i
 = 0; i < 
NUM
; i += 2) {

65 *
v
;

66 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, 
°r
[
i
], &
v
) == str[i]);

67 
	`ok1
(
v
 =
°r
[
i
] + 1);

70 
i
 = 1;

71 
	`°rm≠_ôî©e
(&
m≠
, 
ö_‹dî_by_2
, &
i
);

73 
i
 = 1; i < 
NUM
; i += 2) {

74 *
v
;

75 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, 
°r
[
i
], &
v
) == str[i]);

76 
	`ok1
(
v
 =
°r
[
i
] + 1);

80 
	`°rm≠_ôî©e
(&
m≠
, 
ö_‹dî_by_2
, (*)
NULL
);

83 
i
 = 0; i < 
NUM
; i++)

84 
	`°rm≠_add
(&
m≠
, 
°r
[
NUM
-1-
i
], str[NUM-1-i]+1);

86 
i
 = 0;

87 
	`°rm≠_ôî©e
(&
m≠
, 
ö_‹dî
, &
i
);

89 
	`°rm≠_˛ór
(&
m≠
);

91 
i
 = 0; i < 
NUM
; i++)

92 
	`‰ì
(
°r
[
i
]);

95  
	`exô_°©us
();

96 
	}
}

	@ccan/ccan/strmap/test/run-prefix.c

1 
	~<cˇn/°rm≠/°rm≠.h
>

2 
	~<cˇn/°rm≠/°rm≠.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dio.h
>

7 
	#NUM
 200

	)

9 
boﬁ
 
	$ö_‹dî
(c⁄° *
ödex
, *
vÆue
, *
cou¡
)

11 
i
 = 
	`©oi
(
ödex
);

12 
	`ok1
(
i
 =
	`©oi
(
vÆue
));

13 
	`ok1
(*
cou¡
 =
i
);

14 (*
cou¡
)++;

15  
åue
;

16 
	}
}

18 
boﬁ
 
	$föd_em±y
(c⁄° *
ödex
, *
vÆue
, *
em±y
)

20 i‡(
ödex
 =
em±y
)

21 
	`∑ss
("FoundÉmptyÉntry!");

22  
åue
;

23 
	}
}

25 
	$maö
()

27 
	sm≠
 {

28 
	`STRMAP_MEMBERS
(*);

30 
m≠
 map;

31 c⁄° 
m≠
 *
sub
;

32 
i
;

33 *
°r
[
NUM
], *
em±y
;

35 
	`∂™_ã°s
(8 + 2 * (1 + 10 + 100) + 1);

36 
	`°rm≠_öô
(&
m≠
);

38 
i
 = 0; i < 
NUM
; i++) {

39 
ãm∂©e
[10];

40 
	`•rötf
(
ãm∂©e
, "%08u", 
i
);

41 
°r
[
i
] = 
	`°rdup
(
ãm∂©e
);

45 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "a");

46 
	`ok1
(
	`°rm≠_em±y
(
sub
));

47 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "");

48 
	`ok1
(
	`°rm≠_em±y
(
sub
));

50 
i
 = 0; i < 
NUM
; i++)

51 
	`°rm≠_add
(&
m≠
, 
°r
[
i
], str[i]+1);

54 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "a");

55 
	`ok1
(
	`°rm≠_em±y
(
sub
));

58 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "0");

59 
	`ok1
(
sub
->
øw
.
u
.
n
 =
m≠
.raw.u.n);

60 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "");

61 
	`ok1
(
sub
->
øw
.
u
.
n
 =
m≠
.raw.u.n);

64 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "00000000");

65 
i
 = 0;

66 
	`°rm≠_ôî©e
(
sub
, 
ö_‹dî
, &
i
);

67 
	`ok1
(
i
 == 1);

70 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "0000000");

71 
i
 = 0;

72 
	`°rm≠_ôî©e
(
sub
, 
ö_‹dî
, &
i
);

73 
	`ok1
(
i
 == 10);

76 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "000000");

77 
i
 = 0;

78 
	`°rm≠_ôî©e
(
sub
, 
ö_‹dî
, &
i
);

79 
	`ok1
(
i
 == 100);

82 
em±y
 = 
	`°rdup
("");

83 
	`°rm≠_add
(&
m≠
, 
em±y
,Émpty);

85 
sub
 = 
	`°rm≠_¥efix
(&
m≠
, "");

87 
	`°rm≠_ôî©e
(
sub
, 
föd_em±y
, 
em±y
);

89 
	`°rm≠_˛ór
(&
m≠
);

91 
i
 = 0; i < 
NUM
; i++)

92 
	`‰ì
(
°r
[
i
]);

93 
	`‰ì
(
em±y
);

96  
	`exô_°©us
();

97 
	}
}

	@ccan/ccan/strmap/test/run.c

1 
	~<cˇn/°rm≠/°rm≠.h
>

2 
	~<cˇn/°rm≠/°rm≠.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
	s°rm≠_ch¨p
 {

8 
	`STRMAP_MEMBERS
(*);

9 } 
m≠
;

10 c⁄° 
°r
[] = "hello";

11 c⁄° 
vÆ
[] = "there";

12 c⁄° 
n⁄e
[] = "";

13 *
dup
 = 
	`°rdup
(
°r
);

14 *
v
;

17 
	`∂™_ã°s
(42);

19 
	`°rm≠_öô
(&
m≠
);

21 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
°r
));

22 
	`ok1
(
î∫o
 =
ENOENT
);

23 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
n⁄e
));

24 
	`ok1
(
î∫o
 =
ENOENT
);

25 
	`ok1
(!
	`°rm≠_dñ
(&
m≠
, 
°r
, 
NULL
));

26 
	`ok1
(
î∫o
 =
ENOENT
);

27 
	`ok1
(!
	`°rm≠_dñ
(&
m≠
, 
n⁄e
, 
NULL
));

28 
	`ok1
(
î∫o
 =
ENOENT
);

30 
	`ok1
(
	`°rm≠_add
(&
m≠
, 
°r
, 
vÆ
));

31 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
°r
Ë=
vÆ
);

33 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
dup
Ë=
vÆ
);

34 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
n⁄e
));

35 
	`ok1
(
î∫o
 =
ENOENT
);

38 
	`ok1
(!
	`°rm≠_add
(&
m≠
, 
dup
, 
vÆ
));

39 
	`ok1
(
î∫o
 =
EEXIST
);

40 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
dup
Ë=
vÆ
);

43 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, 
dup
, &
v
Ë=
°r
);

44 
	`ok1
(
v
 =
vÆ
);

45 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
°r
));

46 
	`ok1
(
î∫o
 =
ENOENT
);

47 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
n⁄e
));

48 
	`ok1
(
î∫o
 =
ENOENT
);

51 
	`ok1
(
	`°rm≠_add
(&
m≠
, 
n⁄e
,Çone));

52 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
n⁄e
) ==Çone);

53 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
°r
));

54 
	`ok1
(
î∫o
 =
ENOENT
);

57 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, "", &
v
Ë=
n⁄e
);

58 
	`ok1
(
v
 =
n⁄e
);

59 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
°r
));

60 
	`ok1
(
î∫o
 =
ENOENT
);

61 
	`ok1
(!
	`°rm≠_gë
(&
m≠
, 
n⁄e
));

62 
	`ok1
(
î∫o
 =
ENOENT
);

65 
	`ok1
(
	`°rm≠_add
(&
m≠
, 
n⁄e
,Çone));

66 
	`ok1
(
	`°rm≠_add
(&
m≠
, 
°r
, 
vÆ
));

67 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
°r
Ë=
vÆ
);

68 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
n⁄e
) ==Çone);

69 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, "d€†nŸÉxi°", 
NULL
) == NULL);

70 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, "", 
NULL
Ë=
n⁄e
);

71 
	`ok1
(
	`°rm≠_gë
(&
m≠
, 
°r
Ë=
vÆ
);

72 
	`ok1
(
	`°rm≠_dñ
(&
m≠
, 
dup
, &
v
Ë=
°r
);

73 
	`ok1
(
v
 =
vÆ
);

75 
	`ok1
(
	`°rm≠_em±y
(&
m≠
));

76 
	`‰ì
(
dup
);

79  
	`exô_°©us
();

80 
	}
}

	@ccan/ccan/strset/strset.c

15 
	~<cˇn/°r£t/°r£t.h
>

16 
	~<cˇn/sh‹t_ty≥s/sh‹t_ty≥s.h
>

17 
	~<cˇn/likñy/likñy.h
>

18 
	~<cˇn/°r/°r.h
>

19 
	~<cˇn/ûog/ûog.h
>

20 
	~<as£π.h
>

21 
	~<°dlib.h
>

22 
	~<î∫o.h
>

24 
	snode
 {

26 
	mnul_byã
;

28 
u8
 
	mbô_num
;

30 
size_t
 
	mbyã_num
;

32 
°r£t
 
	mchûd
[2];

36 c⁄° *
	$˛o£°
(
°r£t
 
n
, c⁄° *
membî
)

38 
size_t
 
Àn
 = 
	`°æí
(
membî
);

39 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
membî
;

42 !
n
.
u
.
s
[0]) {

43 
u8
 
dúe˘i⁄
 = 0;

46 i‡(
	`u∆ikñy
(
n
.
u
.n->
byã_num
 =(
size_t
)-1)) {

47 
n
 =Ç.
u
.n->
chûd
[0];

51 i‡(
n
.
u
.n->
byã_num
 < 
Àn
) {

52 
u8
 
c
 = 
byãs
[
n
.
u
.n->
byã_num
];

53 
dúe˘i⁄
 = (
c
 >> 
n
.
u
.n->
bô_num
) & 1;

55 
n
 =Ç.
u
.n->
chûd
[
dúe˘i⁄
];

57  
n
.
u
.
s
;

58 
	}
}

60 *
	$°r£t_gë
(c⁄° 
°r£t
 *
£t
, c⁄° *
membî
)

62 c⁄° *
°r
;

65 i‡(
£t
->
u
.
n
) {

66 
°r
 = 
	`˛o£°
(*
£t
, 
membî
);

67 i‡(
	`°ªq
(
membî
, 
°r
))

68  (*)
°r
;

70 
î∫o
 = 
ENOENT
;

71  
NULL
;

72 
	}
}

74 
boﬁ
 
	$£t_°rög
(
°r£t
 *
£t
,

75 
°r£t
 *
n
, c⁄° *
membî
)

78 i‡(
	`u∆ikñy
(!
membî
[0])) {

79 
n
->
u
.¿
	`mÆloc
((*n->u.n));

80 i‡(
	`u∆ikñy
(!
n
->
u
.n)) {

81 
î∫o
 = 
ENOMEM
;

82  
Ál£
;

84 
n
->
u
.n->
nul_byã
 = '\0';

85 
n
->
u
.n->
byã_num
 = (
size_t
)-1;

87 
n
 = &n->
u
.n->
chûd
[0];

89 
n
->
u
.
s
 = 
membî
;

90  
åue
;

91 
	}
}

93 
boﬁ
 
	$°r£t_add
(
°r£t
 *
£t
, c⁄° *
membî
)

95 
size_t
 
Àn
 = 
	`°æí
(
membî
);

96 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
membî
;

97 
°r£t
 *
≈
;

98 c⁄° *
°r
;

99 
node
 *
√wn
;

100 
size_t
 
byã_num
;

101 
u8
 
bô_num
, 
√w_dú
;

104 i‡(!
£t
->
u
.
n
) {

105  
	`£t_°rög
(
£t
, së, 
membî
);

109 
°r
 = 
	`˛o£°
(*
£t
, 
membî
);

112 
byã_num
 = 0; 
°r
[byã_num] =
membî
[byte_num]; byte_num++) {

113 i‡(
membî
[
byã_num
] == '\0') {

115 
î∫o
 = 
EEXIST
;

116  
Ál£
;

121 
bô_num
 = 
	`ûog32_nz
((
u8
)
°r
[
byã_num
] ^ 
byãs
[byte_num]) - 1;

122 
	`as£π
(
bô_num
 < 
CHAR_BIT
);

125 
√w_dú
 = ((
byãs
[
byã_num
]Ë>> 
bô_num
) & 1;

128 
√wn
 = 
	`mÆloc
((*newn));

129 i‡(!
√wn
) {

130 
î∫o
 = 
ENOMEM
;

131  
Ál£
;

133 
√wn
->
nul_byã
 = '\0';

134 
√wn
->
byã_num
 = byte_num;

135 
√wn
->
bô_num
 = bit_num;

136 i‡(
	`u∆ikñy
(!
	`£t_°rög
(
£t
, &
√wn
->
chûd
[
√w_dú
], 
membî
))) {

137 
	`‰ì
(
√wn
);

138  
Ál£
;

142 
≈
 = 
£t
;

143 !
≈
->
u
.
s
[0]) {

144 
u8
 
dúe˘i⁄
 = 0;

148 i‡(
≈
->
u
.
n
->
byã_num
 > byte_num)

151 i‡(
≈
->
u
.
n
->
byã_num
 =byã_num &&Çp->u.n->
bô_num
 < bit_num)

154 i‡(
≈
->
u
.
n
->
byã_num
 < 
Àn
) {

155 
u8
 
c
 = 
byãs
[
≈
->
u
.
n
->
byã_num
];

156 
dúe˘i⁄
 = (
c
 >> 
≈
->
u
.
n
->
bô_num
) & 1;

158 
≈
 = &≈->
u
.
n
->
chûd
[
dúe˘i⁄
];

161 
√wn
->
chûd
[!
√w_dú
]*
≈
;

162 
≈
->
u
.
n
 = 
√wn
;

163  
åue
;

164 
	}
}

166 *
	$°r£t_dñ
(
°r£t
 *
£t
, c⁄° *
membî
)

168 
size_t
 
Àn
 = 
	`°æí
(
membî
);

169 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
membî
;

170 
°r£t
 *
∑ª¡
 = 
NULL
, *
n
;

171 c⁄° *
ªt
 = 
NULL
;

172 
u8
 
dúe˘i⁄
 = 0;

175 i‡(!
£t
->
u
.
n
) {

176 
î∫o
 = 
ENOENT
;

177  
NULL
;

181 
n
 = 
£t
;

183 !
n
->
u
.
s
[0]) {

184 
u8
 
c
 = 0;

187 i‡(
	`u∆ikñy
(
n
->
u
.n->
byã_num
 =(
size_t
)-1)) {

188 c⁄° *
em±y_°r
 = 
n
->
u
.n->
chûd
[0].u.
s
;

190 i‡(
membî
[0]) {

191 
î∫o
 = 
ENOENT
;

192  
NULL
;

196 
	`‰ì
(
n
->
u
.n);

197 
n
->
u
.
s
 = 
em±y_°r
;

201 
∑ª¡
 = 
n
;

202 i‡(
n
->
u
.n->
byã_num
 < 
Àn
) {

203 
c
 = 
byãs
[
n
->
u
.n->
byã_num
];

204 
dúe˘i⁄
 = (
c
 >> 
n
->
u
.n->
bô_num
) & 1;

206 
dúe˘i⁄
 = 0;

207 
n
 = &n->
u
.n->
chûd
[
dúe˘i⁄
];

211 i‡(!
	`°ªq
(
membî
, 
n
->
u
.
s
)) {

212 
î∫o
 = 
ENOENT
;

213  
NULL
;

216 
ªt
 = 
n
->
u
.
s
;

218 i‡(!
∑ª¡
) {

220 
£t
->
u
.
n
 = 
NULL
;

222 
node
 *
ﬁd
 = 
∑ª¡
->
u
.
n
;

224 *
∑ª¡
 = 
ﬁd
->
chûd
[!
dúe˘i⁄
];

225 
	`‰ì
(
ﬁd
);

228  (*)
ªt
;

229 
	}
}

231 
boﬁ
 
ôî©e
(
°r£t
 
n
,

232 
	$boﬁ
 (*
h™dÀ
)(c⁄° *, *), c⁄° *
d©a
)

234 i‡(
n
.
u
.
s
[0])

235  
	`h™dÀ
(
n
.
u
.
s
, (*)
d©a
);

236 i‡(
	`u∆ikñy
(
n
.
u
.n->
byã_num
 =(
size_t
)-1))

237  
	`h™dÀ
(
n
.
u
.n->
chûd
[0].u.
s
, (*)
d©a
);

239  
	`ôî©e
(
n
.
u
.n->
chûd
[0], 
h™dÀ
, 
d©a
)

240 && 
	`ôî©e
(
n
.
u
.n->
chûd
[1], 
h™dÀ
, 
d©a
);

241 
	}
}

243 
°r£t_ôî©e_
(c⁄° 
°r£t
 *
£t
,

244 
	$boﬁ
 (*
h™dÀ
)(c⁄° *, *), c⁄° *
d©a
)

247 i‡(!
£t
->
u
.
n
)

250 
	`ôî©e
(*
£t
, 
h™dÀ
, 
d©a
);

251 
	}
}

253 c⁄° 
°r£t
 *
	$°r£t_¥efix
(c⁄° 
°r£t
 *
£t
, c⁄° *
¥efix
)

255 c⁄° 
°r£t
 *
n
, *
t›
;

256 
size_t
 
Àn
 = 
	`°æí
(
¥efix
);

257 c⁄° 
u8
 *
byãs
 = (c⁄° u8 *)
¥efix
;

260 i‡(!
£t
->
u
.
n
)

261  
£t
;

263 
t›
 = 
n
 = 
£t
;

266 !
n
->
u
.
s
[0]) {

267 
u8
 
c
 = 0, 
dúe˘i⁄
;

270 i‡(
	`u∆ikñy
(
n
->
u
.n->
byã_num
 =(
size_t
)-1)) {

271 
n
 = &n->
u
.n->
chûd
[0];

275 i‡(
n
->
u
.n->
byã_num
 < 
Àn
)

276 
c
 = 
byãs
[
n
->
u
.n->
byã_num
];

278 
dúe˘i⁄
 = (
c
 >> 
n
->
u
.n->
bô_num
) & 1;

279 
n
 = &n->
u
.n->
chûd
[
dúe˘i⁄
];

280 i‡(
c
)

281 
t›
 = 
n
;

284 i‡(!
	`°r°¨ts
(
n
->
u
.
s
, 
¥efix
)) {

286 c⁄° 
°r£t
 
em±y_£t
;

287  &
em±y_£t
;

290  
t›
;

291 
	}
}

293 
	$˛ór
(
°r£t
 
n
)

295 i‡(!
n
.
u
.
s
[0]) {

296 i‡(
	`likñy
(
n
.
u
.n->
byã_num
 !(
size_t
)-1)) {

297 
	`˛ór
(
n
.
u
.n->
chûd
[0]);

298 
	`˛ór
(
n
.
u
.n->
chûd
[1]);

300 
	`‰ì
(
n
.
u
.n);

302 
	}
}

304 
	$°r£t_˛ór
(
°r£t
 *
£t
)

306 i‡(
£t
->
u
.
n
)

307 
	`˛ór
(*
£t
);

308 
£t
->
u
.
n
 = 
NULL
;

309 
	}
}

	@ccan/ccan/strset/strset.h

1 #i‚de‡
CCAN_STRSET_H


2 
	#CCAN_STRSET_H


	)

3 
	~"c⁄fig.h
"

4 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

5 
	~<°dlib.h
>

6 
	~<°dboﬁ.h
>

14 
	s°r£t
 {

16 
node
 *
	mn
;

17 c⁄° *
	ms
;

18 } 
	mu
;

32 
ölöe
 
	$°r£t_öô
(
°r£t
 *
£t
)

34 
£t
->
u
.
n
 = 
NULL
;

35 
	}
}

45 
ölöe
 
boﬁ
 
	$°r£t_em±y
(c⁄° 
°r£t
 *
£t
)

47  
£t
->
u
.
n
 =
NULL
;

48 
	}
}

62 *
°r£t_gë
(c⁄° 
°r£t
 *
£t
, c⁄° *
membî
);

79 
boﬁ
 
°r£t_add
(
°r£t
 *
£t
, c⁄° *
membî
);

96 *
°r£t_dñ
(
°r£t
 *
£t
, c⁄° *
membî
);

107 
°r£t_˛ór
(
°r£t
 *
£t
);

136 
	#°r£t_ôî©e
(
£t
, 
h™dÀ
, 
¨g
) \

137 
	`°r£t_ôî©e_
((
£t
), 
	`ty≥ß„_cb_¥órgs
(
boﬁ
, *, \

138 (
h™dÀ
), (
¨g
), \

140 (
¨g
))

	)

141 
°r£t_ôî©e_
(c⁄° 
°r£t
 *
£t
,

142 
	$boﬁ
 (*
h™dÀ
)(c⁄° *, *), c⁄° *
d©a
);

164 c⁄° 
°r£t
 *
	`°r£t_¥efix
(c⁄° °r£à*
£t
,

165 c⁄° *
¥efix
);

	@ccan/ccan/strset/test/run-hibit.c

2 
	~<cˇn/°r£t/°r£t.h
>

3 
	~<cˇn/°r£t/°r£t.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	#NUM
 1000

	)

8 
	$ícode
(
ãm∂©e
[3], 
vÆ
)

10 
	`as£π
(
vÆ
 < 255 * 255);

11 
ãm∂©e
[0] = (
vÆ
 / 255) + 1;

12 
ãm∂©e
[1] = (
vÆ
 % 255) + 1;

13 
ãm∂©e
[2] = '\0';

14 
	}
}

16 
boﬁ
 
	$ö_‹dî
(c⁄° *
vÆue
, *
cou¡
)

18 
ãm∂©e
[3];

19 
	`ícode
(
ãm∂©e
, *
cou¡
);

20 
	`ok1
(
	`°ªq
(
vÆue
, 
ãm∂©e
));

21 (*
cou¡
)++;

22  
åue
;

23 
	}
}

25 
boﬁ
 
	$ö_‹dî_by_2
(c⁄° *
vÆue
, *
cou¡
)

27 
ãm∂©e
[3];

28 
	`ícode
(
ãm∂©e
, *
cou¡
);

29 
	`ok1
(
	`°ªq
(
vÆue
, 
ãm∂©e
));

30 (*
cou¡
) += 2;

31  
åue
;

32 
	}
}

34 
boﬁ
 
	$dump
(c⁄° *
vÆue
, *
unu£d
)

36 
	`düg
("%s", 
vÆue
);

37  
åue
;

38 
	}
}

40 
	$maö
()

42 
°r£t
 
£t
;

43 
i
;

44 *
°r
[
NUM
];

46 
	`∂™_ã°s
(
NUM
 + 3 * NUM / 2);

47 
	`°r£t_öô
(&
£t
);

49 
i
 = 0; i < 
NUM
; i++) {

50 
ãm∂©e
[3];

51 
	`ícode
(
ãm∂©e
, 
i
);

52 
°r
[
i
] = 
	`°rdup
(
ãm∂©e
);

55 
i
 = 0; i < 
NUM
; i++)

56 
	`°r£t_add
(&
£t
, 
°r
[
i
]);

58 
	`°r£t_ôî©e
(&
£t
, 
dump
, 
NULL
);

61 
i
 = 0;

62 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî
, &
i
);

65 
i
 = 0; i < 
NUM
; i += 2)

66 
	`ok1
(
	`°r£t_dñ
(&
£t
, 
°r
[
i
]) == str[i]);

68 
i
 = 1;

69 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî_by_2
, &
i
);

71 
i
 = 1; i < 
NUM
; i += 2)

72 
	`ok1
(
	`°r£t_dñ
(&
£t
, 
°r
[
i
]) == str[i]);

75 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî_by_2
, (*)
NULL
);

77 
i
 = 0; i < 
NUM
; i++)

78 
	`‰ì
(
°r
[
i
]);

81  
	`exô_°©us
();

82 
	}
}

	@ccan/ccan/strset/test/run-iterate-const.c

1 
	~<cˇn/°r£t/°r£t.h
>

2 
	~<cˇn/°r£t/°r£t.c
>

3 
	~<cˇn/èp/èp.h
>

5 
boﬁ
 
	gfound
 = 
Ál£
;

8 
boﬁ
 
	$föd_°rög
(c⁄° *
°r
, c⁄° *
cmp
)

10 i‡(
	`°rcmp
(
°r
, 
cmp
) == 0)

11 
found
 = 
åue
;

12  
åue
;

13 
	}
}

15 
	$maö
()

17 
°r£t
 
£t
;

19 
	`∂™_ã°s
(3);

21 
	`°r£t_öô
(&
£t
);

22 
	`ok1
(
	`°r£t_add
(&
£t
, "hello"));

23 
	`ok1
(
	`°r£t_add
(&
£t
, "world"));

24 
	`°r£t_ôî©e
(&
£t
, 
föd_°rög
, (const *)"hello");

25 
	`ok1
(
found
);

26 
	`°r£t_˛ór
(&
£t
);

29  
	`exô_°©us
();

30 
	}
}

	@ccan/ccan/strset/test/run-order.c

1 
	~<cˇn/°r£t/°r£t.h
>

2 
	~<cˇn/°r£t/°r£t.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dio.h
>

6 
	#NUM
 1000

	)

8 
boﬁ
 
	$ö_‹dî
(c⁄° *
vÆue
, *
cou¡
)

10 
i
 = 
	`©oi
(
vÆue
);

11 
	`ok1
(*
cou¡
 =
i
);

12 (*
cou¡
)++;

13  
åue
;

14 
	}
}

16 
boﬁ
 
	$ö_‹dî_by_2
(c⁄° *
vÆue
, *
cou¡
)

18 
i
 = 
	`©oi
(
vÆue
);

19 
	`ok1
(*
cou¡
 =
i
);

20 (*
cou¡
) += 2;

21  
åue
;

22 
	}
}

24 
boﬁ
 
	$dump
(c⁄° *
vÆue
, *
unu£d
)

26 
	`düg
("%s", 
vÆue
);

27  
åue
;

28 
	}
}

30 
	$maö
()

32 
°r£t
 
£t
;

33 
i
;

34 *
°r
[
NUM
];

36 
	`∂™_ã°s
(
NUM
 * 2 + 3 * NUM / 2);

37 
	`°r£t_öô
(&
£t
);

39 
i
 = 0; i < 
NUM
; i++) {

40 
ãm∂©e
[10];

41 
	`•rötf
(
ãm∂©e
, "%08u", 
i
);

42 
°r
[
i
] = 
	`°rdup
(
ãm∂©e
);

45 
i
 = 0; i < 
NUM
; i++)

46 
	`°r£t_add
(&
£t
, 
°r
[
i
]);

48 
	`°r£t_ôî©e
(&
£t
, 
dump
, 
NULL
);

51 
i
 = 0;

52 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî
, &
i
);

55 
i
 = 0; i < 
NUM
; i += 2)

56 
	`ok1
(
	`°r£t_dñ
(&
£t
, 
°r
[
i
]) == str[i]);

58 
i
 = 1;

59 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî_by_2
, &
i
);

61 
i
 = 1; i < 
NUM
; i += 2)

62 
	`ok1
(
	`°r£t_dñ
(&
£t
, 
°r
[
i
]) == str[i]);

65 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî_by_2
, (*)
NULL
);

68 
i
 = 0; i < 
NUM
; i++)

69 
	`°r£t_add
(&
£t
, 
°r
[
NUM
-1-
i
]);

71 
i
 = 0;

72 
	`°r£t_ôî©e
(&
£t
, 
ö_‹dî
, &
i
);

74 
	`°r£t_˛ór
(&
£t
);

76 
i
 = 0; i < 
NUM
; i++)

77 
	`‰ì
(
°r
[
i
]);

80  
	`exô_°©us
();

81 
	}
}

	@ccan/ccan/strset/test/run-prefix.c

1 
	~<cˇn/°r£t/°r£t.h
>

2 
	~<cˇn/°r£t/°r£t.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<°dio.h
>

7 
	#NUM
 200

	)

9 
boﬁ
 
	$ö_‹dî
(c⁄° *
vÆue
, *
cou¡
)

11 
i
 = 
	`©oi
(
vÆue
);

12 
	`ok1
(*
cou¡
 =
i
);

13 (*
cou¡
)++;

14  
åue
;

15 
	}
}

17 
boﬁ
 
	$föd_em±y
(c⁄° *
vÆue
, *
em±y
)

19 i‡(
vÆue
 =
em±y
)

20 
	`∑ss
("FoundÉmptyÉntry!");

21  
åue
;

22 
	}
}

24 
	$maö
()

26 
°r£t
 
£t
;

27 c⁄° 
°r£t
 *
sub
;

28 
i
;

29 *
°r
[
NUM
], *
em±y
;

31 
	`∂™_ã°s
(7 + 1 + 10 + 100);

32 
	`°r£t_öô
(&
£t
);

34 
i
 = 0; i < 
NUM
; i++) {

35 
ãm∂©e
[10];

36 
	`•rötf
(
ãm∂©e
, "%08u", 
i
);

37 
°r
[
i
] = 
	`°rdup
(
ãm∂©e
);

40 
i
 = 0; i < 
NUM
; i++)

41 
	`°r£t_add
(&
£t
, 
°r
[
i
]);

44 
sub
 = 
	`°r£t_¥efix
(&
£t
, "a");

45 
	`ok1
(
	`°r£t_em±y
(
sub
));

48 
sub
 = 
	`°r£t_¥efix
(&
£t
, "0");

49 
	`ok1
(
sub
->
u
.
n
 =
£t
.u.n);

50 
sub
 = 
	`°r£t_¥efix
(&
£t
, "");

51 
	`ok1
(
sub
->
u
.
n
 =
£t
.u.n);

54 
sub
 = 
	`°r£t_¥efix
(&
£t
, "00000000");

55 
i
 = 0;

56 
	`°r£t_ôî©e
(
sub
, 
ö_‹dî
, &
i
);

57 
	`ok1
(
i
 == 1);

60 
sub
 = 
	`°r£t_¥efix
(&
£t
, "0000000");

61 
i
 = 0;

62 
	`°r£t_ôî©e
(
sub
, 
ö_‹dî
, &
i
);

63 
	`ok1
(
i
 == 10);

66 
sub
 = 
	`°r£t_¥efix
(&
£t
, "000000");

67 
i
 = 0;

68 
	`°r£t_ôî©e
(
sub
, 
ö_‹dî
, &
i
);

69 
	`ok1
(
i
 == 100);

72 
em±y
 = 
	`°rdup
("");

73 
	`°r£t_add
(&
£t
, 
em±y
);

75 
sub
 = 
	`°r£t_¥efix
(&
£t
, "");

77 
	`°r£t_ôî©e
(
sub
, 
föd_em±y
, 
em±y
);

79 
	`°r£t_˛ór
(&
£t
);

81 
i
 = 0; i < 
NUM
; i++)

82 
	`‰ì
(
°r
[
i
]);

83 
	`‰ì
(
em±y
);

86  
	`exô_°©us
();

87 
	}
}

	@ccan/ccan/strset/test/run.c

1 
	~<cˇn/°r£t/°r£t.h
>

2 
	~<cˇn/°r£t/°r£t.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
°r£t
 
£t
;

8 c⁄° 
°r
[] = "hello";

9 c⁄° 
n⁄e
[] = "";

10 *
dup
 = 
	`°rdup
(
°r
);

13 
	`∂™_ã°s
(36);

15 
	`°r£t_öô
(&
£t
);

17 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
°r
));

18 
	`ok1
(
î∫o
 =
ENOENT
);

19 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
n⁄e
));

20 
	`ok1
(
î∫o
 =
ENOENT
);

21 
	`ok1
(!
	`°r£t_dñ
(&
£t
, 
°r
));

22 
	`ok1
(
î∫o
 =
ENOENT
);

23 
	`ok1
(!
	`°r£t_dñ
(&
£t
, 
n⁄e
));

24 
	`ok1
(
î∫o
 =
ENOENT
);

26 
	`ok1
(
	`°r£t_add
(&
£t
, 
°r
));

27 
	`ok1
(
	`°r£t_gë
(&
£t
, 
°r
));

29 
	`ok1
(
	`°r£t_gë
(&
£t
, 
dup
));

30 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
n⁄e
));

31 
	`ok1
(
î∫o
 =
ENOENT
);

34 
	`ok1
(!
	`°r£t_add
(&
£t
, 
dup
));

35 
	`ok1
(
î∫o
 =
EEXIST
);

38 
	`ok1
(
	`°r£t_dñ
(&
£t
, 
dup
Ë=
°r
);

39 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
°r
));

40 
	`ok1
(
î∫o
 =
ENOENT
);

41 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
n⁄e
));

42 
	`ok1
(
î∫o
 =
ENOENT
);

45 
	`ok1
(
	`°r£t_add
(&
£t
, 
n⁄e
));

46 
	`ok1
(
	`°r£t_gë
(&
£t
, 
n⁄e
));

47 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
°r
));

48 
	`ok1
(
î∫o
 =
ENOENT
);

51 
	`ok1
(
	`°r£t_dñ
(&
£t
, ""Ë=
n⁄e
);

52 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
°r
));

53 
	`ok1
(
î∫o
 =
ENOENT
);

54 
	`ok1
(!
	`°r£t_gë
(&
£t
, 
n⁄e
));

55 
	`ok1
(
î∫o
 =
ENOENT
);

58 
	`ok1
(
	`°r£t_add
(&
£t
, 
n⁄e
));

59 
	`ok1
(
	`°r£t_add
(&
£t
, 
°r
));

60 
	`ok1
(
	`°r£t_gë
(&
£t
, 
°r
));

61 
	`ok1
(
	`°r£t_gë
(&
£t
, 
n⁄e
));

62 
	`ok1
(
	`°r£t_dñ
(&
£t
, ""Ë=
n⁄e
);

63 
	`ok1
(
	`°r£t_dñ
(&
£t
, 
dup
Ë=
°r
);

65 
	`ok1
(
£t
.
u
.
n
 =
NULL
);

66 
	`‰ì
(
dup
);

69  
	`exô_°©us
();

70 
	}
}

	@ccan/ccan/strset/tools/cbspeed.c

22 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

23 
	~<cˇn/gøb_fûe/gøb_fûe.h
>

24 
	~<cˇn/èŒoc/èŒoc.h
>

25 
	~<cˇn/time/time.h
>

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

29 
	~<time.h
>

30 
	~<uni°d.h
>

31 
	~<sys/time.h
>

35 *
	mroŸ
;

36 } 
	t¸ôbô0_åì
;

38 
¸ôbô0_c⁄èös
(
¸ôbô0_åì
 *
t
, c⁄° *
u
);

39 
¸ôbô0_ö£π
(
¸ôbô0_åì
 *
t
, c⁄° *
u
);

40 
¸ôbô0_dñëe
(
¸ôbô0_åì
 *
t
, c⁄° *
u
);

41 
¸ôbô0_˛ór
(
¸ôbô0_åì
 *
t
);

42 
¸ôbô0_ÆÕªfixed
(
¸ôbô0_åì
 *
t
, c⁄° *
¥efix
,

43 (*
h™dÀ
Ë(c⁄° *, *), *
¨g
);

45 
	#uöt8
 
uöt8_t


	)

46 
	#uöt32
 
uöt32_t


	)

48 
size_t
 
Æloˇãd
;

52 
	~<°döt.h
>

53 
	~<°rög.h
>

54 
	~<°dlib.h
>

56 
	~<sys/ty≥s.h
>

57 
	~<î∫o.h
>

60 *
chûd
[2];

61 
uöt32
 
byã
;

62 
uöt8
 
Ÿhîbôs
;

63 }
	t¸ôbô0_node
;

68 
	$¸ôbô0_c⁄èös
(
¸ôbô0_åì
*
t
,c⁄° *
u
){

69 c⁄° 
uöt8
*
ubyãs
(*)
u
;

70 c⁄° 
size_t
 
uÀn

	`°æí
(
u
);

71 
uöt8
*
p

t
->
roŸ
;

75 if(!
p
) 0;

81 1&(
öçå_t
)
p
){

82 
¸ôbô0_node
*
q
(*)(
p
-1);

85 
uöt8
 
c
= 0;

86 if(
q
->
byã
<
uÀn
)
c

ubyãs
[q->byte];

87 c⁄° 
dúe˘i⁄
(1+(
q
->
Ÿhîbôs
|
c
))>>8;

91 
p

q
->
chûd
[
dúe˘i⁄
];

98  0==
	`°rcmp
(
u
,(c⁄° *)
p
);

102 
	}
}

106 
	$¸ôbô0_ö£π
(
¸ôbô0_åì
*
t
,c⁄° *
u
)

108 c⁄° 
uöt8
*c⁄° 
ubyãs
(*)
u
;

109 c⁄° 
size_t
 
uÀn

	`°æí
(
u
);

110 
uöt8
*
p

t
->
roŸ
;

114 if(!
p
){

116 *
x
;

117 
a

	`posix_memÆign
((**)&
x
,(*),
uÀn
+1);

118 if(
a
) 0;

119 
	`mem˝y
(
x
,
u
,
uÀn
+1);

120 
t
->
roŸ

x
;

122 
t
->
roŸ
 = (*)
u
;

131 1&(
öçå_t
)
p
){

132 
¸ôbô0_node
*
q
(*)(
p
-1);

135 
uöt8
 
c
= 0;

136 if(
q
->
byã
<
uÀn
)
c

ubyãs
[q->byte];

137 c⁄° 
dúe˘i⁄
(1+(
q
->
Ÿhîbôs
|
c
))>>8;

141 
p

q
->
chûd
[
dúe˘i⁄
];

150 
uöt32
 
√wbyã
;

151 
uöt32
 
√wŸhîbôs
;

153 
√wbyã
0;√wbyã<
uÀn
;++newbyte){

154 if(
p
[
√wbyã
]!=
ubyãs
[newbyte]){

155 
√wŸhîbôs

p
[
√wbyã
]^
ubyãs
[newbyte];

156 
dif„ª¡_byã_found
;

160 if(
p
[
√wbyã
]!=0){

161 
√wŸhîbôs

p
[
√wbyã
];

162 
dif„ª¡_byã_found
;

166 
dif„ª¡_byã_found
:

172 
√wŸhîbôs
&(newotherbits-1))newotherbits&=Çewotherbits-1;

173 
√wŸhîbôs
^= 255;

174 
uöt8
 
c

p
[
√wbyã
];

175 
√wdúe˘i⁄
(1+(
√wŸhîbôs
|
c
))>>8;

186 
¸ôbô0_node
*
√wnode
;

187 if(
	`posix_memÆign
((**)&
√wnode
,(*),(
¸ôbô0_node
))) 0;

188 
Æloˇãd
++;

189 *
x
;

191 if(
	`posix_memÆign
((**)&
x
,(*),
uÀn
+1)){

192 
	`‰ì
(
√wnode
);

195 
	`mem˝y
(
x
,
ubyãs
,
uÀn
+1);

197 
x
 = (*)
u
;

199 
√wnode
->
byã

√wbyã
;

200 
√wnode
->
Ÿhîbôs

√wŸhîbôs
;

201 
√wnode
->
chûd
[1-
√wdúe˘i⁄
]
x
;

207 **
whîï
&
t
->
roŸ
;

209 
uöt8
*
p
*
whîï
;

210 if(!(1&(
öçå_t
)
p
));

211 
¸ôbô0_node
*
q
(*)(
p
-1);

212 if(
q
->
byã
> 
√wbyã
);

213 if(
q
->
byã
==
√wbyã
&&q->
Ÿhîbôs
> 
√wŸhîbôs
);

214 
uöt8
 
c
= 0;

215 if(
q
->
byã
<
uÀn
)
c

ubyãs
[q->byte];

216 c⁄° 
dúe˘i⁄
(1+(
q
->
Ÿhîbôs
|
c
))>>8;

217 
whîï

q
->
chûd
+
dúe˘i⁄
;

220 
√wnode
->
chûd
[
√wdúe˘i⁄
]*
whîï
;

221 *
whîï
(*)(1+(*)
√wnode
);

230 
	}
}

234 
	$¸ôbô0_dñëe
(
¸ôbô0_åì
*
t
,c⁄° *
u
){

235 c⁄° 
uöt8
*
ubyãs
(*)
u
;

236 c⁄° 
size_t
 
uÀn

	`°æí
(
u
);

237 
uöt8
*
p

t
->
roŸ
;

238 **
whîï
&
t
->
roŸ
;

239 **
whîeq
= 0;

240 
¸ôbô0_node
*
q
= 0;

241 
dúe˘i⁄
= 0;

245 if(!
p
) 0;

251 1&(
öçå_t
)
p
){

252 
whîeq

whîï
;

253 
q
(*)(
p
-1);

254 
uöt8
 
c
= 0;

255 if(
q
->
byã
<
uÀn
)
c

ubyãs
[q->byte];

256 
dúe˘i⁄
(1+(
q
->
Ÿhîbôs
|
c
))>>8;

257 
whîï

q
->
chûd
+
dúe˘i⁄
;

258 
p
*
whîï
;

265 if(0!=
	`°rcmp
(
u
,(c⁄° *)
p
)) 0;

267 
	`‰ì
(
p
);

274 if(!
whîeq
){

275 
t
->
roŸ
= 0;

279 *
whîeq

q
->
chûd
[1-
dúe˘i⁄
];

280 
	`‰ì
(
q
);

281 
Æloˇãd
--;

286 
	}
}

291 
	$åavî£
(*
t›
){

294 
uöt8
*
p

t›
;

296 if(1&(
öçå_t
)
p
){

297 
¸ôbô0_node
*
q
(*)(
p
-1);

298 
	`åavî£
(
q
->
chûd
[0]);

299 
	`åavî£
(
q
->
chûd
[1]);

300 
	`‰ì
(
q
);

301 
Æloˇãd
--;

304 
	`‰ì
(
p
);

310 
	}
}

312 
	$¸ôbô0_˛ór
(
¸ôbô0_åì
*
t
)

314 if(
t
->
roŸ
)
	`åavî£
(t->root);

315 
t
->
roŸ

NULL
;

316 
	}
}

321 
ÆÕªfixed_åavî£
(
uöt8
*
t›
,

322 (*
h™dÀ
)(c⁄° *,*),*
¨g
){

325 if(1&(
öçå_t
)
t›
){

326 
¸ôbô0_node
*
q
(*)(
t›
-1);

327 
dúe˘i⁄
;

328 
dúe˘i⁄
= 0;direction<2;++direction)

329 
	`ÆÕªfixed_åavî£
(
q
->
chûd
[
dúe˘i⁄
],
h™dÀ
,
¨g
)){

341  
	`h™dÀ
((c⁄° *)
t›
,
¨g
);

343 
	}
}

346 
¸ôbô0_ÆÕªfixed
(
¸ôbô0_åì
*
t
,c⁄° *
¥efix
,

347 (*
h™dÀ
)(c⁄° *,*),*
¨g
){

348 c⁄° 
uöt8
*
ubyãs
(*)
¥efix
;

349 c⁄° 
size_t
 
uÀn

	`°æí
(
¥efix
);

350 
uöt8
*
p

t
->
roŸ
;

351 
uöt8
*
t›

p
;

352 
size_t
 
i
;

354 if(!
p
) 1;

357 1&(
öçå_t
)
p
){

358 
¸ôbô0_node
*
q
(*)(
p
-1);

359 
uöt8
 
c
= 0;

360 if(
q
->
byã
<
uÀn
)
c

ubyãs
[q->byte];

361 c⁄° 
dúe˘i⁄
(1+(
q
->
Ÿhîbôs
|
c
))>>8;

362 
p

q
->
chûd
[
dúe˘i⁄
];

363 if(
q
->
byã
<
uÀn
)
t›

p
;

370 
i
0;i<
uÀn
;++i){

371 if(
p
[
i
]!=
ubyãs
[i]) 1;

377  
	`ÆÕªfixed_åavî£
(
t›
,
h™dÀ
,
¨g
);

378 
	}
}

384 
size_t
 
	$n‹mÆize
(c⁄° 
timevÆ
 *
°¨t
,

385 c⁄° 
timevÆ
 *
°›
,

386 
num
)

388 
timevÆ
 
diff
;

390 
	`timîsub
(
°›
, 
°¨t
, &
diff
);

393  ()(
diff
.
tv_£c
 * 1000000 + diff.
tv_u£c
)

394 / 
num
 * 1000;

395 
	}
}

397 
	$maö
(
¨gc
, *
¨gv
[])

399 
size_t
 
i
, 
j
, 
num
;

400 
timevÆ
 
°¨t
, 
°›
;

401 
¸ôbô0_åì
 
˘
;

402 **
w‹ds
, **
missw‹ds
;

404 
w‹ds
 = 
	`°r•lô
(
NULL
, 
	`gøb_fûe
(NULL,

405 
¨gv
[1] ?árgv[1] : "/usr/share/dict/words",

406 
NULL
), "\n");

407 
˘
.
roŸ
 = 
NULL
;

408 
num
 = 
	`èŒoc_¨øy_Àngth
(
w‹ds
) - 1;

409 
	`¥ötf
("%zu w‹ds\n", 
num
);

412 
missw‹ds
 = 
	`èŒoc_¨øy
(
w‹ds
, *, 
num
);

413 
i
 = 0; i < 
num
; i++) {

414 
œ°c
;

415 i‡(
	`°æí
(
w‹ds
[
i
]))

416 
œ°c
 = 
w‹ds
[
i
][
	`°æí
(words[i])-1];

418 
œ°c
 = 'z';

419 
missw‹ds
[
i
] = 
	`èŒoc_a•rötf
(misswords, "%c%s%c%c",

420 
œ°c
, 
w‹ds
[
i
],Üastc,Üastc);

423 
	`¥ötf
("#01: Initial insert: ");

424 
	`fÊush
(
°dout
);

425 
°¨t
 = 
	`time_now
();

426 
i
 = 0; i < 
num
; i++)

427 
	`¸ôbô0_ö£π
(&
˘
, 
w‹ds
[
i
]);

428 
°›
 = 
	`time_now
();

429 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

431 
	`¥ötf
("Nodesállocated: %zu (%zu bytes)\n",

432 
Æloˇãd
,áŒoˇãd * (
¸ôbô0_node
));

434 
	`¥ötf
("#02: InitialÜookup (match): ");

435 
	`fÊush
(
°dout
);

436 
°¨t
 = 
	`time_now
();

437 
i
 = 0; i < 
num
; i++)

438 i‡(!
	`¸ôbô0_c⁄èös
(&
˘
, 
w‹ds
[
i
]))

439 
	`ab‹t
();

440 
°›
 = 
	`time_now
();

441 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

443 
	`¥ötf
("#03: InitialÜookup (miss): ");

444 
	`fÊush
(
°dout
);

445 
°¨t
 = 
	`time_now
();

446 
i
 = 0; i < 
num
; i++) {

447 i‡(
	`¸ôbô0_c⁄èös
(&
˘
, 
missw‹ds
[
i
]))

448 
	`ab‹t
();

450 
°›
 = 
	`time_now
();

451 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

454 
	`¥ötf
("#04: InitialÜookup (random): ");

455 
	`fÊush
(
°dout
);

456 
°¨t
 = 
	`time_now
();

457 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

458 i‡(!
	`¸ôbô0_c⁄èös
(&
˘
, 
w‹ds
[
j
]))

459 
	`ab‹t
();

460 
°›
 = 
	`time_now
();

461 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

463 
	`¥ötf
("#05: Initial deleteáll: ");

464 
	`fÊush
(
°dout
);

465 
°¨t
 = 
	`time_now
();

466 
i
 = 0; i < 
num
; i++)

467 i‡(!
	`¸ôbô0_dñëe
(&
˘
, 
w‹ds
[
i
]))

468 
	`ab‹t
();

469 
°›
 = 
	`time_now
();

470 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

472 
	`¥ötf
("#06: InitialÑe-inserting: ");

473 
	`fÊush
(
°dout
);

474 
°¨t
 = 
	`time_now
();

475 
i
 = 0; i < 
num
; i++)

476 
	`¸ôbô0_ö£π
(&
˘
, 
w‹ds
[
i
]);

477 
°›
 = 
	`time_now
();

478 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

480 
	`¥ötf
("#07: Deleting first half: ");

481 
	`fÊush
(
°dout
);

482 
°¨t
 = 
	`time_now
();

483 
i
 = 0; i < 
num
; i+=2)

484 i‡(!
	`¸ôbô0_dñëe
(&
˘
, 
w‹ds
[
i
]))

485 
	`ab‹t
();

486 
°›
 = 
	`time_now
();

487 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

489 
	`¥ötf
("#08: Adding (a different) half: ");

490 
	`fÊush
(
°dout
);

492 
°¨t
 = 
	`time_now
();

493 
i
 = 0; i < 
num
; i+=2)

494 
	`¸ôbô0_ö£π
(&
˘
, 
missw‹ds
[
i
]);

495 
°›
 = 
	`time_now
();

496 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

498 
	`¥ötf
("#09: Lookupáfter half-change (match): ");

499 
	`fÊush
(
°dout
);

500 
°¨t
 = 
	`time_now
();

501 
i
 = 1; i < 
num
; i+=2)

502 i‡(!
	`¸ôbô0_c⁄èös
(&
˘
, 
w‹ds
[
i
]))

503 
	`ab‹t
();

504 
i
 = 0; i < 
num
; i+=2) {

505 i‡(!
	`¸ôbô0_c⁄èös
(&
˘
, 
missw‹ds
[
i
]))

506 
	`ab‹t
();

508 
°›
 = 
	`time_now
();

509 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

511 
	`¥ötf
("#10: Lookupáfter half-change (miss): ");

512 
	`fÊush
(
°dout
);

513 
°¨t
 = 
	`time_now
();

514 
i
 = 0; i < 
num
; i+=2)

515 i‡(
	`¸ôbô0_c⁄èös
(&
˘
, 
w‹ds
[
i
]))

516 
	`ab‹t
();

517 
i
 = 1; i < 
num
; i+=2) {

518 i‡(
	`¸ôbô0_c⁄èös
(&
˘
, 
missw‹ds
[
i
]))

519 
	`ab‹t
();

521 
°›
 = 
	`time_now
();

522 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

526 
	`¥ötf
("#11: Churn 1: ");

527 
°¨t
 = 
	`time_now
();

528 
j
 = 0; j < 
num
; j+=2) {

529 i‡(!
	`¸ôbô0_dñëe
(&
˘
, 
missw‹ds
[
j
]))

530 
	`ab‹t
();

531 i‡(
	`¸ôbô0_ö£π
(&
˘
, 
w‹ds
[
j
]) != 2)

532 
	`ab‹t
();

534 
°›
 = 
	`time_now
();

535 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

537 
	`¥ötf
("#12: Churn 2: ");

538 
°¨t
 = 
	`time_now
();

539 
j
 = 1; j < 
num
; j+=2) {

540 i‡(!
	`¸ôbô0_dñëe
(&
˘
, 
w‹ds
[
j
]))

541 
	`ab‹t
();

542 i‡(
	`¸ôbô0_ö£π
(&
˘
, 
missw‹ds
[
j
]) != 2)

543 
	`ab‹t
();

545 
°›
 = 
	`time_now
();

546 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

548 
	`¥ötf
("#13: Churn 3: ");

549 
°¨t
 = 
	`time_now
();

550 
j
 = 1; j < 
num
; j+=2) {

551 i‡(!
	`¸ôbô0_dñëe
(&
˘
, 
missw‹ds
[
j
]))

552 
	`ab‹t
();

553 i‡(
	`¸ôbô0_ö£π
(&
˘
, 
w‹ds
[
j
]) != 2)

554 
	`ab‹t
();

556 
°›
 = 
	`time_now
();

557 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

560 
	`¥ötf
("#14: Post-ChurnÜookup (match): ");

561 
	`fÊush
(
°dout
);

562 
°¨t
 = 
	`time_now
();

563 
i
 = 0; i < 
num
; i++)

564 i‡(!
	`¸ôbô0_c⁄èös
(&
˘
, 
w‹ds
[
i
]))

565 
	`ab‹t
();

566 
°›
 = 
	`time_now
();

567 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

569 
	`¥ötf
("#15: Post-ChurnÜookup (miss): ");

570 
	`fÊush
(
°dout
);

571 
°¨t
 = 
	`time_now
();

572 
i
 = 0; i < 
num
; i++) {

573 i‡(
	`¸ôbô0_c⁄èös
(&
˘
, 
missw‹ds
[
i
]))

574 
	`ab‹t
();

576 
°›
 = 
	`time_now
();

577 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

580 
	`¥ötf
("#16: Post-ChurnÜookup (random): ");

581 
	`fÊush
(
°dout
);

582 
°¨t
 = 
	`time_now
();

583 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

584 i‡(!
	`¸ôbô0_c⁄èös
(&
˘
, 
w‹ds
[
j
]))

585 
	`ab‹t
();

586 
°›
 = 
	`time_now
();

587 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

590 
	}
}

	@ccan/ccan/strset/tools/speed.c

22 
	~<cˇn/°r_èŒoc/°r_èŒoc.h
>

23 
	~<cˇn/gøb_fûe/gøb_fûe.h
>

24 
	~<cˇn/èŒoc/èŒoc.h
>

25 
	~<cˇn/time/time.h
>

26 
	~<cˇn/°r£t/°r£t.c
>

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<time.h
>

31 
	~<uni°d.h
>

32 
	~<sys/time.h
>

35 
size_t
 
	$n‹mÆize
(c⁄° 
timevÆ
 *
°¨t
,

36 c⁄° 
timevÆ
 *
°›
,

37 
num
)

39 
timevÆ
 
diff
;

41 
	`timîsub
(
°›
, 
°¨t
, &
diff
);

44  ()(
diff
.
tv_£c
 * 1000000 + diff.
tv_u£c
)

45 / 
num
 * 1000;

46 
	}
}

48 
	$maö
(
¨gc
, *
¨gv
[])

50 
size_t
 
i
, 
j
, 
num
;

51 
timevÆ
 
°¨t
, 
°›
;

52 
°r£t
 
£t
;

53 **
w‹ds
, **
missw‹ds
;

55 
w‹ds
 = 
	`°r•lô
(
NULL
, 
	`gøb_fûe
(NULL,

56 
¨gv
[1] ?árgv[1] : "/usr/share/dict/words",

57 
NULL
), "\n");

58 
	`°r£t_öô
(&
£t
);

59 
num
 = 
	`èŒoc_¨øy_Àngth
(
w‹ds
) - 1;

60 
	`¥ötf
("%zu w‹ds\n", 
num
);

63 
missw‹ds
 = 
	`èŒoc_¨øy
(
w‹ds
, *, 
num
);

64 
i
 = 0; i < 
num
; i++) {

65 
œ°c
;

66 i‡(
	`°æí
(
w‹ds
[
i
]))

67 
œ°c
 = 
w‹ds
[
i
][
	`°æí
(words[i])-1];

69 
œ°c
 = 'z';

70 
missw‹ds
[
i
] = 
	`èŒoc_a•rötf
(misswords, "%c%s%c%c",

71 
œ°c
, 
w‹ds
[
i
],Üastc,Üastc);

74 
	`¥ötf
("#01: Initial insert: ");

75 
	`fÊush
(
°dout
);

76 
°¨t
 = 
	`time_now
();

77 
i
 = 0; i < 
num
; i++)

78 
	`°r£t_£t
(&
£t
, 
w‹ds
[
i
]);

79 
°›
 = 
	`time_now
();

80 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

83 
	`¥ötf
("Nodesállocated: %zu (%zu bytes)\n",

84 
Æloˇãd
,áŒoˇãd * (
¸ôbô0_node
));

87 
	`¥ötf
("#02: InitialÜookup (match): ");

88 
	`fÊush
(
°dout
);

89 
°¨t
 = 
	`time_now
();

90 
i
 = 0; i < 
num
; i++)

91 i‡(!
	`°r£t_ã°
(&
£t
, 
w‹ds
[
i
]))

92 
	`ab‹t
();

93 
°›
 = 
	`time_now
();

94 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

96 
	`¥ötf
("#03: InitialÜookup (miss): ");

97 
	`fÊush
(
°dout
);

98 
°¨t
 = 
	`time_now
();

99 
i
 = 0; i < 
num
; i++) {

100 i‡(
	`°r£t_ã°
(&
£t
, 
missw‹ds
[
i
]))

101 
	`ab‹t
();

103 
°›
 = 
	`time_now
();

104 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

107 
	`¥ötf
("#04: InitialÜookup (random): ");

108 
	`fÊush
(
°dout
);

109 
°¨t
 = 
	`time_now
();

110 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

111 i‡(!
	`°r£t_ã°
(&
£t
, 
w‹ds
[
j
]))

112 
	`ab‹t
();

113 
°›
 = 
	`time_now
();

114 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

116 
	`¥ötf
("#05: Initial deleteáll: ");

117 
	`fÊush
(
°dout
);

118 
°¨t
 = 
	`time_now
();

119 
i
 = 0; i < 
num
; i++)

120 i‡(!
	`°r£t_˛ór
(&
£t
, 
w‹ds
[
i
]))

121 
	`ab‹t
();

122 
°›
 = 
	`time_now
();

123 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

125 
	`¥ötf
("#06: InitialÑe-inserting: ");

126 
	`fÊush
(
°dout
);

127 
°¨t
 = 
	`time_now
();

128 
i
 = 0; i < 
num
; i++)

129 
	`°r£t_£t
(&
£t
, 
w‹ds
[
i
]);

130 
°›
 = 
	`time_now
();

131 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

133 
	`¥ötf
("#07: Deleting first half: ");

134 
	`fÊush
(
°dout
);

135 
°¨t
 = 
	`time_now
();

136 
i
 = 0; i < 
num
; i+=2)

137 i‡(!
	`°r£t_˛ór
(&
£t
, 
w‹ds
[
i
]))

138 
	`ab‹t
();

139 
°›
 = 
	`time_now
();

140 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

142 
	`¥ötf
("#08: Adding (a different) half: ");

143 
	`fÊush
(
°dout
);

145 
°¨t
 = 
	`time_now
();

146 
i
 = 0; i < 
num
; i+=2)

147 
	`°r£t_£t
(&
£t
, 
missw‹ds
[
i
]);

148 
°›
 = 
	`time_now
();

149 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

151 
	`¥ötf
("#09: Lookupáfter half-change (match): ");

152 
	`fÊush
(
°dout
);

153 
°¨t
 = 
	`time_now
();

154 
i
 = 1; i < 
num
; i+=2)

155 i‡(!
	`°r£t_ã°
(&
£t
, 
w‹ds
[
i
]))

156 
	`ab‹t
();

157 
i
 = 0; i < 
num
; i+=2) {

158 i‡(!
	`°r£t_ã°
(&
£t
, 
missw‹ds
[
i
]))

159 
	`ab‹t
();

161 
°›
 = 
	`time_now
();

162 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

164 
	`¥ötf
("#10: Lookupáfter half-change (miss): ");

165 
	`fÊush
(
°dout
);

166 
°¨t
 = 
	`time_now
();

167 
i
 = 0; i < 
num
; i+=2)

168 i‡(
	`°r£t_ã°
(&
£t
, 
w‹ds
[
i
]))

169 
	`ab‹t
();

170 
i
 = 1; i < 
num
; i+=2) {

171 i‡(
	`°r£t_ã°
(&
£t
, 
missw‹ds
[
i
]))

172 
	`ab‹t
();

174 
°›
 = 
	`time_now
();

175 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

179 
	`¥ötf
("#11: Churn 1: ");

180 
°¨t
 = 
	`time_now
();

181 
j
 = 0; j < 
num
; j+=2) {

182 i‡(!
	`°r£t_˛ór
(&
£t
, 
missw‹ds
[
j
]))

183 
	`ab‹t
();

184 i‡(!
	`°r£t_£t
(&
£t
, 
w‹ds
[
j
]))

185 
	`ab‹t
();

187 
°›
 = 
	`time_now
();

188 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

190 
	`¥ötf
("#12: Churn 2: ");

191 
°¨t
 = 
	`time_now
();

192 
j
 = 1; j < 
num
; j+=2) {

193 i‡(!
	`°r£t_˛ór
(&
£t
, 
w‹ds
[
j
]))

194 
	`ab‹t
();

195 i‡(!
	`°r£t_£t
(&
£t
, 
missw‹ds
[
j
]))

196 
	`ab‹t
();

198 
°›
 = 
	`time_now
();

199 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

201 
	`¥ötf
("#13: Churn 3: ");

202 
°¨t
 = 
	`time_now
();

203 
j
 = 1; j < 
num
; j+=2) {

204 i‡(!
	`°r£t_˛ór
(&
£t
, 
missw‹ds
[
j
]))

205 
	`ab‹t
();

206 i‡(!
	`°r£t_£t
(&
£t
, 
w‹ds
[
j
]))

207 
	`ab‹t
();

209 
°›
 = 
	`time_now
();

210 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

213 
	`¥ötf
("#14: Post-ChurnÜookup (match): ");

214 
	`fÊush
(
°dout
);

215 
°¨t
 = 
	`time_now
();

216 
i
 = 0; i < 
num
; i++)

217 i‡(!
	`°r£t_ã°
(&
£t
, 
w‹ds
[
i
]))

218 
	`ab‹t
();

219 
°›
 = 
	`time_now
();

220 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

222 
	`¥ötf
("#15: Post-ChurnÜookup (miss): ");

223 
	`fÊush
(
°dout
);

224 
°¨t
 = 
	`time_now
();

225 
i
 = 0; i < 
num
; i++) {

226 i‡(
	`°r£t_ã°
(&
£t
, 
missw‹ds
[
i
]))

227 
	`ab‹t
();

229 
°›
 = 
	`time_now
();

230 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

233 
	`¥ötf
("#16: Post-ChurnÜookup (random): ");

234 
	`fÊush
(
°dout
);

235 
°¨t
 = 
	`time_now
();

236 
i
 = 0, 
j
 = 0; i < 
num
; i++, j = (j + 10007) %Çum)

237 i‡(!
	`°r£t_ã°
(&
£t
, 
w‹ds
[
j
]))

238 
	`ab‹t
();

239 
°›
 = 
	`time_now
();

240 
	`¥ötf
(" %zuÇs\n", 
	`n‹mÆize
(&
°¨t
, &
°›
, 
num
));

243 
	}
}

	@ccan/ccan/take/take.c

2 
	~<cˇn/èke/èke.h
>

3 
	~<cˇn/likñy/likñy.h
>

4 
	~<°dlib.h
>

5 
	~<°rög.h
>

7 c⁄° **
	gèkí¨r
;

8 
size_t
 
	gmax_èkí
, 
	gnum_èkí
;

9 
size_t
 
	gÆlocÁû
;

10 (*
ÆlocÁû‚
)(c⁄° *
p
);

12 *
	$èke_
(c⁄° *
p
)

14 i‡(
	`u∆ikñy
(
num_èkí
 =
max_èkí
)) {

15 c⁄° **
√w
;

17 
√w
 = 
	`ªÆloc
(
èkí¨r
, (*èkí¨rË* (
max_èkí
+1));

18 i‡(
	`u∆ikñy
(!
√w
)) {

19 i‡(
ÆlocÁû‚
) {

20 
ÆlocÁû
++;

21 
	`ÆlocÁû‚
(
p
);

22  
NULL
;

25  (*)
p
;

27 
èkí¨r
 = 
√w
;

28 
max_èkí
++;

30 
èkí¨r
[
num_èkí
++] = 
p
;

31  (*)
p
;

32 
	}
}

34 
size_t
 
	$föd_èkí
(c⁄° *
p
)

36 
size_t
 
i
;

38 
i
 = 0; i < 
num_èkí
; i++) {

39 i‡(
èkí¨r
[
i
] =
p
)

40  
i
+1;

43 
	}
}

45 
boﬁ
 
	$èkí
(c⁄° *
p
)

47 
size_t
 
i
;

49 i‡(!
p
 && 
	`u∆ikñy
(
ÆlocÁû
)) {

50 
ÆlocÁû
--;

51  
åue
;

54 
i
 = 
	`föd_èkí
(
p
);

55 i‡(!
i
)

56  
Ál£
;

58 
	`memmove
(&
èkí¨r
[
i
-1], &takenarr[i],

59 (--
num_èkí
 - (
i
 - 1))*(
èkí¨r
[0]));

60  
åue
;

61 
	}
}

63 
boﬁ
 
	$is_èkí
(c⁄° *
p
)

65 i‡(!
p
 && 
	`u∆ikñy
(
ÆlocÁû
))

66  
åue
;

68  
	`föd_èkí
(
p
) > 0;

69 
	}
}

71 
boﬁ
 
	$èkí_™y
()

73  
num_èkí
 != 0;

74 
	}
}

76 
	$èke_˛ónup
()

78 
max_èkí
 = 
num_èkí
 = 0;

79 
	`‰ì
(
èkí¨r
);

80 
èkí¨r
 = 
NULL
;

81 
	}
}

83 
èke_ÆlocÁû
((*
‚
)(c⁄° *
p
))

85 
ÆlocÁû‚
 = 
‚
;

86 
	}
}

	@ccan/ccan/take/take.h

2 #i‚de‡
CCAN_TAKE_H


3 
	#CCAN_TAKE_H


	)

4 
	~"c⁄fig.h
"

5 
	~<°dboﬁ.h
>

15 
	#èke
(
p
Ë(
	`èke_ty≥of
’Ë
	`èke_
(’)))

	)

39 
boﬁ
 
èkí
(c⁄° *
p
);

58 
boﬁ
 
is_èkí
(c⁄° *
p
);

71 
boﬁ
 
èkí_™y
();

84 
èke_˛ónup
();

106 
èke_ÆlocÁû
((*
‚
)(c⁄° *
p
));

109 #i‡
HAVE_TYPEOF


110 
	#èke_ty≥of
(
±r
Ë(
	`__ty≥of__
’å))

	)

112 
	#èke_ty≥of
(
±r
)

	)

115 *
	`èke_
(c⁄° *
p
);

	@ccan/ccan/take/test/run.c

1 
	~<°dlib.h
>

2 
	~<°dboﬁ.h
>

4 
boﬁ
 
	gÁû_ªÆloc
;

5 *
	$my_ªÆloc
(*
p
, 
size_t
 
Àn
)

7 i‡(
Áû_ªÆloc
)

8  
NULL
;

9  
	`ªÆloc
(
p
, 
Àn
);

10 
	}
}

11 
	#ªÆloc
 
my_ªÆloc


	)

13 
	~<cˇn/èke/èke.h
>

14 
	~<cˇn/èke/èke.c
>

15 
	~<cˇn/èp/èp.h
>

17 
	gmy_ÆlocÁû_ˇŒed
;

18 
	$my_ÆlocÁû
(c⁄° *
p
)

20 
my_ÆlocÁû_ˇŒed
++;

21 
	}
}

23 
	$ªcur£
(c⁄° *
èkeme
, 
cou¡
)

25 i‡(
cou¡
 < 1000)

26 
	`ªcur£
(
	`èke
(
	`°rdup
(
èkeme
)), 
cou¡
+1);

27 i‡(
	`èkí
(
èkeme
))

28 
	`‰ì
((*)
èkeme
);

29 
	}
}

31 
	$maö
()

33 c⁄° *
p
 = "hi";

35 
	`∂™_ã°s
(43);

38 
	`ok1
(
	`èke
(
NULL
) == NULL);

39 
	`ok1
(
	`is_èkí
(
NULL
));

40 
	`ok1
(
	`èkí_™y
());

41 
	`ok1
(
	`èkí
(
NULL
));

42 
	`ok1
(!
	`is_èkí
(
NULL
));

43 
	`ok1
(!
	`èkí
(
NULL
));

46 
	`ok1
(
	`èke
(
NULL
) == NULL);

47 
	`ok1
(
	`èke
(
NULL
) == NULL);

48 
	`ok1
(
	`is_èkí
(
NULL
));

49 
	`ok1
(
	`èkí_™y
());

50 
	`ok1
(
	`èkí
(
NULL
));

51 
	`ok1
(
	`is_èkí
(
NULL
));

52 
	`ok1
(
	`èkí_™y
());

53 
	`ok1
(
	`èkí
(
NULL
));

54 
	`ok1
(!
	`is_èkí
(
NULL
));

55 
	`ok1
(!
	`èkí
(
NULL
));

56 
	`ok1
(!
	`èkí_™y
());

59 
	`ok1
(
	`èke
(
p
) ==Ö);

60 
	`ok1
(
	`is_èkí
(
p
));

61 
	`ok1
(
	`èkí_™y
());

62 
	`ok1
(
	`èkí
(
p
));

63 
	`ok1
(!
	`is_èkí
(
p
));

64 
	`ok1
(!
	`èkí
(
p
));

65 
	`ok1
(!
	`èkí_™y
());

68 
	`ok1
(!
my_ÆlocÁû_ˇŒed
);

69 
	`ok1
(
	`èke
(
p
) ==Ö);

70 
	`ok1
(
	`èke
(
p
+1) ==Ö+1);

72 
Áû_ªÆloc
 = 
åue
;

74 
	`ok1
(
	`èke
(
p
+2) ==Ö+2);

75 
	`ok1
(!
	`èkí
(
p
+2));

78 
	`èke_ÆlocÁû
(
my_ÆlocÁû
);

79 
	`ok1
(
	`èke
(
p
+2Ë=
NULL
);

81 
	`ok1
(
my_ÆlocÁû_ˇŒed
 == 1);

82 
	`ok1
(
	`èkí_™y
());

83 
	`ok1
(
	`èkí
(
p
));

84 
	`ok1
(
	`èkí
(
p
+1));

85 
	`ok1
(
	`is_èkí
(
NULL
));

86 
	`ok1
(
	`èkí
(
NULL
));

87 
	`ok1
(!
	`èkí
(
NULL
));

88 
	`ok1
(!
	`èkí_™y
());

91 
Áû_ªÆloc
 = 
Ál£
;

92 
	`ªcur£
("hello", 0);

93 
	`ok1
(
max_èkí
 == 1000);

94 
	`ok1
(!
	`èkí_™y
());

96 
	`èke_˛ónup
();

97 
	`ok1
(
num_èkí
 == 0);

98 
	`ok1
(
max_èkí
 == 0);

99 
	`ok1
(
èkí¨r
 =
NULL
);

101  
	`exô_°©us
();

102 
	}
}

	@ccan/ccan/tal/benchmark/samba-allocs.c

2 
	~<cˇn/èŒoc/èŒoc.h
>

3 
	~<cˇn/èl/èl.h
>

4 
	~<cˇn/time/time.h
>

5 
	~<cˇn/îr/îr.h
>

6 
	~<cˇn/°r/°r.h
>

7 
	~<°rög.h
>

8 
	~<as£π.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/°©.h
>

11 
	~<uni°d.h
>

12 
	~<f˙é.h
>

14 
	snode
 {

15 *
	mn
;

16 
node
 *
	m∑ª¡
;

17 *
	m«me
;

18 
boﬁ
 
	mde°ru˘‹
;

19 
size_t
 
	mÀn
;

20 
	mnum_chûdªn
;

21 
node
 *
	mchûdªn
[0];

24 
	gnode_cou¡
;

26 
node
 *
	$√w_node
()

28 
node_cou¡
++;

29  
	`ˇŒoc
((
node
), 1);

30 
	}
}

33 
node
 *
	$∑r£
(c⁄° *
löe
)

35 
node
 *
n
 = 
	`√w_node
();

36 c⁄° *
p
;

38 
p
 = 
	`°r°r
(
löe
, " contains ");

39 
p
 +
	`°æí
(" contains ");

40 
p
 +
	`°r•n
(
löe
, " ");

41 
n
->
Àn
 = 
	`°πﬁ
(
p
, 
NULL
, 0);

42 
p
 = 
	`°r°r
(p, "d=");

43 i‡(
p
[2] != '(')

44 
n
->
de°ru˘‹
 = 
åue
;

45  
n
;

46 
	}
}

48 
	$add_chûd
(
node
 *
∑ª¡
, nodê*
chûd
)

50 
i
;

51 
node
 *
ﬁdp
 = 
∑ª¡
;

53 
∑ª¡
 = 
	`ªÆloc
(parent, (*parent)

54 + (
∑ª¡
->
chûdªn
[0]Ë* (∑ª¡->
num_chûdªn
+1));

55 
∑ª¡
->
chûdªn
[∑ª¡->
num_chûdªn
++] = 
chûd
;

56 
chûd
->
∑ª¡
 =Öarent;

58 i‡(
∑ª¡
 =
ﬁdp
)

62 
i
 = 0; i < 
∑ª¡
->
num_chûdªn
-1; i++) {

63 
	`as£π
(
∑ª¡
->
chûdªn
[
i
]->∑ª¡ =
ﬁdp
);

64 
∑ª¡
->
chûdªn
[
i
]->parent =Öarent;

68 i‡(
∑ª¡
->parent) {

69 
	`as£π
(
∑ª¡
->∑ª¡->
chûdªn
[∑ª¡->∑ª¡->
num_chûdªn
-1]

70 =
ﬁdp
);

71 
∑ª¡
->∑ª¡->
chûdªn
[∑ª¡->∑ª¡->
num_chûdªn
-1]

72 
∑ª¡
;

74 
	}
}

77 *
	$«mñí
(
Àn
)

79 *
p
 = 
	`mÆloc
(
Àn
);

80 
	`mem£t
(
p
, 'x', 
Àn
-1);

81 
p
[
Àn
-1] = '\0';

82  
p
;

83 
	}
}

85 
node
 *
	$ªad_nodes
(
FILE
 *
f
)

87 
löe
[4096];

88 
cuº_ödít
 = 0, 
ödít
;

89 
node
 *
n
, *
cuº
 = 
	`√w_node
();

92 
	`fgës
(
löe
, 4096, 
f
);

94 
	`fgës
(
löe
, 4096, 
f
)) {

95 
boﬁ
 
is_«me
;

97 
ödít
 = 
	`°r•n
(
löe
, " ");

100 i‡(
	`°r°¨ts
(
löe
 + 
ödít
, "referenceÅo: "))

104 i‡(
	`°r°¨ts
(
löe
 + 
ödít
, "contains "))

105 
ödít
 -= 31;

107 
is_«me
 = 
	`°r°¨ts
(
löe
 + 
ödít
, ".name ");

109 
n
 = 
	`∑r£
(
löe
 + 
ödít
);

110 i‡(
is_«me
) {

111 
cuº
->
«me
 = 
	`«mñí
(
n
->
Àn
);

112 
	`‰ì
(
n
);

114 i‡(
ödít
 > 
cuº_ödít
) {

115 
	`as£π
(
ödít
 =
cuº_ödít
 + 4);

116 
cuº_ödít
 += 4;

119 
cuº_ödít
 += 4;

120 
cuº_ödít
 !
ödít
;

121 
cuº_ödít
 -= 4)

122 
cuº
 = cuº->
∑ª¡
;

124 
	`add_chûd
(
cuº
, 
n
);

125 
cuº
 = 
n
;

128 
cuº
->
∑ª¡
) {

129 
cuº
 = cuº->
∑ª¡
;

130 
cuº_ödít
 -= 4;

132 
	`as£π
(
cuº_ödít
 == 0);

133  
cuº
;

134 
	}
}

136 
	$unu£d_èŒoc_de°ru˘‹
(*
p
)

139 
	}
}

141 
	$do_èŒocs
(
node
 *node)

143 
i
;

144 
cou¡
;

146 i‡(
cou¡
++ % 16 == 0)

147 
node
->
n
 = 
	`èŒoc_¨øy
“ode->
∑ª¡
 ?Çode->∑ª¡->¿: 
NULL
,

148 , 
node
->
Àn
);

150 
node
->
n
 = 
	`èŒoc_size
“ode->
∑ª¡
 ?Çode->∑ª¡->¿: 
NULL
,

151 
node
->
Àn
);

152 i‡(
node
->
de°ru˘‹
)

153 
	`èŒoc_£t_de°ru˘‹
(
node
->
n
, 
unu£d_èŒoc_de°ru˘‹
);

154 i‡(
node
->
«me
)

155 
	`èŒoc_£t_«me
(
node
->
n
, "%s",Çode->
«me
);

157 
i
 = 0; i < 
node
->
num_chûdªn
; i++)

158 
	`do_èŒocs
(
node
->
chûdªn
[
i
]);

159 
	}
}

161 
	$‰ì_èŒocs
(
node
 *node)

163 
i
;

165 
i
 = 0; i < 
node
->
num_chûdªn
; i++)

166 
	`‰ì_èŒocs
(
node
->
chûdªn
[
i
]);

168 
	`èŒoc_‰ì
(
node
->
n
);

169 
	}
}

171 
	$unu£d_èl_de°ru˘‹
(*
p
)

173 
	}
}

175 
	$do_èls
(
node
 *node)

177 
i
;

178 
cou¡
;

183 i‡(
cou¡
++ % 16 == 0)

184 
node
->
n
 = 
	`èl_¨r
“ode->
∑ª¡
 ?Çode->∑ª¡->¿: 
NULL
,

185 , 
node
->
Àn
);

187 
node
->
n
 = 
	`èl_Æloc_
“ode->
∑ª¡
 ?Çode->∑ª¡->¿: 
NULL
,

188 
node
->
Àn
, 
Ál£
, 
	`TAL_LABEL
(
ty≥
, ""));

190 i‡(
node
->
de°ru˘‹
)

191 
	`èl_add_de°ru˘‹
(
node
->
n
, 
unu£d_èl_de°ru˘‹
);

192 i‡(
node
->
«me
)

193 
	`èl_£t_«me
(
node
->
n
,Çode->
«me
);

195 
i
 = 0; i < 
node
->
num_chûdªn
; i++)

196 
	`do_èls
(
node
->
chûdªn
[
i
]);

197 
	}
}

199 
	$‰ì_èls
(
node
 *node)

201 
i
;

203 
i
 = 0; i < 
node
->
num_chûdªn
; i++)

204 
	`‰ì_èls
(
node
->
chûdªn
[
i
]);

206 
	`èl_‰ì
(
node
->
n
);

207 
	}
}

209 
	$do_mÆlocs
(
node
 *node)

211 
i
;

213 
node
->
n
 = 
	`mÆloc
“ode->
Àn
 + (node->
«me
 ? 
	`°æí
(node->name) + 1 : 1));

215 
i
 = 0; i < 
node
->
num_chûdªn
; i++)

216 
	`do_mÆlocs
(
node
->
chûdªn
[
i
]);

217 
	}
}

219 
	$‰ì_mÆlocs
(
node
 *node)

221 
i
;

223 
i
 = 0; i < 
node
->
num_chûdªn
; i++)

224 
	`‰ì_mÆlocs
(
node
->
chûdªn
[
i
]);

226 
	`‰ì
(
node
->
n
);

227 
	}
}

230 
	$dump_vsize
()

232 
fd
, 
i
;

233 
buf
[1000], *
p
 = buf;

235 
	`•rötf
(
buf
, "/¥oc/%u/°©", 
	`gëpid
());

236 
fd
 = 
	`›í
(
buf
, 
O_RDONLY
);

237 
	`ªad
(
fd
, 
buf
, (buf));

238 
	`˛o£
(
fd
);

240 
i
 = 0; i < 22; i++) {

241 
p
 +
	`°rc•n
(p, " ");

242 
p
 +
	`°r•n
(p, " ");

244 
i
 = 
	`©oi
(
p
);

245 
	`¥ötf
("VútuÆ sizê%i, ", 
i
);

246 
p
 +
	`°rc•n
(p, " ");

247 
p
 +
	`°r•n
(p, " ");

248 
i
 = 
	`©oi
(
p
);

249 
	`¥ötf
("RSS = %i\n", 
i
 * 
	`gë∑gesize
());

250 
	}
}

252 
	#LOOPS
 1000

	)

254 
	$maö
(
¨gc
, *
¨gv
[])

256 
time•ec
 
°¨t
, 
Æloc_time
, 
‰ì_time
;

257 
node
 *
roŸ
;

258 
i
;

259 
FILE
 *
f
;

260 
boﬁ
 
run_èŒoc
 = 
åue
, 
run_èl
 =Årue, 
run_mÆloc
 =Årue;

262 
f
 = 
¨gv
[1] ? 
	`f›í
◊rgv[1], "r"Ë: 
°dö
;

263 
roŸ
 = 
	`ªad_nodes
(
f
);

264 
	`f˛o£
(
f
);

265 
	`¥ötf
("Ród %uÇodes\n", 
node_cou¡
);

267 i‡(
¨gc
 > 2) {

268 i‡(
	`°ªq
(
¨gv
[2], "--talloc-size")) {

269 
	`do_èŒocs
(
roŸ
);

270 
	`dump_vsize
();

271 
	`exô
(0);

273 i‡(
	`°ªq
(
¨gv
[2], "--tal-size")) {

274 
	`do_èls
(
roŸ
);

275 
	`dump_vsize
();

276 
	`exô
(0);

278 i‡(
	`°rcmp
(
¨gv
[2], "--talloc") == 0)

279 
run_èl
 = 
run_mÆloc
 = 
Ál£
;

280 i‡(
	`°rcmp
(
¨gv
[2], "--tal") == 0)

281 
run_èŒoc
 = 
run_mÆloc
 = 
Ál£
;

282 i‡(
	`°rcmp
(
¨gv
[2], "--malloc") == 0)

283 
run_èŒoc
 = 
run_èl
 = 
Ál£
;

285 
	`îrx
(1, "Bad fœg %s", 
¨gv
[2]);

288 i‡(!
run_mÆloc
)

289 
a·î_mÆloc
;

291 
Æloc_time
.
tv_£c
 =áŒoc_time.
tv_n£c
 = 0;

292 
‰ì_time
.
tv_£c
 = fªe_time.
tv_n£c
 = 0;

293 
i
 = 0; i < 
LOOPS
; i++) {

294 
°¨t
 = 
	`time_now
();

295 
	`do_mÆlocs
(
roŸ
);

296 
Æloc_time
 = 
	`time_add
◊Œoc_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

298 
°¨t
 = 
	`time_now
();

299 
	`‰ì_mÆlocs
(
roŸ
);

300 
‰ì_time
 = 
	`time_add
(‰ì_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

302 
Æloc_time
 = 
	`time_divide
◊Œoc_time, 
i
);

303 
‰ì_time
 = 
	`time_divide
(‰ì_time, 
i
);

304 
	`¥ötf
("MÆlo¯time: %Œuns\n", 
	`time_to_n£c
(
Æloc_time
));

305 
	`¥ötf
("Fªêtime: %Œuns\n", 
	`time_to_n£c
(
‰ì_time
));

307 
a·î_mÆloc
:

308 i‡(!
run_èŒoc
)

309 
a·î_èŒoc
;

311 
Æloc_time
.
tv_£c
 =áŒoc_time.
tv_n£c
 = 0;

312 
‰ì_time
.
tv_£c
 = fªe_time.
tv_n£c
 = 0;

313 
i
 = 0; i < 
LOOPS
; i++) {

314 
°¨t
 = 
	`time_now
();

315 
	`do_èŒocs
(
roŸ
);

316 
Æloc_time
 = 
	`time_add
◊Œoc_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

318 
°¨t
 = 
	`time_now
();

319 
	`‰ì_èŒocs
(
roŸ
);

320 
‰ì_time
 = 
	`time_add
(‰ì_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

322 
Æloc_time
 = 
	`time_divide
◊Œoc_time, 
i
);

323 
‰ì_time
 = 
	`time_divide
(‰ì_time, 
i
);

324 
	`¥ötf
("TÆlo¯time: %Œuns\n", 
	`time_to_n£c
(
Æloc_time
));

325 
	`¥ötf
("èŒoc_‰ìÅime: %Œuns\n", 
	`time_to_n£c
(
‰ì_time
));

327 
‰ì_time
.
tv_£c
 = fªe_time.
tv_n£c
 = 0;

328 
i
 = 0; i < 
LOOPS
; i++) {

329 
	`do_èŒocs
(
roŸ
);

331 
°¨t
 = 
	`time_now
();

332 
	`èŒoc_‰ì
(
roŸ
->
n
);

333 
‰ì_time
 = 
	`time_add
(‰ì_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

335 
‰ì_time
 = 
	`time_divide
(‰ì_time, 
i
);

336 
	`¥ötf
("SögÀÅÆloc_‰ìÅime: %Œuns\n", 
	`time_to_n£c
(
‰ì_time
));

338 
a·î_èŒoc
:

339 i‡(!
run_èl
)

340 
a·î_èl
;

342 
Æloc_time
.
tv_£c
 =áŒoc_time.
tv_n£c
 = 0;

343 
‰ì_time
.
tv_£c
 = fªe_time.
tv_n£c
 = 0;

344 
i
 = 0; i < 
LOOPS
; i++) {

345 
°¨t
 = 
	`time_now
();

346 
	`do_èls
(
roŸ
);

347 
Æloc_time
 = 
	`time_add
◊Œoc_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

349 
°¨t
 = 
	`time_now
();

350 
	`‰ì_èls
(
roŸ
);

351 
‰ì_time
 = 
	`time_add
(‰ì_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

353 
Æloc_time
 = 
	`time_divide
◊Œoc_time, 
i
);

354 
‰ì_time
 = 
	`time_divide
(‰ì_time, 
i
);

355 
	`¥ötf
("TÆÅime: %Œuns\n", 
	`time_to_n£c
(
Æloc_time
));

356 
	`¥ötf
("TÆ_‰ìÅime: %Œuns\n", 
	`time_to_n£c
(
‰ì_time
));

358 
‰ì_time
.
tv_£c
 = fªe_time.
tv_n£c
 = 0;

359 
i
 = 0; i < 
LOOPS
; i++) {

360 
	`do_èls
(
roŸ
);

362 
°¨t
 = 
	`time_now
();

363 
	`èl_‰ì
(
roŸ
->
n
);

364 
‰ì_time
 = 
	`time_add
(‰ì_time, 
	`time_sub
(
	`time_now
(), 
°¨t
));

366 
‰ì_time
 = 
	`time_divide
(‰ì_time, 
i
);

367 
	`¥ötf
("SögÀÅÆ_‰ìÅime: %Œuns\n", 
	`time_to_n£c
(
‰ì_time
));

368 
a·î_èl
:

371 
	}
}

	@ccan/ccan/tal/benchmark/speed.c

25 
	~<cˇn/èŒoc/èŒoc.h
>

26 
	~<cˇn/èl/èl.h
>

27 
	~<cˇn/èl/°r/°r.h
>

28 
	~<cˇn/time/time.h
>

29 
	~<cˇn/îr/îr.h
>

30 
	~<°rög.h
>

32 
	#LOOPS
 1024

	)

34 
	$maö
(
¨gc
, *
¨gv
[])

36 *
˘x
;

37 
cou¡
;

38 
i
, 
j
;

39 
time•ec
 
tv
;

40 *
p1
, *
p2
[100], *
p3
[100];

41 
boﬁ
 
run_èŒoc
 = 
åue
, 
run_èl
 =Årue, 
run_mÆloc
 =Årue;

43 i‡(
¨gv
[1]) {

44 i‡(
	`°rcmp
(
¨gv
[1], "--talloc") == 0)

45 
run_èl
 = 
run_mÆloc
 = 
Ál£
;

46 i‡(
	`°rcmp
(
¨gv
[1], "--tal") == 0)

47 
run_èŒoc
 = 
run_mÆloc
 = 
Ál£
;

48 i‡(
	`°rcmp
(
¨gv
[1], "--malloc") == 0)

49 
run_èŒoc
 = 
run_èl
 = 
Ál£
;

51 
	`îrx
(1, "Bad fœg %s", 
¨gv
[1]);

54 i‡(!
run_èŒoc
)

55 
a·î_èŒoc
;

57 
˘x
 = 
	`èŒoc_√w
(
NULL
);

58 
tv
 = 
	`time_now
();

59 
cou¡
 = 0;

61 
i
=0;i<
LOOPS
;i++) {

62 
p1
 = 
	`èŒoc_size
(
˘x
, 
LOOPS
 % 128);

63 
j
 = 0; j < 100; j++) {

64 
p2
[
j
] = 
	`èŒoc_°rdup
(
p1
, "foo bar");

65 
p3
[
j
] = 
	`èŒoc_size
(
p1
, 300);

67 
	`èŒoc_‰ì
(
p1
);

69 
cou¡
 +(1 + 200Ë* 
LOOPS
;

70 } 
	`time_sub
(
	`time_now
(), 
tv
).
tv_£c
 < 5);

72 
	`Ârötf
(
°dîr
, "èŒoc: %.0‡›s/£c\n", 
cou¡
/5.0);

74 
	`èŒoc_‰ì
(
˘x
);

76 
a·î_èŒoc
:

77 i‡(!
run_èl
)

78 
a·î_èl
;

80 
˘x
 = 
	`èl
(
NULL
, );

81 
tv
 = 
	`time_now
();

82 
cou¡
 = 0;

84 
i
=0;i<
LOOPS
;i++) {

85 
p1
 = 
	`èl_¨r
(
˘x
, , 
LOOPS
 % 128);

86 
j
 = 0; j < 100; j++) {

87 
p2
[
j
] = 
	`èl_°rdup
(
p1
, "foo bar");

88 
p3
[
j
] = 
	`èl_¨r
(
p1
, , 300);

90 
	`èl_‰ì
(
p1
);

92 
cou¡
 +(1 + 200Ë* 
LOOPS
;

93 } 
	`time_sub
(
	`time_now
(), 
tv
).
tv_£c
 < 5);

94 
	`Ârötf
(
°dîr
, "èl: %.0‡›s/£c\n", 
cou¡
/5.0);

96 
	`èl_‰ì
(
˘x
);

98 
a·î_èl
:

99 i‡(!
run_mÆloc
)

100 
a·î_mÆloc
;

102 
tv
 = 
	`time_now
();

103 
cou¡
 = 0;

105 
i
=0;i<
LOOPS
;i++) {

106 
p1
 = 
	`mÆloc
(
LOOPS
 % 128);

107 
j
 = 0; j < 100; j++) {

108 
p2
[
j
] = 
	`°rdup
("foo bar");

109 
p3
[
j
] = 
	`mÆloc
(300);

111 
j
 = 0; j < 100; j++) {

112 
	`‰ì
(
p2
[
j
]);

113 
	`‰ì
(
p3
[
j
]);

115 
	`‰ì
(
p1
);

117 
cou¡
 +(1 + 200Ë* 
LOOPS
;

118 } 
	`time_sub
(
	`time_now
(), 
tv
).
tv_£c
 < 5);

119 
	`Ârötf
(
°dîr
, "mÆloc: %.0‡›s/£c\n", 
cou¡
/5.0);

121 
a·î_mÆloc
:

122 
	`¥ötf
("success: speed\n");

125 
	}
}

	@ccan/ccan/tal/link/link.c

2 
	~<cˇn/èl/lök/lök.h
>

3 
	~<cˇn/c⁄èöî_of/c⁄èöî_of.h
>

4 
	~<cˇn/li°/li°.h
>

5 
	~<as£π.h
>

8 
	slökabÀ
 {

9 
li°_hód
 
	mlöks
;

12 
	slök
 {

13 
li°_node
 
	mli°
;

16 
	$lökabÀ_nŸifõr
(
èl_t
 *
lökabÀ
,

17 
èl_nŸify_ty≥
 
ty≥
,

18 *
öfo
)

20 
lökabÀ
 *
l
 = 
	`èl_∑ª¡
(linkable);

21 
	`as£π
(
ty≥
 =
TAL_NOTIFY_STEAL
 ||Åy≥ =
TAL_NOTIFY_FREE
);

24 i‡(
ty≥
 =
TAL_NOTIFY_FREE
 && 
	`li°_em±y
(&
l
->
löks
)) {

25 
	`èl_‰ì
(
l
);

30 
	`ab‹t
();

31 
	}
}

33 *
	$èl_lökabÀ_
(
èl_t
 *
√wobj
)

35 
lökabÀ
 *
l
;

38 
	`as£π
(!
	`èl_∑ª¡
(
√wobj
));

40 
l
 = 
	`èl
(
NULL
, 
lökabÀ
);

41 i‡(!
l
)

42 
Áû
;

43 
	`li°_hód_öô
(&
l
->
löks
);

45 i‡(!
	`èl_°ól
(
l
, 
√wobj
))

46 
Áû
;

48 i‡(!
	`èl_add_nŸifõr
(
√wobj
, 
TAL_NOTIFY_STEAL
|
TAL_NOTIFY_FREE
,

49 
lökabÀ_nŸifõr
)) {

50 
	`èl_°ól
(
NULL
, 
√wobj
);

51 
Áû
;

54  (*)
√wobj
;

56 
Áû
:

57 
	`èl_‰ì
(
l
);

58  
NULL
;

59 
	}
}

61 
	$de°roy_lök
(
lök
 *
 k
)

63 
lökabÀ
 *
l
;

66 
l
 = 
	`c⁄èöî_of
(
 k
->
li°
.
¥ev
, 
lökabÀ
, 
löks
.
n
);

68 
	`li°_dñ
(&
 k
->
li°
);

70 i‡(
	`li°_em±y
(&
l
->
löks
))

71 
	`èl_‰ì
(
l
);

72 
	}
}

74 *
	$èl_lök_
(c⁄° 
èl_t
 *
˘x
, c⁄°ÅÆ_à*
lök
)

76 
lökabÀ
 *
l
 = 
	`èl_∑ª¡
(
lök
);

77 
lök
 *
 k
 = 
	`èl
(
˘x
, link);

79 i‡(!
 k
)

80  
NULL
;

81 i‡(!
	`èl_add_de°ru˘‹
(
 k
, 
de°roy_lök
)) {

82 
	`èl_‰ì
(
 k
);

83  
NULL
;

85 
	`li°_add
(&
l
->
löks
, &
 k
->
li°
);

86  (*)
lök
;

87 
	}
}

89 
	$èl_dñök_
(c⁄° 
èl_t
 *
˘x
, c⁄°ÅÆ_à*
lök
)

91 
lökabÀ
 *
l
 = 
	`èl_∑ª¡
(
lök
);

92 
lök
 *
i
;

94 i‡(!
lök
)

98 
	`li°_f‹_óch
(&
l
->
löks
, 
i
, 
li°
) {

99 i‡(
	`èl_∑ª¡
(
i
Ë=
˘x
) {

100 
	`èl_‰ì
(
i
);

104 
	`ab‹t
();

105 
	}
}

	@ccan/ccan/tal/link/link.h

2 #i‚de‡
TAL_LINK_H


3 
	#TAL_LINK_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/èl/èl.h
>

22 
	#èl_lökabÀ
(
√wobj
) \

23 (
	`èl_ty≥of
(
√wobj
Ë
	`èl_lökabÀ_
(“ewobj)))

	)

40 #i‡
HAVE_STATEMENT_EXPR


42 
	#èl_lök
(
˘x
, 
obj
) \

43 ({ 
	`èl_ty≥of
(
obj
Ë
	`èl_lök_
((
˘x
), (obj)); })

	)

45 
	#èl_lök
(
˘x
, 
obj
) \

46 (
	`èl_ty≥of
(
obj
Ë
	`èl_lök_
((
˘x
), (obj)))

	)

61 
	#èl_dñök
(
˘x
, 
obj
) \

62 
	`èl_dñök_
((
˘x
), (
obj
))

	)

65 *
èl_lökabÀ_
(
èl_t
 *
√wobj
);

66 *
èl_lök_
(c⁄° 
èl_t
 *
˘x
, c⁄°ÅÆ_à*
de°
);

67 
èl_dñök_
(c⁄° 
èl_t
 *
˘x
, c⁄°ÅÆ_à*
de°
);

	@ccan/ccan/tal/link/test/run.c

1 
	~<cˇn/èl/lök/lök.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<°dlib.h
>

4 
	~<îr.h
>

6 
	gde°roy_cou¡
 = 0;

7 
	$de°roy_obj
(*
obj
)

9 
de°roy_cou¡
++;

10 
	}
}

12 
	$maö
(
¨gc
, *
¨gv
[])

14 *
lökabÀ
, *
p1
, *
p2
, *
p3
;

15 **
voidµ
;

17 
	`∂™_ã°s
(23);

19 
lökabÀ
 = 
	`èl
(
NULL
, );

20 
	`ok1
(
	`èl_lökabÀ
(
lökabÀ
) ==Üinkable);

21 
	`ok1
(
	`èl_add_de°ru˘‹
(
lökabÀ
, 
de°roy_obj
));

23 
	`èl_‰ì
(
lökabÀ
);

24 
	`ok1
(
de°roy_cou¡
 == 1);

27 
lökabÀ
 = 
	`èl_lökabÀ
(
	`èl
(
NULL
, ));

28 
	`ok1
(
	`èl_add_de°ru˘‹
(
lökabÀ
, 
de°roy_obj
));

29 
	`ok1
(
p1
 = 
	`èl_lök
(
NULL
, 
lökabÀ
));

30 
	`ok1
(
p1
 =
lökabÀ
);

31 
	`èl_dñök
(
NULL
, 
lökabÀ
);

32 
	`ok1
(
de°roy_cou¡
 == 2);

35 
lökabÀ
 = 
	`èl_lökabÀ
(
	`èl
(
NULL
, ));

36 
	`ok1
(
	`èl_add_de°ru˘‹
(
lökabÀ
, 
de°roy_obj
));

37 
	`ok1
(
p1
 = 
	`èl_lök
(
NULL
, 
lökabÀ
));

38 
	`ok1
(
p1
 =
lökabÀ
);

39 
	`ok1
(
p2
 = 
	`èl_lök
(
NULL
, 
lökabÀ
));

40 
	`ok1
(
p2
 =
lökabÀ
);

41 
	`èl_dñök
(
NULL
, 
lökabÀ
);

42 
	`èl_dñök
(
NULL
, 
lökabÀ
);

43 
	`ok1
(
de°roy_cou¡
 == 3);

46 
lökabÀ
 = 
	`èl_lökabÀ
(
	`èl
(
NULL
, ));

47 
	`ok1
(
	`èl_add_de°ru˘‹
(
lökabÀ
, 
de°roy_obj
));

48 
	`ok1
(
p1
 = 
	`èl_lök
(
NULL
, 
lökabÀ
));

49 
	`ok1
(
p1
 =
lökabÀ
);

50 
	`ok1
(
p2
 = 
	`èl_lök
(
NULL
, 
lökabÀ
));

51 
	`ok1
(
p2
 =
lökabÀ
);

52 
	`ok1
(
p3
 = 
	`èl_lök
(
NULL
, 
lökabÀ
));

53 
	`ok1
(
p3
 =
lökabÀ
);

54 
	`èl_dñök
(
NULL
, 
lökabÀ
);

55 
	`èl_dñök
(
NULL
, 
lökabÀ
);

56 
	`èl_dñök
(
NULL
, 
lökabÀ
);

57 
	`ok1
(
de°roy_cou¡
 == 4);

60 
voidµ
 = 
	`èl
(
NULL
, *);

61 
lökabÀ
 = 
	`èl_lökabÀ
(
	`èl
(
NULL
, ));

62 
	`ok1
(
	`èl_add_de°ru˘‹
(
lökabÀ
, 
de°roy_obj
));

64 #i‡
HAVE_STATEMENT_EXPR


65 
	`èl_lök
(
voidµ
, 
lökabÀ
);

67 ()
	`èl_lök
(
voidµ
, 
lökabÀ
);

69 
	`èl_‰ì
(
voidµ
);

70 
	`ok1
(
de°roy_cou¡
 == 5);

72  
	`exô_°©us
();

73 
	}
}

	@ccan/ccan/tal/path/path.c

2 
	~<cˇn/èl/∑th/∑th.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èke/èke.h
>

5 
	~<cˇn/èl/°r/°r.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<uni°d.h
>

10 
	~<limôs.h
>

11 
	~<°dlib.h
>

12 
	~<î∫o.h
>

13 
	~<as£π.h
>

15 
	#PATH_SEP_STR
 "/"

	)

16 
	#PATH_SEP
 (
PATH_SEP_STR
[0])

	)

18 *
	$∑th_cwd
(c⁄° 
èl_t
 *
˘x
)

20 
size_t
 
Àn
 = 64;

21 *
cwd
;

24 
cwd
 = 
	`èl_¨r
(
˘x
, , 
Àn
);

25 
cwd
 && !
	`gëcwd
(cwd, 
Àn
)) {

26 i‡(
î∫o
 !
ERANGE
 || !
	`èl_ªsize
(&
cwd
, 
Àn
 *= 2))

27 
cwd
 = 
	`èl_‰ì
(cwd);

29  
cwd
;

30 
	}
}

32 *
	$∑th_joö
(c⁄° 
èl_t
 *
˘x
, c⁄° *
ba£
, c⁄° *
a
)

34 *
ªt
 = 
NULL
;

35 
size_t
 
Àn
;

37 i‡(
	`u∆ikñy
(!
a
Ë&& 
	`èkí
(a)) {

38 i‡(
	`èkí
(
ba£
))

39 
	`èl_‰ì
(
ba£
);

40  
NULL
;

43 i‡(
a
[0] =
PATH_SEP
) {

44 i‡(
	`èkí
(
ba£
))

45 
	`èl_‰ì
(
ba£
);

46  
	`èl_°rdup
(
˘x
, 
a
);

49 i‡(
	`u∆ikñy
(!
ba£
Ë&& 
	`èkí
(base))

50 
out
;

52 
Àn
 = 
	`°æí
(
ba£
);

53 
ªt
 = 
	`èl_dup
(
˘x
, , 
ba£
, 
Àn
, 1 + 
	`°æí
(
a
) + 1);

54 i‡(!
ªt
)

55 
out
;

56 i‡(
ªt
[
Àn
-1] !
PATH_SEP
)

57 
ªt
[
Àn
++] = 
PATH_SEP
;

58 
	`°r˝y
(
ªt
 + 
Àn
, 
a
);

60 
out
:

61 i‡(
	`èkí
(
a
))

62 
	`èl_‰ì
(
a
);

63  
ªt
;

64 
	}
}

66 #i‡
HAVE_FCHDIR


67 
	s∑th_pushd
 {

68 
	mfd
;

71 
	$pushd_de°roy
(
∑th_pushd
 *
pushd
)

73 
	`˛o£
(
pushd
->
fd
);

74 
	}
}

76 
∑th_pushd
 *
	$∑th_pushd
(c⁄° 
èl_t
 *
˘x
, c⁄° *
dú
)

78 
∑th_pushd
 *
ﬁd
 = 
	`èl
(
˘x
, path_pushd);

80 i‡(!
ﬁd
)

81  
NULL
;

83 i‡(
	`u∆ikñy
(!
dú
Ë&& 
	`èkí
(dir))

84  
	`èl_‰ì
(
ﬁd
);

86 i‡(!
	`èl_add_de°ru˘‹
(
ﬁd
, 
pushd_de°roy
))

87 
ﬁd
 = 
	`èl_‰ì
(old);

89 
ﬁd
->
fd
 = 
	`›í
(".", 
O_RDONLY
);

90 i‡(
ﬁd
->
fd
 < 0)

91 
ﬁd
 = 
	`èl_‰ì
(old);

92 i‡(
	`chdú
(
dú
) != 0)

93 
ﬁd
 = 
	`èl_‰ì
(old);

96 i‡(
	`èkí
(
dú
))

97 
	`èl_‰ì
(
dú
);

98  
ﬁd
;

99 
	}
}

101 
boﬁ
 
	$∑th_p›d
(
∑th_pushd
 *
ﬁddú
)

103 
boﬁ
 
ok
 = (
	`fchdú
(
ﬁddú
->
fd
) == 0);

105 
	`èl_‰ì
(
ﬁddú
);

106  
ok
;

107 
	}
}

109 
	s∑th_pushd
 {

110 c⁄° *
	mﬁddú
;

113 
∑th_pushd
 *
	$∑th_pushd
(c⁄° 
èl_t
 *
˘x
, c⁄° *
dú
)

115 
∑th_pushd
 *
ﬁd
 = 
	`èl
(
˘x
, path_pushd);

117 i‡(!
ﬁd
)

118  
NULL
;

120 
ﬁd
->
ﬁddú
 = 
	`∑th_cwd
(old);

121 i‡(
	`u∆ikñy
(!
ﬁd
->
ﬁddú
))

122 
ﬁd
 = 
	`èl_‰ì
(old);

123 i‡(
	`u∆ikñy
(!
dú
Ë&& 
	`is_èkí
(dir))

124 
ﬁd
 = 
	`èl_‰ì
(old);

125 i‡(
	`chdú
(
dú
) != 0)

126 
ﬁd
 = 
	`èl_‰ì
(old);

128 i‡(
	`èkí
(
dú
))

129 
	`èl_‰ì
(
dú
);

131  
ﬁd
;

132 
	}
}

134 
boﬁ
 
	$∑th_p›d
(
∑th_pushd
 *
ﬁddú
)

136 
boﬁ
 
ok
 = (
	`chdú
(
ﬁddú
->olddir) == 0);

138 
	`èl_‰ì
(
ﬁddú
);

139  
ok
;

140 
	}
}

143 *
	$∑th_ˇn⁄
(c⁄° 
èl_t
 *
˘x
, c⁄° *
a
)

146 *
ﬁdcwd
, *
∑th
, *
p
;

147 *
tmp˘x
;

148 
size_t
 
Àn
;

149 
∑th_pushd
 *
ﬁddú
;

152 
Àn
 = 
	`°æí
(
a
) + 1;

153 i‡(
a
[0] !
PATH_SEP
) {

154 
tmp˘x
 = 
ﬁdcwd
 = 
	`∑th_cwd
(
˘x
);

155 i‡(!
ﬁdcwd
)

156  
NULL
;

157 
Àn
 +
	`°æí
(
ﬁdcwd
Ë+ såÀn(
PATH_SEP_STR
);

159 
∑th
 = 
	`èl_¨øy
(
tmp˘x
, , 
Àn
);

160 i‡(!
∑th
)

161 
out
;

163 
Àn
 = 
	`°æí
(
ﬁdcwd
);

164 
	`mem˝y
(
∑th
, 
ﬁdcwd
, 
Àn
);

165 
∑th
[
Àn
++] = 
PATH_SEP
;

167 
tmp˘x
 = 
∑th
 = 
	`èl_¨øy
(
˘x
, , 
Àn
);

168 i‡(!
∑th
)

169  
NULL
;

170 
Àn
 = 0;

172 
	`°r˝y
(
∑th
 + 
Àn
, 
a
);

174 
p
 = 
	`°ºchr
(
∑th
, 
PATH_SEP
);

175 *
p
 = '\0';

177 
ﬁddú
 = 
	`∑th_pushd
(
tmp˘x
, 
∑th
);

178 i‡(!
ﬁddú
)

179 
out
;

182 
∑th
 = 
	`∑th_cwd
(
tmp˘x
);

183 i‡(!
∑th
)

184 
out
;

187 
Àn
 = 
	`°æí
(
p
+1);

188 i‡(
Àn
) {

189 
size_t
 
ﬁdÀn
 = 
	`èl_¨øy_Àngth
(
∑th
);

190 i‡(
∑th
[
ﬁdÀn
-1] !
PATH_SEP
) {

192 *
p
 = 
PATH_SEP
;

193 
p
--;

194 
Àn
++;

196 
∑th
 = 
	`èl_ªÆloc
(
NULL
,Ö©h, , 
ﬁdÀn
+
Àn
+1);

197 i‡(!
∑th
)

198 
out
;

199 
	`mem˝y
(
∑th
 + 
ﬁdÀn
, 
p
, 
Àn
+1);

202 
∑th
 = 
	`èl_°ól
(
˘x
,Öath);

203 
out
:

205 i‡(!
	`∑th_p›d
(
ﬁddú
))

206 
∑th
 = 
	`èl_‰ì
(path);

208 
	`èl_‰ì
(
tmp˘x
);

209  
∑th
;

211 *
∑th
;

212 i‡(
	`u∆ikñy
(!
a
Ë&& 
	`is_èkí
(a))

213 
∑th
 = 
NULL
;

215 
∑th
 = 
	`èl_¨r
(
˘x
, , 
PATH_MAX
);

216 i‡(
∑th
 && !
	`ªÆ∑th
(
a
,Öath))

217 
∑th
 = 
	`èl_‰ì
(path);

219 i‡(
	`èkí
(
a
))

220 
	`èl_‰ì
(
a
);

221  
∑th
;

223 
	}
}

226 *
	$∑th_ªl
(c⁄° 
èl_t
 *
˘x
, c⁄° *
‰om
, c⁄° *
to
)

228 *
c‰om
, *
˘o
, *
ªt
, *
p
;

229 
èl_t
 *
tmp˘x
;

230 
size_t
 
comm⁄
, 
num_back
, 
i
, 
po°Àn
;

233 
tmp˘x
 = 
c‰om
 = 
	`∑th_ˇn⁄
(
˘x
, 
‰om
);

234 i‡(!
c‰om
)

235 
Áû_èke_to
;

238 i‡(!
	`°ªq
(
c‰om
, 
PATH_SEP_STR
)) {

239 i‡(!
	`èl_ªsize
(&
c‰om
, 
	`°æí
(cfrom)+2))

240 
Áû_èke_to
;

241 
tmp˘x
 = 
c‰om
;

242 
	`°rˇt
(
c‰om
, 
PATH_SEP_STR
);

246 
˘o
 = 
	`∑th_ˇn⁄
(
tmp˘x
, 
to
);

247 i‡(!
˘o
) {

248 
ªt
 = 
NULL
;

249 
out
;

253 
comm⁄
 = 
i
 = 0; 
c‰om
[i] && 
˘o
[i]; i++) {

254 i‡(
c‰om
[
i
] !
˘o
[i])

256 i‡(
c‰om
[
i
] =
PATH_SEP
)

257 
comm⁄
 = 
i
 + 1;

261 i‡(!
c‰om
[
i
] && 
˘o
[i] =
PATH_SEP
) {

262 
˘o
++;

263 
comm⁄
 = 
i
;

264 } i‡(!
˘o
[
i
] && 
c‰om
[i] =
PATH_SEP
) {

265 
c‰om
++;

266 
comm⁄
 = 
i
;

270 
c‰om
 +
comm⁄
;

271 
˘o
 +
comm⁄
;

275 
num_back
 = 
	`°rcou¡
(
c‰om
, 
PATH_SEP_STR
);

276 
po°Àn
 = 
	`°æí
(
˘o
) + 1;

279 i‡(
num_back
 =0 && 
po°Àn
 == 1) {

280 
ªt
 = 
	`èl_°rdup
(
˘x
, ".");

281 
out
;

284 
ªt
 = 
	`èl_¨r
(
˘x
, ,

285 
	`°æí
(".." 
PATH_SEP_STR
Ë* 
num_back
 + 
po°Àn
);

286 i‡(!
ªt
)

287 
out
;

289 
i
 = 0, 
p
 = 
ªt
; i < 
num_back
; i++,Ö +
	`°æí
(".." 
PATH_SEP_STR
))

290 
	`mem˝y
(
p
, ".." 
PATH_SEP_STR
, 
	`°æí
(".." PATH_SEP_STR));

292 i‡(
po°Àn
 == 1)

293 
p
--;

294 
	`mem˝y
(
p
, 
˘o
, 
po°Àn
);

296 
out
:

297 
	`èl_‰ì
(
tmp˘x
);

298  
ªt
;

300 
Áû_èke_to
:

301 i‡(
	`èkí
(
to
))

302 
	`èl_‰ì
(
to
);

303 
ªt
 = 
NULL
;

304 
out
;

305 
	}
}

307 *
	$∑th_ªadlök
(c⁄° 
èl_t
 *
˘x
, c⁄° *
lök«me
)

309 
ssize_t
 
Àn
, 
maxÀn
 = 64;

310 *
ªt
 = 
NULL
;

312 i‡(
	`u∆ikñy
(!
lök«me
Ë&& 
	`is_èkí
(linkname))

313 
Áû
;

315 
ªt
 = 
	`èl_¨r
(
˘x
, , 
maxÀn
 + 1);

317 
ªt
) {

318 
Àn
 = 
	`ªadlök
(
lök«me
, 
ªt
, 
maxÀn
);

319 i‡(
Àn
 < 0)

320 
Áû
;

321 i‡(
Àn
 < 
maxÀn
)

324 i‡(!
	`èl_ªsize
(&
ªt
, 
maxÀn
 *= 2 + 1))

325 
Áû
;

328 i‡(
ªt
)

329 
ªt
[
Àn
] = '\0';

331 
out
:

332 i‡(
	`èkí
(
lök«me
))

333 
	`èl_‰ì
(
lök«me
);

335  
ªt
;

337 
Áû
:

338 
ªt
 = 
	`èl_‰ì
(ret);

339 
out
;

340 
	}
}

342 *
	$∑th_sim∂ify
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
)

344 
size_t
 
i
, 
j
, 
°¨t
, 
Àn
;

345 *
ªt
;

346 
boﬁ
 
íded
 = 
Ál£
;

348 
ªt
 = 
	`èl_°rdup
(
˘x
, 
∑th
);

349 i‡(!
ªt
)

350  
NULL
;

353 i‡(
ªt
[0] =
PATH_SEP
)

354 
°¨t
 = 1;

356 
°¨t
 = 0;

358 
i
 = 
j
 = 
°¨t
; !
íded
; i +
Àn
) {

360 
Àn
 = 0; 
ªt
[
i
+Àn] !
PATH_SEP
;Üen++) {

361 i‡(!
ªt
[
i
+
Àn
]) {

362 
íded
 = 
åue
;

366 
Àn
++;

369 i‡(
Àn
 == 1)

373 i‡(
Àn
 =2 && 
ªt
[
i
] == '.')

377 i‡(
Àn
 =3 && 
ªt
[
i
] == '.' &&Ñet[i+1] == '.') {

378 
°©
 
°
;

380 i‡(
j
 > 
°¨t
) {

382 
	`as£π
(
ªt
[
j
-1] =
PATH_SEP
);

383 
ªt
[
j
-1] = '\0';

386 i‡(
	`°ªq
(
ªt
, "..")

387 || 
	`°ªnds
(
ªt
, 
PATH_SEP_STR
"..")) {

388 
ªt
[
j
-1] = 
PATH_SEP
;

389 
c›y
;

392 i‡(
	`l°©
(
ªt
, &
°
) == 0

393 && !
	`S_ISLNK
(
°
.
°_mode
)) {

394 *
£p
 = 
	`°ºchr
(
ªt
, 
PATH_SEP
);

395 i‡(
£p
)

396 
j
 = 
£p
 - 
ªt
 + 1;

398 
j
 = 0;

401 } i‡(
°¨t
) {

403 
j
 = 1;

405 
ªt
[1] = '\0';

410 
c›y
:

411 
	`memmove
(
ªt
 + 
j
,Ñë + 
i
, 
Àn
);

413 
j
 +
Àn
 - 
íded
;

417 i‡(
j
 == 0) {

418 
ªt
[0] = '.';

419 
ªt
[1] = '\0';

420 } i‡(
j
 > 1 && 
ªt
[j-1] =
PATH_SEP
) {

421 
ªt
[
j
-1] = '\0';

423 
ªt
[
j
] = '\0';

425  
ªt
;

426 
	}
}

428 *
	$∑th_ba£«me
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
)

430 c⁄° *
£p
;

431 *
ªt
;

433 i‡(
	`u∆ikñy
(!
∑th
Ë&& 
	`èkí
(path))

434  
NULL
;

436 
£p
 = 
	`°ºchr
(
∑th
, 
PATH_SEP
);

437 i‡(!
£p
)

438  
	`èl_°rdup
(
˘x
, 
∑th
);

441 i‡(!
£p
[1]) {

442 c⁄° *
íd
;

444 
íd
 = 
£p
;Énd !
∑th
;Énd--)

445 i‡(*
íd
 !
PATH_SEP
)

449 
£p
 = 
íd
; sï >
∑th
 && *£∞!
PATH_SEP
; sep--);

452 i‡(
íd
 =
£p
)

453 
ªt
 = 
	`èl_°rdup
(
˘x
, 
PATH_SEP_STR
);

455 
ªt
 = 
	`èl_°∫dup
(
˘x
, 
£p
+1, 
íd
 - sep);

457 
ªt
 = 
	`èl_°rdup
(
˘x
, 
£p
 + 1);

459 i‡(
	`èkí
(
∑th
))

460 
	`èl_‰ì
(
∑th
);

461  
ªt
;

462 
	}
}

465 *
	$fixed_°rög
(c⁄° 
èl_t
 *
˘x
,

466 c⁄° *
°r
, c⁄° *
∑th
)

468 *
ªt
 = 
	`èl_dup
(
˘x
, , 
∑th
, 0, 
	`°æí
(
°r
)+1);

469 i‡(
ªt
)

470 
	`°r˝y
(
ªt
, 
°r
);

471  
ªt
;

472 
	}
}

474 *
	$∑th_dú«me
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
)

476 c⁄° *
£p
;

478 i‡(
	`u∆ikñy
(!
∑th
Ë&& 
	`èkí
(path))

479  
NULL
;

481 
£p
 = 
	`°ºchr
(
∑th
, 
PATH_SEP
);

482 i‡(!
£p
)

483  
	`fixed_°rög
(
˘x
, ".", 
∑th
);

486 i‡(!
£p
[1]) {

487 c⁄° *
íd
;

489 
íd
 = 
£p
;Énd !
∑th
;Énd--)

490 i‡(*
íd
 !
PATH_SEP
)

494 
£p
 = 
íd
; sï > 
∑th
 && *£∞!
PATH_SEP
; sep--);

498 
£p
 > 
∑th
 && sï[-1] =
PATH_SEP
)

499 
£p
--;

501 i‡(
£p
 =
∑th
) {

502 i‡(
	`∑th_is_abs
(
∑th
))

503  
	`èl_°∫dup
(
˘x
, 
∑th
, 1);

505  
	`fixed_°rög
(
˘x
, ".", 
∑th
);

507  
	`èl_°∫dup
(
˘x
, 
∑th
, 
£p
 -Öath);

508 
	}
}

510 
boﬁ
 
	$∑th_is_abs
(c⁄° *
∑th
)

512  
∑th
[0] =
PATH_SEP
;

513 
	}
}

515 
boﬁ
 
	$∑th_is_fûe
(c⁄° *
∑th
)

517 
°©
 
°
;

519  
	`°©
(
∑th
, &
°
Ë=0 && 
	`S_ISREG
(°.
°_mode
);

520 
	}
}

522 
boﬁ
 
	$∑th_is_dú
(c⁄° *
∑th
)

524 
°©
 
°
;

526  
	`°©
(
∑th
, &
°
Ë=0 && 
	`S_ISDIR
(°.
°_mode
);

527 
	}
}

529 **
	$∑th_•lô
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
)

531 
boﬁ
 
em±y
 = 
∑th
 && !path[0];

532 **
ªt
 = 
	`èl_°r•lô
(
˘x
, 
∑th
, 
PATH_SEP_STR
, 
STR_NO_EMPTY
);

535 i‡(
ªt
 && !
em±y
 && !ret[0]) {

536 i‡(!
	`èl_ªsize
(&
ªt
, 2))

537 
ªt
 = 
	`èl_‰ì
(ret);

539 
ªt
[1] = 
NULL
;

540 
ªt
[0] = 
	`èl_°rdup
‘ë, 
PATH_SEP_STR
);

541 i‡(!
ªt
[0])

542 
ªt
 = 
	`èl_‰ì
(ret);

546  
ªt
;

547 
	}
}

549 
size_t
 
	$∑th_ext_off
(c⁄° *
∑th
)

551 c⁄° *
dŸ
, *
ba£
;

553 
dŸ
 = 
	`°ºchr
(
∑th
, '.');

554 i‡(
dŸ
) {

555 
ba£
 = 
	`°ºchr
(
∑th
, 
PATH_SEP
);

556 i‡(!
ba£
)

557 
ba£
 = 
∑th
;

559 
ba£
++;

560 i‡(
dŸ
 > 
ba£
)

561  
dŸ
 - 
∑th
;

563  
	`°æí
(
∑th
);

564 
	}
}

	@ccan/ccan/tal/path/path.h

2 #i‚de‡
CCAN_PATH_H


3 
	#CCAN_PATH_H


	)

4 
	~<cˇn/èl/èl.h
>

5 
	~<°dboﬁ.h
>

13 *
∑th_cwd
(c⁄° 
èl_t
 *
˘x
);

23 *
∑th_ªadlök
(c⁄° 
èl_t
 *
˘x
, c⁄° *
lök
);

34 *
∑th_ˇn⁄
(c⁄° 
èl_t
 *
˘x
, c⁄° *
a
);

45 *
∑th_sim∂ify
(c⁄° 
èl_t
 *
˘x
, c⁄° *
a
);

56 *
∑th_joö
(c⁄° 
èl_t
 *
˘x
, c⁄° *
ba£
, c⁄° *
a
);

63 
∑th_pushd
 *∑th_pushd(c⁄° 
èl_t
 *
˘x
, c⁄° *
dú
);

71 
boﬁ
 
∑th_p›d
(
∑th_pushd
 *
ﬁddú
);

86 *
∑th_ªl
(c⁄° 
èl_t
 *
˘x
, c⁄° *
‰omdú
, c⁄° *
to
);

105 *
∑th_ba£«me
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
);

117 *
∑th_dú«me
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
);

123 
boﬁ
 
∑th_is_abs
(c⁄° *
∑th
);

129 
boﬁ
 
∑th_is_fûe
(c⁄° *
∑th
);

135 
boﬁ
 
∑th_is_dú
(c⁄° *
∑th
);

152 **
∑th_•lô
(c⁄° 
èl_t
 *
˘x
, c⁄° *
∑th
);

165 
size_t
 
∑th_ext_off
(c⁄° *
∑th
);

	@ccan/ccan/tal/path/test/run-basename.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(26);

11 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "/usr/lib");

12 
	`ok1
(
	`°ªq
(
∑th
, "lib"));

13 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

14 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "/usr/");

15 
	`ok1
(
	`°ªq
(
∑th
, "usr"));

16 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

17 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "/usr//");

18 
	`ok1
(
	`°ªq
(
∑th
, "usr"));

19 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

20 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "usr");

21 
	`ok1
(
	`°ªq
(
∑th
, "usr"));

22 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

23 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "/");

24 
	`ok1
(
	`°ªq
(
∑th
, "/"));

25 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

26 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "//");

27 
	`ok1
(
	`°ªq
(
∑th
, "/"));

28 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

29 
∑th
 = 
	`∑th_ba£«me
(
˘x
, ".");

30 
	`ok1
(
	`°ªq
(
∑th
, "."));

31 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

32 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "./");

33 
	`ok1
(
	`°ªq
(
∑th
, "."));

34 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

35 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "..");

36 
	`ok1
(
	`°ªq
(
∑th
, ".."));

37 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

38 
∑th
 = 
	`∑th_ba£«me
(
˘x
, "../");

39 
	`ok1
(
	`°ªq
(
∑th
, ".."));

40 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

41 
	`èl_‰ì
(
˘x
);

43 
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

44 
	`ok1
(!
	`èl_fú°
(
˘x
));

47 
∑th
 = 
	`∑th_ba£«me
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "..")));

48 
	`ok1
(
	`°ªq
(
∑th
, ".."));

49 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

50 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && !
	`èl_√xt
(ctx,Öath));

51 
	`èl_‰ì
(
∑th
);

52 
	`ok1
(
	`∑th_ba£«me
(
˘x
, 
	`èke
(
NULL
)) == NULL);

53 
	`ok1
(!
	`èl_fú°
(
˘x
));

55 
	`èl_‰ì
(
˘x
);

57  
	`exô_°©us
();

58 
	}
}

	@ccan/ccan/tal/path/test/run-canon.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
cwd
[1024], *
∑th
, *
∑th2
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(15);

11 i‡(!
	`gëcwd
(
cwd
, (cwd)))

12 
	`ab‹t
();

14 
	`u∆ök
("run-canon-link");

15 
	`rmdú
("run-canon-foo");

16 i‡(
	`mkdú
("run-canon-foo", 0700) != 0)

17 
	`ab‹t
();

18 i‡(
	`symlök
("run-canon-foo", "run-canon-link") != 0)

19 
	`ab‹t
();

21 
∑th
 = 
	`∑th_ˇn⁄
(
˘x
, "run-canon-foo");

22 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

23 
	`ok1
(
	`°ªnds
(
∑th
, "run-canon-foo"));

24 
	`ok1
(
	`°r°¨ts
(
∑th
, 
cwd
));

25 
	`ok1
(
∑th
[
	`°æí
(
cwd
)] =
PATH_SEP
);

26 
	`ok1
(
	`°æí
(
∑th
Ë=°æí(
cwd
) + 1 + strlen("run-canon-foo"));

27 
	`èl_‰ì
(
∑th
);

29 
	`ok1
(!
	`∑th_ˇn⁄
(
˘x
, 
	`èke
(
NULL
)));

30 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

33 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

34 
∑th
 = 
	`∑th_ˇn⁄
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "run-canon-foo")));

35 
	`ok1
(
	`°ªnds
(
∑th
, "run-canon-foo"));

36 
	`ok1
(
	`°r°¨ts
(
∑th
, 
cwd
));

37 
	`ok1
(
∑th
[
	`°æí
(
cwd
)] =
PATH_SEP
);

38 
	`ok1
(
	`°æí
(
∑th
Ë=°æí(
cwd
) + 1 + strlen("run-canon-foo"));

39 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

40 
∑th2
 = 
	`∑th_ˇn⁄
(
˘x
, "run-canon-link");

41 
	`ok1
(
	`°ªq
(
∑th2
, 
∑th
));

43 
	`u∆ök
("run-canon-link");

44 i‡(
	`symlök
(".", "run-canon-link") != 0)

45 
	`ab‹t
();

47 
∑th
 = 
	`∑th_ˇn⁄
(
˘x
, "run-canon-link");

48 
	`ok1
(
	`°ªq
(
∑th
, 
cwd
));

50 
	`èl_‰ì
(
˘x
);

52  
	`exô_°©us
();

53 
	}
}

	@ccan/ccan/tal/path/test/run-cwd.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
∑th1
[1024], *
cwd
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

10 
	`∂™_ã°s
(5);

12 i‡(!
	`gëcwd
(
∑th1
, (path1)))

13 
	`ab‹t
();

15 
cwd
 = 
	`∑th_cwd
(
˘x
);

16 
	`ok1
(
cwd
);

17 
	`ok1
(
	`èl_∑ª¡
(
cwd
Ë=
˘x
);

18 
	`èl_‰ì
(
cwd
);

20 
	`rmdú
("run-cwd-long-long-long-name/bar-long-long-long-long-name");

21 
	`rmdú
("run-cwd-long-long-long-name");

22 i‡(
	`mkdú
("run-cwd-long-long-long-name", 0700) != 0)

23 
	`ab‹t
();

24 i‡(
	`mkdú
("run-cwd-long-long-long-name/bar-long-long-long-long-name", 0700) != 0)

25 
	`ab‹t
();

26 i‡(
	`chdú
("run-cwd-long-long-long-name/bar-long-long-long-long-name") != 0)

27 
	`ab‹t
();

29 
cwd
 = 
	`∑th_cwd
(
˘x
);

30 
	`ok1
(
cwd
);

31 
	`ok1
(
	`èl_∑ª¡
(
cwd
Ë=
˘x
);

32 
	`ok1
(
	`°ªnds
(
cwd
,

34 
	`èl_‰ì
(
˘x
);

36  
	`exô_°©us
();

37 
	}
}

	@ccan/ccan/tal/path/test/run-dirname.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(26);

11 
∑th
 = 
	`∑th_dú«me
(
˘x
, "/usr/lib");

12 
	`ok1
(
	`°ªq
(
∑th
, "/usr"));

13 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

14 
∑th
 = 
	`∑th_dú«me
(
˘x
, "/usr/");

15 
	`ok1
(
	`°ªq
(
∑th
, "/"));

16 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

17 
∑th
 = 
	`∑th_dú«me
(
˘x
, "/usr//");

18 
	`ok1
(
	`°ªq
(
∑th
, "/"));

19 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

20 
∑th
 = 
	`∑th_dú«me
(
˘x
, "usr");

21 
	`ok1
(
	`°ªq
(
∑th
, "."));

22 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

23 
∑th
 = 
	`∑th_dú«me
(
˘x
, "/");

24 
	`ok1
(
	`°ªq
(
∑th
, "/"));

25 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

26 
∑th
 = 
	`∑th_dú«me
(
˘x
, "//");

27 
	`ok1
(
	`°ªq
(
∑th
, "/"));

28 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

29 
∑th
 = 
	`∑th_dú«me
(
˘x
, ".");

30 
	`ok1
(
	`°ªq
(
∑th
, "."));

31 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

32 
∑th
 = 
	`∑th_dú«me
(
˘x
, "./");

33 
	`ok1
(
	`°ªq
(
∑th
, "."));

34 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

35 
∑th
 = 
	`∑th_dú«me
(
˘x
, "..");

36 
	`ok1
(
	`°ªq
(
∑th
, "."));

37 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

38 
∑th
 = 
	`∑th_dú«me
(
˘x
, "../");

39 
	`ok1
(
	`°ªq
(
∑th
, "."));

40 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

41 
	`èl_‰ì
(
˘x
);

43 
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

44 
	`ok1
(!
	`èl_fú°
(
˘x
));

47 
∑th
 = 
	`∑th_dú«me
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "..")));

48 
	`ok1
(
	`°ªq
(
∑th
, "."));

49 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

50 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && !
	`èl_√xt
(ctx,Öath));

51 
	`èl_‰ì
(
∑th
);

52 
	`ok1
(
	`∑th_dú«me
(
˘x
, 
	`èke
(
NULL
)) == NULL);

53 
	`ok1
(!
	`èl_fú°
(
˘x
));

55 
	`èl_‰ì
(
˘x
);

57  
	`exô_°©us
();

58 
	}
}

	@ccan/ccan/tal/path/test/run-ext_off.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
	`∂™_ã°s
(9);

9 
	`ok1
(
	`∑th_ext_off
("foo") == 3);

10 
	`ok1
(
	`∑th_ext_off
(".foo") == 4);

11 
	`ok1
(
	`∑th_ext_off
("bar.foo") == 3);

12 
	`ok1
(
	`∑th_ext_off
("bar/foo") == 7);

13 
	`ok1
(
	`∑th_ext_off
("bar/.foo") == 8);

14 
	`ok1
(
	`∑th_ext_off
(".bar/foo") == 8);

15 
	`ok1
(
	`∑th_ext_off
("foo.bar/foo") == 11);

16 
	`ok1
(
	`∑th_ext_off
("foo.bar/foo.") == 11);

17 
	`ok1
(
	`∑th_ext_off
("foo.bar/foo..") == 12);

18  
	`exô_°©us
();

19 
	}
}

	@ccan/ccan/tal/path/test/run-is_abs.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
	`∂™_ã°s
(5);

9 
	`ok1
(
	`∑th_is_abs
(
PATH_SEP_STR
 "foo"));

10 
	`ok1
(!
	`∑th_is_abs
("foo"));

11 
	`ok1
(!
	`∑th_is_abs
("foo" 
PATH_SEP_STR
));

13 
	`ok1
(
	`∑th_is_abs
(
PATH_SEP_STR
 "foo" PATH_SEP_STR));

14 
	`ok1
(
	`∑th_is_abs
(
PATH_SEP_STR
 "."));

15  
	`exô_°©us
();

16 
	}
}

	@ccan/ccan/tal/path/test/run-is_dir.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

8 
	$maö
()

10 
cwd
[1024], *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

12 
	`∂™_ã°s
(6);

14 i‡(!
	`gëcwd
(
cwd
, (cwd)))

15 
	`ab‹t
();

17 
	`u∆ök
("run-is_dir-dir-link");

18 
	`u∆ök
("run-is_dir-file-link");

19 
	`u∆ök
("run-is_dir-dir/file");

20 
	`rmdú
("run-is_dir-dir");

21 i‡(
	`mkdú
("run-is_dir-dir", 0700) != 0)

22 
	`ab‹t
();

23 i‡(
	`symlök
("run-is_dir-dir", "run-is_dir-dir-link") != 0)

24 
	`ab‹t
();

25 i‡(
	`symlök
("run-is_dir-dir/file", "run-is_dir-file-link") != 0)

26 
	`ab‹t
();

27 
	`˛o£
(
	`›í
("run-is_dú-dú/fûe", 
O_WRONLY
|
O_CREAT
, 0600));

29 
	`ok1
(
	`∑th_is_dú
("run-is_dir-dir-link"));

30 
	`ok1
(!
	`∑th_is_dú
("run-is_dir-file-link"));

31 
	`ok1
(!
	`∑th_is_dú
("run-is_dir-dir/file"));

32 
	`ok1
(
	`∑th_is_dú
("run-is_dir-dir"));

34 
∑th
 = 
	`∑th_joö
(
˘x
, 
cwd
, "run-is_dir-dir/file");

35 
	`ok1
(!
	`∑th_is_dú
(
∑th
));

36 
	`ok1
(
	`∑th_is_dú
(
cwd
));

38 
	`èl_‰ì
(
˘x
);

40  
	`exô_°©us
();

41 
	}
}

	@ccan/ccan/tal/path/test/run-is_file.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

8 
	$maö
()

10 
cwd
[1024], *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

12 
	`∂™_ã°s
(7);

14 i‡(!
	`gëcwd
(
cwd
, (cwd)))

15 
	`ab‹t
();

17 
	`u∆ök
("run-is_file-dir-link");

18 
	`u∆ök
("run-is_file-file-link");

19 
	`u∆ök
("run-is_file-dir/file");

20 
	`rmdú
("run-is_file-dir");

21 i‡(
	`mkdú
("run-is_file-dir", 0700) != 0)

22 
	`ab‹t
();

23 i‡(
	`symlök
("run-is_file-dir", "run-is_file-dir-link") != 0)

24 
	`ab‹t
();

25 i‡(
	`symlök
("run-is_file-dir/file", "run-is_file-file-link") != 0)

26 
	`ab‹t
();

27 
	`˛o£
(
	`›í
("run-is_fûe-dú/fûe", 
O_WRONLY
|
O_CREAT
, 0600));

29 
	`ok1
(!
	`∑th_is_fûe
("run-is_file-dir-link"));

30 
	`ok1
(
	`∑th_is_fûe
("run-is_file-file-link"));

31 
	`ok1
(
	`∑th_is_fûe
("run-is_file-dir/file"));

32 
	`ok1
(!
	`∑th_is_fûe
("run-is_file-dir"));

33 
	`ok1
(!
	`∑th_is_fûe
("run-is_file-nonexist"));

35 
∑th
 = 
	`∑th_joö
(
˘x
, 
cwd
, "run-is_file-dir/file");

36 
	`ok1
(
	`∑th_is_fûe
(
∑th
));

37 
	`ok1
(!
	`∑th_is_fûe
(
cwd
));

39 
	`èl_‰ì
(
˘x
);

41  
	`exô_°©us
();

42 
	}
}

	@ccan/ccan/tal/path/test/run-join.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(34);

11 
∑th
 = 
	`∑th_joö
(
˘x
, "foo", "bar");

12 
	`ok1
(
	`°ªq
(
∑th
, "foo/bar"));

13 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

14 
	`èl_‰ì
(
∑th
);

16 
∑th
 = 
	`∑th_joö
(
˘x
, "foo/", "bar");

17 
	`ok1
(
	`°ªq
(
∑th
, "foo/bar"));

18 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

19 
	`èl_‰ì
(
∑th
);

21 
∑th
 = 
	`∑th_joö
(
˘x
, "foo/", "/bar");

22 
	`ok1
(
	`°ªq
(
∑th
, "/bar"));

23 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

24 
	`èl_‰ì
(
∑th
);

26 
∑th
 = 
	`∑th_joö
(
˘x
, "foo", "/bar");

27 
	`ok1
(
	`°ªq
(
∑th
, "/bar"));

28 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

29 
	`èl_‰ì
(
∑th
);

32 
∑th
 = 
	`∑th_joö
(
˘x
, "foo", 
	`èke
(
	`èl_°rdup
(ctx, "bar")));

33 
	`ok1
(
	`°ªq
(
∑th
, "foo/bar"));

34 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

35 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

36 
	`èl_‰ì
(
∑th
);

38 
∑th
 = 
	`∑th_joö
(
˘x
, "foo", 
	`èke
(
	`èl_°rdup
(ctx, "/bar")));

39 
	`ok1
(
	`°ªq
(
∑th
, "/bar"));

40 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

41 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

42 
	`èl_‰ì
(
∑th
);

44 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "foo")), "bar");

45 
	`ok1
(
	`°ªq
(
∑th
, "foo/bar"));

46 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

47 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

48 
	`èl_‰ì
(
∑th
);

50 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "foo")), "/bar");

51 
	`ok1
(
	`°ªq
(
∑th
, "/bar"));

52 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

53 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

54 
	`èl_‰ì
(
∑th
);

56 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "foo")),

57 
	`èke
(
	`èl_°rdup
(
˘x
, "bar")));

58 
	`ok1
(
	`°ªq
(
∑th
, "foo/bar"));

59 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

60 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

61 
	`èl_‰ì
(
∑th
);

63 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "foo")),

64 
	`èke
(
	`èl_°rdup
(
˘x
, "/bar")));

65 
	`ok1
(
	`°ªq
(
∑th
, "/bar"));

66 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

67 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
∑th
 && 
	`èl_√xt
(˘x,Ö©hË=
NULL
);

68 
	`èl_‰ì
(
∑th
);

70 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
NULL
), "bar");

71 
	`ok1
(!
∑th
);

72 
	`ok1
(!
	`èl_fú°
(
˘x
));

75 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
NULL
), "/bar");

76 
	`ok1
(!
∑th
 || 
	`°ªq
(path, "/bar"));

77 
	`èl_‰ì
(
∑th
);

78 
	`ok1
(!
	`èl_fú°
(
˘x
));

80 
∑th
 = 
	`∑th_joö
(
˘x
, "foo", 
	`èke
(
NULL
));

81 
	`ok1
(!
∑th
);

82 
	`ok1
(!
	`èl_fú°
(
˘x
));

84 
∑th
 = 
	`∑th_joö
(
˘x
, 
	`èke
(
NULL
),Åake(NULL));

85 
	`ok1
(!
∑th
);

86 
	`ok1
(!
	`èl_fú°
(
˘x
));

88 
	`èl_‰ì
(
˘x
);

90  
	`exô_°©us
();

91 
	}
}

	@ccan/ccan/tal/path/test/run-pushd.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
∑th_pushd
 *
pd
;

8 
∑th1
[1024], 
∑th2
[1024], *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

11 
	`∂™_ã°s
(19);

14 i‡(!
	`gëcwd
(
∑th1
, (path1)))

15 
	`ab‹t
();

17 
pd
 = 
	`∑th_pushd
(
NULL
, "non-existent-dir");

18 
	`ok1
(
î∫o
 =
ENOENT
);

19 
	`ok1
(!
pd
);

21 
î∫o
 = -100;

22 
pd
 = 
	`∑th_pushd
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "non-existent-dir")));

23 
	`ok1
(
î∫o
 =
ENOENT
);

24 
	`ok1
(!
pd
);

25 
	`ok1
(!
	`èl_fú°
(
˘x
));

27 
î∫o
 = -100;

28 
pd
 = 
	`∑th_pushd
(
˘x
, 
	`èke
(
NULL
));

29 
	`ok1
(!
pd
);

30 
	`ok1
(!
	`èl_fú°
(
˘x
));

31 
	`ok1
(
î∫o
 == -100);

33 
pd
 = 
	`∑th_pushd
(
˘x
, "/tmp");

34 
	`ok1
(
pd
);

35 
	`ok1
(
	`èl_∑ª¡
(
pd
Ë=
˘x
);

37 i‡(!
	`gëcwd
(
∑th2
, (path2)))

38 
	`ab‹t
();

40 
	`ok1
(
	`°ªq
(
∑th2
, "/tmp"));

41 
	`∑th_p›d
(
pd
);

43 i‡(!
	`gëcwd
(
∑th2
, (path2)))

44 
	`ab‹t
();

45 
	`ok1
(
	`°ªq
(
∑th2
, 
∑th1
));

47 
pd
 = 
	`∑th_pushd
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "/tmp")));

48 
	`ok1
(
pd
);

49 
	`ok1
(
	`èl_∑ª¡
(
pd
Ë=
˘x
);

50 
	`∑th_p›d
(
pd
);

51 i‡(!
	`gëcwd
(
∑th2
, (path2)))

52 
	`ab‹t
();

53 
	`ok1
(
	`°ªq
(
∑th2
, 
∑th1
));

54 
	`ok1
(!
	`èl_fú°
(
˘x
));

57 i‡(
	`mkdú
("run-pushd-dir", 0700) != 0)

58 
	`ab‹t
();

59 i‡(
	`chdú
("run-pushd-dir") != 0)

60 
	`ab‹t
();

61 i‡(
	`rmdú
("../run-pushd-dir") != 0)

62 
	`ab‹t
();

64 
pd
 = 
	`∑th_pushd
(
˘x
, 
∑th1
);

65 #i‡
HAVE_FCHDIR


66 
	`ok1
(
pd
);

67 
	`ok1
(
	`∑th_p›d
(
pd
));

69 
	`ok1
(
î∫o
 =
ENOENT
);

70 
	`ok1
(!
pd
);

72 
	`ok1
(!
	`èl_fú°
(
˘x
));

73 
	`èl_‰ì
(
˘x
);

74  
	`exô_°©us
();

75 
	}
}

	@ccan/ccan/tal/path/test/run-readlink.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
lök
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(12);

11 
	`u∆ök
("run-readlink-link");

13 
lök
 = 
	`∑th_ªadlök
(
˘x
, "run-readlink-link");

14 
	`ok1
(
î∫o
 =
ENOENT
);

15 
	`ok1
(!
lök
);

17 
lök
 = 
	`∑th_ªadlök
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "run-readlink-link")));

18 
	`ok1
(
î∫o
 =
ENOENT
);

19 
	`ok1
(!
lök
);

20 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

22 i‡(
	`symlök
("/tmp", "run-readlink-link") != 0)

23 
	`ab‹t
();

25 
lök
 = 
	`∑th_ªadlök
(
˘x
, "run-readlink-link");

26 
	`ok1
(
	`èl_∑ª¡
(
lök
Ë=
˘x
);

27 
	`ok1
(
	`°ªq
(
lök
, "/tmp"));

28 
	`èl_‰ì
(
lök
);

30 
lök
 = 
	`∑th_ªadlök
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "run-readlink-link")));

31 
	`ok1
(
	`èl_∑ª¡
(
lök
Ë=
˘x
);

32 
	`ok1
(
	`°ªq
(
lök
, "/tmp"));

33 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
lök
 && 
	`èl_√xt
(˘x,ÜökË=
NULL
);

35 
	`u∆ök
("run-readlink-link");

37 i‡(
	`symlök
("some-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-long-name", "run-readlink-link") != 0)

38 
	`ab‹t
();

40 
lök
 = 
	`∑th_ªadlök
(
˘x
, "run-readlink-link");

41 
	`ok1
(
	`èl_∑ª¡
(
lök
Ë=
˘x
);

42 
	`ok1
(
	`°ªq
(
lök
, "some-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-really-long-name"));

43 
	`èl_‰ì
(
˘x
);

45  
	`exô_°©us
();

46 
	}
}

	@ccan/ccan/tal/path/test/run-rel.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
cwd
[1024], *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(19);

11 i‡(!
	`gëcwd
(
cwd
, (cwd)))

12 
	`ab‹t
();

14 
	`u∆ök
("run-rel-link");

15 
	`rmdú
("run-rel-foo");

16 i‡(
	`mkdú
("run-rel-foo", 0700) != 0)

17 
	`ab‹t
();

18 i‡(
	`symlök
("run-rel-foo", "run-rel-link") != 0)

19 
	`ab‹t
();

21 
∑th
 = 
	`∑th_ªl
(
˘x
, ".", "run-rel-foo");

22 
	`ok1
(
	`°ªq
(
∑th
, "run-rel-foo"));

23 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

24 
	`èl_‰ì
(
∑th
);

26 
∑th
 = 
	`∑th_ªl
(
˘x
, "run-rel-foo", ".");

27 
	`ok1
(
	`°ªq
(
∑th
, ".."));

28 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

29 
	`èl_‰ì
(
∑th
);

31 
∑th
 = 
	`∑th_ªl
(
˘x
, ".", "run-rel-link");

33 
	`ok1
(
	`°ªq
(
∑th
, "run-rel-link") || streq(path, "run-rel-foo"));

34 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

35 
	`èl_‰ì
(
∑th
);

37 
∑th
 = 
	`∑th_ªl
(
˘x
, "/", ".");

38 
	`ok1
(
	`°ªq
(
∑th
, 
cwd
 + 1));

39 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

40 
	`èl_‰ì
(
∑th
);

42 
∑th
 = 
	`∑th_ªl
(
˘x
, "run-rel-foo", "run-rel-foo");

43 
	`ok1
(
	`°ªq
(
∑th
, "."));

44 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

45 
	`èl_‰ì
(
∑th
);

47 
∑th
 = 
	`∑th_ªl
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, ".")), "run-rel-foo");

48 
	`ok1
(
	`°ªq
(
∑th
, "run-rel-foo"));

49 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

50 
	`èl_‰ì
(
∑th
);

51 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

53 
∑th
 = 
	`∑th_ªl
(
˘x
, ".", 
	`èke
(
	`èl_°rdup
(ctx, "run-rel-foo")));

54 
	`ok1
(
	`°ªq
(
∑th
, "run-rel-foo"));

55 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

56 
	`èl_‰ì
(
∑th
);

57 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

59 
∑th
 = 
	`∑th_ªl
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, ".")),

60 
	`èke
(
	`èl_°rdup
(
˘x
, "run-rel-foo")));

61 
	`ok1
(
	`°ªq
(
∑th
, "run-rel-foo"));

62 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

63 
	`èl_‰ì
(
∑th
);

64 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

66 
	`èl_‰ì
(
˘x
);

68  
	`exô_°©us
();

69 
	}
}

	@ccan/ccan/tal/path/test/run-simplify.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
cwd
[1024], *
∑th
, *
˘x
 = 
	`èl_°rdup
(
NULL
, "ctx");

9 
	`∂™_ã°s
(87);

11 i‡(!
	`gëcwd
(
cwd
, (cwd)))

12 
	`ab‹t
();

14 
	`rmdú
("run-simplify-foo");

15 
	`u∆ök
("run-simplify-link");

16 i‡(
	`mkdú
("run-simplify-foo", 0700) != 0)

17 
	`ab‹t
();

18 i‡(
	`symlök
("run-simplify-foo", "run-simplify-link") != 0)

19 
	`ab‹t
();

22 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, ".");

23 
	`ok1
(
	`°ªq
(
∑th
, "."));

24 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

25 
	`èl_‰ì
(
∑th
);

27 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./");

28 
	`ok1
(
	`°ªq
(
∑th
, "."));

29 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

30 
	`èl_‰ì
(
∑th
);

32 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "..");

33 
	`ok1
(
	`°ªq
(
∑th
, ".."));

34 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

35 
	`èl_‰ì
(
∑th
);

37 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "../");

38 
	`ok1
(
	`°ªq
(
∑th
, ".."));

39 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

40 
	`èl_‰ì
(
∑th
);

42 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./..");

43 
	`ok1
(
	`°ªq
(
∑th
, ".."));

44 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

45 
	`èl_‰ì
(
∑th
);

47 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./../");

48 
	`ok1
(
	`°ªq
(
∑th
, ".."));

49 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

50 
	`èl_‰ì
(
∑th
);

52 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./../.");

53 
	`ok1
(
	`°ªq
(
∑th
, ".."));

54 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

55 
	`èl_‰ì
(
∑th
);

57 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./.././");

58 
	`ok1
(
	`°ªq
(
∑th
, ".."));

59 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

60 
	`èl_‰ì
(
∑th
);

62 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./../..");

63 
	`ok1
(
	`°ªq
(
∑th
, "../.."));

64 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

65 
	`èl_‰ì
(
∑th
);

67 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./../../");

68 
	`ok1
(
	`°ªq
(
∑th
, "../.."));

69 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

70 
	`èl_‰ì
(
∑th
);

73 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/");

74 
	`ok1
(
	`°ªq
(
∑th
, "/"));

75 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

76 
	`èl_‰ì
(
∑th
);

78 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "//");

79 
	`ok1
(
	`°ªq
(
∑th
, "/"));

80 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

81 
	`èl_‰ì
(
∑th
);

83 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/.");

84 
	`ok1
(
	`°ªq
(
∑th
, "/"));

85 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

86 
	`èl_‰ì
(
∑th
);

88 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./");

89 
	`ok1
(
	`°ªq
(
∑th
, "/"));

90 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

91 
	`èl_‰ì
(
∑th
);

93 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/..");

94 
	`ok1
(
	`°ªq
(
∑th
, "/"));

95 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

96 
	`èl_‰ì
(
∑th
);

98 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/../");

99 
	`ok1
(
	`°ªq
(
∑th
, "/"));

100 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

101 
	`èl_‰ì
(
∑th
);

103 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./..");

104 
	`ok1
(
	`°ªq
(
∑th
, "/"));

105 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

106 
	`èl_‰ì
(
∑th
);

108 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./../");

109 
	`ok1
(
	`°ªq
(
∑th
, "/"));

110 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

111 
	`èl_‰ì
(
∑th
);

113 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./../.");

114 
	`ok1
(
	`°ªq
(
∑th
, "/"));

115 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

116 
	`èl_‰ì
(
∑th
);

118 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./.././");

119 
	`ok1
(
	`°ªq
(
∑th
, "/"));

120 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

121 
	`èl_‰ì
(
∑th
);

123 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./../..");

124 
	`ok1
(
	`°ªq
(
∑th
, "/"));

125 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

126 
	`èl_‰ì
(
∑th
);

128 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./../../");

129 
	`ok1
(
	`°ªq
(
∑th
, "/"));

130 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

131 
	`èl_‰ì
(
∑th
);

134 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "run-simplify-foo");

135 
	`ok1
(
	`°ªq
(
∑th
, "run-simplify-foo"));

136 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

137 
	`èl_‰ì
(
∑th
);

139 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./run-simplify-foo");

140 
	`ok1
(
	`°ªq
(
∑th
, "run-simplify-foo"));

141 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

142 
	`èl_‰ì
(
∑th
);

144 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./run-simplify-foo/.");

145 
	`ok1
(
	`°ªq
(
∑th
, "run-simplify-foo"));

146 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

147 
	`èl_‰ì
(
∑th
);

149 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "run-simplify-link");

150 
	`ok1
(
	`°ªq
(
∑th
, "run-simplify-link"));

151 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

152 
	`èl_‰ì
(
∑th
);

154 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./run-simplify-link");

155 
	`ok1
(
	`°ªq
(
∑th
, "run-simplify-link"));

156 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

157 
	`èl_‰ì
(
∑th
);

159 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "./run-simplify-link/.");

160 
	`ok1
(
	`°ªq
(
∑th
, "run-simplify-link"));

161 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

162 
	`èl_‰ì
(
∑th
);

164 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "run-simplify-foo/..");

165 
	`ok1
(
	`°ªq
(
∑th
, "."));

166 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

167 
	`èl_‰ì
(
∑th
);

169 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "run-simplify-foo//..");

170 
	`ok1
(
	`°ªq
(
∑th
, "."));

171 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

172 
	`èl_‰ì
(
∑th
);

174 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "run-simplify-foo//../");

175 
	`ok1
(
	`°ªq
(
∑th
, "."));

176 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

177 
	`èl_‰ì
(
∑th
);

180 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp");

181 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

182 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

183 
	`èl_‰ì
(
∑th
);

185 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/");

186 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

187 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

188 
	`èl_‰ì
(
∑th
);

190 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/.");

191 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

192 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

193 
	`èl_‰ì
(
∑th
);

195 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/./tmp/.");

196 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

197 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

198 
	`èl_‰ì
(
∑th
);

200 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/../tmp/.");

201 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

202 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

203 
	`èl_‰ì
(
∑th
);

205 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/..");

206 
	`ok1
(
	`°ªq
(
∑th
, "/"));

207 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

208 
	`èl_‰ì
(
∑th
);

210 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/../");

211 
	`ok1
(
	`°ªq
(
∑th
, "/"));

212 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

213 
	`èl_‰ì
(
∑th
);

215 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/../tmp");

216 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

217 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

218 
	`èl_‰ì
(
∑th
);

220 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/../tmp/");

221 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

222 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

223 
	`èl_‰ì
(
∑th
);

225 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, "/tmp/../tmp/.");

226 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

227 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

228 
	`èl_‰ì
(
∑th
);

231 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "/tmp/../tmp/.")));

232 
	`ok1
(
	`°ªq
(
∑th
, "/tmp"));

233 
	`ok1
(
	`èl_∑ª¡
(
∑th
Ë=
˘x
);

234 
	`èl_‰ì
(
∑th
);

235 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

237 
∑th
 = 
	`∑th_sim∂ify
(
˘x
, 
	`èke
(
NULL
));

238 
	`ok1
(!
∑th
);

239 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

241 
	`èl_‰ì
(
˘x
);

243  
	`exô_°©us
();

244 
	}
}

	@ccan/ccan/tal/path/test/run-split.c

1 
	~<cˇn/èl/∑th/∑th.h
>

2 
	~<cˇn/èl/∑th/∑th.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
˘x
 = 
	`èl_°rdup
(
NULL
, "˘x"), **
•lô
;

9 
	`∂™_ã°s
(46);

11 
•lô
 = 
	`∑th_•lô
(
˘x
, "foo" 
PATH_SEP_STR
 "bar");

12 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

13 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

14 
	`ok1
(
	`°ªq
(
•lô
[1], "bar"));

15 
	`ok1
(
•lô
[2] =
NULL
);

16 
	`èl_‰ì
(
•lô
);

18 
•lô
 = 
	`∑th_•lô
(
˘x
, "foo" 
PATH_SEP_STR
 "bar" PATH_SEP_STR);

19 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

20 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

21 
	`ok1
(
	`°ªq
(
•lô
[1], "bar"));

22 
	`ok1
(
•lô
[2] =
NULL
);

23 
	`èl_‰ì
(
•lô
);

25 
•lô
 = 
	`∑th_•lô
(
˘x
, 
PATH_SEP_STR
 "foo"

26 
PATH_SEP_STR
 "bar" PATH_SEP_STR);

27 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

28 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

29 
	`ok1
(
	`°ªq
(
•lô
[1], "bar"));

30 
	`ok1
(
•lô
[2] =
NULL
);

31 
	`èl_‰ì
(
•lô
);

33 
•lô
 = 
	`∑th_•lô
(
˘x
, 
PATH_SEP_STR
 PATH_SEP_STR "foo"

34 
PATH_SEP_STR
 PATH_SEP_STR "bar"

35 
PATH_SEP_STR
 PATH_SEP_STR);

36 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

37 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

38 
	`ok1
(
	`°ªq
(
•lô
[1], "bar"));

39 
	`ok1
(
•lô
[2] =
NULL
);

40 
	`èl_‰ì
(
•lô
);

42 
•lô
 = 
	`∑th_•lô
(
˘x
, "foo");

43 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

44 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

45 
	`ok1
(
•lô
[1] =
NULL
);

46 
	`èl_‰ì
(
•lô
);

48 
•lô
 = 
	`∑th_•lô
(
˘x
, 
PATH_SEP_STR
 "foo");

49 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

50 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

51 
	`ok1
(
•lô
[1] =
NULL
);

52 
	`èl_‰ì
(
•lô
);

54 
•lô
 = 
	`∑th_•lô
(
˘x
, 
PATH_SEP_STR
 PATH_SEP_STR "foo");

55 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

56 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

57 
	`ok1
(
•lô
[1] =
NULL
);

58 
	`èl_‰ì
(
•lô
);

60 
•lô
 = 
	`∑th_•lô
(
˘x
, "foo" 
PATH_SEP_STR
);

61 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

62 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

63 
	`ok1
(
•lô
[1] =
NULL
);

64 
	`èl_‰ì
(
•lô
);

66 
•lô
 = 
	`∑th_•lô
(
˘x
, "foo" 
PATH_SEP_STR
 PATH_SEP_STR);

67 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

68 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

69 
	`ok1
(
•lô
[1] =
NULL
);

70 
	`èl_‰ì
(
•lô
);

72 
•lô
 = 
	`∑th_•lô
(
˘x
, 
PATH_SEP_STR
 "foo" PATH_SEP_STR);

73 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

74 
	`ok1
(
	`°ªq
(
•lô
[0], "foo"));

75 
	`ok1
(
•lô
[1] =
NULL
);

76 
	`èl_‰ì
(
•lô
);

78 
•lô
 = 
	`∑th_•lô
(
˘x
, "");

79 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

80 
	`ok1
(
•lô
[0] =
NULL
);

81 
	`èl_‰ì
(
•lô
);

83 
•lô
 = 
	`∑th_•lô
(
˘x
, 
PATH_SEP_STR
);

84 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

85 
	`ok1
(
	`°ªq
(
•lô
[0], 
PATH_SEP_STR
));

86 
	`ok1
(
•lô
[1] =
NULL
);

87 
	`èl_‰ì
(
•lô
);

90 
•lô
 = 
	`∑th_•lô
(
˘x
, 
	`èke
(
	`èl_°rdup
(˘x, 
PATH_SEP_STR
)));

91 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

92 
	`ok1
(
	`°ªq
(
•lô
[0], 
PATH_SEP_STR
));

93 
	`ok1
(
•lô
[1] =
NULL
);

94 
	`èl_‰ì
(
•lô
);

95 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

97 
•lô
 = 
	`∑th_•lô
(
˘x
, 
	`èke
(
NULL
));

98 
	`ok1
(!
•lô
);

99 
	`ok1
(
	`èl_fú°
(
˘x
Ë=
NULL
);

101 
	`ok1
(
	`èl_fú°
(
NULL
Ë=
˘x
 && 
	`èl_√xt
(NULL, ctx) == NULL);

102 
	`èl_‰ì
(
˘x
);

104  
	`exô_°©us
();

105 
	}
}

	@ccan/ccan/tal/str/str.c

2 
	~<uni°d.h
>

3 
	~<°döt.h
>

4 
	~<°rög.h
>

5 
	~<limôs.h
>

6 
	~<°dlib.h
>

7 
	~"°r.h
"

8 
	~<sys/ty≥s.h
>

9 
	~<ªgex.h
>

10 
	~<°d¨g.h
>

11 
	~<uni°d.h
>

12 
	~<°dio.h
>

13 
	~<cˇn/°r/°r.h
>

14 
	~<cˇn/èke/èke.h
>

16 *
	$èl_°rdup
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
)

19  
	`èl_dup_
(
˘x
, 
p
, 1,Ö ? 
	`°æí
’Ë+ 1: 1, 0, 
Ál£
,

20 
	`TAL_LABEL
(, "[]"));

21 
	}
}

23 *
	$èl_°∫dup
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
, 
size_t
 
n
)

25 
size_t
 
Àn
;

26 *
ªt
;

29 i‡(
	`likñy
(
p
)) {

30 
Àn
 = 
	`°æí
(
p
);

31 i‡(
Àn
 > 
n
)

32 
Àn
 = 
n
;

34 
Àn
 = 
n
;

36 
ªt
 = 
	`èl_dup_
(
˘x
, 
p
, 1, 
Àn
, 1, 
Ál£
, 
	`TAL_LABEL
(, "[]"));

37 i‡(
ªt
)

38 
ªt
[
Àn
] = '\0';

39  
ªt
;

40 
	}
}

42 *
	$èl_fmt
(c⁄° 
èl_t
 *
˘x
, c⁄° *
fmt
, ...)

44 
va_li°
 
≠
;

45 *
ªt
;

47 
	`va_°¨t
(
≠
, 
fmt
);

48 
ªt
 = 
	`èl_vfmt
(
˘x
, 
fmt
, 
≠
);

49 
	`va_íd
(
≠
);

51  
ªt
;

52 
	}
}

54 
boﬁ
 
	$do_vfmt
(**
buf
, 
size_t
 
off
, c⁄° *
fmt
, 
va_li°
 
≠
)

57 
size_t
 
max
 = 
	`°æí
(
fmt
) * 2;

58 
boﬁ
 
ok
;

61 
va_li°
 
≠2
;

62 
ªt
;

64 i‡(!
	`èl_ªsize
(
buf
, 
off
 + 
max
)) {

65 
ok
 = 
Ál£
;

69 
	`va_c›y
(
≠2
, 
≠
);

70 
ªt
 = 
	`v¢¥ötf
(*
buf
 + 
off
, 
max
, 
fmt
, 
≠2
);

71 
	`va_íd
(
≠2
);

73 i‡(
ªt
 < 
max
) {

74 
ok
 = 
åue
;

77 
max
 *= 2;

80 i‡(
	`èkí
(
fmt
))

81 
	`èl_‰ì
(
fmt
);

82  
ok
;

83 
	}
}

85 *
	$èl_vfmt
(c⁄° 
èl_t
 *
˘x
, c⁄° *
fmt
, 
va_li°
 
≠
)

87 *
buf
;

89 i‡(!
fmt
 && 
	`èkí
(fmt))

90  
NULL
;

93 
buf
 = 
	`èl_¨r
(
˘x
, , 
	`°æí
(
fmt
) * 2);

94 i‡(!
	`do_vfmt
(&
buf
, 0, 
fmt
, 
≠
))

95 
buf
 = 
	`èl_‰ì
(buf);

96  
buf
;

97 
	}
}

99 
boﬁ
 
	$èl_≠≥nd_vfmt
(**
ba£±r
, c⁄° *
fmt
, 
va_li°
 
≠
)

101 i‡(!
fmt
 && 
	`èkí
(fmt))

102  
Ál£
;

104  
	`do_vfmt
(
ba£±r
, 
	`°æí
(*ba£±r), 
fmt
, 
≠
);

105 
	}
}

107 
boﬁ
 
	$èl_≠≥nd_fmt
(**
ba£±r
, c⁄° *
fmt
, ...)

109 
va_li°
 
≠
;

110 
boﬁ
 
ªt
;

112 
	`va_°¨t
(
≠
, 
fmt
);

113 
ªt
 = 
	`èl_≠≥nd_vfmt
(
ba£±r
, 
fmt
, 
≠
);

114 
	`va_íd
(
≠
);

116  
ªt
;

117 
	}
}

119 *
	$èl_°rˇt
(c⁄° 
èl_t
 *
˘x
, c⁄° *
s1
, c⁄° *
s2
)

121 
size_t
 
Àn1
, 
Àn2
;

122 *
ªt
;

124 i‡(
	`u∆ikñy
(!
s2
Ë&& 
	`èkí
(s2)) {

125 i‡(
	`èkí
(
s1
))

126 
	`èl_‰ì
(
s1
);

127  
NULL
;

130 
Àn1
 = 
s1
 ? 
	`°æí
(s1) : 0;

131 
Àn2
 = 
	`°æí
(
s2
);

134 
ªt
 = 
	`èl_dup_
(
˘x
, 
s1
, 1, 
Àn1
, 
Àn2
 + 1, 
Ál£
,

135 
	`TAL_LABEL
(, "[]"));

136 i‡(
	`likñy
(
ªt
))

137 
	`mem˝y
(
ªt
 + 
Àn1
, 
s2
, 
Àn2
 + 1);

139 i‡(
	`èkí
(
s2
))

140 
	`èl_‰ì
(
s2
);

141  
ªt
;

142 
	}
}

144 **
	$èl_°r•lô
(c⁄° 
èl_t
 *
˘x
,

145 c⁄° *
°rög
, c⁄° *
dñims
, 
°r•lô
 
Êags
)

147 **
∑πs
, *
°r
;

148 
size_t
 
max
 = 64, 
num
 = 0;

150 
∑πs
 = 
	`èl_¨r
(
˘x
, *, 
max
 + 1);

151 i‡(
	`u∆ikñy
(!
∑πs
)) {

152 i‡(
	`èkí
(
°rög
))

153 
	`èl_‰ì
(
°rög
);

154 i‡(
	`èkí
(
dñims
))

155 
	`èl_‰ì
(
dñims
);

156  
NULL
;

158 
°r
 = 
	`èl_°rdup
(
∑πs
, 
°rög
);

159 i‡(
	`u∆ikñy
(!
°r
))

160 
Áû
;

161 i‡(
	`u∆ikñy
(!
dñims
Ë&& 
	`is_èkí
(delims))

162 
Áû
;

164 i‡(
Êags
 =
STR_NO_EMPTY
)

165 
°r
 +
	`°r•n
(°r, 
dñims
);

167 *
°r
 != '\0') {

168 
size_t
 
Àn
 = 
	`°rc•n
(
°r
, 
dñims
), 
dÀn
;

170 
∑πs
[
num
] = 
°r
;

171 
dÀn
 = 
	`°r•n
(
°r
 + 
Àn
, 
dñims
);

172 
∑πs
[
num
][
Àn
] = '\0';

173 i‡(
Êags
 =
STR_EMPTY_OK
 && 
dÀn
)

174 
dÀn
 = 1;

175 
°r
 +
Àn
 + 
dÀn
;

176 i‡(++
num
 =
max
 && !
	`èl_ªsize
(&
∑πs
, max*=2 + 1))

177 
Áû
;

179 
∑πs
[
num
] = 
NULL
;

182 i‡(
	`u∆ikñy
(!
	`èl_ªsize
(&
∑πs
, 
num
+1)))

183 
Áû
;

185 i‡(
	`èkí
(
dñims
))

186 
	`èl_‰ì
(
dñims
);

187  
∑πs
;

189 
Áû
:

190 
	`èl_‰ì
(
∑πs
);

191 i‡(
	`èkí
(
dñims
))

192 
	`èl_‰ì
(
dñims
);

193  
NULL
;

194 
	}
}

196 *
	$èl_°rjoö
(c⁄° 
èl_t
 *
˘x
,

197 *
°rögs
[], c⁄° *
dñim
, 
°rjoö
 
Êags
)

199 
i
;

200 *
ªt
 = 
NULL
;

201 
size_t
 
tŸÀn
 = 0, 
dÀn
;

203 i‡(
	`u∆ikñy
(!
°rögs
Ë&& 
	`is_èkí
(strings))

204 
Áû
;

206 i‡(
	`u∆ikñy
(!
dñim
Ë&& 
	`is_èkí
(delim))

207 
Áû
;

209 
dÀn
 = 
	`°æí
(
dñim
);

210 
ªt
 = 
	`èl_¨r
(
˘x
, , 
dÀn
*2+1);

211 i‡(!
ªt
)

212 
Áû
;

214 
ªt
[0] = '\0';

215 
i
 = 0; 
°rögs
[i]; i++) {

216 
size_t
 
Àn
 = 
	`°æí
(
°rögs
[
i
]);

218 i‡(
Êags
 =
STR_NO_TRAIL
 && !
°rögs
[
i
+1])

219 
dÀn
 = 0;

220 i‡(!
	`èl_ªsize
(&
ªt
, 
tŸÀn
 + 
Àn
 + 
dÀn
 + 1))

221 
Áû
;

222 
	`mem˝y
(
ªt
 + 
tŸÀn
, 
°rögs
[
i
], 
Àn
);

223 
tŸÀn
 +
Àn
;

224 
	`mem˝y
(
ªt
 + 
tŸÀn
, 
dñim
, 
dÀn
);

225 
tŸÀn
 +
dÀn
;

227 
ªt
[
tŸÀn
] = '\0';

228 
out
:

229 i‡(
	`èkí
(
°rögs
))

230 
	`èl_‰ì
(
°rögs
);

231 i‡(
	`èkí
(
dñim
))

232 
	`èl_‰ì
(
dñim
);

233  
ªt
;

234 
Áû
:

235 
ªt
 = 
	`èl_‰ì
(ret);

236 
out
;

237 
	}
}

239 
boﬁ
 
	$èl_°ºeg
(c⁄° 
èl_t
 *
˘x
, c⁄° *
°rög
, c⁄° *
ªgex
, ...)

241 
size_t
 
nm©ch
 = 1 + 
	`°rcou¡
(
ªgex
, "(");

242 
ªgm©ch_t
 
m©ches
[
nm©ch
];

243 
ªgex_t
 
r
;

244 
boﬁ
 
ªt
 = 
Ál£
;

245 
i
;

246 
va_li°
 
≠
;

248 i‡(
	`u∆ikñy
(!
ªgex
Ë&& 
	`is_èkí
(regex))

249 
Áû_no_ª
;

251 i‡(
	`ªgcomp
(&
r
, 
ªgex
, 
REG_EXTENDED
) != 0)

252 
Áû_no_ª
;

254 i‡(
	`u∆ikñy
(!
°rög
Ë&& 
	`is_èkí
(string))

255 
Áû
;

257 i‡(
	`ªgexec
(&
r
, 
°rög
, 
nm©ch
, 
m©ches
, 0) != 0)

258 
Áû
;

260 
ªt
 = 
åue
;

261 
	`va_°¨t
(
≠
, 
ªgex
);

262 
i
 = 1; i < 
nm©ch
; i++) {

263 **
¨g
 = 
	`va_¨g
(
≠
, **);

264 i‡(
¨g
) {

266 i‡(
m©ches
[
i
].
rm_so
 == -1)

267 *
¨g
 = 
NULL
;

269 *
¨g
 = 
	`èl_°∫dup
(
˘x
,

270 
°rög
 + 
m©ches
[
i
].
rm_so
,

271 
m©ches
[
i
].
rm_eo


272 - 
m©ches
[
i
].
rm_so
);

274 i‡(!*
¨g
) {

275 
ªt
 = 
Ál£
;

281 
	`va_íd
(
≠
);

282 
Áû
:

283 
	`ªg‰ì
(&
r
);

284 
Áû_no_ª
:

285 i‡(
	`èkí
(
ªgex
))

286 
	`èl_‰ì
(
ªgex
);

287 i‡(
	`èkí
(
°rög
))

288 
	`èl_‰ì
(
°rög
);

289  
ªt
;

290 
	}
}

	@ccan/ccan/tal/str/str.h

2 #i‚de‡
CCAN_STR_TAL_H


3 
	#CCAN_STR_TAL_H


	)

4 #ifde‡
TAL_USE_TALLOC


5 
	~<cˇn/èl/èŒoc/èŒoc.h
>

7 
	~<cˇn/èl/èl.h
>

9 
	~<°rög.h
>

10 
	~<°dboﬁ.h
>

17 *
èl_°rdup
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
);

27 *
èl_°∫dup
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
, 
size_t
 
n
);

34 *
	$èl_fmt
(c⁄° 
èl_t
 *
˘x
, c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(2,3);

42 *
	$èl_vfmt
(c⁄° 
èl_t
 *
˘x
, c⁄° *
fmt
, 
va_li°
 
≠
)

43 
	`PRINTF_FMT
(2,0);

52 
boﬁ
 
	$èl_≠≥nd_fmt
(**
ba£±r
, c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(2,3);

62 
boﬁ
 
	`èl_≠≥nd_vfmt
(**
ba£±r
, c⁄° *
fmt
, 
va_li°
 
≠
);

70 *
	`èl_°rˇt
(c⁄° 
èl_t
 *
˘x
, c⁄° *
s1
, c⁄° *
s2
);

72 
	e°r•lô
 {

73 
STR_EMPTY_OK
,

74 
STR_NO_EMPTY


112 **
	`èl_°r•lô
(c⁄° 
èl_t
 *
˘x
,

113 c⁄° *
°rög
, c⁄° *
dñims
, 
°r•lô
 
Êag
);

115 
	e°rjoö
 {

116 
STR_TRAIL
,

117 
STR_NO_TRAIL


143 *
	`èl_°rjoö
(c⁄° *
˘x
, *
°rögs
[], c⁄° *
dñim
,

144 
°rjoö
 
Êags
);

185 
boﬁ
 
	`èl_°ºeg
(c⁄° *
˘x
, c⁄° *
°rög
, c⁄° *
ªgex
, ...);

	@ccan/ccan/tal/str/test/helper.h

2 #ifde‡
TAL_USE_TALLOC


3 
ölöe
 
boﬁ
 
	$no_chûdªn
(c⁄° *
˘x
)

5  
	`èŒoc_tŸÆ_blocks
(
˘x
) == 1;

6 
	}
}

8 
ölöe
 
boﬁ
 
	$sögÀ_chûd
(c⁄° *
˘x
, c⁄° *
chûd
)

10  
	`èŒoc_tŸÆ_blocks
(
˘x
Ë=2 && 
	`èl_∑ª¡
(
chûd
) == ctx;

11 
	}
}

13 
ölöe
 
boﬁ
 
	$no_chûdªn
(c⁄° *
˘x
)

15  !
	`èl_fú°
(
˘x
);

16 
	}
}

18 
ölöe
 
boﬁ
 
	$sögÀ_chûd
(c⁄° *
˘x
, c⁄° *
chûd
)

20  
	`èl_fú°
(
˘x
Ë=
chûd
 && !
	`èl_√xt
(ctx, child);

21 
	}
}

	@ccan/ccan/tal/str/test/run-string.c

1 
	~<cˇn/èl/°r/°r.h
>

2 
	~<cˇn/èl/°r/°r.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~"hñ≥r.h
"

6 
	$maö
()

8 *
∑ª¡
, *
c
;

10 
	`∂™_ã°s
(32);

12 
∑ª¡
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
∑ª¡
);

15 
c
 = 
	`èl_°rdup
(
∑ª¡
, "hello");

16 
	`ok1
(
	`°rcmp
(
c
, "hello") == 0);

17 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

18 
	`èl_‰ì
(
c
);

20 
c
 = 
	`èl_°∫dup
(
∑ª¡
, "hello", 3);

21 
	`ok1
(
	`°rcmp
(
c
, "hel") == 0);

22 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

23 
	`èl_‰ì
(
c
);

25 #ifde‡
TAL_USE_TALLOC


26 
c
 = 
	`èl_èŒoc_ty≥chk_
(
∑ª¡
, *);

28 
c
 = 
	`èl_ty≥chk_
(
∑ª¡
, *);

30 
c
 = 
	`èl_dup
(
∑ª¡
, , "hello", 6, 0);

31 
	`ok1
(
	`°rcmp
(
c
, "hello") == 0);

32 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
c
), "char[]") == 0);

33 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

34 
	`èl_‰ì
(
c
);

37 
c
 = 
	`èl_dup
(
∑ª¡
, , "hello", 6, 1);

38 
	`ok1
(
	`°rcmp
(
c
, "hello") == 0);

39 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
c
), "char[]") == 0);

40 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

41 
	`°rˇt
(
c
, "x");

42 
	`èl_‰ì
(
c
);

44 
c
 = 
	`èl_fmt
(
∑ª¡
, "hello %s", "there");

45 
	`ok1
(
	`°rcmp
(
c
, "helloÅhere") == 0);

46 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

47 
	`èl_‰ì
(
c
);

49 
c
 = 
	`èl_°rˇt
(
∑ª¡
, "hello ", "there");

50 
	`ok1
(
	`°rcmp
(
c
, "helloÅhere") == 0);

51 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

54 
c
 = 
	`èl_°rˇt
(
∑ª¡
, 
	`èke
(c), "ágain");

55 
	`ok1
(
	`°rcmp
(
c
, "helloÅhereágain") == 0);

56 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

57 
	`ok1
(
	`sögÀ_chûd
(
∑ª¡
, 
c
));

59 
c
 = 
	`èl_°rˇt
(
∑ª¡
, "And ", 
	`èke
(c));

60 
	`ok1
(
	`°rcmp
(
c
, "And helloÅhereágain") == 0);

61 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

62 
	`ok1
(
	`sögÀ_chûd
(
∑ª¡
, 
c
));

65 
c
 = 
	`èl_°rˇt
(
∑ª¡
, 
	`èke
(
NULL
),Åake(c));

66 
	`ok1
(!
c
);

67 
	`ok1
(
	`no_chûdªn
(
∑ª¡
));

69 
c
 = 
	`èl_°rˇt
(
∑ª¡
, 
	`èke
(
	`èl_°rdup
(parent, "hi")),

70 
	`èke
(
NULL
));

71 
	`ok1
(!
c
);

72 
	`ok1
(
	`no_chûdªn
(
∑ª¡
));

74 
c
 = 
	`èl_°rˇt
(
∑ª¡
, 
	`èke
(
NULL
),Åake(NULL));

75 
	`ok1
(!
c
);

76 
	`ok1
(
	`no_chûdªn
(
∑ª¡
));

79 
c
 = 
	`èl_°rdup
(
∑ª¡
, "hi");

80 
	`ok1
(
	`èl_≠≥nd_fmt
(&
c
, "%s %s", "there", "world"));

81 
	`ok1
(
	`°rcmp
(
c
, "hithere world") == 0);

82 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

84 
	`ok1
(!
	`èl_≠≥nd_fmt
(&
c
, 
	`èke
(
NULL
), "there", "world"));

85 
	`ok1
(
	`°rcmp
(
c
, "hithere world") == 0);

87 
	`èl_‰ì
(
∑ª¡
);

89  
	`exô_°©us
();

90 
	}
}

	@ccan/ccan/tal/str/test/run-strreg.c

1 
	~<cˇn/èl/°r/°r.h
>

2 
	~<cˇn/èl/°r/°r.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~"hñ≥r.h
"

6 
boﬁ
 
	$föd_∑ª¡
(
èl_t
 *
chûd
,ÅÆ_à*
∑ª¡
)

8 
èl_t
 *
i
;

10 
i
 = 
chûd
; i; i = 
	`èl_∑ª¡
(i))

11 i‡(
i
 =
∑ª¡
)

12  
åue
;

14  
Ál£
;

15 
	}
}

17 
	$maö
(
¨gc
, *
¨gv
[])

19 *
˘x
 = 
	`èl_°rdup
(
NULL
, "toplevel");

20 *
a
, *
b
;

22 **
övÆid
 = (**)1L;

24 
	`∂™_ã°s
(40);

26 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", "hñlo"Ë=
åue
);

27 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", "hi"Ë=
Ál£
);

30 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", "hñlo", 
övÆid
Ë=
åue
);

31 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", "hi", 
övÆid
Ë=
Ál£
);

33 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", "[a-z]+", 
övÆid
Ë=
åue
);

34 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", "([a-z]+)", &
a
, 
övÆid
Ë=
åue
);

36 
	`ok1
(
	`°ªq
(
a
, "hello"));

38 
	`ok1
(
	`föd_∑ª¡
(
a
, 
˘x
));

39 
	`èl_‰ì
(
a
);

41 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hello world!", "([a-z]*) ([a-z]+)",

42 &
a
, &
b
, 
övÆid
Ë=
åue
);

43 
	`ok1
(
	`°ªq
(
a
, "hello"));

44 
	`ok1
(
	`°ªq
(
b
, "world"));

45 
	`ok1
(
	`föd_∑ª¡
(
a
, 
˘x
));

46 
	`ok1
(
	`föd_∑ª¡
(
b
, 
˘x
));

47 
	`èl_‰ì
(
a
);

48 
	`èl_‰ì
(
b
);

51 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hello world!", "([a-z])* ([a-z]+)",

52 &
a
, &
b
, 
övÆid
Ë=
åue
);

53 
	`ok1
(
	`°ªq
(
a
, "o"));

54 
	`ok1
(
	`°ªq
(
b
, "world"));

55 
	`èl_‰ì
(
a
);

56 
	`èl_‰ì
(
b
);

59 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hello world!", "(([a-z]*) world)",

60 &
a
, &
b
, 
övÆid
Ë=
åue
);

61 
	`ok1
(
	`°ªq
(
a
, "hello world"));

62 
	`ok1
(
	`°ªq
(
b
, "hello"));

63 
	`èl_‰ì
(
a
);

64 
	`èl_‰ì
(
b
);

67 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hello world!", "(([a-z]*) world)",

68 &
a
, &
b
, 
övÆid
Ë=
åue
);

69 
	`ok1
(
	`°ªq
(
a
, "hello world"));

70 
	`ok1
(
	`°ªq
(
b
, "hello"));

71 
	`èl_‰ì
(
a
);

72 
	`èl_‰ì
(
b
);

75 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hello world!", "((hello|goodbye) world)",

76 &
a
, 
NULL
, 
övÆid
Ë=
åue
);

77 
	`ok1
(
	`°ªq
(
a
, "hello world"));

78 
	`èl_‰ì
(
a
);

81 
	`ok1
(
	`no_chûdªn
(
˘x
));

84 
	`ok1
(
	`èl_°ºeg
(
˘x
, 
	`èke
(
NULL
), "((hello|goodbye) world)",

85 &
b
, 
NULL
, 
övÆid
Ë=
Ál£
);

88 
a
 = 
	`èl_°rdup
(
˘x
, "hello world!");

89 
	`ok1
(
	`èl_°ºeg
(
˘x
, 
	`èke
(
a
), "([a-z]+)", &
b
, 
övÆid
Ë=
åue
);

90 
	`ok1
(
	`°ªq
(
b
, "hello"));

91 
	`ok1
(
	`èl_∑ª¡
(
b
Ë=
˘x
);

92 
	`èl_‰ì
(
b
);

93 
	`ok1
(
	`no_chûdªn
(
˘x
));

96 
a
 = 
	`èl_°rdup
(
˘x
, "([a-z]+)");

97 
	`ok1
(
	`èl_°ºeg
(
˘x
, "hñlÿw‹ld!", 
	`èke
(
a
), &
b
, 
övÆid
Ë=
åue
);

98 
	`ok1
(
	`°ªq
(
b
, "hello"));

99 
	`ok1
(
	`èl_∑ª¡
(
b
Ë=
˘x
);

100 
	`èl_‰ì
(
b
);

101 
	`ok1
(
	`no_chûdªn
(
˘x
));

104 
a
 = 
	`èl_°rdup
(
˘x
, "([a-z]+)");

105 
	`ok1
(
	`èl_°ºeg
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "hello world!")),

106 
	`èke
(
a
), &
b
, 
övÆid
Ë=
åue
);

107 
	`ok1
(
	`°ªq
(
b
, "hello"));

108 
	`ok1
(
	`èl_∑ª¡
(
b
Ë=
˘x
);

109 
	`èl_‰ì
(
b
);

110 
	`ok1
(
	`no_chûdªn
(
˘x
));

113 
a
 = 
	`èl_°rdup
(
˘x
, "([a-z]+)");

114 
	`ok1
(
	`èl_°ºeg
(
˘x
, 
	`èke
(
	`èl_°rdup
(ctx, "HELLO WORLD!")),

115 
	`èke
(
a
), &
b
, 
övÆid
Ë=
Ál£
);

116 
	`ok1
(
	`no_chûdªn
(
˘x
));

117 
	`èl_‰ì
(
˘x
);

119  
	`exô_°©us
();

120 
	}
}

	@ccan/ccan/tal/str/test/run-take.c

1 
	~<cˇn/èl/°r/°r.h
>

2 
	~<cˇn/èl/°r/°r.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~"hñ≥r.h
"

6 
	$maö
()

8 *
∑ª¡
, *
c
;

10 
	`∂™_ã°s
(14);

12 
∑ª¡
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
∑ª¡
);

15 
c
 = 
	`èl_°rdup
(
∑ª¡
, "hello");

17 
c
 = 
	`èl_°rdup
(
∑ª¡
, 
	`èke
(c));

18 
	`ok1
(
	`°rcmp
(
c
, "hello") == 0);

19 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

21 
c
 = 
	`èl_°∫dup
(
∑ª¡
, 
	`èke
(c), 5);

22 
	`ok1
(
	`°rcmp
(
c
, "hello") == 0);

23 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

25 
c
 = 
	`èl_°∫dup
(
∑ª¡
, 
	`èke
(c), 3);

26 
	`ok1
(
	`°rcmp
(
c
, "hel") == 0);

27 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

28 
	`èl_‰ì
(
c
);

30 
c
 = 
	`èl_°rdup
(
∑ª¡
, "hello %s");

31 
c
 = 
	`èl_fmt
(
∑ª¡
, 
	`èke
(c), "there");

32 
	`ok1
(
	`°rcmp
(
c
, "helloÅhere") == 0);

33 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

35 
	`èl_‰ì
(
c
);

36 
	`ok1
(
	`no_chûdªn
(
∑ª¡
));

38 
	`èl_‰ì
(
∑ª¡
);

39 
	`ok1
(!
	`èkí_™y
());

42 
c
 = 
NULL
;

43 
	`ok1
(
	`èl_°rdup
(
NULL
, 
	`èke
(
c
)) == NULL);

44 
	`ok1
(
	`èl_°∫dup
(
NULL
, 
	`èke
(
c
), 5) == NULL);

45 
	`ok1
(
	`èl_fmt
(
NULL
, 
	`èke
(
c
), 0) == NULL);

47  
	`exô_°©us
();

48 
	}
}

	@ccan/ccan/tal/str/test/run.c

1 
	~<cˇn/èl/°r/°r.h
>

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<cˇn/èl/°r/°r.c
>

5 
	~<cˇn/èp/èp.h
>

6 
	~"hñ≥r.h
"

8 
	#ARRAY_SIZE
(
¨r
Ë(◊ºË/ ◊º[0]))

	)

10 c⁄° *
	gsub°rögs
[]

11 { "Ár", "b¨", "baz", "b", "ba", "z", "¨", 
NULL
 };

13 
	$maö
(
¨gc
, *
¨gv
[])

15 **
•lô
, *
°r
;

16 *
˘x
;

18 
	`∂™_ã°s
(69);

19 
•lô
 = 
	`èl_°r•lô
(
NULL
, "hñlÿ w‹ld", " ", 
STR_EMPTY_OK
);

20 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

21 
	`ok1
(!
	`°rcmp
(
•lô
[1], ""));

22 
	`ok1
(!
	`°rcmp
(
•lô
[2], "world"));

23 
	`ok1
(
•lô
[3] =
NULL
);

24 
	`ok1
(
	`èl_cou¡
(
•lô
) == 4);

25 
	`èl_‰ì
(
•lô
);

27 
•lô
 = 
	`èl_°r•lô
(
NULL
, "hñlÿ w‹ld", " ", 
STR_NO_EMPTY
);

28 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

29 
	`ok1
(!
	`°rcmp
(
•lô
[1], "world"));

30 
	`ok1
(
•lô
[2] =
NULL
);

31 
	`ok1
(
	`èl_cou¡
(
•lô
) == 3);

32 
	`èl_‰ì
(
•lô
);

34 
•lô
 = 
	`èl_°r•lô
(
NULL
, " hñlÿ w‹ld", " ", 
STR_NO_EMPTY
);

35 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

36 
	`ok1
(!
	`°rcmp
(
•lô
[1], "world"));

37 
	`ok1
(
•lô
[2] =
NULL
);

38 
	`ok1
(
	`èl_cou¡
(
•lô
) == 3);

39 
	`èl_‰ì
(
•lô
);

41 
•lô
 = 
	`èl_°r•lô
(
NULL
, "hñlÿ w‹ld", "ÿ", 
STR_EMPTY_OK
);

42 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hell"));

43 
	`ok1
(!
	`°rcmp
(
•lô
[1], ""));

44 
	`ok1
(!
	`°rcmp
(
•lô
[2], ""));

45 
	`ok1
(!
	`°rcmp
(
•lô
[3], "w"));

46 
	`ok1
(!
	`°rcmp
(
•lô
[4], "rld"));

47 
	`ok1
(
•lô
[5] =
NULL
);

48 
	`ok1
(
	`èl_cou¡
(
•lô
) == 6);

50 
˘x
 = 
•lô
;

51 
•lô
 = 
	`èl_°r•lô
(
˘x
, "hñlÿ w‹ld", "ÿ", 
STR_EMPTY_OK
);

52 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

53 
	`èl_‰ì
(
˘x
);

55 
°r
 = 
	`èl_°rjoö
(
NULL
, (**)
sub°rögs
, ", ", 
STR_TRAIL
);

56 
	`ok1
(!
	`°rcmp
(
°r
, "far, bar, baz, b, ba, z,ár, "));

57 
˘x
 = 
°r
;

58 
°r
 = 
	`èl_°rjoö
(
˘x
, (**)
sub°rögs
, "", 
STR_TRAIL
);

59 
	`ok1
(!
	`°rcmp
(
°r
, "farbarbazbbazar"));

60 
	`ok1
(
	`èl_∑ª¡
(
°r
Ë=
˘x
);

61 
°r
 = 
	`èl_°rjoö
(
˘x
, (**)
sub°rögs
, ", ", 
STR_NO_TRAIL
);

62 
	`ok1
(
	`èl_∑ª¡
(
°r
Ë=
˘x
);

63 
	`ok1
(!
	`°rcmp
(
°r
, "far, bar, baz, b, ba, z,ár"));

64 
°r
 = 
	`èl_°rjoö
(
˘x
, (**)
sub°rögs
, "", 
STR_NO_TRAIL
);

65 
	`ok1
(!
	`°rcmp
(
°r
, "farbarbazbbazar"));

66 
	`ok1
(
	`èl_∑ª¡
(
°r
Ë=
˘x
);

67 
	`èl_‰ì
(
˘x
);

69 
˘x
 = 
	`èl_°rdup
(
NULL
, "context");

71 
	`ok1
(
	`èl_°r•lô
(
NULL
, 
	`èke
(NULL), " ", 
STR_EMPTY_OK
) == NULL);

72 
	`ok1
(
	`èl_°r•lô
(
NULL
, "foo", 
	`èke
(NULL), 
STR_EMPTY_OK
) == NULL);

77 
°r
 = 
	`èl_°rdup
(
˘x
, "hello world");

78 
	`ok1
(
	`èl_check
(
˘x
, 
NULL
));

79 
	`ok1
(
	`èl_check
(
°r
, 
NULL
));

80 
•lô
 = 
	`èl_°r•lô
(
˘x
, 
	`èke
(
°r
), " ", 
STR_EMPTY_OK
);

81 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

82 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

83 
	`ok1
(!
	`°rcmp
(
•lô
[1], "world"));

84 
	`ok1
(
•lô
[2] =
NULL
);

85 
	`ok1
(
	`èl_check
(
•lô
, 
NULL
));

86 
	`ok1
(
	`èl_check
(
˘x
, 
NULL
));

87 
	`èl_‰ì
(
•lô
);

89 
	`ok1
(
	`no_chûdªn
(
˘x
));

92 
°r
 = 
	`èl_°rdup
(
˘x
, " ");

93 
•lô
 = 
	`èl_°r•lô
(
˘x
, "hñlÿw‹ld", 
	`èke
(
°r
), 
STR_EMPTY_OK
);

94 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

95 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

96 
	`ok1
(!
	`°rcmp
(
•lô
[1], "world"));

97 
	`ok1
(
•lô
[2] =
NULL
);

98 
	`ok1
(
	`èl_check
(
•lô
, 
NULL
));

99 
	`ok1
(
	`èl_check
(
˘x
, 
NULL
));

100 
	`èl_‰ì
(
•lô
);

102 
	`ok1
(
	`no_chûdªn
(
˘x
));

105 
•lô
 = 
	`èl_°r•lô
(
˘x
, 
	`èke
(
	`èl_°rdup
(
NULL
, "hello world")),

106 
	`èke
(
	`èl_°rdup
(
NULL
, " ")), 
STR_EMPTY_OK
);

107 
	`ok1
(
	`èl_∑ª¡
(
•lô
Ë=
˘x
);

108 
	`ok1
(!
	`°rcmp
(
•lô
[0], "hello"));

109 
	`ok1
(!
	`°rcmp
(
•lô
[1], "world"));

110 
	`ok1
(
•lô
[2] =
NULL
);

111 
	`ok1
(
	`èl_check
(
•lô
, 
NULL
));

112 
	`ok1
(
	`èl_check
(
˘x
, 
NULL
));

113 
	`èl_‰ì
(
•lô
);

115 
	`ok1
(
	`no_chûdªn
(
˘x
));

118 
	`ok1
(
	`èl_°rjoö
(
˘x
, 
	`èke
(
NULL
), "", 
STR_TRAIL
) == NULL);

119 
	`ok1
(
	`èl_°rjoö
(
˘x
, 
	`èke
(
NULL
), "", 
STR_NO_TRAIL
) == NULL);

120 
	`ok1
(
	`èl_°rjoö
(
˘x
, 
•lô
, 
	`èke
(
NULL
), 
STR_TRAIL
) == NULL);

121 
	`ok1
(
	`èl_°rjoö
(
˘x
, 
•lô
, 
	`èke
(
NULL
), 
STR_NO_TRAIL
) == NULL);

124 
•lô
 = 
	`èl_°r•lô
(
˘x
, "hñlÿw‹ld", " ", 
STR_EMPTY_OK
);

125 
°r
 = 
	`èl_°rjoö
(
˘x
, 
	`èke
(
•lô
), "Åhîê", 
STR_NO_TRAIL
);

126 
	`ok1
(!
	`°rcmp
(
°r
, "helloÅhere world"));

127 
	`ok1
(
	`èl_∑ª¡
(
°r
Ë=
˘x
);

129 
	`ok1
(
	`sögÀ_chûd
(
˘x
, 
°r
));

130 
	`èl_‰ì
(
°r
);

131 
	`ok1
(
	`no_chûdªn
(
˘x
));

134 
•lô
 = 
	`èl_°r•lô
(
˘x
, "hñlÿw‹ld", " ", 
STR_EMPTY_OK
);

135 
°r
 = 
	`èl_°rjoö
(
˘x
, 
•lô
, 
	`èke
(
	`èl_°rdup
(ctx, "Åhere ")),

136 
STR_NO_TRAIL
);

137 
	`ok1
(!
	`°rcmp
(
°r
, "helloÅhere world"));

138 
	`ok1
(
	`èl_∑ª¡
(
°r
Ë=
˘x
);

139 
	`èl_‰ì
(
•lô
);

141 
	`ok1
(
	`sögÀ_chûd
(
˘x
, 
°r
));

142 
	`èl_‰ì
(
°r
);

143 
	`ok1
(
	`no_chûdªn
(
˘x
));

146 
°r
 = 
	`èl_°rjoö
(
˘x
, 
	`èke
(
	`èl_°r•lô
(ctx, "hello world", " ",

147 
STR_EMPTY_OK
)),

148 
	`èke
(
	`èl_°rdup
(
˘x
, "Åhîê")), 
STR_NO_TRAIL
);

149 
	`ok1
(!
	`°rcmp
(
°r
, "helloÅhere world"));

150 
	`ok1
(
	`èl_∑ª¡
(
°r
Ë=
˘x
);

152 
	`ok1
(
	`sögÀ_chûd
(
˘x
, 
°r
));

153 
	`èl_‰ì
(
°r
);

154 
	`ok1
(
	`no_chûdªn
(
˘x
));

155 
	`èl_‰ì
(
˘x
);

157  
	`exô_°©us
();

158 
	}
}

	@ccan/ccan/tal/tal.c

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/compûî/compûî.h
>

4 
	~<cˇn/li°/li°.h
>

5 
	~<cˇn/èke/èke.h
>

6 
	~<cˇn/Æignof/Æignof.h
>

7 
	~<as£π.h
>

8 
	~<°dio.h
>

9 
	~<°ddef.h
>

10 
	~<°rög.h
>

11 
	~<limôs.h
>

12 
	~<î∫o.h
>

16 
	#NOTIFY_IS_DESTRUCTOR
 512

	)

19 
	e¥›_ty≥
 {

20 
	mCHILDREN
 = 0x00c1d500,

21 
	mNAME
 = 0x00111100,

22 
	mNOTIFIER
 = 0x00071f00,

23 
	mLENGTH
 = 0x00515300

26 
	sèl_hdr
 {

27 
li°_node
 
	mli°
;

28 
¥›_hdr
 *
	m¥›
;

29 
chûdªn
 *
	m∑ª¡_chûd
;

32 
	s¥›_hdr
 {

33 
¥›_ty≥
 
	mty≥
;

34 
¥›_hdr
 *
	m√xt
;

37 
	schûdªn
 {

38 
¥›_hdr
 
	mhdr
;

39 
èl_hdr
 *
	m∑ª¡
;

40 
li°_hód
 
	mchûdªn
;

43 
	s«me
 {

44 
¥›_hdr
 
	mhdr
;

45 
	m«me
[];

48 
	sÀngth
 {

49 
¥›_hdr
 
	mhdr
;

50 
size_t
 
	mcou¡
;

53 
	snŸifõr
 {

54 
¥›_hdr
 
	mhdr
;

55 
èl_nŸify_ty≥
 
	mty≥s
;

57 (*
	mnŸify‚
)(
	mèl_t
 *, 
	mèl_nŸify_ty≥
, *);

58 (*
	mde°roy
)(
	mèl_t
 *);

59 } 
	mu
;

63 
èl_hdr
 
	mhdr
;

64 
chûdªn
 
	mc
;

65 } 
	gnuŒ_∑ª¡
 = { { { &
nuŒ_∑ª¡
.
hdr
.
li°
, &null_parent.hdr.list },

66 &
nuŒ_∑ª¡
.
c
.
hdr
, 
NULL
 },

67 { { 
CHILDREN
, 
NULL
 },

68 &
nuŒ_∑ª¡
.
hdr
,

69 { { &
nuŒ_∑ª¡
.
c
.
chûdªn
.
n
,

70 &
nuŒ_∑ª¡
.
c
.
chûdªn
.
n
 } }

75 *(*
	gÆloc‚
)(
size_t
 
	gsize
Ë
mÆloc
;

76 *(*
	gªsize‚
)(*, 
size_t
 
	gsize
Ë
ªÆloc
;

77 (*
‰ì‚
)(*Ë
‰ì
;

78 (*
îr‹‚
)(c⁄° *
msg
Ë(*)
ab‹t
;

80 
size_t
 
nŸifõrs
 = 0;

82 
ölöe
 
COLD
 
	$ˇŒ_îr‹
(c⁄° *
msg
)

84 
	`îr‹‚
(
msg
);

85 
	}
}

87 
boﬁ
 
	$gë_de°royög_bô
(
chûdªn
 *
∑ª¡_chûd
)

89  (
size_t
)
∑ª¡_chûd
 & 1;

90 
	}
}

92 
	$£t_de°royög_bô
(
chûdªn
 **
∑ª¡_chûd
)

94 *
∑ª¡_chûd
 = (*)((
size_t
)*parent_child | 1);

95 
	}
}

97 
chûdªn
 *
	$ign‹e_de°royög_bô
(
chûdªn
 *
∑ª¡_chûd
)

99  (*)((
size_t
)
∑ª¡_chûd
 & ~(size_t)1);

100 
	}
}

103 
	$èl_˛ónup
()

105 
èl_hdr
 *
i
;

107 (
i
 = 
	`li°_t›
(&
nuŒ_∑ª¡
.
c
.
chûdªn
, 
èl_hdr
, 
li°
))) {

108 
	`li°_dñ
(&
i
->
li°
);

109 
	`mem£t
(
i
, 0, (*i));

113 
	`èke_˛ónup
();

114 
	}
}

117 
boﬁ
 
	$is_lôîÆ
(c⁄° 
¥›_hdr
 *
¥›
)

119  ((*)
¥›
)[0] != 0;

120 
	}
}

122 #i‚de‡
NDEBUG


123 c⁄° *
	gbounds_°¨t
, *
	gbounds_íd
;

125 
	$upd©e_bounds
(c⁄° *
√w
, 
size_t
 
size
)

127 i‡(
	`u∆ikñy
(!
bounds_°¨t
)) {

128 
bounds_°¨t
 = 
√w
;

129 
bounds_íd
 = (*)
√w
 + 
size
;

130 } i‡(
√w
 < 
bounds_°¨t
)

131 
bounds_°¨t
 = 
√w
;

132 i‡((*)
√w
 + 
size
 > (*)
bounds_íd
)

133 
bounds_íd
 = (*)
√w
 + 
size
;

134 
	}
}

136 
boﬁ
 
	$ö_bounds
(c⁄° *
p
)

138  !
p


139 || (
p
 >(*)&
nuŒ_∑ª¡
 &&Ö <= (*)(&null_parent + 1))

140 || (
p
 >
bounds_°¨t
 &&Ö <
bounds_íd
);

141 
	}
}

143 
	$upd©e_bounds
(c⁄° *
√w
, 
size_t
 
size
)

145 
	}
}

147 
boﬁ
 
	$ö_bounds
(c⁄° *
p
)

149  
åue
;

150 
	}
}

153 
	$check_bounds
(c⁄° *
p
)

155 i‡(!
	`ö_bounds
(
p
))

156 
	`ˇŒ_îr‹
("Notá valid header");

157 
	}
}

159 
èl_hdr
 *
	$to_èl_hdr
(c⁄° *
˘x
)

161 
èl_hdr
 *
t
;

163 
t
 = (
èl_hdr
 *)((*)
˘x
 - (tal_hdr));

164 
	`check_bounds
(
t
);

165 
	`check_bounds
(
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
));

166 
	`check_bounds
(
t
->
li°
.
√xt
);

167 
	`check_bounds
(
t
->
li°
.
¥ev
);

168 i‡(
t
->
¥›
 && !
	`is_lôîÆ
(t->prop))

169 
	`check_bounds
(
t
->
¥›
);

170  
t
;

171 
	}
}

173 
èl_hdr
 *
	$to_èl_hdr_‹_nuŒ
(c⁄° *
˘x
)

175 i‡(!
˘x
)

176  &
nuŒ_∑ª¡
.
hdr
;

177  
	`to_èl_hdr
(
˘x
);

178 
	}
}

180 *
	$‰om_èl_hdr
(c⁄° 
èl_hdr
 *
hdr
)

182  (*)(
hdr
 + 1);

183 
	}
}

185 #ifde‡
TAL_DEBUG


186 *
	$‰om_èl_hdr_‹_nuŒ
(
èl_hdr
 *
hdr
)

188 i‡(
hdr
 =&
nuŒ_∑ª¡
.hdr)

189  
NULL
;

190  
	`‰om_èl_hdr
(
hdr
);

191 
	}
}

193 
èl_hdr
 *
	$debug_èl
(
èl_hdr
 *
èl
)

195 
	`èl_check
(
	`‰om_èl_hdr_‹_nuŒ
(
èl
), "TAL_DEBUG ");

196  
èl
;

197 
	}
}

199 
èl_hdr
 *
	$debug_èl
(
èl_hdr
 *
èl
)

201  
èl
;

202 
	}
}

205 
	$nŸify
(c⁄° 
èl_hdr
 *
˘x
,

206 
èl_nŸify_ty≥
 
ty≥
, c⁄° *
öfo
)

208 c⁄° 
¥›_hdr
 *
p
;

210 
p
 = 
˘x
->
¥›
;Ö;Ö =Ö->
√xt
) {

211 
nŸifõr
 *
n
;

213 i‡(
	`is_lôîÆ
(
p
))

215 i‡(
p
->
ty≥
 !
NOTIFIER
)

217 
n
 = (
nŸifõr
 *)
p
;

218 i‡(
n
->
ty≥s
 & 
ty≥
) {

219 i‡(
n
->
ty≥s
 & 
NOTIFY_IS_DESTRUCTOR
)

220 
n
->
u
.
	`de°roy
(
	`‰om_èl_hdr
(
˘x
));

222 
n
->
u
.
	`nŸify‚
(
	`‰om_èl_hdr
(
˘x
), 
ty≥
,

223 (*)
öfo
);

226 
	}
}

228 *
	$Æloˇã
(
size_t
 
size
)

230 *
ªt
 = 
	`Æloc‚
(
size
);

231 i‡(!
ªt
)

232 
	`ˇŒ_îr‹
("allocation failed");

234 
	`upd©e_bounds
(
ªt
, 
size
);

235  
ªt
;

236 
	}
}

238 
¥›_hdr
 **
	$föd_¥›îty_±r
(c⁄° 
èl_hdr
 *
t
,

239 
¥›_ty≥
 
ty≥
)

241 
¥›_hdr
 **
p
;

243 
p
 = (
¥›_hdr
 **)&
t
->
¥›
; *p;Ö = &(*p)->
√xt
) {

244 i‡(
	`is_lôîÆ
(*
p
)) {

245 i‡(
ty≥
 =
NAME
)

246  
p
;

249 i‡((*
p
)->
ty≥
 ==Åype)

250  
p
;

252  
NULL
;

253 
	}
}

255 *
	$föd_¥›îty
(c⁄° 
èl_hdr
 *
∑ª¡
, 
¥›_ty≥
 
ty≥
)

257 
¥›_hdr
 **
p
 = 
	`föd_¥›îty_±r
(
∑ª¡
, 
ty≥
);

259 i‡(
p
)

260  *
p
;

261  
NULL
;

262 
	}
}

264 
	$öô_¥›îty
(
¥›_hdr
 *
hdr
,

265 
èl_hdr
 *
∑ª¡
,

266 
¥›_ty≥
 
ty≥
)

268 
hdr
->
ty≥
 =Åype;

269 
hdr
->
√xt
 = 
∑ª¡
->
¥›
;

270 
∑ª¡
->
¥›
 = 
hdr
;

271 
	}
}

273 
nŸifõr
 *
add_nŸifõr_¥›îty
(
èl_hdr
 *
t
,

274 
èl_nŸify_ty≥
 
ty≥s
,

275 (*
‚
)(*,

276 
èl_nŸify_ty≥
,

279 
nŸifõr
 *
¥›
 = 
	`Æloˇã
((*prop));

280 i‡(
¥›
) {

281 
	`öô_¥›îty
(&
¥›
->
hdr
, 
t
, 
NOTIFIER
);

282 
¥›
->
ty≥s
 =Åypes;

283 
¥›
->
u
.
nŸify‚
 = 
‚
;

285  
¥›
;

286 
	}
}

288 
èl_nŸify_ty≥
 
dñ_nŸifõr_¥›îty
(
èl_hdr
 *
t
,

289 (*
‚
)(
èl_t
 *,

290 
èl_nŸify_ty≥
,

293 
¥›_hdr
 **
p
;

295 
p
 = (
¥›_hdr
 **)&
t
->
¥›
; *p;Ö = &(*p)->
√xt
) {

296 
nŸifõr
 *
n
;

298 i‡(
	`is_lôîÆ
(*
p
))

300 i‡((*
p
)->
ty≥
 !
NOTIFIER
)

302 
n
 = (
nŸifõr
 *)*
p
;

303 i‡(
n
->
u
.
nŸify‚
 =
‚
) {

304 
èl_nŸify_ty≥
 
ty≥s
 = 
n
->types;

305 *
p
 = (*p)->
√xt
;

306 
	`‰ì‚
(
n
);

307  
ty≥s
 & ~
NOTIFY_IS_DESTRUCTOR
;

311 
	}
}

313 
«me
 *
	$add_«me_¥›îty
(
èl_hdr
 *
t
, c⁄° *
«me
)

315 
«me
 *
¥›
;

317 
¥›
 = 
	`Æloˇã
((*¥›Ë+ 
	`°æí
(
«me
) + 1);

318 i‡(
¥›
) {

319 
	`öô_¥›îty
(&
¥›
->
hdr
, 
t
, 
NAME
);

320 
	`°r˝y
(
¥›
->
«me
,Çame);

322  
¥›
;

323 
	}
}

325 
chûdªn
 *
	$add_chûd_¥›îty
(
èl_hdr
 *
∑ª¡
,

326 
èl_hdr
 *
chûd
)

328 
chûdªn
 *
¥›
 = 
	`Æloˇã
((*prop));

329 i‡(
¥›
) {

330 
	`öô_¥›îty
(&
¥›
->
hdr
, 
∑ª¡
, 
CHILDREN
);

331 
¥›
->
∑ª¡
 =Öarent;

332 
	`li°_hód_öô
(&
¥›
->
chûdªn
);

334  
¥›
;

335 
	}
}

337 
boﬁ
 
	$add_chûd
(
èl_hdr
 *
∑ª¡
, èl_hd∏*
chûd
)

339 
chûdªn
 *chûdª¿
	`föd_¥›îty
(
∑ª¡
, 
CHILDREN
);

341 i‡(!
chûdªn
) {

342 
chûdªn
 = 
	`add_chûd_¥›îty
(
∑ª¡
, 
chûd
);

343 i‡(!
chûdªn
)

344  
Ál£
;

346 
	`li°_add
(&
chûdªn
->chûdªn, &
chûd
->
li°
);

347 
chûd
->
∑ª¡_chûd
 = 
chûdªn
;

348  
åue
;

349 
	}
}

351 
	$dñ_åì
(
èl_hdr
 *
t
, c⁄° 
èl_t
 *
‹ig
)

353 
¥›_hdr
 **
¥›
, *
p
, *
√xt
;

356 i‡(
	`u∆ikñy
(
	`gë_de°royög_bô
(
t
->
∑ª¡_chûd
)))

359 
	`£t_de°royög_bô
(&
t
->
∑ª¡_chûd
);

362 
	`nŸify
(
t
, 
TAL_NOTIFY_FREE
, (
èl_t
 *)
‹ig
);

365 
¥›
 = 
	`föd_¥›îty_±r
(
t
, 
CHILDREN
);

366 i‡(
¥›
) {

367 
èl_hdr
 *
i
;

368 
chûdªn
 *
c
 = (chûdª¿*)*
¥›
;

370 (
i
 = 
	`li°_t›
(&
c
->
chûdªn
, 
èl_hdr
, 
li°
))) {

371 
	`li°_dñ
(&
i
->
li°
);

372 
	`dñ_åì
(
i
, 
‹ig
);

377 
p
 = 
t
->
¥›
;Ö && !
	`is_lôîÆ
’);Ö = 
√xt
) {

378 
√xt
 = 
p
->next;

380 i‡(
p
->
ty≥
 !
LENGTH
)

381 
	`‰ì‚
(
p
);

383 
	`‰ì‚
(
t
);

384 
	}
}

386 *
	$èl_Æloc_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
size
, 
boﬁ
 
˛ór
, c⁄° *
œbñ
)

388 
èl_hdr
 *
chûd
, *
∑ª¡
 = 
	`debug_èl
(
	`to_èl_hdr_‹_nuŒ
(
˘x
));

390 
chûd
 = 
	`Æloˇã
((
èl_hdr
Ë+ 
size
);

391 i‡(!
chûd
)

392  
NULL
;

393 i‡(
˛ór
)

394 
	`mem£t
(
	`‰om_èl_hdr
(
chûd
), 0, 
size
);

395 
chûd
->
¥›
 = (*)
œbñ
;

396 i‡(!
	`add_chûd
(
∑ª¡
, 
chûd
)) {

397 
	`‰ì‚
(
chûd
);

398  
NULL
;

400 
	`debug_èl
(
∑ª¡
);

401 i‡(
nŸifõrs
)

402 
	`nŸify
(
∑ª¡
, 
TAL_NOTIFY_ADD_CHILD
, 
	`‰om_èl_hdr
(
chûd
));

403  
	`‰om_èl_hdr
(
	`debug_èl
(
chûd
));

404 
	}
}

406 
boﬁ
 
	$adju°_size
(
size_t
 *
size
, size_à
cou¡
)

408 c⁄° 
size_t
 
exåa
 = (
èl_hdr
Ë+ (
Àngth
)*2;

411 i‡(
cou¡
 && 
	`u∆ikñy
(*
size
 * count / *size != count))

412 
ovîÊow
;

414 *
size
 *
cou¡
;

417 i‡(*
size
 + 
exåa
 <Éxtra)

418 
ovîÊow
;

419  
åue
;

420 
ovîÊow
:

421 
	`ˇŒ_îr‹
("allocation size overflow");

422  
Ál£
;

423 
	}
}

425 
size_t
 
	$exåa_f‹_Àngth
(
size_t
 
size
)

427 
size_t
 
exåa
;

428 c⁄° 
size_t
 
Æign
 = 
	`ALIGNOF
(
Àngth
);

431 
exåa
 = ((
size
 + 
Æign
-1) & ~(align-1)) - size;

432 
exåa
 +(
Àngth
);

433  
exåa
;

434 
	}
}

436 *
	$èl_Æloc_¨r_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
size
, size_à
cou¡
, 
boﬁ
 
˛ór
,

437 
boﬁ
 
add_cou¡
, c⁄° *
œbñ
)

439 *
ªt
;

441 i‡(!
	`adju°_size
(&
size
, 
cou¡
))

442  
NULL
;

444 i‡(
add_cou¡
)

445 
size
 +
	`exåa_f‹_Àngth
(size);

447 
ªt
 = 
	`èl_Æloc_
(
˘x
, 
size
, 
˛ór
, 
œbñ
);

448 i‡(
	`u∆ikñy
(!
ªt
))

449  
ªt
;

451 i‡(
add_cou¡
) {

452 
Àngth
 *
Õr›
;

453 
Õr›
 = (
Àngth
 *)((*)
ªt
 + 
size
) - 1;

454 
	`öô_¥›îty
(&
Õr›
->
hdr
, 
	`to_èl_hdr
(
ªt
), 
LENGTH
);

455 
Õr›
->
cou¡
 = count;

457  
ªt
;

458 
	}
}

460 *
	$èl_‰ì
(c⁄° 
èl_t
 *
˘x
)

462 i‡(
˘x
) {

463 
èl_hdr
 *
t
;

464 
ßved_î∫o
 = 
î∫o
;

465 
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

466 i‡(
nŸifõrs
)

467 
	`nŸify
(
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
)->
∑ª¡
,

468 
TAL_NOTIFY_DEL_CHILD
, 
˘x
);

469 
	`li°_dñ
(&
t
->
li°
);

470 
	`dñ_åì
(
t
, 
˘x
);

471 
î∫o
 = 
ßved_î∫o
;

473  
NULL
;

474 
	}
}

476 *
	$èl_°ól_
(c⁄° 
èl_t
 *
√w_∑ª¡
, c⁄°ÅÆ_à*
˘x
)

478 i‡(
˘x
) {

479 
èl_hdr
 *
√w∑r
, *
t
, *
ﬁd_∑ª¡
;

481 
√w∑r
 = 
	`debug_èl
(
	`to_èl_hdr_‹_nuŒ
(
√w_∑ª¡
));

482 
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

485 
	`li°_dñ
(&
t
->
li°
);

486 
ﬁd_∑ª¡
 = 
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
)->
∑ª¡
;

488 i‡(
	`u∆ikñy
(!
	`add_chûd
(
√w∑r
, 
t
))) {

491 i‡(!
	`add_chûd
(
ﬁd_∑ª¡
, 
t
))

492 
	`ab‹t
();

493  
NULL
;

495 
	`debug_èl
(
√w∑r
);

496 i‡(
nŸifõrs
)

497 
	`nŸify
(
t
, 
TAL_NOTIFY_STEAL
, 
√w_∑ª¡
);

499  (*)
˘x
;

500 
	}
}

502 
boﬁ
 
èl_add_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
))

504 
èl_t
 *
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

505  
	`add_nŸifõr_¥›îty
(
t
, 
TAL_NOTIFY_FREE
|
NOTIFY_IS_DESTRUCTOR
,

506 (*)
de°roy
);

507 
	}
}

509 
boﬁ
 
èl_add_nŸifõr_
(c⁄° 
èl_t
 *
˘x
, 
èl_nŸify_ty≥
 
ty≥s
,

510 (*
ˇŒback
)(
èl_t
 *, 
èl_nŸify_ty≥
, *))

512 
èl_t
 *
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

513 
nŸifõr
 *
n
;

515 
	`as£π
(
ty≥s
);

516 
	`as£π
((
ty≥s
 & ~(
TAL_NOTIFY_FREE
 | 
TAL_NOTIFY_STEAL
 | 
TAL_NOTIFY_MOVE


517 | 
TAL_NOTIFY_RESIZE
 | 
TAL_NOTIFY_RENAME


518 | 
TAL_NOTIFY_ADD_CHILD
 | 
TAL_NOTIFY_DEL_CHILD


519 | 
TAL_NOTIFY_ADD_NOTIFIER


520 | 
TAL_NOTIFY_DEL_NOTIFIER
)) == 0);

523 
n
 = 
	`add_nŸifõr_¥›îty
(
t
, 0, 
ˇŒback
);

524 i‡(
	`u∆ikñy
(!
n
))

525  
Ál£
;

527 i‡(
nŸifõrs
)

528 
	`nŸify
(
t
, 
TAL_NOTIFY_ADD_NOTIFIER
, 
ˇŒback
);

530 
n
->
ty≥s
 =Åypes;

531 i‡(
ty≥s
 !
TAL_NOTIFY_FREE
)

532 
nŸifõrs
++;

533  
åue
;

534 
	}
}

536 
boﬁ
 
èl_dñ_nŸifõr_
(c⁄° 
èl_t
 *
˘x
,

537 (*
ˇŒback
)(
èl_t
 *, 
èl_nŸify_ty≥
, *))

539 
èl_hdr
 *
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

540 
èl_nŸify_ty≥
 
ty≥s
;

542 
ty≥s
 = 
	`dñ_nŸifõr_¥›îty
(
t
, 
ˇŒback
);

543 i‡(
ty≥s
) {

544 
	`nŸify
(
t
, 
TAL_NOTIFY_DEL_NOTIFIER
, 
ˇŒback
);

545 i‡(
ty≥s
 !
TAL_NOTIFY_FREE
)

546 
nŸifõrs
--;

547  
åue
;

549  
Ál£
;

550 
	}
}

552 
boﬁ
 
èl_dñ_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
))

554  
	`èl_dñ_nŸifõr_
(
˘x
, (*)
de°roy
);

555 
	}
}

557 
boﬁ
 
	$èl_£t_«me_
(
èl_t
 *
˘x
, c⁄° *
«me
, 
boﬁ
 
lôîÆ
)

559 
èl_hdr
 *
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

560 
¥›_hdr
 **
¥›
 = 
	`föd_¥›îty_±r
(
t
, 
NAME
);

563 i‡(
¥›
) {

564 
«me
 *«mê(«mê*)*
¥›
;

565 i‡(
	`is_lôîÆ
(&
«me
->
hdr
))

566 *
¥›
 = 
NULL
;

568 *
¥›
 = 
«me
->
hdr
.
√xt
;

569 
	`‰ì‚
(
«me
);

573 i‡(
lôîÆ
 && 
«me
[0]) {

574 
¥›_hdr
 **
p
;

577 
p
 = &
t
->
¥›
; *∞&& !
	`is_lôîÆ
(*p);Ö = &(*p)->
√xt
);

578 *
p
 = (
¥›_hdr
 *)
«me
;

579 } i‡(!
	`add_«me_¥›îty
(
t
, 
«me
))

580  
Ál£
;

582 
	`debug_èl
(
t
);

583 i‡(
nŸifõrs
)

584 
	`nŸify
(
t
, 
TAL_NOTIFY_RENAME
, 
«me
);

585  
åue
;

586 
	}
}

588 c⁄° *
	$èl_«me
(c⁄° 
èl_t
 *
t
)

590 
«me
 *
n
;

592 
n
 = 
	`föd_¥›îty
(
	`debug_èl
(
	`to_èl_hdr
(
t
)), 
NAME
);

593 i‡(!
n
)

594  
NULL
;

596 i‡(
	`is_lôîÆ
(&
n
->
hdr
))

597  (c⁄° *)
n
;

598  
n
->
«me
;

599 
	}
}

601 
size_t
 
	$èl_cou¡
(c⁄° 
èl_t
 *
±r
)

603 
Àngth
 *
l
;

605 
l
 = 
	`föd_¥›îty
(
	`debug_èl
(
	`to_èl_hdr
(
±r
)), 
LENGTH
);

606 i‡(!
l
)

608  
l
->
cou¡
;

609 
	}
}

612 
èl_hdr
 *
	$fú°_chûd
(
èl_hdr
 *
∑ª¡
)

614 
chûdªn
 *
chûd
;

616 
chûd
 = 
	`föd_¥›îty
(
∑ª¡
, 
CHILDREN
);

617 i‡(!
chûd
)

618  
NULL
;

620  
	`li°_t›
(&
chûd
->
chûdªn
, 
èl_hdr
, 
li°
);

621 
	}
}

623 
èl_t
 *
	$èl_fú°
(c⁄° 
èl_t
 *
roŸ
)

625 
èl_hdr
 *
c
, *
t
 = 
	`debug_èl
(
	`to_èl_hdr_‹_nuŒ
(
roŸ
));

627 
c
 = 
	`fú°_chûd
(
t
);

628 i‡(!
c
)

629  
NULL
;

630  
	`‰om_èl_hdr
(
c
);

631 
	}
}

633 
èl_t
 *
	$èl_√xt
(c⁄° 
èl_t
 *
roŸ
, c⁄°ÅÆ_à*
¥ev
)

635 
èl_hdr
 *
c
, *
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
¥ev
)), *
t›
;

638 
c
 = 
	`fú°_chûd
(
t
);

639 i‡(
c
)

640  
	`‰om_èl_hdr
(
c
);

642 
t›
 = 
	`to_èl_hdr_‹_nuŒ
(
roŸ
);

644 
èl_hdr
 *
√xt
;

645 
li°_node
 *
íd
;

647 
íd
 = &
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
)->
chûdªn
.
n
;

649 
√xt
 = 
	`li°_íåy
(
t
->
li°
.√xt, 
èl_hdr
,Üist);

650 i‡(&
√xt
->
li°
 !
íd
)

651  
	`‰om_èl_hdr
(
√xt
);

654 
t
 = 
	`ign‹e_de°royög_bô
—->
∑ª¡_chûd
)->
∑ª¡
;

655 } 
t
 !
t›
);

657  
NULL
;

658 
	}
}

660 
èl_t
 *
	$èl_∑ª¡
(c⁄° 
èl_t
 *
˘x
)

662 
èl_hdr
 *
t
;

664 i‡(!
˘x
)

665  
NULL
;

667 
t
 = 
	`debug_èl
(
	`to_èl_hdr
(
˘x
));

668 i‡(
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
)->
∑ª¡
 =&
nuŒ_∑ª¡
.
hdr
)

669  
NULL
;

670  
	`‰om_èl_hdr
(
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
)->
∑ª¡
);

671 
	}
}

673 
boﬁ
 
	$èl_ªsize_
(
èl_t
 **
˘xp
, 
size_t
 
size
, size_à
cou¡
, 
boﬁ
 
˛ór
)

675 
èl_hdr
 *
ﬁd_t
, *
t
;

676 
chûdªn
 *
chûd
;

677 
¥›_hdr
 **
À≈
;

678 
Àngth
 
Àn
;

679 
size_t
 
exåa
 = 0, 
ñemsize
 = 
size
;

681 
ﬁd_t
 = 
	`debug_èl
(
	`to_èl_hdr
(*
˘xp
));

683 i‡(!
	`adju°_size
(&
size
, 
cou¡
))

684  
Ál£
;

686 
À≈
 = 
	`föd_¥›îty_±r
(
ﬁd_t
, 
LENGTH
);

687 i‡(
À≈
) {

689 
Àn
 = *(
Àngth
 *)*
À≈
;

690 
exåa
 = 
	`exåa_f‹_Àngth
(
size
);

692 
	`as£π
(!
˛ór
);

694 
t
 = 
	`ªsize‚
(
ﬁd_t
, (
èl_hdr
Ë+ 
size
 + 
exåa
);

695 i‡(!
t
) {

696 
	`ˇŒ_îr‹
("Reallocation failure");

697  
Ál£
;

701 i‡(
À≈
) {

702 
Àngth
 *
√w_Àn
;

705 i‡(
˛ór
 && 
cou¡
 > 
Àn
.count) {

706 *
ﬁd_íd
 = (*)(
t
 + 1Ë+ 
Àn
.
cou¡
 * 
ñemsize
;

707 
	`mem£t
(
ﬁd_íd
, 0, 
ñemsize
 * (
cou¡
 - 
Àn
.count));

710 
√w_Àn
 = (
Àngth
 *)((*)(
t
 + 1Ë+ 
size
);

711 
Àn
.
cou¡
 = count;

712 *
√w_Àn
 = 
Àn
;

715 i‡(
À≈
 =&
ﬁd_t
->
¥›
)

716 
t
->
¥›
 = &
√w_Àn
->
hdr
;

718 *
À≈
 = &
√w_Àn
->
hdr
;

721 
	`upd©e_bounds
(
t
, (
èl_hdr
Ë+ 
size
 + 
exåa
);

724 i‡(
t
 !
ﬁd_t
) {

726 
t
->
li°
.
√xt
->
¥ev
 =Å->list.prev->next = &t->list;

729 
chûd
 = 
	`föd_¥›îty
(
t
, 
CHILDREN
);

730 i‡(
chûd
) {

731 
	`as£π
(
chûd
->
∑ª¡
 =
ﬁd_t
);

732 
chûd
->
∑ª¡
 = 
t
;

734 *
˘xp
 = 
	`‰om_èl_hdr
(
	`debug_èl
(
t
));

735 i‡(
nŸifõrs
)

736 
	`nŸify
(
t
, 
TAL_NOTIFY_MOVE
, 
	`‰om_èl_hdr
(
ﬁd_t
));

738 i‡(
nŸifõrs
)

739 
	`nŸify
(
t
, 
TAL_NOTIFY_RESIZE
, (*)
size
);

741  
åue
;

742 
	}
}

744 
boﬁ
 
	$èl_ex∑nd_
(
èl_t
 **
˘xp
, c⁄° *
§c
, 
size_t
 
size
, size_à
cou¡
)

746 
Àngth
 *
l
;

747 
size_t
 
ﬁd_cou¡
;

748 
boﬁ
 
ªt
 = 
Ál£
;

750 
l
 = 
	`föd_¥›îty
(
	`debug_èl
(
	`to_èl_hdr
(*
˘xp
)), 
LENGTH
);

751 
ﬁd_cou¡
 = 
l
->
cou¡
;

754 i‡(
ﬁd_cou¡
 + 
cou¡
 < count) {

755 
	`ˇŒ_îr‹
("dup size overflow");

756 
out
;

760 
	`as£π
(
§c
 < *
˘xp


761 || (*)
§c
 >(*)(*
˘xp
Ë+ (
size
 * 
ﬁd_cou¡
));

763 i‡(!
	`èl_ªsize_
(
˘xp
, 
size
, 
ﬁd_cou¡
 + 
cou¡
, 
Ál£
))

764 
out
;

766 
	`mem˝y
((*)*
˘xp
 + 
size
 * 
ﬁd_cou¡
, 
§c
, 
cou¡
 * size);

767 
ªt
 = 
åue
;

769 
out
:

770 i‡(
	`èkí
(
§c
))

771 
	`èl_‰ì
(
§c
);

772  
ªt
;

773 
	}
}

775 *
	$èl_dup_
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
, 
size_t
 
size
,

776 
size_t
 
n
, size_à
exåa
, 
boﬁ
 
add_cou¡
,

777 c⁄° *
œbñ
)

779 *
ªt
;

780 
size_t
 
nbyãs
 = 
size
;

782 i‡(!
	`adju°_size
(&
nbyãs
, 
n
)) {

783 i‡(
	`èkí
(
p
))

784 
	`èl_‰ì
(
p
);

785  
NULL
;

789 i‡(
n
 + 
exåa
 <Ç) {

790 
	`ˇŒ_îr‹
("dup size overflow");

791 i‡(
	`èkí
(
p
))

792 
	`èl_‰ì
(
p
);

793  
NULL
;

796 i‡(
	`èkí
(
p
)) {

797 i‡(
	`u∆ikñy
(!
p
))

798  
NULL
;

799 i‡(
	`u∆ikñy
(!
	`èl_ªsize_
((**)&
p
, 
size
, 
n
 + 
exåa
, 
Ál£
)))

800  
	`èl_‰ì
(
p
);

801 i‡(
	`u∆ikñy
(!
	`èl_°ól
(
˘x
, 
p
)))

802  
	`èl_‰ì
(
p
);

803  (*)
p
;

806 
ªt
 = 
	`èl_Æloc_¨r_
(
˘x
, 
size
, 
n
 + 
exåa
, 
Ál£
, 
add_cou¡
, 
œbñ
);

807 i‡(
ªt
)

808 
	`mem˝y
(
ªt
, 
p
, 
nbyãs
);

809  
ªt
;

810 
	}
}

812 
èl_£t_backíd
(*(*
Æloc_‚
)(
size_t
 
size
),

813 *(*
ªsize_‚
)(*, 
size_t
 
size
),

814 (*
‰ì_‚
)(*),

815 (*
îr‹_‚
)(c⁄° *
msg
))

817 i‡(
Æloc_‚
)

818 
Æloc‚
 = 
Æloc_‚
;

819 i‡(
ªsize_‚
)

820 
ªsize‚
 = 
ªsize_‚
;

821 i‡(
‰ì_‚
)

822 
‰ì‚
 = 
‰ì_‚
;

823 i‡(
îr‹_‚
)

824 
îr‹‚
 = 
îr‹_‚
;

825 
	}
}

827 #ifde‡
CCAN_TAL_DEBUG


828 
	$dump_node
(
ödít
, c⁄° 
èl_hdr
 *
t
)

830 
i
;

831 c⁄° 
¥›_hdr
 *
p
;

833 
i
 = 0; i < 
ödít
; i++)

834 
	`¥ötf
(" ");

835 
	`¥ötf
("%p", 
t
);

836 
p
 = 
t
->
¥›
;Ö;Ö =Ö->
√xt
) {

837 
chûdªn
 *
c
;

838 
«me
 *
n
;

839 
nŸifõr
 *
no
;

840 
Àngth
 *
l
;

841 i‡(
	`is_lôîÆ
(
p
)) {

842 
	`¥ötf
(" \"%s\"", (c⁄° *)
p
);

845 
p
->
ty≥
) {

846 
CHILDREN
:

847 
c
 = (
chûdªn
 *)
p
;

848 
	`¥ötf
(" CHILDREN(%p):parent=%p,children={%p,%p}\n",

849 
p
, 
c
->
∑ª¡
,

850 
c
->
chûdªn
.
n
.
¥ev
, c->chûdªn.n.
√xt
);

852 
NAME
:

853 
n
 = (
«me
 *)
p
;

854 
	`¥ötf
(" NAME(%p):%s", 
p
, 
n
->
«me
);

856 
NOTIFIER
:

857 
no
 = (
nŸifõr
 *)
p
;

858 
	`¥ötf
(" NOTIFIER(%p):‚=%p", 
p
, 
no
->
u
.
nŸify‚
);

860 
LENGTH
:

861 
l
 = (
Àngth
 *)
p
;

862 
	`¥ötf
(" LENGTH(%p):cou¡=%zu", 
p
, 
l
->
cou¡
);

865 
	`¥ötf
(" **UNKNOWN(%p):%i**", 
p
,Ö->
ty≥
);

868 
	`¥ötf
("\n");

869 
	}
}

871 
	$èl_dump_
(
Àvñ
, c⁄° 
èl_hdr
 *
t
)

873 
chûdªn
 *children;

875 
	`dump_node
(
Àvñ
, 
t
);

877 
chûdªn
 = 
	`föd_¥›îty
(
t
, 
CHILDREN
);

878 i‡(
chûdªn
) {

879 
èl_hdr
 *
i
;

881 
	`li°_f‹_óch
(&
chûdªn
->chûdªn, 
i
, 
li°
)

882 
	`èl_dump_
(
Àvñ
 + 1, 
i
);

884 
	}
}

886 
	$èl_dump
()

888 
	`èl_dump_
(0, &
nuŒ_∑ª¡
.
hdr
);

889 
	}
}

892 #i‚de‡
NDEBUG


893 
boﬁ
 
	$check_îr
(
èl_hdr
 *
t
, c⁄° *
îr‹°r
,

894 c⁄° *
îrmsg
)

896 i‡(
îr‹°r
) {

898 
msg
[
	`°æí
(
îr‹°r
Ë+ 20 + såÀn(
îrmsg
) + 1];

899 
	`•rötf
(
msg
, "%s:%∞%s", 
îr‹°r
, 
	`‰om_èl_hdr
(
t
), 
îrmsg
);

900 
	`ˇŒ_îr‹
(
msg
);

902  
Ál£
;

903 
	}
}

905 
boﬁ
 
	$check_node
(
chûdªn
 *
∑ª¡_chûd
,

906 
èl_hdr
 *
t
, c⁄° *
îr‹°r
)

908 
¥›_hdr
 *
p
;

909 
«me
 *«mê
NULL
;

910 
chûdªn
 *chûdª¿
NULL
;

911 
Àngth
 *Àngth = 
NULL
;

913 i‡(!
	`ö_bounds
(
t
))

914  
	`check_îr
(
t
, 
îr‹°r
, "invalidÖointer");

916 i‡(
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
) !=Öarent_child)

917  
	`check_îr
(
t
, 
îr‹°r
, "incorrectÖarent");

919 
p
 = 
t
->
¥›
;Ö;Ö =Ö->
√xt
) {

920 i‡(
	`is_lôîÆ
(
p
)) {

921 i‡(
«me
)

922  
	`check_îr
(
t
, 
îr‹°r
,

924 
«me
 = («mê*)
p
;

927 i‡(!
	`ö_bounds
(
p
))

928  
	`check_îr
(
t
, 
îr‹°r
,

931 
p
->
ty≥
) {

932 
CHILDREN
:

933 i‡(
chûdªn
)

934  
	`check_îr
(
t
, 
îr‹°r
,

936 
chûdªn
 = (chûdª¿*)
p
;

938 
LENGTH
:

939 i‡(
Àngth
)

940  
	`check_îr
(
t
, 
îr‹°r
,

942 
Àngth
 = (Àngth *)
p
;

944 
NOTIFIER
:

946 
NAME
:

947 i‡(
«me
)

948  
	`check_îr
(
t
, 
îr‹°r
,

950 
«me
 = («mê*)
p
;

953  
	`check_îr
(
t
, 
îr‹°r
, "has unknownÖroperty");

956 i‡(
chûdªn
) {

957 
èl_hdr
 *
i
;

959 i‡(!
	`li°_check
(&
chûdªn
->chûdªn, 
îr‹°r
))

960  
Ál£
;

961 
	`li°_f‹_óch
(&
chûdªn
->chûdªn, 
i
, 
li°
) {

962 i‡(!
	`check_node
(
chûdªn
, 
i
, 
îr‹°r
))

963  
Ál£
;

966  
åue
;

967 
	}
}

969 
boﬁ
 
	$èl_check
(c⁄° 
èl_t
 *
˘x
, c⁄° *
îr‹°r
)

971 
èl_hdr
 *
t
 = 
	`to_èl_hdr_‹_nuŒ
(
˘x
);

973  
	`check_node
(
	`ign‹e_de°royög_bô
(
t
->
∑ª¡_chûd
),Å, 
îr‹°r
);

974 
	}
}

976 
boﬁ
 
	$èl_check
(c⁄° 
èl_t
 *
˘x
, c⁄° *
îr‹°r
)

978  
åue
;

979 
	}
}

	@ccan/ccan/tal/tal.h

2 #i‚de‡
CCAN_TAL_H


3 
	#CCAN_TAL_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/compûî/compûî.h
>

6 
	~<cˇn/likñy/likñy.h
>

7 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

8 
	~<cˇn/°r/°r.h
>

9 
	~<°dlib.h
>

10 
	~<°dboﬁ.h
>

11 
	~<°d¨g.h
>

19 
	tèl_t
;

34 
	#èl
(
˘x
, 
ty≥
) \

35 ((
ty≥
 *)
	`èl_Æloc_
((
˘x
), —y≥), 
Ál£
, 
	`TAL_LABEL
—y≥, "")))

	)

48 
	#èlz
(
˘x
, 
ty≥
) \

49 ((
ty≥
 *)
	`èl_Æloc_
((
˘x
), —y≥), 
åue
, 
	`TAL_LABEL
—y≥, "")))

	)

64 *
èl_‰ì
(c⁄° 
èl_t
 *
p
);

80 
	#èl_¨r
(
˘x
, 
ty≥
, 
cou¡
) \

81 ((
ty≥
 *)
	`èl_Æloc_¨r_
((
˘x
), —y≥), (
cou¡
), 
Ál£
, \

82 
åue
, 
	`TAL_LABEL
(
ty≥
, "[]")))

	)

97 
	#èl_¨rz
(
˘x
, 
ty≥
, 
cou¡
) \

98 ((
ty≥
 *)
	`èl_Æloc_¨r_
((
˘x
), —y≥), (
cou¡
), 
åue
, \

99 
åue
, 
	`TAL_LABEL
(
ty≥
, "[]")))

	)

112 
	#èl_ªsize
(
p
, 
cou¡
) \

113 
	`èl_ªsize_
((**)(
p
), **’), (
cou¡
), 
Ál£
)

	)

127 
	#èl_ªsizez
(
p
, 
cou¡
) \

128 
	`èl_ªsize_
((**)(
p
), **’), (
cou¡
), 
åue
)

	)

138 #i‡
HAVE_STATEMENT_EXPR


140 
	#èl_°ól
(
˘x
, 
±r
) \

141 ({ (
	`èl_ty≥of
(
±r
Ë
	`èl_°ól_
((
˘x
),’å))); })

	)

143 
	#èl_°ól
(
˘x
, 
±r
) \

144 (
	`èl_ty≥of
(
±r
Ë
	`èl_°ól_
((
˘x
),’å)))

	)

157 
	#èl_add_de°ru˘‹
(
±r
, 
fun˘i⁄
) \

158 
	`èl_add_de°ru˘‹_
((
±r
), 
	`ty≥ß„_cb
(, *, (
fun˘i⁄
), (±r)))

	)

168 
	#èl_dñ_de°ru˘‹
(
±r
, 
fun˘i⁄
) \

169 
	`èl_dñ_de°ru˘‹_
((
±r
), 
	`ty≥ß„_cb
(, *, (
fun˘i⁄
), (±r)))

	)

171 
	eèl_nŸify_ty≥
 {

172 
	mTAL_NOTIFY_FREE
 = 1,

173 
	mTAL_NOTIFY_STEAL
 = 2,

174 
	mTAL_NOTIFY_MOVE
 = 4,

175 
	mTAL_NOTIFY_RESIZE
 = 8,

176 
	mTAL_NOTIFY_RENAME
 = 16,

177 
	mTAL_NOTIFY_ADD_CHILD
 = 32,

178 
	mTAL_NOTIFY_DEL_CHILD
 = 64,

179 
	mTAL_NOTIFY_ADD_NOTIFIER
 = 128,

180 
	mTAL_NOTIFY_DEL_NOTIFIER
 = 256

220 
	#èl_add_nŸifõr
(
±r
, 
ty≥s
, 
ˇŒback
) \

221 
	`èl_add_nŸifõr_
((
±r
), (
ty≥s
), \

222 
	`ty≥ß„_cb_po°¨gs
(, 
èl_t
 *, (
ˇŒback
), \

223 (
±r
), \

224 
èl_nŸify_ty≥
, *))

	)

231 
	#èl_dñ_nŸifõr
(
±r
, 
ˇŒback
) \

232 
	`èl_dñ_nŸifõr_
((
±r
), \

233 
	`ty≥ß„_cb_po°¨gs
(, *, (
ˇŒback
), \

234 (
±r
), \

235 
èl_nŸify_ty≥
, *))

	)

244 
	#èl_£t_«me
(
±r
, 
«me
) \

245 
	`èl_£t_«me_
((
±r
), (
«me
), 
	`TAL_IS_LITERAL
“ame))

	)

253 c⁄° *
èl_«me
(c⁄° 
èl_t
 *
±r
);

262 
size_t
 
èl_cou¡
(c⁄° 
èl_t
 *
±r
);

270 
èl_t
 *
èl_fú°
(c⁄°ÅÆ_à*
roŸ
);

281 
èl_t
 *
èl_√xt
(c⁄°ÅÆ_à*
roŸ
, c⁄°ÅÆ_à*
¥ev
);

289 
èl_t
 *
èl_∑ª¡
(c⁄°ÅÆ_à*
˘x
);

299 
	#èl_dup
(
˘x
, 
ty≥
, 
p
, 
n
, 
exåa
) \

300 ((
ty≥
 *)
	`èl_dup_
((
˘x
), 
	`èl_ty≥chk_
(
p
,Åype *), \

301 (
ty≥
), (
n
), (
exåa
), \

302 
åue
, 
	`TAL_LABEL
(
ty≥
, "[]")))

	)

318 
èl_£t_backíd
(*(*
Æloc_‚
)(
size_t
 
size
),

319 *(*
ªsize_‚
)(*, 
size_t
 
size
),

320 (*
‰ì_‚
)(*),

321 (*
îr‹_‚
)(c⁄° *
msg
));

341 
	#èl_ex∑nd
(
a1p
, 
a2
, 
num2
) \

342 
	`èl_ex∑nd_
((**)(
a1p
), (
a2
), **(a1p), \

343 (
num2
Ë+ 0*(*(
a1p
Ë=(
a2
)))

	)

354 
	`èl_˛ónup
();

366 
boﬁ
 
	`èl_check
(c⁄° 
èl_t
 *
˘x
, c⁄° *
îr‹°r
);

368 #ifde‡
CCAN_TAL_DEBUG


375 
	`èl_dump
();

379 #i‚de‡
TAL_LABEL


380 #ifde‡
CCAN_TAL_NO_LABELS


381 
	#TAL_LABEL
(
ty≥
, 
¨r
Ë
NULL


	)

383 #ifde‡
CCAN_TAL_DEBUG


384 
	#TAL_LABEL
(
ty≥
, 
¨r
) \

385 
__FILE__
 ":" 
	`°rögify
(
__LINE__
Ë":" såögify(
ty≥
Ë
¨r


	)

387 
	#TAL_LABEL
(
ty≥
, 
¨r
Ë
	`°rögify
—y≥Ë
	)
arr

392 #i‡
HAVE_BUILTIN_CONSTANT_P


393 
	#TAL_IS_LITERAL
(
°r
Ë
	`__buûtö_c⁄°™t_p
(°r)

	)

395 
	#TAL_IS_LITERAL
(
°r
Ë((&*(°r)Ë!(*))

	)

398 
boﬁ
 
	`èl_£t_«me_
(
èl_t
 *
˘x
, c⁄° *
«me
, boﬁ 
lôîÆ
);

400 #i‡
HAVE_TYPEOF


401 
	#èl_ty≥of
(
±r
Ë(
	`__ty≥of__
’å))

	)

402 #i‡
HAVE_STATEMENT_EXPR


405 
	#èl_ty≥chk_
(
±r
, 
±y≥
Ë({ 
	`__ty≥of__
(’å)+0Ë
_p
 = (±y≥)’å); _p; 
	}
})

	)

407 
	#èl_ty≥chk_
(
±r
, 
±y≥
Ë’å)

	)

410 
	#èl_ty≥of
(
±r
)

	)

411 
	#èl_ty≥chk_
(
±r
, 
±y≥
Ë’å)

	)

414 *
èl_Æloc_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
byãs
, 
boﬁ
 
˛ór
, c⁄° *
œbñ
);

415 *
èl_Æloc_¨r_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
byãs
, size_à
cou¡
, 
boﬁ
 
˛ór
,

416 
boﬁ
 
add_cou¡
, c⁄° *
œbñ
);

418 *
èl_dup_
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
, 
size_t
 
size
,

419 
size_t
 
n
, size_à
exåa
, 
boﬁ
 
add_cou¡
,

420 c⁄° *
œbñ
);

422 
èl_t
 *
èl_°ól_
(c⁄°ÅÆ_à*
√w_∑ª¡
, c⁄°ÅÆ_à*
t
);

424 
boﬁ
 
èl_ªsize_
(
èl_t
 **
˘xp
, 
size_t
 
size
, size_à
cou¡
, boﬁ 
˛ór
);

425 
boﬁ
 
èl_ex∑nd_
(
èl_t
 **
˘xp
, c⁄° *
§c
, 
size_t
 
size
, size_à
cou¡
);

427 
boﬁ
 
èl_add_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
));

428 
boﬁ
 
	`èl_dñ_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
));

430 
boﬁ
 
	`èl_add_nŸifõr_
(c⁄° 
èl_t
 *
˘x
, 
èl_nŸify_ty≥
 
ty≥s
,

431 (*
nŸify
)(
èl_t
 *
˘x
, 
èl_nŸify_ty≥
,

432 *
öfo
));

433 
boﬁ
 
	`èl_dñ_nŸifõr_
(c⁄° 
èl_t
 *
˘x
,

434 (*
nŸify
)(
èl_t
 *
˘x
, 
èl_nŸify_ty≥
,

435 *
öfo
));

	@ccan/ccan/tal/talloc/talloc.c

2 
	~<cˇn/èl/èŒoc/èŒoc.h
>

3 
	~<cˇn/èke/èke.h
>

4 
	~<î∫o.h
>

5 
	~<as£π.h
>

7 (*
îr‹‚
)(c⁄° *
msg
Ë(*)
ab‹t
;

9 
COLD
 
	$ˇŒ_îr‹
(c⁄° *
msg
)

11 
	`îr‹‚
(
msg
);

12 
	}
}

14 *
	$îr‹_⁄_nuŒ
(*
p
, c⁄° *
msg
)

16 i‡(!
p
)

17 
	`ˇŒ_îr‹
(
msg
);

18  
p
;

19 
	}
}

21 *
	$èl_èŒoc_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
byãs
, 
boﬁ
 
˛ór
,

22 c⁄° *
œbñ
)

24 *
ªt
;

26 i‡(
˛ór
)

27 
ªt
 = 
	`_èŒoc_zîo
(
˘x
, 
byãs
, 
œbñ
);

29 
ªt
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 
byãs
, 
œbñ
);

31  
	`îr‹_⁄_nuŒ
(
ªt
, "allocation failure");

32 
	}
}

34 *
	$èl_èŒoc_¨r_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
byãs
, size_à
cou¡
, 
boﬁ
 
˛ór
,

35 c⁄° *
œbñ
)

37 *
ªt
;

39 i‡(
˛ór
)

40 
ªt
 = 
	`_èŒoc_zîo_¨øy
(
˘x
, 
byãs
, 
cou¡
, 
œbñ
);

42 
ªt
 = 
	`_èŒoc_¨øy
(
˘x
, 
byãs
, 
cou¡
, 
œbñ
);

44  
	`îr‹_⁄_nuŒ
(
ªt
, "arrayállocation failure");

45 
	}
}

47 *
	$èl_èŒoc_‰ì_
(c⁄° 
èl_t
 *
˘x
)

49 
ßved_î∫o
 = 
î∫o
;

50 
	`èŒoc_‰ì
((*)
˘x
);

51 
î∫o
 = 
ßved_î∫o
;

52  
NULL
;

53 
	}
}

55 
boﬁ
 
	$èl_èŒoc_£t_«me_
(
èl_t
 *
˘x
, c⁄° *
«me
, 
boﬁ
 
lôîÆ
)

57 i‡(!
lôîÆ
) {

58 
«me
 = 
	`èŒoc_°rdup
(
˘x
,Çame);

59 i‡(!
«me
) {

60 
	`ˇŒ_îr‹
("set_nameállocation failure");

61  
Ál£
;

64 
	`èŒoc_£t_«me_c⁄°
(
˘x
, 
«me
);

65  
åue
;

66 
	}
}

68 c⁄° *
	$èl_èŒoc_«me_
(c⁄° 
èl_t
 *
˘x
)

70 c⁄° *
p
 = 
	`èŒoc_gë_«me
(
˘x
);

71 i‡(
p
 && 
	`u∆ikñy
(
	`°rcmp
(p, "UNNAMED") == 0))

72 
p
 = 
NULL
;

73  
p
;

74 
	}
}

76 
boﬁ
 
	$adju°_size
(
size_t
 *
size
, size_à
cou¡
)

79 i‡(
cou¡
 && 
	`u∆ikñy
(*
size
 * count / *size != count))

80 
ovîÊow
;

82 *
size
 *
cou¡
;

85 i‡(*
size
 + 1024 < 1024)

86 
ovîÊow
;

87  
åue
;

88 
ovîÊow
:

89 
	`ˇŒ_îr‹
("allocation size overflow");

90  
Ál£
;

91 
	}
}

93 *
	$èl_èŒoc_dup_
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
, 
size_t
 
size
,

94 
size_t
 
n
, size_à
exåa
, c⁄° *
œbñ
)

96 *
ªt
;

97 
size_t
 
nbyãs
 = 
size
;

99 i‡(!
	`adju°_size
(&
nbyãs
, 
n
)) {

100 i‡(
	`èkí
(
p
))

101 
	`èl_‰ì
(
p
);

102  
NULL
;

106 i‡(
n
 + 
exåa
 <Ç) {

107 
	`ˇŒ_îr‹
("dup size overflow");

108 i‡(
	`èkí
(
p
))

109 
	`èl_‰ì
(
p
);

110  
NULL
;

113 i‡(
	`èkí
(
p
)) {

114 i‡(
	`u∆ikñy
(!
p
))

115  
NULL
;

116 i‡(
	`u∆ikñy
(!
	`èl_èŒoc_ªsize_
((**)&
p
, 
size
, 
n
 + 
exåa
)))

117  
	`èl_‰ì
(
p
);

118 i‡(
	`u∆ikñy
(!
	`èl_°ól
(
˘x
, 
p
)))

119  
	`èl_‰ì
(
p
);

120  (*)
p
;

123 
ªt
 = 
	`èl_èŒoc_¨r_
(
˘x
, 
size
, 
n
 + 
exåa
, 
Ál£
, 
œbñ
);

124 i‡(
ªt
)

125 
	`mem˝y
(
ªt
, 
p
, 
nbyãs
);

126  
ªt
;

127 
	}
}

129 
boﬁ
 
	$èl_èŒoc_ªsize_
(
èl_t
 **
˘xp
, 
size_t
 
size
, size_à
cou¡
)

131 
èl_t
 *
√wp
;

133 i‡(
	`u∆ikñy
(
cou¡
 == 0)) {

135 
√wp
 = 
	`èŒoc_size
(
	`èŒoc_∑ª¡
(*
˘xp
), 0);

136 i‡(!
√wp
) {

137 
	`ˇŒ_îr‹
("Resize failure");

138  
Ál£
;

140 
	`èŒoc_‰ì
(*
˘xp
);

141 *
˘xp
 = 
√wp
;

142  
åue
;

144 
√wp
 = 
	`_èŒoc_ªÆloc_¨øy
(
NULL
, *
˘xp
, 
size
, 
cou¡
, NULL);

145 i‡(!
√wp
) {

146 
	`ˇŒ_îr‹
("Resize failure");

147  
Ál£
;

149 *
˘xp
 = 
√wp
;

150  
åue
;

151 
	}
}

153 
boﬁ
 
	$èl_èŒoc_ex∑nd_
(
èl_t
 **
˘xp
, c⁄° *
§c
, 
size_t
 
size
, size_à
cou¡
)

155 
boﬁ
 
ªt
 = 
Ál£
;

156 
size_t
 
ﬁd_cou¡
 = 
	`èŒoc_gë_size
(*
˘xp
Ë/ 
size
;

159 i‡(
ﬁd_cou¡
 + 
cou¡
 < count) {

160 
	`ˇŒ_îr‹
("dup size overflow");

161 
out
;

165 
	`as£π
(
§c
 < *
˘xp


166 || (*)
§c
 >(*)(*
˘xp
Ë+ (
size
 * 
ﬁd_cou¡
));

168 i‡(!
	`èl_èŒoc_ªsize_
(
˘xp
, 
size
, 
ﬁd_cou¡
 + 
cou¡
))

169 
out
;

171 
	`mem˝y
((*)*
˘xp
 + 
size
 * 
ﬁd_cou¡
, 
§c
, 
cou¡
 * size);

172 
ªt
 = 
åue
;

174 
out
:

175 i‡(
	`èkí
(
§c
))

176 
	`èl_‰ì
(
§c
);

177  
ªt
;

178 
	}
}

181 
	#HTABLE_BITS
 10

	)

182 
	sde°ru˘‹
 {

183 
de°ru˘‹
 *
	m√xt
;

184 c⁄° 
èl_t
 *
	m˘x
;

185 (*
	mde°roy
)(*
	mme
);

187 
de°ru˘‹
 *
	gde°r_hash
[1 << 
HTABLE_BITS
];

189 
	$hash_±r
(c⁄° *
p
)

191 
h
 = ()
p
 / (*);

193  (
h
 ^ (h >> 
HTABLE_BITS
)) & ((1 << HTABLE_BITS) - 1);

194 
	}
}

196 
	$èl_èŒoc_de°roy
(c⁄° 
èl_t
 *
˘x
)

198 
de°ru˘‹
 **
d
 = &
de°r_hash
[
	`hash_±r
(
˘x
)];

199 *
d
) {

200 i‡((*
d
)->
˘x
 == ctx) {

201 
de°ru˘‹
 *
this
 = *
d
;

202 
this
->
	`de°roy
((*)
˘x
);

203 *
d
 = 
this
->
√xt
;

204 
	`èŒoc_‰ì
(
this
);

208 
	}
}

210 
boﬁ
 
èl_èŒoc_add_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
))

212 
de°ru˘‹
 *
d
 = 
	`èŒoc
(
˘x
, destructor);

213 i‡(!
d
)

214  
Ál£
;

216 
d
->
√xt
 = 
de°r_hash
[
	`hash_±r
(
˘x
)];

217 
d
->
˘x
 = ctx;

218 
d
->
de°roy
 = destroy;

219 
de°r_hash
[
	`hash_±r
(
˘x
)] = 
d
;

220 
	`èŒoc_£t_de°ru˘‹
(
˘x
, 
èl_èŒoc_de°roy
);

221  
åue
;

222 
	}
}

224 
boﬁ
 
èl_èŒoc_dñ_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
))

226 
de°ru˘‹
 **
d
 = &
de°r_hash
[
	`hash_±r
(
˘x
)];

228 *
d
) {

229 i‡((*
d
)->
˘x
 =˘x && (*d)->
de°roy
 == destroy) {

230 
de°ru˘‹
 *
this
 = *
d
;

231 *
d
 = 
this
->
√xt
;

232 
	`èŒoc_‰ì
(
this
);

233  
åue
;

235 
d
 = &(*d)->
√xt
;

237  
Ál£
;

238 
	}
}

240 
èl_èŒoc_£t_backíd_
(*(*
Æloc_‚
)(
size_t
 
size
),

241 *(*
ªsize_‚
)(*, 
size_t
 
size
),

242 (*
‰ì_‚
)(*),

243 (*
îr‹_‚
)(c⁄° *
msg
))

245 
	`as£π
(!
Æloc_‚
);

246 
	`as£π
(!
ªsize_‚
);

247 
	`as£π
(!
‰ì_‚
);

248 
îr‹‚
 = 
îr‹_‚
;

249 
	`èŒoc_£t_ab‹t_‚
(
îr‹_‚
);

250 
	}
}

252 
boﬁ
 
	$èl_èŒoc_check_
(c⁄° 
èl_t
 *
˘x
, c⁄° *
îr‹°r
)

255  !
˘x
 || 
	`èŒoc_tŸÆ_blocks
(ctx) >= 1;

256 
	}
}

	@ccan/ccan/tal/talloc/talloc.h

2 #i‚de‡
CCAN_TAL_TALLOC_H


3 
	#CCAN_TAL_TALLOC_H


	)

4 
	~"c⁄fig.h
"

5 
	~<cˇn/compûî/compûî.h
>

6 
	~<cˇn/likñy/likñy.h
>

7 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

8 
	~<cˇn/°r/°r.h
>

9 
	~<èŒoc.h
>

10 
	~<°dlib.h
>

11 
	~<°dboﬁ.h
>

12 
	~<°d¨g.h
>

20 
TALLOC_CTX
 
	tèl_t
;

35 
	#èl
(
˘x
, 
ty≥
) \

36 ((
ty≥
 *)
	`èl_èŒoc_
((
˘x
), —y≥), 
Ál£
, \

37 
	`TAL_LABEL
(
ty≥
, "")))

	)

50 
	#èlz
(
˘x
, 
ty≥
) \

51 ((
ty≥
 *)
	`èl_èŒoc_
((
˘x
), —y≥), 
åue
, \

52 
	`TAL_LABEL
(
ty≥
, "")))

	)

67 
	#èl_‰ì
(
p
Ë
	`èl_èŒoc_‰ì_
’)

	)

83 
	#èl_¨r
(
˘x
, 
ty≥
, 
cou¡
) \

84 ((
ty≥
 *)
	`èl_èŒoc_¨r_
((
˘x
), —y≥), (
cou¡
), 
Ál£
, \

85 
	`TAL_LABEL
(
ty≥
, "[]")))

	)

100 
	#èl_¨rz
(
˘x
, 
ty≥
, 
cou¡
) \

101 ((
ty≥
 *)
	`èl_èŒoc_¨r_
((
˘x
), —y≥), (
cou¡
), 
åue
, \

102 
	`TAL_LABEL
(
ty≥
, "[]")))

	)

115 
	#èl_ªsize
(
p
, 
cou¡
) \

116 
	`èl_èŒoc_ªsize_
((**)(
p
), **’), (
cou¡
))

	)

126 
	#èl_°ól
(
˘x
, 
±r
Ë
	`èŒoc_°ól
((˘x), (±r))

	)

136 
	#èl_add_de°ru˘‹
(
±r
, 
fun˘i⁄
) \

137 
	`èl_èŒoc_add_de°ru˘‹_
((
±r
), 
	`ty≥ß„_cb
(, *, \

138 (
fun˘i⁄
), (
±r
)))

	)

150 
	#èl_dñ_de°ru˘‹
(
±r
, 
fun˘i⁄
) \

151 
	`èl_èŒoc_dñ_de°ru˘‹_
((
±r
), 
	`ty≥ß„_cb
(, *, \

152 (
fun˘i⁄
), (
±r
)))

	)

161 
	#èl_£t_«me
(
±r
, 
«me
) \

162 
	`èl_èŒoc_£t_«me_
((
±r
), (
«me
), 
	`TAL_TALLOC_IS_LITERAL
“ame))

	)

170 
	#èl_«me
(
±r
) \

171 
	`èl_èŒoc_«me_
(
±r
)

	)

177 
	#èl_cou¡
(
±r
Ë
	`èŒoc_¨øy_Àngth
’å)

	)

185 
	#èl_∑ª¡
(
˘x
Ë
	`èŒoc_∑ª¡
(˘x)

	)

195 
	#èl_dup
(
˘x
, 
ty≥
, 
p
, 
n
, 
exåa
) \

196 ((
ty≥
 *)
	`èl_èŒoc_dup_
((
˘x
), 
	`èl_èŒoc_ty≥chk_
(
p
,Åype *), \

197 (
ty≥
), (
n
), (
exåa
), \

198 
	`TAL_LABEL
(
ty≥
, "[]")))

	)

212 
	#èl_£t_backíd
(
Æloc_‚
, 
ªsize_‚
, 
‰ì_‚
, 
îr‹_‚
) \

213 
	`èl_èŒoc_£t_backíd_
((
Æloc_‚
), (
ªsize_‚
), (
‰ì_‚
), (
îr‹_‚
))

	)

233 
	#èl_ex∑nd
(
a1p
, 
a2
, 
num2
) \

234 
	`èl_èŒoc_ex∑nd_
((**)(
a1p
), (
a2
), **(a1p), \

235 (
num2
Ë+ 0*(*(
a1p
Ë=(
a2
)))

	)

247 
	#èl_check
(
˘x
, 
îr‹°r
) \

248 
	`èl_èŒoc_check_
((
˘x
), (
îr‹°r
))

	)

252 #i‚de‡
TAL_TALLOC_LABEL


253 #ifde‡
CCAN_TAL_NO_LABELS


254 
	#TAL_LABEL
(
ty≥
, 
¨r
Ë
NULL


	)

256 #ifde‡
CCAN_TAL_DEBUG


257 
	#TAL_LABEL
(
ty≥
, 
¨r
) \

258 
__FILE__
 ":" 
	`°rögify
(
__LINE__
Ë":" såögify(
ty≥
Ë
¨r


	)

260 
	#TAL_LABEL
(
ty≥
, 
¨r
Ë
	`°rögify
—y≥Ë
	)
arr

265 #i‡
HAVE_BUILTIN_CONSTANT_P


266 
	#TAL_TALLOC_IS_LITERAL
(
°r
Ë
	`__buûtö_c⁄°™t_p
(°r)

	)

268 
	#TAL_TALLOC_IS_LITERAL
(
°r
Ë
Ál£


	)

271 #i‡
HAVE_TYPEOF
 && 
HAVE_STATEMENT_EXPR


274 
	#èl_èŒoc_ty≥chk_
(
±r
, 
±y≥
Ë({ 
	`__ty≥of__
(’å)+0Ë
_p
 = (±y≥)’å); _p; })

	)

276 
	#èl_èŒoc_ty≥chk_
(
±r
, 
±y≥
Ë’å)

	)

279 *
èl_èŒoc_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
byãs
, 
boﬁ
 
˛ór
,

280 c⁄° *
œbñ
);

281 *
èl_èŒoc_¨r_
(c⁄° 
èl_t
 *
˘x
, 
size_t
 
byãs
, size_à
cou¡
, 
boﬁ
 
˛ór
,

282 c⁄° *
œbñ
);

283 *
èl_èŒoc_‰ì_
(c⁄° 
èl_t
 *
˘x
);

284 c⁄° *
èl_èŒoc_«me_
(c⁄° 
èl_t
 *
˘x
);

285 
boﬁ
 
èl_èŒoc_£t_«me_
(
èl_t
 *
˘x
, c⁄° *
«me
, boﬁ 
lôîÆ
);

287 
boﬁ
 
èl_èŒoc_add_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
));

288 
boﬁ
 
	`èl_èŒoc_dñ_de°ru˘‹_
(c⁄° 
èl_t
 *
˘x
, (*
de°roy
)(*
me
));

291 
	#èl_dup_
(
˘x
, 
p
, 
size
, 
n
, 
exåa
, 
add_cou¡
, 
œbñ
) \

292 
	`èl_èŒoc_dup_
((
˘x
), (
p
), (
size
), (
n
), (
exåa
), (
œbñ
))

	)

293 *
	`èl_èŒoc_dup_
(c⁄° 
èl_t
 *
˘x
, c⁄° *
p
, 
size_t
 
size
,

294 
size_t
 
n
, size_à
exåa
, c⁄° *
œbñ
);

296 
boﬁ
 
	`èl_èŒoc_ªsize_
(
èl_t
 **
˘xp
, 
size_t
 
size
, size_à
cou¡
);

297 
boﬁ
 
	`èl_èŒoc_ex∑nd_
(
èl_t
 **
˘xp
, c⁄° *
§c
, 
size_t
 
size
, size_à
cou¡
);

298 
boﬁ
 
	`èl_èŒoc_check_
(c⁄° 
èl_t
 *
˘x
, c⁄° *
îr‹°r
);

300 
	`èl_èŒoc_£t_backíd_
(*(*
Æloc_‚
)(
size_t
 
size
),

301 *(*
ªsize_‚
)(*, 
size_t
 
size
),

302 (*
‰ì_‚
)(*),

303 (*
îr‹_‚
)(c⁄° *
msg
));

	@ccan/ccan/tal/talloc/test/run-array.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
[4];

8 
i
;

10 
	`∂™_ã°s
(11);

12 
∑ª¡
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
∑ª¡
);

16 
i
 = 0; i < 4; i++) {

17 
c
[
i
] = 
	`èlz
(
∑ª¡
, );

18 
	`ok1
(*
c
[
i
] == '\0');

19 
	`èl_‰ì
(
c
[
i
]);

23 
i
 = 0; i < 4; i++) {

24 
c
[
i
] = 
	`èl_¨r
(
∑ª¡
, , 4);

25 
	`°r˝y
(
c
[
i
], "abc");

26 
	`èl_‰ì
(
c
[
i
]);

30 
i
 = 0; i < 4; i++) {

31 
c
[
i
] = 
	`èl_¨rz
(
∑ª¡
, , 4);

32 
	`ok1
(!
c
[
i
][0] && !c[i][1] && !c[i][2] && !c[i][3]);

33 
	`°r˝y
(
c
[
i
], "abc");

34 
	`èl_‰ì
(
c
[
i
]);

38 
c
[0] = 
	`èl_¨rz
(
∑ª¡
, , 4);

39 
	`ok1
(
	`èl_ªsize
(&
c
[0], 6));

40 
	`°r˝y
(
c
[0], "hello");

41 
	`èl_‰ì
(
c
[0]);

42 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
∑ª¡
) == 1);

43 
	`èl_‰ì
(
∑ª¡
);

45  
	`exô_°©us
();

46 
	}
}

	@ccan/ccan/tal/talloc/test/run-count.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
p1
, *
p2
;

9 
	`∂™_ã°s
(12);

11 
p1
 = 
	`èl
(
NULL
, );

12 
	`ok1
(
p1
);

13 
	`ok1
(
	`èl_cou¡
(
p1
) == 1);

15 
p2
 = 
	`èl_¨r
(
p1
, , 1);

16 
	`ok1
(
p2
);

17 
	`ok1
(
	`èl_cou¡
(
p2
) == 1);

18 
	`ok1
(
	`èl_ªsize
(&
p2
, 2));

19 
	`ok1
(
	`èl_cou¡
(
p2
) == 2);

20 
	`ok1
(
	`èl_check
(
NULL
, NULL));

21 
	`èl_‰ì
(
p2
);

23 
p2
 = 
	`èl_¨rz
(
p1
, , 7);

24 
	`ok1
(
p2
);

25 
	`ok1
(
	`èl_cou¡
(
p2
) == 7);

26 
	`ok1
(
	`èl_ªsize
(&
p2
, 0));

27 
	`ok1
(
	`èl_cou¡
(
p2
) == 0);

28 
	`ok1
(
	`èl_check
(
NULL
, NULL));

29 
	`èl_‰ì
(
p2
);

30 
	`èl_‰ì
(
p1
);

32  
	`exô_°©us
();

33 
	}
}

	@ccan/ccan/tal/talloc/test/run-destructor.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 *
	g∑ª¡
, *
	gchûd
;

6 
	gde°roy_cou¡
;

9 
	$de°roy_∑ª¡
(*
p
)

11 
	`ok1
(
p
 =
∑ª¡
);

12 
	`ok1
(
de°roy_cou¡
 == 0);

14 *
chûd
 = '1';

15 
de°roy_cou¡
++;

16 
	}
}

18 
	$de°roy_chûd
(*
p
)

20 
	`ok1
(
p
 =
chûd
);

21 
	`ok1
(
de°roy_cou¡
 == 1);

23 *
∑ª¡
 = '1';

24 
de°roy_cou¡
++;

25 
	}
}

27 
	$de°roy_öc
(*
p
)

29 
de°roy_cou¡
++;

30 
	}
}

32 
	$maö
()

34 *
chûd2
;

36 
	`∂™_ã°s
(18);

38 
de°roy_cou¡
 = 0;

39 
∑ª¡
 = 
	`èl
(
NULL
, );

40 
chûd
 = 
	`èl
(
∑ª¡
, );

41 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_∑ª¡
));

42 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd
, 
de°roy_chûd
));

43 
	`èl_‰ì
(
∑ª¡
);

44 
	`ok1
(
de°roy_cou¡
 == 2);

46 
de°roy_cou¡
 = 0;

47 
∑ª¡
 = 
	`èl
(
NULL
, );

48 
chûd
 = 
	`èl
(
∑ª¡
, );

49 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_∑ª¡
));

50 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd
, 
de°roy_chûd
));

51 
	`ok1
(
	`èl_dñ_de°ru˘‹
(
chûd
, 
de°roy_chûd
));

52 
	`èl_‰ì
(
∑ª¡
);

53 
	`ok1
(
de°roy_cou¡
 == 1);

55 
de°roy_cou¡
 = 0;

56 
∑ª¡
 = 
	`èl
(
NULL
, );

57 
chûd
 = 
	`èl
(
∑ª¡
, );

58 
chûd2
 = 
	`èl
(
∑ª¡
, );

59 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_öc
));

60 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_öc
));

61 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd
, 
de°roy_öc
));

62 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd2
, 
de°roy_öc
));

63 
	`èl_‰ì
(
∑ª¡
);

64 
	`ok1
(
de°roy_cou¡
 == 4);

66  
	`exô_°©us
();

67 
	}
}

	@ccan/ccan/tal/talloc/test/run-expand.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
a
;

8 c⁄° 
¨r
[] = { 1, 2 };

10 
	`∂™_ã°s
(14);

11 
	`èŒoc_íabÀ_nuŒ_åackög_no_auto‰ì
();

13 
a
 = 
	`èl_¨rz
(
NULL
, , 1);

14 
	`ok1
(
a
);

16 
	`ok1
(
	`èl_ex∑nd
(&
a
, 
¨r
, 2));

17 
	`ok1
(
	`èl_cou¡
(
a
) == 3);

18 
	`ok1
(
a
[0] == 0);

19 
	`ok1
(
a
[1] == 1);

20 
	`ok1
(
a
[2] == 2);

22 
	`ok1
(
	`èl_ex∑nd
(&
a
, 
	`èke
(
	`èl_¨rz
(
NULL
, , 1)), 1));

23 
	`ok1
(
	`èl_cou¡
(
a
) == 4);

24 
	`ok1
(
a
[0] == 0);

25 
	`ok1
(
a
[1] == 1);

26 
	`ok1
(
a
[2] == 2);

27 
	`ok1
(
a
[3] == 0);

28 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
NULL
) == 2);

29 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
a
) == 1);

31 
	`èl_‰ì
(
a
);

33 
	`èŒoc_dißbÀ_nuŒ_åackög
();

34  
	`exô_°©us
();

35 
	}
}

	@ccan/ccan/tal/talloc/test/run-free.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

4 
	~<î∫o.h
>

6 
	$de°roy_î∫o
(*
p
)

8 
î∫o
 = 
ENOENT
;

9 
	}
}

11 
	$maö
()

13 *
p
;

15 
	`∂™_ã°s
(2);

17 
p
 = 
	`èl
(
NULL
, );

18 
	`ok1
(
	`èl_add_de°ru˘‹
(
p
, 
de°roy_î∫o
));

21 
î∫o
 = 
EINVAL
;

22 
	`èl_‰ì
(
p
);

23 
	`ok1
(
î∫o
 =
EINVAL
);

25  
	`exô_°©us
();

26 
	}
}

	@ccan/ccan/tal/talloc/test/run-named-debug.c

1 
	#CCAN_TAL_DEBUG


	)

2 
	~<cˇn/èl/èŒoc/èŒoc.h
>

3 
	~<cˇn/èl/èŒoc/èŒoc.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 *
p
;

9 
«me
[] = "testÇame";

11 
	`∂™_ã°s
(6);

13 
p
 = 
	`èl
(
NULL
, );

14 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
__FILE__
 ":13:int") == 0);

16 
	`èl_£t_«me
(
p
, "someÜiteral");

17 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "someÜiteral") == 0);

19 
	`èl_£t_«me
(
p
, 
«me
);

20 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
«me
) == 0);

22 
	`ok1
(
	`èl_«me
(
p
Ë!
«me
);

24 
	`èl_£t_«me
(
p
, "some otherÜiteral");

25 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "some otherÜiteral") == 0);

27 
	`èl_‰ì
(
p
);

29 
p
 = 
	`èl_¨r
(
NULL
, , 2);

30 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
__FILE__
 ":29:int[]") == 0);

31 
	`èl_‰ì
(
p
);

33  
	`exô_°©us
();

34 
	}
}

	@ccan/ccan/tal/talloc/test/run-named-nolabels.c

1 
	#CCAN_TAL_NO_LABELS


	)

2 
	~<cˇn/èl/èŒoc/èŒoc.h
>

3 
	~<cˇn/èl/èŒoc/èŒoc.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 *
p
;

9 
«me
[] = "testÇame";

11 
	`∂™_ã°s
(5);

13 
p
 = 
	`èl
(
NULL
, );

14 
	`ok1
(
	`èl_«me
(
p
Ë=
NULL
);

16 
	`èl_£t_«me
(
p
, "someÜiteral");

17 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "someÜiteral") == 0);

19 
	`èl_£t_«me
(
p
, 
«me
);

20 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
«me
) == 0);

22 
	`ok1
(
	`èl_«me
(
p
Ë!
«me
);

24 
	`èl_£t_«me
(
p
, "some otherÜiteral");

25 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "some otherÜiteral") == 0);

27 
	`èl_‰ì
(
p
);

29  
	`exô_°©us
();

30 
	}
}

	@ccan/ccan/tal/talloc/test/run-named.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
p
;

8 
«me
[] = "testÇame";

10 
	`∂™_ã°s
(6);

12 
p
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "int") == 0);

15 
	`èl_£t_«me
(
p
, "someÜiteral");

16 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "someÜiteral") == 0);

18 
	`èl_£t_«me
(
p
, 
«me
);

19 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
«me
) == 0);

21 
	`ok1
(
	`èl_«me
(
p
Ë!
«me
);

23 
	`èl_£t_«me
(
p
, "some otherÜiteral");

24 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "some otherÜiteral") == 0);

26 
	`èl_‰ì
(
p
);

28 
p
 = 
	`èl_¨r
(
NULL
, , 2);

29 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "int[]") == 0);

30 
	`èl_‰ì
(
p
);

32  
	`exô_°©us
();

33 
	}
}

	@ccan/ccan/tal/talloc/test/run-overflow.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	gîr‹_cou¡
;

7 
	$my_îr‹
(c⁄° *
msg
)

9 
îr‹_cou¡
++;

10 
	}
}

12 
	$maö
()

14 *
p
;

15 *
pi
, *
‹igpi
;

16 *
˝
;

18 
	`∂™_ã°s
(30);

20 
	`èl_£t_backíd
(
NULL
, NULL, NULL, 
my_îr‹
);

21 
	`èŒoc_íabÀ_nuŒ_åackög_no_auto‰ì
();

23 
p
 = 
	`èl_¨r
(
NULL
, , (
size_t
)-1);

24 
	`ok1
(!
p
);

25 
	`ok1
(
îr‹_cou¡
 == 1);

27 
p
 = 
	`èl_¨r
(
NULL
, , (
size_t
)-2);

28 
	`ok1
(!
p
);

29 
	`ok1
(
îr‹_cou¡
 == 2);

32 
îr‹_cou¡
 = 0;

33 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

34 
	`ok1
(
‹igpi
);

35 
	`ok1
(
îr‹_cou¡
 == 0);

36 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, (
size_t
)-1, 0);

37 
	`ok1
(!
pi
);

38 
	`ok1
(
îr‹_cou¡
 == 1);

39 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, 0, (
size_t
)-1);

40 
	`ok1
(!
pi
);

41 
	`ok1
(
îr‹_cou¡
 == 2);

43 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, (
size_t
)-1UL / (),

44 (
size_t
)-1UL / ());

45 
	`ok1
(!
pi
);

46 
	`ok1
(
îr‹_cou¡
 == 3);

48 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, (
size_t
)-1UL / () / 2,

49 (
size_t
)-1UL / () / 2);

50 
	`ok1
(!
pi
);

51 
	`ok1
(
îr‹_cou¡
 == 4);

52 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
NULL
) == 2);

53 
	`èl_‰ì
(
‹igpi
);

56 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

57 
îr‹_cou¡
 = 0;

58 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), (
size_t
)-1, 0);

59 
	`ok1
(!
pi
);

60 
	`ok1
(
îr‹_cou¡
 == 1);

62 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

63 
îr‹_cou¡
 = 0;

64 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), 0, (
size_t
)-1);

65 
	`ok1
(!
pi
);

66 
	`ok1
(
îr‹_cou¡
 == 1);

67 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
NULL
) == 1);

69 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

70 
îr‹_cou¡
 = 0;

71 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), (
size_t
)-1UL / (),

72 (
size_t
)-1UL / ());

73 
	`ok1
(!
pi
);

74 
	`ok1
(
îr‹_cou¡
 == 1);

75 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
NULL
) == 1);

77 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

78 
îr‹_cou¡
 = 0;

80 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), (
size_t
)-1UL / () / 2,

81 (
size_t
)-1UL / () / 2);

82 
	`ok1
(!
pi
);

83 
	`ok1
(
îr‹_cou¡
 == 1);

84 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
NULL
) == 1);

87 
˝
 = 
	`èl_¨r
(
p
, , 100);

88 
	`ok1
(!
	`èl_ex∑nd
(&
˝
, 
NULL
, (
size_t
)-99UL));

89 
	`ok1
(
îr‹_cou¡
 == 2);

90 
	`èl_‰ì
(
˝
);

93 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

94 
	`ok1
(!
	`èl_ex∑nd
(&
‹igpi
, 
NULL
, (
size_t
)-1UL / ()));

95 
	`ok1
(
îr‹_cou¡
 == 3);

96 
	`èl_‰ì
(
‹igpi
);

98 
	`èŒoc_dißbÀ_nuŒ_åackög
();

99  
	`exô_°©us
();

100 
	}
}

	@ccan/ccan/tal/talloc/test/run-steal.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
p
[5];

8 
i
;

10 
	`∂™_ã°s
(9);

12 
p
[0] = 
	`èl
(
NULL
, );

13 
i
 = 1; i < 5; i++)

14 
p
[
i
] = 
	`èl
(p[i-1], );

16 
	`èl_check
(
NULL
, "check");

18 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[4]) ==Ö[4]);

19 
	`èl_check
(
NULL
, "check");

21 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[4]) ==Ö[4]);

22 
	`èl_check
(
NULL
, "check");

24 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[1]) ==Ö[1]);

25 
	`èl_check
(
NULL
, "check");

27 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[1]) ==Ö[1]);

28 
	`èl_check
(
NULL
, "check");

30 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[2]) ==Ö[2]);

31 
	`èl_check
(
NULL
, "check");

33 
	`ok1
(
	`èl_∑ª¡
(
p
[1]) ==Ö[0]);

34 
	`ok1
(
	`èl_∑ª¡
(
p
[2]) ==Ö[0]);

35 
	`ok1
(
	`èl_∑ª¡
(
p
[3]) ==Ö[2]);

36 
	`ok1
(
	`èl_∑ª¡
(
p
[4]) ==Ö[0]);

37 
	`èl_‰ì
(
p
[0]);

39  
	`exô_°©us
();

40 
	}
}

	@ccan/ccan/tal/talloc/test/run-take.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
;

9 
	`∂™_ã°s
(21);

12 
	`ok1
(
	`èke
(
NULL
) == NULL);

13 
	`ok1
(
	`is_èkí
(
NULL
));

14 
	`ok1
(
	`èkí
(
NULL
));

15 
	`ok1
(!
	`is_èkí
(
NULL
));

16 
	`ok1
(!
	`èkí
(
NULL
));

18 
∑ª¡
 = 
	`èl
(
NULL
, );

19 
	`ok1
(
∑ª¡
);

21 
	`ok1
(
	`èke
(
∑ª¡
) ==Öarent);

22 
	`ok1
(
	`is_èkí
(
∑ª¡
));

23 
	`ok1
(
	`èkí
(
∑ª¡
));

24 
	`ok1
(!
	`is_èkí
(
∑ª¡
));

25 
	`ok1
(!
	`èkí
(
∑ª¡
));

27 
c
 = 
	`èl
(
∑ª¡
, );

28 *
c
 = 'h';

29 
c
 = 
	`èl_dup
(
∑ª¡
, , 
	`èke
(c), 1, 0);

30 
	`ok1
(
c
[0] == 'h');

31 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

33 
c
 = 
	`èl_dup
(
∑ª¡
, , 
	`èke
(c), 1, 2);

34 
	`ok1
(
c
[0] == 'h');

35 
	`°r˝y
(
c
, "hi");

36 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

39 
c
 = 
	`èl_dup
(
NULL
, , 
	`èke
(c), 1, 0);

40 
	`ok1
(
c
[0] == 'h');

41 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
NULL
);

44 
	`èl_‰ì
(
c
);

45 
	`ok1
(
	`èŒoc_tŸÆ_blocks
(
∑ª¡
) == 1);

47 
	`èl_‰ì
(
∑ª¡
);

48 
	`ok1
(!
	`èkí_™y
());

51 
c
 = 
NULL
;

52 
	`ok1
(
	`èl_dup
(
NULL
, , 
	`èke
(
c
), 5, 5) == NULL);

53 
	`ok1
(!
	`èkí_™y
());

55  
	`exô_°©us
();

56 
	}
}

	@ccan/ccan/tal/talloc/test/run.c

1 
	~<cˇn/èl/èŒoc/èŒoc.h
>

2 
	~<cˇn/èl/èŒoc/èŒoc.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
[4];

8 
i
, 
j
;

10 
	`∂™_ã°s
(9);

13 
	`ok1
(
	`èl_‰ì
(
NULL
) == NULL);

15 
∑ª¡
 = 
	`èl
(
NULL
, );

16 
	`ok1
(
∑ª¡
);

17 
	`ok1
(
	`èl_∑ª¡
(
∑ª¡
Ë=
NULL
);

18 
	`ok1
(
	`èl_∑ª¡
(
NULL
) == NULL);

20 
i
 = 0; i < 4; i++)

21 
c
[
i
] = 
	`èl
(
∑ª¡
, );

23 
i
 = 0; i < 4; i++)

24 
	`ok1
(
	`èl_∑ª¡
(
c
[
i
]Ë=
∑ª¡
);

27 
	`ok1
(
	`èl_‰ì
(
∑ª¡
Ë=
NULL
);

29 
∑ª¡
 = 
	`èl
(
NULL
, );

32 
i
 = 0; i < 4; i++) {

33 
j
 = 0; j < 4; j++)

34 
c
[
j
] = 
	`èl
(
∑ª¡
, );

36 
	`èl_‰ì
(
c
[
i
]);

37 
	`èl_‰ì
(
c
[(
i
+1) % 4]);

38 
	`èl_‰ì
(
c
[(
i
+2) % 4]);

39 
	`èl_‰ì
(
c
[(
i
+3) % 4]);

41 
	`èl_‰ì
(
∑ª¡
);

43  
	`exô_°©us
();

44 
	}
}

	@ccan/ccan/tal/test/run-allocfail.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	gÆloc_cou¡
, 
	gwhí_to_Áû
, 
	gîr_cou¡
;

6 
boﬁ
 
	g°ólög
;

8 *
	$Áûög_Æloc
(
size_t
 
Àn
)

10 i‡(
Æloc_cou¡
++ =
whí_to_Áû
)

11  
NULL
;

13 
	`as£π
(
°ólög
 || 
Æloc_cou¡
 <
whí_to_Áû
);

15  
	`mÆloc
(
Àn
);

16 
	}
}

18 *
	$Áûög_ªÆloc
(*
p
, 
size_t
 
Àn
)

20 i‡(
Æloc_cou¡
++ =
whí_to_Áû
)

21  
NULL
;

23  
	`ªÆloc
(
p
, 
Àn
);

24 
	}
}

27 
	$noÁû_⁄_îr‹
(c⁄° *
msg
)

29 
	`düg
("ERROR: %s", 
msg
);

30 
îr_cou¡
++;

31 
	}
}

33 
	$de°roy_p
(*
p
)

35 
	}
}

37 
	$maö
()

39 *
p
, *
c1
, *
c2
;

40 
boﬁ
 
suc˚ss
;

42 
	`∂™_ã°s
(25);

44 
	`èl_£t_backíd
(
Áûög_Æloc
, 
Áûög_ªÆloc
, 
NULL
, 
noÁû_⁄_îr‹
);

47 
whí_to_Áû
 = 
îr_cou¡
 = 0;

49 
Æloc_cou¡
 = 0;

50 
p
 = 
	`èl
(
NULL
, );

51 
whí_to_Áû
++;

52 } !
p
);

53 
	`ok1
(
Æloc_cou¡
 >= 1);

54 
	`ok1
(
whí_to_Áû
 > 1);

55 
	`ok1
(
îr_cou¡
 =
whí_to_Áû
 - 1);

58 
whí_to_Áû
 = 
îr_cou¡
 = 0;

60 
Æloc_cou¡
 = 0;

61 
c1
 = 
	`èl
(
p
, );

62 
whí_to_Áû
++;

63 } !
c1
);

64 
	`ok1
(
Æloc_cou¡
 >= 1);

65 
	`ok1
(
whí_to_Áû
 > 1);

66 
	`ok1
(
îr_cou¡
 =
whí_to_Áû
 - 1);

69 
c2
 = 
c1
;

70 
whí_to_Áû
 = 
îr_cou¡
 = 0;

72 
Æloc_cou¡
 = 0;

73 i‡(
	`èl_ªsize
(&
c1
, 100))

76 
	`ok1
(
c1
 =
c2
);

77 
whí_to_Áû
++;

79 
	`ok1
(
Æloc_cou¡
 == 1);

80 
	`ok1
(
whí_to_Áû
 == 1);

81 
	`ok1
(
îr_cou¡
 == 1);

83 
	`mem£t
(
c1
, 1, 100);

86 
whí_to_Áû
 = 
îr_cou¡
 = 0;

88 
Æloc_cou¡
 = 0;

89 
c2
 = 
	`èl
(
p
, );

90 
whí_to_Áû
++;

91 } !
c2
);

92 
	`ok1
(
Æloc_cou¡
 >= 1);

93 
	`ok1
(
whí_to_Áû
 > 1);

95 
	`ok1
 (
îr_cou¡
 =
whí_to_Áû
 - 1 ||Érr_count == when_to_fail);

98 
whí_to_Áû
 = 
îr_cou¡
 = 0;

100 
Æloc_cou¡
 = 0;

101 
suc˚ss
 = 
	`èl_add_de°ru˘‹
(
p
, 
de°roy_p
);

102 
whí_to_Áû
++;

103 } !
suc˚ss
);

104 
	`ok1
(
Æloc_cou¡
 >= 1);

105 
	`ok1
(
whí_to_Áû
 > 1);

106 
	`ok1
(
îr_cou¡
 =
whí_to_Áû
 - 1);

109 
whí_to_Áû
 = 
îr_cou¡
 = 0;

111 c⁄° 
«me
[] = "someÇame";

112 
Æloc_cou¡
 = 0;

113 
suc˚ss
 = 
	`èl_£t_«me
(
p
, 
«me
);

114 
whí_to_Áû
++;

115 } !
suc˚ss
);

116 
	`ok1
(
Æloc_cou¡
 >= 1);

117 
	`ok1
(
whí_to_Áû
 > 1);

118 
	`ok1
(
îr_cou¡
 =
whí_to_Áû
 - 1);

121 
°ólög
 = 
åue
;

122 
whí_to_Áû
 = 
îr_cou¡
 = 0;

124 
Æloc_cou¡
 = 0;

125 
suc˚ss
 = 
	`èl_°ól
(
c2
, 
c1
Ë!
NULL
;

126 
whí_to_Áû
++;

127 } !
suc˚ss
);

128 
	`ok1
(
Æloc_cou¡
 >= 1);

129 
	`ok1
(
whí_to_Áû
 > 1);

130 
	`ok1
(
îr_cou¡
 =
whí_to_Áû
 - 1);

133 
whí_to_Áû
 = 1000;

134 ()
	`èl
(
p
, );

135 
c1
 = 
	`èl
(
p
, );

136 
c2
 = 
	`èl
(
p
, );

137 ()
	`èl
(
p
, );

140 
whí_to_Áû
 = 
îr_cou¡
 = 0;

142 
Æloc_cou¡
 = 0;

143 
suc˚ss
 = 
	`èl_°ól
(
c2
, 
c1
Ë!
NULL
;

144 
whí_to_Áû
++;

145 } !
suc˚ss
);

146 
	`ok1
(
Æloc_cou¡
 >= 1);

147 
	`ok1
(
whí_to_Áû
 > 1);

148 
	`ok1
(
îr_cou¡
 =
whí_to_Áû
 - 1);

150 
	`èl_‰ì
(
p
);

151 
	`èl_˛ónup
();

152  
	`exô_°©us
();

153 
	}
}

	@ccan/ccan/tal/test/run-array.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
[4];

8 
i
;

10 
	`∂™_ã°s
(11);

12 
∑ª¡
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
∑ª¡
);

16 
i
 = 0; i < 4; i++) {

17 
c
[
i
] = 
	`èlz
(
∑ª¡
, );

18 
	`ok1
(*
c
[
i
] == '\0');

19 
	`èl_‰ì
(
c
[
i
]);

23 
i
 = 0; i < 4; i++) {

24 
c
[
i
] = 
	`èl_¨r
(
∑ª¡
, , 4);

25 
	`°r˝y
(
c
[
i
], "abc");

26 
	`èl_‰ì
(
c
[
i
]);

30 
i
 = 0; i < 4; i++) {

31 
c
[
i
] = 
	`èl_¨rz
(
∑ª¡
, , 4);

32 
	`ok1
(!
c
[
i
][0] && !c[i][1] && !c[i][2] && !c[i][3]);

33 
	`°r˝y
(
c
[
i
], "abc");

34 
	`èl_‰ì
(
c
[
i
]);

38 
c
[0] = 
	`èl_¨rz
(
∑ª¡
, , 4);

39 
	`ok1
(
	`èl_ªsize
(&
c
[0], 6));

40 
	`°r˝y
(
c
[0], "hello");

41 
	`èl_‰ì
(
c
[0]);

42 
	`ok1
(
	`èl_fú°
(
∑ª¡
Ë=
NULL
);

44 
	`èl_‰ì
(
∑ª¡
);

46 
	`èl_˛ónup
();

47  
	`exô_°©us
();

48 
	}
}

	@ccan/ccan/tal/test/run-count.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
boﬁ
 
	gmove
;

6 
	#ALIGN
 ((*)*2)

	)

8 *
	$my_Æloc
(
size_t
 
Àn
)

10 *
ªt
 = 
	`mÆloc
(
Àn
 + 
ALIGN
);

11 
	`mem˝y
(
ªt
, &
Àn
, (len));

12  
ªt
 + 
ALIGN
;

13 
	}
}

15 
	$my_‰ì
(*
p
)

17 i‡(
p
)

18 
	`‰ì
((*)
p
 - 
ALIGN
);

19 
	}
}

21 *
	$my_ªÆloc
(*
ﬁd
, 
size_t
 
√w_size
)

23 *
ªt
;

26 i‡(
move
) {

27 
size_t
 
ﬁd_size
 = *(size_à*)((*)
ﬁd
 - 
ALIGN
);

28 
ªt
 = 
	`my_Æloc
(
√w_size
);

29 
	`mem˝y
(
ªt
, 
ﬁd
, 
ﬁd_size
 > 
√w_size
 ?Çew_size : old_size);

30 
	`my_‰ì
(
ﬁd
);

32 
ªt
 = 
	`ªÆloc
((*)
ﬁd
 - 
ALIGN
, 
√w_size
 + ALIGN);

33 
	`mem˝y
(
ªt
, &
√w_size
, (new_size));

34 
ªt
 +
ALIGN
;

36  
ªt
;

37 
	}
}

39 
	$maö
()

41 *
p1
, *
p2
;

42 
i
;

44 
	`èl_£t_backíd
(
my_Æloc
, 
my_ªÆloc
, 
my_‰ì
, 
NULL
);

46 
	`∂™_ã°s
(19 * 3);

48 
i
 = 0; i < 3; i++) {

49 
move
 = 
i
;

51 
p1
 = 
	`èl
(
NULL
, );

52 
	`ok1
(
p1
);

53 
	`ok1
(
	`èl_cou¡
(
p1
) == 0);

55 
p2
 = 
	`èl_¨r
(
p1
, , 1);

56 
	`ok1
(
p2
);

57 
	`ok1
(
	`èl_cou¡
(
p2
) == 1);

58 
	`ok1
(
	`èl_ªsize
(&
p2
, 2));

59 
	`ok1
(
	`èl_cou¡
(
p2
) == 2);

60 
	`ok1
(
	`èl_check
(
NULL
, NULL));

61 
	`èl_‰ì
(
p2
);

64 
p2
 = 
	`èl_¨rz
(
p1
, , 7);

65 
	`ok1
(
p2
);

66 
	`ok1
(
	`èl_cou¡
(
p2
) == 7);

67 
	`ok1
(
	`èl_check
(
NULL
, NULL));

68 
	`èl_ªsize
(&
p2
, 20);

69 
	`ok1
(
p2
);

70 
	`ok1
(
	`èl_check
(
NULL
, NULL));

71 
	`ok1
(
	`èl_cou¡
(
p2
) == 20);

73 i‡(
i
 == 2)

74 
move
 = 
Ál£
;

75 
	`èl_ªsize
(&
p2
, 300);

76 
	`ok1
(
p2
);

77 
	`ok1
(
	`èl_check
(
NULL
, NULL));

78 
	`ok1
(
	`èl_cou¡
(
p2
) == 300);

79 
	`ok1
(
	`èl_ªsize
(&
p2
, 0));

80 
	`ok1
(
	`èl_cou¡
(
p2
) == 0);

81 
	`ok1
(
	`èl_check
(
NULL
, NULL));

82 
	`èl_‰ì
(
p2
);

83 
	`èl_‰ì
(
p1
);

86 
	`èl_˛ónup
();

87  
	`exô_°©us
();

88 
	}
}

	@ccan/ccan/tal/test/run-destructor.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 *
	g∑ª¡
, *
	gchûd
;

6 
	gde°roy_cou¡
;

9 
	$de°roy_∑ª¡
(*
p
)

11 
	`ok1
(
p
 =
∑ª¡
);

12 
	`ok1
(
de°roy_cou¡
 == 0);

14 *
chûd
 = '1';

15 
de°roy_cou¡
++;

16 
	}
}

18 
	$de°roy_chûd
(*
p
)

20 
	`ok1
(
p
 =
chûd
);

21 
	`ok1
(
de°roy_cou¡
 == 1);

23 *
∑ª¡
 = '1';

24 
de°roy_cou¡
++;

25 
	}
}

27 
	$de°roy_öc
(*
p
)

29 
de°roy_cou¡
++;

30 
	}
}

32 
	$maö
()

34 *
chûd2
;

36 
	`∂™_ã°s
(18);

38 
de°roy_cou¡
 = 0;

39 
∑ª¡
 = 
	`èl
(
NULL
, );

40 
chûd
 = 
	`èl
(
∑ª¡
, );

41 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_∑ª¡
));

42 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd
, 
de°roy_chûd
));

43 
	`èl_‰ì
(
∑ª¡
);

44 
	`ok1
(
de°roy_cou¡
 == 2);

46 
de°roy_cou¡
 = 0;

47 
∑ª¡
 = 
	`èl
(
NULL
, );

48 
chûd
 = 
	`èl
(
∑ª¡
, );

49 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_∑ª¡
));

50 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd
, 
de°roy_chûd
));

51 
	`ok1
(
	`èl_dñ_de°ru˘‹
(
chûd
, 
de°roy_chûd
));

52 
	`èl_‰ì
(
∑ª¡
);

53 
	`ok1
(
de°roy_cou¡
 == 1);

55 
de°roy_cou¡
 = 0;

56 
∑ª¡
 = 
	`èl
(
NULL
, );

57 
chûd
 = 
	`èl
(
∑ª¡
, );

58 
chûd2
 = 
	`èl
(
∑ª¡
, );

59 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_öc
));

60 
	`ok1
(
	`èl_add_de°ru˘‹
(
∑ª¡
, 
de°roy_öc
));

61 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd
, 
de°roy_öc
));

62 
	`ok1
(
	`èl_add_de°ru˘‹
(
chûd2
, 
de°roy_öc
));

63 
	`èl_‰ì
(
∑ª¡
);

64 
	`ok1
(
de°roy_cou¡
 == 4);

66 
	`èl_˛ónup
();

67  
	`exô_°©us
();

68 
	}
}

	@ccan/ccan/tal/test/run-expand.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
a
;

8 c⁄° 
¨r
[] = { 1, 2 };

10 
	`∂™_ã°s
(13);

12 
a
 = 
	`èl_¨rz
(
NULL
, , 1);

13 
	`ok1
(
a
);

15 
	`ok1
(
	`èl_ex∑nd
(&
a
, 
¨r
, 2));

16 
	`ok1
(
	`èl_cou¡
(
a
) == 3);

17 
	`ok1
(
a
[0] == 0);

18 
	`ok1
(
a
[1] == 1);

19 
	`ok1
(
a
[2] == 2);

21 
	`ok1
(
	`èl_ex∑nd
(&
a
, 
	`èke
(
	`èl_¨rz
(
NULL
, , 1)), 1));

22 
	`ok1
(
	`èl_cou¡
(
a
) == 4);

23 
	`ok1
(
a
[0] == 0);

24 
	`ok1
(
a
[1] == 1);

25 
	`ok1
(
a
[2] == 2);

26 
	`ok1
(
a
[3] == 0);

27 
	`ok1
(
	`èl_fú°
(
NULL
Ë=
a
 && !
	`èl_√xt
(NULL,á));

29 
	`èl_‰ì
(
a
);

31 
	`èl_˛ónup
();

32  
	`exô_°©us
();

33 
	}
}

	@ccan/ccan/tal/test/run-free.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$de°roy_î∫o
(*
p
)

7 
î∫o
 = 
ENOENT
;

8 
	}
}

10 
	$maö
()

12 *
p
;

14 
	`∂™_ã°s
(2);

16 
p
 = 
	`èl
(
NULL
, );

17 
	`ok1
(
	`èl_add_de°ru˘‹
(
p
, 
de°roy_î∫o
));

20 
î∫o
 = 
EINVAL
;

21 
	`èl_‰ì
(
p
);

22 
	`ok1
(
î∫o
 =
EINVAL
);

24 
	`èl_˛ónup
();

25  
	`exô_°©us
();

26 
	}
}

	@ccan/ccan/tal/test/run-groups-grow.c

1 
	#CCAN_TAL_DEBUG


	)

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/èl/èl.c
>

4 
	~<cˇn/èp/èp.h
>

6 
size_t
 
	gnum_Æloˇãd
;

8 *
	$Æloc_accou¡
(
size_t
 
Àn
)

10 
num_Æloˇãd
++;

11  
	`mÆloc
(
Àn
);

12 
	}
}

14 
	$‰ì_accou¡
(*
p
)

16 
num_Æloˇãd
--;

17  
	`‰ì
(
p
);

18 
	}
}

20 
	#NUM_ALLOCS
 1000

	)

22 
	$maö
()

24 *
p
, *
c
[
NUM_ALLOCS
];

25 
i
;

26 
size_t
 
Æloˇãd_a·î_fú°
;

28 
	`∂™_ã°s
(1);

30 
	`èl_£t_backíd
(
Æloc_accou¡
, 
NULL
, 
‰ì_accou¡
, NULL);

32 
p
 = 
	`èl
(
NULL
, );

33 
c
[0] = 
	`èl
(
p
, );

35 
Æloˇãd_a·î_fú°
 = 
num_Æloˇãd
;

36 
i
 = 1; i < 
NUM_ALLOCS
; i++)

37 
c
[
i
] = 
	`èl
(
p
, );

40 
i
 = 0; i < 
NUM_ALLOCS
; i++)

41 
	`èl_‰ì
(
c
[
i
]);

44 
	`ok1
(
num_Æloˇãd
 <
Æloˇãd_a·î_fú°
);

45 
	`èl_‰ì
(
p
);

46 
	`èl_˛ónup
();

47  
	`exô_°©us
();

48 
	}
}

	@ccan/ccan/tal/test/run-iter.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	#NUM
 1000

	)

7 
	$maö
()

9 *
p
[
NUM
] = { 
NULL
 }, *
ôî
;

10 
i
;

12 
	`∂™_ã°s
(
NUM
 + 1 + NUM);

15 
i
 = 0; i < 
NUM
; i++) {

16 
p
[
i
] = 
	`èl
’[
	`ønd
() % (i + 1)], );

17 *
p
[
i
] = '0';

20 
i
 = 0;

21 
ôî
 = 
	`èl_fú°
(
NULL
); iãr; iã∏
	`èl_√xt
(NULL, iter)) {

22 
i
++;

23 
	`ok1
(*
ôî
 == '0');

24 *
ôî
 = '1';

26 
	`ok1
(
i
 =
NUM
);

28 
i
 = 
NUM
-1; i >= 0; i--) {

29 
	`ok1
(*
p
[
i
] == '1');

30 
	`èl_‰ì
(
p
[
i
]);

32 
	`èl_˛ónup
();

33  
	`exô_°©us
();

34 
	}
}

	@ccan/ccan/tal/test/run-named-debug.c

1 
	#CCAN_TAL_DEBUG


	)

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/èl/èl.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 *
p
;

9 
«me
[] = "testÇame";

11 
	`∂™_ã°s
(6);

13 
p
 = 
	`èl
(
NULL
, );

14 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
__FILE__
 ":13:int") == 0);

16 
	`èl_£t_«me
(
p
, "someÜiteral");

17 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "someÜiteral") == 0);

19 
	`èl_£t_«me
(
p
, 
«me
);

20 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
«me
) == 0);

22 
	`ok1
(
	`èl_«me
(
p
Ë!
«me
);

24 
	`èl_£t_«me
(
p
, "some otherÜiteral");

25 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "some otherÜiteral") == 0);

27 
	`èl_‰ì
(
p
);

29 
p
 = 
	`èl_¨r
(
NULL
, , 2);

30 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
__FILE__
 ":29:int[]") == 0);

31 
	`èl_‰ì
(
p
);

33 
	`èl_˛ónup
();

34  
	`exô_°©us
();

35 
	}
}

	@ccan/ccan/tal/test/run-named-nolabels.c

1 
	#CCAN_TAL_NO_LABELS


	)

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/èl/èl.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 *
p
;

9 
«me
[] = "testÇame";

11 
	`∂™_ã°s
(5);

13 
p
 = 
	`èl
(
NULL
, );

14 
	`ok1
(
	`èl_«me
(
p
Ë=
NULL
);

16 
	`èl_£t_«me
(
p
, "someÜiteral");

17 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "someÜiteral") == 0);

19 
	`èl_£t_«me
(
p
, 
«me
);

20 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
«me
) == 0);

22 
	`ok1
(
	`èl_«me
(
p
Ë!
«me
);

24 
	`èl_£t_«me
(
p
, "some otherÜiteral");

25 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "some otherÜiteral") == 0);

27 
	`èl_‰ì
(
p
);

29 
	`èl_˛ónup
();

30  
	`exô_°©us
();

31 
	}
}

	@ccan/ccan/tal/test/run-named.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
p
;

8 
«me
[] = "testÇame";

10 
	`∂™_ã°s
(6);

12 
p
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "int") == 0);

15 
	`èl_£t_«me
(
p
, "someÜiteral");

16 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "someÜiteral") == 0);

18 
	`èl_£t_«me
(
p
, 
«me
);

19 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), 
«me
) == 0);

21 
	`ok1
(
	`èl_«me
(
p
Ë!
«me
);

23 
	`èl_£t_«me
(
p
, "some otherÜiteral");

24 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "some otherÜiteral") == 0);

26 
	`èl_‰ì
(
p
);

28 
p
 = 
	`èl_¨r
(
NULL
, , 2);

29 
	`ok1
(
	`°rcmp
(
	`èl_«me
(
p
), "int[]") == 0);

30 
	`èl_‰ì
(
p
);

32 
	`èl_˛ónup
();

33  
	`exô_°©us
();

34 
	}
}

	@ccan/ccan/tal/test/run-notifier.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
èl_nŸify_ty≥
 
	gex≥˘
;

6 *
	gex≥˘_öfo
;

7 *
	g˘x
;

8 
	gnŸifõd1
, 
	gnŸifõd2
;

11 *
	$my_ªÆloc
(*
ﬁd
, 
size_t
 
size
)

13 *
√w
 = 
	`ªÆloc
(
ﬁd
, 
size
);

14 i‡(
√w
 =
ﬁd
) {

15 *
p
 = 
	`mÆloc
(
size
);

16 
	`mem˝y
(
p
, 
ﬁd
, 
size
);

17 
	`‰ì
(
ﬁd
);

18 
√w
 = 
p
;

20  
√w
;

21 
	}
}

23 
	$nŸify1
(*
p
, 
èl_nŸify_ty≥
 
nŸify
, *
öfo
)

25 
	`ok1
(
˘x
 == ctx);

26 
	`ok1
(
nŸify
 =
ex≥˘
);

27 i‡(
ex≥˘_öfo
 == &expect_info)

28 
ex≥˘_öfo
 = 
öfo
;

30 
	`ok1
(
öfo
 =
ex≥˘_öfo
);

31 
nŸifõd1
++;

32 
	}
}

34 
	$nŸify2
(*
˘x
, 
èl_nŸify_ty≥
 
nŸify
, *
öfo
)

36 
nŸifõd2
++;

37 
	}
}

39 
boﬁ
 
	g£í_move
, 
	g£í_ªsize
;

40 
	$ªsize_nŸifõr
(*
p
, 
èl_nŸify_ty≥
 
nŸify
, *
öfo
)

42 i‡(
nŸify
 =
TAL_NOTIFY_MOVE
) {

43 
	`ok1
(!
£í_move
);

44 
	`ok1
(!
£í_ªsize
);

45 
	`ok1
(
öfo
 =
˘x
);

46 
	`ok1
(
p
 !
˘x
);

47 
˘x
 = 
p
;

48 
£í_move
 = 
åue
;

49 } i‡(
nŸify
 =
TAL_NOTIFY_RESIZE
) {

50 
	`ok1
(!
£í_ªsize
);

51 
	`ok1
(
£í_move
);

52 
	`ok1
(
p
 =
˘x
);

53 
	`ok1
((
size_t
)
öfo
 == 100);

54 
£í_ªsize
 = 
åue
;

56 
	`Áû
("U√x≥˘edÇŸifõ∏%i", 
nŸify
);

57 
	}
}

59 
	$maö
()

61 *
chûd
, *
√w_˘x
;

63 
	`∂™_ã°s
(56);

65 
˘x
 = 
	`èl
(
NULL
, );

66 
	`ok1
(
	`èl_add_nŸifõr
(
˘x
, 511, 
nŸify1
));

67 
	`ok1
(
nŸifõd1
 == 0);

68 
	`ok1
(
nŸifõd2
 == 0);

70 
ex≥˘
 = 
TAL_NOTIFY_STEAL
;

71 
ex≥˘_öfo
 = 
NULL
;

72 
	`ok1
(
	`èl_°ól
(
NULL
, 
˘x
) == ctx);

73 
	`ok1
(
nŸifõd1
 == 1);

75 
ex≥˘
 = 
TAL_NOTIFY_ADD_NOTIFIER
;

76 
ex≥˘_öfo
 = 
nŸify2
;

77 
	`ok1
(
	`èl_add_nŸifõr
(
˘x
, 
TAL_NOTIFY_RENAME
|
TAL_NOTIFY_ADD_NOTIFIER


78 |
TAL_NOTIFY_DEL_NOTIFIER
, 
nŸify2
));

79 
	`ok1
(
nŸifõd1
 == 2);

80 
	`ok1
(
nŸifõd2
 == 0);

82 
ex≥˘
 = 
TAL_NOTIFY_RENAME
;

83 
ex≥˘_öfo
 = (*)"newname";

84 
	`ok1
(
	`èl_£t_«me
(
˘x
, (*)
ex≥˘_öfo
));

85 
	`ok1
(
nŸifõd1
 == 3);

86 
	`ok1
(
nŸifõd2
 == 1);

88 
ex≥˘
 = 
TAL_NOTIFY_DEL_NOTIFIER
;

89 
ex≥˘_öfo
 = 
nŸify2
;

90 
	`ok1
(
	`èl_dñ_nŸifõr
(
˘x
, 
nŸify2
));

91 
	`ok1
(
nŸifõd1
 == 4);

92 
	`ok1
(
nŸifõd2
 == 1);

95 
ex≥˘
 = 
TAL_NOTIFY_DEL_NOTIFIER
;

96 
ex≥˘_öfo
 = 
nŸify2
;

97 
	`ok1
(!
	`èl_dñ_nŸifõr
(
˘x
, 
nŸify2
));

98 
	`ok1
(
nŸifõd1
 == 4);

99 
	`ok1
(
nŸifõd2
 == 1);

101 
ex≥˘
 = 
TAL_NOTIFY_ADD_CHILD
;

102 
ex≥˘_öfo
 = &expect_info;

103 
chûd
 = 
	`èl
(
˘x
, );

104 
	`ok1
(
nŸifõd1
 == 5);

105 
	`ok1
(
nŸifõd2
 == 1);

106 
	`ok1
(
ex≥˘_öfo
 =
chûd
);

108 
ex≥˘
 = 
TAL_NOTIFY_DEL_CHILD
;

109 
ex≥˘_öfo
 = 
chûd
;

110 
	`èl_‰ì
(
chûd
);

111 
	`ok1
(
nŸifõd1
 == 6);

112 
	`ok1
(
nŸifõd2
 == 1);

114 
ex≥˘
 = 
TAL_NOTIFY_FREE
;

115 
ex≥˘_öfo
 = 
˘x
;

116 
	`èl_‰ì
(
˘x
);

117 
	`ok1
(
nŸifõd1
 == 7);

118 
	`ok1
(
nŸifõd2
 == 1);

120 
	`èl_£t_backíd
(
NULL
, 
my_ªÆloc
, NULL, NULL);

121 
˘x
 = 
√w_˘x
 = 
	`èl
(
NULL
, );

122 
	`ok1
(
	`èl_add_nŸifõr
(
√w_˘x
, 511, 
ªsize_nŸifõr
));

123 
	`ok1
(
	`èl_ªsize
(&
√w_˘x
, 100));

124 
	`ok1
(
£í_move
);

125 
	`ok1
(
£í_ªsize
);

126 
	`èl_dñ_nŸifõr
(
√w_˘x
, 
ªsize_nŸifõr
);

127 
	`èl_‰ì
(
√w_˘x
);

129 
	`èl_˛ónup
();

130  
	`exô_°©us
();

131 
	}
}

	@ccan/ccan/tal/test/run-overflow.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	gîr‹_cou¡
;

7 
	$my_îr‹
(c⁄° *
msg
)

9 
îr‹_cou¡
++;

10 
	}
}

12 
	$maö
()

14 *
p
;

15 *
pi
, *
‹igpi
;

16 *
˝
;

18 
	`∂™_ã°s
(30);

20 
	`èl_£t_backíd
(
NULL
, NULL, NULL, 
my_îr‹
);

22 
p
 = 
	`èl_¨r
(
NULL
, , (
size_t
)-1);

23 
	`ok1
(!
p
);

24 
	`ok1
(
îr‹_cou¡
 == 1);

26 
p
 = 
	`èl_¨r
(
NULL
, , (
size_t
)-2);

27 
	`ok1
(!
p
);

28 
	`ok1
(
îr‹_cou¡
 == 2);

31 
îr‹_cou¡
 = 0;

32 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

33 
	`ok1
(
‹igpi
);

34 
	`ok1
(
îr‹_cou¡
 == 0);

35 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, (
size_t
)-1, 0);

36 
	`ok1
(!
pi
);

37 
	`ok1
(
îr‹_cou¡
 == 1);

38 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, 0, (
size_t
)-1);

39 
	`ok1
(!
pi
);

40 
	`ok1
(
îr‹_cou¡
 == 2);

42 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, (
size_t
)-1UL / (),

43 (
size_t
)-1UL / ());

44 
	`ok1
(!
pi
);

45 
	`ok1
(
îr‹_cou¡
 == 3);

47 
pi
 = 
	`èl_dup
(
NULL
, , 
‹igpi
, (
size_t
)-1UL / () / 2,

48 (
size_t
)-1UL / () / 2);

49 
	`ok1
(!
pi
);

50 
	`ok1
(
îr‹_cou¡
 == 4);

51 
	`ok1
(
	`èl_fú°
(
NULL
Ë=
‹igpi
 && !
	`èl_√xt
(NULL, origpi));

52 
	`èl_‰ì
(
‹igpi
);

55 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

56 
îr‹_cou¡
 = 0;

57 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), (
size_t
)-1, 0);

58 
	`ok1
(!
pi
);

59 
	`ok1
(
îr‹_cou¡
 == 1);

61 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

62 
îr‹_cou¡
 = 0;

63 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), 0, (
size_t
)-1);

64 
	`ok1
(!
pi
);

65 
	`ok1
(
îr‹_cou¡
 == 1);

66 
	`ok1
(!
	`èl_fú°
(
NULL
));

68 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

69 
îr‹_cou¡
 = 0;

70 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), (
size_t
)-1UL / (),

71 (
size_t
)-1UL / ());

72 
	`ok1
(!
pi
);

73 
	`ok1
(
îr‹_cou¡
 == 1);

74 
	`ok1
(!
	`èl_fú°
(
NULL
));

76 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

77 
îr‹_cou¡
 = 0;

79 
pi
 = 
	`èl_dup
(
NULL
, , 
	`èke
(
‹igpi
), (
size_t
)-1UL / () / 2,

80 (
size_t
)-1UL / () / 2);

81 
	`ok1
(!
pi
);

82 
	`ok1
(
îr‹_cou¡
 == 1);

83 
	`ok1
(!
	`èl_fú°
(
NULL
));

86 
˝
 = 
	`èl_¨r
(
p
, , 100);

87 
	`ok1
(!
	`èl_ex∑nd
(&
˝
, 
NULL
, (
size_t
)-99UL));

88 
	`ok1
(
îr‹_cou¡
 == 2);

89 
	`èl_‰ì
(
˝
);

92 
‹igpi
 = 
	`èl_¨r
(
NULL
, , 100);

93 
	`ok1
(!
	`èl_ex∑nd
(&
‹igpi
, 
NULL
, (
size_t
)-1UL / ()));

94 
	`ok1
(
îr‹_cou¡
 == 3);

95 
	`èl_‰ì
(
‹igpi
);

97 
	`èl_˛ónup
();

98  
	`exô_°©us
();

99 
	}
}

	@ccan/ccan/tal/test/run-resizez.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
;

8 
i
;

10 
	`∂™_ã°s
(1 + 3 * 100 + 98);

12 
∑ª¡
 = 
	`èl
(
NULL
, );

13 
	`ok1
(
∑ª¡
);

15 
i
 = 0; i < 100; i++) {

16 
c
 = 
	`èl_¨r
(
∑ª¡
, , 1);

17 
	`ok1
(
	`èl_ªsizez
(&
c
, 
i
));

18 
	`ok1
(
	`èl_cou¡
(
c
Ë=
i
);

19 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

20 i‡(
i
 > 1)

21 
	`ok1
(
c
[
i
-1] == '\0');

23 
	`èl_‰ì
(
∑ª¡
);

25 
	`èl_˛ónup
();

26  
	`exô_°©us
();

27 
	}
}

	@ccan/ccan/tal/test/run-steal.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
p
[5];

8 
i
;

10 
	`∂™_ã°s
(9);

12 
p
[0] = 
	`èl
(
NULL
, );

13 
i
 = 1; i < 5; i++)

14 
p
[
i
] = 
	`èl
(p[i-1], );

16 
	`èl_check
(
NULL
, "check");

18 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[4]) ==Ö[4]);

19 
	`èl_check
(
NULL
, "check");

21 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[4]) ==Ö[4]);

22 
	`èl_check
(
NULL
, "check");

24 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[1]) ==Ö[1]);

25 
	`èl_check
(
NULL
, "check");

27 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[1]) ==Ö[1]);

28 
	`èl_check
(
NULL
, "check");

30 
	`ok1
(
	`èl_°ól
(
p
[0],Ö[2]) ==Ö[2]);

31 
	`èl_check
(
NULL
, "check");

33 
	`ok1
(
	`èl_∑ª¡
(
p
[1]) ==Ö[0]);

34 
	`ok1
(
	`èl_∑ª¡
(
p
[2]) ==Ö[0]);

35 
	`ok1
(
	`èl_∑ª¡
(
p
[3]) ==Ö[2]);

36 
	`ok1
(
	`èl_∑ª¡
(
p
[4]) ==Ö[0]);

37 
	`èl_‰ì
(
p
[0]);

39 
	`èl_˛ónup
();

40  
	`exô_°©us
();

41 
	}
}

	@ccan/ccan/tal/test/run-take.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
;

9 
	`∂™_ã°s
(21);

12 
	`ok1
(
	`èke
(
NULL
) == NULL);

13 
	`ok1
(
	`is_èkí
(
NULL
));

14 
	`ok1
(
	`èkí
(
NULL
));

15 
	`ok1
(!
	`is_èkí
(
NULL
));

16 
	`ok1
(!
	`èkí
(
NULL
));

18 
∑ª¡
 = 
	`èl
(
NULL
, );

19 
	`ok1
(
∑ª¡
);

21 
	`ok1
(
	`èke
(
∑ª¡
) ==Öarent);

22 
	`ok1
(
	`is_èkí
(
∑ª¡
));

23 
	`ok1
(
	`èkí
(
∑ª¡
));

24 
	`ok1
(!
	`is_èkí
(
∑ª¡
));

25 
	`ok1
(!
	`èkí
(
∑ª¡
));

27 
c
 = 
	`èl
(
∑ª¡
, );

28 *
c
 = 'h';

29 
c
 = 
	`èl_dup
(
∑ª¡
, , 
	`èke
(c), 1, 0);

30 
	`ok1
(
c
[0] == 'h');

31 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

33 
c
 = 
	`èl_dup
(
∑ª¡
, , 
	`èke
(c), 1, 2);

34 
	`ok1
(
c
[0] == 'h');

35 
	`°r˝y
(
c
, "hi");

36 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
∑ª¡
);

39 
c
 = 
	`èl_dup
(
NULL
, , 
	`èke
(c), 1, 0);

40 
	`ok1
(
c
[0] == 'h');

41 
	`ok1
(
	`èl_∑ª¡
(
c
Ë=
NULL
);

44 
	`èl_‰ì
(
c
);

45 
	`ok1
(
	`èl_fú°
(
∑ª¡
Ë=
NULL
);

47 
	`èl_‰ì
(
∑ª¡
);

48 
	`ok1
(!
	`èkí_™y
());

51 
c
 = 
NULL
;

52 
	`ok1
(
	`èl_dup
(
NULL
, , 
	`èke
(
c
), 5, 5) == NULL);

53 
	`ok1
(!
	`èkí_™y
());

55 
	`èl_˛ónup
();

56  
	`exô_°©us
();

57 
	}
}

	@ccan/ccan/tal/test/run-test-backend.c

1 
	~<°dlib.h
>

2 
	~<°dboﬁ.h
>

5 
boﬁ
 
	gmy_Æloc_ˇŒed
;

7 *
	$my_Æloc
(
size_t
 
Àn
)

9 
my_Æloc_ˇŒed
 = 
åue
;

10  (*)
	`mÆloc
(
Àn
 + 16) + 16;

11 
	}
}

13 
	$my_‰ì
(*
p
)

15 i‡(
p
)

16 
	`‰ì
((*)
p
 - 16);

17 
	}
}

19 *
	$my_ªÆloc
(*
ﬁd
, 
size_t
 
√w_size
)

21  (*)
	`ªÆloc
((*)
ﬁd
 - 16, 
√w_size
 + 16) + 16;

22 
	}
}

24 
	#‰ì
 (((*)(*))
ab‹t
)

	)

25 
	#mÆloc
 ((*(*)(
size_t
))
ab‹t
)

	)

26 
	#ªÆloc
 ((*(*)(*, 
size_t
))
ab‹t
)

	)

28 
	~<cˇn/èl/èl.h
>

29 
	~<cˇn/èl/èl.c
>

30 
	~<cˇn/èp/èp.h
>

32 
	#NUM_ALLOCS
 1000

	)

34 
	$de°roy_p
(*
p
)

36 
	}
}

38 
	$maö
()

40 *
p
, *
c
[
NUM_ALLOCS
];

41 
i
;

42 *
«me
;

45 
	`∂™_ã°s
(1);

47 
	`èl_£t_backíd
(
my_Æloc
, 
my_ªÆloc
, 
my_‰ì
, 
NULL
);

49 
p
 = 
	`èl
(
NULL
, );

50 
	`ok1
(
my_Æloc_ˇŒed
);

53 
	`èl_add_de°ru˘‹
(
p
, 
de°roy_p
);

55 
	`èl_£t_«me
(
p
, "test");

56 
«me
 = 
	`èl_¨r
(
NULL
, , 6);

57 
	`°r˝y
(
«me
, "test2");

58 
	`èl_£t_«me
(
p
, 
«me
);

60 
	`èl_£t_«me
(
p
, 
«me
);

61 
	`èl_‰ì
(
«me
);

64 
i
 = 0; i < 
NUM_ALLOCS
; i++)

65 
c
[
i
] = 
	`èl
(
p
, );

68 
i
 = 1; i < 
NUM_ALLOCS
 / 2; i++)

69 
	`èl_°ól
(
c
[0], c[
i
]);

72 
i
 = 
NUM_ALLOCS
 / 2; i < NUM_ALLOCS; i++)

73 
	`èl_‰ì
(
c
[
i
]);

76 
	`èl_‰ì
(
p
);

78 
	`èl_˛ónup
();

79  
	`exô_°©us
();

80 
	}
}

	@ccan/ccan/tal/test/run.c

1 
	~<cˇn/èl/èl.h
>

2 
	~<cˇn/èl/èl.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 *
∑ª¡
, *
c
[4], *
p
;

8 
i
, 
j
;

10 
	`∂™_ã°s
(14);

13 
	`ok1
(
	`èl_‰ì
(
NULL
) == NULL);

15 
∑ª¡
 = 
	`èl
(
NULL
, );

16 
	`ok1
(
∑ª¡
);

17 
	`ok1
(
	`èl_∑ª¡
(
∑ª¡
Ë=
NULL
);

18 
	`ok1
(
	`èl_∑ª¡
(
NULL
) == NULL);

20 
i
 = 0; i < 4; i++)

21 
c
[
i
] = 
	`èl
(
∑ª¡
, );

23 
i
 = 0; i < 4; i++)

24 
	`ok1
(
	`èl_∑ª¡
(
c
[
i
]Ë=
∑ª¡
);

27 
i
 = 0;

28 
p
 = 
	`èl_fú°
(
∑ª¡
);Ö;Ö = 
	`èl_√xt
(parent,Ö)) {

29 *
p
 = '1';

30 
i
++;

32 
	`ok1
(
i
 == 4);

33 
	`ok1
(*
c
[0] == '1');

34 
	`ok1
(*
c
[1] == '1');

35 
	`ok1
(*
c
[2] == '1');

36 
	`ok1
(*
c
[3] == '1');

39 
	`ok1
(
	`èl_‰ì
(
∑ª¡
Ë=
NULL
);

41 
∑ª¡
 = 
	`èl
(
NULL
, );

44 
i
 = 0; i < 4; i++) {

45 
j
 = 0; j < 4; j++)

46 
c
[
j
] = 
	`èl
(
∑ª¡
, );

48 
	`èl_‰ì
(
c
[
i
]);

49 
	`debug_èl
(
	`to_èl_hdr
(
∑ª¡
));

50 
	`èl_‰ì
(
c
[(
i
+1) % 4]);

51 
	`debug_èl
(
	`to_èl_hdr
(
∑ª¡
));

52 
	`èl_‰ì
(
c
[(
i
+2) % 4]);

53 
	`debug_èl
(
	`to_èl_hdr
(
∑ª¡
));

54 
	`èl_‰ì
(
c
[(
i
+3) % 4]);

55 
	`debug_èl
(
	`to_èl_hdr
(
∑ª¡
));

57 
	`èl_‰ì
(
∑ª¡
);

59 
	`èl_˛ónup
();

60  
	`exô_°©us
();

61 
	}
}

	@ccan/ccan/talloc/talloc.c

34 
	~"èŒoc.h
"

35 
	~<°rög.h
>

36 
	~<°döt.h
>

37 
	~<î∫o.h
>

38 
	~<sys/ty≥s.h
>

39 
	~<uni°d.h
>

43 
	#ALWAYS_REALLOC
 0

	)

46 
	#MAX_TALLOC_SIZE
 0x7FFFFFFF

	)

47 
	#TALLOC_MAGIC
 0xe814ec70

	)

48 
	#TALLOC_FLAG_FREE
 0x01

	)

49 
	#TALLOC_FLAG_LOOP
 0x02

	)

50 
	#TALLOC_FLAG_EXT_ALLOC
 0x04

	)

51 
	#TALLOC_MAGIC_REFERENCE
 ((c⁄° *)1)

	)

55 #i‚de‡
TALLOC_ABORT


56 
	#TALLOC_ABORT
(
ªas⁄
Ë
	`ab‹t
()

	)

59 #i‚de‡
disˇrd_c⁄°_p


60 #i‡
deföed
(
INTPTR_MIN
)

61 
	#disˇrd_c⁄°_p
(
ty≥
, 
±r
Ë(—y≥ *)((
öçå_t
)’å)))

	)

63 
	#disˇrd_c⁄°_p
(
ty≥
, 
±r
Ë(—y≥ *)’å))

	)

68 #i‡
HAVE_BUILTIN_EXPECT


71 
	#likñy
(
x
Ë
	`__buûtö_ex≥˘
(!!(x), 1)

	)

72 
	#u∆ikñy
(
x
Ë
	`__buûtö_ex≥˘
(!!(x), 0)

	)

74 
	#likñy
(
x
Ë
	)
x

75 
	#u∆ikñy
(
x
Ë
	)
x

82 *
	gnuŒ_c⁄ãxt
;

83 
pid_t
 *
	gauto‰ì_c⁄ãxt
;

85 *(*
	gtc_mÆloc
)(
size_t
 
	gsize
Ë
mÆloc
;

86 (*
tc_‰ì
)(*
±r
Ë
‰ì
;

87 *(*
tc_ªÆloc
)(*
±r
, 
size_t
 
size
Ë
ªÆloc
;

89 *(*
tc_exã∫Æ_ªÆloc
)(c⁄° *
∑ª¡
, *
±r
, 
size_t
 
size
);

90 (*
tc_lock
)(c⁄° *
˘x
);

91 (*
tc_u∆ock
)();

93 
	sèŒoc_ª„ªn˚_h™dÀ
 {

94 
èŒoc_ª„ªn˚_h™dÀ
 *
√xt
, *
¥ev
;

95 *
±r
;

98 (*
	tèŒoc_de°ru˘‹_t
)(*);

100 
	sèŒoc_chunk
 {

101 
èŒoc_chunk
 *
√xt
, *
¥ev
;

102 
èŒoc_chunk
 *
∑ª¡
, *
chûd
;

103 
èŒoc_ª„ªn˚_h™dÀ
 *
ªfs
;

104 
èŒoc_de°ru˘‹_t
 
de°ru˘‹
;

105 c⁄° *
«me
;

106 
size_t
 
size
;

107 
Êags
;

111 
	#TC_HDR_SIZE
 (((
èŒoc_chunk
)+15)&~15)

	)

112 
	#TC_PTR_FROM_CHUNK
(
tc
Ë((*)(
TC_HDR_SIZE
 + (*Èc))

	)

115 
ölöe
 
èŒoc_chunk
 *
	$èŒoc_chunk_‰om_±r
(c⁄° *
±r
)

117 c⁄° *
µ
 = (c⁄° *)
±r
;

118 
èŒoc_chunk
 *
tc
 = 
	`disˇrd_c⁄°_p
(èŒoc_chunk, 
µ
 - 
TC_HDR_SIZE
);

119 i‡(
	`u∆ikñy
((
tc
->
Êags
 & (
TALLOC_FLAG_FREE
 | ~0xF)Ë!
TALLOC_MAGIC
)) {

120 i‡(
tc
->
Êags
 & 
TALLOC_FLAG_FREE
) {

121 
	`TALLOC_ABORT
("BadÅalloc magic value - double free");

123 
	`TALLOC_ABORT
("BadÅalloc magic value - unknown value");

126  
tc
;

127 
	}
}

130 
	#_TLIST_ADD
(
li°
, 
p
) \

132 i‡(!(
li°
)) { \

133 (
li°
Ë(
p
); \

134 (
p
)->
√xt
 = (p)->
¥ev
 = 
NULL
; \

136 (
li°
)->
¥ev
 = (
p
); \

137 (
p
)->
√xt
 = (
li°
); \

138 (
p
)->
¥ev
 = 
NULL
; \

139 (
li°
Ë(
p
); \

141 } 0)

	)

144 
	#_TLIST_REMOVE
(
li°
, 
p
) \

146 i‡((
p
Ë=(
li°
)) { \

147 (
li°
Ë(
p
)->
√xt
; \

148 i‡(
li°
Ë÷i°)->
¥ev
 = 
NULL
; \

150 i‡((
p
)->
¥ev
Ë’)->¥ev->
√xt
 = (p)->next; \

151 i‡((
p
)->
√xt
Ë’)->√xt->
¥ev
 = (p)->prev; \

153 i‡((
p
Ë&& (’Ë!(
li°
))Ë’)->
√xt
 = (p)->
¥ev
 = 
NULL
; \

154 } 0)

	)

156 
	glocked
;

157 
ölöe
 
	$lock
(c⁄° *
p
)

159 i‡(
tc_lock
 && 
p
) {

160 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
p
);

162 i‡(
tc
->
Êags
 & 
TALLOC_FLAG_EXT_ALLOC
) {

163 i‡(
locked
)

164 
	`TALLOC_ABORT
("nestedÜocking");

165 
	`tc_lock
(
tc
);

166 
locked
 = 1;

169 
	}
}

171 
ölöe
 
	$u∆ock
()

173 i‡(
locked
) {

174 
	`tc_u∆ock
();

175 
locked
 = 0;

177 
	}
}

182 
ölöe
 
èŒoc_chunk
 *
	$èŒoc_∑ª¡_chunk
(c⁄° *
±r
)

184 
èŒoc_chunk
 *
tc
;

186 i‡(
	`u∆ikñy
(
±r
 =
NULL
)) {

187  
NULL
;

190 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

191 
tc
->
¥ev
)Åc=tc->prev;

193  
tc
->
∑ª¡
;

194 
	}
}

197 *
	$èŒoc_∑ª¡_nﬁock
(c⁄° *
±r
)

199 
èŒoc_chunk
 *
tc
;

201 
tc
 = 
	`èŒoc_∑ª¡_chunk
(
±r
);

202  
tc
 ? 
	`TC_PTR_FROM_CHUNK
—cË: 
NULL
;

203 
	}
}

205 *
	$èŒoc_∑ª¡
(c⁄° *
±r
)

207 *
∑ª¡
;

209 
	`lock
(
±r
);

210 
∑ª¡
 = 
	`èŒoc_∑ª¡_nﬁock
(
±r
);

211 
	`u∆ock
();

212  
∑ª¡
;

213 
	}
}

218 c⁄° *
	$èŒoc_∑ª¡_«me
(c⁄° *
±r
)

220 
èŒoc_chunk
 *
tc
;

222 
	`lock
(
±r
);

223 
tc
 = 
	`èŒoc_∑ª¡_chunk
(
±r
);

224 
	`u∆ock
();

226  
tc
?Åc->
«me
 : 
NULL
;

227 
	}
}

229 *
	$öô_èŒoc
(
èŒoc_chunk
 *
∑ª¡
,

230 
èŒoc_chunk
 *
tc
,

231 
size_t
 
size
, 
exã∫Æ
)

233 i‡(
	`u∆ikñy
(
tc
 =
NULL
))

234  
NULL
;

236 
tc
->
size
 = size;

237 
tc
->
Êags
 = 
TALLOC_MAGIC
;

238 i‡(
exã∫Æ
)

239 
tc
->
Êags
 |
TALLOC_FLAG_EXT_ALLOC
;

240 
tc
->
de°ru˘‹
 = 
NULL
;

241 
tc
->
chûd
 = 
NULL
;

242 
tc
->
«me
 = 
NULL
;

243 
tc
->
ªfs
 = 
NULL
;

245 i‡(
	`likñy
(
∑ª¡
)) {

246 i‡(
∑ª¡
->
chûd
) {

247 
∑ª¡
->
chûd
->∑ª¡ = 
NULL
;

248 
tc
->
√xt
 = 
∑ª¡
->
chûd
;

249 
tc
->
√xt
->
¥ev
 =Åc;

251 
tc
->
√xt
 = 
NULL
;

253 
tc
->
∑ª¡
 =Öarent;

254 
tc
->
¥ev
 = 
NULL
;

255 
∑ª¡
->
chûd
 = 
tc
;

257 
tc
->
√xt
 =Åc->
¥ev
 =Åc->
∑ª¡
 = 
NULL
;

260  
	`TC_PTR_FROM_CHUNK
(
tc
);

261 
	}
}

266 
ölöe
 *
	$__èŒoc
(c⁄° *
c⁄ãxt
, 
size_t
 
size
)

268 
èŒoc_chunk
 *
tc
;

269 
èŒoc_chunk
 *
∑ª¡
 = 
NULL
;

270 
exã∫Æ
 = 0;

272 i‡(
	`u∆ikñy
(
c⁄ãxt
 =
NULL
)) {

273 
c⁄ãxt
 = 
nuŒ_c⁄ãxt
;

276 i‡(
	`u∆ikñy
(
size
 >
MAX_TALLOC_SIZE
)) {

277  
NULL
;

280 i‡(
	`likñy
(
c⁄ãxt
)) {

281 
∑ª¡
 = 
	`èŒoc_chunk_‰om_±r
(
c⁄ãxt
);

282 i‡(
	`u∆ikñy
(
∑ª¡
->
Êags
 & 
TALLOC_FLAG_EXT_ALLOC
)) {

283 
tc
 = 
	`tc_exã∫Æ_ªÆloc
(
c⁄ãxt
, 
NULL
,

284 
TC_HDR_SIZE
+
size
);

285 
exã∫Æ
 = 1;

286 
Æloc_d⁄e
;

290 
tc
 = (
èŒoc_chunk
 *)
	`tc_mÆloc
(
TC_HDR_SIZE
+
size
);

291 
Æloc_d⁄e
:

292  
	`öô_èŒoc
(
∑ª¡
, 
tc
, 
size
, 
exã∫Æ
);

293 
	}
}

301 
_èŒoc_£t_de°ru˘‹
(c⁄° *
±r
, (*
de°ru˘‹
)(*))

303 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

304 
tc
->
de°ru˘‹
 = destructor;

305 
	}
}

310 
	$èŒoc_ö¸ó£_ªf_cou¡
(c⁄° *
±r
)

312 i‡(
	`u∆ikñy
(!
	`èŒoc_ª„ªn˚
(
nuŒ_c⁄ãxt
, 
±r
))) {

316 
	}
}

323 
	$èŒoc_ª„ªn˚_de°ru˘‹
(
èŒoc_ª„ªn˚_h™dÀ
 *
h™dÀ
)

325 
èŒoc_chunk
 *
±r_tc
 = 
	`èŒoc_chunk_‰om_±r
(
h™dÀ
->
±r
);

326 
	`_TLIST_REMOVE
(
±r_tc
->
ªfs
, 
h™dÀ
);

328 
	}
}

334 
ölöe
 
	$_èŒoc_£t_«me_c⁄°
(c⁄° *
±r
, c⁄° *
«me
)

336 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

337 
tc
->
«me
 =Çame;

338 
	}
}

343 
ölöe
 *
	$_èŒoc_«med_c⁄°
(c⁄° *
c⁄ãxt
, 
size_t
 
size
, c⁄° *
«me
)

345 *
±r
;

347 
±r
 = 
	`__èŒoc
(
c⁄ãxt
, 
size
);

348 i‡(
	`u∆ikñy
(
±r
 =
NULL
)) {

349  
NULL
;

352 
	`_èŒoc_£t_«me_c⁄°
(
±r
, 
«me
);

354  
±r
;

355 
	}
}

366 *
	$_èŒoc_ª„ªn˚
(c⁄° *
c⁄ãxt
, c⁄° *
±r
)

368 
èŒoc_chunk
 *
tc
;

369 
èŒoc_ª„ªn˚_h™dÀ
 *
h™dÀ
;

370 i‡(
	`u∆ikñy
(
±r
 =
NULL
))  NULL;

372 
	`lock
(
c⁄ãxt
);

373 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

374 
h™dÀ
 = (
èŒoc_ª„ªn˚_h™dÀ
 *)
	`_èŒoc_«med_c⁄°
(
c⁄ãxt
,

375 (
èŒoc_ª„ªn˚_h™dÀ
),

376 
TALLOC_MAGIC_REFERENCE
);

377 i‡(
	`u∆ikñy
(
h™dÀ
 =
NULL
)) {

378 
	`u∆ock
();

379  
NULL
;

385 
	`èŒoc_£t_de°ru˘‹
(
h™dÀ
, 
èŒoc_ª„ªn˚_de°ru˘‹
);

386 
h™dÀ
->
±r
 = 
	`disˇrd_c⁄°_p
(,Ötr);

387 
	`_TLIST_ADD
(
tc
->
ªfs
, 
h™dÀ
);

388 
	`u∆ock
();

389  
h™dÀ
->
±r
;

390 
	}
}

395 
	$_èŒoc_is_∑ª¡
(c⁄° *
c⁄ãxt
, c⁄° *
±r
)

397 
èŒoc_chunk
 *
tc
;

399 i‡(
c⁄ãxt
 =
NULL
) {

403 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
c⁄ãxt
);

404 
tc
) {

405 i‡(
	`TC_PTR_FROM_CHUNK
(
tc
Ë=
±r
) {

408 
tc
 &&Åc->
¥ev
)Åc =Åc->prev;

409 i‡(
tc
) {

410 
tc
 =Åc->
∑ª¡
;

414 
	}
}

421 *
	$__èŒoc_°ól
(c⁄° *
√w_˘x
, c⁄° *
±r
)

423 
èŒoc_chunk
 *
tc
, *
√w_tc
;

425 i‡(
	`u∆ikñy
(!
±r
)) {

426  
NULL
;

429 i‡(
	`u∆ikñy
(
√w_˘x
 =
NULL
)) {

430 
√w_˘x
 = 
nuŒ_c⁄ãxt
;

433 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

435 i‡(
	`u∆ikñy
(
√w_˘x
 =
NULL
)) {

436 i‡(
tc
->
∑ª¡
) {

437 
	`_TLIST_REMOVE
(
tc
->
∑ª¡
->
chûd
,Åc);

438 i‡(
tc
->
∑ª¡
->
chûd
) {

439 
tc
->
∑ª¡
->
chûd
->parent =Åc->parent;

442 i‡(
tc
->
¥ev
Ëtc->¥ev->
√xt
 =Åc->next;

443 i‡(
tc
->
√xt
Ëtc->√xt->
¥ev
 =Åc->prev;

446 
tc
->
∑ª¡
 =Åc->
√xt
 =Åc->
¥ev
 = 
NULL
;

447  
	`disˇrd_c⁄°_p
(, 
±r
);

450 
√w_tc
 = 
	`èŒoc_chunk_‰om_±r
(
√w_˘x
);

452 i‡(
	`u∆ikñy
(
tc
 =
√w_tc
 ||Åc->
∑ª¡
 ==Çew_tc)) {

453  
	`disˇrd_c⁄°_p
(, 
±r
);

456 i‡(
tc
->
∑ª¡
) {

457 
	`_TLIST_REMOVE
(
tc
->
∑ª¡
->
chûd
,Åc);

458 i‡(
tc
->
∑ª¡
->
chûd
) {

459 
tc
->
∑ª¡
->
chûd
->parent =Åc->parent;

462 i‡(
tc
->
¥ev
Ëtc->¥ev->
√xt
 =Åc->next;

463 i‡(
tc
->
√xt
Ëtc->√xt->
¥ev
 =Åc->prev;

466 
tc
->
∑ª¡
 = 
√w_tc
;

467 i‡(
√w_tc
->
chûd
Ë√w_tc->chûd->
∑ª¡
 = 
NULL
;

468 
	`_TLIST_ADD
(
√w_tc
->
chûd
, 
tc
);

470  
	`disˇrd_c⁄°_p
(, 
±r
);

471 
	}
}

476 
ölöe
 
	$_èŒoc_‰ì
(c⁄° *
±r
)

478 
èŒoc_chunk
 *
tc
;

479 *
ﬁd∑ª¡
 = 
NULL
;

481 i‡(
	`u∆ikñy
(
±r
 =
NULL
)) {

485 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

487 i‡(
	`u∆ikñy
(
tc
->
ªfs
)) {

488 
is_chûd
;

496 
is_chûd
 = 
	`_èŒoc_is_∑ª¡
(
tc
->
ªfs
, 
±r
);

497 
	`_èŒoc_‰ì
(
tc
->
ªfs
);

498 i‡(
is_chûd
) {

499  
	`_èŒoc_‰ì
(
±r
);

504 i‡(
	`u∆ikñy
(
tc
->
Êags
 & 
TALLOC_FLAG_LOOP
)) {

509 i‡(
	`u∆ikñy
(
tc
->
de°ru˘‹
)) {

510 
èŒoc_de°ru˘‹_t
 
d
 = 
tc
->
de°ru˘‹
;

511 i‡(
d
 =(
èŒoc_de°ru˘‹_t
)-1) {

514 
tc
->
de°ru˘‹
 = (
èŒoc_de°ru˘‹_t
)-1;

515 i‡(
	`d
(
	`disˇrd_c⁄°_p
(, 
±r
)) == -1) {

516 
tc
->
de°ru˘‹
 = 
d
;

519 
tc
->
de°ru˘‹
 = 
NULL
;

522 i‡(
	`u∆ikñy
(
tc
->
Êags
 & 
TALLOC_FLAG_EXT_ALLOC
))

523 
ﬁd∑ª¡
 = 
	`èŒoc_∑ª¡_nﬁock
(
±r
);

525 i‡(
tc
->
∑ª¡
) {

526 
	`_TLIST_REMOVE
(
tc
->
∑ª¡
->
chûd
,Åc);

527 i‡(
tc
->
∑ª¡
->
chûd
) {

528 
tc
->
∑ª¡
->
chûd
->parent =Åc->parent;

531 i‡(
tc
->
¥ev
Ëtc->¥ev->
√xt
 =Åc->next;

532 i‡(
tc
->
√xt
Ëtc->√xt->
¥ev
 =Åc->prev;

535 
tc
->
Êags
 |
TALLOC_FLAG_LOOP
;

537 
tc
->
chûd
) {

543 *
chûd
 = 
	`TC_PTR_FROM_CHUNK
(
tc
->child);

544 c⁄° *
√w_∑ª¡
 = 
nuŒ_c⁄ãxt
;

545 
èŒoc_chunk
 *
ﬁd_∑ª¡
 = 
NULL
;

546 i‡(
	`u∆ikñy
(
tc
->
chûd
->
ªfs
)) {

547 
èŒoc_chunk
 *
p
 = 
	`èŒoc_∑ª¡_chunk
(
tc
->
chûd
->
ªfs
);

548 i‡(
p
Ë
√w_∑ª¡
 = 
	`TC_PTR_FROM_CHUNK
(p);

561 i‡(
√w_∑ª¡
 =
nuŒ_c⁄ãxt
 && (
tc
->
chûd
->
ªfs
 ||Åc->chûd->
de°ru˘‹
)) {

562 
ﬁd_∑ª¡
 = 
	`èŒoc_∑ª¡_chunk
(
±r
);

564 i‡(
	`u∆ikñy
(
	`_èŒoc_‰ì
(
chûd
) == -1)) {

565 i‡(
√w_∑ª¡
 =
nuŒ_c⁄ãxt
) {

566 
èŒoc_chunk
 *
p
 = 
ﬁd_∑ª¡
;

567 i‡(
p
Ë
√w_∑ª¡
 = 
	`TC_PTR_FROM_CHUNK
(p);

569 
	`__èŒoc_°ól
(
√w_∑ª¡
, 
chûd
);

573 
tc
->
Êags
 |
TALLOC_FLAG_FREE
;

575 i‡(
	`u∆ikñy
(
tc
->
Êags
 & 
TALLOC_FLAG_EXT_ALLOC
))

576 
	`tc_exã∫Æ_ªÆloc
(
ﬁd∑ª¡
, 
tc
, 0);

578 
	`tc_‰ì
(
tc
);

581 
	}
}

583 *
	$_èŒoc_°ól
(c⁄° *
√w_˘x
, c⁄° *
±r
)

585 *
p
;

587 
	`lock
(
√w_˘x
);

588 
p
 = 
	`__èŒoc_°ól
(
√w_˘x
, 
±r
);

589 
	`u∆ock
();

590  
p
;

591 
	}
}

598 
ölöe
 
	$èŒoc_uƒe„ªn˚
(c⁄° *
c⁄ãxt
, c⁄° *
±r
)

600 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

601 
èŒoc_ª„ªn˚_h™dÀ
 *
h
;

603 i‡(
	`u∆ikñy
(
c⁄ãxt
 =
NULL
)) {

604 
c⁄ãxt
 = 
nuŒ_c⁄ãxt
;

607 
h
=
tc
->
ªfs
;h;h=h->
√xt
) {

608 
èŒoc_chunk
 *
p
 = 
	`èŒoc_∑ª¡_chunk
(
h
);

609 i‡(
p
 =
NULL
) {

610 i‡(
c⁄ãxt
 =
NULL
) ;

611 } i‡(
	`TC_PTR_FROM_CHUNK
(
p
Ë=
c⁄ãxt
) {

615 i‡(
h
 =
NULL
) {

619  
	`_èŒoc_‰ì
(
h
);

620 
	}
}

626 
	$èŒoc_u∆ök
(c⁄° *
c⁄ãxt
, *
±r
)

628 
èŒoc_chunk
 *
tc_p
, *
√w_p
;

629 *
√w_∑ª¡
;

631 i‡(
±r
 =
NULL
) {

635 i‡(
c⁄ãxt
 =
NULL
) {

636 
c⁄ãxt
 = 
nuŒ_c⁄ãxt
;

639 
	`lock
(
c⁄ãxt
);

640 i‡(
	`èŒoc_uƒe„ªn˚
(
c⁄ãxt
, 
±r
) == 0) {

641 
	`u∆ock
();

645 i‡(
c⁄ãxt
 =
NULL
) {

646 i‡(
	`èŒoc_∑ª¡_chunk
(
±r
Ë!
NULL
) {

647 
	`u∆ock
();

651 i‡(
	`èŒoc_chunk_‰om_±r
(
c⁄ãxt
Ë!
	`èŒoc_∑ª¡_chunk
(
±r
)) {

652 
	`u∆ock
();

657 
tc_p
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

659 i‡(
tc_p
->
ªfs
 =
NULL
) {

660 
ªt
 = 
	`_èŒoc_‰ì
(
±r
);

661 
	`u∆ock
();

662  
ªt
;

665 
√w_p
 = 
	`èŒoc_∑ª¡_chunk
(
tc_p
->
ªfs
);

666 i‡(
√w_p
) {

667 
√w_∑ª¡
 = 
	`TC_PTR_FROM_CHUNK
(
√w_p
);

669 
√w_∑ª¡
 = 
NULL
;

672 i‡(
	`èŒoc_uƒe„ªn˚
(
√w_∑ª¡
, 
±r
) != 0) {

673 
	`u∆ock
();

677 
	`__èŒoc_°ól
(
√w_∑ª¡
, 
±r
);

678 
	`u∆ock
();

681 
	}
}

686 
ölöe
 c⁄° *
	$èŒoc_£t_«me_v
(c⁄° *
±r
, c⁄° *
fmt
, 
va_li°
 
≠
Ë
	`PRINTF_FMT
(2,0);

688 
ölöe
 c⁄° *
	$èŒoc_£t_«me_v
(c⁄° *
±r
, c⁄° *
fmt
, 
va_li°
 
≠
)

690 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

691 
tc
->
«me
 = 
	`èŒoc_va•rötf
(
±r
, 
fmt
, 
≠
);

692 i‡(
	`likñy
(
tc
->
«me
)) {

693 
	`_èŒoc_£t_«me_c⁄°
(
tc
->
«me
, ".name");

695  
tc
->
«me
;

696 
	}
}

701 c⁄° *
	$èŒoc_£t_«me
(c⁄° *
±r
, c⁄° *
fmt
, ...)

703 c⁄° *
«me
;

704 
va_li°
 
≠
;

705 
	`va_°¨t
(
≠
, 
fmt
);

706 
«me
 = 
	`èŒoc_£t_«me_v
(
±r
, 
fmt
, 
≠
);

707 
	`va_íd
(
≠
);

708  
«me
;

709 
	}
}

717 *
	$èŒoc_«med
(c⁄° *
c⁄ãxt
, 
size_t
 
size
, c⁄° *
fmt
, ...)

719 
va_li°
 
≠
;

720 *
±r
;

721 c⁄° *
«me
;

723 
	`lock
(
c⁄ãxt
);

724 
±r
 = 
	`__èŒoc
(
c⁄ãxt
, 
size
);

725 
	`u∆ock
();

726 i‡(
	`u∆ikñy
(
±r
 =
NULL
))  NULL;

728 
	`va_°¨t
(
≠
, 
fmt
);

729 
«me
 = 
	`èŒoc_£t_«me_v
(
±r
, 
fmt
, 
≠
);

730 
	`va_íd
(
≠
);

732 i‡(
	`u∆ikñy
(
«me
 =
NULL
)) {

733 
	`èŒoc_‰ì
(
±r
);

734  
NULL
;

737  
±r
;

738 
	}
}

743 c⁄° *
	$èŒoc_gë_«me
(c⁄° *
±r
)

745 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

746 i‡(
	`u∆ikñy
(
tc
->
«me
 =
TALLOC_MAGIC_REFERENCE
)) {

749 i‡(
	`likñy
(
tc
->
«me
)) {

750  
tc
->
«me
;

753 
	}
}

760 *
	$èŒoc_check_«me
(c⁄° *
±r
, c⁄° *
«me
)

762 c⁄° *
≤ame
;

763 i‡(
	`u∆ikñy
(
±r
 =
NULL
))  NULL;

764 
≤ame
 = 
	`èŒoc_gë_«me
(
±r
);

765 i‡(
	`likñy
(
≤ame
 =
«me
 || 
	`°rcmp
(pname,Çame) == 0)) {

766  
	`disˇrd_c⁄°_p
(, 
±r
);

768  
NULL
;

769 
	}
}

775 *
	$èŒoc_öô
(c⁄° *
fmt
, ...)

777 
va_li°
 
≠
;

778 *
±r
;

779 c⁄° *
«me
;

786 
	`èŒoc_íabÀ_nuŒ_åackög
();

788 
±r
 = 
	`__èŒoc
(
NULL
, 0);

789 i‡(
	`u∆ikñy
(
±r
 =
NULL
))  NULL;

791 
	`va_°¨t
(
≠
, 
fmt
);

792 
«me
 = 
	`èŒoc_£t_«me_v
(
±r
, 
fmt
, 
≠
);

793 
	`va_íd
(
≠
);

795 i‡(
	`u∆ikñy
(
«me
 =
NULL
)) {

796 
	`èŒoc_‰ì
(
±r
);

797  
NULL
;

800  
±r
;

801 
	}
}

806 *
	$_èŒoc
(c⁄° *
c⁄ãxt
, 
size_t
 
size
)

808  
	`__èŒoc
(
c⁄ãxt
, 
size
);

809 
	}
}

811 
	$èŒoc_de°roy_poöãr
(***
µå
)

813 i‡((
uöçå_t
)**
µå
 < 
	`gë∑gesize
())

814 
	`TALLOC_ABORT
("Double free or invalidÅalloc_set?");

816 **
µå
 = (*)1;

818 
	}
}

820 
	$_èŒoc_£t
(*
±r
, c⁄° *
˘x
, 
size_t
 
size
, c⁄° *
«me
)

822 ***
chûd
;

823 *
p
;

825 
p
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 
size
, 
«me
);

826 i‡(
	`u∆ikñy
(!
p
))

827 
£t_±r
;

829 
chûd
 = 
	`èŒoc
(
p
, **);

830 i‡(
	`u∆ikñy
(!
chûd
)) {

831 
	`èŒoc_‰ì
(
p
);

832 
p
 = 
NULL
;

833 
£t_±r
;

835 *
chûd
 = 
±r
;

836 
	`èŒoc_£t_«me_c⁄°
(
chûd
, "talloc_set destructor");

837 
	`èŒoc_£t_de°ru˘‹
(
chûd
, 
èŒoc_de°roy_poöãr
);

839 
£t_±r
:

841 
	`mem˝y
(
±r
, &
p
, (p));

842 
	}
}

847 
	$èŒoc_£t_«me_c⁄°
(c⁄° *
±r
, c⁄° *
«me
)

849 
	`_èŒoc_£t_«me_c⁄°
(
±r
, 
«me
);

850 
	}
}

857 *
	$èŒoc_«med_c⁄°
(c⁄° *
c⁄ãxt
, 
size_t
 
size
, c⁄° *
«me
)

859 *
p
;

860 
	`lock
(
c⁄ãxt
);

861 
p
 = 
	`_èŒoc_«med_c⁄°
(
c⁄ãxt
, 
size
, 
«me
);

862 
	`u∆ock
();

863  
p
;

864 
	}
}

874 
	$èŒoc_‰ì
(c⁄° *
±r
)

876 
ßved_î∫o
 = 
î∫o
, 
ªt
;

878 
	`lock
(
±r
);

879 
ªt
 = 
	`_èŒoc_‰ì
(
	`disˇrd_c⁄°_p
(, 
±r
));

880 
	`u∆ock
();

881 i‡(
ªt
 == 0)

882 
î∫o
 = 
ßved_î∫o
;

883  
ªt
;

884 
	}
}

892 *
	$_èŒoc_ªÆloc
(c⁄° *
c⁄ãxt
, *
±r
, 
size_t
 
size
, c⁄° *
«me
)

894 
èŒoc_chunk
 *
tc
;

895 *
√w_±r
;

898 i‡(
	`u∆ikñy
(
size
 == 0)) {

899 
	`èŒoc_‰ì
(
±r
);

900  
NULL
;

903 i‡(
	`u∆ikñy
(
size
 >
MAX_TALLOC_SIZE
)) {

904  
NULL
;

908 i‡(
±r
 =
NULL
) {

909  
	`èŒoc_«med_c⁄°
(
c⁄ãxt
, 
size
, 
«me
);

912 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

915 i‡(
	`u∆ikñy
(
tc
->
ªfs
)) {

916  
NULL
;

919 
	`lock
(
±r
);

920 i‡(
	`u∆ikñy
(
tc
->
Êags
 & 
TALLOC_FLAG_EXT_ALLOC
)) {

922 *
∑ª¡
 = 
	`èŒoc_∑ª¡_nﬁock
(
±r
);

923 
tc
->
Êags
 |
TALLOC_FLAG_FREE
;

924 
√w_±r
 = 
	`tc_exã∫Æ_ªÆloc
(
∑ª¡
, 
tc
, 
size
 + 
TC_HDR_SIZE
);

927 
tc
->
Êags
 |
TALLOC_FLAG_FREE
;

929 #i‡
ALWAYS_REALLOC


930 
√w_±r
 = 
	`tc_mÆloc
(
size
 + 
TC_HDR_SIZE
);

931 i‡(
√w_±r
) {

932 
	`mem˝y
(
√w_±r
, 
tc
,Åc->
size
 + 
TC_HDR_SIZE
);

933 
	`tc_‰ì
(
tc
);

936 
√w_±r
 = 
	`tc_ªÆloc
(
tc
, 
size
 + 
TC_HDR_SIZE
);

940 i‡(
	`u∆ikñy
(!
√w_±r
)) {

941 
tc
->
Êags
 &~
TALLOC_FLAG_FREE
;

942 
	`u∆ock
();

943  
NULL
;

946 
tc
 = (
èŒoc_chunk
 *)
√w_±r
;

947 
tc
->
Êags
 &~
TALLOC_FLAG_FREE
;

948 i‡(
tc
->
∑ª¡
) {

949 
tc
->
∑ª¡
->
chûd
 =Åc;

951 i‡(
tc
->
chûd
) {

952 
tc
->
chûd
->
∑ª¡
 =Åc;

955 i‡(
tc
->
¥ev
) {

956 
tc
->
¥ev
->
√xt
 =Åc;

958 i‡(
tc
->
√xt
) {

959 
tc
->
√xt
->
¥ev
 =Åc;

962 
tc
->
size
 = size;

963 
	`_èŒoc_£t_«me_c⁄°
(
	`TC_PTR_FROM_CHUNK
(
tc
), 
«me
);

964 
	`u∆ock
();

966  
	`TC_PTR_FROM_CHUNK
(
tc
);

967 
	}
}

973 *
	$_èŒoc_move
(c⁄° *
√w_˘x
, c⁄° *
_µå
)

975 c⁄° **
µå
 = 
	`disˇrd_c⁄°_p
(c⁄° *,
_µå
);

976 *
ªt
 = 
	`_èŒoc_°ól
(
√w_˘x
, *
µå
);

977 (*
µå
Ë
NULL
;

978  
ªt
;

979 
	}
}

984 
size_t
 
	$_èŒoc_tŸÆ_size
(c⁄° *
±r
)

986 
size_t
 
tŸÆ
 = 0;

987 
èŒoc_chunk
 *
c
, *
tc
;

989 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

991 i‡(
tc
->
Êags
 & 
TALLOC_FLAG_LOOP
) {

995 
tc
->
Êags
 |
TALLOC_FLAG_LOOP
;

997 
tŸÆ
 = 
tc
->
size
;

998 
c
=
tc
->
chûd
;c;c=c->
√xt
) {

999 
tŸÆ
 +
	`_èŒoc_tŸÆ_size
(
	`TC_PTR_FROM_CHUNK
(
c
));

1002 
tc
->
Êags
 &~
TALLOC_FLAG_LOOP
;

1004  
tŸÆ
;

1005 
	}
}

1007 
size_t
 
	$èŒoc_tŸÆ_size
(c⁄° *
±r
)

1009 
size_t
 
tŸÆ
;

1011 i‡(
±r
 =
NULL
) {

1012 
±r
 = 
nuŒ_c⁄ãxt
;

1014 i‡(
±r
 =
NULL
) {

1018 
	`lock
(
±r
);

1019 
tŸÆ
 = 
	`_èŒoc_tŸÆ_size
(
±r
);

1020 
	`u∆ock
();

1021  
tŸÆ
;

1022 
	}
}

1027 
size_t
 
	$_èŒoc_tŸÆ_blocks
(c⁄° *
±r
)

1029 
size_t
 
tŸÆ
 = 0;

1030 
èŒoc_chunk
 *
c
, *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

1032 i‡(
tc
->
Êags
 & 
TALLOC_FLAG_LOOP
) {

1036 
tc
->
Êags
 |
TALLOC_FLAG_LOOP
;

1038 
tŸÆ
++;

1039 
c
=
tc
->
chûd
;c;c=c->
√xt
) {

1040 
tŸÆ
 +
	`_èŒoc_tŸÆ_blocks
(
	`TC_PTR_FROM_CHUNK
(
c
));

1043 
tc
->
Êags
 &~
TALLOC_FLAG_LOOP
;

1045  
tŸÆ
;

1046 
	}
}

1048 
size_t
 
	$èŒoc_tŸÆ_blocks
(c⁄° *
±r
)

1050 
size_t
 
tŸÆ
;

1052 
	`lock
(
±r
);

1053 
tŸÆ
 = 
	`_èŒoc_tŸÆ_blocks
(
±r
);

1054 
	`u∆ock
();

1056  
tŸÆ
;

1057 
	}
}

1059 
size_t
 
	$_èŒoc_ª„ªn˚_cou¡
(c⁄° *
±r
)

1061 
èŒoc_chunk
 *
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

1062 
èŒoc_ª„ªn˚_h™dÀ
 *
h
;

1063 
size_t
 
ªt
 = 0;

1065 
h
=
tc
->
ªfs
;h;h=h->
√xt
) {

1066 
ªt
++;

1068  
ªt
;

1069 
	}
}

1074 
size_t
 
	$èŒoc_ª„ªn˚_cou¡
(c⁄° *
±r
)

1076 
size_t
 
ªt
;

1078 
	`lock
(
	`èŒoc_chunk_‰om_±r
(
±r
));

1079 
ªt
 = 
	`_èŒoc_ª„ªn˚_cou¡
(
±r
);

1080 
	`u∆ock
();

1081  
ªt
;

1082 
	}
}

1087 
_èŒoc_ªp‹t_dïth_cb
(c⁄° *
±r
, 
dïth
, 
max_dïth
,

1088 (*
ˇŒback
)(c⁄° *
±r
,

1089 
dïth
, 
max_dïth
,

1090 
is_ªf
,

1091 *
¥iv©e_d©a
),

1092 *
¥iv©e_d©a
)

1094 
èŒoc_chunk
 *
c
, *
tc
;

1096 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
±r
);

1098 i‡(
tc
->
Êags
 & 
TALLOC_FLAG_LOOP
) {

1102 
	`ˇŒback
(
±r
, 
dïth
, 
max_dïth
, 0, 
¥iv©e_d©a
);

1104 i‡(
max_dïth
 >0 && 
dïth
 >= max_depth) {

1108 
tc
->
Êags
 |
TALLOC_FLAG_LOOP
;

1109 
c
=
tc
->
chûd
;c;c=c->
√xt
) {

1110 i‡(
c
->
«me
 =
TALLOC_MAGIC_REFERENCE
) {

1111 
èŒoc_ª„ªn˚_h™dÀ
 *
h
 = (èŒoc_ª„ªn˚_h™dÀ *)
	`TC_PTR_FROM_CHUNK
(
c
);

1112 
	`ˇŒback
(
h
->
±r
, 
dïth
 + 1, 
max_dïth
, 1, 
¥iv©e_d©a
);

1114 
	`_èŒoc_ªp‹t_dïth_cb
(
	`TC_PTR_FROM_CHUNK
(
c
), 
dïth
 + 1, 
max_dïth
, 
ˇŒback
, 
¥iv©e_d©a
);

1117 
tc
->
Êags
 &~
TALLOC_FLAG_LOOP
;

1118 
	}
}

1120 
èŒoc_ªp‹t_dïth_cb
(c⁄° *
±r
, 
dïth
, 
max_dïth
,

1121 (*
ˇŒback
)(c⁄° *
±r
,

1122 
dïth
, 
max_dïth
,

1123 
is_ªf
,

1124 *
¥iv©e_d©a
),

1125 *
¥iv©e_d©a
)

1127 i‡(
±r
 =
NULL
) {

1128 
±r
 = 
nuŒ_c⁄ãxt
;

1130 i‡(
±r
 =
NULL
) ;

1132 
	`lock
(
±r
);

1133 
	`_èŒoc_ªp‹t_dïth_cb
(
±r
, 
dïth
, 
max_dïth
, 
ˇŒback
, 
¥iv©e_d©a
);

1134 
	`u∆ock
();

1135 
	}
}

1137 
	$èŒoc_ªp‹t_dïth_FILE_hñ≥r
(c⁄° *
±r
, 
dïth
, 
max_dïth
, 
is_ªf
, *
_f
)

1139 c⁄° *
«me
 = 
	`èŒoc_gë_«me
(
±r
);

1140 
FILE
 *
f
 = (FILE *)
_f
;

1142 i‡(
is_ªf
) {

1143 
	`Ârötf
(
f
, "%*§e„ªn˚Åo: %s\n", 
dïth
*4, "", 
«me
);

1147 i‡(
dïth
 == 0) {

1148 
	`Ârötf
(
f
,"%stallocÑeport on '%s' (total %6lu bytes in %3lu blocks)\n",

1149 (
max_dïth
 < 0 ? "fuŒ " :""), 
«me
,

1150 ()
	`_èŒoc_tŸÆ_size
(
±r
),

1151 ()
	`_èŒoc_tŸÆ_blocks
(
±r
));

1155 
	`Ârötf
(
f
, "%*s%-30s contains %6lu bytes in %3lu blocks (ref %d) %p\n",

1156 
dïth
*4, "",

1157 
«me
,

1158 ()
	`_èŒoc_tŸÆ_size
(
±r
),

1159 ()
	`_èŒoc_tŸÆ_blocks
(
±r
),

1160 ()
	`_èŒoc_ª„ªn˚_cou¡
(
±r
),Ötr);

1163 
	`Ârötf
(
f
, "content: ");

1164 i‡(
	`èŒoc_tŸÆ_size
(
±r
)) {

1165 
tŸ
 = 
	`èŒoc_tŸÆ_size
(
±r
);

1166 
i
;

1168 
i
 = 0; i < 
tŸ
; i++) {

1169 i‡((((*)
±r
)[
i
] > 31) && (((*)ptr)[i] < 126)) {

1170 
	`Ârötf
(
f
, "%c", ((*)
±r
)[
i
]);

1172 
	`Ârötf
(
f
, "~%02x", ((*)
±r
)[
i
]);

1176 
	`Ârötf
(
f
, "\n");

1178 
	}
}

1183 
	$èŒoc_ªp‹t_dïth_fûe
(c⁄° *
±r
, 
dïth
, 
max_dïth
, 
FILE
 *
f
)

1185 
	`èŒoc_ªp‹t_dïth_cb
(
±r
, 
dïth
, 
max_dïth
, 
èŒoc_ªp‹t_dïth_FILE_hñ≥r
, 
f
);

1186 
	`fÊush
(
f
);

1187 
	}
}

1192 
	$èŒoc_ªp‹t_fuŒ
(c⁄° *
±r
, 
FILE
 *
f
)

1194 
	`èŒoc_ªp‹t_dïth_fûe
(
±r
, 0, -1, 
f
);

1195 
	}
}

1200 
	$èŒoc_ªp‹t
(c⁄° *
±r
, 
FILE
 *
f
)

1202 
	`èŒoc_ªp‹t_dïth_fûe
(
±r
, 0, 1, 
f
);

1203 
	}
}

1208 
	$èŒoc_ªp‹t_nuŒ
()

1210 i‡(
	`èŒoc_tŸÆ_size
(
nuŒ_c⁄ãxt
) != 0) {

1211 
	`èŒoc_ªp‹t
(
nuŒ_c⁄ãxt
, 
°dîr
);

1213 
	}
}

1218 
	$èŒoc_ªp‹t_nuŒ_fuŒ
()

1220 i‡(
	`èŒoc_tŸÆ_size
(
nuŒ_c⁄ãxt
) != 0) {

1221 
	`èŒoc_ªp‹t_fuŒ
(
nuŒ_c⁄ãxt
, 
°dîr
);

1223 
	}
}

1228 
	$èŒoc_íabÀ_nuŒ_åackög
()

1230 i‡(
nuŒ_c⁄ãxt
 =
NULL
) {

1231 
nuŒ_c⁄ãxt
 = 
	`_èŒoc_«med_c⁄°
(
NULL
, 0, "null_context");

1233 
	}
}

1238 
	$èŒoc_dißbÀ_nuŒ_åackög
()

1240 
	`_èŒoc_‰ì
(
nuŒ_c⁄ãxt
);

1241 
nuŒ_c⁄ãxt
 = 
NULL
;

1242 
	}
}

1247 
	$èŒoc_íabÀ_Àak_ªp‹t
()

1249 
	`èŒoc_íabÀ_nuŒ_åackög
();

1250 
	`©exô
(
èŒoc_ªp‹t_nuŒ
);

1251 
	}
}

1256 
	$èŒoc_íabÀ_Àak_ªp‹t_fuŒ
()

1258 
	`èŒoc_íabÀ_nuŒ_åackög
();

1259 
	`©exô
(
èŒoc_ªp‹t_nuŒ_fuŒ
);

1260 
	}
}

1265 *
	$_èŒoc_zîo
(c⁄° *
˘x
, 
size_t
 
size
, c⁄° *
«me
)

1267 *
p
;

1269 
	`lock
(
˘x
);

1270 
p
 = 
	`_èŒoc_«med_c⁄°
(
˘x
, 
size
, 
«me
);

1271 
	`u∆ock
();

1273 i‡(
p
) {

1274 
	`mem£t
(
p
, '\0', 
size
);

1277  
p
;

1278 
	}
}

1283 *
	$_èŒoc_memdup
(c⁄° *
t
, c⁄° *
p
, 
size_t
 
size
, c⁄° *
«me
)

1285 *
√wp
;

1287 
	`lock
(
t
);

1288 
√wp
 = 
	`_èŒoc_«med_c⁄°
(
t
, 
size
, 
«me
);

1289 
	`u∆ock
();

1291 i‡(
	`likñy
(
√wp
)) {

1292 
	`mem˝y
(
√wp
, 
p
, 
size
);

1295  
√wp
;

1296 
	}
}

1301 *
	$èŒoc_°rdup
(c⁄° *
t
, c⁄° *
p
)

1303 *
ªt
;

1304 i‡(!
p
) {

1305  
NULL
;

1307 
ªt
 = (*)
	`èŒoc_memdup
(
t
, 
p
, 
	`°æí
(p) + 1);

1308 i‡(
	`likñy
(
ªt
)) {

1309 
	`_èŒoc_£t_«me_c⁄°
(
ªt
,Ñet);

1311  
ªt
;

1312 
	}
}

1317 *
	$èŒoc_≠≥nd_°rög
(*
‹ig
, c⁄° *
≠≥nd
)

1319 *
ªt
;

1320 
size_t
 
ﬁí
 = 
	`°æí
(
‹ig
);

1321 
size_t
 
Æíz
;

1323 i‡(!
≠≥nd
)

1324  
‹ig
;

1326 
Æíz
 = 
	`°æí
(
≠≥nd
) + 1;

1328 
ªt
 = 
	`èŒoc_ªÆloc
(
NULL
, 
‹ig
, , 
ﬁí
 + 
Æíz
);

1329 i‡(!
ªt
)

1330  
NULL
;

1333 
	`mem˝y
(&
ªt
[
ﬁí
], 
≠≥nd
, 
Æíz
);

1335 
	`_èŒoc_£t_«me_c⁄°
(
ªt
,Ñet);

1337  
ªt
;

1338 
	}
}

1343 *
	$èŒoc_°∫dup
(c⁄° *
t
, c⁄° *
p
, 
size_t
 
n
)

1345 
size_t
 
Àn
;

1346 *
ªt
;

1348 
Àn
=0;Üí<
n
 && 
p
[len];Üen++) ;

1350 
	`lock
(
t
);

1351 
ªt
 = (*)
	`__èŒoc
(
t
, 
Àn
 + 1);

1352 
	`u∆ock
();

1353 i‡(!
ªt
Ë{  
NULL
; }

1354 
	`mem˝y
(
ªt
, 
p
, 
Àn
);

1355 
ªt
[
Àn
] = 0;

1356 
	`_èŒoc_£t_«me_c⁄°
(
ªt
,Ñet);

1357  
ªt
;

1358 
	}
}

1360 *
	$èŒoc_va•rötf
(c⁄° *
t
, c⁄° *
fmt
, 
va_li°
 
≠
)

1362 
Àn
;

1363 *
ªt
;

1364 
va_li°
 
≠2
;

1365 
c
;

1368 
	`va_c›y
(
≠2
, 
≠
);

1369 
Àn
 = 
	`v¢¥ötf
(&
c
, 1, 
fmt
, 
≠2
);

1370 
	`va_íd
(
≠2
);

1371 i‡(
Àn
 < 0) {

1372  
NULL
;

1375 
	`lock
(
t
);

1376 
ªt
 = (*)
	`__èŒoc
(
t
, 
Àn
+1);

1377 
	`u∆ock
();

1378 i‡(
ªt
) {

1379 
	`va_c›y
(
≠2
, 
≠
);

1380 
	`v¢¥ötf
(
ªt
, 
Àn
+1, 
fmt
, 
≠2
);

1381 
	`va_íd
(
≠2
);

1382 
	`_èŒoc_£t_«me_c⁄°
(
ªt
,Ñet);

1385  
ªt
;

1386 
	}
}

1393 *
	$èŒoc_a•rötf
(c⁄° *
t
, c⁄° *
fmt
, ...)

1395 
va_li°
 
≠
;

1396 *
ªt
;

1398 
	`va_°¨t
(
≠
, 
fmt
);

1399 
ªt
 = 
	`èŒoc_va•rötf
(
t
, 
fmt
, 
≠
);

1400 
	`va_íd
(
≠
);

1401  
ªt
;

1402 
	}
}

1410 *
	$èŒoc_va•rötf_≠≥nd
(*
s
, c⁄° *
fmt
, 
va_li°
 
≠
)

1412 
èŒoc_chunk
 *
tc
;

1413 
Àn
, 
s_Àn
;

1414 
va_li°
 
≠2
;

1415 
c
;

1417 i‡(
s
 =
NULL
) {

1418  
	`èŒoc_va•rötf
(
NULL
, 
fmt
, 
≠
);

1421 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
s
);

1423 
s_Àn
 = 
tc
->
size
 - 1;

1425 
	`va_c›y
(
≠2
, 
≠
);

1426 
Àn
 = 
	`v¢¥ötf
(&
c
, 1, 
fmt
, 
≠2
);

1427 
	`va_íd
(
≠2
);

1429 i‡(
Àn
 <= 0) {

1436  
s
;

1439 
s
 = 
	`èŒoc_ªÆloc
(
NULL
, s, , 
s_Àn
 + 
Àn
+1);

1440 i‡(!
s
Ë 
NULL
;

1442 
	`va_c›y
(
≠2
, 
≠
);

1443 
	`v¢¥ötf
(
s
+
s_Àn
, 
Àn
+1, 
fmt
, 
≠2
);

1444 
	`va_íd
(
≠2
);

1445 
	`_èŒoc_£t_«me_c⁄°
(
s
, s);

1447  
s
;

1448 
	}
}

1455 *
	$èŒoc_a•rötf_≠≥nd
(*
s
, c⁄° *
fmt
, ...)

1457 
va_li°
 
≠
;

1459 
	`va_°¨t
(
≠
, 
fmt
);

1460 
s
 = 
	`èŒoc_va•rötf_≠≥nd
(s, 
fmt
, 
≠
);

1461 
	`va_íd
(
≠
);

1462  
s
;

1463 
	}
}

1468 *
	$_èŒoc_¨øy
(c⁄° *
˘x
, 
size_t
 
ñ_size
, 
cou¡
, c⁄° *
«me
)

1470 *
p
;

1472 i‡(
cou¡
 >
MAX_TALLOC_SIZE
/
ñ_size
) {

1473  
NULL
;

1475 
	`lock
(
˘x
);

1476 
p
 = 
	`_èŒoc_«med_c⁄°
(
˘x
, 
ñ_size
 * 
cou¡
, 
«me
);

1477 
	`u∆ock
();

1478  
p
;

1479 
	}
}

1484 *
	$_èŒoc_zîo_¨øy
(c⁄° *
˘x
, 
size_t
 
ñ_size
, 
cou¡
, c⁄° *
«me
)

1486 *
p
;

1488 i‡(
cou¡
 >
MAX_TALLOC_SIZE
/
ñ_size
) {

1489  
NULL
;

1491 
p
 = 
	`_èŒoc_zîo
(
˘x
, 
ñ_size
 * 
cou¡
, 
«me
);

1492  
p
;

1493 
	}
}

1498 *
	$_èŒoc_ªÆloc_¨øy
(c⁄° *
˘x
, *
±r
, 
size_t
 
ñ_size
, 
cou¡
, c⁄° *
«me
)

1500 i‡(
cou¡
 >
MAX_TALLOC_SIZE
/
ñ_size
) {

1501  
NULL
;

1503  
	`_èŒoc_ªÆloc
(
˘x
, 
±r
, 
ñ_size
 * 
cou¡
, 
«me
);

1504 
	}
}

1511 *
	$èŒoc_ªÆloc_‚
(c⁄° *
c⁄ãxt
, *
±r
, 
size_t
 
size
)

1513  
	`_èŒoc_ªÆloc
(
c⁄ãxt
, 
±r
, 
size
, 
NULL
);

1514 
	}
}

1517 
	$èŒoc_auto‰ì_de°ru˘‹
(*
±r
)

1519 
auto‰ì_c⁄ãxt
 = 
NULL
;

1521 
	}
}

1523 
	$èŒoc_auto‰ì
()

1525 i‡(
auto‰ì_c⁄ãxt
 && *auto‰ì_c⁄ãxà=
	`gëpid
())

1526 
	`èŒoc_‰ì
(
auto‰ì_c⁄ãxt
);

1527 
	}
}

1533 *
	$èŒoc_auto‰ì_c⁄ãxt
()

1535 i‡(
auto‰ì_c⁄ãxt
 =
NULL
 || *auto‰ì_c⁄ãxà!
	`gëpid
()) {

1536 
auto‰ì_c⁄ãxt
 = 
	`èŒoc
(
NULL
, 
pid_t
);

1537 *
auto‰ì_c⁄ãxt
 = 
	`gëpid
();

1538 
	`èŒoc_£t_«me_c⁄°
(
auto‰ì_c⁄ãxt
, "autofree_context");

1540 
	`èŒoc_£t_de°ru˘‹
(
auto‰ì_c⁄ãxt
, 
èŒoc_auto‰ì_de°ru˘‹
);

1541 
	`©exô
(
èŒoc_auto‰ì
);

1543  
auto‰ì_c⁄ãxt
;

1544 
	}
}

1546 
size_t
 
	$èŒoc_gë_size
(c⁄° *
c⁄ãxt
)

1548 
èŒoc_chunk
 *
tc
;

1550 i‡(
c⁄ãxt
 =
NULL
)

1553 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
c⁄ãxt
);

1555  
tc
->
size
;

1556 
	}
}

1561 *
	$èŒoc_föd_∑ª¡_by«me
(c⁄° *
c⁄ãxt
, c⁄° *
«me
)

1563 
èŒoc_chunk
 *
tc
;

1565 i‡(
c⁄ãxt
 =
NULL
) {

1566  
NULL
;

1569 
	`lock
(
c⁄ãxt
);

1570 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
c⁄ãxt
);

1571 
tc
) {

1572 i‡(
tc
->
«me
 && 
	`°rcmp
(tc->name,Çame) == 0) {

1573 
	`u∆ock
();

1574  
	`TC_PTR_FROM_CHUNK
(
tc
);

1576 
tc
 &&Åc->
¥ev
)Åc =Åc->prev;

1577 i‡(
tc
) {

1578 
tc
 =Åc->
∑ª¡
;

1581 
	`u∆ock
();

1582  
NULL
;

1583 
	}
}

1588 
	$èŒoc_show_∑ª¡s
(c⁄° *
c⁄ãxt
, 
FILE
 *
fûe
)

1590 
èŒoc_chunk
 *
tc
;

1592 i‡(
c⁄ãxt
 =
NULL
) {

1593 
	`Ârötf
(
fûe
, "tallocÇoÖarents for NULL\n");

1597 
	`lock
(
c⁄ãxt
);

1598 
tc
 = 
	`èŒoc_chunk_‰om_±r
(
c⁄ãxt
);

1599 
	`Ârötf
(
fûe
, "èŒo¯∑ª¡†o‡'%s'\n", 
	`èŒoc_gë_«me
(
c⁄ãxt
));

1600 
tc
) {

1601 
	`Ârötf
(
fûe
, "\t'%s'\n", 
	`èŒoc_gë_«me
(
	`TC_PTR_FROM_CHUNK
(
tc
)));

1602 
tc
 &&Åc->
¥ev
)Åc =Åc->prev;

1603 i‡(
tc
) {

1604 
tc
 =Åc->
∑ª¡
;

1607 
	`u∆ock
();

1608 
	`fÊush
(
fûe
);

1609 
	}
}

1611 
	$èŒoc_is_∑ª¡
(c⁄° *
c⁄ãxt
, c⁄° *
±r
)

1613 
ªt
;

1614 
	`lock
(
c⁄ãxt
);

1615 
ªt
 = 
	`_èŒoc_is_∑ª¡
(
c⁄ãxt
, 
±r
);

1616 
	`u∆ock
();

1617  
ªt
;

1618 
	}
}

1620 
èŒoc_£t_Æloˇt‹
(*(*
mÆloc
)(
size_t
 
size
),

1621 (*
‰ì
)(*
±r
),

1622 *(*
ªÆloc
)(*
±r
, 
size_t
 
size
))

1624 
tc_mÆloc
 = 
mÆloc
;

1625 
tc_‰ì
 = 
‰ì
;

1626 
tc_ªÆloc
 = 
ªÆloc
;

1627 
	}
}

1629 *
èŒoc_add_exã∫Æ
(c⁄° *
˘x
,

1630 *(*
ªÆloc
)(c⁄° *, *, 
size_t
),

1631 (*
lock
)(c⁄° *
p
),

1632 (*
u∆ock
)())

1634 
èŒoc_chunk
 *
tc
, *
∑ª¡
;

1635 *
p
;

1637 i‡(
tc_exã∫Æ_ªÆloc
 &&Åc_exã∫Æ_ªÆlo¯!
ªÆloc
)

1638 
	`TALLOC_ABORT
("talloc_add_externalÑeallocÑeplaced");

1639 
tc_exã∫Æ_ªÆloc
 = 
ªÆloc
;

1641 i‡(
	`u∆ikñy
(
˘x
 =
NULL
)) {

1642 
˘x
 = 
nuŒ_c⁄ãxt
;

1643 
∑ª¡
 = 
NULL
;

1645 
∑ª¡
 = 
	`èŒoc_chunk_‰om_±r
(
˘x
);

1647 
tc
 = 
	`tc_exã∫Æ_ªÆloc
(
˘x
, 
NULL
, 
TC_HDR_SIZE
);

1648 
p
 = 
	`öô_èŒoc
(
∑ª¡
, 
tc
, 0, 1);

1649 
tc_lock
 = 
lock
;

1650 
tc_u∆ock
 = 
u∆ock
;

1652  
p
;

1653 
	}
}

	@ccan/ccan/talloc/talloc.h

1 #i‚de‡
CCAN_TALLOC_H


2 
	#CCAN_TALLOC_H


	)

26 
	~<°dlib.h
>

27 
	~<°dio.h
>

28 
	~<°d¨g.h
>

29 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

30 
	~<cˇn/compûî/compûî.h
>

31 
	~"c⁄fig.h
"

36 #i‚de‡
__loˇti⁄__


37 
	#__TALLOC_STRING_LINE1__
(
s
Ë#s

	)

38 
	#__TALLOC_STRING_LINE2__
(
s
Ë
	`__TALLOC_STRING_LINE1__
(s)

	)

39 
	#__TALLOC_STRING_LINE3__
 
	`__TALLOC_STRING_LINE2__
(
__LINE__
)

	)

40 
	#__loˇti⁄__
 
__FILE__
 ":" 
__TALLOC_STRING_LINE3__


	)

45 #i‡
HAVE_TYPEOF


46 
	#_TALLOC_TYPEOF
(
±r
Ë
	`__ty≥of__
’å)

	)

48 
	#_TALLOC_TYPEOF
(
±r
Ë*

	)

51 
	#èŒoc_move
(
˘x
, 
±r
Ë(
	`_TALLOC_TYPEOF
(*’å)))
	`_èŒoc_move
((˘x),(*)’å))

	)

79 
	#èŒoc
(
˘x
, 
ty≥
Ë—y≥ *)
	`èŒoc_«med_c⁄°
(˘x, —y≥), #ty≥)

	)

102 
	tTALLOC_CTX
;

125 
	#èŒoc_£t
(
µå
, 
˘x
) \

126 
	`_èŒoc_£t
((
µå
), (
˘x
), (&**’±r)), 
__loˇti⁄__
)

	)

160 
èŒoc_‰ì
(c⁄° *
±r
);

212 
	#èŒoc_£t_de°ru˘‹
(
±r
, 
fun˘i⁄
) \

213 
	`_èŒoc_£t_de°ru˘‹
((
±r
), 
	`ty≥ß„_cb
(, *, (
fun˘i⁄
), (±r)))

	)

233 
	#èŒoc_zîo
(
˘x
, 
ty≥
Ë—y≥ *)
	`_èŒoc_zîo
(˘x, —y≥), #ty≥)

	)

257 
	#èŒoc_¨øy
(
˘x
, 
ty≥
, 
cou¡
Ë—y≥ *)
	`_èŒoc_¨øy
(˘x, —y≥), cou¡, #ty≥)

	)

277 
	#èŒoc_size
(
˘x
, 
size
Ë
	`èŒoc_«med_c⁄°
(˘x, size, 
__loˇti⁄__
)

	)

279 #i‡
HAVE_TYPEOF


309 
	#èŒoc_°ól
(
˘x
, 
±r
Ë({ 
	`_TALLOC_TYPEOF
’åË
_èŒoc_°ól_ªt
 = (_TALLOC_TYPEOF’å))
	`_èŒoc_°ól
((˘x),’å)); _èŒoc_°ól_ªt; }Ë

	)

311 
	#èŒoc_°ól
(
˘x
, 
±r
Ë(
	`_TALLOC_TYPEOF
’å))
	`_èŒoc_°ól
((˘x),’å))

	)

337 
èŒoc_ªp‹t_fuŒ
(c⁄° *
±r
, 
FILE
 *
f
);

372 
	#èŒoc_ª„ªn˚
(
˘x
, 
±r
Ë(
	`_TALLOC_TYPEOF
’å))
	`_èŒoc_ª„ªn˚
((˘x),’å))

	)

400 
èŒoc_u∆ök
(c⁄° *
c⁄ãxt
, *
±r
);

423 
èŒoc_ªp‹t
(c⁄° *
±r
, 
FILE
 *
f
);

439 
	#èŒoc_±πy≥
(
˘x
, 
±r
Ë(
	`_TALLOC_TYPEOF
’å))
	`èŒoc_size
(˘x, (*’å)))

	)

450 
	#èŒoc_√w
(
˘x
Ë
	`èŒoc_«med_c⁄°
(˘x, 0, "èŒoc_√w: " 
__loˇti⁄__
)

	)

457 
	#èŒoc_zîo_size
(
˘x
, 
size
Ë
	`_èŒoc_zîo
(˘x, size, 
__loˇti⁄__
)

	)

467 
	#èŒoc_zîo_¨øy
(
˘x
, 
ty≥
, 
cou¡
Ë—y≥ *)
	`_èŒoc_zîo_¨øy
(˘x, —y≥), cou¡, #ty≥)

	)

477 
	#èŒoc_¨øy_size
(
˘x
, 
size
, 
cou¡
Ë
	`_èŒoc_¨øy
(˘x, size, cou¡, 
__loˇti⁄__
)

	)

487 
	#èŒoc_¨øy_±πy≥
(
˘x
, 
±r
, 
cou¡
Ë(
	`_TALLOC_TYPEOF
’å))
	`èŒoc_¨øy_size
(˘x, (*’å)), cou¡)

	)

513 
	#èŒoc_ªÆloc
(
˘x
, 
p
, 
ty≥
, 
cou¡
Ë—y≥ *)
	`_èŒoc_ªÆloc_¨øy
(˘x,Ö, —y≥), cou¡, #ty≥)

	)

524 
	#èŒoc_ªÆloc_size
(
˘x
, 
±r
, 
size
Ë
	`_èŒoc_ªÆloc
(˘x,Öå, size, 
__loˇti⁄__
)

	)

541 *
èŒoc_°rdup
(c⁄° *
t
, c⁄° *
p
);

558 *
èŒoc_°∫dup
(c⁄° *
t
, c⁄° *
p
, 
size_t
 
n
);

568 
	#èŒoc_memdup
(
t
, 
p
, 
size
Ë
	`_èŒoc_memdup
—,Ö, size, 
__loˇti⁄__
)

	)

583 *
	$èŒoc_a•rötf
(c⁄° *
t
, c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(2,3);

598 *
WARN_UNUSED_RESULT
 
	`èŒoc_≠≥nd_°rög
(*
‹ig
, c⁄° *
≠≥nd
);

612 *
WARN_UNUSED_RESULT
 
	$èŒoc_a•rötf_≠≥nd
(*
s
, c⁄° *
fmt
, ...)

613 
	`PRINTF_FMT
(2,3);

629 *
	$èŒoc_va•rötf
(c⁄° *
t
, c⁄° *
fmt
, 
va_li°
 
≠
)

630 
	`PRINTF_FMT
(2,0);

641 *
WARN_UNUSED_RESULT
 
	$èŒoc_va•rötf_≠≥nd
(*
s
, c⁄° *
fmt
, 
va_li°
 
≠
)

642 
	`PRINTF_FMT
(2,0);

656 
	#èŒoc_£t_ty≥
(
±r
, 
ty≥
Ë
	`èŒoc_£t_«me_c⁄°
’å, #ty≥)

	)

668 
	#èŒoc_gë_ty≥
(
±r
, 
ty≥
Ë—y≥ *)
	`èŒoc_check_«me
’å, #ty≥)

	)

680 
	#èŒoc_föd_∑ª¡_byty≥
(
±r
, 
ty≥
Ë—y≥ *)
	`èŒoc_föd_∑ª¡_by«me
’å, #ty≥)

	)

695 
	`èŒoc_ö¸ó£_ªf_cou¡
(c⁄° *
±r
);

718 c⁄° *
	$èŒoc_£t_«me
(c⁄° *
±r
, c⁄° *
fmt
, ...)

719 
	`PRINTF_FMT
(2,3);

735 
	`èŒoc_£t_«me_c⁄°
(c⁄° *
±r
, c⁄° *
«me
);

749 *
	$èŒoc_«med
(c⁄° *
c⁄ãxt
, 
size_t
 
size
,

750 c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(3,4);

763 *
	`èŒoc_«med_c⁄°
(c⁄° *
c⁄ãxt
, 
size_t
 
size
, c⁄° *
«me
);

772 c⁄° *
	`èŒoc_gë_«me
(c⁄° *
±r
);

782 *
	`èŒoc_check_«me
(c⁄° *
±r
, c⁄° *
«me
);

793 *
	$èŒoc_öô
(c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(1,2);

806 
size_t
 
	`èŒoc_tŸÆ_size
(c⁄° *
±r
);

820 
size_t
 
	`èŒoc_tŸÆ_blocks
(c⁄° *
±r
);

842 
	`èŒoc_ªp‹t_dïth_cb
(c⁄° *
±r
, 
dïth
, 
max_dïth
,

843 (*
ˇŒback
)(c⁄° *
±r
,

844 
dïth
, 
max_dïth
,

845 
is_ªf
,

846 *
¥iv©e_d©a
),

847 *
¥iv©e_d©a
);

859 
	`èŒoc_ªp‹t_dïth_fûe
(c⁄° *
±r
, 
dïth
, 
max_dïth
, 
FILE
 *
f
);

868 
	`èŒoc_íabÀ_nuŒ_åackög
();

875 
	`èŒoc_dißbÀ_nuŒ_åackög
();

901 
	`èŒoc_íabÀ_Àak_ªp‹t
();

927 
	`èŒoc_íabÀ_Àak_ªp‹t_fuŒ
();

936 *
	`èŒoc_auto‰ì_c⁄ãxt
();

947 
	#èŒoc_¨øy_Àngth
(
p
Ë(
	`èŒoc_gë_size
’Ë/ ((*p)))

	)

959 
size_t
 
	`èŒoc_gë_size
(c⁄° *
˘x
);

971 *
	`èŒoc_föd_∑ª¡_by«me
(c⁄° *
˘x
, c⁄° *
«me
);

982 
	`èŒoc_£t_Æloˇt‹
(*(*
mÆloc
)(
size_t
 
size
),

983 (*
‰ì
)(*
±r
),

984 *(*
ªÆloc
)(*
±r
, 
size_t
 
size
));

1005 *
	`èŒoc_add_exã∫Æ
(c⁄° *
˘x
,

1006 *(*
ªÆloc
)(c⁄° *
∑ª¡
,

1007 *
±r
, 
size_t
),

1008 (*
lock
)(c⁄° *
p
),

1009 (*
u∆ock
)());

1012 *
	`_èŒoc
(c⁄° *
c⁄ãxt
, 
size_t
 
size
);

1013 
	`_èŒoc_£t
(*
±r
, c⁄° *
˘x
, 
size_t
 
size
, c⁄° *
«me
);

1014 
	`_èŒoc_£t_de°ru˘‹
(c⁄° *
±r
, (*
de°ru˘‹
)(*));

1015 
size_t
 
	`èŒoc_ª„ªn˚_cou¡
(c⁄° *
±r
);

1016 *
	`_èŒoc_ª„ªn˚
(c⁄° *
c⁄ãxt
, c⁄° *
±r
);

1018 *
WARN_UNUSED_RESULT
 
	`_èŒoc_ªÆloc
(c⁄° *
c⁄ãxt
, *
±r
, 
size_t
 
size
, c⁄° *
«me
);

1019 *
	`èŒoc_∑ª¡
(c⁄° *
±r
);

1020 c⁄° *
	`èŒoc_∑ª¡_«me
(c⁄° *
±r
);

1021 *
	`_èŒoc_°ól
(c⁄° *
√w_˘x
, c⁄° *
±r
);

1022 *
	`_èŒoc_move
(c⁄° *
√w_˘x
, c⁄° *
µå
);

1023 *
	`_èŒoc_zîo
(c⁄° *
˘x
, 
size_t
 
size
, c⁄° *
«me
);

1024 *
	`_èŒoc_memdup
(c⁄° *
t
, c⁄° *
p
, 
size_t
 
size
, c⁄° *
«me
);

1025 *
	`_èŒoc_¨øy
(c⁄° *
˘x
, 
size_t
 
ñ_size
, 
cou¡
, c⁄° *
«me
);

1026 *
	`_èŒoc_zîo_¨øy
(c⁄° *
˘x
, 
size_t
 
ñ_size
, 
cou¡
, c⁄° *
«me
);

1027 *
WARN_UNUSED_RESULT
 
	`_èŒoc_ªÆloc_¨øy
(c⁄° *
˘x
, *
±r
, 
size_t
 
ñ_size
, 
cou¡
, c⁄° *
«me
);

1028 *
	`èŒoc_ªÆloc_‚
(c⁄° *
c⁄ãxt
, *
±r
, 
size_t
 
size
);

1029 
	`èŒoc_show_∑ª¡s
(c⁄° *
c⁄ãxt
, 
FILE
 *
fûe
);

1030 
	`èŒoc_is_∑ª¡
(c⁄° *
c⁄ãxt
, c⁄° *
±r
);

	@ccan/ccan/talloc/test/compile_fail-talloc_set.c

1 
	~<cˇn/èŒoc/èŒoc.c
>

3 
	$maö
()

5 *
p
;

7 
	`èŒoc_£t
(

8 #ifde‡
FAIL


9 
p


11 &
p


13 , 
NULL
);

15 
	}
}

	@ccan/ccan/talloc/test/run-corruption1.c

2 
	~<cˇn/èŒoc/èŒoc.c
>

3 
	~<°dboﬁ.h
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
(
¨gc
, *
¨gv
[])

8 *
roŸ
, *
p1
;

10 
	`∂™_ã°s
(2);

11 
	`èŒoc_íabÀ_nuŒ_åackög
();

12 
roŸ
 = 
	`èŒoc_√w
(
NULL
);

13 
p1
 = 
	`èŒoc_°rdup
(
roŸ
, "foo");

14 
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
);

15 
	`èŒoc_‰ì
(
roŸ
);

16 
	`ok1
(
	`°rcmp
(
p1
, "foo") == 0);

17 
	`èŒoc_u∆ök
(
NULL
, 
p1
);

20 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

21 
	`èŒoc_dißbÀ_nuŒ_åackög
();

23  
	`exô_°©us
();

24 
	}
}

	@ccan/ccan/talloc/test/run-external-alloc.c

1 
	~<cˇn/èŒoc/èŒoc.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<as£π.h
>

7 
	gext_Æloc_cou¡
, 
	gext_‰ì_cou¡
, 
	gext_ªÆloc_cou¡
, 
	glock_cou¡
, 
	gu∆ock_cou¡
;

8 *
	gex≥˘ed_∑ª¡
;

10 *
	$ext_ªÆloc
(c⁄° *
∑ª¡
, *
±r
, 
size_t
 
size
)

12 
	`ok1
(
∑ª¡
 =
ex≥˘ed_∑ª¡
);

13 i‡(
±r
 =
NULL
)

14 
ext_Æloc_cou¡
++;

15 i‡(
size
 == 0)

16 
ext_‰ì_cou¡
++;

17 i‡(
±r
 && 
size
)

18 
ext_ªÆloc_cou¡
++;

19  
	`ªÆloc
(
±r
, 
size
);

20 
	}
}

22 
	$ext_lock
(c⁄° *
˘x
)

24 
lock_cou¡
++;

25 
	}
}

27 
	$ext_u∆ock
()

29 
u∆ock_cou¡
++;

30 
	}
}

32 
	$maö
()

34 *
p
, *
p2
, *
hód
;

35 
	`∂™_ã°s
(15);

37 
ex≥˘ed_∑ª¡
 = 
NULL
;

38 
hód
 = 
	`èŒoc_add_exã∫Æ
(
NULL
, 
ext_ªÆloc
, 
ext_lock
, 
ext_u∆ock
);

39 
	`as£π
(
hód
);

40 
	`ok1
(
ext_Æloc_cou¡
 == 1);

42 
ex≥˘ed_∑ª¡
 = 
hód
;

43 
p
 = 
	`èŒoc_¨øy
(
hód
, , 1);

44 
	`ok1
(
ext_Æloc_cou¡
 == 2);

45 
	`as£π
(
p
);

48 
ex≥˘ed_∑ª¡
 = 
p
;

49 
p2
 = 
	`èŒoc
(
p
, );

50 
	`ok1
(
ext_Æloc_cou¡
 == 3);

52 
ex≥˘ed_∑ª¡
 = 
hód
;

53 
p
 = 
	`èŒoc_ªÆloc
(
NULL
,Ö, , 1000);

54 
	`ok1
(
ext_ªÆloc_cou¡
 == 1);

55 
	`as£π
(
p
);

57 
ex≥˘ed_∑ª¡
 = 
p
;

58 
	`èŒoc_‰ì
(
p2
);

59 
	`ok1
(
ext_‰ì_cou¡
 == 1);

61 
ex≥˘ed_∑ª¡
 = 
hód
;

62 
	`èŒoc_‰ì
(
p
);

63 
	`ok1
(
ext_‰ì_cou¡
 == 2);

65 
ex≥˘ed_∑ª¡
 = 
NULL
;

66 
	`èŒoc_‰ì
(
hód
);

67 
	`ok1
(
ext_‰ì_cou¡
 == 3);

69 
	`ok1
(
lock_cou¡
 =
u∆ock_cou¡
);

71  
	`exô_°©us
();

72 
	}
}

	@ccan/ccan/talloc/test/run-set_allocator.c

1 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

2 
	~<cˇn/èŒoc/èŒoc.c
>

3 
	~<°dboﬁ.h
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<cˇn/Áûã°/Áûã°.h
>

7 
	gmy_mÆloc_cou¡
, 
	gmy_‰ì_cou¡
, 
	gmy_ªÆloc_cou¡
;

9 *
	$my_mÆloc
(
size_t
 
size
)

11 
my_mÆloc_cou¡
++;

12  
	`mÆloc
(
size
);

13 
	}
}

15 
	$my_‰ì
(*
±r
)

17 
my_‰ì_cou¡
++;

18 
	`‰ì
(
±r
);

19 
	}
}

21 *
	$my_ªÆloc
(*
±r
, 
size_t
 
size
)

23 
my_ªÆloc_cou¡
++;

24 
	`ok1
(
±r
);

25 
	`ok1
(
size
);

26  
	`ªÆloc
(
±r
, 
size
);

27 
	}
}

29 
	$maö
(
¨gc
, *
¨gv
[])

31 *
p1
, *
p2
;

33 
	`∂™_ã°s
(14);

34 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

35 
	`èŒoc_£t_Æloˇt‹
(
my_mÆloc
, 
my_‰ì
, 
my_ªÆloc
);

36 
p1
 = 
	`èŒoc_¨øy
(
NULL
, , 10);

37 i‡(!
p1
)

38 
	`Áûã°_exô
(
	`exô_°©us
());

39 
	`ok1
(
my_mÆloc_cou¡
 == 1);

40 
	`ok1
(
my_‰ì_cou¡
 == 0);

41 
	`ok1
(
my_ªÆloc_cou¡
 == 0);

43 
p2
 = 
	`èŒoc_ªÆloc
(
NULL
, 
p1
, , 10000);

44 i‡(!
p2
) {

45 
	`èŒoc_‰ì
(
p1
);

46 
	`Áûã°_exô
(
	`exô_°©us
());

48 
p1
 = 
p2
;

49 
	`ok1
(
my_mÆloc_cou¡
 == 1);

50 
	`ok1
(
my_‰ì_cou¡
 == 0);

51 
	`ok1
(
my_ªÆloc_cou¡
 == 1);

53 
p2
 = 
	`èŒoc
(
p1
, );

54 i‡(!
p2
) {

55 
	`èŒoc_‰ì
(
p1
);

56 
	`Áûã°_exô
(
	`exô_°©us
());

58 
	`ok1
(
my_mÆloc_cou¡
 == 2);

59 
	`ok1
(
my_‰ì_cou¡
 == 0);

60 
	`ok1
(
my_ªÆloc_cou¡
 == 1);

62 
	`èŒoc_‰ì
(
p1
);

63 
	`ok1
(
my_mÆloc_cou¡
 == 2);

64 
	`ok1
(
my_‰ì_cou¡
 == 2);

65 
	`ok1
(
my_ªÆloc_cou¡
 == 1);

67 
	`Áûã°_exô
(
	`exô_°©us
());

68 
	}
}

	@ccan/ccan/talloc/test/run-talloc_set.c

1 
	~<cˇn/èŒoc/èŒoc.c
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<as£π.h
>

5 
	$maö
()

7 *
c
;

8 *
i
;

10 
	`∂™_ã°s
(12);

13 
	`èŒoc_£t
(&
c
, 
NULL
);

14 
	`ok1
(
c
 >(*)(
öçå_t
)
	`gë∑gesize
());

15 
	`ok1
(
	`èŒoc_∑ª¡
(
c
Ë=
NULL
);

18 
	`èŒoc_‰ì
(
c
);

19 
	`ok1
(
c
);

20 
	`ok1
(
c
 < (*)(
öçå_t
)
	`gë∑gesize
());

23 
	`èŒoc_£t
(&
i
, 
NULL
);

24 
	`èŒoc_£t
(&
c
, 
i
);

25 
	`ok1
(
c
 >(*)(
öçå_t
)
	`gë∑gesize
());

26 
	`ok1
(
i
 >(*)(
öçå_t
)
	`gë∑gesize
());

27 
	`ok1
(
	`èŒoc_∑ª¡
(
i
Ë=
NULL
);

28 
	`ok1
(
	`èŒoc_∑ª¡
(
c
Ë=
i
);

29 
	`èŒoc_‰ì
(
i
);

30 
	`ok1
(
c
);

31 
	`ok1
(
c
 < (*)(
öçå_t
)
	`gë∑gesize
());

32 
	`ok1
(
i
);

33 
	`ok1
(
i
 < (*)(
öçå_t
)
	`gë∑gesize
());

35  
	`exô_°©us
();

36 
	}
}

	@ccan/ccan/talloc/test/run-test_autofree.c

1 
	~<cˇn/èŒoc/èŒoc.c
>

2 
	~<°dboﬁ.h
>

3 
	~<cˇn/èp/èp.h
>

5 
	$de°roy_öt
(*
p
)

7 
	`ok1
(*
p
 == 7);

8 
	`_exô
(0);

9 
	}
}

11 
	$maö
(
¨gc
, *
¨gv
[])

13 *
p
;

16 
	`∂™_ã°s
(1);

18 
p
 = 
	`èŒoc
(
	`èŒoc_auto‰ì_c⁄ãxt
(), );

19 *
p
 = 7;

20 
	`èŒoc_£t_de°ru˘‹
(
p
, 
de°roy_öt
);

23 
	`exô
(1);

24 
	}
}

	@ccan/ccan/talloc/test/run-test_free_in_destructor.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

66 
boﬁ
 
	gã°_èŒoc_‰ì_ö_de°ru˘‹_run
;

67 
	$_ã°_èŒoc_‰ì_ö_de°ru˘‹
(**
±r
)

69 
	`èŒoc_‰ì
(*
±r
);

70 
ã°_èŒoc_‰ì_ö_de°ru˘‹_run
 = 
åue
;

72 
	}
}

74 
boﬁ
 
	$ã°_èŒoc_‰ì_ö_de°ru˘‹
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

76 *
Àvñ0
;

77 *
Àvñ1
;

78 *
Àvñ2
;

79 *
Àvñ3
;

80 *
Àvñ4
;

81 **
Àvñ5
;

82 
boﬁ
 
ªt
 = 
Ál£
;

84 
Àvñ0
 = 
	`èŒoc_√w
(
˘x
);

85 i‡(!
Àvñ0
)

86 
out
;

87 
Àvñ1
 = 
	`èŒoc_√w
(
Àvñ0
);

88 i‡(!
Àvñ1
)

89 
out
;

90 
Àvñ2
 = 
	`èŒoc_√w
(
Àvñ1
);

91 i‡(!
Àvñ2
)

92 
out
;

93 
Àvñ3
 = 
	`èŒoc_√w
(
Àvñ2
);

94 i‡(!
Àvñ3
)

95 
out
;

96 
Àvñ4
 = 
	`èŒoc_√w
(
Àvñ3
);

97 i‡(!
Àvñ4
)

98 
out
;

99 
Àvñ5
 = 
	`èŒoc
(
Àvñ4
, *);

100 i‡(!
Àvñ5
)

101 
out
;

103 *
Àvñ5
 = 
	`èŒoc_ª„ªn˚
(
NULL
, 
Àvñ3
);

105 
ã°_èŒoc_‰ì_ö_de°ru˘‹_run
 = 
Ál£
;

106 
	`èŒoc_£t_de°ru˘‹
(
Àvñ5
, 
_ã°_èŒoc_‰ì_ö_de°ru˘‹
);

108 
	`èŒoc_‰ì
(
Àvñ1
);

109 
ªt
 = 
åue
;

110 
out
:

111 
	`èŒoc_‰ì
(
Àvñ0
);

113 
	`ok1
(
ã°_èŒoc_‰ì_ö_de°ru˘‹_run
);

115  
ªt
;

116 
	}
}

118 
	$maö
(
¨gc
, *
¨gv
[])

120 
	`∂™_ã°s
(3);

121 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

123 
	`èŒoc_íabÀ_nuŒ_åackög
();

124 i‡(
nuŒ_c⁄ãxt
) {

125 
	`ok1
(
	`ã°_èŒoc_‰ì_ö_de°ru˘‹
(
NULL
));

127 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

128 
	`èŒoc_dißbÀ_nuŒ_åackög
();

130 
	`Áûã°_exô
(
	`exô_°©us
());

131 
	}
}

	@ccan/ccan/talloc/test/run-test_free_parent_deny_child.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

66 
	$Áû_de°ru˘‹_°r
(*
±r
)

69 
	}
}

71 
boﬁ
 
	$ã°_‰ì_∑ª¡_díy_chûd
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

73 *
t›
 = 
	`èŒoc_√w
(
˘x
);

74 *
Àvñ1
;

75 *
Àvñ2
;

76 *
Àvñ3
;

77 
boﬁ
 
ªt
 = 
Ál£
;

79 i‡(!
t›
)

80 
out
;

82 
Àvñ1
 = 
	`èŒoc_°rdup
(
t›
, "level1");

83 i‡(!
Àvñ1
)

84 
out
;

85 
Àvñ2
 = 
	`èŒoc_°rdup
(
Àvñ1
, "level2");

86 i‡(!
Àvñ2
)

87 
out
;

88 
Àvñ3
 = 
	`èŒoc_°rdup
(
Àvñ2
, "level3");

89 i‡(!
Àvñ3
)

90 
out
;

92 
	`èŒoc_£t_de°ru˘‹
(
Àvñ3
, 
Áû_de°ru˘‹_°r
);

93 
	`èŒoc_‰ì
(
Àvñ1
);

94 
	`èŒoc_£t_de°ru˘‹
(
Àvñ3
, 
NULL
);

96 
	`CHECK_PARENT
("‰ì_∑ª¡_díy_chûd", 
Àvñ3
, 
t›
);

97 
ªt
 = 
åue
;

99 
out
:

100 
	`èŒoc_‰ì
(
t›
);

102  
ªt
;

103 
	}
}

105 
	$maö
(
¨gc
, *
¨gv
[])

107 
	`∂™_ã°s
(3);

108 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

110 
	`èŒoc_íabÀ_nuŒ_åackög
();

111 i‡(
nuŒ_c⁄ãxt
) {

112 
	`ok1
(
	`ã°_‰ì_∑ª¡_díy_chûd
(
NULL
));

114 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

115 
	`èŒoc_dißbÀ_nuŒ_åackög
();

117 
	`Áûã°_exô
(
	`exô_°©us
());

118 
	}
}

	@ccan/ccan/talloc/test/run-test_loop.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

66 
	glo›_de°ru˘‹_cou¡
;

68 
	$ã°_lo›_de°ru˘‹
(*
±r
)

70 
lo›_de°ru˘‹_cou¡
++;

72 
	}
}

74 
boﬁ
 
	$ã°_lo›
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

76 *
t›
 = 
	`èŒoc_√w
(
˘x
);

77 *
∑ª¡
;

78 
	sªq1
 {

79 *
ªq2
, *
ªq3
;

80 } *
ªq1
;

81 
boﬁ
 
ªt
 = 
Ál£
;

83 i‡(!
t›
)

84 
out
;

86 
∑ª¡
 = 
	`èŒoc_°rdup
(
t›
, "parent");

87 i‡(!
∑ª¡
)

88 
out
;

90 
ªq1
 = 
	`èŒoc
(
∑ª¡
, req1);

91 i‡(!
ªq1
)

92 
out
;

94 
ªq1
->
ªq2
 = 
	`èŒoc_°rdup
(req1, "req2");

95 i‡(!
ªq1
->
ªq2
)

96 
out
;

98 
	`èŒoc_£t_de°ru˘‹
(
ªq1
->
ªq2
, 
ã°_lo›_de°ru˘‹
);

99 
ªq1
->
ªq3
 = 
	`èŒoc_°rdup
(req1, "req3");

100 i‡(!
ªq1
->
ªq3
)

101 
out
;

102 ()
	`èŒoc_ª„ªn˚
(
ªq1
->
ªq3
,Ñeq1);

103 
	`èŒoc_‰ì
(
∑ª¡
);

105 
	`t‹tuª_as£π
("lo›", 
lo›_de°ru˘‹_cou¡
 == 1,

107 
lo›_de°ru˘‹_cou¡
 = 0;

108 
ªt
 = 
åue
;

109 
out
:

110 
	`èŒoc_‰ì
(
t›
);

112  
ªt
;

113 
	}
}

115 
	$maö
(
¨gc
, *
¨gv
[])

117 
	`∂™_ã°s
(3);

118 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

120 
	`èŒoc_íabÀ_nuŒ_åackög
();

121 i‡(
nuŒ_c⁄ãxt
) {

122 
	`ok1
(
	`ã°_lo›
(
NULL
));

124 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

125 
	`èŒoc_dißbÀ_nuŒ_åackög
();

127 
	`Áûã°_exô
(
	`exô_°©us
());

128 
	}
}

	@ccan/ccan/talloc/test/run-test_misc.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

66 
	$Áû_de°ru˘‹
(*
±r
)

69 
	}
}

74 
boﬁ
 
	$ã°_misc
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

76 *
roŸ
, *
p1
;

77 *
p2
;

78 *
d
;

79 c⁄° *
«me
;

80 
boﬁ
 
ªt
 = 
Ál£
;

82 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

83 i‡(!
roŸ
)

84 
out
;

86 
p1
 = 
	`èŒoc_size
(
roŸ
, 0x7fffffff);

87 
	`t‹tuª_as£π
("misc", !
p1
, "failed:ÜargeÅallocállowed\n");

89 
p1
 = 
	`èŒoc_°rdup
(
roŸ
, "foo");

90 i‡(!
p1
)

91 
out
;

93 i‡(
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
) != 0)

94 
out
;

95 i‡(
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
) != 0)

96 
out
;

97 i‡(
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
) != 0)

98 
out
;

99 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

100 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

101 
	`èŒoc_‰ì
(
p1
);

102 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

103 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

104 
	`èŒoc_u∆ök
(
NULL
, 
p1
);

105 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

106 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

107 
p2
 = 
	`èŒoc_°rdup
(
p1
, "foo");

108 i‡(!
p2
)

109 
out
;

110 
	`t‹tuª_as£π
("misc", 
	`èŒoc_u∆ök
(
roŸ
, 
p2
) == -1,

112 
	`t‹tuª_as£π
("misc", 
	`èŒoc_u∆ök
(
p1
, 
p2
) == 0,

114 
	`èŒoc_‰ì
(
p1
);

115 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

116 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

118 
«me
 = 
	`èŒoc_£t_«me
(
p1
, "myÇame is %s", "foo");

119 i‡(!
«me
)

120 
out
;

121 
	`t‹tuª_as£π_°r_equÆ
("misc", 
	`èŒoc_gë_«me
(
p1
), "myÇame is foo",

123 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

124 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

126 
	`èŒoc_£t_«me_c⁄°
(
p1
, 
NULL
);

127 
	`t‹tuª_as£π_°r_equÆ
 ("misc", 
	`èŒoc_gë_«me
(
p1
), "UNNAMED",

129 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

130 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

132 
	`t‹tuª_as£π
("misc", 
	`èŒoc_‰ì
(
NULL
) == -1,

135 
	`èŒoc_£t_de°ru˘‹
(
p1
, 
Áû_de°ru˘‹
);

136 
	`t‹tuª_as£π
("misc", 
	`èŒoc_‰ì
(
p1
) == -1,

138 
	`èŒoc_£t_de°ru˘‹
(
p1
, 
NULL
);

140 
p2
 = (*)
	`èŒoc_zîo_size
(
p1
, 20);

141 i‡(!
p2
)

142 
out
;

143 
	`t‹tuª_as£π
("misc", 
p2
[19] == 0, "FailedÅo give zero memory\n");

144 
	`èŒoc_‰ì
(
p2
);

146 
	`t‹tuª_as£π
("misc", 
	`èŒoc_°rdup
(
roŸ
, 
NULL
) == NULL,

149 
p2
 = 
	`èŒoc_°∫dup
(
p1
, "foo", 2);

150 i‡(!
p2
)

151 
out
;

152 
	`t‹tuª_as£π
("misc", 
	`°rcmp
("fo", 
p2
) == 0,

154 
p2
 = 
	`èŒoc_a•rötf_≠≥nd
(p2, "o%c", 'd');

155 i‡(!
p2
)

156 
out
;

157 
	`t‹tuª_as£π
("misc", 
	`°rcmp
("food", 
p2
) == 0,

159 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

160 
	`CHECK_BLOCKS
("misc", 
p1
, 3);

162 
p2
 = 
	`èŒoc_a•rötf_≠≥nd
(
NULL
, "hello %s", "world");

163 i‡(!
p2
)

164 
out
;

165 
	`t‹tuª_as£π
("misc", 
	`°rcmp
("hñlÿw‹ld", 
p2
) == 0,

167 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

168 
	`CHECK_BLOCKS
("misc", 
p1
, 3);

169 
	`èŒoc_‰ì
(
p2
);

171 
d
 = 
	`èŒoc_¨øy
(
p1
, , 0x20000000);

172 
	`t‹tuª_as£π
("misc", !
d
, "failed: integer overflowÇot detected\n");

174 
d
 = 
	`èŒoc_ªÆloc
(
p1
, d, , 0x20000000);

175 
	`t‹tuª_as£π
("misc", !
d
, "failed: integer overflowÇot detected\n");

177 
	`èŒoc_‰ì
(
p1
);

178 
	`CHECK_BLOCKS
("misc", 
roŸ
, 1);

180 
p1
 = 
	`èŒoc_«med
(
roŸ
, 100, "%d bytes", 100);

181 i‡(!
p1
)

182 
out
;

183 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

184 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

185 
	`èŒoc_u∆ök
(
roŸ
, 
p1
);

187 
p1
 = 
	`èŒoc_öô
("%d bytes", 200);

188 i‡(!
p1
)

189 
out
;

190 
p2
 = 
	`èŒoc_a•rötf
(
p1
, "myÅest '%s'", "string");

191 i‡(!
p2
)

192 
out
;

193 
	`t‹tuª_as£π_°r_equÆ
("misc", 
p2
, "myÅest 'string'",

195 
	`CHECK_BLOCKS
("misc", 
p1
, 3);

196 
	`CHECK_SIZE
("misc", 
p2
, 17);

197 
	`CHECK_BLOCKS
("misc", 
roŸ
, 1);

198 
	`èŒoc_u∆ök
(
NULL
, 
p1
);

200 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 10, "p1");

201 i‡(!
p1
)

202 
out
;

203 
p2
 = (*)
	`èŒoc_«med_c⁄°
(
roŸ
, 20, "p2");

204 i‡(!
p2
)

205 
out
;

206 i‡(!
	`èŒoc_ª„ªn˚
(
p1
, 
p2
))

207 
out
;

208 
	`èŒoc_u∆ök
(
roŸ
, 
p2
);

209 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

210 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

211 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

212 
	`èŒoc_u∆ök
(
p1
, 
p2
);

213 
	`èŒoc_u∆ök
(
roŸ
, 
p1
);

215 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 10, "p1");

216 i‡(!
p1
)

217 
out
;

218 
p2
 = (*)
	`èŒoc_«med_c⁄°
(
roŸ
, 20, "p2");

219 i‡(!
p2
)

220 
out
;

221 i‡(!
	`èŒoc_ª„ªn˚
(
NULL
, 
p2
))

222 
out
;

223 
	`èŒoc_u∆ök
(
roŸ
, 
p2
);

224 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

225 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

226 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

227 
	`èŒoc_u∆ök
(
NULL
, 
p2
);

228 
	`èŒoc_u∆ök
(
roŸ
, 
p1
);

232 
	`t‹tuª_as£π
("misc", 
	`èŒoc_u∆ök
(
roŸ
, 
NULL
) == -1,

235 
	`CHECK_SIZE
("misc", 
roŸ
, 0);

237 
	`èŒoc_íabÀ_Àak_ªp‹t
();

238 
	`èŒoc_íabÀ_Àak_ªp‹t_fuŒ
();

239 
ªt
 = 
åue
;

240 
out
:

241 
	`èŒoc_‰ì
(
roŸ
);

242  
ªt
;

243 
	}
}

245 
	$maö
(
¨gc
, *
¨gv
[])

247 
	`∂™_ã°s
(47);

248 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

250 
	`èŒoc_íabÀ_nuŒ_åackög
();

251 i‡(
nuŒ_c⁄ãxt
) {

252 
	`ok1
(
	`ã°_misc
(
NULL
));

254 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

255 
	`èŒoc_dißbÀ_nuŒ_åackög
();

257 
	`Áûã°_exô
(
	`exô_°©us
());

258 
	}
}

	@ccan/ccan/talloc/test/run-test_move.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_move
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
;

72 
	st_move
 {

73 *
p
;

74 *
x
;

75 } *
t1
, *
t2
;

76 
boﬁ
 
ªt
 = 
Ál£
;

78 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

79 i‡(!
roŸ
)

80 
out
;

82 
t1
 = 
	`èŒoc
(
roŸ
, 
t_move
);

83 i‡(!
t1
)

84 
out
;

85 
t2
 = 
	`èŒoc
(
roŸ
, 
t_move
);

86 i‡(!
t2
)

87 
out
;

88 
t1
->
p
 = 
	`èŒoc_°rdup
(t1, "foo");

89 i‡(!
t1
->
p
)

90 
out
;

91 
t1
->
x
 = 
	`èŒoc
(t1, );

92 i‡(!
t1
->
x
)

93 
out
;

94 *
t1
->
x
 = 42;

96 
t2
->
p
 = 
	`èŒoc_move
—2, &
t1
->p);

97 
t2
->
x
 = 
	`èŒoc_move
—2, &
t1
->x);

98 
	`t‹tuª_as£π
("move", 
t1
->
p
 =
NULL
 &&Å1->
x
 == NULL &&

99 
	`°rcmp
(
t2
->
p
, "foo"Ë=0 && *t2->
x
 == 42,

102 
ªt
 = 
åue
;

103 
out
:

104 
	`èŒoc_‰ì
(
roŸ
);

106  
ªt
;

107 
	}
}

109 
	$maö
(
¨gc
, *
¨gv
[])

111 
	`∂™_ã°s
(3);

112 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

114 
	`èŒoc_íabÀ_nuŒ_åackög
();

115 i‡(
nuŒ_c⁄ãxt
) {

116 
	`ok1
(
	`ã°_move
(
NULL
));

118 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

119 
	`èŒoc_dißbÀ_nuŒ_åackög
();

121 
	`Áûã°_exô
(
	`exô_°©us
());

122 
	}
}

	@ccan/ccan/talloc/test/run-test_realloc.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_ªÆloc
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
, *
p1
, *
p2
;

72 
boﬁ
 
ªt
 = 
Ál£
;

74 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

75 i‡(!
roŸ
)

76 
out
;

78 
p1
 = 
	`èŒoc_size
(
roŸ
, 10);

79 i‡(!
p1
)

80 
out
;

81 
	`CHECK_SIZE
("ªÆloc", 
p1
, 10);

83 
p1
 = 
	`èŒoc_ªÆloc_size
(
NULL
,Ö1, 20);

84 i‡(!
p1
)

85 
out
;

86 
	`CHECK_SIZE
("ªÆloc", 
p1
, 20);

88 i‡(!
	`èŒoc_√w
(
p1
))

89 
out
;

91 
p2
 = 
	`èŒoc_ªÆloc_size
(
p1
, 
NULL
, 30);

92 i‡(!
p2
)

93 
out
;

95 i‡(!
	`èŒoc_√w
(
p1
))

96 
out
;

98 
p2
 = 
	`èŒoc_ªÆloc_size
(
p1
,Ö2, 40);

99 i‡(!
p2
)

100 
out
;

102 
	`CHECK_SIZE
("ªÆloc", 
p2
, 40);

103 
	`CHECK_SIZE
("ªÆloc", 
roŸ
, 60);

104 
	`CHECK_BLOCKS
("ªÆloc", 
p1
, 4);

106 
p1
 = 
	`èŒoc_ªÆloc_size
(
NULL
,Ö1, 20);

107 i‡(!
p1
)

108 
out
;

109 
	`CHECK_SIZE
("ªÆloc", 
p1
, 60);

111 i‡(
	`èŒoc_ö¸ó£_ªf_cou¡
(
p2
) != 0)

112 
out
;

113 
	`t‹tuª_as£π
("ªÆloc", 
	`èŒoc_ªÆloc_size
(
NULL
, 
p2
, 5) == NULL,

115 
	`CHECK_BLOCKS
("ªÆloc", 
p1
, 4);

117 
	`ok1
(
	`èŒoc_ªÆloc_size
(
NULL
, 
p2
, 0) == NULL);

118 
	`ok1
(
	`èŒoc_ªÆloc_size
(
NULL
, 
p2
, 0) == NULL);

119 
	`CHECK_BLOCKS
("ªÆloc", 
p1
, 3);

121 
	`t‹tuª_as£π
("ªÆloc", 
	`èŒoc_ªÆloc_size
(
NULL
, 
p1
, 0x7fffffff) == NULL,

124 
	`ok1
(
	`èŒoc_ªÆloc_size
(
NULL
, 
p1
, 0) == NULL);

126 
	`CHECK_BLOCKS
("ªÆloc", 
roŸ
, 1);

127 
	`CHECK_SIZE
("ªÆloc", 
roŸ
, 0);

128 
ªt
 = 
åue
;

130 
out
:

131 
	`èŒoc_‰ì
(
roŸ
);

133  
ªt
;

134 
	}
}

139 
boﬁ
 
	$ã°_ªÆloc_chûd
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

141 *
roŸ
;

142 
	sñ2
 {

143 c⁄° *
«me
;

144 } *
ñ2
;

145 
	sñ1
 {

146 
cou¡
;

147 
ñ2
 **
li°
, **
li°2
, **
li°3
;

148 } *
ñ1
;

149 
boﬁ
 
ªt
 = 
Ál£
;

151 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

152 i‡(!
roŸ
)

153 
out
;

155 
ñ1
 = 
	`èŒoc
(
roŸ
, el1);

156 i‡(!
ñ1
)

157 
out
;

158 
ñ1
->
li°
 = 
	`èŒoc
”l1, 
ñ2
 *);

159 i‡(!
ñ1
->
li°
)

160 
out
;

161 
ñ1
->
li°
[0] = 
	`èŒoc
”l1->li°, 
ñ2
);

162 i‡(!
ñ1
->
li°
[0])

163 
out
;

164 
ñ1
->
li°
[0]->
«me
 = 
	`èŒoc_°rdup
(el1->list[0], "testing");

165 i‡(!
ñ1
->
li°
[0]->
«me
)

166 
out
;

168 
ñ1
->
li°2
 = 
	`èŒoc
”l1, 
ñ2
 *);

169 i‡(!
ñ1
->
li°2
)

170 
out
;

171 
ñ1
->
li°2
[0] = 
	`èŒoc
”l1->li°2, 
ñ2
);

172 i‡(!
ñ1
->
li°2
[0])

173 
out
;

174 
ñ1
->
li°2
[0]->
«me
 = 
	`èŒoc_°rdup
(el1->list2[0], "testing2");

175 i‡(!
ñ1
->
li°2
[0]->
«me
)

176 
out
;

178 
ñ1
->
li°3
 = 
	`èŒoc
”l1, 
ñ2
 *);

179 i‡(!
ñ1
->
li°3
)

180 
out
;

181 
ñ1
->
li°3
[0] = 
	`èŒoc
”l1->li°3, 
ñ2
);

182 i‡(!
ñ1
->
li°3
[0])

183 
out
;

184 
ñ1
->
li°3
[0]->
«me
 = 
	`èŒoc_°rdup
(el1->list3[0], "testing2");

185 i‡(!
ñ1
->
li°3
[0]->
«me
)

186 
out
;

188 
ñ2
 = 
	`èŒoc
(
ñ1
->
li°
, el2);

189 i‡(!
ñ2
)

190 
out
;

191 
ñ2
 = 
	`èŒoc
(
ñ1
->
li°2
, el2);

192 i‡(!
ñ2
)

193 
out
;

194 
ñ2
 = 
	`èŒoc
(
ñ1
->
li°3
, el2);

195 i‡(!
ñ2
)

196 
out
;

198 
ñ1
->
li°
 = 
	`èŒoc_ªÆloc
”l1,Él1->li°, 
ñ2
 *, 100);

199 i‡(!
ñ1
->
li°
)

200 
out
;

201 
ñ1
->
li°2
 = 
	`èŒoc_ªÆloc
”l1,Él1->li°2, 
ñ2
 *, 200);

202 i‡(!
ñ1
->
li°2
)

203 
out
;

204 
ñ1
->
li°3
 = 
	`èŒoc_ªÆloc
”l1,Él1->li°3, 
ñ2
 *, 300);

205 i‡(!
ñ1
->
li°3
)

206 
out
;

208 
ªt
 = 
åue
;

209 
out
:

210 
	`èŒoc_‰ì
(
roŸ
);

212  
ªt
;

213 
	}
}

215 
	$maö
(
¨gc
, *
¨gv
[])

217 
	`∂™_ã°s
(17);

218 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

220 
	`èŒoc_íabÀ_nuŒ_åackög
();

221 i‡(
nuŒ_c⁄ãxt
) {

222 
	`ok1
(
	`ã°_ªÆloc
(
NULL
Ë&& 
	`ã°_ªÆloc_chûd
(NULL));

224 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

225 
	`èŒoc_dißbÀ_nuŒ_åackög
();

227 
	`Áûã°_exô
(
	`exô_°©us
());

228 
	}
}

	@ccan/ccan/talloc/test/run-test_realloc_fn.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_ªÆloc_‚
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
, *
p1
;

72 
boﬁ
 
ªt
 = 
Ál£
;

74 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

75 i‡(!
roŸ
)

76 
out
;

78 
p1
 = 
	`èŒoc_ªÆloc_‚
(
roŸ
, 
NULL
, 10);

79 i‡(!
p1
)

80 
out
;

81 
	`CHECK_BLOCKS
("ªÆloc_‚", 
roŸ
, 2);

82 
	`CHECK_SIZE
("ªÆloc_‚", 
roŸ
, 10);

83 
p1
 = 
	`èŒoc_ªÆloc_‚
(
roŸ
,Ö1, 20);

84 i‡(!
p1
)

85 
out
;

86 
	`CHECK_BLOCKS
("ªÆloc_‚", 
roŸ
, 2);

87 
	`CHECK_SIZE
("ªÆloc_‚", 
roŸ
, 20);

88 
p1
 = 
	`èŒoc_ªÆloc_‚
(
roŸ
,Ö1, 0);

89 
	`CHECK_BLOCKS
("ªÆloc_‚", 
roŸ
, 1);

90 
	`CHECK_SIZE
("ªÆloc_‚", 
roŸ
, 0);

91 
ªt
 = 
åue
;

93 
out
:

94 
	`èŒoc_‰ì
(
roŸ
);

95  
ªt
;

96 
	}
}

98 
	$maö
(
¨gc
, *
¨gv
[])

100 
	`∂™_ã°s
(8);

101 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

103 
	`èŒoc_íabÀ_nuŒ_åackög
();

104 i‡(
nuŒ_c⁄ãxt
) {

105 
	`ok1
(
	`ã°_ªÆloc_‚
(
NULL
));

107 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

108 
	`èŒoc_dißbÀ_nuŒ_åackög
();

110 
	`Áûã°_exô
(
	`exô_°©us
());

111 
	}
}

	@ccan/ccan/talloc/test/run-test_ref.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_ªf1
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

72 
boﬁ
 
ªt
 = 
Ál£
;

74 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

75 i‡(!
roŸ
)

76 
out
;

77 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

78 i‡(!
p1
)

79 
out
;

80 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

81 i‡(!
p2
)

82 
out
;

83 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1"))

84 
out
;

85 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 2, "x2"))

86 
out
;

87 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 3, "x3"))

88 
out
;

90 
r1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "r1");

91 i‡(!
r1
)

92 
out
;

93 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

94 i‡(!
ªf
)

95 
out
;

97 
	`CHECK_BLOCKS
("ªf1", 
p1
, 5);

98 
	`CHECK_BLOCKS
("ªf1", 
p2
, 1);

99 
	`CHECK_BLOCKS
("ªf1", 
r1
, 2);

101 
	`èŒoc_‰ì
(
p2
);

103 
	`CHECK_BLOCKS
("ªf1", 
p1
, 5);

104 
	`CHECK_BLOCKS
("ªf1", 
p2
, 1);

105 
	`CHECK_BLOCKS
("ªf1", 
r1
, 1);

107 
	`èŒoc_‰ì
(
p1
);

109 
	`CHECK_BLOCKS
("ªf1", 
r1
, 1);

111 
	`èŒoc_‰ì
(
r1
);

113 i‡(
	`èŒoc_ª„ªn˚
(
roŸ
, 
NULL
)) {

114  
Ál£
;

117 
	`CHECK_BLOCKS
("ªf1", 
roŸ
, 1);

119 
	`CHECK_SIZE
("ªf1", 
roŸ
, 0);

120 
ªt
 = 
åue
;

121 
out
:

122 
	`èŒoc_‰ì
(
roŸ
);

123  
ªt
;

124 
	}
}

129 
boﬁ
 
	$ã°_ªf2
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

131 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

132 
boﬁ
 
ªt
 = 
Ál£
;

134 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

135 i‡(!
roŸ
)

136 
out
;

137 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

138 i‡(!
p1
)

139 
out
;

140 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1"))

141 
out
;

142 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x2"))

143 
out
;

144 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x3"))

145 
out
;

146 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

147 i‡(!
p2
)

148 
out
;

150 
r1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "r1");

151 i‡(!
r1
)

152 
out
;

153 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

154 i‡(!
ªf
)

155 
out
;

157 
	`CHECK_BLOCKS
("ªf2", 
p1
, 5);

158 
	`CHECK_BLOCKS
("ªf2", 
p2
, 1);

159 
	`CHECK_BLOCKS
("ªf2", 
r1
, 2);

161 
	`èŒoc_‰ì
(
ªf
);

163 
	`CHECK_BLOCKS
("ªf2", 
p1
, 5);

164 
	`CHECK_BLOCKS
("ªf2", 
p2
, 1);

165 
	`CHECK_BLOCKS
("ªf2", 
r1
, 1);

167 
	`èŒoc_‰ì
(
p2
);

169 
	`CHECK_BLOCKS
("ªf2", 
p1
, 4);

170 
	`CHECK_BLOCKS
("ªf2", 
r1
, 1);

172 
	`èŒoc_‰ì
(
p1
);

174 
	`CHECK_BLOCKS
("ªf2", 
r1
, 1);

176 
	`èŒoc_‰ì
(
r1
);

178 
	`CHECK_SIZE
("ªf2", 
roŸ
, 0);

179 
ªt
 = 
åue
;

181 
out
:

182 
	`èŒoc_‰ì
(
roŸ
);

183  
ªt
;

184 
	}
}

189 
boﬁ
 
	$ã°_ªf3
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

191 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

192 
boﬁ
 
ªt
 = 
Ál£
;

194 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

195 i‡(!
roŸ
)

196 
out
;

197 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

198 i‡(!
p1
)

199 
out
;

200 
p2
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p2");

201 i‡(!
p2
)

202 
out
;

203 
r1
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "r1");

204 i‡(!
r1
)

205 
out
;

206 
ªf
 = 
	`èŒoc_ª„ªn˚
(
p2
, 
r1
);

207 i‡(!
ªf
)

208 
out
;

210 
	`CHECK_BLOCKS
("ªf3", 
p1
, 2);

211 
	`CHECK_BLOCKS
("ªf3", 
p2
, 2);

212 
	`CHECK_BLOCKS
("ªf3", 
r1
, 1);

214 
	`èŒoc_‰ì
(
p1
);

216 
	`CHECK_BLOCKS
("ªf3", 
p2
, 2);

217 
	`CHECK_BLOCKS
("ªf3", 
r1
, 1);

219 
	`èŒoc_‰ì
(
p2
);

221 
	`CHECK_SIZE
("ªf3", 
roŸ
, 0);

223 
ªt
 = 
åue
;

224 
out
:

225 
	`èŒoc_‰ì
(
roŸ
);

227  
ªt
;

228 
	}
}

233 
boﬁ
 
	$ã°_ªf4
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

235 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

236 
boﬁ
 
ªt
 = 
Ál£
;

238 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

239 i‡(!
roŸ
)

240 
out
;

241 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

242 i‡(!
p1
)

243 
out
;

244 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1"))

245 
out
;

246 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x2"))

247 
out
;

248 i‡(!
	`èŒoc_«med_c⁄°
(
p1
, 1, "x3"))

249 
out
;

250 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

251 i‡(!
p2
)

252 
out
;

254 
r1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "r1");

255 i‡(!
r1
)

256 
out
;

257 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

258 i‡(!
ªf
)

259 
out
;

261 
	`CHECK_BLOCKS
("ªf4", 
p1
, 5);

262 
	`CHECK_BLOCKS
("ªf4", 
p2
, 1);

263 
	`CHECK_BLOCKS
("ªf4", 
r1
, 2);

265 
	`èŒoc_‰ì
(
r1
);

267 
	`CHECK_BLOCKS
("ªf4", 
p1
, 5);

268 
	`CHECK_BLOCKS
("ªf4", 
p2
, 1);

270 
	`èŒoc_‰ì
(
p2
);

272 
	`CHECK_BLOCKS
("ªf4", 
p1
, 4);

274 
	`èŒoc_‰ì
(
p1
);

276 
	`CHECK_SIZE
("ªf4", 
roŸ
, 0);

278 
ªt
 = 
åue
;

279 
out
:

280 
	`èŒoc_‰ì
(
roŸ
);

282  
ªt
;

283 
	}
}

285 
	$maö
(
¨gc
, *
¨gv
[])

287 
	`∂™_ã°s
(34);

288 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

290 
	`èŒoc_íabÀ_nuŒ_åackög
();

291 i‡(
nuŒ_c⁄ãxt
) {

292 
	`ok1
(
	`ã°_ªf1
(
NULL
)

293 && 
	`ã°_ªf2
(
NULL
)

294 && 
	`ã°_ªf3
(
NULL
)

295 && 
	`ã°_ªf4
(
NULL
));

297 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

298 
	`èŒoc_dißbÀ_nuŒ_åackög
();

300 
	`Áûã°_exô
(
	`exô_°©us
());

301 
	}
}

	@ccan/ccan/talloc/test/run-test_steal.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_°ól
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
, *
p1
, *
p2
;

72 
boﬁ
 
ªt
 = 
Ál£
;

74 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

75 i‡(!
roŸ
)

76 
out
;

78 
p1
 = 
	`èŒoc_¨øy
(
roŸ
, , 10);

79 i‡(!
p1
)

80 
out
;

81 
	`CHECK_SIZE
("°ól", 
p1
, 10);

83 
p2
 = 
	`èŒoc_ªÆloc
(
roŸ
, 
NULL
, , 20);

84 i‡(!
p2
)

85 
out
;

86 
	`CHECK_SIZE
("°ól", 
p1
, 10);

87 
	`CHECK_SIZE
("°ól", 
roŸ
, 30);

89 
	`t‹tuª_as£π
("°ól", 
	`èŒoc_°ól
(
p1
, 
NULL
) == NULL,

92 
	`t‹tuª_as£π
("°ól", 
	`èŒoc_°ól
(
p1
,Ö1) ==Ö1,

94 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 3);

95 
	`CHECK_SIZE
("°ól", 
roŸ
, 30);

97 
	`èŒoc_°ól
(
NULL
, 
p1
);

98 
	`èŒoc_°ól
(
NULL
, 
p2
);

99 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 1);

100 
	`CHECK_SIZE
("°ól", 
roŸ
, 0);

102 
	`èŒoc_‰ì
(
p1
);

103 
	`èŒoc_°ól
(
roŸ
, 
p2
);

104 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 2);

105 
	`CHECK_SIZE
("°ól", 
roŸ
, 20);

107 
	`èŒoc_‰ì
(
p2
);

109 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 1);

110 
	`CHECK_SIZE
("°ól", 
roŸ
, 0);

112 
	`èŒoc_‰ì
(
roŸ
);

113 
roŸ
 = 
NULL
;

115 
p1
 = 
	`èŒoc_size
(
NULL
, 3);

116 i‡(!
p1
)

117 
out
;

118 
	`CHECK_SIZE
("°ól", 
NULL
, 3);

119 
	`èŒoc_‰ì
(
p1
);

120 
ªt
 = 
åue
;

122 
out
:

123 
	`èŒoc_‰ì
(
roŸ
);

124  
ªt
;

125 
	}
}

127 
	$maö
(
¨gc
, *
¨gv
[])

129 
	`∂™_ã°s
(16);

130 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

132 
	`èŒoc_íabÀ_nuŒ_åackög
();

133 i‡(
nuŒ_c⁄ãxt
) {

134 
	`ok1
(
	`ã°_°ól
(
NULL
));

136 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

137 
	`èŒoc_dißbÀ_nuŒ_åackög
();

139 
	`Áûã°_exô
(
	`exô_°©us
());

140 
	}
}

	@ccan/ccan/talloc/test/run-test_talloc_ptrtype.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

66 
boﬁ
 
	$ã°_èŒoc_±πy≥
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

68 *
t›
 = 
	`èŒoc_√w
(
˘x
);

69 
	s°ru˘1
 {

70 
foo
;

71 
b¨
;

72 } *
s1
, *
s2
, **
s3
, ***
s4
;

73 c⁄° *
loˇti⁄1
;

74 c⁄° *
loˇti⁄2
;

75 c⁄° *
loˇti⁄3
;

76 c⁄° *
loˇti⁄4
;

77 
boﬁ
 
ªt
 = 
Ál£
;

79 i‡(!
t›
)

80 
out
;

82 
s1
 = 
	`èŒoc_±πy≥
(
t›
, s1);
loˇti⁄1
 = 
__loˇti⁄__
;

83 i‡(!
s1
)

84 
out
;

86 
	`ok1
(
	`èŒoc_gë_size
(
s1
Ë=(
°ru˘1
));

88 
	`ok1
(
	`°rcmp
(
loˇti⁄1
, 
	`èŒoc_gë_«me
(
s1
)) == 0);

90 
s2
 = 
	`èŒoc_¨øy_±πy≥
(
t›
, s2, 10);
loˇti⁄2
 = 
__loˇti⁄__
;

91 i‡(!
s2
)

92 
out
;

94 
	`ok1
(
	`èŒoc_gë_size
(
s2
Ë=((
°ru˘1
) * 10));

96 
	`ok1
(
	`°rcmp
(
loˇti⁄2
, 
	`èŒoc_gë_«me
(
s2
)) == 0);

98 
s3
 = 
	`èŒoc_¨øy_±πy≥
(
t›
, s3, 10);
loˇti⁄3
 = 
__loˇti⁄__
;

99 i‡(!
s3
)

100 
out
;

102 
	`ok1
(
	`èŒoc_gë_size
(
s3
Ë=((
°ru˘1
 *) * 10));

104 
	`t‹tuª_as£π_°r_equÆ
("±πy≥", 
loˇti⁄3
, 
	`èŒoc_gë_«me
(
s3
),

107 
s4
 = 
	`èŒoc_¨øy_±πy≥
(
t›
, s4, 10);
loˇti⁄4
 = 
__loˇti⁄__
;

108 i‡(!
s4
)

109 
out
;

111 
	`ok1
(
	`èŒoc_gë_size
(
s4
Ë=((
°ru˘1
 **) * 10));

113 
	`t‹tuª_as£π_°r_equÆ
("±πy≥", 
loˇti⁄4
, 
	`èŒoc_gë_«me
(
s4
),

115 
ªt
 = 
åue
;

117 
out
:

118 
	`èŒoc_‰ì
(
t›
);

120  
ªt
;

121 
	}
}

123 
	$maö
(
¨gc
, *
¨gv
[])

125 
	`∂™_ã°s
(10);

126 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

128 
	`èŒoc_íabÀ_nuŒ_åackög
();

129 i‡(
nuŒ_c⁄ãxt
) {

130 
	`ok1
(
	`ã°_èŒoc_±πy≥
(
NULL
));

132 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

133 
	`èŒoc_dißbÀ_nuŒ_åackög
();

135 
	`Áûã°_exô
(
	`exô_°©us
());

136 
	}
}

	@ccan/ccan/talloc/test/run-test_type.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_ty≥
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
;

72 
	sñ1
 {

73 
cou¡
;

75 
	sñ2
 {

76 
cou¡
;

78 
ñ1
 *el1;

79 
boﬁ
 
ªt
 = 
Ál£
;

81 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

83 
ñ1
 = 
	`èŒoc
(
roŸ
, el1);

84 i‡(!
ñ1
)

85 
out
;

87 
ñ1
->
cou¡
 = 1;

89 
	`t‹tuª_as£π
("ty≥", 
	`èŒoc_gë_ty≥
(
ñ1
, el1) ==Él1,

91 
	`t‹tuª_as£π
("ty≥", 
	`èŒoc_gë_ty≥
(
ñ1
, 
ñ2
Ë=
NULL
,

93 
	`èŒoc_£t_ty≥
(
ñ1
, 
ñ2
);

94 
	`t‹tuª_as£π
("ty≥", 
	`èŒoc_gë_ty≥
(
ñ1
, 
ñ2
) == (el2 *)el1,

96 
ªt
 = 
åue
;

97 
out
:

98 
	`èŒoc_‰ì
(
roŸ
);

100  
ªt
;

101 
	}
}

103 
	$maö
(
¨gc
, *
¨gv
[])

105 
	`∂™_ã°s
(5);

106 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

108 
	`èŒoc_íabÀ_nuŒ_åackög
();

109 i‡(
nuŒ_c⁄ãxt
) {

110 
	`ok1
(
	`ã°_ty≥
(
NULL
));

112 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

113 
	`èŒoc_dißbÀ_nuŒ_åackög
();

115 
	`Áûã°_exô
(
	`exô_°©us
());

116 
	}
}

	@ccan/ccan/talloc/test/run-test_unlink.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

69 
boﬁ
 
	$ã°_u∆ök1
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

71 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

72 
boﬁ
 
ªt
 = 
Ál£
;

74 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

75 i‡(!
roŸ
)

76 
out
;

78 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

79 i‡(!
p1
)

80 
out
;

81 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1");

82 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x2");

83 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x3");

84 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

85 i‡(!
p2
)

86 
out
;

88 
r1
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "r1");

89 i‡(!
r1
)

90 
out
;

91 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

92 i‡(!
ªf
)

93 
out
;

95 
	`CHECK_BLOCKS
("u∆ök", 
p1
, 7);

96 
	`CHECK_BLOCKS
("u∆ök", 
p2
, 1);

97 
	`CHECK_BLOCKS
("u∆ök", 
r1
, 2);

99 
	`èŒoc_u∆ök
(
r1
, 
p2
);

101 
	`CHECK_BLOCKS
("u∆ök", 
p1
, 6);

102 
	`CHECK_BLOCKS
("u∆ök", 
p2
, 1);

103 
	`CHECK_BLOCKS
("u∆ök", 
r1
, 1);

105 
	`èŒoc_‰ì
(
p1
);

107 
	`CHECK_SIZE
("u∆ök", 
roŸ
, 0);

108 
ªt
 = 
åue
;

109 
out
:

110 
	`èŒoc_‰ì
(
roŸ
);

112  
ªt
;

113 
	}
}

115 
	$maö
(
¨gc
, *
¨gv
[])

117 
	`∂™_ã°s
(9);

118 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

120 
	`èŒoc_íabÀ_nuŒ_åackög
();

121 i‡(
nuŒ_c⁄ãxt
) {

122 
	`ok1
(
	`ã°_u∆ök1
(
NULL
));

124 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

125 
	`èŒoc_dißbÀ_nuŒ_åackög
();

127 
	`Áûã°_exô
(
	`exô_°©us
());

128 
	}
}

	@ccan/ccan/talloc/test/run-test_unref_reparent.c

28 
	~<cˇn/Áûã°/Áûã°_ovîride.h
>

29 
	~<cˇn/èŒoc/èŒoc.c
>

30 
	~<°dboﬁ.h
>

31 
	~<cˇn/èp/èp.h
>

32 
	~<cˇn/Áûã°/Áûã°.h
>

34 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

35 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

36 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

38 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

39 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

41 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

43 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

44 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

46 
ã°
, #ptr, \

47 ()
	`èŒoc_tŸÆ_size
(
±r
), \

48 ()
tsize
)

	)

50 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

51 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

53 
ã°
, #ptr, \

54 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

55 ()
tblocks
)

	)

57 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

58 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

60 
ã°
, #ptr, \

61 
	`èŒoc_∑ª¡
(
±r
), \

62 (
∑ª¡
))

	)

64 
	gt‹tuª_c⁄ãxt
;

66 
boﬁ
 
	$ã°_uƒef_ª∑ª¡
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

68 *
roŸ
, *
p1
, *
p2
, *
c1
;

69 
boﬁ
 
ªt
 = 
Ál£
;

71 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

72 i‡(!
roŸ
)

73 
out
;

74 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "origÖarent");

75 i‡(!
p1
)

76 
out
;

77 
p2
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "parent byÑeference");

78 i‡(!
p2
)

79 
out
;

81 
c1
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "child");

82 i‡(!
c1
)

83 
out
;

85 i‡(!
	`èŒoc_ª„ªn˚
(
p2
, 
c1
))

86 
out
;

88 
	`CHECK_PARENT
("uƒef_ª∑ª¡", 
c1
, 
p1
);

90 
	`èŒoc_‰ì
(
p1
);

92 
	`CHECK_PARENT
("uƒef_ª∑ª¡", 
c1
, 
p2
);

94 
	`èŒoc_u∆ök
(
p2
, 
c1
);

96 
	`CHECK_SIZE
("uƒef_ª∑ª¡", 
roŸ
, 1);

98 
	`èŒoc_‰ì
(
p2
);

99 
ªt
 = 
åue
;

100 
out
:

101 
	`èŒoc_‰ì
(
roŸ
);

103  
ªt
;

104 
	}
}

106 
boﬁ
 
	$ã°_li„Àss
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

108 *
t›
 = 
	`èŒoc_√w
(
˘x
);

109 *
∑ª¡
, *
chûd
;

110 *
chûd_ow√r
 = 
	`èŒoc_√w
(
˘x
);

112 
∑ª¡
 = 
	`èŒoc_°rdup
(
t›
, "parent");

113 i‡(!
∑ª¡
)

114  
Ál£
;

115 
chûd
 = 
	`èŒoc_°rdup
(
∑ª¡
, "child");

116 i‡(!
chûd
) {

117 
	`èŒoc_‰ì
(
∑ª¡
);

118  
Ál£
;

120 i‡(!
	`èŒoc_ª„ªn˚
(
chûd
, 
∑ª¡
)) {

121 
	`èŒoc_‰ì
(
∑ª¡
);

122  
Ál£
;

125 i‡(!
	`èŒoc_ª„ªn˚
(
chûd_ow√r
, 
chûd
)) {

126 
	`èŒoc_u∆ök
(
chûd
, 
∑ª¡
);

127 
	`èŒoc_‰ì
(
∑ª¡
);

128  
Ál£
;

131 
	`èŒoc_u∆ök
(
t›
, 
∑ª¡
);

132 
	`èŒoc_‰ì
(
chûd
);

133 
	`èŒoc_‰ì
(
t›
);

134 
	`èŒoc_‰ì
(
chûd_ow√r
);

135 
	`èŒoc_‰ì
(
chûd
);

137  
åue
;

138 
	}
}

140 
	$maö
(
¨gc
, *
¨gv
[])

142 
	`∂™_ã°s
(5);

143 
	`Áûã°_öô
(
¨gc
, 
¨gv
);

145 
	`èŒoc_íabÀ_nuŒ_åackög
();

146 i‡(
nuŒ_c⁄ãxt
) {

147 
	`ok1
(
	`ã°_uƒef_ª∑ª¡
(
NULL
Ë&& 
	`ã°_li„Àss
(NULL));

149 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

150 
	`èŒoc_dißbÀ_nuŒ_åackög
();

152 
	`Áûã°_exô
(
	`exô_°©us
());

153 
	}
}

	@ccan/ccan/talloc/test/run.c

28 
	~<cˇn/èŒoc/èŒoc.c
>

29 
	~<°dboﬁ.h
>

30 
	~<cˇn/èp/èp.h
>

32 
	#t‹tuª_as£π
(
ã°
, 
ex¥
, 
°r
) \

33 
	`ok
(
ex¥
, "%s [\n%s: Expression %s failed: %s\n]\n", \

34 
ã°
, 
__loˇti⁄__
, #ex¥, 
°r
)

	)

36 
	#t‹tuª_as£π_°r_equÆ
(
ã°
, 
¨g1
, 
¨g2
, 
desc
) \

37 
	`ok
(
	`°rcmp
(
¨g1
, 
¨g2
) == 0, \

39 
ã°
, 
__loˇti⁄__
, 
¨g1
, 
¨g2
, 
desc
)

	)

41 
	#CHECK_SIZE
(
ã°
, 
±r
, 
tsize
) \

42 
	`ok
(
	`èŒoc_tŸÆ_size
(
±r
Ë=(
tsize
), \

44 
ã°
, #ptr, \

45 ()
	`èŒoc_tŸÆ_size
(
±r
), \

46 ()
tsize
)

	)

48 
	#CHECK_BLOCKS
(
ã°
, 
±r
, 
tblocks
) \

49 
	`ok
(
	`èŒoc_tŸÆ_blocks
(
±r
Ë=(
tblocks
), \

51 
ã°
, #ptr, \

52 ()
	`èŒoc_tŸÆ_blocks
(
±r
), \

53 ()
tblocks
)

	)

55 
	#CHECK_PARENT
(
ã°
, 
±r
, 
∑ª¡
) \

56 
	`ok
(
	`èŒoc_∑ª¡
(
±r
Ë=(
∑ª¡
), \

58 
ã°
, #ptr, \

59 
	`èŒoc_∑ª¡
(
±r
), \

60 (
∑ª¡
))

	)

62 
	gt‹tuª_c⁄ãxt
;

67 
boﬁ
 
	$ã°_ªf1
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

69 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

71 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

72 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

73 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

74 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1");

75 
	`èŒoc_«med_c⁄°
(
p1
, 2, "x2");

76 
	`èŒoc_«med_c⁄°
(
p1
, 3, "x3");

78 
r1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "r1");

79 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

81 
	`CHECK_BLOCKS
("ªf1", 
p1
, 5);

82 
	`CHECK_BLOCKS
("ªf1", 
p2
, 1);

83 
	`CHECK_BLOCKS
("ªf1", 
r1
, 2);

85 
	`èŒoc_‰ì
(
p2
);

87 
	`CHECK_BLOCKS
("ªf1", 
p1
, 5);

88 
	`CHECK_BLOCKS
("ªf1", 
p2
, 1);

89 
	`CHECK_BLOCKS
("ªf1", 
r1
, 1);

91 
	`èŒoc_‰ì
(
p1
);

93 
	`CHECK_BLOCKS
("ªf1", 
r1
, 1);

95 
	`èŒoc_‰ì
(
r1
);

97 i‡(
	`èŒoc_ª„ªn˚
(
roŸ
, 
NULL
)) {

98  
Ál£
;

101 
	`CHECK_BLOCKS
("ªf1", 
roŸ
, 1);

103 
	`CHECK_SIZE
("ªf1", 
roŸ
, 0);

105 
	`èŒoc_‰ì
(
roŸ
);

106  
åue
;

107 
	}
}

112 
boﬁ
 
	$ã°_ªf2
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

114 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

116 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

117 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

118 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1");

119 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x2");

120 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x3");

121 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

123 
r1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "r1");

124 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

126 
	`CHECK_BLOCKS
("ªf2", 
p1
, 5);

127 
	`CHECK_BLOCKS
("ªf2", 
p2
, 1);

128 
	`CHECK_BLOCKS
("ªf2", 
r1
, 2);

130 
	`èŒoc_‰ì
(
ªf
);

132 
	`CHECK_BLOCKS
("ªf2", 
p1
, 5);

133 
	`CHECK_BLOCKS
("ªf2", 
p2
, 1);

134 
	`CHECK_BLOCKS
("ªf2", 
r1
, 1);

136 
	`èŒoc_‰ì
(
p2
);

138 
	`CHECK_BLOCKS
("ªf2", 
p1
, 4);

139 
	`CHECK_BLOCKS
("ªf2", 
r1
, 1);

141 
	`èŒoc_‰ì
(
p1
);

143 
	`CHECK_BLOCKS
("ªf2", 
r1
, 1);

145 
	`èŒoc_‰ì
(
r1
);

147 
	`CHECK_SIZE
("ªf2", 
roŸ
, 0);

149 
	`èŒoc_‰ì
(
roŸ
);

150  
åue
;

151 
	}
}

156 
boﬁ
 
	$ã°_ªf3
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

158 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

160 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

161 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

162 
p2
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p2");

163 
r1
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "r1");

164 
ªf
 = 
	`èŒoc_ª„ªn˚
(
p2
, 
r1
);

166 
	`CHECK_BLOCKS
("ªf3", 
p1
, 2);

167 
	`CHECK_BLOCKS
("ªf3", 
p2
, 2);

168 
	`CHECK_BLOCKS
("ªf3", 
r1
, 1);

170 
	`èŒoc_‰ì
(
p1
);

172 
	`CHECK_BLOCKS
("ªf3", 
p2
, 2);

173 
	`CHECK_BLOCKS
("ªf3", 
r1
, 1);

175 
	`èŒoc_‰ì
(
p2
);

177 
	`CHECK_SIZE
("ªf3", 
roŸ
, 0);

179 
	`èŒoc_‰ì
(
roŸ
);

181  
åue
;

182 
	}
}

187 
boﬁ
 
	$ã°_ªf4
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

189 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

191 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

192 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

193 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1");

194 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x2");

195 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x3");

196 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

198 
r1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "r1");

199 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

201 
	`CHECK_BLOCKS
("ªf4", 
p1
, 5);

202 
	`CHECK_BLOCKS
("ªf4", 
p2
, 1);

203 
	`CHECK_BLOCKS
("ªf4", 
r1
, 2);

205 
	`èŒoc_‰ì
(
r1
);

207 
	`CHECK_BLOCKS
("ªf4", 
p1
, 5);

208 
	`CHECK_BLOCKS
("ªf4", 
p2
, 1);

210 
	`èŒoc_‰ì
(
p2
);

212 
	`CHECK_BLOCKS
("ªf4", 
p1
, 4);

214 
	`èŒoc_‰ì
(
p1
);

216 
	`CHECK_SIZE
("ªf4", 
roŸ
, 0);

218 
	`èŒoc_‰ì
(
roŸ
);

220  
åue
;

221 
	}
}

227 
boﬁ
 
	$ã°_u∆ök1
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

229 *
roŸ
, *
p1
, *
p2
, *
ªf
, *
r1
;

231 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

232 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "p1");

233 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x1");

234 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x2");

235 
	`èŒoc_«med_c⁄°
(
p1
, 1, "x3");

236 
p2
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "p2");

238 
r1
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "r1");

239 
ªf
 = 
	`èŒoc_ª„ªn˚
(
r1
, 
p2
);

241 
	`CHECK_BLOCKS
("u∆ök", 
p1
, 7);

242 
	`CHECK_BLOCKS
("u∆ök", 
p2
, 1);

243 
	`CHECK_BLOCKS
("u∆ök", 
r1
, 2);

245 
	`èŒoc_u∆ök
(
r1
, 
p2
);

247 
	`CHECK_BLOCKS
("u∆ök", 
p1
, 6);

248 
	`CHECK_BLOCKS
("u∆ök", 
p2
, 1);

249 
	`CHECK_BLOCKS
("u∆ök", 
r1
, 1);

251 
	`èŒoc_‰ì
(
p1
);

253 
	`CHECK_SIZE
("u∆ök", 
roŸ
, 0);

255 
	`èŒoc_‰ì
(
roŸ
);

257  
åue
;

258 
	}
}

260 
	$Áû_de°ru˘‹
(*
±r
)

263 
	}
}

268 
boﬁ
 
	$ã°_misc
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

270 *
roŸ
, *
p1
;

271 *
p2
;

272 *
d
;

273 c⁄° *
«me
;

275 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

277 
p1
 = 
	`èŒoc_size
(
roŸ
, 0x7fffffff);

278 
	`t‹tuª_as£π
("misc", !
p1
, "failed:ÜargeÅallocállowed\n");

280 
p1
 = 
	`èŒoc_°rdup
(
roŸ
, "foo");

281 
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
);

282 
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
);

283 
	`èŒoc_ö¸ó£_ªf_cou¡
(
p1
);

284 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

285 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

286 
	`èŒoc_‰ì
(
p1
);

287 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

288 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

289 
	`èŒoc_u∆ök
(
NULL
, 
p1
);

290 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

291 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

292 
p2
 = 
	`èŒoc_°rdup
(
p1
, "foo");

293 
	`t‹tuª_as£π
("misc", 
	`èŒoc_u∆ök
(
roŸ
, 
p2
) == -1,

295 
	`t‹tuª_as£π
("misc", 
	`èŒoc_u∆ök
(
p1
, 
p2
) == 0,

297 
	`èŒoc_‰ì
(
p1
);

298 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

299 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

301 
«me
 = 
	`èŒoc_£t_«me
(
p1
, "myÇame is %s", "foo");

302 
	`t‹tuª_as£π_°r_equÆ
("misc", 
	`èŒoc_gë_«me
(
p1
), "myÇame is foo",

304 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

305 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

307 
	`èŒoc_£t_«me_c⁄°
(
p1
, 
NULL
);

308 
	`t‹tuª_as£π_°r_equÆ
 ("misc", 
	`èŒoc_gë_«me
(
p1
), "UNNAMED",

310 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

311 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

313 
	`t‹tuª_as£π
("misc", 
	`èŒoc_‰ì
(
NULL
) == -1,

316 
	`èŒoc_£t_de°ru˘‹
(
p1
, 
Áû_de°ru˘‹
);

317 
	`t‹tuª_as£π
("misc", 
	`èŒoc_‰ì
(
p1
) == -1,

319 
	`èŒoc_£t_de°ru˘‹
(
p1
, 
NULL
);

322 
p2
 = (*)
	`èŒoc_zîo_size
(
p1
, 20);

323 
	`t‹tuª_as£π
("misc", 
p2
[19] == 0, "FailedÅo give zero memory\n");

324 
	`èŒoc_‰ì
(
p2
);

326 
	`t‹tuª_as£π
("misc", 
	`èŒoc_°rdup
(
roŸ
, 
NULL
) == NULL,

329 
p2
 = 
	`èŒoc_°∫dup
(
p1
, "foo", 2);

330 
	`t‹tuª_as£π
("misc", 
	`°rcmp
("fo", 
p2
) == 0,

332 
p2
 = 
	`èŒoc_a•rötf_≠≥nd
(p2, "o%c", 'd');

333 
	`t‹tuª_as£π
("misc", 
	`°rcmp
("food", 
p2
) == 0,

335 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

336 
	`CHECK_BLOCKS
("misc", 
p1
, 3);

338 
p2
 = 
	`èŒoc_a•rötf_≠≥nd
(
NULL
, "hello %s", "world");

339 
	`t‹tuª_as£π
("misc", 
	`°rcmp
("hñlÿw‹ld", 
p2
) == 0,

341 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

342 
	`CHECK_BLOCKS
("misc", 
p1
, 3);

343 
	`èŒoc_‰ì
(
p2
);

345 
d
 = 
	`èŒoc_¨øy
(
p1
, , 0x20000000);

346 
	`t‹tuª_as£π
("misc", !
d
, "failed: integer overflowÇot detected\n");

348 
d
 = 
	`èŒoc_ªÆloc
(
p1
, d, , 0x20000000);

349 
	`t‹tuª_as£π
("misc", !
d
, "failed: integer overflowÇot detected\n");

351 
	`èŒoc_‰ì
(
p1
);

352 
	`CHECK_BLOCKS
("misc", 
roŸ
, 1);

354 
p1
 = 
	`èŒoc_«med
(
roŸ
, 100, "%d bytes", 100);

355 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

356 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

357 
	`èŒoc_u∆ök
(
roŸ
, 
p1
);

359 
p1
 = 
	`èŒoc_öô
("%d bytes", 200);

360 
p2
 = 
	`èŒoc_a•rötf
(
p1
, "myÅest '%s'", "string");

361 
	`t‹tuª_as£π_°r_equÆ
("misc", 
p2
, "myÅest 'string'",

363 
	`CHECK_BLOCKS
("misc", 
p1
, 3);

364 
	`CHECK_SIZE
("misc", 
p2
, 17);

365 
	`CHECK_BLOCKS
("misc", 
roŸ
, 1);

366 
	`èŒoc_u∆ök
(
NULL
, 
p1
);

368 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 10, "p1");

369 
p2
 = (*)
	`èŒoc_«med_c⁄°
(
roŸ
, 20, "p2");

370 ()
	`èŒoc_ª„ªn˚
(
p1
, 
p2
);

371 
	`èŒoc_u∆ök
(
roŸ
, 
p2
);

372 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

373 
	`CHECK_BLOCKS
("misc", 
p1
, 2);

374 
	`CHECK_BLOCKS
("misc", 
roŸ
, 3);

375 
	`èŒoc_u∆ök
(
p1
, 
p2
);

376 
	`èŒoc_u∆ök
(
roŸ
, 
p1
);

378 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 10, "p1");

379 
p2
 = (*)
	`èŒoc_«med_c⁄°
(
roŸ
, 20, "p2");

380 ()
	`èŒoc_ª„ªn˚
(
NULL
, 
p2
);

381 
	`èŒoc_u∆ök
(
roŸ
, 
p2
);

382 
	`CHECK_BLOCKS
("misc", 
p2
, 1);

383 
	`CHECK_BLOCKS
("misc", 
p1
, 1);

384 
	`CHECK_BLOCKS
("misc", 
roŸ
, 2);

385 
	`èŒoc_u∆ök
(
NULL
, 
p2
);

386 
	`èŒoc_u∆ök
(
roŸ
, 
p1
);

390 
	`t‹tuª_as£π
("misc", 
	`èŒoc_u∆ök
(
roŸ
, 
NULL
) == -1,

393 
	`CHECK_SIZE
("misc", 
roŸ
, 0);

395 
	`èŒoc_‰ì
(
roŸ
);

397 
	`CHECK_SIZE
("misc", 
NULL
, 0);

399 
	`èŒoc_íabÀ_Àak_ªp‹t
();

400 
	`èŒoc_íabÀ_Àak_ªp‹t_fuŒ
();

402  
åue
;

403 
	}
}

409 
boﬁ
 
	$ã°_ªÆloc
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

411 *
roŸ
, *
p1
, *
p2
;

413 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

415 
p1
 = 
	`èŒoc_size
(
roŸ
, 10);

416 
	`CHECK_SIZE
("ªÆloc", 
p1
, 10);

418 
p1
 = 
	`èŒoc_ªÆloc_size
(
NULL
,Ö1, 20);

419 
	`CHECK_SIZE
("ªÆloc", 
p1
, 20);

421 
	`èŒoc_√w
(
p1
);

423 
p2
 = 
	`èŒoc_ªÆloc_size
(
p1
, 
NULL
, 30);

425 
	`èŒoc_√w
(
p1
);

427 
p2
 = 
	`èŒoc_ªÆloc_size
(
p1
,Ö2, 40);

429 
	`CHECK_SIZE
("ªÆloc", 
p2
, 40);

430 
	`CHECK_SIZE
("ªÆloc", 
roŸ
, 60);

431 
	`CHECK_BLOCKS
("ªÆloc", 
p1
, 4);

433 
p1
 = 
	`èŒoc_ªÆloc_size
(
NULL
,Ö1, 20);

434 
	`CHECK_SIZE
("ªÆloc", 
p1
, 60);

436 
	`èŒoc_ö¸ó£_ªf_cou¡
(
p2
);

437 
	`t‹tuª_as£π
("ªÆloc", 
	`èŒoc_ªÆloc_size
(
NULL
, 
p2
, 5) == NULL,

439 
	`CHECK_BLOCKS
("ªÆloc", 
p1
, 4);

441 
	`ok1
(
	`èŒoc_ªÆloc_size
(
NULL
, 
p2
, 0) == NULL);

442 
	`ok1
(
	`èŒoc_ªÆloc_size
(
NULL
, 
p2
, 0) == NULL);

443 
	`CHECK_BLOCKS
("ªÆloc", 
p1
, 3);

445 
	`t‹tuª_as£π
("ªÆloc", 
	`èŒoc_ªÆloc_size
(
NULL
, 
p1
, 0x7fffffff) == NULL,

448 
p1
 = 
	`èŒoc_ªÆloc_size
(
NULL
,Ö1, 0);

450 
	`CHECK_BLOCKS
("ªÆloc", 
roŸ
, 1);

451 
	`CHECK_SIZE
("ªÆloc", 
roŸ
, 0);

453 
	`èŒoc_‰ì
(
roŸ
);

455  
åue
;

456 
	}
}

461 
boﬁ
 
	$ã°_ªÆloc_chûd
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

463 *
roŸ
;

464 
	sñ2
 {

465 c⁄° *
«me
;

466 } *
ñ2
;

467 
	sñ1
 {

468 
cou¡
;

469 
ñ2
 **
li°
, **
li°2
, **
li°3
;

470 } *
ñ1
;

472 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

474 
ñ1
 = 
	`èŒoc
(
roŸ
, el1);

475 
ñ1
->
li°
 = 
	`èŒoc
”l1, 
ñ2
 *);

476 
ñ1
->
li°
[0] = 
	`èŒoc
”l1->li°, 
ñ2
);

477 
ñ1
->
li°
[0]->
«me
 = 
	`èŒoc_°rdup
(el1->list[0], "testing");

479 
ñ1
->
li°2
 = 
	`èŒoc
”l1, 
ñ2
 *);

480 
ñ1
->
li°2
[0] = 
	`èŒoc
”l1->li°2, 
ñ2
);

481 
ñ1
->
li°2
[0]->
«me
 = 
	`èŒoc_°rdup
(el1->list2[0], "testing2");

483 
ñ1
->
li°3
 = 
	`èŒoc
”l1, 
ñ2
 *);

484 
ñ1
->
li°3
[0] = 
	`èŒoc
”l1->li°3, 
ñ2
);

485 
ñ1
->
li°3
[0]->
«me
 = 
	`èŒoc_°rdup
(el1->list3[0], "testing2");

487 
ñ2
 = 
	`èŒoc
(
ñ1
->
li°
, el2);

488 
ñ2
 = 
	`èŒoc
(
ñ1
->
li°2
, el2);

489 
ñ2
 = 
	`èŒoc
(
ñ1
->
li°3
, el2);

491 
ñ1
->
li°
 = 
	`èŒoc_ªÆloc
”l1,Él1->li°, 
ñ2
 *, 100);

492 
ñ1
->
li°2
 = 
	`èŒoc_ªÆloc
”l1,Él1->li°2, 
ñ2
 *, 200);

493 
ñ1
->
li°3
 = 
	`èŒoc_ªÆloc
”l1,Él1->li°3, 
ñ2
 *, 300);

495 
	`èŒoc_‰ì
(
roŸ
);

497  
åue
;

498 
	}
}

503 
boﬁ
 
	$ã°_ty≥
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

505 *
roŸ
;

506 
	sñ1
 {

507 
cou¡
;

509 
	sñ2
 {

510 
cou¡
;

512 
ñ1
 *el1;

514 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

516 
ñ1
 = 
	`èŒoc
(
roŸ
, el1);

518 
ñ1
->
cou¡
 = 1;

520 
	`t‹tuª_as£π
("ty≥", 
	`èŒoc_gë_ty≥
(
ñ1
, el1) ==Él1,

522 
	`t‹tuª_as£π
("ty≥", 
	`èŒoc_gë_ty≥
(
ñ1
, 
ñ2
Ë=
NULL
,

524 
	`èŒoc_£t_ty≥
(
ñ1
, 
ñ2
);

525 
	`t‹tuª_as£π
("ty≥", 
	`èŒoc_gë_ty≥
(
ñ1
, 
ñ2
) == (el2 *)el1,

528 
	`èŒoc_‰ì
(
roŸ
);

530  
åue
;

531 
	}
}

536 
boﬁ
 
	$ã°_°ól
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

538 *
roŸ
, *
p1
, *
p2
;

540 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

542 
p1
 = 
	`èŒoc_¨øy
(
roŸ
, , 10);

543 
	`CHECK_SIZE
("°ól", 
p1
, 10);

545 
p2
 = 
	`èŒoc_ªÆloc
(
roŸ
, 
NULL
, , 20);

546 
	`CHECK_SIZE
("°ól", 
p1
, 10);

547 
	`CHECK_SIZE
("°ól", 
roŸ
, 30);

549 
	`t‹tuª_as£π
("°ól", 
	`èŒoc_°ól
(
p1
, 
NULL
) == NULL,

552 
	`t‹tuª_as£π
("°ól", 
	`èŒoc_°ól
(
p1
,Ö1) ==Ö1,

554 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 3);

555 
	`CHECK_SIZE
("°ól", 
roŸ
, 30);

557 
	`èŒoc_°ól
(
NULL
, 
p1
);

558 
	`èŒoc_°ól
(
NULL
, 
p2
);

559 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 1);

560 
	`CHECK_SIZE
("°ól", 
roŸ
, 0);

562 
	`èŒoc_‰ì
(
p1
);

563 
	`èŒoc_°ól
(
roŸ
, 
p2
);

564 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 2);

565 
	`CHECK_SIZE
("°ól", 
roŸ
, 20);

567 
	`èŒoc_‰ì
(
p2
);

569 
	`CHECK_BLOCKS
("°ól", 
roŸ
, 1);

570 
	`CHECK_SIZE
("°ól", 
roŸ
, 0);

572 
	`èŒoc_‰ì
(
roŸ
);

574 
p1
 = 
	`èŒoc_size
(
NULL
, 3);

575 
	`CHECK_SIZE
("°ól", 
NULL
, 3);

576 
	`èŒoc_‰ì
(
p1
);

578  
åue
;

579 
	}
}

584 
boﬁ
 
	$ã°_move
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

586 *
roŸ
;

587 
	st_move
 {

588 *
p
;

589 *
x
;

590 } *
t1
, *
t2
;

592 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

594 
t1
 = 
	`èŒoc
(
roŸ
, 
t_move
);

595 
t2
 = 
	`èŒoc
(
roŸ
, 
t_move
);

596 
t1
->
p
 = 
	`èŒoc_°rdup
(t1, "foo");

597 
t1
->
x
 = 
	`èŒoc
(t1, );

598 *
t1
->
x
 = 42;

600 
t2
->
p
 = 
	`èŒoc_move
—2, &
t1
->p);

601 
t2
->
x
 = 
	`èŒoc_move
—2, &
t1
->x);

602 
	`t‹tuª_as£π
("move", 
t1
->
p
 =
NULL
 &&Å1->
x
 == NULL &&

603 
	`°rcmp
(
t2
->
p
, "foo"Ë=0 && *t2->
x
 == 42,

606 
	`èŒoc_‰ì
(
roŸ
);

608  
åue
;

609 
	}
}

614 
boﬁ
 
	$ã°_ªÆloc_‚
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

616 *
roŸ
, *
p1
;

618 
roŸ
 = 
	`èŒoc_√w
(
˘x
);

620 
p1
 = 
	`èŒoc_ªÆloc_‚
(
roŸ
, 
NULL
, 10);

621 
	`CHECK_BLOCKS
("ªÆloc_‚", 
roŸ
, 2);

622 
	`CHECK_SIZE
("ªÆloc_‚", 
roŸ
, 10);

623 
p1
 = 
	`èŒoc_ªÆloc_‚
(
roŸ
,Ö1, 20);

624 
	`CHECK_BLOCKS
("ªÆloc_‚", 
roŸ
, 2);

625 
	`CHECK_SIZE
("ªÆloc_‚", 
roŸ
, 20);

626 
p1
 = 
	`èŒoc_ªÆloc_‚
(
roŸ
,Ö1, 0);

627 
	`CHECK_BLOCKS
("ªÆloc_‚", 
roŸ
, 1);

628 
	`CHECK_SIZE
("ªÆloc_‚", 
roŸ
, 0);

630 
	`èŒoc_‰ì
(
roŸ
);

632  
åue
;

633 
	}
}

636 
boﬁ
 
	$ã°_uƒef_ª∑ª¡
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

638 *
roŸ
, *
p1
, *
p2
, *
c1
;

640 
roŸ
 = 
	`èŒoc_«med_c⁄°
(
˘x
, 0, "root");

641 
p1
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "origÖarent");

642 
p2
 = 
	`èŒoc_«med_c⁄°
(
roŸ
, 1, "parent byÑeference");

644 
c1
 = 
	`èŒoc_«med_c⁄°
(
p1
, 1, "child");

645 
	`èŒoc_ª„ªn˚
(
p2
, 
c1
);

647 
	`CHECK_PARENT
("uƒef_ª∑ª¡", 
c1
, 
p1
);

649 
	`èŒoc_‰ì
(
p1
);

651 
	`CHECK_PARENT
("uƒef_ª∑ª¡", 
c1
, 
p2
);

653 
	`èŒoc_u∆ök
(
p2
, 
c1
);

655 
	`CHECK_SIZE
("uƒef_ª∑ª¡", 
roŸ
, 1);

657 
	`èŒoc_‰ì
(
p2
);

658 
	`èŒoc_‰ì
(
roŸ
);

660  
åue
;

661 
	}
}

663 
boﬁ
 
	$ã°_li„Àss
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

665 *
t›
 = 
	`èŒoc_√w
(
˘x
);

666 *
∑ª¡
, *
chûd
;

667 *
chûd_ow√r
 = 
	`èŒoc_√w
(
˘x
);

669 
∑ª¡
 = 
	`èŒoc_°rdup
(
t›
, "parent");

670 
chûd
 = 
	`èŒoc_°rdup
(
∑ª¡
, "child");

671 ()
	`èŒoc_ª„ªn˚
(
chûd
, 
∑ª¡
);

672 ()
	`èŒoc_ª„ªn˚
(
chûd_ow√r
, 
chûd
);

673 
	`èŒoc_u∆ök
(
t›
, 
∑ª¡
);

674 
	`èŒoc_‰ì
(
chûd
);

675 
	`èŒoc_‰ì
(
t›
);

676 
	`èŒoc_‰ì
(
chûd_ow√r
);

677 
	`èŒoc_‰ì
(
chûd
);

679  
åue
;

680 
	}
}

682 
	glo›_de°ru˘‹_cou¡
;

684 
	$ã°_lo›_de°ru˘‹
(*
±r
)

686 
lo›_de°ru˘‹_cou¡
++;

688 
	}
}

690 
boﬁ
 
	$ã°_lo›
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

692 *
t›
 = 
	`èŒoc_√w
(
˘x
);

693 *
∑ª¡
;

694 
	sªq1
 {

695 *
ªq2
, *
ªq3
;

696 } *
ªq1
;

698 
∑ª¡
 = 
	`èŒoc_°rdup
(
t›
, "parent");

699 
ªq1
 = 
	`èŒoc
(
∑ª¡
, req1);

700 
ªq1
->
ªq2
 = 
	`èŒoc_°rdup
(req1, "req2");

701 
	`èŒoc_£t_de°ru˘‹
(
ªq1
->
ªq2
, 
ã°_lo›_de°ru˘‹
);

702 
ªq1
->
ªq3
 = 
	`èŒoc_°rdup
(req1, "req3");

703 ()
	`èŒoc_ª„ªn˚
(
ªq1
->
ªq3
,Ñeq1);

704 
	`èŒoc_‰ì
(
∑ª¡
);

705 
	`èŒoc_‰ì
(
t›
);

707 
	`t‹tuª_as£π
("lo›", 
lo›_de°ru˘‹_cou¡
 == 1,

709 
lo›_de°ru˘‹_cou¡
 = 0;

711  
åue
;

712 
	}
}

714 
	$Áû_de°ru˘‹_°r
(*
±r
)

717 
	}
}

719 
boﬁ
 
	$ã°_‰ì_∑ª¡_díy_chûd
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

721 *
t›
 = 
	`èŒoc_√w
(
˘x
);

722 *
Àvñ1
;

723 *
Àvñ2
;

724 *
Àvñ3
;

726 
Àvñ1
 = 
	`èŒoc_°rdup
(
t›
, "level1");

727 
Àvñ2
 = 
	`èŒoc_°rdup
(
Àvñ1
, "level2");

728 
Àvñ3
 = 
	`èŒoc_°rdup
(
Àvñ2
, "level3");

730 
	`èŒoc_£t_de°ru˘‹
(
Àvñ3
, 
Áû_de°ru˘‹_°r
);

731 
	`èŒoc_‰ì
(
Àvñ1
);

732 
	`èŒoc_£t_de°ru˘‹
(
Àvñ3
, 
NULL
);

734 
	`CHECK_PARENT
("‰ì_∑ª¡_díy_chûd", 
Àvñ3
, 
t›
);

736 
	`èŒoc_‰ì
(
t›
);

738  
åue
;

739 
	}
}

741 
boﬁ
 
	$ã°_èŒoc_±πy≥
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

743 *
t›
 = 
	`èŒoc_√w
(
˘x
);

744 
	s°ru˘1
 {

745 
foo
;

746 
b¨
;

747 } *
s1
, *
s2
, **
s3
, ***
s4
;

748 c⁄° *
loˇti⁄1
;

749 c⁄° *
loˇti⁄2
;

750 c⁄° *
loˇti⁄3
;

751 c⁄° *
loˇti⁄4
;

753 
s1
 = 
	`èŒoc_±πy≥
(
t›
, s1);
loˇti⁄1
 = 
__loˇti⁄__
;

755 
	`ok1
(
	`èŒoc_gë_size
(
s1
Ë=(
°ru˘1
));

757 
	`ok1
(
	`°rcmp
(
loˇti⁄1
, 
	`èŒoc_gë_«me
(
s1
)) == 0);

759 
s2
 = 
	`èŒoc_¨øy_±πy≥
(
t›
, s2, 10);
loˇti⁄2
 = 
__loˇti⁄__
;

761 
	`ok1
(
	`èŒoc_gë_size
(
s2
Ë=((
°ru˘1
) * 10));

763 
	`ok1
(
	`°rcmp
(
loˇti⁄2
, 
	`èŒoc_gë_«me
(
s2
)) == 0);

765 
s3
 = 
	`èŒoc_¨øy_±πy≥
(
t›
, s3, 10);
loˇti⁄3
 = 
__loˇti⁄__
;

767 
	`ok1
(
	`èŒoc_gë_size
(
s3
Ë=((
°ru˘1
 *) * 10));

769 
	`t‹tuª_as£π_°r_equÆ
("±πy≥", 
loˇti⁄3
, 
	`èŒoc_gë_«me
(
s3
),

772 
s4
 = 
	`èŒoc_¨øy_±πy≥
(
t›
, s4, 10);
loˇti⁄4
 = 
__loˇti⁄__
;

774 
	`ok1
(
	`èŒoc_gë_size
(
s4
Ë=((
°ru˘1
 **) * 10));

776 
	`t‹tuª_as£π_°r_equÆ
("±πy≥", 
loˇti⁄4
, 
	`èŒoc_gë_«me
(
s4
),

779 
	`èŒoc_‰ì
(
t›
);

781  
åue
;

782 
	}
}

784 
boﬁ
 
	gã°_èŒoc_‰ì_ö_de°ru˘‹_run
;

785 
	$_ã°_èŒoc_‰ì_ö_de°ru˘‹
(**
±r
)

787 
	`èŒoc_‰ì
(*
±r
);

788 
ã°_èŒoc_‰ì_ö_de°ru˘‹_run
 = 
åue
;

790 
	}
}

792 
boﬁ
 
	$ã°_èŒoc_‰ì_ö_de°ru˘‹
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

794 *
Àvñ0
;

795 *
Àvñ1
;

796 *
Àvñ2
;

797 *
Àvñ3
;

798 *
Àvñ4
;

799 **
Àvñ5
;

802 i‡(
˘x
)

803  
åue
;

805 
Àvñ0
 = 
	`èŒoc_√w
(
˘x
);

806 
Àvñ1
 = 
	`èŒoc_√w
(
Àvñ0
);

807 
Àvñ2
 = 
	`èŒoc_√w
(
Àvñ1
);

808 
Àvñ3
 = 
	`èŒoc_√w
(
Àvñ2
);

809 
Àvñ4
 = 
	`èŒoc_√w
(
Àvñ3
);

810 
Àvñ5
 = 
	`èŒoc
(
Àvñ4
, *);

812 *
Àvñ5
 = 
	`èŒoc_ª„ªn˚
(
NULL
, 
Àvñ3
);

814 
ã°_èŒoc_‰ì_ö_de°ru˘‹_run
 = 
Ál£
;

815 
	`èŒoc_£t_de°ru˘‹
(
Àvñ5
, 
_ã°_èŒoc_‰ì_ö_de°ru˘‹
);

817 
	`èŒoc_‰ì
(
Àvñ1
);

819 
	`èŒoc_‰ì
(
Àvñ0
);

821 
	`ok1
(
ã°_èŒoc_‰ì_ö_de°ru˘‹_run
);

823  
åue
;

824 
	}
}

826 
boﬁ
 
	$ã°_auto‰ì
(c⁄° 
t‹tuª_c⁄ãxt
 *
˘x
)

829 *
p
;

830 
p
 = 
	`èŒoc_auto‰ì_c⁄ãxt
();

831 
	`èŒoc_‰ì
(
p
);

833 
p
 = 
	`èŒoc_auto‰ì_c⁄ãxt
();

834 
	`èŒoc_‰ì
(
p
);

836  
åue
;

837 
	}
}

839 
boﬁ
 
	$t‹tuª_loˇl_èŒoc
(c⁄° 
t‹tuª_c⁄ãxt
 *
t˘x
)

841 
boﬁ
 
ªt
 = 
åue
;

843 
	`£éöebuf
(
°dout
);

845 
	`èŒoc_dißbÀ_nuŒ_åackög
();

846 
	`èŒoc_íabÀ_nuŒ_åackög
();

848 
ªt
 &
	`ã°_ªf1
(
t˘x
);

849 
ªt
 &
	`ã°_ªf2
(
t˘x
);

850 
ªt
 &
	`ã°_ªf3
(
t˘x
);

851 
ªt
 &
	`ã°_ªf4
(
t˘x
);

852 
ªt
 &
	`ã°_u∆ök1
(
t˘x
);

853 
ªt
 &
	`ã°_misc
(
t˘x
);

854 
ªt
 &
	`ã°_ªÆloc
(
t˘x
);

855 
ªt
 &
	`ã°_ªÆloc_chûd
(
t˘x
);

856 
ªt
 &
	`ã°_°ól
(
t˘x
);

857 
ªt
 &
	`ã°_move
(
t˘x
);

858 
ªt
 &
	`ã°_uƒef_ª∑ª¡
(
t˘x
);

859 
ªt
 &
	`ã°_ªÆloc_‚
(
t˘x
);

860 
ªt
 &
	`ã°_ty≥
(
t˘x
);

861 
ªt
 &
	`ã°_li„Àss
(
t˘x
);

862 
ªt
 &
	`ã°_lo›
(
t˘x
);

863 
ªt
 &
	`ã°_‰ì_∑ª¡_díy_chûd
(
t˘x
);

864 
ªt
 &
	`ã°_èŒoc_±πy≥
(
t˘x
);

865 
ªt
 &
	`ã°_èŒoc_‰ì_ö_de°ru˘‹
(
t˘x
);

866 
ªt
 &
	`ã°_auto‰ì
(
t˘x
);

868  
ªt
;

869 
	}
}

871 
	glock_Áûed
 = 0, 
	gu∆ock_Áûed
 = 0, 
	glock_bad
 = 0;

872 
	glocked
;

874 
	#MAX_ALLOCATIONS
 100

	)

875 *
	gÆloˇti⁄s
[
MAX_ALLOCATIONS
];

876 
	gnum_Ælocs
, 
	gnum_‰ìs
, 
	gnum_ªÆlocs
;

878 
	$föd_±r
(c⁄° *
p
)

880 
i
;

882 
i
 = 0; i < 
MAX_ALLOCATIONS
; i++)

883 i‡(
Æloˇti⁄s
[
i
] =
p
)

885  
i
;

886 
	}
}

888 
	$Æloˇti⁄s_u£d
()

890 
i
, 
ªt
 = 0;

892 
i
 = 0; i < 
MAX_ALLOCATIONS
; i++)

893 i‡(
Æloˇti⁄s
[
i
])

894 
ªt
++;

895  
ªt
;

896 
	}
}

898 
	$ã°_lock
(c⁄° *
˘x
)

900 i‡(
	`föd_±r
(
˘x
Ë=
MAX_ALLOCATIONS
)

901 
lock_bad
++;

903 i‡(
locked
)

904 
lock_Áûed
++;

905 
locked
 = 1;

906 
	}
}

908 
	$ã°_u∆ock
()

910 i‡(!
locked
)

911 
u∆ock_Áûed
++;

912 
locked
 = 0;

913 
	}
}

915 
	gªÆloc_ˇŒed
, 
	gªÆloc_bad
;

917 *
	$n‹mÆ_ªÆloc
(c⁄° *
∑ª¡
, *
±r
, 
size_t
 
size
)

919 
i
 = 
	`föd_±r
(
±r
);

921 
ªÆloc_ˇŒed
++;

922 i‡(
±r
 && 
size
)

923 
num_ªÆlocs
++;

924 i‡(
±r
)

925 
num_‰ìs
++;

926 i‡(
size
)

927 
num_Ælocs
++;

929 
	`ab‹t
();

931 i‡(
i
 =
MAX_ALLOCATIONS
) {

932 i‡(
±r
) {

933 
ªÆloc_bad
++;

934 
i
 = 
	`föd_±r
(
NULL
);

936 
	`ab‹t
();

939 
Æloˇti⁄s
[
i
] = 
	`ªÆloc
(
±r
, 
size
);

941 i‡(!
size
)

942 
Æloˇti⁄s
[
i
] = 
NULL
;

944  
Æloˇti⁄s
[
i
];

945 
	}
}

947 
	$maö
()

949 
t‹tuª_c⁄ãxt
 *
˘x
;

951 
	`∂™_ã°s
(289);

952 
˘x
 = 
	`èŒoc_add_exã∫Æ
(
NULL
, 
n‹mÆ_ªÆloc
, 
ã°_lock
, 
ã°_u∆ock
);

954 
	`t‹tuª_loˇl_èŒoc
(
NULL
);

955 
	`ok
(!
lock_bad
, "%uÜocks on badÖointer",Üock_bad);

956 
	`ok
(!
lock_Áûed
, "lock_failed count %u should be zero",Üock_failed);

957 
	`ok
(!
u∆ock_Áûed
, "unlock_failed count %u should be zero",

958 
u∆ock_Áûed
);

959 
	`ok
(
ªÆloc_ˇŒed
 == 1, "ourÑealloc shouldÇot be calledágain");

961 
	`t‹tuª_loˇl_èŒoc
(
˘x
);

962 
	`ok
(!
lock_bad
, "%uÜocks on badÖointer",Üock_bad);

963 
	`ok
(!
lock_Áûed
, "lock_failed count %u should be zero",Üock_failed);

964 
	`ok
(!
u∆ock_Áûed
, "unlock_failed count %u should be zero",

965 
u∆ock_Áûed
);

966 
	`ok
(
ªÆloc_ˇŒed
, "ourÑealloc should be called");

967 
	`ok
(!
ªÆloc_bad
, "ourÑealloc given unknownÖointer %uÅimes",

968 
ªÆloc_bad
);

970 
	`èŒoc_‰ì
(
˘x
);

971 
	`ok
(!
lock_bad
, "%uÜocks on badÖointer",Üock_bad);

972 
	`ok
(!
lock_Áûed
, "lock_failed count %u should be zero",Üock_failed);

973 
	`ok
(!
u∆ock_Áûed
, "unlock_failed count %u should be zero",

974 
u∆ock_Áûed
);

975 
	`ok
(
ªÆloc_ˇŒed
, "ourÑealloc should be called");

976 
	`ok
(!
ªÆloc_bad
, "ourÑealloc given unknownÖointer %uÅimes",

977 
ªÆloc_bad
);

979 
	`ok
(
	`Æloˇti⁄s_u£d
() == 0, "%uállocations still used?",

980 
	`Æloˇti⁄s_u£d
());

983 
	`ok1
(!
	`èŒoc_chunk_‰om_±r
(
nuŒ_c⁄ãxt
)->
chûd
);

984 
	`èŒoc_dißbÀ_nuŒ_åackög
();

986  
	`exô_°©us
();

987 
	}
}

	@ccan/ccan/talloc_link/talloc_link.c

2 
	~<cˇn/li°/li°.h
>

3 
	~<cˇn/èŒoc/èŒoc.h
>

4 
	~<cˇn/èŒoc_lök/èŒoc_lök.h
>

5 
	~<as£π.h
>

8 *
	gèŒoc_löks
 = 
NULL
;

11 
	sèŒoc_löked
 {

12 
li°_hód
 
	mlöks
;

13 c⁄° *
	mobj
;

17 
	sèŒoc_lök
 {

18 
li°_node
 
	mli°
;

19 
èŒoc_löked
 *
	mlöked
;

22 
	$de°roy_lök
(
èŒoc_lök
 *
lök
)

24 
	`li°_dñ
(&
lök
->
li°
);

25 i‡(
	`li°_em±y
(&
lök
->
löked
->
löks
))

26 
	`èŒoc_‰ì
(
lök
->
löked
);

28 
	}
}

30 
boﬁ
 
	$add_lök
(c⁄° *
˘x
, 
èŒoc_löked
 *
löked
)

32 
èŒoc_lök
 *
lök
 = 
	`èŒoc
(
˘x
, talloc_link);

33 i‡(!
lök
)

34  
Ál£
;

36 
lök
->
löked
 =Üinked;

37 
	`li°_add
(&
löked
->
löks
, &
lök
->
li°
);

38 
	`èŒoc_£t_de°ru˘‹
(
lök
, 
de°roy_lök
);

39  
åue
;

40 
	}
}

42 *
	$_èŒoc_löked
(c⁄° *
˘x
, c⁄° *
√wobj
)

44 
èŒoc_löked
 *
löked
;

46 i‡(
	`èŒoc_∑ª¡
(
√wobj
)) {

48 i‡(!
èŒoc_löks
)

49 
èŒoc_löks
 = 
	`èŒoc_«med_c⁄°
(
NULL
, 0,

52 
	`as£π
(
	`èŒoc_∑ª¡
(
√wobj
Ë=èŒoc_∑ª¡(
èŒoc_löks
));

55 
löked
 = 
	`èŒoc
(
èŒoc_löks
, 
èŒoc_löked
);

56 i‡(!
löked
) {

57 
	`èŒoc_‰ì
(
√wobj
);

58  
NULL
;

60 
	`li°_hód_öô
(&
löked
->
löks
);

61 
löked
->
obj
 = 
	`èŒoc_°ól
÷öked, 
√wobj
);

63 i‡(!
	`add_lök
(
˘x
, 
löked
)) {

64 
	`èŒoc_‰ì
(
löked
);

65  
NULL
;

68  (*)
√wobj
;

69 
	}
}

71 *
	$_èŒoc_lök
(c⁄° *
˘x
, c⁄° *
obj
)

73 
èŒoc_löked
 *
löked
;

75 
löked
 = 
	`èŒoc_gë_ty≥
(
	`èŒoc_∑ª¡
(
obj
), 
èŒoc_löked
);

76 
	`as£π
(!
	`li°_em±y
(&
löked
->
löks
));

77  
	`add_lök
(
˘x
, 
löked
Ë? (*)
obj
 : 
NULL
;

78 
	}
}

80 
	$èŒoc_dñök
(c⁄° *
˘x
, c⁄° *
obj
)

82 
èŒoc_löked
 *
löked
;

83 
èŒoc_lök
 *
i
;

85 i‡(!
obj
)

88 
löked
 = 
	`èŒoc_gë_ty≥
(
	`èŒoc_∑ª¡
(
obj
), 
èŒoc_löked
);

89 
	`li°_f‹_óch
(&
löked
->
löks
, 
i
, 
li°
) {

90 i‡(
	`èŒoc_is_∑ª¡
(
i
, 
˘x
)) {

91 
	`èŒoc_‰ì
(
i
);

95 
	`ab‹t
();

96 
	}
}

	@ccan/ccan/talloc_link/talloc_link.h

2 #i‚de‡
TALLOC_LINK_H


3 
	#TALLOC_LINK_H


	)

4 
	~<cˇn/èŒoc/èŒoc.h
>

18 
	#èŒoc_löked
(
˘x
, 
√wobj
) \

19 ((
	`_TALLOC_TYPEOF
(
√wobj
))
	`_èŒoc_löked
((
˘x
), (√wobj)))

	)

31 
	#èŒoc_lök
(
˘x
, 
obj
) \

32 ((
	`_TALLOC_TYPEOF
(
obj
))
	`_èŒoc_lök
((
˘x
), (obj)))

	)

42 
èŒoc_dñök
(c⁄° *
˘x
, c⁄° *
löked
);

45 *
_èŒoc_lök
(c⁄° *
˘x
, c⁄° *
löked
);

46 *
_èŒoc_löked
(c⁄° *
˘x
, c⁄° *
löked
);

	@ccan/ccan/talloc_link/test/run.c

1 
	~<cˇn/èŒoc_lök/èŒoc_lök.h
>

2 
	~<cˇn/èp/èp.h
>

3 
	~<cˇn/èŒoc_lök/èŒoc_lök.c
>

4 
	~<°dlib.h
>

5 
	~<îr.h
>

7 
	gde°roy_cou¡
 = 0;

8 
	$de°roy_obj
(*
obj
)

10 
de°roy_cou¡
++;

12 
	}
}

14 
	$maö
(
¨gc
, *
¨gv
[])

16 *
obj
, *
p1
, *
p2
, *
p3
;

18 
	`∂™_ã°s
(16);

20 
	`èŒoc_íabÀ_Àak_ªp‹t
();

23 
p1
 = 
	`èŒoc
(
NULL
, );

24 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

25 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

27 
	`ok
(
de°roy_cou¡
 == 0, "destroy_count = %u", destroy_count);

28 
	`èŒoc_‰ì
(
p1
);

29 
	`ok
(
de°roy_cou¡
 == 1, "destroy_count = %u", destroy_count);

32 
p1
 = 
	`èŒoc
(
NULL
, );

33 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

34 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

35 
p2
 = 
	`èŒoc
(
NULL
, );

36 
	`èŒoc_lök
(
p2
, 
obj
);

38 
	`èŒoc_‰ì
(
p1
);

39 
	`ok
(
de°roy_cou¡
 == 1, "destroy_count = %u", destroy_count);

40 
	`èŒoc_‰ì
(
p2
);

41 
	`ok
(
de°roy_cou¡
 == 2, "destroy_count = %u", destroy_count);

44 
p1
 = 
	`èŒoc
(
NULL
, );

45 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

46 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

48 
p2
 = 
	`èŒoc
(
NULL
, );

49 
p3
 = 
	`èŒoc
(
NULL
, );

51 
	`èŒoc_lök
(
p2
, 
obj
);

52 
	`èŒoc_lök
(
p3
, 
obj
);

54 
	`èŒoc_‰ì
(
p1
);

55 
	`ok
(
de°roy_cou¡
 == 2, "destroy_count = %u", destroy_count);

56 
	`èŒoc_‰ì
(
p2
);

57 
	`ok
(
de°roy_cou¡
 == 2, "destroy_count = %u", destroy_count);

58 
	`èŒoc_‰ì
(
p3
);

59 
	`ok
(
de°roy_cou¡
 == 3, "destroy_count = %u", destroy_count);

62 
p1
 = 
	`èŒoc
(
NULL
, );

63 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

64 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

66 
	`ok
(
de°roy_cou¡
 == 3, "destroy_count = %u", destroy_count);

67 
	`èŒoc_dñök
(
p1
, 
obj
);

68 
	`ok
(
de°roy_cou¡
 == 4, "destroy_count = %u", destroy_count);

69 
	`èŒoc_‰ì
(
p1
);

72 
p1
 = 
	`èŒoc
(
NULL
, );

73 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

74 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

76 
p2
 = 
	`èŒoc
(
NULL
, );

77 
	`èŒoc_lök
(
p2
, 
obj
);

79 
	`èŒoc_dñök
(
p1
, 
obj
);

80 
	`ok
(
de°roy_cou¡
 == 4, "destroy_count = %u", destroy_count);

81 
	`èŒoc_dñök
(
p2
, 
obj
);

82 
	`ok
(
de°roy_cou¡
 == 5, "destroy_count = %u", destroy_count);

83 
	`èŒoc_‰ì
(
p1
);

84 
	`èŒoc_‰ì
(
p2
);

87 
p1
 = 
	`èŒoc
(
NULL
, );

88 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

89 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

90 
p2
 = 
	`èŒoc
(
NULL
, );

91 
	`èŒoc_lök
(
p2
, 
obj
);

93 
	`èŒoc_dñök
(
p1
, 
obj
);

94 
	`ok
(
de°roy_cou¡
 == 5, "destroy_count = %u", destroy_count);

95 
	`èŒoc_‰ì
(
p2
);

96 
	`ok
(
de°roy_cou¡
 == 6, "destroy_count = %u", destroy_count);

97 
	`èŒoc_‰ì
(
p1
);

100 
p1
 = 
	`èŒoc
(
NULL
, );

101 
obj
 = 
	`èŒoc_löked
(
p1
, 
	`èŒoc
(
NULL
, ));

102 
	`èŒoc_£t_de°ru˘‹
(
obj
, 
de°roy_obj
);

103 
p2
 = 
	`èŒoc
(
NULL
, );

104 
	`èŒoc_lök
(
p2
, 
obj
);

106 
	`èŒoc_‰ì
(
p1
);

107 
	`ok
(
de°roy_cou¡
 == 6, "destroy_count = %u", destroy_count);

108 
	`èŒoc_dñök
(
p2
, 
obj
);

109 
	`ok
(
de°roy_cou¡
 == 7, "destroy_count = %u", destroy_count);

110 
	`èŒoc_‰ì
(
p2
);

113 
	`ok1
(
	`èŒoc_tŸÆ_size
(
NULL
) == 0);

115 
	`èŒoc_dißbÀ_nuŒ_åackög
();

117  
	`exô_°©us
();

118 
	}
}

	@ccan/ccan/tally/tally.c

2 
	~<cˇn/èŒy/èŒy.h
>

3 
	~<cˇn/buûd_as£π/buûd_as£π.h
>

4 
	~<cˇn/likñy/likñy.h
>

5 
	~<°döt.h
>

6 
	~<limôs.h
>

7 
	~<°rög.h
>

8 
	~<°dio.h
>

9 
	~<as£π.h
>

10 
	~<°dlib.h
>

12 
	#SIZET_BITS
 ((
size_t
)*
CHAR_BIT
)

	)

15 
	sèŒy
 {

16 
ssize_t
 
	mmö
, 
	mmax
;

17 
size_t
 
	mtŸÆ
[2];

19 
	mbuckës
, 
	m°ï_bôs
;

20 
size_t
 
	mcou¡s
[1 ];

23 
èŒy
 *
	$èŒy_√w
(
buckës
)

25 
èŒy
 *tally;

28 i‡(
buckës
 == 0) {

29 
buckës
 = 1;

33 i‡((*
èŒy
Ë* 
buckës
 / (*tally) != buckets) {

34  
NULL
;

37 
èŒy
 = (èŒy *)
	`mÆloc
(

38 (*
èŒy
Ë+ —Æly->
cou¡s
[0])*(
buckës
-1));

39 i‡(
èŒy
 =
NULL
) {

40  
NULL
;

43 
èŒy
->
max
 = ((
size_t
)1 << (
SIZET_BITS
 - 1));

44 
èŒy
->
mö
 = ~èŒy->
max
;

45 
èŒy
->
tŸÆ
[0] =Åally->total[1] = 0;

46 
èŒy
->
buckës
 = buckets;

47 
èŒy
->
°ï_bôs
 = 0;

48 
	`mem£t
(
èŒy
->
cou¡s
, 0, —Æly->cou¡s[0])*
buckës
);

49  
èŒy
;

50 
	}
}

52 
	$buckë_of
(
ssize_t
 
mö
, 
°ï_bôs
, ssize_à
vÆ
)

55 i‡(
°ï_bôs
 =
SIZET_BITS
) {

58 
	`as£π
(
°ï_bôs
 < 
SIZET_BITS
);

59  (
size_t
)(
vÆ
 - 
mö
Ë>> 
°ï_bôs
;

60 
	}
}

63 
ssize_t
 
	$buckë_mö
(
ssize_t
 
mö
, 
°ï_bôs
, 
b
)

66 i‡(
°ï_bôs
 =
SIZET_BITS
) {

67  
mö
;

69 
	`as£π
(
°ï_bôs
 < 
SIZET_BITS
);

70  
mö
 + ((
ssize_t
)
b
 << 
°ï_bôs
);

71 
	}
}

74 
boﬁ
 
	$shi·_ovîÊows
(
size_t
 
num
, 
bôs
)

76 i‡(
bôs
 == 0) {

77  
Ál£
;

80  ((
num
 << 
bôs
) >> 1) != (num << (bits - 1));

81 
	}
}

84 
	$ªn‹mÆize
(
èŒy
 *tally,

85 
ssize_t
 
√w_mö
, ssize_à
√w_max
)

87 
size_t
 
ønge
, 
•ûl
;

88 
i
, 
ﬁd_mö
;

91 i‡(
èŒy
->
max
 <ÅÆly->
mö
) {

92 
upd©e
;

97 
ønge
 = (
√w_max
 - 
√w_mö
) + 1;

98 !
	`shi·_ovîÊows
(
èŒy
->
buckës
,ÅÆly->
°ï_bôs
)

99 && 
ønge
 > ((
size_t
)
èŒy
->
buckës
 <<ÅÆly->
°ï_bôs
)) {

101 
i
 = 1; i < 
èŒy
->
buckës
; i++) {

102 
èŒy
->
cou¡s
[
i
/2] +=Åally->counts[i];

103 
èŒy
->
cou¡s
[
i
] = 0;

105 
èŒy
->
°ï_bôs
++;

109 
ﬁd_mö
 = 
	`buckë_of
(
√w_mö
, 
èŒy
->
°ï_bôs
,ÅÆly->
mö
);

110 
	`memmove
(
èŒy
->
cou¡s
 + 
ﬁd_mö
,

111 
èŒy
->
cou¡s
,

112 (
èŒy
->
cou¡s
[0]Ë* (èŒy->
buckës
 - 
ﬁd_mö
));

113 
	`mem£t
(
èŒy
->
cou¡s
, 0, —Æly->cou¡s[0]Ë* 
ﬁd_mö
);

116 
•ûl
 = (
èŒy
->
mö
 - 
√w_mö
Ë% (1 <<ÅÆly->
°ï_bôs
);

117 
i
 = 0; i < 
èŒy
->
buckës
-1; i++) {

118 
size_t
 
adju°
 = (
èŒy
->
cou¡s
[
i
] >>ÅÆly->
°ï_bôs
Ë* 
•ûl
;

119 
èŒy
->
cou¡s
[
i
] -
adju°
;

120 
èŒy
->
cou¡s
[
i
+1] +
adju°
;

123 
upd©e
:

124 
èŒy
->
mö
 = 
√w_mö
;

125 
èŒy
->
max
 = 
√w_max
;

126 
	}
}

128 
	$èŒy_add
(
èŒy
 *èŒy, 
ssize_t
 
vÆ
)

130 
ssize_t
 
√w_mö
 = 
èŒy
->
mö
, 
√w_max
 =ÅÆly->
max
;

131 
boﬁ
 
√ed_ªn‹mÆize
 = 
Ál£
;

133 i‡(
vÆ
 < 
èŒy
->
mö
) {

134 
√w_mö
 = 
vÆ
;

135 
√ed_ªn‹mÆize
 = 
åue
;

137 i‡(
vÆ
 > 
èŒy
->
max
) {

138 
√w_max
 = 
vÆ
;

139 
√ed_ªn‹mÆize
 = 
åue
;

141 i‡(
√ed_ªn‹mÆize
) {

142 
	`ªn‹mÆize
(
èŒy
, 
√w_mö
, 
√w_max
);

147 i‡(
vÆ
 > 0 && 
èŒy
->
tŸÆ
[0] + val <Åally->total[0]) {

148 
èŒy
->
tŸÆ
[1]++;

149 } i‡(
vÆ
 < 0 && 
èŒy
->
tŸÆ
[0] + val >Åally->total[0]) {

150 
èŒy
->
tŸÆ
[1]--;

152 
èŒy
->
tŸÆ
[0] +
vÆ
;

153 
èŒy
->
cou¡s
[
	`buckë_of
—Æly->
mö
,ÅÆly->
°ï_bôs
, 
vÆ
)]++;

154 
	}
}

156 
size_t
 
	$èŒy_num
(c⁄° 
èŒy
 *tally)

158 
size_t
 
i
, 
num
 = 0;

159 
i
 = 0; i < 
èŒy
->
buckës
; i++) {

160 
num
 +
èŒy
->
cou¡s
[
i
];

162  
num
;

163 
	}
}

165 
ssize_t
 
	$èŒy_mö
(c⁄° 
èŒy
 *tally)

167  
èŒy
->
mö
;

168 
	}
}

170 
ssize_t
 
	$èŒy_max
(c⁄° 
èŒy
 *tally)

172  
èŒy
->
max
;

173 
	}
}

176 
	$Ês64
(
uöt64_t
 
vÆ
)

178 #i‡
HAVE_BUILTIN_CLZL


179 i‡(
vÆ
 <
ULONG_MAX
) {

181  
vÆ
 ? (Ë* 
CHAR_BIT
 - 
	`__buûtö_˛zl
(val) : 0;

184 
uöt64_t
 
r
 = 64;

186 i‡(!
vÆ
) {

189 i‡(!(
vÆ
 & 0xffffffff00000000ull)) {

190 
vÆ
 <<= 32;

191 
r
 -= 32;

193 i‡(!(
vÆ
 & 0xffff000000000000ull)) {

194 
vÆ
 <<= 16;

195 
r
 -= 16;

197 i‡(!(
vÆ
 & 0xff00000000000000ull)) {

198 
vÆ
 <<= 8;

199 
r
 -= 8;

201 i‡(!(
vÆ
 & 0xf000000000000000ull)) {

202 
vÆ
 <<= 4;

203 
r
 -= 4;

205 i‡(!(
vÆ
 & 0xc000000000000000ull)) {

206 
vÆ
 <<= 2;

207 
r
 -= 2;

209 i‡(!(
vÆ
 & 0x8000000000000000ull)) {

210 
vÆ
 <<= 1;

211 
r
 -= 1;

213  
r
;

214 #i‡
HAVE_BUILTIN_CLZL


217 
	}
}

220 
uöt64_t
 
	$divlu64
(
uöt64_t
 
u1
, uöt64_à
u0
, uöt64_à
v
)

222 c⁄° 
uöt64_t
 
b
 = 4294967296ULL;

223 
uöt32_t
 
un
[4],

224 
vn
[2];

226 
uöt32_t
 
q
[2];

227 
uöt64_t
 
un1
, 
un0
,

228 
vn0
;

229 
uöt64_t
 
qh©
;

230 
uöt64_t
 
rh©
;

231 
uöt64_t
 
p
;

232 
öt64_t
 
s
, 
i
, 
j
, 
t
, 
k
;

234 i‡(
u1
 >
v
) {

235  (
uöt64_t
)-1;

238 
s
 = 64 - 
	`Ês64
(
v
);

239 
vn0
 = 
v
 << 
s
;

240 
vn
[1] = 
vn0
 >> 32;

241 
vn
[0] = 
vn0
 & 0xFFFFFFFF;

244 
un1
 = ((
u1
 << 
s
Ë| (
u0
 >> (64 - s))) & (-s >> 63);

245 
un0
 = 
u0
 << 
s
;

246 
un
[3] = 
un1
 >> 32;

247 
un
[2] = 
un1
;

248 
un
[1] = 
un0
 >> 32;

249 
un
[0] = 
un0
;

251 
j
 = 1; j >= 0; j--) {

253 
qh©
 = (
un
[
j
+2]*
b
 + un[j+1])/
vn
[1];

254 
rh©
 = (
un
[
j
+2]*
b
 + un[j+1]Ë- 
qh©
*
vn
[1];

255 
agaö
:

256 i‡(
qh©
 >
b
 || qh©*
vn
[0] > b*
rh©
 + 
un
[
j
]) {

257 
qh©
 = qhat - 1;

258 
rh©
 =Ñh© + 
vn
[1];

259 i‡(
rh©
 < 
b
) {

260 
agaö
;

265 
k
 = 0;

266 
i
 = 0; i < 2; i++) {

267 
p
 = 
qh©
*
vn
[
i
];

268 
t
 = 
un
[
i
+
j
] - 
k
 - (
p
 & 0xFFFFFFFF);

269 
un
[
i
+
j
] = 
t
;

270 
k
 = (
p
 >> 32Ë- (
t
 >> 32);

272 
t
 = 
un
[
j
+2] - 
k
;

273 
un
[
j
+2] = 
t
;

275 
q
[
j
] = 
qh©
;

276 i‡(
t
 < 0) {

277 
q
[
j
] = q[j] - 1;

278 
k
 = 0;

279 
i
 = 0; i < 2; i++) {

280 
t
 = 
un
[
i
+
j
] + 
vn
[i] + 
k
;

281 
un
[
i
+
j
] = 
t
;

282 
k
 = 
t
 >> 32;

284 
un
[
j
+2] = un[j+2] + 
k
;

288  
q
[1]*
b
 + q[0];

289 
	}
}

291 
öt64_t
 
	$divls64
(
öt64_t
 
u1
, 
uöt64_t
 
u0
, i¡64_à
v
)

293 
öt64_t
 
q
, 
u√g
, 
v√g
, 
diff
, 
b‹row
;

295 
u√g
 = 
u1
 >> 63;

296 i‡(
u√g
) {

297 
u0
 = -u0;

298 
b‹row
 = (
u0
 != 0);

299 
u1
 = -u1 - 
b‹row
;

302 
v√g
 = 
v
 >> 63;

303 
v
 = (v ^ 
v√g
) - vneg;

305 i‡((
uöt64_t
)
u1
 >(uöt64_t)
v
) {

306 
ovîÊow
;

309 
q
 = 
	`divlu64
(
u1
, 
u0
, 
v
);

311 
diff
 = 
u√g
 ^ 
v√g
;

312 
q
 = (q ^ 
diff
) - diff;

314 i‡((
diff
 ^ 
q
) < 0 && q != 0) {

316 
ovîÊow
:

317 
q
 = 0x8000000000000000ULL;

319  
q
;

320 
	}
}

322 
ssize_t
 
	$èŒy_món
(c⁄° 
èŒy
 *tally)

324 
size_t
 
cou¡
 = 
	`èŒy_num
(
èŒy
);

325 i‡(!
cou¡
) {

329 i‡((
èŒy
->
tŸÆ
[0]Ë=(
uöt32_t
)) {

331 
öt64_t
 
tŸÆ
 = 
èŒy
->total[0]

332 | (((
uöt64_t
)
èŒy
->
tŸÆ
[1]) << 32);

333  
tŸÆ
 / 
cou¡
;

335  
	`divls64
(
èŒy
->
tŸÆ
[1],ÅÆly->tŸÆ[0], 
cou¡
);

336 
	}
}

338 
ssize_t
 
	$èŒy_tŸÆ
(c⁄° 
èŒy
 *èŒy, 
ssize_t
 *
ovîÊow
)

340 i‡(
ovîÊow
) {

341 *
ovîÊow
 = 
èŒy
->
tŸÆ
[1];

342  
èŒy
->
tŸÆ
[0];

346 i‡(
èŒy
->
tŸÆ
[1] & ((
size_t
)1 << (
SIZET_BITS
-1))) {

349 i‡((~
èŒy
->
tŸÆ
[1])+1 != 0

350 || (
ssize_t
)
èŒy
->
tŸÆ
[0] >= 0) {

352  (
ssize_t
)((
size_t
)1 << (
SIZET_BITS
 - 1));

357 i‡(
èŒy
->
tŸÆ
[1] || (
ssize_t
)tally->total[0] < 0) {

359  (
ssize_t
)~((
size_t
)1 << (
SIZET_BITS
 - 1));

362  
èŒy
->
tŸÆ
[0];

363 
	}
}

365 
ssize_t
 
	$buckë_ønge
(c⁄° 
èŒy
 *èŒy, 
b
, 
size_t
 *
îr
)

367 
ssize_t
 
mö
, 
max
;

369 
mö
 = 
	`buckë_mö
(
èŒy
->mö,ÅÆly->
°ï_bôs
, 
b
);

370 i‡(
b
 =
èŒy
->
buckës
 - 1) {

371 
max
 = 
èŒy
->max;

373 
max
 = 
	`buckë_mö
(
èŒy
->
mö
,ÅÆly->
°ï_bôs
, 
b
+1) - 1;

377 *
îr
 = (
max
 - 
mö
 + 1) / 2;

379  
mö
 + (
max
 - min) / 2;

380 
	}
}

382 
ssize_t
 
	$èŒy_≠¥ox_medün
(c⁄° 
èŒy
 *èŒy, 
size_t
 *
îr
)

384 
size_t
 
cou¡
 = 
	`èŒy_num
(
èŒy
), 
tŸÆ
 = 0;

385 
i
;

387 
i
 = 0; i < 
èŒy
->
buckës
; i++) {

388 
tŸÆ
 +
èŒy
->
cou¡s
[
i
];

389 i‡(
tŸÆ
 * 2 >
cou¡
) {

393  
	`buckë_ønge
(
èŒy
, 
i
, 
îr
);

394 
	}
}

396 
ssize_t
 
	$èŒy_≠¥ox_mode
(c⁄° 
èŒy
 *èŒy, 
size_t
 *
îr
)

398 
i
, 
mö_be°
 = 0, 
max_be°
 = 0;

400 
i
 = 0; i < 
èŒy
->
buckës
; i++) {

401 i‡(
èŒy
->
cou¡s
[
i
] >ÅÆly->cou¡s[
mö_be°
]) {

402 
mö_be°
 = 
max_be°
 = 
i
;

403 } i‡(
èŒy
->
cou¡s
[
i
] =èŒy->cou¡s[
mö_be°
]) {

404 
max_be°
 = 
i
;

409 i‡(
mö_be°
 !
max_be°
) {

410 
ssize_t
 
mö
, 
max
;

411 
mö
 = 
	`buckë_ønge
(
èŒy
, 
mö_be°
, 
îr
);

412 
max
 = 
	`buckë_ønge
(
èŒy
, 
max_be°
, 
îr
);

413 
max
 +*
îr
;

414 *
îr
 +(
size_t
)(
max
 - 
mö
);

415  
mö
 + (
max
 - min) / 2;

418  
	`buckë_ønge
(
èŒy
, 
mö_be°
, 
îr
);

419 
	}
}

421 
	$gë_max_buckë
(c⁄° 
èŒy
 *tally)

423 
i
;

425 
i
 = 
èŒy
->
buckës
; i > 0; i--) {

426 i‡(
èŒy
->
cou¡s
[
i
-1]) {

430  
i
;

431 
	}
}

433 *
	$èŒy_hi°ogøm
(c⁄° 
èŒy
 *tally,

434 
width
, 
height
)

436 
i
, 
cou¡
, 
max_buckë
, 
œrge°_buckë
;

437 
èŒy
 *
tmp
;

438 *
gøph
, *
p
;

440 
	`as£π
(
width
 >
TALLY_MIN_HISTO_WIDTH
);

441 
	`as£π
(
height
 >
TALLY_MIN_HISTO_HEIGHT
);

444 
max_buckë
 = 
	`gë_max_buckë
(
èŒy
);

447 i‡(
height
 >
max_buckë
) {

448 
height
 = 
max_buckë
;

449 
tmp
 = 
NULL
;

453 
tmp
 = 
	`èŒy_√w
(
èŒy
->
buckës
);

454 i‡(!
tmp
) {

455  
NULL
;

457 
tmp
->
mö
 = 
èŒy
->min;

458 
tmp
->
max
 = 
èŒy
->max;

459 
tmp
->
°ï_bôs
 = 
èŒy
->step_bits;

460 
	`mem˝y
(
tmp
->
cou¡s
, 
èŒy
->counts,

461 (
èŒy
->
cou¡s
[0]Ë* 
tmp
->
buckës
);

462 (
max_buckë
 = 
	`gë_max_buckë
(
tmp
)Ë>
height
) {

463 
	`ªn‹mÆize
(
tmp
,Åmp->
mö
,Åmp->
max
 * 2);

466 
tmp
->
max
 = 
èŒy
->max;

467 
èŒy
 = 
tmp
;

468 
height
 = 
max_buckë
;

472 
œrge°_buckë
 = 0;

473 
i
 = 0; i < 
èŒy
->
buckës
; i++) {

474 i‡(
èŒy
->
cou¡s
[
i
] > 
œrge°_buckë
) {

475 
œrge°_buckë
 = 
èŒy
->
cou¡s
[
i
];

479 
p
 = 
gøph
 = (*)
	`mÆloc
(
height
 * (
width
 + 1) + 1);

480 i‡(!
gøph
) {

481 
	`‰ì
(
tmp
);

482  
NULL
;

485 
i
 = 0; i < 
height
; i++) {

486 
covîed
 = 1, 
row
;

489 
row
 = 
height
 - 
i
 - 1;

490 
cou¡
 = ()
èŒy
->
cou¡s
[
row
] / 
œrge°_buckë
 * (
width
-1)+1;

492 i‡(
row
 == 0) {

493 
covîed
 = 
	`¢¥ötf
(
p
, 
width
, "%zi", 
èŒy
->
mö
);

494 } i‡(
row
 =
height
 - 1) {

495 
covîed
 = 
	`¢¥ötf
(
p
, 
width
, "%zi", 
èŒy
->
max
);

496 } i‡(
row
 =
	`buckë_of
(
èŒy
->
mö
,ÅÆly->
°ï_bôs
, 0)) {

497 *
p
 = '+';

499 *
p
 = '|';

502 i‡(
covîed
 > 
width
) {

503 
covîed
 = 
width
;

505 
p
 +
covîed
;

507 i‡(
cou¡
 > 
covîed
) {

508 
cou¡
 -
covîed
;

509 
	`mem£t
(
p
, '*', 
cou¡
);

511 
cou¡
 = 0;

514 
p
 +
cou¡
;

515 *
p
 = '\n';

516 
p
++;

518 *
p
 = '\0';

519 
	`‰ì
(
tmp
);

520  
gøph
;

521 
	}
}

	@ccan/ccan/tally/tally.h

2 #i‚de‡
CCAN_TALLY_H


3 
	#CCAN_TALLY_H


	)

4 
	~"c⁄fig.h
"

5 
	~<sys/ty≥s.h
>

7 
	gèŒy
;

19 
èŒy
 *
èŒy_√w
(
buckës
);

26 
èŒy_add
(
èŒy
 *èŒy, 
ssize_t
 
vÆ
);

32 
size_t
 
èŒy_num
(c⁄° 
èŒy
 *tally);

40 
ssize_t
 
èŒy_mö
(c⁄° 
èŒy
 *tally);

48 
ssize_t
 
èŒy_max
(c⁄° 
èŒy
 *tally);

56 
ssize_t
 
èŒy_món
(c⁄° 
èŒy
 *tally);

67 
ssize_t
 
èŒy_tŸÆ
(c⁄° 
èŒy
 *èŒy, ssize_à*
ovîÊow
);

78 
ssize_t
 
èŒy_≠¥ox_medün
(c⁄° 
èŒy
 *èŒy, 
size_t
 *
îr
);

89 
ssize_t
 
èŒy_≠¥ox_mode
(c⁄° 
èŒy
 *èŒy, 
size_t
 *
îr
);

91 
	#TALLY_MIN_HISTO_WIDTH
 8

	)

92 
	#TALLY_MIN_HISTO_HEIGHT
 3

	)

103 *
èŒy_hi°ogøm
(c⁄° 
èŒy
 *tally,

104 
width
, 
height
);

	@ccan/ccan/tally/test/run-bucket_of.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
, 
max_°ï
;

7 
ssize_t
 
mö
, 
max
;

9 
max
 = (
ssize_t
)~(1ULL << ((max)*
CHAR_BIT
 - 1));

10 
mö
 = (
ssize_t
)(1ULL << ((
max
)*
CHAR_BIT
 - 1));

11 
max_°ï
 = (
max
)*
CHAR_BIT
;

13 
	`∂™_ã°s
(2 + 100 + 10 + 5

15 + (1 << 7Ë* (
max_°ï
 - 7));

18 
	`ok1
(
	`buckë_of
(0, 0, 0) == 0);

21 
	`ok1
(
	`buckë_of
(0, 1, 0) == 0);

24 
i
 = 0; i < 100; i++)

25 
	`ok1
(
	`buckë_of
(0, 3, 
i
) == i >> 3);

28 
i
 = 0; i < 10; i++)

29 
	`ok1
(
	`buckë_of
(0, 1, 
i
) == i >> 1);

32 
	`ok1
(
	`buckë_of
(
mö
, 0, min) == 0);

33 
	`ok1
(
	`buckë_of
(
mö
, 
max_°ï
-1, min) == 0);

34 
	`ok1
(
	`buckë_of
(
mö
, 
max_°ï
-1, 
max
) == 1);

35 
	`ok1
(
	`buckë_of
(
mö
, 
max_°ï
, min) == 0);

36 
	`ok1
(
	`buckë_of
(
mö
, 
max_°ï
, 
max
) == 0);

39 
	`ok1
(
	`buckë_mö
(0, 0, 0) == 0);

42 
	`ok1
(
	`buckë_mö
(0, 1, 0) == 0);

45 
i
 = 0; i < 100; i++)

46 
	`ok1
(
	`buckë_mö
(0, 3, 
i
) == i << 3);

49 
i
 = 0; i < 5; i++)

50 
	`ok1
(
	`buckë_mö
(0, 1, 
i
) == i << 1);

53 
	`ok1
(
	`buckë_mö
(
mö
, 0, 0) == min);

54 
	`ok1
(
	`buckë_mö
(
mö
, 
max_°ï
-1, 0) == min);

55 
	`ok1
(
	`buckë_mö
(
mö
, 
max_°ï
-1, 1) == 0);

56 
	`ok1
(
	`buckë_mö
(
mö
, 
max_°ï
, 0) == min);

60 
i
 = 0; i < (1 << 7); i++) {

61 
j
;

62 
j
 = 0; j < 
max_°ï
 - 7; j++) {

63 
ssize_t
 
vÆ
;

65 
vÆ
 = 
	`buckë_mö
(-(
ssize_t
)
i
, 
j
, i);

66 
	`ok1
(
	`buckë_of
(-(
ssize_t
)
i
, 
j
, 
vÆ
) == i);

70  
	`exô_°©us
();

71 
	}
}

	@ccan/ccan/tally/test/run-divlu64.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
, 
j
;

8 
	`∂™_ã°s
(5985);

10 
i
 = 0; i < 127; i++) {

11 
uöt64_t
 
u1
, 
u0
;

12 i‡(
i
 < 64) {

13 
u1
 = 0;

14 
u0
 = 1ULL << 
i
;

15 
j
 = 0;

17 
u1
 = 1ULL << (
i
 - 64);

18 
u0
 = 0;

19 
j
 = 
i
 - 63;

21 ; 
j
 < 63; j++) {

22 
uöt64_t
 
™swî
;

23 i‡(
j
 > 
i
)

24 
™swî
 = 0;

26 
™swî
 = 1ULL << (
i
 - 
j
);

27 
	`ok1
(
	`divlu64
(
u1
, 
u0
, 1ULL << 
j
Ë=
™swî
);

30  
	`exô_°©us
();

31 
	}
}

	@ccan/ccan/tally/test/run-histogram.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
;

7 
èŒy
 *tally;

8 *
gøph
, *
p
;

10 
	`∂™_ã°s
(100 + 1 + 10 + 1 + 100 + 1 + 10 + 1 + 10 * 2 + 1);

13 
èŒy
 = 
	`èŒy_√w
(100);

14 
i
 = 0; i < 100; i++)

15 
	`èŒy_add
(
èŒy
, 
i
);

18 
gøph
 = 
p
 = 
	`èŒy_hi°ogøm
(
èŒy
, 20, 100);

19 
i
 = 0; i < 100; i++) {

20 *
eﬁ
 = 
	`°rchr
(
p
, '\n');

23 
	`ok1
(
eﬁ
 - 
p
 == 20);

24 
p
 = 
eﬁ
 + 1;

26 
	`ok1
(!*
p
);

27 
	`‰ì
(
gøph
);

30 
gøph
 = 
p
 = 
	`èŒy_hi°ogøm
(
èŒy
, 20, 10);

31 
i
 = 0; i < 10; i++) {

32 *
eﬁ
 = 
	`°rchr
(
p
, '\n');

35 i‡(
eﬁ
) {

36 
	`ok1
(
eﬁ
 - 
p
 =20 || (eﬁ -Ö < 20 && 
i
 == 0));

39 
	`ok1
(
i
 > 5);

41 i‡(
eﬁ
)

42 
p
 = 
eﬁ
 + 1;

44 
	`ok1
(!*
p
);

45 
	`‰ì
(
gøph
);

48 
gøph
 = 
p
 = 
	`èŒy_hi°ogøm
(
èŒy
, 20, 1000);

49 
i
 = 0; i < 100; i++) {

50 *
eﬁ
 = 
	`°rchr
(
p
, '\n');

52 
	`ok1
(
eﬁ
 - 
p
 == 20);

53 
p
 = 
eﬁ
 + 1;

55 
	`ok1
(!*
p
);

56 
	`‰ì
(
gøph
);

57 
	`‰ì
(
èŒy
);

60 
èŒy
 = 
	`èŒy_√w
(10);

61 
i
 = 0; i < 10; i++) {

62 
j
;

63 
j
 = 0; j <
i
; j++)

64 
	`èŒy_add
(
èŒy
, 
i
);

67 
gøph
 = 
p
 = 
	`èŒy_hi°ogøm
(
èŒy
, 10, 10);

68 
i
 = 0; i < 10; i++) {

69 *
eﬁ
 = 
	`°rchr
(
p
, '\n');

70 
	`ok1
(
eﬁ
 - 
p
 =10 - 
i
);

71 
p
 = 
eﬁ
 + 1;

73 
	`ok1
(!*
p
);

74 
	`düg
("Hîe'†thê¥ëty: %s", 
gøph
);

75 
	`‰ì
(
gøph
);

76 
	`‰ì
(
èŒy
);

79 
èŒy
 = 
	`èŒy_√w
(10);

80 
i
 = 0; i < 10; i++) {

81 
	`èŒy_add
(
èŒy
, 
i
 - 5);

84 
gøph
 = 
p
 = 
	`èŒy_hi°ogøm
(
èŒy
, 10, 10);

85 
i
 = 0; i < 10; i++) {

86 *
eﬁ
 = 
	`°rchr
(
p
, '\n');

89 
	`ok1
(
eﬁ
 - 
p
 == 10);

92 i‡(
i
 == 0)

93 
	`ok1
(
	`°∫cmp
(
p
, "4*", 2) == 0);

94 i‡(
i
 == 9)

95 
	`ok1
(
	`°∫cmp
(
p
, "-5*", 3) == 0);

96 i‡(
i
 == 4)

97 
	`ok1
(
p
[0] == '+');

99 
	`ok1
(
p
[0] == '|');

100 
p
 = 
eﬁ
 + 1;

102 
	`ok1
(!*
p
);

103 
	`düg
("Hîe'†thê¥ëty: %s", 
gøph
);

104 
	`‰ì
(
gøph
);

105 
	`‰ì
(
èŒy
);

107  
	`exô_°©us
();

108 
	}
}

	@ccan/ccan/tally/test/run-mean.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
;

7 
èŒy
 *èŒy = 
	`èŒy_√w
(0);

8 
ssize_t
 
mö
, 
max
;

10 
max
 = (
ssize_t
)~(1ULL << ((max)*
CHAR_BIT
 - 1));

11 
mö
 = (
ssize_t
)(1ULL << ((
max
)*
CHAR_BIT
 - 1));

13 
	`∂™_ã°s
(100 + 100);

15 
i
 = 0; i < 100; i++) {

16 
	`èŒy_add
(
èŒy
, 
i
);

17 
	`èŒy_add
(
èŒy
, -
i
);

18 
	`ok1
(
	`èŒy_món
(
èŒy
) == 0);

22 
i
 = 0; i < 100; i++) {

23 
	`èŒy_add
(
èŒy
, 
max
 - 
i
);

24 
	`èŒy_add
(
èŒy
, 
mö
 + 1 + 
i
);

25 
	`ok1
(
	`èŒy_món
(
èŒy
) == 0);

28 
	`‰ì
(
èŒy
);

29  
	`exô_°©us
();

30 
	}
}

	@ccan/ccan/tally/test/run-median.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
;

7 
èŒy
 *èŒy = 
	`èŒy_√w
(100);

8 
ssize_t
 
mö
, 
max
, 
medün
;

9 
size_t
 
îr
;

11 
max
 = (
ssize_t
)~(1ULL << ((max)*
CHAR_BIT
 - 1));

12 
mö
 = (
ssize_t
)(1ULL << ((
max
)*
CHAR_BIT
 - 1));

14 
	`∂™_ã°s
(100*2 + 100*2 + 100*2);

16 
i
 = 0; i < 100; i++) {

17 
	`èŒy_add
(
èŒy
, 
i
);

18 
	`èŒy_add
(
èŒy
, -
i
);

19 
medün
 = 
	`èŒy_≠¥ox_medün
(
èŒy
, &
îr
);

20 
	`ok1
(
îr
 <= 4);

21 
	`ok1
(
medün
 - (
ssize_t
)
îr
 <= 0 && median + (ssize_t)err >= 0);

25 
i
 = 0; i < 100; i++) {

26 
	`èŒy_add
(
èŒy
, 
max
 - 
i
);

27 
	`èŒy_add
(
èŒy
, 
mö
 + 1 + 
i
);

28 
medün
 = 
	`èŒy_≠¥ox_medün
(
èŒy
, &
îr
);

30 
	`ok1
(
îr
 <
max
 / 100 * 2);

31 
	`ok1
(
medün
 - (
ssize_t
)
îr
 <= 0 && median + (ssize_t)err >= 0);

33 
	`‰ì
(
èŒy
);

35 
èŒy
 = 
	`èŒy_√w
(10);

36 
i
 = 0; i < 100; i++) {

37 
	`èŒy_add
(
èŒy
, 
i
);

38 
medün
 = 
	`èŒy_≠¥ox_medün
(
èŒy
, &
îr
);

39 
	`ok1
(
îr
 <
i
 / 10 + 1);

40 
	`ok1
(
medün
 - (
ssize_t
)
îr
 <
i
/2

41 && 
medün
 + (
ssize_t
)
îr
 >
i
/2);

43 
	`‰ì
(
èŒy
);

45  
	`exô_°©us
();

46 
	}
}

	@ccan/ccan/tally/test/run-min-max.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
;

7 
èŒy
 *èŒy = 
	`èŒy_√w
(0);

9 
	`∂™_ã°s
(100 * 4);

11 
i
 = 0; i < 100; i++) {

12 
	`èŒy_add
(
èŒy
, 
i
);

13 
	`ok1
(
	`èŒy_num
(
èŒy
Ë=
i
*2 + 1);

14 
	`èŒy_add
(
èŒy
, -
i
);

15 
	`ok1
(
	`èŒy_num
(
èŒy
Ë=
i
*2 + 2);

16 
	`ok1
(
	`èŒy_max
(
èŒy
Ë=
i
);

17 
	`ok1
(
	`èŒy_mö
(
èŒy
Ë=-
i
);

19 
	`‰ì
(
èŒy
);

20  
	`exô_°©us
();

21 
	}
}

	@ccan/ccan/tally/test/run-mode.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
i
;

7 
èŒy
 *èŒy = 
	`èŒy_√w
(100);

8 
ssize_t
 
mö
, 
max
, 
mode
;

9 
size_t
 
îr
;

11 
max
 = (
ssize_t
)~(1ULL << ((max)*
CHAR_BIT
 - 1));

12 
mö
 = (
ssize_t
)(1ULL << ((
max
)*
CHAR_BIT
 - 1));

14 
	`∂™_ã°s
(100 + 50 + 100 + 100 + 10);

16 
i
 = 0; i < 100; i++) {

17 
	`èŒy_add
(
èŒy
, 
i
);

18 
	`èŒy_add
(
èŒy
, -
i
);

19 
mode
 = 
	`èŒy_≠¥ox_mode
(
èŒy
, &
îr
);

20 i‡(
i
 < 50)

21 
	`ok1
(
îr
 == 0);

22 
	`ok1
(
mode
 - (
ssize_t
)
îr
 <= 0 && mode + (ssize_t)err >= 0);

26 
i
 = 0; i < 100; i++) {

27 
	`èŒy_add
(
èŒy
, 
max
 - 
i
);

28 
	`èŒy_add
(
èŒy
, 
mö
 + 1 + 
i
);

29 
mode
 = 
	`èŒy_≠¥ox_mode
(
èŒy
, &
îr
);

30 
	`ok1
(
mode
 - (
ssize_t
)
îr
 <= 0 && mode + (ssize_t)err >= 0);

32 
	`‰ì
(
èŒy
);

34 
èŒy
 = 
	`èŒy_√w
(10);

35 
	`èŒy_add
(
èŒy
, 0);

36 
i
 = 0; i < 100; i++) {

37 
	`èŒy_add
(
èŒy
, 
i
);

38 
mode
 = 
	`èŒy_≠¥ox_mode
(
èŒy
, &
îr
);

39 i‡(
i
 < 10)

40 
	`ok1
(
îr
 == 0);

41 
	`ok1
(
mode
 - (
ssize_t
)
îr
 <= 0 && mode + (ssize_t)err >= 0);

44 
	`‰ì
(
èŒy
);

45  
	`exô_°©us
();

46 
	}
}

	@ccan/ccan/tally/test/run-renormalize.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
èŒy
 *èŒy = 
	`èŒy_√w
(2);

8 
	`∂™_ã°s
(4);

9 
èŒy
->
mö
 = 0;

10 
èŒy
->
max
 = 0;

11 
èŒy
->
cou¡s
[0] = 1;

14 
	`ªn‹mÆize
(
èŒy
, 0, 1);

15 
	`ok1
(
èŒy
->
cou¡s
[0] == 1);

16 
	`ok1
(
èŒy
->
cou¡s
[1] == 0);

17 
èŒy
->
cou¡s
[1]++;

20 
	`ªn‹mÆize
(
èŒy
, 0, 3);

21 
	`ok1
(
èŒy
->
cou¡s
[0] == 2);

22 
	`ok1
(
èŒy
->
cou¡s
[1] == 0);

24 
	`‰ì
(
èŒy
);

25  
	`exô_°©us
();

26 
	}
}

	@ccan/ccan/tally/test/run-total.c

1 
	~<cˇn/èŒy/èŒy.c
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
èŒy
 *tally;

7 
ssize_t
 
tŸÆ
, 
ovîÊow
;

8 
ssize_t
 
mö
, 
max
;

10 
max
 = (
ssize_t
)~(1ULL << ((max)*
CHAR_BIT
 - 1));

11 
mö
 = (
ssize_t
)(1ULL << ((
max
)*
CHAR_BIT
 - 1));

13 
	`∂™_ã°s
(15);

16 
èŒy
 = 
	`èŒy_√w
(0);

17 
	`èŒy_add
(
èŒy
, 
mö
);

18 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, 
NULL
Ë=
mö
);

19 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, &
ovîÊow
Ë=
mö
);

20 
	`ok1
(
ovîÊow
 == -1);

23 
	`èŒy_add
(
èŒy
, 
mö
);

24 
tŸÆ
 = 
	`èŒy_tŸÆ
(
èŒy
, &
ovîÊow
);

25 
	`ok1
(
ovîÊow
 == -1);

26 
	`ok1
((
size_t
)
tŸÆ
 == 0);

27 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, 
NULL
Ë=
mö
);

28 
	`‰ì
(
èŒy
);

31 
èŒy
 = 
	`èŒy_√w
(0);

32 
	`èŒy_add
(
èŒy
, 
max
);

33 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, 
NULL
Ë=
max
);

34 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, &
ovîÊow
Ë=
max
);

35 
	`ok1
(
ovîÊow
 == 0);

38 
	`èŒy_add
(
èŒy
, 
max
);

39 
tŸÆ
 = 
	`èŒy_tŸÆ
(
èŒy
, &
ovîÊow
);

40 
	`ok1
(
ovîÊow
 == 0);

41 
	`ok1
((
size_t
)
tŸÆ
 == (size_t)-2);

42 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, 
NULL
Ë=
max
);

45 
	`èŒy_add
(
èŒy
, 
max
);

46 
tŸÆ
 = 
	`èŒy_tŸÆ
(
èŒy
, &
ovîÊow
);

47 
	`ok1
(
ovîÊow
 == 1);

48 i‡((
size_t
) == 4)

49 
	`ok1
((
size_t
)
tŸÆ
 == 0x7FFFFFFD);

50 i‡((
size_t
) == 8)

51 
	`ok1
((
size_t
)
tŸÆ
 == 0x7FFFFFFFFFFFFFFDULL);

52 
	`ok1
(
	`èŒy_tŸÆ
(
èŒy
, 
NULL
Ë=
max
);

53 
	`‰ì
(
èŒy
);

55  
	`exô_°©us
();

56 
	}
}

	@ccan/ccan/tap/tap.c

26 
	~"c⁄fig.h
"

27 
	~<˘y≥.h
>

28 
	~<°d¨g.h
>

29 
	~<°dio.h
>

30 
	~<°dlib.h
>

31 
	~<uni°d.h
>

33 
	~"èp.h
"

35 
	gno_∂™
 = 0;

36 
	gskù_Æl
 = 0;

37 
	ghave_∂™
 = 0;

38 
	gã°_cou¡
 = 0;

39 
	ge_ã°s
 = 0;

40 
	gÁûuªs
 = 0;

41 *
	gtodo_msg
 = 
NULL
;

42 c⁄° *
	gtodo_msg_fixed
 = "libtap malloc issue";

43 
	gtodo
 = 0;

44 
	gã°_dõd
 = 0;

45 
	gã°_pid
;

54 #ifde‡
WANT_PTHREAD


55 
	~<±hªad.h
>

56 
±hªad_muãx_t
 
	gM
 = 
PTHREAD_MUTEX_INITIALIZER
;

57 
	#LOCK
 
	`±hªad_muãx_lock
(&
M
)

	)

58 
	#UNLOCK
 
	`±hªad_muãx_u∆ock
(&
M
)

	)

60 
	#LOCK


	)

61 
	#UNLOCK


	)

65 
	$_ex≥˘ed_ã°s
(
ã°s
)

68 
	`¥ötf
("1..%d\n", 
ã°s
);

69 
e_ã°s
 = 
ã°s
;

70 
	}
}

73 
	$dügv
(c⁄° *
fmt
, 
va_li°
 
≠
)

75 
	`Âuts
("# ", 
°dout
);

76 
	`vÂrötf
(
°dout
, 
fmt
, 
≠
);

77 
	`Âuts
("\n", 
°dout
);

78 
	}
}

81 
	$_düg
(c⁄° *
fmt
, ...)

83 
va_li°
 
≠
;

84 
	`va_°¨t
(
≠
, 
fmt
);

85 
	`dügv
(
fmt
, 
≠
);

86 
	`va_íd
(
≠
);

87 
	}
}

97 
	$_gí_ªsu…
(
ok
, c⁄° *
func
, c⁄° *
fûe
, 
löe
,

98 c⁄° *
ã°_«me
, ...)

100 
va_li°
 
≠
;

101 *
loˇl_ã°_«me
 = 
NULL
;

102 *
c
;

103 
«me_is_digôs
;

105 
LOCK
;

107 
ã°_cou¡
++;

111 if(
ã°_«me
 !
NULL
) {

112 
	`va_°¨t
(
≠
, 
ã°_«me
);

113 i‡(
	`va•rötf
(&
loˇl_ã°_«me
, 
ã°_«me
, 
≠
) < 0)

114 
loˇl_ã°_«me
 = 
NULL
;

115 
	`va_íd
(
≠
);

120 if(
loˇl_ã°_«me
) {

121 
«me_is_digôs
 = 1;

122 
c
 = 
loˇl_ã°_«me
; *c != '\0'; c++) {

123 if(!
	`isdigô
(()*
c
)

124 && !
	`is•a˚
(()*
c
)) {

125 
«me_is_digôs
 = 0;

130 if(
«me_is_digôs
) {

131 
	`_düg
(" YouÇamed you∏ã° '%s'. You shouldn'àu£Çumbî†f‹ you∏ã°Çames.", 
loˇl_ã°_«me
);

132 
	`_düg
(" Very confusing.");

137 if(!
ok
) {

138 
	`¥ötf
("not ");

139 
Áûuªs
++;

142 
	`¥ötf
("ok %d", 
ã°_cou¡
);

144 if(
ã°_«me
 !
NULL
) {

145 
	`¥ötf
(" - ");

149 if(
loˇl_ã°_«me
 !
NULL
) {

150 
	`Êockfûe
(
°dout
);

151 
c
 = 
loˇl_ã°_«me
; *c != '\0'; c++) {

152 if(*
c
 == '#')

153 
	`Âutc
('\\', 
°dout
);

154 
	`Âutc
(()*
c
, 
°dout
);

156 
	`fu∆ockfûe
(
°dout
);

158 
	`¥ötf
("%s", 
todo_msg_fixed
);

169 if(
todo
) {

170 
	`¥ötf
(" # TODO %s", 
todo_msg
 ?Åodo_msg : 
todo_msg_fixed
);

171 if(!
ok
)

172 
Áûuªs
--;

175 
	`¥ötf
("\n");

177 if(!
ok
)

178 
	`_düg
(" Failed %stest (%s:%s()átÜine %d)",

179 
todo
 ? "(TODOË" : "", 
fûe
, 
func
, 
löe
);

181 
	`‰ì
(
loˇl_ã°_«me
);

183 
UNLOCK
;

185 i‡(!
ok
 && 
èp_Áû_ˇŒback
)

186 
	`èp_Áû_ˇŒback
();

190  
ok
 ? 1 : 0;

191 
	}
}

198 
	$_˛ónup
()

201 i‡(
	`gëpid
(Ë!
ã°_pid
)

204 
LOCK
;

209 if(!
no_∂™
 && !
have_∂™
 && !
skù_Æl
) {

210 
	`_düg
("LooksÜike yourÅest died before it could outputánything.");

211 
UNLOCK
;

215 if(
ã°_dõd
) {

216 
	`_düg
("Look†likêyou∏ã° dõd ju°á·î %d.", 
ã°_cou¡
);

217 
UNLOCK
;

224 if(!
skù_Æl
 && (
no_∂™
 || !
have_∂™
)) {

225 
	`¥ötf
("1..%d\n", 
ã°_cou¡
);

228 if((
have_∂™
 && !
no_∂™
Ë&& 
e_ã°s
 < 
ã°_cou¡
) {

229 
	`_düg
("LooksÜike youÖlanned %dÅests butÑan %dÉxtra.",

230 
e_ã°s
, 
ã°_cou¡
 -É_tests);

231 
UNLOCK
;

235 if((
have_∂™
 || !
no_∂™
Ë&& 
e_ã°s
 > 
ã°_cou¡
) {

236 
	`_düg
("LooksÜike youÖlanned %dÅests but onlyÑan %d.",

237 
e_ã°s
, 
ã°_cou¡
);

238 if(
Áûuªs
) {

239 
	`_düg
("LooksÜike you failed %dÅests of %dÑun.",

240 
Áûuªs
, 
ã°_cou¡
);

242 
UNLOCK
;

246 if(
Áûuªs
)

247 
	`_düg
("LooksÜike you failed %dÅests of %d.",

248 
Áûuªs
, 
ã°_cou¡
);

250 
UNLOCK
;

251 
	}
}

258 
	$_èp_öô
()

260 
run_⁄˚
 = 0;

262 if(!
run_⁄˚
) {

263 
ã°_pid
 = 
	`gëpid
();

264 
	`©exô
(
_˛ónup
);

270 
run_⁄˚
 = 1;

272 
	}
}

278 
	$∂™_no_∂™
()

281 
LOCK
;

283 
	`_èp_öô
();

285 if(
have_∂™
 != 0) {

286 
	`Ârötf
(
°dîr
, "YouÅriedÅoÖlanÅwice!\n");

287 
ã°_dõd
 = 1;

288 
UNLOCK
;

289 
	`exô
(255);

292 
have_∂™
 = 1;

293 
no_∂™
 = 1;

295 
UNLOCK
;

296 
	}
}

302 
	$∂™_skù_Æl
(c⁄° *
ªas⁄
)

305 
LOCK
;

307 
	`_èp_öô
();

309 
skù_Æl
 = 1;

311 
	`¥ötf
("1..0");

313 if(
ªas⁄
 !
NULL
)

314 
	`¥ötf
(" # Skù %s", 
ªas⁄
);

316 
	`¥ötf
("\n");

318 
UNLOCK
;

319 
	}
}

325 
	$∂™_ã°s
(
ã°s
)

328 
LOCK
;

330 
	`_èp_öô
();

332 if(
have_∂™
 != 0) {

333 
	`Ârötf
(
°dîr
, "YouÅriedÅoÖlanÅwice!\n");

334 
ã°_dõd
 = 1;

335 
UNLOCK
;

336 
	`exô
(255);

339 if(
ã°s
 == 0) {

340 
	`Ârötf
(
°dîr
, "You saidÅoÑun 0Åests! You've gotÅoÑun something.\n");

341 
ã°_dõd
 = 1;

342 
UNLOCK
;

343 
	`exô
(255);

346 
have_∂™
 = 1;

348 
	`_ex≥˘ed_ã°s
(
ã°s
);

350 
UNLOCK
;

351 
	}
}

354 
	$düg
(c⁄° *
fmt
, ...)

356 
va_li°
 
≠
;

358 
LOCK
;

360 
	`va_°¨t
(
≠
, 
fmt
);

361 
	`dügv
(
fmt
, 
≠
);

362 
	`va_íd
(
≠
);

364 
UNLOCK
;

365 
	}
}

368 
	$skù
(
n
, c⁄° *
fmt
, ...)

370 
va_li°
 
≠
;

371 *
skù_msg
;

373 
LOCK
;

375 
	`va_°¨t
(
≠
, 
fmt
);

376 i‡(
	`va•rötf
(&
skù_msg
, 
fmt
, 
≠
) < 0)

377 
skù_msg
 = 
NULL
;

378 
	`va_íd
(
≠
);

380 
n
-- > 0) {

381 
ã°_cou¡
++;

382 
	`¥ötf
("ok %d # skù %s\n", 
ã°_cou¡
,

383 
skù_msg
 !
NULL
 ?

384 
skù_msg
 : "libtap():malloc() failed");

387 
	`‰ì
(
skù_msg
);

389 
UNLOCK
;

390 
	}
}

393 
	$todo_°¨t
(c⁄° *
fmt
, ...)

395 
va_li°
 
≠
;

397 
LOCK
;

399 
	`va_°¨t
(
≠
, 
fmt
);

400 i‡(
	`va•rötf
(&
todo_msg
, 
fmt
, 
≠
) < 0)

401 
todo_msg
 = 
NULL
;

402 
	`va_íd
(
≠
);

404 
todo
 = 1;

406 
UNLOCK
;

407 
	}
}

410 
	$todo_íd
()

413 
LOCK
;

415 
todo
 = 0;

416 
	`‰ì
(
todo_msg
);

418 
UNLOCK
;

419 
	}
}

422 
	$exô_°©us_
()

424 
r
;

426 
LOCK
;

429 if(
no_∂™
 || !
have_∂™
) {

430 
UNLOCK
;

431  
Áûuªs
;

436 if(
e_ã°s
 < 
ã°_cou¡
) {

437 
r
 = 
ã°_cou¡
 - 
e_ã°s
;

438 
UNLOCK
;

439  
r
;

444 
r
 = 
Áûuªs
 + 
e_ã°s
 - 
ã°_cou¡
;

445 
UNLOCK
;

447  
r
;

448 
	}
}

451 
	$exô_°©us
()

453 
r
 = 
	`exô_°©us_
();

454 i‡(
r
 > 255)

455 
r
 = 255;

456  
r
;

457 
	}
}

	@ccan/ccan/tap/tap.h

1 #i‚de‡
CCAN_TAP_H


2 
	#CCAN_TAP_H


	)

28 
	~<cˇn/compûî/compûî.h
>

43 
∂™_ã°s
(
ã°s
);

56 
	#ok1
(
e
) ((e) ? \

57 
	`_gí_ªsu…
(1, 
__func__
, 
__FILE__
, 
__LINE__
, "%s", #e) : \

58 
	`_gí_ªsu…
(0, 
__func__
, 
__FILE__
, 
__LINE__
, "%s", #e))

	)

73 
	#ok
(
e
, ...) ((e) ? \

74 
	`_gí_ªsu…
(1, 
__func__
, 
__FILE__
, 
__LINE__
, \

75 
__VA_ARGS__
) : \

76 
	`_gí_ªsu…
(0, 
__func__
, 
__FILE__
, 
__LINE__
, \

77 
__VA_ARGS__
))

	)

93 
	#∑ss
(...Ë
	`ok
(1, 
__VA_ARGS__
)

	)

102 
	#Áû
(...Ë
	`ok
(0, 
__VA_ARGS__
)

	)

105 
	#skù_if
(
c⁄d
, 
n
, ...) \

106 i‡(
c⁄d
Ë
	`skù
((
n
), 
__VA_ARGS__
); \

107 

	)

109 
	#skù_°¨t
(
ã°
, 
n
, ...) \

111 if((
ã°
)) { \

112 
	`skù
(
n
, 
__VA_ARGS__
); \

114 }

	)

116 
	#skù_íd
 } 0)

	)

118 
	$_gí_ªsu…
(, const *, const *, ,

119 c⁄° *, ...Ë
	`PRINTF_FMT
(5, 6);

131 
	$düg
(c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(1, 2);

154 
	$skù
(
n
, c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(2, 3);

184 
	$todo_°¨t
(c⁄° *
fmt
, ...Ë
	`PRINTF_FMT
(1, 2);

191 
	`todo_íd
();

203 
	`exô_°©us
();

222 
	`∂™_no_∂™
();

242 
	`∂™_skù_Æl
(c⁄° *
ªas⁄
);

249 (*
èp_Áû_ˇŒback
)();

	@ccan/ccan/tap/test/run.c

5 
	~<cˇn/èp/èp.h
>

6 
	~<cˇn/èp/èp.c
>

7 
	~<°dio.h
>

8 
	~<limôs.h
>

9 
	~<îr.h
>

10 
	~<°rög.h
>

11 
	~<°dboﬁ.h
>

12 
	~<‚m©ch.h
>

17 
	g°dîrfd
;

20 
	$wrôe_Æl
(
fd
, c⁄° *
d©a
, 
size_t
 
size
)

22 
size
) {

23 
ssize_t
 
d⁄e
;

25 
d⁄e
 = 
	`wrôe
(
fd
, 
d©a
, 
size
);

26 i‡(
d⁄e
 <= 0)

27 
	`_exô
(1);

28 
d©a
 = (c⁄° *)d©®+ 
d⁄e
;

29 
size
 -
d⁄e
;

31 
	}
}

34 
	$Áûmsg
(c⁄° *
fmt
, ...)

36 
buf
[1024];

37 
va_li°
 
≠
;

40 
	`va_°¨t
(
≠
, 
fmt
);

41 
	`v•rötf
(
buf
, 
fmt
, 
≠
);

42 
	`va_íd
(
≠
);

44 
	`wrôe_Æl
(
°dîrfd
, "# ", 2);

45 
	`wrôe_Æl
(
°dîrfd
, 
buf
, 
	`°æí
(buf));

46 
	`wrôe_Æl
(
°dîrfd
, "\n", 1);

47 
	`_exô
(1);

48 
	}
}

50 
	$ex≥˘
(
fd
, c⁄° *
∑âîn
)

52 
buf„r
[
PIPE_BUF
+1];

53 
r
;

55 
r
 = 
	`ªad
(
fd
, 
buf„r
, (buffer)-1);

56 i‡(
r
 < 0)

57 
	`Áûmsg
("reading fromÖipe");

58 
buf„r
[
r
] = '\0';

60 i‡(
	`‚m©ch
(
∑âîn
, 
buf„r
, 0) != 0)

61 
	`Áûmsg
("Ex≥˘ed '%s' gŸ '%s'", 
∑âîn
, 
buf„r
);

62 
	}
}

64 
	$maö
(
¨gc
, *
¨gv
[])

66 
p
[2];

67 
°doutfd
;

69 
	`£tbuf
(
°dout
, 0);

70 
	`¥ötf
("1..1\n");

71 
°dîrfd
 = 
	`dup
(
STDERR_FILENO
);

72 i‡(
°dîrfd
 < 0)

73 
	`îr
(1, "dup of stderr failed");

75 
°doutfd
 = 
	`dup
(
STDOUT_FILENO
);

76 i‡(
°doutfd
 < 0)

77 
	`îr
(1, "dup of stdout failed");

79 i‡(
	`pùe
(
p
) != 0)

80 
	`Áûmsg
("pipe failed");

82 i‡(
	`dup2
(
p
[1], 
STDERR_FILENO
Ë< 0 || dup2’[1], 
STDOUT_FILENO
) < 0)

83 
	`Áûmsg
("Duplicating file descriptor");

85 
	`∂™_ã°s
(10);

86 
	`ex≥˘
(
p
[0], "1..10\n");

88 
	`ok
(1, "msg1");

89 
	`ex≥˘
(
p
[0], "ok 1 - msg1\n");

91 
	`ok
(0, "msg2");

92 
	`ex≥˘
(
p
[0], "not ok 2 - msg2\n"

95 
	`ok1
(
åue
);

96 
	`ex≥˘
(
p
[0], "ok 3 -Årue\n");

98 
	`ok1
(
Ál£
);

99 
	`ex≥˘
(
p
[0], "not ok 4 - false\n"

102 
	`∑ss
("passed");

103 
	`ex≥˘
(
p
[0], "ok 5 -Öassed\n");

105 
	`Áû
("failed");

106 
	`ex≥˘
(
p
[0], "not ok 6 - failed\n"

109 
	`skù
(2, "skipping %s", "test");

110 
	`ex≥˘
(
p
[0], "ok 7 # skip skippingÅest\n"

113 
	`todo_°¨t
("todo");

114 
	`ok1
(
Ál£
);

115 
	`ex≥˘
(
p
[0], "not ok 9 - false # TODOÅodo\n"

117 
	`ok1
(
åue
);

118 
	`ex≥˘
(
p
[0], "ok 10 -Årue # TODOÅodo\n");

119 
	`todo_íd
();

121 i‡(
	`exô_°©us
() != 3)

122 
	`Áûmsg
("Ex≥˘edÉxô sètu†3,ÇŸ %i", 
	`exô_°©us
());

126 
	`_˛ónup
();

127 
	`ex≥˘
(
p
[0], "# LooksÜike you failed 2Åests of 9.\n");

130 
	`wrôe_Æl
(
°doutfd
, "ok 1 - AllÖassed\n",

131 
	`°æí
("ok 1 - AllÖassed\n"));

132 
	`exô
(0);

133 
	}
}

	@ccan/ccan/tcon/tcon.h

2 #i‚de‡
CCAN_TCON_H


3 
	#CCAN_TCON_H


	)

4 
	~"c⁄fig.h
"

39 #i‡
HAVE_FLEXIBLE_ARRAY_MEMBER


40 
	#TCON
(
de˛s
Ë°ru˘ { de˛s; } 
_tc⁄
[]

	)

42 
	#TCON
(
de˛s
Ë°ru˘ { de˛s; } 
_tc⁄
[1]

	)

61 
	#tc⁄_check
(
x
, 
ˇ«ry
, 
ex¥
) \

62 (((
x
)->
_tc⁄
[0].
ˇ«ry
 =(
ex¥
)Ë? (xË: (x))

	)

76 
	#tc⁄_check_±r
(
x
, 
ˇ«ry
, 
ex¥
) \

77 ((&(
x
)->
_tc⁄
[0].
ˇ«ry
 =(
ex¥
)Ë? (xË: (x))

	)

85 #i‡
HAVE_TYPEOF


86 
	#tc⁄_ty≥
(
x
, 
ˇ«ry
Ë
	`__ty≥of__
((x)->
_tc⁄
[0].ˇ«ry)

	)

88 
	#tc⁄_ty≥
(
x
, 
ˇ«ry
Ë*

	)

96 #i‡
HAVE_TYPEOF


97 
	#tc⁄_±r_ty≥
(
x
, 
ˇ«ry
Ë
	`__ty≥of__
(&(x)->
_tc⁄
[0].ˇ«ry)

	)

99 
	#tc⁄_±r_ty≥
(
x
, 
ˇ«ry
Ë*

	)

112 
	#tc⁄_ˇ°
(
x
, 
ˇ«ry
, 
ex¥
Ë((
	`tc⁄_ty≥
((x), c™¨y))”x¥))

	)

113 
	#tc⁄_ˇ°_±r
(
x
, 
ˇ«ry
, 
ex¥
Ë((
	`tc⁄_±r_ty≥
((x), c™¨y))”x¥))

	)

	@ccan/ccan/tcon/test/compile_fail-tcon_cast.c

1 
	~<cˇn/tc⁄/tc⁄.h
>

2 
	~<°dlib.h
>

4 
	sc⁄èöî
 {

5 *
	mp
;

8 
	söt_™d_ch¨p_c⁄èöî
 {

9 
c⁄èöî
 
	møw
;

10 
TCON
(*
tc1
; *
tc2
);

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
öt_™d_ch¨p_c⁄èöî
 
ic⁄
;

16 #ifde‡
FAIL


17 #i‡!
HAVE_TYPEOF


18 #îr‹ 
We
 
ˇ¬Ÿ
 
dëe˘
 
ty≥
 
¥obÀms
 
wôhout
 
HAVE_TYPEOF


24 
x
;

26 
ic⁄
.
øw
.
p
 = 
NULL
;

27 
x
 = 
	`tc⁄_ˇ°
(&
ic⁄
, 
tc1
, ic⁄.
øw
.
p
);

28  
x
 !
NULL
 ? 0 : 1;

29 
	}
}

	@ccan/ccan/tcon/test/compile_fail.c

1 
	~<cˇn/tc⁄/tc⁄.h
>

2 
	~<°dlib.h
>

4 
	sc⁄èöî
 {

5 *
	mp
;

8 
	söt_c⁄èöî
 {

9 
c⁄èöî
 
	møw
;

10 
TCON
(*
ˇ«ry
);

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
öt_c⁄èöî
 
ic⁄
;

16 #ifde‡
FAIL


21 
x
 = 
NULL
;

23 
	`tc⁄_check
(&
ic⁄
, 
ˇ«ry
, 
x
)->
øw
.
p
 = x;

25 
	}
}

	@ccan/ccan/tcon/test/compile_ok-void.c

1 
	~<cˇn/tc⁄/tc⁄.h
>

2 
	~<°dlib.h
>

4 
	sc⁄èöî
 {

5 *
	mp
;

8 
	svoid_c⁄èöî
 {

9 
c⁄èöî
 
	møw
;

10 
TCON
(*
ˇ«ry
);

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
void_c⁄èöî
 
vc⁄
;

17 
	`tc⁄_check
(&
vc⁄
, 
ˇ«ry
, 
NULL
)->
øw
.
p
 = NULL;

18 
	`tc⁄_check
(&
vc⁄
, 
ˇ«ry
, 
¨gv
[0])->
øw
.
p
 = 
NULL
;

19 
	`tc⁄_check
(&
vc⁄
, 
ˇ«ry
, 
maö
)->
øw
.
p
 = 
NULL
;

21 
	}
}

	@ccan/ccan/tcon/test/compile_ok.c

1 
	~<cˇn/tc⁄/tc⁄.h
>

2 
	~<°dlib.h
>

4 
	sc⁄èöî
 {

5 *
	mp
;

8 
	söt_c⁄èöî
 {

9 
c⁄èöî
 
	møw
;

10 
TCON
(
tc
);

13 
	sch¨p_™d_öt_c⁄èöî
 {

14 
c⁄èöî
 
	møw
;

15 
TCON
(
tc1
; *
tc2
);

18 
	$maö
(
¨gc
, *
¨gv
[])

20 
öt_c⁄èöî
 
ic⁄
;

21 
ch¨p_™d_öt_c⁄èöî
 
cic⁄
;

23 
	`tc⁄_check
(&
ic⁄
, 
tc
, 7)->
øw
.
p
 = 
NULL
;

24 
	`tc⁄_check
(&
cic⁄
, 
tc1
, 7)->
øw
.
p
 = 
¨gv
[0];

25 
	`tc⁄_check
(&
cic⁄
, 
tc2
, 
¨gv
[0])->
øw
.
p
 =árgv[0];

27 
	}
}

	@ccan/ccan/time/test/run-check.c

1 
	#DEBUG


	)

2 
	~<cˇn/time/time.h
>

3 
	~<cˇn/time/time.c
>

4 
	~<cˇn/èp/èp.h
>

5 
	~<uni°d.h
>

6 
	~<°dlib.h
>

7 
	~<sig«l.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/waô.h
>

12 
	$ab‹t
()

14 
	`exô
(7);

15 
	}
}

17 
	$maö
()

19 
time•ec
 
t1
, 
t2
, 
t3
, 
zîo
 = { 0, 0 };

20 
fds
[2];

22 
	`∂™_ã°s
(62);

25 
t1
 = 
	`time_now
();

26 
t2
 = 
	`time_now
();

29 
t3
 = 
	`time_sub
(
t2
, 
t1
);

30 
	`ok1
(
t3
.
tv_£c
 > 0 ||Å3.
tv_n£c
 >= 0);

31 
t3
 = 
	`time_sub
(
t2
,Å2);

32 
	`ok1
(
t3
.
tv_£c
 =0 &&Å3.
tv_n£c
 == 0);

33 
t3
 = 
	`time_sub
(
t1
,Å1);

34 
	`ok1
(
t3
.
tv_£c
 =0 &&Å3.
tv_n£c
 == 0);

37 
	`ok1
(
	`time_eq
(
t1
,Å1));

38 
	`ok1
(
	`time_eq
(
t2
,Å2));

39 
	`ok1
(!
	`time_eq
(
t1
, 
t3
));

40 
	`ok1
(!
	`time_eq
(
t2
, 
t3
));

43 
t3
.
tv_£c
 = 0;

44 
t3
.
tv_n£c
 = 1;

45 
t2
 = 
	`time_add
—2, 
t3
);

48 
	`ok1
(!
	`time_eq
(
t1
, 
t2
));

49 
	`ok1
(!
	`time_gª©î
(
t1
, 
t2
));

50 
	`ok1
(
	`time_Àss
(
t1
, 
t2
));

51 
	`ok1
(
	`time_gª©î
(
t2
, 
t1
));

52 
	`ok1
(!
	`time_Àss
(
t2
, 
t1
));

53 
t3
.
tv_£c
 = 0;

54 
t3
.
tv_n£c
 = 999999999;

55 
t2
 = 
	`time_add
—2, 
t3
);

56 
	`ok1
(!
	`time_eq
(
t1
, 
t2
));

57 
	`ok1
(!
	`time_gª©î
(
t1
, 
t2
));

58 
	`ok1
(
	`time_Àss
(
t1
, 
t2
));

59 
	`ok1
(
	`time_gª©î
(
t2
, 
t1
));

60 
	`ok1
(!
	`time_Àss
(
t2
, 
t1
));

62 
t3
 = 
	`time_sub
(
t2
, 
zîo
);

63 
	`ok1
(
	`time_eq
(
t3
, 
t2
));

64 
t3
 = 
	`time_sub
(
t2
,Å2);

65 
	`ok1
(
	`time_eq
(
t3
, 
zîo
));

68 
t3
 = 
	`time_‰om_m£c
(500);

69 
	`ok1
(
t3
.
tv_£c
 == 0);

70 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

71 
	`ok1
(
	`time_to_m£c
(
t3
) == 500);

73 
t3
 = 
	`time_‰om_m£c
(1000);

74 
	`ok1
(
t3
.
tv_£c
 == 1);

75 
	`ok1
(
t3
.
tv_n£c
 == 0);

76 
	`ok1
(
	`time_to_m£c
(
t3
) == 1000);

78 
t3
 = 
	`time_‰om_m£c
(1500);

79 
	`ok1
(
t3
.
tv_£c
 == 1);

80 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

81 
	`ok1
(
	`time_to_m£c
(
t3
) == 1500);

84 
t3
 = 
	`time_‰om_u£c
(500000);

85 
	`ok1
(
t3
.
tv_£c
 == 0);

86 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

87 
	`ok1
(
	`time_to_u£c
(
t3
) == 500000);

89 
t3
 = 
	`time_‰om_u£c
(1000000);

90 
	`ok1
(
t3
.
tv_£c
 == 1);

91 
	`ok1
(
t3
.
tv_n£c
 == 0);

92 
	`ok1
(
	`time_to_u£c
(
t3
) == 1000000);

94 
t3
 = 
	`time_‰om_u£c
(1500000);

95 
	`ok1
(
t3
.
tv_£c
 == 1);

96 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

97 
	`ok1
(
	`time_to_u£c
(
t3
) == 1500000);

100 
t3
 = 
	`time_‰om_n£c
(500000000);

101 
	`ok1
(
t3
.
tv_£c
 == 0);

102 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

103 
	`ok1
(
	`time_to_n£c
(
t3
) == 500000000);

105 
t3
 = 
	`time_‰om_n£c
(1000000000);

106 
	`ok1
(
t3
.
tv_£c
 == 1);

107 
	`ok1
(
t3
.
tv_n£c
 == 0);

108 
	`ok1
(
	`time_to_n£c
(
t3
) == 1000000000);

110 
t3
 = 
	`time_‰om_n£c
(1500000000);

111 
	`ok1
(
t3
.
tv_£c
 == 1);

112 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

113 
	`ok1
(
	`time_to_n£c
(
t3
) == 1500000000);

116 
t3
 = 
	`time_sub
—ime_sub(
t2
, 
	`time_‰om_m£c
(500)),Åime_from_msec(500));

117 
	`ok1
(
t3
.
tv_£c
 =
t2
.tv_sec - 1);

118 
	`ok1
(
t3
.
tv_n£c
 =
t2
.tv_nsec);

121 
t1
.
tv_n£c
 = 100;

122 
t1
.
tv_£c
 = 100;

124 
t3
 = 
	`time_divide
(
t1
, 2);

125 
	`ok1
(
t3
.
tv_£c
 == 50);

126 
	`ok1
(
t3
.
tv_n£c
 == 50);

128 
t3
 = 
	`time_divide
(
t1
, 100);

129 
	`ok1
(
t3
.
tv_£c
 == 1);

130 
	`ok1
(
t3
.
tv_n£c
 == 1);

132 
t3
 = 
	`time_mu…ùly
(t3, 100);

133 
	`ok1
(
	`time_eq
(
t3
, 
t1
));

135 
t3
 = 
	`time_divide
(
t1
, 200);

136 
	`ok1
(
t3
.
tv_£c
 == 0);

137 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

140 
t1
.
tv_£c
 = (1U << 31) - 1;

141 
t1
.
tv_n£c
 = 999999999;

142 
t2
 = 
	`time_divide
(
t1
, 1 << 30);

144 
	`ok1
((
t2
.
tv_£c
 =2 &&Å2.
tv_n£c
 == 0)

145 || (
t2
.
tv_£c
 =1 &&Å2.
tv_n£c
 == 999999999));

148 
t1
.
tv_£c
 = 0;

149 
t1
.
tv_n£c
 = 1;

150 
t2
 = 
	`time_mu…ùly
(
t1
, 1UL << 31);

151 
	`ok1
(
t2
.
tv_£c
 == 2);

152 
	`ok1
(
t2
.
tv_n£c
 == 147483648);

154 
	`pùe
(
fds
);

156 
	`fÊush
(
°dout
);

157 
	`f‹k
()) {

159 
	`˛o£
(
fds
[0]);

160 
	`dup2
(
fds
[1], 1);

161 
	`dup2
(
fds
[1], 2);

162 
t1
.
tv_£c
 = 7;

163 
t1
.
tv_n£c
 = 1000000001;

164 
t2
 = 
	`time_check
(
t1
, 
NULL
);

165 i‡(
t2
.
tv_£c
 !8 ||Å2.
tv_n£c
 != 1)

166 
	`exô
(1);

167 
t1
.
tv_£c
 = -1;

168 
t1
.
tv_n£c
 = 5;

169 
t2
 = 
	`time_check
(
t1
, 
NULL
);

170 i‡(
t2
.
tv_£c
 !0 ||Å2.
tv_n£c
 != 5)

171 
	`exô
(1);

172 
t1
.
tv_£c
 = 8;

173 
t1
.
tv_n£c
 = 1000000002;

175 
t2
 = 
	`time_check
(
t1
, "abortstr");

176 
	`exô
(1);

179 
ªadbuf
[1024];

180 
r
, 
Àn
 = 0;

182 
	`˛o£
(
fds
[1]);

183 (
r
 = 
	`ªad
(
fds
[0], 
ªadbuf
 + 
Àn
, 1023 -Üen)) > 0)

184 
Àn
 +
r
;

185 
ªadbuf
[
Àn
] = '\0';

186 
	`ok1
(
	`°rcmp
(
ªadbuf
,

192 
	`ok1
(
	`waô
(&
r
) != -1);

193 
	`ok1
(
	`WIFEXITED
(
r
));

194 
	`ok1
(
	`WEXITSTATUS
(
r
) == 7);

198  
	`exô_°©us
();

199 
	}
}

	@ccan/ccan/time/test/run.c

1 
	~<cˇn/time/time.h
>

2 
	~<cˇn/time/time.c
>

3 
	~<cˇn/èp/èp.h
>

5 
	$maö
()

7 
time•ec
 
t1
, 
t2
, 
t3
, 
zîo
 = { 0, 0 };

9 
	`∂™_ã°s
(58);

12 
t1
 = 
	`time_now
();

13 
t2
 = 
	`time_now
();

16 
t3
 = 
	`time_sub
(
t2
, 
t1
);

17 
	`ok1
(
t3
.
tv_£c
 > 0 ||Å3.
tv_n£c
 >= 0);

18 
t3
 = 
	`time_sub
(
t2
,Å2);

19 
	`ok1
(
t3
.
tv_£c
 =0 &&Å3.
tv_n£c
 == 0);

20 
t3
 = 
	`time_sub
(
t1
,Å1);

21 
	`ok1
(
t3
.
tv_£c
 =0 &&Å3.
tv_n£c
 == 0);

24 
	`ok1
(
	`time_eq
(
t1
,Å1));

25 
	`ok1
(
	`time_eq
(
t2
,Å2));

26 
	`ok1
(!
	`time_eq
(
t1
, 
t3
));

27 
	`ok1
(!
	`time_eq
(
t2
, 
t3
));

30 
t3
.
tv_£c
 = 0;

31 
t3
.
tv_n£c
 = 1;

32 
t2
 = 
	`time_add
—2, 
t3
);

35 
	`ok1
(!
	`time_eq
(
t1
, 
t2
));

36 
	`ok1
(!
	`time_gª©î
(
t1
, 
t2
));

37 
	`ok1
(
	`time_Àss
(
t1
, 
t2
));

38 
	`ok1
(
	`time_gª©î
(
t2
, 
t1
));

39 
	`ok1
(!
	`time_Àss
(
t2
, 
t1
));

40 
t3
.
tv_£c
 = 0;

41 
t3
.
tv_n£c
 = 999999999;

42 
t2
 = 
	`time_add
—2, 
t3
);

43 
	`ok1
(!
	`time_eq
(
t1
, 
t2
));

44 
	`ok1
(!
	`time_gª©î
(
t1
, 
t2
));

45 
	`ok1
(
	`time_Àss
(
t1
, 
t2
));

46 
	`ok1
(
	`time_gª©î
(
t2
, 
t1
));

47 
	`ok1
(!
	`time_Àss
(
t2
, 
t1
));

49 
t3
 = 
	`time_sub
(
t2
, 
zîo
);

50 
	`ok1
(
	`time_eq
(
t3
, 
t2
));

51 
t3
 = 
	`time_sub
(
t2
,Å2);

52 
	`ok1
(
	`time_eq
(
t3
, 
zîo
));

55 
t3
 = 
	`time_‰om_m£c
(500);

56 
	`ok1
(
t3
.
tv_£c
 == 0);

57 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

58 
	`ok1
(
	`time_to_m£c
(
t3
) == 500);

60 
t3
 = 
	`time_‰om_m£c
(1000);

61 
	`ok1
(
t3
.
tv_£c
 == 1);

62 
	`ok1
(
t3
.
tv_n£c
 == 0);

63 
	`ok1
(
	`time_to_m£c
(
t3
) == 1000);

65 
t3
 = 
	`time_‰om_m£c
(1500);

66 
	`ok1
(
t3
.
tv_£c
 == 1);

67 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

68 
	`ok1
(
	`time_to_m£c
(
t3
) == 1500);

71 
t3
 = 
	`time_‰om_u£c
(500000);

72 
	`ok1
(
t3
.
tv_£c
 == 0);

73 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

74 
	`ok1
(
	`time_to_u£c
(
t3
) == 500000);

76 
t3
 = 
	`time_‰om_u£c
(1000000);

77 
	`ok1
(
t3
.
tv_£c
 == 1);

78 
	`ok1
(
t3
.
tv_n£c
 == 0);

79 
	`ok1
(
	`time_to_u£c
(
t3
) == 1000000);

81 
t3
 = 
	`time_‰om_u£c
(1500000);

82 
	`ok1
(
t3
.
tv_£c
 == 1);

83 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

84 
	`ok1
(
	`time_to_u£c
(
t3
) == 1500000);

87 
t3
 = 
	`time_‰om_n£c
(500000000);

88 
	`ok1
(
t3
.
tv_£c
 == 0);

89 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

90 
	`ok1
(
	`time_to_n£c
(
t3
) == 500000000);

92 
t3
 = 
	`time_‰om_n£c
(1000000000);

93 
	`ok1
(
t3
.
tv_£c
 == 1);

94 
	`ok1
(
t3
.
tv_n£c
 == 0);

95 
	`ok1
(
	`time_to_n£c
(
t3
) == 1000000000);

97 
t3
 = 
	`time_‰om_n£c
(1500000000);

98 
	`ok1
(
t3
.
tv_£c
 == 1);

99 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

100 
	`ok1
(
	`time_to_n£c
(
t3
) == 1500000000);

103 
t3
 = 
	`time_sub
—ime_sub(
t2
, 
	`time_‰om_m£c
(500)),Åime_from_msec(500));

104 
	`ok1
(
t3
.
tv_£c
 =
t2
.tv_sec - 1);

105 
	`ok1
(
t3
.
tv_n£c
 =
t2
.tv_nsec);

108 
t1
.
tv_n£c
 = 100;

109 
t1
.
tv_£c
 = 100;

111 
t3
 = 
	`time_divide
(
t1
, 2);

112 
	`ok1
(
t3
.
tv_£c
 == 50);

113 
	`ok1
(
t3
.
tv_n£c
 == 50);

115 
t3
 = 
	`time_divide
(
t1
, 100);

116 
	`ok1
(
t3
.
tv_£c
 == 1);

117 
	`ok1
(
t3
.
tv_n£c
 == 1);

119 
t3
 = 
	`time_mu…ùly
(t3, 100);

120 
	`ok1
(
	`time_eq
(
t3
, 
t1
));

122 
t3
 = 
	`time_divide
(
t1
, 200);

123 
	`ok1
(
t3
.
tv_£c
 == 0);

124 
	`ok1
(
t3
.
tv_n£c
 == 500000000);

127 
t1
.
tv_£c
 = (1U << 31) - 1;

128 
t1
.
tv_n£c
 = 999999999;

129 
t2
 = 
	`time_divide
(
t1
, 1 << 30);

131 
	`ok1
((
t2
.
tv_£c
 =2 &&Å2.
tv_n£c
 == 0)

132 || (
t2
.
tv_£c
 =1 &&Å2.
tv_n£c
 == 999999999));

135 
t1
.
tv_£c
 = 0;

136 
t1
.
tv_n£c
 = 1;

137 
t2
 = 
	`time_mu…ùly
(
t1
, 1UL << 31);

138 
	`ok1
(
t2
.
tv_£c
 == 2);

139 
	`ok1
(
t2
.
tv_n£c
 == 147483648);

141  
	`exô_°©us
();

142 
	}
}

	@ccan/ccan/time/time.c

2 
	~<cˇn/time/time.h
>

3 
	~<°dlib.h
>

4 
	~<°dio.h
>

6 #i‡!
HAVE_CLOCK_GETTIME
 && !
HAVE_CLOCK_GETTIME_IN_LIBRT


7 
	~<sys/time.h
>

9 
time•ec
 
	$time_now
()

11 
timevÆ
 
now
;

12 
time•ec
 
ªt
;

13 
	`gëtimeofday
(&
now
, 
NULL
);

14 
ªt
.
tv_£c
 = 
now
.tv_sec;

15 
ªt
.
tv_n£c
 = 
now
.
tv_u£c
 * 1000;

16  
	`TIME_CHECK
(
ªt
);

17 
	}
}

19 
	~<time.h
>

20 
time•ec
 
	$time_now
()

22 
time•ec
 
ªt
;

23 
	`˛ock_gëtime
(
CLOCK_REALTIME
, &
ªt
);

24  
	`TIME_CHECK
(
ªt
);

25 
	}
}

28 
time•ec
 
	$time_divide
(
time•ec
 
t
, 
div
)

30 
time•ec
 
ªs
;

31 
uöt64_t
 
ªm
, 
ns
;

34 
ªs
.
tv_£c
 = 
	`TIME_CHECK
(
t
).tv_£¯/ 
div
;

35 
ªm
 = 
t
.
tv_£c
 % 
div
;

39 
bôs
 = 
	`ûog64
(
ªm
);

40 i‡(
bôs
 + 30 >= 64) {

42 
ªm
 >>(
bôs
 - (64 - 30));

43 
div
 >>(
bôs
 - (64 - 30));

46 i‡(
ªm
 & ~(((
uöt64_t
)1 << 30) - 1)) {

48 
n£c
 = 
ªm
 * 1000000000.0 + 
t
.
tv_n£c
;

49 
ªs
.
tv_n£c
 = 
n£c
 / 
div
;

51 
ns
 = 
ªm
 * 1000000000 + 
t
.
tv_n£c
;

52 
ªs
.
tv_n£c
 = 
ns
 / 
div
;

54  
	`TIME_CHECK
(
ªs
);

55 
	}
}

57 
time•ec
 
	$time_mu…ùly
(
time•ec
 
t
, 
mu…
)

59 
time•ec
 
ªs
;

62 i‡(
mu…
 & ~((1UL << 30) - 1)) {

64 
n£c
 = ()
t
.
tv_n£c
 * 
mu…
;

66 
ªs
.
tv_£c
 = 
n£c
 / 1000000000.0;

67 
ªs
.
tv_n£c
 = 
n£c
 - (ªs.
tv_£c
 * 1000000000.0);

69 
uöt64_t
 
n£c
 = 
t
.
tv_n£c
 * 
mu…
;

71 
ªs
.
tv_n£c
 = 
n£c
 % 1000000000;

72 
ªs
.
tv_£c
 = 
n£c
 / 1000000000;

74 
ªs
.
tv_£c
 +
	`TIME_CHECK
(
t
).tv_£¯* 
mu…
;

75  
	`TIME_CHECK
(
ªs
);

76 
	}
}

78 
time•ec
 
	$time_check
(
time•ec
 
t
, c⁄° *
ab‹t°r
)

80 i‡(
t
.
tv_£c
 < 0 ||Å.
tv_n£c
 >= 1000000000) {

81 i‡(
ab‹t°r
) {

82 
	`Ârötf
(
°dîr
, "%s: malformedÅime %li.%09li\n",

83 
ab‹t°r
,

84 ()
t
.
tv_£c
, (È.
tv_n£c
);

85 
	`ab‹t
();

87 
time•ec
 
ﬁd
 = 
t
;

89 i‡(
t
.
tv_n£c
 >= 1000000000) {

90 
t
.
tv_£c
 +t.
tv_n£c
 / 1000000000;

91 
t
.
tv_n£c
 %= 1000000000;

93 i‡(
t
.
tv_£c
 < 0)

94 
t
.
tv_£c
 = 0;

96 
	`Ârötf
(
°dîr
, "WARNING: malformedÅime"

98 ()
ﬁd
.
tv_£c
, ()ﬁd.
tv_n£c
,

99 ()
t
.
tv_£c
, (È.
tv_n£c
);

102  
t
;

103 
	}
}

	@ccan/ccan/time/time.h

2 #i‚de‡
CCAN_TIME_H


3 
	#CCAN_TIME_H


	)

4 
	~"c⁄fig.h
"

5 
	~<sys/time.h
>

6 #i‡
HAVE_STRUCT_TIMESPEC


7 
	~<time.h
>

9 
	stime•ec
 {

10 
time_t
 
	mtv_£c
;

11 
	mtv_n£c
;

14 
	~<°döt.h
>

15 
	~<°dboﬁ.h
>

17 #ifde‡
DEBUG


18 
	~<cˇn/°r/°r.h
>

19 
	#TIME_CHECK
(
t
) \

20 
	`time_check
((
t
), 
__FILE__
 ":" 
	`°rögify
(
__LINE__
Ë" (" såögify—Ë"Ë")

	)

22 
	#TIME_CHECK
(
t
Ë—)

	)

43 
time•ec
 
time_check
(time•e¯
ö
, c⁄° *
ab‹t°r
);

51 
time•ec
 
time_now
();

65 
ölöe
 
boﬁ
 
	$time_gª©î
(
time•ec
 
a
, time•e¯
b
)

67 i‡(
	`TIME_CHECK
(
a
).
tv_£c
 > TIME_CHECK(
b
).tv_sec)

68  
åue
;

69 i‡(
a
.
tv_£c
 < 
b
.tv_sec)

70  
Ál£
;

72  
a
.
tv_n£c
 > 
b
.tv_nsec;

73 
	}
}

87 
ölöe
 
boﬁ
 
	$time_Àss
(
time•ec
 
a
, time•e¯
b
)

89 i‡(
	`TIME_CHECK
(
a
).
tv_£c
 < TIME_CHECK(
b
).tv_sec)

90  
åue
;

91 i‡(
a
.
tv_£c
 > 
b
.tv_sec)

92  
Ál£
;

94  
a
.
tv_n£c
 < 
b
.tv_nsec;

95 
	}
}

117 
ölöe
 
boﬁ
 
	$time_eq
(
time•ec
 
a
, time•e¯
b
)

119  
	`TIME_CHECK
(
a
).
tv_£c
 =TIME_CHECK(
b
).tv_sec

120 && 
a
.
tv_n£c
 =
b
.tv_nsec;

121 
	}
}

136 
ölöe
 
time•ec
 
	$time_sub
(
time•ec
 
ª˚¡
,

137 
time•ec
 
ﬁd
)

139 
time•ec
 
diff
;

141 
diff
.
tv_£c
 = 
	`TIME_CHECK
(
ª˚¡
).tv_£¯- TIME_CHECK(
ﬁd
).tv_sec;

142 i‡(
ﬁd
.
tv_n£c
 > 
ª˚¡
.tv_nsec) {

143 
diff
.
tv_£c
--;

144 
diff
.
tv_n£c
 = 1000000000 + 
ª˚¡
.tv_n£¯- 
ﬁd
.tv_nsec;

146 
diff
.
tv_n£c
 = 
ª˚¡
.tv_n£¯- 
ﬁd
.tv_nsec;

148  
	`TIME_CHECK
(
diff
);

149 
	}
}

165 
ölöe
 
time•ec
 
	$time_add
(
time•ec
 
a
, time•e¯
b
)

167 
time•ec
 
sum
;

169 
sum
.
tv_£c
 = 
	`TIME_CHECK
(
a
).tv_£¯+ TIME_CHECK(
b
).tv_sec;

170 
sum
.
tv_n£c
 = 
a
.tv_n£¯+ 
b
.tv_nsec;

171 i‡(
sum
.
tv_n£c
 >= 1000000000) {

172 
sum
.
tv_£c
++;

173 
sum
.
tv_n£c
 -= 1000000000;

175  
	`TIME_CHECK
(
sum
);

176 
	}
}

199 
time•ec
 
time_divide
(time•e¯
t
, 
div
);

211 
time•ec
 
time_mu…ùly
(time•e¯
t
, 
mu…
);

226 
ölöe
 
uöt64_t
 
	$time_to_m£c
(
time•ec
 
t
)

228 
uöt64_t
 
m£c
;

230 
m£c
 = 
	`TIME_CHECK
(
t
).
tv_n£c
 / 1000000 + (
uöt64_t
È.
tv_£c
 * 1000;

231  
m£c
;

232 
	}
}

248 
ölöe
 
uöt64_t
 
	$time_to_u£c
(
time•ec
 
t
)

250 
uöt64_t
 
u£c
;

252 
u£c
 = 
	`TIME_CHECK
(
t
).
tv_n£c
 / 1000 + (
uöt64_t
È.
tv_£c
 * 1000000;

253  
u£c
;

254 
	}
}

270 
ölöe
 
uöt64_t
 
	$time_to_n£c
(
time•ec
 
t
)

272 
uöt64_t
 
n£c
;

274 
n£c
 = 
	`TIME_CHECK
(
t
).
tv_n£c
 + (
uöt64_t
È.
tv_£c
 * 1000000000;

275  
n£c
;

276 
	}
}

286 
ölöe
 
time•ec
 
	$time_‰om_m£c
(
uöt64_t
 
m£c
)

288 
time•ec
 
t
;

290 
t
.
tv_n£c
 = (
m£c
 % 1000) * 1000000;

291 
t
.
tv_£c
 = 
m£c
 / 1000;

292  
	`TIME_CHECK
(
t
);

293 
	}
}

303 
ölöe
 
time•ec
 
	$time_‰om_u£c
(
uöt64_t
 
u£c
)

305 
time•ec
 
t
;

307 
t
.
tv_n£c
 = (
u£c
 % 1000000) * 1000;

308 
t
.
tv_£c
 = 
u£c
 / 1000000;

309  
	`TIME_CHECK
(
t
);

310 
	}
}

320 
ölöe
 
time•ec
 
	$time_‰om_n£c
(
uöt64_t
 
n£c
)

322 
time•ec
 
t
;

324 
t
.
tv_n£c
 = 
n£c
 % 1000000000;

325 
t
.
tv_£c
 = 
n£c
 / 1000000000;

326  
	`TIME_CHECK
(
t
);

327 
	}
}

339 
ölöe
 
timevÆ
 
	$time•ec_to_timevÆ
(
time•ec
 
ts
)

341 
timevÆ
 
tv
;

342 
tv
.
tv_£c
 = 
ts
.tv_sec;

343 
tv
.
tv_u£c
 = 
ts
.
tv_n£c
 / 1000;

344  
tv
;

345 
	}
}

358 
ölöe
 
time•ec
 
	$timevÆ_to_time•ec
(
timevÆ
 
tv
)

360 
time•ec
 
ts
;

361 
ts
.
tv_£c
 = 
tv
.tv_sec;

362 
ts
.
tv_n£c
 = 
tv
.
tv_u£c
 * 1000;

363  
ts
;

364 
	}
}

	@ccan/ccan/timer/benchmarks/benchmark.c

1 
	~<cˇn/time/time.h
>

2 
	~<°döt.h
>

3 
	~<°dio.h
>

4 
	~<°dlib.h
>

6 #ifde‡
FIRST_APPROX


7 
	~"fú°-≠¥ox.c
"

9 #ifde‡
SECOND_APPROX


10 
	~"£c⁄d-≠¥ox.c
"

12 #ifde‡
NO_APPROX


13 
	~"no-≠¥ox.c
"

16 
	$maö
(
¨gc
, *
¨gv
[])

18 
time•ec
 
°¨t
, 
vÆ
, 
vÆ2
, 
íd
, 
diff
;

19 
i
, 
j
, 
limô
 = 
	`©oi
(
¨gv
[1] ?: "100000");

20 
uöt64_t
 
vÆ64
;

22 
vÆ
 = 
°¨t
 = 
	`time_now
();

23 
vÆ64
 = 
	`to_u64
(
°¨t
);

24 
vÆ2
.
tv_£c
 = 0;

25 
vÆ2
.
tv_n£c
 = 1;

27 
j
 = 0; j < 
limô
; j++) {

28 
i
 = 0; i < 
limô
; i++) {

29 
vÆ
 = 
	`time_add
(vÆ, 
vÆ2
);

30 
vÆ64
 +
	`to_u64
(
vÆ2
);

34 
íd
 = 
	`time_now
();

36 
	`¥ötf
("val64 says %lu.%09lu\n",

37 
	`‰om_u64
(
vÆ64
).
tv_£c
,

38 
	`‰om_u64
(
vÆ64
).
tv_n£c
);

40 
	`¥ötf
("val says %lu.%09lu\n",

41 
vÆ
.
tv_£c
,

42 
vÆ
.
tv_n£c
);

44 i‡(
	`time_gª©î
(
vÆ
, 
	`‰om_u64
(
vÆ64
)))

45 
diff
 = 
	`time_sub
(
vÆ
, 
	`‰om_u64
(
vÆ64
));

47 
diff
 = 
	`time_sub
(
	`‰om_u64
(
vÆ64
), 
vÆ
);

49 
	`¥ötf
("Time %lluns,Érror = %i%%\n",

50 ()
	`time_to_n£c
(
	`time_sub
(
íd
, 
°¨t
)),

51 ()(100 * 
	`time_to_n£c
(
diff
Ë/Åime_to_n£c(
	`time_sub
(
vÆ
, 
°¨t
))));

53 
	}
}

	@ccan/ccan/timer/benchmarks/expected-usage.c

5 
	~<cˇn/timî/timî.h
>

6 
	~<cˇn/›t/›t.h
>

7 
	~<cˇn/¨øy_size/¨øy_size.h
>

8 
	~<°dio.h
>

10 
	#PER_CONN_TIME
 8192

	)

11 
	#CONN_TIMEOUT_MS
 30000

	)

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
time•ec
 
°¨t
, 
cuº
;

16 
timîs
Åimers;

17 
li°_hód
 
expúed
;

18 
timî
 
t
[
PER_CONN_TIME
];

19 
i
, 
num
;

20 
boﬁ
 
check
 = 
Ál£
;

22 
	`›t_ªgi°î_nﬂrg
("-c|--check", 
›t_£t_boﬁ
, &
check
,

25 
	`›t_∑r£
(&
¨gc
, 
¨gv
, 
›t_log_°dîr_exô
);

27 
num
 = 
¨gv
[1] ? 
	`©oi
◊rgv[1]Ë: (
check
 ? 100000 : 100000000);

29 
	`li°_hód_öô
(&
expúed
);

30 
cuº
 = 
°¨t
 = 
	`time_now
();

31 
	`timîs_öô
(&
timîs
, 
°¨t
);

33 
i
 = 0; i < 
num
; i++) {

34 
cuº
 = 
	`time_add
(cuº, 
	`time_‰om_m£c
(1));

35 i‡(
check
)

36 
	`timîs_check
(&
timîs
, 
NULL
);

37 
	`timîs_expúe
(&
timîs
, 
cuº
, &
expúed
);

38 i‡(
check
)

39 
	`timîs_check
(&
timîs
, 
NULL
);

40 
	`as£π
(
	`li°_em±y
(&
expúed
));

42 i‡(
i
 >
PER_CONN_TIME
) {

43 
	`timî_dñ
(&
timîs
, &
t
[
i
%
PER_CONN_TIME
]);

44 i‡(
check
)

45 
	`timîs_check
(&
timîs
, 
NULL
);

47 
	`timî_add
(&
timîs
, &
t
[
i
%
PER_CONN_TIME
],

48 
	`time_add
(
cuº
, 
	`time_‰om_m£c
(
CONN_TIMEOUT_MS
)));

49 i‡(
check
)

50 
	`timîs_check
(&
timîs
, 
NULL
);

52 i‡(
num
 > 
PER_CONN_TIME
) {

53 
i
 = 0; i < 
PER_CONN_TIME
; i++)

54 
	`timî_dñ
(&
timîs
, &
t
[
i
]);

57 
cuº
 = 
	`time_sub
(
	`time_now
(), 
°¨t
);

58 i‡(
check
)

59 
	`timîs_check
(&
timîs
, 
NULL
);

60 
	`timîs_˛ónup
(&
timîs
);

61 
	`›t_‰ì_èbÀ
();

63 
i
 = 0; i < 
	`ARRAY_SIZE
(
timîs
.
Àvñ
); i++)

64 i‡(!
timîs
.
Àvñ
[
i
])

67 
	`¥ötf
("%u in %lu.%09lu (%uÜevels / %zu)\n",

68 
num
, ()
cuº
.
tv_£c
, cuº.
tv_n£c
,

69 
i
, 
	`ARRAY_SIZE
(
timîs
.
Àvñ
));

71 
	}
}

	@ccan/ccan/timer/test/run-add.c

1 
	~<cˇn/timî/timî.h
>

3 
	~<cˇn/timî/timî.c
>

4 
	~<cˇn/èp/èp.h
>

7 
	#MAX_ORD
 34

	)

10 
uöt64_t
 
	$√xt
(
uöt64_t
 
ba£
)

12 i‡(
ba£
 > 16 && ((base - 1) & ((base - 1) >> 1)) == 0)

13  
ba£
 * 2 - 3;

14  
ba£
+1;

15 
	}
}

17 
	$maö
()

19 
timîs
Åimers;

20 
timî
 
t
;

21 
uöt64_t
 
diff
;

22 
i
;

25 
	`∂™_ã°s
(2 + (18 + (
MAX_ORD
 - 4) * 3) * (18 + (MAX_ORD - 4) * 3));

27 
	`timîs_öô
(&
timîs
, 
	`time_‰om_n£c
(0));

28 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

30 
i
 = 0; i < 4; i++)

31 
	`add_Àvñ
(&
timîs
, 
i
);

33 
i
 = 0;

34 
diff
 = 0; dif‡< (1ULL << 
MAX_ORD
)+2; dif‡
	`√xt
(diff)) {

35 
i
++;

36 
timîs
.
ba£
 = 0;

37 
timîs
.
ba£
 < (1ULL << 
MAX_ORD
)+2;

38 
timîs
.
ba£
 = 
	`√xt
(timers.base)) {

39 
	`timî_add
(&
timîs
, &
t
, 
	`gøös_to_time
—imîs.
ba£
 + 
diff
));

40 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

41 
	`timî_dñ
(&
timîs
, &
t
);

45 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

47 
	`timîs_˛ónup
(&
timîs
);

50  
	`exô_°©us
();

51 
	}
}

	@ccan/ccan/timer/test/run-expiry.c

1 
	~<cˇn/timî/timî.h
>

3 
	~<cˇn/timî/timî.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 
timîs
Åimers;

9 
timî
 
t
;

10 
li°_hód
 
li°
;

13 
	`∂™_ã°s
(7);

15 
	`timîs_öô
(&
timîs
, 
	`gøös_to_time
(1364984760903400ULL));

16 
	`ok1
(
timîs
.
ba£
 == 1364984760903400ULL);

17 
	`timî_add
(&
timîs
, &
t
, 
	`gøös_to_time
(1364984761003398ULL));

18 
	`ok1
(
t
.
time
 == 1364984761003398ULL);

19 
	`ok1
(
timîs
.
fú°
 == 1364984761003398ULL);

20 
	`timîs_expúe
(&
timîs
, 
	`gøös_to_time
(1364984760903444ULL), &
li°
);

21 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

22 
	`ok1
(
	`li°_p›
(&
li°
, 
timî
,Üi°Ë=
NULL
);

23 
	`timîs_expúe
(&
timîs
, 
	`gøös_to_time
(1364984761002667ULL), &
li°
);

24 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

25 
	`ok1
(
	`li°_p›
(&
li°
, 
timî
,Üi°Ë=
NULL
);

27 
	`timîs_˛ónup
(&
timîs
);

30  
	`exô_°©us
();

31 
	}
}

	@ccan/ccan/timer/test/run-ff.c

1 
	~<cˇn/timî/timî.h
>

3 
	~<cˇn/timî/timî.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 
timîs
Åimers;

9 
timî
 
t
;

10 
li°_hód
 
expúed
;

13 
	`∂™_ã°s
(3);

15 
	`timîs_öô
(&
timîs
, 
	`time_‰om_u£c
(1364726722653919ULL));

16 
	`timî_add
(&
timîs
, &
t
, 
	`time_‰om_u£c
(1364726722703919ULL));

17 
	`timîs_expúe
(&
timîs
, 
	`time_‰om_u£c
(1364726722653920ULL), &
expúed
);

18 
	`ok1
(
	`li°_em±y
(&
expúed
));

19 
	`timîs_expúe
(&
timîs
, 
	`time_‰om_u£c
(1364726725454187ULL), &
expúed
);

20 
	`ok1
(!
	`li°_em±y
(&
expúed
));

21 
	`ok1
(
	`li°_t›
(&
expúed
, 
timî
, 
li°
Ë=&
t
);

23 
	`timîs_˛ónup
(&
timîs
);

26  
	`exô_°©us
();

27 
	}
}

	@ccan/ccan/timer/test/run.c

1 
	~<cˇn/timî/timî.h
>

3 
	~<cˇn/timî/timî.c
>

4 
	~<cˇn/èp/èp.h
>

6 
	$maö
()

8 
timîs
Åimers;

9 
timî
 
t
[64];

10 
li°_hód
 
expúed
;

11 
time•ec
 
óæõ°
;

12 
uöt64_t
 
i
;

15 
	`∂™_ã°s
(488);

17 
	`timîs_öô
(&
timîs
, 
	`time_‰om_n£c
(0));

18 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

19 
	`ok1
(!
	`timî_óæõ°
(&
timîs
, &
óæõ°
));

21 
	`timî_add
(&
timîs
, &
t
[0], 
	`time_‰om_n£c
(1));

22 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

23 
	`ok1
(
	`timî_óæõ°
(&
timîs
, &
óæõ°
));

24 
	`ok1
(
	`time_eq
(
óæõ°
, 
	`gøös_to_time
(
t
[0].
time
)));

25 
	`timî_dñ
(&
timîs
, &
t
[0]);

26 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

27 
	`ok1
(!
	`timî_óæõ°
(&
timîs
, &
óæõ°
));

30 
i
 = 0; i < 32; i++) {

31 
	`timî_add
(&
timîs
, &
t
[
i
*2], 
	`time_‰om_n£c
(1ULL << i));

32 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

33 
	`timî_add
(&
timîs
, &
t
[
i
*2+1], 
	`time_‰om_n£c
((1ULL << i) + 1));

34 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

37 
i
 = 0; i < 32; i++) {

38 c⁄° 
timî
 *
t1
, *
t2
;

40 
t1
 = 
	`gë_fú°
(&
timîs
);

41 
	`ok1
(
t1
 =&
t
[
i
*2] ||Å1 == &t[i*2+1]);

42 
	`timî_dñ
(&
timîs
, (
timî
 *)
t1
);

43 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

45 
t2
 = 
	`gë_fú°
(&
timîs
);

46 
	`ok1
(
t2
 !
t1
 && (t2 =&
t
[
i
*2] ||Å2 == &t[i*2+1]));

47 
	`timî_dñ
(&
timîs
, (
timî
 *)
t2
);

48 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

52 
i
 = 0; i < 32; i++) {

53 
uöt64_t
 
exp
 = (uöt64_t)
TIMER_GRANULARITY
 << 
i
;

55 
	`timî_add
(&
timîs
, &
t
[
i
*2], 
	`time_‰om_n£c
(
exp
));

56 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

57 
	`timî_add
(&
timîs
, &
t
[
i
*2+1], 
	`time_‰om_n£c
(
exp
 + 1));

58 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

61 
i
 = 0; i < 32; i++) {

62 
timî
 *
t1
, *
t2
;

64 
	`ok1
(
	`timî_óæõ°
(&
timîs
, &
óæõ°
));

65 
	`timîs_expúe
(&
timîs
, 
óæõ°
, &
expúed
);

67 
t1
 = 
	`li°_p›
(&
expúed
, 
timî
, 
li°
);

68 
	`ok1
(
t1
);

69 
t2
 = 
	`li°_p›
(&
expúed
, 
timî
, 
li°
);

70 
	`ok1
(
t2
);

71 
	`ok1
(
	`li°_em±y
(&
expúed
));

73 
	`ok1
(
t1
 =&
t
[
i
*2] ||Å1 == &t[i*2+1]);

74 
	`ok1
(
t2
 !
t1
 && (t2 =&
t
[
i
*2] ||Å2 == &t[i*2+1]));

75 
	`ok1
(
	`timîs_check
(&
timîs
, 
NULL
));

78 
	`ok1
(!
	`timî_óæõ°
(&
timîs
, &
óæõ°
));

80 
	`timîs_˛ónup
(&
timîs
);

83  
	`exô_°©us
();

84 
	}
}

	@ccan/ccan/timer/timer.c

2 
	~<cˇn/timî/timî.h
>

3 
	~<cˇn/¨øy_size/¨øy_size.h
>

4 
	~<cˇn/ûog/ûog.h
>

5 
	~<cˇn/likñy/likñy.h
>

6 
	~<°dlib.h
>

7 
	~<°dio.h
>

9 
	#PER_LEVEL
 (1ULL << 
TIMER_LEVEL_BITS
)

	)

11 
	stimî_Àvñ
 {

12 
li°_hód
 
	mli°
[
PER_LEVEL
];

15 
uöt64_t
 
	$time_to_gøös
(
time•ec
 
ts
)

17  
ts
.
tv_£c
 * ((
uöt64_t
)1000000000 / 
TIMER_GRANULARITY
)

18 + (
ts
.
tv_n£c
 / 
TIMER_GRANULARITY
);

19 
	}
}

21 
time•ec
 
	$gøös_to_time
(
uöt64_t
 
gøös
)

23 
time•ec
 
ts
;

25 
ts
.
tv_£c
 = 
gøös
 / (1000000000 / 
TIMER_GRANULARITY
);

26 
ts
.
tv_n£c
 = (
gøös
 % (1000000000 / 
TIMER_GRANULARITY
))

27 * 
TIMER_GRANULARITY
;

28  
ts
;

29 
	}
}

31 
	$timîs_öô
(
timîs
 *timîs, 
time•ec
 
°¨t
)

33 
i
;

35 
	`li°_hód_öô
(&
timîs
->
Ár
);

36 
timîs
->
ba£
 = 
	`time_to_gøös
(
°¨t
);

37 
timîs
->
fú°
 = -1ULL;

38 
i
 = 0; i < 
	`ARRAY_SIZE
(
timîs
->
Àvñ
); i++)

39 
timîs
->
Àvñ
[
i
] = 
NULL
;

40 
	}
}

42 
	$Àvñ_of
(c⁄° 
timîs
 *timîs, 
uöt64_t
 
time
)

44 
uöt64_t
 
diff
;

47 
diff
 = 
time
 - 
timîs
->
ba£
;

48  
	`ûog64
(
diff
 / 2Ë/ 
TIMER_LEVEL_BITS
;

49 
	}
}

51 
	$timî_add_øw
(
timîs
 *timîs, 
timî
 *
t
)

53 
li°_hód
 *
l
;

54 
Àvñ
 = 
	`Àvñ_of
(
timîs
, 
t
->
time
);

56 i‡(!
timîs
->
Àvñ
[level])

57 
l
 = &
timîs
->
Ár
;

59 
off
 = (
t
->
time
 >> (
Àvñ
*
TIMER_LEVEL_BITS
)Ë& (
PER_LEVEL
-1);

60 
l
 = &
timîs
->
Àvñ
[Àvñ]->
li°
[
off
];

63 
	`li°_add_èû
(
l
, &
t
->
li°
);

64 
	}
}

66 
	$timî_add
(
timîs
 *timîs, 
timî
 *
t
, 
time•ec
 
whí
)

68 
t
->
time
 = 
	`time_to_gøös
(
whí
);

71 i‡(
t
->
time
 < 
timîs
->
ba£
)

72 
t
->
time
 = 
timîs
->
ba£
;

73 i‡(
t
->
time
 < 
timîs
->
fú°
)

74 
timîs
->
fú°
 = 
t
->
time
;

76 
	`timî_add_øw
(
timîs
, 
t
);

77 
	}
}

80 
	$timî_dñ
(
timîs
 *timîs, 
timî
 *
t
)

82 
	`li°_dñ
(&
t
->
li°
);

83 
	}
}

85 
	$timîs_Ár_gë
(
timîs
 *timers,

86 
li°_hód
 *
li°
,

87 
uöt64_t
 
whí
)

89 
timî
 *
i
, *
√xt
;

91 
	`li°_f‹_óch_ß„
(&
timîs
->
Ár
, 
i
, 
√xt
, 
li°
) {

92 i‡(
i
->
time
 <
whí
) {

93 
	`li°_dñ_‰om
(&
timîs
->
Ár
, &
i
->
li°
);

94 
	`li°_add_èû
(
li°
, &
i
->list);

97 
	}
}

99 
	$add_Àvñ
(
timîs
 *timîs, 
Àvñ
)

101 
timî_Àvñ
 *
l
;

102 
timî
 *
t
;

103 
i
;

104 
li°_hód
 
‰om_Ár
;

106 
l
 = 
	`mÆloc
((*l));

107 i‡(!
l
)

110 
i
 = 0; i < 
	`ARRAY_SIZE
(
l
->
li°
); i++)

111 
	`li°_hód_öô
(&
l
->
li°
[
i
]);

112 
timîs
->
Àvñ
[Àvñ] = 
l
;

114 
	`li°_hód_öô
(&
‰om_Ár
);

115 
	`timîs_Ár_gë
(
timîs
, &
‰om_Ár
,

116 
timîs
->
ba£
 + (1ULL << ((
Àvñ
+1)*
TIMER_LEVEL_BITS
)) - 1);

118 (
t
 = 
	`li°_p›
(&
‰om_Ár
, 
timî
, 
li°
)Ë!
NULL
)

119 
	`timî_add_øw
(
timîs
, 
t
);

120 
	}
}

122 c⁄° 
timî
 *
	$föd_fú°
(c⁄° 
li°_hód
 *
li°
,

123 c⁄° 
timî
 *
¥ev
)

125 
timî
 *
t
;

127 
	`li°_f‹_óch
(
li°
, 
t
,Üist) {

128 i‡(!
¥ev
 || 
t
->
time
 <Örev->time)

129 
¥ev
 = 
t
;

131  
¥ev
;

132 
	}
}

134 c⁄° 
timî
 *
	$gë_fú°
(c⁄° 
timîs
 *timers)

136 
Àvñ
, 
i
, 
off
;

137 
boﬁ
 
√ed_√xt
;

138 
uöt64_t
 
ba£
;

139 c⁄° 
timî
 *
found
 = 
NULL
;

140 
li°_hód
 *
h
;

142 i‡(
timîs
->
fú°
 <Åimîs->
ba£
) {

143 
ba£
 = 
timîs
->base;

144 
Àvñ
 = 0;

147 
Àvñ
 = 
	`Àvñ_of
(
timîs
,Åimîs->
fú°
);

148 
ba£
 = 
timîs
->
fú°
 >> (
TIMER_LEVEL_BITS
 * 
Àvñ
);

151 
√xt
:

152 i‡(!
timîs
->
Àvñ
[level])

153  
	`föd_fú°
(&
timîs
->
Ár
, 
NULL
);

155 
√ed_√xt
 = 
Ál£
;

156 
off
 = 
ba£
 % 
PER_LEVEL
;

157 
i
 = 0; i < 
PER_LEVEL
; i++) {

158 
h
 = &
timîs
->
Àvñ
[Àvñ]->
li°
[(
i
+
off
Ë% 
PER_LEVEL
];

160 i‡(!
	`li°_em±y
(
h
))

165 i‡(
i
 + 
off
 =
PER_LEVEL
)

166 
√ed_√xt
 = 
åue
;

168 i‡(
i
 =
PER_LEVEL
) {

169 
Àvñ
++;

170 
ba£
 >>
TIMER_LEVEL_BITS
;

171 
√xt
;

175 i‡(
Àvñ
 == 0)

176 
found
 = 
	`li°_t›
(
h
, 
timî
, 
li°
);

178 
found
 = 
	`föd_fú°
(
h
, 
NULL
);

180 i‡(
√ed_√xt
) {

181 i‡(!
timîs
->
Àvñ
[level+1]) {

182 
found
 = 
	`föd_fú°
(&
timîs
->
Ár
, found);

184 
ba£
 >>
TIMER_LEVEL_BITS
;

185 
off
 = 
ba£
 % 
PER_LEVEL
;

186 
h
 = &
timîs
->
Àvñ
[Àvñ+1]->
li°
[
off
];

187 
found
 = 
	`föd_fú°
(
h
, found);

190  
found
;

191 
	}
}

193 
boﬁ
 
	$upd©e_fú°
(
timîs
 *timers)

195 c⁄° 
timî
 *
found
 = 
	`gë_fú°
(
timîs
);

197 i‡(!
found
) {

198 
timîs
->
fú°
 = -1ULL;

199  
Ál£
;

202 
timîs
->
fú°
 = 
found
->
time
;

203  
åue
;

204 
	}
}

206 
boﬁ
 
	$timî_óæõ°
(
timîs
 *timîs, 
time•ec
 *
fú°
)

208 i‡(!
	`upd©e_fú°
(
timîs
))

209  
Ál£
;

211 *
fú°
 = 
	`gøös_to_time
(
timîs
->first);

212  
åue
;

213 
	}
}

216 
	$timî_Á°_f‹w¨d
(
timîs
 *timîs, 
uöt64_t
 
time
)

218 
Àvñ
, 
ch™ged
;

219 
√ed_Àvñ
 = -1;

220 
li°_hód
 
li°
;

221 
timî
 *
i
;

225 i‡(
time
 =
timîs
->
ba£
)

228 
ch™ged
 = 
	`ûog64_nz
(
time
 ^ 
timîs
->
ba£
);

229 
Àvñ
 = (
ch™ged
 - 1Ë/ 
TIMER_LEVEL_BITS
;

233 
	`li°_hód_öô
(&
li°
);

236 i‡(!
timîs
->
Àvñ
[level]) {

238 
	`timîs_Ár_gë
(
timîs
, &
li°
,

239 
timîs
->
ba£


240 + (1ULL << ((
Àvñ
+1)*
TIMER_LEVEL_BITS
))-1);

241 
√ed_Àvñ
 = 
Àvñ
;

243 
§c
;

246 
§c
 = (
time
 >> (
Àvñ
 * 
TIMER_LEVEL_BITS
)Ë% 
PER_LEVEL
;

247 
	`li°_≠≥nd_li°
(&
li°
,

248 &
timîs
->
Àvñ
[Àvñ]->
li°
[
§c
]);

250 } 
Àvñ
--);

253 i‡(
√ed_Àvñ
 != -1)

254 
	`add_Àvñ
(
timîs
, 
√ed_Àvñ
);

257 
timîs
->
ba£
 = 
time
;

258 (
i
 = 
	`li°_p›
(&
li°
, 
timî
,Üi°)Ë!
NULL
)

259 
	`timî_add_øw
(
timîs
, 
i
);

260 
	}
}

263 
	$timîs_expúe
(
timîs
 *timers,

264 
time•ec
 
expúe
,

265 
li°_hód
 *
li°
)

267 
uöt64_t
 
now
 = 
	`time_to_gøös
(
expúe
);

268 
off
;

270 
	`as£π
(
now
 >
timîs
->
ba£
);

272 
	`li°_hód_öô
(
li°
);

274 i‡(!
timîs
->
Àvñ
[0]) {

275 i‡(
	`li°_em±y
(&
timîs
->
Ár
))

277 
	`add_Àvñ
(
timîs
, 0);

281 i‡(
timîs
->
fú°
 > 
now
) {

282 
	`timî_Á°_f‹w¨d
(
timîs
, 
now
);

286 
	`timî_Á°_f‹w¨d
(
timîs
,Åimîs->
fú°
);

287 
off
 = 
timîs
->
ba£
 % 
PER_LEVEL
;

289 
	`li°_≠≥nd_li°
(
li°
, &
timîs
->
Àvñ
[0]->li°[
off
]);

290 i‡(
timîs
->
ba£
 =
now
)

292 } 
	`upd©e_fú°
(
timîs
));

293 
	}
}

295 
boﬁ
 
	$timî_li°_check
(c⁄° 
li°_hód
 *
l
,

296 
uöt64_t
 
mö
, uöt64_à
max
, uöt64_à
fú°
,

297 c⁄° *
ab‹t°r
)

299 c⁄° 
timî
 *
t
;

301 i‡(!
	`li°_check
(
l
, 
ab‹t°r
))

302  
Ál£
;

304 
	`li°_f‹_óch
(
l
, 
t
, 
li°
) {

305 i‡(
t
->
time
 < 
mö
 ||Å->timê> 
max
) {

306 i‡(
ab‹t°r
) {

307 
	`Ârötf
(
°dîr
,

309 
ab‹t°r
, 
t
,Å->
time
, 
mö
, 
max
);

310 
	`ab‹t
();

312  
Ál£
;

314 i‡(
t
->
time
 < 
fú°
) {

315 i‡(
ab‹t°r
) {

316 
	`Ârötf
(
°dîr
,

318 
ab‹t°r
, 
t
,Å->
time
, 
fú°
);

319 
	`ab‹t
();

321  
Ál£
;

324  
åue
;

325 
	}
}

327 
timîs
 *
	$timîs_check
(c⁄° 
timîs
 *timîs, c⁄° *
ab‹t°r
)

329 
l
, 
i
, 
off
;

330 
uöt64_t
 
ba£
;

332 
l
 = 0;

333 i‡(!
timîs
->
Àvñ
[0])

334 
∑°_Àvñs
;

337 
off
 = 
timîs
->
ba£
 % 
PER_LEVEL
;

338 
i
 = 0; i < 
PER_LEVEL
; i++) {

339 
li°_hód
 *
h
;

341 
h
 = &
timîs
->
Àvñ
[
l
]->
li°
[(
i
+
off
Ë% 
PER_LEVEL
];

342 i‡(!
	`timî_li°_check
(
h
, 
timîs
->
ba£
 + 
i
,Åimers->base + i,

343 
timîs
->
fú°
, 
ab‹t°r
))

344  
NULL
;

349 
l
 = 1; 
timîs
->
Àvñ
[l] &&Ü < 
PER_LEVEL
;Ü++) {

350 
uöt64_t
 
≥r_buckë
 = 1ULL << (
TIMER_LEVEL_BITS
 * 
l
);

352 
off
 = ((
timîs
->
ba£
 >> (
l
*
TIMER_LEVEL_BITS
)Ë% 
PER_LEVEL
);

354 
ba£
 = (
timîs
->ba£ & ~(
≥r_buckë
 - 1)) +Öer_bucket;

356 
i
 = 1; i <
PER_LEVEL
; i++) {

357 
li°_hód
 *
h
;

359 
h
 = &
timîs
->
Àvñ
[
l
]->
li°
[(
i
+
off
Ë% 
PER_LEVEL
];

360 i‡(!
	`timî_li°_check
(
h
, 
ba£
, ba£ + 
≥r_buckë
 - 1,

361 
timîs
->
fú°
, 
ab‹t°r
))

362  
NULL
;

363 
ba£
 +
≥r_buckë
;

367 
∑°_Àvñs
:

368 
ba£
 = (
timîs
->ba£ & ~((1ULL << (
TIMER_LEVEL_BITS
 * 
l
)) - 1))

369 + (1ULL << (
TIMER_LEVEL_BITS
 * 
l
)) - 1;

370 i‡(!
	`timî_li°_check
(&
timîs
->
Ár
, 
ba£
, -1ULL,Åimîs->
fú°
,

371 
ab‹t°r
))

372  
NULL
;

374  (
timîs
 *)timers;

375 
	}
}

377 #ifde‡
CCAN_TIMER_DEBUG


378 
	$timîs_dump
(c⁄° 
timîs
 *timîs, 
FILE
 *
Â
)

380 
l
, 
i
;

381 
uöt64_t
 
mö
, 
max
, 
num
;

382 
timî
 *
t
;

384 i‡(!
Â
)

385 
Â
 = 
°dîr
;

387 
	`Ârötf
(
Â
, "Ba£: %Œu\n", 
timîs
->
ba£
);

389 
l
 = 0; 
timîs
->
Àvñ
[l] &&Ü < 
	`ARRAY_SIZE
(timers->level);Ü++) {

390 
	`Ârötf
(
Â
, "Level %i (+%llu):\n",

391 
l
, (
uöt64_t
)1 << (
TIMER_LEVEL_BITS
 *Ü));

392 
i
 = 0; i < (1 << 
TIMER_LEVEL_BITS
); i++) {

394 i‡(
	`li°_em±y
(&
timîs
->
Àvñ
[
l
]->
li°
[
i
]))

396 
mö
 = -1ULL;

397 
max
 = 0;

398 
num
 = 0;

399 
	`li°_f‹_óch
(&
timîs
->
Àvñ
[
l
]->
li°
[
i
], 
t
,Üist) {

400 i‡(
t
->
time
 < 
mö
)

401 
mö
 = 
t
->
time
;

402 i‡(
t
->
time
 > 
max
)

403 
max
 = 
t
->
time
;

404 
num
++;

406 
	`Ârötf
(
°dîr
, " %llu (+%llu-+%llu)\n",

407 
num
, 
mö
 - 
timîs
->
ba£
, 
max
 -Åimers->base);

411 
mö
 = -1ULL;

412 
max
 = 0;

413 
num
 = 0;

414 
	`li°_f‹_óch
(&
timîs
->
Ár
, 
t
, 
li°
) {

415 i‡(
t
->
time
 < 
mö
)

416 
mö
 = 
t
->
time
;

417 i‡(
t
->
time
 > 
max
)

418 
max
 = 
t
->
time
;

419 
num
++;

421 
	`Ârötf
(
°dîr
, "F¨: %Œu (%Œu-%Œu)\n", 
num
, 
mö
, 
max
);

422 
	}
}

425 
	$timîs_˛ónup
(
timîs
 *timers)

427 
l
;

429 
l
 = 0;Ü < 
	`ARRAY_SIZE
(
timîs
->
Àvñ
);Ü++)

430 
	`‰ì
(
timîs
->
Àvñ
[
l
]);

431 
	}
}

	@ccan/ccan/timer/timer.h

2 #i‚de‡
CCAN_TIMER_H


3 
	#CCAN_TIMER_H


	)

4 
	~<cˇn/time/time.h
>

5 
	~<cˇn/li°/li°.h
>

6 
	~<°döt.h
>

8 #i‚de‡
TIMER_GRANULARITY


10 
	#TIMER_GRANULARITY
 1000

	)

13 #i‚de‡
TIMER_LEVEL_BITS


15 
	#TIMER_LEVEL_BITS
 5

	)

18 
	gtimîs
;

19 
	gtimî
;

34 
timîs_öô
(
timîs
 *timîs, 
time•ec
 
°¨t
);

45 
timîs_˛ónup
(
timîs
 *timers);

62 
timî_add
(
timîs
 *timîs, 
timî
 *timer,

63 
time•ec
 
whí
);

75 
timî_dñ
(
timîs
 *timîs, 
timî
 *timer);

90 
boﬁ
 
timî_óæõ°
(
timîs
 *timîs, 
time•ec
 *
fú°
);

116 
timîs_expúe
(
timîs
 *timers,

117 
time•ec
 
expúe
,

118 
li°_hód
 *
li°
);

136 
timîs
 *
timîs_check
(c⁄° timî†*
t
, c⁄° *
ab‹t°r
);

138 #ifde‡
CCAN_TIMER_DEBUG


139 
	~<°dio.h
>

146 
timîs_dump
(c⁄° 
timîs
 *timîs, 
FILE
 *
Â
);

158 
	stimîs
 {

160 
li°_hód
 
	mÁr
;

161 
uöt64_t
 
	mba£
;

162 
uöt64_t
 
	mfú°
;

164 
timî_Àvñ
 *
	mÀvñ
[(64 + 
TIMER_LEVEL_BITS
-1) / TIMER_LEVEL_BITS];

176 
	stimî
 {

177 
li°_node
 
	mli°
;

178 
uöt64_t
 
	mtime
;

	@ccan/ccan/tlist/test/compile_fail-tlist_add.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

4 
TLIST_TYPE
(
cousös
, 
cousö
);

6 
	schûd
 {

7 c⁄° *
	m«me
;

8 
li°_node
 
	mli°
;

11 
	scousö
 {

12 c⁄° *
	m«me
;

13 
li°_node
 
	mli°
;

16 
	$maö
(
¨gc
, *
¨gv
[])

18 
éi°_chûdªn
 
chûdªn
;

19 
éi°_cousös
 
cousös
;

20 
chûd
 child = { "child" };

21 
cousö
 cousin = { "cousin" };

23 
	`éi°_öô
(&
chûdªn
);

24 
	`éi°_öô
(&
cousös
);

25 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

26 
	`éi°_add
(&
cousös
, &
cousö
, 
li°
);

27 
	`éi°_dñ_‰om
(&
cousös
, &
cousö
, 
li°
);

28 #ifde‡
FAIL


29 #i‡!
HAVE_FLEXIBLE_ARRAY_MEMBER


30 #îr‹ 
Nìd
 
ÊexibÀ
 
¨øy
 
membîs
 
to
 
check
 
ty≥


32 
	`éi°_add
(&
chûdªn
, &
cousö
, 
li°
);

35 
	}
}

	@ccan/ccan/tlist/test/compile_fail-tlist_add_tail.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

4 
TLIST_TYPE
(
cousös
, 
cousö
);

6 
	schûd
 {

7 c⁄° *
	m«me
;

8 
li°_node
 
	mli°
;

11 
	scousö
 {

12 c⁄° *
	m«me
;

13 
li°_node
 
	mli°
;

16 
	$maö
(
¨gc
, *
¨gv
[])

18 
éi°_chûdªn
 
chûdªn
;

19 
éi°_cousös
 
cousös
;

20 
chûd
 child = { "child" };

21 
cousö
 cousin = { "cousin" };

23 
	`éi°_öô
(&
chûdªn
);

24 
	`éi°_öô
(&
cousös
);

25 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

26 
	`éi°_add
(&
cousös
, &
cousö
, 
li°
);

27 
	`éi°_dñ_‰om
(&
cousös
, &
cousö
, 
li°
);

28 #ifde‡
FAIL


29 #i‡!
HAVE_FLEXIBLE_ARRAY_MEMBER


30 #îr‹ 
Nìd
 
ÊexibÀ
 
¨øy
 
membîs
 
to
 
check
 
ty≥


32 
	`éi°_add_èû
(&
chûdªn
, &
cousö
, 
li°
);

35 
	}
}

	@ccan/ccan/tlist/test/compile_fail-tlist_del_from.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

4 
TLIST_TYPE
(
cousös
, 
cousö
);

6 
	schûd
 {

7 c⁄° *
	m«me
;

8 
li°_node
 
	mli°
;

11 
	scousö
 {

12 c⁄° *
	m«me
;

13 
li°_node
 
	mli°
;

16 
	$maö
(
¨gc
, *
¨gv
[])

18 
éi°_chûdªn
 
chûdªn
;

19 
éi°_cousös
 
cousös
;

20 
chûd
 child = { "child" };

21 
cousö
 cousin = { "cousin" };

23 
	`éi°_öô
(&
chûdªn
);

24 
	`éi°_öô
(&
cousös
);

25 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

26 
	`éi°_add
(&
cousös
, &
cousö
, 
li°
);

27 #ifde‡
FAIL


28 #i‡!
HAVE_FLEXIBLE_ARRAY_MEMBER


29 #îr‹ 
Nìd
 
ÊexibÀ
 
¨øy
 
membîs
 
to
 
check
 
ty≥


31 
	`éi°_dñ_‰om
(&
chûdªn
, &
cousö
, 
li°
);

34 
	}
}

	@ccan/ccan/tlist/test/compile_fail-tlist_for_each.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

5 
	schûd
 {

6 c⁄° *
	m«me
;

7 
li°_node
 
	mli°
;

10 
	scousö
 {

11 c⁄° *
	m«me
;

12 
li°_node
 
	mli°
;

15 
	$maö
(
¨gc
, *
¨gv
[])

17 
éi°_chûdªn
 
chûdªn
;

18 
chûd
 child = { "child" };

19 #ifde‡
FAIL


20 #i‡!
HAVE_FLEXIBLE_ARRAY_MEMBER


21 #îr‹ 
Nìd
 
ÊexibÀ
 
¨øy
 
membîs
 
to
 
check
 
ty≥


23 
cousö
 *
c
;

25 
chûd
 *
c
;

28 
	`éi°_öô
(&
chûdªn
);

29 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

31 
	`éi°_f‹_óch
(&
chûdªn
, 
c
, 
li°
)

32 (Ë
c
;

34 
	}
}

	@ccan/ccan/tlist/test/compile_fail-tlist_for_each_safe.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

5 
	schûd
 {

6 c⁄° *
	m«me
;

7 
li°_node
 
	mli°
;

10 
	scousö
 {

11 c⁄° *
	m«me
;

12 
li°_node
 
	mli°
;

15 
	$maö
(
¨gc
, *
¨gv
[])

17 
éi°_chûdªn
 
chûdªn
;

18 
chûd
 child = { "child" };

19 #ifde‡
FAIL


20 #i‡!
HAVE_FLEXIBLE_ARRAY_MEMBER


21 #îr‹ 
Nìd
 
ÊexibÀ
 
¨øy
 
membîs
 
to
 
check
 
ty≥


23 
cousö
 *
c
, *
n
;

25 
chûd
 *
c
, *
n
;

28 
	`éi°_öô
(&
chûdªn
);

29 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

31 
	`éi°_f‹_óch_ß„
(&
chûdªn
, 
c
, 
n
, 
li°
);

33 
	}
}

	@ccan/ccan/tlist/test/compile_fail-tlist_tail.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

5 
	schûd
 {

6 c⁄° *
	m«me
;

7 
li°_node
 
	mli°
;

10 
	scousö
 {

11 c⁄° *
	m«me
;

12 
li°_node
 
	mli°
;

15 
	$maö
(
¨gc
, *
¨gv
[])

17 
éi°_chûdªn
 
chûdªn
;

18 
chûd
 child = { "child" };

19 #ifde‡
FAIL


20 
cousö
 *
c
;

22 
chûd
 *
c
;

25 
	`éi°_öô
(&
chûdªn
);

26 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

28 
c
 = 
	`éi°_èû
(&
chûdªn
, 
li°
);

29 (Ë
c
;

31 
	}
}

	@ccan/ccan/tlist/test/compile_fail-tlist_top.c

1 
	~<cˇn/éi°/éi°.h
>

3 
TLIST_TYPE
(
chûdªn
, 
chûd
);

5 
	schûd
 {

6 c⁄° *
	m«me
;

7 
li°_node
 
	mli°
;

10 
	scousö
 {

11 c⁄° *
	m«me
;

12 
li°_node
 
	mli°
;

15 
	$maö
(
¨gc
, *
¨gv
[])

17 
éi°_chûdªn
 
chûdªn
;

18 
chûd
 child = { "child" };

19 #ifde‡
FAIL


20 
cousö
 *
c
;

22 
chûd
 *
c
;

25 
	`éi°_öô
(&
chûdªn
);

26 
	`éi°_add
(&
chûdªn
, &
chûd
, 
li°
);

28 
c
 = 
	`éi°_t›
(&
chûdªn
, 
li°
);

29 (Ë
c
;

31 
	}
}

	@ccan/ccan/tlist/test/run.c

1 
	#CCAN_LIST_DEBUG
 1

	)

2 
	~<cˇn/éi°/éi°.h
>

3 
	~<cˇn/èp/èp.h
>

5 
TLIST_TYPE
(
chûdªn
, 
chûd
);

7 
	s∑ª¡
 {

8 c⁄° *
	m«me
;

9 
éi°_chûdªn
 
	mchûdªn
;

10 
	mnum_chûdªn
;

13 
	schûd
 {

14 c⁄° *
	m«me
;

15 
li°_node
 
	mli°
;

18 
	$maö
(
¨gc
, *
¨gv
[])

20 
∑ª¡
Öarent;

21 
chûd
 
c1
, 
c2
, 
c3
, *
c
, *
n
;

22 
i
;

23 
éi°_chûdªn
 
éi°
 = 
	`TLIST_INIT
(tlist);

25 
	`∂™_ã°s
(48);

27 
	`ok1
(
	`éi°_em±y
(&
éi°
));

28 
	`ok1
(
	`éi°_check
(&
éi°
, 
NULL
));

30 
∑ª¡
.
num_chûdªn
 = 0;

31 
	`éi°_öô
(&
∑ª¡
.
chûdªn
);

33 
	`ok1
(
	`éi°_em±y
(&
∑ª¡
.
chûdªn
));

34 
	`ok1
(
	`éi°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

36 
c2
.
«me
 = "c2";

37 
	`éi°_add
(&
∑ª¡
.
chûdªn
, &
c2
, 
li°
);

39 
	`ok1
(!
	`éi°_em±y
(&
∑ª¡
.
chûdªn
));

40 
	`ok1
(
c2
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
øw
.
n
);

41 
	`ok1
(
c2
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
øw
.
n
);

42 
	`ok1
(
∑ª¡
.
chûdªn
.
øw
.
n
.
√xt
 =&
c2
.
li°
);

43 
	`ok1
(
∑ª¡
.
chûdªn
.
øw
.
n
.
¥ev
 =&
c2
.
li°
);

45 
	`ok1
(
	`éi°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

47 
c1
.
«me
 = "c1";

48 
	`éi°_add
(&
∑ª¡
.
chûdªn
, &
c1
, 
li°
);

50 
	`ok1
(!
	`éi°_em±y
(&
∑ª¡
.
chûdªn
));

51 
	`ok1
(
c2
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
øw
.
n
);

52 
	`ok1
(
c2
.
li°
.
¥ev
 =&
c1
.list);

53 
	`ok1
(
∑ª¡
.
chûdªn
.
øw
.
n
.
√xt
 =&
c1
.
li°
);

54 
	`ok1
(
∑ª¡
.
chûdªn
.
øw
.
n
.
¥ev
 =&
c2
.
li°
);

55 
	`ok1
(
c1
.
li°
.
√xt
 =&
c2
.list);

56 
	`ok1
(
c1
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
øw
.
n
);

58 
	`ok1
(
	`éi°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

60 
c3
.
«me
 = "c3";

61 
	`éi°_add_èû
(&
∑ª¡
.
chûdªn
, &
c3
, 
li°
);

63 
	`ok1
(!
	`éi°_em±y
(&
∑ª¡
.
chûdªn
));

64 
	`ok1
(
∑ª¡
.
chûdªn
.
øw
.
n
.
√xt
 =&
c1
.
li°
);

65 
	`ok1
(
∑ª¡
.
chûdªn
.
øw
.
n
.
¥ev
 =&
c3
.
li°
);

66 
	`ok1
(
c1
.
li°
.
√xt
 =&
c2
.list);

67 
	`ok1
(
c1
.
li°
.
¥ev
 =&
∑ª¡
.
chûdªn
.
øw
.
n
);

68 
	`ok1
(
c2
.
li°
.
√xt
 =&
c3
.list);

69 
	`ok1
(
c2
.
li°
.
¥ev
 =&
c1
.list);

70 
	`ok1
(
c3
.
li°
.
√xt
 =&
∑ª¡
.
chûdªn
.
øw
.
n
);

71 
	`ok1
(
c3
.
li°
.
¥ev
 =&
c2
.list);

73 
	`ok1
(
	`éi°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

76 
	`ok1
(
	`éi°_t›
(&
∑ª¡
.
chûdªn
, 
li°
Ë=&
c1
);

79 
	`ok1
(
	`éi°_èû
(&
∑ª¡
.
chûdªn
, 
li°
Ë=&
c3
);

82 
i
 = 0;

83 
	`éi°_f‹_óch
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
) {

84 
i
++) {

86 
	`ok1
(
c
 =&
c1
);

89 
	`ok1
(
c
 =&
c2
);

92 
	`ok1
(
c
 =&
c3
);

95 i‡(
i
 > 2)

98 
	`ok1
(
i
 == 3);

101 
i
 = 0;

102 
	`éi°_f‹_óch_ªv
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
) {

103 
i
++) {

105 
	`ok1
(
c
 =&
c3
);

108 
	`ok1
(
c
 =&
c2
);

111 
	`ok1
(
c
 =&
c1
);

114 i‡(
i
 > 2)

117 
	`ok1
(
i
 == 3);

120 
i
 = 0;

121 
	`éi°_f‹_óch_ß„
(&
∑ª¡
.
chûdªn
, 
c
, 
n
, 
li°
) {

122 
i
++) {

124 
	`ok1
(
c
 =&
c1
);

125 
	`éi°_dñ
(
c
, 
li°
);

128 
	`ok1
(
c
 =&
c2
);

129 
	`éi°_dñ_‰om
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
);

132 
	`ok1
(
c
 =&
c3
);

133 
	`éi°_dñ_‰om
(&
∑ª¡
.
chûdªn
, 
c
, 
li°
);

136 
	`ok1
(
	`éi°_check
(&
∑ª¡
.
chûdªn
, 
NULL
));

137 i‡(
i
 > 2)

140 
	`ok1
(
i
 == 3);

141 
	`ok1
(
	`éi°_em±y
(&
∑ª¡
.
chûdªn
));

144 
	`ok1
(
	`éi°_t›
(&
∑ª¡
.
chûdªn
, 
li°
Ë=(
chûd
 *)
NULL
);

145 
	`ok1
(
	`éi°_èû
(&
∑ª¡
.
chûdªn
, 
li°
Ë=(
chûd
 *)
NULL
);

146  
	`exô_°©us
();

147 
	}
}

	@ccan/ccan/tlist/tlist.h

2 #i‚de‡
CCAN_TLIST_H


3 
	#CCAN_TLIST_H


	)

4 
	~<cˇn/li°/li°.h
>

5 
	~<cˇn/tc⁄/tc⁄.h
>

30 
	#TLIST_TYPE
(
suffix
, 
ty≥
) \

31 
éi°_
##
suffix
 { \

32 
li°_hód
 
øw
; \

33 
	`TCON
(
ty≥
 *
ˇ«ry
); \

34 }

	)

48 
	#TLIST_INIT
(
«me
Ë{ 
	`LIST_HEAD_INIT
“ame.
øw
Ë}

	)

76 
	#éi°_check
(
h
, 
ab‹t°r
) \

77 
	`li°_check
(&(
h
)->
øw
, (
ab‹t°r
))

	)

90 
	#éi°_öô
(
h
Ë
	`li°_hód_öô
(&(h)->
øw
)

	)

101 
	#éi°_øw
(
h
, 
ex¥
Ë(&
	`tc⁄_check
((h), 
ˇ«ry
, (ex¥))->
øw
)

	)

118 
	#éi°_add
(
h
, 
n
, 
membî
Ë
	`li°_add
(
	`éi°_øw
((h), (n)), &“)->membî)

	)

131 
	#éi°_add_èû
(
h
, 
n
, 
membî
) \

132 
	`li°_add_èû
(
	`éi°_øw
((
h
), (
n
)), &“)->
membî
)

	)

152 
	#éi°_dñ_‰om
(
h
, 
n
, 
membî
) \

153 
	`li°_dñ_‰om
(
	`éi°_øw
((
h
), (
n
)), &“)->
membî
)

	)

164 
	#éi°_dñ
(
n
, 
membî
) \

165 
	`li°_dñ
(&(
n
)->
membî
)

	)

176 
	#éi°_em±y
(
h
Ë
	`li°_em±y
(&(h)->
øw
)

	)

191 
	#éi°_t›
(
h
, 
membî
) \

192 ((
	`tc⁄_ty≥
((
h
), 
ˇ«ry
)) \

193 
	`li°_t›_
(&(
h
)->
øw
, \

194 (*)(&(
h
)->
_tc⁄
[0].
ˇ«ry
->
membî
) - \

195 (*)((
h
)->
_tc⁄
[0].
ˇ«ry
)))

	)

210 
	#éi°_èû
(
h
, 
membî
) \

211 ((
	`tc⁄_ty≥
((
h
), 
ˇ«ry
)) \

212 
	`li°_èû_
(&(
h
)->
øw
, \

213 (*)(&(
h
)->
_tc⁄
[0].
ˇ«ry
->
membî
) - \

214 (*)((
h
)->
_tc⁄
[0].
ˇ«ry
)))

	)

229 
	#éi°_f‹_óch
(
h
, 
i
, 
membî
) \

230 
	`li°_f‹_óch
(
	`éi°_øw
((
h
), (
i
)), (i), 
membî
)

	)

245 
	#éi°_f‹_óch_ªv
(
h
, 
i
, 
membî
) \

246 
	`li°_f‹_óch_ªv
(
	`éi°_øw
((
h
), (
i
)), (i), 
membî
)

	)

266 
	#éi°_f‹_óch_ß„
(
h
, 
i
, 
nxt
, 
membî
) \

267 
	`li°_f‹_óch_ß„
(
	`éi°_øw
((
h
), (
i
)), (i), (
nxt
), 
membî
)

	)

	@ccan/ccan/ttxml/test/run.c

1 
	~<cˇn/âxml/âxml.h
>

4 
	#BUFFER
 40

	)

6 
	~<cˇn/âxml/âxml.c
>

7 
	~<cˇn/èp/èp.h
>

10 
	$ã°_lﬂd
(c⁄° * 
fûíame
)

12 
XmlNode
 *
xml
 = 
	`xml_lﬂd
(
fûíame
);

13 if(!
xml
)  0;

15 
	`xml_‰ì
(
xml
);

17 
	}
}

19 
	$maö
()

21 
XmlNode
 *
x
, *
t
;

23 
	`∂™_ã°s
(12);

25 
	`ok1
(
x
 = 
	`xml_lﬂd
("./test/test.xml1"));

26 
	`ok1
(!
	`xml_föd
(
x
, "Doesn't Exist"));

27 
	`ok1
(
t
 = 
	`xml_föd
(
x
, "one"));

28 
	`ok1
(
	`xml_föd
(
t
, "two"));

29 
	`ok1
(!
	`xml_©å
(
t
, "foobar"));

30 
	`ok1
(!
	`xml_©å
(
t
, "Doesn't Exist"));

31 
	`ok1
(
	`xml_©å
(
t
, "barfoo"));

32 
	`xml_‰ì
(
x
);

34 
	`ok1
(!
	`ã°_lﬂd
("doesÇotÉxist"));

35 
	`ok1
(
	`ã°_lﬂd
("./test/test.xml1"));

36 
	`ok1
(
	`ã°_lﬂd
("./test/test.xml2"));

37 
	`ok1
(
	`ã°_lﬂd
("./test/test.xml3"));

38 
	`ok1
(
	`ã°_lﬂd
("./test/test.xml4"));

46  
	`exô_°©us
();

47 
	}
}

	@ccan/ccan/ttxml/ttxml.c

3 
	~<°dlib.h
>

4 
	~<°rög.h
>

5 
	~<°dio.h
>

7 
	~"âxml.h
"

9 #i‚de‡
BUFFER


10 
	#BUFFER
 3264

	)

14 
	#XML_LETTER
 1

	)

15 
	#XML_NUMBER
 2

	)

16 
	#XML_SPACE
 4

	)

17 
	#XML_SLASH
 8

	)

18 
	#XML_OPEN
 16

	)

19 
	#XML_EQUALS
 32

	)

20 
	#XML_CLOSE
 64

	)

21 
	#XML_QUOTE
 128

	)

22 
	#XML_OTHER
 256

	)

24 
	#XML_ALL
 0xFFFFFFFF

	)

27 
	sXMLBUF


29 
FILE
 * 
	mÂå
;

30 * 
	mbuf
;

31 
	mÀn
;

32 
	mªad_ödex
;

33 
	meof
;

34 
	mîr‹
;

35 } 
	tXMLBUF
;

39 
XmlNode
* 
	$xml_√w
(* 
«me
)

41 
XmlNode
 * 
ªt
 = 
	`mÆloc
((XmlNode));

42 if(!
ªt
) 
NULL
;

44 
ªt
->
©åib
 = 
NULL
;

45 
ªt
->
«ârib
 = 0;

46 
ªt
->
chûd
 =Ñë->
√xt
 = 
NULL
;

48 
ªt
->
«me
 =Çame;

49  
ªt
;

50 
	}
}

53 
	$xml_‰ì
(
XmlNode
 *
èrgë
)

55 
i
;

56 
i
=0; i<
èrgë
->
«ârib
*2; i++)

57 if(
èrgë
->
©åib
[
i
])

58 
	`‰ì
(
èrgë
->
©åib
[
i
]);

60 if(
èrgë
->
©åib
)
	`‰ì
(target->attrib);

61 if(
èrgë
->
chûd
)
	`xml_‰ì
(target->child);

62 if(
èrgë
->
√xt
)
	`xml_‰ì
(target->next);

63 
	`‰ì
(
èrgë
->
«me
);

64 
	`‰ì
(
èrgë
);

65 
	}
}

70 
	$is_•ecül
(
ôem
)

72 if((
ôem
 >= 'a' && item <= 'z') || (item >= 'A' && item <='Z'))

73  
XML_LETTER
;

74 if–
ôem
 >= '0' && item <='9' )

75  
XML_NUMBER
;

76 if–
ôem
 == 0x20 || item == '\t' || item == 0x0D || item == 0x0A )

77  
XML_SPACE
;

78 if–
ôem
 == '/' )

79  
XML_SLASH
;

80 if–
ôem
 == '<' )

81  
XML_OPEN
;

82 if–
ôem
 == '=' )

83  
XML_EQUALS
;

84 if–
ôem
 == '>' )

85  
XML_CLOSE
;

86 if–
ôem
 == '"' || item == '\'' )

87  
XML_QUOTE
;

89 
	}
}

92 
	$xml_ªad_fûe
(
XMLBUF
 *
xml
)

94 
size
;

96 if(
xml
->
eof
);

98 
size
 = 
	`‰ód
–
xml
->
buf
, 1, xml->
Àn
, xml->
Âå
);

99 if–
size
 !
xml
->
Àn
 )

101 
xml
->
Àn
 = 
size
;

102 
xml
->
buf
[
size
]=0;

103 
xml
->
eof
 = 1;

105 
	}
}

108 
	$xml_íd_fûe
(
XMLBUF
 *
xml
)

110 
xml
->
Àn
 = 0;

111 
xml
->
eof
 = 1;

112 
xml
->
ªad_ödex
 = 0 ;

113 
xml
->
îr‹
 = 1;

114 
	}
}

118 
	$xml_≥ek
(
XMLBUF
 *
xml
)

120  
xml
->
buf
[xml->
ªad_ödex
];

121 
	}
}

124 
	$xml_ªad_byã
(
XMLBUF
 *
xml
)

126 
ªt
 = 
	`xml_≥ek
(
xml
);

127 
xml
->
ªad_ödex
++;

128 if(
xml
->
ªad_ödex
 >xml->
Àn
)

130 if(
xml
->
eof
)

132 
xml
->
ªad_ödex
 = xml->
Àn
;

133  
ªt
;

135 
xml
->
ªad_ödex
 = 0 ;

136 
	`xml_ªad_fûe
(
xml
);

138  
ªt
;

139 
	}
}

143 
	$xml_skù
–
XMLBUF
 *
xml
, 
mask
)

145  
	`is_•ecül
(
	`xml_≥ek
(
xml
)Ë& 
mask
 && !(xml->
eof
 && xml->
ªad_ödex
 >xml->
Àn
) )

146 
	`xml_ªad_byã
(
xml
);

147 
	}
}

151 
	gquŸech¨
 = 0;

152 
	$ã°_quŸe
(c⁄° 
x
)

154 
esˇ≥d
=0;

155 if–
esˇ≥d
 || '\\' =
x
 )

157 
esˇ≥d
 = !escaped;

160 if–
x
 !
quŸech¨
 )

163 
	}
}

165 
	g„ed_mask
 = 0;

166 
	$ã°_mask
(c⁄° 
x
)

168  !(
	`is_•ecül
(
x
Ë& 
„ed_mask
);

169 
	}
}

180 * 
xml_„ed
–
XMLBUF
 *
xml
, (*
ã°
)() )

182 
off£t
 = 
xml
->
ªad_ödex
;

183 
dñè
;

184 *
ªt
 = 
NULL
;

185 *
tmp
 = 
NULL
;

186 
size
 = 0;

189  
	`ã°
(
xml
->
buf
[
off£t
]) )

191 
off£t
 ++;

193 if(
off£t
 >
xml
->
Àn
)

195 
dñè
 = 
off£t
 - 
xml
->
ªad_ödex
;

196 
tmp
 = 
	`ªÆloc
(
ªt
, 
size
 + 
dñè
 + 1);

197 if(!
tmp
)
xml_„ed_mÆloc
;

198 
ªt
 = 
tmp
;

199 
	`mem˝y
(
ªt
+
size
, 
xml
->
buf
 + xml->
ªad_ödex
, 
dñè
);

200 
size
 +
dñè
;

201 
ªt
[
size
]=0;

202 if(
xml
->
eof
) 
ªt
;

203 
	`xml_ªad_fûe
(
xml
);

204 
xml
->
ªad_ödex
 = 0;

205 
off£t
 = 0;

209 if(
off£t
 > 
xml
->
ªad_ödex
)

211 
dñè
 = 
off£t
 - 
xml
->
ªad_ödex
;

212 
tmp
 = 
	`ªÆloc
(
ªt
, 
size
 + 
dñè
 + 1);

213 if(!
tmp
)
xml_„ed_mÆloc
;

214 
ªt
 = 
tmp
;

215 
	`mem˝y
(
ªt
+
size
, 
xml
->
buf
 + xml->
ªad_ödex
, 
dñè
);

216 
xml
->
ªad_ödex
 = 
off£t
;

217 
size
 +
dñè
;

218 
ªt
[
size
]=0;

220  
ªt
;

221 
xml_„ed_mÆloc
:

222 
	`‰ì
(
ªt
);

223 
	`xml_íd_fûe
(
xml
);

225 
	}
}

233 
	$xml_ªad_©å
(
XMLBUF
 *
xml
, 
XmlNode
 *
node
)

235 
n
=0;

236 **
tmp
;

239 
xml
->
Àn
)

241 if–
	`is_•ecül
(
	`xml_≥ek
(
xml
)Ë& (
XML_CLOSE
 | 
XML_SLASH
) )

244 
n
 = ++
node
->
«ârib
;

245 
tmp
 = 
	`ªÆloc
(
node
->
©åib
, 
n
 * 2 * (*) );

246 if(!
tmp
)
xml_ªad_©å_mÆloc
;

247 
node
->
©åib
 = 
tmp
;

248 
node
->
©åib
[--
n
*2+1] = 0;

250 
„ed_mask
 = 
XML_EQUALS
 | 
XML_SPACE
 | 
XML_CLOSE
 | 
XML_SLASH
;

251 
node
->
©åib
[
n
*2] = 
	`xml_„ed
(
xml
, 
ã°_mask
 );

252 if–
	`xml_≥ek
(
xml
) == '=' )

254 
	`xml_ªad_byã
(
xml
);

255 if–
	`is_•ecül
(
	`xml_≥ek
(
xml
)Ë& 
XML_QUOTE
 )

257 
quŸech¨
 = 
	`xml_ªad_byã
(
xml
);

258 
node
->
©åib
[
n
*2+1] = 
	`xml_„ed
(
xml
, 
ã°_quŸe
);

259 
	`xml_ªad_byã
(
xml
);

263 
„ed_mask
 = 
XML_SPACE
 | 
XML_CLOSE
 | 
XML_SLASH
;

264 
node
->
©åib
[
n
*2+1] = 
	`xml_„ed
(
xml
, 
ã°_mask
);

267 
	`xml_skù
(
xml
, 
XML_SPACE
);

270 
xml_ªad_©å_mÆloc
:

271 
	`xml_íd_fûe
(
xml
);

272 
	}
}

279 
XmlNode
* 
	$xml_∑r£
(
XMLBUF
 *
xml
)

281 
toff
;

282 **
tmp
;

283 *
°mp
;

284 
XmlNode
 **
this
, *
ªt
 = 
NULL
;

286 
this
 = &
ªt
;

288 
	`xml_skù
(
xml
, 
XML_SPACE
);

289  (
xml
->
ªad_ödex
 < xml->
Àn
Ë|| !xml->
eof
 )

291 
	`is_•ecül
(
	`xml_≥ek
(
xml
)))

293 
XML_OPEN
:

294 
	`xml_ªad_byã
(
xml
);

295 if(
	`xml_≥ek
(
xml
) == '/')

296  
ªt
;

298 
„ed_mask
 = 
XML_SPACE
 | 
XML_SLASH
 | 
XML_CLOSE
;

299 *
this
 = 
	`xml_√w
–
	`xml_„ed
(
xml
, 
ã°_mask
));

300 if(
xml
->
îr‹
)
xml_∑r£_mÆloc
;

301 
	`xml_skù
(
xml
, 
XML_SPACE
);

303 
	`xml_ªad_©å
(
xml
, *
this
);

306 
	`is_•ecül
(
	`xml_≥ek
(
xml
)))

308 
XML_CLOSE
:

309 
	`xml_ªad_byã
(
xml
);

310 (*
this
)->
chûd
 = 
	`xml_∑r£
(
xml
);

311 
	`xml_skù
(
xml
, 
XML_ALL
 ^ 
XML_CLOSE
);

312 
	`xml_ªad_byã
(
xml
);

314 
XML_SLASH
:

315 
	`xml_ªad_byã
(
xml
);

316 
	`xml_ªad_byã
(
xml
);

322 *
this
 = 
	`xml_√w
(0);

323 
	`xml_skù
(
xml
, 
XML_SPACE
);

324 
„ed_mask
 = 
XML_OPEN
;

325 (*
this
)->
«ârib
=1;

326 
tmp
 = 
	`mÆloc
((*)*2);

327 if(!
tmp
)
xml_∑r£_mÆloc
;

328 (*
this
)->
©åib
 = 
tmp
;

329 (*
this
)->
©åib
[1] = 
NULL
;

330 
°mp
 = (*
this
)->
©åib
[0] = 
	`xml_„ed
(
xml
, 
ã°_mask
);

334 
toff
 = 
	`°æí
(
°mp
)-1;

335  ( 
	`is_•ecül
(
°mp
[
toff
]Ë& 
XML_SPACE
 ) )

337 
°mp
[
toff
] = 0;

338 
toff
 --;

343 
this
 = &(*this)->
√xt
;

344 
	`xml_skù
(
xml
, 
XML_SPACE
);

347  
ªt
;

348 
xml_∑r£_mÆloc
:

349 
	`xml_íd_fûe
(
xml
);

350 if(
ªt
)
	`xml_‰ì
(ret);

352 
	}
}

356 
XmlNode
* 
	$xml_lﬂd
(c⁄° * 
fûíame
)

358 
XMLBUF
 
xml
;

359 
XmlNode
 *
ªt
 = 
NULL
;

363 
xml
.
îr‹
 = 0;

364 
xml
.
eof
 = 0;

365 
xml
.
ªad_ödex
 = 0;

366 
xml
.
Âå
 = 
	`f›í
(
fûíame
, "rb");

367 if(!
xml
.
Âå
)

368  
NULL
;

370 
xml
.
buf
 = 
	`mÆloc
(
BUFFER
+1);

371 if(!
xml
.
buf
)

372 
xml_lﬂd_Áû_mÆloc_buf
;

373 
xml
.
buf
[
BUFFER
]=0;

374 
xml
.
Àn
 = 
BUFFER
;

376 
	`xml_ªad_fûe
(&
xml
);

378 
ªt
 = 
	`xml_∑r£
(&
xml
);

380 if(
xml
.
îr‹
)

382 
	`xml_‰ì
(
ªt
);

383 
ªt
 = 
NULL
;

386 
	`‰ì
(
xml
.
buf
);

387 
xml_lﬂd_Áû_mÆloc_buf
:

388 
	`f˛o£
(
xml
.
Âå
);

389  
ªt
;

390 
	}
}

393 
XmlNode
 * 
	$xml_föd
(
XmlNode
 *
xml
, c⁄° *
«me
)

395 
XmlNode
 * 
ªt
;

396 if(
xml
->
«me
)if(!
	`°rcmp
(xml->name,Çame)) xml;

397 if(
xml
->
chûd
)

399 
ªt
 = 
	`xml_föd
(
xml
->
chûd
, 
«me
);

400 if(
ªt
)Ñet;

402 if(
xml
->
√xt
)

404 
ªt
 = 
	`xml_föd
(
xml
->
√xt
, 
«me
);

405 if(
ªt
)Ñet;

407  
NULL
;

408 
	}
}

411 * 
	$xml_©å
(
XmlNode
 *
x
, c⁄° *
«me
)

413 
i
;

414 
i
=0; i<
x
->
«ârib
; i++)

415 if(
x
->
©åib
[
i
*2])

416 if(!
	`°rcmp
(
x
->
©åib
[
i
*2], 
«me
))

417  
x
->
©åib
[
i
*2+1];

419 
	}
}

	@ccan/ccan/ttxml/ttxml.h

1 #i‚de‡
CCAN_TTXML_H


2 
	#CCAN_TTXML_H


	)

34 
	sXmlNode
 {

35 * 
	m«me
;

36 ** 
	m©åib
;

37 
	m«ârib
;

38 
XmlNode
 * 
	mchûd
;

39 
XmlNode
 * 
	m√xt
;

40 } 
	tXmlNode
;

52 
XmlNode
* 
xml_lﬂd
(c⁄° * 
fûíame
);

53 
xml_‰ì
(
XmlNode
 *
èrgë
);

54 * 
xml_©å
(
XmlNode
 *
x
, c⁄° *
«me
);

55 
XmlNode
 * 
xml_föd
(XmlNodê*
xml
, c⁄° *
«me
);

	@ccan/ccan/typesafe_cb/test/compile_fail-cast_if_type-promotable.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dboﬁ.h
>

4 
	$_£t_some_vÆue
(*
vÆ
)

6 
	}
}

8 
	#£t_some_vÆue
(
ex¥
) \

9 
	`_£t_some_vÆue
(
	`ty≥ß„_cb_ˇ°
(*, , (
ex¥
)))

	)

11 
	$maö
(
¨gc
, *
¨gv
[])

13 #ifde‡
FAIL


14 
boﬁ
 
x
 = 0;

15 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


19 
x
 = 0;

21 
	`£t_some_vÆue
(
x
);

23 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb-int.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

4 
_ˇŒback
((*
‚
)(*
¨g
), *arg);

5 
	`_ˇŒback
((*
‚
)(*
¨g
), *arg)

7 
	`‚
(
¨g
);

8 
	}
}

12 
	#ˇŒback
(
‚
, 
¨g
) \

13 
	`_ˇŒback
(
	`ty≥ß„_cb
(, (
‚
), (
¨g
)), (¨g))

	)

15 
my_ˇŒback
(
somëhög
);

16 
	$my_ˇŒback
(
somëhög
)

18 
	}
}

20 
	$maö
(
¨gc
, *
¨gv
[])

22 #ifde‡
FAIL


24 
	`ˇŒback
(
my_ˇŒback
, 100);

27 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

4 
_ªgi°î_ˇŒback
((*
cb
)(*
¨g
), *arg)

6 
	}
}

8 
	#ªgi°î_ˇŒback
(
cb
, 
¨g
) \

9 
	`_ªgi°î_ˇŒback
(
	`ty≥ß„_cb
(, *, (
cb
), (
¨g
)), (¨g))

	)

11 
	$my_ˇŒback
(*
p
)

13 
	}
}

15 
	$maö
(
¨gc
, *
¨gv
[])

17 
°r
[] = "hello world";

18 #ifde‡
FAIL


19 *
p
;

20 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


24 *
p
;

26 
p
 = 
NULL
;

29 
	`ªgi°î_ˇŒback
(
my_ˇŒback
, 
°r
);

32 
	`ªgi°î_ˇŒback
(
my_ˇŒback
, 
p
);

34 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_cast-multi.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

4 
	sfoo
 {

5 
	mx
;

8 
	sb¨
 {

9 
	mx
;

12 
	sbaz
 {

13 
	mx
;

16 
	s™y
 {

17 
	mx
;

20 
	sŸhî
 {

21 
	mx
;

24 
	$èke_™y
(
™y
 *any)

26 
	}
}

28 
	$maö
(
¨gc
, *
¨gv
[])

30 #ifde‡
FAIL


31 
Ÿhî


32 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


36 
foo


38 *
¨g
 = 
NULL
;

39 
	`èke_™y
(
	`ty≥ß„_cb_ˇ°3
(
™y
 *,

40 
foo
 *, 
b¨
 *, 
baz
 *,

41 
¨g
));

43 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_cast.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

3 
_£t_some_vÆue
(*
vÆ
);

5 
	$_£t_some_vÆue
(*
vÆ
)

7 
	}
}

9 
	#£t_some_vÆue
(
ex¥
) \

10 
	`_£t_some_vÆue
(
	`ty≥ß„_cb_ˇ°
(*, , (
ex¥
)))

	)

12 
	$maö
(
¨gc
, *
¨gv
[])

14 #ifde‡
FAIL


15 
x
 = 0;

16 
	`£t_some_vÆue
(
x
);

17 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


21 *
p
 = 0;

22 
	`£t_some_vÆue
(
p
);

25 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_postargs.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

4 
_ªgi°î_ˇŒback
((*
cb
)(*
¨g
, 
x
), *arg)

6 
	}
}

7 
	#ªgi°î_ˇŒback
(
cb
, 
¨g
) \

8 
	`_ªgi°î_ˇŒback
(
	`ty≥ß„_cb_po°¨gs
(, *, (
cb
), (
¨g
), ), (¨g))

	)

10 
	$my_ˇŒback
(*
p
, 
x
)

12 
	}
}

14 
	$maö
(
¨gc
, *
¨gv
[])

16 #ifde‡
FAIL


17 *
p
;

18 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


22 *
p
;

24 
p
 = 
NULL
;

25 
	`ªgi°î_ˇŒback
(
my_ˇŒback
, 
p
);

27 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_preargs.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

4 
_ªgi°î_ˇŒback
((*
cb
)(
x
, *
¨g
), *arg)

6 
	}
}

8 
	#ªgi°î_ˇŒback
(
cb
, 
¨g
) \

9 
	`_ªgi°î_ˇŒback
(
	`ty≥ß„_cb_¥órgs
(, *, (
cb
), (
¨g
), ), (¨g))

	)

11 
	$my_ˇŒback
(
x
, *
p
)

13 
	}
}

15 
	$maö
(
¨gc
, *
¨gv
[])

17 #ifde‡
FAIL


18 *
p
;

19 #i‡!
HAVE_TYPEOF
||!
HAVE_BUILTIN_CHOOSE_EXPR
||!
HAVE_BUILTIN_TYPES_COMPATIBLE_P


23 *
p
;

25 
p
 = 
NULL
;

26 
	`ªgi°î_ˇŒback
(
my_ˇŒback
, 
p
);

28 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb-NULL.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

6 
_ªgi°î_ˇŒback
((*
cb
)(c⁄° *
¨g
), const *arg)

8 
	}
}

10 
	#ªgi°î_ˇŒback
(
cb
, 
¨g
) \

11 
	`_ªgi°î_ˇŒback
(
	`ty≥ß„_cb
(, c⁄° *, (
cb
), (
¨g
)), (¨g))

	)

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
	`ªgi°î_ˇŒback
(
NULL
, "hello world");

17 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb-undefined.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

6 
_ªgi°î_ˇŒback
((*
cb
)(*
¨g
), *arg)

8 
	}
}

10 
	#ªgi°î_ˇŒback
(
cb
, 
¨g
) \

11 
	`_ªgi°î_ˇŒback
(
	`ty≥ß„_cb
(, *, (
cb
), (
¨g
)), (¨g))

	)

13 
_ªgi°î_ˇŒback_¥e
((*
cb
)(
x
, *
¨g
), *arg)

15 
	}
}

17 
	#ªgi°î_ˇŒback_¥e
(
cb
, 
¨g
) \

18 
	`_ªgi°î_ˇŒback_¥e
(
	`ty≥ß„_cb_¥órgs
(, *, (
cb
), (
¨g
), ), (¨g))

	)

20 
_ªgi°î_ˇŒback_po°
((*
cb
)(*
¨g
, 
x
), *arg)

22 
	}
}

24 
	#ªgi°î_ˇŒback_po°
(
cb
, 
¨g
) \

25 
	`_ªgi°î_ˇŒback_po°
(
	`ty≥ß„_cb_po°¨gs
(, *, (
cb
), (
¨g
), ), (¨g))

	)

27 
	gundeföed
;

29 
	$my_ˇŒback
(
undeföed
 *
undef
)

31 
	}
}

33 
	$my_ˇŒback_¥e
(
x
, 
undeföed
 *
undef
)

35 
	}
}

37 
	$my_ˇŒback_po°
(
undeföed
 *
undef
, 
x
)

39 
	}
}

41 
	$maö
(
¨gc
, *
¨gv
[])

43 
undeföed
 *
h™dÀ
 = 
NULL
;

45 
	`ªgi°î_ˇŒback
(
my_ˇŒback
, 
h™dÀ
);

46 
	`ªgi°î_ˇŒback_¥e
(
my_ˇŒback_¥e
, 
h™dÀ
);

47 
	`ªgi°î_ˇŒback_po°
(
my_ˇŒback_po°
, 
h™dÀ
);

49 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb-vars.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

6 
_ªgi°î_ˇŒback
((*
cb
)(*
¨g
), *arg)

8 
	}
}

10 
	#ªgi°î_ˇŒback
(
cb
, 
¨g
) \

11 
	`_ªgi°î_ˇŒback
(
	`ty≥ß„_cb
(, *, (
cb
), (
¨g
)), (¨g))

	)

13 
_ªgi°î_ˇŒback_¥e
((*
cb
)(
x
, *
¨g
), *arg)

15 
	}
}

17 
	#ªgi°î_ˇŒback_¥e
(
cb
, 
¨g
) \

18 
	`_ªgi°î_ˇŒback_¥e
(
	`ty≥ß„_cb_¥órgs
(, *, (
cb
), (
¨g
), ), (¨g))

	)

20 
_ªgi°î_ˇŒback_po°
((*
cb
)(*
¨g
, 
x
), *arg)

22 
	}
}

24 
	#ªgi°î_ˇŒback_po°
(
cb
, 
¨g
) \

25 
	`_ªgi°î_ˇŒback_po°
(
	`ty≥ß„_cb_po°¨gs
(, *, (
cb
), (
¨g
), ), (¨g))

	)

27 
	gundeföed
;

29 
	$my_ˇŒback
(
undeföed
 *
undef
)

31 
	}
}

33 
	$my_ˇŒback_¥e
(
x
, 
undeföed
 *
undef
)

35 
	}
}

37 
	$my_ˇŒback_po°
(
undeföed
 *
undef
, 
x
)

39 
	}
}

41 
	$maö
(
¨gc
, *
¨gv
[])

43 
undeföed
 *
h™dÀ
 = 
NULL
;

44 (*
cb
)(
undeföed
 *
undef
Ë
my_ˇŒback
;

45 (*
¥e
)(
x
, 
undeföed
 *
undef
Ë
my_ˇŒback_¥e
;

46 (*
po°
)(
undeföed
 *
undef
, 
x
Ë
my_ˇŒback_po°
;

48 
	`ªgi°î_ˇŒback
(
cb
, 
h™dÀ
);

49 
	`ªgi°î_ˇŒback_¥e
(
¥e
, 
h™dÀ
);

50 
	`ªgi°î_ˇŒback_po°
(
po°
, 
h™dÀ
);

52 
	}
}

	@ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb_cast.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°dlib.h
>

4 
	sfoo
 {

5 
	mx
;

8 
	sb¨
 {

9 
	mx
;

12 
	sbaz
 {

13 
	mx
;

16 
	s™y
 {

17 
	mx
;

20 
	$èke_™y
(
™y
 *any)

22 
	}
}

24 
	$maö
(
¨gc
, *
¨gv
[])

27 
foo
 *foÿ
NULL
;

28 
b¨
 *b¨ = 
NULL
;

29 
baz
 *baz = 
NULL
;

31 
	`èke_™y
(
	`ty≥ß„_cb_ˇ°3
(
™y
 *,

32 
foo
 *, 
b¨
 *, 
baz
 *,

33 
foo
));

34 
	`èke_™y
(
	`ty≥ß„_cb_ˇ°3
(
™y
 *,

35 
foo
 *, 
b¨
 *, 
baz
 *,

36 
b¨
));

37 
	`èke_™y
(
	`ty≥ß„_cb_ˇ°3
(
™y
 *,

38 
foo
 *, 
b¨
 *, 
baz
 *,

39 
baz
));

41 
	}
}

	@ccan/ccan/typesafe_cb/test/run.c

1 
	~<cˇn/ty≥ß„_cb/ty≥ß„_cb.h
>

2 
	~<°rög.h
>

3 
	~<°döt.h
>

4 
	~<cˇn/èp/èp.h
>

6 
	gdummy
 = 0;

9 
	$_£t_some_vÆue
(*
vÆ
)

11 
	`ok1
(
vÆ
 =&
dummy
);

12 
	}
}

14 
	#£t_some_vÆue
(
ex¥
) \

15 
	`_£t_some_vÆue
(
	`ty≥ß„_cb_ˇ°
(*, , (
ex¥
)))

	)

17 
_ˇŒback_⁄órg
((*
‚
)(*
¨g
), *arg)

19 
	`‚
(
¨g
);

20 
	}
}

22 
_ˇŒback_¥órgs
((*
‚
)(
a
, 
b
, *
¨g
), *arg)

24 
	`‚
(1, 2, 
¨g
);

25 
	}
}

27 
_ˇŒback_po°¨gs
((*
‚
)(*
¨g
, 
a
, 
b
), *arg)

29 
	`‚
(
¨g
, 1, 2);

30 
	}
}

32 
	#ˇŒback_⁄órg
(
cb
, 
¨g
) \

33 
	`_ˇŒback_⁄órg
(
	`ty≥ß„_cb
(, *, (
cb
), (
¨g
)), (¨g))

	)

35 
	#ˇŒback_¥órgs
(
cb
, 
¨g
) \

36 
	`_ˇŒback_¥órgs
(
	`ty≥ß„_cb_¥órgs
(, *, (
cb
), (
¨g
), , ), (¨g))

	)

38 
	#ˇŒback_po°¨gs
(
cb
, 
¨g
) \

39 
	`_ˇŒback_po°¨gs
(
	`ty≥ß„_cb_po°¨gs
(, *, (
cb
), (
¨g
), , ), (¨g))

	)

41 
	$my_ˇŒback_⁄órg
(*
p
)

43 
	`ok1
(
	`°rcmp
(
p
, "hello world") == 0);

44 
	}
}

46 
	$my_ˇŒback_¥órgs
(
a
, 
b
, *
p
)

48 
	`ok1
(
a
 == 1);

49 
	`ok1
(
b
 == 2);

50 
	`ok1
(
	`°rcmp
(
p
, "hello world") == 0);

51 
	}
}

53 
	$my_ˇŒback_po°¨gs
(*
p
, 
a
, 
b
)

55 
	`ok1
(
a
 == 1);

56 
	`ok1
(
b
 == 2);

57 
	`ok1
(
	`°rcmp
(
p
, "hello world") == 0);

58 
	}
}

62 
	sˇŒback_⁄órg


64 (*
	m‚
)(*
	m¨g
);

65 c⁄° *
	m¨g
;

68 
ˇŒback_⁄órg
 
	gcb_⁄órg


69 { 
ty≥ß„_cb
(, *, 
my_ˇŒback_⁄órg
, (*)(
öçå_t
)"hello world"),

72 
	sˇŒback_¥órgs


74 (*
	m‚
)(
	ma
, 
	mb
, *
	m¨g
);

75 c⁄° *
	m¨g
;

78 
ˇŒback_¥órgs
 
	gcb_¥órgs


79 { 
ty≥ß„_cb_¥órgs
(, *, 
my_ˇŒback_¥órgs
,

80 (*)(
öçå_t
)"hi", , ), "hi" };

82 
	sˇŒback_po°¨gs


84 (*
	m‚
)(*
	m¨g
, 
	ma
, 
	mb
);

85 c⁄° *
	m¨g
;

88 
ˇŒback_po°¨gs
 
	gcb_po°¨gs


89 { 
ty≥ß„_cb_po°¨gs
(, *, 
my_ˇŒback_po°¨gs
,

90 (*)(
öçå_t
)"hi", , ), "hi" };

92 
	$maö
(
¨gc
, *
¨gv
[])

94 *
p
 = &
dummy
;

95 
l
 = ()
p
;

96 
°r
[] = "hello world";

98 
	`∂™_ã°s
(2 + 1 + 3 + 3);

99 
	`£t_some_vÆue
(
p
);

100 
	`£t_some_vÆue
(
l
);

102 
	`ˇŒback_⁄órg
(
my_ˇŒback_⁄órg
, 
°r
);

104 
	`ˇŒback_¥órgs
(
my_ˇŒback_¥órgs
, 
°r
);

106 
	`ˇŒback_po°¨gs
(
my_ˇŒback_po°¨gs
, 
°r
);

108  
	`exô_°©us
();

109 
	}
}

	@ccan/ccan/typesafe_cb/typesafe_cb.h

2 #i‚de‡
CCAN_TYPESAFE_CB_H


3 
	#CCAN_TYPESAFE_CB_H


	)

4 
	~"c⁄fig.h
"

6 #i‡
HAVE_TYPEOF
 && 
HAVE_BUILTIN_CHOOSE_EXPR
 && 
HAVE_BUILTIN_TYPES_COMPATIBLE_P


32 
	#ty≥ß„_cb_ˇ°
(
de°ty≥
, 
okty≥
, 
ex¥
) \

33 
	`__buûtö_choo£_ex¥
( \

34 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(0?(
ex¥
):(expr)), \

35 
okty≥
), \

36 (
de°ty≥
)(
ex¥
), (ex¥))

	)

38 
	#ty≥ß„_cb_ˇ°
(
de°ty≥
, 
okty≥
, 
ex¥
Ë((de°ty≥)”x¥))

	)

61 
	#ty≥ß„_cb_ˇ°3
(
de°ty≥
, 
ok1
, 
ok2
, 
ok3
, 
ex¥
) \

62 
	`ty≥ß„_cb_ˇ°
(
de°ty≥
, 
ok1
, \

63 
	`ty≥ß„_cb_ˇ°
(
de°ty≥
, 
ok2
, \

64 
	`ty≥ß„_cb_ˇ°
(
de°ty≥
, 
ok3
, \

65 (
ex¥
))))

	)

86 
	#ty≥ß„_cb
(
πy≥
, 
©y≥
, 
‚
, 
¨g
) \

87 
	`ty≥ß„_cb_ˇ°
(
	`πy≥
 (*)(
©y≥
), \

88 
	`πy≥
 (*)(
	`__ty≥of__
(
¨g
)), \

89 (
‚
))

	)

108 
	#ty≥ß„_cb_¥órgs
(
πy≥
, 
©y≥
, 
‚
, 
¨g
, ...) \

109 
	`ty≥ß„_cb_ˇ°
(
	`πy≥
 (*)(
__VA_ARGS__
, 
©y≥
), \

110 
	`πy≥
 (*)(
__VA_ARGS__
, 
	`__ty≥of__
(
¨g
)), \

111 (
‚
))

	)

130 
	#ty≥ß„_cb_po°¨gs
(
πy≥
, 
©y≥
, 
‚
, 
¨g
, ...) \

131 
	`ty≥ß„_cb_ˇ°
(
	`πy≥
 (*)(
©y≥
, 
__VA_ARGS__
), \

132 
	`πy≥
 (*)(
	`__ty≥of__
(
¨g
), 
__VA_ARGS__
), \

133 (
‚
))

	)

	@ccan/ccan/version/test/compile_fail.c

1 
	~<cˇn/vîsi⁄/vîsi⁄.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 #ifde‡
FAIL


7 
vîsi⁄
 
a
;

8 
a
 = 0;

11 
	}
}

	@ccan/ccan/version/test/run.c

1 
	~<cˇn/vîsi⁄/vîsi⁄.h
>

2 
	~<cˇn/èp/èp.h
>

4 
	$maö
()

6 
vîsi⁄
 
a
, 
b
;

8 
	`∂™_ã°s
(26);

11 
a
 = 
	`vîsi⁄
(1, 0);

12 
b
 = 
	`vîsi⁄
(2, 0);

13 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) < 0);

15 
a
 = 
	`vîsi⁄
(1, 1);

16 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) < 0);

18 
a
 = 
	`vîsi⁄
(2, 0);

19 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) == 0);

21 
a
 = 
	`vîsi⁄
(2, 1);

22 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

24 
b
 = 
	`vîsi⁄
(2, 1);

25 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) == 0);

27 
a
 = 
	`vîsi⁄
(3, 0);

28 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

30 
a
 = 
	`vîsi⁄
(3, 1);

31 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

34 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(1, 0)) > 0);

35 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(1, 1)) > 0);

36 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(3, 0)) > 0);

37 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(3, 1)) == 0);

38 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(3, 2)) < 0);

39 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(4, 0)) < 0);

40 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
	`vîsi⁄
(4, 1)) < 0);

43 
a
 = 
	`vîsi⁄
(0xFFFF, 0xFFFF);

44 
b
 = 
	`vîsi⁄
(0xFFFE, 0xFFFF);

45 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

46 
	`ok1
(
	`vîsi⁄_cmp
(
b
, 
a
) < 0);

48 
b
 = 
	`vîsi⁄
(0xFFFF, 0xFFFE);

49 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

50 
	`ok1
(
	`vîsi⁄_cmp
(
b
, 
a
) < 0);

52 
b
 = 
	`vîsi⁄
(0xFFFF, 0xFFFF);

53 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) == 0);

54 
	`ok1
(
	`vîsi⁄_cmp
(
b
, 
a
) == 0);

56 
b
 = 
	`vîsi⁄
(0, 1);

57 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

58 
	`ok1
(
	`vîsi⁄_cmp
(
b
, 
a
) < 0);

60 
b
 = 
	`vîsi⁄
(1, 0);

61 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

62 
	`ok1
(
	`vîsi⁄_cmp
(
b
, 
a
) < 0);

64 
b
 = 
	`vîsi⁄
(0, 0);

65 
	`ok1
(
	`vîsi⁄_cmp
(
a
, 
b
) > 0);

66 
	`ok1
(
	`vîsi⁄_cmp
(
b
, 
a
) < 0);

68  
	`exô_°©us
();

69 
	}
}

	@ccan/ccan/version/version.h

26 #i‚de‡
CCAN_VERSION_H


27 
	#CCAN_VERSION_H


	)

29 
	~<°döt.h
>

31 
	svîsi⁄
 {

32 
uöt32_t
 
	m_v
;

39 
ölöe
 
uöt16_t
 
	$vîsi⁄_maj‹
(
vîsi⁄
 
v
) {

40  (
v
.
_v
 & 0xFFFF0000) >> 16;

41 
	}
}

47 
ölöe
 
uöt16_t
 
	$vîsi⁄_mö‹
(c⁄° 
vîsi⁄
 
v
) {

48  
v
.
_v
 & 0xFFFF;

49 
	}
}

56 
ölöe
 
vîsi⁄
 
	$vîsi⁄
(
uöt16_t
 
maj‹
, uöt16_à
mö‹
)

58 
vîsi⁄
 
v
 = { .
_v
 = 
maj‹
 << 16 | 
mö‹
 };

59  
v
;

60 
	}
}

75 
ölöe
 
	$vîsi⁄_cmp
(
vîsi⁄
 
a
, vîsi⁄ 
b
)

77  (
a
.
_v
 =
b
._v) ? 0 : (a._v > b._v) ? 1 : - 1;

78 
	}
}

	@ccan/ccan/wwviaudio/wwviaudio.c

22 #i‚de‡
WWVIAUDIO_STUBS_ONLY


24 
	~<°dio.h
>

25 
	~<°döt.h
>

26 
	~<limôs.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<sys/°©.h
>

29 
	~<uni°d.h
>

30 
	~<°rög.h
>

31 
	~<°dlib.h
>

33 
	#WWVIAUDIO_DEFINE_GLOBALS


	)

34 
	~"wwvüudio.h
"

35 #unde‡
WWVIAUDIO_DEFINE_GLOBALS


37 
	~<p‹èudio.h
>

38 
	~<cˇn/ogg_to_pcm/ogg_to_pcm.h
>

40 
	#FRAMES_PER_BUFFER
 (1024)

	)

42 
PaSåóm
 *
	g°ªam
 = 
NULL
;

43 
	gaudio_∑u£d
 = 0;

44 
	gmusic_∂ayög
 = 1;

45 
	gsound_w‹kög
 = 0;

46 
	gnomusic
 = 0;

47 
	gsound_ef„˘s_⁄
 = 1;

48 
	gsound_devi˚
 = -1;

49 
	gmax_c⁄cuºít_sounds
 = 0;

50 
	gmax_sound_˛ùs
 = 0;

53 
	$wwvüudio_∑u£_audio
()

55 
audio_∑u£d
 = 1;

56 
	}
}

59 
	$wwvüudio_ªsume_audio
()

61 
audio_∑u£d
 = 0;

62 
	}
}

65 
	$wwvüudio_sûí˚_music
()

67 
music_∂ayög
 = 0;

68 
	}
}

71 
	$wwvüudio_ªsume_music
()

73 
music_∂ayög
 = 1;

74 
	}
}

76 
	$wwvüudio_toggÀ_music
()

78 
music_∂ayög
 = !music_playing;

79 
	}
}

82 
	$wwvüudio_sûí˚_sound_ef„˘s
()

84 
sound_ef„˘s_⁄
 = 0;

85 
	}
}

88 
	$wwvüudio_ªsume_sound_ef„˘s
()

90 
sound_ef„˘s_⁄
 = 1;

91 
	}
}

93 
	$wwvüudio_toggÀ_sound_ef„˘s
()

95 
sound_ef„˘s_⁄
 = !sound_effects_on;

96 
	}
}

98 
	$wwvüudio_£t_nomusic
()

100 
nomusic
 = 1;

101 
	}
}

103 
	ssound_˛ù
 {

104 
	ma˘ive
;

105 
	mnßm∂es
;

106 
	mpos
;

107 
öt16_t
 *
	mßm∂e
;

108 } *
	g˛ù
 = 
NULL
;

110 
sound_˛ù
 *
	gaudio_queue
 = 
NULL
;

112 
	$wwvüudio_ªad_ogg_˛ù
(
˛ùnum
, *
fûíame
)

114 
uöt64_t
 
n‰ames
;

115 
fûebuf
[
PATH_MAX
];

116 
°©
 
°©buf
;

117 
ßm∂esize
, 
ßm∂e_øã
;

118 
nch™√ls
;

119 
rc
;

121 i‡(
˛ùnum
 >
max_sound_˛ùs
 || clipnum < 0)

124 
	`°∫˝y
(
fûebuf
, 
fûíame
, 
PATH_MAX
);

125 
rc
 = 
	`°©
(
fûebuf
, &
°©buf
);

126 i‡(
rc
 != 0) {

127 
	`¢¥ötf
(
fûebuf
, 
PATH_MAX
, "%s", 
fûíame
);

128 
rc
 = 
	`°©
(
fûebuf
, &
°©buf
);

129 i‡(
rc
 != 0) {

130 
	`Ârötf
(
°dîr
, "°©('%s'ËÁûed.\n", 
fûebuf
);

143 i‡(
˛ù
[
˛ùnum
].
ßm∂e
 !
NULL
)

145 
	`‰ì
(
˛ù
[
˛ùnum
].
ßm∂e
);

147 
rc
 = 
	`ogg_to_pcm
(
fûebuf
, &
˛ù
[
˛ùnum
].
ßm∂e
, &
ßm∂esize
,

148 &
ßm∂e_øã
, &
nch™√ls
, &
n‰ames
);

149 i‡(
˛ù
[
˛ùnum
].
ßm∂e
 =
NULL
) {

150 
	`¥ötf
("Can't get memory for sound data for %llu frames in %s\n",

151 
n‰ames
, 
fûebuf
);

152 
îr‹
;

155 i‡(
rc
 != 0) {

156 
	`Ârötf
(
°dîr
, "Error: ogg_to_pcm('%s') failed.\n",

157 
fûebuf
);

158 
îr‹
;

161 
˛ù
[
˛ùnum
].
nßm∂es
 = (Ë
n‰ames
;

162 i‡(
˛ù
[
˛ùnum
].
nßm∂es
 < 0)

163 
˛ù
[
˛ùnum
].
nßm∂es
 = 0;

166 
îr‹
:

168 
	}
}

174 
∑ã°CÆlback
(c⁄° *
öputBuf„r
, *
ouçutBuf„r
,

175 
‰amesPîBuf„r
, c⁄° 
PaSåómCÆlbackTimeInfo
* 
timeInfo
,

176 
PaSåómCÆlbackFœgs
 
°©usFœgs
, 
__©åibuã__
 ((
unu£d
)Ë*
u£rD©a
 )

178 
	gi
, 
	gj
, 
	gßm∂e
, 
	gcou¡
;

179 *
	gout
 = 
NULL
;

180 
	gouçut
;

181 
	gout
 = (*Ë
ouçutBuf„r
;

182 
	gouçut
 = 0.0;

183 
	gcou¡
 = 0;

185 i‡(
	gaudio_∑u£d
) {

189 
	gi
 = 0; i < 
	g‰amesPîBuf„r
; i++)

190 *
	gout
++ = () 0;

194 
	gi
 = 0; i < 
	g‰amesPîBuf„r
; i++) {

195 
	gouçut
 = 0.0;

196 
	gcou¡
 = 0;

197 
	gj
 = 0; j < 
	gmax_c⁄cuºít_sounds
; j++) {

198 i‡(!
	gaudio_queue
[
j
].
	ga˘ive
 ||

199 
	gaudio_queue
[
j
].
	gßm∂e
 =
NULL
)

201 
	gßm∂e
 = 
i
 + 
audio_queue
[
j
].
pos
;

202 
	gcou¡
++;

203 i‡(
	gßm∂e
 >
audio_queue
[
j
].
nßm∂es
) {

204 
audio_queue
[
j
].
a˘ive
 = 0;

207 i‡(
	gj
 !
WWVIAUDIO_MUSIC_SLOT
 && 
sound_ef„˘s_⁄
)

208 
ouçut
 +(Ë
audio_queue
[
j
].
ßm∂e
[ßm∂e] * 0.5 / (Ë(
INT16_MAX
);

209 i‡(
	gj
 =
WWVIAUDIO_MUSIC_SLOT
 && 
music_∂ayög
)

210 
ouçut
 +(Ë
audio_queue
[
j
].
ßm∂e
[ßm∂e] / (Ë(
INT16_MAX
);

212 *
	gout
++ = (Ë
ouçut
 / 2.0;

214 
	gi
 = 0; i < 
	gmax_c⁄cuºít_sounds
; i++) {

215 i‡(!
	gaudio_queue
[
i
].
	ga˘ive
)

217 
	gaudio_queue
[
i
].
	gpos
 +
‰amesPîBuf„r
;

218 i‡(
	gaudio_queue
[
i
].
	gpos
 >
audio_queue
[i].
nßm∂es
)

219 
audio_queue
[
i
].
a˘ive
 = 0;

225 
	$decode_∑îr‹
(
PaEº‹
 
rc
)

227 i‡(
rc
 =
∑NoEº‹
)

229 
	`Ârötf
(
°dîr
, "AnÉrror occurred while usingÅheÖortaudio stream\n");

230 
	`Ârötf
(
°dîr
, "Eº‹Çumbî: %d\n", 
rc
);

231 
	`Ârötf
(
°dîr
, "Eº‹ mesßge: %s\n", 
	`Pa_GëEº‹Text
(
rc
));

232 
	}
}

234 
	$wwvüudio_ãrmö©e_p‹èudio
(
PaEº‹
 
rc
)

236 
	`Pa_Tîmö©e
();

237 
	`decode_∑îr‹
(
rc
);

238 
	}
}

240 
	$wwvüudio_öôülize_p‹èudio
(
maximum_c⁄cuºít_sounds
, 
maximum_sound_˛ùs
)

242 
PaSåómP¨amëîs
 
ouç¨ams
;

243 
PaEº‹
 
rc
;

244 
PaDevi˚Index
 
devi˚_cou¡
;

246 
max_c⁄cuºít_sounds
 = 
maximum_c⁄cuºít_sounds
;

247 
max_sound_˛ùs
 = 
maximum_sound_˛ùs
;

249 
audio_queue
 = 
	`mÆloc
(
max_c⁄cuºít_sounds
 * (audio_queue[0]));

250 
˛ù
 = 
	`mÆloc
(
max_sound_˛ùs
 * (clip[0]));

251 i‡(
audio_queue
 =
NULL
 || 
˛ù
 == NULL)

254 
	`mem£t
(
audio_queue
, 0, ◊udio_queue[0]Ë* 
max_c⁄cuºít_sounds
);

255 
	`mem£t
(
˛ù
, 0, (˛ù[0]Ë* 
max_sound_˛ùs
);

257 
rc
 = 
	`Pa_Inôülize
();

258 i‡(
rc
 !
∑NoEº‹
)

259 
îr‹
;

261 
devi˚_cou¡
 = 
	`Pa_GëDevi˚Cou¡
();

262 
	`¥ötf
("P‹èudiÿªp‹t†%d sound devi˚s.\n", 
devi˚_cou¡
);

264 i‡(
devi˚_cou¡
 == 0) {

265 
	`¥ötf
("There will beÇoáudio.\n");

266 
îr‹
;

267 
rc
 = 0;

269 
sound_w‹kög
 = 1;

271 
ouç¨ams
.
devi˚
 = 
	`Pa_GëDeÁu…OuçutDevi˚
();

273 
	`¥ötf
("P‹èudiÿßy†thêdeÁu… devi˚ is: %d\n", 
ouç¨ams
.
devi˚
);

275 i‡(
sound_devi˚
 != -1) {

276 i‡(
sound_devi˚
 >
devi˚_cou¡
)

277 
	`Ârötf
(
°dîr
, "wordwarvi: Invalid sound device "

278 "%d s≥cifõd, ign‹ög.\n", 
sound_devi˚
);

280 
ouç¨ams
.
devi˚
 = 
sound_devi˚
;

281 
	`¥ötf
("Usög sound devi˚ %d\n", 
ouç¨ams
.
devi˚
);

284 i‡(
ouç¨ams
.
devi˚
 < 0 && 
devi˚_cou¡
 > 0) {

285 
	`¥ötf
("Hmm,Åhat's strange,Öortaudio saysÅhe default device is %d,\n"

287 
ouç¨ams
.
devi˚
, 
devi˚_cou¡
);

288 
	`¥ötf
("IÅhink we'll just skip sound forÇow.\n");

289 
	`¥ötf
("You mightÅryÅhe '--sounddevice' optionánd see ifÅhat helps.\n");

290 
sound_w‹kög
 = 0;

294 
ouç¨ams
.
ch™√lCou¡
 = 1;

295 
ouç¨ams
.
ßm∂eF‹m©
 = 
∑Flﬂt32
;

296 
ouç¨ams
.
sugge°edL©ícy
 =

297 
	`Pa_GëDevi˚Info
(
ouç¨ams
.
devi˚
)->
deÁu…LowOuçutL©ícy
;

298 
ouç¨ams
.
ho°ApiS≥cificSåómInfo
 = 
NULL
;

300 
rc
 = 
	`Pa_O≥nSåóm
(&
°ªam
,

301 
NULL
,

302 &
ouç¨ams
, 
WWVIAUDIO_SAMPLE_RATE
, 
FRAMES_PER_BUFFER
,

303 
∑NoFœg
,

304 
∑ã°CÆlback
, 
NULL
 );

305 i‡(
rc
 !
∑NoEº‹
)

306 
îr‹
;

307 i‡((
rc
 = 
	`Pa_SèπSåóm
(
°ªam
)Ë!
∑NoEº‹
)

308 
îr‹
;

309  
rc
;

310 
îr‹
:

311 
	`wwvüudio_ãrmö©e_p‹èudio
(
rc
);

312  
rc
;

313 
	}
}

316 
	$wwvüudio_°›_p‹èudio
()

318 
i
, 
rc
;

320 i‡(!
sound_w‹kög
)

322 i‡((
rc
 = 
	`Pa_St›Såóm
(
°ªam
)Ë!
∑NoEº‹
)

323 
îr‹
;

324 
rc
 = 
	`Pa_Clo£Såóm
(
°ªam
);

325 
îr‹
:

326 
	`wwvüudio_ãrmö©e_p‹èudio
(
rc
);

327 i‡(
audio_queue
) {

328 
	`‰ì
(
audio_queue
);

329 
audio_queue
 = 
NULL
;

330 
max_c⁄cuºít_sounds
 = 0;

332 i‡(
˛ù
) {

333 
i
 = 0; i < 
max_sound_˛ùs
; i++) {

334 i‡(
˛ù
[
i
].
ßm∂e
)

335 
	`‰ì
(
˛ù
[
i
].
ßm∂e
);

337 
	`‰ì
(
˛ù
);

338 
˛ù
 = 
NULL
;

339 
max_sound_˛ùs
 = 0;

342 
	}
}

344 
	$wwvüudio_add_sound_to_¶Ÿ
(
which_sound
, 
which_¶Ÿ
)

346 
i
;

348 i‡(!
sound_w‹kög
)

351 i‡(
nomusic
 && 
which_¶Ÿ
 =
WWVIAUDIO_MUSIC_SLOT
)

354 i‡(
which_¶Ÿ
 !
WWVIAUDIO_ANY_SLOT
) {

355 i‡(
audio_queue
[
which_¶Ÿ
].
a˘ive
)

356 
audio_queue
[
which_¶Ÿ
].
a˘ive
 = 0;

357 
audio_queue
[
which_¶Ÿ
].
pos
 = 0;

358 
audio_queue
[
which_¶Ÿ
].
nßm∂es
 = 0;

360 
audio_queue
[
which_¶Ÿ
].
ßm∂e
 = 
˛ù
[
which_sound
].sample;

361 
audio_queue
[
which_¶Ÿ
].
nßm∂es
 = 
˛ù
[
which_sound
].nsamples;

363 
audio_queue
[
which_¶Ÿ
].
a˘ive
 = 1;

364  
which_¶Ÿ
;

366 
i
=1;i<
max_c⁄cuºít_sounds
;i++) {

367 i‡(
audio_queue
[
i
].
a˘ive
 == 0) {

368 
audio_queue
[
i
].
nßm∂es
 = 
˛ù
[
which_sound
].nsamples;

369 
audio_queue
[
i
].
pos
 = 0;

370 
audio_queue
[
i
].
ßm∂e
 = 
˛ù
[
which_sound
].sample;

371 
audio_queue
[
i
].
a˘ive
 = 1;

375  (
i
 >
max_c⁄cuºít_sounds
) ? -1 : i;

376 
	}
}

378 
	$wwvüudio_add_sound
(
which_sound
)

380  
	`wwvüudio_add_sound_to_¶Ÿ
(
which_sound
, 
WWVIAUDIO_ANY_SLOT
);

381 
	}
}

383 
	$wwvüudio_∂ay_music
(
which_sound
)

385  
	`wwvüudio_add_sound_to_¶Ÿ
(
which_sound
, 
WWVIAUDIO_MUSIC_SLOT
);

386 
	}
}

389 
	$wwvüudio_add_sound_low_¥i‹ôy
(
which_sound
)

393 
i
;

394 
em±y_¶Ÿs
 = 0;

395 
œ°_¶Ÿ
;

397 i‡(!
sound_w‹kög
)

399 
œ°_¶Ÿ
 = -1;

400 
i
 = 1; i < 
max_c⁄cuºít_sounds
; i++)

401 i‡(
audio_queue
[
i
].
a˘ive
 == 0) {

402 
œ°_¶Ÿ
 = 
i
;

403 
em±y_¶Ÿs
++;

404 i‡(
em±y_¶Ÿs
 >= 5)

408 i‡(
em±y_¶Ÿs
 < 5)

411 
i
 = 
œ°_¶Ÿ
;

413 i‡(
audio_queue
[
i
].
a˘ive
 == 0) {

414 
audio_queue
[
i
].
nßm∂es
 = 
˛ù
[
which_sound
].nsamples;

415 
audio_queue
[
i
].
pos
 = 0;

416 
audio_queue
[
i
].
ßm∂e
 = 
˛ù
[
which_sound
].sample;

417 
audio_queue
[
i
].
a˘ive
 = 1;

420 
	}
}

423 
	$wwvüudio_ˇn˚l_sound
(
queue_íåy
)

425 i‡(!
sound_w‹kög
)

427 
audio_queue
[
queue_íåy
].
a˘ive
 = 0;

428 
	}
}

430 
	$wwvüudio_ˇn˚l_music
()

432 
	`wwvüudio_ˇn˚l_sound
(
WWVIAUDIO_MUSIC_SLOT
);

433 
	}
}

435 
	$wwvüudio_ˇn˚l_Æl_sounds
()

437 
i
;

438 i‡(!
sound_w‹kög
)

440 
i
 = 0; i < 
max_c⁄cuºít_sounds
; i++)

441 
audio_queue
[
i
].
a˘ive
 = 0;

442 
	}
}

444 
	$wwvüudio_£t_sound_devi˚
(
devi˚
)

446 
sound_devi˚
 = 
devi˚
;

448 
	}
}

452 
	$wwvüudio_öôülize_p‹èudio
(Ë{  0; 
	}
}

453 
	$wwvüudio_°›_p‹èudio
(Ë{ ; 
	}
}

454 
	$wwvüudio_£t_nomusic
(Ë{ ; 
	}
}

455 
	$wwvüudio_ªad_ogg_˛ù
(
˛ùnum
, *
fûíame
Ë{  0; 
	}
}

457 
	$wwvüudio_∑u£_audio
(Ë{ ; 
	}
}

458 
	$wwvüudio_ªsume_audio
(Ë{ ; 
	}
}

460 
	$wwvüudio_sûí˚_music
(Ë{ ; 
	}
}

461 
	$wwvüudio_ªsume_music
(Ë{ ; 
	}
}

462 
	$wwvüudio_sûí˚_sound_ef„˘s
(Ë{ ; 
	}
}

463 
	$wwvüudio_ªsume_sound_ef„˘s
(Ë{ ; 
	}
}

464 
	$wwvüudio_toggÀ_sound_ef„˘s
(Ë{ ; 
	}
}

466 
	$wwvüudio_∂ay_music
(
which_sound
Ë{  0; 
	}
}

467 
	$wwvüudio_ˇn˚l_music
(Ë{ ; 
	}
}

468 
	$wwvüudio_toggÀ_music
(Ë{ ; 
	}
}

469 
	$wwvüudio_add_sound
(
which_sound
Ë{  0; 
	}
}

470 
	$wwvüudio_add_sound_low_¥i‹ôy
(
which_sound
Ë{ ; 
	}
}

471 
	$wwvüudio_ˇn˚l_sound
(
queue_íåy
Ë{ ; 
	}
}

472 
	$wwvüudio_ˇn˚l_Æl_sounds
(Ë{ ; 
	}
}

473 
	$wwvüudio_£t_sound_devi˚
(
devi˚
Ë{  0; 
	}
}

	@ccan/ccan/wwviaudio/wwviaudio.h

1 #i‚de‡
_WWVIAUDIO_H_


2 
	#_WWVIAUDIO_H_


	)

24 #ifde‡
WWVIAUDIO_DEFINE_GLOBALS


25 
	#GLOBAL


	)

27 
	#GLOBAL
 

	)

30 
	#WWVIAUDIO_MUSIC_SLOT
 (0)

	)

31 
	#WWVIAUDIO_SAMPLE_RATE
 (44100)

	)

32 
	#WWVIAUDIO_ANY_SLOT
 (-1)

	)

40 
GLOBAL
 
wwvüudio_£t_nomusic
();

49 
GLOBAL
 
wwvüudio_£t_sound_devi˚
(
devi˚
);

59 
GLOBAL
 
wwvüudio_öôülize_p‹èudio
(
maximum_c⁄cuºít_sounds
,

60 
maximum_sound_˛ùs
);

65 
GLOBAL
 
wwvüudio_°›_p‹èudio
();

77 
GLOBAL
 
wwvüudio_ªad_ogg_˛ù
(
sound_numbî
, *
fûíame
);

84 
GLOBAL
 
wwvüudio_∑u£_audio
();

87 
GLOBAL
 
wwvüudio_ªsume_audio
();

96 
GLOBAL
 
wwvüudio_∂ay_music
(
sound_numbî
);

99 
GLOBAL
 
wwvüudio_sûí˚_music
();

102 
GLOBAL
 
wwvüudio_ªsume_music
();

105 
GLOBAL
 
wwvüudio_toggÀ_music
();

108 
GLOBAL
 
wwvüudio_ˇn˚l_music
();

118 
GLOBAL
 
wwvüudio_add_sound
(
sound_numbî
);

124 
GLOBAL
 
wwvüudio_add_sound_low_¥i‹ôy
(
sound_numbî
);

127 
GLOBAL
 
wwvüudio_sûí˚_sound_ef„˘s
();

130 
GLOBAL
 
wwvüudio_ªsume_sound_ef„˘s
();

133 
GLOBAL
 
wwvüudio_toggÀ_sound_ef„˘s
();

136 
GLOBAL
 
wwvüudio_ˇn˚l_sound
(
ch™√l
);

140 
GLOBAL
 
wwvüudio_ˇn˚l_Æl_sounds
();

170 #unde‡
GLOBAL


	@ccan/junkcode/codedr@gmail.com-grok/grok.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<°rög.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<î∫o.h
>

22 
	$maö
(
¨gc
, **
¨gv
)

24 
i
, 
dc
 = 0, 
fd
;

25 
sz
, 
˙t
, 
off£t
;

26 *
‚
;

27 *
buf
, *
d©a
;

30 i‡(3 > 
¨gc
) {

31 
	`Âuts
("ußge: grok f¿off£à[cd©a]+\n", 
°dîr
);

32 
	`exô
(1);

34 
‚
 = 
¨gv
[1];

35 
off£t
 = 
	`°πﬁ
(
¨gv
[2], 
NULL
, 16);

36 
d©a
 = (*Ë
	`ˇŒoc
(
¨gc
 - 2, ());

37 
i
 = 3; i < 
¨gc
; i++) {

38 
x
;

39 
x
 = 
	`°πﬁ
(
¨gv
[
i
], 
NULL
, 16);

40 
d©a
[
dc
++] = 0xf‡& 
x
;

43 i‡(0 > (
fd
 = 
	`›í
(
‚
, 
O_RDWR
))) {

44 
	`Ârötf
(
°dîr
, "ˇ¬Ÿ o≥¿%s,Éºnÿ%d\n", 
‚
, 
î∫o
);

45 
	`exô
(2);

48 i‡(0 > 
	`l£ek
(
fd
, 
off£t
, 
SEEK_SET
)) {

49 
	`Ârötf
(
°dîr
, "ˇ¬Ÿ sìkÅÿ%x,Éºnÿ%d\n", 
off£t
, 
î∫o
);

50 
	`exô
(2);

53 
buf
 = (*Ë
	`ˇŒoc
(
dc
, ());

55 i‡(0 > (
˙t
 = 
	`ªad
(
fd
, 
buf
, 
dc
))) {

56 
	`Ârötf
(
°dîr
, "cannotÑead %d bytesát %x,Érrno %d\n",

57 
dc
, 
off£t
, 
î∫o
);

58 
	`exô
(3);

60 
	`¥ötf
("ªad %d o‡%d byãs\n", 
˙t
, 
dc
);

63 i‡(0 > 
	`l£ek
(
fd
, 
off£t
, 
SEEK_SET
)) {

64 
	`Ârötf
(
°dîr
, "ˇ¬Ÿ sìkÅÿ%x,Éºnÿ%d\n", 
off£t
, 
î∫o
);

65 
	`exô
(2);

68 i‡(0 > (
sz
 = 
	`wrôe
(
fd
, 
d©a
, 
˙t
))) {

69 
	`Ârötf
(
°dîr
, "cannot write %d bytesát %x,Érrno %d\n",

70 
˙t
, 
off£t
, 
î∫o
);

71 
	`exô
(4);

73 
	`¥ötf
("wrŸê%d o‡%d byãs\n", 
sz
, 
˙t
);

74 
	`exô
(0);

75 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_array.h

24 #i‚de‡
_C_ARRAY_H_


25 
	#_C_ARRAY_H_


	)

27 
	s˛ib_¨øy
 {

28 
	mno_max_ñemíts
;

29 
	mno_of_ñemíts
;

30 
˛ib_obje˘
** 
	mpEÀmíts
;

31 
˛ib_com∑ª
 
	mcom∑ª_‚
;

32 
˛ib_de°roy
 
	mde°ru˘_‚
;

35 
˛ib_¨øy
* 
√w_˛ib_¨øy
 ( 
öô_size
, 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
);

36 
˛ib_îr‹
 
push_back_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, *
ñem
, 
size_t
 
ñem_size
);

37 
˛ib_îr‹
 
ñemít_©_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
, 
pos
, **
e
);

38 
˛ib_îr‹
 
ö£π_©_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, 
ödex
, *
ñem
, 
size_t
 
ñem_size
);

39 
size_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
);

40 
ˇ∑côy_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
 );

41 
˛ib_boﬁ
 
em±y_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
);

42 
˛ib_îr‹
 
ª£rve_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
, 
pos
);

43 
˛ib_îr‹
 
‰⁄t_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
,*
ñem
);

44 
˛ib_îr‹
 
back_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
,*
ñem
);

45 
˛ib_îr‹
 
ªmove_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, 
pos
);

46 
˛ib_îr‹
 
dñëe_˛ib_¨øy
–
˛ib_¨øy
 *
pAºay
);

47 
sw≠_ñemít_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, 
À·
, 
right
);

48 
f‹_óch_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, (*
‚
)(*));

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_deque.h

24 #i‚de‡
_C_DEQUE_H_


25 
	#_C_DEQUE_H_


	)

27 
	s˛ib_deque
 {

28 
˛ib_obje˘
**
	mpEÀmíts
;

29 
	mno_max_ñemíts
;

30 
	mhód
;

31 
	mèû
;

32 
	mno_of_ñemíts
;

33 
˛ib_com∑ª
 
	mcom∑ª_‚
;

34 
˛ib_de°roy
 
	mde°ru˘_‚
;

35 }
	gc_deque
;

37 
˛ib_deque
* 
√w_˛ib_deque
–
deq_size
 , 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
);

38 
˛ib_îr‹
 
push_back_˛ib_deque
 (
˛ib_deque
 *
pDeq
, *
ñem
, 
size_t
 
ñem_size
);

39 
˛ib_îr‹
 
push_‰⁄t_˛ib_deque
(
˛ib_deque
 *
pDeq
, *
ñem
,
size_t
 
ñem_size
);

41 
˛ib_îr‹
 
‰⁄t_˛ib_deque
 (
˛ib_deque
 *
pDeq
,*);

42 
˛ib_îr‹
 
back_˛ib_deque
 (
˛ib_deque
 *
pDeq
,*);

43 
˛ib_îr‹
 
p›_back_˛ib_deque
 (
˛ib_deque
 *
pDeq
);

44 
˛ib_îr‹
 
p›_‰⁄t_˛ib_deque
 (
˛ib_deque
 *
pDeq
);

45 
˛ib_boﬁ
 
em±y_˛ib_deque
 (
˛ib_deque
 *
pDeq
);

46 
size_˛ib_deque
 ( 
˛ib_deque
 *
pDeq
);

47 
˛ib_îr‹
 
dñëe_˛ib_deque
 ( 
˛ib_deque
 *
pDeq
);

48 
˛ib_îr‹
 
ñemít_©_˛ib_deque
 (
˛ib_deque
 *
pDeq
, 
ödex
, **
ñem
);

49 
f‹_óch_˛ib_deque
 ( 
˛ib_deque
 *
pDeq
, (*
‚
)(*));

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_errors.h

24 #i‚de‡
_C_ERRORS_H_


25 
	#_C_ERRORS_H_


	)

30 
	#CLIB_ERROR_SUCCESS
 0

	)

31 
	#CLIB_ERROR_ERROR
 1

	)

32 
	#CLIB_ERROR_MEMORY
 2

	)

33 
	#CLIB_ELEMENT_RETURN_ERROR
 3

	)

37 
	#CLIB_ARRAY_NOT_INITIALIZED
 101

	)

38 
	#CLIB_ARRAY_INDEX_OUT_OF_BOUND
 102

	)

39 
	#CLIB_ARRAY_INSERT_FAILED
 103

	)

41 
	#CLIB_DEQUE_NOT_INITIALIZED
 201

	)

42 
	#CLIB_DEQUE_INDEX_OUT_OF_BOUND
 202

	)

44 
	#CLIB_RBTREE_NOT_INITIALIZED
 401

	)

45 
	#CLIB_RBTREE_KEY_DUPLICATE
 401

	)

46 
	#CLIB_RBTREE_KEY_NOT_FOUND
 402

	)

48 
	#CLIB_SET_NOT_INITIALIZED
 501

	)

49 
	#CLIB_SET_INVALID_INPUT
 502

	)

51 
	#CLIB_MAP_NOT_INITIALIZED
 501

	)

52 
	#CLIB_MAP_INVALID_INPUT
 502

	)

54 
	#CLIB_SLIST_INSERT_FAILED
 601

	)

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_heap.h

23 #i‚de‡
_C_HEAP_H


24 
	#_C_HEAP_H


	)

26 
	s˛ib_hóp
 {

27 
˛ib_¨øy
 *
	mpHópPå
;

28 
	mhóp_∑ª¡
;

29 
	mhóp_À·
;

30 
	mhóp_right
;

33 
˛ib_hóp
 *
√w_˛ib_hóp
–
deÁu…_size
, 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
 );

34 
dñëe_˛ib_hóp
–
˛ib_hóp
 *
pHóp
);

35 
ö£π_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
, *
ñem
, 
size_t
 
ñem_size
);

36 
buûd_max_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
 );\

37 
buûd_mö_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
 );

38 *
exåa˘_max_˛ib_hóp
–
˛ib_hóp
 *
pHóp
);

39 *
exåa˘_mö_˛ib_hóp
–
˛ib_hóp
 *
pHóp
);

40 
˛ib_boﬁ
 
em±y_˛ib_hóp
–
˛ib_hóp
 *
pHóp
);

41 
f‹_óch_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
, (*
‚
)(*));

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_lib.h

24 #i‚de‡
_C_LIB_H_


25 
	#_C_LIB_H_


	)

27 
	~"c_îr‹s.h
"

28 
	~<°dlib.h
>

34 (*
	t˛ib_de°roy
)(*);

35 (*
	t˛ib_com∑ª
)(*,*);

36 (*
	t˛ib_åavîßl
)( *);

38 
	t˛ib_îr‹
;

39 
	t˛ib_boﬁ
;

41 
	#˛ib_bœck
 0

	)

42 
	#˛ib_ªd
 1

	)

43 
	#˛ib_åue
 1

	)

44 
	#˛ib_Ál£
 0

	)

50 
	s˛ib_obje˘
 {

51 * 
øw_d©a
;

52 
size_t
 
size
;

55 
	~"c_¨øy.h
"

56 
	~"c_deque.h
"

57 
	~"c_rb.h
"

58 
	~"c_£t.h
"

59 
	~"c_m≠.h
"

60 
	~"c_¶i°.h
"

61 
	~"c_m≠.h
"

62 
	~"c_°ack.h
"

63 
	~"c_hóp.h
"

69 
	`˛ib_c›y
 ( *
de°ö©i⁄
, *
sour˚
, 
size_t
 
size
 );

70 
	`˛ib_gë
 ( *
de°ö©i⁄
, *
sour˚
, 
size_t
 
size
);

71 * 
	`˛ib_°rdup
 ( *
±r
 );

73 
˛ib_obje˘
* 
	`√w_˛ib_obje˘
 (*
öObje˘
, 
size_t
 
obj_size
);

74 
˛ib_îr‹
 
	`gë_øw_˛ib_obje˘
 (
˛ib_obje˘
 *
öObje˘
, **
ñem
);

75 
	`dñëe_˛ib_obje˘
 (
˛ib_obje˘
* 
öObje˘
 );

76 
	`ª∂a˚_øw_˛ib_obje˘
(
˛ib_obje˘
* 
cuºít_obje˘
,*
ñem
, 
size_t
 
ñem_size
);

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_map.h

24 #i‚de‡
_C_MAP_H_


25 
	#_C_MAP_H_


	)

27 
	s˛ib_m≠
 {

28 
˛ib_rb
* 
	mroŸ
;

32 
˛ib_m≠
* 
√w_˛ib_m≠
 ( 
˛ib_com∑ª
 
‚_˛ib_k
, 
˛ib_de°roy
 
‚_k_d
, clib_de°roy 
‚_v_d
);

33 
˛ib_îr‹
 
ö£π_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
, 
size_t
 
key_size
, *
vÆue
, size_à
vÆue_size
);

34 
˛ib_boﬁ
 
exi°s_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
);

35 
˛ib_îr‹
 
ªmove_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
);

36 
˛ib_boﬁ
 
föd_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
, **
vÆue
);

37 
˛ib_îr‹
 
dñëe_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
);

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_rb.h

24 #i‚de‡
_C_RB_H_


25 
	#_C_RB_H_


	)

27 
	s˛ib_rb_node
 {

28 
˛ib_rb_node
 *
	mÀ·
;

29 
˛ib_rb_node
 *
	mright
;

30 
˛ib_rb_node
 *
	m∑ª¡
;

31 
	mcﬁ‹
;

32 
˛ib_obje˘
* 
	mkey
;

33 
˛ib_obje˘
* 
	mvÆue
;

36 
	s˛ib_rb
 {

37 
˛ib_rb_node
* 
	mroŸ
;

38 
˛ib_rb_node
 
	m£¡öñ
;

39 
˛ib_de°roy
 
	mde°ru˘_k_‚
;

40 
˛ib_de°roy
 
	mde°ru˘_v_‚
;

41 
˛ib_com∑ª
 
	mcom∑ª_‚
;

44 
˛ib_rb
* 
√w_˛ib_rb
(
˛ib_com∑ª
 
‚_c
,
˛ib_de°roy
 
‚_ed
, clib_de°roy 
‚_vd
 );

45 
˛ib_îr‹
 
ö£π_˛ib_rb
(
˛ib_rb
 *
pTªe
, *
key
, 
size_t
 
key_size
, *
vÆue
, size_à
vÆue_size
);

46 
˛ib_rb_node
* 
föd_˛ib_rb
 (
˛ib_rb
 *
pTªe
, *
key
);

47 
˛ib_rb_node
* 
ªmove_˛ib_rb
 (
˛ib_rb
 *
pTªe
, *
key
);

48 
˛ib_îr‹
 
dñëe_˛ib_rb
 (
˛ib_rb
 *
pTªe
);

49 
˛ib_boﬁ
 
em±y_˛ib_rb
 (
˛ib_rb
 *
pTªe
);

51 
˛ib_rb_node
 *
möimum_˛ib_rb
–
˛ib_rb
 *
pTªe
, ˛ib_rb_nodê*
x
 );

52 
˛ib_rb_node
 *
maximum_˛ib_rb
–
˛ib_rb
 *
pTªe
, ˛ib_rb_nodê*
x
 );

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_set.h

24 #i‚de‡
_C_SET_H_


25 
	#_C_SET_H_


	)

27 
	s˛ib_£t
 {

28 
˛ib_rb
* 
	mroŸ
;

31 
˛ib_£t
* 
√w_˛ib_£t
–
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
);

32 
˛ib_îr‹
 
ö£π_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
, 
size_t
 
key_size
);

33 
˛ib_boﬁ
 
exi°s_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
);

34 
˛ib_îr‹
 
ªmove_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
);

35 
˛ib_boﬁ
 
föd_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
, * 
outKey
);

36 
˛ib_îr‹
 
dñëe_˛ib_£t
 ( 
˛ib_£t
 *
pSë
);

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_slist.h

24 #i‚de‡
_C_SLIST_H_


25 
	#_C_SLIST_H_


	)

27 
	s˛ib_¶i°_node
 {

28 
˛ib_obje˘
* 
	mñem
;

29 
˛ib_¶i°_node
 *
	m√xt
;

32 
	s˛ib_¶i°
 {

33 
˛ib_¶i°_node
* 
	mhód
;

34 
˛ib_de°roy
 
	mde°ru˘_‚
;

35 
˛ib_com∑ª
 
	mcom∑ª_‚
;

36 
	msize
;

40 
˛ib_¶i°
* 
√w_˛ib_¶i°
(
˛ib_de°roy
 
‚_d
, 
˛ib_com∑ª
 
‚_c
);

41 
dñëe_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
);

42 
˛ib_îr‹
 
ö£π_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
, 
pos
, *
ñem
, 
size_t
 
ñem_size
);

43 
˛ib_îr‹
 
push_back_˛ib_¶i°
(
˛ib_¶i°
 *
pSli°
, *
ñem
, 
size_t
 
ñem_size
);

44 
ªmove_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
, 
pos
);

45 
f‹_óch_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
, (*
‚
)(* ));

46 
˛ib_boﬁ
 
	`föd_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
, * 
föd_vÆue
, **
out_vÆue
);

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_stack.h

23 #i‚de‡
_C_STACK_H


24 
	#_C_STACK_H


	)

26 
	s˛ib_°ack
 {

27 
˛ib_¨øy
 *
	mpSèckAº
;

30 
˛ib_°ack
 *
√w_˛ib_°ack
–
deÁu…_size
, 
˛ib_de°roy
 
‚_d
);

31 
dñëe_˛ib_°ack
(
˛ib_°ack
 *
pSèck
);

32 
push_˛ib_°ack
(
˛ib_°ack
 *
pSèck
, *
ñem
, 
size_t
 
ñem_size
);

33 
p›_˛ib_°ack
(
˛ib_°ack
 *
pSèck
, **
ñem
);

34 
˛ib_boﬁ
 
em±y_˛ib_°ack
 ( 
˛ib_°ack
 *
pSèck
);

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_array.c

24 
	~"c_lib.h
"

25 
	~<°rög.h
>

26 
	~<°dio.h
>

29 
˛ib_¨øy
*

30 
	$¨øy_check_™d_grow
 ( 
˛ib_¨øy
* 
pAºay
) {

31 i‡–
pAºay
->
no_of_ñemíts
 >pAºay->
no_max_ñemíts
 ) {

32 
pAºay
->
no_max_ñemíts
 = 2 *ÖArray->no_max_elements;

33 
pAºay
->
pEÀmíts
 = (
˛ib_obje˘
**Ë
	`ªÆloc
 (ÖArray->pElements,

34 
pAºay
->
no_max_ñemíts
 *  ( 
˛ib_obje˘
*));

36  
pAºay
;

37 
	}
}

39 
˛ib_¨øy
*

40 
	$√w_˛ib_¨øy
(
¨øy_size
, 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
) {

42 
˛ib_¨øy
* 
pAºay
 = (˛ib_¨øy*)
	`mÆloc
((clib_array));

43 i‡–! 
pAºay
 )

44  (
˛ib_¨øy
*)0;

46 
pAºay
->
no_max_ñemíts
 = 
¨øy_size
 < 8 ? 8 :árray_size;

47 
pAºay
->
pEÀmíts
 = (
˛ib_obje˘
**Ë
	`mÆloc
’Aºay->
no_max_ñemíts
 * (clib_object*));

48 i‡–! 
pAºay
->
pEÀmíts
 ){

49 
	`‰ì
 ( 
pAºay
 );

50  (
˛ib_¨øy
*)0;

52 
pAºay
->
com∑ª_‚
 = 
‚_c
;

53 
pAºay
->
de°ru˘_‚
 = 
‚_d
;

54 
pAºay
->
no_of_ñemíts
 = 0;

56  
pAºay
;

57 
	}
}

59 
˛ib_îr‹


60 
	$ö£π_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
, 
ödex
, *
ñem
, 
size_t
 
ñem_size
) {

62 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

63 
˛ib_obje˘
* 
pObje˘
 = 
	`√w_˛ib_obje˘
 ( 
ñem
, 
ñem_size
 );

64 i‡–! 
pObje˘
 )

65  
CLIB_ARRAY_INSERT_FAILED
;

67 
pAºay
->
pEÀmíts
[
ödex
] = 
pObje˘
;

68 
pAºay
->
no_of_ñemíts
++;

69  
rc
;

70 
	}
}

72 
˛ib_îr‹


73 
	$push_back_˛ib_¨øy
 (
˛ib_¨øy
* 
pAºay
, *
ñem
, 
size_t
 
ñem_size
) {

74 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

76 i‡–! 
pAºay
)

77  
CLIB_ARRAY_NOT_INITIALIZED
;

79 
	`¨øy_check_™d_grow
 ( 
pAºay
);

81 
rc
 = 
	`ö£π_˛ib_¨øy
–
pAºay
,ÖAºay->
no_of_ñemíts
, 
ñem
, 
ñem_size
);

83  
rc
;

84 
	}
}

86 
˛ib_îr‹


87 
	$ñemít_©_˛ib_¨øy
 (
˛ib_¨øy
* 
pAºay
, 
ödex
, ** 
ñem
) {

88 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

90 i‡–! 
pAºay
 )

91  
CLIB_ARRAY_NOT_INITIALIZED
;

93 i‡–
ödex
 < 0 || index >
pAºay
->
no_of_ñemíts
 )

94  
CLIB_ARRAY_INDEX_OUT_OF_BOUND
;

96 
	`gë_øw_˛ib_obje˘
 ( 
pAºay
->
pEÀmíts
[
ödex
], 
ñem
 );

97  
rc
;

98 
	}
}

101 
	$size_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
 ) {

102 i‡–
pAºay
 =(
˛ib_¨øy
*)0 )

104  
pAºay
->
no_of_ñemíts
;

105 
	}
}

108 
	$ˇ∑côy_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
 ) {

109 i‡–
pAºay
 =(
˛ib_¨øy
*)0 )

111  
pAºay
->
no_max_ñemíts
;

112 
	}
}

114 
˛ib_boﬁ


115 
	$em±y_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
) {

116 i‡–
pAºay
 =(
˛ib_¨øy
*)0 )

118 i‡–
pAºay
->
no_of_ñemíts
 == 0 )

119  
˛ib_åue
;

121  
˛ib_Ál£
;

122 
	}
}

124 
˛ib_îr‹


125 
	$ª£rve_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
, 
√w_size
) {

126 i‡–
pAºay
 =(
˛ib_¨øy
*)0 )

127  
CLIB_ARRAY_NOT_INITIALIZED
;

129 i‡–
√w_size
 <
pAºay
->
no_max_ñemíts
 )

130  
CLIB_ERROR_SUCCESS
;

132 
	`¨øy_check_™d_grow
 ( 
pAºay
);

133  
CLIB_ERROR_SUCCESS
;

135 
	}
}

137 
˛ib_îr‹


138 
	$‰⁄t_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
,*
ñem
) {

139  
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
, 0, 
ñem
 );

140 
	}
}

142 
˛ib_îr‹


143 
	$back_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
,*
ñem
) {

144  
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
,ÖAºay->
no_of_ñemíts
 - 1, 
ñem
 );

145 
	}
}

147 
˛ib_îr‹


148 
	$ö£π_©_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
, 
ödex
, *
ñem
, 
size_t
 
ñem_size
) {

149 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

150 i‡–! 
pAºay
 )

151  
CLIB_ARRAY_NOT_INITIALIZED
;

153 i‡–
ödex
 < 0 || index > 
pAºay
->
no_max_ñemíts
 )

154  
CLIB_ARRAY_INDEX_OUT_OF_BOUND
;

156 
	`¨øy_check_™d_grow
 ( 
pAºay
);

158 
	`memmove
 ( &(
pAºay
->
pEÀmíts
[
ödex
 + 1]),

159 &
pAºay
->
pEÀmíts
[
ödex
],

160 (
pAºay
->
no_of_ñemíts
 - 
ödex
 ) * (
˛ib_obje˘
*));

162 
rc
 = 
	`ö£π_˛ib_¨øy
 ( 
pAºay
, 
ödex
, 
ñem
 , 
ñem_size
);

164  
rc
;

165 
	}
}

167 
˛ib_îr‹


168 
	$ªmove_˛ib_¨øy
 ( 
˛ib_¨øy
* 
pAºay
, 
ödex
) {

169 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

171 i‡–! 
pAºay
 )

172  
rc
;

173 i‡–
ödex
 < 0 || index >
pAºay
->
no_of_ñemíts
 )

174  
CLIB_ARRAY_INDEX_OUT_OF_BOUND
;

176 i‡–
pAºay
->
de°ru˘_‚
 ) {

177 *
ñem
;

178 i‡–
CLIB_ERROR_SUCCESS
 =
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
, 
ödex
 , &
ñem
 ) ) {

179 
pAºay
->
	`de°ru˘_‚
(
ñem
);

182 
	`dñëe_˛ib_obje˘
 ( 
pAºay
->
pEÀmíts
[
ödex
]);

184 i‡–
ödex
 !
pAºay
->
no_of_ñemíts
 - 1 ) {

185 
	`memmove
 ( &(
pAºay
->
pEÀmíts
[
ödex
]),

186 &
pAºay
->
pEÀmíts
[
ödex
 + 1],

187 (
pAºay
->
no_of_ñemíts
 - 
ödex
 ) * (
˛ib_obje˘
*));

189 
pAºay
->
no_of_ñemíts
--;

190  
rc
;

191 
	}
}

193 
˛ib_îr‹


194 
	$dñëe_˛ib_¨øy
–
˛ib_¨øy
* 
pAºay
) {

195 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

196 
i
 = 0;

198 i‡–
pAºay
 =(
˛ib_¨øy
*)0 )

199  
rc
;

201 i‡–
pAºay
->
de°ru˘_‚
 ) {

202  
i
 = 0; i < 
pAºay
->
no_of_ñemíts
; i++) {

203 *
ñem
;

204 i‡–
CLIB_ERROR_SUCCESS
 =
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
, 
i
 , &
ñem
 ) )

205 
pAºay
->
	`de°ru˘_‚
(
ñem
);

208  
i
 = 0; i < 
pAºay
->
no_of_ñemíts
; i++)

209 
	`dñëe_˛ib_obje˘
 ( 
pAºay
->
pEÀmíts
[
i
]);

211 
	`‰ì
 ( 
pAºay
->
pEÀmíts
);

212 
	`‰ì
 ( 
pAºay
 );

213  
rc
;

214 
	}
}

217 
	$sw≠_ñemít_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, 
À·
, 
right
) {

218 
˛ib_obje˘
 *
ãmp
 = 
pAºay
->
pEÀmíts
[
À·
];

219 
pAºay
->
pEÀmíts
[
À·
] =ÖAºay->pEÀmíts[
right
];

220 
pAºay
->
pEÀmíts
[
right
] = 
ãmp
;

221 
	}
}

223 
f‹_óch_˛ib_¨øy
 ( 
˛ib_¨øy
 *
pAºay
, (*
‚
)(*)) {

224 
size
 = 
pAºay
->
no_of_ñemíts
;

225 
i
 = 0;

226  
i
 = 0; i < 
size
; i++ ) {

227 *
ñem
;

228 
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
, 
i
 , &
ñem
);

229 (
‚
)(
ñem
);

230 
	`‰ì
 ( 
ñem
 );

232 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_deque.c

24 
	~"c_lib.h
"

26 
	~<°rög.h
>

28 
	#CLIB_DEQUE_INDEX
(
x
Ë((*)(
pDeq
)->
pEÀmíts
 + ((
˛ib_obje˘
Ë* (x)))

	)

30 
˛ib_îr‹


31 
	$ö£π_˛ib_deque
 ( 
˛ib_deque
 *
pDeq
, 
ödex
, *
ñem
,
size_t
 
ñem_size
) {

32 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

33 
˛ib_obje˘
* 
pObje˘
 = 
	`√w_˛ib_obje˘
 ( 
ñem
, 
ñem_size
 );

34 i‡–! 
pObje˘
 )

35  
CLIB_ARRAY_INSERT_FAILED
;

37 
pDeq
->
pEÀmíts
[
ödex
] = 
pObje˘
;

38 
pDeq
->
no_of_ñemíts
++;

39  
rc
;

40 
	}
}

42 
˛ib_deque
*

43 
	$grow_deque
 ( 
˛ib_deque
 *
pDeq
 ) {

45 
pDeq
->
no_max_ñemíts
 =ÖDeq->no_max_elements * 2;

46 
pDeq
->
pEÀmíts
 = (
˛ib_obje˘
**Ë
	`ªÆloc
 (ÖDeq->pElements,

47 
pDeq
->
no_max_ñemíts
 *  ( 
˛ib_obje˘
*));

48  
pDeq
;

50 
	}
}

51 
˛ib_deque
*

52 
	$√w_˛ib_deque
–
deq_size
 , 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
) {

54 
˛ib_deque
 *
pDeq
 = (˛ib_deque*)
	`mÆloc
((clib_deque));

55 i‡–
pDeq
 =(
˛ib_deque
*)0 )

56  (
˛ib_deque
*)0;

58 
pDeq
->
no_max_ñemíts
 = 
deq_size
 < 8 ? 8 : deq_size;

59 
pDeq
->
pEÀmíts
 = (
˛ib_obje˘
**Ë
	`mÆloc
’Deq->
no_max_ñemíts
 * (clib_object*));

61 i‡–
pDeq
 =(
˛ib_deque
*)0 )

62  (
˛ib_deque
*)0;

64 
pDeq
->
com∑ª_‚
 = 
‚_c
;

65 
pDeq
->
de°ru˘_‚
 = 
‚_d
;

66 
pDeq
->
hód
 = (ÌDeq->
no_max_ñemíts
 / 2;

67 
pDeq
->
èû
 =ÖDeq->
hód
 + 1;

68 
pDeq
->
no_of_ñemíts
 = 0;

70  
pDeq
;

71 
	}
}

72 
˛ib_îr‹


73 
	$push_back_˛ib_deque
(
˛ib_deque
 *
pDeq
, *
ñem
, 
size_t
 
ñem_size
) {

74 i‡–
pDeq
 =(
˛ib_deque
*)0 )

75  
CLIB_DEQUE_NOT_INITIALIZED
;

77 i‡–
pDeq
->
èû
 =pDeq->
no_max_ñemíts
 )

78 
pDeq
 = 
	`grow_deque
(pDeq);

80 
	`ö£π_˛ib_deque
(
pDeq
,ÖDeq->
èû
, 
ñem
, 
ñem_size
);

81 
pDeq
->
èû
++;

83  
CLIB_ERROR_SUCCESS
;

84 
	}
}

85 
˛ib_îr‹


86 
	$push_‰⁄t_˛ib_deque
(
˛ib_deque
 *
pDeq
, *
ñem
,
size_t
 
ñem_size
) {

87 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

88 
to
 = 0;

89 
‰om
 = 0;

90 
cou¡
 = 0;

92 i‡–
pDeq
->
hód
 == 0 ) {

93 
pDeq
 = 
	`grow_deque
(pDeq);

94 
to
 = (
pDeq
->
no_max_ñemíts
 -ÖDeq->
no_of_ñemíts
)/2;

95 
‰om
 = 
pDeq
->
hód
 + 1;

96 
cou¡
 = 
pDeq
->
èû
 - 
‰om
 + 1;

97 
	`memmove
 (&(
pDeq
->
pEÀmíts
[
to
]), &’Deq->pEÀmíts[
‰om
]), 
cou¡
 *  (
˛ib_obje˘
*));

98 
pDeq
->
hód
 = 
to
 - 1;

99 
pDeq
->
èû
 =ÖDeq->
hód
 + 
cou¡
;

101 
	`ö£π_˛ib_deque
(
pDeq
,ÖDeq->
hód
, 
ñem
, 
ñem_size
);

102 
pDeq
->
hód
--;

103  
rc
;

104 
	}
}

106 
˛ib_îr‹


107 
	$‰⁄t_˛ib_deque
 (
˛ib_deque
 *
pDeq
, *
ñem
) {

108 i‡–
pDeq
 =(
˛ib_deque
*)0 )

109  
CLIB_DEQUE_NOT_INITIALIZED
;

110 
	`ñemít_©_˛ib_deque
 ( 
pDeq
,ÖDeq->
hód
 + 1, 
ñem
 );

111  
CLIB_ERROR_SUCCESS
;

112 
	}
}

114 
˛ib_îr‹


115 
	$back_˛ib_deque
 (
˛ib_deque
 *
pDeq
, *
ñem
) {

116 i‡–
pDeq
 =(
˛ib_deque
*)0 )

117  
CLIB_DEQUE_NOT_INITIALIZED
;

118 
	`ñemít_©_˛ib_deque
 ( 
pDeq
,ÖDeq->
èû
 - 1, 
ñem
 );

119  
CLIB_ERROR_SUCCESS
;

120 
	}
}

122 
˛ib_îr‹


123 
	$p›_back_˛ib_deque
 (
˛ib_deque
 *
pDeq
) {

124 i‡–
pDeq
 =(
˛ib_deque
*)0 )

125  
CLIB_DEQUE_NOT_INITIALIZED
;

127 i‡–
pDeq
->
de°ru˘_‚
 ) {

128 *
ñem
;

129 i‡–
	`ñemít_©_˛ib_deque
–
pDeq
,ÖDeq->
èû
 - 1, &
ñem
 ) =
CLIB_ERROR_SUCCESS
 )

130 
pDeq
->
	`de°ru˘_‚
(
ñem
);

132 
	`dñëe_˛ib_obje˘
(
pDeq
->
pEÀmíts
[pDeq->
èû
 - 1]);

133 
pDeq
->
èû
--;

134 
pDeq
->
no_of_ñemíts
--;

136  
CLIB_ERROR_SUCCESS
;

138 
	}
}

140 
˛ib_îr‹


141 
	$p›_‰⁄t_˛ib_deque
(
˛ib_deque
 *
pDeq
) {

143 i‡–
pDeq
 =(
˛ib_deque
*)0 )

144  
CLIB_DEQUE_NOT_INITIALIZED
;

146 i‡–
pDeq
->
de°ru˘_‚
 ) {

147 *
ñem
;

148 i‡–
	`ñemít_©_˛ib_deque
–
pDeq
,ÖDeq->
hód
 + 1, &
ñem
 ) =
CLIB_ERROR_SUCCESS
 )

149 
pDeq
->
	`de°ru˘_‚
(
ñem
);

151 
	`dñëe_˛ib_obje˘
(
pDeq
->
pEÀmíts
[pDeq->
hód
 + 1]);

153 
pDeq
->
hód
++;

154 
pDeq
->
no_of_ñemíts
--;

156  
CLIB_ERROR_SUCCESS
;

157 
	}
}

158 
˛ib_boﬁ


159 
	$em±y_˛ib_deque
 (
˛ib_deque
 *
pDeq
) {

160 i‡–
pDeq
 =(
˛ib_deque
*)0 )

161  
˛ib_åue
;

163  
pDeq
->
no_of_ñemíts
 =0 ? 
˛ib_åue
 : 
˛ib_Ál£
;

164 
	}
}

166 
	$size_˛ib_deque
–
˛ib_deque
 *
pDeq
 ) {

167 i‡–
pDeq
 =(
˛ib_deque
*)0 )

168  
˛ib_åue
;

170  
pDeq
->
no_of_ñemíts
 - 1;

171 
	}
}

173 
˛ib_îr‹


174 
	$ñemít_©_˛ib_deque
 (
˛ib_deque
 *
pDeq
, 
ödex
, **
ñem
) {

176 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

178 i‡–! 
pDeq
 )

179  
CLIB_DEQUE_NOT_INITIALIZED
;

181 
	`gë_øw_˛ib_obje˘
 ( 
pDeq
->
pEÀmíts
[
ödex
], 
ñem
 );

182  
rc
;

183 
	}
}

185 
˛ib_îr‹


186 
	$dñëe_˛ib_deque
 ( 
˛ib_deque
 *
pDeq
 ) {

187 
i
 = 0;

189 i‡–
pDeq
 =(
˛ib_deque
*)0 )

190  
CLIB_ERROR_SUCCESS
;

192 i‡–
pDeq
->
de°ru˘_‚
 ) {

193  
i
 = 
pDeq
->
hód
 + 1; i <ÖDeq->
èû
; i++ ){

194 *
ñem
;

195 i‡–
	`ñemít_©_˛ib_deque
–
pDeq
, 
i
, &
ñem
 ) =
CLIB_ERROR_SUCCESS
 ) {

196 
pDeq
->
	`de°ru˘_‚
(
ñem
);

200  
i
 = 
pDeq
->
hód
 + 1; i <ÖDeq->
èû
; i++ ){

201 
	`dñëe_˛ib_obje˘
(
pDeq
->
pEÀmíts
[
i
]);

203 
	`‰ì
 ( 
pDeq
->
pEÀmíts
);

204 
	`‰ì
 ( 
pDeq
 );

206  
CLIB_ERROR_SUCCESS
;

207 
	}
}

209 
f‹_óch_˛ib_deque
 ( 
˛ib_deque
 *
pDeq
, (*
‚
)(*)) {

210 
ödex
 = 0;

211  
ödex
 = 
pDeq
->
hód
 + 1; index <ÖDeq->
èû
; index++ ){

212 *
ñem
;

213 i‡–
	`ñemít_©_˛ib_deque
–
pDeq
, 
ödex
, &
ñem
 ) =
CLIB_ERROR_SUCCESS
 ) {

214 (
‚
)(
ñem
);

215 
	`‰ì
 ( 
ñem
 );

218 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_heap.c

23 
	~"c_lib.h
"

26 
	$pvt_˛ib_hóp_isLóf
–
pos
 , 
˛ib_hóp
 *
pHóp
) {

27  ( 
pos
 >(
pHóp
->
pHópPå
->
no_of_ñemíts
/2)) && (Öos <ÖHeap->pHeapPtr->no_of_elements );

28 
	}
}

31 
	$pvt_˛ib_hóp_À·chûd
–
pos
 ) {

32  2 * 
pos
 + 1;

33 
	}
}

36 
	$pvt_˛ib_hóp_com∑ª
(
˛ib_¨øy
 *
pAºay
, 
lIndex
 , 
rIndex
) {

37 *
À·
 = (*)0;

38 *
right
 = (*)0;

39 
com∑ª_ªsu…
 = 0;

40 
˛ib_îr‹
 
rc
 = 0;

41 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
, 
lIndex
 , &
À·
);

42 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
pAºay
, 
rIndex
 , &
right
);

43 
com∑ª_ªsu…
 = 
pAºay
->
	`com∑ª_‚
 ( 
À·
, 
right
 );

44 i‡–
À·
 ) 
	`‰ì
 (Üeft );

45 i‡–
right
 ) 
	`‰ì
 (Ñight );

46  
com∑ª_ªsu…
;

47 
	}
}

50 
	$pvt_˛ib_hóp_si·down_max
–
˛ib_hóp
 *
pHóp
, 
pos
 ) {

52 
˛ib_¨øy
 *
pAºay
 = 
pHóp
->
pHópPå
;

53 
n
 = 
pAºay
->
no_of_ñemíts
;

55  !
	`pvt_˛ib_hóp_isLóf
(
pos
, 
pHóp
) ) {

56 
j
 = 
	`pvt_˛ib_hóp_À·chûd
–
pos
 );

57 i‡––
j
 < ( 
n
 - 1) ) &&

58 (
	`pvt_˛ib_hóp_com∑ª
–
pAºay
, 
j
, j+1) == -1)) {

59 
j
++;

61 i‡–
	`pvt_˛ib_hóp_com∑ª
–
pAºay
, 
pos
, 
j
 ) == 1 ||

62 
	`pvt_˛ib_hóp_com∑ª
–
pAºay
, 
pos
, 
j
 ) == 0) ;

64 
	`sw≠_ñemít_˛ib_¨øy
(
pAºay
, 
pos
, 
j
);

65 
pos
 = 
j
;

67 
	}
}

70 
	$pvt_˛ib_hóp_si·down_mö
–
˛ib_hóp
 *
pHóp
, 
pos
 ) {

72 
˛ib_¨øy
 *
pAºay
 = 
pHóp
->
pHópPå
;

73 
n
 = 
pAºay
->
no_of_ñemíts
;

75  !
	`pvt_˛ib_hóp_isLóf
(
pos
, 
pHóp
) ) {

76 
j
 = 
	`pvt_˛ib_hóp_À·chûd
–
pos
 );

77 i‡––
j
 < ( 
n
 - 1) ) &&

78 (
	`pvt_˛ib_hóp_com∑ª
–
pAºay
, 
j
, j+1) == 1)) {

79 
j
++;

81 i‡–
	`pvt_˛ib_hóp_com∑ª
–
pAºay
, 
pos
, 
j
 ) == -1 ||

82 
	`pvt_˛ib_hóp_com∑ª
–
pAºay
, 
pos
, 
j
 ) == 0) ;

84 
	`sw≠_ñemít_˛ib_¨øy
(
pAºay
, 
pos
, 
j
);

85 
pos
 = 
j
;

87 
	}
}

89 
˛ib_hóp
 *

90 
	$√w_˛ib_hóp
–
deÁu…_size
, 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
 ) {

91 
˛ib_hóp
 *
pHóp
 = ( ˛ib_hó∞*Ë
	`mÆloc
 (  ( clib_heap ));

92 
pHóp
->
pHópPå
 = 
	`√w_˛ib_¨øy
 ( 
deÁu…_size
, 
‚_c
, 
‚_d
);

93 
pHóp
->
hóp_À·
 = 0;

94 
pHóp
->
hóp_∑ª¡
 = 0;

95 
pHóp
->
hóp_right
 = 0;

96  
pHóp
;

97 
	}
}

100 
	$dñëe_˛ib_hóp
–
˛ib_hóp
 *
pHóp
) {

101 
	`dñëe_˛ib_¨øy
 ( 
pHóp
->
pHópPå
 );

102 
	`‰ì
 ( 
pHóp
 );

103 
	}
}

106 
	$ö£π_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
, *
ñem
, 
size_t
 
ñem_size
) {

107 
	`push_back_˛ib_¨øy
 ( 
pHóp
->
pHópPå
, 
ñem
, 
ñem_size
);

108 
	}
}

111 
	$buûd_max_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
 ) {

112 
i
 = 0;

113  
i
 = (
pHóp
->
pHópPå
->
no_of_ñemíts
 / 2 ) - 1; i >= 0; i--) {

114 
	`pvt_˛ib_hóp_si·down_max
(
pHóp
, 
i
);

116 
	}
}

118 
	$exåa˘_max_˛ib_hóp
–
˛ib_hóp
 *
pHóp
) {

119 *
ñem
;

120 
	`sw≠_ñemít_˛ib_¨øy
(
pHóp
->
pHópPå
,

122 
pHóp
->
pHópPå
->
no_of_ñemíts
 - 1);

124 
	`back_˛ib_¨øy
–
pHóp
->
pHópPå
, &
ñem
);

125 
	`ªmove_˛ib_¨øy
 ( 
pHóp
->
pHópPå
,ÖHóp->pHópPå->
no_of_ñemíts
 - 1 );

127 i‡(
pHóp
->
pHópPå
->
no_of_ñemíts
 != 0) {

128 
	`pvt_˛ib_hóp_si·down_max
(
pHóp
, 0);

131  
ñem
;

132 
	}
}

135 
	$buûd_mö_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
 ) {

136 
i
 = 0;

137  
i
 = (
pHóp
->
pHópPå
->
no_of_ñemíts
 / 2 ) - 1; i >= 0; i--) {

138 
	`pvt_˛ib_hóp_si·down_mö
(
pHóp
, 
i
);

140 
	}
}

143 
	$exåa˘_mö_˛ib_hóp
–
˛ib_hóp
 *
pHóp
) {

144 *
ñem
;

145 
	`sw≠_ñemít_˛ib_¨øy
(
pHóp
->
pHópPå
,

147 
pHóp
->
pHópPå
->
no_of_ñemíts
 - 1);

149 
	`back_˛ib_¨øy
–
pHóp
->
pHópPå
, &
ñem
);

150 
	`ªmove_˛ib_¨øy
 ( 
pHóp
->
pHópPå
,ÖHóp->pHópPå->
no_of_ñemíts
 - 1 );

152 i‡(
pHóp
->
pHópPå
->
no_of_ñemíts
 != 0) {

153 
	`pvt_˛ib_hóp_si·down_mö
(
pHóp
, 0);

155  
ñem
;

156 
	}
}

157 
˛ib_boﬁ


158 
	$em±y_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
) {

159 i‡–
pHóp
 =–
˛ib_hóp
*)0 )

160  
˛ib_åue
;

162  
pHóp
->
pHópPå
->
no_of_ñemíts
 =0 ? 
˛ib_åue
 : 
˛ib_Ál£
;

163 
	}
}

166 
f‹_óch_˛ib_hóp
 ( 
˛ib_hóp
 *
pHóp
, (*
‚
)(*)) {

167 
size
 = 
	`size_˛ib_¨øy
 ( 
pHóp
->
pHópPå
 );

168 
i
 = 0;

169  
i
 = 0; i < 
size
; i++ ) {

170 *
ñem
;

171 
	`ñemít_©_˛ib_¨øy
 ( 
pHóp
->
pHópPå
, 
i
 , &
ñem
);

172 (
‚
)(
ñem
);

173 
	`‰ì
 ( 
ñem
 );

175 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_map.c

24 
	~"c_lib.h
"

26 
	~<°dio.h
>

29 
˛ib_m≠
*

30 
	$√w_˛ib_m≠
 ( 
˛ib_com∑ª
 
‚_˛ib_k
, 
˛ib_de°roy
 
‚_k_d
,

31 
˛ib_de°roy
 
‚_v_d
) {

33 
˛ib_m≠
 *
pM≠
 = (˛ib_m≠*)
	`mÆloc
((clib_map));

34 i‡(
pM≠
 =(
˛ib_m≠
*)0)

35  (
˛ib_m≠
*)0;

37 
pM≠
->
roŸ
 = 
	`√w_˛ib_rb
 (
‚_˛ib_k
, 
‚_k_d
, 
‚_v_d
);

38 i‡(
pM≠
->
roŸ
 =(
˛ib_rb
*)0)

39  (
˛ib_m≠
*)0;

41  
pM≠
;

42 
	}
}

43 
˛ib_îr‹


44 
	$ö£π_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
, 
size_t
 
key_size
, *
vÆue
, size_à
vÆue_size
) {

45 i‡(
pM≠
 =(
˛ib_m≠
*)0)

46  
CLIB_MAP_NOT_INITIALIZED
;

48  
	`ö£π_˛ib_rb
 ( 
pM≠
->
roŸ
, 
key
, 
key_size
, 
vÆue
, 
vÆue_size
);

49 
	}
}

50 
˛ib_boﬁ


51 
	$exi°s_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
) {

52 
˛ib_boﬁ
 
found
 = 
˛ib_Ál£
;

53 
˛ib_rb_node
* 
node
;

55 i‡(
pM≠
 =(
˛ib_m≠
*)0)

56  
˛ib_Ál£
;

58 
node
 = 
	`föd_˛ib_rb
 ( 
pM≠
->
roŸ
, 
key
);

59 i‡–
node
 !(
˛ib_rb_node
*)0 ) {

60  
˛ib_åue
;

62  
found
;

63 
	}
}

64 
˛ib_îr‹


65 
	$ªmove_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
) {

66 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

67 
˛ib_rb_node
* 
node
;

68 i‡(
pM≠
 =(
˛ib_m≠
*)0)

69  
CLIB_MAP_NOT_INITIALIZED
;

71 
node
 = 
	`ªmove_˛ib_rb
 ( 
pM≠
->
roŸ
, 
key
 );

72 i‡–
node
 !(
˛ib_rb_node
*)0 ) {

73 * 
ªmoved_node
;

74 
	`gë_øw_˛ib_obje˘
 ( 
node
->
key
, &
ªmoved_node
 );

75 
	`‰ì
 ( 
ªmoved_node
);

76 
	`dñëe_˛ib_obje˘
 ( 
node
->
key
 );

78 
	`gë_øw_˛ib_obje˘
 ( 
node
->
vÆue
, &
ªmoved_node
 );

79 
	`‰ì
 ( 
ªmoved_node
);

80 
	`dñëe_˛ib_obje˘
 ( 
node
->
vÆue
);

82 
	`‰ì
 ( 
node
 );

84  
rc
;

85 
	}
}

86 
˛ib_boﬁ


87 
	$föd_˛ib_m≠
 ( 
˛ib_m≠
 *
pM≠
, *
key
, **
vÆue
) {

88 
˛ib_rb_node
* 
node
;

90 i‡(
pM≠
 =(
˛ib_m≠
*)0)

91  
˛ib_Ál£
;

93 
node
 = 
	`föd_˛ib_rb
 ( 
pM≠
->
roŸ
, 
key
);

94 i‡–
node
 =(
˛ib_rb_node
*)0 )

95  
˛ib_Ál£
;

97 
	`gë_øw_˛ib_obje˘
 ( 
node
->
vÆue
, value );

99  
˛ib_åue
;

101 
	}
}

103 
˛ib_îr‹


104 
	$dñëe_˛ib_m≠
 ( 
˛ib_m≠
* 
x
) {

105 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

106 i‡–
x
 !(
˛ib_m≠
*)0 ){

107 
rc
 = 
	`dñëe_˛ib_rb
 ( 
x
->
roŸ
 );

108 
	`‰ì
 ( 
x
 );

110  
rc
;

111 
	}
}

113 
˛ib_rb_node
 *

114 
	$möimum_˛ib_m≠
–
˛ib_m≠
 *
x
 ) {

115  
	`möimum_˛ib_rb
–
x
->
roŸ
, x->root->root);

116 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_rb.c

24 
	~"c_lib.h
"

26 
	~<°dio.h
>

27 
	~<°rög.h
>

28 
	~<as£π.h
>

30 
	#rb_£¡öñ
 &
pTªe
->
£¡öñ


	)

32 
debug_vîify_¥›îtõs
(
˛ib_rb
*);

33 
debug_vîify_¥›îty_1
(
˛ib_rb
*,
˛ib_rb_node
*);

34 
debug_vîify_¥›îty_2
(
˛ib_rb
*,
˛ib_rb_node
*);

35 
debug_node_cﬁ‹
(
˛ib_rb
*,
˛ib_rb_node
* 
n
);

36 
debug_vîify_¥›îty_4
(
˛ib_rb
*,
˛ib_rb_node
*);

37 
debug_vîify_¥›îty_5
(
˛ib_rb
*,
˛ib_rb_node
*);

38 
debug_vîify_¥›îty_5_hñ≥r
(
˛ib_rb
*,
˛ib_rb_node
*,,*);

42 
	$pvt_À·_rŸ©e
(
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
){

43 
˛ib_rb_node
 *
y
;

44 
y
 = 
x
->
right
;

45 
x
->
right
 = 
y
->
À·
;

46 i‡(
y
->
À·
 !
rb_£¡öñ
)

47 
y
->
À·
->
∑ª¡
 = 
x
;

48 i‡(
y
 !
rb_£¡öñ
)

49 
y
->
∑ª¡
 = 
x
->parent;

50 i‡(
x
->
∑ª¡
){

51 i‡(
x
 =x->
∑ª¡
->
À·
)

52 
x
->
∑ª¡
->
À·
 = 
y
;

54 
x
->
∑ª¡
->
right
 = 
y
;

57 
pTªe
->
roŸ
 = 
y
;

58 
y
->
À·
 = 
x
;

59 i‡(
x
 !
rb_£¡öñ
)

60 
x
->
∑ª¡
 = 
y
;

61 
	}
}

63 
	$pvt_right_rŸ©e
(
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
) {

64 
˛ib_rb_node
 *
y
 = 
x
->
À·
;

65 
x
->
À·
 = 
y
->
right
;

66 i‡(
y
->
right
 !
rb_£¡öñ
)

67 
y
->
right
->
∑ª¡
 = 
x
;

68 i‡(
y
 !
rb_£¡öñ
)

69 
y
->
∑ª¡
 = 
x
->parent;

70 i‡(
x
->
∑ª¡
) {

71 i‡(
x
 =x->
∑ª¡
->
right
)

72 
x
->
∑ª¡
->
right
 = 
y
;

74 
x
->
∑ª¡
->
À·
 = 
y
;

77 
pTªe
->
roŸ
 = 
y
;

78 
y
->
right
 = 
x
;

79 i‡(
x
 !
rb_£¡öñ
)

80 
x
->
∑ª¡
 = 
y
;

81 
	}
}

83 
˛ib_rb
*

84 
	$√w_˛ib_rb
(
˛ib_com∑ª
 
‚_c
,
˛ib_de°roy
 
‚_ed
, clib_de°roy 
‚_vd
 ){

86 
˛ib_rb
 *
pTªe
 = (˛ib_rb*)
	`mÆloc
((clib_rb));

87 i‡–
pTªe
 =(
˛ib_rb
*)0 )

88  (
˛ib_rb
*)0;

90 
pTªe
->
com∑ª_‚
 = 
‚_c
;

91 
pTªe
->
de°ru˘_k_‚
 = 
‚_ed
;

92 
pTªe
->
de°ru˘_v_‚
 = 
‚_vd
;

93 
pTªe
->
roŸ
 = 
rb_£¡öñ
;

94 
pTªe
->
£¡öñ
.
À·
 = 
rb_£¡öñ
;

95 
pTªe
->
£¡öñ
.
right
 = 
rb_£¡öñ
;

96 
pTªe
->
£¡öñ
.
∑ª¡
 = (
˛ib_rb_node
*)0 ;

97 
pTªe
->
£¡öñ
.
cﬁ‹
 = 
˛ib_bœck
;

99  
pTªe
;

100 
	}
}

102 
	$pvt_rb_ö£π_fixup
–
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
 ) {

103 
x
 !
pTªe
->
roŸ
 && x->
∑ª¡
->
cﬁ‹
 =
˛ib_ªd
) {

104 i‡(
x
->
∑ª¡
 =x->∑ª¡->∑ª¡->
À·
) {

105 
˛ib_rb_node
 *
y
 = 
x
->
∑ª¡
->∑ª¡->
right
;

106 i‡(
y
->
cﬁ‹
 =
˛ib_ªd
) {

107 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_bœck
;

108 
y
->
cﬁ‹
 = 
˛ib_bœck
;

109 
x
->
∑ª¡
->∑ª¡->
cﬁ‹
 = 
˛ib_ªd
;

110 
x
 = x->
∑ª¡
->parent;

112 i‡(
x
 =x->
∑ª¡
->
right
){

113 
x
 = x->
∑ª¡
;

114 
	`pvt_À·_rŸ©e
 (
pTªe
, 
x
);

116 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_bœck
;

117 
x
->
∑ª¡
->∑ª¡->
cﬁ‹
 = 
˛ib_ªd
;

118 
	`pvt_right_rŸ©e
 (
pTªe
, 
x
->
∑ª¡
->parent);

121 
˛ib_rb_node
 *
y
 = 
x
->
∑ª¡
->∑ª¡->
À·
;

122 i‡(
y
->
cﬁ‹
 =
˛ib_ªd
) {

123 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_bœck
;

124 
y
->
cﬁ‹
 = 
˛ib_bœck
;

125 
x
->
∑ª¡
->∑ª¡->
cﬁ‹
 = 
˛ib_ªd
;

126 
x
 = x->
∑ª¡
->parent;

128 i‡(
x
 =x->
∑ª¡
->
À·
) {

129 
x
 = x->
∑ª¡
;

130 
	`pvt_right_rŸ©e
 (
pTªe
, 
x
);

132 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_bœck
;

133 
x
->
∑ª¡
->∑ª¡->
cﬁ‹
 = 
˛ib_ªd
;

134 
	`pvt_À·_rŸ©e
 (
pTªe
, 
x
->
∑ª¡
->parent);

138 
pTªe
->
roŸ
->
cﬁ‹
 = 
˛ib_bœck
;

139 
	}
}

140 
˛ib_rb_node
*

141 
	$föd_˛ib_rb
 (
˛ib_rb
 *
pTªe
, *
key
) {

142 
˛ib_rb_node
 *
x
 = 
pTªe
->
roŸ
;

144 
x
 !
rb_£¡öñ
) {

145 
c
 = 0;

146 *
cur_key
 ;

147 
	`gë_øw_˛ib_obje˘
 ( 
x
->
key
, &
cur_key
 );

148 
c
 = 
pTªe
->
	`com∑ª_‚
 (
key
, 
cur_key
);

149 
	`‰ì
 ( 
cur_key
 );

150 i‡(
c
 == 0) {

153 
x
 = 
c
 < 0 ? x->
À·
 : x->
right
;

156 i‡–
x
 =
rb_£¡öñ
 )

157  (
˛ib_rb_node
*)0 ;

159  
x
;

160 
	}
}

162 
˛ib_îr‹


163 
	$ö£π_˛ib_rb
(
˛ib_rb
 *
pTªe
, *
k
, 
size_t
 
key_size
, *
v
, size_à
vÆue_size
) {

165 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

166 
˛ib_rb_node
 *
x
;

167 
˛ib_rb_node
 *
y
;

168 
˛ib_rb_node
 *
z
;

170 
x
 = (
˛ib_rb_node
*)
	`mÆloc
 ((clib_rb_node));

171 i‡–
x
 =(
˛ib_rb_node
*)0 )

172  
CLIB_ERROR_MEMORY
;

174 
x
->
À·
 = 
rb_£¡öñ
;

175 
x
->
right
 = 
rb_£¡öñ
;

176 
x
->
cﬁ‹
 = 
˛ib_ªd
;

178 
x
->
key
 = 
	`√w_˛ib_obje˘
 ( 
k
, 
key_size
 );

179 i‡–
v
 ) {

180 
x
->
vÆue
 = 
	`√w_˛ib_obje˘
 ( 
v
, 
vÆue_size
 );

182 
x
->
vÆue
 = (
˛ib_obje˘
*)0;

185 
y
 = 
pTªe
->
roŸ
;

186 
z
 = (
˛ib_rb_node
*)0 ;

188 
y
 !
rb_£¡öñ
) {

189 
c
 = 0;

190 *
cur_key
;

191 * 
√w_key
;

193 
	`gë_øw_˛ib_obje˘
 ( 
y
->
key
, &
cur_key
 );

194 
	`gë_øw_˛ib_obje˘
 ( 
x
->
key
, &
√w_key
 );

196 
c
 = (
pTªe
->
com∑ª_‚
Ë–
√w_key
 , 
cur_key
);

197 
	`‰ì
 ( 
cur_key
 );

198 
	`‰ì
 ( 
√w_key
 );

199 i‡(
c
 == 0) {

201  
CLIB_RBTREE_KEY_DUPLICATE
;

203 
z
 = 
y
;

204 i‡–
c
 < 0 )

205 
y
 = y->
À·
;

207 
y
 = y->
right
;

209 
x
->
∑ª¡
 = 
z
;

210 i‡(
z
) {

211 
c
 = 0;

212 *
cur_key
;

213 * 
√w_key
;

214 
	`gë_øw_˛ib_obje˘
 ( 
z
->
key
, &
cur_key
 );

215 
	`gë_øw_˛ib_obje˘
 ( 
x
->
key
, &
√w_key
 );

217 
c
 = 
pTªe
->
	`com∑ª_‚
–
√w_key
, 
cur_key
);

218 
	`‰ì
 ( 
cur_key
 );

219 
	`‰ì
 ( 
√w_key
 );

220 i‡(
c
 < 0) {

221 
z
->
À·
 = 
x
;

223 
z
->
right
 = 
x
;

227 
pTªe
->
roŸ
 = 
x
;

229 
	`pvt_rb_ö£π_fixup
 (
pTªe
, 
x
);

231 
	`debug_vîify_¥›îtõs
 ( 
pTªe
);

232  
rc
;

233 
	}
}

235 
	$pvt_rb_ªmove_fixup
–
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
 ) {

236 
x
 !
pTªe
->
roŸ
 && x->
cﬁ‹
 =
˛ib_bœck
) {

237 i‡(
x
 =x->
∑ª¡
->
À·
) {

238 
˛ib_rb_node
 *
w
 = 
x
->
∑ª¡
->
right
;

239 i‡(
w
->
cﬁ‹
 =
˛ib_ªd
) {

240 
w
->
cﬁ‹
 = 
˛ib_bœck
;

241 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_ªd
;

242 
	`pvt_À·_rŸ©e
 (
pTªe
, 
x
->
∑ª¡
);

243 
w
 = 
x
->
∑ª¡
->
right
;

245 i‡(
w
->
À·
->
cﬁ‹
 =
˛ib_bœck
 && w->
right
->color == clib_black) {

246 
w
->
cﬁ‹
 = 
˛ib_ªd
;

247 
x
 = x->
∑ª¡
;

249 i‡(
w
->
right
->
cﬁ‹
 =
˛ib_bœck
) {

250 
w
->
À·
->
cﬁ‹
 = 
˛ib_bœck
;

251 
w
->
cﬁ‹
 = 
˛ib_ªd
;

252 
	`pvt_right_rŸ©e
 (
pTªe
, 
w
);

253 
w
 = 
x
->
∑ª¡
->
right
;

255 
w
->
cﬁ‹
 = 
x
->
∑ª¡
->color;

256 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_bœck
;

257 
w
->
right
->
cﬁ‹
 = 
˛ib_bœck
;

258 
	`pvt_À·_rŸ©e
 (
pTªe
, 
x
->
∑ª¡
);

259 
x
 = 
pTªe
->
roŸ
;

262 
˛ib_rb_node
 *
w
 = 
x
->
∑ª¡
->
À·
;

263 i‡(
w
->
cﬁ‹
 =
˛ib_ªd
) {

264 
w
->
cﬁ‹
 = 
˛ib_bœck
;

265 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_ªd
;

266 
	`pvt_right_rŸ©e
 (
pTªe
, 
x
->
∑ª¡
);

267 
w
 = 
x
->
∑ª¡
->
À·
;

269 i‡(
w
->
right
->
cﬁ‹
 =
˛ib_bœck
 && w->
À·
->color == clib_black) {

270 
w
->
cﬁ‹
 = 
˛ib_ªd
;

271 
x
 = x->
∑ª¡
;

273 i‡(
w
->
À·
->
cﬁ‹
 =
˛ib_bœck
) {

274 
w
->
right
->
cﬁ‹
 = 
˛ib_bœck
;

275 
w
->
cﬁ‹
 = 
˛ib_ªd
;

276 
	`pvt_À·_rŸ©e
 (
pTªe
, 
w
);

277 
w
 = 
x
->
∑ª¡
->
À·
;

279 
w
->
cﬁ‹
 = 
x
->
∑ª¡
->color;

280 
x
->
∑ª¡
->
cﬁ‹
 = 
˛ib_bœck
;

281 
w
->
À·
->
cﬁ‹
 = 
˛ib_bœck
;

282 
	`pvt_right_rŸ©e
 (
pTªe
, 
x
->
∑ª¡
);

283 
x
 = 
pTªe
->
roŸ
;

287 
x
->
cﬁ‹
 = 
˛ib_bœck
;

288 
	}
}

290 
˛ib_rb_node
*

291 
	$pvt_ªmove_˛ib_rb
(
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
z
 ) {

292 
˛ib_rb_node
 *
x
 = (clib_rb_node*)0 ;

293 
˛ib_rb_node
 *
y
 = (clib_rb_node*)0 ;

295 i‡(
z
->
À·
 =
rb_£¡öñ
 || z->
right
 ==Ñb_sentinel)

296 
y
 = 
z
;

298 
y
 = 
z
->
right
;

299 
y
->
À·
 !
rb_£¡öñ
)

300 
y
 = y->
À·
;

302 i‡(
y
->
À·
 !
rb_£¡öñ
)

303 
x
 = 
y
->
À·
;

305 
x
 = 
y
->
right
;

307 
x
->
∑ª¡
 = 
y
->parent;

308 i‡(
y
->
∑ª¡
)

310 i‡(
y
 =y->
∑ª¡
->
À·
)

311 
y
->
∑ª¡
->
À·
 = 
x
;

313 
y
->
∑ª¡
->
right
 = 
x
;

316 
pTªe
->
roŸ
 = 
x
;

317 i‡(
y
 !
z
) {

318 
˛ib_obje˘
* 
tmp
;

319 
tmp
 = 
z
->
key
;

320 
z
->
key
 = 
y
->key;

321 
y
->
key
 = 
tmp
;

323 
tmp
 = 
z
->
vÆue
;

324 
z
->
vÆue
 = 
y
->value;

325 
y
->
vÆue
 = 
tmp
;

327 i‡(
y
->
cﬁ‹
 =
˛ib_bœck
)

328 
	`pvt_rb_ªmove_fixup
 (
pTªe
, 
x
);

330 
	`debug_vîify_¥›îtõs
 ( 
pTªe
);

331  
y
;

332 
	}
}

334 
˛ib_rb_node
*

335 
	$ªmove_˛ib_rb
 (
˛ib_rb
 *
pTªe
, *
key
) {

336 
˛ib_rb_node
 *
z
 = (clib_rb_node*)0 ;

338 
z
 = 
pTªe
->
roŸ
;

339 
z
 !
rb_£¡öñ
) {

340 
c
 = 0;

341 *
cur_key
;

342 
	`gë_øw_˛ib_obje˘
 ( 
z
->
key
, &
cur_key
 );

343 
c
 = 
pTªe
->
	`com∑ª_‚
 (
key
, 
cur_key
);

344 
	`‰ì
 ( 
cur_key
 );

345 i‡–
c
 == 0) {

349 
z
 = ( 
c
 < 0Ë? z->
À·
 : z->
right
;

352 i‡(
z
 =
rb_£¡öñ
)

353  (
˛ib_rb_node
*)0 ;

354  
	`pvt_ªmove_˛ib_rb
(
pTªe
, 
z
 );

355 
	}
}

357 
	$pvt_dñëe_˛ib_rb_node
 (
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
 ) {

359 *
key
;

360 *
vÆue
;

362 i‡–
pTªe
->
de°ru˘_k_‚
 ) {

363 
	`gë_øw_˛ib_obje˘
 ( 
x
->
key
, &key );

364 
pTªe
->
	`de°ru˘_k_‚
 ( 
key
 );

366 
	`dñëe_˛ib_obje˘
–
x
->
key
 );

368 i‡–
x
->
vÆue
 ) {

369 i‡–
pTªe
->
de°ru˘_v_‚
 ) {

370 
	`gë_øw_˛ib_obje˘
 ( 
x
->
vÆue
, &value);

371 
pTªe
->
	`de°ru˘_v_‚
 ( 
vÆue
 );

373 
	`dñëe_˛ib_obje˘
–
x
->
vÆue
 );

375 
	}
}

377 
˛ib_îr‹


378 
	$dñëe_˛ib_rb
(
˛ib_rb
 *
pTªe
) {

380 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

381 
˛ib_rb_node
 *
z
 = 
pTªe
->
roŸ
;

383 
z
 !
rb_£¡öñ
) {

384 i‡(
z
->
À·
 !
rb_£¡öñ
)

385 
z
 = z->
À·
;

386 i‡(
z
->
right
 !
rb_£¡öñ
)

387 
z
 = z->
right
;

389 
	`pvt_dñëe_˛ib_rb_node
 ( 
pTªe
, 
z
 );

390 i‡(
z
->
∑ª¡
) {

391 
z
 = z->
∑ª¡
;

392 i‡(
z
->
À·
 !
rb_£¡öñ
){

393 
	`‰ì
 ( 
z
->
À·
 );

394 
z
->
À·
 = 
rb_£¡öñ
;

395 }i‡(
z
->
right
 !
rb_£¡öñ
){

396 
	`‰ì
 ( 
z
->
right
 );

397 
z
->
right
 = 
rb_£¡öñ
;

400 
	`‰ì
 ( 
z
 );

401 
z
 = 
rb_£¡öñ
;

405 
	`‰ì
 ( 
pTªe
 );

406  
rc
;

407 
	}
}

408 
˛ib_rb_node
 *

409 
	$möimum_˛ib_rb
–
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
 ) {

410  
x
->
À·
 !
rb_£¡öñ
)

411 
x
 = x->
À·
;

412  
x
;

413 
	}
}

415 
˛ib_rb_node
 *

416 
	$maximum_˛ib_rb
–
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
 ) {

417  
x
->
right
 !
rb_£¡öñ
)

418 
x
 = x->
right
;

419  
x
;

420 
	}
}

423 
˛ib_boﬁ


424 
	$em±y_˛ib_rb
(
˛ib_rb
 *
pTªe
) {

425 i‡–
pTªe
->
roŸ
 !
rb_£¡öñ
 )

426  
˛ib_åue
;

427  
˛ib_Ál£
;

428 
	}
}

429 
˛ib_rb_node
*

430 
	$åì_suc˚ss‹
(
˛ib_rb
 *
pTªe
, 
˛ib_rb_node
 *
x
) {

431 
˛ib_rb_node
 *
y
 = (clib_rb_node*)0;

432 i‡–
x
->
right
 !
rb_£¡öñ
)

433  
	`möimum_˛ib_rb
–
pTªe
, 
x
->
right
);

435 i‡–
x
 =
	`maximum_˛ib_rb
(
pTªe
,pTªe->
roŸ
))

436  (
˛ib_rb_node
*)0;

438 
y
 = 
x
->
∑ª¡
;

439  
y
 !
rb_£¡öñ
 && 
x
 =y->
right
 ){

440 
x
 = 
y
;

441 
y
 = y->
∑ª¡
;

443  
y
;

444 
	}
}

447 
	$debug_vîify_¥›îtõs
(
˛ib_rb
* 
t
) {

448 
	`debug_vîify_¥›îty_1
(
t
,t->
roŸ
);

449 
	`debug_vîify_¥›îty_2
(
t
,t->
roŸ
);

450 
	`debug_vîify_¥›îty_4
(
t
,t->
roŸ
);

451 
	`debug_vîify_¥›îty_5
(
t
,t->
roŸ
);

452 
	}
}

454 
	$debug_vîify_¥›îty_1
(
˛ib_rb
 *
pTªe
,
˛ib_rb_node
* 
n
) {

455 
	`as£π
(
	`debug_node_cﬁ‹
(
pTªe
,
n
Ë=
˛ib_ªd
 || debug_node_cﬁ‹’Tªe,nË=
˛ib_bœck
);

456 i‡(
n
 =
rb_£¡öñ
) ;

457 
	`debug_vîify_¥›îty_1
(
pTªe
,
n
->
À·
);

458 
	`debug_vîify_¥›îty_1
(
pTªe
,
n
->
right
);

459 
	}
}

461 
	$debug_vîify_¥›îty_2
(
˛ib_rb
 *
pTªe
,
˛ib_rb_node
* 
roŸ
) {

462 
	`as£π
(
	`debug_node_cﬁ‹
(
pTªe
,
roŸ
Ë=
˛ib_bœck
);

463 
	}
}

465 
	$debug_node_cﬁ‹
(
˛ib_rb
 *
pTªe
,
˛ib_rb_node
* 
n
) {

466  
n
 =
rb_£¡öñ
 ? 
˛ib_bœck
 :Ç->
cﬁ‹
;

467 
	}
}

469 
	$debug_vîify_¥›îty_4
(
˛ib_rb
 *
pTªe
,
˛ib_rb_node
* 
n
) {

470 i‡(
	`debug_node_cﬁ‹
(
pTªe
,
n
Ë=
˛ib_ªd
) {

471 
	`as£π
 (
	`debug_node_cﬁ‹
(
pTªe
,
n
->
À·
Ë=
˛ib_bœck
);

472 
	`as£π
 (
	`debug_node_cﬁ‹
(
pTªe
,
n
->
right
Ë=
˛ib_bœck
);

473 
	`as£π
 (
	`debug_node_cﬁ‹
(
pTªe
,
n
->
∑ª¡
Ë=
˛ib_bœck
);

475 i‡(
n
 =
rb_£¡öñ
) ;

476 
	`debug_vîify_¥›îty_4
(
pTªe
,
n
->
À·
);

477 
	`debug_vîify_¥›îty_4
(
pTªe
,
n
->
right
);

478 
	}
}

480 
	$debug_vîify_¥›îty_5
(
˛ib_rb
 *
pTªe
,
˛ib_rb_node
* 
roŸ
) {

481 
bœck_cou¡_∑th
 = -1;

482 
	`debug_vîify_¥›îty_5_hñ≥r
(
pTªe
,
roŸ
, 0, &
bœck_cou¡_∑th
);

483 
	}
}

485 
	$debug_vîify_¥›îty_5_hñ≥r
(
˛ib_rb
 *
pTªe
,
˛ib_rb_node
* 
n
, 
bœck_cou¡
, * 
∑th_bœck_cou¡
) {

486 i‡(
	`debug_node_cﬁ‹
(
pTªe
,
n
Ë=
˛ib_bœck
) {

487 
bœck_cou¡
++;

489 i‡(
n
 =
rb_£¡öñ
) {

490 i‡(*
∑th_bœck_cou¡
 == -1) {

491 *
∑th_bœck_cou¡
 = 
bœck_cou¡
;

493 
	`as£π
 (
bœck_cou¡
 =*
∑th_bœck_cou¡
);

497 
	`debug_vîify_¥›îty_5_hñ≥r
(
pTªe
,
n
->
À·
, 
bœck_cou¡
, 
∑th_bœck_cou¡
);

498 
	`debug_vîify_¥›îty_5_hñ≥r
(
pTªe
,
n
->
right
, 
bœck_cou¡
, 
∑th_bœck_cou¡
);

499 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_set.c

24 
	~"c_lib.h
"

26 
	~<°dio.h
>

28 
˛ib_£t
*

29 
	$√w_˛ib_£t
 ( 
˛ib_com∑ª
 
‚_c
, 
˛ib_de°roy
 
‚_d
) {

31 
˛ib_£t
 *
pSë
 = (˛ib_£t*)
	`mÆloc
((clib_set));

32 i‡(
pSë
 =(
˛ib_£t
*)0 )

33  (
˛ib_£t
*)0 ;

35 
pSë
->
roŸ
 = 
	`√w_˛ib_rb
 (
‚_c
, 
‚_d
, (*)0);

36 i‡(
pSë
->
roŸ
 =(
˛ib_rb
*)0)

37  (
˛ib_£t
*)0 ;

39  
pSë
;

40 
	}
}

41 
˛ib_îr‹


42 
	$ö£π_˛ib_£t
 (
˛ib_£t
 *
pSë
, *
key
, 
size_t
 
key_size
) {

43 i‡(
pSë
 =(
˛ib_£t
*)0 )

44  
CLIB_SET_NOT_INITIALIZED
;

46  
	`ö£π_˛ib_rb
 ( 
pSë
->
roŸ
, 
key
, 
key_size
, (*)0, 0);

47 
	}
}

48 
˛ib_boﬁ


49 
	$exi°s_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
) {

50 
˛ib_boﬁ
 
found
 = 
˛ib_Ál£
;

51 
˛ib_rb_node
* 
node
;

53 i‡(
pSë
 =(
˛ib_£t
*)0 )

54  
˛ib_Ál£
;

56 
node
 = 
	`föd_˛ib_rb
 ( 
pSë
->
roŸ
, 
key
);

57 i‡–
node
 !(
˛ib_rb_node
*)0 ) {

58  
˛ib_åue
;

60  
found
;

61 
	}
}

62 
˛ib_îr‹


63 
	$ªmove_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
) {

64 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

65 
˛ib_rb_node
* 
node
;

66 i‡(
pSë
 =(
˛ib_£t
*)0 )

67  
CLIB_SET_NOT_INITIALIZED
;

69 
node
 = 
	`ªmove_˛ib_rb
 ( 
pSë
->
roŸ
, 
key
 );

70 i‡–
node
 !(
˛ib_rb_node
*)0 ) {

74  
rc
;

75 
	}
}

76 
˛ib_boﬁ


77 
	$föd_˛ib_£t
 ( 
˛ib_£t
 *
pSë
, *
key
, * 
outKey
) {

78 
˛ib_rb_node
* 
node
;

80 i‡(
pSë
 =(
˛ib_£t
*)0 )

81  
˛ib_Ál£
;

83 
node
 = 
	`föd_˛ib_rb
 ( 
pSë
->
roŸ
, 
key
);

84 i‡–
node
 =(
˛ib_rb_node
*)0 )

85  
˛ib_Ál£
;

87 
	`gë_øw_˛ib_obje˘
 ( 
node
->
key
, 
outKey
 );

89  
˛ib_åue
;

91 
	}
}

93 
˛ib_îr‹


94 
	$dñëe_˛ib_£t
 ( 
˛ib_£t
* 
x
) {

95 
˛ib_îr‹
 
rc
 = 
CLIB_ERROR_SUCCESS
;

96 i‡–
x
 !(
˛ib_£t
*)0 ){

97 
rc
 = 
	`dñëe_˛ib_rb
 ( 
x
->
roŸ
 );

98 
	`‰ì
 ( 
x
 );

100  
rc
;

101 
	}
}

102 
˛ib_rb_node
 *

103 
	$möimum_˛ib_£t
–
˛ib_£t
 *
x
 ) {

104  
	`möimum_˛ib_rb
–
x
->
roŸ
, x->root->root);

105 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_slist.c

24 
	~"c_lib.h
"

26 
˛ib_¶i°
*

27 
	$√w_˛ib_¶i°
(
˛ib_de°roy
 
‚_d
, 
˛ib_com∑ª
 
‚_c
){

28 
˛ib_¶i°
 *
pSli°
 = (˛ib_¶i°*)
	`mÆloc
((clib_slist));

29 
pSli°
->
hód
 = (
˛ib_¶i°_node
*)0;

30 
pSli°
->
de°ru˘_‚
 = 
‚_d
;

31 
pSli°
->
com∑ª_‚
 = 
‚_c
;

32 
pSli°
->
size
 = 0;

33  
pSli°
;

34 
	}
}

36 
	$dñëe_˛ib_¶i°
–
˛ib_¶i°
 *
pSli°
){

37 
pSli°
->
size
 != 0) {

38 
	`ªmove_˛ib_¶i°
 ( 
pSli°
, 0 );

40 
	`‰ì
 ( 
pSli°
 );

41 
	}
}

43 
˛ib_îr‹


44 
	$push_back_˛ib_¶i°
–
˛ib_¶i°
 *
pSli°
, *
ñem
, 
size_t
 
ñem_size
){

46 
˛ib_¶i°_node
* 
cuºít
 = (clib_slist_node*)0;

47 
˛ib_¶i°_node
* 
√w_node
 = (clib_slist_node*)0;

49 
√w_node
 = (
˛ib_¶i°_node
*)
	`mÆloc
((clib_slist_node));

51 
√w_node
->
ñem
 = 
	`√w_˛ib_obje˘
 (ÉÀm, 
ñem_size
 );

52 i‡–! 
√w_node
->
ñem
 )

53  
CLIB_SLIST_INSERT_FAILED
;

54 
√w_node
->
√xt
 = (
˛ib_¶i°_node
*)0;

56 i‡–
pSli°
->
hód
 =(
˛ib_¶i°_node
*)0 ) {

57 
pSli°
->
hód
 = 
√w_node
;

58 
pSli°
->
size
++;

59  
CLIB_ERROR_SUCCESS
;

61 
cuºít
 = 
pSli°
->
hód
;

62  
cuºít
->
√xt
 !(
˛ib_¶i°_node
*)0 )

63 
cuºít
 = cuºít->
√xt
;

64 
cuºít
->
√xt
 = 
√w_node
;

65 
pSli°
->
size
++;

67  
CLIB_ERROR_SUCCESS
;

68 
	}
}

70 
	$pvt_ªmove_˛ib_li°
 ( 
˛ib_¶i°
 *
pSli°
, 
˛ib_¶i°_node
* 
pSli°Node
 ) {

71 *
ñem
;

72 
	`gë_øw_˛ib_obje˘
(
pSli°Node
->
ñem
, &elem);

73 i‡–
pSli°
->
de°ru˘_‚
) {

74 (
pSli°
->
de°ru˘_‚
)(
ñem
);

75 
	`dñëe_˛ib_obje˘
 ( 
pSli°Node
->
ñem
 );

77 
	`‰ì
 ( 
ñem
 );

78 
	`dñëe_˛ib_obje˘
 ( 
pSli°Node
->
ñem
 );

80 
	`‰ì
 ( 
pSli°Node
);

81 
	}
}

83 
	$ªmove_˛ib_¶i°
–
˛ib_¶i°
 *
pSli°
, 
pos
 ) {

84 
i
 = 0;

86 
˛ib_¶i°_node
* 
cuºít
 = 
pSli°
->
hód
;

87 
˛ib_¶i°_node
* 
ãmp
 = (clib_slist_node*)0;

89 i‡–
pos
 > 
pSli°
->
size
 ) ;

91 i‡–
pos
 == 0 ) {

92 
pSli°
->
hód
 = 
cuºít
->
√xt
;

93 
	`pvt_ªmove_˛ib_li°
(
pSli°
, 
cuºít
);

94 
pSli°
->
size
--;

97  
i
 = 1; i < 
pos
 - 1; i++)

98 
cuºít
 = cuºít->
√xt
;

100 
ãmp
 = 
cuºít
->
√xt
;

101 
cuºít
->
√xt
 = current->next->next;

102 
	`pvt_ªmove_˛ib_li°
 ( 
pSli°
, 
ãmp
 );

104 
pSli°
->
size
--;

105 
	}
}

106 
˛ib_îr‹


107 
	$ö£π_˛ib_¶i°
(
˛ib_¶i°
 *
pSli°
, 
pos
, *
ñem
, 
size_t
 
ñem_size
) {

108 
i
 = 0;

109 
˛ib_¶i°_node
* 
cuºít
 = 
pSli°
->
hód
;

110 
˛ib_¶i°_node
* 
√w_node
 = (clib_slist_node*)0;

112 i‡–
pos
 == 1 ) {

113 
√w_node
 = (
˛ib_¶i°_node
*)
	`mÆloc
((clib_slist_node));

114 
√w_node
->
ñem
 = 
	`√w_˛ib_obje˘
 (ÉÀm, 
ñem_size
 );

115 i‡–! 
√w_node
->
ñem
 ) {

116 
	`‰ì
 ( 
√w_node
 );

117  
CLIB_SLIST_INSERT_FAILED
;

119 
√w_node
->
√xt
 = 
pSli°
->
hód
;

120 
pSli°
->
hód
 = 
√w_node
;

121 
pSli°
->
size
++;

122  
CLIB_ERROR_SUCCESS
;

125 i‡–
pos
 >
pSli°
->
size
 + 1 ) {

126  
	`push_back_˛ib_¶i°
 ( 
pSli°
, 
ñem
, 
ñem_size
 );

129  
i
 = 1; i < 
pos
 - 1; i++) {

130 
cuºít
 = cuºít->
√xt
;

132 
√w_node
 = (
˛ib_¶i°_node
*)
	`mÆloc
((clib_slist_node));

133 
√w_node
->
ñem
 = 
	`√w_˛ib_obje˘
 (ÉÀm, 
ñem_size
 );

134 i‡–! 
√w_node
->
ñem
 ) {

135 
	`‰ì
 ( 
√w_node
 );

136  
CLIB_SLIST_INSERT_FAILED
;

139 
√w_node
->
√xt
 = 
cuºít
->next;

140 
cuºít
->
√xt
 = 
√w_node
;

141 
pSli°
->
size
++;

143  
CLIB_ERROR_SUCCESS
;

144 
	}
}

146 
f‹_óch_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
, (*
‚
)(* )) {

147 *
ñem
;

148 
˛ib_¶i°_node
* 
cuºít
 = 
pSli°
->
hód
;

149  
cuºít
 !(
˛ib_¶i°_node
*)0 ) {

150 
	`gë_øw_˛ib_obje˘
(
cuºít
->
ñem
, &elem);

151 (
‚
)(
ñem
);

152 
	`‰ì
 ( 
ñem
 );

153 
cuºít
 = cuºít->
√xt
;

155 
	}
}

156 
˛ib_boﬁ


157 
	$föd_˛ib_¶i°
 (
˛ib_¶i°
 *
pSli°
, * 
föd_vÆue
, **
out_vÆue
) {

158 
˛ib_¶i°_node
* 
cuºít
 = 
pSli°
->
hód
;

159  
cuºít
 !(
˛ib_¶i°_node
*)0 ) {

160 
	`gë_øw_˛ib_obje˘
(
cuºít
->
ñem
, 
out_vÆue
);

161 i‡((
pSli°
->
com∑ª_‚
)(
föd_vÆue
,*
out_vÆue
) != 0){

164 
	`‰ì
 ( *
out_vÆue
 );

165 
cuºít
 = cuºít->
√xt
;

167 i‡–
cuºít
 ) {

168  
˛ib_åue
;

170  
˛ib_Ál£
;

171 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_stack.c

23 
	~"c_lib.h
"

25 
˛ib_°ack
 *

26 
	$√w_˛ib_°ack
–
deÁu…_size
, 
˛ib_de°roy
 
‚_d
) {

27 
˛ib_°ack
 *
pSèck
 = ( ˛ib_°ack*)
	`mÆloc
( ( clib_stack));

28 
pSèck
->
pSèckAº
 = 
	`√w_˛ib_¨øy
 ( 
deÁu…_size
, 
NULL
, 
‚_d
);

29  
pSèck
;

30 
	}
}

32 
	$dñëe_˛ib_°ack
(
˛ib_°ack
 *
pSèck
){

33 i‡–
pSèck
 ){

34 
	`dñëe_˛ib_¨øy
 ( 
pSèck
->
pSèckAº
 );

36 
	`‰ì
 ( 
pSèck
 );

37 
	}
}

39 
	$push_˛ib_°ack
(
˛ib_°ack
 *
pSèck
, *
ñem
, 
size_t
 
ñem_size
) {

40 
	`push_back_˛ib_¨øy
–
pSèck
->
pSèckAº
, 
ñem
, 
ñem_size
);

41 
	}
}

43 
	$p›_˛ib_°ack
(
˛ib_°ack
 *
pSèck
, **
ñem
) {

44 
	`back_˛ib_¨øy
–
pSèck
->
pSèckAº
, 
ñem
 );

45 
	`ªmove_˛ib_¨øy
–
pSèck
->
pSèckAº
, 
	`size_˛ib_¨øy
(ÖStack->pStackArr) - 1);

46 
	}
}

47 
˛ib_boﬁ


48 
	$em±y_˛ib_°ack
 ( 
˛ib_°ack
 *
pSèck
) {

49  
	`em±y_˛ib_¨øy
–
pSèck
->
pSèckAº
);

50 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_util.c

24 
	~"c_lib.h
"

25 
	~<°rög.h
>

26 
	~<°dlib.h
>

29 
	$˛ib_c›y
–*
de°ö©i⁄
, *
sour˚
, 
size_t
 
size
 ) {

30 
	`mem˝y
 ( (*)
de°ö©i⁄
, 
sour˚
, 
size
);

31 
	}
}

33 
	$˛ib_gë
 ( *
de°ö©i⁄
, *
sour˚
, 
size_t
 
size
) {

34 
	`mem˝y
 ( 
de°ö©i⁄
, (*)
sour˚
, 
size
);

35 
	}
}

37 
˛ib_obje˘
*

38 
	$√w_˛ib_obje˘
(*
öObje˘
, 
size_t
 
obj_size
) {

39 
˛ib_obje˘
* 
tmp
 = (˛ib_obje˘*)
	`mÆloc
((clib_object));

40 i‡–! 
tmp
 )

41  (
˛ib_obje˘
*)0;

42 
tmp
->
size
 = 
obj_size
;

43 
tmp
->
øw_d©a
 = (*)
	`mÆloc
(
obj_size
);

44 i‡–!
tmp
->
øw_d©a
 ) {

45 
	`‰ì
 ( 
tmp
 );

46  (
˛ib_obje˘
*)0;

48 
	`mem˝y
 ( 
tmp
->
øw_d©a
, 
öObje˘
, 
obj_size
);

49  
tmp
;

50 
	}
}

52 
˛ib_îr‹


53 
	$gë_øw_˛ib_obje˘
 ( 
˛ib_obje˘
 *
öObje˘
, **
ñem
) {

54 *
ñem
 = (*)
	`mÆloc
(
öObje˘
->
size
);

55 i‡–! *
ñem
 )

56  
CLIB_ELEMENT_RETURN_ERROR
;

57 
	`mem˝y
 ( *
ñem
, 
öObje˘
->
øw_d©a
, inObje˘->
size
 );

59  
CLIB_ERROR_SUCCESS
;

60 
	}
}

62 
	$ª∂a˚_øw_˛ib_obje˘
(
˛ib_obje˘
 *
cuºít_obje˘
,*
ñem
, 
size_t
 
ñem_size
) {

63 
	`‰ì
 (
cuºít_obje˘
->
øw_d©a
);

64 
cuºít_obje˘
->
øw_d©a
 = (*)
	`mÆloc
(
ñem_size
);

65 
	`mem˝y
 ( 
cuºít_obje˘
->
øw_d©a
, 
ñem
, 
ñem_size
);

66 
	}
}

70 
	$dñëe_˛ib_obje˘
 ( 
˛ib_obje˘
 *
öObje˘
 ) {

71 i‡(
öObje˘
) {

72 
	`‰ì
 (
öObje˘
->
øw_d©a
);

73 
	`‰ì
 (
öObje˘
);

75 
	}
}

78 
	$˛ib_°rdup
 ( *
±r
 ) {

79 #ifde‡
WIN32


80  
	`_°rdup
 (
±r
);

82  
	`°rdup
 (
±r
);

84 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_array.c

24 
	~"c_lib.h
"

26 
	~<°dlib.h
>

27 
	~<°rög.h
>

28 
	~<°dio.h
>

29 
	~<as£π.h
>

32 
	$com∑ª_e
 ( *
À·
, *
right
 ) {

33 *
l
 = (*Ë
À·
;

34 *
r
 = (*Ë
right
;

35  *
l
 =*
r
 ;

36 
	}
}

38 
	$‰ì_e
 ( *
±r
 ) {

39 i‡–
±r
 )

40 
	`‰ì
 ( 
±r
);

41 
	}
}

43 
	$¥öt_e
 ( *
±r
 ){

44 i‡–
±r
 )

45 
	`¥ötf
 ( "%d\n", *(*)
±r
);

46 
	}
}

48 
	$ã°_wôh_öt
() {

49 
size
 = 10;

50 
i
 = 0;

51 
rc
 ;

52 * 
p_rv
 = (* )0;

53 
rv
 = 0;

54 
˛ib_¨øy
* 
myAºay
 = 
	`√w_˛ib_¨øy
 (8,
com∑ª_e
,
NULL
);

55 
	`as£π
 ( 
˛ib_åue
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

57  
i
 = 0; i <
size
; i++) {

58 
	`push_back_˛ib_¨øy
 ( 
myAºay
, &
i
 ,());

60 
	`as£π
 ( 
˛ib_Ál£
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

61 
	`as£π
 ( 
size
 + 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

62  
i
 = 0; i <
size
; i++) {

63 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
i
 , &
p_rv
 );

64 
rv
 = *(*)
p_rv
;

65 
	`as£π
 ( 
rv
 =
i
 );

66 
	`‰ì
 ( 
p_rv
 );

68 
rc
 = 
	`‰⁄t_˛ib_¨øy
 ( 
myAºay
, &
p_rv
 );

69 
rv
 = *(*)
p_rv
;

70 
	`as£π
 ( 
rv
 == 0 );

71 
	`‰ì
 ( 
p_rv
 );

73 
rc
 = 
	`back_˛ib_¨øy
–
myAºay
, &
p_rv
 );

74 
rv
 = *(*)
p_rv
;

75 
	`as£π
 ( 
rv
 =
size
 );

76 
	`‰ì
 ( 
p_rv
 );

78 
	`ªmove_˛ib_¨øy
–
myAºay
, 0 );

79 
	`as£π
 ( 
size
 =
	`size_˛ib_¨øy
–
myAºay
 ));

80 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 0 , &
p_rv
 );

81 
rv
 = *(*)
p_rv
;

82 
	`as£π
 ( 
rv
 == 1 );

83 
	`‰ì
 ( 
p_rv
 );

85 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

86 
	`ªmove_˛ib_¨øy
–
myAºay
, 
size
/2 );

87 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

88 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
size
/2 , &
p_rv
 );

89 
rv
 = *(*)
p_rv
;

90 
	`as£π
 ( 
rv
 =
size
/2 + 2 );

91 
	`‰ì
 ( 
p_rv
 );

93 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

94 
	`ªmove_˛ib_¨øy
–
myAºay
, 
size
 - 1);

95 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

96 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

97 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
size
 - 1, &
p_rv
 );

98 
rv
 = *(*)
p_rv
;

99 
	`as£π
 ( 
rv
 == 9 );

100 
	`‰ì
 ( 
p_rv
 );

102 
i
 = 900;

103 
	`ö£π_©_˛ib_¨øy
 ( 
myAºay
, 5, &
i
, ());

104 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 5 , &
p_rv
 );

105 
rv
 = *(*)
p_rv
;

106 
	`as£π
 ( 
rv
 =
i
 );

107 
	`‰ì
 ( 
p_rv
 );

109 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 6 , &
p_rv
 );

110 
rv
 = *(*)
p_rv
;

111 
	`as£π
 ( 
rv
 == 7 );

112 
	`‰ì
 ( 
p_rv
 );

114  
i
 = 0; i < 
	`size_˛ib_¨øy
(
myAºay
 ); i++){

115 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
i
 , &
p_rv
 );

116 
	`¥öt_e
 ( 
p_rv
);

117 
	`‰ì
 ( 
p_rv
 );

120 
	`dñëe_˛ib_¨øy
 ( 
myAºay
 );

121 
	}
}

124 
	$ã°_wôh_poöãrs
() {

125 
size
 = 10;

126 
i
 = 0;

127 *
rv
, 
rc
 ;

128 * 
p_rv
 = (* )0;

129 
˛ib_¨øy
* 
myAºay
 = 
	`√w_˛ib_¨øy
 (8,
com∑ª_e
,
‰ì_e
);

130 
	`as£π
 ( 
˛ib_åue
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

132  
i
 = 0; i < 
size
; i++) {

133 *
v
 = ( *Ë
	`mÆloc
 ( ());

134 
	`mem˝y
 ( 
v
, &
i
, ());

135 
	`push_back_˛ib_¨øy
 ( 
myAºay
, 
v
 ,(*));

136 
	`‰ì
 ( 
v
 );

138 
	`as£π
 ( 
˛ib_Ál£
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

139 
	`as£π
 ( 
size
 =
	`size_˛ib_¨øy
–
myAºay
 ));

140  
i
 = 0; i < 
size
; i++) {

141 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
i
 , &
p_rv
 );

142 
rv
 = (*Ë
p_rv
;

143 
	`as£π
 ( *
rv
 =
i
 );

144 
	`‰ì
 ( 
p_rv
);

146 
rc
 = 
	`‰⁄t_˛ib_¨øy
 ( 
myAºay
, &
p_rv
 );

147 
rv
 = (*Ë
p_rv
;

148 
	`as£π
 ( *
rv
 == 0 );

149 
	`‰ì
 ( 
p_rv
);

151 
rc
 = 
	`back_˛ib_¨øy
–
myAºay
, &
p_rv
 );

152 
rv
 = (*Ë
p_rv
;

153 
	`as£π
 ( *
rv
 =
size
 - 1);

154 
	`‰ì
 ( 
p_rv
);

156 
	`ªmove_˛ib_¨øy
–
myAºay
, 0 );

157 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

159 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 0 , &
p_rv
 );

160 
rv
 = (*Ë
p_rv
;

161 
	`as£π
 ( *
rv
 == 1 );

162 
	`‰ì
 ( 
p_rv
);

164 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

165 
	`ªmove_˛ib_¨øy
–
myAºay
, 
size
/2 );

166 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

167 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
size
/2 , &
p_rv
 );

168 
rv
 = (*Ë
p_rv
;

169 
	`as£π
 ( *
rv
 =
size
/2 + 2 );

170 
	`‰ì
 ( 
p_rv
);

172 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

173 
	`ªmove_˛ib_¨øy
–
myAºay
, 
size
 - 1);

174 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

176 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

178 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
size
 - 1, &
p_rv
 );

179 
rv
 = (*Ë
p_rv
;

180 
	`as£π
 ( *
rv
 == 8 );

181 
	`‰ì
 ( 
p_rv
);

183 
	`dñëe_˛ib_¨øy
 ( 
myAºay
 );

184 
	}
}

187 
	$ã°_wôh_°rögs
() {

188 
size
 = 10;

189 *
öput_¨øy
[11];

190 
i
 = 0;

191 *
rv
, 
rc
 ;

192 * 
p_rv
 = (* )0;

193 
˛ib_¨øy
* 
myAºay
 = 
	`√w_˛ib_¨øy
 (8,
com∑ª_e
,
‰ì_e
);

194 
	`as£π
 ( 
˛ib_åue
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

196 
öput_¨øy
[0] = "STRING_0";

197 
öput_¨øy
[1] = "STRING_1";

198 
öput_¨øy
[2] = "STRING_2";

199 
öput_¨øy
[3] = "STRING_3";

200 
öput_¨øy
[4] = "STRING_4";

201 
öput_¨øy
[5] = "STRING_5";

202 
öput_¨øy
[6] = "STRING_6";

203 
öput_¨øy
[7] = "STRING_7";

204 
öput_¨øy
[8] = "STRING_8";

205 
öput_¨øy
[9] = "STRING_9";

206 
öput_¨øy
[10] = "STRING_10";

209  
i
 = 0; i < 
size
; i++) {

210 *
v
 = 
	`˛ib_°rdup
 ( 
öput_¨øy
[
i
]);

211 
	`push_back_˛ib_¨øy
 ( 
myAºay
 ,
v
, 
	`°æí
(v) + 1 );

212 
	`‰ì
 ( 
v
 );

214 
	`as£π
 ( 
˛ib_Ál£
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

215 
	`as£π
 ( 
size
 =
	`size_˛ib_¨øy
–
myAºay
 ));

216  
i
 = 0; i < 
size
; i++) {

217 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
i
 , &
p_rv
 );

218 
rv
 = (*)
p_rv
;

219 
	`as£π
 ( 
	`°rcmp
–
rv
, 
öput_¨øy
[
i
]) == 0);

220 
	`‰ì
 ( 
p_rv
 );

222 
rc
 = 
	`‰⁄t_˛ib_¨øy
 ( 
myAºay
, &
p_rv
 );

223 
rv
 = (*)
p_rv
;

224 
	`as£π
 ( 
	`°rcmp
–
rv
, 
öput_¨øy
[0]) == 0);

225 
	`‰ì
 ( 
p_rv
 );

227 
rc
 = 
	`back_˛ib_¨øy
–
myAºay
, &
p_rv
 );

228 
rv
 = (*)
p_rv
;

229 
	`as£π
 ( 
	`°rcmp
–
rv
, 
öput_¨øy
[
size
 - 1]) == 0);

230 
	`‰ì
 ( 
p_rv
 );

232 
	`ªmove_˛ib_¨øy
–
myAºay
, 0 );

233 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

235 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 0 , &
p_rv
 );

236 
rv
 = (*)
p_rv
;

237 
	`as£π
 ( 
	`°rcmp
–
rv
, 
öput_¨øy
[1]) == 0);

238 
	`‰ì
 ( 
p_rv
 );

240 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

241 
	`ªmove_˛ib_¨øy
–
myAºay
, 
size
/2 );

243 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
size
/2 , &
p_rv
 );

244 
rv
 = (*)
p_rv
;

245 
	`as£π
 ( 
	`°rcmp
–
rv
, 
öput_¨øy
[
size
/2 + 2]) == 0);

246 
	`‰ì
 ( 
p_rv
 );

248 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

249 
	`ªmove_˛ib_¨øy
–
myAºay
, 
size
 - 1);

250 
	`as£π
 ( 
size
 - 1 =
	`size_˛ib_¨øy
–
myAºay
 ));

251 
size
 = 
	`size_˛ib_¨øy
–
myAºay
 );

253 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
size
 - 1, &
p_rv
 );

254 
rv
 = (*)
p_rv
;

255 
	`as£π
 ( 
	`°rcmp
–
rv
, 
öput_¨øy
[8]) == 0);

256 
	`‰ì
 ( 
p_rv
 );

258 
	`dñëe_˛ib_¨øy
 ( 
myAºay
 );

259 
	}
}

260 
˛ib_¨øy
*

261 
	$¸óã_¨øy
() {

262 
size
 = 10;

263 
i
 = 0;

264 
rc
 ;

265 * 
p_rv
 = (* )0;

266 
rv
 = 0;

268 
˛ib_¨øy
* 
myAºay
 = 
	`√w_˛ib_¨øy
 (8,
com∑ª_e
,
NULL
);

269 
	`as£π
 ( 
˛ib_åue
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

271  
i
 = 0; i < 
size
; i++) {

272 
	`push_back_˛ib_¨øy
 ( 
myAºay
, &
i
 ,());

274 
	`as£π
 ( 
˛ib_Ál£
 =
	`em±y_˛ib_¨øy
–
myAºay
 ));

275 
	`as£π
 ( 
size
 =
	`size_˛ib_¨øy
–
myAºay
 ));

276  
i
 = 0; i < 
size
; i++) {

277 
rc
 = 
	`ñemít_©_˛ib_¨øy
 ( 
myAºay
, 
i
 , &
p_rv
 );

278 
rv
 = *(*)
p_rv
;

279 
	`as£π
 ( 
rv
 =
i
 );

280 
	`‰ì
 ( 
p_rv
 );

282  
myAºay
;

283 
	}
}

285 
	$ã°_f‹_óch_¨øy
(){

286 
˛ib_¨øy
* 
pAºay
 = 
	`¸óã_¨øy
();

287 
˛ib_obje˘
 *
ãmp
;

288 
	`f‹_óch_˛ib_¨øy
–
pAºay
, 
¥öt_e
);

290 
ãmp
 = 
pAºay
->
pEÀmíts
[5];

291 
pAºay
->
pEÀmíts
[5] =ÖArray->pElements[8];

292 
pAºay
->
pEÀmíts
[8] = 
ãmp
;

294 
	`f‹_óch_˛ib_¨øy
–
pAºay
, 
¥öt_e
);

295 
	`dñëe_˛ib_¨øy
 ( 
pAºay
 );

297 
	}
}

299 
	$ã°_˛ib_¨øy
(){

300 
	`ã°_wôh_öt
();

301 
	`ã°_wôh_poöãrs
();

302 
	`ã°_wôh_°rögs
();

303 
	`¥ötf
 ( "---------------------------------\n");

304 
	`ã°_f‹_óch_¨øy
();

305 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_deque.c

24 
	~"c_lib.h
"

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

29 
	~<as£π.h
>

32 
	$com∑ª_e
 ( *
À·
, *
right
 ) {

33 *
l
 = (*Ë
À·
;

34 *
r
 = (*Ë
right
;

35  *
l
 =*
r
 ;

36 
	}
}

38 
	$‰ì_e
 ( *
±r
 ) {

39 i‡–
±r
 )

40 
	`‰ì
 ( 
±r
);

41 
	}
}

43 
	$ã°_˛ib_deque
() {

44 
Êù
 = 1;

45 
i
 = 0;

46 
limô
 = 20;

47 * 
ñemít
;

48 
j
 = 0;

50 
˛ib_deque
* 
myDeq
 = 
	`√w_˛ib_deque
 ( 10, 
com∑ª_e
, 
NULL
);

51 
	`as£π
 ( (
˛ib_deque
*)0 !
myDeq
 );

53  
i
 = 0; i <
limô
; i++ ) {

54 i‡–
Êù
 ) {

55 
	`push_back_˛ib_deque
 ( 
myDeq
, &
i
 , ());

56 
Êù
 = 0;

58 
	`push_‰⁄t_˛ib_deque
 ( 
myDeq
, &
i
, () );

59 
Êù
 = 1;

62 
	`‰⁄t_˛ib_deque
 ( 
myDeq
, &
ñemít
 );

63 
	`as£π
 ( *(*)
ñemít
 =
limô
 - 1 );

64 
	`‰ì
 ( 
ñemít
 );

66 
	`back_˛ib_deque
 ( 
myDeq
, &
ñemít
 );

67 
	`as£π
 ( *(*)
ñemít
 =
limô
);

68 
	`‰ì
 ( 
ñemít
 );

70  
	`em±y_˛ib_deque
(
myDeq
Ë!
˛ib_åue
 ) {

71 
	`p›_‰⁄t_˛ib_deque
 ( 
myDeq
);

73 
	`dñëe_˛ib_deque
(
myDeq
);

75 
myDeq
 = 
	`√w_˛ib_deque
 ( 10, 
com∑ª_e
, 
‰ì_e
);

76  
i
 = 0; i <
limô
; i ++ ) {

77 *
v
 = (*)
	`mÆloc
(());

78 
	`mem˝y
 ( 
v
, &
i
,  ( ));

79 
	`push_back_˛ib_deque
 ( 
myDeq
, 
v
 , (*));

80 
	`‰ì
 ( 
v
 );

82  
i
 = 
myDeq
->
hód
 + 1; i < myDeq->
èû
; i++ ){

83 *
ñem
;

84 i‡–
	`ñemít_©_˛ib_deque
–
myDeq
, 
i
, &
ñem
 ) =
CLIB_ERROR_SUCCESS
 ) {

85 
	`as£π
 ( *(*)
ñem
 =
j
++ );

86 
	`‰ì
 ( 
ñem
 );

89 
	`dñëe_˛ib_deque
(
myDeq
);

90 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_heap.c

24 
	~"c_lib.h
"

25 
	~<°dio.h
>

28 
	$com∑ª_öt
 ( *
À·
, *
right
 ) {

29 *
l
 = (*)
À·
;

30 *
r
 = (*)
right
;

32 i‡–*
l
 < *
r
 )

34 i‡–*
l
 > *
r
 )

37 
	}
}

39 
	$¥öt_ñemít
 ( *
±r
 ) {

40 
	`¥ötf
 ( "%d\n", *(*)
±r
);

41 
	}
}

43 
	$ã°_˛ib_hóp_max
() {

44 
ã°
[] = {4,1,3,2,16,9,10,14,8,7};

45 
ödex
 = 0;

46 
size
 =  (
ã°
) /(test[0]);

47 *
maxEÀm
;

48 
˛ib_hóp
* 
pHóp
 = 
	`√w_˛ib_hóp
 ( 8, 
com∑ª_öt
, 
NULL
);

50  
ödex
 = 0; index < 
size
; index++ ) {

51 
v
 = 
ã°
[
ödex
];

52 
	`ö£π_˛ib_hóp
 ( 
pHóp
, &
v
, ());

54 
	`buûd_max_˛ib_hóp
–
pHóp
);

55 
	`¥ötf
 ( "---------------------------------\n");

56 
	`f‹_óch_˛ib_hóp
 ( 
pHóp
, 
¥öt_ñemít
);

57 
	`¥ötf
 ( "---------------------------------\n");

58  
	`em±y_˛ib_hóp
(
pHóp
Ë!
˛ib_åue
 ) {

59 
maxEÀm
 = 
	`exåa˘_max_˛ib_hóp
 ( 
pHóp
 );

60 
	`¥ötf
 ( "MAX ELEMENT = %d\n", *(*)
maxEÀm
);

61 
	`‰ì
 ( 
maxEÀm
 );

63 
	`dñëe_˛ib_hóp
 ( 
pHóp
 );

64 
	}
}

67 
	$ã°_˛ib_hóp_mö
() {

68 
ã°
[] = {4,1,3,2,16,9,10,14,8,7};

69 
ödex
 = 0;

70 
size
 =  (
ã°
) /(test[0]);

71 *
maxEÀm
;

72 
˛ib_hóp
* 
pHóp
 = 
	`√w_˛ib_hóp
 ( 8, 
com∑ª_öt
, 
NULL
);

74  
ödex
 = 0; index < 
size
; index++ ) {

75 
v
 = 
ã°
[
ödex
];

76 
	`ö£π_˛ib_hóp
 ( 
pHóp
, &
v
, ());

78 
	`buûd_mö_˛ib_hóp
–
pHóp
);

79 
	`¥ötf
 ( "---------------------------------\n");

80 
	`f‹_óch_˛ib_hóp
 ( 
pHóp
, 
¥öt_ñemít
);

81 
	`¥ötf
 ( "---------------------------------\n");

82  
	`em±y_˛ib_hóp
(
pHóp
Ë!
˛ib_åue
 ) {

83 
maxEÀm
 = 
	`exåa˘_mö_˛ib_hóp
 ( 
pHóp
 );

84 
	`¥ötf
 ( "MIN ELEMENT = %d\n", *(*)
maxEÀm
);

85 
	`‰ì
 ( 
maxEÀm
 );

87 
	`dñëe_˛ib_hóp
 ( 
pHóp
 );

89 
	}
}

92 
	$ã°_˛ib_hóp
() {

93 
	`ã°_˛ib_hóp_max
();

94 
	`ã°_˛ib_hóp_mö
();

95 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_map.c

24 
	~"c_lib.h
"

25 
	~<°rög.h
>

26 
	~<as£π.h
>

27 
	~<°dio.h
>

30 
	$com∑ª_e
 ( *
À·
, *
right
 ) {

31  
	`°rcmp
 ( (c⁄° *)
À·
, (c⁄° *Ë
right
 );

32 
	}
}

33 *
	gch¨_vÆue
[] = { "A","B","C","D","E","F","G","H","I","J","K","L","M",

35 
	göt_vÆue
[] = { 1,2,3,4,5,6,7,8,9,10,

40 
	$ö£π_Æl
 ( 
˛ib_m≠
* 
myM≠
) {

41 
size
 = (
ch¨_vÆue
)/(char_value[0]);

42 
i
 = 0;

43  
i
 = 0; i < 
size
; i++ ) {

44 *
key
 = 
	`˛ib_°rdup
–
ch¨_vÆue
[
i
]);

45 
key_Àngth
 = ()
	`°æí
 ( 
key
 ) + 1;

46 
vÆue
 = 
öt_vÆue
[
i
];

47 
	`¥ötf
 ( "In£πög [%†-> %d]\n", 
key
, 
vÆue
 );

48 
	`ö£π_˛ib_m≠
 ( 
myM≠
, 
key
, 
key_Àngth
, &
vÆue
, ());

49 
	`‰ì
 ( 
key
 );

51 
	}
}

53 
	$check_exi°s_Æl
–
˛ib_m≠
* 
myM≠
) {

54 
size
 = (
ch¨_vÆue
)/(char_value[0]);

55 
i
 = 0;

56  
i
 = 0; i < 
size
; i++ ) {

57 *
vÆue
 ;

58 
	`as£π
 ( 
˛ib_åue
 =
	`exi°s_˛ib_m≠
 ( 
myM≠
, 
ch¨_vÆue
[
i
]));

59 
	`as£π
 ( 
˛ib_åue
 =
	`föd_˛ib_m≠
–
myM≠
, 
ch¨_vÆue
[
i
], &
vÆue
));

60 
	`¥ötf
 ( "-----> [%†=%d]\n", 
ch¨_vÆue
[
i
], *(*)
vÆue
);

61 
	`as£π
 ( *(*)
vÆue
 =
öt_vÆue
[
i
]);

62 
	`‰ì
 ( 
vÆue
 );

64 
	}
}

67 
	$ªmove_some_exi°
(
˛ib_m≠
* 
myM≠
) {

68 
	`as£π
 ( 
CLIB_ERROR_SUCCESS
 =
	`ªmove_˛ib_m≠
 ( 
myM≠
, "A"));

69 
	`as£π
 ( 
˛ib_Ál£
 =
	`exi°s_˛ib_m≠
 ( 
myM≠
, "A"));

71 
	`as£π
 ( 
CLIB_ERROR_SUCCESS
 =
	`ªmove_˛ib_m≠
 ( 
myM≠
, "X"));

72 
	`as£π
 ( 
˛ib_Ál£
 =
	`exi°s_˛ib_m≠
 ( 
myM≠
, "X"));

74 
	`as£π
 ( 
CLIB_ERROR_SUCCESS
 =
	`ªmove_˛ib_m≠
 ( 
myM≠
, "Z"));

75 
	`as£π
 ( 
˛ib_Ál£
 =
	`exi°s_˛ib_m≠
 ( 
myM≠
, "Z"));

77 
	`as£π
 ( 
CLIB_ERROR_SUCCESS
 =
	`ªmove_˛ib_m≠
 ( 
myM≠
, "H"));

78 
	`as£π
 ( 
˛ib_Ál£
 =
	`exi°s_˛ib_m≠
 ( 
myM≠
, "H"));

79 
	}
}

81 
	$add_ªmoved_check_Æl
(
˛ib_m≠
* 
myM≠
) {

83 *
key
 = 
	`˛ib_°rdup
 ("A");

84 
key_Àngth
 = ()
	`°æí
 ( 
key
 ) + 1;

85 
	`ö£π_˛ib_m≠
 ( 
myM≠
, 
key
, 
key_Àngth
 , &
öt_vÆue
[0], ());

86 
	`‰ì
 ( 
key
 );

88 
key
 = 
	`˛ib_°rdup
 ("X");

89 
key_Àngth
 = ()
	`°æí
 ( 
key
 ) + 1;

90 
	`ö£π_˛ib_m≠
 ( 
myM≠
, 
key
, 
key_Àngth
, &
öt_vÆue
[23], ());

91 
	`‰ì
 ( 
key
 );

93 
key
 = 
	`˛ib_°rdup
 ("Z");

94 
key_Àngth
 = ()
	`°æí
 ( 
key
 ) + 1;

95 
	`ö£π_˛ib_m≠
 ( 
myM≠
, 
key
, 
key_Àngth
, &
öt_vÆue
[25], ());

96 
	`‰ì
 ( 
key
 );

98 
key
 = 
	`˛ib_°rdup
 ("H");

99 
key_Àngth
 = ()
	`°æí
 ( 
key
 ) + 1;

100 
	`ö£π_˛ib_m≠
 ( 
myM≠
, 
key
, 
key_Àngth
, &
öt_vÆue
[7 ], ());

101 
	`‰ì
 ( 
key
 );

103 
	`check_exi°s_Æl
(
myM≠
);

104 
	}
}

106 
	$ã°_˛ib_m≠
() {

107 
˛ib_m≠
* 
myM≠
 = 
	`√w_˛ib_m≠
 ( 
com∑ª_e
, 
NULL
, NULL);

108 
	`ö£π_Æl
(
myM≠
);

109 
	`check_exi°s_Æl
(
myM≠
);

110 
	`ªmove_some_exi°
(
myM≠
);

111 
	`add_ªmoved_check_Æl
(
myM≠
);

112 
	`dñëe_˛ib_m≠
(
myM≠
);

113 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_rb.c

24 
	~"c_lib.h
"

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_set.c

24 
	~"c_lib.h
"

26 
	~<°dlib.h
>

27 
	~<°rög.h
>

28 
	~<°dio.h
>

29 
	~<as£π.h
>

32 
	$dñëe_e
 ( *
±r
 ) {

33 i‡–
±r
 )

34 
	`‰ì
 ( 
±r
 );

35 
	}
}

37 
	$com∑ª_e
 ( *
À·
, *
right
 ) {

38 *
l
 = (*)
À·
;

39 *
r
 = (*)
right
;

40  
	`°rcmp
 ( (c⁄° *)
l
, (c⁄° *Ë
r
 );

41 
	}
}

43 
	$com∑ª_öt
 ( *
À·
, *
right
 ) {

44 *
l
 = (*)
À·
;

45 *
r
 = (*)
right
;

47 i‡–*
l
 < *
r
 )

49 i‡–*
l
 > *
r
 )

52 
	}
}

54 
	$ã°_˛ib_£t
(){

56 
ã°
[] = { 0,1,2,3,4,5,6,7,8,9 };

57 
ödex
 = 0;

58 
size
 =  (
ã°
) /(test[0]);

59 * 
outKey
;

61 
˛ib_£t
 *
pSë
 = 
	`√w_˛ib_£t
 ( 
com∑ª_öt
, 
NULL
);

63  
ödex
 = 0; index < 
size
; index++ ) {

64 
v
 = 
ã°
[
ödex
];

65 
	`ö£π_˛ib_£t
 ( 
pSë
, &
v
, ());

67  
ödex
 = 0; index < 
size
; index++ ) {

68 
v
 = 
ã°
[
ödex
];

69 
	`as£π
 ( 
˛ib_åue
 =
	`exi°s_˛ib_£t
 ( 
pSë
, &
v
));

72 
ödex
 = 9;

73 
	`föd_˛ib_£t
 ( 
pSë
, &
ödex
, &
outKey
);

74 
	`as£π
 ( 9 =*(*)
outKey
);

75 
	`‰ì
 ( 
outKey
 );

76 
	`dñëe_˛ib_£t
(
pSë
);

79 
	sã°
 {

80 *
°rög
;

81 } 
	tTEST_INPUT
;

83 
ödex
 = 0;

84 
size
 = 0;

85 *
v
;

87 
TEST_INPUT
 
ti
[] ={

97 
˛ib_£t
 *
pSë
 = 
	`√w_˛ib_£t
 ( 
com∑ª_e
, 
dñëe_e
);

98 
size
 =  ( 
ti
 ) /  (Åi[0]);

100  
ödex
 = 0; index < 
size
; index++ ){

101 *
ãmp
 = 
	`˛ib_°rdup
 ( 
ti
[
ödex
].
°rög
 );

102 
	`ö£π_˛ib_£t
 ( 
pSë
, 
ãmp
, 
	`°æí
(temp) + 1 );

103 
	`‰ì
 ( 
ãmp
 );

105  
ödex
 = 0; index < 
size
; index++ ){

106 
v
 = 
ti
[
ödex
].
°rög
;

107 
	`as£π
 ( 
˛ib_åue
 =
	`exi°s_˛ib_£t
 ( 
pSë
, 
v
));

109 
	`dñëe_˛ib_£t
(
pSë
);

111 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_slist.c

24 
	~"c_lib.h
"

26 
	~<°dlib.h
>

27 
	~<°rög.h
>

28 
	~<°dio.h
>

29 
	~<as£π.h
>

32 
	$‰ì_ñemít
 ( *
±r
 ) {

33 i‡–
±r
 )

34 
	`‰ì
 ( 
±r
);

35 
	}
}

38 
	$add_ñemíts_to_li°
–
˛ib_¶i°
* 
Œ
, 
x
, 
y
 ) {

39 
i
 = 0;

40  
i
 = 
x
; i <
y
; i++ ) {

41 *
v
 = ( *Ë
	`mÆloc
 (  ( ));

42 
	`mem˝y
 ( 
v
, &
i
,  ( ));

43 
	`push_back_˛ib_¶i°
 ( 
Œ
, 
v
 , (v));

44 
	`‰ì
 ( 
v
 );

46 
	}
}

48 
	$¥öt_e
 ( *
±r
 ) {

49 i‡–
±r
 )

50 
	`¥ötf
 ( "%d\n", *(*)
±r
);

51 
	}
}

54 
	$com∑ª_ñemít
 ( *
À·
, *
right
 ) {

55 *
l
 = (*Ë
À·
;

56 *
r
 = (*Ë
right
;

57  *
l
 =*
r
 ;

58 
	}
}

62 
	$ã°_˛ib_¶i°
() {

63 
i
 = 0;

64 *
v
;

65 * 
outVÆue
;

66 
˛ib_¶i°
* 
li°
 = 
	`√w_˛ib_¶i°
(
‰ì_ñemít
,
com∑ª_ñemít
);

68 
	`add_ñemíts_to_li°
(
li°
,1, 10 );

69 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

71 
i
 = 55;

72 
v
 = ( *Ë
	`mÆloc
 (  ( ));

73 
	`mem˝y
 ( 
v
, &
i
,  ( ));

74 
	`ö£π_˛ib_¶i°
(
li°
,5, 
v
,(v));

75 
	`‰ì
 ( 
v
 );

76 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

78 
	`ªmove_˛ib_¶i°
(
li°
,5);

79 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

81 
	`ªmove_˛ib_¶i°
(
li°
,0);

82 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

84 
	`ªmove_˛ib_¶i°
(
li°
,100);

85 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

87 
i
 = 1;

88 
v
 = ( *Ë
	`mÆloc
 (  ( ));

89 
	`mem˝y
 ( 
v
, &
i
,  ( ));

90 
	`ö£π_˛ib_¶i°
(
li°
,1,
v
,(v));

91 
	`‰ì
 ( 
v
 );

92 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

94 
i
 = 11;

95 
v
 = ( *Ë
	`mÆloc
 (  ( ));

96 
	`mem˝y
 ( 
v
, &
i
,  ( ));

97 
	`ö£π_˛ib_¶i°
(
li°
,11,
v
,(v));

98 
	`‰ì
 ( 
v
 );

99 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

101 
i
 = 12;

102 
v
 = ( *Ë
	`mÆloc
 (  ( ));

103 
	`mem˝y
 ( 
v
, &
i
,  ( ));

104 
	`ö£π_˛ib_¶i°
(
li°
,200,
v
,(v));

105 
	`‰ì
 ( 
v
 );

106 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

108 
	`ªmove_˛ib_¶i°
(
li°
,li°->
size
);

109 
	`f‹_óch_˛ib_¶i°
(
li°
, 
¥öt_e
);

111 
i
 = 10;

112 i‡–
˛ib_åue
 =
	`föd_˛ib_¶i°
 ( 
li°
, &
i
, &
outVÆue
)) {

113 
	`as£π
 ( 
i
 =*(*)
outVÆue
 );

114 
	`‰ì
 ( 
outVÆue
 );

116 
i
 = 100;

117 
	`as£π
 ( 
˛ib_Ál£
 =
	`föd_˛ib_¶i°
 ( 
li°
, &
i
, &
outVÆue
));

119 
	`dñëe_˛ib_¶i°
 ( 
li°
 );

121 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_stack.c

23 
	~"c_lib.h
"

24 
	~<as£π.h
>

27 
	$ã°_˛ib_°ack
() {

28 
˛ib_°ack
 *
pSèck
 = 
	`√w_˛ib_°ack
–10, 
NULL
 );

29 
i
 = 0;

30 
size
 = 10;

31  
i
 = 0; i < 
size
; i++) {

32 
	`push_˛ib_°ack
 ( 
pSèck
, &
i
, (i));

34 
size
 = size - 1;

35  ! 
	`em±y_˛ib_°ack
(
pSèck
)) {

36 *
ñem
;

37 
	`p›_˛ib_°ack
–
pSèck
, &
ñem
);

38 
	`as£π
 ( 
size
-- =*(*)
ñem
);

39 
	`‰ì
 ( 
ñem
 );

41 
	`dñëe_˛ib_°ack
 ( 
pSèck
 );

42 
	}
}

	@ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_clibutils.c

24 
	~<°dio.h
>

25 
ã°_˛ib_¨øy
();

26 
ã°_˛ib_deque
();

27 
ã°_˛ib_åì
();

28 
ã°_˛ib_rb
();

29 
ã°_˛ib_£t
();

30 
ã°_˛ib_m≠
();

31 
ã°_˛ib_¶i°
();

32 
ã°_˛ib_m≠
();

33 
ã°_˛ib_°ack
();

34 
ã°_˛ib_hóp
();

36 
	$maö
–
¨gc
, **
¨gv
 ) {

37 
	`¥ötf
 ( "PerformingÅest for dynamicárray\n");

38 
	`ã°_˛ib_¨øy
();

39 
	`¥ötf
 ( "PerformingÅest for deque\n");

40 
	`ã°_˛ib_deque
();

41 
	`¥ötf
 ( "PerformingÅest for sets\n");

42 
	`ã°_˛ib_£t
();

43 
	`¥ötf
 ( "PerformingÅest for map\n");

44 
	`ã°_˛ib_m≠
();

45 
	`¥ötf
 ( "PerformingÅest for slist\n");

46 
	`ã°_˛ib_¶i°
();

47 
	`¥ötf
 ( "PerformingÅest for stackn");

48 
	`ã°_˛ib_°ack
();

49 
	`¥ötf
 ( "PerformingÅest for heap\n");

50 
	`ã°_˛ib_hóp
();

54 
	}
}

	@ccan/junkcode/fork0@users.sf.net-bitmaps/bitmaps.h

2 #i‚de‡
_BITMAPS_H_


3 
	#_BITMAPS_H_


	)

12 íum { 
	mBITS_PER_BITMAP_ELEM
 = 8 * () };

14 
	tbôm≠_ñem_t
;

18 
ölöe


19 
bôm≠_ñem_t
 
	$bôm≠_ã°_bô
(c⁄° 
bôm≠_ñem_t
* 
bôs
, 
bô
)

21 i‡–(*
bôs
) == 4 )

22  
bôs
[
bô
 >> 5] & (0x80000000 >> (bit & 0x1f));

23 i‡–(*
bôs
) == 8 )

24  
bôs
[
bô
 >> 6] & (0x8000000000000000ull >> (bit & 0x3f));

27  
bôs
[
bô
 / 
BITS_PER_BITMAP_ELEM
] &

28 1 << ((
BITS_PER_BITMAP_ELEM
 - 
bô
 % BITS_PER_BITMAP_ELEM) - 1);

30 
	}
}

32 
ölöe


33 
bôm≠_ñem_t
 
	$bôm≠_£t_bô
(
bôm≠_ñem_t
* 
bôs
, 
bô
)

35 i‡–(*
bôs
) == 4 )

36  
bôs
[
bô
 >> 5] |= (0x80000000 >> (bit & 0x1f));

37 i‡–(*
bôs
) == 8 )

38  
bôs
[
bô
 >> 6] |= (0x8000000000000000ull >> (bit & 0x3f));

41  
bôs
[
bô
 / 
BITS_PER_BITMAP_ELEM
] |=

42 1 << ((
BITS_PER_BITMAP_ELEM
 - 
bô
 % BITS_PER_BITMAP_ELEM) - 1);

44 
	}
}

49 
ölöe


50 
	$bôm≠_£t_8bôs_Á°
(
bôm≠_ñem_t
* 
bôs
, 
pos
, 
b8
)

52 i‡–(*
bôs
) == 4 )

53 
bôs
[
pos
 >> 5] |
b8
 << (24 - (pos & 0x1f));

54 i‡–(*
bôs
) == 8 )

55 
bôs
[
pos
 >> 6] |
b8
 << (56 - (pos & 0x3f));

58 
bôs
[
pos
 / 
BITS_PER_BITMAP_ELEM
] |=

59 
b8
 << (
BITS_PER_BITMAP_ELEM
 - 8 - 
pos
 % BITS_PER_BITMAP_ELEM);

61 
	}
}

63 
ölöe


64 
bôm≠_ñem_t
 
	$bôm≠_˛ór_bô
(
bôm≠_ñem_t
* 
bôs
, 
bô
)

66 i‡–(*
bôs
) == 4 )

67  
bôs
[
bô
 >> 5] &= ~(0x80000000 >> (bit & 0x1f));

68 i‡–(*
bôs
) == 8 )

69  
bôs
[
bô
 >> 6] &= ~(0x8000000000000000ull >> (bit & 0x3f));

72  
bôs
[
bô
 / 
BITS_PER_BITMAP_ELEM
] &=

73 ~(1 << ((
BITS_PER_BITMAP_ELEM
 - 
bô
 % BITS_PER_BITMAP_ELEM) - 1));

75 
	}
}

	@ccan/junkcode/fork0@users.sf.net-pathexpand/pathexpand.c

1 
	~<°rög.h
>

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

11 *
	$∑thex∑nd
(c⁄° *
cwd
, c⁄° *
∑th
)

13 c⁄° 
SEP
[] = "/";

14 i‡(!*
∑th
)

15 
∑th
 = ".";

16 i‡(!*
cwd
 || *
SEP
 =*
∑th
)

17 
cwd
 = "";

19 *
cwd
 && *
SEP
 == *cwd)

20 ++
cwd
;

22 
size_t
 
Àn
 = 
	`°æí
(
cwd
);

23 *
out
 = 
	`mÆloc
(
Àn
 + 1 + 
	`°æí
(
∑th
) + 1);

24 *
p
 = 
	`°r˝y
(
out
, 
cwd
Ë+ 
Àn
;

26 ; *
∑th
; ++path)

28 *
∂
;

29 i‡(
p
 > 
out
 &&Ö[-1] !*
SEP
)

30 *
p
++ = *
SEP
;

31 
∂
 = 
p
;

32 *
∑th
 && *
SEP
 != *path)

33 *
p
++ = *
∑th
++;

34 *
p
 = '\0';

36 i‡(
p
 =
∂
)

39 i‡–
p
 - 
∂
 == 1 && '.' == *pl )

40 --
p
;

42 i‡–
p
 - 
∂
 == 2 && '.' ==Öl[0] && '.' ==Öl[1] )

45 i‡(
∂
 > 
out
 && --pl > out)

46 --
∂
;Ö»> 
out
 && *
SEP
 != *pl; --pl)

48 
p
 = 
∂
 > 
out
 ? ++pl: out;

51 i‡(*
∑th
)

52 *
p
++ = *
∑th
;

54 i‡(!*
∑th
)

57 i‡(
p
 > 
out
+1 && *
SEP
 ==Ö[-1])

58 --
p
;

59 *
p
 = '\0';

60  
out
;

61 
	}
}

63 #ifde‡
CHECK_PATHEXPAND


64 
	$check
(c⁄° *
cwd
, c⁄° *
∑th
, c⁄° *
good
)

66 
n
 = 0;

67 
	`¥ötf
("%-2d: %10s$ cd %s", ++
n
, 
cwd
, 
∑th
);

68 *
t
 = 
	`∑thex∑nd
(
cwd
, 
∑th
);

69 i‡–
	`°rcmp
(
t
, 
good
) )

70 
	`¥ötf
(" ____________________Áûed(%s)\n", 
t
);

72 
	`¥ötf
(" \033[32m%s\033[0m\n", 
t
);

73 
	`‰ì
(
t
);

74 
	}
}

76 
	$maö
(
¨gc
, **
¨gv
)

78  
	`check
("/onelevel", "aa", "onelevel/aa");

79  
	`check
("/", "..", "");

80  
	`check
("/", "../..", "");

81  
	`check
("/one", "aa/../bb", "one/bb");

82  
	`check
("/one/two", "aa//bb", "one/two/aa/bb");

83  
	`check
("", "/aa//bb", "aa/bb");

84  
	`check
("/one/two", "", "one/two");

85  
	`check
("/one/two", "aa/..bb/x/../cc/", "one/two/aa/..bb/cc");

86  
	`check
("/one/two", "aa/x/././cc////", "one/two/aa/x/cc");

87  
	`check
("/one/two", "../../../../aa", "aa");

88  
	`check
("one/", "../one/two", "one/two");

89  
	`check
("", "../../two", "two");

90  
	`check
("a/b/c", "../../two", "a/two");

91  
	`check
("a/b/", "../two", "a/two");

92  
	`check
("///", "../two", "two");

94 
	}
}

	@ccan/junkcode/fork0@users.sf.net-timeout/timeout.c

2 
	#_GNU_SOURCE


	)

3 
	~<uni°d.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/waô.h
>

6 
	~<sig«l.h
>

7 
	~<°dio.h
>

8 
	~<°rög.h
>

9 
	~<°dlib.h
>

10 
	~<î∫o.h
>

12 c⁄° *
	g¨gv0
;

13 **
	g¥g¨gv
;

14 
pid_t
 
	gpid
;

15 
	gsigno
;

16 
	gtimeout
;

18 
	$timedout
(
sig
)

20 
	`Ârötf
(
°dîr
, "%s[%d]: %s[%d]Åimed outáfter %u sec\n",

21 
¨gv0
, 
	`gëpid
(), *
¥g¨gv
, 
pid
, 
timeout
);

22 i‡(
pid
)

23 
	`kûl
(-
pid
, 
signo
);

24 
	}
}

26 
	$öãºu±ed
(
sig
)

28 
	`Æ¨m
(0);

29 i‡(
pid
)

30 
	`kûl
(-
pid
, 
sig
);

31 
	}
}

33 
	$ußge
()

35 
	`Ârötf
(
°dîr
, "%s <timeout-seconds> [-<signal>]Örogram ...\n"

38 
¨gv0
);

39 
	`exô
(1);

40 
	}
}

43 c⁄° *
	m«me
;

44 
	msigno
;

45 } 
	gknown
[] = {

46 {"HUP", 
SIGHUP
},

47 {"INT", 
SIGINT
},

48 {"QUIT", 
SIGQUIT
},

49 {"ILL", 
SIGILL
},

50 {"TRAP", 
SIGTRAP
},

51 {"ABRT", 
SIGABRT
},

52 {"BUS", 
SIGBUS
},

53 {"FPE", 
SIGFPE
},

54 {"KILL", 
SIGKILL
},

55 {"USR1", 
SIGUSR1
},

56 {"SEGV", 
SIGSEGV
},

57 {"USR2", 
SIGUSR2
},

58 {"PIPE", 
SIGPIPE
},

59 {"ALRM", 
SIGALRM
},

60 {"TERM", 
SIGTERM
},

61 {"STKFLT", 
SIGSTKFLT
},

62 {"CHLD", 
SIGCHLD
},

63 {"CONT", 
SIGCONT
},

64 {"STOP", 
SIGSTOP
},

65 {"TSTP", 
SIGTSTP
},

66 {"TTIN", 
SIGTTIN
},

67 {"TTOU", 
SIGTTOU
},

68 {"URG", 
SIGURG
},

69 {"XCPU", 
SIGXCPU
},

70 {"XFSZ", 
SIGXFSZ
},

71 {"VTALRM", 
SIGVTALRM
},

72 {"PROF", 
SIGPROF
},

73 {"WINCH", 
SIGWINCH
},

74 {"IO", 
SIGIO
},

75 {"PWR", 
SIGPWR
},

76 {"SYS", 
SIGSYS
},

79 
	$signo_¨g
(c⁄° *
¨g
)

81 i‡(*
¨g
 == '-') {

82 *
p
;

83 
s
 = 
	`°πﬁ
(++
¨g
, &
p
, 10);

84 i‡(!*
p
 &&Ö > 
¨g
 && 
s
 > 0 && s < 
_NSIG
) {

85 
signo
 = 
s
;

88 i‡(!
	`°∫ˇ£cmp
(
¨g
, "SIG", 3))

89 
¨g
 += 3;

90 
s
 = 0; s < (
known
)/(*known); ++s)

91 i‡(!
	`°rˇ£cmp
(
¨g
, 
known
[
s
].
«me
)) {

92 
signo
 = 
known
[
s
].signo;

97 
	}
}

99 
	$maö
(
¨gc
, ** 
¨gv
)

101 
¨gv0
 = 
	`°ºchr
(*
¨gv
, '/');

102 i‡(
¨gv0
)

103 ++
¨gv0
;

105 
¨gv0
 = *
¨gv
;

107 
	`sig«l
(
SIGALRM
, 
timedout
);

108 
	`sig«l
(
SIGINT
, 
öãºu±ed
);

109 
	`sig«l
(
SIGHUP
, 
öãºu±ed
);

111 ++
¨gv
;

113 i‡(!*
¨gv
)

114 
	`ußge
();

116 i‡(
	`signo_¨g
(*
¨gv
))

117 ++
¨gv
;

118 i‡(
	`ssˇnf
(*
¨gv
, "%u", &
timeout
) == 1)

119 ++
¨gv
;

121 
	`ußge
();

122 i‡(!
signo
 && 
	`signo_¨g
(*
¨gv
))

123 ++
¨gv
;

124 i‡(!
signo
)

125 
signo
 = 
SIGKILL
;

127 i‡(!*
¨gv
)

128 
	`ußge
();

130 
¥g¨gv
 = 
¨gv
;

131 
	`Æ¨m
(
timeout
);

132 
pid
 = 
	`f‹k
();

134 i‡(!
pid
) {

135 
	`sig«l
(
SIGALRM
, 
SIG_DFL
);

136 
	`sig«l
(
SIGCHLD
, 
SIG_DFL
);

137 
	`sig«l
(
SIGINT
, 
SIG_DFL
);

138 
	`sig«l
(
SIGHUP
, 
SIG_DFL
);

139 
	`£çgid
(0, 0);

140 
	`execvp
(*
¥g¨gv
,Örgargv);

141 
	`Ârötf
(
°dîr
, "%s: %s: %s\n",

142 
¨gv0
, *
¥g¨gv
, 
	`°ªº‹
(
î∫o
));

143 
	`_exô
(2);

144 } i‡(
pid
 < 0) {

145 
	`Ârötf
(
°dîr
, "%s: %s\n", 
¨gv0
, 
	`°ªº‹
(
î∫o
));

147 
°©us
;

148 
	`waôpid
(
pid
, &
°©us
, 0Ë< 0 && 
EINTR
 =
î∫o
)

150 
	`Æ¨m
(0);

151 i‡(
	`WIFEXITED
(
°©us
))

152  
	`WEXITSTATUS
(
°©us
);

153 i‡(
	`WIFSIGNALED
(
°©us
)) {

158 i‡(
	`WTERMSIG
(
°©us
Ë=
SIGHUP
 ||

159 
	`WTERMSIG
(
°©us
Ë=
SIGINT
 ||

160 
	`WTERMSIG
(
°©us
Ë=
SIGTERM
 ||

161 
	`WTERMSIG
(
°©us
Ë=
SIGQUIT
 ||

162 
	`WTERMSIG
(
°©us
Ë=
SIGKILL
) {

163 
	`sig«l
(
	`WTERMSIG
(
°©us
), 
SIG_DFL
);

164 
	`øi£
(
	`WTERMSIG
(
°©us
));

166 
	`Ârötf
(
°dîr
, "%s: %s: %s\n",

167 
¨gv0
, *
¥g¨gv
, 
	`°rsig«l
(
	`WTERMSIG
(
°©us
)));

170 
	`Ârötf
(
°dîr
, "%†dõd\n", *
¥g¨gv
);

173 
	}
}

	@ccan/junkcode/guerrilla_thought@gmx.de-bst/bst.h

1 #i‚de‡
BST_H


2 
	#BST_H


	)

4 
	#b°_de˛¨e
(
«me
, 
ty≥
, 
idx_ty≥
) struct { \

6 
idx_ty≥
 
idx
; \

7 
ty≥
 
ñem
; \

8 *
À·
; \

9 *
right
; \

10 } *
hód
; \

11 } 
«me


	)

13 
	#b°_öô
(
«me
) do { \

14 (
«me
).
hód
 = 
NULL
; \

15 } 0)

	)

17 
	#b°_node_ty≥
(
«me
Ë
	`ty≥of
(*(“ame).
hód
))

	)

19 
	#b°_ö£π
(
«me
, 
_ñem
, 
_idx
) do { \

20 
	`b°_node_ty≥
(
«me
Ë**
cur
 = 
NULL
; \

22 
cur
 = &((
«me
).
hód
); ;) { \

23 
	`as£π
(
cur
 !
NULL
); \

25 i‡(*
cur
 =
NULL
) { \

26 (*
cur
Ë
	`mÆloc
((
	`b°_node_ty≥
(
«me
))); \

27 
	`as£π
(*
cur
 !
NULL
); \

28 (*
cur
)->
idx
 = 
_idx
; \

29 (*
cur
)->
ñem
 = 
_ñem
; \

30 (*
cur
)->
À·
 = 
NULL
; \

31 (*
cur
)->
right
 = 
NULL
; \

34 
	`as£π
((*
cur
)->
idx
 !
_idx
); \

36 i‡(
_idx
 < (*
cur
)->
idx
) { \

37 
cur
 = (
	`b°_node_ty≥
(
«me
Ë**)&((*cur)->
À·
); \

39 
cur
 = (
	`b°_node_ty≥
(
«me
Ë**)&((*cur)->
right
); \

43 } 0)

	)

45 
	#b°_föd
(
«me
, 
_idx
, 
_ñemp
) do { \

46 
	`b°_node_ty≥
(
«me
Ë*
cur
 = 
NULL
; \

48 
	`as£π
((
_ñemp
Ë!
NULL
); \

50 
cur
 = (
«me
).
hód
; cu∏!
NULL
; ) { \

51 i‡(
cur
->
idx
 =
_idx
) { \

55 i‡(
_idx
 < 
cur
->
idx
) { \

56 
cur
 = (
	`b°_node_ty≥
(
«me
Ë*)(cur->
À·
); \

58 
cur
 = (
	`b°_node_ty≥
(
«me
Ë*)(cur->
right
); \

62 i‡(
cur
 !
NULL
) { \

63 *(
_ñemp
Ë((
cur
)->
ñem
); \

65 *(
_ñemp
Ë
NULL
; \

67 } 0);

	)

74 
	gcur
 = &((
b°_node_ty≥
(
«me
)((*
cur
)->
right
))); \

76 (*
	gcur
).
	gñem
 = 
ñem
; \

77 (*
	gcur
).
	gidx
 = 
idx
; \

	@ccan/junkcode/henryeshbaugh@gmail.com-log/log.c

1 
	~<log.h
>

2 
	~<°dio.h
>

3 
	~<°rög.h
>

4 
	~<°dboﬁ.h
>

5 
	~<°d¨g.h
>

6 
	~<time.h
>

9 
	#FG_RED
 "\033[31m"

	)

10 
	#FG_YELLOW
 "\033[33m"

	)

11 
	#FG_BLUE
 "\033[34m"

	)

12 
	#FG_PURPLE
 "\033[35m"

	)

13 
	#TEXT_BOLD
 "\033[1m"

	)

14 
	#COLOR_END
 "\033[0m"

15 

	)

16 
FILE
 *
	g_loggög_fûes
[16] = { 
NULL
, NULL, NULL, NULL, NULL, NULL, NULL, NULL,

17 
NULL
, NULL, NULL, NULL, NULL, NULL, NULL, NULL };

18 
	g_log_cuºít_mode
, 
	g_cuºít_log_fûe
 = 1;

20 
FILE
 *
	$£t_log_fûe
(*
fûíame
)

22 i‡(
_cuºít_log_fûe
+1 > 16Ë 
NULL
;

23 
_loggög_fûes
[
_cuºít_log_fûe
++] = 
	`f›í
(
fûíame
, "a+");

24  
_loggög_fûes
[
_cuºít_log_fûe
];

25 
	}
}

27 
	$£t_log_mode
(
mode
)

29 
_log_cuºít_mode
 = 
mode
;

30 
	}
}

32 
	$gë_log_mode
()

34  
_log_cuºít_mode
;

35 
	}
}

38 
	$_¥öt_log
(
logÀvñ
, *
fûe
, c⁄° *
func
, *
˛ock
, 
löe
, *
msg
, ...)

40 
_loggög_fûes
[0] = 
°dout
;

41 
va_li°
 
¨gs
;

42 
	`va_°¨t
(
¨gs
, 
msg
);

47 
buf„r
[
	`°æí
(
msg
) + 1024];

48 
	`v¢¥ötf
(
buf„r
, 
	`°æí
(
msg
)+1024, msg, 
¨gs
);

49 i‡(
logÀvñ
 < 0 ||ÜogÀvñ > 3ËlogÀvñ = 
LOG_INVALID
;

52 
logÀvñ
) {

53 
LOG_CRITICAL
:

54 
	`¥ötf
(
TEXT_BOLD
 
FG_RED
);

56 
LOG_ERROR
:

57 
	`¥ötf
(
FG_RED
);

59 
LOG_WARNING
:

60 
	`¥ötf
(
FG_YELLOW
);

62 
LOG_INFO
:

63 
	`¥ötf
(
FG_BLUE
);

65 
LOG_INVALID
:

66 
	`¥ötf
(
FG_PURPLE
);

70 
i
;

71 
i
=0; i < 16; i++)

72 i‡(
_loggög_fûes
[
i
])

73 
	`Ârötf
(
_loggög_fûes
[
i
], "%s", 
log_ègs
[
_log_cuºít_mode
][
logÀvñ
]);

75 
	`¥ötf
(
COLOR_END
);

77 i‡(
_log_cuºít_mode
 =
LOG_VERBOSE
) {

78 
i
=0; i < 16; i++)

79 i‡(
_loggög_fûes
[
i
])

80 
	`Ârötf
(
_loggög_fûes
[
i
],

82 
func
, 
fûe
, 
löe
, 
˛ock
);

87 *
to_¥öt
 = 
	`°πok
(
buf„r
, "\n");

88 
i
 = 0; i < 16; i++)

89 i‡(
_loggög_fûes
[
i
])

90 
	`Ârötf
(
_loggög_fûes
[
i
], "%s\n", 
to_¥öt
);

94 
to_¥öt
 = 
	`°πok
(
NULL
, "\n")) {

95 
i
 = 0; i < 16; i++)

96 i‡(
_loggög_fûes
[
i
])

97 
	`Ârötf
(
_loggög_fûes
[
i
], "%s\n", 
to_¥öt
);

100 
	}
}

	@ccan/junkcode/henryeshbaugh@gmail.com-log/log.h

1 #i‚de‡
CCAN_LOG_H


2 
	#CCAN_LOG_H


	)

4 
	~<°dio.h
>

5 
	~<°rög.h
>

6 
	~<°dboﬁ.h
>

7 
	~<°d¨g.h
>

8 
	~<time.h
>

10 
	#LOG_CRITICAL
 0

	)

11 
	#LOG_ERROR
 1

	)

12 
	#LOG_WARNING
 2

	)

13 
	#LOG_INFO
 3

	)

14 
	#LOG_INVALID
 4

	)

17 *
	glog_ègs
[2][5] = { { "[CRITICAL] ",

28 
	#LOG_VERBOSE
 0

	)

29 
	#LOG_CONCISE
 1

	)

31 
FILE
 *
£t_log_fûe
(*);

32 
gë_log_mode
();

33 
£t_log_mode
();

35 
	#¥öt_log
(
Àvñ
, ...) do { \

36 
time_t
 
_˛k
 = 
	`time
(
NULL
); \

37 
	`_¥öt_log
(
Àvñ
, 
__FILE__
, 
__func__
, 
	`˘ime
(&
_˛k
), 
__LINE__
, 
__VA_ARGS__
); \

38 } 0)

	)

40 
_¥öt_log
(, *, const *, *, , *, ...);

	@ccan/junkcode/iasoule32@gmail.com-polynomial/_info.c

1 
	~<°rög.h
>

2 
	~<°dio.h
>

3 
	~"c⁄fig.h
"

13 
	$maö
(
¨gc
, *
¨gv
[])

15 i‡(
¨gc
 != 2)

18 i‡(
	`°rcmp
(
¨gv
[1], "depends") == 0) {

23 i‡(
	`°rcmp
(
¨gv
[1], "libs") == 0) {

24 
	`¥ötf
("m\n");

29 
	}
}

	@ccan/junkcode/iasoule32@gmail.com-polynomial/polynomial_adt.c

1 
	~"pﬁynomül_adt.h
"

3 
PﬁyAdt
 *
	$¸óã_adt
(
hp
)

5 
PﬁyAdt
 *
pAdt
 = 
	`mÆloc
((PolyAdt));

6 
	`as£π
(
pAdt
 !
NULL
);

8 
pAdt
->
hód
 = 
NULL
;

9 
pAdt
->
ãrms
 = 0;

10 
pAdt
->
hp
 = hp;

12  
pAdt
;

13 
	}
}

15 
	$ö£π_ãrm
(
PﬁyAdt
 *
pAdt
, 
c
, 
e
)

17 
	`as£π
(
pAdt
 !
NULL
);

18 
Node
 *
n
 = 
	`mÆloc
((Node));

20 if(
pAdt
->
hód
 =
NULL
)

21 
pAdt
->
hód
 = 
	`¸óã_node
(
c
, 
e
,ÖAdt->head);

23 
n
 = 
pAdt
->
hód
;Ç->
√xt
 !
NULL
;Ç =Ç->next);

24 
n
->
√xt
 = 
	`¸óã_node
(
c
, 
e
, 
NULL
);

26 
pAdt
->
ãrms
++;

27 
	}
}

29 
PﬁyAdt
 *
	$pﬁyImage
(c⁄° 
PﬁyAdt
 *
‹ig
)

31 
PﬁyAdt
 *
img
 = 
	`¸óã_adt
(
‹ig
->
hp
);

32 
Node
 *
‹igHód
 = 
‹ig
->
hód
;

34 ; 
‹igHód
; origHód = origHód->
√xt
)

35 
	`ö£π_ãrm
(
img
, 
‹igHód
->
c€ff
, origHód->
exp
);

36  
img
;

37 
	}
}

39 
PﬁyAdt
 *
	$add
(c⁄° 
PﬁyAdt
 *
a
, c⁄° PﬁyAdà*
b
)

41 
PﬁyAdt
 *
sum
;

42 
Node
 *
n
, *
≈
;

43 
°©e
 = 1;

45 
	`as£π
(
a
 !
NULL
 && 
b
 != NULL);

47 
hpow
 = 
	`max
(
a
->
hp
, 
b
->hp);

48 
sum
 = 
	`¸óã_adt
(
hpow
);

54 
n
 = 
a
->
hód
; 
≈
 = 
b
->head;

55 
°©e
) {

57 if(
n
->
exp
 =
≈
->exp){

58 
	`ö£π_ãrm
(
sum
, 
n
->
c€ff
 + 
≈
->c€ff,Ç->
exp
);

59 
n
 =Ç->
√xt
;

60 
≈
 =Çp->
√xt
;

63 if(
n
->
exp
 < 
≈
->exp){

64 
	`ö£π_ãrm
(
sum
, 
≈
->
c€ff
,Çp->
exp
);

65 
≈
 =Çp->
√xt
;

69 
	`ö£π_ãrm
(
sum
, 
n
->
c€ff
,Ç->
exp
);

70 
n
 =Ç->
√xt
;

73 if(
≈
 =
NULL
 && 
°©e
){

74 ; 
n
 !
NULL
;Ç =Ç->
√xt
)

75 
	`ö£π_ãrm
(
sum
, 
n
->
c€ff
,Ç->
exp
);

76 
°©e
 = 0;

79 if(
n
 =
NULL
 && 
°©e
){

80 ; 
≈
 !
NULL
;Ç∞≈->
√xt
)

81 
	`ö£π_ãrm
(
sum
, 
≈
->
c€ff
,Çp->
exp
);

82 
°©e
 = 0;

85  
sum
;

86 
	}
}

88 
PﬁyAdt
 *
	$subåa˘
(c⁄° 
PﬁyAdt
 *
a
, c⁄° PﬁyAdà*
b
)

90 
	`as£π
(
a
 !
NULL
 && 
b
 != NULL);

92 
PﬁyAdt
 *
tmp
 = 
	`¸óã_adt
(
b
->
hp
);

93 
Node
 *
b±r
;

95 
b±r
 = 
b
->
hód
; b±∏!
NULL
; b±∏b±r->
√xt
)

96 
	`ö£π_ãrm
(
tmp
,-
b±r
->
c€ff
,b±r->
exp
);

97  
	`add
(
a
,
tmp
);

98 
	}
}

100 
PﬁyAdt
 *
	$mu…ùly
(c⁄° 
PﬁyAdt
 *
a
, c⁄° PﬁyAdà*
b
)

102 
	`as£π
(
a
 !
NULL
 && 
b
 != NULL);

105 
PﬁyAdt
 *
¥od
 = 
	`¸óã_adt
(
a
->
hód
->
exp
 + 
b
->head->exp);

106 
Node
 *
n
 = 
a
->
hód
, *
≈
 = 
b
->head;

107 
Node
 *
t
 = 
b
->
hód
;

109 if(
a
->
ãrms
 < 
b
->terms){

110 
n
 = 
b
->
hód
;

111 
≈
 = 
t
 = 
a
->
hód
;

114 ; 
n
 !
NULL
;Ç =Ç->
√xt
){

115 
≈
 = 
t
;

116 ; 
≈
 !
NULL
;Ç∞≈->
√xt
){

117 
	`ö£π_ãrm
(
¥od
, 
n
->
c€ff
 * 
≈
->c€ff,Ç->
exp
 +Çp->exp);

121  
¥od
;

122 
	}
}

124 
PﬁyAdt
 *
	$dîiv©ive
(c⁄° 
PﬁyAdt
 *
a
)

126 
	`as£π
(
a
 !
NULL
);

128 
PﬁyAdt
 *
dîiv
 = 
	`¸óã_adt
(
a
->
hód
->
exp
 - 1);

129 
Node
 *
n
 = 
a
->
hód
;

131 ; 
n
 !
NULL
;Ç =Ç->
√xt
){

132 if(
n
->
exp
 == 0) ;

133 
	`ö£π_ãrm
(
dîiv
, 
n
->
c€ff
 *Ç->
exp
,Ç->exp-1);

135  
dîiv
;

136 
	}
}

138 
PﬁyAdt
 *
	$öãgøã
(c⁄° 
PﬁyAdt
 *
a
)

140 
	`as£π
(
a
 !
NULL
);

142 
PﬁyAdt
 *
öãgønd
 = 
	`¸óã_adt
(
a
->
hód
->
exp
 + 1);

143 
Node
 *
n
;

145 
n
 = 
a
->
hód
;Ç !
NULL
;Ç =Ç->
√xt
)

146 
	`ö£π_ãrm
(
öãgønd
, ()
n
->
c€ff
/“->
exp
+1.0F),Ç->exp + 1);

148  
öãgønd
;

149 
	}
}

151 
	$quadøtic_roŸs
(c⁄° 
PﬁyAdt
 *
a
, *
ªÆ
, *
˝lx
)

153 
	`as£π
(
a
 !
NULL
);

155 
ds¸m¡
, 
_a
, 
b
, 
c
;

156 
u
, 
v
;

158 
Node
 *
n
 = 
a
->
hód
;

159 
_a
 = 
n
->
c€ff
; 
b
 =Ç->
√xt
->c€ff; 
c
 =Ç->next->next->coeff;

161 
ds¸m¡
 = (
b
*bË- 4*
_a
*
c
;

162 
u
 = -
b
/(2*
_a
); 
v
 = 
	`sqπ
(()
	`Ábs
(
ds¸m¡
))/(2*_a);

164 if((
ªÆ
 && !
˝lx
) || (!real && cplx))

165 
	`as£π
(1);

167 if(
ªÆ
 =
NULL
 && 
˝lx
 == NULL){

168 if(
a
->
hp
 !2 &&á->
ãrms
 < 3){

169 
	`¥ötf
("Invalid Quadratic*, Aánd B must beÇon-zero");

173 if(
ds¸m¡
 != 0)

174 
	`¥ötf
("X = %.2‡+/- %.2f%c\n",
u
,
v
,
ds¸m¡
 < 0 ? 'I':' ');

176 
	`¥ötf
("(X %¯%.2f)(X %¯%.2f)\n",
	`sgn
(
u
),
	`Ábs
(u),sgn(u),fabs(u));

177 
	`¥ötf
("X1,2 = %.2f\n",
u
);

182 if(
ds¸m¡
 < 0){

183 *
ªÆ
 = 
u
;

184 *
˝lx
 = 
v
;

186 if(
ds¸m¡
 == 0){

187 *
ªÆ
 = 
u
;

188 *
˝lx
 = 0.00F;

191 *
ªÆ
 = 
u
 + 
v
;

192 *
˝lx
 = 
u
 - 
v
;

195 
	}
}

197 
PﬁyAdt
 *
	$exp⁄ítüã
(c⁄° 
PﬁyAdt
 *
a
, 
n
)

199 
	`as£π
(
a
 !
NULL
);

201 
PﬁyAdt
 *
ex≤
 = 
	`¸óã_adt
(
a
->
hp
 * 
n
);

202 
PﬁyAdt
 *
≠å
 = 
	`pﬁyImage
(
a
);

203 
hl
 = 
n
 / 2;

206 if(
n
 == 0){

207 
	`ö£π_ãrm
(
ex≤
, 1, 0);

208  
ex≤
;

210 if(
n
 == 1){

211  
≠å
;

214 ; 
hl
 ; hl--)

215 
≠å
 = 
	`mu…ùly
(aptr,áptr);

217 if(
n
 % 2)

218 
ex≤
 = 
	`mu…ùly
(
≠å
, 
a
);

220 
ex≤
 = 
≠å
;

221  
ex≤
;

222 
	}
}

224 
PﬁyAdt
 *
	$compo£
(c⁄° 
PﬁyAdt
 *
p
, c⁄° PﬁyAdà*
q
)

226 
	`as£π
(
p
 && 
q
);

228 
PﬁyAdt
 *
comp
 = 
	`¸óã_adt
(
p
->
hód
->
exp
 * 
q
->head->exp);

229 
PﬁyAdt
 *
exp
;

231 
Node
 *
µ
 = 
p
->
hód
;

232 
Node
 *
qq
 = 
q
->
hód
;

234 
sw≠
 = 0;

236 if(
p
->
ãrms
 < 
q
->terms){

237 
µ
 = 
q
->
hód
;

238 
qq
 = 
p
->
hód
;

239 
sw≠
 = 1;

243 ; 
µ
 !
NULL
;Ö∞µ->
√xt
){

244 
exp
 = 
	`exp⁄ítüã
(
sw≠
 ? 
p
: 
q
, 
µ
->exp);

245 
	`ö£π_ãrm
(
comp
, 
µ
->
c€ff
 * 
exp
->
hód
->coeff,Éxp->head->exp);

248  
comp
;

249 
	}
}

251 
	$de°roy_pﬁy
(
PﬁyAdt
 *
pﬁy
)

253 
Node
 *
ps
 = 
pﬁy
->
hód
;

254 
Node
 *
tmp
 = 
NULL
;

255 
ps
 !
NULL
){

256 
tmp
 = 
ps
;

257 
	`‰ì
(
tmp
);

258 
ps
 =Ös->
√xt
;

260 
pﬁy
->
hp
 =Öﬁy->
ãrms
 = 0;

261 
pﬁy
->
hód
 = 
NULL
;

262 
	}
}

264 
	$di•œy_pﬁy
(c⁄° 
PﬁyAdt
 *
a
)

266 
	`as£π
(
a
 !
NULL
);

267 
Node
 *
n
;

269 
n
 = 
a
->
hód
;Ç !
NULL
;Ç =Ç->
√xt
){

271 
n
->
c€ff
 < 0 ? 
	`putch¨
('-') :Öutchar('+');

272 if(
n
->
exp
 == 0)

273 
	`¥ötf
(" %.2‡",
	`Ábs
(
n
->
c€ff
));

274 if(
n
->
c€ff
 == 1)

275 
	`¥ötf
(" X^%d ",
n
->
exp
);

276 if(
n
->
exp
 == 1)

277 
	`¥ötf
(" %.2fX ",
	`Ábs
(
n
->
c€ff
));

278 if(
n
->
c€ff
 == 0)

281 
	`¥ötf
(" %.2fX^%d ",
	`Ábs
(
n
->
c€ff
),n->
exp
);

283 
	`¥ötf
("\n\n");

284 
	}
}

	@ccan/junkcode/iasoule32@gmail.com-polynomial/polynomial_adt.h

32 #i‚de‡
__POLYNOMIAL_ADT


33 
	#__POLYNOMIAL_ADT


	)

35 
	~<as£π.h
>

36 
	~<°dlib.h
>

37 
	~<°dio.h
>

38 
	~<m©h.h
>

40 
	#max
(
a
, 
b
Ë◊Ë> (bË? (aË: (b)

	)

41 
	#sgn
(
a
) (a) < 0 ? '+' : '-'

42 

	)

43 
	snode
 {

44 
	mexp
;

45 
	mc€ff
;

46 
node
 *
	m√xt
;

47 }
	tNode
;

49 
	spﬁynomül_adt
 {

50 
Node
 *
	mhód
;

51 
	mãrms
, 
	mhp
;

52 }
	tPﬁyAdt
;

58 
PﬁyAdt
 *
¸óã_adt
(
hp
);

69 
ölöe
 
Node
 *
	$¸óã_node
(
c⁄°™t
, 
exp
, 
Node
 *
√xt
) {

70 
Node
 *
nNode
 = 
	`mÆloc
((Node));

71 
	`as£π
(
nNode
 !
NULL
);

73 
nNode
->
exp
 =Éxp;

74 
nNode
->
c€ff
 = 
c⁄°™t
;

75 
nNode
->
√xt
 =Çext;

76  
nNode
;

77 
	}
}

85 
ö£π_ãrm
(
PﬁyAdt
 *
pAdt
, 
c
, 
e
);

91 
PﬁyAdt
 *
pﬁyImage
(c⁄° PﬁyAdà*
‹ig
);

99 
PﬁyAdt
 *
add
(c⁄° PﬁyAdà*
a
, c⁄° PﬁyAdà*
b
);

107 
PﬁyAdt
 *
subåa˘
(c⁄° PﬁyAdà*
a
, c⁄° PﬁyAdà*
b
);

114 
PﬁyAdt
 *
mu…ùly
(c⁄° PﬁyAdà*
a
, c⁄° PﬁyAdà*
b
);

120 
PﬁyAdt
 *
dîiv©ive
(c⁄° PﬁyAdà*
a
);

128 
PﬁyAdt
 *
öãgøã
(c⁄° PﬁyAdà*
a
);

146 
quadøtic_roŸs
(c⁄° 
PﬁyAdt
 *
a
, *
ªÆ
, *
˝lx
);

154 
PﬁyAdt
 *
exp⁄ítüã
(c⁄° PﬁyAdà*
a
, 
n
);

161 
PﬁyAdt
 *
compo£
(c⁄° PﬁyAdà*
p
, c⁄° PﬁyAdà*
q
);

169 
de°roy_pﬁy
(
PﬁyAdt
 *
pﬁy
);

175 
di•œy_pﬁy
(c⁄° 
PﬁyAdt
 *
a
);

	@ccan/junkcode/iasoule32@gmail.com-polynomial/test/run.c

32 
	~<°dio.h
>

33 
	~"../pﬁynomül_adt.h
"

34 
	~"../pﬁynomül_adt.c
"

36 
	$maö
()

38 
PﬁyAdt
 *
p
 = 
	`¸óã_adt
(5), *
q
 = create_adt(4);

39 
PﬁyAdt
 *
sum
, *
diff
, *
¥od
;

41 
	`ö£π_ãrm
(
p
,1,5);

42 
	`ö£π_ãrm
(
p
,3,4);

43 
	`ö£π_ãrm
(
p
,1,3);

44 
	`ö£π_ãrm
(
p
,9,2);

45 
	`ö£π_ãrm
(
p
,8,1);

47 
	`ö£π_ãrm
(
q
,2,4);

48 
	`ö£π_ãrm
(
q
,8,3);

49 
	`ö£π_ãrm
(
q
,7,2);

50 
	`ö£π_ãrm
(
q
,6,1);

53 
	`¥ötf
("Displaying Polynomials ...\n");

54 
	`di•œy_pﬁy
(
p
);

55 
	`di•œy_pﬁy
(
q
);

57 
sum
 = 
	`add
(
p
,
q
);

58 
	`¥ötf
("P(x) + Q(x) = ");

59 
	`di•œy_pﬁy
(
sum
);

61 
diff
 = 
	`subåa˘
(
p
,
q
);

62 
	`¥ötf
("P(x) - Q(x) = ");

63 
	`di•œy_pﬁy
(
diff
);

65 
¥od
 = 
	`mu…ùly
(
p
,
q
);

66 
	`¥ötf
("P(x)*Q(x) = ");

67 
	`di•œy_pﬁy
(
¥od
);

69 
PﬁyAdt
 *
quad
 = 
	`¸óã_adt
(2);

70 
	`ö£π_ãrm
(
quad
, 10, 2);

71 
	`ö£π_ãrm
(
quad
, 30, 1);

72 
	`ö£π_ãrm
(
quad
, 2, 0);

74 
	`quadøtic_roŸs
(
quad
, 
NULL
, NULL);

76 
ªÆ
, 
˝lx
;

77 
	`quadøtic_roŸs
(
quad
, &
ªÆ
, &
˝lx
);

79 
	`¥ötf
("X1 = %f, X2 = %f\n\n", 
ªÆ
, 
˝lx
);

81 
PﬁyAdt
 *
dîiv
, *
öãgøl
;

83 
dîiv
 = 
	`dîiv©ive
(
p
);

84 
	`¥ötf
("The derivitive ofÖ = ");

85 
	`di•œy_pﬁy
(
dîiv
);

86 
öãgøl
 = 
	`öãgøã
(
q
);

88 
	`¥ötf
("The integral of q = ");

89 
	`di•œy_pﬁy
(
öãgøl
);

91 
	`¥ötf
("\n Computing P(x)^3\n");

93 
PﬁyAdt
 *
expo
;

94 
expo
 = 
	`exp⁄ítüã
(
p
, 3);

95 
	`di•œy_pﬁy
(
expo
);

96 
	`¥ötf
("\n");

98 
	`¥ötf
("Computing Integral[Q(x)^2]\n");

99 
expo
 = 
	`exp⁄ítüã
(
q
, 2);

100 
öãgøl
 = 
	`öãgøã
(
expo
);

101 
	`di•œy_pﬁy
(
öãgøl
);

104 
	`¥ötf
(" Differentiatingánd Integrating P\n");

105 
	`di•œy_pﬁy
(
	`öãgøã
(
	`dîiv©ive
(
p
)));

107 
PﬁyAdt
 *
L
, *
M
;

109 
L
 = 
	`¸óã_adt
(3), 
M
 = create_adt(2);

111 
	`ö£π_ãrm
(
L
, 4, 3);

112 
	`ö£π_ãrm
(
L
, 10, 2);

113 
	`ö£π_ãrm
(
L
, 15, 1);

115 
	`ö£π_ãrm
(
M
, 4, 2);

116 
	`¥ötf
("L = ");

117 
	`di•œy_pﬁy
(
L
);

118 
	`¥ötf
("M = ");

119 
	`di•œy_pﬁy
(
M
);

122 
	`¥ötf
("Computing composition L(M(X))\n");

123 
	`di•œy_pﬁy
(
	`compo£
(
L
, 
M
));

125 
	`¥ötf
("Freed memory backÅo heap forállocatedÖolys'\n");

126 
	`de°roy_pﬁy
(
sum
);

127 
	`de°roy_pﬁy
(
diff
);

128 
	`de°roy_pﬁy
(
¥od
);

129 
	`de°roy_pﬁy
(
L
); de°roy_pﬁy(
M
);

130 
	`de°roy_pﬁy
(
q
); de°roy_pﬁy(
p
);

133 
	}
}

	@ccan/junkcode/mansourmoufid@gmail.com-endianness/endianness.c

1 
	~<°döt.h
>

3 
	$maö
( )

5 c⁄° 
uöt64_t
 
⁄e
 = (uint64_t) 1;

6 i‡((
uöt8_t
Ë1 =*((uöt8_à*Ë&
⁄e
))

10 
	}
}

	@ccan/junkcode/swehack@gmail.com-snifstat/snifstat.c

6 
	~<°dio.h
>

7 
	~<°dlib.h
>

8 
	~<uni°d.h
>

9 
	~<°rög.h
>

12 
	~<√tdb.h
>

15 
	~<sys/ty≥s.h
>

16 
	~<sys/sockë.h
>

17 
	~<√t/if.h
>

18 
	~<√t/rouã.h
>

19 
	~<√t/if_dl.h
>

20 
	~<√töë/ö.h
>

21 
	~<¨∑/öë.h
>

22 
	~<√töë/if_ëhî.h
>

23 
	~<iÁddrs.h
>

26 
	~<sys/time.h
>

29 
	~<sig«l.h
>

32 
	~<ãrmios.h
>

33 #i‚de‡
TIOCGWINSZ


34 
	~<sys/io˘l.h
>

38 
	~<pˇp.h
>

40 
	#APP_NAME
 "¢if°©"

	)

41 
	#APP_VERSION
 0.2

	)

43 
ˇlc_åaf_io
(*, 
ëhî_hódî
 *);

44 
ëhaddr¢cmp
(c⁄° *, c⁄° *, 
size_t
);

45 
ª£t_cou¡
();

46 
gë_wödowsize
();

47 
ußge
(const *);

49 
	gª£t
 = 0;

51 
	$maö
(
¨gc
, **
¨gv
) {

52 *
i‚ame
 = 
NULL
;

53 
¨gch
;

54 
show_ö_bôs
 = 0;

55 
bôs_¥efix
[] = "Kbps";

56 
byãs_¥efix
[] = "KB/s";

57 
max_ôî©i⁄
 = 0;

59 
îrbuf
[
PCAP_ERRBUF_SIZE
];

60 
pˇp_t
 *
pˇp
 = 
NULL
;

61 
bpf_¥ogøm
 
fûãrd
;

62 
bpf_u_öt32
 
√ç
, 
√tmask
;

63 *
fûãr
 = 
NULL
;

64 c⁄° 
u_ch¨
 *
∑ckë
 = 
NULL
;

65 
pˇp_pkthdr
 
hódî
;

67 *
ëhî_addrs
 = 
NULL
;

68 
iÁddrs
 *
iÁ
 = 
NULL
;

69 
sockaddr_dl
 *
sdl
 = 
NULL
;

71 
ôimîvÆ
 
ôv
, 
oôv
;

72 
ôimîvÆ
 *
ôvp
 = &
ôv
;

75 
ëhî_hódî
 *
ëhî√t
 = 
NULL
;

77 
ôî©i⁄
 = 0, 
tŸÆ_ôî©i⁄
 = 0;

78 
cur_ö
, 
cur_out
;

79 
cur_ws
 = 0, 
√w_ws
, 
ﬁd_ws
, 
ws_ch™ge
;

80 
åaf_io
 = 2;

82 *
ª£ç
 = &
ª£t
;

84 if(
¨gc
 < 4) {

85 
	`ußge
(
¨gv
[0]);

86 
	`exô
(-1);

89 (
¨gch
 = 
	`gë›t
(
¨gc
, 
¨gv
, "i:bc:hv")) != -1) {

90 
¨gch
) {

92 if(
	`°æí
(
›èrg
) < 16) {

93 
i‚ame
 = 
›èrg
;

94 
›åe£t
 = 1;

96 
	`ußge
(
¨gv
[0]);

97 
	`exô
(-1);

101 
show_ö_bôs
 = 1;

102 
›åe£t
 = 1;

105 
max_ôî©i⁄
 = ()
	`©oi
(
›èrg
);

108 
	`ußge
(
¨gv
[0]);

109 
	`exô
(-1);

111 
	`¥ötf
("%†v%.1‡byÇo˘u∫Æ [©] swehack [dŸ] se\n", 
APP_NAME
, 
APP_VERSION
);

112 
	`exô
(-1);

116 if(
¨gc
 - 
›töd
 < 1) {

117 
	`ußge
(
¨gv
[0]);

118 
	`exô
(-1);

121 
fûãr
 = 
¨gv
[
›töd
];

123 if(
	`pˇp_looku≤ë
(
i‚ame
, &
√ç
, &
√tmask
, 
îrbuf
) == -1) {

124 
	`Ârötf
(
°dîr
, "pˇp_looku≤ë: %s\n", 
îrbuf
);

125 
	`exô
(-1);

128 if((
pˇp
 = 
	`pˇp_›í_live
(
i‚ame
, 65535, 1, 10, 
îrbuf
)Ë=
NULL
) {

129 
	`Ârötf
(
°dîr
, "pˇp_›í_live: %s\n", 
îrbuf
);

130 
	`exô
(-1);

133 if(
	`pˇp_compûe
(
pˇp
, &
fûãrd
, 
fûãr
, 1, 
√tmask
) == -1) {

134 
	`Ârötf
(
°dîr
, "pˇp_compûe: %s\n", 
	`pˇp_gëîr
(
pˇp
));

135 
	`exô
(-1);

138 if(
	`pˇp_£tfûãr
(
pˇp
, &
fûãrd
) == -1) {

139 
	`Ârötf
(
°dîr
, "pˇp_£tfûãr: %s\n", 
	`pˇp_gëîr
(
pˇp
));

140 
	`exô
(-1);

143 if(
	`sig«l
(
SIGALRM
, 
ª£t_cou¡
Ë=
SIG_ERR
) {

144 
	`≥º‹
("signal: ");

145 
	`exô
(-1);

148 if(
	`gëiÁddrs
(&
iÁ
) == -1) {

149 
	`≥º‹
("getifaddrs: ");

150 
	`exô
(-1);

153 ;
iÁ
;iÁ = iÁ->
iÁ_√xt
) {

154 if(
	`°∫cmp
(
i‚ame
, 
iÁ
->
iÁ_«me
, (ifa->ifa_name)) == 0) {

155 
sdl
 = (
sockaddr_dl
 *)
iÁ
->
iÁ_addr
;

156 if((
ëhî_addrs
 = 
	`mÆloc
(
sdl
->
sdl_Æí
)Ë=
NULL
) {

157 
	`≥º‹
("malloc: ");

158 
	`exô
(-1);

160 
	`mem˝y
(
ëhî_addrs
, 
	`LLADDR
(
sdl
), sdl->
sdl_Æí
);

165 
	`timî˛ór
(&
ôvp
->
ô_öãrvÆ
);

166 
ôvp
->
ô_vÆue
.
tv_£c
 = 1;

167 
ôvp
->
ô_vÆue
.
tv_u£c
 = 0;

170 *
ª£ç
 = 0;

172 
ﬁd_ws
 = 
cur_ws
;

173 
√w_ws
 = 
	`gë_wödowsize
();

174 if(
√w_ws
 !
ﬁd_ws
) {

175 
cur_ws
 = 
√w_ws
;

177 
ws_ch™ge
 = 
cur_ws
-2;

179 if(
	`£tôimî
(
ITIMER_REAL
, 
ôvp
, &
oôv
) < 0) {

180 
	`Ârötf
(
°dîr
, "setitimer: \n");

181 
	`exô
(-1);

184 
cur_ö
 = 0.0;

185 
cur_out
 = 0.0;

186 *
ª£ç
 == 0) {

187 if((
∑ckë
 = 
	`pˇp_√xt
(
pˇp
, &
hódî
)Ë!
NULL
) {

188 
ëhî√t
 = (
ëhî_hódî
 *)
∑ckë
;

190 if(
hódî
.
Àn
 == 671429858) {

191 
cur_ö
 += 0.0;

192 
cur_out
 += 0.0;

194 
åaf_io
 = 
	`ˇlc_åaf_io
(
ëhî_addrs
, 
ëhî√t
);

195 if(
åaf_io
 == 0) {

196 
cur_ö
 +
hódî
.
Àn
;

197 } if(
åaf_io
 == 1) {

198 
cur_out
 +
hódî
.
Àn
;

200 
åaf_io
 = 2;

205 
cur_ö
 /= 1024;

206 
cur_out
 /= 1024;

208 if(
show_ö_bôs
 == 1) {

209 
cur_ö
 *= 8;

210 
cur_out
 *= 8;

213 if(
ôî©i⁄
 >
ws_ch™ge
 || 
tŸÆ_ôî©i⁄
 == 0) {

214 
	`¥ötf
("%11s\n%5†ö %5†out\n", 
i‚ame
, (
show_ö_bôs
 =1Ë? 
bôs_¥efix
 : 
byãs_¥efix
, (show_in_bits == 1) ? bits_prefix : bytes_prefix);

215 if(
ôî©i⁄
 > 1) {

216 
ôî©i⁄
 = 1;

220 if(
tŸÆ_ôî©i⁄
 > 0) {

221 
	`¥ötf
("%8.2l‡%9.2lf\n", 
cur_ö
, 
cur_out
);

224 if(
max_ôî©i⁄
 > 0 && max_ôî©i⁄ =
tŸÆ_ôî©i⁄
) {

228 
ôî©i⁄
++;

229 
tŸÆ_ôî©i⁄
++;

232 
	`pˇp_˛o£
(
pˇp
);

234 
	`exô
(0);

235 
	}
}

238 
	$ˇlc_åaf_io
(*
ëhî_addrs
, 
ëhî_hódî
 *
ëhî√t
) {

243 if(
	`ëhaddr¢cmp
(
ëhî_addrs
, 
ëhî√t
->
ëhî_sho°
, (ether_addrs)) == 0) {

246 if(
	`ëhaddr¢cmp
(
ëhî_addrs
, 
ëhî√t
->
ëhî_dho°
, (ether_addrs)) == 0) {

250 
	}
}

253 
	$ëhaddr¢cmp
(c⁄° *
s1
, c⁄° *
s2
, 
size_t
 
Àn
) {

254 if(
Àn
 == 0) {

259 if(*
s1
++ !*
s2
++) {

260 (*(c⁄° *)
s1
 - *(c⁄° *)(
s2
 - 1));

262 } --
Àn
 != 0);

265 
	}
}

268 
	$ª£t_cou¡
(
sig«l
) {

269 *
ª£ç
 = 
NULL
;

270 
ª£ç
 = &
ª£t
;

272 *
ª£ç
 = 1;

275 
	}
}

278 
	$gë_wödowsize
() {

279 
wösize
 
ws
;

281 if(
	`io˘l
(
STDOUT_FILENO
, 
TIOCGWINSZ
, &
ws
) < 0) {

285 (
ws
.
ws_row
);

286 
	}
}

288 
	$ußge
(c⁄° *
≠≤ame
) {

289 
	`¥ötf
("Ußge: %†-ò<öãrÁ˚> [-bhv] <fûãr>\n", 
≠≤ame
);

290 
	`¥ötf
("\t-i <interface>\t Specify interfaceÅo capture from\n"

296 
	}
}

	@ccan/junkcode/tinkertim@gmail.com-grawk/grawk.c

50 
	~<°dio.h
>

51 
	~<°dlib.h
>

52 
	~<°rög.h
>

53 
	~<gë›t.h
>

54 
	~<sys/ty≥s.h
>

55 
	~<sys/°©.h
>

56 
	~<ªgex.h
>

58 
	#VERSION
 "1.0.7"

	)

59 
	#MAINTAINER
 "Tim Po° <echo@ech‹ïly.us>"

	)

62 
	sawk_∑âîn


64 
	mmaxfõld
;

65 
	mnumfõlds
;

66 **
	mfõlds
;

69 
awk_∑âîn
 
	tawk_∑t_t
;

72 
›ti⁄
 c⁄° 
	gl⁄g_›ti⁄s
[] = {

73 { "ign‹e-ˇ£", 
no_¨gumít
, 0, 'i' },

74 { "wôh-fûíame", 
no_¨gumít
, 0, 'W' },

75 { "no-fûíame", 
no_¨gumít
, 0, 'w' },

76 { "löe-numbî", 
no_¨gumít
, 0, 'n' },

77 { "fõld-£∑øt‹", 
ªquúed_¨gumít
, 0, 'F' },

78 { "hñp", 
no_¨gumít
, 0, 'h' },

79 { "vîsi⁄", 
no_¨gumít
, 0, 'v' },

84 c⁄° *
	g¥og«me
 = "grawk";

87 *
	gtokdñim
 = 
NULL
;

90 
ußge
();

91 
¥o˚ss
(
FILE
 *, 
ªgex_t
, 
awk_∑t_t
, *, );

92 
¥o˚ss_löe
(*, 
awk_∑t_t
, *, *);

93 
¥o˚ss_fûes
(, **, 
ªgex_t
, 
awk_∑t_t
, , );

94 
¥o˚ss_pùe
(
ªgex_t
, 
awk_∑t_t
, );

95 
awkcomp
(
awk_∑t_t
 *, *);

96 
awk‰ì
(
awk_∑t_t
 *);

97 *
ªadlöe
(
FILE
 *);

99 
	$ußge
()

101 
	`¥ötf
("%†%s\n", 
¥og«me
, 
VERSION
);

102 
	`¥ötf
("Usage: %s [OPTION] PATTERN OUTPUT_PATTERN file1 [file2]...\n",

103 
¥og«me
);

104 
	`¥ötf
("Options:\n");

105 
	`¥ötf
(" --help "

107 
	`¥ötf
(" -i, --ignore-case "

109 
	`¥ötf
(" -W, --with-filename "

111 
	`¥ötf
(" -w, --no-filename "

113 
	`¥ötf
(" -n, --line-number "

115 
	`¥ötf
(" -F fs, --field-separator=fs "

117 
	`¥ötf
(" -h, --help "

119 
	`¥ötf
(" -v, --version "

121 
	`¥ötf
(" PATTERN "

123 
	`¥ötf
(" OUTPUT_PATTERN "

126 
	`¥ötf
("\nExamples:\n");

127 
	`¥ötf
(" Retrieve joe123's home directory from /etc/passwd:\n");

128 
	`¥ötf
("\t%†-F : \"j€123\" '$6' /ëc/∑sswd\n", 
¥og«me
);

129 
	`¥ötf
("\n Find fields 2 3ánd 4 onÜinesÅhat begin with @ from stdin:\n");

130 
	`¥ötf
("\tˇàfûe.txà| %†\"^@\" '$2,$3,$4'\n", 
¥og«me
);

131 
	`¥ötf
("\n Useásá simple grep:\n");

132 
	`¥ötf
("\t%†\"°rögÅÿföd\" '$0' /fûe.txt\n", 
¥og«me
);

133 
	`¥ötf
("\nRï‹àbug†tÿ%s\n", 
MAINTAINER
);

134 
	}
}

138 *
	$ªadlöe
(
FILE
 *
Â
)

140 *
°r
 = (*)
NULL
;

141 
ch
 = 0, 
Àn
 = 256, 
°ï
 = 256, 
i
 = 0;

143 
°r
 = (*)
	`mÆloc
(
Àn
);

144 i‡(
°r
 =
NULL
)

145  
°r
;

148 
ch
 = 
	`fgëc
(
Â
);

149 i‡(
	`„of
(
Â
))

151 i‡(
ch
 == '\n' || ch == '\r') {

152 
°r
[
i
++] = 0;

155 
°r
[
i
++] = 
ch
;

156 i‡(
i
 =
Àn
 - 2) {

157 
Àn
 +
°ï
;

158 
°r
 = (*)
	`ªÆloc
(°r, 
Àn
);

159 i‡(
°r
 =
NULL
) {

160 
	`f˛o£
(
Â
);

161  
°r
;

165  
°r
;

166 
	}
}

174 
	$¥o˚ss
(
FILE
 *
Â
, 
ªgex_t
 
ª
, 
awk_∑t_t
 
awk
,

175 *
fûíame
, 
show_löío
)

177 *
öbuf
 = 
NULL
;

178 
¶öío
[32];

179 
	`mem£t
(
¶öío
, 0, (slineno));

180 
löío
 = 0;

181 
found
 = 0;

184 
öbuf
 = 
	`ªadlöe
(
Â
);

185 i‡(!
öbuf
)

187 i‡(
	`„of
(
Â
))

189 
löío
++;

190 i‡(
	`ªgexec
(&
ª
, 
öbuf
, (
size_t
)0, 
NULL
, 0) == 0) {

191 
found
 = 1;

192 i‡(
show_löío
)

193 
	`•rötf
(
¶öío
, "%ld:", 
löío
);

194 i‡(
	`¥o˚ss_löe
(
öbuf
, 
awk
, 
fûíame
, 
¶öío
)) {

195 
	`Ârötf
 (
°dîr
, "Eº‹Öro˚ssögÜöê[%s]\n", 
öbuf
);

196 
	`‰ì
 (
öbuf
);

200 
	`‰ì
 (
öbuf
);

203 i‡(
öbuf
)

204 
	`‰ì
(
öbuf
);

206  
found
;

207 
	}
}

212 
	$¥o˚ss_fûes
(
numfûes
, **
fûes
, 
ªgex_t
 
ª
, 
awk_∑t_t
 
awk
,

213 
show_fûíame
, 
show_löío
)

215 
i
, 
found
 = 0;

216 
FILE
 *
Â
 = 
NULL
;

217 
°©
 
f°©
;

218 
fûíame
[1024];

219 
	`mem£t
(
fûíame
, 0, (filename));

221 
i
 = 0; i < 
numfûes
; i++) {

222 i‡(
	`°©
(
fûes
[
i
], &
f°©
) == -1) {

224 
	`Ârötf
 (
°dîr
,

225 "Eº‹ác˚ssög fûê%s. Nÿsuch fûe\n", 
fûes
[
i
]);

228 i‡(
show_fûíame
)

229 
	`•rötf
–
fûíame
, "%s:", 
fûes
[
i
] );

231 i‡((
f°©
.
°_mode
 & 
S_IFMT
Ë!
S_IFREG
)

233 i‡(
NULL
 =(
Â
 = 
	`f›í
(
fûes
[
i
], "r"))) {

234 
	`Ârötf
(
°dîr
,

235 "Eº‹ o≥nög fûê%s. Pîmissi⁄ díõd\n", 
fûes
[
i
]);

238 i‡(
	`¥o˚ss
(
Â
, 
ª
, 
awk
, 
fûíame
, 
show_löío
) == 1)

239 
found
 = 1;

240 
	`f˛o£
(
Â
);

243  
found
;

244 
	}
}

247 
	$¥o˚ss_pùe
(
ªgex_t
 
ª
, 
awk_∑t_t
 
awk
, 
show_löío
)

249 i‡(
	`¥o˚ss
(
°dö
, 
ª
, 
awk
, "", 
show_löío
) == 1)

253 
	}
}

257 
	$¥o˚ss_löe
(*
öbuf
, 
awk_∑t_t
 
awk
, *
fûíame
, *
löío
)

259 
fuŒ_löe
[3] = { '\1', '0', '\0' };

261 i‡(
awk
.
numfõlds
 =1 && 
	`°rcmp
◊wk.
fõlds
[0], 
fuŒ_löe
) == 0) {

263 
	`Ârötf
 (
°dout
, "%s%s%s\n", 
fûíame
, 
löío
, 
öbuf
);

269 **
löefõlds
 = (**)
	`mÆloc
((
awk
.
maxfõld
 + 1) * (*));

270 *
wrkbuf
 = 
	`°rdup
(
öbuf
), *
tbuf
;

272 
cou¡
 = 0, 
n
 = 1, 
i
;

273 
i
 = 0; i < (
awk
.
maxfõld
 + 1); i++) {

274 
löefõlds
[
i
] = 
NULL
;

277 
tbuf
 = 
	`°πok
(
wrkbuf
, 
tokdñim
);

278 if(
tbuf
)

279 
löefõlds
[0] = 
	`°rdup
(
tbuf
);

281 
tbuf
 !
NULL
) {

282 
tbuf
 = 
	`°πok
(
NULL
, 
tokdñim
);

283 i‡(!
tbuf
)

285 
cou¡
++;

286 i‡(
cou¡
 > 
awk
.
maxfõld
)

288 
löefõlds
[
cou¡
] = 
	`°rdup
(
tbuf
);

289 i‡(!
löefõlds
[
cou¡
]) {

290 
	`Ârötf
(
°dîr
, "CouldÇotállocate memoryÅoÖrocess file %s\n",

291 
fûíame
);

297 
	`Ârötf
(
°dout
, "%s%s", 
fûíame
, 
löío
);

298 
i
 = 0; i < 
awk
.
numfõlds
; i++) {

299 i‡(
awk
.
fõlds
[
i
][0] == '\1') {

300 
n
 = 
	`©oi
(&
awk
.
fõlds
[
i
][1]);

301 i‡(
n
 == 0) {

302 
	`Ârötf
(
°dout
, "%s", 
öbuf
);

305 i‡(
löefõlds
[
n
-1])

306 
	`Ârötf
(
°dout
, "%s", 
löefõlds
[
n
-1]);

309 
	`Ârötf
(
°dout
, "%s", 
awk
.
fõlds
[
i
]);

311 
	`Ârötf
(
°dout
, "\n");

313 i‡(
wrkbuf
)

314 
	`‰ì
(
wrkbuf
);

316 
i
 = 0; i < 
cou¡
; i++) {

317 
	`‰ì
(
löefõlds
[
i
]);

318 
löefõlds
[
i
] = (*Ë
NULL
;

321 
	`‰ì
(
löefõlds
);

322 
löefõlds
 = (**)
NULL
;

325 
	}
}

332 
	$awkcomp
(
awk_∑t_t
 *
awk
, *
≠©ã∫
)

334 
awk
->
maxfõld
 = 0;

335 
awk
->
numfõlds
 = 0;

336 
awk
->
fõlds
 = 
NULL
;

337 
awk
->
fõlds
 = (**)
	`mÆloc
((*));

339 
i
, 
num
 = 0;

340 *
wrkbuf
;

342 
wrkbuf
 = (*)
	`mÆloc
(
	`°æí
(
≠©ã∫
) + 1);

343 i‡(
wrkbuf
 =
NULL
) {

344 
	`‰ì
(
awk
);

345 
	`Ârötf
(
°dîr
, "MemoryállocationÉrror (wrkbuf) ináwkcomp()\n");

349 
öSåög
 = 0, 
offs
 = 0;

350 
ch
;

351 
i
 = 0; i < 
	`°æí
–
≠©ã∫
 ); i++) {

352 
ch
 = 
≠©ã∫
[
i
];

353 i‡(
öSåög
 && 
ch
 != '"' && ch != '\\') {

354 
wrkbuf
[
offs
++] = 
ch
;

357 i‡(
ch
 == ' ')

359 
ch
) {

362 i‡(
öSåög
) {

363 
wrkbuf
[
offs
++] = 
≠©ã∫
[++
i
];

369 
	`Ârötf
(
°dîr
,

376 
öSåög
 = !inString;

377 i‡(
öSåög
)

384 
wrkbuf
[
offs
++] = '\1';

386 
num
 = 0;

388 
ch
 = 
≠©ã∫
[++
i
];

390 i‡(
ch
 < 48 || ch > 57) {

391 
i
--;

394 
num
 = (num * 10Ë+ (
ch
 - 48);

395 
wrkbuf
[
offs
++] = 
ch
;

397 i‡(
num
 > 
awk
->
maxfõld
)

398 
awk
->
maxfõld
 = 
num
;

400 i‡(
wrkbuf
[1] == 0) {

401 
	`Ârötf
(
°dîr
, "Incomplete field descriptorát "

402 "‹Çó∏ch¨a˘î %d i¿awkÖ©ã∫\n", 
i
+1);

408 
wrkbuf
[
offs
++] = ' ';

413 i‡(
offs
 == 0)

416 
wrkbuf
[
offs
] = '\0';

417 
awk
->
fõlds
 =

418 (**)
	`ªÆloc
(
awk
->
fõlds
, (awk->
numfõlds
 + 1)

420 i‡(!
awk
->
fõlds
 ) {

421 
	`Ârötf
(
°dîr
,

425 
awk
->
fõlds
[awk->
numfõlds
] = 
	`°rdup
(
wrkbuf
);

426 i‡(!
awk
->
fõlds
[awk->
numfõlds
]) {

427 
	`Ârötf
(
°dîr
,

429 
awk
->
numfõlds
);

432 
	`mem£t
(
wrkbuf
, 0, 
	`°æí
(
≠©ã∫
) + 1);

433 
awk
->
numfõlds
++;

434 
offs
 = 0;

437 
	`‰ì
(
wrkbuf
);

439 i‡(
awk
->
numfõlds
 == 0) {

440 
	`Ârötf
(
°dîr
,

446 
	}
}

449 
	$awk‰ì
(
awk_∑t_t
 *
awk
 )

451 
i
;

452 
i
 = 0; i < 
awk
->
numfõlds
; i++)

453 
	`‰ì
(
awk
->
fõlds
[
i
]);

455 
	`‰ì
(
awk
->
fõlds
);

456 
	}
}

458 
	$maö
(
¨gc
, **
¨gv
)

460 *
≠©ã∫
 = 
NULL
, *
g∑âîn
 = NULL;

461 **
fûes
 = 
NULL
;

462 
numfûes
 = 0, 
i
 = 0, 
c
 = 0;

463 
ign‹e_ˇ£
 = 0, 
no_fûíame
 = 0, 
wôh_fûíame
 = 0, 
löe_numbî
 = 0;

465 i‡(
¨gc
 < 3) {

466 
	`ußge
();

467  
EXIT_FAILURE
;

470 
tokdñim
 = 
	`°rdup
("\t\r\n ");

472 
›t_öd
 = 0;

473 
c
 != -1) {

474 
c
 = 
	`gë›t_l⁄g
(
¨gc
, 
¨gv
, "wWhöF:", 
l⁄g_›ti⁄s
, &
›t_öd
);

475 
c
) {

477 
wôh_fûíame
 = 0;

478 
no_fûíame
 = 1;

481 
ign‹e_ˇ£
 = 1;

484 
wôh_fûíame
 = 1;

485 
no_fûíame
 = 0;

488 
löe_numbî
 = 1;

491 
tokdñim
 = 
	`ªÆloc
—okdñim, 3 + 
	`°æí
(
›èrg
) + 1);

492 
	`mem£t
(
tokdñim
, 0, 3 + 
	`°æí
–
›èrg
 ) + 1);

493 
	`•rötf
(
tokdñim
, "\t\r\n%s", 
›èrg
);

496 
	`ußge
();

497 
	`‰ì
(
tokdñim
);

498  
EXIT_SUCCESS
;

501 
	`¥ötf
("%s\n", 
VERSION
);

502 
	`‰ì
(
tokdñim
);

503  
EXIT_SUCCESS
;

509 i‡((
¨gc
 - 
›töd
) < 2) {

510 
	`ußge
();

511 
	`‰ì
(
tokdñim
);

512  
EXIT_FAILURE
;

516 
g∑âîn
 = 
	`°rdup
(
¨gv
[
›töd
]);

517 i‡(
g∑âîn
 =
NULL
) {

518 
	`Ârötf
(
°dîr
, "MemoryállocationÉrror");

519 
	`exô
(
EXIT_FAILURE
);

521 
›töd
++;

524 
≠©ã∫
 = 
	`°rdup
(
¨gv
[
›töd
]);

525 if(
≠©ã∫
 =
NULL
) {

526 
	`Ârötf
(
°dîr
, "MemoryállocationÉrror");

527 
	`exô
(
EXIT_FAILURE
);

529 
›töd
++;

533 i‡(
›töd
 < 
¨gc
) {

534 
numfûes
 = 
¨gc
 - 
›töd
;

535 
fûes
 = (**)
	`mÆloc
((*Ë* (
numfûes
 + 1));

536 
i
 = 0; i < 
numfûes
; i++) {

537 
fûes
[
i
] = 
	`°rdup
(
¨gv
[
›töd
 + i]);

542 i‡(
numfûes
 > 1 && 
no_fûíame
 == 0)

543 
wôh_fûíame
 = 1;

548 
ªgex_t
 
ª
;

549 
cÊags
 = 0, 
rc
 = 0;

551 i‡(
ign‹e_ˇ£
)

552 
cÊags
 = 
REG_ICASE
;

554 i‡(
	`ªgcomp
(&
ª
, 
g∑âîn
, 
cÊags
)) {

555 
	`Ârötf
(
°dîr
,

556 "Eº‹ compûög gªp-°yÀÖ©ã∫ [%s]\n", 
g∑âîn
);

557  
EXIT_FAILURE
;

560 
awk_∑t_t
 
awk
;

561 i‡(
	`awkcomp
(&
awk
, 
≠©ã∫
))

563 
	`Ârötf
(
°dîr
,

564 "Eº‹ compûögáwk-°yÀÖ©ã∫ [%s]\n", 
≠©ã∫
);

565  
EXIT_FAILURE
;

568 i‡(
numfûes
 > 0) {

569 if(
	`¥o˚ss_fûes
(

570 
numfûes
, 
fûes
, 
ª
, 
awk
, 
wôh_fûíame
, 
löe_numbî
) == 0)

571 
rc
 = 255;

573 if(
	`¥o˚ss_pùe
(
ª
, 
awk
, 
löe_numbî
) == 0)

574 
rc
 = 255;

578 
i
 = 0; i < 
numfûes
; i++) {

579 i‡(
fûes
[
i
])

580 
	`‰ì
(
fûes
[
i
]);

582 
	`‰ì
(
fûes
);

585 
	`‰ì
(
≠©ã∫
);

588 
	`‰ì
(
g∑âîn
);

591 
	`ªg‰ì
(&
ª
);

594 
	`awk‰ì
(&
awk
);

597 i‡(
tokdñim
)

598 
	`‰ì
(
tokdñim
);

599  
rc
;

600 
	}
}

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/choose.c

1 
	~"choo£.h
"

2 
	~"gcd.h
"

9 
	$choo£
(
_n
,
_m
){

10 
ªt
;

11 
i
;

12 
ªt
=1;

13 
i
=1;i<=
_m
;
_n
--,i++){

14 
nmi
;

15 
nmi
=
_n
%
i
;

16 if(
nmi
==0)
ªt
*=
_n
/
i
;

17 if(
ªt
%
i
==0Ïë=‘ë/i)*
_n
;

19 
d
;

20 
d
=
	`gcd
(
i
,
nmi
);

21 
ªt
=‘ë/(
i
/
d
))*(
_n
/d);

24  
ªt
;

25 
	}
}

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/choose.h

1 #i‡!
deföed
(
_choo£_H
)

2 
	#_choo£_H
 (1)

	)

9 
choo£
(
_n
,
_m
);

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/crt.c

1 
	~"¸t.h
"

2 
	~"egcd.h
"

22 
	$¸t
(*
_x
,c⁄° 
_a
[],c⁄° 
_m
[],
_n
){

23 
i
;

24 
m0
;

25 
a0
;

26 
x0
;

28 if(
_n
<1){

29 *
_x
=0;

34 
m0
=
_m
[0]<0?-_m[0]:_m[0];

35 
a0
=
_a
[0];

38 
i
=1;i<
_n
;i++){

39 
d
;

40 
mi
;

41 
xi
;

43 
mi
=
_m
[
i
]<0?-_m[i]:_m[i];

46 
d
=
	`egcd
(
m0
,
mi
,&
xi
,&
x0
);

47 if(
d
>1){

50 if((
a0
-
_a
[
i
])%
d
!=0) -1;

52 if(
d
==
m0
){

53 
a0
=
_a
[
i
];

54 
m0
=
mi
;

57 if(
d
!=
mi
){

73 
m0
/=
d
;

74 
	`egcd
(
m0
,
mi
/
d
,&
xi
,&
x0
);

75 
a0
+=(
_a
[
i
]-a0)*
m0
*
xi
;

76 
m0
*=
mi
;

77 
a0
˜0%
m0
;

80 if(
d
==1){

84 
a0
˜0*
mi
*
x0
+
_a
[
i
]*
m0
*
xi
;

86 
m0
*=
mi
;

87 
a0
%=
m0
;

91 if(
a0
!=
_a
[
i
]) -1;

96 if(
m0
!=0){

97 
x0
=
a0
%
m0
;

98 *
_x
=
x0
<0?x0+
m0
:x0;

101 *
_x
=
a0
;

102  
m0
;

103 
	}
}

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/crt.h

1 #i‡!
deföed
(
_¸t_H
)

2 
	#_¸t_H
 (1)

	)

22 
¸t
(*
_x
,c⁄° 
_a
[],c⁄° 
_m
[],
_n
);

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/egcd.c

1 
	~"egcd.h
"

22 
	$egcd
(
_a
,
_b
,*
_u
,*
_v
){

23 
a
;

24 
b
;

25 
s
;

26 
t
;

27 
u
;

28 
v
;

31 
a
=
_a
<0?-_a:_a;

32 
b
=
_b
<0?-_b:_b;

34 
s
=
v
=0;

35 
t
=
u
=1;

36 
b
){

37 
q
;

38 
r
;

39 
w
;

40 
q
=
a
/
b
;

41 
r
=
a
%
b
;

42 
a
=
b
;

43 
b
=
r
;

44 
w
=
s
;

45 
s
=
u
-
q
*s;

46 
u
=
w
;

47 
w
=
t
;

48 
t
=
v
-
q
*t;

49 
v
=
w
;

53 *
_u
=
_a
<0?-
u
:u;

54 *
_v
=
_b
<0?-
v
:v;

55  
a
;

56 
	}
}

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/egcd.h

1 #i‡!
deföed
(
_egcd_H
)

2 
	#_egcd_H
 (1)

	)

23 
egcd
(
_a
,
_b
,*
_u
,*
_v
);

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/gcd.c

1 
	~"gcd.h
"

10 
	$gcd
(
_a
,
_b
){

13 if(
_a
<0)_a=-_a;

14 if(
_b
<0)_b=-_b;

16 
_b
){

17 
r
;

18 
r
=
_a
%
_b
;

19 
_a
=
_b
;

20 
_b
=
r
;

22  
_a
;

23 
	}
}

	@ccan/junkcode/tterribe@email.unc.edu-nmbrthry/gcd.h

1 #i‡!
deföed
(
_gcd_H
)

2 
	#_gcd_H
 (1)

	)

11 
gcd
(
_a
,
_b
);

	@ccan/tools/ccan_depends.c

1 
	~"toﬁs.h
"

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<cˇn/îr/îr.h
>

5 
	~<cˇn/°r/°r.h
>

7 
	$maö
(
¨gc
, *
¨gv
[])

9 **
dïs
;

10 
i
;

11 
boﬁ
 
compûe
 = 
Ál£
;

12 
boﬁ
 
ªcur£
 = 
åue
;

13 
boﬁ
 
cˇn
 = 
åue
;

14 c⁄° *
°yÀ
 = "depends";

16 i‡(
¨gv
[1] && 
	`°ªq
(argv[1], "--direct")) {

17 
¨gv
++;

18 
¨gc
--;

19 
ªcur£
 = 
Ál£
;

21 i‡(
¨gv
[1] && 
	`°ªq
(argv[1], "--compile")) {

22 
¨gv
++;

23 
¨gc
--;

24 
compûe
 = 
åue
;

26 i‡(
¨gv
[1] && 
	`°ªq
(argv[1], "--non-ccan")) {

27 
¨gv
++;

28 
¨gc
--;

29 
cˇn
 = 
Ál£
;

31 i‡(
¨gv
[1] && 
	`°ªq
(argv[1], "--tests")) {

32 
¨gv
++;

33 
¨gc
--;

34 
°yÀ
 = "testdepends";

36 i‡(
¨gc
 != 2)

37 
	`îrx
(1, "Usage: ccan_depends [--direct] [--compile] [--non-ccan] [--tests] <dir>\n"

41 i‡(!
cˇn
 && !
compûe
)

42 
	`îrx
(1, "--non-ccanÇeeds --compile");

44 i‡(
compûe
)

45 
dïs
 = 
	`gë_dïs
(
NULL
, 
¨gv
[1], 
°yÀ
, 
ªcur£
, 
compûe_öfo
);

47 
dïs
 = 
	`gë_ß„_cˇn_dïs
(
NULL
, 
¨gv
[1], 
°yÀ
, 
ªcur£
);

49 
i
 = 0; 
dïs
[i]; i++)

50 i‡(
	`°r°¨ts
(
dïs
[
i
], "cˇn/"Ë=
cˇn
)

51 
	`¥ötf
("%s\n", 
dïs
[
i
]);

53 
	}
}

	@ccan/tools/ccan_dir.c

1 
	~<cˇn/îr/îr.h
>

2 
	~<cˇn/èl/∑th/∑th.h
>

3 
	~"toﬁs.h
"

4 
	~<as£π.h
>

5 
	~<°rög.h
>

6 
	~<°dlib.h
>

9 
	$cˇn_dú_¥efix
(c⁄° *
fuŒdú
)

11 
i
;

13 
	`as£π
(
fuŒdú
[0] == '/');

14 
i
 = 
	`°æí
(
fuŒdú
) - 1; i > 0; i--) {

15 i‡(
	`°∫cmp
(
fuŒdú
+
i
, "/ccan", 5) != 0)

17 i‡(
fuŒdú
[
i
+5] != '\0' && fulldir[i+5] != '/')

19  
i
 + 1;

22 
	}
}

24 c⁄° *
	$föd_cˇn_dú
(c⁄° *
ba£
)

26 *
cˇn_dú
;

28 i‡(!
cˇn_dú
) {

29 i‡(
ba£
[0] != '/') {

30 c⁄° *
tmp˘x
 = 
	`∑th_cwd
(
NULL
);

31 
	`föd_cˇn_dú
(
	`∑th_joö
(
tmp˘x
,Åmp˘x, 
ba£
));

32 
	`èl_‰ì
(
tmp˘x
);

34 
¥efix
 = 
	`cˇn_dú_¥efix
(
ba£
);

35 i‡(
¥efix
)

36 
cˇn_dú
 = 
	`èl_°∫dup
(
NULL
, 
ba£
, 
¥efix
);

39  
cˇn_dú
;

40 
	}
}

	@ccan/tools/ccanlint/async.c

1 
	~"cˇ∆öt.h
"

2 
	~"../toﬁs.h
"

3 
	~<sys/ty≥s.h
>

4 
	~<sys/time.h
>

5 
	~<sys/ªsour˚.h
>

6 
	~<sys/waô.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

11 
	~<îr.h
>

12 
	~<as£π.h
>

13 
	~<cˇn/lbÆ™˚/lbÆ™˚.h
>

14 
	~<cˇn/éi°/éi°.h
>

15 
	~<cˇn/time/time.h
>

17 
lbÆ™˚
 *
	glb
;

18 
TLIST_TYPE
(
comm™d
, command);

19 
éi°_comm™d
 
	g≥ndög
 = 
TLIST_INIT
(
≥ndög
);

20 
éi°_comm™d
 
	gru¬ög
 = 
TLIST_INIT
(
ru¬ög
);

21 
	gnum_ru¬ög
 = 0;

22 
éi°_comm™d
 
	gd⁄e
 = 
TLIST_INIT
(
d⁄e
);

24 
	scomm™d
 {

25 
li°_node
 
	mli°
;

26 *
	mcomm™d
;

27 
pid_t
 
	mpid
;

28 
	mouçut_fd
;

29 
	mtime_ms
;

30 
lbÆ™˚_èsk
 *
	mèsk
;

31 
	m°©us
;

32 *
	mouçut
;

33 
boﬁ
 
	md⁄e
;

34 c⁄° *
	m˘x
;

37 
	$kûlme
(
sig
)

39 
	`kûl
(-
	`gëpid
(), 
SIGKILL
);

40 
	}
}

42 
	$run_m‹e
()

44 
comm™d
 *
c
;

46 
num_ru¬ög
 < 
	`lbÆ™˚_èrgë
(
lb
)) {

47 
p
[2];

49 
c
 = 
	`éi°_t›
(&
≥ndög
, 
li°
);

50 i‡(!
c
)

53 
	`fÊush
(
°dout
);

54 i‡(
	`pùe
(
p
) != 0)

55 
	`îr
(1, "Pipe failed");

56 
c
->
pid
 = 
	`f‹k
();

57 i‡(
c
->
pid
 == -1)

58 
	`îr
(1, "Fork failed");

59 i‡(
c
->
pid
 == 0) {

60 
ôimîvÆ
 
ôim
;

62 i‡(
	`dup2
(
p
[1], 
STDOUT_FILENO
) != STDOUT_FILENO

63 || 
	`dup2
(
p
[1], 
STDERR_FILENO
) != STDERR_FILENO

64 || 
	`˛o£
(
p
[0]) != 0

65 || 
	`˛o£
(
STDIN_FILENO
) != 0

66 || 
	`›í
("/dev/nuŒ", 
O_RDONLY
Ë!
STDIN_FILENO
)

67 
	`exô
(128);

69 
	`sig«l
(
SIGALRM
, 
kûlme
);

70 
ôim
.
ô_öãrvÆ
.
tv_£c
 = itim.ô_öãrvÆ.
tv_u£c
 = 0;

71 
ôim
.
ô_vÆue
 = 
	`time•ec_to_timevÆ
(
	`time_‰om_m£c
(
c
->
time_ms
));

72 
	`£tôimî
(
ITIMER_REAL
, &
ôim
, 
NULL
);

74 
c
->
°©us
 = 
	`sy°em
(c->
comm™d
);

75 i‡(
	`WIFEXITED
(
c
->
°©us
))

76 
	`exô
(
	`WEXITSTATUS
(
c
->
°©us
));

78 
	`exô
(128 + 
	`WTERMSIG
(
c
->
°©us
));

81 i‡(
toﬁs_vîbo£
)

82 
	`¥ötf
("Ru¬ögásync: %†=> %i\n", 
c
->
comm™d
, c->
pid
);

84 
	`˛o£
(
p
[1]);

85 
c
->
ouçut_fd
 = 
p
[0];

86 
c
->
èsk
 = 
	`lbÆ™˚_èsk_√w
(
lb
);

87 
	`éi°_dñ_‰om
(&
≥ndög
, 
c
, 
li°
);

88 
	`éi°_add_èû
(&
ru¬ög
, 
c
, 
li°
);

89 
num_ru¬ög
++;

91 
	}
}

93 
	$de°roy_comm™d
(
comm™d
 *command)

95 i‡(!
comm™d
->
d⁄e
 && comm™d->
pid
) {

96 
	`kûl
(-
comm™d
->
pid
, 
SIGKILL
);

97 
	`˛o£
(
comm™d
->
ouçut_fd
);

98 
num_ru¬ög
--;

101 
	`éi°_dñ
(
comm™d
, 
li°
);

102 
	}
}

104 
	$run_comm™d_async
(c⁄° *
˘x
, 
time_ms
,

105 c⁄° *
fmt
, ...)

107 
comm™d
 *command;

108 
va_li°
 
≠
;

110 
	`as£π
(
˘x
);

112 i‡(!
lb
)

113 
lb
 = 
	`lbÆ™˚_√w
();

115 
comm™d
 = 
	`èl
(
˘x
, command);

116 
comm™d
->
˘x
 = ctx;

117 
comm™d
->
time_ms
 =Åime_ms;

118 
comm™d
->
pid
 = 0;

120 
comm™d
->
ouçut
 = 
	`èl_¨rz
(command, , 1);

121 
	`va_°¨t
(
≠
, 
fmt
);

122 
comm™d
->comm™d = 
	`èl_vfmt
(comm™d, 
fmt
, 
≠
);

123 
	`va_íd
(
≠
);

124 
	`éi°_add_èû
(&
≥ndög
, 
comm™d
, 
li°
);

125 
comm™d
->
d⁄e
 = 
Ál£
;

126 
	`èl_add_de°ru˘‹
(
comm™d
, 
de°roy_comm™d
);

128 
	`run_m‹e
();

129 
	}
}

131 
	$ª≠_ouçut
()

133 
fd_£t
 
ö
;

134 
comm™d
 *
c
, *
√xt
;

135 
max_fd
 = 0;

137 
	`FD_ZERO
(&
ö
);

139 
	`éi°_f‹_óch
(&
ru¬ög
, 
c
, 
li°
) {

140 
	`FD_SET
(
c
->
ouçut_fd
, &
ö
);

141 i‡(
c
->
ouçut_fd
 > 
max_fd
)

142 
max_fd
 = 
c
->
ouçut_fd
;

145 i‡(
	`£À˘
(
max_fd
+1, &
ö
, 
NULL
, NULL, NULL) < 0)

146 
	`îr
(1, "select failed");

148 
	`éi°_f‹_óch_ß„
(&
ru¬ög
, 
c
, 
√xt
, 
li°
) {

149 i‡(
	`FD_ISSET
(
c
->
ouçut_fd
, &
ö
)) {

150 
ﬁd_Àn
, 
Àn
;

152 
ﬁd_Àn
 = 
	`èl_cou¡
(
c
->
ouçut
);

153 
	`èl_ªsize
(&
c
->
ouçut
, 
ﬁd_Àn
 + 1024);

154 
Àn
 = 
	`ªad
(
c
->
ouçut_fd
, c->
ouçut
 + 
ﬁd_Àn
 - 1, 1024);

155 i‡(
Àn
 < 0)

156 
	`îr
(1, "Reading fromásync command");

157 
	`èl_ªsize
(&
c
->
ouçut
, 
ﬁd_Àn
 + 
Àn
);

158 
c
->
ouçut
[
ﬁd_Àn
 + 
Àn
 - 1] = '\0';

159 i‡(
Àn
 == 0) {

160 
rußge
 
ru
;

161 
	`waô4
(
c
->
pid
, &c->
°©us
, 0, &
ru
);

162 i‡(
toﬁs_vîbo£
)

163 
	`¥ötf
("Finishedásync %i: %s %u\n",

164 
c
->
pid
,

165 
	`WIFEXITED
(
c
->
°©us
)

168 
	`WIFEXITED
(
c
->
°©us
)

169 ? 
	`WEXITSTATUS
(
c
->
°©us
)

170 : 
	`WTERMSIG
(
c
->
°©us
));

171 
	`lbÆ™˚_èsk_‰ì
(
c
->
èsk
, &
ru
);

172 
c
->
èsk
 = 
NULL
;

173 
c
->
d⁄e
 = 
åue
;

174 
	`˛o£
(
c
->
ouçut_fd
);

175 
	`éi°_dñ_‰om
(&
ru¬ög
, 
c
, 
li°
);

176 
	`éi°_add_èû
(&
d⁄e
, 
c
, 
li°
);

177 
num_ru¬ög
--;

181 
	}
}

183 *
	$cﬁÀ˘_comm™d
(
boﬁ
 *
ok
, **
ouçut
)

185 
comm™d
 *
c
;

186 c⁄° *
˘x
;

188 (
c
 = 
	`éi°_t›
(&
d⁄e
, 
li°
)Ë=
NULL
) {

189 i‡(
	`éi°_em±y
(&
≥ndög
Ë&&Åli°_em±y(&
ru¬ög
))

190  
NULL
;

191 
	`ª≠_ouçut
();

192 
	`run_m‹e
();

195 *
ok
 = (
	`WIFEXITED
(
c
->
°©us
Ë&& 
	`WEXITSTATUS
(c->status) == 0);

196 
˘x
 = 
c
->ctx;

197 *
ouçut
 = 
	`èl_°ól
(
˘x
, 
c
->output);

198 
	`èl_‰ì
(
c
);

199  (*)
˘x
;

200 
	}
}

203 
	$compûe_™d_lök_async
(c⁄° *
˘x
, 
time_ms
,

204 c⁄° *
cfûe
, c⁄° *
cˇndú
,

205 c⁄° *
objs
, c⁄° *
compûî
,

206 c⁄° *
cÊags
,

207 c⁄° *
libs
, c⁄° *
outfûe
)

209 i‡(
compûe_vîbo£
)

210 
	`¥ötf
("CompûögándÜökög (asyncË%s\n", 
outfûe
);

211 
	`run_comm™d_async
(
˘x
, 
time_ms
,

213 
compûî
, 
cÊags
,

214 
cˇndú
, 
outfûe
, 
cfûe
, 
objs
, 
libs
);

215 
	}
}

	@ccan/tools/ccanlint/ccanlint.c

20 
	~"cˇ∆öt.h
"

21 
	~"../toﬁs.h
"

22 
	~"../ªad_c⁄fig_hódî.h
"

23 
	~<uni°d.h
>

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<îr.h
>

28 
	~<˘y≥.h
>

29 
	~<cˇn/°r/°r.h
>

30 
	~<cˇn/èke/èke.h
>

31 
	~<cˇn/›t/›t.h
>

32 
	~<cˇn/f‹óch/f‹óch.h
>

33 
	~<cˇn/ˇ°/ˇ°.h
>

34 
	~<cˇn/éi°/éi°.h
>

35 
	~<cˇn/èl/∑th/∑th.h
>

36 
	~<cˇn/°rm≠/°rm≠.h
>

38 
	scˇ∆öt_m≠
 {

39 
STRMAP_MEMBERS
(
cˇ∆öt
 *);

42 
	gvîbo£
 = 0;

43 
cˇ∆öt_m≠
 
	gã°s
;

44 
boﬁ
 
	gß„_mode
 = 
Ál£
;

45 
boﬁ
 
	gkìp_ªsu…s
 = 
Ál£
;

46 
boﬁ
 
	gn⁄_cˇn_dïs
 = 
Ál£
;

47 
boﬁ
 
	gbuûd_Áûed
 = 
Ál£
;

48 
boﬁ
 
	gèrgëög
 = 
Ál£
;

49 
	gtimeout
;

51 c⁄° *
	gc⁄fig_hódî
;

53 c⁄° *
	gcˇn_dú
;

56 
	$ödít_¥öt
(c⁄° *
°rög
)

58 *
°rög
) {

59 
löe
 = 
	`°rc•n
(
°rög
, "\n");

60 
	`¥ötf
("\t%.*s", 
löe
, 
°rög
);

61 i‡(
°rög
[
löe
] == '\n') {

62 
	`¥ötf
("\n");

63 
löe
++;

65 
°rög
 +
löe
;

67 
	}
}

70 
boﬁ
 
	$ask
(c⁄° *
que°i⁄
)

72 
ª∂y
[80];

74 
	`¥ötf
("%†", 
que°i⁄
);

75 
	`fÊush
(
°dout
);

77  
	`fgës
(
ª∂y
, ‘ïly), 
°dö
Ë!
NULL


78 && 
	`touµî
(
ª∂y
[0]) == 'Y';

79 
	}
}

82 
boﬁ
 
	$skù_ã°
(
dgøph_node
 *
node
, c⁄° *
why
)

84 
cˇ∆öt
 *
c
 = 
	`c⁄èöî_of
(
node
, ccanlint,Çode);

85 
c
->
skù
 = 
why
;

86  
åue
;

87 
	}
}

89 c⁄° *
	$dï_Áûed
(
m™i„°
 *
m
)

92 
	}
}

94 
boﬁ
 
	$ˇ¬Ÿ_run
(
dgøph_node
 *
node
, *
Æl
)

96 
cˇ∆öt
 *
c
 = 
	`c⁄èöî_of
(
node
, ccanlint,Çode);

97 
c
->
ˇn_run
 = 
dï_Áûed
;

99  
åue
;

100 
	}
}

102 
	srun_öfo
 {

103 
boﬁ
 
	mquõt
;

104 
	msc‹e
, 
	mtŸÆ
;

105 
m™i„°
 *
	mm
;

106 c⁄° *
	m¥efix
;

107 
boﬁ
 
	m∑ss
;

110 
boﬁ
 
	$run_ã°
(
dgøph_node
 *
n
, 
run_öfo
 *
run
)

112 
cˇ∆öt
 *
i
 = 
	`c⁄èöî_of
(
n
, cˇ∆öt, 
node
);

113 
timñe·
;

114 
sc‹e
 *score;

116 i‡(
i
->
d⁄e
)

117  
åue
;

119 
sc‹e
 = 
	`èl
(
run
->
m
, score);

120 
	`li°_hód_öô
(&
sc‹e
->
≥r_fûe_îr‹s
);

121 
sc‹e
->
îr‹
 = 
NULL
;

122 
sc‹e
->
∑ss
 = 
Ál£
;

123 
sc‹e
->score = 0;

124 
sc‹e
->
tŸÆ
 = 1;

130 i‡(
i
->
skù
) {

131 i‡(
vîbo£
)

132 
	`¥ötf
("%s%s: skipped (%s)\n",

133 
run
->
¥efix
, 
i
->
«me
, i->
skù
);

135 
sc‹e
->
∑ss
 = 
åue
;

136 
out
;

139 i‡(
i
->
ˇn_run
) {

140 
i
->
skù
 = i->
	`ˇn_run
(
run
->
m
);

141 i‡(
i
->
skù
) {

143 i‡(
vîbo£
 > 1)

144 
	`¥ötf
("%s%s: skipped (%s)\n",

145 
run
->
¥efix
, 
i
->
«me
, i->
skù
);

147 
	`dgøph_åavî£_‰om
(&
i
->
node
, 
ˇ¬Ÿ_run
, 
NULL
);

148 
sc‹e
->
∑ss
 = 
åue
;

149 
sc‹e
->
tŸÆ
 = 0;

150 
out
;

154 
timñe·
 = 
timeout
 ?Åimeouà: 
deÁu…_timeout_ms
;

155 
i
->
	`check
(
run
->
m
, &
timñe·
, 
sc‹e
);

156 i‡(
timeout
 && 
timñe·
 == 0) {

157 
i
->
skù
 = "timeout";

158 i‡(
vîbo£
)

159 
	`¥ötf
("%s%s: skipped (%s)\n",

160 
run
->
¥efix
, 
i
->
«me
, i->
skù
);

162 
	`dgøph_åavî£_‰om
(&
i
->
node
, 
skù_ã°
,

164 
sc‹e
->
∑ss
 = 
åue
;

165 
sc‹e
->
tŸÆ
 = 0;

166 
out
;

169 
	`as£π
(
sc‹e
->sc‹ê<sc‹e->
tŸÆ
);

170 i‡((!
sc‹e
->
∑ss
 && !
run
->
quõt
)

171 || (
sc‹e
->sc‹ê< sc‹e->
tŸÆ
 && 
vîbo£
)

172 || 
vîbo£
 > 1) {

173 
	`¥ötf
("%s%s (%s): %s",

174 
run
->
¥efix
, 
i
->
«me
, i->
key
,

175 
sc‹e
->
∑ss
 ? "PASS" : "FAIL");

176 i‡(
sc‹e
->
tŸÆ
 > 1)

177 
	`¥ötf
(" (+%u/%u)", 
sc‹e
->sc‹e, sc‹e->
tŸÆ
);

178 
	`¥ötf
("\n");

181 i‡((!
run
->
quõt
 && !
sc‹e
->
∑ss
Ë|| 
vîbo£
) {

182 i‡(
sc‹e
->
îr‹
) {

183 
	`¥ötf
("%s%s", 
sc‹e
->
îr‹
,

184 
	`°ªnds
(
sc‹e
->
îr‹
, "\n") ? "" : "\n");

187 i‡(!
run
->
quõt
 && 
sc‹e
->sc‹ê< sc‹e->
tŸÆ
 && 
i
->
h™dÀ
)

188 
i
->
	`h™dÀ
(
run
->
m
, 
sc‹e
);

190 i‡(!
sc‹e
->
∑ss
) {

192 
	`dgøph_åavî£_‰om
(&
i
->
node
, 
skù_ã°
, "dependency failed");

195 
out
:

196 
run
->
sc‹e
 += score->score;

197 
run
->
tŸÆ
 +
sc‹e
->total;

200 
run
->
∑ss
 &
sc‹e
->pass;

201 
i
->
d⁄e
 = 
åue
;

203 i‡(!
sc‹e
->
∑ss
 && 
i
->
compuls‹y
) {

204 
	`w¨nx
("%s%†Áûed", 
run
->
¥efix
, 
i
->
«me
);

205 
run
->
sc‹e
 = 0;

206  
Ál£
;

208  
åue
;

209 
	}
}

211 
	$ªgi°î_ã°
(
cˇ∆öt
 *
ã°
)

213 i‡(!
	`°rm≠_add
(&
ã°s
, 
ã°
->
key
,Åest))

214 
	`îr
(1, "AddögÅe° %s", 
ã°
->
key
);

215 
ã°
->
›ti⁄s
 = 
	`èl_¨r
(
NULL
, *, 1);

216 
ã°
->
›ti⁄s
[0] = 
NULL
;

217 
	`dgøph_öô_node
(&
ã°
->
node
);

218 
	}
}

220 
boﬁ
 
	$gë_ã°
(c⁄° *
membî
, 
cˇ∆öt
 *
i
,

221 
cˇ∆öt
 **
ªt
)

223 i‡(
	`éi°_em±y
(&
i
->
node
.
edge
[
DGRAPH_TO
])) {

224 *
ªt
 = 
i
;

225  
Ál£
;

227  
åue
;

228 
	}
}

233 
ölöe
 
cˇ∆öt
 *
	$gë_√xt_ã°
()

235 
cˇ∆öt
 *
i
 = 
NULL
;

237 
	`°rm≠_ôî©e
(&
ã°s
, 
gë_ã°
, &
i
);

238 i‡(
i
)

239  
i
;

241 i‡(
	`°rm≠_em±y
(&
ã°s
))

242  
NULL
;

244 
	`îrx
(1, "Can't makeÖrocess;Åest dependency cycle");

245 
	}
}

247 
cˇ∆öt
 *
	$föd_ã°
(c⁄° *
key
)

249  
	`°rm≠_gë
(&
ã°s
, 
key
);

250 
	}
}

252 
boﬁ
 
	$is_ex˛uded
(c⁄° *
«me
)

254  
	`föd_ã°
(
«me
)->
skù
 !
NULL
;

255 
	}
}

257 
boﬁ
 
	$öô_dïs
(c⁄° *
membî
, 
cˇ∆öt
 *
c
, *
unu£d
)

259 **
dïs
 = 
	`èl_°r•lô
(
NULL
, 
c
->
√eds
, " ", 
STR_EMPTY_OK
);

260 
i
;

262 
i
 = 0; 
dïs
[i]; i++) {

263 
cˇ∆öt
 *
dï
;

265 
dï
 = 
	`föd_ã°
(
dïs
[
i
]);

266 i‡(!
dï
)

267 
	`îrx
(1, "BUG: unknown dep '%s' for %s",

268 
dïs
[
i
], 
c
->
key
);

269 
	`dgøph_add_edge
(&
dï
->
node
, &
c
->node);

271 
	`èl_‰ì
(
dïs
);

272  
åue
;

273 
	}
}

275 
boﬁ
 
	$check_«mes
(c⁄° *
membî
, 
cˇ∆öt
 *
c
,

276 
cˇ∆öt_m≠
 *
«mes
)

278 i‡(!
	`°rm≠_add
(
«mes
, 
c
->
«me
, c))

279 
	`îr
(1, "Du∂iˇãÇamê%s", 
c
->
«me
);

280  
åue
;

281 
	}
}

283 
	$öô_ã°s
()

285 
cˇ∆öt_m≠
 
«mes
;

286 
cˇ∆öt
 **
èbÀ
;

287 
size_t
 
i
, 
num
;

289 
	`°rm≠_öô
(&
ã°s
);

291 
èbÀ
 = 
	`autod©a_gë
(
cˇ∆öt_ã°s
, &
num
);

292 
i
 = 0; i < 
num
; i++)

293 
	`ªgi°î_ã°
(
èbÀ
[
i
]);

294 
	`autod©a_‰ì
(
èbÀ
);

296 
	`°rm≠_ôî©e
(&
ã°s
, 
öô_dïs
, 
NULL
);

299 
	`°rm≠_öô
(&
«mes
);

300 
	`°rm≠_ôî©e
(&
ã°s
, 
check_«mes
, &
«mes
);

301 
	`°rm≠_˛ór
(&
«mes
);

302 
	}
}

304 
boﬁ
 
	$ª£t_ã°
(
dgøph_node
 *
node
, *
unu£d
)

306 
cˇ∆öt
 *
c
 = 
	`c⁄èöî_of
(
node
, ccanlint,Çode);

307 
c
->
skù
 = 
NULL
;

308 
c
->
d⁄e
 = 
Ál£
;

309  
åue
;

310 
	}
}

312 
	$ª£t_ã°s
(
dgøph_node
 *
Æl
)

314 
	`dgøph_åavî£_to
(
Æl
, 
ª£t_ã°
, 
NULL
);

315 
	}
}

317 
boﬁ
 
	$¥öt_dïs
(c⁄° *
membî
, 
cˇ∆öt
 *
c
, *
unu£d
)

319 i‡(!
	`éi°_em±y
(&
c
->
node
.
edge
[
DGRAPH_FROM
])) {

320 
dgøph_edge
 *
e
;

322 
	`¥ötf
("The£ dïíd o¿%s:\n", 
c
->
key
);

323 
	`dgøph_f‹_óch_edge
(&
c
->
node
, 
e
, 
DGRAPH_FROM
) {

324 
cˇ∆öt
 *
to
 = 
	`c⁄èöî_of
(
e
->
n
[
DGRAPH_TO
],

325 
cˇ∆öt
,

326 
node
);

327 
	`¥ötf
("\t%s\n", 
to
->
key
);

330  
åue
;

331 
	}
}

333 
	$¥öt_ã°_dïíds
()

335 
	`¥ötf
("Tests:\n");

337 
	`°rm≠_ôî©e
(&
ã°s
, 
¥öt_dïs
, 
NULL
);

338 
	}
}

341 
	$show_tmpdú
(c⁄° *
dú
)

343 
	`¥ötf
("You c™ föd cˇ∆öàw‹kög fûe†ö '%s'\n", 
dú
);

344 
	}
}

346 *
	$kìp_ã°s
(*
unu£d
)

348 
kìp_ªsu…s
 = 
åue
;

351 
	`kìp_ãmp_dú
();

352 
	`èl_add_de°ru˘‹
(
	`ãmp_dú
(), 
show_tmpdú
);

353  
NULL
;

354 
	}
}

356 
boﬁ
 
	$ªmove_ã°
(
dgøph_node
 *
node
, c⁄° *
why
)

358 
cˇ∆öt
 *
c
 = 
	`c⁄èöî_of
(
node
, ccanlint,Çode);

359 
c
->
skù
 = 
why
;

360 
	`dgøph_˛ór_node
(
node
);

361  
åue
;

362 
	}
}

364 *
	$ex˛ude_ã°
(c⁄° *
ã°«me
, *
unu£d
)

366 
cˇ∆öt
 *
i
 = 
	`föd_ã°
(
ã°«me
);

367 i‡(!
i
)

368  
	`èl_fmt
(
NULL
, "Nÿã° %†tÿ--ex˛ude", 
ã°«me
);

371 
	`dgøph_åavî£_‰om
(&
i
->
node
, 
ªmove_ã°
, "excluded on commandÜine");

372 
	`ªmove_ã°
(&
i
->
node
, "excluded on commandÜine");

373  
NULL
;

374 
	}
}

376 
	$skù_ã°_™d_dïs
(
cˇ∆öt
 *
c
, c⁄° *
why
)

379 
	`dgøph_åavî£_‰om
(&
c
->
node
, 
skù_ã°
, 
why
);

380 
	`skù_ã°
(&
c
->
node
, 
why
);

381 
	}
}

383 *
	$li°_ã°s
(*
¨g
)

385 
cˇ∆öt
 *
i
;

387 
	`¥ötf
("Tests:\n");

389 (
i
 = 
	`gë_√xt_ã°
()Ë!
NULL
) {

390 
	`¥ötf
(" %-25†%s\n", 
i
->
key
, i->
«me
);

391 
	`dgøph_˛ór_node
(&
i
->
node
);

392 
	`°rm≠_dñ
(&
ã°s
, 
i
->
key
, 
NULL
);

394 
	`exô
(0);

395 
	}
}

397 
boﬁ
 
	$døw_ã°
(c⁄° *
membî
, 
cˇ∆öt
 *
c
, c⁄° *
°yÀ
)

403 
	`¥ötf
("\t\"%p\" [œbñ=\"%s\"%s]\n", 
c
, c->
key
, 
°yÀ
);

404  
åue
;

405 
	}
}

407 
	$ã°_dgøph_vîti˚s
(c⁄° *
°yÀ
)

409 
	`°rm≠_ôî©e
(&
ã°s
, 
døw_ã°
, 
°yÀ
);

410 
	}
}

412 
boﬁ
 
	$døw_edges
(c⁄° *
membî
, 
cˇ∆öt
 *
c
, *
unu£d
)

414 
dgøph_edge
 *
e
;

416 
	`dgøph_f‹_óch_edge
(&
c
->
node
, 
e
, 
DGRAPH_FROM
) {

417 
cˇ∆öt
 *
to
 = 
	`c⁄èöî_of
(
e
->
n
[
DGRAPH_TO
],

418 
cˇ∆öt
,

419 
node
);

420 
	`¥ötf
("\t\"%p\" -> \"%p\"\n", 
c
->
«me
, 
to
->name);

422  
åue
;

423 
	}
}

425 
	$ã°_dgøph_edges
()

427 
	`°rm≠_ôî©e
(&
ã°s
, 
døw_edges
, 
NULL
);

428 
	}
}

430 *
	$ã°_dïídícy_gøph
(*
¨g
)

432 
	`puts
("digraph G {");

434 
	`ã°_dgøph_vîti˚s
("");

435 
	`ã°_dgøph_edges
();

437 
	`puts
("}");

439 
	`exô
(0);

440 
	}
}

442 
	$add_›ti⁄s
(
cˇ∆öt
 *
ã°
, **
›ti⁄s
,

443 
num_›ti⁄s
)

445 
num
;

447 i‡(!
ã°
->
›ti⁄s
)

448 
num
 = 0;

451 
num
 = 
	`èl_cou¡
(
ã°
->
›ti⁄s
) - 1;

453 
	`èl_ªsize
(&
ã°
->
›ti⁄s
, 
num
 + 
num_›ti⁄s
 + 1);

454 
	`mem˝y
(&
ã°
->
›ti⁄s
[
num
], o±i⁄s, (
num_›ti⁄s
 + 1)*(*));

455 
	}
}

457 
	$add_öfo_›ti⁄s
(
cˇn_fûe
 *
öfo
)

459 
doc_£˘i⁄
 *
d
;

460 
i
;

461 
cˇ∆öt
 *
ã°
;

463 
	`li°_f‹_óch
(
	`gë_cˇn_fûe_docs
(
öfo
), 
d
, 
li°
) {

464 i‡(!
	`°ªq
(
d
->
ty≥
, "ccanlint"))

467 
i
 = 0; i < 
d
->
num_löes
; i++) {

468 **
w‹ds
 = 
	`èl_°r•lô
(
d
, d->
löes
[
i
], " \t",

469 
STR_NO_EMPTY
);

470 i‡(!
w‹ds
[0])

473 i‡(
	`°∫cmp
(
w‹ds
[0], "//", 2) == 0)

476 
ã°
 = 
	`föd_ã°
(
w‹ds
[0]);

477 i‡(!
ã°
) {

478 
	`w¨nx
("%s: unknown ccanlintÅest '%s'",

479 
öfo
->
fuŒ«me
, 
w‹ds
[0]);

483 i‡(!
w‹ds
[1]) {

484 
	`w¨nx
("%s:ÇoárgumentÅoÅest '%s'",

485 
öfo
->
fuŒ«me
, 
w‹ds
[0]);

490 i‡(
	`°rˇ£cmp
(
w‹ds
[1], "FAIL") == 0) {

491 i‡(!
èrgëög
)

492 
	`skù_ã°_™d_dïs
(
ã°
,

496 i‡(!
ã°
->
èkes_›ti⁄s
)

497 
	`w¨nx
("%s: %s doesn'tÅake options",

498 
öfo
->
fuŒ«me
, 
w‹ds
[0]);

499 
	`add_›ti⁄s
(
ã°
, 
w‹ds
+1, 
	`èl_cou¡
(words)-1);

503 
	}
}

506 **
	$≥r_fûe_›ti⁄s
(c⁄° 
cˇ∆öt
 *
ã°
, 
cˇn_fûe
 *
f
)

508 **
ªt
;

509 
i
, 
j
 = 0;

512 i‡(!
ã°
->
›ti⁄s
[0])

513  
ã°
->
›ti⁄s
;

515 
ªt
 = 
	`èl_¨r
(
f
, *, 
	`èl_cou¡
(
ã°
->
›ti⁄s
));

516 
i
 = 0; 
ã°
->
›ti⁄s
[i]; i++) {

517 *
›äame
;

519 i‡(!
ã°
->
›ti⁄s
[
i
] || !
	`°rchr
(test->options[i], ':')) {

520 
›äame
 = 
ã°
->
›ti⁄s
[
i
];

521 } i‡(
	`°r°¨ts
(
ã°
->
›ti⁄s
[
i
], 
f
->
«me
)

522 && 
ã°
->
›ti⁄s
[
i
][
	`°æí
(
f
->
«me
)] == ':') {

523 
›äame
 = 
ã°
->
›ti⁄s
[
i
] + 
	`°æí
(
f
->
«me
) + 1;

528 i‡(
	`°ªq
(
›äame
, "FAIL")) {

529 
ªt
 = 
	`èl_¨r
(
f
, *, 2);

530 
ªt
[0] = (*)"FAIL";

531 
ªt
[1] = 
NULL
;

532  
ªt
;

534 
ªt
[
j
++] = 
›äame
;

536 
ªt
[
j
] = 
NULL
;

539 
	`èl_ªsize
(&
ªt
, 
j
 + 1);

540  
ªt
;

541 
	}
}

543 *
	$›t_£t_c⁄°_ch¨p
(c⁄° *
¨g
, c⁄° **
p
)

545  
	`›t_£t_ch¨p
(
¨g
, 
	`ˇ°_c⁄°2
(**, 
p
));

546 
	}
}

548 *
	$›t_£t_èrgë
(c⁄° *
¨g
, 
dgøph_node
 *
Æl
)

550 
cˇ∆öt
 *
t
 = 
	`föd_ã°
(
¨g
);

551 i‡(!
t
)

552  
	`èl_fmt
(
NULL
, "unknow¿--èrgë %s", 
¨g
);

554 
èrgëög
 = 
åue
;

555 
	`dgøph_add_edge
(&
t
->
node
, 
Æl
);

556  
NULL
;

557 
	}
}

559 
boﬁ
 
	$run_ã°s
(
dgøph_node
 *
Æl
,

560 
boﬁ
 
summ¨y
,

561 
boﬁ
 
dïs_Áû_ign‹e
,

562 
m™i„°
 *
m
,

563 c⁄° *
¥efix
)

565 
run_öfo
 
run
;

566 c⁄° *
commít
 = "";

568 
run
.
quõt
 = 
summ¨y
;

569 
run
.
m
 = m;

570 
run
.
¥efix
 =Örefix;

571 
run
.
sc‹e
 =Ñun.
tŸÆ
 = 0;

572 
run
.
∑ss
 = 
åue
;

574 
n⁄_cˇn_dïs
 = 
buûd_Áûed
 = 
Ál£
;

576 
	`dgøph_åavî£_to
(
Æl
, 
run_ã°
, &
run
);

579 i‡(
dïs_Áû_ign‹e
 && 
n⁄_cˇn_dïs
 && 
buûd_Áûed
) {

580 
commít
 = " (missingÇon-ccan dependencies?)";

581 
run
.
∑ss
 = 
åue
;

583 
	`¥ötf
("%sTotal score: %u/%u%s\n",

584 
¥efix
, 
run
.
sc‹e
,Ñun.
tŸÆ
, 
commít
);

586  
run
.
∑ss
;

587 
	}
}

589 
boﬁ
 
	$add_to_Æl
(c⁄° *
membî
, 
cˇ∆öt
 *
c
,

590 
dgøph_node
 *
Æl
)

593 i‡(!
c
->
skù
)

594 
	`dgøph_add_edge
(&
c
->
node
, 
Æl
);

595  
åue
;

596 
	}
}

598 
boﬁ
 
	$ã°_moduÀ
(
dgøph_node
 *
Æl
,

599 c⁄° *
dú
, c⁄° *
¥efix
, 
boﬁ
 
summ¨y
,

600 
boﬁ
 
dïs_Áû_ign‹e
)

602 
m™i„°
 *
m
 = 
	`gë_m™i„°
(
	`auto‰ì
(), 
dú
);

603 *
ã°lök
 = 
	`∑th_joö
(
NULL
, 
	`ãmp_dú
(), "test");

607 
	`u∆ök
(
ã°lök
);

608 i‡(
	`symlök
(
	`∑th_joö
(
m
, 
dú
, "ã°"), 
ã°lök
) != 0)

609 
	`îr
(1, "Cª©ögÅe° symlök i¿%s", 
	`ãmp_dú
());

611  
	`run_ã°s
(
Æl
, 
summ¨y
, 
dïs_Áû_ign‹e
, 
m
, 
¥efix
);

612 
	}
}

614 
	$maö
(
¨gc
, *
¨gv
[])

616 
boﬁ
 
summ¨y
 = 
Ál£
, 
∑ss
 = 
åue
, 
dïs_Áû_ign‹e
 = false;

617 
i
;

618 c⁄° *
¥efix
 = "";

619 *
cwd
 = 
	`∑th_cwd
(
NULL
), *
dú
;

620 
cˇ∆öt
 
t›
;

621 c⁄° *
ovîride_compûî
 = 
NULL
, *
ovîride_cÊags
 = NULL;

624 
	`dgøph_öô_node
(&
t›
.
node
);

626 
	`›t_ªgi°î_óæy_nﬂrg
("--vîbo£|-v", 
›t_öc_ötvÆ
, &
vîbo£
,

628 
	`›t_ªgi°î_nﬂrg
("-n|--ß„-mode", 
›t_£t_boﬁ
, &
ß„_mode
,

630 
	`›t_ªgi°î_nﬂrg
("-l|--li°-ã°s", 
li°_ã°s
, 
NULL
,

632 
	`›t_ªgi°î_nﬂrg
("--ã°-dï-gøph", 
ã°_dïídícy_gøph
, 
NULL
,

634 
	`›t_ªgi°î_nﬂrg
("-k|--kìp", 
kìp_ã°s
, 
NULL
,

636 
	`›t_ªgi°î_nﬂrg
("--summ¨y|-s", 
›t_£t_boﬁ
, &
summ¨y
,

638 
	`›t_ªgi°î_¨g
("-x|--ex˛udê<ã°«me>", 
ex˛ude_ã°
, 
NULL
, NULL,

640 
	`›t_ªgi°î_¨g
("--timeouà<mûÀ£c⁄ds>", 
›t_£t_uötvÆ
,

641 
NULL
, &
timeout
,

643 
	`›t_ªgi°î_¨g
("-t|--èrgë <ã°«me>", 
›t_£t_èrgë
, 
NULL
,

644 &
t›
.
node
,

646 
	`›t_ªgi°î_¨g
("--compûî <compûî>", 
›t_£t_c⁄°_ch¨p
,

647 
NULL
, &
ovîride_compûî
, "setÅhe compiler");

648 
	`›t_ªgi°î_¨g
("--cÊag†<Êags>", 
›t_£t_c⁄°_ch¨p
,

649 
NULL
, &
ovîride_cÊags
, "setÅhe compiler flags");

650 
	`›t_ªgi°î_nﬂrg
("--dïs-Áû-ign‹e", 
›t_£t_boﬁ
,

651 &
dïs_Áû_ign‹e
,

653 
	`›t_ªgi°î_nﬂrg
("-?|-h|--hñp", 
›t_ußge_™d_exô
,

659 
	`›t_óæy_∑r£
(
¨gc
, 
¨gv
, 
›t_log_°dîr_exô
);

662 i‡(
	`chdú
(
	`ãmp_dú
()) != 0)

663 
	`îr
(1, "Eº‹ ch™gögÅÿ%†ãmp‹¨y dú", 
	`ãmp_dú
());

665 
	`öô_ã°s
();

667 i‡(
vîbo£
 >= 3) {

668 
compûe_vîbo£
 = 
åue
;

669 
	`¥öt_ã°_dïíds
();

671 i‡(
vîbo£
 >= 4)

672 
toﬁs_vîbo£
 = 
åue
;

674 
	`›t_∑r£
(&
¨gc
, 
¨gv
, 
›t_log_°dîr_exô
);

676 i‡(!
èrgëög
)

677 
	`°rm≠_ôî©e
(&
ã°s
, 
add_to_Æl
, &
t›
.
node
);

679 i‡(
¨gc
 == 1)

680 
dú
 = 
cwd
;

682 
dú
 = 
	`∑th_joö
(
NULL
, 
cwd
, 
¨gv
[1]);

684 
cˇn_dú
 = 
	`föd_cˇn_dú
(
dú
);

685 i‡(!
cˇn_dú
)

686 
	`îrx
(1, "C™nŸ föd cˇn/ ba£ dúe˘‹y i¿%s", 
dú
);

687 
c⁄fig_hódî
 = 
	`ªad_c⁄fig_hódî
(
cˇn_dú
, 
vîbo£
 > 1);

690 i‡(
ovîride_cÊags
)

691 
cÊags
 = 
ovîride_cÊags
;

692 i‡(
ovîride_compûî
)

693 
compûî
 = 
ovîride_compûî
;

695 i‡(
¨gc
 == 1)

696 
∑ss
 = 
	`ã°_moduÀ
(&
t›
.
node
, 
cwd
, "",

697 
summ¨y
, 
dïs_Áû_ign‹e
);

699 
i
 = 1; i < 
¨gc
; i++) {

700 
dú
 = 
	`∑th_ˇn⁄
(
NULL
,

701 
	`èke
(
	`∑th_joö
(
NULL
, 
cwd
, 
¨gv
[
i
])));

702 i‡(!
dú
)

703 
	`îr
(1, "Cannot get canonicalÇame of '%s'",

704 
¨gv
[
i
]);

706 
¥efix
 = 
	`∑th_joö
(
NULL
, 
cˇn_dú
, "ccan");

707 
¥efix
 = 
	`∑th_ªl
(
NULL
, 
	`èke
’ªfix), 
dú
);

708 
¥efix
 = 
	`èl_°rˇt
(
NULL
, 
	`èke
(prefix), ": ");

710 
∑ss
 &
	`ã°_moduÀ
(&
t›
.
node
, 
dú
, 
¥efix
, 
summ¨y
,

711 
dïs_Áû_ign‹e
);

712 
	`ª£t_ã°s
(&
t›
.
node
);

715  
∑ss
 ? 0 : 1;

716 
	}
}

	@ccan/tools/ccanlint/ccanlint.h

1 #i‚de‡
CCAN_LINT_H


2 
	#CCAN_LINT_H


	)

3 
	~"c⁄fig.h
"

4 
	~<cˇn/li°/li°.h
>

5 
	~<cˇn/èl/èl.h
>

6 
	~<cˇn/dgøph/dgøph.h
>

7 
	~<cˇn/autod©a/autod©a.h
>

8 
	~<°dboﬁ.h
>

9 
	~"../doc_exåa˘.h
"

10 
	~"../m™i„°.h
"

11 
	~"../toﬁs.h
"

12 
	~"li˚n£s.h
"

14 
AUTODATA_TYPE
(
cˇ∆öt_ã°s
, 
cˇ∆öt
);

15 
	#REGISTER_TEST
(
ã°
Ë
	`AUTODATA
(
cˇ∆öt_ã°s
, &ã°)

	)

24 
vîbo£
;

27 
	sfûe_îr‹
 {

28 
li°_node
 
	mli°
;

29 
cˇn_fûe
 *
	mfûe
;

30 
	mlöe
;

34 
	ssc‹e
 {

37 
boﬁ
 
	m∑ss
;

39 
	msc‹e
, 
	mtŸÆ
;

41 *
	mîr‹
;

43 
li°_hód
 
	m≥r_fûe_îr‹s
;

46 
	scˇ∆öt
 {

48 c⁄° *
	mkey
;

51 c⁄° *
	m«me
;

54 c⁄° *(*
	mˇn_run
)(
m™i„°
 *
	mm
);

57 
boﬁ
 
	mcompuls‹y
;

62 (*
	mcheck
)(
m™i„°
 *
	mm
,

63 *
	mtimñe·
, 
sc‹e
 *
	msc‹e
);

66 (*
	mh™dÀ
)(
m™i„°
 *
	mm
, 
sc‹e
 *
	msc‹e
);

69 **
	m›ti⁄s
;

71 
boﬁ
 
	mèkes_›ti⁄s
;

74 c⁄° *
	m√eds
;

78 
dgøph_node
 
	mnode
;

80 c⁄° *
	mskù
;

82 
boﬁ
 
	md⁄e
;

86 
boﬁ
 
ask
(c⁄° *
que°i⁄
);

88 
	elöe_öfo_ty≥
 {

89 
	mPREPROC_LINE
,

90 
	mCODE_LINE
,

91 
	mDOC_LINE
,

92 
	mCOMMENT_LINE
,

97 
	sµ_c⁄dôi⁄s
 {

99 
µ_c⁄dôi⁄s
 *
	m∑ª¡
;

102 
	mPP_COND_IF
,

103 
	mPP_COND_IFDEF
,

104 
	mPP_COND_UNKNOWN
,

105 } 
	mty≥
;

107 
boﬁ
 
	mövî£
;

108 c⁄° *
	msymbﬁ
;

112 
	slöe_öfo
 {

113 
löe_öfo_ty≥
 
	mty≥
;

116 
boﬁ
 
	mc⁄töued
;

119 
µ_c⁄dôi⁄s
 *
	mc⁄d
;

123 
löe_öfo
 *
gë_cˇn_löe_öfo
(
cˇn_fûe
 *
f
);

126 c⁄° *
gë_cˇn_sim∂ifõd
(
cˇn_fûe
 *
f
);

128 
	elöe_compûed
 {

129 
	mNOT_COMPILED
,

130 
	mCOMPILED
,

131 
	mMAYBE_COMPILED
,

136 
löe_compûed
 
gë_cˇn_löe_µ
(
µ_c⁄dôi⁄s
 *
c⁄d
,

137 c⁄° *
symbﬁ
,

138 c⁄° *
vÆue
, ...);

141 
boﬁ
 
gë_tokí
(c⁄° **
löe
, c⁄° *
tokí
);

143 *
gë_symbﬁ_tokí
(*
˘x
, c⁄° **
löe
);

146 
li°_hód
 *
gë_cˇn_fûe_docs
(
cˇn_fûe
 *
f
);

149 **
≥r_fûe_›ti⁄s
(c⁄° 
cˇ∆öt
 *
ã°
, 
cˇn_fûe
 *
f
);

152 
sc‹e_fûe_îr‹
(
sc‹e
 *, 
cˇn_fûe
 *
f
, 
löe
,

153 c⁄° *
îr‹fmt
, ...);

156 
run_comm™d_async
(c⁄° *
˘x
, 
time_ms
,

157 c⁄° *
fmt
, ...);

160 
compûe_™d_lök_async
(c⁄° *
˘x
, 
time_ms
,

161 c⁄° *
cfûe
, c⁄° *
cˇndú
,

162 c⁄° *
objs
, c⁄° *
compûî
,

163 c⁄° *
cÊags
,

164 c⁄° *
libs
, c⁄° *
outfûe
);

167 *
cﬁÀ˘_comm™d
(
boﬁ
 *
ok
, **
ouçut
);

170 *
gë_‹_compûe_öfo
(c⁄° *
˘x
, c⁄° *
dú
);

173 
cˇ∆öt
 
åaûög_whôe•a˚
;

176 
	sdïídít
 {

177 
li°_node
 
	mnode
;

178 
cˇ∆öt
 *
	mdïídít
;

182 
boﬁ
 
is_ex˛uded
(c⁄° *
«me
);

185 
add_öfo_›ti⁄s
(
cˇn_fûe
 *
öfo
);

188 
boﬁ
 
ß„_mode
;

191 
boﬁ
 
kìp_ªsu…s
;

194 
boﬁ
 
n⁄_cˇn_dïs
;

197 
boﬁ
 
buûd_Áûed
;

200 c⁄° *
c⁄fig_hódî
;

203 c⁄° *
cˇn_dú
;

	@ccan/tools/ccanlint/file_analysis.c

1 
	~"c⁄fig.h
"

2 
	~"cˇ∆öt.h
"

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èke/èke.h
>

5 
	~<cˇn/hash/hash.h
>

6 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

7 
	~<cˇn/n€º/n€º.h
>

8 
	~<cˇn/f‹óch/f‹óch.h
>

9 
	~<cˇn/as‹t/as‹t.h
>

10 
	~<cˇn/¨øy_size/¨øy_size.h
>

11 
	~"../toﬁs.h
"

12 
	~<uni°d.h
>

13 
	~<sys/ty≥s.h
>

14 
	~<sys/°©.h
>

15 
	~<f˙é.h
>

16 
	~<îr.h
>

17 
	~<î∫o.h
>

18 
	~<dúít.h
>

19 
	~<˘y≥.h
>

20 
	~<°d¨g.h
>

21 
	~<as£π.h
>

23 
li°_hód
 *
	$gë_cˇn_fûe_docs
(
cˇn_fûe
 *
f
)

25 i‡(!
f
->
doc_£˘i⁄s
) {

26 
	`gë_cˇn_fûe_löes
(
f
);

27 
f
->
doc_£˘i⁄s
 = 
	`exåa˘_doc_£˘i⁄s
(f->
löes
, f->
«me
);

29  
f
->
doc_£˘i⁄s
;

30 
	}
}

39 *
	$ªmove_commíts
(c⁄° 
èl_t
 *
˘x
,

40 c⁄° *
löe
, 
boﬁ
 
ö_commít
,

41 
boﬁ
 *
u¡îmö©ed
)

43 *
p
, *
ªt
 = 
	`èl_¨r
(
˘x
, , 
	`°æí
(
löe
) + 1);

45 
p
 = 
ªt
;

47 i‡(!
ö_commít
) {

49 c⁄° *
ﬁd_commít
 = 
	`°r°r
(
löe
, "/*");

50 c⁄° *
√w_commít
 = 
	`°r°r
(
löe
, "//");

51 c⁄° *
commít
;

53 i‡(
√w_commít
 && 
ﬁd_commít
)

54 
commít
 = 
√w_commít
 < 
ﬁd_commít


55 ? 
√w_commít
 : 
ﬁd_commít
;

56 i‡(
ﬁd_commít
)

57 
commít
 = 
ﬁd_commít
;

58 i‡(
√w_commít
)

59 
commít
 = 
√w_commít
;

62 
	`°r˝y
(
p
, 
löe
);

63 *
u¡îmö©ed
 = 
Ál£
;

68 
	`mem˝y
(
p
, 
löe
, 
commít
 -Üine);

69 
p
 +
commít
 - 
löe
;

70 
löe
 +
commít
 -Üine + 2;

72 i‡(
commít
 =
√w_commít
) {

74 
p
[0] = '\0';

75 *
u¡îmö©ed
 = 
Ál£
;

78 
ö_commít
 = 
åue
;

81 i‡(
ö_commít
) {

82 c⁄° *
íd
 = 
	`°r°r
(
löe
, "*/");

83 i‡(!
íd
) {

84 *
u¡îmö©ed
 = 
åue
;

85 
p
[0] = '\0';

88 
löe
 = 
íd
+2;

89 
ö_commít
 = 
Ál£
;

92  
ªt
;

93 
	}
}

95 
boﬁ
 
	$is_em±y
(c⁄° *
löe
)

97  
	`°r•n
(
löe
, " \r\t"Ë=
	`°æí
(line);

98 
	}
}

100 
boﬁ
 
	$c⁄töues
(c⁄° *
löe
)

103  
	`°ªnds
(
löe
, "\\");

104 
	}
}

106 
boﬁ
 
	$∑r£_hash_if
(
µ_c⁄dôi⁄s
 *
c⁄d
, c⁄° **
löe
)

108 
boﬁ
 
bøckës
, 
deföed
;

110 
c⁄d
->
övî£
 = 
	`gë_tokí
(
löe
, "!");

111 
deföed
 = 
	`gë_tokí
(
löe
, "defined");

112 
bøckës
 = 
	`gë_tokí
(
löe
, "(");

113 
c⁄d
->
symbﬁ
 = 
	`gë_symbﬁ_tokí
(c⁄d, 
löe
);

114 i‡(!
c⁄d
->
symbﬁ
)

115  
Ál£
;

116 i‡(
bøckës
 && !
	`gë_tokí
(
löe
, ")"))

117  
Ál£
;

118 i‡(!
deföed
)

119 
c⁄d
->
ty≥
 = 
PP_COND_IF
;

122 i‡(
	`gë_tokí
(
löe
, "||") || get_token(line, "&&")) {

123 
µ_c⁄dôi⁄s
 *
sub
 = 
	`èl
(
c⁄d
, pp_conditions);

125 
sub
->
∑ª¡
 = 
c⁄d
->parent;

126 
sub
->
ty≥
 = 
PP_COND_IFDEF
;

127 i‡(
	`∑r£_hash_if
(
sub
, 
löe
))

128 
c⁄d
->
∑ª¡
 = 
sub
;

131  
åue
;

132 
	}
}

135 
µ_c⁄dôi⁄s
 *
	$™Æyze_dúe˘ive
(
cˇn_fûe
 *
f
,

136 c⁄° *
löe
,

137 
µ_c⁄dôi⁄s
 *
∑ª¡
)

139 
µ_c⁄dôi⁄s
 *
c⁄d
 = 
	`èl
(
f
, pp_conditions);

140 
boﬁ
 
unu£d
;

142 
löe
 = 
	`ªmove_commíts
(
f
,Üöe, 
Ál£
, &
unu£d
);

144 
c⁄d
->
∑ª¡
 =Öarent;

145 
c⁄d
->
ty≥
 = 
PP_COND_IFDEF
;

147 i‡(!
	`gë_tokí
(&
löe
, "#"))

148 
	`ab‹t
();

150 i‡(
	`gë_tokí
(&
löe
, "if")) {

151 i‡(!
	`∑r£_hash_if
(
c⁄d
, &
löe
))

152 
unknown
;

153 } i‡(
	`gë_tokí
(&
löe
, "elif")) {

155 i‡(!
∑ª¡
)

156  
NULL
;

157 
c⁄d
->
∑ª¡
 =Öarent->parent;

160 i‡(!
	`∑r£_hash_if
(
c⁄d
, &
löe
))

161 
unknown
;

162 } i‡(
	`gë_tokí
(&
löe
, "ifdef")) {

163 
boﬁ
 
bøckës
;

164 
c⁄d
->
övî£
 = 
Ál£
;

165 
bøckës
 = 
	`gë_tokí
(&
löe
, "(");

166 
c⁄d
->
symbﬁ
 = 
	`gë_symbﬁ_tokí
(c⁄d, &
löe
);

167 i‡(!
c⁄d
->
symbﬁ
)

168 
unknown
;

169 i‡(
bøckës
 && !
	`gë_tokí
(&
löe
, ")"))

170 
unknown
;

171 } i‡(
	`gë_tokí
(&
löe
, "ifndef")) {

172 
boﬁ
 
bøckës
;

173 
c⁄d
->
övî£
 = 
åue
;

174 
bøckës
 = 
	`gë_tokí
(&
löe
, "(");

175 
c⁄d
->
symbﬁ
 = 
	`gë_symbﬁ_tokí
(c⁄d, &
löe
);

176 i‡(!
c⁄d
->
symbﬁ
)

177 
unknown
;

178 i‡(
bøckës
 && !
	`gë_tokí
(&
löe
, ")"))

179 
unknown
;

180 } i‡(
	`gë_tokí
(&
löe
, "else")) {

182 i‡(!
∑ª¡
)

183  
NULL
;

185 *
c⁄d
 = *
∑ª¡
;

186 
c⁄d
->
övî£
 = !cond->inverse;

187  
c⁄d
;

188 } i‡(
	`gë_tokí
(&
löe
, "endif")) {

189 
	`èl_‰ì
(
c⁄d
);

191 i‡(!
∑ª¡
)

192  
NULL
;

194  
∑ª¡
->parent;

197 
	`èl_‰ì
(
c⁄d
);

198  
∑ª¡
;

201 i‡(!
	`is_em±y
(
löe
))

202 
unknown
;

203  
c⁄d
;

205 
unknown
:

206 
c⁄d
->
ty≥
 = 
PP_COND_UNKNOWN
;

207  
c⁄d
;

208 
	}
}

211 
löe_öfo
 *
	$gë_cˇn_löe_öfo
(
cˇn_fûe
 *
f
)

213 
boﬁ
 
c⁄töued
 = 
Ál£
, 
ö_commít
 = false;

214 
µ_c⁄dôi⁄s
 *
c⁄d
 = 
NULL
;

215 
i
;

217 i‡(
f
->
löe_öfo
)

218  
f
->
löe_öfo
;

220 
	`gë_cˇn_fûe_löes
(
f
);

221 
f
->
löe_öfo
 = 
	`èl_¨r
(f->
löes
, line_info,

222 
	`èl_cou¡
(
f
->
löes
)-1);

224 
i
 = 0; 
f
->
löes
[i]; 
c⁄töued
 = 
	`c⁄töues
(f->lines[i++])) {

225 *
p
;

226 
boﬁ
 
°ûl_doc_löe
;

229 
f
->
löe_öfo
[
i
].
c⁄d
 = cond;

230 
f
->
löe_öfo
[
i
].
c⁄töued
 = continued;

232 i‡(
c⁄töued
) {

234 
f
->
löe_öfo
[
i
].
ty≥
 = f->line_info[i-1].type;

236 
	`ªmove_commíts
(
f
, f->
löes
[
i
], 
ö_commít
, &in_comment);

241 i‡(!
ö_commít


242 && 
f
->
löes
[
i
][
	`°r•n
(f->lines[i], " \t")] == '#') {

243 
f
->
löe_öfo
[
i
].
ty≥
 = 
PREPROC_LINE
;

244 
c⁄d
 = 
	`™Æyze_dúe˘ive
(
f
, f->
löes
[
i
], cond);

248 
°ûl_doc_löe
 = (
ö_commít


249 && 
f
->
löe_öfo
[
i
-1].
ty≥
 =
DOC_LINE
);

251 
p
 = 
	`ªmove_commíts
(
f
, f->
löes
[
i
], 
ö_commít
, &in_comment);

252 i‡(
	`is_em±y
(
p
)) {

253 i‡(
	`°r°¨ts
(
f
->
löes
[
i
], "/**"Ë|| 
°ûl_doc_löe
)

254 
f
->
löe_öfo
[
i
].
ty≥
 = 
DOC_LINE
;

256 
f
->
löe_öfo
[
i
].
ty≥
 = 
COMMENT_LINE
;

258 
f
->
löe_öfo
[
i
].
ty≥
 = 
CODE_LINE
;

259 
	`èl_‰ì
(
p
);

261  
f
->
löe_öfo
;

262 
	}
}

264 
	ssymbﬁ
 {

265 
li°_node
 
	mli°
;

266 c⁄° *
	m«me
;

267 c⁄° *
	mvÆue
;

270 
symbﬁ
 *
	$föd_symbﬁ
(
li°_hód
 *
syms
, c⁄° *
sym
)

272 
symbﬁ
 *
i
;

274 
	`li°_f‹_óch
(
syms
, 
i
, 
li°
)

275 i‡(
	`°ªq
(
sym
, 
i
->
«me
))

276  
i
;

277  
NULL
;

278 
	}
}

280 
löe_compûed
 
	$gë_µ
(
µ_c⁄dôi⁄s
 *
c⁄d
,

281 
li°_hód
 *
syms
)

283 
symbﬁ
 *
sym
;

284 
vÆ
;

285 
löe_compûed
 
∑ª¡
, 
ªt
;

288 i‡(!
c⁄d
)

289  
COMPILED
;

292 
∑ª¡
 = 
	`gë_µ
(
c⁄d
->∑ª¡, 
syms
);

293 i‡(
∑ª¡
 =
NOT_COMPILED
)

294  
NOT_COMPILED
;

296 i‡(
c⁄d
->
ty≥
 =
PP_COND_UNKNOWN
)

297  
MAYBE_COMPILED
;

299 
sym
 = 
	`föd_symbﬁ
(
syms
, 
c⁄d
->
symbﬁ
);

300 i‡(!
sym
)

301  
MAYBE_COMPILED
;

303 
c⁄d
->
ty≥
) {

304 
PP_COND_IF
:

306 
vÆ
 = 
sym
->
vÆue
 ? *sym->value : 0;

307 i‡(!
vÆ
 =
c⁄d
->
övî£
)

308 
ªt
 = 
COMPILED
;

310 
ªt
 = 
NOT_COMPILED
;

313 
PP_COND_IFDEF
:

314 i‡(
c⁄d
->
övî£
 =!
sym
->
vÆue
)

315 
ªt
 = 
COMPILED
;

317 
ªt
 = 
NOT_COMPILED
;

321 
	`ab‹t
();

325 i‡(
∑ª¡
 =
MAYBE_COMPILED
 && 
ªt
 =
COMPILED
)

326 
ªt
 = 
MAYBE_COMPILED
;

327  
ªt
;

328 
	}
}

330 
	$add_symbﬁ
(
li°_hód
 *
hód
,

331 c⁄° *
symbﬁ
, c⁄° *
vÆue
)

333 
symbﬁ
 *
sym
 = 
	`èl
(
hód
, symbol);

334 
sym
->
«me
 = 
symbﬁ
;

335 
sym
->
vÆue
 = value;

336 
	`li°_add
(
hód
, &
sym
->
li°
);

337 
	}
}

339 
löe_compûed
 
	$gë_cˇn_löe_µ
(
µ_c⁄dôi⁄s
 *
c⁄d
,

340 c⁄° *
symbﬁ
,

341 c⁄° *
vÆue
,

344 
löe_compûed
 
ªt
;

345 
li°_hód
 *
hód
;

346 
va_li°
 
≠
;

348 
hód
 = 
	`èl
(
NULL
, 
li°_hód
);

349 
	`li°_hód_öô
(
hód
);

351 
	`va_°¨t
(
≠
, 
vÆue
);

352 
	`add_symbﬁ
(
hód
, 
symbﬁ
, 
vÆue
);

354 (
symbﬁ
 = 
	`va_¨g
(
≠
, c⁄° *)Ë!
NULL
) {

355 
vÆue
 = 
	`va_¨g
(
≠
, const *);

356 
	`add_symbﬁ
(
hód
, 
symbﬁ
, 
vÆue
);

358 
ªt
 = 
	`gë_µ
(
c⁄d
, 
hód
);

359 
	`èl_‰ì
(
hód
);

360  
ªt
;

361 
	}
}

363 
	$sc‹e_fûe_îr‹
(
sc‹e
 *sc‹e, 
cˇn_fûe
 *
f
, 
löe
,

364 c⁄° *
îr‹fmt
, ...)

366 
va_li°
 
≠
;

368 
fûe_îr‹
 *
„
 = 
	`èl
(
sc‹e
, file_error);

369 
„
->
fûe
 = 
f
;

370 
„
->
löe
 =Üine;

371 
	`li°_add_èû
(&
sc‹e
->
≥r_fûe_îr‹s
, &
„
->
li°
);

373 i‡(!
sc‹e
->
îr‹
)

374 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score, "");

376 i‡(
vîbo£
 < 2 && 
	`°rcou¡
(
sc‹e
->
îr‹
, "\n") > 5) {

377 i‡(!
	`°ªnds
(
sc‹e
->
îr‹
,

379 
sc‹e
->
îr‹
 = 
	`èl_°rˇt
(score,

380 
	`èke
(
sc‹e
->
îr‹
),

387 i‡(
löe
)

388 
	`èl_≠≥nd_fmt
(&
sc‹e
->
îr‹
, "%s:%u:", 
f
->
fuŒ«me
, 
löe
);

390 
	`èl_≠≥nd_fmt
(&
sc‹e
->
îr‹
, "%s:", 
f
->
fuŒ«me
);

392 
	`va_°¨t
(
≠
, 
îr‹fmt
);

393 
	`èl_≠≥nd_vfmt
(&
sc‹e
->
îr‹
, 
îr‹fmt
, 
≠
);

394 
	`va_íd
(
≠
);

395 
sc‹e
->
îr‹
 = 
	`èl_°rˇt
(sc‹e, 
	`èke
(score->error),"\n");

396 
	}
}

398 *
	$gë_‹_compûe_öfo
(c⁄° *
˘x
, c⁄° *
dú
)

400 
m™i„°
 *
m
 = 
	`gë_m™i„°
(
NULL
, 
dú
);

402 i‡(!
m
->
öfo_fûe
->
compûed
[
COMPILE_NORMAL
])

403 
m
->
öfo_fûe
->
compûed
[
COMPILE_NORMAL
] = 
	`compûe_öfo
(m, 
dú
);

405  
m
->
öfo_fûe
->
compûed
[
COMPILE_NORMAL
];

406 
	}
}

	@ccan/tools/ccanlint/licenses.c

1 
	~"li˚n£s.h
"

2 
	~"cˇ∆öt.h
"

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èl/èl.h
>

5 
	~<cˇn/èl/°r/°r.h
>

7 c⁄° 
li˚n£_öfo
 
	gli˚n£s
[] = {

17 
NULL


23 
NULL


28 
NULL
,

29 
NULL


41 
NULL


47 
NULL


52 
NULL
,

53 
NULL


71 
NULL


75 { 
NULL
, NULL, NULL }

78 { 
NULL
, NULL, NULL }

84 
	#O
 
åue


	)

85 
	#X
 
Ál£


	)

86 
boﬁ
 
	gli˚n£_com∑tibÀ
[
LICENSE_UNKNOWN
+1][LICENSE_UNKNOWN] = {

90 { 
O
, 
X
, X, O, X, X, X, X, O, O, O, O },

92 { 
O
, O, 
X
, O, X, X, X, X, O, O, O, O },

94 { 
O
, 
X
, O, O, X, X, X, X, O, O, O, O },

96 { 
O
, O, O, O, 
X
, X, X, X, O, O, O, O },

98 { 
O
, O, O, O, O, 
X
, X, O, O, O, O, O },

100 { 
O
, O, O, O, O, O, 
X
, O, O, O, O, O },

102 { 
O
, O, O, O, O, 
X
, O, O, O, O, O, O },

104 { 
O
, O, O, O, O, O, O, O, O, O, O, O },

106 { 
X
, X, X, X, X, X, X, X, 
O
, O, O, O },

108 { 
X
, X, X, X, X, X, X, X, X, 
O
, O, O },

110 { 
X
, X, X, X, X, X, X, X, X, X, 
O
, O },

112 { 
X
, X, X, X, X, X, X, X, X, X, 
O
, O },

114 { 
X
, X, X, X, X, X, X, X, X, X, 
O
, O }

116 #unde‡
X


117 #unde‡
O


121 
li˚n£
 
	$which_li˚n£
(
doc_£˘i⁄
 *
d
)

123 i‡(!
d
)

124  
LICENSE_UNKNOWN
;

127 i‡(
	`°ªq
(
d
->
löes
[0], "GPL"))

128  
LICENSE_GPL
;

130 i‡(
	`°ªq
(
d
->
löes
[0], "GPLv2"))

131  
LICENSE_GPLv2
;

133 i‡(
	`°ªq
(
d
->
löes
[0], "GPL (v2 orányÜater version)"))

134  
LICENSE_GPLv2_PLUS
;

136 i‡(
	`°ªq
(
d
->
löes
[0], "GPL (v3 orányÜater version)"))

137  
LICENSE_GPLv3
;

140 i‡(
	`°ªq
(
d
->
löes
[0], "LGPL"))

141  
LICENSE_LGPL
;

143 i‡(
	`°ªq
(
d
->
löes
[0], "LGPLv2.1"))

144  
LICENSE_LGPLv2
;

146 i‡(
	`°ªq
(
d
->
löes
[0], "LGPL (v2.1 orányÜater version)"))

147  
LICENSE_LGPLv2_PLUS
;

149 i‡(
	`°ªq
(
d
->
löes
[0], "LGPL (v3 orányÜater version)"))

150  
LICENSE_LGPLv3
;

152 i‡(
	`°ªq
(
d
->
löes
[0], "BSD-MIT") || streq(d->lines[0], "MIT"))

153  
LICENSE_MIT
;

154 i‡(
	`°ªq
(
d
->
löes
[0], "BSD (3 clause)"))

155  
LICENSE_BSD
;

156 i‡(
	`°ªq
(
d
->
löes
[0], "CC0"))

157  
LICENSE_CC0
;

158 i‡(
	`èl_°ºeg
(
NULL
, 
d
->
löes
[0], "CC0 \\([Pp]ublic [Dd]omain\\)",

159 
NULL
))

160  
LICENSE_CC0
;

161 i‡(
	`èl_°ºeg
(
NULL
, 
d
->
löes
[0], "[Pp]ublic [Dd]omain"))

162  
LICENSE_PUBLIC_DOMAIN
;

164  
LICENSE_UNKNOWN
;

165 
	}
}

167 c⁄° *
	$gë_cˇn_sim∂ifõd
(
cˇn_fûe
 *
f
)

169 i‡(!
f
->
sim∂ifõd
) {

170 
i
, 
j
;

173 
f
->
sim∂ifõd
 = 
	`èl_°rdup
(f, 
	`gë_cˇn_fûe_c⁄ã¡s
(f));

174 
i
 = 0, 
j
 = 0; 
f
->
sim∂ifõd
[i]; i++) {

175 i‡(
	`cisuµî
(
f
->
sim∂ifõd
[
i
]))

176 
f
->
sim∂ifõd
[
j
++] = 
	`tﬁowî
(f->sim∂ifõd[
i
]);

177 i‡(
	`ci¶owî
(
f
->
sim∂ifõd
[
i
]))

178 
f
->
sim∂ifõd
[
j
++] = f->sim∂ifõd[
i
];

179 i‡(
	`cisdigô
(
f
->
sim∂ifõd
[
i
]))

180 
f
->
sim∂ifõd
[
j
++] = f->sim∂ifõd[
i
];

181 i‡(
	`cis•a˚
(
f
->
sim∂ifõd
[
i
])) {

182 i‡(
j
 !0 && 
f
->
sim∂ifõd
[j-1] != ' ')

183 
f
->
sim∂ifõd
[
j
++] = ' ';

186 
f
->
sim∂ifõd
[
j
] = '\0';

188  
f
->
sim∂ifõd
;

189 
	}
}

191 
boﬁ
 
	$föd_boûî∂©e
(
cˇn_fûe
 *
f
, 
li˚n£
Üicense)

193 
i
;

195 
i
 = 0; i < 
NUM_CLAUSES
; i++) {

196 i‡(!
li˚n£s
[
li˚n£
].
˛au£
[
i
])

199 i‡(!
	`°r°r
(
	`gë_cˇn_sim∂ifõd
(
f
),

200 
li˚n£s
[
li˚n£
].
˛au£
[
i
])) {

201  
Ál£
;

204  
åue
;

205 
	}
}

207 
doc_£˘i⁄
 *
	$föd_li˚n£_èg
(c⁄° 
m™i„°
 *
m
)

209 
doc_£˘i⁄
 *
d
;

211 
	`li°_f‹_óch
(
	`gë_cˇn_fûe_docs
(
m
->
öfo_fûe
), 
d
, 
li°
) {

212 i‡(!
	`°ªq
(
d
->
fun˘i⁄
, 
m
->
mod«me
))

214 i‡(
	`°ªq
(
d
->
ty≥
, "license"))

215  
d
;

217  
NULL
;

218 
	}
}

	@ccan/tools/ccanlint/licenses.h

1 #i‚de‡
CCANLINT_LICENSES_H


2 
	#CCANLINT_LICENSES_H


	)

3 
	~<°dboﬁ.h
>

5 
	eli˚n£
 {

6 
	mLICENSE_LGPLv2_PLUS
,

7 
	mLICENSE_LGPLv2
,

8 
	mLICENSE_LGPLv3
,

9 
	mLICENSE_LGPL
,

10 
	mLICENSE_GPLv2_PLUS
,

11 
	mLICENSE_GPLv2
,

12 
	mLICENSE_GPLv3
,

13 
	mLICENSE_GPL
,

14 
	mLICENSE_BSD
,

15 
	mLICENSE_MIT
,

16 
	mLICENSE_CC0
,

17 
	mLICENSE_PUBLIC_DOMAIN
,

18 
	mLICENSE_UNKNOWN


21 
	#NUM_CLAUSES
 3

	)

23 
	sli˚n£_öfo
 {

24 c⁄° *
	m«me
;

25 c⁄° *
	msh‹äame
;

27 c⁄° *
	m˛au£
[
NUM_CLAUSES
];

31 
boﬁ
 
	gli˚n£_com∑tibÀ
[
LICENSE_UNKNOWN
+1][LICENSE_UNKNOWN];

33 c⁄° 
li˚n£_öfo
 
li˚n£s
[];

35 
	gcˇn_fûe
;

36 
boﬁ
 
föd_boûî∂©e
(
cˇn_fûe
 *
f
, 
li˚n£
Üicense);

38 
	gdoc_£˘i⁄
;

39 
li˚n£
 
which_li˚n£
(
doc_£˘i⁄
 *
d
);

41 
	gm™i„°
;

42 
doc_£˘i⁄
 *
föd_li˚n£_èg
(c⁄° 
m™i„°
 *
m
);

	@ccan/tools/ccanlint/test/run-file_analysis.c

1 
	~"toﬁs/cˇ∆öt/cˇ∆öt.h
"

2 
	~"cˇn/èp/èp.h
"

3 
	~"toﬁs/cˇ∆öt/fûe_™Æysis.c
"

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<°dio.h
>

8 
	~<as£π.h
>

11 
	sã°
 {

12 
löe_öfo_ty≥
 
	mty≥
;

13 
boﬁ
 
	mc⁄töued
;

14 c⁄° *
	mlöe
;

17 
ã°
 
	gã°fûe
[] = {

18 { 
PREPROC_LINE
, 
Ál£
, "#ifndef TEST_H" },

19 { 
PREPROC_LINE
, 
Ál£
, "#define TEST_H" },

20 { 
DOC_LINE
, 
Ál£
, "/**" },

21 { 
DOC_LINE
, 
Ál£
, " * Comment here." },

22 { 
DOC_LINE
, 
Ál£
, " * Comment hereÅoo." },

23 { 
DOC_LINE
, 
Ál£
, " */" },

24 { 
COMMENT_LINE
, 
Ál£
, "// Normal one-line comment" },

25 { 
COMMENT_LINE
, 
Ál£
, " // Spaced one-line comment" },

26 { 
COMMENT_LINE
, 
Ál£
, "/* Normal one-line comment */" },

27 { 
COMMENT_LINE
, 
Ál£
, " /* Spaced one-line comment */" },

28 { 
COMMENT_LINE
, 
Ál£
, " /* SpacedÅwo-line comment" },

29 { 
COMMENT_LINE
, 
Ál£
, " continued comment */" },

30 { 
CODE_LINE
, 
Ál£
, "extern int x;"},

31 { 
CODE_LINE
, 
Ál£
, "extern int y; // WithÇew-style comment"},

32 { 
CODE_LINE
, 
Ál£
, "extern int z; /* With old-style comment */"},

33 { 
CODE_LINE
, 
Ál£
, "extern int v; /* WithÅwo-line comment"},

34 { 
COMMENT_LINE
, 
Ál£
, " SecondÜine of comment"},

35 { 
COMMENT_LINE
, 
Ál£
, "/* comment1 */ // comment 2"},

36 { 
COMMENT_LINE
, 
Ál£
, "/* comment1 */ /* comment 2 */ "},

37 { 
CODE_LINE
, 
Ál£
, "/* comment1 */ code; /* comment 2 */ "},

38 { 
CODE_LINE
, 
Ál£
, "/* comment1 */ code; // comment 2"},

39 { 
COMMENT_LINE
, 
Ál£
, "/* comment start \\"},

40 { 
COMMENT_LINE
, 
åue
, " comment finish */"},

41 { 
PREPROC_LINE
, 
Ál£
, "#define foo \\"},

42 { 
PREPROC_LINE
, 
åue
, " (bar + \\"},

43 { 
PREPROC_LINE
, 
åue
, " baz)"},

44 { 
CODE_LINE
, 
Ál£
, "extern int \\"},

45 { 
CODE_LINE
, 
åue
, "#x;"},

48 { 
PREPROC_LINE
, 
Ál£
, "#ifdef BAR"},

49 { 
CODE_LINE
, 
Ál£
, "BAR"},

50 { 
PREPROC_LINE
, 
Ál£
, "#else"},

51 { 
CODE_LINE
, 
Ál£
, "!BAR"},

52 { 
PREPROC_LINE
, 
Ál£
, "#endif"},

54 { 
PREPROC_LINE
, 
Ál£
, "#if defined BAR"},

55 { 
CODE_LINE
, 
Ál£
, "BAR"},

56 { 
PREPROC_LINE
, 
Ál£
, "#else"},

57 { 
CODE_LINE
, 
Ál£
, "!BAR"},

58 { 
PREPROC_LINE
, 
Ál£
, "#endif"},

60 { 
PREPROC_LINE
, 
Ál£
, "#if defined(BAR)"},

61 { 
CODE_LINE
, 
Ál£
, "BAR"},

62 { 
PREPROC_LINE
, 
Ál£
, "#else"},

63 { 
CODE_LINE
, 
Ál£
, "!BAR"},

64 { 
PREPROC_LINE
, 
Ál£
, "#endif"},

66 { 
PREPROC_LINE
, 
Ál£
, "#if !defined(BAR)"},

67 { 
CODE_LINE
, 
Ál£
, "!BAR"},

68 { 
PREPROC_LINE
, 
Ál£
, "#else"},

69 { 
CODE_LINE
, 
Ál£
, "BAR"},

70 { 
PREPROC_LINE
, 
Ál£
, "#endif"},

72 { 
PREPROC_LINE
, 
Ál£
, "#if HAVE_FOO"},

73 { 
CODE_LINE
, 
Ál£
, "HAVE_FOO"},

74 { 
PREPROC_LINE
, 
Ál£
, "#elif HAVE_BAR"},

75 { 
CODE_LINE
, 
Ál£
, "HAVE_BAR"},

76 { 
PREPROC_LINE
, 
Ál£
, "#else"},

77 { 
CODE_LINE
, 
Ál£
, "neither"},

78 { 
PREPROC_LINE
, 
Ál£
, "#endif /* Withá comment. */"},

80 { 
PREPROC_LINE
, 
Ál£
, "#endif /* TEST_H */" },

83 
	#NUM_LINES
 ((
ã°fûe
)/—e°fûe[0]))

	)

85 c⁄° *
	$löe_ty≥_«me
(
löe_öfo_ty≥
 
ty≥
)

87 
ty≥
) {

88 
PREPROC_LINE
:  "PREPROC_LINE";

89 
CODE_LINE
:  "CODE_LINE";

90 
DOC_LINE
:  "DOC_LINE";

91 
COMMENT_LINE
:  "COMMENT_LINE";

94 
	}
}

97 
	$maö
(
¨gc
, *
¨gv
[])

99 
i
;

100 
löe_öfo
 *line_info;

101 
cˇn_fûe
 *
f
 = 
	`èl
(
NULL
, ccan_file);

103 
	`∂™_ã°s
(
NUM_LINES
 * 2 + 2 + 86);

105 
f
->
num_löes
 = 
NUM_LINES
;

106 
f
->
löe_öfo
 = 
NULL
;

107 
f
->
löes
 = 
	`èl_¨øy
(f, *, f->
num_löes
);

108 
i
 = 0; i < 
f
->
num_löes
; i++)

109 
f
->
löes
[
i
] = 
	`èl_°rdup
(f->löes, 
ã°fûe
[i].
löe
);

111 
löe_öfo
 = 
	`gë_cˇn_löe_öfo
(
f
);

112 
	`ok1
(
löe_öfo
 =
f
->line_info);

113 
i
 = 0; i < 
f
->
num_löes
; i++) {

114 
	`ok
(
f
->
löe_öfo
[
i
].
ty≥
 =
ã°fûe
[i].type,

116 
i
, 
ã°fûe
[i].
löe
,

117 
	`löe_ty≥_«me
(
f
->
löe_öfo
[
i
].
ty≥
),

118 
	`löe_ty≥_«me
(
ã°fûe
[
i
].
ty≥
));

119 
	`ok
(
f
->
löe_öfo
[
i
].
c⁄töued
 =
ã°fûe
[i].continued,

121 
i
, 
ã°fûe
[i].
löe
,

122 
ã°fûe
[
i
].
c⁄töued
 ? "TRUE" : "FALSE");

126 
	`ok1
(
	`gë_cˇn_löe_öfo
(
f
Ë=
löe_öfo
);

129 
	`ok1
(
löe_öfo
[0].
c⁄d
 =
NULL
);

131 
	`ok1
(
löe_öfo
[1].
c⁄d
 !
NULL
);

132 
	`ok1
(
löe_öfo
[1].
c⁄d
->
ty≥
 =
PP_COND_IFDEF
);

133 
	`ok1
(
löe_öfo
[1].
c⁄d
->
övî£
);

134 
	`ok1
(
löe_öfo
[1].
c⁄d
->
∑ª¡
 =
NULL
);

135 
	`ok1
(
	`°ªq
(
löe_öfo
[1].
c⁄d
->
symbﬁ
, "TEST_H"));

138 
i
 = 0; i < 
f
->
num_löes
; i++) {

139 i‡(!
	`°ªq
(
ã°fûe
[
i
].
löe
, "BAR"))

141 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
ty≥
 =
PP_COND_IFDEF
);

142 
	`ok1
(!
löe_öfo
[
i
].
c⁄d
->
övî£
);

143 
	`ok1
(
	`°ªq
(
löe_öfo
[
i
].
c⁄d
->
symbﬁ
, "BAR"));

144 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
∑ª¡
 ==Üine_info[1].cond);

148 
i
 = 0; i < 
f
->
num_löes
; i++) {

149 i‡(!
	`°ªq
(
ã°fûe
[
i
].
löe
, "!BAR"))

151 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
ty≥
 =
PP_COND_IFDEF
);

152 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
övî£
);

153 
	`ok1
(
	`°ªq
(
löe_öfo
[
i
].
c⁄d
->
symbﬁ
, "BAR"));

154 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
∑ª¡
 ==Üine_info[1].cond);

158 
i
 = 0; i < 
f
->
num_löes
; i++) {

159 i‡(!
	`°ªq
(
ã°fûe
[
i
].
löe
, "HAVE_BAR"))

161 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
ty≥
 =
PP_COND_IF
);

162 
	`ok1
(!
löe_öfo
[
i
].
c⁄d
->
övî£
);

163 
	`ok1
(
	`°ªq
(
löe_öfo
[
i
].
c⁄d
->
symbﬁ
, "HAVE_BAR"));

164 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
∑ª¡
 ==Üine_info[1].cond);

168 
i
 = 0; i < 
f
->
num_löes
; i++) {

169 i‡(!
	`°ªq
(
ã°fûe
[
i
].
löe
, "HAVE_FOO"))

171 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
ty≥
 =
PP_COND_IF
);

172 
	`ok1
(!
löe_öfo
[
i
].
c⁄d
->
övî£
);

173 
	`ok1
(
	`°ªq
(
löe_öfo
[
i
].
c⁄d
->
symbﬁ
, "HAVE_FOO"));

174 
	`ok1
(
löe_öfo
[
i
].
c⁄d
->
∑ª¡
 ==Üine_info[1].cond);

178 
i
 = 0; i < 
f
->
num_löes
; i++) {

179 
vÆ
 = 1;

180 i‡(
	`°ªq
(
ã°fûe
[
i
].
löe
, "BAR")) {

183 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", &
vÆ
,

184 
NULL
Ë=
MAYBE_COMPILED
);

185 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", 
NULL
,

186 
NULL
Ë=
NOT_COMPILED
);

187 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", &
vÆ
,

188 "TEST_H", 
NULL
,

189 
NULL
Ë=
COMPILED
);

190 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", 
NULL
,

191 "TEST_H", 
NULL
,

192 
NULL
Ë=
NOT_COMPILED
);

193 } i‡(
	`°ªq
(
ã°fûe
[
i
].
löe
, "!BAR")) {

194 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", &
vÆ
,

195 
NULL
Ë=
NOT_COMPILED
);

196 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", 
NULL
,

197 
NULL
Ë=
MAYBE_COMPILED
);

198 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", &
vÆ
,

199 "TEST_H", 
NULL
,

200 
NULL
Ë=
NOT_COMPILED
);

201 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "BAR", 
NULL
,

202 "TEST_H", 
NULL
,

203 
NULL
Ë=
COMPILED
);

204 } i‡(
	`°ªq
(
ã°fûe
[
i
].
löe
, "HAVE_BAR")) {

205 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_BAR",

206 &
vÆ
, 
NULL
Ë=
MAYBE_COMPILED
);

207 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_BAR",

208 &
vÆ
, "TEST_H", 
NULL
,

209 
NULL
Ë=
COMPILED
);

210 
vÆ
 = 0;

211 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_BAR",

212 &
vÆ
, 
NULL
Ë=
NOT_COMPILED
);

213 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_BAR",

214 &
vÆ
, "TEST_H", 
NULL
,

215 
NULL
Ë=
NOT_COMPILED
);

216 } i‡(
	`°ªq
(
ã°fûe
[
i
].
löe
, "HAVE_FOO")) {

217 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_FOO",

218 &
vÆ
, 
NULL
Ë=
MAYBE_COMPILED
);

219 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_FOO",

220 &
vÆ
, "TEST_H", 
NULL
,

221 
NULL
Ë=
COMPILED
);

222 
vÆ
 = 0;

223 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_FOO",

224 &
vÆ
, 
NULL
Ë=
NOT_COMPILED
);

225 
	`ok1
(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, "HAVE_FOO",

226 &
vÆ
, "TEST_H", 
NULL
,

227 
NULL
Ë=
NOT_COMPILED
);

231  
	`exô_°©us
();

232 
	}
}

	@ccan/tools/ccanlint/tests/avoids_cpp_reserved.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<°rög.h
>

14 
	~<˘y≥.h
>

16 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

18 i‡(
ß„_mode
)

20  
NULL
;

21 
	}
}

23 
cˇn_fûe
 *
	$maö_hódî
(
m™i„°
 *
m
)

25 
cˇn_fûe
 *
f
;

27 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

28 i‡(
	`°r°¨ts
(
f
->
«me
, 
m
->
ba£«me
)

29 && 
	`°æí
(
f
->
«me
Ë=°æí(
m
->
ba£«me
) + 2)

30  
f
;

33 
	`ab‹t
();

34 
	}
}

36 
	$check_hódîs_no_˝p
(
m™i„°
 *
m
,

37 *
timñe·
, 
sc‹e
 *score)

39 *
c⁄ã¡s
;

40 *
tmp§c
, *
tmpobj
, *
cmdout
;

41 
fd
;

42 
cˇn_fûe
 *
maöh
 = 
	`maö_hódî
(
m
);

44 
tmp§c
 = 
	`ãmp_fûe
(
m
, "-ö˛uded.c", 
maöh
->
fuŒ«me
);

45 
tmpobj
 = 
	`ãmp_fûe
(
m
, ".o", 
tmp§c
);

48 
sc‹e
->
∑ss
 = 
åue
;

49 
fd
 = 
	`›í
(
tmp§c
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

50 i‡(
fd
 < 0)

51 
	`îr
(1, "Cª©ögÅemp‹¨y fûê%s", 
tmp§c
);

53 
c⁄ã¡s
 = 
	`èl_fmt
(
tmp§c
,

86 
m
->
mod«me
, m->
ba£«me
);

87 i‡(
	`wrôe
(
fd
, 
c⁄ã¡s
, 
	`°æí
(contents)) != strlen(contents))

88 
	`îr
(1, "wrôögÅÿãmp‹¨y fûê%s", 
tmp§c
);

89 
	`˛o£
(
fd
);

91 i‡(
	`compûe_obje˘
(
sc‹e
, 
tmp§c
, 
cˇn_dú
, 
compûî
, 
cÊags
,

92 
tmpobj
, &
cmdout
)) {

93 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

95 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

97 
cmdout
);

99 
	}
}

101 
cˇ∆öt
 
	gavoids_˝p_ª£rved
 = {

102 .
key
 = "avoids_cpp_reserved",

103 .
	g«me
 = "Modules main header compiles without C++Ñeserved words",

104 .
	gcheck
 = 
check_hódîs_no_˝p
,

105 .
	gˇn_run
 = 
ˇn_buûd
,

106 .
	g√eds
 = "main_header_compiles"

109 
REGISTER_TEST
(
avoids_˝p_ª£rved
);

	@ccan/tools/ccanlint/tests/build.h

1 #i‚de‡
CCANLINT_BUILD_H


2 
	#CCANLINT_BUILD_H


	)

3 *
buûd_moduÀ
(
m™i„°
 *
m
, 
compûe_ty≥
 
˘y≥
, **
îr°r
);

4 *
buûd_submoduÀ
(
m™i„°
 *
m
, c⁄° *
Êags
,

5 
compûe_ty≥
 
˘y≥
);

6 
buûd_obje˘s
(
m™i„°
 *
m
,

7 
sc‹e
 *sc‹e, c⁄° *
Êags
,

8 
compûe_ty≥
 
˘y≥
);

	@ccan/tools/ccanlint/tests/depends_accurate.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èke/èke.h
>

5 
	~<cˇn/f‹óch/f‹óch.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<uni°d.h
>

10 
	~<limôs.h
>

11 
	~<î∫o.h
>

12 
	~<°dlib.h
>

13 
	~<°dio.h
>

14 
	~<îr.h
>

15 
	~<°rög.h
>

16 
	~<˘y≥.h
>

18 
boﬁ
 
	$has_dï
(
m™i„°
 *
m
, **
dïs
, 
boﬁ
 *
u£d
,

19 c⁄° *
dï«me
)

21 
i
;

24 i‡(
	`°ªq
(
dï«me
 + 
	`°æí
("cˇn/"), 
m
->
mod«me
))

25  
åue
;

27 
i
 = 0; 
dïs
[i]; i++) {

28 i‡(
	`°ªq
(
dïs
[
i
], 
dï«me
)) {

29 
u£d
[
i
] = 
åue
;

30  
åue
;

33  
Ál£
;

34 
	}
}

36 
boﬁ
 
	$check_dï_ö˛udes
(
m™i„°
 *
m
,

37 **
dïs
, 
boﬁ
 *
u£d
,

38 
sc‹e
 *score,

39 
cˇn_fûe
 *
f
)

41 
i
;

42 **
löes
 = 
	`gë_cˇn_fûe_löes
(
f
);

43 
löe_öfo
 *
li
 = 
	`gë_cˇn_löe_öfo
(
f
);

44 
boﬁ
 
ok
 = 
åue
;

46 
i
 = 0; 
löes
[i]; i++) {

47 *
mod
;

48 i‡(!
	`èl_°ºeg
(
f
, 
löes
[
i
],

50 "(cˇn/+.+)/+[^/]+\\.h", &
mod
))

53 i‡(
	`has_dï
(
m
, 
dïs
, 
u£d
, 
mod
))

59 i‡(!
li
[
i
].
c⁄d
) {

60 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

61 "%†nŸÜi°ed i¿_öfo", 
mod
);

62 
ok
 = 
Ál£
;

65  
ok
;

66 
	}
}

68 
	$check_dïíds_accuøã
(
m™i„°
 *
m
,

69 *
timñe·
, 
sc‹e
 *score)

71 
li°_hód
 *
li°
;

72 
i
, 
c‹e_dïs
, 
ã°_dïs
;

73 **
dïs
, **
tdïs
;

74 
boﬁ
 *
u£d
;

75 
boﬁ
 
ok
 = 
åue
;

78 i‡(
ß„_mode
) {

79 
dïs
 = 
	`gë_ß„_cˇn_dïs
(
m
, m->
dú
, "dïíds", 
Ál£
);

80 
tdïs
 = 
	`gë_ß„_cˇn_dïs
(
m
, m->
dú
, "ã°dïíds", 
Ál£
);

82 
dïs
 = 
	`gë_dïs
(
m
, m->
dú
, "dïíds", 
Ál£
,

83 
gë_‹_compûe_öfo
);

84 
tdïs
 = 
	`gë_dïs
(
m
, m->
dú
, "ã°dïíds", 
Ál£
,

85 
gë_‹_compûe_öfo
);

88 
c‹e_dïs
 = 
	`èl_cou¡
(
dïs
) - 1;

89 
ã°_dïs
 = 
	`èl_cou¡
(
tdïs
) - 1;

91 
u£d
 = 
	`èl_¨rz
(
m
, 
boﬁ
, 
c‹e_dïs
 + 
ã°_dïs
 + 1);

93 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
) {

94 
cˇn_fûe
 *
f
;

96 
	`li°_f‹_óch
(
li°
, 
f
,Üist)

97 
ok
 &
	`check_dï_ö˛udes
(
m
, 
dïs
, 
u£d
, 
sc‹e
, 
f
);

100 
i
 = 0; i < 
c‹e_dïs
; i++) {

101 i‡(!
u£d
[
i
] && 
	`°r°¨ts
(
dïs
[i], "ccan/"))

102 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
m
->
öfo_fûe
, 0,

104 
dïs
[
i
]);

108 
dïs
 = 
	`èl_dup
(
m
, *, 
	`èke
(dïs), 
c‹e_dïs
, 
ã°_dïs
 + 2);

109 
	`mem˝y
(
dïs
 + 
c‹e_dïs
, 
tdïs
, —dïs[0]Ë* 
ã°_dïs
);

111 
dïs
[
c‹e_dïs
 + 
ã°_dïs
] = (*)"ccan/tap";

112 
dïs
[
c‹e_dïs
 + 
ã°_dïs
 + 1] = 
NULL
;

114 
	`f‹óch_±r
(
li°
, &
m
->
run_ã°s
, &m->
≠i_ã°s
,

115 &
m
->
compûe_ok_ã°s
, &m->
compûe_Áû_ã°s
,

116 &
m
->
Ÿhî_ã°_c_fûes
) {

117 
cˇn_fûe
 *
f
;

119 
	`li°_f‹_óch
(
li°
, 
f
,Üist)

120 
ok
 &
	`check_dï_ö˛udes
(
m
, 
dïs
, 
u£d
, 
sc‹e
, 
f
);

123 
i
 = 
c‹e_dïs
; i < 
ã°_dïs
; i++) {

124 i‡(!
u£d
[
i
])

125 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
m
->
öfo_fûe
, 0,

127 
dïs
[
i
]);

130 i‡(!
sc‹e
->
îr‹
)

131 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

134 
sc‹e
->
∑ss
 = 
ok
;

135 
	}
}

137 
cˇ∆öt
 
	gdïíds_accuøã
 = {

138 .
key
 = "depends_accurate",

139 .
	g«me
 = "Module's CCAN dependenciesáreÅhe only CCAN files #included",

140 .
	gcheck
 = 
check_dïíds_accuøã
,

141 .
	g√eds
 = "depends_existÅest_depends_exist"

144 
REGISTER_TEST
(
dïíds_accuøã
);

	@ccan/tools/ccanlint/tests/depends_build.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/f‹óch/f‹óch.h
>

4 
	~<cˇn/°r/°r.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"buûd.h
"

18 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

20 i‡(
ß„_mode
)

22  
NULL
;

23 
	}
}

25 
boﬁ
 
	$ex≥˘_obj_fûe
(
m™i„°
 *
m
)

28  !
	`li°_em±y
(&
m
->
c_fûes
);

29 
	}
}

31 *
	$buûd_subdú_objs
(
m™i„°
 *
m
,

32 c⁄° *
Êags
,

33 
compûe_ty≥
 
˘y≥
)

35 
cˇn_fûe
 *
i
;

37 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
) {

38 *
fuŒfûe
 = 
	`èl_fmt
(
m
, "%s/%s", m->
dú
, 
i
->
«me
);

39 *
ouçut
;

41 
i
->
compûed
[
˘y≥
] = 
	`ãmp_fûe
(
m
, "", 
fuŒfûe
);

42 i‡(!
	`compûe_obje˘
(
m
, 
fuŒfûe
, 
cˇn_dú
, 
compûî
, 
Êags
,

43 
i
->
compûed
[
˘y≥
], &
ouçut
)) {

44 
	`èl_‰ì
(
i
->
compûed
[
˘y≥
]);

45 
i
->
compûed
[
˘y≥
] = 
NULL
;

46  
	`èl_fmt
(
m
,

48 
m
->
mod«me
, 
ouçut
);

51  
NULL
;

52 
	}
}

54 *
	$buûd_submoduÀ
(
m™i„°
 *
m
, c⁄° *
Êags
,

55 
compûe_ty≥
 
˘y≥
)

57 *
îr°r
;

59 i‡(
m
->
compûed
[
˘y≥
])

60  
NULL
;

62 i‡(!
	`ex≥˘_obj_fûe
(
m
))

63  
NULL
;

65 i‡(
vîbo£
 >= 2)

66 
	`¥ötf
(" Buûdög dïídícy %s\n", 
m
->
dú
);

68 
îr°r
 = 
	`buûd_subdú_objs
(
m
, 
Êags
, 
˘y≥
);

69 i‡(
îr°r
)

70  
îr°r
;

72 
m
->
compûed
[
˘y≥
] = 
	`buûd_moduÀ
(m, cty≥, &
îr°r
);

73 i‡(!
m
->
compûed
[
˘y≥
])

74  
îr°r
;

75  
NULL
;

76 
	}
}

78 
	$check_dïíds_buût
(
m™i„°
 *
m
,

79 *
timñe·
, 
sc‹e
 *score)

81 
li°_hód
 *
li°
;

83 
	`f‹óch_±r
(
li°
, &
m
->
dïs
, &m->
ã°_dïs
) {

84 
m™i„°
 *
i
;

85 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

86 *
îr°r
;

88 
îr°r
 = 
	`buûd_submoduÀ
(
i
, 
cÊags
, 
COMPILE_NORMAL
);

90 i‡(
îr°r
) {

91 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

95 
i
->
mod«me
,

96 
îr°r
);

102 
sc‹e
->
∑ss
 = 
åue
;

103 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

104 
	}
}

106 
cˇ∆öt
 
	gdïíds_buûd
 = {

107 .
key
 = "depends_build",

108 .
	g«me
 = "Module's CCAN dependencies can be found or built",

109 .
	gcheck
 = 
check_dïíds_buût
,

110 .
	gˇn_run
 = 
ˇn_buûd
,

111 .
	g√eds
 = "depends_existÅest_depends_exist"

114 
REGISTER_TEST
(
dïíds_buûd
);

	@ccan/tools/ccanlint/tests/depends_build_without_features.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"ªdu˚_„©uªs.h
"

17 
	~"buûd.h
"

19 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

21 i‡(
ß„_mode
)

23  
NULL
;

24 
	}
}

26 
	$check_dïíds_buût_wôhout_„©uªs
(
m™i„°
 *
m
,

27 *
timñe·
,

28 
sc‹e
 *score)

30 
li°_hód
 *
li°
;

31 
m™i„°
 *
i
;

32 *
Êags
;

34 
Êags
 = 
	`èl_fmt
(
sc‹e
, "%†%s", 
cÊags
, 
REDUCE_FEATURES_FLAGS
);

36 
	`f‹óch_±r
(
li°
, &
m
->
dïs
, &m->
ã°_dïs
) {

37 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

38 *
îr°r
 = 
	`buûd_submoduÀ
(
i
, 
Êags
,

39 
COMPILE_NOFEAT
);

41 i‡(
îr°r
) {

42 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

45 
i
->
mod«me
,

46 
îr°r
);

52 
sc‹e
->
∑ss
 = 
åue
;

53 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

54 
	}
}

56 
cˇ∆öt
 
	gdïíds_buûd_wôhout_„©uªs
 = {

57 .
key
 = "depends_build_without_features",

58 .
	g«me
 = "Module's CCAN dependencies can be found or built (reduced features)",

59 .
	gcheck
 = 
check_dïíds_buût_wôhout_„©uªs
,

60 .
	gˇn_run
 = 
ˇn_buûd
,

61 .
	g√eds
 = "depends_buildÑeduce_features"

64 
REGISTER_TEST
(
dïíds_buûd_wôhout_„©uªs
);

	@ccan/tools/ccanlint/tests/depends_exist.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èl/∑th/∑th.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

17 
boﬁ
 
	$have_dï
(
m™i„°
 *
m
, c⁄° *
dï
)

19 
m™i„°
 *
i
;

21 
	`li°_f‹_óch
(&
m
->
dïs
, 
i
, 
li°
)

22 i‡(
	`°ªq
(
i
->
mod«me
, 
dï
 + 
	`°æí
("ccan/")))

23  
åue
;

25  
Ál£
;

26 
	}
}

28 
boﬁ
 
	$add_dï
(
m™i„°
 *
m
,

29 
li°_hód
 *
dïli°
,

30 c⁄° *
dï
, 
sc‹e
 *score)

32 
°©
 
°
;

33 
m™i„°
 *
subm
;

34 *
dú
 = 
	`∑th_joö
(
m
, 
cˇn_dú
, 
dï
);

37 i‡(
	`°©
(
dú
, &
°
) != 0) {

38 
sc‹e
->
îr‹
 = 
	`èl_fmt
(
m
, "CouldÇot stat dependency %s: %s",

39 
dú
, 
	`°ªº‹
(
î∫o
));

40  
Ál£
;

42 
subm
 = 
	`gë_m™i„°
(
m
, 
dú
);

43 
	`li°_add_èû
(
dïli°
, &
subm
->
li°
);

44  
åue
;

45 
	}
}

48 
	$check_dïíds_exi°
(
m™i„°
 *
m
,

49 *
timñe·
, 
sc‹e
 *score)

51 
i
;

52 **
dïs
;

54 i‡(
ß„_mode
)

55 
dïs
 = 
	`gë_ß„_cˇn_dïs
(
m
, m->
dú
, "dïíds", 
åue
);

57 
dïs
 = 
	`gë_dïs
(
m
, m->
dú
, "dïíds", 
åue
,

58 
gë_‹_compûe_öfo
);

60 i‡(!
dïs
) {

61 
sc‹e
->
îr‹
 = 
	`èl_fmt
(
m
, "CouldÇotÉxtract dependencies");

65 
i
 = 0; 
dïs
[i]; i++) {

66 i‡(!
	`°r°¨ts
(
dïs
[
i
], "ccan/")) {

67 
n⁄_cˇn_dïs
 = 
åue
;

71 i‡(!
	`add_dï
(
m
, &m->
dïs
, dïs[
i
], 
sc‹e
))

75 
sc‹e
->
∑ss
 = 
åue
;

76 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

77 
	}
}

79 
	$check_ã°_dïíds_exi°
(
m™i„°
 *
m
,

80 *
timñe·
,

81 
sc‹e
 *score)

83 
i
;

84 **
dïs
;

85 
boﬁ
 
√eds_èp
;

88 i‡(
	`°ªq
(
m
->
mod«me
, "tap")) {

89 
√eds_èp
 = 
Ál£
;

90 } i‡(
	`li°_em±y
(&
m
->
run_ã°s
Ë&&Üi°_em±y(&m->
≠i_ã°s
)) {

91 
√eds_èp
 = 
Ál£
;

93 
√eds_èp
 = 
åue
;

96 i‡(
ß„_mode
)

97 
dïs
 = 
	`gë_ß„_cˇn_dïs
(
m
, m->
dú
, "ã°dïíds", 
åue
);

99 
dïs
 = 
	`gë_dïs
(
m
, m->
dú
, "ã°dïíds", 
åue
,

100 
gë_‹_compûe_öfo
);

102 
i
 = 0; 
dïs
[i]; i++) {

103 i‡(!
	`°r°¨ts
(
dïs
[
i
], "ccan/"))

107 i‡(!
	`have_dï
(
m
, 
dïs
[
i
])

108 && !
	`add_dï
(
m
, &m->
ã°_dïs
, 
dïs
[
i
], 
sc‹e
))

111 i‡(
	`°ªq
(
dïs
[
i
], "ccan/tap")) {

112 
√eds_èp
 = 
Ál£
;

116 i‡(
√eds_èp
 && !
	`have_dï
(
m
, "ccan/tap")

117 && !
	`add_dï
(
m
, &m->
ã°_dïs
, "cˇn/èp", 
sc‹e
)) {

121 
sc‹e
->
∑ss
 = 
åue
;

122 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

123 
	}
}

125 
cˇ∆öt
 
	gdïíds_exi°
 = {

126 .
key
 = "depends_exist",

127 .
	g«me
 = "Module's CCAN dependencies can be found",

128 .
	gcompuls‹y
 = 
åue
,

129 .
	gcheck
 = 
check_dïíds_exi°
,

130 .
	g√eds
 = "info_exists"

133 
REGISTER_TEST
(
dïíds_exi°
);

135 
cˇ∆öt
 
	gã°_dïíds_exi°
 = {

136 .
key
 = "test_depends_exist",

137 .
	g«me
 = "Module's CCANÅest dependencies can be found",

138 .
	gcompuls‹y
 = 
Ál£
,

139 .
	gcheck
 = 
check_ã°_dïíds_exi°
,

140 .
	g√eds
 = "depends_exist"

143 
REGISTER_TEST
(
ã°_dïíds_exi°
);

	@ccan/tools/ccanlint/tests/examples_compile.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/èl/èl.h
>

4 
	~<cˇn/èl/°r/°r.h
>

5 
	~<cˇn/èke/èke.h
>

6 
	~<cˇn/ˇ°/ˇ°.h
>

7 
	~<cˇn/èl/∑th/∑th.h
>

8 
	~<cˇn/°r/°r.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/°©.h
>

11 
	~<f˙é.h
>

12 
	~<°döt.h
>

13 
	~<°rög.h
>

14 
	~<uni°d.h
>

15 
	~<˘y≥.h
>

16 
	~<as£π.h
>

17 
	~<îr.h
>

18 
	~"buûd.h
"

20 c⁄° *
	$ˇn_run
(
m™i„°
 *
m
)

22 i‡(
ß„_mode
)

24 i‡(
	`li°_em±y
(&
m
->
exam∂es
))

26  
NULL
;

27 
	}
}

29 
	$add_mod
(
m™i„°
 ***
dïs
, m™i„° *
m
)

31 
num
 = 
	`èl_cou¡
(*
dïs
);

32 
	`èl_ªsize
(
dïs
, 
num
 + 1);

33 (*
dïs
)[
num
] = 
m
;

34 
	}
}

36 
boﬁ
 
	$have_mod
(
m™i„°
 *
dïs
[], c⁄° *
mod«me
)

38 
i
;

40 
i
 = 0; i < 
	`èl_cou¡
(
dïs
); i++)

41 i‡(
	`°rcmp
(
dïs
[
i
]->
mod«me
, modname) == 0)

42  
åue
;

43  
Ál£
;

44 
	}
}

46 
	$add_dï
(
m™i„°
 ***
dïs
, c⁄° *
mod«me
)

48 
i
;

49 
m™i„°
 *
m
;

50 *
îr°r
;

52 i‡(
	`have_mod
(*
dïs
, 
mod«me
))

55 
m
 = 
	`gë_m™i„°
(*
dïs
,

56 
	`èl_fmt
(*
dïs
, "%s/cˇn/%s", 
cˇn_dú
, 
mod«me
));

57 
îr°r
 = 
	`buûd_submoduÀ
(
m
, 
cÊags
, 
COMPILE_NORMAL
);

58 i‡(
îr°r
)

59 
	`îrx
(1, "%s", 
îr°r
);

61 
	`add_mod
(
dïs
, 
m
);

64 
	`as£π
(!
ß„_mode
);

65 i‡(
m
->
öfo_fûe
) {

66 **
öfodïs
;

68 
öfodïs
 = 
	`gë_dïs
(
m
, m->
dú
, "dïíds", 
Ál£
,

69 
gë_‹_compûe_öfo
);

71 
i
 = 0; 
öfodïs
[i]; i++) {

72 i‡(
	`°r°¨ts
(
öfodïs
[
i
], "ccan/"))

73 
	`add_dï
(
dïs
, 
öfodïs
[
i
] + 
	`°æí
("ccan/"));

76 
	}
}

78 
m™i„°
 **
	$gë_exam∂e_dïs
(
m™i„°
 *
m
,

79 
cˇn_fûe
 *
f
)

81 **
löes
;

82 
m™i„°
 **
dïs
 = 
	`èl_¨r
(
f
, manifest *, 0);

85 
	`add_dï
(&
dïs
, 
m
->
mod«me
);

88 
löes
 = 
	`gë_cˇn_fûe_löes
(
f
); *lines;Üines++) {

89 *
mod«me
;

90 i‡(
	`èl_°ºeg
(
f
, *
löes
,

92 "cˇn/+(.+)/+[^/]+\\.h", &
mod«me
)) {

93 i‡(!
	`have_mod
(
dïs
, 
mod«me
))

94 
	`add_dï
(&
dïs
, 
mod«me
);

98  
dïs
;

99 
	}
}

101 *
	$exam∂e_obj_li°
(c⁄° *
˘x
, 
m™i„°
 **
dïs
)

103 *
li°
 = 
	`èl_°rdup
(
˘x
, "");

104 
i
;

106 
i
 = 0; i < 
	`èl_cou¡
(
dïs
); i++) {

107 i‡(
dïs
[
i
]->
compûed
[
COMPILE_NORMAL
])

108 
	`èl_≠≥nd_fmt
(&
li°
, " %s",

109 
dïs
[
i
]->
compûed
[
COMPILE_NORMAL
]);

111  
li°
;

112 
	}
}

114 *
	$exam∂e_lib_li°
(c⁄° *
˘x
, 
m™i„°
 **
dïs
)

116 *
li°
 = 
	`èl_°rdup
(
˘x
, "");

117 **
libs
;

118 
i
, 
j
;

121 
i
 = 0; i < 
	`èl_cou¡
(
dïs
); i++) {

122 
libs
 = 
	`gë_libs
(
˘x
, 
dïs
[
i
]->
dú
, 
NULL
, 
gë_‹_compûe_öfo
);

123 
j
 = 0; 
libs
[j]; j++)

124 
	`èl_≠≥nd_fmt
(&
li°
, "-l%†", 
libs
[
j
]);

126  
li°
;

127 
	}
}

130 
boﬁ
 
	$compûe
(c⁄° *
˘x
,

131 
m™i„°
 *
m
,

132 
cˇn_fûe
 *
fûe
,

133 **
ouçut
)

135 
m™i„°
 **
dïs
 = 
	`gë_exam∂e_dïs
(
m
, 
fûe
);

137 
fûe
->
compûed
[
COMPILE_NORMAL
] = 
	`ãmp_fûe
(
˘x
, "", fûe->
fuŒ«me
);

138 i‡(!
	`compûe_™d_lök
(
˘x
, 
fûe
->
fuŒ«me
, 
cˇn_dú
,

139 
	`exam∂e_obj_li°
(
fûe
, 
dïs
),

140 
compûî
, 
cÊags
,

141 
	`exam∂e_lib_li°
(
fûe
, 
dïs
),

142 
fûe
->
compûed
[
COMPILE_NORMAL
],

143 
ouçut
)) {

145 
	`u∆ök
(
fûe
->
compûed
[
COMPILE_NORMAL
]);

146 
fûe
->
compûed
[
COMPILE_NORMAL
] = 
NULL
;

147  
Ál£
;

149  
åue
;

150 
	}
}

152 
	$°¨t_maö
(**
ªt
, c⁄° *
why
)

154 
	`èl_≠≥nd_fmt
(
ªt
,

157 "{\n", 
why
);

158 
	}
}

161 *
	$add_func
(c⁄° 
èl_t
 *
˘x
, *
Ÿhîs
, c⁄° *
löe
)

163 c⁄° *
p
, *
íd
 = 
	`°rchr
(
löe
, '(') - 1;

164 *
u£
;

166 
	`cis•a˚
(*
íd
)) {

167 
íd
--;

168 i‡(
íd
 =
löe
)

169  
Ÿhîs
;

172 
p
 = 
íd
; 
	`ciß um
(*p) || *p == '_';Ö--) {

173 i‡(
p
 =
löe
)

174  
Ÿhîs
;

177 
u£
 = 
	`èl_fmt
(
˘x
, "printf(\"%%p\", %.*s);\n",

178 ()(
íd
 - 
p
),Ö+1);

179 i‡(
Ÿhîs
)

180 
u£
 = 
	`èl_°rˇt
(
˘x
, 
	`èke
(
Ÿhîs
),Åake(use));

182  
u£
;

183 
	}
}

185 
	$°rù_Àadög_whôe•a˚
(**
löes
)

187 
i
, 
mö_•™
 = -1U;

189 
i
 = 0; 
löes
[i]; i++) {

190 
•™
 = 
	`°r•n
(
löes
[
i
], " \t");

192 i‡(!
löes
[
i
][
•™
])

194 i‡(
•™
 < 
mö_•™
)

195 
mö_•™
 = 
•™
;

198 
i
 = 0; 
löes
[i]; i++)

199 i‡(
	`°æí
(
löes
[
i
]Ë>
mö_•™
)

200 
löes
[
i
] +
mö_•™
;

201 
	}
}

203 
boﬁ
 
	$looks_öã∫Æ
(**
löes
, **
why
)

205 
i
;

206 
boﬁ
 
œ°_íded
 = 
åue
;

208 
i
 = 0; 
löes
[i]; i++) {

210 c⁄° *
löe
 = 
löes
[
i
] + 
	`°r•n
(lines[i], " \t");

211 
Àn
 = 
	`°r•n
(
löe
, 
IDENT_CHARS
);

213 i‡(!
löe
[0] || 
	`cis•a˚
÷öe[0]Ë|| 
	`°r°¨ts
(line, "//")

214 || 
	`°r°¨ts
(
löe
, "#line"))

217 
	`as£π
(
löe
[
	`°æí
(line)-1] != '\n');

220 i‡(
	`°r°¨ts
(
löe
, "if"Ë&& 
Àn
 == 2) {

221 *
why
 = 
	`ˇ°_c⁄°
(*, "starts with if");

222  
åue
;

224 i‡(
	`°r°¨ts
(
löe
, "f‹"Ë&& 
Àn
 == 3) {

225 *
why
 = 
	`ˇ°_c⁄°
(*, "starts with for");

226  
åue
;

228 i‡(
	`°r°¨ts
(
löe
, "whûe"Ë&& 
Àn
 == 5) {

229 *
why
 = 
	`ˇ°_c⁄°
(*, "starts with while");

230  
åue
;

232 i‡(
	`°r°¨ts
(
löe
, "do"Ë&& 
Àn
 == 2) {

233 *
why
 = 
	`ˇ°_c⁄°
(*, "starts with do");

234  
åue
;

238 i‡(
	`°r°¨ts
(
löe
, "#include")) {

239 *
why
 = 
	`ˇ°_c⁄°
(*, "starts with #include");

240  
Ál£
;

243 i‡(
œ°_íded
 && 
	`°rchr
(
löe
, '(')) {

244 i‡(
	`°r°¨ts
(
löe
, "static")) {

245 *
why
 = 
	`ˇ°_c⁄°
(*,

248  
Ál£
;

250 i‡(
	`°ªnds
(
löe
, ")")) {

251 *
why
 = 
	`ˇ°_c⁄°
(*,

253  
Ál£
;

258 i‡(
	`°r°r
(
löe
, "didn't seemÅo belong insideá function")) {

259 *
why
 = 
	`ˇ°_c⁄°
(*, "Comment said so");

260  
Ál£
;

264 i‡(
œ°_íded
 && 
Àn


265 && 
	`ci•un˘
(
löe
[
Àn
+
	`°r•n
(line+len, " ")])) {

266 *
why
 = 
	`ˇ°_c⁄°
(*, "starts with identifier"

268  
åue
;

271 
œ°_íded
 = (
	`°ªnds
(
löe
, "}")

272 || 
	`°ªnds
(
löe
, ";")

273 || 
	`°ªnds
(
löe
, "*/")

274 || 
	`°ªq
(
löe
, "..."));

278 *
why
 = 
	`ˇ°_c⁄°
(*, "gaveÇo clues");

279  
åue
;

280 
	}
}

283 **
	$comböe
(c⁄° *
˘x
, **
löes
, **
¥ev
)

285 
i
, 
löes_tŸÆ
, 
¥ev_tŸÆ
, 
cou¡
;

286 **
ªt
;

287 c⁄° *
ªas⁄ög
;

288 *
why
 = 
NULL
;

290 i‡(!
¥ev
)

291  
NULL
;

294 i‡(
	`looks_öã∫Æ
(
löes
, &
why
)) {

295 
cou¡
 = 0;

296 
ªas⁄ög
 = "seemedÅo belong insideá function";

299 
cou¡
 = 0; 
löes
[count]; count++) {

300 i‡(
	`°rcmp
(
löes
[
cou¡
], "...") == 0)

303 i‡(!
löes
[
cou¡
]) {

305 
cou¡
 = 0;

306 
ªas⁄ög
 = "didn't seemÅo belong inside"

310 
ªas⁄ög
 = "didn't seemÅo belong inside"

314 
cou¡
++;

318 
i
 = 0; 
löes
[i]; i++);

319 
löes_tŸÆ
 = 
i
;

321 
i
 = 0; 
¥ev
[i]; i++);

322 
¥ev_tŸÆ
 = 
i
;

324 
ªt
 = 
	`èl_¨r
(
˘x
, *, 1 + 
löes_tŸÆ
 + 
¥ev_tŸÆ
 + 1);

325 
ªt
[0] = 
	`èl_fmt
(ret, "/* TheÉxample %s,Åhus %s */",

326 
why
, 
ªas⁄ög
);

327 
	`mem˝y
(
ªt
+1, 
löes
, 
cou¡
 * (ret[0]));

328 
	`mem˝y
(
ªt
+1 + 
cou¡
, 
¥ev
, 
¥ev_tŸÆ
 * (ret[0]));

329 
	`mem˝y
(
ªt
+1 + 
cou¡
 + 
¥ev_tŸÆ
, 
löes
 + count,

330 (
löes_tŸÆ
 - 
cou¡
 + 1Ë* (
ªt
[0]));

331  
ªt
;

332 
	}
}

335 *
	$°rù_commít
(c⁄° *
˘x
, c⁄° *
‹ig_löe
)

337 *
p
, *
ªt
 = 
	`èl_°rdup
(
˘x
, 
‹ig_löe
);

339 
p
 = 
	`°r°r
(
ªt
, "/*");

340 i‡(!
p
)

341 
p
 = 
	`°r°r
(
ªt
, "//");

342 i‡(
p
)

343 *
p
 = '\0';

344  
ªt
;

345 
	}
}

347 *
	$m™gÀ
(
m™i„°
 *
m
, **
löes
)

349 *
ªt
, *
u£_funcs
 = 
NULL
, *
why
;

350 
boﬁ
 
ö_fun˘i⁄
 = 
Ál£
, 
Áke_fun˘i⁄
 = fÆ£, 
has_maö
 = false;

351 
i
;

353 
ªt
 = 
	`èl_fmt
(
m
,

370 
m
->
mod«me
, m->
ba£«me
);

372 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret), "/* Useful dummy functions. */\n"

378 i‡(
	`looks_öã∫Æ
(
löes
, &
why
)) {

380 
	`°¨t_maö
(&
ªt
, 
why
);

381 
Áke_fun˘i⁄
 = 
åue
;

382 
ö_fun˘i⁄
 = 
åue
;

383 
has_maö
 = 
åue
;

385 
	`èl_≠≥nd_fmt
(&
ªt
,

387 
why
);

390 
i
 = 0; 
löes
[i]; i++) {

391 *
löe
 = 
	`°rù_commít
(
ªt
, 
löes
[
i
]);

394 i‡(
ö_fun˘i⁄
) {

395 i‡(
löe
[0] == '}')

396 
ö_fun˘i⁄
 = 
Ál£
;

400 i‡(!
	`cis•a˚
(
löe
[0])

401 && 
	`°rchr
(
löe
, '(')

402 && !
	`°rchr
(
löe
, ';')

403 && !
	`°r°r
(
löe
, "//")) {

404 
ö_fun˘i⁄
 = 
åue
;

405 i‡(
	`°∫cmp
(
löe
, "int main", 8) == 0)

406 
has_maö
 = 
åue
;

407 i‡(
	`°∫cmp
(
löe
, "static", 6) == 0) {

408 
u£_funcs
 = 
	`add_func
(
m
, use_funcs,

409 
löe
);

414 i‡(
	`°rcmp
(
löe
, "...") == 0) {

415 i‡(!
ö_fun˘i⁄
 && !
has_maö


416 && 
	`looks_öã∫Æ
(
löes
 + 
i
 + 1, &
why
)) {

418 
	`°¨t_maö
(&
ªt
, 
why
);

419 
has_maö
 = 
åue
;

420 
Áke_fun˘i⁄
 = 
åue
;

421 
ö_fun˘i⁄
 = 
åue
;

423 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret), "/* ...Ñemoved */\n");

426 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
‘ë), 
löes
[
i
]);

427 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret), "\n");

430 i‡(!
has_maö
) {

431 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret),

434 
Áke_fun˘i⁄
 = 
åue
;

437 i‡(
u£_funcs
) {

438 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret),

442 i‡(!
Áke_fun˘i⁄
) {

443 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret),

446 
Áke_fun˘i⁄
 = 
åue
;

448 
	`èl_≠≥nd_fmt
(&
ªt
, " %s\n", 
u£_funcs
);

451 i‡(
Áke_fun˘i⁄
)

452 
ªt
 = 
	`èl_°rˇt
(
m
, 
	`èke
(ret), "return 0;\n}\n");

453  
ªt
;

454 
	}
}

456 
cˇn_fûe
 *
	$m™gÀ_exam∂e
(
m™i„°
 *
m
,

457 
cˇn_fûe
 *
exam∂e
,

458 **
löes
)

460 *
«me
, *
c⁄ã¡s
;

461 
fd
;

462 
cˇn_fûe
 *
f
;

464 
«me
 = 
	`ãmp_fûe
(
exam∂e
, ".c",

465 
	`èke
(
	`èl_fmt
(
NULL
, "m™gÀd-%s", 
exam∂e
->
«me
)));

466 
f
 = 
	`√w_cˇn_fûe
(
exam∂e
,

467 
	`èke
(
	`∑th_dú«me
(
exam∂e
, 
«me
)),

468 
	`èke
(
	`∑th_ba£«me
(
exam∂e
, 
«me
)));

469 
	`èl_°ól
(
f
, 
«me
);

471 
fd
 = 
	`›í
(
f
->
fuŒ«me
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

472 i‡(
fd
 < 0)

473  
NULL
;

475 
c⁄ã¡s
 = 
	`m™gÀ
(
m
, 
löes
);

476 i‡(
	`wrôe
(
fd
, 
c⁄ã¡s
, 
	`°æí
(contents)) != strlen(contents)) {

477 
	`˛o£
(
fd
);

478  
NULL
;

480 
	`˛o£
(
fd
);

481 
f
->
c⁄ã¡s
 = 
	`èl_°ól
(f, contents);

482 
	`li°_add
(&
m
->
m™gÀd_exam∂es
, &
f
->
li°
);

483  
f
;

484 
	}
}

488 
boﬁ
 
	$has_ex≥˘ed_ouçut
(**
löes
)

490 
i
;

492 
i
 = 0; 
löes
[i]; i++) {

493 *
p
 = 
löes
[
i
] + 
	`°r•n
(lines[i], " \t");

494 i‡(!
	`°r°¨ts
(
p
, "//"))

496 
p
 +
	`°r•n
(p, "/ ");

497 i‡(
	`°∫ˇ£cmp
(
p
, "giví", 
	`°æí
("given")) == 0)

498  
åue
;

500  
Ál£
;

501 
	}
}

503 
	$åy_compûög
(
m™i„°
 *
m
,

504 
cˇn_fûe
 *
i
,

505 **
¥ev
,

506 
cˇn_fûe
 *
m™gÀd
[3],

507 
boﬁ
 
ªs
[3],

508 *
îr
[3],

509 **
löes
[3])

511 
num
;

514 
m™gÀd
[0] = 
i
;

515 
ªs
[0] = 
	`compûe
(
i
, 
m
, 
m™gÀd
[0], &
îr
[0]);

516 
löes
[0] = 
	`gë_cˇn_fûe_löes
(
i
);

517 i‡(
ªs
[0] && 
	`°ªq
(
îr
[0], ""))

520 i‡(
¥ev
) {

521 
löes
[1] = 
	`comböe
(
i
, 
	`gë_cˇn_fûe_löes
(i), 
¥ev
);

523 
m™gÀd
[1] = 
	`m™gÀ_exam∂e
(
m
, 
i
, 
löes
[1]);

524 
ªs
[1] = 
	`compûe
(
i
, 
m
, 
m™gÀd
[1], &
îr
[1]);

525 i‡(
ªs
[1] && 
	`°ªq
(
îr
[1], "")) {

528 
num
 = 2;

530 
num
 = 1;

533 
löes
[
num
] = 
	`gë_cˇn_fûe_löes
(
i
);

534 
m™gÀd
[
num
] = 
	`m™gÀ_exam∂e
(
m
, 
i
, 
löes
[num]);

535 
ªs
[
num
] = 
	`compûe
(
i
, 
m
, 
m™gÀd
[num], &
îr
[num]);

537  
num
+1;

538 
	}
}

540 
	$buûd_exam∂es
(
m™i„°
 *
m
,

541 *
timñe·
, 
sc‹e
 *score)

543 
cˇn_fûe
 *
i
;

544 **
¥ev
 = 
NULL
;

545 
boﬁ
 
w¨nögs
 = 
Ál£
;

547 
sc‹e
->
tŸÆ
 = 0;

548 
sc‹e
->
∑ss
 = 
åue
;

550 
	`li°_f‹_óch
(&
m
->
exam∂es
, 
i
, 
li°
) {

551 *
îr
[3];

552 
cˇn_fûe
 *
fûe
[3] = { 
NULL
, NULL, NULL };

553 
boﬁ
 
ªs
[3];

554 
num
, 
j
;

555 **
löes
[3];

556 c⁄° *
îr‹
;

558 
sc‹e
->
tŸÆ
++;

561 
	`°rù_Àadög_whôe•a˚
(
	`gë_cˇn_fûe_löes
(
i
));

563 
num
 = 
	`åy_compûög
(
m
, 
i
, 
¥ev
, 
fûe
, 
ªs
, 
îr
, 
löes
);

566 
j
 = 0; j < 
num
; j++) {

567 i‡(
ªs
[
j
] && 
	`°ªq
(
îr
[j], "")) {

568 i‡(!
	`has_ex≥˘ed_ouçut
(
löes
[
j
]))

569 
¥ev
 = 
löes
[
j
];

570 
sc‹e
->score++;

571 
√xt
;

576 
j
 = 0; j < 
num
; j++) {

577 i‡(
ªs
[
j
]) {

578 i‡(!
	`has_ex≥˘ed_ouçut
(
löes
[
j
]))

579 
¥ev
 = 
löes
[
j
];

580 
sc‹e
->score++;

581 
w¨nögs
 = 
åue
;

582 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
fûe
[
j
], 0,

589 
	`gë_cˇn_fûe_c⁄ã¡s
(
fûe
[
j
]),

590 
îr
[
j
]);

591 
√xt
;

595 
sc‹e
->
∑ss
 = 
Ál£
;

596 i‡(!
vîbo£
) {

597 i‡(
num
 == 3)

598 
îr‹
 = "Compiling standalone,ádding headers, "

602 
îr‹
 = "Standalone compileánd"

605 i‡(
num
 == 3) {

606 
îr‹
 = 
	`èl_fmt
(
sc‹e
,

616 
	`gë_cˇn_fûe_c⁄ã¡s
(
fûe
[0]),

617 
îr
[0],

618 
	`gë_cˇn_fûe_c⁄ã¡s
(
fûe
[1]),

619 
îr
[1],

620 
	`gë_cˇn_fûe_c⁄ã¡s
(
fûe
[2]),

621 
îr
[2]);

623 
îr‹
 = 
	`èl_fmt
(
sc‹e
,

630 
	`gë_cˇn_fûe_c⁄ã¡s
(
fûe
[0]),

631 
îr
[0],

632 
	`gë_cˇn_fûe_c⁄ã¡s
(
fûe
[1]),

633 
îr
[1]);

636 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0, "%s", 
îr‹
);

638 
¥ev
 = 
NULL
;

640 
√xt
:

645 i‡(!
	`li°_em±y
(&
m
->
exam∂es
)) {

646 
sc‹e
->
tŸÆ
++;

647 i‡(!
w¨nögs
)

648 
sc‹e
->score++;

650 
	}
}

652 
cˇ∆öt
 
	gexam∂es_compûe
 = {

653 .
key
 = "examples_compile",

654 .
	g«me
 = "ModuleÉxamples compile",

655 .
	gcheck
 = 
buûd_exam∂es
,

656 .
	gˇn_run
 = 
ˇn_run
,

657 .
	g√eds
 = "examples_exist module_builds"

660 
REGISTER_TEST
(
exam∂es_compûe
);

	@ccan/tools/ccanlint/tests/examples_exist.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èl/∑th/∑th.h
>

5 
	~<cˇn/èke/èke.h
>

6 
	~<cˇn/ˇ°/ˇ°.h
>

7 
	~<sys/ty≥s.h
>

8 
	~<sys/°©.h
>

9 
	~<f˙é.h
>

10 
	~<uni°d.h
>

11 
	~<limôs.h
>

12 
	~<î∫o.h
>

13 
	~<°dlib.h
>

14 
	~<°dio.h
>

15 
	~<îr.h
>

16 
	~<°rög.h
>

17 
	~<˘y≥.h
>

20 *
	$add_exam∂e
(
m™i„°
 *
m
, 
cˇn_fûe
 *
sour˚
,

21 
doc_£˘i⁄
 *
exam∂e
)

23 *
«me
, *
löem¨kî
;

24 
i
;

25 
fd
;

26 
cˇn_fûe
 *
f
;

28 
«me
 = 
	`èl_fmt
(
m
, "example-%s-%s",

29 
sour˚
->
«me
, 
exam∂e
->
fun˘i⁄
);

31 
	`°rchr
(
«me
, ' '))

32 *
	`°rchr
(
«me
, ' ') = '_';

34 
«me
 = 
	`ãmp_fûe
(
m
, ".c", 
	`èke
(name));

35 
f
 = 
	`√w_cˇn_fûe
(
m
, 
	`èke
(
	`∑th_dú«me
(m, 
«me
)),

36 
	`èke
(
	`∑th_ba£«me
(
m
, 
«me
)));

37 
	`èl_°ól
(
f
, 
«me
);

38 
	`li°_add_èû
(&
m
->
exam∂es
, &
f
->
li°
);

40 
fd
 = 
	`›í
(
f
->
fuŒ«me
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

41 i‡(
fd
 < 0)

42  
	`èl_fmt
(
m
, "CreatingÅemporary file %s: %s",

43 
f
->
fuŒ«me
, 
	`°ªº‹
(
î∫o
));

46 
löem¨kî
 = 
	`èl_fmt
(
f
, "#line %i \"%s\"\n",

47 
exam∂e
->
§˛öe
+2, 
sour˚
->
fuŒ«me
);

48 
	`wrôe
(
fd
, 
löem¨kî
, 
	`°æí
(linemarker));

50 
i
 = 0; i < 
exam∂e
->
num_löes
; i++) {

51 i‡(
	`wrôe
(
fd
, 
exam∂e
->
löes
[
i
], 
	`°æí
(example->lines[i]))

52 !
	`°æí
(
exam∂e
->
löes
[
i
])

53 || 
	`wrôe
(
fd
, "\n", 1) != 1) {

54 
	`˛o£
(
fd
);

55  
	`ˇ°_c⁄°
(*,

59 
	`˛o£
(
fd
);

60  
NULL
;

61 
	}
}

64 
	$exåa˘_exam∂es
(
m™i„°
 *
m
,

65 *
timñe·
,

66 
sc‹e
 *score)

68 
cˇn_fûe
 *
f
, *
maöh
 = 
NULL
;

69 
doc_£˘i⁄
 *
d
;

70 
boﬁ
 
have_öfo_exam∂e
 = 
Ál£
, 
have_hódî_exam∂e
 = false;

72 
sc‹e
->
tŸÆ
 = 2;

73 
	`li°_f‹_óch
(
	`gë_cˇn_fûe_docs
(
m
->
öfo_fûe
), 
d
, 
li°
) {

74 i‡(
	`°ªq
(
d
->
ty≥
, "example")) {

75 
sc‹e
->
îr‹
 = 
	`add_exam∂e
(
m
, m->
öfo_fûe
, 
d
);

76 i‡(
sc‹e
->
îr‹
)

78 
have_öfo_exam∂e
 = 
åue
;

83 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

84 i‡(!
	`°r°¨ts
(
f
->
«me
, 
m
->
ba£«me
)

85 || 
	`°æí
(
f
->
«me
Ë!°æí(
m
->
ba£«me
) + 2)

88 
maöh
 = 
f
;

89 
	`li°_f‹_óch
(
	`gë_cˇn_fûe_docs
(
f
), 
d
, 
li°
) {

90 i‡(
	`°ªq
(
d
->
ty≥
, "example")) {

91 
sc‹e
->
îr‹
 = 
	`add_exam∂e
(
m
, 
f
, 
d
);

92 i‡(
sc‹e
->
îr‹
)

94 
have_hódî_exam∂e
 = 
åue
;

100 
sc‹e
->
∑ss
 = 
åue
;

101 i‡(
have_öfo_exam∂e
 && 
have_hódî_exam∂e
) {

102 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

106 i‡(!
have_öfo_exam∂e
)

107 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
m
->
öfo_fûe
, 0, "No Example: section");

108 i‡(!
have_hódî_exam∂e
)

109 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
maöh
, 0, "No Example: section");

111 
sc‹e
->sc‹ê
have_öfo_exam∂e
 + 
have_hódî_exam∂e
;

112 
	}
}

114 
cˇ∆öt
 
	gexam∂es_exi°
 = {

115 .
key
 = "examples_exist",

116 .
	g«me
 = "_infoánd main header file have Example: sections",

117 .
	gcheck
 = 
exåa˘_exam∂es
,

118 .
	g√eds
 = "info_exists"

121 
REGISTER_TEST
(
exam∂es_exi°
);

	@ccan/tools/ccanlint/tests/examples_relevant.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<°rög.h
>

14 
	~<˘y≥.h
>

16 
	$exam∂es_ªÀv™t_check
(
m™i„°
 *
m
,

17 *
timñe·
,

18 
sc‹e
 *score)

20 
cˇn_fûe
 *
f
;

21 
doc_£˘i⁄
 *
d
;

23 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

24 
	`li°_f‹_óch
(
	`gë_cˇn_fûe_docs
(
f
), 
d
, 
li°
) {

25 
i
;

26 
boﬁ
 
found
 = 
Ál£
;

28 i‡(!
	`°ªq
(
d
->
ty≥
, "example"))

31 i‡(!
d
->
fun˘i⁄
) {

32 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
d
->
§˛öe
+1,

36 
i
 = 0; i < 
d
->
num_löes
; i++) {

37 i‡(
	`°r°r
(
d
->
löes
[
i
], d->
fun˘i⁄
))

38 
found
 = 
åue
;

41 i‡(!
found
) {

42 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
d
->
§˛öe
+1,

44 " míti⁄ it", 
d
->
fun˘i⁄
);

49 i‡(!
sc‹e
->
îr‹
) {

50 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

51 
sc‹e
->
∑ss
 = 
åue
;

54 
	}
}

56 
cˇ∆öt
 
	gexam∂es_ªÀv™t
 = {

57 .
key
 = "examples_relevant",

58 .
	g«me
 = "Example: sections demonstrateáppropriate function",

59 .
	gcheck
 = 
exam∂es_ªÀv™t_check
,

60 .
	g√eds
 = "examples_exist"

63 
REGISTER_TEST
(
exam∂es_ªÀv™t
);

	@ccan/tools/ccanlint/tests/examples_run.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/f‹óch/f‹óch.h
>

4 
	~<cˇn/°r/°r.h
>

5 
	~<cˇn/ˇ°/ˇ°.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<°döt.h
>

10 
	~<°rög.h
>

11 
	~<uni°d.h
>

12 
	~<˘y≥.h
>

13 
	~<as£π.h
>

15 c⁄° *
	$ˇn_run
(
m™i„°
 *
m
)

17 
li°_hód
 *
li°
;

19 i‡(
ß„_mode
)

21 
	`f‹óch_±r
(
li°
, &
m
->
exam∂es
, &m->
m™gÀd_exam∂es
)

22 i‡(!
	`li°_em±y
(
li°
))

23  
NULL
;

25 
	}
}

28 
boﬁ
 
	$sˇn_f‹v
(c⁄° *
˘x
,

29 c⁄° *
öput
, c⁄° *
fmt
, 
va_li°
 *
¨gs
)

31 
va_li°
 
≠
;

32 
boﬁ
 
ªt
;

34 i‡(
öput
[0] ='\0' || 
fmt
[0] == '\0')

35  
öput
[0] =
fmt
[0];

37 
	`va_c›y
(
≠
, *
¨gs
);

39 i‡(
	`cis•a˚
(
fmt
[0])) {

41 
ªt
 = 
Ál£
;

42 
	`cis•a˚
(
öput
[0])) {

43 i‡(
	`sˇn_f‹v
(
˘x
, ++
öput
, 
fmt
+1, &
≠
)) {

44 
ªt
 = 
åue
;

48 } i‡(
fmt
[0] != '%') {

49 i‡(
	`touµî
(
öput
[0]Ë!touµî(
fmt
[0]))

50 
ªt
 = 
Ál£
;

52 
ªt
 = 
	`sˇn_f‹v
(
˘x
, 
öput
+1, 
fmt
+1, &
≠
);

54 **
p
 = 
	`va_¨g
(
≠
, **);

55 
Àn
;

57 
ªt
 = 
Ál£
;

58 
	`as£π
(
fmt
[1] == 's');

59 
Àn
 = 1; 
öput
[len-1];Üen++) {

60 
ªt
 = 
	`sˇn_f‹v
(
˘x
, 
öput
 + 
Àn
, 
fmt
+2, &
≠
);

61 i‡(
ªt
) {

62 *
p
 = 
	`èl_°∫dup
(
˘x
, 
öput
, 
Àn
);

63 
ªt
 = 
åue
;

68 
	`va_íd
(
≠
);

69  
ªt
;

70 
	}
}

72 
boﬁ
 
	$sˇn_f‹
(c⁄° *
˘x
, c⁄° *
öput
, c⁄° *
fmt
, ...)

74 
boﬁ
 
ªt
;

75 
va_li°
 
≠
;

77 
	`va_°¨t
(
≠
, 
fmt
);

78 
ªt
 = 
	`sˇn_f‹v
(
˘x
, 
öput
, 
fmt
, &
≠
);

79 
	`va_íd
(
≠
);

80  
ªt
;

81 
	}
}

83 *
	$föd_ex≥˘
(
cˇn_fûe
 *
fûe
,

84 **
löes
, **
öput
, 
boﬁ
 *
exa˘
,

85 *
löe
)

87 *
ex≥˘
;

88 c⁄° *
fmt
;

90 ; 
löes
[*
löe
]; (*line)++) {

91 *
p
 = 
löes
[*
löe
] + 
	`°r•n
(lines[*line], " \t");

92 i‡(!
	`°r°¨ts
(
p
, "//"))

94 
p
 +
	`°r•n
(p, "/ ");

95 
	`f‹óch_±r
(
fmt
,

100 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, 
öput
, &
ex≥˘
)) {

101 *
exa˘
 = 
åue
;

102  
ex≥˘
;

106 
	`f‹óch_±r
(
fmt
,

111 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, 
öput
, &
ex≥˘
)) {

112 *
exa˘
 = 
Ál£
;

113  
ex≥˘
;

117 
	`f‹óch_±r
(
fmt
, "outputs '%s'", "outputs \"%s\"") {

118 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, &
ex≥˘
)) {

119 *
öput
 = 
	`ˇ°_c⁄°
(*, "");

120 *
exa˘
 = 
åue
;

121  
ex≥˘
;

125 
	`f‹óch_±r
(
fmt
,

130 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, 
öput
, &
ex≥˘
)) {

131 *
exa˘
 = 
Ál£
;

132  
ex≥˘
;

137 
	`f‹óch_±r
(
fmt
,

148 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, 
öput
, &
ex≥˘
)) {

149 *
exa˘
 = 
åue
;

150  
ex≥˘
;

154 
	`f‹óch_±r
(
fmt
,

165 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, 
öput
, &
ex≥˘
)) {

166 *
exa˘
 = 
Ál£
;

167  
ex≥˘
;

171 
	`f‹óch_±r
(
fmt
,

175 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, &
ex≥˘
)) {

176 *
öput
 = 
	`ˇ°_c⁄°
(*, "");

177 *
exa˘
 = 
åue
;

178  
ex≥˘
;

182 
	`f‹óch_±r
(
fmt
,

186 i‡(
	`sˇn_f‹
(
fûe
, 
p
, 
fmt
, &
ex≥˘
)) {

187 *
öput
 = 
	`ˇ°_c⁄°
(*, "");

188 *
exa˘
 = 
Ál£
;

189  
ex≥˘
;

193  
NULL
;

194 
	}
}

196 *
	$åim
(*
°rög
)

198 
	`°ªnds
(
°rög
, "\n"))

199 
°rög
[
	`°æí
(string)-1] = '\0';

200  
°rög
;

201 
	}
}

203 *
	$u√x≥˘ed
(
cˇn_fûe
 *
i
, c⁄° *
öput
,

204 c⁄° *
ex≥˘
, 
boﬁ
 
exa˘
)

206 *
ouçut
, *
cmd
;

207 
boﬁ
 
ok
;

208 
deÁu…_time
 = 
deÁu…_timeout_ms
;

210 
cmd
 = 
	`èl_fmt
(
i
, "echo '%s' | %s %s",

211 
öput
, 
i
->
compûed
[
COMPILE_NORMAL
], input);

213 
ouçut
 = 
	`run_wôh_timeout
(
i
, 
cmd
, &
ok
, &
deÁu…_time
);

214 i‡(!
ok
)

215  
	`èl_fmt
(
i
, "Exited withÇon-zero status\n");

217 i‡(
exa˘
) {

218 i‡(
	`°ªq
(
ouçut
, 
ex≥˘
Ë|| såeq(
	`åim
(output),Éxpect))

219  
NULL
;

221 i‡(
	`°r°r
(
ouçut
, 
ex≥˘
))

222  
NULL
;

224  
ouçut
;

225 
	}
}

227 
	$run_exam∂es
(
m™i„°
 *
m
,

228 *
timñe·
, 
sc‹e
 *score)

230 
cˇn_fûe
 *
i
;

231 
li°_hód
 *
li°
;

233 
sc‹e
->
tŸÆ
 = 0;

234 
sc‹e
->
∑ss
 = 
åue
;

236 
	`f‹óch_±r
(
li°
, &
m
->
exam∂es
, &m->
m™gÀd_exam∂es
) {

237 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

238 **
löes
, *
ex≥˘
, *
öput
, *
ouçut
;

239 
löíum
 = 0;

240 
boﬁ
 
exa˘
;

242 
löes
 = 
	`gë_cˇn_fûe_löes
(
i
);

244 
ex≥˘
 = 
	`föd_ex≥˘
(
i
, 
löes
, &
öput
, &
exa˘
,

245 &
löíum
);

246 
ex≥˘
;

247 
löíum
++,

248 
ex≥˘
 = 
	`föd_ex≥˘
(
i
, 
löes
, &
öput
,

249 &
exa˘
, &
löíum
)) {

250 i‡(
i
->
compûed
[
COMPILE_NORMAL
] =
NULL
)

253 
sc‹e
->
tŸÆ
++;

254 
ouçut
 = 
	`u√x≥˘ed
(
i
, 
öput
, 
ex≥˘
, 
exa˘
);

255 i‡(!
ouçut
) {

256 
sc‹e
->score++;

259 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 
löíum
+1,

261 
ouçut
,

262 
exa˘
 ? "match" : "contain",

263 
ex≥˘
);

264 
sc‹e
->
∑ss
 = 
Ál£
;

268 
	}
}

271 
cˇ∆öt
 
	gexam∂es_run
 = {

272 .
key
 = "examples_run",

273 .
	g«me
 = "ModuleÉxamples withÉxpected output giveÅhat output",

274 .
	gcheck
 = 
run_exam∂es
,

275 .
	gˇn_run
 = 
ˇn_run
,

276 .
	g√eds
 = "examples_compile"

279 
REGISTER_TEST
(
exam∂es_run
);

	@ccan/tools/ccanlint/tests/hash_if.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

17 
	$check_hash_if
(
m™i„°
 *
m
,

18 *
timñe·
, 
sc‹e
 *score)

20 
li°_hód
 *
li°
;

21 c⁄° *
ex∂™©i⁄
 =

26 
sc‹e
->
∑ss
 = 
åue
;

28 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
,

29 &
m
->
run_ã°s
, &m->
≠i_ã°s
,

30 &
m
->
compûe_ok_ã°s
, &m->
compûe_Áû_ã°s
,

31 &
m
->
Ÿhî_ã°_c_fûes
) {

32 
cˇn_fûe
 *
f
;

34 
	`li°_f‹_óch
(
li°
, 
f
,Üist) {

35 
i
;

36 **
löes
 = 
	`gë_cˇn_fûe_löes
(
f
);

38 
i
 = 0; 
löes
[i]; i++) {

39 c⁄° *
löe
 = 
löes
[
i
];

40 *
sym
;

42 i‡(!
	`gë_tokí
(&
löe
, "#"))

44 i‡(!(
	`gë_tokí
(&
löe
, "if")

45 && 
	`gë_tokí
(&
löe
, "defined")

46 && 
	`gë_tokí
(&
löe
, "("))

47 && !
	`gë_tokí
(&
löe
, "ifdef"))

50 
sym
 = 
	`gë_symbﬁ_tokí
(
löes
, &
löe
);

51 i‡(!
sym
 || !
	`°r°¨ts
(sym, "HAVE_"))

53 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

56 
sym
, 
ex∂™©i⁄
);

57 
ex∂™©i⁄
 = "";

62 i‡(!
sc‹e
->
îr‹
) {

63 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

65 
	}
}

67 
cˇ∆öt
 
	ghash_if
 = {

68 .
key
 = "hash_if",

69 .
	g«me
 = "Featuresáre checked with #ifÇot #ifdef",

70 .
	gcheck
 = 
check_hash_if
,

71 .
	g√eds
 = "info_exists"

74 
REGISTER_TEST
(
hash_if
);

	@ccan/tools/ccanlint/tests/headers_idempotent.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<°rög.h
>

14 
	~<˘y≥.h
>

16 c⁄° 
	gex∂aö
[]

24 
	$fix_«me
(*
«me
)

26 
i
;

28 
i
 = 0; 
«me
[i]; i++) {

29 i‡(
	`ciß um
(
«me
[
i
]))

30 
«me
[
i
] = 
	`touµî
(name[i]);

32 
«me
[
i
] = '_';

34 
	}
}

36 
	$h™dÀ_idem
(
m™i„°
 *
m
, 
sc‹e
 *score)

38 
fûe_îr‹
 *
e
;

40 
	`li°_f‹_óch
(&
sc‹e
->
≥r_fûe_îr‹s
, 
e
, 
li°
) {

41 *
«me
, *
q
, *
tm≤ame
;

42 
FILE
 *
out
;

43 
i
;

46 i‡(
	`°r°¨ts
(
e
->
fûe
->
«me
, 
m
->
ba£«me
)

47 || 
	`°æí
(
e
->
fûe
->
«me
Ë=°æí(
m
->
ba£«me
) + 2)

48 
«me
 = 
	`èl_fmt
(
sc‹e
, "CCAN_%s_H", 
m
->
mod«me
);

50 
«me
 = 
	`èl_fmt
(
sc‹e
, "CCAN_%s_%s",

51 
m
->
mod«me
, 
e
->
fûe
->
«me
);

52 
	`fix_«me
(
«me
);

54 
q
 = 
	`èl_fmt
(
sc‹e
,

56 
e
->
fûe
->
«me
,Çame);

57 i‡(!
	`ask
(
q
))

60 
tm≤ame
 = 
	`ãmp_fûe
(
sc‹e
, ".h", 
e
->
fûe
->
«me
);

61 
out
 = 
	`f›í
(
tm≤ame
, "w");

62 i‡(!
out
)

63 
	`îr
(1, "O≥nög %s", 
tm≤ame
);

64 i‡(
	`Ârötf
(
out
, "#i‚de‡%s\n#deföê%s\n", 
«me
,Çame) < 0)

65 
	`îr
(1, "Wrôög %s", 
tm≤ame
);

67 
i
 = 0; 
e
->
fûe
->
löes
[i]; i++)

68 i‡(
	`Ârötf
(
out
, "%s\n", 
e
->
fûe
->
löes
[
i
]) < 0)

69 
	`îr
(1, "Wrôög %s", 
tm≤ame
);

71 i‡(
	`Ârötf
(
out
, "#ídi‡/* %†*/\n", 
«me
) < 0)

72 
	`îr
(1, "Wrôög %s", 
tm≤ame
);

74 i‡(
	`f˛o£
(
out
) != 0)

75 
	`îr
(1, "Closög %s", 
tm≤ame
);

77 i‡(!
	`move_fûe
(
tm≤ame
, 
e
->
fûe
->
fuŒ«me
))

78 
	`îr
(1, "Movög %†tÿ%s", 
tm≤ame
, 
e
->
fûe
->
fuŒ«me
);

80 
	}
}

82 
	$check_idem
(
cˇn_fûe
 *
f
, 
sc‹e
 *score)

84 
löe_öfo
 *line_info;

85 
i
, 
fú°_¥ïroc_löe
;

86 c⁄° *
löe
, *
sym
;

88 
löe_öfo
 = 
	`gë_cˇn_löe_öfo
(
f
);

89 i‡(
	`èl_cou¡
(
f
->
löes
) < 4)

93 
i
 = 0; 
f
->
löes
[i]; i++) {

94 i‡(
löe_öfo
[
i
].
ty≥
 =
DOC_LINE


95 || 
löe_öfo
[
i
].
ty≥
 =
COMMENT_LINE
)

97 i‡(
löe_öfo
[
i
].
ty≥
 =
CODE_LINE
) {

98 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

102 } i‡(
löe_öfo
[
i
].
ty≥
 =
PREPROC_LINE
)

107 i‡(!
f
->
löes
[
i
])

110 
fú°_¥ïroc_löe
 = 
i
;

111 
i
 = 
fú°_¥ïroc_löe
+1; 
f
->
löes
[i]; i++) {

112 i‡(
löe_öfo
[
i
].
ty≥
 =
DOC_LINE


113 || 
löe_öfo
[
i
].
ty≥
 =
COMMENT_LINE
)

115 i‡(
löe_öfo
[
i
].
ty≥
 =
CODE_LINE
) {

116 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

120 } i‡(
löe_öfo
[
i
].
ty≥
 =
PREPROC_LINE
)

125 i‡(!
f
->
löes
[
i
])

129 i‡(!
löe_öfo
[
i
].
c⁄d
) {

130 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1, "Expected #ifndef");

134 
löe
 = 
f
->
löes
[
i
];

137 i‡(
löe_öfo
[
i
].
c⁄d
->
ty≥
 !
PP_COND_IFDEF


138 || !
löe_öfo
[
i
].
c⁄d
->
övî£
) {

139 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1, "Expected #ifndef");

144 i‡(!
	`gë_tokí
(&
löe
, "#"))

145 
	`ab‹t
();

146 i‡(!
	`gë_tokí
(&
löe
, "define")) {

147 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

149 
löe_öfo
[
i
].
c⁄d
->
symbﬁ
);

152 
sym
 = 
	`gë_symbﬁ_tokí
(
f
, &
löe
);

153 i‡(!
sym
 || !
	`°ªq
(sym, 
löe_öfo
[
i
].
c⁄d
->
symbﬁ
)) {

154 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

156 
löe_öfo
[
i
].
c⁄d
->
symbﬁ
);

161 
i
++; 
f
->
löes
[i]; i++) {

162 
vÆ
 = 0;

163 i‡(
löe_öfo
[
i
].
ty≥
 =
DOC_LINE


164 || 
löe_öfo
[
i
].
ty≥
 =
COMMENT_LINE
)

166 i‡(
	`gë_cˇn_löe_µ
(
löe_öfo
[
i
].
c⁄d
, 
sym
, &
vÆ
, 
NULL
)

167 !
NOT_COMPILED
) {

168 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1, "code outside"

173 
	}
}

175 
	$check_idempŸít
(
m™i„°
 *
m
,

176 *
timñe·
, 
sc‹e
 *score)

178 
cˇn_fûe
 *
f
;

181 
sc‹e
->
∑ss
 = 
åue
;

183 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

184 
	`check_idem
(
f
, 
sc‹e
);

186 i‡(!
sc‹e
->
îr‹
) {

187 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

189 
	}
}

191 
cˇ∆öt
 
	ghódîs_idempŸít
 = {

192 .
key
 = "headers_idempotent",

193 .
	g«me
 = "Module headersáre #ifndef/#define wrapped",

194 .
	gcheck
 = 
check_idempŸít
,

195 .
	gh™dÀ
 = 
h™dÀ_idem
,

196 .
	g√eds
 = "info_exists main_header_exists"

199 
REGISTER_TEST
(
hódîs_idempŸít
);

	@ccan/tools/ccanlint/tests/info_documentation_exists.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/doc_exåa˘.h
>

3 
	~<toﬁs/toﬁs.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<cˇn/°r/°r.h
>

14 
	~<cˇn/n€º/n€º.h
>

16 
check_öfo_documíèti⁄_exi°s
(
m™i„°
 *
m
,

17 *
timñe·
,

18 
sc‹e
 *score);

20 
cˇ∆öt
 
	göfo_documíèti⁄_exi°s
 = {

21 .
key
 = "info_documentation_exists",

22 .
	g«me
 = "Module has documentation in _info",

23 .
	gcheck
 = 
check_öfo_documíèti⁄_exi°s
,

24 .
	g√eds
 = "info_exists"

27 
	$¸óã_öfo_ãm∂©e_doc
(
m™i„°
 *
m
, 
sc‹e
 *score)

29 
fd
;

30 
FILE
 *
√w
;

31 *
ﬁdc⁄ã¡s
;

33 i‡(!
	`ask
("Should IÖrepend descriptionÅo _info file for you?"))

36 
fd
 = 
	`›í
("_öfo.√w", 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0666);

37 i‡(
fd
 < 0 || !(
√w
 = 
	`fd›í
(fd, "w")))

38 
	`îr
(1, "Creating _info.newÅo insert documentation");

40 i‡(
	`Ârötf
(
√w
,

48 " */\n", 
m
->
mod«me
, m->
ba£«me
) < 0) {

49 
	`u∆ök_n€º
("_info.new");

50 
	`îr
(1, "WritingÅo _info.newÅo insert documentation");

53 
ﬁdc⁄ã¡s
 = 
	`èl_gøb_fûe
(
m
, m->
öfo_fûe
->
fuŒ«me
, 
NULL
);

54 i‡(!
ﬁdc⁄ã¡s
) {

55 
	`u∆ök_n€º
("_info.new");

56 
	`îr
(1, "Ródög %s", 
m
->
öfo_fûe
->
fuŒ«me
);

58 i‡(
	`Ârötf
(
√w
, "%s", 
ﬁdc⁄ã¡s
) < 0) {

59 
	`u∆ök_n€º
("_info.new");

60 
	`îr
(1, "Appending _infoÅo _info.new");

62 i‡(
	`f˛o£
(
√w
) != 0) {

63 
	`u∆ök_n€º
("_info.new");

64 
	`îr
(1, "Closing _info.new");

66 i‡(!
	`move_fûe
("_öfo.√w", 
m
->
öfo_fûe
->
fuŒ«me
)) {

67 
	`u∆ök_n€º
("_info.new");

68 
	`îr
(1, "Ríamög _öfo.√wÅÿ%s", 
m
->
öfo_fûe
->
fuŒ«me
);

70 
	}
}

72 
	$check_öfo_documíèti⁄_exi°s
(
m™i„°
 *
m
,

73 *
timñe·
,

74 
sc‹e
 *score)

76 
li°_hód
 *
öfodocs
 = 
	`gë_cˇn_fûe_docs
(
m
->
öfo_fûe
);

77 
doc_£˘i⁄
 *
d
;

78 
boﬁ
 
summ¨y
 = 
Ál£
, 
des¸ùti⁄
 = false;

81 
sc‹e
->
∑ss
 = 
åue
;

83 
	`li°_f‹_óch
(
öfodocs
, 
d
, 
li°
) {

84 i‡(!
	`°ªq
(
d
->
fun˘i⁄
, 
m
->
mod«me
))

86 i‡(
	`°ªq
(
d
->
ty≥
, "summary"))

87 
summ¨y
 = 
åue
;

88 i‡(
	`°ªq
(
d
->
ty≥
, "description"))

89 
des¸ùti⁄
 = 
åue
;

92 i‡(
summ¨y
 && 
des¸ùti⁄
) {

93 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

94 } i‡(!
summ¨y
) {

95 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score,

99 
öfo_documíèti⁄_exi°s
.
h™dÀ
 = 
¸óã_öfo_ãm∂©e_doc
;

100 } i‡(!
des¸ùti⁄
) {

101 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score,

107 
	}
}

109 
REGISTER_TEST
(
öfo_documíèti⁄_exi°s
);

	@ccan/tools/ccanlint/tests/info_exists.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/èl/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<°rög.h
>

14 
	~<cˇn/n€º/n€º.h
>

16 
	$check_has_öfo
(
m™i„°
 *
m
,

17 *
timñe·
,

18 
sc‹e
 *score)

20 i‡(
m
->
öfo_fûe
) {

21 
sc‹e
->
∑ss
 = 
åue
;

22 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

23 
	`add_öfo_›ti⁄s
(
m
->
öfo_fûe
);

25 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score,

31 
	}
}

33 c⁄° 
	gãm∂©e
[] =

59 
	$¸óã_öfo_ãm∂©e
(
m™i„°
 *
m
, 
sc‹e
 *score)

61 
FILE
 *
öfo
;

62 c⁄° *
fûíame
;

64 i‡(!
	`ask
("Should I createáÅemplate _info file for you?"))

67 
fûíame
 = 
	`èl_fmt
(
m
, "%s/%s", m->
dú
, "_info");

68 
öfo
 = 
	`f›í
(
fûíame
, "w");

69 i‡(!
öfo
)

70 
	`îr
(1, "TryögÅÿ¸óãáÅem∂©ê_öfÿö %s", 
fûíame
);

72 i‡(
	`Ârötf
(
öfo
, 
ãm∂©e
, 
m
->
mod«me
) < 0) {

73 
	`u∆ök_n€º
(
fûíame
);

74 
	`îr
(1, "WrôögÅem∂©êötÿ%s", 
fûíame
);

76 
	`f˛o£
(
öfo
);

77 
	}
}

79 
cˇ∆öt
 
	göfo_exi°s
 = {

80 .
key
 = "info_exists",

81 .
	g«me
 = "Module has _info file",

82 .
	gcompuls‹y
 = 
åue
,

83 .
	gcheck
 = 
check_has_öfo
,

84 .
	gh™dÀ
 = 
¸óã_öfo_ãm∂©e
,

85 .
	g√eds
 = ""

88 
REGISTER_TEST
(
öfo_exi°s
);

	@ccan/tools/ccanlint/tests/info_summary_single_line.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<°dio.h
>

4 
	~<cˇn/°r/°r.h
>

6 
	$check_öfo_summ¨y_sögÀ_löe
(
m™i„°
 *
m
,

7 *
timñe·
,

8 
sc‹e
 *score)

10 
li°_hód
 *
öfodocs
 = 
	`gë_cˇn_fûe_docs
(
m
->
öfo_fûe
);

11 
doc_£˘i⁄
 *
d
;

13 
sc‹e
->
∑ss
 = 
åue
;

14 
sc‹e
->score = 1;

16 
	`li°_f‹_óch
(
öfodocs
, 
d
, 
li°
) {

17 c⁄° *
a·î
;

19 i‡(!
	`°ªq
(
d
->
ty≥
, "summary"))

23 
a·î
 = 
m
->
öfo_fûe
->
löes
[
d
->
§˛öe
+1];

24 i‡(
a·î
 && 
	`°r•n
◊·î, " *"Ë!
	`°æí
(after)) {

25 
sc‹e
->
∑ss
 = 
Ál£
;

26 
sc‹e
->score = 0;

27 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
m
->
öfo_fûe
, 
d
->
§˛öe
+1,

29 
m
->
öfo_fûe
->
löes
[
d
->
§˛öe
],

30 
m
->
öfo_fûe
->
löes
[
d
->
§˛öe
+1]);

33 
	}
}

35 
cˇ∆öt
 
	göfo_summ¨y_sögÀ_löe
 = {

36 .
key
 = "info_summary_single_line",

37 .
	g«me
 = "Module hasá singleÜine summary in _info",

38 .
	gcheck
 = 
check_öfo_summ¨y_sögÀ_löe
,

39 .
	g√eds
 = "info_exists"

42 
REGISTER_TEST
(
öfo_summ¨y_sögÀ_löe
);

	@ccan/tools/ccanlint/tests/license_comment.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/f‹óch/f‹óch.h
>

3 
	~<sys/ty≥s.h
>

4 
	~<sys/°©.h
>

5 
	~<f˙é.h
>

6 
	~<uni°d.h
>

7 
	~<limôs.h
>

8 
	~<î∫o.h
>

9 
	~<°dlib.h
>

10 
	~<°dio.h
>

11 
	~<îr.h
>

12 
	~<cˇn/°r/°r.h
>

14 
	$check_li˚n£_commít
(
m™i„°
 *
m
,

15 *
timñe·
, 
sc‹e
 *score)

17 
li°_hód
 *
li°
;

20 i‡(
m
->
li˚n£
 =
LICENSE_PUBLIC_DOMAIN


21 || 
m
->
li˚n£
 =
LICENSE_UNKNOWN
) {

22 
sc‹e
->
∑ss
 = 
åue
;

23 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

27 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
) {

28 
cˇn_fûe
 *
f
;

30 
	`li°_f‹_óch
(
li°
, 
f
,Üist) {

31 
i
;

32 **
löes
 = 
	`gë_cˇn_fûe_löes
(
f
);

33 
löe_öfo
 *
öfo
 = 
	`gë_cˇn_löe_öfo
(
f
);

34 
boﬁ
 
found_li˚n£
 = 
Ál£
, 
found_Êav‹
 = false;

36 
i
 = 0; 
löes
[i]; i++) {

37 i‡(
öfo
[
i
].
ty≥
 =
CODE_LINE
)

39 i‡(
	`°r°r
(
löes
[
i
], "LICENSE"))

40 
found_li˚n£
 = 
åue
;

41 i‡(
	`°r°r
(
löes
[
i
],

42 
li˚n£s
[
m
->
li˚n£
].
sh‹äame
))

43 
found_Êav‹
 = 
åue
;

45 i‡((!
found_li˚n£
 || !
found_Êav‹
)

46 && !
	`föd_boûî∂©e
(
f
, 
m
->
li˚n£
)) {

47 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
löes
[
i
] ? i : 0,

54 i‡(
	`li°_em±y
(&
sc‹e
->
≥r_fûe_îr‹s
)) {

55 
sc‹e
->
∑ss
 = 
åue
;

56 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

58 
	}
}

60 
cˇ∆öt
 
	gli˚n£_commít
 = {

61 .
key
 = "license_comment",

62 .
	g«me
 = "Sourceánd header filesÑeferÅo LICENSE",

63 .
	gcheck
 = 
check_li˚n£_commít
,

64 .
	g√eds
 = "license_exists"

66 
REGISTER_TEST
(
li˚n£_commít
);

	@ccan/tools/ccanlint/tests/license_depends_compat.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/f‹óch/f‹óch.h
>

3 
	~<sys/ty≥s.h
>

4 
	~<sys/°©.h
>

5 
	~<f˙é.h
>

6 
	~<uni°d.h
>

7 
	~<limôs.h
>

8 
	~<î∫o.h
>

9 
	~<°dlib.h
>

10 
	~<°dio.h
>

11 
	~<îr.h
>

13 
	$check_li˚n£_dïíds_com∑t
(
m™i„°
 *
m
,

14 *
timñe·
,

15 
sc‹e
 *score)

17 
m™i„°
 *
i
;

19 
sc‹e
->
∑ss
 = 
åue
;

22 i‡(
m
->
li˚n£
 =
LICENSE_UNKNOWN
) {

23 
sc‹e
->sc‹êsc‹e->
tŸÆ
 = 0;

27 
	`li°_f‹_óch
(&
m
->
dïs
, 
i
, 
li°
) {

28 
doc_£˘i⁄
 *
d
 = 
	`föd_li˚n£_èg
(
i
);

29 
i
->
li˚n£
 = 
	`which_li˚n£
(
d
);

31 i‡(
i
->
li˚n£
 !
LICENSE_UNKNOWN


32 && !
li˚n£_com∑tibÀ
[
m
->
li˚n£
][
i
->license]) {

33 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
->
öfo_fûe
, 0,

36 
i
->
mod«me
,

37 
li˚n£s
[
i
->
li˚n£
].
«me
);

38 
sc‹e
->
∑ss
 = 
Ál£
;

42 i‡(
sc‹e
->
∑ss
)

43 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

44 
	}
}

46 
cˇ∆öt
 
	gli˚n£_dïíds_com∑t
 = {

47 .
key
 = "license_depends_compat",

48 .
	g«me
 = "CCAN dependencies don't contain incompatibleÜicenses",

49 .
	gcheck
 = 
check_li˚n£_dïíds_com∑t
,

50 .
	g√eds
 = "license_exists depends_exist"

52 
REGISTER_TEST
(
li˚n£_dïíds_com∑t
);

	@ccan/tools/ccanlint/tests/license_exists.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/èl/°r/°r.h
>

4 
	~<cˇn/èl/∑th/∑th.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<cˇn/°r/°r.h
>

15 
	~<cˇn/èke/èke.h
>

18 c⁄° *
	$lök_¥efix
(
m™i„°
 *
m
)

20 *
¥efix
 = 
	`èl_°rdup
(
m
, "../../");

21 
i
;

23 
i
 = 0; i < 
	`°rcou¡
(
m
->
mod«me
, "/"); i++)

24 
¥efix
 = 
	`èl_°rˇt
(
m
, 
	`èke
(prefix), "../");

26  
	`èl_°rˇt
(
m
, 
	`èke
(
¥efix
), "licenses/");

27 
	}
}

29 c⁄° *
	$ex≥˘ed_lök
(c⁄° 
èl_t
 *
˘x
,

30 c⁄° *
¥efix
, 
li˚n£
Üicense)

32 c⁄° *
sh‹äame
;

34 
li˚n£
) {

35 
LICENSE_LGPLv2_PLUS
:

36 
LICENSE_LGPLv2
:

37 
sh‹äame
 = "LGPL-2.1";

39 
LICENSE_LGPLv3
:

40 
LICENSE_LGPL
:

41 
sh‹äame
 = "LGPL-3";

44 
LICENSE_GPLv2_PLUS
:

45 
LICENSE_GPLv2
:

46 
sh‹äame
 = "GPL-2";

49 
LICENSE_GPLv3
:

50 
LICENSE_GPL
:

51 
sh‹äame
 = "GPL-3";

54 
LICENSE_BSD
:

55 
sh‹äame
 = "BSD-3CLAUSE";

58 
LICENSE_MIT
:

59 
sh‹äame
 = "BSD-MIT";

62 
LICENSE_CC0
:

63 
sh‹äame
 = "CC0";

67  
NULL
;

70  
	`èl_°rˇt
(
˘x
, 
¥efix
, 
sh‹äame
);

71 
	}
}

73 
	$h™dÀ_li˚n£_lök
(
m™i„°
 *
m
, 
sc‹e
 *score)

75 
doc_£˘i⁄
 *
d
 = 
	`föd_li˚n£_èg
(
m
);

76 c⁄° *
¥efix
 = 
	`lök_¥efix
(
m
);

77 c⁄° *
lök
 = 
	`∑th_joö
(
m
, m->
dú
, "LICENSE");

78 c⁄° *
lde°
 = 
	`ex≥˘ed_lök
(
sc‹e
, 
¥efix
, 
m
->
li˚n£
);

79 *
q
;

81 
	`¥ötf
(

83 "LICENSE symlök i¡ÿ%†tÿavoidÅoÿm™y c›õs.\n", 
¥efix
);

86 
q
 = 
	`èl_fmt
(
m
, "Set upÜinkÅo %s (license is %s)?",

87 
lde°
, 
d
->
löes
[0]);

88 i‡(
	`ask
(
q
)) {

89 i‡(
	`symlök
(
lde°
, 
lök
) != 0)

90 
	`îr
(1, "Cª©ög symlök %†-> %s", 
lök
, 
lde°
);

92 
	}
}

94 
cˇ∆öt
 
li˚n£_exi°s
;

96 
	$check_has_li˚n£
(
m™i„°
 *
m
,

97 *
timñe·
, 
sc‹e
 *score)

99 
buf
[
PATH_MAX
];

100 
ssize_t
 
Àn
;

101 *
li˚n£
 = 
	`∑th_joö
(
m
, m->
dú
, "LICENSE");

102 c⁄° *
ex≥˘ed
;

103 
doc_£˘i⁄
 *
d
;

104 c⁄° *
¥efix
 = 
	`lök_¥efix
(
m
);

106 
d
 = 
	`föd_li˚n£_èg
(
m
);

107 i‡(!
d
) {

108 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score, "No License:Åag in _info");

112 
m
->
li˚n£
 = 
	`which_li˚n£
(
d
);

113 i‡(
m
->
li˚n£
 =
LICENSE_UNKNOWN
) {

114 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
m
->
öfo_fûe
, 
d
->
§˛öe
,

116 
d
->
löes
[0]);

118 
sc‹e
->
∑ss
 = 
åue
;

123 
sc‹e
->
∑ss
 = 
åue
;

125 
ex≥˘ed
 = 
	`ex≥˘ed_lök
(
m
, 
¥efix
, m->
li˚n£
);

127 
Àn
 = 
	`ªadlök
(
li˚n£
, 
buf
, (buf));

128 i‡(
Àn
 < 0) {

130 i‡(
î∫o
 =
EINVAL
) {

131 i‡(!
ex≥˘ed
) {

132 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

135 
sc‹e
->
îr‹


136 
	`èl_fmt
(
sc‹e
,

139 
d
->
löes
[0], 
ex≥˘ed
);

142 i‡(
î∫o
 =
ENOENT
) {

144 i‡(
m
->
li˚n£
 =
LICENSE_PUBLIC_DOMAIN
) {

145 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

148 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score,

150 i‡(
ex≥˘ed
)

151 
li˚n£_exi°s
.
h™dÀ
 = 
h™dÀ_li˚n£_lök
;

154 
	`îr
(1, "ªadlök o¿%s", 
li˚n£
);

156 i‡(
Àn
 >(
buf
))

157 
	`îrx
(1, "Ródög symlök %†gavêhugêªsu…", 
li˚n£
);

159 
buf
[
Àn
] = '\0';

161 i‡(!
	`°r°¨ts
(
buf
, 
¥efix
)) {

162 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

164 
¥efix
, 
buf
);

168 i‡(!
ex≥˘ed
) {

169 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

172 
d
->
löes
[0], 
buf
);

176 i‡(!
	`°ªq
(
buf
, 
ex≥˘ed
)) {

177 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

179 
ex≥˘ed
, 
buf
);

182 
sc‹e
->
∑ss
 = 
åue
;

183 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

184 
	}
}

186 
cˇ∆öt
 
	gli˚n£_exi°s
 = {

187 .
key
 = "license_exists",

188 .
	g«me
 = "Module has License:Éntry in _info,ánd LICENSE symlink/file",

189 .
	gcheck
 = 
check_has_li˚n£
,

190 .
	g√eds
 = "info_exists"

192 
REGISTER_TEST
(
li˚n£_exi°s
);

	@ccan/tools/ccanlint/tests/license_file_compat.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/f‹óch/f‹óch.h
>

3 
	~<sys/ty≥s.h
>

4 
	~<sys/°©.h
>

5 
	~<f˙é.h
>

6 
	~<uni°d.h
>

7 
	~<limôs.h
>

8 
	~<î∫o.h
>

9 
	~<°dlib.h
>

10 
	~<°dio.h
>

11 
	~<îr.h
>

12 
	~<cˇn/°r/°r.h
>

14 
	$check_li˚n£_fûe_com∑t
(
m™i„°
 *
m
,

15 *
timñe·
,

16 
sc‹e
 *score)

18 
li°_hód
 *
li°
;

21 i‡(
m
->
li˚n£
 =
LICENSE_UNKNOWN
) {

22 
sc‹e
->
∑ss
 = 
åue
;

23 
sc‹e
->sc‹êsc‹e->
tŸÆ
 = 0;

27 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
) {

28 
cˇn_fûe
 *
f
;

30 
	`li°_f‹_óch
(
li°
, 
f
,Üist) {

31 
li˚n£
 
l
;

35 
l
 = 0;Ü < 
LICENSE_UNKNOWN
;Ü++) {

36 i‡(!
	`föd_boûî∂©e
(
f
, 
l
))

38 i‡(
li˚n£_com∑tibÀ
[
m
->
li˚n£
][
l
])

40 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 0,

42 
li˚n£s
[
l
].
«me
,

43 
li˚n£s
[
m
->
li˚n£
].
«me
);

49 i‡(
	`li°_em±y
(&
sc‹e
->
≥r_fûe_îr‹s
)) {

50 
sc‹e
->
∑ss
 = 
åue
;

51 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

53 
	}
}

55 
cˇ∆öt
 
	gli˚n£_fûe_com∑t
 = {

56 .
key
 = "license_file_compat",

57 .
	g«me
 = "Source files don't contain incompatibleÜicenses",

58 .
	gcheck
 = 
check_li˚n£_fûe_com∑t
,

59 .
	g√eds
 = "license_exists"

61 
REGISTER_TEST
(
li˚n£_fûe_com∑t
);

	@ccan/tools/ccanlint/tests/main_header_compiles.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<°rög.h
>

14 
	~<˘y≥.h
>

16 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

18 i‡(
ß„_mode
)

20  
NULL
;

21 
	}
}

23 
cˇn_fûe
 *
	$maö_hódî
(
m™i„°
 *
m
)

25 
cˇn_fûe
 *
f
;

27 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

28 i‡(
	`°r°¨ts
(
f
->
«me
, 
m
->
ba£«me
)

29 && 
	`°æí
(
f
->
«me
Ë=°æí(
m
->
ba£«me
) + 2)

30  
f
;

33 
	`ab‹t
();

34 
	}
}

36 
	$check_ö˛udes_buûd
(
m™i„°
 *
m
,

37 *
timñe·
, 
sc‹e
 *score)

39 *
c⁄ã¡s
;

40 *
tmp§c
, *
tmpobj
, *
cmdout
;

41 
fd
;

42 
cˇn_fûe
 *
maöh
 = 
	`maö_hódî
(
m
);

44 
tmp§c
 = 
	`ãmp_fûe
(
m
, "-ö˛uded.c", 
maöh
->
fuŒ«me
);

45 
tmpobj
 = 
	`ãmp_fûe
(
m
, ".o", 
tmp§c
);

47 
fd
 = 
	`›í
(
tmp§c
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

48 i‡(
fd
 < 0)

49 
	`îr
(1, "Cª©ögÅemp‹¨y fûê%s", 
tmp§c
);

51 
c⁄ã¡s
 = 
	`èl_fmt
(
tmp§c
, "#include <ccan/%s/%s.h>\n",

52 
m
->
mod«me
, m->
ba£«me
);

53 i‡(
	`wrôe
(
fd
, 
c⁄ã¡s
, 
	`°æí
(contents)) != strlen(contents))

54 
	`îr
(1, "wrôögÅÿãmp‹¨y fûê%s", 
tmp§c
);

55 
	`˛o£
(
fd
);

57 i‡(
	`compûe_obje˘
(
sc‹e
, 
tmp§c
, 
cˇn_dú
, 
compûî
, 
cÊags
,

58 
tmpobj
, &
cmdout
)) {

59 
sc‹e
->
∑ss
 = 
åue
;

60 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

62 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

64 
cmdout
);

66 
	}
}

68 
cˇ∆öt
 
	gmaö_hódî_compûes
 = {

69 .
key
 = "main_header_compiles",

70 .
	g«me
 = "Modules main header compiles",

71 .
	gcheck
 = 
check_ö˛udes_buûd
,

72 .
	gˇn_run
 = 
ˇn_buûd
,

73 .
	g√eds
 = "depends_exist main_header_exists"

76 
REGISTER_TEST
(
maö_hódî_compûes
);

	@ccan/tools/ccanlint/tests/main_header_exists.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/èl/èl.h
>

3 
	~<cˇn/èl/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<cˇn/°r/°r.h
>

14 
	~<cˇn/n€º/n€º.h
>

16 
	$check_has_maö_hódî
(
m™i„°
 *
m
,

17 *
timñe·
, 
sc‹e
 *score)

19 
cˇn_fûe
 *
f
;

21 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

22 i‡(
	`°r°¨ts
(
f
->
«me
, 
m
->
ba£«me
)

23 && 
	`°æí
(
f
->
«me
Ë=°æí(
m
->
ba£«me
) + 2) {

24 
sc‹e
->
∑ss
 = 
åue
;

25 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

29 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

33 
m
->
mod«me
, m->
ba£«me
);

34 
	}
}

36 
cˇ∆öt
 
	gmaö_hódî_exi°s
 = {

37 .
key
 = "main_header_exists",

38 .
	g«me
 = "Module has main header file",

39 .
	gcheck
 = 
check_has_maö_hódî
,

40 .
	g√eds
 = ""

43 
REGISTER_TEST
(
maö_hódî_exi°s
);

	@ccan/tools/ccanlint/tests/module_builds.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èke/èke.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"buûd.h
"

18 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

20 i‡(
ß„_mode
)

22  
NULL
;

23 
	}
}

25 *
	$obj_li°
(c⁄° 
m™i„°
 *
m
, 
compûe_ty≥
 
˘y≥
)

27 *
li°
 = 
	`èl_°rdup
(
m
, "");

28 
cˇn_fûe
 *
i
;

31 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
) {

32 
li°
 = 
	`èl_°rˇt
(
m
, 
	`èke
÷i°), 
i
->
compûed
[
˘y≥
]);

33 
li°
 = 
	`èl_°rˇt
(
m
, 
	`èke
(list), " ");

35  
li°
;

36 
	}
}

38 *
	$buûd_moduÀ
(
m™i„°
 *
m
,

39 
compûe_ty≥
 
˘y≥
, **
îr°r
)

41  
	`lök_obje˘s
(
m
, m->
ba£«me
, 
	`obj_li°
(m, 
˘y≥
), 
îr°r
);

42 
	}
}

44 
	$do_buûd
(
m™i„°
 *
m
,

45 *
timñe·
,

46 
sc‹e
 *score)

48 *
îr°r
;

50 i‡(
	`li°_em±y
(&
m
->
c_fûes
)) {

52 
sc‹e
->
tŸÆ
 = 0;

53 
sc‹e
->
∑ss
 = 
åue
;

57 
m
->
compûed
[
COMPILE_NORMAL
]

58 
	`buûd_moduÀ
(
m
, 
COMPILE_NORMAL
, &
îr°r
);

59 i‡(!
m
->
compûed
[
COMPILE_NORMAL
]) {

60 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
NULL
, 0, "%s", 
îr°r
);

64 
sc‹e
->
∑ss
 = 
åue
;

65 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

66 
	}
}

68 
cˇ∆öt
 
	gmoduÀ_buûds
 = {

69 .
key
 = "module_builds",

70 .
	g«me
 = "Module can be built from object files",

71 .
	gcompuls‹y
 = 
åue
,

72 .
	gcheck
 = 
do_buûd
,

73 .
	gˇn_run
 = 
ˇn_buûd
,

74 .
	g√eds
 = "objects_build"

77 
REGISTER_TEST
(
moduÀ_buûds
);

	@ccan/tools/ccanlint/tests/module_links.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èke/èke.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

17 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

19 i‡(
ß„_mode
)

21  
NULL
;

22 
	}
}

24 *
	$obj_li°
(c⁄° 
m™i„°
 *
m
)

26 *
li°
;

27 
m™i„°
 *
i
;

29 i‡(
m
->
compûed
[
COMPILE_NORMAL
])

30 
li°
 = 
	`èl_°rdup
(
m
, m->
compûed
[
COMPILE_NORMAL
]);

32 
li°
 = 
	`èl_°rdup
(
m
, "");

35 
	`li°_f‹_óch
(&
m
->
dïs
, 
i
, 
li°
) {

36 i‡(!
i
->
compûed
[
COMPILE_NORMAL
])

38 
li°
 = 
	`èl_°rˇt
(
m
, 
	`èke
(list), " ");

39 
li°
 = 
	`èl_°rˇt
(
m
, 
	`èke
÷i°), 
i
->
compûed
[
COMPILE_NORMAL
]);

41  
li°
;

42 
	}
}

44 *
	$lib_li°
(c⁄° 
m™i„°
 *
m
)

46 
i
;

47 **
libs
;

48 *
ªt
 = 
	`èl_°rdup
(
m
, "");

50 
libs
 = 
	`gë_libs
(
m
, m->
dú
, "dïíds", 
gë_‹_compûe_öfo
);

51 
i
 = 0; 
libs
[i]; i++)

52 
	`èl_≠≥nd_fmt
(&
ªt
, "-l%†", 
libs
[
i
]);

53  
ªt
;

54 
	}
}

56 
	$check_u£_buûd
(
m™i„°
 *
m
,

57 *
timñe·
, 
sc‹e
 *score)

59 *
c⁄ã¡s
;

60 *
tmpfûe
, *
cmdout
;

61 
fd
;

63 
tmpfûe
 = 
	`ãmp_fûe
(
m
, ".c", "example.c");

65 
fd
 = 
	`›í
(
tmpfûe
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

66 i‡(
fd
 < 0)

67 
	`îr
(1, "Cª©ögÅemp‹¨y fûê%s", 
tmpfûe
);

69 
c⁄ã¡s
 = 
	`èl_fmt
(
tmpfûe
,

75 
m
->
mod«me
, m->
ba£«me
);

76 i‡(
	`wrôe
(
fd
, 
c⁄ã¡s
, 
	`°æí
(contents)) != strlen(contents))

77 
	`îr
(1, "Faûuª wrôögÅÿãmp‹¨y fûê%s", 
tmpfûe
);

78 
	`˛o£
(
fd
);

80 i‡(
	`compûe_™d_lök
(
sc‹e
, 
tmpfûe
, 
cˇn_dú
, 
	`obj_li°
(
m
),

81 
compûî
, 
cÊags
, 
	`lib_li°
(
m
),

82 
	`ãmp_fûe
(
m
, "", 
tmpfûe
),

83 &
cmdout
)) {

84 
sc‹e
->
∑ss
 = 
åue
;

85 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

87 
sc‹e
->
îr‹
 = 
cmdout
;

89 
	}
}

91 
cˇ∆öt
 
	gmoduÀ_löks
 = {

92 .
key
 = "module_links",

93 .
	g«me
 = "Module can beÜinkedágainstÅrivialÖrogram",

94 .
	gcheck
 = 
check_u£_buûd
,

95 .
	gˇn_run
 = 
ˇn_buûd
,

96 .
	g√eds
 = "module_builds depends_build"

99 
REGISTER_TEST
(
moduÀ_löks
);

	@ccan/tools/ccanlint/tests/no_trailing_whitespace.c

2 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

3 
	~<cˇn/f‹óch/f‹óch.h
>

4 
	~<cˇn/°r/°r.h
>

5 
	~<cˇn/èl/°r/°r.h
>

8 *
	$gë_åaûög_whôe•a˚
(c⁄° 
èl_t
 *
˘x
, c⁄° *
löe
)

10 c⁄° *
e
 = 
	`°rchr
(
löe
, 0);

11 
e
>
löe
 && (e[-1]==' ' ||É[-1]=='\t'))

12 
e
--;

13 i‡(*
e
 == 0)

14  
NULL
;

15 i‡(
e
 =
löe
)

16  
NULL
;

18 i‡(
	`°æí
(
löe
) > 20)

19  
	`èl_fmt
(
˘x
, "...'%s'", 
löe
 + 
	`°æí
(line) - 20);

20  
	`èl_fmt
(
˘x
, "'%s'", 
löe
);

21 
	}
}

23 
	$check_åaûög_whôe•a˚
(
m™i„°
 *
m
,

24 *
timñe·
,

25 
sc‹e
 *score)

27 
li°_hód
 *
li°
;

28 
cˇn_fûe
 *
f
;

29 
i
;

32 
sc‹e
->
∑ss
 = 
åue
;

34 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
) {

35 
	`li°_f‹_óch
(
li°
, 
f
,Üist) {

36 **
löes
 = 
	`gë_cˇn_fûe_löes
(
f
);

37 
i
 = 0; 
f
->
löes
[i]; i++) {

38 *
îr
 = 
	`gë_åaûög_whôe•a˚
(
sc‹e
,

39 
löes
[
i
]);

40 i‡(
îr
)

41 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
f
, 
i
+1,

42 "%s", 
îr
);

46 i‡(!
sc‹e
->
îr‹
) {

47 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

49 
	}
}

51 
cˇ∆öt
 
	gno_åaûög_whôe•a˚
 = {

52 .
key
 = "no_trailing_whitespace",

53 .
	g«me
 = "Module's source code hasÇoÅrailing whitespace",

54 .
	gcheck
 = 
check_åaûög_whôe•a˚
,

55 .
	g√eds
 = "info_exists"

59 
REGISTER_TEST
(
no_åaûög_whôe•a˚
);

	@ccan/tools/ccanlint/tests/objects_build.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èl/∑th/∑th.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"buûd.h
"

18 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

20 i‡(
ß„_mode
)

22  
NULL
;

23 
	}
}

25 
	$buûd_obje˘s
(
m™i„°
 *
m
,

26 
sc‹e
 *sc‹e, c⁄° *
Êags
,

27 
compûe_ty≥
 
˘y≥
)

29 
cˇn_fûe
 *
i
;

30 
boﬁ
 
îr‹s
 = 
Ál£
, 
w¨nögs
 = false;

32 i‡(
	`li°_em±y
(&
m
->
c_fûes
))

33 
sc‹e
->
tŸÆ
 = 0;

35 
sc‹e
->
tŸÆ
 = 2;

37 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
) {

38 *
ouçut
;

39 *
fuŒfûe
 = 
	`∑th_joö
(
m
, m->
dú
, 
i
->
«me
);

41 
i
->
compûed
[
˘y≥
] = 
	`ãmp_fûe
(
m
, "", 
fuŒfûe
);

42 i‡(!
	`compûe_obje˘
(
sc‹e
, 
fuŒfûe
, 
cˇn_dú
, 
compûî
, 
Êags
,

43 
i
->
compûed
[
˘y≥
], &
ouçut
)) {

44 
	`èl_‰ì
(
i
->
compûed
[
˘y≥
]);

45 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

47 
ouçut
);

48 
îr‹s
 = 
åue
;

49 } i‡(!
	`°ªq
(
ouçut
, "")) {

50 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

53 
ouçut
);

54 
w¨nögs
 = 
åue
;

58 i‡(!
îr‹s
) {

59 
sc‹e
->
∑ss
 = 
åue
;

60 
sc‹e
->sc‹êsc‹e->
tŸÆ
 - 
w¨nögs
;

62 
buûd_Áûed
 = 
åue
;

63 
	}
}

65 
	$check_objs_buûd
(
m™i„°
 *
m
,

66 *
timñe·
, 
sc‹e
 *score)

68 
	`buûd_obje˘s
(
m
, 
sc‹e
, 
cÊags
, 
COMPILE_NORMAL
);

69 
	}
}

71 
cˇ∆öt
 
	gobje˘s_buûd
 = {

72 .
key
 = "objects_build",

73 .
	g«me
 = "Module object files can be built",

74 .
	gcompuls‹y
 = 
åue
,

75 .
	gcheck
 = 
check_objs_buûd
,

76 .
	gˇn_run
 = 
ˇn_buûd
,

77 .
	g√eds
 = "depends_exist"

80 
REGISTER_TEST
(
obje˘s_buûd
);

	@ccan/tools/ccanlint/tests/objects_build_with_stringchecks.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"ªdu˚_„©uªs.h
"

18 c⁄° *
	$u£s_°rögfuncs
(
m™i„°
 *
m
)

20 
li°_hód
 *
li°
;

22 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
) {

23 
cˇn_fûe
 *
i
;

24 *
m©ch
;

26 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

27 i‡(
	`èl_°ºeg
(
m
, 
	`gë_cˇn_fûe_c⁄ã¡s
(
i
),

31 "|°r°r|°rchr|°ºchr)", &
m©ch
)) {

32 i‡(
vîbo£
 > 2)

33 
	`¥ötf
("Matched '%s' in %s\n",

34 
m©ch
, 
i
->
fuŒ«me
);

35  
NULL
;

40 
	}
}

42 
	$wrôe_°r
(
fd
, c⁄° *
°r
)

44 i‡(
	`wrôe
(
fd
, 
°r
, 
	`°æí
(str)) != strlen(str))

45 
	`îr
(1, "WritingÅoÅemporary file");

46 
	}
}

48 
	$°¨t_fûe
(c⁄° *
fûíame
)

50 
fd
;

51 
fd
 = 
	`›í
(
fûíame
, 
O_WRONLY
|
O_CREAT
, 0600);

52 
	`wrôe_°r
(
fd
, "#define CCAN_STR_DEBUG 1\n#include <ccan/str/str.h>\n");

53  
fd
;

54 
	}
}

56 
	$ã°_compûe
(
sc‹e
 *score,

57 
cˇn_fûe
 *
fûe
,

58 c⁄° *
fûíame
,

59 c⁄° *
Êags
,

60 
boﬁ
 *
îr‹s
,

61 
boﬁ
 *
w¨nögs
)

63 *
ouçut
, *
compûed
;

65 
compûed
 = 
	`ãmp_fûe
(
sc‹e
, "", 
fûíame
);

66 i‡(!
	`compûe_obje˘
(
sc‹e
, 
fûíame
, 
cˇn_dú
, 
compûî
, 
Êags
,

67 
compûed
, &
ouçut
)) {

68 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
fûe
, 0,

70 
ouçut
);

71 *
îr‹s
 = 
åue
;

72 } i‡(!
	`°ªq
(
ouçut
, "")) {

73 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
fûe
, 0,

75 
ouçut
);

76 *
w¨nögs
 = 
åue
;

78 
	}
}

80 
cˇn_fûe
 *
	$gë_maö_hódî
(
m™i„°
 *
m
)

82 
cˇn_fûe
 *
f
;

84 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
f
, 
li°
) {

85 i‡(
	`°r°¨ts
(
f
->
«me
, 
m
->
ba£«me
)

86 && 
	`°æí
(
f
->
«me
Ë=°æí(
m
->
ba£«me
) + 2) {

87  
f
;

91 
	`îrx
(1, "No main header?");

92 
	}
}

94 
	$buûd_obje˘s_wôh_°rögchecks
(
m™i„°
 *
m
,

95 *
timñe·
,

96 
sc‹e
 *score)

98 
cˇn_fûe
 *
i
;

99 
boﬁ
 
îr‹s
 = 
Ál£
, 
w¨nögs
 = false;

100 *
tmp
, *
Êags
;

101 
tmpfd
;

104 
Êags
 = 
	`èl_fmt
(
sc‹e
, "-I%†%s", 
m
->
dú
, 
cÊags
);

107 i‡(
	`li°_em±y
(&
m
->
c_fûes
)) {

108 *
löe
;

109 
i
 = 
	`gë_maö_hódî
(
m
);

110 
tmp
 = 
	`ãmp_fûe
(
sc‹e
, ".c", 
i
->
fuŒ«me
);

111 
tmpfd
 = 
	`°¨t_fûe
(
tmp
);

112 
löe
 = 
	`èl_fmt
(
sc‹e
, "#include <ccan/%s/%s.h>\n",

113 
m
->
mod«me
, m->
ba£«me
);

114 
	`wrôe_°r
(
tmpfd
, 
löe
);

115 
	`˛o£
(
tmpfd
);

116 
	`ã°_compûe
(
sc‹e
, 
i
, 
tmp
, 
Êags
, &
îr‹s
, &
w¨nögs
);

118 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
) {

119 
tmp
 = 
	`ãmp_fûe
(
sc‹e
, ".c", 
i
->
fuŒ«me
);

120 
tmpfd
 = 
	`°¨t_fûe
(
tmp
);

121 
	`wrôe_°r
(
tmpfd
, 
	`gë_cˇn_fûe_c⁄ã¡s
(
i
));

122 
	`˛o£
(
tmpfd
);

123 
	`ã°_compûe
(
sc‹e
, 
i
, 
tmp
, 
Êags
, &
îr‹s
, &
w¨nögs
);

128 
sc‹e
->
∑ss
 = 
åue
;

130 
sc‹e
->
tŸÆ
 = 1;

131 i‡(!
îr‹s
) {

132 
sc‹e
->sc‹ê!
w¨nögs
;

134 
	}
}

136 
cˇ∆öt
 
	gobje˘s_buûd_wôh_°rögchecks
 = {

137 .
key
 = "objects_build_with_stringchecks",

138 .
	g«me
 = "Module compiles withÉxtra ctype.hánd str function checks",

139 .
	gcheck
 = 
buûd_obje˘s_wôh_°rögchecks
,

140 .
	gˇn_run
 = 
u£s_°rögfuncs
,

141 .
	g√eds
 = "objects_build main_header_exists"

143 
REGISTER_TEST
(
obje˘s_buûd_wôh_°rögchecks
);

	@ccan/tools/ccanlint/tests/objects_build_without_features.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/èl/°r/°r.h
>

3 
	~"ªdu˚_„©uªs.h
"

4 
	~"buûd.h
"

6 
	$check_objs_buûd_wôhout_„©uªs
(
m™i„°
 *
m
,

7 *
timñe·
,

8 
sc‹e
 *score)

10 c⁄° *
Êags
 = 
	`èl_fmt
(
sc‹e
, "%s %s",

11 
REDUCE_FEATURES_FLAGS
, 
cÊags
);

12 
	`buûd_obje˘s
(
m
, 
sc‹e
, 
Êags
, 
COMPILE_NOFEAT
);

13 
	}
}

15 
cˇ∆öt
 
	gobje˘s_buûd_wôhout_„©uªs
 = {

16 .
key
 = "objects_build_without_features",

17 .
	g«me
 = "Module object files can be built (without features)",

18 .
	gcheck
 = 
check_objs_buûd_wôhout_„©uªs
,

19 .
	g√eds
 = "reduce_features objects_build"

21 
REGISTER_TEST
(
obje˘s_buûd_wôhout_„©uªs
);

	@ccan/tools/ccanlint/tests/reduce_features.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<cˇn/°r/°r.h
>

6 
	~<cˇn/hash/hash.h
>

7 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

8 
	~<î∫o.h
>

9 
	~<îr.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/°©.h
>

12 
	~<f˙é.h
>

13 
	~<uni°d.h
>

14 
	~"ªdu˚_„©uªs.h
"

16 
boﬁ
 
	g„©uªs_wîe_ªdu˚d
;

18 c⁄° *
	$ˇn_run
(
m™i„°
 *
m
)

20 i‡(!
c⁄fig_hódî
)

21  
	`èl_°rdup
(
m
, "CouldÇotÑead config.h");

22  
NULL
;

23 
	}
}

25 
size_t
 
	$›ti⁄_hash
(c⁄° *
«me
)

27  
	`hash
(
«me
, 
	`°æí
(name), 0);

28 
	}
}

30 c⁄° *
	$›ti⁄_«me
(c⁄° *
«me
)

32  
«me
;

33 
	}
}

35 
boﬁ
 
	$›ti⁄_cmp
(c⁄° *
«me1
, c⁄° *
«me2
)

37  
	`°ªq
(
«me1
, 
«me2
);

38 
	}
}

40 
HTABLE_DEFINE_TYPE
(, 
›ti⁄_«me
, 
›ti⁄_hash
, 
›ti⁄_cmp
, 
hèbÀ_›ti⁄
);

42 
hèbÀ_›ti⁄
 *
	$hèbÀ_›ti⁄_√w
()

44 
hèbÀ_›ti⁄
 *
›ts
 = 
	`mÆloc
((*opts));

45 
	`hèbÀ_›ti⁄_öô
(
›ts
);

46  
›ts
;

47 
	}
}

49 
	$hèbÀ_›ti⁄_‰ì
(
hèbÀ_›ti⁄
 *
›ts
)

51 
	`hèbÀ_›ti⁄_˛ór
(
›ts
);

52 
	`‰ì
(
›ts
);

53 
	}
}

55 
	$add_›ti⁄s
(
hèbÀ_›ti⁄
 *
›ts
,

56 
µ_c⁄dôi⁄s
 *
c⁄d
)

58 
num
 = 0;

59 i‡(
c⁄d
->
∑ª¡
)

60 
num
 +
	`add_›ti⁄s
(
›ts
, 
c⁄d
->
∑ª¡
);

61 i‡(
c⁄d
->
ty≥
 =
PP_COND_IF
 || c⁄d->ty≥ =
PP_COND_IFDEF
) {

62 i‡(
	`°r°¨ts
(
c⁄d
->
symbﬁ
, "HAVE_")) {

63 i‡(!
	`hèbÀ_›ti⁄_gë
(
›ts
, 
c⁄d
->
symbﬁ
)) {

64 
	`hèbÀ_›ti⁄_add
(
›ts
, 
c⁄d
->
symbﬁ
);

65 
num
++;

69  
num
;

70 
	}
}

72 
hèbÀ_›ti⁄
 *
	$gë_u£d_›ti⁄s
(
m™i„°
 *
m
)

74 
li°_hód
 *
li°
;

75 
cˇn_fûe
 *
f
;

76 
i
, 
num
;

77 
hèbÀ_›ti⁄
 *
›ts
 = 
	`hèbÀ_›ti⁄_√w
();

78 
löe_öfo
 *
öfo
;

80 
num
 = 0;

81 
	`f‹óch_±r
(
li°
, &
m
->
c_fûes
, &m->
h_fûes
) {

82 
	`li°_f‹_óch
(
li°
, 
f
,Üist) {

83 
öfo
 = 
	`gë_cˇn_löe_öfo
(
f
);

84 
µ_c⁄dôi⁄s
 *
¥ev
 = 
NULL
;

86 
i
 = 0; 
f
->
löes
[i]; i++) {

87 i‡(
öfo
[
i
].
c⁄d
 && info[i].c⁄d !
¥ev
) {

88 
num
 +
	`add_›ti⁄s
(
›ts
, 
öfo
[
i
].
c⁄d
);

89 
¥ev
 = 
öfo
[
i
].
c⁄d
;

95 i‡(!
num
) {

96 
	`hèbÀ_›ti⁄_‰ì
(
›ts
);

97 
›ts
 = 
NULL
;

99  
›ts
;

100 
	}
}

102 
hèbÀ_›ti⁄
 *
	$gë_c⁄fig_›ti⁄s
(
m™i„°
 *
m
)

104 c⁄° **
löes
 = (c⁄° **)
	`èl_°r•lô
(
m
, 
c⁄fig_hódî
, "\n",

105 
STR_EMPTY_OK
);

106 
i
;

107 
hèbÀ_›ti⁄
 *
›ts
 = 
	`hèbÀ_›ti⁄_√w
();

109 
i
 = 0; i < 
	`èl_cou¡
(
löes
) - 1; i++) {

110 *
sym
;

112 i‡(!
	`gë_tokí
(&
löes
[
i
], "#"))

114 i‡(!
	`gë_tokí
(&
löes
[
i
], "define"))

116 
sym
 = 
	`gë_symbﬁ_tokí
(
löes
, &löes[
i
]);

117 i‡(!
	`°r°¨ts
(
sym
, "HAVE_"))

120 i‡(
	`°ªnds
(
sym
, "_ENDIAN"))

123 i‡(
	`°ªq
(
sym
, "HAVE_STRUCT_TIMESPEC"))

125 i‡(!
	`gë_tokí
(&
löes
[
i
], "1"))

127 
	`hèbÀ_›ti⁄_add
(
›ts
, 
sym
);

129  
›ts
;

130 
	}
}

132 
	$do_ªdu˚_„©uªs
(
m™i„°
 *
m
,

133 *
timñe·
, 
sc‹e
 *score)

135 
hèbÀ_›ti⁄
 *
›ti⁄s_u£d
, *
›ti⁄s_avaû
, *
›ti⁄s
;

136 
hèbÀ_›ti⁄_ôî
 
i
;

137 
fd
;

138 c⁄° *
sym
;

139 *
hdr
;

142 
sc‹e
->
tŸÆ
 = 0;

143 
sc‹e
->
∑ss
 = 
åue
;

145 
›ti⁄s_u£d
 = 
	`gë_u£d_›ti⁄s
(
m
);

146 i‡(!
›ti⁄s_u£d
) {

149 
›ti⁄s_avaû
 = 
	`gë_c⁄fig_›ti⁄s
(
m
);

151 
›ti⁄s
 = 
NULL
;

152 
sym
 = 
	`hèbÀ_›ti⁄_fú°
(
›ti⁄s_u£d
, &
i
);

153 
sym
;

154 
sym
 = 
	`hèbÀ_›ti⁄_√xt
(
›ti⁄s_u£d
, &
i
)) {

155 i‡(
	`hèbÀ_›ti⁄_gë
(
›ti⁄s_avaû
, 
sym
)) {

156 i‡(!
›ti⁄s
)

157 
›ti⁄s
 = 
	`hèbÀ_›ti⁄_√w
();

158 
	`hèbÀ_›ti⁄_add
(
›ti⁄s
, 
sym
);

161 
	`hèbÀ_›ti⁄_‰ì
(
›ti⁄s_avaû
);

162 
	`hèbÀ_›ti⁄_‰ì
(
›ti⁄s_u£d
);

164 i‡(!
›ti⁄s
)

168 
hdr
 = 
	`èl_°rˇt
(
m
, "/* Modified byÑeduce_features */\n",

169 
c⁄fig_hódî
);

170 
sym
 = 
	`hèbÀ_›ti⁄_fú°
(
›ti⁄s
, &
i
);

171 
sym
;

172 
sym
 = 
	`hèbÀ_›ti⁄_√xt
(
›ti⁄s
, &
i
)) {

173 
	`èl_≠≥nd_fmt
(&
hdr
, "#unde‡%s\n#deföê%†0\n", 
sym
, sym);

175 i‡(
	`mkdú
("ªdu˚d-„©uªs", 0700Ë!0 && 
î∫o
 !
EEXIST
)

176 
	`îr
(1, "CreatingÑeduced-features directory");

178 
fd
 = 
	`›í
("ªdu˚d-„©uªs/c⁄fig.h", 
O_TRUNC
|
O_CREAT
|
O_RDWR
, 0600);

179 i‡(
fd
 < 0)

180 
	`îr
(1, "CreatingÑeduced-features/config.h");

181 i‡(!
	`wrôe_Æl
(
fd
, 
hdr
, 
	`°æí
(hdr)))

182 
	`îr
(1, "WritingÑeduced-features/config.h");

183 
	`˛o£
(
fd
);

184 
„©uªs_wîe_ªdu˚d
 = 
åue
;

185 
	}
}

187 
cˇ∆öt
 
	gªdu˚_„©uªs
 = {

188 .
key
 = "reduce_features",

189 .
	g«me
 = "Produce config.h withÑeduced features",

190 .
	gˇn_run
 = 
ˇn_run
,

191 .
	gcheck
 = 
do_ªdu˚_„©uªs
,

194 .
	g√eds
 = "tests_compile"

196 
REGISTER_TEST
(
ªdu˚_„©uªs
);

	@ccan/tools/ccanlint/tests/reduce_features.h

1 #i‚de‡
CCANLINT_REDUCE_FEATURES_H


2 
	#CCANLINT_REDUCE_FEATURES_H


	)

3 
boﬁ
 
„©uªs_wîe_ªdu˚d
;

5 
	#REDUCE_FEATURES_FLAGS
 "-Iªdu˚d-„©uªs"

	)

	@ccan/tools/ccanlint/tests/tests_compile.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"ªdu˚_„©uªs.h
"

17 
	~"ã°s_compûe.h
"

19 c⁄° *
	$ˇn_buûd
(
m™i„°
 *
m
)

21 i‡(
ß„_mode
)

23  
NULL
;

24 
	}
}

26 *
	$ã°_obj_li°
(c⁄° 
m™i„°
 *
m
, 
boﬁ
 
lök_wôh_moduÀ
,

27 
compûe_ty≥
 
˘y≥
, compûe_ty≥ 
own_˘y≥
)

29 *
li°
 = 
	`èl_°rdup
(
m
, "");

30 
cˇn_fûe
 *
i
;

31 
m™i„°
 *
subm
;

34 
	`li°_f‹_óch
(&
m
->
Ÿhî_ã°_c_fûes
, 
i
, 
li°
)

35 
	`èl_≠≥nd_fmt
(&
li°
, " %s", 
i
->
compûed
[
˘y≥
]);

38 i‡(
lök_wôh_moduÀ
)

39 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
)

40 
	`èl_≠≥nd_fmt
(&
li°
, " %s", 
i
->
compûed
[
own_˘y≥
]);

43 
	`li°_f‹_óch
(&
m
->
dïs
, 
subm
, 
li°
) {

44 i‡(
subm
->
compûed
[
˘y≥
])

45 
	`èl_≠≥nd_fmt
(&
li°
, " %s", 
subm
->
compûed
[
˘y≥
]);

49 
	`li°_f‹_óch
(&
m
->
ã°_dïs
, 
subm
, 
li°
) {

50 i‡(
subm
->
compûed
[
˘y≥
])

51 
	`èl_≠≥nd_fmt
(&
li°
, " %s", 
subm
->
compûed
[
˘y≥
]);

54  
li°
;

55 
	}
}

57 *
	$ã°_lib_li°
(c⁄° 
m™i„°
 *
m
, 
compûe_ty≥
 
˘y≥
)

59 
i
;

60 **
libs
;

61 *
ªt
 = 
	`èl_°rdup
(
m
, "");

63 
libs
 = 
	`gë_libs
(
m
, m->
dú
, "ã°dïíds", 
gë_‹_compûe_öfo
);

64 
i
 = 0; 
libs
[i]; i++)

65 
	`èl_≠≥nd_fmt
(&
ªt
, "-l%†", 
libs
[
i
]);

66  
ªt
;

67 
	}
}

69 
boﬁ
 
	$compûe
(c⁄° *
˘x
,

70 
m™i„°
 *
m
,

71 
cˇn_fûe
 *
fûe
,

72 
boﬁ
 
Áû
,

73 
boﬁ
 
lök_wôh_moduÀ
,

74 
compûe_ty≥
 
˘y≥
,

75 **
ouçut
)

77 *
‚ame
, *
Êags
;

79 
Êags
 = 
	`èl_fmt
(
˘x
, "%s%s%s",

80 
Áû
 ? "-DFAIL " : "",

81 
cÊags
,

82 
˘y≥
 =
COMPILE_NOFEAT


83 ? " "
REDUCE_FEATURES_FLAGS
 : "");

85 
‚ame
 = 
	`ãmp_fûe
(
˘x
, "", 
fûe
->
fuŒ«me
);

86 i‡(!
	`compûe_™d_lök
(
˘x
, 
fûe
->
fuŒ«me
, 
cˇn_dú
,

87 
	`ã°_obj_li°
(
m
, 
lök_wôh_moduÀ
,

88 
˘y≥
, ctype),

89 
compûî
, 
Êags
, 
	`ã°_lib_li°
(
m
, 
˘y≥
), 
‚ame
,

90 
ouçut
)) {

91 
	`èl_‰ì
(
‚ame
);

92  
Ál£
;

95 
fûe
->
compûed
[
˘y≥
] = 
‚ame
;

96  
åue
;

97 
	}
}

99 
	$compûe_async
(c⁄° *
˘x
,

100 
m™i„°
 *
m
,

101 
cˇn_fûe
 *
fûe
,

102 
boﬁ
 
lök_wôh_moduÀ
,

103 
compûe_ty≥
 
˘y≥
,

104 
time_ms
)

106 *
Êags
;

108 
fûe
->
compûed
[
˘y≥
] = 
	`ãmp_fûe
(
˘x
, "", fûe->
fuŒ«me
);

109 
Êags
 = 
	`èl_fmt
(
˘x
, "%s%s",

110 
cÊags
,

111 
˘y≥
 =
COMPILE_NOFEAT


112 ? " "
REDUCE_FEATURES_FLAGS
 : "");

114 
	`compûe_™d_lök_async
(
fûe
, 
time_ms
, fûe->
fuŒ«me
, 
cˇn_dú
,

115 
	`ã°_obj_li°
(
m
, 
lök_wôh_moduÀ
, 
˘y≥
, ctype),

116 
compûî
, 
Êags
, 
	`ã°_lib_li°
(
m
, 
˘y≥
),

117 
fûe
->
compûed
[
˘y≥
]);

118 
	}
}

120 
	$compûe_ã°s
(
m™i„°
 *
m
,

121 
sc‹e
 *score,

122 
compûe_ty≥
 
˘y≥
,

123 
time_ms
)

125 *
cmdout
;

126 
cˇn_fûe
 *
i
;

127 
li°_hód
 *
li°
;

128 
boﬁ
 
îr‹s
 = 
Ál£
, 
w¨nögs
 = fÆ£, 
ok
;

130 
	`f‹óch_±r
(
li°
, &
m
->
compûe_ok_ã°s
, &m->
run_ã°s
, &m->
≠i_ã°s
) {

131 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

132 
	`compûe_async
(
sc‹e
, 
m
, 
i
,

133 
li°
 =&
m
->
≠i_ã°s
,

134 
˘y≥
, 
time_ms
);

138 (
i
 = 
	`cﬁÀ˘_comm™d
(&
ok
, &
cmdout
)Ë!
NULL
) {

139 i‡(!
ok
) {

140 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

142 
cmdout
);

143 
îr‹s
 = 
åue
;

144 } i‡(!
	`°ªq
(
cmdout
, "")) {

145 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

147 
cmdout
);

148 
w¨nögs
 = 
åue
;

153 i‡(
îr‹s
)

157 
	`li°_f‹_óch
(&
m
->
compûe_Áû_ã°s
, 
i
, 
li°
) {

158 i‡(!
	`compûe
(
sc‹e
, 
m
, 
i
, 
Ál£
, fÆ£, 
˘y≥
, &
cmdout
)) {

159 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

161 
cmdout
);

164 i‡(!
	`°ªq
(
cmdout
, "")) {

165 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

168 
cmdout
);

171 i‡(
	`compûe
(
sc‹e
, 
m
, 
i
, 
åue
, 
Ál£
, 
˘y≥
, &
cmdout
)

172 && 
	`°ªq
(
cmdout
, "")) {

173 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

177 
sc‹e
->
tŸÆ
++;

180 
sc‹e
->
∑ss
 = 
åue
;

181 
sc‹e
->sc‹êsc‹e->
tŸÆ
 - 
w¨nögs
;

182 
	}
}

185 
	$do_compûe_ã°s
(
m™i„°
 *
m
,

186 *
timñe·
, 
sc‹e
 *score)

188 
	`compûe_ã°s
(
m
, 
sc‹e
, 
COMPILE_NORMAL
, *
timñe·
);

189 
	}
}

191 
cˇ∆öt
 
	gã°s_compûe
 = {

192 .
key
 = "tests_compile",

193 .
	g«me
 = "ModuleÅests compile",

194 .
	gcheck
 = 
do_compûe_ã°s
,

195 .
	gˇn_run
 = 
ˇn_buûd
,

196 .
	g√eds
 = "tests_helpers_compile objects_build"

199 
REGISTER_TEST
(
ã°s_compûe
);

201 c⁄° *
	$„©uªs_ªdu˚d
(
m™i„°
 *
m
)

203 i‡(
„©uªs_wîe_ªdu˚d
)

204  
NULL
;

206 
	}
}

208 
	$do_compûe_ã°s_wôhout_„©uªs
(
m™i„°
 *
m
,

209 *
timñe·
,

210 
sc‹e
 *score)

212 
	`compûe_ã°s
(
m
, 
sc‹e
, 
COMPILE_NOFEAT
, *
timñe·
);

213 
	}
}

215 
cˇ∆öt
 
	gã°s_compûe_wôhout_„©uªs
 = {

216 .
key
 = "tests_compile_without_features",

217 .
	g«me
 = "ModuleÅests compile (without features)",

218 .
	gcheck
 = 
do_compûe_ã°s_wôhout_„©uªs
,

219 .
	gˇn_run
 = 
„©uªs_ªdu˚d
,

220 .
	g√eds
 = "module_buildsÅests_helpers_compile_without_features objects_build_without_features"

222 
REGISTER_TEST
(
ã°s_compûe_wôhout_„©uªs
);

	@ccan/tools/ccanlint/tests/tests_compile.h

3 *
ã°_obj_li°
(c⁄° 
m™i„°
 *
m
, 
boﬁ
 
lök_wôh_moduÀ
,

4 
compûe_ty≥
 
˘y≥
, compûe_ty≥ 
own_˘y≥
);

6 *
ã°_lib_li°
(c⁄° 
m™i„°
 *
m
, 
compûe_ty≥
 
˘y≥
);

	@ccan/tools/ccanlint/tests/tests_compile_coverage.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

16 
	~"buûd.h
"

17 
	~"ã°s_compûe.h
"

20 c⁄° *
	$ˇn_run_covîage
(
m™i„°
 *
m
)

22 #ifde‡
__GNUC__


23 
timñe·
 = 
deÁu…_timeout_ms
;

24 *
ouçut
;

26 i‡(!
	`run_comm™d
(
m
, &
timñe·
, &
ouçut
, "gcov -h"))

27  
	`èl_fmt
(
m
, "Nÿgcov suµ‹t: %s", 
ouçut
);

28  
NULL
;

32 
	}
}

34 
	$cov_compûe
(c⁄° *
˘x
,

35 
time_ms
,

36 
m™i„°
 *
m
,

37 
cˇn_fûe
 *
fûe
,

38 
boﬁ
 
lök_wôh_moduÀ
)

40 *
Êags
 = 
	`èl_fmt
(
˘x
, "%†%s", 
cÊags
, 
COVERAGE_CFLAGS
);

42 
fûe
->
compûed
[
COMPILE_COVERAGE
] = 
	`ãmp_fûe
(
˘x
, "", fûe->
fuŒ«me
);

43 
	`compûe_™d_lök_async
(
fûe
, 
time_ms
, fûe->
fuŒ«me
, 
cˇn_dú
,

44 
	`ã°_obj_li°
(
m
, 
lök_wôh_moduÀ
,

45 
COMPILE_NORMAL
,

46 
COMPILE_COVERAGE
),

47 
compûî
, 
Êags
,

48 
	`ã°_lib_li°
(
m
, 
COMPILE_NORMAL
),

49 
fûe
->
compûed
[
COMPILE_COVERAGE
]);

50 
	}
}

53 
	$do_compûe_covîage_ã°s
(
m™i„°
 *
m
,

54 *
timñe·
,

55 
sc‹e
 *score)

57 *
cmdout
;

58 
cˇn_fûe
 *
i
;

59 
li°_hód
 *
h
;

60 
boﬁ
 
ok
;

61 *
f
 = 
	`èl_fmt
(
sc‹e
, "%†%s", 
cÊags
, 
COVERAGE_CFLAGS
);

64 i‡(!
	`li°_em±y
(&
m
->
≠i_ã°s
)) {

65 
	`buûd_obje˘s
(
m
, 
sc‹e
, 
f
, 
COMPILE_COVERAGE
);

66 i‡(!
sc‹e
->
∑ss
) {

67 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score,

73 
	`f‹óch_±r
(
h
, &
m
->
run_ã°s
, &m->
≠i_ã°s
) {

74 
	`li°_f‹_óch
(
h
, 
i
, 
li°
) {

75 
	`cov_compûe
(
m
, *
timñe·
, m, 
i
, 
h
 =&m->
≠i_ã°s
);

79 (
i
 = 
	`cﬁÀ˘_comm™d
(&
ok
, &
cmdout
)Ë!
NULL
) {

80 i‡(!
ok
) {

81 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

83 " %s", 
cmdout
);

86 i‡(!
sc‹e
->
îr‹
) {

87 
sc‹e
->
∑ss
 = 
åue
;

88 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

90 
	}
}

92 
cˇ∆öt
 
	gã°s_compûe_covîage
 = {

93 .
key
 = "tests_compile_coverage",

94 .
	g«me
 = "ModuÀÅe°†compûêwôh " 
COVERAGE_CFLAGS
,

95 .
	gcheck
 = 
do_compûe_covîage_ã°s
,

96 .
	gˇn_run
 = 
ˇn_run_covîage
,

97 .
	g√eds
 = "tests_compile"

100 
REGISTER_TEST
(
ã°s_compûe_covîage
);

	@ccan/tools/ccanlint/tests/tests_coverage.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èl/∑th/∑th.h
>

5 
	~<cˇn/f‹óch/f‹óch.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<uni°d.h
>

10 
	~<limôs.h
>

11 
	~<î∫o.h
>

12 
	~<°dlib.h
>

13 
	~<°dio.h
>

14 
	~<îr.h
>

15 
	~<°rög.h
>

16 
	~<˘y≥.h
>

18 
boﬁ
 
	$föd_sour˚_fûe
(c⁄° 
m™i„°
 *
m
, c⁄° *
fûíame
)

20 c⁄° 
cˇn_fûe
 *
i
;

22 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
) {

23 i‡(
	`°ªq
(
i
->
fuŒ«me
, 
fûíame
))

24  
åue
;

26 
	`li°_f‹_óch
(&
m
->
h_fûes
, 
i
, 
li°
) {

27 i‡(
	`°ªq
(
i
->
fuŒ«me
, 
fûíame
))

28  
åue
;

30  
Ál£
;

31 
	}
}

34 
	$sc‹e_covîage
(
covîed
, 
tŸÆ
)

36 
thªsh
, 
uncovîed
 = 1.0 - 
covîed
;

37 
i
;

39 i‡(
covîed
 == 1.0)

40  
tŸÆ
;

42 
tŸÆ
--;

43 
i
 = 0, 
thªsh
 = 0.5; i < 
tŸÆ
; i++,Åhresh /= 2) {

44 i‡(
uncovîed
 > 
thªsh
)

47  
i
;

48 
	}
}

52 
	$™Æyze_covîage
(
m™i„°
 *
m
, 
boﬁ
 
fuŒ_gcov
,

53 c⁄° *
ouçut
, 
sc‹e
 *score)

55 **
löes
 = 
	`èl_°r•lô
(
sc‹e
, 
ouçut
, "\n", 
STR_EMPTY_OK
);

56 
covîed_löes
 = 0.0;

57 
i
, 
tŸÆ_löes
 = 0;

58 
boﬁ
 
löes_m©ãr
 = 
Ál£
;

76 
i
 = 0; 
löes
[i]; i++) {

77 i‡(
	`°r°¨ts
(
löes
[
i
], "File '")) {

78 *
fûe
 = 
löes
[
i
] + 
	`°æí
("File '");

79 
fûe
[
	`°rc•n
(file, "'")] = '\0';

80 i‡(
	`föd_sour˚_fûe
(
m
, 
fûe
))

81 
löes_m©ãr
 = 
åue
;

83 
löes_m©ãr
 = 
Ál£
;

84 } i‡(
löes_m©ãr


85 && 
	`°r°¨ts
(
löes
[
i
], "LinesÉxecuted:")) {

86 
ex
;

87 
of
;

88 i‡(
	`ssˇnf
(
löes
[
i
], "LinesÉxecuted:%f%% of %u",

89 &
ex
, &
of
) != 2)

90 
	`îrx
(1, "CouldÇŸÖ¨£Üöê'%s'", 
löes
[
i
]);

91 
tŸÆ_löes
 +
of
;

92 
covîed_löes
 +
ex
 / 100.0 * 
of
;

93 } i‡(
fuŒ_gcov


94 && (
	`°r°r
(
löes
[
i
], ":creating '")

95 || 
	`°r°¨ts
(
löes
[
i
], "Creating '"))) {

96 *
fûe
, *
fûíame
, *
≠o°r›he
;

97 
≠o°r›he
 = 
	`°rchr
(
löes
[
i
], '\'');

98 
fûíame
 = 
≠o°r›he
 + 1;

99 
≠o°r›he
 = 
	`°rchr
(
fûíame
, '\'');

100 *
≠o°r›he
 = '\0';

101 i‡(
löes_m©ãr
) {

102 
fûe
 = 
	`èl_gøb_fûe
(
sc‹e
, 
fûíame
, 
NULL
);

103 i‡(!
fûe
) {

104 
sc‹e
->
îr‹
 = 
	`èl_fmt
(score,

106 
fûíame
);

109 
	`¥ötf
("%s", 
fûe
);

111 i‡(
toﬁs_vîbo£
)

112 
	`¥ötf
("U∆ökög %s", 
fûíame
);

113 
	`u∆ök
(
fûíame
);

117 
sc‹e
->
∑ss
 = 
åue
;

119 i‡(
vîbo£
 > 1)

120 
	`¥ötf
("%u of %uÜines covered\n",

121 ()
covîed_löes
, 
tŸÆ_löes
);

126 i‡(
tŸÆ_löes
 == 0)

127 
sc‹e
->
tŸÆ
 = score->score = 0;

129 
sc‹e
->
tŸÆ
 = 6;

130 
sc‹e
->sc‹ê
	`sc‹e_covîage
(
covîed_löes
 / 
tŸÆ_löes
,

131 
sc‹e
->
tŸÆ
);

133 
	}
}

135 
	$do_run_covîage_ã°s
(
m™i„°
 *
m
,

136 *
timñe·
, 
sc‹e
 *score)

138 
cˇn_fûe
 *
i
;

139 *
cmdout
, *
outdú
;

140 *
covcmd
;

141 
boﬁ
 
fuŒ_gcov
 = (
vîbo£
 > 1);

142 
li°_hód
 *
li°
;

143 
boﬁ
 
øn_some
 = 
Ál£
;

146 
outdú
 = 
	`∑th_dú«me
(
sc‹e
,

147 
m
->
öfo_fûe
->
compûed
[
COMPILE_NORMAL
]);

148 
covcmd
 = 
	`èl_fmt
(
m
, "gcov %s -o %s",

149 
fuŒ_gcov
 ? "" : "-n",

150 
outdú
);

153 
	`f‹óch_±r
(
li°
, &
m
->
run_ã°s
, &m->
≠i_ã°s
) {

154 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

155 i‡(
	`run_comm™d
(
sc‹e
, 
timñe·
, &
cmdout
,

156 "%s", 
i
->
compûed
[
COMPILE_COVERAGE
])) {

157 
	`èl_≠≥nd_fmt
(&
covcmd
, " %s", 
i
->
fuŒ«me
);

159 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

161 " faûed: %s", 
cmdout
);

164 
øn_some
 = 
åue
;

169 i‡(!
øn_some
) {

170 
sc‹e
->
tŸÆ
 = score->score = 0;

171 
sc‹e
->
∑ss
 = 
åue
;

176 i‡(!
	`run_comm™d
(
sc‹e
, 
timñe·
, &
cmdout
, "%s", 
covcmd
)) {

177 
sc‹e
->
îr‹
 = 
	`èl_fmt
(sc‹e, "Ru¬ög gcov: %s", 
cmdout
);

181 
	`™Æyze_covîage
(
m
, 
fuŒ_gcov
, 
cmdout
, 
sc‹e
);

182 
	}
}

184 
cˇ∆öt
 
	gã°s_covîage
 = {

185 .
key
 = "tests_coverage",

186 .
	g«me
 = "Module'sÅests coverállÅhe code",

187 .
	gcheck
 = 
do_run_covîage_ã°s
,

188 .
	g√eds
 = "tests_compile_coverageÅests_pass"

191 
REGISTER_TEST
(
ã°s_covîage
);

	@ccan/tools/ccanlint/tests/tests_exist.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<cˇn/èl/°r/°r.h
>

3 
	~<cˇn/èl/∑th/∑th.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

14 
check_ã°s_exi°
(
m™i„°
 *
m
,

15 *
timñe·
, 
sc‹e
 *score);

17 
cˇ∆öt
 
	gã°s_exi°
 = {

18 .
key
 = "tests_exist",

19 .
	g«me
 = "Module hasÅest directory withÅests in it",

20 .
	gcheck
 = 
check_ã°s_exi°
,

21 .
	g√eds
 = "info_exists"

23 
REGISTER_TEST
(
ã°s_exi°
);

25 
	$h™dÀ_no_ã°s
(
m™i„°
 *
m
, 
sc‹e
 *score)

27 
FILE
 *
run
;

28 
cˇn_fûe
 *
i
;

29 *
ã°_dú
 = 
	`èl_fmt
(
m
, "%s/ã°", m->
dú
), *
run_fûe
;

31 
	`¥ötf
(

60 i‡(!
	`ask
("Should I createáÅemplateÅest/run.c file for you?"))

63 i‡(
	`mkdú
(
ã°_dú
, 0700) != 0) {

64 i‡(
î∫o
 !
EEXIST
)

65 
	`îr
(1, "CreatingÅest/ directory");

68 
run_fûe
 = 
	`èl_fmt
(
ã°_dú
, "%s/run.c",Åest_dir);

69 
run
 = 
	`f›í
(
run_fûe
, "w");

70 i‡(!
run
)

71 
	`îr
(1, "TryingÅo createáÅest/run.c");

73 
	`Ârötf
(
run
, "#ö˛udê<cˇn/%s/%s.h>\n", 
m
->
mod«me
, m->
ba£«me
);

74 i‡(!
	`li°_em±y
(&
m
->
c_fûes
)) {

75 
	`Âuts
("/* In˛udêthêC fûe†dúe˘ly. */\n", 
run
);

76 
	`li°_f‹_óch
(&
m
->
c_fûes
, 
i
, 
li°
)

77 
	`Ârötf
(
run
, "#include <ccan/%s/%s>\n",

78 
m
->
mod«me
, 
i
->
«me
);

80 
	`Ârötf
(
run
, "%s",

103 
	`f˛o£
(
run
);

104 
	}
}

106 
	$check_ã°s_exi°
(
m™i„°
 *
m
,

107 *
timñe·
, 
sc‹e
 *score)

109 
°©
 
°
;

110 *
ã°_dú
 = 
	`∑th_joö
(
m
, m->
dú
, "test");

112 i‡(
	`l°©
(
ã°_dú
, &
°
) != 0) {

113 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score, "NoÅest directory");

114 i‡(
î∫o
 !
ENOENT
)

115 
	`îr
(1, "°©tög %s", 
ã°_dú
);

116 
ã°s_exi°
.
h™dÀ
 = 
h™dÀ_no_ã°s
;

118 
sc‹e
->
∑ss
 = 
åue
;

122 i‡(!
	`S_ISDIR
(
°
.
°_mode
)) {

123 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score, "test isÇotá directory");

127 i‡(
	`li°_em±y
(&
m
->
≠i_ã°s
)

128 && 
	`li°_em±y
(&
m
->
run_ã°s
)

129 && 
	`li°_em±y
(&
m
->
compûe_ok_ã°s
)

130 && 
	`li°_em±y
(&
m
->
compûe_Áû_ã°s
)) {

131 
sc‹e
->
îr‹
 = 
	`èl_°rdup
(score, "NoÅests inÅest directory");

132 
ã°s_exi°
.
h™dÀ
 = 
h™dÀ_no_ã°s
;

135 
sc‹e
->
∑ss
 = 
åue
;

136 
sc‹e
->sc‹êsc‹e->
tŸÆ
;

137 
	}
}

	@ccan/tools/ccanlint/tests/tests_helpers_compile.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<sys/ty≥s.h
>

5 
	~<sys/°©.h
>

6 
	~<f˙é.h
>

7 
	~<uni°d.h
>

8 
	~<limôs.h
>

9 
	~<î∫o.h
>

10 
	~<°dlib.h
>

11 
	~<°dio.h
>

12 
	~<îr.h
>

13 
	~<°rög.h
>

14 
	~<˘y≥.h
>

15 
	~"ªdu˚_„©uªs.h
"

17 c⁄° *
	$ˇn_run
(
m™i„°
 *
m
)

19 i‡(
ß„_mode
)

21  
NULL
;

22 
	}
}

24 
boﬁ
 
	$compûe
(
m™i„°
 *
m
,

25 
cˇn_fûe
 *
cfûe
,

26 c⁄° *
Êags
,

27 
compûe_ty≥
 
˘y≥
,

28 **
ouçut
)

30 
cfûe
->
compûed
[
˘y≥
] = 
	`ãmp_fûe
(
m
, ".o", cfûe->
fuŒ«me
);

31  
	`compûe_obje˘
(
m
, 
cfûe
->
fuŒ«me
, 
cˇn_dú
, 
compûî
, 
Êags
,

32 
cfûe
->
compûed
[
˘y≥
], 
ouçut
);

33 
	}
}

35 
	$compûe_ã°_hñ≥rs
(
m™i„°
 *
m
,

36 *
timñe·
,

37 
sc‹e
 *score,

38 c⁄° *
Êags
,

39 
compûe_ty≥
 
˘y≥
)

41 
cˇn_fûe
 *
i
;

42 
boﬁ
 
îr‹s
 = 
Ál£
, 
w¨nögs
 = false;

44 i‡(
	`li°_em±y
(&
m
->
Ÿhî_ã°_c_fûes
))

45 
sc‹e
->
tŸÆ
 = 0;

47 
sc‹e
->
tŸÆ
 = 2;

49 
	`li°_f‹_óch
(&
m
->
Ÿhî_ã°_c_fûes
, 
i
, 
li°
) {

50 *
cmdout
;

52 i‡(!
	`compûe
(
m
, 
i
, 
Êags
, 
˘y≥
, &
cmdout
)) {

53 
îr‹s
 = 
åue
;

54 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0, "Compile failed:\n%s",

55 
cmdout
);

56 } i‡(!
	`°ªq
(
cmdout
, "")) {

57 
w¨nögs
 = 
åue
;

58 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0,

59 "Compûêgavêw¨nögs:\n%s", 
cmdout
);

63 i‡(!
îr‹s
) {

64 
sc‹e
->
∑ss
 = 
åue
;

65 
sc‹e
->sc‹êsc‹e->
tŸÆ
 - 
w¨nögs
;

67 
	}
}

69 
	$do_compûe_ã°_hñ≥rs
(
m™i„°
 *
m
,

70 *
timñe·
,

71 
sc‹e
 *score)

73 
	`compûe_ã°_hñ≥rs
(
m
, 
timñe·
, 
sc‹e
, 
cÊags
, 
COMPILE_NORMAL
);

74 
	}
}

76 
cˇ∆öt
 
	gã°s_hñ≥rs_compûe
 = {

77 .
key
 = "tests_helpers_compile",

78 .
	g«me
 = "ModuleÅest helper objects compile",

79 .
	gcheck
 = 
do_compûe_ã°_hñ≥rs
,

80 .
	gˇn_run
 = 
ˇn_run
,

81 .
	g√eds
 = "depends_buildÅests_exist"

84 
REGISTER_TEST
(
ã°s_hñ≥rs_compûe
);

86 c⁄° *
	$„©uªs_ªdu˚d
(
m™i„°
 *
m
)

88 i‡(
„©uªs_wîe_ªdu˚d
)

89  
NULL
;

91 
	}
}

93 
	$do_compûe_ã°_hñ≥rs_wôhout_„©uªs
(
m™i„°
 *
m
,

94 *
timñe·
,

95 
sc‹e
 *score)

97 *
Êags
;

99 
Êags
 = 
	`èl_fmt
(
sc‹e
, "%†%s", 
cÊags
, 
REDUCE_FEATURES_FLAGS
);

101 
	`compûe_ã°_hñ≥rs
(
m
, 
timñe·
, 
sc‹e
, 
Êags
, 
COMPILE_NOFEAT
);

102 
	}
}

104 
cˇ∆öt
 
	gã°s_hñ≥rs_compûe_wôhout_„©uªs
 = {

105 .
key
 = "tests_helpers_compile_without_features",

106 .
	g«me
 = "ModuleÅests helpers compile (without features)",

107 .
	gcheck
 = 
do_compûe_ã°_hñ≥rs_wôhout_„©uªs
,

108 .
	gˇn_run
 = 
„©uªs_ªdu˚d
,

109 .
	g√eds
 = "depends_build_without_featuresÅests_exist"

111 
REGISTER_TEST
(
ã°s_hñ≥rs_compûe_wôhout_„©uªs
);

	@ccan/tools/ccanlint/tests/tests_pass.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/èke/èke.h
>

4 
	~<cˇn/°r/°r.h
>

5 
	~<cˇn/f‹óch/f‹óch.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<uni°d.h
>

10 
	~<limôs.h
>

11 
	~<î∫o.h
>

12 
	~<°dlib.h
>

13 
	~<°dio.h
>

14 
	~<îr.h
>

15 
	~<°rög.h
>

16 
	~<˘y≥.h
>

17 
	~"ã°s_∑ss.h
"

19 
boﬁ
 
	gdo_vÆgröd
 = 
Ál£
;

21 c⁄° *
	$ˇn_run
(
m™i„°
 *
m
)

23 
timñe·
 = 
deÁu…_timeout_ms
;

24 *
ouçut
;

25 i‡(
ß„_mode
)

28 i‡(!
	`is_ex˛uded
("tests_pass_valgrind")

29 && 
	`run_comm™d
(
m
, &
timñe·
, &
ouçut
,

31 
do_vÆgröd
 = 
åue
;

33  
NULL
;

34 
	}
}

36 c⁄° *
	$c⁄ˇt
(
sc‹e
 *sc‹e, *
bôs
[])

38 
i
;

39 *
ªt
 = 
	`èl_°rdup
(
sc‹e
, "");

41 
i
 = 0; 
bôs
[i]; i++) {

42 i‡(
i
)

43 
ªt
 = 
	`èl_°rˇt
(
sc‹e
, 
	`èke
(ret), " ");

44 
ªt
 = 
	`èl_°rˇt
(
sc‹e
, 
	`èke
‘ë), 
bôs
[
i
]);

46  
ªt
;

47 
	}
}

49 
	$run_ã°
(*
˘x
,

50 
m™i„°
 *
m
,

51 *
timñe·
,

52 
cˇn_fûe
 *
i
)

54 i‡(
do_vÆgröd
) {

55 c⁄° *
›ti⁄s
;

56 
›ti⁄s
 = 
	`c⁄ˇt
(
˘x
,

57 
	`≥r_fûe_›ti⁄s
(&
ã°s_∑ss_vÆgröd
, 
i
));

59 i‡(!
	`°ªq
(
›ti⁄s
, "FAIL")) {

63 
i
->
vÆgröd_log
 = 
	`èl_fmt
(
m
,

65 
i
->
compûed
[
COMPILE_NORMAL
]);

67 
	`run_comm™d_async
(
i
, *
timñe·
,

72 
›ti⁄s
,

73 
i
->
compûed
[
COMPILE_NORMAL
],

74 
i
->
vÆgröd_log
);

79 
	`run_comm™d_async
(
i
, *
timñe·
, "%s",

80 
i
->
compûed
[
COMPILE_NORMAL
]);

81 
	}
}

83 
	$do_run_ã°s
(
m™i„°
 *
m
,

84 *
timñe·
,

85 
sc‹e
 *score)

87 
li°_hód
 *
li°
;

88 
cˇn_fûe
 *
i
;

89 *
cmdout
;

90 
boﬁ
 
ok
;

92 
sc‹e
->
tŸÆ
 = 0;

93 
	`f‹óch_±r
(
li°
, &
m
->
run_ã°s
, &m->
≠i_ã°s
) {

94 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

95 
sc‹e
->
tŸÆ
++;

96 i‡(
vîbo£
 >= 2)

97 
	`¥ötf
(" %s...\n", 
i
->
«me
);

98 
	`run_ã°
(
sc‹e
, 
m
, 
timñe·
, 
i
);

102 (
i
 = 
	`cﬁÀ˘_comm™d
(&
ok
, &
cmdout
)Ë!
NULL
) {

103 i‡(!
ok
)

104 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0, "%s", 
cmdout
);

106 
sc‹e
->score++;

107 i‡(
vîbo£
 >= 2)

108 
	`¥ötf
(" ...%s\n", 
i
->
«me
);

111 i‡(
sc‹e
->sc‹ê=sc‹e->
tŸÆ
)

112 
sc‹e
->
∑ss
 = 
åue
;

113 
	}
}

117 
	#d€¢t_m©ãr
()

	)

119 
	$run_undî_debuggî
(
m™i„°
 *
m
, 
sc‹e
 *score)

121 *
comm™d
;

122 
fûe_îr‹
 *
fú°
;

124 
fú°
 = 
	`li°_t›
(&
sc‹e
->
≥r_fûe_îr‹s
, 
fûe_îr‹
, 
li°
);

126 i‡(!
	`ask
("Should IÑunÅhe first failingÅest underÅhe debugger?"))

129 
comm™d
 = 
	`èl_fmt
(
m
, "gdb -ex 'breakÅap.c:139' -ex 'run' %s",

130 
fú°
->
fûe
->
compûed
[
COMPILE_NORMAL
]);

131 i‡(
	`sy°em
(
comm™d
))

132 
	`d€¢t_m©ãr
();

133 
	}
}

135 
cˇ∆öt
 
	gã°s_∑ss
 = {

136 .
key
 = "tests_pass",

137 .
	g«me
 = "Module'sÑunándápiÅestsÖass",

138 .
	gcheck
 = 
do_run_ã°s
,

139 .
	gh™dÀ
 = 
run_undî_debuggî
,

140 .
	gˇn_run
 = 
ˇn_run
,

141 .
	g√eds
 = "tests_compile"

144 
REGISTER_TEST
(
ã°s_∑ss
);

	@ccan/tools/ccanlint/tests/tests_pass.h

2 
boﬁ
 
do_vÆgröd
;

4 
cˇ∆öt
 
ã°s_∑ss_vÆgröd
;

	@ccan/tools/ccanlint/tests/tests_pass_valgrind.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/èke/èke.h
>

5 
	~<cˇn/f‹óch/f‹óch.h
>

6 
	~"ã°s_∑ss.h
"

7 
	~<sys/ty≥s.h
>

8 
	~<sys/°©.h
>

9 
	~<f˙é.h
>

10 
	~<uni°d.h
>

11 
	~<limôs.h
>

12 
	~<î∫o.h
>

13 
	~<°dlib.h
>

14 
	~<°dio.h
>

15 
	~<îr.h
>

16 
	~<°rög.h
>

17 
	~<˘y≥.h
>

20 c⁄° *
	$ˇn_run_vg
(
m™i„°
 *
m
)

22 i‡(!
do_vÆgröd
)

23  
	`èl_fmt
(
m
, "No valgrind support");

24  
NULL
;

25 
	}
}

27 
do_Àakcheck_vg
(
m™i„°
 *
m
,

28 *
timñe·
,

29 
sc‹e
 *score);

31 
cˇ∆öt
 
	gã°s_∑ss_vÆgröd_nﬁóks
 = {

32 .
key
 = "tests_pass_valgrind_noleaks",

33 .
	g«me
 = "Module'sÑunándápiÅests haveÇo memoryÜeaks",

34 .
	gcheck
 = 
do_Àakcheck_vg
,

35 .
	gèkes_›ti⁄s
 = 
åue
,

36 .
	g√eds
 = "tests_pass_valgrind"

38 
REGISTER_TEST
(
ã°s_∑ss_vÆgröd_nﬁóks
);

54 
boﬁ
 
	$bœnk_löe
(c⁄° *
löe
)

56  
löe
[
	`°r•n
(line, "=0123456789 ")] == '\0';

57 
	}
}

60 **
	$exåa˘_m©chög
(c⁄° *
¥efix
, *
löes
[])

62 
i
, 
num_ªt
 = 0;

63 **
ªt
 = 
	`èl_¨r
(
löes
, *, 
	`èl_cou¡
(lines));

65 
i
 = 0; i < 
	`èl_cou¡
(
löes
) - 1; i++) {

66 i‡(
	`°r°¨ts
(
löes
[
i
], 
¥efix
)) {

67 
ªt
[
num_ªt
++] = 
	`èl_°rdup
‘ë, 
löes
[
i
]);

68 
löes
[
i
] = (*)"";

71 
ªt
[
num_ªt
++] = 
NULL
;

74 
	`èl_ªsize
(&
ªt
, 
num_ªt
);

75  
ªt
;

76 
	}
}

78 *
	$gë_Àaks
(*
löes
[], **
îrs
)

80 *
Àaks
 = 
	`èl_°rdup
(
löes
, "");

81 
i
;

83 
i
 = 0; i < 
	`èl_cou¡
(
löes
) - 1; i++) {

84 i‡(
	`°r°r
(
löes
[
i
], "Üost ")) {

86 i‡(
	`°r°r
(
löes
[
i
], " definitelyÜost ")) {

88 
löes
[
i
] && !
	`bœnk_löe
(lines[i])) {

89 
	`èl_≠≥nd_fmt
(&
Àaks
, "%s\n",

90 
löes
[
i
]);

91 
i
++;

95 
löes
[
i
] && !
	`bœnk_löe
(lines[i]))

96 
i
++;

99 
löes
[
i
] && !
	`bœnk_löe
(lines[i])) {

100 i‡(!*
îrs
)

101 *
îrs
 = 
	`èl_fmt
(
NULL
, "%s\n", 
löes
[
i
]);

103 
	`èl_≠≥nd_fmt
(
îrs
, "%s\n", 
löes
[
i
]);

104 
i
++;

108  
Àaks
;

109 
	}
}

112 *
	$™Æyze_ouçut
(c⁄° *
ouçut
, **
îrs
)

114 *
Àaks
 = 
	`èl_°rdup
(
ouçut
, "");

115 
i
;

116 **
löes
 = 
	`èl_°r•lô
(
ouçut
, ouçut, "\n", 
STR_EMPTY_OK
);

118 *
îrs
 = 
	`èl_°rdup
(
ouçut
, "");

119 
i
 = 0; i < 
	`èl_cou¡
(
löes
) - 1; i++) {

120 
¥eÊí
 = 
	`°r•n
(
löes
[
i
], "=0123456789");

121 *
¥efix
, **
sublöes
;

124 i‡(
¥eÊí
 == 0)

127 
¥efix
 = 
	`èl_°∫dup
(
ouçut
, 
löes
[
i
], 
¥eÊí
);

128 
sublöes
 = 
	`exåa˘_m©chög
(
¥efix
, 
löes
);

130 
Àaks
 = 
	`èl_°rˇt
(
ouçut
, 
	`èke
(leaks),

131 
	`èke
(
	`gë_Àaks
(
sublöes
, 
îrs
)));

134 i‡(!
Àaks
[0]) {

135 
	`èl_‰ì
(
Àaks
);

136 
Àaks
 = 
NULL
;

138 i‡(!(*
îrs
)[0]) {

139 
	`èl_‰ì
(*
îrs
);

140 *
îrs
 = 
NULL
;

142  
Àaks
;

143 
	}
}

145 c⁄° *
	$c⁄ˇt
(
sc‹e
 *sc‹e, *
bôs
[])

147 
i
;

148 *
ªt
 = 
	`èl_°rdup
(
sc‹e
, "");

150 
i
 = 0; 
bôs
[i]; i++) {

151 i‡(
i
)

152 
ªt
 = 
	`èl_°rˇt
(
sc‹e
, 
	`èke
(ret), " ");

153 
ªt
 = 
	`èl_°rˇt
(
sc‹e
, 
	`èke
‘ë), 
bôs
[
i
]);

155  
ªt
;

156 
	}
}

159 
	$do_run_ã°s_vg
(
m™i„°
 *
m
,

160 *
timñe·
,

161 
sc‹e
 *score)

163 
cˇn_fûe
 *
i
;

164 
li°_hód
 *
li°
;

167 
sc‹e
->
tŸÆ
 = 0;

168 
sc‹e
->
∑ss
 = 
åue
;

169 
	`f‹óch_±r
(
li°
, &
m
->
run_ã°s
, &m->
≠i_ã°s
) {

170 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

171 *
îr
, *
ouçut
;

172 c⁄° *
›ti⁄s
;

174 
sc‹e
->
tŸÆ
++;

175 
›ti⁄s
 = 
	`c⁄ˇt
(
sc‹e
,

176 
	`≥r_fûe_›ti⁄s
(&
ã°s_∑ss_vÆgröd
,

177 
i
));

178 i‡(
	`°ªq
(
›ti⁄s
, "FAIL")) {

179 
i
->
Àak_öfo
 = 
NULL
;

183 
ouçut
 = 
	`èl_gøb_fûe
(
i
, i->
vÆgröd_log
, 
NULL
);

185 i‡(!
ouçut
 || output[0] == '\0') {

186 
îr
 = 
NULL
;

187 
i
->
Àak_öfo
 = 
NULL
;

189 
i
->
Àak_öfo
 = 
	`™Æyze_ouçut
(
ouçut
, &
îr
);

191 i‡(
îr
) {

192 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0, "%s", 
îr
);

193 
sc‹e
->
∑ss
 = 
Ál£
;

195 
sc‹e
->score++;

198 
	}
}

200 
	$do_Àakcheck_vg
(
m™i„°
 *
m
,

201 *
timñe·
,

202 
sc‹e
 *score)

204 
cˇn_fûe
 *
i
;

205 
li°_hód
 *
li°
;

206 **
›ti⁄s
;

207 
boﬁ
 
Àaks
 = 
Ál£
;

209 
	`f‹óch_±r
(
li°
, &
m
->
run_ã°s
, &m->
≠i_ã°s
) {

210 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

211 
›ti⁄s
 = 
	`≥r_fûe_›ti⁄s
(&
ã°s_∑ss_vÆgröd_nﬁóks
,

212 
i
);

213 i‡(
›ti⁄s
[0]) {

214 i‡(
	`°ªq
(
›ti⁄s
[0], "FAIL")) {

215 
Àaks
 = 
åue
;

218 
	`îrx
(1, "UnknownÜeakcheck options '%s'",

219 
›ti⁄s
[0]);

222 i‡(
i
->
Àak_öfo
) {

223 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0, "%s",

224 
i
->
Àak_öfo
);

225 
Àaks
 = 
åue
;

231 
sc‹e
->
∑ss
 = 
åue
;

232 i‡(!
Àaks
) {

233 
sc‹e
->score = 1;

235 
	}
}

238 
	#d€¢t_m©ãr
()

	)

240 
	$run_undî_debuggî_vg
(
m™i„°
 *
m
, 
sc‹e
 *score)

242 
fûe_îr‹
 *
fú°
;

243 *
comm™d
;

246 i‡(
sc‹e
->
∑ss
)

249 i‡(!
	`ask
("Should IÑunÅhe first failingÅest underÅhe debugger?"))

252 
fú°
 = 
	`li°_t›
(&
sc‹e
->
≥r_fûe_îr‹s
, 
fûe_îr‹
, 
li°
);

253 
comm™d
 = 
	`èl_fmt
(
m
, "valgrind --leak-check=full --db-attach=yes%s %s",

254 
	`c⁄ˇt
(
sc‹e
, 
	`≥r_fûe_›ti⁄s
(&
ã°s_∑ss_vÆgröd
,

255 
fú°
->
fûe
)),

256 
fú°
->
fûe
->
compûed
[
COMPILE_NORMAL
]);

257 i‡(
	`sy°em
(
comm™d
))

258 
	`d€¢t_m©ãr
();

259 
	}
}

261 
cˇ∆öt
 
	gã°s_∑ss_vÆgröd
 = {

262 .
key
 = "tests_pass_valgrind",

263 .
	g«me
 = "Module'sÑunándápiÅests succeed under valgrind",

264 .
	gˇn_run
 = 
ˇn_run_vg
,

265 .
	gcheck
 = 
do_run_ã°s_vg
,

266 .
	gh™dÀ
 = 
run_undî_debuggî_vg
,

267 .
	gèkes_›ti⁄s
 = 
åue
,

268 .
	g√eds
 = "tests_pass"

270 
REGISTER_TEST
(
ã°s_∑ss_vÆgröd
);

	@ccan/tools/ccanlint/tests/tests_pass_without_features.c

1 
	~<toﬁs/cˇ∆öt/cˇ∆öt.h
>

2 
	~<toﬁs/toﬁs.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<cˇn/f‹óch/f‹óch.h
>

5 
	~<sys/ty≥s.h
>

6 
	~<sys/°©.h
>

7 
	~<f˙é.h
>

8 
	~<uni°d.h
>

9 
	~<limôs.h
>

10 
	~<î∫o.h
>

11 
	~<°dlib.h
>

12 
	~<°dio.h
>

13 
	~<îr.h
>

14 
	~<°rög.h
>

15 
	~<˘y≥.h
>

18 
	$do_run_ã°s_no_„©uªs
(
m™i„°
 *
m
,

19 *
timñe·
,

20 
sc‹e
 *score)

22 
li°_hód
 *
li°
;

23 
cˇn_fûe
 *
i
;

24 *
cmdout
;

26 
sc‹e
->
tŸÆ
 = 0;

27 
	`f‹óch_±r
(
li°
, &
m
->
run_ã°s
, &m->
≠i_ã°s
) {

28 
	`li°_f‹_óch
(
li°
, 
i
,Üist) {

29 
sc‹e
->
tŸÆ
++;

30 i‡(
vîbo£
 >= 2)

31 
	`¥ötf
(" %s\n", 
i
->
«me
);

32 i‡(
	`run_comm™d
(
m
, 
timñe·
, &
cmdout
, "%s",

33 
i
->
compûed
[
COMPILE_NOFEAT
]))

34 
sc‹e
->score++;

36 
	`sc‹e_fûe_îr‹
(
sc‹e
, 
i
, 0, "%s", 
cmdout
);

40 i‡(
sc‹e
->sc‹ê=sc‹e->
tŸÆ
)

41 
sc‹e
->
∑ss
 = 
åue
;

42 
	}
}

45 
	#d€¢t_m©ãr
()

	)

47 
	$run_undî_debuggî
(
m™i„°
 *
m
, 
sc‹e
 *score)

49 *
comm™d
;

50 
fûe_îr‹
 *
fú°
;

52 
fú°
 = 
	`li°_t›
(&
sc‹e
->
≥r_fûe_îr‹s
, 
fûe_îr‹
, 
li°
);

54 i‡(!
	`ask
("Should IÑunÅhe first failingÅest underÅhe debugger?"))

57 
comm™d
 = 
	`èl_fmt
(
m
, "gdb -ex 'breakÅap.c:139' -ex 'run' %s",

58 
fú°
->
fûe
->
compûed
[
COMPILE_NOFEAT
]);

59 i‡(
	`sy°em
(
comm™d
))

60 
	`d€¢t_m©ãr
();

61 
	}
}

63 
cˇ∆öt
 
	gã°s_∑ss_wôhout_„©uªs
 = {

64 .
key
 = "tests_pass_without_features",

65 .
	g«me
 = "Module'sÑunándápiÅestsÖass (without features)",

66 .
	gcheck
 = 
do_run_ã°s_no_„©uªs
,

67 .
	gh™dÀ
 = 
run_undî_debuggî
,

68 .
	g√eds
 = "tests_compile_without_features"

71 
REGISTER_TEST
(
ã°s_∑ss_wôhout_„©uªs
);

	@ccan/tools/compile.c

1 
	~"toﬁs.h
"

2 
	~<°dlib.h
>

4 #i‚de‡
CCAN_COMPILER


5 
	#CCAN_COMPILER
 
DEFAULT_CCAN_COMPILER


	)

7 #i‚de‡
CCAN_CFLAGS


8 
	#CCAN_CFLAGS
 
DEFAULT_CCAN_CFLAGS


	)

10 c⁄° *
	gcompûî
 = 
CCAN_COMPILER
;

11 c⁄° *
	gcÊags
 = 
CCAN_CFLAGS
;

13 
boﬁ
 
	gcompûe_vîbo£
 = 
Ál£
;

16 *
	$lök_obje˘s
(c⁄° *
˘x
, c⁄° *
ba£«me
,

17 c⁄° *
objs
, **
îrmsg
)

19 *
fûe
 = 
	`ãmp_fûe
(
˘x
, ".o", 
ba£«me
);

21 i‡(
compûe_vîbo£
)

22 
	`¥ötf
("Lökög obje˘†ötÿ%s\n", 
fûe
);

24 i‡(
	`run_comm™d
(
˘x
, 
NULL
, 
îrmsg
, "ld -∏-ÿ%†%s", 
fûe
, 
objs
))

25  
fûe
;

27 
	`èl_‰ì
(
fûe
);

28  
NULL
;

29 
	}
}

32 
boﬁ
 
	$compûe_obje˘
(c⁄° *
˘x
, c⁄° *
cfûe
, c⁄° *
cˇndú
,

33 c⁄° *
compûî
,

34 c⁄° *
cÊags
,

35 c⁄° *
outfûe
, **
ouçut
)

37 i‡(
compûe_vîbo£
)

38 
	`¥ötf
("Compûög %s\n", 
outfûe
);

39  
	`run_comm™d
(
˘x
, 
NULL
, 
ouçut
,

41 
compûî
, 
cÊags
, 
cˇndú
, 
outfûe
, 
cfûe
);

42 
	}
}

46 
boﬁ
 
	$compûe_™d_lök
(c⁄° *
˘x
, c⁄° *
cfûe
, c⁄° *
cˇndú
,

47 c⁄° *
objs
, c⁄° *
compûî
,

48 c⁄° *
cÊags
,

49 c⁄° *
libs
, c⁄° *
outfûe
, **
ouçut
)

51 i‡(
compûe_vîbo£
)

52 
	`¥ötf
("CompûögándÜökög %s\n", 
outfûe
);

53  
	`run_comm™d
(
˘x
, 
NULL
, 
ouçut
,

55 
compûî
, 
cÊags
,

56 
cˇndú
, 
outfûe
, 
cfûe
, 
objs
, 
libs
);

57 
	}
}

	@ccan/tools/configurator/configurator.c

24 
	~<°dio.h
>

25 
	~<°dboﬁ.h
>

26 
	~<°dlib.h
>

27 
	~<uni°d.h
>

28 
	~<îr.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/waô.h
>

31 
	~<sys/°©.h
>

32 
	~<f˙é.h
>

33 
	~<°rög.h
>

35 
	#DEFAULT_COMPILER
 "cc"

	)

36 
	#DEFAULT_FLAGS
 "-g3 -ggdb -WÆ»-Wunde‡-Wmissög-¥ŸŸy≥†-Wmissög-de˛¨©i⁄†-W°ri˘-¥ŸŸy≥†-Wﬁd-°yÀ-deföôi⁄"

	)

38 
	#OUTPUT_FILE
 "c⁄figuøt‹.out"

	)

39 
	#INPUT_FILE
 "c⁄figuøt‹ã°.c"

	)

41 
	gvîbo£
;

43 
	eã°_°yÀ
 {

44 
	mOUTSIDE_MAIN
 = 0x1,

45 
	mDEFINES_FUNC
 = 0x2,

46 
	mINSIDE_MAIN
 = 0x4,

47 
	mDEFINES_EVERYTHING
 = 0x8,

48 
	mMAY_NOT_COMPILE
 = 0x10,

49 
	mEXECUTE
 = 0x8000

52 
	sã°
 {

53 c⁄° *
	m«me
;

54 
ã°_°yÀ
 
	m°yÀ
;

55 c⁄° *
	mdïíds
;

56 c⁄° *
	mlök
;

57 c⁄° *
	m‰agmít
;

58 
boﬁ
 
	md⁄e
;

59 
boﬁ
 
	m™swî
;

62 
ã°
 
	gã°s
[] = {

63 { "HAVE_32BIT_OFF_T", 
DEFINES_EVERYTHING
|
EXECUTE
, 
NULL
, NULL,

68 { "HAVE_ALIGNOF", 
INSIDE_MAIN
, 
NULL
, NULL,

70 { "HAVE_ASPRINTF", 
DEFINES_FUNC
, 
NULL
, NULL,

78 { "HAVE_ATTRIBUTE_COLD", 
DEFINES_FUNC
, 
NULL
, NULL,

80 { "HAVE_ATTRIBUTE_CONST", 
DEFINES_FUNC
, 
NULL
, NULL,

82 { "HAVE_ATTRIBUTE_MAY_ALIAS", 
OUTSIDE_MAIN
, 
NULL
, NULL,

84 { "HAVE_ATTRIBUTE_NORETURN", 
DEFINES_FUNC
, 
NULL
, NULL,

87 { "HAVE_ATTRIBUTE_PRINTF", 
DEFINES_FUNC
, 
NULL
, NULL,

89 { "HAVE_ATTRIBUTE_UNUSED", 
OUTSIDE_MAIN
, 
NULL
, NULL,

91 { "HAVE_ATTRIBUTE_USED", 
OUTSIDE_MAIN
, 
NULL
, NULL,

93 { "HAVE_BACKTRACE", 
DEFINES_FUNC
, 
NULL
, NULL,

99 { "HAVE_BIG_ENDIAN", 
INSIDE_MAIN
|
EXECUTE
, 
NULL
, NULL,

103 { "HAVE_BSWAP_64", 
DEFINES_FUNC
, "HAVE_BYTESWAP_H", 
NULL
,

106 { "HAVE_BUILTIN_CHOOSE_EXPR", 
INSIDE_MAIN
, 
NULL
, NULL,

108 { "HAVE_BUILTIN_CLZ", 
INSIDE_MAIN
, 
NULL
, NULL,

110 { "HAVE_BUILTIN_CLZL", 
INSIDE_MAIN
, 
NULL
, NULL,

112 { "HAVE_BUILTIN_CLZLL", 
INSIDE_MAIN
, 
NULL
, NULL,

114 { "HAVE_BUILTIN_CONSTANT_P", 
INSIDE_MAIN
, 
NULL
, NULL,

116 { "HAVE_BUILTIN_EXPECT", 
INSIDE_MAIN
, 
NULL
, NULL,

118 { "HAVE_BUILTIN_FFSL", 
INSIDE_MAIN
, 
NULL
, NULL,

120 { "HAVE_BUILTIN_FFSLL", 
INSIDE_MAIN
, 
NULL
, NULL,

122 { "HAVE_BUILTIN_POPCOUNTL", 
INSIDE_MAIN
, 
NULL
, NULL,

124 { "HAVE_BUILTIN_TYPES_COMPATIBLE_P", 
INSIDE_MAIN
, 
NULL
, NULL,

126 { "HAVE_BYTESWAP_H", 
OUTSIDE_MAIN
, 
NULL
, NULL,

129 
DEFINES_FUNC
, "HAVE_STRUCT_TIMESPEC", 
NULL
,

137 
DEFINES_FUNC
,

146 { "HAVE_COMPOUND_LITERALS", 
INSIDE_MAIN
, 
NULL
, NULL,

149 { "HAVE_FCHDIR", 
DEFINES_EVERYTHING
|
EXECUTE
, 
NULL
, NULL,

158 { "HAVE_ERR_H", 
DEFINES_FUNC
, 
NULL
, NULL,

170 { "HAVE_FILE_OFFSET_BITS", 
DEFINES_EVERYTHING
|
EXECUTE
,

171 "HAVE_32BIT_OFF_T", 
NULL
,

177 { "HAVE_FOR_LOOP_DECLARATION", 
INSIDE_MAIN
, 
NULL
, NULL,

180 { "HAVE_FLEXIBLE_ARRAY_MEMBER", 
OUTSIDE_MAIN
, 
NULL
, NULL,

182 { "HAVE_GETPAGESIZE", 
DEFINES_FUNC
, 
NULL
, NULL,

185 { "HAVE_ISBLANK", 
DEFINES_FUNC
, 
NULL
, NULL,

189 { "HAVE_LITTLE_ENDIAN", 
INSIDE_MAIN
|
EXECUTE
, 
NULL
, NULL,

193 { "HAVE_MEMMEM", 
DEFINES_FUNC
, 
NULL
, NULL,

199 { "HAVE_MMAP", 
DEFINES_FUNC
, 
NULL
, NULL,

204 { "HAVE_PROC_SELF_MAPS", 
DEFINES_EVERYTHING
|
EXECUTE
, 
NULL
, NULL,

212 
DEFINES_EVERYTHING
|
EXECUTE
|
MAY_NOT_COMPILE
, 
NULL
, NULL,

225 
DEFINES_FUNC
, 
NULL
, NULL,

232 
DEFINES_FUNC
, 
NULL
, NULL,

238 { "HAVE_STACK_GROWS_UPWARDS", 
DEFINES_EVERYTHING
|
EXECUTE
, 
NULL
, NULL,

248 { "HAVE_STATEMENT_EXPR", 
INSIDE_MAIN
, 
NULL
, NULL,

250 { "HAVE_SYS_FILIO_H", 
OUTSIDE_MAIN
, 
NULL
, NULL,

252 { "HAVE_TYPEOF", 
INSIDE_MAIN
, 
NULL
, NULL,

254 { "HAVE_UTIME", 
DEFINES_FUNC
, 
NULL
, NULL,

261 { "HAVE_WARN_UNUSED_RESULT", 
DEFINES_FUNC
, 
NULL
, NULL,

269 *
	$gøb_fd
(
fd
)

271 
ªt
;

272 
size_t
 
max
, 
size
 = 0;

273 *
buf„r
;

275 
max
 = 16384;

276 
buf„r
 = 
	`mÆloc
(
max
+1);

277 (
ªt
 = 
	`ªad
(
fd
, 
buf„r
 + 
size
, 
max
 - size)) > 0) {

278 
size
 +
ªt
;

279 i‡(
size
 =
max
)

280 
buf„r
 = 
	`ªÆloc
(buf„r, 
max
 *= 2);

282 i‡(
ªt
 < 0)

283 
	`îr
(1, "reading from command");

284 
buf„r
[
size
] = '\0';

285  
buf„r
;

286 
	}
}

288 *
	$run
(c⁄° *
cmd
, *
exô°©us
)

290 
pid_t
 
pid
;

291 
p
[2];

292 *
ªt
;

293 
°©us
;

295 i‡(
	`pùe
(
p
) != 0)

296 
	`îr
(1, "creatingÖipe");

298 
pid
 = 
	`f‹k
();

299 i‡(
pid
 == -1)

300 
	`îr
(1, "forking");

302 i‡(
pid
 == 0) {

303 i‡(
	`dup2
(
p
[1], 
STDOUT_FILENO
) != STDOUT_FILENO

304 || 
	`dup2
(
p
[1], 
STDERR_FILENO
) != STDERR_FILENO

305 || 
	`˛o£
(
p
[0]) != 0

306 || 
	`˛o£
(
STDIN_FILENO
) != 0

307 || 
	`›í
("/dev/nuŒ", 
O_RDONLY
Ë!
STDIN_FILENO
)

308 
	`exô
(128);

310 
°©us
 = 
	`sy°em
(
cmd
);

311 i‡(
	`WIFEXITED
(
°©us
))

312 
	`exô
(
	`WEXITSTATUS
(
°©us
));

314 
	`exô
(128 + 
	`WTERMSIG
(
°©us
));

317 
	`˛o£
(
p
[1]);

318 
ªt
 = 
	`gøb_fd
(
p
[0]);

320 i‡(
	`waôpid
(
pid
, &
°©us
, 0) !=Öid)

321 
	`îr
(1, "FailedÅo wait for child");

322 
	`˛o£
(
p
[0]);

323 i‡(
	`WIFEXITED
(
°©us
))

324 *
exô°©us
 = 
	`WEXITSTATUS
(
°©us
);

326 *
exô°©us
 = -
	`WTERMSIG
(
°©us
);

327  
ªt
;

328 
	}
}

330 *
	$c⁄√˘_¨gs
(c⁄° *
¨gv
[], c⁄° *
exåa
)

332 
i
, 
Àn
 = 
	`°æí
(
exåa
) + 1;

333 *
ªt
;

335 
i
 = 1; 
¨gv
[i]; i++)

336 
Àn
 +1 + 
	`°æí
(
¨gv
[
i
]);

338 
ªt
 = 
	`mÆloc
(
Àn
);

339 
Àn
 = 0;

340 
i
 = 1; 
¨gv
[i]; i++) {

341 
	`°r˝y
(
ªt
 + 
Àn
, 
¨gv
[
i
]);

342 
Àn
 +
	`°æí
(
¨gv
[
i
]);

343 i‡(
¨gv
[
i
+1])

344 
ªt
[
Àn
++] = ' ';

346 
	`°r˝y
(
ªt
 + 
Àn
, 
exåa
);

347  
ªt
;

348 
	}
}

350 
ã°
 *
	$föd_ã°
(c⁄° *
«me
)

352 
i
;

354 
i
 = 0; i < (
ã°s
)/(tests[0]); i++) {

355 i‡(
	`°rcmp
(
ã°s
[
i
].
«me
,Çame) == 0)

356  &
ã°s
[
i
];

358 
	`ab‹t
();

359 
	}
}

361 
	#PRE_BOILERPLATE
 "/* Te°Örogøm gíî©ed by c⁄figuøt‹. */\n"

	)

362 
	#MAIN_START_BOILERPLATE
 "öàmaö(öà¨gc, ch¨ *¨gv[]Ë{\n"

	)

363 
	#USE_FUNC_BOILERPLATE
 "(void)func;\n"

	)

364 
	#MAIN_BODY_BOILERPLATE
 "ªtu∫ 0;\n"

	)

365 
	#MAIN_END_BOILERPLATE
 "}\n"

	)

367 
boﬁ
 
	$run_ã°
(c⁄° *
cmd
, 
ã°
 *test)

369 *
ouçut
;

370 
FILE
 *
outf
;

371 
°©us
;

373 i‡(
ã°
->
d⁄e
)

374  
ã°
->
™swî
;

376 i‡(
ã°
->
dïíds
) {

377 
size_t
 
Àn
;

378 c⁄° *
dïs
 = 
ã°
->
dïíds
;

379 *
dï
;

382 (
Àn
 = 
	`°rc•n
(
dïs
, " "))) {

383 
boﬁ
 
posôive
 = 
åue
;

384 i‡(
dïs
[
Àn
]) {

385 
dï
 = 
	`°rdup
(
dïs
);

386 
dï
[
Àn
] = '\0';

388 
dï
 = (*)
dïs
;

391 i‡(
dï
[0] == '!') {

392 
dï
++;

393 
posôive
 = 
Ál£
;

395 i‡(
	`run_ã°
(
cmd
, 
	`föd_ã°
(
dï
)Ë!
posôive
) {

396 
ã°
->
™swî
 = 
Ál£
;

397 
ã°
->
d⁄e
 = 
åue
;

398  
ã°
->
™swî
;

400 
dïs
 +
Àn
;

401 
dïs
 +
	`°r•n
(deps, " ");

405 
outf
 = 
	`f›í
(
INPUT_FILE
, "w");

406 i‡(!
outf
)

407 
	`îr
(1, "¸ótög %s", 
INPUT_FILE
);

409 
	`Ârötf
(
outf
, "%s", 
PRE_BOILERPLATE
);

410 
ã°
->
°yÀ
 & ~(
EXECUTE
|
MAY_NOT_COMPILE
)) {

411 
INSIDE_MAIN
:

412 
	`Ârötf
(
outf
, "%s", 
MAIN_START_BOILERPLATE
);

413 
	`Ârötf
(
outf
, "%s", 
ã°
->
‰agmít
);

414 
	`Ârötf
(
outf
, "%s", 
MAIN_END_BOILERPLATE
);

416 
OUTSIDE_MAIN
:

417 
	`Ârötf
(
outf
, "%s", 
ã°
->
‰agmít
);

418 
	`Ârötf
(
outf
, "%s", 
MAIN_START_BOILERPLATE
);

419 
	`Ârötf
(
outf
, "%s", 
MAIN_BODY_BOILERPLATE
);

420 
	`Ârötf
(
outf
, "%s", 
MAIN_END_BOILERPLATE
);

422 
DEFINES_FUNC
:

423 
	`Ârötf
(
outf
, "%s", 
ã°
->
‰agmít
);

424 
	`Ârötf
(
outf
, "%s", 
MAIN_START_BOILERPLATE
);

425 
	`Ârötf
(
outf
, "%s", 
USE_FUNC_BOILERPLATE
);

426 
	`Ârötf
(
outf
, "%s", 
MAIN_BODY_BOILERPLATE
);

427 
	`Ârötf
(
outf
, "%s", 
MAIN_END_BOILERPLATE
);

429 
DEFINES_EVERYTHING
:

430 
	`Ârötf
(
outf
, "%s", 
ã°
->
‰agmít
);

433 
	`ab‹t
();

436 
	`f˛o£
(
outf
);

438 i‡(
vîbo£
 > 1)

439 i‡(
	`sy°em
("ˇà" 
INPUT_FILE
) == -1);

441 i‡(
ã°
->
lök
) {

442 *
√wcmd
;

443 
√wcmd
 = 
	`mÆloc
(
	`°æí
(
cmd
) + strlen(" ")

444 + 
	`°æí
(
ã°
->
lök
) + 1);

445 
	`•rötf
(
√wcmd
, "%†%s", 
cmd
, 
ã°
->
lök
);

446 i‡(
vîbo£
 > 1)

447 
	`¥ötf
("Exå®lökÜöe: %s", 
√wcmd
);

448 
cmd
 = 
√wcmd
;

451 
ouçut
 = 
	`run
(
cmd
, &
°©us
);

452 i‡(
°©us
 !0 || 
	`°r°r
(
ouçut
, "warning")) {

453 i‡(
vîbo£
)

454 
	`¥ötf
("Compile %s for %s, status %i: %s\n",

455 
°©us
 ? "fail" : "warning",

456 
ã°
->
«me
, 
°©us
, 
ouçut
);

457 i‡((
ã°
->
°yÀ
 & 
EXECUTE
Ë&& !—e°->°yÀ & 
MAY_NOT_COMPILE
))

458 
	`îrx
(1, "Test for %s didÇot compile:\n%s",

459 
ã°
->
«me
, 
ouçut
);

460 
ã°
->
™swî
 = 
Ál£
;

461 
	`‰ì
(
ouçut
);

464 
	`‰ì
(
ouçut
);

466 i‡((
ã°
->
°yÀ
 & 
EXECUTE
Ë|| (ã°->°yÀ & 
INSIDE_MAIN
)) {

467 
ouçut
 = 
	`run
("./" 
OUTPUT_FILE
, &
°©us
);

468 i‡(!(
ã°
->
°yÀ
 & 
EXECUTE
Ë&& 
°©us
 != 0)

469 
	`îrx
(1, "Test for %s failed with %i:\n%s",

470 
ã°
->
«me
, 
°©us
, 
ouçut
);

471 i‡(
vîbo£
 && 
°©us
)

472 
	`¥ötf
("%†exôed %i\n", 
ã°
->
«me
, 
°©us
);

473 
	`‰ì
(
ouçut
);

475 
ã°
->
™swî
 = (
°©us
 == 0);

477 
ã°
->
d⁄e
 = 
åue
;

478  
ã°
->
™swî
;

479 
	}
}

481 
	$maö
(
¨gc
, c⁄° *
¨gv
[])

483 *
cmd
;

484 
i
;

485 c⁄° *
deÁu…_¨gs
[]

486 { "", 
DEFAULT_COMPILER
, 
DEFAULT_FLAGS
, 
NULL
 };

488 i‡(
¨gc
 > 1) {

489 i‡(
	`°rcmp
(
¨gv
[1], "--help") == 0) {

490 
	`¥ötf
("Usage: configurator [-v] [<compiler> <flags>...]\n"

493 
DEFAULT_COMPILER
, 
DEFAULT_FLAGS
);

494 
	`exô
(0);

496 i‡(
	`°rcmp
(
¨gv
[1], "-v") == 0) {

497 
¨gc
--;

498 
¨gv
++;

499 
vîbo£
 = 1;

500 } i‡(
	`°rcmp
(
¨gv
[1], "-vv") == 0) {

501 
¨gc
--;

502 
¨gv
++;

503 
vîbo£
 = 2;

507 i‡(
¨gc
 == 1)

508 
¨gv
 = 
deÁu…_¨gs
;

510 
cmd
 = 
	`c⁄√˘_¨gs
(
¨gv
, " -ÿ" 
OUTPUT_FILE
 " " 
INPUT_FILE
);

511 
i
 = 0; i < (
ã°s
)/(tests[0]); i++)

512 
	`run_ã°
(
cmd
, &
ã°s
[
i
]);

514 
	`u∆ök
(
OUTPUT_FILE
);

515 
	`u∆ök
(
INPUT_FILE
);

517 
	`¥ötf
("/* Generated by CCAN configurator */\n"

520 
	`¥ötf
("#ifndef _GNU_SOURCE\n");

521 
	`¥ötf
("#define _GNU_SOURCE /* Always use GNUÉxtensions. */\n");

522 
	`¥ötf
("#endif\n");

523 
	`¥ötf
("#deföêCCAN_COMPILER \"%s\"\n", 
¨gv
[1]);

524 
	`¥ötf
("#deföêCCAN_CFLAGS \"%s\"\n\n", 
	`c⁄√˘_¨gs
(
¨gv
+1, ""));

526 
	`¥ötf
("#define HAVE_CCAN 1\n");

527 
i
 = 0; i < (
ã°s
)/(tests[0]); i++)

528 
	`¥ötf
("#deföê%†%u\n", 
ã°s
[
i
].
«me
,Åe°s[i].
™swî
);

529 
	`¥ötf
("#endif /* CCAN_CONFIG_H */\n");

531 
	}
}

	@ccan/tools/depends.c

1 
	~<cˇn/°r/°r.h
>

2 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

3 
	~<cˇn/rbuf/rbuf.h
>

4 
	~<cˇn/èl/∑th/∑th.h
>

5 
	~<cˇn/compûî/compûî.h
>

6 
	~<cˇn/îr/îr.h
>

7 
	~"toﬁs.h
"

8 
	~<sys/ty≥s.h
>

9 
	~<sys/°©.h
>

10 
	~<f˙é.h
>

11 
	~<°dboﬁ.h
>

12 
	~<uni°d.h
>

13 
	~<î∫o.h
>

15 ** 
	$PRINTF_FMT
(2, 3)

16 
	$löes_‰om_cmd
(c⁄° *
˘x
, c⁄° *
f‹m©
, ...)

18 
va_li°
 
≠
;

19 *
cmd
;

20 
FILE
 *
p
;

21 
rbuf
 
ö
;

23 
	`va_°¨t
(
≠
, 
f‹m©
);

24 
cmd
 = 
	`èl_vfmt
(
˘x
, 
f‹m©
, 
≠
);

25 
	`va_íd
(
≠
);

27 
p
 = 
	`p›í
(
cmd
, "r");

28 i‡(!
p
)

29 
	`îr
(1, "Executög '%s'", 
cmd
);

32 
	`rbuf_öô
(&
ö
, 
	`fûío
(
p
), 
	`èl_¨r
(
˘x
, , 0), 0);

33 i‡(!
	`rbuf_ªad_°r
(&
ö
, 0, 
do_èl_ªÆloc
Ë&& 
î∫o
)

34 
	`îr
(1, "Ródög from '%s'", 
cmd
);

35 
	`p˛o£
(
p
);

37  
	`èl_°r•lô
(
˘x
, 
ö
.
buf
, "\n", 
STR_EMPTY_OK
);

38 
	}
}

42 *
	$compûe_öfo
(c⁄° *
˘x
, c⁄° *
dú
)

44 *
öfo_c_fûe
, *
öfo
, *
compûed
, *
ouçut
;

45 
size_t
 
Àn
;

46 
fd
;

49 
öfo
 = 
	`èl_gøb_fûe
(
˘x
, 
	`èl_fmt
(˘x, "%s/_öfo", 
dú
), &
Àn
);

50 i‡(!
öfo
)

51  
NULL
;

53 
öfo_c_fûe
 = 
	`ãmp_fûe
(
˘x
, ".c", "_info");

54 
fd
 = 
	`›í
(
öfo_c_fûe
, 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0600);

55 i‡(
fd
 < 0)

56  
NULL
;

57 i‡(!
	`wrôe_Æl
(
fd
, 
öfo
, 
Àn
))

58  
NULL
;

60 i‡(
	`˛o£
(
fd
) != 0)

61  
NULL
;

63 
compûed
 = 
	`ãmp_fûe
(
˘x
, "", "info");

64 i‡(
	`compûe_™d_lök
(
˘x
, 
öfo_c_fûe
, 
	`föd_cˇn_dú
(
dú
), "",

65 
compûî
, 
cÊags
, "", 
compûed
, &
ouçut
))

66  
compûed
;

67  
NULL
;

68 
	}
}

70 **
gë_⁄e_dïs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

71 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
))

73 **
	gdïs
, *
	gcmd
;

74 *
	göfofûe
 = 
gë_öfo
(
˘x
, 
dú
);

76 i‡(!
	göfofûe
)

77  
	gNULL
;

79 
	gcmd
 = 
èl_fmt
(
˘x
, "%†%s", 
öfofûe
, 
°yÀ
);

80 
	gdïs
 = 
löes_‰om_cmd
(
cmd
, "%s", cmd);

81 i‡(!
	gdïs
) {

83 i‡(
°ªq
(
°yÀ
, "depends"))

84 
îr
(1, "CouldÇŸÑu¿'%s'", 
cmd
);

85 
	gdïs
 = 
èl
(
˘x
, *);

86 
	gdïs
[0] = 
NULL
;

88  
	gdïs
;

92 *
	$ª∂a˚
(c⁄° *
˘x
, c⁄° *
§c
,

93 c⁄° *
‰om
, c⁄° *
to
)

95 *
ªt
 = 
	`èl_°rdup
(
˘x
, "");

96 
æí
, 
Àn
, 
add
;

98 
æí
 = 
Àn
 = 0;

100 c⁄° *
√xt
 = 
	`°r°r
(
§c
+
Àn
, 
‰om
);

101 i‡(!
√xt
)

102 
add
 = 
	`°æí
(
§c
+
Àn
) + 1;

104 
add
 = 
√xt
 - (
§c
+
Àn
);

106 
	`èl_ªsize
(&
ªt
, 
æí
 + 
add
 + 
	`°æí
(
to
)+1);

107 
	`mem˝y
(
ªt
+
æí
, 
§c
+
Àn
, 
add
);

108 i‡(!
√xt
)

109  
ªt
;

110 
Àn
 +
add
;

111 
æí
 +
add
;

112 
	`°r˝y
(
ªt
+
æí
, 
to
);

113 
æí
 +
	`°æí
(
to
);

114 
Àn
 +
	`°æí
(
‰om
);

116 
	}
}

119 **
gë_⁄e_ß„_dïs
(c⁄° *
˘x
,

120 c⁄° *
dú
,

121 c⁄° *
°yÀ
,

122 *(*
unu£d
)(const *, const *))

124 **
	gdïs
, **
	glöes
, *
	gøw
, *
	g‚ame
;

125 
	gi
, 
	gn
;

126 
boﬁ
 
	gc‹ª˘_°yÀ
 = 
Ál£
;

128 
	g‚ame
 = 
∑th_joö
(
˘x
, 
dú
, "_info");

129 
	gøw
 = 
èl_gøb_fûe
(
‚ame
, f«me, 
NULL
);

130 i‡(!
	gøw
)

131 
îrx
(1, "CouldÇŸ o≥¿%s", 
‚ame
);

134 
	glöes
 = 
èl_°r•lô
(
øw
, 
ª∂a˚
(raw,Ñaw, "\\n", "\n"), "\n",

135 
STR_EMPTY_OK
);

137 
	gdïs
 = 
èl_¨r
(
˘x
, *, 
èl_cou¡
(
löes
));

139 
	gn
 = 
i
 = 0; 
	glöes
[i]; 
	gi
++) {

140 *
	g°r
;

141 
	gÀn
;

144 i‡(
	glöes
[
i
][0] == '#')

147 i‡(
°r°r
(
löes
[
i
], "\"testdepends\""))

148 
	gc‹ª˘_°yÀ
 = 
°ªq
(
°yÀ
, "testdepends");

149 i‡(
°r°r
(
löes
[
i
], "\"depends\""))

150 
	gc‹ª˘_°yÀ
 = 
°ªq
(
°yÀ
, "depends");

152 i‡(!
	gc‹ª˘_°yÀ
)

156 i‡(
°r°¨ts
(
löes
[
i
], "ccan/"))

157 
	g°r
 = 
löes
[
i
];

159 
	g°r
 = 
°r°r
(
löes
[
i
], "\"ccan/");

160 i‡(!
	g°r
)

162 
	g°r
++;

165 
	gÀn
 = 
°r•n
(
°r
, "/abcdefghijklmnopqrstuvxwyz12345678980_");

166 i‡(
	gÀn
 == 5)

168 
	gdïs
[
n
++] = 
èl_°∫dup
(
dïs
, 
°r
, 
Àn
);

170 
	gdïs
[
n
] = 
NULL
;

171 
èl_‰ì
(
‚ame
);

174 
èl_ªsize
(&
dïs
, 
n
 + 1);

175  
	gdïs
;

178 
boﬁ
 
	$have_dï
(**
dïs
, c⁄° *
dï
)

180 
i
;

182 
i
 = 0; 
dïs
[i]; i++)

183 i‡(
	`°ªq
(
dïs
[
i
], 
dï
))

184  
åue
;

185  
Ál£
;

186 
	}
}

192 
gë_Æl_dïs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

193 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
),

194 **(*
gë_⁄e
)(const *, const *, const *,

195 *(*
gë_öfo
)(const *, const *)))

197 **
	gdïs
;

198 
	gi
;

200 
	gdïs
 = 
gë_⁄e
(
˘x
, 
dú
, 
°yÀ
, 
gë_öfo
);

201 i‡(!
	gdïs
)

202  
	gNULL
;

203 
	gi
 = 0; i < 
èl_cou¡
(
dïs
)-1; i++) {

204 **
	g√wdïs
;

205 
	gj
;

206 *
	gsubdú
;

208 i‡(!
°r°¨ts
(
dïs
[
i
], "ccan/"))

211 
	gsubdú
 = 
∑th_joö
(
˘x
, 
föd_cˇn_dú
(
dú
), 
dïs
[
i
]);

212 
	g√wdïs
 = 
gë_⁄e
(
˘x
, 
subdú
, "dïíds", 
gë_öfo
);

215 
	gj
 = 0; j < 
èl_cou¡
(
√wdïs
)-1; j++) {

216 
	gnum
;

218 i‡(
have_dï
(
dïs
, 
√wdïs
[
j
]))

221 
	gnum
 = 
èl_cou¡
(
dïs
)-1;

222 
èl_ªsize
(&
dïs
, 
num
 + 2);

223 
	gdïs
[
num
] = 
√wdïs
[
j
];

224 
	gdïs
[
num
+1] = 
NULL
;

227  
	gdïs
;

231 **
gë_⁄e_libs
(c⁄° *
˘x
, c⁄° *
dú
,

232 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
))

234 *
	gcmd
, **
	glöes
;

236 
	gcmd
 = 
èl_fmt
(
˘x
, "%†libs", 
gë_öfo
(˘x, 
dú
));

237 
	glöes
 = 
löes_‰om_cmd
(
cmd
, "%s", cmd);

239 i‡(
	glöes
)

240 
èl_ªsize
(&
löes
, 
èl_cou¡
(lines)-1);

241  
	glöes
;

245 **
	$add_dïs
(**
dïs1
, **
dïs2
)

247 
i
, 
Àn
;

249 
Àn
 = 
	`èl_cou¡
(
dïs1
);

251 
i
 = 0; 
dïs2
[i]; i++) {

252 i‡(
	`have_dï
(
dïs1
, 
dïs2
[
i
]))

254 
	`èl_ªsize
(&
dïs1
, 
Àn
 + 1);

255 
dïs1
[
Àn
-1] = 
	`èl_°rdup
(dïs1, 
dïs2
[
i
]);

256 
dïs1
[
Àn
++] = 
NULL
;

258  
dïs1
;

259 
	}
}

261 **
gë_libs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

262 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
))

264 **
	gdïs
, **
	glibs
;

265 
	gi
, 
	gÀn
;

267 
	glibs
 = 
gë_⁄e_libs
(
˘x
, 
dú
, 
gë_öfo
);

268 
	gÀn
 = 
èl_cou¡
(
libs
);

270 i‡(
	g°yÀ
) {

271 
	gdïs
 = 
gë_dïs
(
˘x
, 
dú
, 
°yÀ
, 
åue
, 
gë_öfo
);

272 i‡(
°ªq
(
°yÀ
, "testdepends"))

273 
	gdïs
 = 
add_dïs
(
dïs
,

274 
gë_dïs
(
˘x
, 
dú
, "dïíds", 
åue
,

275 
gë_öfo
));

277 
	gi
 = 0; 
	gdïs
[
i
]; i++) {

278 **
	g√wlibs
, *
	gsubdú
;

279 
size_t
 
	g√wÀn
;

281 i‡(!
°r°¨ts
(
dïs
[
i
], "ccan/"))

284 
	gsubdú
 = 
∑th_joö
(
˘x
, 
föd_cˇn_dú
(
dú
), 
dïs
[
i
]);

286 
	g√wlibs
 = 
gë_⁄e_libs
(
˘x
, 
subdú
, 
gë_öfo
);

287 
	g√wÀn
 = 
èl_cou¡
(
√wlibs
);

288 
èl_ªsize
(&
libs
, 
Àn
 + 
√wÀn
);

289 
mem˝y
(&
libs
[
Àn
], 
√wlibs
,

290 (
√wlibs
[0])*
√wÀn
);

291 
	gÀn
 +
√wÀn
;

296 
èl_ªsize
(&
libs
, 
Àn
 + 1);

297 
	glibs
[
Àn
] = 
NULL
;

298  
	glibs
;

302 **
	$uniquify_dïs
(**
dïs
)

304 
i
, 
j
, 
num
;

306 i‡(!
dïs
)

307  
NULL
;

309 
num
 = 
	`èl_cou¡
(
dïs
) - 1;

310 
i
 = 0; i < 
num
; i++) {

311 
j
 = 
i
 + 1; j < 
num
; j++) {

312 i‡(
	`°ªq
(
dïs
[
i
], dïs[
j
])) {

313 
	`memmove
(&
dïs
[
j
], &deps[j+1],

314 (
num
 - 
j
 - 1) * (*));

315 
num
--;

319 
dïs
[
num
] = 
NULL
;

321 
	`èl_ªsize
(&
dïs
, 
num
 + 1);

322  
dïs
;

323 
	}
}

325 **
gë_dïs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

326 
boﬁ
 
ªcur£
,

327 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
))

329 **
	gªt
;

331 i‡(!
	gªcur£
) {

332 
	gªt
 = 
gë_⁄e_dïs
(
˘x
, 
dú
, 
°yÀ
, 
gë_öfo
);

334 
	gªt
 = 
gë_Æl_dïs
(
˘x
, 
dú
, 
°yÀ
, 
gë_öfo
, 
gë_⁄e_dïs
);

336  
uniquify_dïs
(
ªt
);

339 **
	$gë_ß„_cˇn_dïs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

340 
boﬁ
 
ªcur£
)

342 **
ªt
;

343 i‡(!
ªcur£
) {

344 
ªt
 = 
	`gë_⁄e_ß„_dïs
(
˘x
, 
dú
, 
°yÀ
, 
NULL
);

346 
ªt
 = 
	`gë_Æl_dïs
(
˘x
, 
dú
, 
°yÀ
, 
NULL
, 
gë_⁄e_ß„_dïs
);

348  
	`uniquify_dïs
(
ªt
);

349 
	}
}

	@ccan/tools/doc_extract-core.c

2 
	~<cˇn/èke/èke.h
>

3 
	~<cˇn/°r/°r.h
>

4 
	~<îr.h
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<°rög.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/°©.h
>

11 
	~<f˙é.h
>

12 
	~<°dboﬁ.h
>

13 
	~<˘y≥.h
>

14 
	~"doc_exåa˘.h
"

15 
	~"toﬁs.h
"

17 **
	$gøb_doc
(**
löes
, **
löem≠
,

18 c⁄° *
fûe
)

20 **
ªt
;

21 
i
, 
num
;

22 
boﬁ
 
¥ötög
 = 
Ál£
;

24 
ªt
 = 
	`èl_¨r
(
NULL
, *, 
	`èl_cou¡
(
löes
));

25 *
löem≠
 = 
	`èl_¨r
(
ªt
, , 
	`èl_cou¡
(
löes
));

27 
num
 = 0;

28 
i
 = 0; 
löes
[i]; i++) {

29 i‡(
	`°ªq
(
löes
[
i
], "/**")) {

30 
¥ötög
 = 
åue
;

31 i‡(
num
 != 0) {

32 
ªt
[
num
-1] = 
	`èl_°rˇt
(
NULL
,

33 
	`èke
(
ªt
[
num
-1]), "\n");

35 } i‡(
	`°ªq
(
löes
[
i
], " */"))

36 
¥ötög
 = 
Ál£
;

37 i‡(
¥ötög
) {

38 i‡(
	`°r°¨ts
(
löes
[
i
], " * "))

39 
ªt
[
num
++] = 
	`èl_°rdup
‘ë, 
löes
[
i
]+3);

40 i‡(
	`°r°¨ts
(
löes
[
i
], " *"))

41 
ªt
[
num
++] = 
	`èl_°rdup
‘ë, 
löes
[
i
]+2);

44 
boﬁ
 
w¨√d
;

45 i‡(!
w¨√d
) {

46 
	`w¨nx
("%s:%u:"

48 
fûe
, 
i
+1);

49 
w¨√d
++;

51 
ªt
[
num
++] = 
	`èl_°rdup
‘ë, 
löes
[
i
]);

52 i‡(
	`°r°r
(
löes
[
i
], "*/"))

53 
¥ötög
 = 
Ál£
;

55 (*
löem≠
)[
num
-1] = 
i
;

58 
ªt
[
num
] = 
NULL
;

59  
ªt
;

60 
	}
}

62 
boﬁ
 
	$is_bœnk
(c⁄° *
löe
)

64  
löe
 &&Üöe[
	`°r•n
(line, " \t\n")] == '\0';

65 
	}
}

67 *
	$is_£˘i⁄
(c⁄° *
˘x
, c⁄° *
löe
, **
vÆue
)

69 *
£˙ame
;

72 i‡(!
	`èl_°ºeg
(
˘x
, 
löe
,

74 &
£˙ame
, 
NULL
, 
vÆue
))

75  
NULL
;

77  
£˙ame
;

78 
	}
}

81 
	$is_summ¨y_löe
(c⁄° *
löe
)

83 
id_Àn
;

86 
id_Àn
 = 
	`°r•n
(
löe
, 
IDENT_CHARS
" /");

87 i‡(
id_Àn
 == 0)

89 i‡(
	`°r•n
(
löe
, " "Ë=
id_Àn
)

91 i‡(!
	`°r°¨ts
(
löe
 + 
id_Àn
-1, " - "))

93  
id_Àn
 - 1;

94 
	}
}

96 
boﬁ
 
	$em±y_£˘i⁄
(
doc_£˘i⁄
 *
d
)

98 
i
;

100 
i
 = 0; i < 
d
->
num_löes
; i++)

101 i‡(!
	`is_bœnk
(
d
->
löes
[
i
]))

102  
Ál£
;

103  
åue
;

104 
	}
}

106 
doc_£˘i⁄
 *
	$√w_£˘i⁄
(
li°_hód
 *
li°
,

107 c⁄° *
fun˘i⁄
,

108 c⁄° *
ty≥
,

109 
§˛öe
)

111 
doc_£˘i⁄
 *
d
;

112 *
lowîty≥
;

113 
i
;

116 
d
 = 
	`li°_èû
(
li°
, 
doc_£˘i⁄
,Üist);

117 i‡(
d
 && 
	`em±y_£˘i⁄
(d)) {

118 
	`li°_dñ
(&
d
->
li°
);

119 
	`èl_‰ì
(
d
);

122 
d
 = 
	`èl
(
li°
, 
doc_£˘i⁄
);

123 
d
->
fun˘i⁄
 = function;

124 
lowîty≥
 = 
	`èl_¨r
(
d
, , 
	`°æí
(
ty≥
) + 1);

126 
i
 = 0; i < 
	`°æí
(
ty≥
)+1; i++)

127 
lowîty≥
[
i
] = 
	`tﬁowî
(
ty≥
[i]);

128 
d
->
ty≥
 = 
lowîty≥
;

129 
d
->
löes
 = 
	`èl_¨r
(d, *, 0);

130 
d
->
num_löes
 = 0;

131 
d
->
§˛öe
 = srcline;

133 
	`li°_add_èû
(
li°
, &
d
->list);

134  
d
;

135 
	}
}

137 
	$add_löe
(
doc_£˘i⁄
 *
cuº
, c⁄° *
löe
)

139 *
mylöe
 = 
	`èl_°rdup
(
cuº
->
löes
, 
löe
);

140 
	`èl_ex∑nd
(&
cuº
->
löes
, &
mylöe
, 1);

141 
cuº
->
num_löes
++;

142 
	}
}

145 
	$add_dëabbed_löe
(
doc_£˘i⁄
 *
cuº
, c⁄° *
øwlöe
)

147 
i
, 
eff_i
, 
Àn
, 
off
 = 0;

148 *
löe
;

151 
löe
 = 
	`èl_¨r
(
cuº
, , 
	`°æí
(
øwlöe
) +

152 
	`°rcou¡
(
øwlöe
, "\t") * 7 + 1);

153 
Àn
 = 0;

156 
i
 = 
eff_i
 = 0; i < 
	`°æí
(
øwlöe
); i++) {

157 i‡(
øwlöe
[
i
] == '\t') {

159 
löe
[
Àn
++] = ' ';

160 
eff_i
++;

161 } 
eff_i
 % 8 != 0);

163 
löe
[
Àn
++] = 
øwlöe
[
i
];

164 i‡(
off
 =0 && 
øwlöe
[
i
] == '*')

165 
off
 = 
i
 + 1;

166 
eff_i
++;

169 
löe
[
Àn
] = '\0';

171 
	`add_löe
(
cuº
, 
löe
 + 
off
);

172 
	`èl_‰ì
(
löe
);

173 
	}
}

177 
	$åim_löes
(
doc_£˘i⁄
 *
cuº
)

179 
i
, 
åim
 = -1;

180 
œ°_n⁄_em±y
 = -1;

183 
i
 = 0; i < 
cuº
->
num_löes
; i++) {

184 
¥efix
 = 
	`°r•n
(
cuº
->
löes
[
i
], " ");

186 i‡(
cuº
->
löes
[
i
][
¥efix
] == '\0')

188 i‡(
¥efix
 < 
åim
)

189 
åim
 = 
¥efix
;

193 
i
 = 0; i < 
cuº
->
num_löes
; i++) {

194 
¥efix
 = 
	`°r•n
(
cuº
->
löes
[
i
], " ");

195 i‡(
¥efix
 < 
åim
)

196 
cuº
->
löes
[
i
] +
¥efix
;

198 
cuº
->
löes
[
i
] +
åim
;

201 i‡(
cuº
->
löes
[
i
][
	`°r•n
(curr->lines[i], " \t")] != '\0')

202 
œ°_n⁄_em±y
 = 
i
;

206 
cuº
->
num_löes
 = 
œ°_n⁄_em±y
 + 1;

207 
	}
}

209 
li°_hód
 *
	$exåa˘_doc_£˘i⁄s
(**
øwlöes
, c⁄° *
fûe
)

211 *
löem≠
;

212 **
löes
 = 
	`gøb_doc
(
øwlöes
, &
löem≠
, 
fûe
);

213 c⁄° *
fun˘i⁄
 = 
NULL
;

214 
doc_£˘i⁄
 *
cuº
 = 
NULL
;

215 
i
;

216 
li°_hód
 *
li°
;

218 
li°
 = 
	`èl
(
NULL
, 
li°_hód
);

219 
	`li°_hód_öô
(
li°
);

221 
i
 = 0; 
löes
[i]; i++) {

222 
fun˛í
;

223 *
ty≥
, *
exåa
;

225 
fun˛í
 = 
	`is_summ¨y_löe
(
löes
[
i
]);

226 i‡(
fun˛í
) {

227 
fun˘i⁄
 = 
	`èl_°∫dup
(
li°
, 
löes
[
i
], 
fun˛í
);

228 
cuº
 = 
	`√w_£˘i⁄
(
li°
, 
fun˘i⁄
, "summary",

229 
löem≠
[
i
]);

230 
	`add_löe
(
cuº
, 
löes
[
i
] + 
fun˛í
 + 3);

231 
cuº
 = 
	`√w_£˘i⁄
(
li°
, 
fun˘i⁄
, "description",

232 
löem≠
[
i
]);

233 } i‡((
ty≥
 = 
	`is_£˘i⁄
(
li°
, 
löes
[
i
], &
exåa
)Ë!
NULL
){

234 
cuº
 = 
	`√w_£˘i⁄
(
li°
, 
fun˘i⁄
, 
ty≥
, 
löem≠
[
i
]);

235 i‡(!
	`°ªq
(
exåa
, "")) {

236 
	`add_löe
(
cuº
, 
exåa
);

237 
cuº
 = 
NULL
;

240 i‡(
cuº
)

241 
	`add_dëabbed_löe
(
cuº
, 
øwlöes
[
löem≠
[
i
]]);

245 
	`li°_f‹_óch
(
li°
, 
cuº
,Üist)

246 
	`åim_löes
(
cuº
);

248 
	`èl_‰ì
(
löes
);

249  
li°
;

250 
	}
}

	@ccan/tools/doc_extract.c

2 
	~<cˇn/°r/°r.h
>

3 
	~<cˇn/îr/îr.h
>

4 
	~"toﬁs.h
"

5 
	~<°rög.h
>

6 
	~<°dio.h
>

7 
	~"doc_exåa˘.h
"

10 
boﬁ
 
	$ty≥m©ch
(c⁄° *
a
, c⁄° *
b
)

12 
size_t
 
i
;

14 
i
 = 0; 
a
[i]; i++) {

15 i‡(
	`ciß um
(
a
[
i
])) {

16 i‡(
a
[
i
] !
b
[i])

17  
Ál£
;

19 i‡(
	`ciß um
(
b
[
i
]))

20  
Ál£
;

23  
b
[
i
] == '\0';

24 
	}
}

26 
	$maö
(
¨gc
, *
¨gv
[])

28 
i
;

29 c⁄° *
ty≥
;

30 c⁄° *
fun˘i⁄
 = 
NULL
;

32 i‡(
¨gc
 < 3)

33 
	`îrx
(1, "Usage: doc_extract [--function=<funcname>] TYPE <file>...\n"

36 i‡(
	`°r°¨ts
(
¨gv
[1], "--function=")) {

37 
fun˘i⁄
 = 
¨gv
[1] + 
	`°æí
("--function=");

38 
¨gv
++;

39 
¨gc
--;

42 
ty≥
 = 
¨gv
[1];

43 
i
 = 2; i < 
¨gc
; i++) {

44 *
fûe
, **
löes
;

45 
li°_hód
 *
li°
;

46 
doc_£˘i⁄
 *
d
;

48 
fûe
 = 
	`èl_gøb_fûe
(
NULL
, 
¨gv
[
i
], NULL);

49 i‡(!
fûe
)

50 
	`îr
(1, "Ródög fûê%s", 
¨gv
[
i
]);

51 
löes
 = 
	`èl_°r•lô
(
fûe
, fûe, "\n", 
STR_EMPTY_OK
);

53 
li°
 = 
	`exåa˘_doc_£˘i⁄s
(
löes
, 
¨gv
[
i
]);

54 i‡(
	`li°_em±y
(
li°
))

55 
	`îrx
(1, "Nÿdocumíèti⁄ i¿fûê%s", 
¨gv
[
i
]);

56 
	`èl_‰ì
(
fûe
);

58 i‡(
	`°ªq
(
ty≥
, "functions")) {

59 c⁄° *
œ°
 = 
NULL
;

60 
	`li°_f‹_óch
(
li°
, 
d
,Üist) {

61 i‡(
d
->
fun˘i⁄
) {

62 i‡(!
œ°
 || !
	`°ªq
(
d
->
fun˘i⁄
,Üast))

63 
	`¥ötf
("%s\n", 
d
->
fun˘i⁄
);

64 
œ°
 = 
d
->
fun˘i⁄
;

68 
j
;

69 
	`li°_f‹_óch
(
li°
, 
d
,Üist) {

70 i‡(
fun˘i⁄
) {

71 i‡(!
d
->
fun˘i⁄
)

73 i‡(!
	`°ªq
(
d
->
fun˘i⁄
, function))

76 i‡(
	`°ªq
(
ty≥
, "all"))

77 
	`¥ötf
("%s:\n", 
d
->
ty≥
);

78 i‡(!
	`ty≥m©ch
(
d
->
ty≥
,Åype))

81 
j
 = 0; j < 
d
->
num_löes
; j++)

82 
	`¥ötf
("%s\n", 
d
->
löes
[
j
]);

85 
	`èl_‰ì
(
li°
);

88 
	}
}

	@ccan/tools/doc_extract.h

1 #i‚de‡
_DOC_EXTRACT_CORE_H


2 
	#_DOC_EXTRACT_CORE_H


	)

3 
	~<°dboﬁ.h
>

4 
	~<cˇn/li°/li°.h
>

6 
	sdoc_£˘i⁄
 {

7 
li°_node
 
	mli°
;

8 c⁄° *
	mfun˘i⁄
;

9 c⁄° *
	mty≥
;

11 
	m§˛öe
;

12 
	mnum_löes
;

13 **
	mlöes
;

16 
li°_hód
 *
exåa˘_doc_£˘i⁄s
(**
øwlöes
, c⁄° *
fûe
);

	@ccan/tools/manifest.c

1 
	~"c⁄fig.h
"

2 
	~"m™i„°.h
"

3 
	~"toﬁs.h
"

4 
	~<cˇn/°r/°r.h
>

5 
	~<cˇn/èl/lök/lök.h
>

6 
	~<cˇn/èl/∑th/∑th.h
>

7 
	~<cˇn/hash/hash.h
>

8 
	~<cˇn/hèbÀ/hèbÀ_ty≥.h
>

9 
	~<cˇn/n€º/n€º.h
>

10 
	~<cˇn/f‹óch/f‹óch.h
>

11 
	~<cˇn/as‹t/as‹t.h
>

12 
	~<cˇn/¨øy_size/¨øy_size.h
>

13 
	~<cˇn/îr/îr.h
>

14 
	~<uni°d.h
>

15 
	~<sys/ty≥s.h
>

16 
	~<sys/°©.h
>

17 
	~<f˙é.h
>

18 
	~<î∫o.h
>

19 
	~<dúít.h
>

20 
	~<˘y≥.h
>

21 
	~<°d¨g.h
>

22 
	~<as£π.h
>

24 
size_t
 
	$dú_hash
(c⁄° *
«me
)

26  
	`hash
(
«me
, 
	`°æí
(name), 0);

27 
	}
}

29 c⁄° *
	$m™i„°_«me
(c⁄° 
m™i„°
 *
m
)

31  
m
->
dú
;

32 
	}
}

34 
boﬁ
 
	$dú_cmp
(c⁄° 
m™i„°
 *
m
, c⁄° *
dú
)

36  
	`°rcmp
(
m
->
dú
, dir) == 0;

37 
	}
}

39 
HTABLE_DEFINE_TYPE
(
m™i„°
, 
m™i„°_«me
, 
dú_hash
, 
dú_cmp
,

40 
hèbÀ_m™i„°
);

41 
hèbÀ_m™i„°
 *
	gm™i„°s
;

43 c⁄° *
	$gë_cˇn_fûe_c⁄ã¡s
(
cˇn_fûe
 *
f
)

45 i‡(!
f
->
c⁄ã¡s
) {

46 
f
->
c⁄ã¡s
 = 
	`èl_gøb_fûe
(f, f->
fuŒ«me
,

47 &
f
->
c⁄ã¡s_size
);

48 i‡(!
f
->
c⁄ã¡s
)

49 
	`îr
(1, "Ródög fûê%s", 
f
->
fuŒ«me
);

51  
f
->
c⁄ã¡s
;

52 
	}
}

54 **
	$gë_cˇn_fûe_löes
(
cˇn_fûe
 *
f
)

56 i‡(!
f
->
löes
)

57 
f
->
löes
 = 
	`èl_°r•lô
(f, 
	`gë_cˇn_fûe_c⁄ã¡s
(f), "\n",

58 
STR_EMPTY_OK
);

60  
f
->
löes
;

61 
	}
}

63 
cˇn_fûe
 *
	$√w_cˇn_fûe
(c⁄° *
˘x
, c⁄° *
dú
,

64 c⁄° *
«me
)

66 
cˇn_fûe
 *
f
;

67 
i
;

69 
	`as£π
(
dú
[0] == '/');

71 
f
 = 
	`èl
(
˘x
, 
cˇn_fûe
);

72 
f
->
löes
 = 
NULL
;

73 
f
->
löe_öfo
 = 
NULL
;

74 
f
->
doc_£˘i⁄s
 = 
NULL
;

75 
i
 = 0; i < 
	`ARRAY_SIZE
(
f
->
compûed
); i++)

76 
f
->
compûed
[
i
] = 
NULL
;

77 
f
->
«me
 = 
	`èl_°rdup
(f,Çame);

78 
f
->
fuŒ«me
 = 
	`∑th_joö
(f, 
dú
, f->
«me
);

79 
f
->
c⁄ã¡s
 = 
NULL
;

80 
f
->
sim∂ifõd
 = 
NULL
;

81  
f
;

82 
	}
}

84 
	$add_fûes
(
m™i„°
 *
m
, c⁄° *
ba£
, c⁄° *
subdú
)

86 
DIR
 *
d
;

87 
dúít
 *
ít
;

88 **
subs
 = 
	`èl_¨r
(
m
, *, 0);

89 c⁄° *
thisdú
;

91 i‡(!
subdú
)

92 
thisdú
 = 
ba£
;

94 
thisdú
 = 
	`∑th_joö
(
subs
, 
ba£
, 
subdú
);

96 
d
 = 
	`›ídú
(
thisdú
);

97 i‡(!
d
)

98 
	`îr
(1, "O≥nög dúe˘‹y %s", 
thisdú
);

100 (
ít
 = 
	`ªaddú
(
d
)Ë!
NULL
) {

101 
°©
 
°
;

102 
cˇn_fûe
 *
f
;

103 
li°_hód
 *
de°
;

104 
boﬁ
 
is_c_§c
;

106 i‡(
ít
->
d_«me
[0] == '.')

109 
f
 = 
	`√w_cˇn_fûe
(
m
, m->
dú
,

110 
subdú
 ? 
	`∑th_joö
(
m
, subdú, 
ít
->
d_«me
)

111 : 
ít
->
d_«me
);

112 i‡(
	`l°©
(
f
->
fuŒ«me
, &
°
) != 0)

113 
	`îr
(1, "l°© %s", 
f
->
fuŒ«me
);

115 i‡(
	`S_ISDIR
(
°
.
°_mode
)) {

116 
size_t
 
Àn
 = 
	`èl_cou¡
(
subs
);

117 
	`èl_ªsize
(&
subs
, 
Àn
+1);

118 
subs
[
Àn
] = 
	`èl_°rˇt
(subs, 
f
->
«me
, "/");

121 i‡(!
	`S_ISREG
(
°
.
°_mode
)) {

122 
	`èl_‰ì
(
f
);

126 i‡(
	`°ªq
(
f
->
«me
, "_info")) {

127 
m
->
öfo_fûe
 = 
f
;

131 
is_c_§c
 = 
	`°ªnds
(
f
->
«me
, ".c");

132 i‡(!
is_c_§c
 && !
	`°ªnds
(
f
->
«me
, ".h")) {

133 
de°
 = &
m
->
Ÿhî_fûes
;

134 } i‡(!
	`°rchr
(
f
->
«me
, '/')) {

135 i‡(
is_c_§c
)

136 
de°
 = &
m
->
c_fûes
;

138 
de°
 = &
m
->
h_fûes
;

139 } i‡(
	`°r°¨ts
(
f
->
«me
, "test/")) {

140 i‡(
is_c_§c
) {

141 i‡(
	`°r°¨ts
(
f
->
«me
, "test/api"))

142 
de°
 = &
m
->
≠i_ã°s
;

143 i‡(
	`°r°¨ts
(
f
->
«me
, "test/run"))

144 
de°
 = &
m
->
run_ã°s
;

145 i‡(
	`°r°¨ts
(
f
->
«me
, "test/compile_ok"))

146 
de°
 = &
m
->
compûe_ok_ã°s
;

147 i‡(
	`°r°¨ts
(
f
->
«me
, "test/compile_fail"))

148 
de°
 = &
m
->
compûe_Áû_ã°s
;

150 
de°
 = &
m
->
Ÿhî_ã°_c_fûes
;

152 
de°
 = &
m
->
Ÿhî_ã°_fûes
;

154 
de°
 = &
m
->
Ÿhî_fûes
;

156 
	`li°_add
(
de°
, &
f
->
li°
);

158 
	`˛o£dú
(
d
);

161 i‡(!
subdú
) {

162 
size_t
 
i
;

164 i‡(!
m
->
öfo_fûe


165 && 
	`li°_em±y
(&
m
->
c_fûes
)

166 && 
	`li°_em±y
(&
m
->
h_fûes
))

167 
	`îrx
(1, "No _info, C or H files found here!");

169 
i
 = 0; i < 
	`èl_cou¡
(
subs
); i++)

170 
	`add_fûes
(
m
, 
ba£
, 
subs
[
i
]);

172 
	`èl_‰ì
(
subs
);

173 
	}
}

175 
	$cmp_«mes
(
cˇn_fûe
 *c⁄° *
a
, cˇn_fûê*c⁄° *
b
,

176 *
unu£d
)

178  
	`°rcmp
((*
a
)->
«me
, (*
b
)->name);

179 
	}
}

181 
	$s‹t_fûes
(
li°_hód
 *
li°
)

183 
cˇn_fûe
 **
fûes
 = 
	`èl_¨r
(
NULL
, cˇn_fûê*, 0), *
f
;

184 
i
;

186 (
f
 = 
	`li°_t›
(
li°
, 
cˇn_fûe
,Üi°)Ë!
NULL
) {

187 
	`èl_ex∑nd
(&
fûes
, &
f
, 1);

188 
	`li°_dñ
(&
f
->
li°
);

190 
	`as‹t
(
fûes
, 
	`èl_cou¡
(fûes), 
cmp_«mes
, 
NULL
);

192 
i
 = 0; i < 
	`èl_cou¡
(
fûes
); i++)

193 
	`li°_add_èû
(
li°
, &
fûes
[
i
]->list);

194 
	`èl_‰ì
(
fûes
);

195 
	}
}

197 
m™i„°
 *
	$gë_m™i„°
(c⁄° *
˘x
, c⁄° *
dú
)

199 
m™i„°
 *
m
;

200 *
ˇn⁄_dú
;

201 
Àn
;

202 
li°_hód
 *
li°
;

204 i‡(!
m™i„°s
) {

205 
m™i„°s
 = 
	`èl
(
NULL
, 
hèbÀ_m™i„°
);

206 
	`hèbÀ_m™i„°_öô
(
m™i„°s
);

209 
ˇn⁄_dú
 = 
	`∑th_ˇn⁄
(
˘x
, 
dú
);

210 i‡(!
ˇn⁄_dú
)

211 
	`îr
(1, "Gëtög c™⁄iˇ»vîsi⁄ o‡dúe˘‹y %s", 
dú
);

213 
m
 = 
	`hèbÀ_m™i„°_gë
(
m™i„°s
, 
ˇn⁄_dú
);

214 i‡(
m
)

215  
m
;

217 
m
 = 
	`èl_lökabÀ
(
	`èl
(
NULL
, 
m™i„°
));

218 
m
->
öfo_fûe
 = 
NULL
;

219 
m
->
compûed
[
COMPILE_NORMAL
] = m->compûed[
COMPILE_NOFEAT
] = 
NULL
;

220 
m
->
dú
 = 
	`èl_°ól
(m, 
ˇn⁄_dú
);

221 
	`li°_hód_öô
(&
m
->
c_fûes
);

222 
	`li°_hód_öô
(&
m
->
h_fûes
);

223 
	`li°_hód_öô
(&
m
->
≠i_ã°s
);

224 
	`li°_hód_öô
(&
m
->
run_ã°s
);

225 
	`li°_hód_öô
(&
m
->
compûe_ok_ã°s
);

226 
	`li°_hód_öô
(&
m
->
compûe_Áû_ã°s
);

227 
	`li°_hód_öô
(&
m
->
Ÿhî_ã°_c_fûes
);

228 
	`li°_hód_öô
(&
m
->
Ÿhî_ã°_fûes
);

229 
	`li°_hód_öô
(&
m
->
Ÿhî_fûes
);

230 
	`li°_hód_öô
(&
m
->
exam∂es
);

231 
	`li°_hód_öô
(&
m
->
m™gÀd_exam∂es
);

232 
	`li°_hód_öô
(&
m
->
dïs
);

233 
	`li°_hód_öô
(&
m
->
ã°_dïs
);

236 
Àn
 = 
	`°æí
(
m
->
dú
);

237 
Àn
 && 
m
->
dú
[len-1] == '/')

238 
m
->
dú
[--
Àn
] = '\0';

240 
m
->
ba£«me
 = 
	`°ºchr
(m->
dú
, '/');

241 i‡(!
m
->
ba£«me
)

242 
	`îrx
(1, "I don'tÉxpectÅo beÑun fromÅheÑoot directory");

243 
m
->
ba£«me
++;

245 
	`as£π
(
	`°r°¨ts
(
m
->
dú
, 
	`föd_cˇn_dú
(m->dir)));

246 
m
->
mod«me
 = m->
dú
 + 
	`°æí
(
	`föd_cˇn_dú
(m->dir)) + strlen("ccan/");

248 
	`add_fûes
(
m
, 
ˇn⁄_dú
, 
NULL
);

251 
	`f‹óch_±r
(
li°
, &
m
->
≠i_ã°s
, &m->
run_ã°s
, &m->
compûe_ok_ã°s
,

252 &
m
->
compûe_Áû_ã°s
)

253 
	`s‹t_fûes
(
li°
);

255 
	`hèbÀ_m™i„°_add
(
m™i„°s
, 
	`èl_lök
(m™i„°s, 
m
));

257  
m
;

258 
	}
}

	@ccan/tools/manifest.h

1 #i‚de‡
CCAN_TOOLS_MANIFEST_H


2 
	#CCAN_TOOLS_MANIFEST_H


	)

3 
	~"c⁄fig.h
"

4 
	~"cˇ∆öt/li˚n£s.h
"

5 
	~<cˇn/li°/li°.h
>

7 
	ecompûe_ty≥
 {

8 
	mCOMPILE_NORMAL
,

9 
	mCOMPILE_NOFEAT
,

10 
	mCOMPILE_COVERAGE
,

11 
	mCOMPILE_TYPES


14 
	sm™i„°
 {

15 *
	mdú
;

17 *
	mmod«me
;

19 *
	mba£«me
;

20 
cˇn_fûe
 *
	möfo_fûe
;

23 
li°_node
 
	mli°
;

25 *
	mcompûed
[
COMPILE_TYPES
];

27 
li°_hód
 
	mc_fûes
;

28 
li°_hód
 
	mh_fûes
;

30 
li°_hód
 
	mrun_ã°s
;

31 
li°_hód
 
	m≠i_ã°s
;

32 
li°_hód
 
	mcompûe_ok_ã°s
;

33 
li°_hód
 
	mcompûe_Áû_ã°s
;

34 
li°_hód
 
	mŸhî_ã°_c_fûes
;

35 
li°_hód
 
	mŸhî_ã°_fûes
;

37 
li°_hód
 
	mŸhî_fûes
;

38 
li°_hód
 
	mexam∂es
;

39 
li°_hód
 
	mm™gÀd_exam∂es
;

42 
li°_hód
 
	mdïs
;

43 
li°_hód
 
	mã°_dïs
;

46 
li˚n£
 
	mli˚n£
;

50 
m™i„°
 *
gë_m™i„°
(c⁄° *
˘x
, c⁄° *
dú
);

52 
	scˇn_fûe
 {

53 
li°_node
 
	mli°
;

56 *
	m«me
;

59 *
	mfuŒ«me
;

63 c⁄° *
	mc⁄ã¡s
;

64 
size_t
 
	mc⁄ã¡s_size
;

67 **
	mlöes
;

68 
löe_öfo
 *
	mlöe_öfo
;

70 
li°_hód
 *
	mdoc_£˘i⁄s
;

73 *
	mcompûed
[
COMPILE_TYPES
];

76 *
	mvÆgröd_log
;

79 *
	mÀak_öfo
;

82 *
	msim∂ifõd
;

86 
cˇn_fûe
 *
√w_cˇn_fûe
(c⁄° *
˘x
,

87 c⁄° *
dú
, c⁄° *
«me
);

90 c⁄° *
gë_cˇn_fûe_c⁄ã¡s
(
cˇn_fûe
 *
f
);

93 **
gë_cˇn_fûe_löes
(
cˇn_fûe
 *
f
);

	@ccan/tools/namespacize.c

2 
	~<î∫o.h
>

3 
	~<°rög.h
>

4 
	~<°dboﬁ.h
>

5 
	~<˘y≥.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<dúít.h
>

8 
	~<uni°d.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/°©.h
>

11 
	~<f˙é.h
>

12 
	~"cˇn/°r/°r.h
"

13 
	~"cˇn/èke/èke.h
"

14 
	~"cˇn/rbuf/rbuf.h
"

15 
	~"cˇn/èl/∑th/∑th.h
"

16 
	~"cˇn/îr/îr.h
"

17 
	~"toﬁs.h
"

19 
boﬁ
 
	gvîbo£
 = 
Ál£
;

20 
	gödít
 = 0;

21 
	#vîbo£
(
¨gs
...) \

22 dÿ{ i‡(
vîbo£
) { \

23 
_i
; \

24 
_i
 = 0; _ò< 
ödít
; _i++Ë
	`¥ötf
(" "); \

25 
	`¥ötf
(
¨gs
); \

27 } 0)

	)

28 
	#vîbo£_ödít
(Ë(
ödít
 +2)

	)

29 
	#vîbo£_unödít
(Ë(
ödít
 -2)

	)

31 
	$u∆ök_no_î∫o
(c⁄° *
fûíame
)

33 
ªt
 = 0, 
£ºno
 = 
î∫o
;

34 i‡(
	`u∆ök
(
fûíame
) < 0)

35 
ªt
 = 
î∫o
;

36 
î∫o
 = 
£ºno
;

37  
ªt
;

38 
	}
}

40 **
	$gë_dú
(c⁄° *
dú
)

42 
DIR
 *
d
;

43 
dúít
 *
ít
;

44 **
«mes
 = 
	`èl_¨r
(
NULL
, *, 0), *
n
;

46 
d
 = 
	`›ídú
(
dú
);

47 i‡(!
d
)

48  
NULL
;

50 (
ít
 = 
	`ªaddú
(
d
)Ë!
NULL
) {

51 
n
 = 
	`èl_fmt
(
«mes
, "%s/%s", 
dú
, 
ít
->
d_«me
);

52 
	`èl_ex∑nd
(&
«mes
, &
n
, 1);

54 
n
 = 
NULL
;

55 
	`èl_ex∑nd
(&
«mes
, &
n
, 1);

56 
	`˛o£dú
(
d
);

57  
«mes
;

58 
	}
}

60 
	sª∂a˚


62 
ª∂a˚
 *
	m√xt
;

63 *
	m°rög
;

66 
__©åibuã__
((
n‹ëu∫
)Ë
	$ußge
()

68 
	`îrx
(1, "Usage:\n"

76 
	}
}

78 
	$add_ª∂a˚
(
ª∂a˚
 **
ª∂
, c⁄° *
°r
)

80 
ª∂a˚
 *
√w
, *
i
;

83 
i
 = *
ª∂
; i; i = i->
√xt
)

84 i‡(
	`°ªq
(
i
->
°rög
, 
°r
))

87 
√w
 = 
	`èl
(*
ª∂
, 
ª∂a˚
);

88 
√w
->
√xt
 = *
ª∂
;

89 
√w
->
°rög
 = 
	`èl_°rdup
“ew, 
°r
);

90 *
ª∂
 = 
√w
;

91 
	}
}

93 
	$add_ª∂a˚_tok
(
ª∂a˚
 **
ª∂
, c⁄° *
s
)

95 
ª∂a˚
 *
√w
;

96 
Àn
 = 
	`°r•n
(
s
, 
IDENT_CHARS
);

98 
√w
 = 
	`èl
(*
ª∂
, 
ª∂a˚
);

99 
√w
->
√xt
 = *
ª∂
;

100 
√w
->
°rög
 = 
	`èl_°∫dup
“ew, 
s
, 
Àn
);

101 *
ª∂
 = 
√w
;

102 
	}
}

104 
	$look_f‹_ma¸os
(*
c⁄ã¡s
, 
ª∂a˚
 **
ª∂
)

106 *
p
;

107 íum { 
LINESTART
, 
HASH
, 
DEFINE
, 
NONE
 } 
°©e
 = LINESTART;

110 
p
 = 
c⁄ã¡s
; *p;Ö++) {

111 i‡(*
p
 == '\n')

112 
°©e
 = 
LINESTART
;

113 i‡(!
	`cis•a˚
(*
p
)) {

114 i‡(
°©e
 =
LINESTART
 && *
p
 == '#')

115 
°©e
 = 
HASH
;

116 i‡(
°©e
==
HASH
 && !
	`°∫cmp
(
p
, "define", 6)) {

117 
°©e
 = 
DEFINE
;

118 
p
 += 5;

119 } i‡(
°©e
 =
DEFINE
) {

120 
Àn
;

122 
Àn
 = 
	`°r•n
(
p
, 
IDENT_CHARS
);

123 i‡(
Àn
) {

124 *
s
;

125 
s
 = 
	`èl_°∫dup
(
c⁄ã¡s
, 
p
, 
Àn
);

127 i‡(!
	`°r°¨ts
(
s
, "CCAN_")) {

128 
	`vîbo£
("Found %s\n", 
s
);

129 
	`add_ª∂a˚
(
ª∂
, 
s
);

132 
°©e
 = 
NONE
;

134 
°©e
 = 
NONE
;

137 
	}
}

140 
	$¥ïro˚ss
(*
p
)

142 *
s
;

145 (
s
 = 
	`°r°r
(
p
, "\\\n")Ë!
NULL
)

146 
s
[0] = s[1] = ' ';

149 i‡(
p
[0] == '#') {

150 
i
;

151 
i
 = 0; 
p
[i] != '\n'; i++)

152 
p
[
i
] = ' ';

154 (
s
 = 
	`°r°r
(
p
, "\n#")Ë!
NULL
) {

155 
i
;

156 
i
 = 1; 
s
[i] != '\n'; i++)

157 
s
[
i
] = ' ';

159 
	}
}

161 *
	$gë_°©emít
(c⁄° *
˘x
, **
p
)

163 
bøckës
 = 0;

164 
boﬁ
 
£í_bøckës
 = 
Ál£
;

165 *
™swî
 = 
	`èl_°rdup
(
˘x
, "");

168 i‡((*
p
)[0] == '/' && (*p)[1] == '/')

169 *
p
 +
	`°rc•n
(*p, "\n");

170 i‡((*
p
)[0] == '/' && (*p)[1] == '*')

171 *
p
 = 
	`°r°r
(*p, "*/") + 1;

173 
c
 = **
p
;

174 i‡(
c
 =';' && !
bøckës
) {

175 (*
p
)++;

176  
™swî
;

179 i‡(
	`cis•a˚
(
c
)) {

180 
c
 = ' ';

181 
	`cis•a˚
((*
p
)[1]))

182 (*
p
)++;

183 } i‡(
c
 == '{' || c == '(' || c == '[') {

184 i‡(
c
 == '(')

185 
£í_bøckës
 = 
åue
;

186 
bøckës
++;

187 } i‡(
c
 == '}' || c == ')' || c == ']')

188 
bøckës
--;

190 i‡(
™swî
[0] !'\0' || 
c
 != ' ') {

191 
	`èl_≠≥nd_fmt
(&
™swî
, "%c", 
c
);

193 i‡(
c
 ='}' && 
£í_bøckës
 && 
bøckës
 == 0) {

194 (*
p
)++;

195  
™swî
;

198 (*
p
)++;

199 i‡(**
p
 == '\0')

200  
NULL
;

202 
	}
}

205 
	$look_f‹_deföôi⁄s
(*
c⁄ã¡s
, 
ª∂a˚
 **
ª∂
)

207 *
°mt
, *
p
 = 
c⁄ã¡s
;

209 
	`¥ïro˚ss
(
c⁄ã¡s
);

211 (
°mt
 = 
	`gë_°©emít
(
c⁄ã¡s
, &
p
)Ë!
NULL
) {

212 
i
, 
Àn
;

215 i‡((
	`°∫cmp
(
°mt
, "struct", 5) == 0

216 || 
	`°∫cmp
(
°mt
, "union", 5) == 0)

217 && 
	`°rchr
(
°mt
, '{') && stmt[7] != '{')

218 
	`add_ª∂a˚_tok
(
ª∂
, 
°mt
+7);

221 
i
 = 
	`°æí
(
°mt
)-1; i >= 0; i--)

222 i‡(
	`°r•n
(
°mt
+
i
, 
IDENT_CHARS
) == 0)

225 i‡(
i
 !
	`°æí
(
°mt
)-1) {

226 
	`add_ª∂a˚_tok
(
ª∂
, 
°mt
+
i
+1);

231 
Àn
 = 
	`°r•n
(
°mt
, 
IDENT_CHARS
 "* ");

232 i‡(
Àn
 > 0 && (
°mt
[len] == '(' || stmt[len] == '[')) {

233 i‡(
	`°r•n
(
°mt
 + 
Àn
 + 1, 
IDENT_CHARS
) != 0) {

234 
i
 = 
Àn
-1; i >= 0; i--)

235 i‡(
	`°r•n
(
°mt
+
i
, 
IDENT_CHARS
) == 0)

237 i‡(
i
 !
Àn
-1) {

238 
	`add_ª∂a˚_tok
(
ª∂
, 
°mt
+
i
+1);

243 
Àn
++;

244 
Àn
 +
	`°r•n
(
°mt
 +Üen, " *");

245 
i
 = 
	`°r•n
(
°mt
 + 
Àn
, 
IDENT_CHARS
);

246 i‡(
i
 > 0 && 
°mt
[
Àn
 + i] == ')')

247 
	`add_ª∂a˚_tok
(
ª∂
, 
°mt
+
Àn
);

251 
	}
}

254 
	$™Æyze_hódîs
(c⁄° *
dú
, 
ª∂a˚
 **
ª∂
)

256 *
hdr
, *
c⁄ã¡s
;

259 
hdr
 = 
	`èl_fmt
(
dú
, "%s.h",

260 
	`∑th_joö
(
NULL
, 
dú
, 
	`èke
(
	`∑th_ba£«me
(NULL, dir))));

262 
c⁄ã¡s
 = 
	`èl_gøb_fûe
(
dú
, 
hdr
, 
NULL
);

263 i‡(!
c⁄ã¡s
)

264 
	`îr
(1, "Ródög %s", 
hdr
);

266 
	`vîbo£
("Lookög i¿%†f‹ ma¸os\n", 
hdr
);

267 
	`vîbo£_ödít
();

268 
	`look_f‹_ma¸os
(
c⁄ã¡s
, 
ª∂
);

269 
	`vîbo£_unödít
();

271 
	`vîbo£
("Lookög i¿%†f‹ symbﬁs\n", 
hdr
);

272 
	`vîbo£_ödít
();

273 
	`look_f‹_deföôi⁄s
(
c⁄ã¡s
, 
ª∂
);

274 
	`vîbo£_unödít
();

275 
	}
}

277 
	$wrôe_ª∂a˚mít_fûe
(c⁄° *
dú
, 
ª∂a˚
 **
ª∂
)

279 *
ª∂«me
 = 
	`∑th_joö
(
dú
, dir, ".namespacize");

280 
fd
;

281 
ª∂a˚
 *
r
;

283 
fd
 = 
	`›í
(
ª∂«me
, 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0644);

284 i‡(
fd
 < 0) {

285 i‡(
î∫o
 =
EEXIST
)

286 
	`îrx
(1, "%sálreadyÉxists: can'tÇamespacizeÅwice",

287 
ª∂«me
);

288 
	`îr
(1, "O≥nög %s", 
ª∂«me
);

291 
r
 = *
ª∂
;Ñ;Ñ =Ñ->
√xt
) {

292 i‡(
	`wrôe
(
fd
,
r
->
°rög
,
	`°æí
(r->string)) != strlen(r->string)

293 || 
	`wrôe
(
fd
, "\n", 1) != 1) {

294 
	`u∆ök_no_î∫o
(
ª∂«me
);

295 i‡(
î∫o
 == 0)

296 
	`îrx
(1, "Short writeÅo %s: disk full?",

297 
ª∂«me
);

298 
	`îrx
(1, "WrôögÅÿ%s", 
ª∂«me
);

302 
	`˛o£
(
fd
);

303 
	}
}

305 
	$u∆ök_de°roy
(*
«me
)

307 
	`u∆ök
(
«me
);

308 
	}
}

310 *
	$föd_w‹d
(*
f
, c⁄° *
°r
)

312 *
p
 = 
f
;

314 (
p
 = 
	`°r°r
’, 
°r
)Ë!
NULL
) {

316 i‡(
p
 > 
f
 && (
	`ciß um
(p[-1]) ||Ö[-1] == '_')) {

317 
p
++;

320 i‡(
	`ciß um
(
p
[
	`°æí
(
°r
)]) ||Ö[strlen(str)] == '_') {

321 
p
++;

324  
p
;

326  
NULL
;

327 
	}
}

330 c⁄° *
	$ªwrôe_fûe
(c⁄° *
fûíame
,

331 c⁄° 
ª∂a˚
 *
ª∂
)

333 *
√w«me
, *
fûe
;

334 
fd
;

336 
	`vîbo£
("Rewrôög %s\n", 
fûíame
);

337 
fûe
 = 
	`èl_gøb_fûe
(
fûíame
, fûíame, 
NULL
);

338 i‡(!
fûe
)

339 
	`îr
(1, "Ródög fûê%s", 
fûíame
);

341 ; 
ª∂
;Ñï»ª∂->
√xt
) {

342 *
p
;

344 (
p
 = 
	`föd_w‹d
(
fûe
, 
ª∂
->
°rög
)Ë!
NULL
) {

345 
off
;

346 *
√w
 = 
	`èl_¨r
(
fûe
, , 
	`°æí
(file)+6);

348 
off
 = 
p
 - 
fûe
;

349 
	`mem˝y
(
√w
, 
fûe
, 
off
);

350 i‡(
	`cisuµî
(
ª∂
->
°rög
[0]))

351 
	`mem˝y
(
√w
 + 
off
, "CCAN_", 5);

353 
	`mem˝y
(
√w
 + 
off
, "ccan_", 5);

354 
	`°r˝y
(
√w
 + 
off
 + 5, 
fûe
 + off);

355 
fûe
 = 
√w
;

360 
√w«me
 = 
	`èl_fmt
(
	`auto‰ì
(), "%s.tmp", 
fûíame
);

361 
fd
 = 
	`›í
(
√w«me
, 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0644);

362 i‡(
fd
 < 0)

363 
	`îr
(1, "Cª©ög %s", 
√w«me
);

365 
	`èl_add_de°ru˘‹
(
√w«me
, 
u∆ök_de°roy
);

366 i‡(
	`wrôe
(
fd
, 
fûe
, 
	`°æí
(file)) != strlen(file)) {

367 i‡(
î∫o
 == 0)

368 
	`îrx
(1, "Sh‹àwrôêtÿ%s: disk fuŒ?", 
√w«me
);

369 
	`îrx
(1, "WrôögÅÿ%s", 
√w«me
);

371 
	`˛o£
(
fd
);

372  
√w«me
;

373 
	}
}

375 
	sadju°ed


377 
adju°ed
 *
	m√xt
;

378 c⁄° *
	mfûe
;

379 c⁄° *
	mtmpfûe
;

382 
	$£tup_adju°_fûes
(c⁄° *
dú
,

383 c⁄° 
ª∂a˚
 *
ª∂
,

384 
adju°ed
 **
adj
)

386 **
fûes
;

388 
fûes
 = 
	`gë_dú
(
dú
); *files; files++) {

389 i‡(
	`°ªnds
(*
fûes
, "/test"))

390 
	`£tup_adju°_fûes
(*
fûes
, 
ª∂
, 
adj
);

391 i‡(
	`°ªnds
(*
fûes
, ".c") || strends(*files, ".h")) {

392 
adju°ed
 *
a
 = 
	`èl
(
dú
, adjusted);

393 
a
->
√xt
 = *
adj
;

394 
a
->
fûe
 = *
fûes
;

395 
a
->
tmpfûe
 = 
	`ªwrôe_fûe
◊->
fûe
, 
ª∂
);

396 *
adj
 = 
a
;

399 
	}
}

402 
	$ª«me_fûes
(c⁄° 
adju°ed
 *
adj
)

404 
adj
) {

405 i‡(!
	`move_fûe
(
adj
->
tmpfûe
,ádj->
fûe
))

406 
	`w¨n
("CouldÇotÑename over '%s', we're inÅrouble",

407 
adj
->
fûe
);

408 
adj
 =ádj->
√xt
;

410 
	}
}

412 
	$c⁄vît_dú
(c⁄° *
dú
)

414 *
«me
;

415 
ª∂a˚
 *ª∂a˚ = 
NULL
;

416 
adju°ed
 *
adj
 = 
NULL
;

419 
«me
 = 
	`∑th_ˇn⁄
(
NULL
, 
dú
);

420 
	`™Æyze_hódîs
(
«me
, &
ª∂a˚
);

421 
	`wrôe_ª∂a˚mít_fûe
(
«me
, &
ª∂a˚
);

422 
	`£tup_adju°_fûes
(
«me
, 
ª∂a˚
, &
adj
);

423 
	`ª«me_fûes
(
adj
);

424 
	`èl_‰ì
(
«me
);

425 
	`èl_‰ì
(
ª∂a˚
);

426 
	}
}

428 
ª∂a˚
 *
	$ªad_ª∂a˚mít_fûe
(c⁄° *
dïdú
)

430 
ª∂a˚
 *
ª∂
 = 
NULL
;

431 *
ª∂«me
 = 
	`∑th_joö
(
dïdú
, depdir, ".namespacize");

432 *
fûe
, **
löe
;

434 
fûe
 = 
	`èl_gøb_fûe
(
ª∂«me
,Ñï ame, 
NULL
);

435 i‡(!
fûe
) {

436 i‡(
î∫o
 !
ENOENT
)

437 
	`îr
(1, "O≥nög %s", 
ª∂«me
);

438  
NULL
;

441 
löe
 = 
	`èl_°r•lô
(
fûe
, fûe, "\n", 
STR_EMPTY_OK
); *line;Üine++)

442 
	`add_ª∂a˚
(&
ª∂
, *
löe
);

443  
ª∂
;

444 
	}
}

446 
	$adju°_dú
(c⁄° *
dú
)

448 *
∑ª¡
 = 
	`∑th_dú«me
(
	`auto‰ì
(), 
dú
);

449 **
dïs
;

451 
	`vîbo£
("Adju°ög %s\n", 
dú
);

452 
	`vîbo£_ödít
();

453 
dïs
 = 
	`gë_dïs
(
∑ª¡
, 
dú
, "dïíds", 
Ál£
, 
compûe_öfo
);

454 *
dïs
;

455 
dïs
++) {

456 *
dïdú
;

457 
adju°ed
 *
adj
 = 
NULL
;

458 
ª∂a˚
 *
ª∂
;

460 
dïdú
 = 
	`∑th_joö
(
∑ª¡
,Ö¨ít, *
dïs
);

461 
ª∂
 = 
	`ªad_ª∂a˚mít_fûe
(
dïdú
);

462 i‡(
ª∂
) {

463 
	`vîbo£
("%†ha†bì¿«me•acized\n", 
dïdú
);

464 
	`£tup_adju°_fûes
(
∑ª¡
, 
ª∂
, &
adj
);

465 
	`ª«me_fûes
(
adj
);

467 
	`vîbo£
("%†ha†nŸ bì¿«me•acized\n", 
dïdú
);

468 
	`èl_‰ì
(
dïdú
);

470 
	`vîbo£_unödít
();

471 
	`èl_‰ì
(
∑ª¡
);

472 
	}
}

474 
	$adju°_dïídíts
(c⁄° *
dú
)

476 *
∑ª¡
 = 
	`∑th_dú«me
(
NULL
, 
dú
);

477 *
ba£
 = 
	`∑th_ba£«me
(
∑ª¡
, 
dú
);

478 **
fûe
;

480 
	`vîbo£
("Lookög f‹ dïídít†ö %s\n", 
∑ª¡
);

481 
	`vîbo£_ödít
();

482 
fûe
 = 
	`gë_dú
(
∑ª¡
); *file; file++) {

483 *
öfo
, **
dïs
;

484 
boﬁ
 
isdï
 = 
Ál£
;

486 i‡(
	`∑th_ba£«me
(*
fûe
, *file)[0] == '.')

489 
öfo
 = 
	`∑th_joö
(*
fûe
, *file, "_info");

490 i‡(
	`ac˚ss
(
öfo
, 
R_OK
) != 0)

493 
dïs
 = 
	`gë_dïs
(*
fûe
, *fûe, "dïíds", 
Ál£
,

494 
compûe_öfo
);

495 *
dïs
; deps++) {

496 i‡(!
	`°r°¨ts
(*
dïs
, "ccan/"))

498 i‡(
	`°ªq
(*
dïs
 + 
	`°æí
("cˇn/"), 
ba£
))

499 
isdï
 = 
åue
;

501 i‡(
isdï
)

502 
	`adju°_dú
(*
fûe
);

504 
	`vîbo£
("%†i†nŸ dïídít\n", *
fûe
);

506 
	`vîbo£_unödít
();

507 
	}
}

509 
	$maö
(
¨gc
, *
¨gv
[])

511 i‡(
¨gv
[1] && 
	`°ªq
(argv[1], "--verbose")) {

512 
vîbo£
 = 
åue
;

513 
¨gv
++;

514 
¨gc
--;

517 i‡(
¨gc
 == 2) {

518 
	`vîbo£
("Name•acizög %s\n", 
¨gv
[1]);

519 
	`vîbo£_ödít
();

520 
	`c⁄vît_dú
(
¨gv
[1]);

521 
	`adju°_dïídíts
(
¨gv
[1]);

522 
	`vîbo£_unödít
();

526 i‡(
¨gc
 > 2 && 
	`°ªq
(
¨gv
[1], "--adjust")) {

527 
i
;

529 
i
 = 2; i < 
¨gc
; i++)

530 
	`adju°_dú
(
¨gv
[
i
]);

533 
	`ußge
();

534 
	}
}

	@ccan/tools/read_config_header.c

1 
	~<cˇn/îr/îr.h
>

2 
	~<cˇn/°r/°r.h
>

3 
	~<cˇn/èl/∑th/∑th.h
>

4 
	~"ªad_c⁄fig_hódî.h
"

5 
	~"toﬁs.h
"

6 
	~<°rög.h
>

9 *
	$gë_symbﬁ_tokí
(*
˘x
, c⁄° **
löe
)

11 
tokÀn
;

12 *
ªt
;

14 *
löe
 +
	`°r•n
(*line, " \t");

15 
tokÀn
 = 
	`°r•n
(*
löe
, 
IDENT_CHARS
);

16 i‡(!
tokÀn
)

17  
NULL
;

18 
ªt
 = 
	`èl_°∫dup
(
˘x
, *
löe
, 
tokÀn
);

19 *
löe
 +
tokÀn
;

20  
ªt
;

21 
	}
}

24 
boﬁ
 
	$gë_tokí
(c⁄° **
löe
, c⁄° *
tokí
)

26 
tokÀn
;

28 *
löe
 +
	`°r•n
(*line, " \t");

29 i‡(
	`ciß um
(
tokí
[0]) ||Åoken[0] == '_')

30 
tokÀn
 = 
	`°r•n
(*
löe
, 
IDENT_CHARS
);

33 
tokÀn
 = 
	`°æí
(
tokí
);

36 i‡(
tokÀn
 =
	`°æí
(
tokí
Ë&& !
	`°∫cmp
(*
löe
,Åoken,Åoklen)) {

37 *
löe
 +
tokÀn
;

38  
åue
;

40  
Ál£
;

41 
	}
}

43 *
	$dem™gÀ_°rög
(*
°rög
)

45 
i
;

46 c⁄° 
m≠‰om
[] = "abfnrtv";

47 c⁄° 
m≠to
[] = "\a\b\f\n\r\t\v";

49 i‡(!
	`°rchr
(
°rög
, '"'))

50  
NULL
;

51 
°rög
 = 
	`°rchr
(string, '"') + 1;

52 i‡(!
	`°ºchr
(
°rög
, '"'))

53  
NULL
;

54 *
	`°ºchr
(
°rög
, '"') = '\0';

56 
i
 = 0; i < 
	`°æí
(
°rög
); i++) {

57 i‡(
°rög
[
i
] == '\\') {

58 
ª∂
;

59 
Àn
 = 0;

60 c⁄° *
p
 = 
	`°rchr
(
m≠‰om
, 
°rög
[
i
+1]);

61 i‡(
p
) {

62 
ª∂
 = 
m≠to
[
p
 - 
m≠‰om
];

63 
Àn
 = 1;

64 } i‡(
	`°æí
(
°rög
+
i
+1) >= 3) {

65 i‡(
°rög
[
i
+1] == 'x') {

66 
ª∂
 = (
°rög
[
i
+2]-'0')*16

67 + 
°rög
[
i
+3]-'0';

68 
Àn
 = 3;

69 } i‡(
	`cisdigô
(
°rög
[
i
+1])) {

70 
ª∂
 = (
°rög
[
i
+2]-'0')*8*8

71 + (
°rög
[
i
+3]-'0')*8

72 + (
°rög
[
i
+4]-'0');

73 
Àn
 = 3;

76 i‡(
Àn
 == 0) {

77 
ª∂
 = 
°rög
[
i
+1];

78 
Àn
 = 1;

81 
°rög
[
i
] = 
ª∂
;

82 
	`memmove
(
°rög
 + 
i
 + 1, såög + i + 
Àn
 + 1,

83 
	`°æí
(
°rög
 + 
i
 + 
Àn
 + 1) + 1);

87  
°rög
;

88 
	}
}

90 *
	$ªad_c⁄fig_hódî
(c⁄° *
cˇn_dú
, 
boﬁ
 
vîbo£
)

92 *
‚ame
 = 
	`∑th_joö
(
NULL
, 
cˇn_dú
, "config.h");

93 **
löes
;

94 
i
;

95 *
c⁄fig_hódî
;

97 
c⁄fig_hódî
 = 
	`èl_gøb_fûe
(
NULL
, 
‚ame
, NULL);

98 
	`èl_‰ì
(
‚ame
);

100 i‡(!
c⁄fig_hódî
)

101  
NULL
;

103 
löes
 = 
	`èl_°r•lô
(
c⁄fig_hódî
, c⁄fig_hódî, "\n", 
STR_EMPTY_OK
);

104 
i
 = 0; i < 
	`èl_cou¡
(
löes
) - 1; i++) {

105 *
sym
;

106 c⁄° **
löe
 = (c⁄° **)&
löes
[
i
];

108 i‡(!
	`gë_tokí
(
löe
, "#"))

110 i‡(!
	`gë_tokí
(
löe
, "define"))

112 
sym
 = 
	`gë_symbﬁ_tokí
(
löes
, 
löe
);

113 i‡(
	`°ªq
(
sym
, "CCAN_COMPILER")) {

114 
compûî
 = 
	`dem™gÀ_°rög
(
löes
[
i
]);

115 i‡(!
compûî
)

116 
	`îrx
(1, "%s:%u:couldÇotÖarse CCAN_COMPILER",

117 
‚ame
, 
i
+1);

118 i‡(
vîbo£
)

119 
	`¥ötf
("%s: compiler setÅo '%s'\n",

120 
‚ame
, 
compûî
);

121 } i‡(
	`°ªq
(
sym
, "CCAN_CFLAGS")) {

122 
cÊags
 = 
	`dem™gÀ_°rög
(
löes
[
i
]);

123 i‡(!
cÊags
)

124 
	`îrx
(1, "%s:%u:couldÇotÖarse CCAN_CFLAGS",

125 
‚ame
, 
i
+1);

126 i‡(
vîbo£
)

127 
	`¥ötf
("%s: compiler flags setÅo '%s'\n",

128 
‚ame
, 
cÊags
);

131  
c⁄fig_hódî
;

132 
	}
}

	@ccan/tools/read_config_header.h

1 #i‚de‡
CCAN_TOOLS_READ_CONFIG_HEADER_H


2 
	#CCAN_TOOLS_READ_CONFIG_HEADER_H


	)

3 
	~<°dboﬁ.h
>

6 
boﬁ
 
gë_tokí
(c⁄° **
löe
, c⁄° *
tokí
);

9 *
gë_symbﬁ_tokí
(*
˘x
, c⁄° **
löe
);

12 *
ªad_c⁄fig_hódî
(c⁄° *
c⁄fig_dú
, 
boﬁ
 
vîbo£
);

	@ccan/tools/tools.c

1 
	~<cˇn/èke/èke.h
>

2 
	~<cˇn/îr/îr.h
>

3 
	~<cˇn/n€º/n€º.h
>

4 
	~<cˇn/rbuf/rbuf.h
>

5 
	~<cˇn/ªad_wrôe_Æl/ªad_wrôe_Æl.h
>

6 
	~<cˇn/n€º/n€º.h
>

7 
	~<cˇn/time/time.h
>

8 
	~<cˇn/èl/∑th/∑th.h
>

9 
	~<sys/°©.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/time.h
>

12 
	~<sys/waô.h
>

13 
	~<f˙é.h
>

14 
	~<°rög.h
>

15 
	~<uni°d.h
>

16 
	~<°d¨g.h
>

17 
	~<î∫o.h
>

18 
	~<uni°d.h
>

19 
	~<as£π.h
>

20 
	~<sig«l.h
>

21 
	~"toﬁs.h
"

23 c⁄° *
	gtmpdú
 = 
NULL
;

24 
boﬁ
 
	gtoﬁs_vîbo£
 = 
Ál£
;

27 c⁄° 
	gdeÁu…_timeout_ms
 = 10 * 60 * 1000;

29 
	$kûlme
(
sig
)

31 
	`kûl
(-
	`gëpid
(), 
SIGKILL
);

32 
	}
}

34 *
	$run_wôh_timeout
(c⁄° *
˘x
, c⁄° *
cmd
,

35 
boﬁ
 *
ok
, *
timeout_ms
)

37 
pid_t
 
pid
;

38 
p
[2];

39 
rbuf
 
ö
;

40 
°©us
, 
ms
;

41 
time•ec
 
°¨t
;

43 *
ok
 = 
Ál£
;

44 i‡(
	`pùe
(
p
) != 0)

45  
	`èl_fmt
(
˘x
, "FailedÅo createÖipe: %s",

46 
	`°ªº‹
(
î∫o
));

48 i‡(
toﬁs_vîbo£
)

49 
	`¥ötf
("Ru¬ög: %s\n", 
cmd
);

52 
	`fÊush
(
°dout
);

53 
°¨t
 = 
	`time_now
();

54 
pid
 = 
	`f‹k
();

55 i‡(
pid
 == -1) {

56 
	`˛o£_n€º
(
p
[0]);

57 
	`˛o£_n€º
(
p
[1]);

58  
	`èl_fmt
(
˘x
, "FaûedÅÿf‹k: %s", 
	`°ªº‹
(
î∫o
));

61 i‡(
pid
 == 0) {

62 
ôimîvÆ
 
ôim
;

64 i‡(
	`dup2
(
p
[1], 
STDOUT_FILENO
) != STDOUT_FILENO

65 || 
	`dup2
(
p
[1], 
STDERR_FILENO
) != STDERR_FILENO

66 || 
	`˛o£
(
p
[0]) != 0

67 || 
	`˛o£
(
STDIN_FILENO
) != 0

68 || 
	`›í
("/dev/nuŒ", 
O_RDONLY
Ë!
STDIN_FILENO
)

69 
	`exô
(128);

71 
	`sig«l
(
SIGALRM
, 
kûlme
);

72 
ôim
.
ô_öãrvÆ
.
tv_£c
 = itim.ô_öãrvÆ.
tv_u£c
 = 0;

73 
ôim
.
ô_vÆue
 = 
	`time•ec_to_timevÆ
(
	`time_‰om_m£c
(*
timeout_ms
));

74 
	`£tôimî
(
ITIMER_REAL
, &
ôim
, 
NULL
);

76 
°©us
 = 
	`sy°em
(
cmd
);

77 i‡(
	`WIFEXITED
(
°©us
))

78 
	`exô
(
	`WEXITSTATUS
(
°©us
));

80 
	`exô
(128 + 
	`WTERMSIG
(
°©us
));

83 
	`˛o£
(
p
[1]);

84 
	`rbuf_öô
(&
ö
, 
p
[0], 
	`èl_¨r
(
˘x
, , 4096), 4096);

85 i‡(!
	`rbuf_ªad_°r
(&
ö
, 0, 
do_èl_ªÆloc
Ë&& 
î∫o
)

86 
ö
.
buf
 = 
	`èl_‰ì
(in.buf);

89 i‡(
	`waôpid
(
pid
, &
°©us
, 0) !=Öid)

90 
	`îr
(1, "FailedÅo wait for child");

92 
ms
 = 
	`time_to_m£c
(
	`time_sub
(
	`time_now
(), 
°¨t
));

93 i‡(
ms
 > *
timeout_ms
)

94 *
timeout_ms
 = 0;

96 *
timeout_ms
 -
ms
;

97 
	`˛o£
(
p
[0]);

98 i‡(
toﬁs_vîbo£
) {

99 
	`¥ötf
("%s", 
ö
.
buf
);

100 
	`¥ötf
("Föished: %u ms, %†%u\n", 
ms
,

101 
	`WIFEXITED
(
°©us
) ? "exit status" : "killed by signal",

102 
	`WIFEXITED
(
°©us
Ë? 
	`WEXITSTATUS
(status)

103 : 
	`WTERMSIG
(
°©us
));

105 *
ok
 = (
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(status) == 0);

106  
ö
.
buf
;

107 
	}
}

110 
boﬁ
 
	$run_comm™d
(c⁄° *
˘x
, *
time_ms
, **
ouçut
,

111 c⁄° *
fmt
, ...)

113 
va_li°
 
≠
;

114 *
cmd
;

115 
boﬁ
 
ok
;

116 
deÁu…_time
 = 
deÁu…_timeout_ms
;

118 i‡(!
time_ms
)

119 
time_ms
 = &
deÁu…_time
;

120 i‡(*
time_ms
 == 0) {

121 *
ouçut
 = 
	`èl_°rdup
(
˘x
, "\n== TIMED OUT ==\n");

122  
Ál£
;

125 
	`va_°¨t
(
≠
, 
fmt
);

126 
cmd
 = 
	`èl_vfmt
(
˘x
, 
fmt
, 
≠
);

127 
	`va_íd
(
≠
);

129 *
ouçut
 = 
	`run_wôh_timeout
(
˘x
, 
cmd
, &
ok
, 
time_ms
);

130 i‡(
ok
)

131  
åue
;

132 i‡(!*
ouçut
)

133 
	`îr
(1, "ProblemÑunning child");

134 i‡(*
time_ms
 == 0)

135 *
ouçut
 = 
	`èl_°rˇt
(
˘x
, 
	`èke
(*output), "\n== TIMED OUT ==\n");

136  
Ál£
;

137 
	}
}

139 
	$u∆ök_Æl
(c⁄° *
dú
)

141 
cmd
[
	`°æí
(
dú
) + ("rm -rf ")];

142 
	`•rötf
(
cmd
, "rm -r‡%s", 
dú
);

143 i‡(
toﬁs_vîbo£
)

144 
	`¥ötf
("Ru¬ög: %s\n", 
cmd
);

145 i‡(
	`sy°em
(
cmd
) != 0)

146 
	`w¨n
("CouldÇŸÑemovêãmp‹¨y w‹k i¿%s", 
dú
);

147 
	}
}

149 
pid_t
 *
	ga‰ì
;

150 
	$‰ì_auto‰ì
()

152 i‡(*
a‰ì
 =
	`gëpid
())

153 
	`èl_‰ì
(
a‰ì
);

154 
	}
}

156 
èl_t
 *
	$auto‰ì
()

158 i‡(!
a‰ì
) {

159 
a‰ì
 = 
	`èl
(
NULL
, 
pid_t
);

160 *
a‰ì
 = 
	`gëpid
();

161 
	`©exô
(
‰ì_auto‰ì
);

163  
a‰ì
;

164 
	}
}

166 c⁄° *
	$ãmp_dú
()

169 !
tmpdú
) {

170 
tmpdú
 = 
	`gëív
("TMPDIR");

171 i‡(!
tmpdú
)

172 
tmpdú
 = "/tmp";

173 
tmpdú
 = 
	`èl_fmt
(
	`auto‰ì
(), "%s/ccanlint-%u.%lu",

174 
tmpdú
, 
	`gëpid
(), 
	`øndom
());

175 i‡(
	`mkdú
(
tmpdú
, 0700) != 0) {

176 i‡(
î∫o
 =
EEXIST
) {

177 
	`èl_‰ì
(
tmpdú
);

178 
tmpdú
 = 
NULL
;

181 
	`îr
(1, "mkdú %†Áûed", 
tmpdú
);

183 
	`èl_add_de°ru˘‹
(
tmpdú
, 
u∆ök_Æl
);

184 i‡(
toﬁs_vîbo£
)

185 
	`¥ötf
("Cª©edÅemp‹¨y dúe˘‹y %s\n", 
tmpdú
);

187  
tmpdú
;

188 
	}
}

190 
	$kìp_ãmp_dú
()

192 
	`èl_dñ_de°ru˘‹
(
	`ãmp_dú
(), 
u∆ök_Æl
);

193 
	}
}

195 *
	$ãmp_fûe
(c⁄° *
˘x
, c⁄° *
exãnsi⁄
, c⁄° *
§˙ame
)

197 *
f
, *
ba£
, *
suffix
;

198 
°©
 
°
;

199 
cou¡
 = 0;

201 
ba£
 = 
	`∑th_joö
(
˘x
, 
	`ãmp_dú
(), 
	`èke
(
	`∑th_ba£«me
(˘x, 
§˙ame
)));

203 
ba£
[
	`∑th_ext_off
(base)] = '\0';

204 
suffix
 = 
	`èl_°rdup
(
˘x
, 
exãnsi⁄
);

207 
f
 = 
	`èl_°rˇt
(
˘x
, 
ba£
, 
suffix
);

208 
suffix
 = 
	`èl_fmt
(
ba£
, "-%u%s", ++
cou¡
, 
exãnsi⁄
);

209 } 
	`l°©
(
f
, &
°
) == 0);

211 i‡(
toﬁs_vîbo£
)

212 
	`¥ötf
("Cª©ög fûê%s\n", 
f
);

214 
	`èl_‰ì
(
ba£
);

215  
f
;

216 
	}
}

218 
boﬁ
 
	$move_fûe
(c⁄° *
ﬁd«me
, c⁄° *
√w«me
)

220 *
c⁄ã¡s
;

221 
size_t
 
size
;

222 
fd
;

223 
boﬁ
 
ªt
;

225 i‡(
toﬁs_vîbo£
)

226 
	`¥ötf
("Movög fûê%†tÿ%s: ", 
ﬁd«me
, 
√w«me
);

229 i‡(
	`ª«me
(
ﬁd«me
, 
√w«me
) == 0) {

230 i‡(
toﬁs_vîbo£
)

231 
	`¥ötf
("rename worked\n");

232  
åue
;

236 
c⁄ã¡s
 = 
	`èl_gøb_fûe
(
NULL
, 
ﬁd«me
, &
size
);

237 i‡(!
c⁄ã¡s
) {

238 i‡(
toﬁs_vîbo£
)

239 
	`¥ötf
("ªad faûed: %s\n", 
	`°ªº‹
(
î∫o
));

240  
Ál£
;

243 
fd
 = 
	`›í
(
√w«me
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0666);

244 i‡(
fd
 < 0) {

245 i‡(
toﬁs_vîbo£
)

246 
	`¥ötf
("ouçuà›í faûed: %s\n", 
	`°ªº‹
(
î∫o
));

247 
ªt
 = 
Ál£
;

248 
‰ì
;

251 
ªt
 = 
	`wrôe_Æl
(
fd
, 
c⁄ã¡s
, 
size
);

252 i‡(
	`˛o£
(
fd
) != 0)

253 
ªt
 = 
Ál£
;

255 i‡(
ªt
) {

256 i‡(
toﬁs_vîbo£
)

257 
	`¥ötf
("copy worked\n");

258 
	`u∆ök
(
ﬁd«me
);

260 i‡(
toﬁs_vîbo£
)

261 
	`¥ötf
("write/close failed\n");

262 
	`u∆ök
(
√w«me
);

265 
‰ì
:

266 
	`èl_‰ì
(
c⁄ã¡s
);

267  
ªt
;

268 
	}
}

270 *
	$do_èl_ªÆloc
(*
p
, 
size_t
 
size
)

272 
	`èl_ªsize
((**)&
p
, 
size
);

273  
p
;

274 
	}
}

276 *
	$èl_gøb_fûe
(c⁄° *
˘x
, c⁄° *
fûíame
, 
size_t
 *
size
)

278 
rbuf
Ñbuf;

279 *
buf
 = 
	`èl_¨r
(
˘x
, , 0);

281 i‡(!
	`rbuf_›í
(&
rbuf
, 
fûíame
, 
buf
, 0))

282  
	`èl_‰ì
(
buf
);

284 i‡(!
	`rbuf_fûl_Æl
(&
rbuf
, 
do_èl_ªÆloc
Ë&& 
î∫o
)

285 
rbuf
.
buf
 = 
	`èl_‰ì
(rbuf.buf);

287 
rbuf
.
buf
[rbuf.
Àn
] = '\0';

288 i‡(
size
)

289 *
size
 = 
rbuf
.
Àn
;

291 
	`˛o£
(
rbuf
.
fd
);

293  
rbuf
.
buf
;

294 
	}
}

	@ccan/tools/tools.h

1 #i‚de‡
CCAN_TOOLS_H


2 
	#CCAN_TOOLS_H


	)

3 
	~"c⁄fig.h
"

4 
	~<cˇn/compûî/compûî.h
>

5 
	~<cˇn/rbuf/rbuf.h
>

6 
	~<cˇn/èl/èl.h
>

7 
	~<cˇn/èl/°r/°r.h
>

8 
	~<°dlib.h
>

9 
	~<°dboﬁ.h
>

12 
	#DEFAULT_CCAN_COMPILER
 "cc"

	)

13 
	#DEFAULT_CCAN_CFLAGS
 "-g"

	)

15 
	#IDENT_CHARS
 "ABCDEFGHIJKLMNOPQRSTUVWXYZ" \

17 "01234567889_"

	)

19 
	#SPACE_CHARS
 " \f\n\r\t\v"

	)

21 
	#COVERAGE_CFLAGS
 "-Ârofûe-¨c†-·e°-covîage"

	)

24 c⁄° *
compûî
, *
cÊags
;

27 *
compûe_öfo
(c⁄° *
˘x
, c⁄° *
dú
);

30 **
gë_dïs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

31 
boﬁ
 
ªcur£
,

32 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
));

35 **
gë_ß„_cˇn_dïs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

36 
boﬁ
 
ªcur£
);

43 **
gë_libs
(c⁄° *
˘x
, c⁄° *
dú
, c⁄° *
°yÀ
,

44 *(*
gë_öfo
)(c⁄° *
˘x
, c⁄° *
dú
));

48 
boﬁ
 
toﬁs_vîbo£
;

49 
boﬁ
 
	$PRINTF_FMT
(4,5Ë
	`run_comm™d
(c⁄° *
˘x
,

50 *
time_ms
,

51 **
ouçut
,

52 c⁄° *
fmt
, ...);

53 *
	`run_wôh_timeout
(c⁄° *
˘x
, c⁄° *
cmd
,

54 
boﬁ
 *
ok
, *
timeout_ms
);

55 c⁄° *
	`ãmp_dú
();

56 
	`kìp_ãmp_dú
();

57 
boﬁ
 
	`move_fûe
(c⁄° *
ﬁd«me
, c⁄° *
√w«me
);

59 *
	`do_èl_ªÆloc
(*
p
, 
size_t
 
size
);

60 *
	`èl_gøb_fûe
(c⁄° *
˘x
, c⁄° *
fûíame
, 
size_t
 *
size
);

63 
èl_t
 *
	`auto‰ì
();

71 
boﬁ
 
compûe_vîbo£
;

73 *
	`lök_obje˘s
(c⁄° *
˘x
, c⁄° *
ba£«me
,

74 c⁄° *
objs
, **
îrmsg
);

76 
boﬁ
 
	`compûe_obje˘
(c⁄° *
˘x
, c⁄° *
cfûe
, c⁄° *
cˇndú
,

77 c⁄° *
compûî
,

78 c⁄° *
cÊags
,

79 c⁄° *
outfûe
, **
ouçut
);

81 
boﬁ
 
	`compûe_™d_lök
(c⁄° *
˘x
, c⁄° *
cfûe
, c⁄° *
cˇndú
,

82 c⁄° *
objs
,

83 c⁄° *
compûî
, c⁄° *
cÊags
,

84 c⁄° *
libs
, c⁄° *
outfûe
, **
ouçut
);

87 *
	`ãmp_fûe
(c⁄° *
˘x
, c⁄° *
exãnsi⁄
, c⁄° *
§˙ame
);

90 c⁄° 
deÁu…_timeout_ms
;

93 c⁄° *
	`föd_cˇn_dú
(c⁄° *
ba£
);

	@ccan/web/uploader.php.cpp

1 <?
php


2 
£ssi⁄_°¨t
();

4 
	~"logo.html
"

5 
	~"míuli°.html
"

6 
	~"°©ic-c⁄figuøti⁄
"

7 <?
php


10 i‡(
	g$_FILES
["uploadedfile"]["error"] > 0) {

11 
	gecho
 "Eº‹: " . 
	g$_FILES
["uploadedfile"]["error"] . "<br />";

12 
exô
();

15 
	g$de°
 = 
ãm≤am
(
$ãmpfﬁdî
, "upload-");

16 
move_u∂ﬂded_fûe
(
$_FILES
["u∂ﬂdedfûe"]["tmp_«me"], 
$de°
);

17 
	gumask
 0740

19 
	g$subje˘
 = "CCAN: codêu∂ﬂd by '" . 
$_POST
['emaû'] . "' wôhÇamê" . 
$_FILES
["uploadedfile"]["name"];

20 
	g$mesßge
 = "Fûêty≥: ".
$_FILES
["uploadedfile"]["type"]."\n".

21 "Size: ".
$_FILES
["uploadedfile"]["size"]."\n".

22 "CœimedÉmaû: ".
$_POST
['email']."\n".

23 "Fûêde°ö©i⁄: ".
$de°
."\n";

25 
maû
(
$cˇ«dmö
, 
$subje˘
, 
$mesßge
, "From: $frommail");

26 
	gecho
 "<diválign=\"center\"> Thanks!<br>

27 
Maû
 
wûl
 
be
 
£nd
 
to
 
admö
Åÿ
publish
 
the
 
	gcode
.<

	@d2im.c

21 
	~"d2im.h
"

27 
D2IM_INST
 
	gglb_d2im
;

35 
	$d2im_ªad_c⁄fig
 ()

38 
iks
 *
p
;

39 
iks
 *
t
;

40 
e
;

42 
e
 = 
	`iks_lﬂd
–"./d2im.xml", &
p
);

44 
glb_d2im
.
xml_c⁄f
 = 
p
;

46 if(
e
 !
IKS_OK
 ){

47 
	`Ârötf
(
°dîr
, "canÇot open d2im.xml.\n" );

48 
	`exô
(0);

51 
t
 = 
	`iks_chûd
(
p
);

53  
t
 ){

56 i‡–
	`iks_ty≥
–
t
 ) =
IKS_TAG
 && !
	`°rcmp
–
	`iks_«me
(Å ), "win" ) ){

57 
	`Ârötf
(
°dout
, "width: %s\n", 
	`iks_föd_cd©a
(
t
, "width") );

58 
	`Ârötf
(
°dout
, "height: %s\n", 
	`iks_föd_cd©a
(
t
, "height") );

62 i‡–
	`iks_ty≥
–
t
 ) =
IKS_TAG
 && !
	`°rcmp
–
	`iks_«me
(Å ), "utf8" ) ){

63 
glb_d2im
.
c⁄fig
 = 
t
;

64 
	`Ârötf
(
°dout
, "öfo: %s\n", 
	`iks_föd_cd©a
(
t
, "chinese") );

68 
t
 = 
	`iks_√xt
(t);

74 
	}
}

84 
	$d2im_öô
 ()

88 
	`d2im_ªad_c⁄fig
();

90 if–!
	`Æ_öô
() ){

91 
	`Ârötf
 ( 
°dîr
, "fatalÉrror: openállegroÜibrary failed...\n" );

92 
	`exô
(0);

94 
	`Æ_ö°Æl_keybﬂrd
();

95 
	`Æ_ö°Æl_mou£
();

97 
	`Æ_öô_f⁄t_add⁄
();

98 
	`Æ_öô_âf_add⁄
();

101 
glb_d2im
.
di•œy
 = 
	`Æ_¸óã_di•œy
(640, 480);

103 i‡–
glb_d2im
.
di•
 =
NULL
 ) {

104 
	`Ârötf
 ( 
°dîr
, "fatalÉrror: open display failed...\n" );

105 
	`exô
(0);

109 
glb_d2im
.
Âs
 = 60;

110 
glb_d2im
.
timî
 = 
	`Æ_¸óã_timî
(1.0 / glb_d2im.
Âs
);

111 
glb_d2im
.
evtq
 = 
	`Æ_¸óã_evít_queue
();

112 
	`Æ_ªgi°î_evít_sour˚
(
glb_d2im
.
evtq
, 
	`Æ_gë_keybﬂrd_evít_sour˚
());

113 
	`Æ_ªgi°î_evít_sour˚
(
glb_d2im
.
evtq
, 
	`Æ_gë_mou£_evít_sour˚
());

114 
	`Æ_ªgi°î_evít_sour˚
(
glb_d2im
.
evtq
, 
	`Æ_gë_di•œy_evít_sour˚
(glb_d2im.
di•
));

115 
	`Æ_ªgi°î_evít_sour˚
(
glb_d2im
.
evtq
, 
	`Æ_gë_timî_evít_sour˚
(glb_d2im.
timî
));

123 
	}
}

133 
	$d2im_run
 ()

136 
ALLEGRO_FONT
 *
f⁄t
;

137 
ALLEGRO_EVENT
 
evít
;

139 
f⁄t
 = 
	`Æ_lﬂd_f⁄t
("./wqy-microhei.ttf", 12, 0);

140 if–
f⁄t
 =
NULL
 ){

141 
	`Ârötf
(
°dout
, "canÇotÜoad font.\n" );

142 
	`exô
(0);

145 
	`Æ_°¨t_timî
();

150 
	`Æ_˛ór_to_cﬁ‹
(
	`Æ_m≠_rgb
(0, 0, 0));

152 
	`Æ_£t_èrgë_bôm≠
(
	`Æ_gë_backbuf„r
(
glb_d2im
.
di•œy
));

154 
	`Æ_døw_ãxt
(
f⁄t
, 
	`Æ_m≠_rgb
(250,250,50), 12.0, 12.0, 0, 
	`iks_föd_cd©a
(
glb_d2im
.
c⁄fig
, "chinese")) ;

156 
	`Æ_waô_f‹_evít
–
glb_d2im
.
evít_queue
, &
evít
 );

158 
evít
.
ty≥
) {

159 
ALLEGRO_EVENT_DISPLAY_CLOSE
:

164 
ALLEGRO_EVENT_KEY_DOWN
:

166 i‡(
evít
.
keybﬂrd
.
keycode
 =
ALLEGRO_KEY_ESCAPE
)

172 
ALLEGRO_EVENT_TIMER
:

181 
	`Æ_Êù_di•œy
();

184 
	}
}

195 
	$d2im_quô
 ()

199 
	}
}

	@d2im.h

21 #i‚de‡ 
_ö˛uded_d2im_öc__


22 
	#_ö˛uded_d2im_öc__


	)

24 
	~<ik£mñ.h
>

25 
	~<ÆÀgro5/ÆÀgro.h
>

26 
	~<ÆÀgro5/ÆÀgro_f⁄t.h
>

29 
	sD2IM_INST
 {

30 
iks
 * 
	mxml_c⁄fig
;

32 
D2IM_INST
 
	tD2IM_INST
;

33 
D2IM_INST
 
glb_d2im
;

39 
d2im_öô
();

40 
d2im_run
();

41 
d2im_quô
();

	@d2lib/d2scene/d2scene.h

23 
	sD2SCENE
 {

24 
UINT32
 
	mwidth
;

25 
UINT32
 
	mheight
;

27 
UINT32
 
	mf_num
;

28 
UINT32
 
	mw_num
;

31 
D2SCENE
 
	tD2SCENE
;

	@ex_blit.c

3 
	~<ÆÀgro5/ÆÀgro.h
>

4 
	~<ÆÀgro5/ÆÀgro_f⁄t.h
>

5 
	~<ÆÀgro5/ÆÀgro_image.h
>

6 
	~<ÆÀgro5/ÆÀgro_cﬁ‹.h
>

7 
	~<°dio.h
>

8 
	~<°d¨g.h
>

9 
	~<m©h.h
>

11 
	~"comm⁄.c
"

13 
	sExam∂e


15 
ALLEGRO_BITMAP
 *
	m∑âîn
;

16 
ALLEGRO_FONT
 *
	mf⁄t
;

17 
ALLEGRO_EVENT_QUEUE
 *
	mqueue
;

18 
ALLEGRO_COLOR
 
	mbackground
, 
	mãxt
, 
	mwhôe
;

20 
	mtimî
[4], 
	mcou¡î
[4];

21 
	mFPS
;

22 
	mãxt_x
, 
	mãxt_y
;

23 } 
	gex
;

25 
ALLEGRO_BITMAP
 *
	$exam∂e_bôm≠
(
w
, 
h
)

27 
i
, 
j
;

28 
mx
 = 
w
 * 0.5;

29 
my
 = 
h
 * 0.5;

30 
ALLEGRO_STATE
 
°©e
;

31 
ALLEGRO_BITMAP
 *
∑âîn
 = 
	`Æ_¸óã_bôm≠
(
w
, 
h
);

32 
	`Æ_°‹e_°©e
(&
°©e
, 
ALLEGRO_STATE_TARGET_BITMAP
);

33 
	`Æ_£t_èrgë_bôm≠
(
∑âîn
);

34 
	`Æ_lock_bôm≠
(
∑âîn
, 
ALLEGRO_PIXEL_FORMAT_ANY
, 
ALLEGRO_LOCK_WRITEONLY
);

35 
i
 = 0; i < 
w
; i++) {

36 
j
 = 0; j < 
h
; j++) {

37 
a
 = 
	`©™2
(
i
 - 
mx
, 
j
 - 
my
);

38 
d
 = 
	`sqπ
(
	`pow
(
i
 - 
mx
, 2Ë+Öow(
j
 - 
my
, 2));

39 
ßt
 = 
	`pow
(1.0 - 1 / (1 + 
d
 * 0.1), 5);

40 
hue
 = 3 * 
a
 * 180 / 
ALLEGRO_PI
;

41 
hue
 = (huê/ 360 - 
	`Êo‹f
(hue / 360)) * 360;

42 
	`Æ_put_pixñ
(
i
, 
j
, 
	`Æ_cﬁ‹_hsv
(
hue
, 
ßt
, 1));

45 
	`Æ_put_pixñ
(0, 0, 
	`Æ_m≠_rgb
(0, 0, 0));

46 
	`Æ_u∆ock_bôm≠
(
∑âîn
);

47 
	`Æ_ª°‹e_°©e
(&
°©e
);

48  
∑âîn
;

49 
	}
}

51 
	$£t_xy
(
x
, 
y
)

53 
ex
.
ãxt_x
 = 
x
;

54 
ex
.
ãxt_y
 = 
y
;

55 
	}
}

57 
	$gë_xy
(*
x
, *
y
)

59 *
x
 = 
ex
.
ãxt_x
;

60 *
y
 = 
ex
.
ãxt_y
;

61 
	}
}

63 
	$¥öt
(c⁄° *
f‹m©
, ...)

65 
va_li°
 
li°
;

66 
mesßge
[1024];

67 
th
 = 
	`Æ_gë_f⁄t_löe_height
(
ex
.
f⁄t
);

68 
	`va_°¨t
(
li°
, 
f‹m©
);

69 
	`v¢¥ötf
(
mesßge
,  mesßge, 
f‹m©
, 
li°
);

70 
	`va_íd
(
li°
);

71 
	`Æ_£t_bÀndî
(
ALLEGRO_ADD
, 
ALLEGRO_ONE
, 
ALLEGRO_INVERSE_ALPHA
);

72 
	`Æ_døw_ãxtf
(
ex
.
f⁄t
,Éx.
ãxt
,Éx.
ãxt_x
,Éx.
ãxt_y
, 0, "%s", 
mesßge
);

73 
ex
.
ãxt_y
 +
th
;

74 
	}
}

76 
	$°¨t_timî
(
i
)

78 
ex
.
timî
[
i
] -
	`Æ_gë_time
();

79 
ex
.
cou¡î
[
i
]++;

80 
	}
}

82 
	$°›_timî
(
i
)

84 
ex
.
timî
[
i
] +
	`Æ_gë_time
();

85 
	}
}

87 
	$gë_Âs
(
i
)

89 i‡(
ex
.
timî
[
i
] == 0)

91  
ex
.
cou¡î
[
i
] /Éx.
timî
[i];

92 
	}
}

94 
	$døw
()

96 
x
, 
y
;

97 
iw
 = 
	`Æ_gë_bôm≠_width
(
ex
.
∑âîn
);

98 
ih
 = 
	`Æ_gë_bôm≠_height
(
ex
.
∑âîn
);

99 
ALLEGRO_BITMAP
 *
s¸ìn
, *
ãmp
;

100 
ALLEGRO_LOCKED_REGION
 *
lock
;

101 *
d©a
;

102 
size
, 
i
, 
f‹m©
;

104 
	`Æ_£t_bÀndî
(
ALLEGRO_ADD
, 
ALLEGRO_ONE
, 
ALLEGRO_ZERO
);

106 
	`Æ_˛ór_to_cﬁ‹
(
ex
.
background
);

108 
s¸ìn
 = 
	`Æ_gë_èrgë_bôm≠
();

110 
	`£t_xy
(8, 8);

126 
	`¥öt
("S¸ì¿-> Bôm≠ -> S¸ì¿(%.1‡Âs)", 
	`gë_Âs
(1));

127 
	`gë_xy
(&
x
, &
y
);

128 
	`Æ_døw_bôm≠
(
ex
.
∑âîn
, 
x
, 
y
, 0);

130 
ãmp
 = 
	`Æ_¸óã_bôm≠
(
iw
, 
ih
);

131 
	`Æ_£t_èrgë_bôm≠
(
ãmp
);

132 
	`Æ_˛ór_to_cﬁ‹
(
	`Æ_m≠_rgba_f
(1, 0, 0, 1));

133 
	`°¨t_timî
(1);

134 
	`Æ_døw_bôm≠_ªgi⁄
(
s¸ìn
, 
x
, 
y
, 
iw
, 
ih
, 0, 0, 0);

136 
	`Æ_£t_èrgë_bôm≠
(
s¸ìn
);

137 
	`Æ_døw_bôm≠
(
ãmp
, 
x
 + 8 + 
iw
, 
y
, 0);

138 
	`°›_timî
(1);

139 
	`£t_xy
(
x
, 
y
 + 
ih
);

141 
	`Æ_de°roy_bôm≠
(
ãmp
);

144 
	`¥öt
("S¸ì¿-> Mem‹y -> S¸ì¿(%.1‡Âs)", 
	`gë_Âs
(2));

145 
	`gë_xy
(&
x
, &
y
);

146 
	`Æ_døw_bôm≠
(
ex
.
∑âîn
, 
x
, 
y
, 0);

148 
	`Æ_£t_√w_bôm≠_Êags
(
ALLEGRO_MEMORY_BITMAP
);

149 
ãmp
 = 
	`Æ_¸óã_bôm≠
(
iw
, 
ih
);

150 
	`Æ_£t_èrgë_bôm≠
(
ãmp
);

151 
	`Æ_˛ór_to_cﬁ‹
(
	`Æ_m≠_rgba_f
(1, 0, 0, 1));

152 
	`°¨t_timî
(2);

153 
	`Æ_døw_bôm≠_ªgi⁄
(
s¸ìn
, 
x
, 
y
, 
iw
, 
ih
, 0, 0, 0);

155 
	`Æ_£t_èrgë_bôm≠
(
s¸ìn
);

156 
	`Æ_døw_bôm≠
(
ãmp
, 
x
 + 8 + 
iw
, 
y
, 0);

157 
	`°›_timî
(2);

158 
	`£t_xy
(
x
, 
y
 + 
ih
);

160 
	`Æ_de°roy_bôm≠
(
ãmp
);

161 
	`Æ_£t_√w_bôm≠_Êags
(
ALLEGRO_VIDEO_BITMAP
);

164 
	`¥öt
("S¸ì¿-> Locked -> S¸ì¿(%.1‡Âs)", 
	`gë_Âs
(3));

165 
	`gë_xy
(&
x
, &
y
);

166 
	`Æ_døw_bôm≠
(
ex
.
∑âîn
, 
x
, 
y
, 0);

168 
	`°¨t_timî
(3);

169 
lock
 = 
	`Æ_lock_bôm≠_ªgi⁄
(
s¸ìn
, 
x
, 
y
, 
iw
, 
ih
,

170 
ALLEGRO_PIXEL_FORMAT_ANY
, 
ALLEGRO_LOCK_READONLY
);

171 
f‹m©
 = 
lock
->format;

172 
size
 = 
lock
->
pixñ_size
;

173 
d©a
 = 
	`mÆloc
(
size
 * 
iw
 * 
ih
);

174 
i
 = 0; i < 
ih
; i++)

175 
	`mem˝y
((*)
d©a
 + 
i
 * 
size
 * 
iw
,

176 (*)
lock
->
d©a
 + 
i
 *Üock->
pôch
, 
size
 * 
iw
);

177 
	`Æ_u∆ock_bôm≠
(
s¸ìn
);

179 
lock
 = 
	`Æ_lock_bôm≠_ªgi⁄
(
s¸ìn
, 
x
 + 8 + 
iw
, 
y
, iw, 
ih
, 
f‹m©
,

180 
ALLEGRO_LOCK_WRITEONLY
);

181 
i
 = 0; i < 
ih
; i++)

182 
	`mem˝y
((*)
lock
->
d©a
 + 
i
 *Üock->
pôch
,

183 (*)
d©a
 + 
i
 * 
size
 * 
iw
, size * iw);

184 
	`Æ_u∆ock_bôm≠
(
s¸ìn
);

185 
	`‰ì
(
d©a
);

186 
	`°›_timî
(3);

187 
	`£t_xy
(
x
, 
y
 + 
ih
);

189 
	}
}

191 
	$tick
()

193 
	`døw
();

194 
	`Æ_Êù_di•œy
();

195 
	}
}

197 
	$run
()

199 
ALLEGRO_EVENT
 
evít
;

200 
boﬁ
 
√ed_døw
 = 
åue
;

203 i‡(
√ed_døw
 && 
	`Æ_is_evít_queue_em±y
(
ex
.
queue
)) {

204 
	`tick
();

205 
√ed_døw
 = 
Ál£
;

208 
	`Æ_waô_f‹_evít
(
ex
.
queue
, &
evít
);

210 
evít
.
ty≥
) {

211 
ALLEGRO_EVENT_DISPLAY_CLOSE
:

214 
ALLEGRO_EVENT_KEY_DOWN
:

215 i‡(
evít
.
keybﬂrd
.
keycode
 =
ALLEGRO_KEY_ESCAPE
)

219 
ALLEGRO_EVENT_TIMER
:

220 
√ed_døw
 = 
åue
;

224 
	}
}

226 
	$öô
()

228 
ex
.
FPS
 = 60;

230 
ex
.
f⁄t
 = 
	`Æ_lﬂd_f⁄t
("data/fixed_font.tga", 0, 0);

231 i‡(!
ex
.
f⁄t
) {

232 
	`ab‹t_exam∂e
("data/fixed_font.tgaÇot found\n");

234 
ex
.
background
 = 
	`Æ_cﬁ‹_«me
("beige");

235 
ex
.
ãxt
 = 
	`Æ_cﬁ‹_«me
("black");

236 
ex
.
whôe
 = 
	`Æ_cﬁ‹_«me
("white");

237 
ex
.
∑âîn
 = 
	`exam∂e_bôm≠
(100, 100);

238 
	}
}

240 
	$maö
()

242 
ALLEGRO_DISPLAY
 *
di•œy
;

243 
ALLEGRO_TIMER
 *
timî
;

245 i‡(!
	`Æ_öô
()) {

246 
	`ab‹t_exam∂e
("CouldÇot init Allegro.\n");

249 
	`Æ_ö°Æl_keybﬂrd
();

250 
	`Æ_ö°Æl_mou£
();

251 
	`Æ_öô_image_add⁄
();

252 
	`Æ_öô_f⁄t_add⁄
();

254 
di•œy
 = 
	`Æ_¸óã_di•œy
(640, 480);

255 i‡(!
di•œy
) {

256 
	`ab‹t_exam∂e
("Error creating display\n");

259 
	`öô
();

261 
timî
 = 
	`Æ_¸óã_timî
(1.0 / 
ex
.
FPS
);

263 
ex
.
queue
 = 
	`Æ_¸óã_evít_queue
();

264 
	`Æ_ªgi°î_evít_sour˚
(
ex
.
queue
, 
	`Æ_gë_keybﬂrd_evít_sour˚
());

265 
	`Æ_ªgi°î_evít_sour˚
(
ex
.
queue
, 
	`Æ_gë_mou£_evít_sour˚
());

266 
	`Æ_ªgi°î_evít_sour˚
(
ex
.
queue
, 
	`Æ_gë_di•œy_evít_sour˚
(
di•œy
));

267 
	`Æ_ªgi°î_evít_sour˚
(
ex
.
queue
, 
	`Æ_gë_timî_evít_sour˚
(
timî
));

269 
	`Æ_°¨t_timî
(
timî
);

270 
	`run
();

272 
	`Æ_de°roy_evít_queue
(
ex
.
queue
);

275 
	}
}

	@ex_drawpixels.c

1 
	~<ÆÀgro5/ÆÀgro.h
>

2 
	~<°dio.h
>

4 
	~"comm⁄.c
"

6 
	#WIDTH
 640

	)

7 
	#HEIGHT
 480

	)

8 
	#NUM_STARS
 300

	)

9 
	#TARGET_FPS
 9999

	)

12 
	sPoöt


14 
	mx
, 
	my
;

15 } 
	tPoöt
;

18 
	$maö
()

20 
ALLEGRO_DISPLAY
 *
di•œy
;

21 
ALLEGRO_KEYBOARD_STATE
 
key_°©e
;

22 
Poöt
 
°¨s
[3][
NUM_STARS
/3];

23 
•ìds
[3] = { 0.0001f, 0.05f, 0.15f };

24 
ALLEGRO_COLOR
 
cﬁ‹s
[3];

25 
°¨t
, 
now
, 
ñ≠£d
, 
‰ame_cou¡
;

26 
tŸÆ_‰ames
 = 0;

27 
¥ogøm_°¨t
;

28 
Àngth
;

29 
œyî
, 
°¨
;

31 i‡(!
	`Æ_öô
()) {

32 
	`ab‹t_exam∂e
("CouldÇot init Allegro.\n");

35 
	`›í_log
();

37 
	`Æ_ö°Æl_keybﬂrd
();

39 
di•œy
 = 
	`Æ_¸óã_di•œy
(
WIDTH
, 
HEIGHT
);

40 i‡(!
di•œy
) {

41 
	`ab‹t_exam∂e
("CouldÇot create display.\n");

44 
cﬁ‹s
[0] = 
	`Æ_m≠_rgba
(255, 100, 255, 128);

45 
cﬁ‹s
[1] = 
	`Æ_m≠_rgba
(255, 100, 100, 255);

46 
cﬁ‹s
[2] = 
	`Æ_m≠_rgba
(100, 100, 255, 255);

48 
œyî
 = 0;Üayer < 3;Üayer++) {

49 
°¨
 = 0; sè∏< 
NUM_STARS
/3; star++) {

50 
Poöt
 *
p
 = &
°¨s
[
œyî
][
°¨
];

51 
p
->
x
 = 
	`ønd
(Ë% 
WIDTH
;

52 
p
->
y
 = 
	`ønd
(Ë% 
HEIGHT
;

57 
°¨t
 = 
	`Æ_gë_time
() * 1000;

58 
now
 = 
°¨t
;

59 
ñ≠£d
 = 0;

60 
‰ame_cou¡
 = 0;

61 
¥ogøm_°¨t
 = 
	`Æ_gë_time
();

65 i‡(
‰ame_cou¡
 < (1000/
TARGET_FPS
)) {

66 
‰ame_cou¡
 +
ñ≠£d
;

69 
X
, 
Y
;

71 
‰ame_cou¡
 -(1000/
TARGET_FPS
);

72 
	`Æ_˛ór_to_cﬁ‹
(
	`Æ_m≠_rgb
(0, 0, 0));

73 
°¨
 = 0; sè∏< 
NUM_STARS
/3; star++) {

74 
Poöt
 *
p
 = &
°¨s
[0][
°¨
];

75 
	`Æ_døw_pixñ
(
p
->
x
,Ö->
y
, 
cﬁ‹s
[0]);

77 
	`Æ_lock_bôm≠
(
	`Æ_gë_backbuf„r
(
di•œy
), 
ALLEGRO_PIXEL_FORMAT_ANY
, 0);

79 
œyî
 = 1;Üayer < 3;Üayer++) {

80 
°¨
 = 0; sè∏< 
NUM_STARS
/3; star++) {

81 
Poöt
 *
p
 = &
°¨s
[
œyî
][
°¨
];

83 
	`Æ_put_pixñ
(
p
->
x
,Ö->
y
, 
cﬁ‹s
[
œyî
]);

88 
X
 = 
WIDTH
 - 1;

89 
Y
 = 
HEIGHT
 - 1;

90 
	`Æ_put_pixñ
(0, 0, 
	`Æ_m≠_rgb_f
(1, 1, 1));

91 
	`Æ_put_pixñ
(
X
, 0, 
	`Æ_m≠_rgb_f
(1, 1, 1));

92 
	`Æ_put_pixñ
(0, 
Y
, 
	`Æ_m≠_rgb_f
(1, 1, 1));

93 
	`Æ_put_pixñ
(
X
, 
Y
, 
	`Æ_m≠_rgb_f
(1, 1, 1));

95 
	`Æ_u∆ock_bôm≠
(
	`Æ_gë_backbuf„r
(
di•œy
));

96 
	`Æ_Êù_di•œy
();

97 
tŸÆ_‰ames
++;

100 
now
 = 
	`Æ_gë_time
() * 1000;

101 
ñ≠£d
 = 
now
 - 
°¨t
;

102 
°¨t
 = 
now
;

104 
œyî
 = 0;Üayer < 3;Üayer++) {

105 
°¨
 = 0; sè∏< 
NUM_STARS
/3; star++) {

106 
Poöt
 *
p
 = &
°¨s
[
œyî
][
°¨
];

107 
p
->
y
 -
•ìds
[
œyî
] * 
ñ≠£d
;

108 i‡(
p
->
y
 < 0) {

109 
p
->
x
 = 
	`ønd
(Ë% 
WIDTH
;

110 
p
->
y
 = 
HEIGHT
;

115 
	`Æ_ª°
(0.001);

117 
	`Æ_gë_keybﬂrd_°©e
(&
key_°©e
);

118 i‡(
	`Æ_key_down
(&
key_°©e
, 
ALLEGRO_KEY_ESCAPE
))

122 
Àngth
 = 
	`Æ_gë_time
(Ë- 
¥ogøm_°¨t
;

124 i‡(
Àngth
 != 0) {

125 
	`log_¥ötf
("%d FPS\n", ()(
tŸÆ_‰ames
 / 
Àngth
));

128 
	`Æ_de°roy_di•œy
(
di•œy
);

130 
	`˛o£_log
(
åue
);

133 
	}
}

	@main.c

23 
	~"maö.h
"

24 
	~<°dlib.h
>

25 
	~<°dio.h
>

32 
	$maö
 ( 
¨gc
, *
¨gv
[] )

34 
	`d2im_öô
();

35 
	`d2im_run
();

36 
	`d2im_quô
();

38 
	}
}

	@main.h

22 #i‚de‡ 
_ö˛uded_maö_öc__


23 
	#_ö˛uded_maö_öc__


	)

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<°döt.h
>

28 
	~"d2im.h
"

	@/usr/include/arpa/inet.h

19 #i‚de‡
_ARPA_INET_H


20 
	#_ARPA_INET_H
 1

	)

22 
	~<„©uªs.h
>

23 
	~<√töë/ö.h
>

26 #i‚de‡
__sockÀn_t_deföed


27 
__sockÀn_t
 
	tsockÀn_t
;

28 
	#__sockÀn_t_deföed


	)

31 
__BEGIN_DECLS


35 
ö_addr_t
 
	$öë_addr
 (
__c⁄°
 *
__˝
Ë
__THROW
;

38 
ö_addr_t
 
	$öë_ aof
 (
ö_addr
 
__ö
Ë
__THROW
;

42 
ö_addr
 
	$öë_makóddr
 (
ö_addr_t
 
__√t
, in_addr_à
__ho°
)

43 
__THROW
;

46 
ö_addr_t
 
	$öë_√tof
 (
ö_addr
 
__ö
Ë
__THROW
;

50 
ö_addr_t
 
	$öë_√tw‹k
 (
__c⁄°
 *
__˝
Ë
__THROW
;

54 *
	$öë_¡ﬂ
 (
ö_addr
 
__ö
Ë
__THROW
;

59 
	$öë_±⁄
 (
__af
, 
__c⁄°
 *
__ª°ri˘
 
__˝
,

60 *
__ª°ri˘
 
__buf
Ë
__THROW
;

65 
__c⁄°
 *
	$öë_¡›
 (
__af
, 
__c⁄°
 *
__ª°ri˘
 
__˝
,

66 *
__ª°ri˘
 
__buf
, 
sockÀn_t
 
__Àn
)

67 
__THROW
;

71 #ifde‡
__USE_MISC


74 
	$öë_©⁄
 (
__c⁄°
 *
__˝
, 
ö_addr
 *
__öp
Ë
__THROW
;

78 *
	$öë_√è
 (
ö_addr_t
 
__√t
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

83 *
	$öë_√t_¡›
 (
__af
, 
__c⁄°
 *
__˝
, 
__bôs
,

84 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

89 
	$öë_√t_±⁄
 (
__af
, 
__c⁄°
 *
__˝
,

90 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

95 
	$öë_nßp_addr
 (
__c⁄°
 *
__˝
,

96 *
__buf
, 
__Àn
Ë
__THROW
;

100 *
	$öë_nßp_¡ﬂ
 (
__Àn
, 
__c⁄°
 *
__˝
,

101 *
__buf
Ë
__THROW
;

104 
__END_DECLS


	@/usr/include/assert.h

24 #ifdef 
_ASSERT_H


26 #unde‡
_ASSERT_H


27 #unde‡
as£π


28 #unde‡
__ASSERT_VOID_CAST


30 #ifdef 
__USE_GNU


31 #unde‡
as£π_≥º‹


36 
	#_ASSERT_H
 1

	)

37 
	~<„©uªs.h
>

39 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,95)

40 
	#__ASSERT_VOID_CAST
 
°©ic_ˇ°
<>

	)

42 
	#__ASSERT_VOID_CAST
 ()

	)

50 #ifdef 
NDEBUG


52 
	#as£π
(
ex¥
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

60 #ifdef 
__USE_GNU


61 
	#as£π_≥º‹
(
î∫um
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

66 #i‚de‡
_ASSERT_H_DECLS


67 
	#_ASSERT_H_DECLS


	)

68 
__BEGIN_DECLS


71 
	$__as£π_Áû
 (
__c⁄°
 *
__as£πi⁄
, __c⁄° *
__fûe
,

72 
__löe
, 
__c⁄°
 *
__fun˘i⁄
)

73 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

76 
	$__as£π_≥º‹_Áû
 (
__î∫um
, 
__c⁄°
 *
__fûe
,

77 
__löe
,

78 
__c⁄°
 *
__fun˘i⁄
)

79 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

84 
	$__as£π
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
, 
__löe
)

85 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

88 
__END_DECLS


91 
	#as£π
(
ex¥
) \

92 ((
ex¥
) \

93 ? 
	`__ASSERT_VOID_CAST
 (0) \

94 : 
	`__as£π_Áû
 (
	`__STRING
(
ex¥
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

96 #ifdef 
__USE_GNU


97 
	#as£π_≥º‹
(
î∫um
) \

98 (!(
î∫um
) \

99 ? 
	`__ASSERT_VOID_CAST
 (0) \

100 : 
	`__as£π_≥º‹_Áû
 ((
î∫um
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

108 #i‡
deföed
 
__˝lu•lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

109 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

111 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

112 
	#__ASSERT_FUNCTION
 
__func__


	)

114 
	#__ASSERT_FUNCTION
 ((
__c⁄°
 *Ë0)

	)

	@/usr/include/byteswap.h

19 #i‚de‡
_BYTESWAP_H


20 
	#_BYTESWAP_H
 1

	)

23 
	~<bôs/byãsw≠.h
>

30 
	#bsw≠_16
(
x
Ë
	`__bsw≠_16
 (x)

	)

33 
	#bsw≠_32
(
x
Ë
	`__bsw≠_32
 (x)

	)

35 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

37 
	#bsw≠_64
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/ctype.h

24 #i‚def 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<„©uªs.h
>

28 
	~<bôs/ty≥s.h
>

30 
	g__BEGIN_DECLS


32 #i‚de‡
_ISbô


41 
	~<ídün.h
>

42 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


43 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

45 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

50 
	m_ISuµî
 = 
_ISbô
 (0),

51 
	m_ISlowî
 = 
_ISbô
 (1),

52 
	m_ISÆpha
 = 
_ISbô
 (2),

53 
	m_ISdigô
 = 
_ISbô
 (3),

54 
	m_ISxdigô
 = 
_ISbô
 (4),

55 
	m_IS•a˚
 = 
_ISbô
 (5),

56 
	m_IS¥öt
 = 
_ISbô
 (6),

57 
	m_ISgøph
 = 
_ISbô
 (7),

58 
	m_ISbœnk
 = 
_ISbô
 (8),

59 
	m_IS˙ål
 = 
_ISbô
 (9),

60 
	m_ISpun˘
 = 
_ISbô
 (10),

61 
	m_ISÆnum
 = 
_ISbô
 (11)

81 
__c⁄°
 **
	$__˘y≥_b_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°
));

83 
__c⁄°
 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°
));

85 
__c⁄°
 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

86 
__THROW
 
	`__©åibuã__
 ((
__c⁄°
));

88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

91 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

92 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

94 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__ex˘y≥
 (
iß um
);

103 
	`__ex˘y≥
 (
ißÕha
);

104 
	`__ex˘y≥
 (
is˙ål
);

105 
	`__ex˘y≥
 (
isdigô
);

106 
	`__ex˘y≥
 (
i¶owî
);

107 
	`__ex˘y≥
 (
isgøph
);

108 
	`__ex˘y≥
 (
i•röt
);

109 
	`__ex˘y≥
 (
i•un˘
);

110 
	`__ex˘y≥
 (
is•a˚
);

111 
	`__ex˘y≥
 (
isuµî
);

112 
	`__ex˘y≥
 (
isxdigô
);

116 
	$tﬁowî
 (
__c
Ë
__THROW
;

119 
	$touµî
 (
__c
Ë
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__ex˘y≥
 (
isbœnk
);

130 
__END_NAMESPACE_C99


133 #ifde‡
__USE_GNU


135 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

138 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


142 
	$ißscii
 (
__c
Ë
__THROW
;

146 
	$tﬂscii
 (
__c
Ë
__THROW
;

150 
	`__ex˘y≥
 (
_touµî
);

151 
	`__ex˘y≥
 (
_tﬁowî
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

156 (
__exãnsi⁄__
 \

157 ({ 
__ªs
; \

158 i‡( (
c
) > 1) \

160 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

166 
__ªs
 = 
f
 
¨gs
; \

169 
__ªs
 = (
a
)[(Ë(
c
)]; \

170 
__ªs
; 
	}
}))

	)

172 #i‡!
deföed
 
__NO_CTYPE
 && !deföed 
__˝lu•lus


173 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

174 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

175 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

176 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

177 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

178 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

179 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

180 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

181 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

182 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

183 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

185 #ifde‡
__USE_ISOC99


186 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

189 #ifde‡
__USE_EXTERN_INLINES


190 
__exã∫_ölöe
 

191 
__NTH
 (
	$tﬁowî
 (
__c
))

193  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

194 
	}
}

196 
__exã∫_ölöe
 

197 
__NTH
 (
	$touµî
 (
__c
))

199  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

200 
	}
}

203 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


204 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

205 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

208 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


209 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

210 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

212 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

213 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

219 #ifde‡
__USE_XOPEN2K8


233 
	~<xloˇÀ.h
>

237 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

238 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

240 
	#__ex˘y≥_l
(
«me
) \

241 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

247 
__ex˘y≥_l
 (
iß um_l
);

248 
__ex˘y≥_l
 (
ißÕha_l
);

249 
__ex˘y≥_l
 (
is˙ål_l
);

250 
__ex˘y≥_l
 (
isdigô_l
);

251 
__ex˘y≥_l
 (
i¶owî_l
);

252 
__ex˘y≥_l
 (
isgøph_l
);

253 
__ex˘y≥_l
 (
i•röt_l
);

254 
__ex˘y≥_l
 (
i•un˘_l
);

255 
__ex˘y≥_l
 (
is•a˚_l
);

256 
__ex˘y≥_l
 (
isuµî_l
);

257 
__ex˘y≥_l
 (
isxdigô_l
);

259 
__ex˘y≥_l
 (
isbœnk_l
);

263 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

264 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

267 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

268 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

270 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


271 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

272 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

273 
	#__touµî_l
(
c
, 
loˇÀ
) \

274 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

275 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

276 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

280 #i‚de‡
__NO_CTYPE


281 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

282 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

283 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

284 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

285 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

286 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

287 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

288 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

289 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

290 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

291 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

293 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

295 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC


296 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

297 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

300 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

301 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

302 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

303 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

304 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

305 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

306 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

307 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

308 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

309 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

310 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

312 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

314 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC


315 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

316 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/dirent.h

23 #i‚def 
_DIRENT_H


24 
	#_DIRENT_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


30 
	~<bôs/ty≥s.h
>

32 #ifde‡
__USE_XOPEN


33 #i‚de‡
__öo_t_deföed


34 #i‚de‡
__USE_FILE_OFFSET64


35 
__öo_t
 
	töo_t
;

37 
__öo64_t
 
	töo_t
;

39 
	#__öo_t_deföed


	)

41 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__öo64_t_deföed


42 
__öo64_t
 
	töo64_t
;

43 
	#__öo64_t_deföed


	)

62 
	~<bôs/dúít.h
>

64 #i‡(
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
Ë&& !deföed 
d_fûío


65 
	#d_öo
 
d_fûío


	)

82 #ifde‡
_DIRENT_HAVE_D_NAMLEN


83 
	#_D_EXACT_NAMLEN
(
d
Ë((d)->
d_«mÀn
)

	)

84 
	#_D_ALLOC_NAMLEN
(
d
Ë(
	`_D_EXACT_NAMLEN
 (dË+ 1)

	)

86 
	#_D_EXACT_NAMLEN
(
d
Ë(
	`°æí
 ((d)->
d_«me
))

	)

87 #ifde‡
_DIRENT_HAVE_D_RECLEN


88 
	#_D_ALLOC_NAMLEN
(
d
Ë(((*Ë(dË+ (d)->
d_ª˛í
Ë- &(d)->
d_«me
[0])

	)

90 
	#_D_ALLOC_NAMLEN
(
d
Ë( (d)->
d_«me
 > 1 ?  (d)->d_name : \

91 
	`_D_EXACT_NAMLEN
 (
d
Ë+ 1)

	)

96 #ifde‡
__USE_BSD


100 
	mDT_UNKNOWN
 = 0,

101 
	#DT_UNKNOWN
 
DT_UNKNOWN


	)

102 
	mDT_FIFO
 = 1,

103 
	#DT_FIFO
 
DT_FIFO


	)

104 
	mDT_CHR
 = 2,

105 
	#DT_CHR
 
DT_CHR


	)

106 
	mDT_DIR
 = 4,

107 
	#DT_DIR
 
DT_DIR


	)

108 
	mDT_BLK
 = 6,

109 
	#DT_BLK
 
DT_BLK


	)

110 
	mDT_REG
 = 8,

111 
	#DT_REG
 
DT_REG


	)

112 
	mDT_LNK
 = 10,

113 
	#DT_LNK
 
DT_LNK


	)

114 
	mDT_SOCK
 = 12,

115 
	#DT_SOCK
 
DT_SOCK


	)

116 
	mDT_WHT
 = 14

117 
	#DT_WHT
 
DT_WHT


	)

121 
	#IFTODT
(
mode
Ë(((modeË& 0170000Ë>> 12)

	)

122 
	#DTTOIF
(
dúty≥
Ë((dúty≥Ë<< 12)

	)

128 
__dú°ªam
 
	tDIR
;

135 
DIR
 *
	$›ídú
 (
__c⁄°
 *
__«me
Ë
	`__n⁄nuŒ
 ((1));

137 #ifde‡
__USE_XOPEN2K8


142 
DIR
 *
	`fd›ídú
 (
__fd
);

150 
	$˛o£dú
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

162 #i‚de‡
__USE_FILE_OFFSET64


163 
dúít
 *
	$ªaddú
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

165 #ifde‡
__REDIRECT


166 
dúít
 *
	`__REDIRECT
 (
ªaddú
, (
DIR
 *
__dúp
), 
ªaddú64
)

167 
	`__n⁄nuŒ
 ((1));

169 
	#ªaddú
 
ªaddú64


	)

173 #ifde‡
__USE_LARGEFILE64


174 
dúít64
 *
	$ªaddú64
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

177 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


183 #i‚de‡
__USE_FILE_OFFSET64


184 
	$ªaddú_r
 (
DIR
 *
__ª°ri˘
 
__dúp
,

185 
dúít
 *
__ª°ri˘
 
__íåy
,

186 
dúít
 **
__ª°ri˘
 
__ªsu…
)

187 
	`__n⁄nuŒ
 ((1, 2, 3));

189 #ifde‡
__REDIRECT


190 
	`__REDIRECT
 (
ªaddú_r
,

191 (
DIR
 *
__ª°ri˘
 
__dúp
,

192 
dúít
 *
__ª°ri˘
 
__íåy
,

193 
dúít
 **
__ª°ri˘
 
__ªsu…
),

194 
ªaddú64_r
Ë
	`__n⁄nuŒ
 ((1, 2, 3));

196 
	#ªaddú_r
 
ªaddú64_r


	)

200 #ifde‡
__USE_LARGEFILE64


201 
	$ªaddú64_r
 (
DIR
 *
__ª°ri˘
 
__dúp
,

202 
dúít64
 *
__ª°ri˘
 
__íåy
,

203 
dúít64
 **
__ª°ri˘
 
__ªsu…
)

204 
	`__n⁄nuŒ
 ((1, 2, 3));

209 
	$ªwöddú
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

211 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


212 
	~<bôs/ty≥s.h
>

215 
	$£ekdú
 (
DIR
 *
__dúp
, 
__pos
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

218 
	$ãŒdú
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

221 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN2K8


224 
	$dúfd
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

226 #i‡
deföed
 
__OPTIMIZE__
 && deföed 
_DIR_dúfd


227 
	#dúfd
(
dúp
Ë
	`_DIR_dúfd
 (dúp)

	)

230 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC


231 #i‚de‡
MAXNAMLEN


233 
	~<bôs/posix1_lim.h
>

236 #ifde‡
NAME_MAX


237 
	#MAXNAMLEN
 
NAME_MAX


	)

239 
	#MAXNAMLEN
 255

	)

244 
	#__√ed_size_t


	)

245 
	~<°ddef.h
>

251 #i‚de‡
__USE_FILE_OFFSET64


252 
	`sˇndú
 (
__c⁄°
 *
__ª°ri˘
 
__dú
,

253 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

254 (*
__£À˘‹
Ë(
__c⁄°
 
dúít
 *),

255 (*
__cmp
Ë(
__c⁄°
 
dúít
 **,

256 
__c⁄°
 
dúít
 **))

257 
	`__n⁄nuŒ
 ((1, 2));

259 #ifde‡
__REDIRECT


260 
	`__REDIRECT
 (
sˇndú
,

261 (
__c⁄°
 *
__ª°ri˘
 
__dú
,

262 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

263 (*
__£À˘‹
Ë(
__c⁄°
 
dúít
 *),

264 (*
__cmp
Ë(
__c⁄°
 
dúít
 **,

265 
__c⁄°
 
dúít
 **)),

266 
sˇndú64
Ë
	`__n⁄nuŒ
 ((1, 2));

268 
	#sˇndú
 
sˇndú64


	)

272 #i‡
deföed
 
__USE_GNU
 && deföed 
__USE_LARGEFILE64


275 
	`sˇndú64
 (
__c⁄°
 *
__ª°ri˘
 
__dú
,

276 
dúít64
 ***
__ª°ri˘
 
__«mñi°
,

277 (*
__£À˘‹
Ë(
__c⁄°
 
dúít64
 *),

278 (*
__cmp
Ë(
__c⁄°
 
dúít64
 **,

279 
__c⁄°
 
dúít64
 **))

280 
	`__n⁄nuŒ
 ((1, 2));

284 #i‚de‡
__USE_FILE_OFFSET64


285 
	$Æphas‹t
 (
__c⁄°
 
dúít
 **
__e1
,

286 
__c⁄°
 
dúít
 **
__e2
)

287 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

289 #ifde‡
__REDIRECT


290 
	`__REDIRECT_NTH
 (
Æphas‹t
,

291 (
__c⁄°
 
dúít
 **
__e1
,

292 
__c⁄°
 
dúít
 **
__e2
),

293 
Æphas‹t64
Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

295 
	#Æphas‹t
 
Æphas‹t64


	)

299 #i‡
deföed
 
__USE_GNU
 && deföed 
__USE_LARGEFILE64


300 
	$Æphas‹t64
 (
__c⁄°
 
dúít64
 **
__e1
,

301 
__c⁄°
 
dúít64
 **
__e2
)

302 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

307 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC


312 #i‚de‡
__USE_FILE_OFFSET64


313 
__ssize_t
 
	$gëdúíåõs
 (
__fd
, *
__ª°ri˘
 
__buf
,

314 
size_t
 
__nbyãs
,

315 
__off_t
 *
__ª°ri˘
 
__ba£p
)

316 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

318 #ifde‡
__REDIRECT


319 
__ssize_t
 
	`__REDIRECT_NTH
 (
gëdúíåõs
,

320 (
__fd
, *
__ª°ri˘
 
__buf
,

321 
size_t
 
__nbyãs
,

322 
__off64_t
 *
__ª°ri˘
 
__ba£p
),

323 
gëdúíåõs64
Ë
	`__n⁄nuŒ
 ((2, 4));

325 
	#gëdúíåõs
 
gëdúíåõs64


	)

329 #ifde‡
__USE_LARGEFILE64


330 
__ssize_t
 
	$gëdúíåõs64
 (
__fd
, *
__ª°ri˘
 
__buf
,

331 
size_t
 
__nbyãs
,

332 
__off64_t
 *
__ª°ri˘
 
__ba£p
)

333 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

337 #ifde‡
__USE_GNU


339 #i‚de‡
__USE_FILE_OFFSET64


340 
	$vîsi⁄s‹t
 (
__c⁄°
 
dúít
 **
__e1
,

341 
__c⁄°
 
dúít
 **
__e2
)

342 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

344 #ifde‡
__REDIRECT


345 
	`__REDIRECT_NTH
 (
vîsi⁄s‹t
,

346 (
__c⁄°
 
dúít
 **
__e1
,

347 
__c⁄°
 
dúít
 **
__e2
),

348 
vîsi⁄s‹t64
)

349 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

351 
	#vîsi⁄s‹t
 
vîsi⁄s‹t64


	)

355 #ifde‡
__USE_LARGEFILE64


356 
	$vîsi⁄s‹t64
 (
__c⁄°
 
dúít64
 **
__e1
,

357 
__c⁄°
 
dúít64
 **
__e2
)

358 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

362 
__END_DECLS


	@/usr/include/endian.h

19 #i‚def 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<„©uªs.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<bôs/ídün.h
>

41 #i‚de‡
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

54 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

59 #ifde‡
__USE_BSD


61 
	~<bôs/byãsw≠.h
>

63 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


64 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

65 
	#htﬁe16
(
x
Ë(x)

	)

66 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

67 
	#À16toh
(
x
Ë(x)

	)

69 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

70 
	#htﬁe32
(
x
Ë(x)

	)

71 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

72 
	#À32toh
(
x
Ë(x)

	)

74 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

75 
	#htﬁe64
(
x
Ë(x)

	)

76 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

77 
	#À64toh
(
x
Ë(x)

	)

79 
	#htobe16
(
x
Ë(x)

	)

80 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

81 
	#be16toh
(
x
Ë(x)

	)

82 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

84 
	#htobe32
(
x
Ë(x)

	)

85 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

86 
	#be32toh
(
x
Ë(x)

	)

87 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

89 
	#htobe64
(
x
Ë(x)

	)

90 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

91 
	#be64toh
(
x
Ë(x)

	)

92 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/err.h

20 #i‚def 
_ERR_H


21 
	#_ERR_H
 1

	)

23 
	~<„©uªs.h
>

25 
	#__√ed___va_li°


	)

26 
	~<°d¨g.h
>

27 #i‚def 
__GNUC_VA_LIST


28 
	#__gnuc_va_li°
 
__±r_t


	)

31 
__BEGIN_DECLS


35 
	$w¨n
 (
__c⁄°
 *
__f‹m©
, ...)

36 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 2)));

37 
	$vw¨n
 (
__c⁄°
 *
__f‹m©
, 
__gnuc_va_li°
)

38 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 0)));

41 
	$w¨nx
 (
__c⁄°
 *
__f‹m©
, ...)

42 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 2)));

43 
	$vw¨nx
 (
__c⁄°
 *
__f‹m©
, 
__gnuc_va_li°
)

44 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 0)));

47 
	$îr
 (
__°©us
, 
__c⁄°
 *
__f‹m©
, ...)

48 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

49 
	$vîr
 (
__°©us
, 
__c⁄°
 *
__f‹m©
, 
__gnuc_va_li°
)

50 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

51 
	$îrx
 (
__°©us
, 
__c⁄°
 *
__f‹m©
, ...)

52 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

53 
	$vîrx
 (
__°©us
, 
__c⁄°
 *, 
__gnuc_va_li°
)

54 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

56 
__END_DECLS


	@/usr/include/errno.h

23 #i‚def 
_ERRNO_H


27 #i‚def 
__√ed_Em©h


28 
	#_ERRNO_H
 1

	)

29 
	~<„©uªs.h
>

32 
	g__BEGIN_DECLS


36 
	~<bôs/î∫o.h
>

37 #unde‡
__√ed_Em©h


39 #ifdef 
_ERRNO_H


46 #i‚def 
î∫o


47 
î∫o
;

50 #ifde‡
__USE_GNU


55 *
¥ogøm_övoˇti⁄_«me
, *
¥ogøm_övoˇti⁄_sh‹t_«me
;

59 
	g__END_DECLS


67 #i‡
deföed
 
__USE_GNU
 || deföed 
__√ed_îr‹_t


68 #i‚de‡
__îr‹_t_deföed


69 
	tîr‹_t
;

70 
	#__îr‹_t_deföed
 1

	)

72 #unde‡
__√ed_îr‹_t


	@/usr/include/execinfo.h

19 #i‚de‡
_EXECINFO_H


20 
	#_EXECINFO_H
 1

	)

22 
	~<„©uªs.h
>

24 
__BEGIN_DECLS


28 
	$backåa˚
 (**
__¨øy
, 
__size
Ë
	`__n⁄nuŒ
 ((1));

33 **
	$backåa˚_symbﬁs
 (*
__c⁄°
 *
__¨øy
, 
__size
)

34 
__THROW
 
	`__n⁄nuŒ
 ((1));

39 
	$backåa˚_symbﬁs_fd
 (*
__c⁄°
 *
__¨øy
, 
__size
, 
__fd
)

40 
__THROW
 
	`__n⁄nuŒ
 ((1));

42 
__END_DECLS


	@/usr/include/fcntl.h

24 #i‚def 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


34 
	~<bôs/f˙é.h
>

37 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


38 
	~<bôs/ty≥s.h
>

39 
	#__√ed_time•ec


	)

40 
	~<time.h
>

41 
	~<bôs/°©.h
>

43 
	#S_IFMT
 
__S_IFMT


	)

44 
	#S_IFDIR
 
__S_IFDIR


	)

45 
	#S_IFCHR
 
__S_IFCHR


	)

46 
	#S_IFBLK
 
__S_IFBLK


	)

47 
	#S_IFREG
 
__S_IFREG


	)

48 #ifde‡
__S_IFIFO


49 
	#S_IFIFO
 
__S_IFIFO


	)

51 #ifde‡
__S_IFLNK


52 
	#S_IFLNK
 
__S_IFLNK


	)

54 #i‡(
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8
Ë&& deföed 
__S_IFSOCK


55 
	#S_IFSOCK
 
__S_IFSOCK


	)

60 
	#S_ISUID
 
__S_ISUID


	)

61 
	#S_ISGID
 
__S_ISGID


	)

63 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


65 
	#S_ISVTX
 
__S_ISVTX


	)

68 
	#S_IRUSR
 
__S_IREAD


	)

69 
	#S_IWUSR
 
__S_IWRITE


	)

70 
	#S_IXUSR
 
__S_IEXEC


	)

72 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

74 
	#S_IRGRP
 (
S_IRUSR
 >> 3Ë

	)

75 
	#S_IWGRP
 (
S_IWUSR
 >> 3Ë

	)

76 
	#S_IXGRP
 (
S_IXUSR
 >> 3Ë

	)

78 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

80 
	#S_IROTH
 (
S_IRGRP
 >> 3Ë

	)

81 
	#S_IWOTH
 (
S_IWGRP
 >> 3Ë

	)

82 
	#S_IXOTH
 (
S_IXGRP
 >> 3Ë

	)

84 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

87 #ifdef 
__USE_MISC


88 #i‚de‡
R_OK


91 
	#R_OK
 4

	)

92 
	#W_OK
 2

	)

93 
	#X_OK
 1

	)

94 
	#F_OK
 0

	)

99 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


100 
	#SEEK_SET
 0

	)

101 
	#SEEK_CUR
 1

	)

102 
	#SEEK_END
 2

	)

110 
f˙é
 (
__fd
, 
__cmd
, ...);

118 #i‚de‡
__USE_FILE_OFFSET64


119 
	$›í
 (
__c⁄°
 *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

121 #ifde‡
__REDIRECT


122 
	`__REDIRECT
 (
›í
, (
__c⁄°
 *
__fûe
, 
__oÊag
, ...), 
›í64
)

123 
	`__n⁄nuŒ
 ((1));

125 
	#›í
 
›í64


	)

128 #ifde‡
__USE_LARGEFILE64


129 
	$›í64
 (
__c⁄°
 *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

132 #ifde‡
__USE_ATFILE


142 #i‚de‡
__USE_FILE_OFFSET64


143 
	$›í©
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__oÊag
, ...)

144 
	`__n⁄nuŒ
 ((2));

146 #ifde‡
__REDIRECT


147 
	`__REDIRECT
 (
›í©
, (
__fd
, 
__c⁄°
 *
__fûe
, 
__oÊag
,

148 ...), 
›í©64
Ë
	`__n⁄nuŒ
 ((2));

150 
	#›í©
 
›í©64


	)

153 #ifde‡
__USE_LARGEFILE64


154 
	$›í©64
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__oÊag
, ...)

155 
	`__n⁄nuŒ
 ((2));

164 #i‚de‡
__USE_FILE_OFFSET64


165 
	$¸ót
 (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

167 #ifde‡
__REDIRECT


168 
	`__REDIRECT
 (
¸ót
, (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
),

169 
¸ót64
Ë
	`__n⁄nuŒ
 ((1));

171 
	#¸ót
 
¸ót64


	)

174 #ifde‡
__USE_LARGEFILE64


175 
	$¸ót64
 (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

178 #i‡!
deföed
 
F_LOCK
 && (deföed 
__USE_MISC
 || (deföed 
__USE_XOPEN_EXTENDED
 \

179 && !
deföed
 
__USE_POSIX
))

188 
	#F_ULOCK
 0

	)

189 
	#F_LOCK
 1

	)

190 
	#F_TLOCK
 2

	)

191 
	#F_TEST
 3

	)

193 #i‚de‡
__USE_FILE_OFFSET64


194 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
);

196 #ifde‡
__REDIRECT


197 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
), 
lockf64
);

199 
	#lockf
 
lockf64


	)

202 #ifde‡
__USE_LARGEFILE64


203 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
);

207 #ifde‡
__USE_XOPEN2K


210 #i‚de‡
__USE_FILE_OFFSET64


211 
	$posix_Ádvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_à
__Àn
,

212 
__advi£
Ë
__THROW
;

214 #ifde‡
__REDIRECT_NTH


215 
	`__REDIRECT_NTH
 (
posix_Ádvi£
, (
__fd
, 
__off64_t
 
__off£t
,

216 
__off64_t
 
__Àn
, 
__advi£
),

217 
posix_Ádvi£64
);

219 
	#posix_Ádvi£
 
posix_Ádvi£64


	)

222 #ifde‡
__USE_LARGEFILE64


223 
	$posix_Ádvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_à
__Àn
,

224 
__advi£
Ë
__THROW
;

232 #i‚de‡
__USE_FILE_OFFSET64


233 
	`posix_ÁŒoˇã
 (
__fd
, 
__off_t
 
__off£t
, __off_à
__Àn
);

235 #ifde‡
__REDIRECT


236 
	`__REDIRECT
 (
posix_ÁŒoˇã
, (
__fd
, 
__off64_t
 
__off£t
,

237 
__off64_t
 
__Àn
),

238 
posix_ÁŒoˇã64
);

240 
	#posix_ÁŒoˇã
 
posix_ÁŒoˇã64


	)

243 #ifde‡
__USE_LARGEFILE64


244 
	`posix_ÁŒoˇã64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_à
__Àn
);

250 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe
 \

251 && 
deföed
 
__va_¨g_∑ck_Àn


252 
	~<bôs/f˙é2.h
>

255 
__END_DECLS


	@/usr/include/fnmatch.h

19 #i‚def 
_FNMATCH_H


20 
	#_FNMATCH_H
 1

	)

22 #ifdef 
__˝lu•lus


27 #i‡(
deföed
 
__STDC__
 && __STDC__Ë|| deföed 
__˝lu•lus


28 
	#__c⁄°
 c⁄°

	)

30 
	#__c⁄°


	)

36 #unde‡
FNM_PATHNAME


37 #unde‡
FNM_NOESCAPE


38 #unde‡
FNM_PERIOD


41 
	#FNM_PATHNAME
 (1 << 0Ë

	)

42 
	#FNM_NOESCAPE
 (1 << 1Ë

	)

43 
	#FNM_PERIOD
 (1 << 2Ë

	)

45 #i‡!
deföed
 
_POSIX_C_SOURCE
 || _POSIX_C_SOURCE < 2 || deföed 
_GNU_SOURCE


46 
	#FNM_FILE_NAME
 
FNM_PATHNAME


	)

47 
	#FNM_LEADING_DIR
 (1 << 3Ë

	)

48 
	#FNM_CASEFOLD
 (1 << 4Ë

	)

49 
	#FNM_EXTMATCH
 (1 << 5Ë

	)

53 
	#FNM_NOMATCH
 1

	)

59 #ifde‡
_XOPEN_SOURCE


60 
	#FNM_NOSYS
 (-1)

	)

65 
‚m©ch
 (
__c⁄°
 *
__∑âîn
, __c⁄° *
__«me
,

66 
__Êags
);

68 #ifdef 
__˝lu•lus


	@/usr/include/getopt.h

21 #i‚de‡
_GETOPT_H


23 #i‚de‡
__√ed_gë›t


24 
	#_GETOPT_H
 1

	)

34 #i‡!
deföed
 
__GNU_LIBRARY__


35 
	~<˘y≥.h
>

38 #i‚de‡
__THROW


39 #i‚de‡
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

42 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__˝lu•lus


59 *
›èrg
;

73 
›töd
;

78 
›ãº
;

82 
›t›t
;

84 #i‚de‡
__√ed_gë›t


106 
	s›ti⁄


108 c⁄° *
	g«me
;

111 
	ghas_¨g
;

112 *
	gÊag
;

113 
	gvÆ
;

118 
	#no_¨gumít
 0

	)

119 
	#ªquúed_¨gumít
 1

	)

120 
	#›ti⁄Æ_¨gumít
 2

	)

148 #ifde‡
__GNU_LIBRARY__


152 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

153 
__THROW
;

155 #i‡
deföed
 
__√ed_gë›t
 && deföed 
__USE_POSIX2
 \

156 && !
deföed
 
	g__USE_POSIX_IMPLICITLY
 && !deföed 
	g__USE_GNU


160 #ifde‡
__REDIRECT


161 
__REDIRECT_NTH
 (
gë›t
, (
___¨gc
, *c⁄° *
___¨gv
,

162 c⁄° *
__sh‹t›ts
),

163 
__posix_gë›t
);

165 
__posix_gë›t
 (
___¨gc
, *c⁄° *
___¨gv
,

166 c⁄° *
__sh‹t›ts
Ë
__THROW
;

167 
	#gë›t
 
__posix_gë›t


	)

171 
gë›t
 ();

174 #i‚de‡
__√ed_gë›t


175 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

176 c⁄° *
__sh‹t›ts
,

177 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

178 
__THROW
;

179 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

180 c⁄° *
__sh‹t›ts
,

181 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

182 
__THROW
;

186 #ifdef 
__˝lu•lus


191 #unde‡
__√ed_gë›t


	@/usr/include/ifaddrs.h

20 #i‚de‡
_IFADDRS_H


21 
	#_IFADDRS_H
 1

	)

23 
	~<„©uªs.h
>

24 
	~<sys/sockë.h
>

26 
__BEGIN_DECLS


30 
	siÁddrs


32 
iÁddrs
 *
	miÁ_√xt
;

34 *
	miÁ_«me
;

35 
	miÁ_Êags
;

37 
sockaddr
 *
	miÁ_addr
;

38 
sockaddr
 *
	miÁ_√tmask
;

45 
sockaddr
 *
	mifu_brﬂdaddr
;

46 
sockaddr
 *
	mifu_d°addr
;

47 } 
	miÁ_ifu
;

50 #i‚de‡
iÁ_brﬂdaddr


51 
	#iÁ_brﬂdaddr
 
iÁ_ifu
.
ifu_brﬂdaddr


	)

53 #i‚de‡
iÁ_d°addr


54 
	#iÁ_d°addr
 
iÁ_ifu
.
ifu_d°addr


	)

57 *
	miÁ_d©a
;

67 
	$gëiÁddrs
 (
iÁddrs
 **
__iÁp
Ë
__THROW
;

70 
	$‰ìiÁddrs
 (
iÁddrs
 *
__iÁ
Ë
__THROW
;

72 
__END_DECLS


	@/usr/include/inttypes.h

23 #i‚de‡
_INTTYPES_H


24 
	#_INTTYPES_H
 1

	)

26 
	~<„©uªs.h
>

28 
	~<°döt.h
>

31 #i‚de‡
____gwch¨_t_deföed


32 #ifde‡
__˝lu•lus


33 
	#__gwch¨_t
 
wch¨_t


	)

34 #ñi‡
deföed
 
__WCHAR_TYPE__


35 
__WCHAR_TYPE__
 
	t__gwch¨_t
;

37 
	#__√ed_wch¨_t


	)

38 
	~<°ddef.h
>

39 
wch¨_t
 
	t__gwch¨_t
;

41 
	#____gwch¨_t_deföed
 1

	)

47 #i‡!
deföed
 
__˝lu•lus
 || deföed 
__STDC_FORMAT_MACROS


49 #i‡
__WORDSIZE
 == 64

50 
	#__PRI64_PREFIX
 "l"

	)

51 
	#__PRIPTR_PREFIX
 "l"

	)

53 
	#__PRI64_PREFIX
 "Œ"

	)

54 
	#__PRIPTR_PREFIX


	)

60 
	#PRId8
 "d"

	)

61 
	#PRId16
 "d"

	)

62 
	#PRId32
 "d"

	)

63 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

65 
	#PRIdLEAST8
 "d"

	)

66 
	#PRIdLEAST16
 "d"

	)

67 
	#PRIdLEAST32
 "d"

	)

68 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIdFAST8
 "d"

	)

71 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

72 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

73 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

76 
	#PRIi8
 "i"

	)

77 
	#PRIi16
 "i"

	)

78 
	#PRIi32
 "i"

	)

79 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

81 
	#PRIiLEAST8
 "i"

	)

82 
	#PRIiLEAST16
 "i"

	)

83 
	#PRIiLEAST32
 "i"

	)

84 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIiFAST8
 "i"

	)

87 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

88 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

89 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

92 
	#PRIo8
 "o"

	)

93 
	#PRIo16
 "o"

	)

94 
	#PRIo32
 "o"

	)

95 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

97 
	#PRIoLEAST8
 "o"

	)

98 
	#PRIoLEAST16
 "o"

	)

99 
	#PRIoLEAST32
 "o"

	)

100 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIoFAST8
 "o"

	)

103 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

104 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

105 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

108 
	#PRIu8
 "u"

	)

109 
	#PRIu16
 "u"

	)

110 
	#PRIu32
 "u"

	)

111 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

113 
	#PRIuLEAST8
 "u"

	)

114 
	#PRIuLEAST16
 "u"

	)

115 
	#PRIuLEAST32
 "u"

	)

116 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIuFAST8
 "u"

	)

119 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

120 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

121 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

124 
	#PRIx8
 "x"

	)

125 
	#PRIx16
 "x"

	)

126 
	#PRIx32
 "x"

	)

127 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

129 
	#PRIxLEAST8
 "x"

	)

130 
	#PRIxLEAST16
 "x"

	)

131 
	#PRIxLEAST32
 "x"

	)

132 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIxFAST8
 "x"

	)

135 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

136 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

137 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

140 
	#PRIX8
 "X"

	)

141 
	#PRIX16
 "X"

	)

142 
	#PRIX32
 "X"

	)

143 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

145 
	#PRIXLEAST8
 "X"

	)

146 
	#PRIXLEAST16
 "X"

	)

147 
	#PRIXLEAST32
 "X"

	)

148 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

150 
	#PRIXFAST8
 "X"

	)

151 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

152 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

153 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

157 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

158 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

159 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

160 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

161 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

162 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

166 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

167 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

168 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

169 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

170 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

171 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

177 
	#SCNd8
 "hhd"

	)

178 
	#SCNd16
 "hd"

	)

179 
	#SCNd32
 "d"

	)

180 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

182 
	#SCNdLEAST8
 "hhd"

	)

183 
	#SCNdLEAST16
 "hd"

	)

184 
	#SCNdLEAST32
 "d"

	)

185 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNdFAST8
 "hhd"

	)

188 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

189 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

190 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

193 
	#SCNi8
 "hhi"

	)

194 
	#SCNi16
 "hi"

	)

195 
	#SCNi32
 "i"

	)

196 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

198 
	#SCNiLEAST8
 "hhi"

	)

199 
	#SCNiLEAST16
 "hi"

	)

200 
	#SCNiLEAST32
 "i"

	)

201 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNiFAST8
 "hhi"

	)

204 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

205 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

206 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

209 
	#SCNu8
 "hhu"

	)

210 
	#SCNu16
 "hu"

	)

211 
	#SCNu32
 "u"

	)

212 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

214 
	#SCNuLEAST8
 "hhu"

	)

215 
	#SCNuLEAST16
 "hu"

	)

216 
	#SCNuLEAST32
 "u"

	)

217 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNuFAST8
 "hhu"

	)

220 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

221 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

222 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

225 
	#SCNo8
 "hho"

	)

226 
	#SCNo16
 "ho"

	)

227 
	#SCNo32
 "o"

	)

228 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

230 
	#SCNoLEAST8
 "hho"

	)

231 
	#SCNoLEAST16
 "ho"

	)

232 
	#SCNoLEAST32
 "o"

	)

233 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNoFAST8
 "hho"

	)

236 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

237 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

238 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

241 
	#SCNx8
 "hhx"

	)

242 
	#SCNx16
 "hx"

	)

243 
	#SCNx32
 "x"

	)

244 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

246 
	#SCNxLEAST8
 "hhx"

	)

247 
	#SCNxLEAST16
 "hx"

	)

248 
	#SCNxLEAST32
 "x"

	)

249 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

251 
	#SCNxFAST8
 "hhx"

	)

252 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

253 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

254 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

258 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

259 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

260 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

261 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

262 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

265 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

266 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

267 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

268 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

269 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

274 
	g__BEGIN_DECLS


276 #i‡
__WORDSIZE
 == 64

281 
	mquŸ
;

282 
	mªm
;

283 } 
	timaxdiv_t
;

290 
	mquŸ
;

291 
	mªm
;

292 } 
	timaxdiv_t
;

298 
ötmax_t
 
	$imaxabs
 (
ötmax_t
 
__n
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

301 
imaxdiv_t
 
	$imaxdiv
 (
ötmax_t
 
__numî
, i¡max_à
__díom
)

302 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

305 
ötmax_t
 
	$°πoimax
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

306 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

309 
uötmax_t
 
	$°πoumax
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

310 ** 
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

313 
ötmax_t
 
	$wc°oimax
 (
__c⁄°
 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

314 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

315 
__THROW
;

318 
uötmax_t
 
	$wc°oumax
 (
__c⁄°
 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

319 
__gwch¨_t
 ** 
__ª°ri˘
 
__íd±r
, 
__ba£
)

320 
__THROW
;

322 #ifde‡
__USE_EXTERN_INLINES


324 #i‡
__WORDSIZE
 == 64

326 
	$__°πﬁ_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

327 **
__ª°ri˘
 
__íd±r
,

328 
__ba£
, 
__group
)

329 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

331 
__exã∫_ölöe
 
ötmax_t


332 
	`__NTH
 (
	$°πoimax
 (
__c⁄°
 *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

333 
ba£
))

335  
	`__°πﬁ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

336 
	}
}

338 
	$__°πoul_öã∫Æ
 (
__c⁄°
 *

339 
__ª°ri˘
 
__≈å
,

340 ** 
__ª°ri˘
 
__íd±r
,

341 
__ba£
, 
__group
)

342 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

344 
__exã∫_ölöe
 
uötmax_t


345 
	`__NTH
 (
	$°πoumax
 (
__c⁄°
 *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

346 
ba£
))

348  
	`__°πoul_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

349 
	}
}

351 
	$__wc°ﬁ_öã∫Æ
 (
__c⁄°
 
__gwch¨_t
 * 
__ª°ri˘
 
__≈å
,

352 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
,

353 
__ba£
, 
__group
)

354 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

356 
__exã∫_ölöe
 
ötmax_t


357 
	`__NTH
 (
	$wc°oimax
 (
__c⁄°
 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

358 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

360  
	`__wc°ﬁ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

361 
	}
}

363 
	$__wc°oul_öã∫Æ
 (
__c⁄°
 
__gwch¨_t
 *

364 
__ª°ri˘
 
__≈å
,

365 
__gwch¨_t
 **

366 
__ª°ri˘
 
__íd±r
,

367 
__ba£
, 
__group
)

368 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

370 
__exã∫_ölöe
 
uötmax_t


371 
	`__NTH
 (
	$wc°oumax
 (
__c⁄°
 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

372 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

374  
	`__wc°oul_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

375 
	}
}

379 
__exãnsi⁄__


380 
	$__°πﬁl_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

381 **
__ª°ri˘
 
__íd±r
,

382 
__ba£
, 
__group
)

383 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

385 
__exã∫_ölöe
 
ötmax_t


386 
	`__NTH
 (
	$°πoimax
 (
__c⁄°
 *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

387 
ba£
))

389  
	`__°πﬁl_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

390 
	}
}

392 
__exãnsi⁄__


393 
	$__°πouŒ_öã∫Æ
 (
__c⁄°
 *

394 
__ª°ri˘
 
__≈å
,

396 
__ª°ri˘
 
__íd±r
,

397 
__ba£
,

398 
__group
)

399 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

401 
__exã∫_ölöe
 
uötmax_t


402 
	`__NTH
 (
	$°πoumax
 (
__c⁄°
 *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

403 
ba£
))

405  
	`__°πouŒ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

406 
	}
}

408 
__exãnsi⁄__


409 
	$__wc°ﬁl_öã∫Æ
 (
__c⁄°
 
__gwch¨_t
 *

410 
__ª°ri˘
 
__≈å
,

411 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
,

412 
__ba£
, 
__group
)

413 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

415 
__exã∫_ölöe
 
ötmax_t


416 
	`__NTH
 (
	$wc°oimax
 (
__c⁄°
 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

417 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

419  
	`__wc°ﬁl_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

420 
	}
}

423 
__exãnsi⁄__


424 
	$__wc°ouŒ_öã∫Æ
 (
__c⁄°
 
__gwch¨_t
 *

425 
__ª°ri˘
 
__≈å
,

426 
__gwch¨_t
 **

427 
__ª°ri˘
 
__íd±r
,

428 
__ba£
,

429 
__group
)

430 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

432 
__exã∫_ölöe
 
uötmax_t


433 
	`__NTH
 (
	$wc°oumax
 (
__c⁄°
 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

434 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

436  
	`__wc°ouŒ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

437 
	}
}

442 
	g__END_DECLS


	@/usr/include/limits.h

24 #i‚de‡
_LIBC_LIMITS_H_


25 
	#_LIBC_LIMITS_H_
 1

	)

27 
	~<„©uªs.h
>

33 
	#MB_LEN_MAX
 16

	)

38 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

43 #i‚de‡
_LIMITS_H


44 
	#_LIMITS_H
 1

	)

46 
	~<bôs/w‹dsize.h
>

55 
	#CHAR_BIT
 8

	)

58 
	#SCHAR_MIN
 (-128)

	)

59 
	#SCHAR_MAX
 127

	)

62 
	#UCHAR_MAX
 255

	)

65 #ifde‡
__CHAR_UNSIGNED__


66 
	#CHAR_MIN
 0

	)

67 
	#CHAR_MAX
 
UCHAR_MAX


	)

69 
	#CHAR_MIN
 
SCHAR_MIN


	)

70 
	#CHAR_MAX
 
SCHAR_MAX


	)

74 
	#SHRT_MIN
 (-32768)

	)

75 
	#SHRT_MAX
 32767

	)

78 
	#USHRT_MAX
 65535

	)

81 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

82 
	#INT_MAX
 2147483647

	)

85 
	#UINT_MAX
 4294967295U

	)

88 #i‡
__WORDSIZE
 == 64

89 
	#LONG_MAX
 9223372036854775807L

	)

91 
	#LONG_MAX
 2147483647L

	)

93 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

96 #i‡
__WORDSIZE
 == 64

97 
	#ULONG_MAX
 18446744073709551615UL

	)

99 
	#ULONG_MAX
 4294967295UL

	)

102 #ifde‡
__USE_ISOC99


105 
	#LLONG_MAX
 9223372036854775807LL

	)

106 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

109 
	#ULLONG_MAX
 18446744073709551615ULL

	)

123 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


125 #ö˛ude_√xà<
limôs
.
h
>

131 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


132 #i‚de‡
LLONG_MIN


133 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

135 #i‚de‡
LLONG_MAX


136 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

138 #i‚de‡
ULLONG_MAX


139 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

143 #ifdef 
__USE_POSIX


145 
	~<bôs/posix1_lim.h
>

148 #ifdef 
__USE_POSIX2


149 
	~<bôs/posix2_lim.h
>

152 #ifdef 
__USE_XOPEN


153 
	~<bôs/x›í_lim.h
>

	@/usr/include/malloc.h

21 #i‚de‡
_MALLOC_H


22 
	#_MALLOC_H
 1

	)

24 
	~<„©uªs.h
>

25 
	~<°ddef.h
>

26 
	~<°dio.h
>

27 
	#__mÆloc_±r_t
 *

	)

30 
	#__mÆloc_size_t
 
size_t


	)

31 
	#__mÆloc_±rdiff_t
 
±rdiff_t


	)

33 #ifde‡
__GNUC__


35 
	#__MALLOC_P
(
¨gs
Ë¨g†
__THROW


	)

38 
	#__MALLOC_PMT
(
¨gs
Ë
	)
args

42 
	#__MALLOC_P
(
¨gs
Ë
	)
args

43 
	#__MALLOC_PMT
(
¨gs
Ë
	)
args

48 
__BEGIN_DECLS


51 *
mÆloc
 
__MALLOC_P
 ((
size_t
 
__size
)Ë
__©åibuã_mÆloc__
 
__wur
;

54 *
ˇŒoc
 
__MALLOC_P
 ((
size_t
 
__nmemb
, size_à
__size
))

55 
__©åibuã_mÆloc__
 
__wur
;

62 *
ªÆloc
 
__MALLOC_P
 ((*
__±r
, 
size_t
 
__size
))

63 
__©åibuã_w¨n_unu£d_ªsu…__
;

66 
‰ì
 
__MALLOC_P
 ((*
__±r
));

69 
c‰ì
 
__MALLOC_P
 ((*
__±r
));

72 *
memÆign
 
__MALLOC_P
 ((
size_t
 
__Æignmít
, size_à
__size
))

73 
__©åibuã_mÆloc__
 
__wur
;

76 *
vÆloc
 
__MALLOC_P
 ((
size_t
 
__size
))

77 
__©åibuã_mÆloc__
 
__wur
;

81 * 
pvÆloc
 
__MALLOC_P
 ((
size_t
 
__size
))

82 
__©åibuã_mÆloc__
 
__wur
;

86 *(*
__m‹ec‹e
Ë
__MALLOC_PMT
 ((
±rdiff_t
 
__size
));

89 *
__deÁu…_m‹ec‹e
 
__MALLOC_P
 ((
±rdiff_t
 
__size
))

90 
__©åibuã_mÆloc__
;

94 
	smÆlöfo
 {

95 
	m¨ía
;

96 
	m‹dblks
;

97 
	msmblks
;

98 
	mhblks
;

99 
	mhblkhd
;

100 
	musmblks
;

101 
	mfsmblks
;

102 
	mu‹dblks
;

103 
	mf‹dblks
;

104 
	mkìpco°
;

108 
mÆlöfo
 mÆlöfÿ
__MALLOC_P
 (());

111 #i‚de‡
M_MXFAST


112 
	#M_MXFAST
 1

	)

114 #i‚de‡
M_NLBLKS


115 
	#M_NLBLKS
 2

	)

117 #i‚de‡
M_GRAIN


118 
	#M_GRAIN
 3

	)

120 #i‚de‡
M_KEEP


121 
	#M_KEEP
 4

	)

125 
	#M_TRIM_THRESHOLD
 -1

	)

126 
	#M_TOP_PAD
 -2

	)

127 
	#M_MMAP_THRESHOLD
 -3

	)

128 
	#M_MMAP_MAX
 -4

	)

129 
	#M_CHECK_ACTION
 -5

	)

130 
	#M_PERTURB
 -6

	)

131 
	#M_ARENA_TEST
 -7

	)

132 
	#M_ARENA_MAX
 -8

	)

135 
mÆl›t
 
__MALLOC_P
 ((
__∑øm
, 
__vÆ
));

139 
mÆloc_åim
 
__MALLOC_P
 ((
size_t
 
__∑d
));

143 
size_t
 
mÆloc_ußbÀ_size
 
__MALLOC_P
 ((*
__±r
));

146 
mÆloc_°©s
 
__MALLOC_P
 (());

149 
mÆloc_öfo
 (
__›ti⁄s
, 
FILE
 *
__Â
);

152 *
mÆloc_gë_°©e
 
__MALLOC_P
 (());

156 
mÆloc_£t_°©e
 
__MALLOC_P
 ((*
__±r
));

161 (*
__mÆloc_öôülize_hook
Ë
	`__MALLOC_PMT
 (());

163 (*
__‰ì_hook
Ë
	`__MALLOC_PMT
 ((*
__±r
,

164 
__c⁄°
 
__mÆloc_±r_t
));

165 *(*
__mÆloc_hook
Ë
	`__MALLOC_PMT
 ((
size_t
 
__size
,

166 
__c⁄°
 
__mÆloc_±r_t
));

167 *(*
__ªÆloc_hook
Ë
	`__MALLOC_PMT
 ((*
__±r
, 
size_t
 
__size
,

168 
__c⁄°
 
__mÆloc_±r_t
));

169 *(*
__memÆign_hook
Ë
	`__MALLOC_PMT
 ((
size_t
 
__Æignmít
,

170 
size_t
 
__size
,

171 
__c⁄°
 
__mÆloc_±r_t
));

172 (*
__a·î_m‹ec‹e_hook
Ë
	`__MALLOC_PMT
 (());

175 
__mÆloc_check_öô
 
	`__MALLOC_P
 (());

178 
__END_DECLS


	@/usr/include/math.h

25 #i‚def 
_MATH_H


26 
	#_MATH_H
 1

	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


34 
	~<bôs/huge_vÆ.h
>

35 #ifde‡
__USE_ISOC99


36 
	~<bôs/huge_vÆf.h
>

37 
	~<bôs/huge_vÆl.h
>

40 
	~<bôs/öf.h
>

43 
	~<bôs/«n.h
>

47 
	~<bôs/m©hdef.h
>

54 
	#__MATHCALL
(
fun˘i⁄
,
suffix
, 
¨gs
) \

55 
	`__MATHDECL
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
)

	)

56 
	#__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

57 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
); \

58 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
)

	)

59 
	#__MATHCALLX
(
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

60 
	`__MATHDECLX
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
)

	)

61 
	#__MATHDECLX
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

62 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
); \

63 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
)

	)

64 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

65 
ty≥
 
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
Ë
¨gs
 
__THROW


	)

67 
	#_MdoubÀ_
 

	)

68 
	#__MATH_PRECNAME
(
«me
,
r
Ë
	`__CONCAT
“ame,r)

	)

69 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

70 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

71 
	~<bôs/m©hˇŒs.h
>

72 #unde‡
_MdoubÀ_


73 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


74 #unde‡
_MdoubÀ_END_NAMESPACE


75 #unde‡
__MATH_PRECNAME


77 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


83 #i‚de‡
_MÊﬂt_


84 
	#_MÊﬂt_
 

	)

86 
	#_MdoubÀ_
 
_MÊﬂt_


	)

87 #ifde‡
__STDC__


88 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f
##
	)
r

90 
	#__MATH_PRECNAME
(
«me
,
r
Ë«mê
f
 
	)
r

92 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

93 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

94 
	~<bôs/m©hˇŒs.h
>

95 #unde‡
_MdoubÀ_


96 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


97 #unde‡
_MdoubÀ_END_NAMESPACE


98 #unde‡
__MATH_PRECNAME


100 #i‡(
__STDC__
 - 0 || 
__GNUC__
 - 0) \

101 && (!
deföed
 
__NO_LONG_DOUBLE_MATH
 \

102 || 
deföed
 
__LDBL_COMPAT
 \

103 || !
deföed
 
_LIBC
)

104 #ifde‡
__LDBL_COMPAT


106 #ifde‡
__USE_ISOC99


107 
	$__∆dbl_√xâow¨df
 (
__x
, 
__y
)

108 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

109 #ifde‡
__REDIRECT_NTH


110 
	`__REDIRECT_NTH
 (
√xâow¨df
, (
__x
, 
__y
),

111 
__∆dbl_√xâow¨df
)

112 
	`__©åibuã__
 ((
__c⁄°__
));

113 
	`__REDIRECT_NTH
 (
√xâow¨d
, (
__x
, 
__y
),

114 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

115 
	`__REDIRECT_NTH
 (
√xâow¨dl
,

116 (
__x
, 
__y
),

117 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

122 #i‡
deföed
 
__LDBL_COMPAT
 || deföed 
__NO_LONG_DOUBLE_MATH


124 #unde‡
__MATHDECL_1


125 
	#__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
Æüs
) \

126 
ty≥
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
), \

127 
¨gs
, 
Æüs
)

	)

128 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

129 
	`__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
	`__CONCAT
(fun˘i⁄,suffix))

	)

134 #i‚de‡
_Ml⁄g_doubÀ_


135 
	#_Ml⁄g_doubÀ_
 

	)

137 
	#_MdoubÀ_
 
_Ml⁄g_doubÀ_


	)

138 #ifde‡
__STDC__


139 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
l
##
	)
r

141 
	#__MATH_PRECNAME
(
«me
,
r
Ë«mê
l
 
	)
r

143 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

144 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

145 
	~<bôs/m©hˇŒs.h
>

146 #unde‡
_MdoubÀ_


147 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


148 #unde‡
_MdoubÀ_END_NAMESPACE


149 #unde‡
__MATH_PRECNAME


154 #unde‡
__MATHDECL_1


155 #unde‡
__MATHDECL


156 #unde‡
__MATHCALL


159 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


161 
signgam
;

166 #ifde‡
__USE_ISOC99


204 
FP_NAN
,

205 
	#FP_NAN
 
FP_NAN


	)

206 
FP_INFINITE
,

207 
	#FP_INFINITE
 
FP_INFINITE


	)

208 
FP_ZERO
,

209 
	#FP_ZERO
 
FP_ZERO


	)

210 
FP_SUBNORMAL
,

211 
	#FP_SUBNORMAL
 
FP_SUBNORMAL


	)

212 
FP_NORMAL


213 
	#FP_NORMAL
 
FP_NORMAL


	)

217 #ifde‡
__NO_LONG_DOUBLE_MATH


218 
	#Â˛assify
(
x
) \

219 ( (
x
Ë= (Ë? 
	`__Â˛assifyf
 (xË: 
	`__Â˛assify
 (x))

	)

221 
	#Â˛assify
(
x
) \

222 ( (
x
) ==  () \

223 ? 
	`__Â˛assifyf
 (
x
) \

224 :  (
x
) ==  () \

225 ? 
	`__Â˛assify
 (
x
Ë: 
	`__Â˛assifyl
 (x))

	)

229 #ifde‡
__NO_LONG_DOUBLE_MATH


230 
	#signbô
(
x
) \

231 ( (
x
Ë= (Ë? 
	`__signbôf
 (xË: 
	`__signbô
 (x))

	)

233 
	#signbô
(
x
) \

234 ( (
x
) ==  () \

235 ? 
	`__signbôf
 (
x
) \

236 :  (
x
) ==  () \

237 ? 
	`__signbô
 (
x
Ë: 
	`__signbôl
 (x))

	)

241 #ifde‡
__NO_LONG_DOUBLE_MATH


242 
	#isföôe
(
x
) \

243 ( (
x
Ë= (Ë? 
	`__föôef
 (xË: 
	`__föôe
 (x))

	)

245 
	#isföôe
(
x
) \

246 ( (
x
) ==  () \

247 ? 
	`__föôef
 (
x
) \

248 :  (
x
) ==  () \

249 ? 
	`__föôe
 (
x
Ë: 
	`__föôñ
 (x))

	)

253 
	#i¢‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_NORMAL
)

	)

257 #ifde‡
__NO_LONG_DOUBLE_MATH


258 
	#i¢™
(
x
) \

259 ( (
x
Ë= (Ë? 
	`__i¢™f
 (xË: 
	`__i¢™
 (x))

	)

261 
	#i¢™
(
x
) \

262 ( (
x
) ==  () \

263 ? 
	`__i¢™f
 (
x
) \

264 :  (
x
) ==  () \

265 ? 
	`__i¢™
 (
x
Ë: 
	`__i¢™l
 (x))

	)

269 #ifde‡
__NO_LONG_DOUBLE_MATH


270 
	#isöf
(
x
) \

271 ( (
x
Ë= (Ë? 
	`__isöff
 (xË: 
	`__isöf
 (x))

	)

273 
	#isöf
(
x
) \

274 ( (
x
) ==  () \

275 ? 
	`__isöff
 (
x
) \

276 :  (
x
) ==  () \

277 ? 
	`__isöf
 (
x
Ë: 
	`__isöÊ
 (x))

	)

281 
	#MATH_ERRNO
 1

	)

282 
	#MATH_ERREXCEPT
 2

	)

287 #i‚de‡
__FAST_MATH__


288 
	#m©h_îrh™dlög
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

293 #ifdef 
__USE_MISC


297 
_IEEE_
 = -1,

298 
_SVID_
,

299 
_XOPEN_
,

300 
_POSIX_
,

301 
_ISOC_


302 } 
	t_LIB_VERSION_TYPE
;

307 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

311 #ifde‡
__USE_SVID


317 #ifde‡
__˝lu•lus


318 
__ex˚±i⁄


320 
ex˚±i⁄


323 
ty≥
;

324 *
«me
;

325 
¨g1
;

326 
¨g2
;

327 
ªtvÆ
;

328 
	}
};

330 #ifde‡
__˝lu•lus


331 
	$m©hîr
 (
__ex˚±i⁄
 *
__exc
Ë
	`throw
 ();

333 
	`m©hîr
 (
ex˚±i⁄
 *
__exc
);

336 
	#X_TLOSS
 1.41484755040568800000e+16

	)

339 
	#DOMAIN
 1

	)

340 
	#SING
 2

	)

341 
	#OVERFLOW
 3

	)

342 
	#UNDERFLOW
 4

	)

343 
	#TLOSS
 5

	)

344 
	#PLOSS
 6

	)

347 
	#HUGE
 3.40282347e+38F

	)

351 #ifde‡
__USE_XOPEN


353 
	#MAXFLOAT
 3.40282347e+38F

	)

360 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


361 
	#M_E
 2.7182818284590452354

	)

362 
	#M_LOG2E
 1.4426950408889634074

	)

363 
	#M_LOG10E
 0.43429448190325182765

	)

364 
	#M_LN2
 0.69314718055994530942

	)

365 
	#M_LN10
 2.30258509299404568402

	)

366 
	#M_PI
 3.14159265358979323846

	)

367 
	#M_PI_2
 1.57079632679489661923

	)

368 
	#M_PI_4
 0.78539816339744830962

	)

369 
	#M_1_PI
 0.31830988618379067154

	)

370 
	#M_2_PI
 0.63661977236758134308

	)

371 
	#M_2_SQRTPI
 1.12837916709551257390

	)

372 
	#M_SQRT2
 1.41421356237309504880

	)

373 
	#M_SQRT1_2
 0.70710678118654752440

	)

379 #ifde‡
__USE_GNU


380 
	#M_El
 2.7182818284590452353602874713526625L

	)

381 
	#M_LOG2El
 1.4426950408889634073599246810018921L

	)

382 
	#M_LOG10El
 0.4342944819032518276511289189166051L

	)

383 
	#M_LN2l
 0.6931471805599453094172321214581766L

	)

384 
	#M_LN10l
 2.3025850929940456840179914546843642L

	)

385 
	#M_PIl
 3.1415926535897932384626433832795029L

	)

386 
	#M_PI_2l
 1.5707963267948966192313216916397514L

	)

387 
	#M_PI_4l
 0.7853981633974483096156608458198757L

	)

388 
	#M_1_PIl
 0.3183098861837906715377675267450287L

	)

389 
	#M_2_PIl
 0.6366197723675813430755350534900574L

	)

390 
	#M_2_SQRTPIl
 1.1283791670955125738961589031215452L

	)

391 
	#M_SQRT2l
 1.4142135623730950488016887242096981L

	)

392 
	#M_SQRT1_2l
 0.7071067811865475244008443621048490L

	)

399 #i‡
deföed
 
__STRICT_ANSI__
 && !deföed 
__NO_MATH_INLINES


400 
	#__NO_MATH_INLINES
 1

	)

403 #i‡
deföed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

410 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
(x, y)

	)

411 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
(x, y)

	)

412 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
(x, y)

	)

413 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
(x, y)

	)

414 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
(x, y)

	)

415 
	#isun‹dîed
(
u
, 
v
Ë
	`__buûtö_isun‹dîed
(u, v)

	)

419 #ifde‡
__USE_EXTERN_INLINES


420 
	~<bôs/m©hölöe.h
>

423 #ifde‡
__USE_ISOC99


427 #i‚de‡
isgª©î


428 
	#isgª©î
(
x
, 
y
) \

429 (
__exãnsi⁄__
 \

430 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

431 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x > __y; 
	}
}))

	)

435 #i‚de‡
isgª©îequÆ


436 
	#isgª©îequÆ
(
x
, 
y
) \

437 (
__exãnsi⁄__
 \

438 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

439 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x >__y; }))

	)

443 #i‚de‡
i¶ess


444 
	#i¶ess
(
x
, 
y
) \

445 (
__exãnsi⁄__
 \

446 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

447 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x < __y; }))

	)

451 #i‚de‡
i¶es£quÆ


452 
	#i¶es£quÆ
(
x
, 
y
) \

453 (
__exãnsi⁄__
 \

454 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

455 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x <__y; }))

	)

459 #i‚de‡
i¶essgª©î


460 
	#i¶essgª©î
(
x
, 
y
) \

461 (
__exãnsi⁄__
 \

462 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

463 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& (__x < __y || __y < __x); }))

	)

467 #i‚de‡
isun‹dîed


468 
	#isun‹dîed
(
u
, 
v
) \

469 (
__exãnsi⁄__
 \

470 ({ 
	`__ty≥of__
(
u
Ë
__u
 = (u); __ty≥of__(
v
Ë
__v
 = (v); \

471 
	`Â˛assify
 (
__u
Ë=
FP_NAN
 || fp˛assify (
__v
Ë=FP_NAN; }))

	)

476 
	g__END_DECLS


	@/usr/include/net/if.h

20 #i‚de‡
_NET_IF_H


21 
	#_NET_IF_H
 1

	)

23 
	~<„©uªs.h
>

25 #ifde‡
__USE_MISC


26 
	~<sys/ty≥s.h
>

27 
	~<sys/sockë.h
>

32 
	#IF_NAMESIZE
 16

	)

34 
	sif_«meödex


36 
	mif_ödex
;

37 *
	mif_«me
;

41 #ifde‡
__USE_MISC


45 
	mIFF_UP
 = 0x1,

46 
	#IFF_UP
 
IFF_UP


	)

47 
	mIFF_BROADCAST
 = 0x2,

48 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

49 
	mIFF_DEBUG
 = 0x4,

50 
	#IFF_DEBUG
 
IFF_DEBUG


	)

51 
	mIFF_LOOPBACK
 = 0x8,

52 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

53 
	mIFF_POINTOPOINT
 = 0x10,

54 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

55 
	mIFF_NOTRAILERS
 = 0x20,

56 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

57 
	mIFF_RUNNING
 = 0x40,

58 
	#IFF_RUNNING
 
IFF_RUNNING


	)

59 
	mIFF_NOARP
 = 0x80,

60 
	#IFF_NOARP
 
IFF_NOARP


	)

61 
	mIFF_PROMISC
 = 0x100,

62 
	#IFF_PROMISC
 
IFF_PROMISC


	)

65 
	mIFF_ALLMULTI
 = 0x200,

66 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

68 
	mIFF_MASTER
 = 0x400,

69 
	#IFF_MASTER
 
IFF_MASTER


	)

70 
	mIFF_SLAVE
 = 0x800,

71 
	#IFF_SLAVE
 
IFF_SLAVE


	)

73 
	mIFF_MULTICAST
 = 0x1000,

74 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

76 
	mIFF_PORTSEL
 = 0x2000,

77 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

78 
	mIFF_AUTOMEDIA
 = 0x4000,

79 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

80 
	mIFF_DYNAMIC
 = 0x8000

81 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

89 
	siÁddr


91 
sockaddr
 
	miÁ_addr
;

94 
sockaddr
 
	mifu_brﬂdaddr
;

95 
sockaddr
 
	mifu_d°addr
;

96 } 
	miÁ_ifu
;

97 
iÁ˚
 *
	miÁ_iÂ
;

98 
iÁddr
 *
	miÁ_√xt
;

101 
	#iÁ_brﬂdaddr
 
iÁ_ifu
.
ifu_brﬂdaddr


	)

102 
	#iÁ_d°addr
 
iÁ_ifu
.
ifu_d°addr


	)

112 
	sifm≠


114 
	mmem_°¨t
;

115 
	mmem_íd
;

116 
	mba£_addr
;

117 
	múq
;

118 
	mdma
;

119 
	mp‹t
;

127 
	si‰eq


129 
	#IFHWADDRLEN
 6

	)

130 
	#IFNAMSIZ
 
IF_NAMESIZE


	)

133 
	mi‰n_«me
[
IFNAMSIZ
];

134 } 
	mi‰_i‰n
;

138 
sockaddr
 
	mi‰u_addr
;

139 
sockaddr
 
	mi‰u_d°addr
;

140 
sockaddr
 
	mi‰u_brﬂdaddr
;

141 
sockaddr
 
	mi‰u_√tmask
;

142 
sockaddr
 
	mi‰u_hwaddr
;

143 
	mi‰u_Êags
;

144 
	mi‰u_ivÆue
;

145 
	mi‰u_mtu
;

146 
ifm≠
 
	mi‰u_m≠
;

147 
	mi‰u_¶ave
[
IFNAMSIZ
];

148 
	mi‰u_√w«me
[
IFNAMSIZ
];

149 
__ˇddr_t
 
	mi‰u_d©a
;

150 } 
	mi‰_i‰u
;

152 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

153 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

154 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

155 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

156 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

157 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

158 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

159 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

160 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

161 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

162 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

163 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

164 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

165 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

166 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

167 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

168 
	#_IOT_i‰eq
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),16,0,0)

	)

169 
	#_IOT_i‰eq_sh‹t
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

170 
	#_IOT_i‰eq_öt
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

177 
	sifc⁄f


179 
	mifc_Àn
;

182 
__ˇddr_t
 
	mifcu_buf
;

183 
i‰eq
 *
	mifcu_ªq
;

184 } 
	mifc_ifcu
;

186 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

187 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

188 
	#_IOT_ifc⁄f
 
	`_IOT
(
	`_IOTS
(
ifc⁄f
),1,0,0,0,0Ë

	)

191 
__BEGIN_DECLS


194 
	$if_«mëoödex
 (
__c⁄°
 *
__i‚ame
Ë
__THROW
;

195 *
	$if_ödext⁄ame
 (
__ifödex
, *
__i‚ame
Ë
__THROW
;

198 
if_«meödex
 *
	$if_«meödex
 (Ë
__THROW
;

201 
	$if_‰ì«meödex
 (
if_«meödex
 *
__±r
Ë
__THROW
;

203 
__END_DECLS


	@/usr/include/net/route.h

21 #i‚de‡
_NET_ROUTE_H


22 
	#_NET_ROUTE_H
 1

	)

24 
	~<„©uªs.h
>

25 
	~<sys/sockë.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<√töë/ö.h
>

28 
	~<bôs/w‹dsize.h
>

32 
	sπíåy


34 
	mπ_∑d1
;

35 
sockaddr
 
	mπ_d°
;

36 
sockaddr
 
	mπ_g©eway
;

37 
sockaddr
 
	mπ_gímask
;

38 
	mπ_Êags
;

39 
	mπ_∑d2
;

40 
	mπ_∑d3
;

41 
	mπ_tos
;

42 
	mπ_˛ass
;

43 #i‡
__WORDSIZE
 == 64

44 
	mπ_∑d4
[3];

46 
	mπ_∑d4
;

48 
	mπ_mëric
;

49 *
	mπ_dev
;

50 
	mπ_mtu
;

51 
	mπ_wödow
;

52 
	mπ_úâ
;

55 
	#π_mss
 
π_mtu


	)

58 
	sö6_πmsg


60 
ö6_addr
 
	mπmsg_d°
;

61 
ö6_addr
 
	mπmsg_§c
;

62 
ö6_addr
 
	mπmsg_g©eway
;

63 
u_öt32_t
 
	mπmsg_ty≥
;

64 
u_öt16_t
 
	mπmsg_d°_Àn
;

65 
u_öt16_t
 
	mπmsg_§c_Àn
;

66 
u_öt32_t
 
	mπmsg_mëric
;

67 
	mπmsg_öfo
;

68 
u_öt32_t
 
	mπmsg_Êags
;

69 
	mπmsg_ifödex
;

73 
	#RTF_UP
 0x0001

	)

74 
	#RTF_GATEWAY
 0x0002

	)

76 
	#RTF_HOST
 0x0004

	)

77 
	#RTF_REINSTATE
 0x0008

	)

78 
	#RTF_DYNAMIC
 0x0010

	)

79 
	#RTF_MODIFIED
 0x0020

	)

80 
	#RTF_MTU
 0x0040

	)

81 
	#RTF_MSS
 
RTF_MTU


	)

82 
	#RTF_WINDOW
 0x0080

	)

83 
	#RTF_IRTT
 0x0100

	)

84 
	#RTF_REJECT
 0x0200

	)

85 
	#RTF_STATIC
 0x0400

	)

86 
	#RTF_XRESOLVE
 0x0800

	)

87 
	#RTF_NOFORWARD
 0x1000

	)

88 
	#RTF_THROW
 0x2000

	)

89 
	#RTF_NOPMTUDISC
 0x4000

	)

92 
	#RTF_DEFAULT
 0x00010000

	)

93 
	#RTF_ALLONLINK
 0x00020000

	)

94 
	#RTF_ADDRCONF
 0x00040000

	)

96 
	#RTF_LINKRT
 0x00100000

	)

97 
	#RTF_NONEXTHOP
 0x00200000

	)

99 
	#RTF_CACHE
 0x01000000

	)

100 
	#RTF_FLOW
 0x02000000

	)

101 
	#RTF_POLICY
 0x04000000

	)

103 
	#RTCF_VALVE
 0x00200000

	)

104 
	#RTCF_MASQ
 0x00400000

	)

105 
	#RTCF_NAT
 0x00800000

	)

106 
	#RTCF_DOREDIRECT
 0x01000000

	)

107 
	#RTCF_LOG
 0x02000000

	)

108 
	#RTCF_DIRECTSRC
 0x04000000

	)

110 
	#RTF_LOCAL
 0x80000000

	)

111 
	#RTF_INTERFACE
 0x40000000

	)

112 
	#RTF_MULTICAST
 0x20000000

	)

113 
	#RTF_BROADCAST
 0x10000000

	)

114 
	#RTF_NAT
 0x08000000

	)

116 
	#RTF_ADDRCLASSMASK
 0xF8000000

	)

117 
	#RT_ADDRCLASS
(
Êags
Ë((
__u_öt32_t
ËÊag†>> 23)

	)

119 
	#RT_TOS
(
tos
Ë(—osË& 
IPTOS_TOS_MASK
)

	)

121 
	#RT_LOCALADDR
(
Êags
Ë((Êag†& 
RTF_ADDRCLASSMASK
) \

122 =(
RTF_LOCAL
|
RTF_INTERFACE
))

	)

124 
	#RT_CLASS_UNSPEC
 0

	)

125 
	#RT_CLASS_DEFAULT
 253

	)

127 
	#RT_CLASS_MAIN
 254

	)

128 
	#RT_CLASS_LOCAL
 255

	)

129 
	#RT_CLASS_MAX
 255

	)

132 
	#RTMSG_ACK
 
NLMSG_ACK


	)

133 
	#RTMSG_OVERRUN
 
NLMSG_OVERRUN


	)

135 
	#RTMSG_NEWDEVICE
 0x11

	)

136 
	#RTMSG_DELDEVICE
 0x12

	)

137 
	#RTMSG_NEWROUTE
 0x21

	)

138 
	#RTMSG_DELROUTE
 0x22

	)

139 
	#RTMSG_NEWRULE
 0x31

	)

140 
	#RTMSG_DELRULE
 0x32

	)

141 
	#RTMSG_CONTROL
 0x40

	)

143 
	#RTMSG_AR_FAILED
 0x51

	)

	@/usr/include/netdb.h

23 #i‚def 
_NETDB_H


24 
	#_NETDB_H
 1

	)

26 
	~<„©uªs.h
>

28 
	~<√töë/ö.h
>

29 
	~<°döt.h
>

30 #ifde‡
__USE_MISC


33 
	~<Ωc/√tdb.h
>

36 #ifde‡
__USE_GNU


37 
	#__√ed_sigevít_t


	)

38 
	~<bôs/sigöfo.h
>

39 
	#__√ed_time•ec


	)

40 
	~<time.h
>

43 
	~<bôs/√tdb.h
>

46 
	#_PATH_HEQUIV
 "/ëc/ho°s.equiv"

	)

47 
	#_PATH_HOSTS
 "/ëc/ho°s"

	)

48 
	#_PATH_NETWORKS
 "/ëc/√tw‹ks"

	)

49 
	#_PATH_NSSWITCH_CONF
 "/ëc/nsswôch.c⁄f"

	)

50 
	#_PATH_PROTOCOLS
 "/ëc/¥Ÿocﬁs"

	)

51 
	#_PATH_SERVICES
 "/ëc/£rvi˚s"

	)

54 
	g__BEGIN_DECLS


56 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


59 
	#h_î∫o
 (*
	`__h_î∫o_loˇti⁄
 ())

	)

62 *
	$__h_î∫o_loˇti⁄
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

66 
	#HOST_NOT_FOUND
 1

	)

67 
	#TRY_AGAIN
 2

	)

69 
	#NO_RECOVERY
 3

	)

71 
	#NO_DATA
 4

	)

74 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


75 
	#NETDB_INTERNAL
 -1

	)

76 
	#NETDB_SUCCESS
 0

	)

77 
	#NO_ADDRESS
 
NO_DATA


	)

80 #ifde‡
__USE_XOPEN2K


82 
	#IPPORT_RESERVED
 1024

	)

85 #ifde‡
__USE_GNU


87 
	#SCOPE_DELIMITER
 '%'

	)

90 #ifde‡
__USE_MISC


93 
	$hîr‹
 (
__c⁄°
 *
__°r
Ë
__THROW
;

96 
__c⁄°
 *
	$h°ªº‹
 (
__îr_num
Ë
__THROW
;

101 
	sho°ít


103 *
h_«me
;

104 **
h_Æü£s
;

105 
h_addπy≥
;

106 
h_Àngth
;

107 **
h_addr_li°
;

108 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


109 
	#h_addr
 
h_addr_li°
[0]

	)

118 
	`£tho°ít
 (
__°ay_›í
);

124 
	`ídho°ít
 ();

131 
ho°ít
 *
	`gëho°ít
 ();

138 
ho°ít
 *
	`gëho°byaddr
 (
__c⁄°
 *
__addr
, 
__sockÀn_t
 
__Àn
,

139 
__ty≥
);

145 
ho°ít
 *
	`gëho°by«me
 (
__c⁄°
 *
__«me
);

147 #ifde‡
__USE_MISC


156 
ho°ít
 *
	`gëho°by«me2
 (
__c⁄°
 *
__«me
, 
__af
);

168 
	`gëho°ít_r
 (
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

169 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

170 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

171 *
__ª°ri˘
 
__h_î∫›
);

173 
	`gëho°byaddr_r
 (
__c⁄°
 *
__ª°ri˘
 
__addr
, 
__sockÀn_t
 
__Àn
,

174 
__ty≥
,

175 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

176 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

177 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

178 *
__ª°ri˘
 
__h_î∫›
);

180 
	`gëho°by«me_r
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

181 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

182 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

183 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

184 *
__ª°ri˘
 
__h_î∫›
);

186 
	`gëho°by«me2_r
 (
__c⁄°
 *
__ª°ri˘
 
__«me
, 
__af
,

187 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

188 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

189 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

190 *
__ª°ri˘
 
__h_î∫›
);

199 
	`£äëít
 (
__°ay_›í
);

205 
	`íd√ã¡
 ();

212 
√ã¡
 *
	`gë√ã¡
 ();

219 
√ã¡
 *
	`gë√tbyaddr
 (
uöt32_t
 
__√t
, 
__ty≥
);

225 
√ã¡
 *
	`gë√tby«me
 (
__c⁄°
 *
__«me
);

227 #ifdef 
__USE_MISC


238 
	`gë√ã¡_r
 (
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

239 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

240 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

241 *
__ª°ri˘
 
__h_î∫›
);

243 
	`gë√tbyaddr_r
 (
uöt32_t
 
__√t
, 
__ty≥
,

244 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

245 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

246 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

247 *
__ª°ri˘
 
__h_î∫›
);

249 
	`gë√tby«me_r
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

250 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

251 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

252 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

253 *
__ª°ri˘
 
__h_î∫›
);

258 
	s£rvít


260 *
s_«me
;

261 **
s_Æü£s
;

262 
s_p‹t
;

263 *
s_¥Ÿo
;

271 
	`£t£rvít
 (
__°ay_›í
);

277 
	`íd£rvít
 ();

284 
£rvít
 *
	`gë£rvít
 ();

291 
£rvít
 *
	`gë£rvby«me
 (
__c⁄°
 *
__«me
,

292 
__c⁄°
 *
__¥Ÿo
);

299 
£rvít
 *
	`gë£rvbyp‹t
 (
__p‹t
, 
__c⁄°
 *
__¥Ÿo
);

302 #ifdef 
__USE_MISC


310 
	`gë£rvít_r
 (
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

311 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

312 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

314 
	`gë£rvby«me_r
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

315 
__c⁄°
 *
__ª°ri˘
 
__¥Ÿo
,

316 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

317 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

318 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

320 
	`gë£rvbyp‹t_r
 (
__p‹t
, 
__c⁄°
 *
__ª°ri˘
 
__¥Ÿo
,

321 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

322 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

323 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

328 
	s¥Ÿ€¡


330 *
p_«me
;

331 **
p_Æü£s
;

332 
p_¥Ÿo
;

340 
	`£çrŸ€¡
 (
__°ay_›í
);

346 
	`íd¥Ÿ€¡
 ();

353 
¥Ÿ€¡
 *
	`gë¥Ÿ€¡
 ();

359 
¥Ÿ€¡
 *
	`gë¥Ÿoby«me
 (
__c⁄°
 *
__«me
);

365 
¥Ÿ€¡
 *
	`gë¥Ÿobynumbî
 (
__¥Ÿo
);

368 #ifdef 
__USE_MISC


376 
	`gë¥Ÿ€¡_r
 (
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

377 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

378 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

380 
	`gë¥Ÿoby«me_r
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

381 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

382 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

383 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

385 
	`gë¥Ÿobynumbî_r
 (
__¥Ÿo
,

386 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

387 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

388 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

397 
	`£äëgª¡
 (
__c⁄°
 *
__√tgroup
);

405 
	`íd√tgª¡
 ();

414 
	`gë√tgª¡
 (**
__ª°ri˘
 
__ho°p
,

415 **
__ª°ri˘
 
__u£Ω
,

416 **
__ª°ri˘
 
__domaöp
);

425 
	`ö√tgr
 (
__c⁄°
 *
__√tgroup
, __c⁄° *
__ho°
,

426 
__c⁄°
 *
__u£r
, __c⁄° *
__domaö
);

434 
	`gë√tgª¡_r
 (**
__ª°ri˘
 
__ho°p
,

435 **
__ª°ri˘
 
__u£Ω
,

436 **
__ª°ri˘
 
__domaöp
,

437 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
);

441 #ifde‡
__USE_BSD


453 
	`rcmd
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

454 
__c⁄°
 *
__ª°ri˘
 
__locu£r
,

455 
__c⁄°
 *
__ª°ri˘
 
__ªmu£r
,

456 
__c⁄°
 *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

465 
	`rcmd_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

466 
__c⁄°
 *
__ª°ri˘
 
__locu£r
,

467 
__c⁄°
 *
__ª°ri˘
 
__ªmu£r
,

468 
__c⁄°
 *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

469 
ß_Ámûy_t
 
__af
);

481 
	`ªxec
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

482 
__c⁄°
 *
__ª°ri˘
 
__«me
,

483 
__c⁄°
 *
__ª°ri˘
 
__∑ss
,

484 
__c⁄°
 *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

493 
	`ªxec_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

494 
__c⁄°
 *
__ª°ri˘
 
__«me
,

495 
__c⁄°
 *
__ª°ri˘
 
__∑ss
,

496 
__c⁄°
 *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

497 
ß_Ámûy_t
 
__af
);

507 
	`ru£rok
 (
__c⁄°
 *
__rho°
, 
__su£r
,

508 
__c⁄°
 *
__ªmu£r
, __c⁄° *
__locu£r
);

517 
	`ru£rok_af
 (
__c⁄°
 *
__rho°
, 
__su£r
,

518 
__c⁄°
 *
__ªmu£r
, __c⁄° *
__locu£r
,

519 
ß_Ámûy_t
 
__af
);

530 
	`úu£rok
 (
uöt32_t
 
__øddr
, 
__su£r
,

531 
__c⁄°
 *
__ªmu£r
, __c⁄° *
__locu£r
);

541 
	`úu£rok_af
 (
__c⁄°
 *
__øddr
, 
__su£r
,

542 
__c⁄°
 *
__ªmu£r
, __c⁄° *
__locu£r
,

543 
ß_Ámûy_t
 
__af
);

553 
	`ºesvp‹t
 (*
__Æp‹t
);

562 
	`ºesvp‹t_af
 (*
__Æp‹t
, 
ß_Ámûy_t
 
__af
);

567 #ifdef 
__USE_POSIX


569 
	saddröfo


571 
ai_Êags
;

572 
ai_Ámûy
;

573 
ai_sockty≥
;

574 
ai_¥Ÿocﬁ
;

575 
sockÀn_t
 
ai_addæí
;

576 
sockaddr
 *
ai_addr
;

577 *
ai_ˇn⁄«me
;

578 
addröfo
 *
ai_√xt
;

581 #ifde‡
__USE_GNU


583 
	sgaicb


585 c⁄° *
¨_«me
;

586 c⁄° *
¨_£rvi˚
;

587 c⁄° 
addröfo
 *
¨_ªque°
;

588 
addröfo
 *
¨_ªsu…
;

590 
__ªtu∫
;

591 
__unu£d
[5];

595 
	#GAI_WAIT
 0

	)

596 
	#GAI_NOWAIT
 1

	)

600 
	#AI_PASSIVE
 0x0001

	)

601 
	#AI_CANONNAME
 0x0002

	)

602 
	#AI_NUMERICHOST
 0x0004

	)

603 
	#AI_V4MAPPED
 0x0008

	)

604 
	#AI_ALL
 0x0010

	)

605 
	#AI_ADDRCONFIG
 0x0020

	)

607 #ifde‡
__USE_GNU


608 
	#AI_IDN
 0x0040

	)

611 
	#AI_CANONIDN
 0x0080

	)

612 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

614 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

617 
	#AI_NUMERICSERV
 0x0400

	)

620 
	#EAI_BADFLAGS
 -1

	)

621 
	#EAI_NONAME
 -2

	)

622 
	#EAI_AGAIN
 -3

	)

623 
	#EAI_FAIL
 -4

	)

624 
	#EAI_FAMILY
 -6

	)

625 
	#EAI_SOCKTYPE
 -7

	)

626 
	#EAI_SERVICE
 -8

	)

627 
	#EAI_MEMORY
 -10

	)

628 
	#EAI_SYSTEM
 -11

	)

629 
	#EAI_OVERFLOW
 -12

	)

630 #ifde‡
__USE_GNU


631 
	#EAI_NODATA
 -5

	)

632 
	#EAI_ADDRFAMILY
 -9

	)

633 
	#EAI_INPROGRESS
 -100

	)

634 
	#EAI_CANCELED
 -101

	)

635 
	#EAI_NOTCANCELED
 -102

	)

636 
	#EAI_ALLDONE
 -103

	)

637 
	#EAI_INTR
 -104

	)

638 
	#EAI_IDN_ENCODE
 -105

	)

641 #ifde‡
__USE_MISC


642 
	#NI_MAXHOST
 1025

	)

643 
	#NI_MAXSERV
 32

	)

646 
	#NI_NUMERICHOST
 1

	)

647 
	#NI_NUMERICSERV
 2

	)

648 
	#NI_NOFQDN
 4

	)

649 
	#NI_NAMEREQD
 8

	)

650 
	#NI_DGRAM
 16

	)

651 #ifde‡
__USE_GNU


652 
	#NI_IDN
 32

	)

653 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

655 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

664 
	`gëaddröfo
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

665 
__c⁄°
 *
__ª°ri˘
 
__£rvi˚
,

666 
__c⁄°
 
addröfo
 *
__ª°ri˘
 
__ªq
,

667 
addröfo
 **
__ª°ri˘
 
__∑i
);

670 
	$‰ìaddröfo
 (
addröfo
 *
__ai
Ë
__THROW
;

673 
__c⁄°
 *
	$gai_°ªº‹
 (
__ecode
Ë
__THROW
;

679 
	`gë«meöfo
 (
__c⁄°
 
sockaddr
 *
__ª°ri˘
 
__ß
,

680 
sockÀn_t
 
__ßÀn
, *
__ª°ri˘
 
__ho°
,

681 
sockÀn_t
 
__ho°Àn
, *
__ª°ri˘
 
__£rv
,

682 
sockÀn_t
 
__£rvÀn
, 
__Êags
);

685 #ifde‡
__USE_GNU


694 
	`gëaddröfo_a
 (
__mode
, 
gaicb
 *
__li°
[
__ª°ri˘_¨r
],

695 
__ít
, 
sigevít
 *
__ª°ri˘
 
__sig
);

705 
	`gai_su•íd
 (
__c⁄°
 
gaicb
 *__c⁄° 
__li°
[], 
__ít
,

706 
__c⁄°
 
time•ec
 *
__timeout
);

709 
	$gai_îr‹
 (
gaicb
 *
__ªq
Ë
__THROW
;

712 
	$gai_ˇn˚l
 (
gaicb
 *
__gaicbp
Ë
__THROW
;

715 
__END_DECLS


	@/usr/include/netinet/if_ether.h

19 #i‚de‡
__NETINET_IF_ETHER_H


21 
	#__NETINET_IF_ETHER_H
 1

	)

22 
	~<„©uªs.h
>

23 
	~<sys/ty≥s.h
>

26 
	~<löux/if_ëhî.h
>

28 #ifde‡
__USE_BSD


61 
	~<√t/ëhî√t.h
>

62 
	~<√t/if_¨p.h
>

64 
__BEGIN_DECLS


72 
	sëhî_¨p
 {

73 
¨phdr
 
	mó_hdr
;

74 
u_öt8_t
 
	m¨p_sha
[
ETH_ALEN
];

75 
u_öt8_t
 
	m¨p_•a
[4];

76 
u_öt8_t
 
	m¨p_tha
[
ETH_ALEN
];

77 
u_öt8_t
 
	m¨p_ça
[4];

79 
	#¨p_hrd
 
ó_hdr
.
¨_hrd


	)

80 
	#¨p_¥o
 
ó_hdr
.
¨_¥o


	)

81 
	#¨p_h 
 
ó_hdr
.
¨_h 


	)

82 
	#¨p_∂n
 
ó_hdr
.
¨_∂n


	)

83 
	#¨p_›
 
ó_hdr
.
¨_›


	)

90 
	#ETHER_MAP_IP_MULTICAST
(
ùaddr
, 
íaddr
) \

94 (
íaddr
)[0] = 0x01; \

95 (
íaddr
)[1] = 0x00; \

96 (
íaddr
)[2] = 0x5e; \

97 (
íaddr
)[3] = ((
u_öt8_t
 *)
ùaddr
)[1] & 0x7f; \

98 (
íaddr
)[4] = ((
u_öt8_t
 *)
ùaddr
)[2]; \

99 (
íaddr
)[5] = ((
u_öt8_t
 *)
ùaddr
)[3]; \

100 }

	)

102 
	g__END_DECLS


	@/usr/include/netinet/in.h

20 #i‚def 
_NETINET_IN_H


21 
	#_NETINET_IN_H
 1

	)

23 
	~<„©uªs.h
>

24 
	~<°döt.h
>

25 
	~<sys/sockë.h
>

26 
	~<bôs/ty≥s.h
>

29 
__BEGIN_DECLS


34 
	mIPPROTO_IP
 = 0,

35 
	#IPPROTO_IP
 
IPPROTO_IP


	)

36 
	mIPPROTO_HOPOPTS
 = 0,

37 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

38 
	mIPPROTO_ICMP
 = 1,

39 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

40 
	mIPPROTO_IGMP
 = 2,

41 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

42 
	mIPPROTO_IPIP
 = 4,

43 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

44 
	mIPPROTO_TCP
 = 6,

45 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

46 
	mIPPROTO_EGP
 = 8,

47 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

48 
	mIPPROTO_PUP
 = 12,

49 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

50 
	mIPPROTO_UDP
 = 17,

51 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

52 
	mIPPROTO_IDP
 = 22,

53 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

54 
	mIPPROTO_TP
 = 29,

55 
	#IPPROTO_TP
 
IPPROTO_TP


	)

56 
	mIPPROTO_DCCP
 = 33,

57 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

58 
	mIPPROTO_IPV6
 = 41,

59 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

60 
	mIPPROTO_ROUTING
 = 43,

61 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

62 
	mIPPROTO_FRAGMENT
 = 44,

63 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

64 
	mIPPROTO_RSVP
 = 46,

65 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

66 
	mIPPROTO_GRE
 = 47,

67 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

68 
	mIPPROTO_ESP
 = 50,

69 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

70 
	mIPPROTO_AH
 = 51,

71 
	#IPPROTO_AH
 
IPPROTO_AH


	)

72 
	mIPPROTO_ICMPV6
 = 58,

73 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

74 
	mIPPROTO_NONE
 = 59,

75 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

76 
	mIPPROTO_DSTOPTS
 = 60,

77 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

78 
	mIPPROTO_MTP
 = 92,

79 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

80 
	mIPPROTO_ENCAP
 = 98,

81 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

82 
	mIPPROTO_PIM
 = 103,

83 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

84 
	mIPPROTO_COMP
 = 108,

85 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

86 
	mIPPROTO_SCTP
 = 132,

87 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

88 
	mIPPROTO_UDPLITE
 = 136,

89 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


97 
uöt16_t
 
	tö_p‹t_t
;

102 
	mIPPORT_ECHO
 = 7,

103 
	mIPPORT_DISCARD
 = 9,

104 
	mIPPORT_SYSTAT
 = 11,

105 
	mIPPORT_DAYTIME
 = 13,

106 
	mIPPORT_NETSTAT
 = 15,

107 
	mIPPORT_FTP
 = 21,

108 
	mIPPORT_TELNET
 = 23,

109 
	mIPPORT_SMTP
 = 25,

110 
	mIPPORT_TIMESERVER
 = 37,

111 
	mIPPORT_NAMESERVER
 = 42,

112 
	mIPPORT_WHOIS
 = 43,

113 
	mIPPORT_MTP
 = 57,

115 
	mIPPORT_TFTP
 = 69,

116 
	mIPPORT_RJE
 = 77,

117 
	mIPPORT_FINGER
 = 79,

118 
	mIPPORT_TTYLINK
 = 87,

119 
	mIPPORT_SUPDUP
 = 95,

122 
	mIPPORT_EXECSERVER
 = 512,

123 
	mIPPORT_LOGINSERVER
 = 513,

124 
	mIPPORT_CMDSERVER
 = 514,

125 
	mIPPORT_EFSSERVER
 = 520,

128 
	mIPPORT_BIFFUDP
 = 512,

129 
	mIPPORT_WHOSERVER
 = 513,

130 
	mIPPORT_ROUTESERVER
 = 520,

133 
	mIPPORT_RESERVED
 = 1024,

136 
	mIPPORT_USERRESERVED
 = 5000

141 
uöt32_t
 
	tö_addr_t
;

142 
	sö_addr


144 
ö_addr_t
 
	ms_addr
;

153 
	#IN_CLASSA
(
a
Ë((((
ö_addr_t
)◊)Ë& 0x80000000Ë=0)

	)

154 
	#IN_CLASSA_NET
 0xff000000

	)

155 
	#IN_CLASSA_NSHIFT
 24

	)

156 
	#IN_CLASSA_HOST
 (0xfffffff‡& ~
IN_CLASSA_NET
)

	)

157 
	#IN_CLASSA_MAX
 128

	)

159 
	#IN_CLASSB
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xc0000000Ë=0x80000000)

	)

160 
	#IN_CLASSB_NET
 0xffff0000

	)

161 
	#IN_CLASSB_NSHIFT
 16

	)

162 
	#IN_CLASSB_HOST
 (0xfffffff‡& ~
IN_CLASSB_NET
)

	)

163 
	#IN_CLASSB_MAX
 65536

	)

165 
	#IN_CLASSC
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xc0000000)

	)

166 
	#IN_CLASSC_NET
 0xffffff00

	)

167 
	#IN_CLASSC_NSHIFT
 8

	)

168 
	#IN_CLASSC_HOST
 (0xfffffff‡& ~
IN_CLASSC_NET
)

	)

170 
	#IN_CLASSD
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xe0000000)

	)

171 
	#IN_MULTICAST
(
a
Ë
	`IN_CLASSD
◊)

	)

173 
	#IN_EXPERIMENTAL
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xe0000000)

	)

174 
	#IN_BADCLASS
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xf0000000)

	)

177 
	#INADDR_ANY
 ((
ö_addr_t
Ë0x00000000)

	)

179 
	#INADDR_BROADCAST
 ((
ö_addr_t
Ë0xffffffff)

	)

181 
	#INADDR_NONE
 ((
ö_addr_t
Ë0xffffffff)

	)

184 
	#IN_LOOPBACKNET
 127

	)

186 #i‚de‡
INADDR_LOOPBACK


187 
	#INADDR_LOOPBACK
 ((
ö_addr_t
Ë0x7f000001Ë

	)

191 
	#INADDR_UNSPEC_GROUP
 ((
ö_addr_t
Ë0xe0000000Ë

	)

192 
	#INADDR_ALLHOSTS_GROUP
 ((
ö_addr_t
Ë0xe0000001Ë

	)

193 
	#INADDR_ALLRTRS_GROUP
 ((
ö_addr_t
Ë0xe0000002Ë

	)

194 
	#INADDR_MAX_LOCAL_GROUP
 ((
ö_addr_t
Ë0xe00000ffË

	)

198 
	sö6_addr


202 
uöt8_t
 
	m__u6_addr8
[16];

203 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


204 
uöt16_t
 
	m__u6_addr16
[8];

205 
uöt32_t
 
	m__u6_addr32
[4];

207 } 
	m__ö6_u
;

208 
	#s6_addr
 
__ö6_u
.
__u6_addr8


	)

209 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


210 
	#s6_addr16
 
__ö6_u
.
__u6_addr16


	)

211 
	#s6_addr32
 
__ö6_u
.
__u6_addr32


	)

215 c⁄° 
ö6_addr
 
ö6addr_™y
;

216 c⁄° 
ö6_addr
 
ö6addr_lo›back
;

217 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

218 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

220 
	#INET_ADDRSTRLEN
 16

	)

221 
	#INET6_ADDRSTRLEN
 46

	)

225 
	ssockaddr_ö


227 
__SOCKADDR_COMMON
 (
sö_
);

228 
ö_p‹t_t
 
	msö_p‹t
;

229 
ö_addr
 
	msö_addr
;

232 
	msö_zîo
[ (
sockaddr
) -

233 
__SOCKADDR_COMMON_SIZE
 -

234  (
ö_p‹t_t
) -

235  (
ö_addr
)];

239 
	ssockaddr_ö6


241 
__SOCKADDR_COMMON
 (
sö6_
);

242 
ö_p‹t_t
 
	msö6_p‹t
;

243 
uöt32_t
 
	msö6_Êowöfo
;

244 
ö6_addr
 
	msö6_addr
;

245 
uöt32_t
 
	msö6_sc›e_id
;

249 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


251 
	sù_mªq


254 
ö_addr
 
	mimr_mu…üddr
;

257 
ö_addr
 
	mimr_öãrÁ˚
;

260 
	sù_mªq_sour˚


263 
ö_addr
 
	mimr_mu…üddr
;

266 
ö_addr
 
	mimr_öãrÁ˚
;

269 
ö_addr
 
	mimr_sour˚addr
;

275 
	sùv6_mªq


278 
ö6_addr
 
	mùv6mr_mu…üddr
;

281 
	mùv6mr_öãrÁ˚
;

285 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


287 
	sgroup_ªq


290 
uöt32_t
 
	mgr_öãrÁ˚
;

293 
sockaddr_°‹age
 
	mgr_group
;

296 
	sgroup_sour˚_ªq


299 
uöt32_t
 
	mg§_öãrÁ˚
;

302 
sockaddr_°‹age
 
	mg§_group
;

305 
sockaddr_°‹age
 
	mg§_sour˚
;

310 
	sù_msfûãr


313 
ö_addr
 
	mimsf_mu…üddr
;

316 
ö_addr
 
	mimsf_öãrÁ˚
;

319 
uöt32_t
 
	mimsf_fmode
;

322 
uöt32_t
 
	mimsf_num§c
;

324 
ö_addr
 
	mimsf_¶i°
[1];

327 
	#IP_MSFILTER_SIZE
(
num§c
Ë( (
ù_msfûãr
) \

328 -  (
ö_addr
) \

329 + (
num§c
Ë*  (
ö_addr
))

	)

331 
	sgroup_fûãr


334 
uöt32_t
 
	mgf_öãrÁ˚
;

337 
sockaddr_°‹age
 
	mgf_group
;

340 
uöt32_t
 
	mgf_fmode
;

343 
uöt32_t
 
	mgf_num§c
;

345 
sockaddr_°‹age
 
	mgf_¶i°
[1];

348 
	#GROUP_FILTER_SIZE
(
num§c
Ë( (
group_fûãr
) \

349 -  (
sockaddr_°‹age
) \

350 + ((
num§c
) \

351 *  (
sockaddr_°‹age
)))

	)

356 
	~<bôs/ö.h
>

365 
uöt32_t
 
	$¡ohl
 (
uöt32_t
 
__√é⁄g
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

366 
uöt16_t
 
	$¡ohs
 (
uöt16_t
 
__√tsh‹t
)

367 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

368 
uöt32_t
 
	$ht⁄l
 (
uöt32_t
 
__ho°l⁄g
)

369 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

370 
uöt16_t
 
	$ht⁄s
 (
uöt16_t
 
__ho°sh‹t
)

371 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

373 
	~<ídün.h
>

376 
	~<bôs/byãsw≠.h
>

378 #ifde‡
__OPTIMIZE__


382 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


385 
	#¡ohl
(
x
Ë(x)

	)

386 
	#¡ohs
(
x
Ë(x)

	)

387 
	#ht⁄l
(
x
Ë(x)

	)

388 
	#ht⁄s
(
x
Ë(x)

	)

390 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


391 
	#¡ohl
(
x
Ë
	`__bsw≠_32
 (x)

	)

392 
	#¡ohs
(
x
Ë
	`__bsw≠_16
 (x)

	)

393 
	#ht⁄l
(
x
Ë
	`__bsw≠_32
 (x)

	)

394 
	#ht⁄s
(
x
Ë
	`__bsw≠_16
 (x)

	)

399 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

400 (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] == 0 \

401 && ((
__c⁄°
 
uöt32_t
 *Ë(
a
))[1] == 0 \

402 && ((
__c⁄°
 
uöt32_t
 *Ë(
a
))[2] == 0 \

403 && ((
__c⁄°
 
uöt32_t
 *Ë(
a
))[3] =0)

	)

405 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

406 (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] == 0 \

407 && ((
__c⁄°
 
uöt32_t
 *Ë(
a
))[1] == 0 \

408 && ((
__c⁄°
 
uöt32_t
 *Ë(
a
))[2] == 0 \

409 && ((
__c⁄°
 
uöt32_t
 *Ë(
a
))[3] =
	`ht⁄l
 (1))

	)

411 
	#IN6_IS_ADDR_MULTICAST
(
a
Ë(((
__c⁄°
 
uöt8_t
 *Ë◊))[0] =0xff)

	)

413 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

414 ((((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

415 =
	`ht⁄l
 (0x„800000))

	)

417 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

418 ((((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

419 =
	`ht⁄l
 (0x„c00000))

	)

421 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

422 ((((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] == 0) \

423 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[1] == 0) \

424 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[2] =
	`ht⁄l
 (0xffff)))

	)

426 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

427 ((((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] == 0) \

428 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[1] == 0) \

429 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[2] == 0) \

430 && (
	`¡ohl
 (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[3]Ë> 1))

	)

432 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

433 ((((
__c⁄°
 
uöt32_t
 *Ë(
a
))[0] =((__c⁄° uöt32_à*Ë(
b
))[0]) \

434 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[1] =((__c⁄° uöt32_à*Ë(
b
))[1]) \

435 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[2] =((__c⁄° uöt32_à*Ë(
b
))[2]) \

436 && (((
__c⁄°
 
uöt32_t
 *Ë(
a
))[3] =((__c⁄° uöt32_à*Ë(
b
))[3]))

	)

438 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


440 
	$bödªsvp‹t
 (
__sockfd
, 
sockaddr_ö
 *
__sock_ö
Ë
__THROW
;

443 
	$bödªsvp‹t6
 (
__sockfd
, 
sockaddr_ö6
 *
__sock_ö
)

444 
__THROW
;

448 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

449 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

450 && ((((
__c⁄°
 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x1))

	)

452 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

453 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

454 && ((((
__c⁄°
 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x2))

	)

456 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

457 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

458 && ((((
__c⁄°
 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x5))

	)

460 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

461 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

462 && ((((
__c⁄°
 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x8))

	)

464 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

465 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

466 && ((((
__c⁄°
 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0xe))

	)

469 #ifde‡
__USE_GNU


471 
	sö6_pktöfo


473 
ö6_addr
 
ùi6_addr
;

474 
ùi6_ifödex
;

478 
	sù6_mtuöfo


480 
sockaddr_ö6
 
ù6m_addr
;

481 
uöt32_t
 
ù6m_mtu
;

486 
	$öë6_›ti⁄_•a˚
 (
__nbyãs
)

487 
__THROW
 
__©åibuã_dïªˇãd__
;

488 
	$öë6_›ti⁄_öô
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

489 
__ty≥
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

490 
	$öë6_›ti⁄_≠≥nd
 (
cmsghdr
 *
__cmsg
,

491 
__c⁄°
 
uöt8_t
 *
__ty≥p
, 
__mu…x
,

492 
__∂usy
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

493 
uöt8_t
 *
	$öë6_›ti⁄_Æloc
 (
cmsghdr
 *
__cmsg
, 
__d©Æí
,

494 
__mu…x
, 
__∂usy
)

495 
__THROW
 
__©åibuã_dïªˇãd__
;

496 
	$öë6_›ti⁄_√xt
 (
__c⁄°
 
cmsghdr
 *
__cmsg
,

497 
uöt8_t
 **
__çåp
)

498 
__THROW
 
__©åibuã_dïªˇãd__
;

499 
	$öë6_›ti⁄_föd
 (
__c⁄°
 
cmsghdr
 *
__cmsg
,

500 
uöt8_t
 **
__çåp
, 
__ty≥
)

501 
__THROW
 
__©åibuã_dïªˇãd__
;

505 
	$öë6_›t_öô
 (*
__extbuf
, 
sockÀn_t
 
__exéí
Ë
__THROW
;

506 
	$öë6_›t_≠≥nd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

507 
uöt8_t
 
__ty≥
, 
sockÀn_t
 
__Àn
, uöt8_à
__Æign
,

508 **
__d©abuÂ
Ë
__THROW
;

509 
	$öë6_›t_föish
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
)

510 
__THROW
;

511 
	$öë6_›t_£t_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

512 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

513 
	$öë6_›t_√xt
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

514 
uöt8_t
 *
__ty≥p
, 
sockÀn_t
 *
__À≈
,

515 **
__d©abuÂ
Ë
__THROW
;

516 
	$öë6_›t_föd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

517 
uöt8_t
 
__ty≥
, 
sockÀn_t
 *
__À≈
,

518 **
__d©abuÂ
Ë
__THROW
;

519 
	$öë6_›t_gë_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

520 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

524 
sockÀn_t
 
	$öë6_πh_•a˚
 (
__ty≥
, 
__£gmíts
Ë
__THROW
;

525 *
	$öë6_πh_öô
 (*
__bp
, 
sockÀn_t
 
__bp_Àn
, 
__ty≥
,

526 
__£gmíts
Ë
__THROW
;

527 
	$öë6_πh_add
 (*
__bp
, 
__c⁄°
 
ö6_addr
 *
__addr
Ë
__THROW
;

528 
	$öë6_πh_ªvî£
 (
__c⁄°
 *
__ö
, *
__out
Ë
__THROW
;

529 
	$öë6_πh_£gmíts
 (
__c⁄°
 *
__bp
Ë
__THROW
;

530 
ö6_addr
 *
	$öë6_πh_gëaddr
 (
__c⁄°
 *
__bp
, 
__ödex
)

531 
__THROW
;

537 
	$gëùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

538 
ö_addr
 
__group
, 
uöt32_t
 *
__fmode
,

539 
uöt32_t
 *
__num§c
, 
ö_addr
 *
__¶i°
)

540 
__THROW
;

543 
	$£tùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

544 
ö_addr
 
__group
, 
uöt32_t
 
__fmode
,

545 
uöt32_t
 
__num§c
,

546 
__c⁄°
 
ö_addr
 *
__¶i°
)

547 
__THROW
;

551 
	$gësour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

552 
__c⁄°
 
sockaddr
 *
__group
,

553 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 *
__fmode
,

554 
uöt32_t
 *
__num§c
,

555 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

558 
	$£tsour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

559 
__c⁄°
 
sockaddr
 *
__group
,

560 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 
__fmode
,

561 
uöt32_t
 
__num§c
,

562 
__c⁄°
 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

565 
__END_DECLS


	@/usr/include/poll.h

1 
	~<sys/pﬁl.h
>

	@/usr/include/pthread.h

20 #i‚de‡
_PTHREAD_H


21 
	#_PTHREAD_H
 1

	)

23 
	~<„©uªs.h
>

24 
	~<ídün.h
>

25 
	~<sched.h
>

26 
	~<time.h
>

28 
	~<bôs/±hªadty≥s.h
>

29 
	~<bôs/£tjmp.h
>

30 
	~<bôs/w‹dsize.h
>

36 
	mPTHREAD_CREATE_JOINABLE
,

37 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

38 
	mPTHREAD_CREATE_DETACHED


39 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

46 
	mPTHREAD_MUTEX_TIMED_NP
,

47 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

48 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

49 
	mPTHREAD_MUTEX_ADAPTIVE_NP


50 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


52 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

53 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

54 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

55 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


57 #ifde‡
__USE_GNU


59 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


64 #ifde‡
__USE_XOPEN2K


68 
	mPTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

70 
	mPTHREAD_MUTEX_ROBUST
,

71 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


76 #ifde‡
__USE_UNIX98


80 
	mPTHREAD_PRIO_NONE
,

81 
	mPTHREAD_PRIO_INHERIT
,

82 
	mPTHREAD_PRIO_PROTECT


88 #i‡
__WORDSIZE
 == 64

89 
	#PTHREAD_MUTEX_INITIALIZER
 \

90 { { 0, 0, 0, 0, 0, 0, { 0, 0 } } }

	)

91 #ifde‡
__USE_GNU


92 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0, 0 } } }

	)

94 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0, 0 } } }

	)

96 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

97 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0, 0 } } }

	)

100 
	#PTHREAD_MUTEX_INITIALIZER
 \

101 { { 0, 0, 0, 0, 0, { 0 } } }

	)

102 #ifde‡
__USE_GNU


103 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0 } } }

	)

105 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0 } } }

	)

107 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

108 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0 } } }

	)

114 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


124 
	#PTHREAD_RWLOCK_INITIALIZER
 \

125 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

126 #ifde‡
__USE_GNU


127 #i‡
__WORDSIZE
 == 64

128 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

130 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

132 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


133 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

134 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

135 0, 0, 0, 0 } }

	)

137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

139 0 } }

	)

149 
	mPTHREAD_INHERIT_SCHED
,

150 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

151 
	mPTHREAD_EXPLICIT_SCHED


152 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

159 
	mPTHREAD_SCOPE_SYSTEM
,

160 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

161 
	mPTHREAD_SCOPE_PROCESS


162 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

169 
	mPTHREAD_PROCESS_PRIVATE
,

170 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

171 
	mPTHREAD_PROCESS_SHARED


172 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

178 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*Ë0, 0, 0 } }

	)

182 
	s_±hªad_˛ónup_buf„r


184 (*
	m__routöe
) (*);

185 *
	m__¨g
;

186 
	m__ˇn˚…y≥
;

187 
_±hªad_˛ónup_buf„r
 *
	m__¥ev
;

193 
	mPTHREAD_CANCEL_ENABLE
,

194 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

195 
	mPTHREAD_CANCEL_DISABLE


196 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

200 
	mPTHREAD_CANCEL_DEFERRED
,

201 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

202 
	mPTHREAD_CANCEL_ASYNCHRONOUS


203 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

205 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

209 
	#PTHREAD_ONCE_INIT
 0

	)

212 #ifde‡
__USE_XOPEN2K


216 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

220 
__BEGIN_DECLS


225 
±hªad_¸óã
 (
±hªad_t
 *
__ª°ri˘
 
__√wthªad
,

226 
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

227 *(*
__°¨t_routöe
) (*),

228 *
__ª°ri˘
 
__¨g
Ë
__THROW
 
__n⁄nuŒ
 ((1, 3));

234 
	$±hªad_exô
 (*
__ªtvÆ
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

242 
	`±hªad_joö
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
);

244 #ifde‡
__USE_GNU


247 
	$±hªad_åyjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
Ë
__THROW
;

255 
	`±hªad_timedjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

256 
__c⁄°
 
time•ec
 *
__ab°ime
);

263 
	$±hªad_dëach
 (
±hªad_t
 
__th
Ë
__THROW
;

267 
±hªad_t
 
	$±hªad_£lf
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

270 
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
Ë
__THROW
;

278 
	$±hªad_©å_öô
 (
±hªad_©å_t
 *
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

281 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 *
__©å
)

282 
__THROW
 
	`__n⁄nuŒ
 ((1));

285 
	$±hªad_©å_gëdëach°©e
 (
__c⁄°
 
±hªad_©å_t
 *
__©å
,

286 *
__dëach°©e
)

287 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

290 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 *
__©å
,

291 
__dëach°©e
)

292 
__THROW
 
	`__n⁄nuŒ
 ((1));

296 
	$±hªad_©å_gëgu¨dsize
 (
__c⁄°
 
±hªad_©å_t
 *
__©å
,

297 
size_t
 *
__gu¨dsize
)

298 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

301 
	$±hªad_©å_£tgu¨dsize
 (
±hªad_©å_t
 *
__©å
,

302 
size_t
 
__gu¨dsize
)

303 
__THROW
 
	`__n⁄nuŒ
 ((1));

307 
	$±hªad_©å_gësched∑øm
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


308 
__©å
,

309 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

310 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

313 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

314 
__c⁄°
 
sched_∑øm
 *
__ª°ri˘


315 
__∑øm
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

318 
	$±hªad_©å_gëschedpﬁicy
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


319 
__©å
, *
__ª°ri˘
 
__pﬁicy
)

320 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

323 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *
__©å
, 
__pﬁicy
)

324 
__THROW
 
	`__n⁄nuŒ
 ((1));

327 
	$±hªad_©å_gëöhîôsched
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


328 
__©å
, *
__ª°ri˘
 
__öhîô
)

329 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

332 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 *
__©å
,

333 
__öhîô
)

334 
__THROW
 
	`__n⁄nuŒ
 ((1));

338 
	$±hªad_©å_gësc›e
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

339 *
__ª°ri˘
 
__sc›e
)

340 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

343 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *
__©å
, 
__sc›e
)

344 
__THROW
 
	`__n⁄nuŒ
 ((1));

347 
	$±hªad_©å_gë°ackaddr
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


348 
__©å
, **
__ª°ri˘
 
__°ackaddr
)

349 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__©åibuã_dïªˇãd__
;

355 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 *
__©å
,

356 *
__°ackaddr
)

357 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
;

360 
	$±hªad_©å_gë°acksize
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


361 
__©å
, 
size_t
 *
__ª°ri˘
 
__°acksize
)

362 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

367 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 *
__©å
,

368 
size_t
 
__°acksize
)

369 
__THROW
 
	`__n⁄nuŒ
 ((1));

371 #ifde‡
__USE_XOPEN2K


373 
	$±hªad_©å_gë°ack
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

374 **
__ª°ri˘
 
__°ackaddr
,

375 
size_t
 *
__ª°ri˘
 
__°acksize
)

376 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

381 
	$±hªad_©å_£t°ack
 (
±hªad_©å_t
 *
__©å
, *
__°ackaddr
,

382 
size_t
 
__°acksize
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

385 #ifde‡
__USE_GNU


388 
	$±hªad_©å_£èfföôy_≈
 (
±hªad_©å_t
 *
__©å
,

389 
size_t
 
__˝u£tsize
,

390 
__c⁄°
 
˝u_£t_t
 *
__˝u£t
)

391 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

395 
	$±hªad_©å_gëafföôy_≈
 (
__c⁄°
 
±hªad_©å_t
 *
__©å
,

396 
size_t
 
__˝u£tsize
,

397 
˝u_£t_t
 *
__˝u£t
)

398 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

404 
	$±hªad_gë©å_≈
 (
±hªad_t
 
__th
, 
±hªad_©å_t
 *
__©å
)

405 
__THROW
 
	`__n⁄nuŒ
 ((2));

413 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
__èrgë_thªad
, 
__pﬁicy
,

414 
__c⁄°
 
sched_∑øm
 *
__∑øm
)

415 
__THROW
 
	`__n⁄nuŒ
 ((3));

418 
	$±hªad_gësched∑øm
 (
±hªad_t
 
__èrgë_thªad
,

419 *
__ª°ri˘
 
__pﬁicy
,

420 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

421 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

424 
	$±hªad_£tsched¥io
 (
±hªad_t
 
__èrgë_thªad
, 
__¥io
)

425 
__THROW
;

428 #ifde‡
__USE_GNU


430 
	$±hªad_gë«me_≈
 (
±hªad_t
 
__èrgë_thªad
, *
__buf
,

431 
size_t
 
__buÊí
)

432 
__THROW
 
	`__n⁄nuŒ
 ((2));

435 
	$±hªad_£äame_≈
 (
±hªad_t
 
__èrgë_thªad
, 
__c⁄°
 *
__«me
)

436 
__THROW
 
	`__n⁄nuŒ
 ((2));

440 #ifde‡
__USE_UNIX98


442 
	$±hªad_gëc⁄cuºícy
 (Ë
__THROW
;

445 
	$±hªad_£tc⁄cuºícy
 (
__Àvñ
Ë
__THROW
;

448 #ifde‡
__USE_GNU


453 
	$±hªad_yõld
 (Ë
__THROW
;

458 
	$±hªad_£èfföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

459 
__c⁄°
 
˝u_£t_t
 *
__˝u£t
)

460 
__THROW
 
	`__n⁄nuŒ
 ((3));

463 
	$±hªad_gëafföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

464 
˝u_£t_t
 *
__˝u£t
)

465 
__THROW
 
	`__n⁄nuŒ
 ((3));

478 
	`±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

479 (*
__öô_routöe
Ë()Ë
	`__n⁄nuŒ
 ((1, 2));

490 
	`±hªad_£tˇn˚l°©e
 (
__°©e
, *
__ﬁd°©e
);

494 
	`±hªad_£tˇn˚…y≥
 (
__ty≥
, *
__ﬁdty≥
);

497 
	`±hªad_ˇn˚l
 (
±hªad_t
 
__th
);

502 
	`±hªad_ã°ˇn˚l
 ();

511 
__jmp_buf
 
__ˇn˚l_jmp_buf
;

512 
__mask_was_ßved
;

513 } 
__ˇn˚l_jmp_buf
[1];

514 *
__∑d
[4];

515 } 
	t__±hªad_unwöd_buf_t
 
	t__©åibuã__
 ((
	t__Æig√d__
));

518 #i‚de‡
__˛ónup_f˘_©åibuã


519 
	#__˛ónup_f˘_©åibuã


	)

524 
	s__±hªad_˛ónup_‰ame


526 (*
__ˇn˚l_routöe
) (*);

527 *
__ˇn˚l_¨g
;

528 
__do_ô
;

529 
__ˇn˚l_ty≥
;

532 #i‡
deföed
 
__GNUC__
 && deföed 
__EXCEPTIONS


533 #ifde‡
__˝lu•lus


535 ˛as†
	c__±hªad_˛ónup_˛ass


537 (*
__ˇn˚l_routöe
) (*);

538 *
__ˇn˚l_¨g
;

539 
__do_ô
;

540 
__ˇn˚l_ty≥
;

542 
public
:

543 
	`__±hªad_˛ónup_˛ass
 ((*
__f˘
Ë(*), *
__¨g
)

544 : 
	`__ˇn˚l_routöe
 (
__f˘
), 
	`__ˇn˚l_¨g
 (
__¨g
), 
	$__do_ô
 (1) { }

545 ~
	$__±hªad_˛ónup_˛ass
 (Ë{ i‡(
__do_ô
Ë
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); 
	}
}

546 
	$__£tdoô
 (
__√wvÆ
Ë{ 
__do_ô
 = __√wvÆ; 
	}
}

547 
	$__de„r
 (Ë{ 
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
,

548 &
__ˇn˚l_ty≥
); 
	}
}

549 
	$__ª°‹e
 (Ëc⁄° { 
	`±hªad_£tˇn˚…y≥
 (
__ˇn˚l_ty≥
, 0); 
	}
}

559 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

561 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
)

	)

565 
	#±hªad_˛ónup_p›
(
execuã
) \

566 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

567 } 0)

	)

569 #ifde‡
__USE_GNU


573 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

575 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
); \

576 
__˛‰ame
.
	`__de„r
 ()

	)

581 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

582 
__˛‰ame
.
	`__ª°‹e
 (); \

583 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

584 } 0)

	)

591 
__exã∫_ölöe
 

592 
	$__±hªad_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
__‰ame
)

594 i‡(
__‰ame
->
__do_ô
)

595 
__‰ame
->
	`__ˇn˚l_routöe
 (__‰ame->
__ˇn˚l_¨g
);

596 
	}
}

605 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

607 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

608 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

609 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

610 .
__do_ô
 = 1 };

	)

614 
	#±hªad_˛ónup_p›
(
execuã
) \

615 
__˛‰ame
.
__do_ô
 = (
execuã
); \

616 } 0)

	)

618 #ifde‡
__USE_GNU


622 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

624 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

625 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

626 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

627 .
__do_ô
 = 1 }; \

628 (Ë
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
, \

629 &
__˛‰ame
.
__ˇn˚l_ty≥
)

	)

634 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

635 (Ë
	`±hªad_£tˇn˚…y≥
 (
__˛‰ame
.
__ˇn˚l_ty≥
, 
NULL
); \

636 
__˛‰ame
.
__do_ô
 = (
execuã
); \

637 } 0)

	)

648 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

650 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

651 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

652 *
__ˇn˚l_¨g
 = (
¨g
); \

653 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

654 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

655 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

657 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

658 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

662 
	`__±hªad_ªgi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

663 dÿ{

	)

664 
__±hªad_ªgi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

665 
__˛ónup_f˘_©åibuã
;

669 
	#±hªad_˛ónup_p›
(
execuã
) \

672 
	`__±hªad_uƒegi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

673 i‡(
execuã
) \

674 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

675 } 0)

	)

676 
	$__±hªad_uƒegi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

677 
__˛ónup_f˘_©åibuã
;

679 #ifde‡
__USE_GNU


683 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

685 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

686 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

687 *
__ˇn˚l_¨g
 = (
¨g
); \

688 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

689 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

690 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

692 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

693 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

697 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (&
__ˇn˚l_buf
); \

698 dÿ{

	)

699 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (
__±hªad_unwöd_buf_t
 *
__buf
)

700 
__˛ónup_f˘_©åibuã
;

705 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

708 
	`__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (&
__ˇn˚l_buf
); \

709 i‡(
execuã
) \

710 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

711 
	}
} 0)

	)

712 
	$__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (
__±hªad_unwöd_buf_t
 *
__buf
)

713 
__˛ónup_f˘_©åibuã
;

717 
	$__±hªad_unwöd_√xt
 (
__±hªad_unwöd_buf_t
 *
__buf
)

718 
__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

719 #i‚de‡
SHARED


720 
	`__©åibuã__
 ((
__wók__
))

726 
__jmp_buf_èg
;

727 
	$__sig£tjmp
 (
__jmp_buf_èg
 *
__ív
, 
__ßvemask
Ë
__THROW
;

733 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

734 
__c⁄°
 
±hªad_muãx©å_t
 *
__muãx©å
)

735 
__THROW
 
	`__n⁄nuŒ
 ((1));

738 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
)

739 
__THROW
 
	`__n⁄nuŒ
 ((1));

742 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
)

743 
__THROW
 
	`__n⁄nuŒ
 ((1));

746 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
)

747 
__THROW
 
	`__n⁄nuŒ
 ((1));

749 #ifde‡
__USE_XOPEN2K


751 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

752 
__c⁄°
 
time•ec
 *
__ª°ri˘


753 
__ab°ime
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

757 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
)

758 
__THROW
 
	`__n⁄nuŒ
 ((1));

762 
	$±hªad_muãx_gë¥io˚ûög
 (
__c⁄°
 
±hªad_muãx_t
 *

763 
__ª°ri˘
 
__muãx
,

764 *
__ª°ri˘
 
__¥io˚ûög
)

765 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

769 
	$±hªad_muãx_£çrio˚ûög
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

770 
__¥io˚ûög
,

771 *
__ª°ri˘
 
__ﬁd_˚ûög
)

772 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

775 #ifde‡
__USE_XOPEN2K8


777 
	$±hªad_muãx_c⁄si°ít
 (
±hªad_muãx_t
 *
__muãx
)

778 
__THROW
 
	`__n⁄nuŒ
 ((1));

779 #ifde‡
__USE_GNU


780 
	$±hªad_muãx_c⁄si°ít_≈
 (
±hªad_muãx_t
 *
__muãx
)

781 
__THROW
 
	`__n⁄nuŒ
 ((1));

790 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
)

791 
__THROW
 
	`__n⁄nuŒ
 ((1));

794 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
)

795 
__THROW
 
	`__n⁄nuŒ
 ((1));

798 
	$±hªad_muãx©å_gëpsh¨ed
 (
__c⁄°
 
±hªad_muãx©å_t
 *

799 
__ª°ri˘
 
__©å
,

800 *
__ª°ri˘
 
__psh¨ed
)

801 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

804 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 *
__©å
,

805 
__psh¨ed
)

806 
__THROW
 
	`__n⁄nuŒ
 ((1));

808 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


810 
	$±hªad_muãx©å_gëty≥
 (
__c⁄°
 
±hªad_muãx©å_t
 *
__ª°ri˘


811 
__©å
, *
__ª°ri˘
 
__köd
)

812 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

817 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
, 
__köd
)

818 
__THROW
 
	`__n⁄nuŒ
 ((1));

822 
	$±hªad_muãx©å_gë¥Ÿocﬁ
 (
__c⁄°
 
±hªad_muãx©å_t
 *

823 
__ª°ri˘
 
__©å
,

824 *
__ª°ri˘
 
__¥Ÿocﬁ
)

825 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

829 
	$±hªad_muãx©å_£çrŸocﬁ
 (
±hªad_muãx©å_t
 *
__©å
,

830 
__¥Ÿocﬁ
)

831 
__THROW
 
	`__n⁄nuŒ
 ((1));

834 
	$±hªad_muãx©å_gë¥io˚ûög
 (
__c⁄°
 
±hªad_muãx©å_t
 *

835 
__ª°ri˘
 
__©å
,

836 *
__ª°ri˘
 
__¥io˚ûög
)

837 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

840 
	$±hªad_muãx©å_£çrio˚ûög
 (
±hªad_muãx©å_t
 *
__©å
,

841 
__¥io˚ûög
)

842 
__THROW
 
	`__n⁄nuŒ
 ((1));

844 #ifde‡
__USE_XOPEN2K


846 
	$±hªad_muãx©å_gërobu°
 (
__c⁄°
 
±hªad_muãx©å_t
 *
__©å
,

847 *
__robu°√ss
)

848 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

849 #ifde‡
__USE_GNU


850 
	$±hªad_muãx©å_gërobu°_≈
 (
__c⁄°
 
±hªad_muãx©å_t
 *
__©å
,

851 *
__robu°√ss
)

852 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

856 
	$±hªad_muãx©å_£åobu°
 (
±hªad_muãx©å_t
 *
__©å
,

857 
__robu°√ss
)

858 
__THROW
 
	`__n⁄nuŒ
 ((1));

859 #ifde‡
__USE_GNU


860 
	$±hªad_muãx©å_£åobu°_≈
 (
±hªad_muãx©å_t
 *
__©å
,

861 
__robu°√ss
)

862 
__THROW
 
	`__n⁄nuŒ
 ((1));

867 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


872 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

873 
__c⁄°
 
±hªad_rwlock©å_t
 *
__ª°ri˘


874 
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

877 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
)

878 
__THROW
 
	`__n⁄nuŒ
 ((1));

881 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

882 
__THROW
 
	`__n⁄nuŒ
 ((1));

885 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

886 
__THROW
 
	`__n⁄nuŒ
 ((1));

888 #ifde‡
__USE_XOPEN2K


890 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

891 
__c⁄°
 
time•ec
 *
__ª°ri˘


892 
__ab°ime
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

896 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
)

897 
__THROW
 
	`__n⁄nuŒ
 ((1));

900 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1));

903 #ifde‡
__USE_XOPEN2K


905 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

906 
__c⁄°
 
time•ec
 *
__ª°ri˘


907 
__ab°ime
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

911 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
)

912 
__THROW
 
	`__n⁄nuŒ
 ((1));

918 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 *
__©å
)

919 
__THROW
 
	`__n⁄nuŒ
 ((1));

922 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 *
__©å
)

923 
__THROW
 
	`__n⁄nuŒ
 ((1));

926 
	$±hªad_rwlock©å_gëpsh¨ed
 (
__c⁄°
 
±hªad_rwlock©å_t
 *

927 
__ª°ri˘
 
__©å
,

928 *
__ª°ri˘
 
__psh¨ed
)

929 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

932 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 *
__©å
,

933 
__psh¨ed
)

934 
__THROW
 
	`__n⁄nuŒ
 ((1));

937 
	$±hªad_rwlock©å_gëköd_≈
 (
__c⁄°
 
±hªad_rwlock©å_t
 *

938 
__ª°ri˘
 
__©å
,

939 *
__ª°ri˘
 
__¥ef
)

940 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

943 
	$±hªad_rwlock©å_£tköd_≈
 (
±hªad_rwlock©å_t
 *
__©å
,

944 
__¥ef
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

952 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

953 
__c⁄°
 
±hªad_c⁄d©å_t
 *
__ª°ri˘


954 
__c⁄d_©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

957 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 *
__c⁄d
)

958 
__THROW
 
	`__n⁄nuŒ
 ((1));

961 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 *
__c⁄d
)

962 
__THROW
 
	`__n⁄nuŒ
 ((1));

965 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 *
__c⁄d
)

966 
__THROW
 
	`__n⁄nuŒ
 ((1));

973 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

974 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
)

975 
	`__n⁄nuŒ
 ((1, 2));

984 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

985 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

986 
__c⁄°
 
time•ec
 *
__ª°ri˘


987 
__ab°ime
Ë
	`__n⁄nuŒ
 ((1, 2, 3));

992 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 *
__©å
)

993 
__THROW
 
	`__n⁄nuŒ
 ((1));

996 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 *
__©å
)

997 
__THROW
 
	`__n⁄nuŒ
 ((1));

1000 
	$±hªad_c⁄d©å_gëpsh¨ed
 (
__c⁄°
 
±hªad_c⁄d©å_t
 *

1001 
__ª°ri˘
 
__©å
,

1002 *
__ª°ri˘
 
__psh¨ed
)

1003 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1006 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 *
__©å
,

1007 
__psh¨ed
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1009 #ifde‡
__USE_XOPEN2K


1011 
	$±hªad_c⁄d©å_gë˛ock
 (
__c⁄°
 
±hªad_c⁄d©å_t
 *

1012 
__ª°ri˘
 
__©å
,

1013 
__˛ockid_t
 *
__ª°ri˘
 
__˛ock_id
)

1014 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1017 
	$±hªad_c⁄d©å_£t˛ock
 (
±hªad_c⁄d©å_t
 *
__©å
,

1018 
__˛ockid_t
 
__˛ock_id
)

1019 
__THROW
 
	`__n⁄nuŒ
 ((1));

1023 #ifde‡
__USE_XOPEN2K


1028 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 *
__lock
, 
__psh¨ed
)

1029 
__THROW
 
	`__n⁄nuŒ
 ((1));

1032 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 *
__lock
)

1033 
__THROW
 
	`__n⁄nuŒ
 ((1));

1036 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 *
__lock
)

1037 
__THROW
 
	`__n⁄nuŒ
 ((1));

1040 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 *
__lock
)

1041 
__THROW
 
	`__n⁄nuŒ
 ((1));

1044 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 *
__lock
)

1045 
__THROW
 
	`__n⁄nuŒ
 ((1));

1052 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 *
__ª°ri˘
 
__b¨rõr
,

1053 
__c⁄°
 
±hªad_b¨rõøâr_t
 *
__ª°ri˘


1054 
__©å
, 
__cou¡
)

1055 
__THROW
 
	`__n⁄nuŒ
 ((1));

1058 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1059 
__THROW
 
	`__n⁄nuŒ
 ((1));

1062 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1063 
__THROW
 
	`__n⁄nuŒ
 ((1));

1067 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1068 
__THROW
 
	`__n⁄nuŒ
 ((1));

1071 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1072 
__THROW
 
	`__n⁄nuŒ
 ((1));

1075 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (
__c⁄°
 
±hªad_b¨rõøâr_t
 *

1076 
__ª°ri˘
 
__©å
,

1077 *
__ª°ri˘
 
__psh¨ed
)

1078 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1081 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 *
__©å
,

1082 
__psh¨ed
)

1083 
__THROW
 
	`__n⁄nuŒ
 ((1));

1095 
	`±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

1096 (*
__de°r_fun˘i⁄
) (*))

1097 
__THROW
 
	`__n⁄nuŒ
 ((1));

1100 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1103 *
	$±hªad_gë•ecific
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1106 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

1107 
__c⁄°
 *
__poöãr
Ë
__THROW
 ;

1110 #ifde‡
__USE_XOPEN2K


1112 
	$±hªad_gë˝u˛ockid
 (
±hªad_t
 
__thªad_id
,

1113 
__˛ockid_t
 *
__˛ock_id
)

1114 
__THROW
 
	`__n⁄nuŒ
 ((2));

1129 
	`±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1130 (*
__∑ª¡
) (),

1131 (*
__chûd
Ë()Ë
__THROW
;

1134 #ifde‡
__USE_EXTERN_INLINES


1136 
__exã∫_ölöe
 

1137 
	`__NTH
 (
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
))

1139  
__thªad1
 =
__thªad2
;

1140 
	}
}

1143 
	g__END_DECLS


	@/usr/include/regex.h

22 #i‚de‡
_REGEX_H


23 
	#_REGEX_H
 1

	)

25 
	~<sys/ty≥s.h
>

26 
	~<gnu/›ti⁄-groups.h
>

29 #ifde‡
__˝lu•lus


37 
	ts_ªg_t
;

38 
	ta˘ive_ªg_t
;

45 
	tªg_sy¡ax_t
;

47 #ifde‡
__USE_GNU


50 
	#RE_BACKSLASH_ESCAPE_IN_LISTS
 ((Ë1)

	)

55 
	#RE_BK_PLUS_QM
 (
RE_BACKSLASH_ESCAPE_IN_LISTS
 << 1)

	)

61 
	#RE_CHAR_CLASSES
 (
RE_BK_PLUS_QM
 << 1)

	)

75 
	#RE_CONTEXT_INDEP_ANCHORS
 (
RE_CHAR_CLASSES
 << 1)

	)

83 
	#RE_CONTEXT_INDEP_OPS
 (
RE_CONTEXT_INDEP_ANCHORS
 << 1)

	)

87 
	#RE_CONTEXT_INVALID_OPS
 (
RE_CONTEXT_INDEP_OPS
 << 1)

	)

91 
	#RE_DOT_NEWLINE
 (
RE_CONTEXT_INVALID_OPS
 << 1)

	)

95 
	#RE_DOT_NOT_NULL
 (
RE_DOT_NEWLINE
 << 1)

	)

99 
	#RE_HAT_LISTS_NOT_NEWLINE
 (
RE_DOT_NOT_NULL
 << 1)

	)

104 
	#RE_INTERVALS
 (
RE_HAT_LISTS_NOT_NEWLINE
 << 1)

	)

108 
	#RE_LIMITED_OPS
 (
RE_INTERVALS
 << 1)

	)

112 
	#RE_NEWLINE_ALT
 (
RE_LIMITED_OPS
 << 1)

	)

117 
	#RE_NO_BK_BRACES
 (
RE_NEWLINE_ALT
 << 1)

	)

121 
	#RE_NO_BK_PARENS
 (
RE_NO_BK_BRACES
 << 1)

	)

125 
	#RE_NO_BK_REFS
 (
RE_NO_BK_PARENS
 << 1)

	)

129 
	#RE_NO_BK_VBAR
 (
RE_NO_BK_REFS
 << 1)

	)

135 
	#RE_NO_EMPTY_RANGES
 (
RE_NO_BK_VBAR
 << 1)

	)

139 
	#RE_UNMATCHED_RIGHT_PAREN_ORD
 (
RE_NO_EMPTY_RANGES
 << 1)

	)

143 
	#RE_NO_POSIX_BACKTRACKING
 (
RE_UNMATCHED_RIGHT_PAREN_ORD
 << 1)

	)

147 
	#RE_NO_GNU_OPS
 (
RE_NO_POSIX_BACKTRACKING
 << 1)

	)

155 
	#RE_DEBUG
 (
RE_NO_GNU_OPS
 << 1)

	)

160 
	#RE_INVALID_INTERVAL_ORD
 (
RE_DEBUG
 << 1)

	)

163 #ifde‡
__OPTION_POSIX_REGEXP_GLIBC


166 
	#RE_ICASE
 (
RE_INVALID_INTERVAL_ORD
 << 1)

	)

171 
	#RE_CARET_ANCHORS_HERE
 (
RE_ICASE
 << 1)

	)

175 
	#RE_CONTEXT_INVALID_DUP
 (
RE_CARET_ANCHORS_HERE
 << 1)

	)

179 
	#RE_NO_SUB
 (
RE_CONTEXT_INVALID_DUP
 << 1)

	)

187 
ªg_sy¡ax_t
 
ª_sy¡ax_›ti⁄s
;

189 #ifde‡
__USE_GNU


194 
	#RE_SYNTAX_EMACS
 0

	)

196 
	#RE_SYNTAX_AWK
 \

197 (
RE_BACKSLASH_ESCAPE_IN_LISTS
 | 
RE_DOT_NOT_NULL
 \

198 | 
RE_NO_BK_PARENS
 | 
RE_NO_BK_REFS
 \

199 | 
RE_NO_BK_VBAR
 | 
RE_NO_EMPTY_RANGES
 \

200 | 
RE_DOT_NEWLINE
 | 
RE_CONTEXT_INDEP_ANCHORS
 \

201 | 
RE_UNMATCHED_RIGHT_PAREN_ORD
 | 
RE_NO_GNU_OPS
)

	)

203 
	#RE_SYNTAX_GNU_AWK
 \

204 ((
RE_SYNTAX_POSIX_EXTENDED
 | 
RE_BACKSLASH_ESCAPE_IN_LISTS
 | 
RE_DEBUG
) \

205 & ~(
RE_DOT_NOT_NULL
 | 
RE_INTERVALS
 | 
RE_CONTEXT_INDEP_OPS
 \

206 | 
RE_CONTEXT_INVALID_OPS
 ))

	)

208 
	#RE_SYNTAX_POSIX_AWK
 \

209 (
RE_SYNTAX_POSIX_EXTENDED
 | 
RE_BACKSLASH_ESCAPE_IN_LISTS
 \

210 | 
RE_INTERVALS
 | 
RE_NO_GNU_OPS
)

	)

212 
	#RE_SYNTAX_GREP
 \

213 (
RE_BK_PLUS_QM
 | 
RE_CHAR_CLASSES
 \

214 | 
RE_HAT_LISTS_NOT_NEWLINE
 | 
RE_INTERVALS
 \

215 | 
RE_NEWLINE_ALT
)

	)

217 
	#RE_SYNTAX_EGREP
 \

218 (
RE_CHAR_CLASSES
 | 
RE_CONTEXT_INDEP_ANCHORS
 \

219 | 
RE_CONTEXT_INDEP_OPS
 | 
RE_HAT_LISTS_NOT_NEWLINE
 \

220 | 
RE_NEWLINE_ALT
 | 
RE_NO_BK_PARENS
 \

221 | 
RE_NO_BK_VBAR
)

	)

223 
	#RE_SYNTAX_POSIX_EGREP
 \

224 (
RE_SYNTAX_EGREP
 | 
RE_INTERVALS
 | 
RE_NO_BK_BRACES
 \

225 | 
RE_INVALID_INTERVAL_ORD
)

	)

228 
	#RE_SYNTAX_ED
 
RE_SYNTAX_POSIX_BASIC


	)

230 
	#RE_SYNTAX_SED
 
RE_SYNTAX_POSIX_BASIC


	)

233 
	#_RE_SYNTAX_POSIX_COMMON
 \

234 (
RE_CHAR_CLASSES
 | 
RE_DOT_NEWLINE
 | 
RE_DOT_NOT_NULL
 \

235 | 
RE_INTERVALS
 | 
RE_NO_EMPTY_RANGES
)

	)

237 #ifde‡
__OPTION_POSIX_REGEXP_GLIBC


238 
	#RE_SYNTAX_POSIX_BASIC
 \

239 (
_RE_SYNTAX_POSIX_COMMON
 | 
RE_BK_PLUS_QM
 | 
RE_CONTEXT_INVALID_DUP
)

	)

241 
	#RE_SYNTAX_POSIX_BASIC
 \

242 (
_RE_SYNTAX_POSIX_COMMON
 | 
RE_BK_PLUS_QM
)

	)

248 
	#RE_SYNTAX_POSIX_MINIMAL_BASIC
 \

249 (
_RE_SYNTAX_POSIX_COMMON
 | 
RE_LIMITED_OPS
)

	)

251 
	#RE_SYNTAX_POSIX_EXTENDED
 \

252 (
_RE_SYNTAX_POSIX_COMMON
 | 
RE_CONTEXT_INDEP_ANCHORS
 \

253 | 
RE_CONTEXT_INDEP_OPS
 | 
RE_NO_BK_BRACES
 \

254 | 
RE_NO_BK_PARENS
 | 
RE_NO_BK_VBAR
 \

255 | 
RE_CONTEXT_INVALID_OPS
 | 
RE_UNMATCHED_RIGHT_PAREN_ORD
)

	)

259 
	#RE_SYNTAX_POSIX_MINIMAL_EXTENDED
 \

260 (
_RE_SYNTAX_POSIX_COMMON
 | 
RE_CONTEXT_INDEP_ANCHORS
 \

261 | 
RE_CONTEXT_INVALID_OPS
 | 
RE_NO_BK_BRACES
 \

262 | 
RE_NO_BK_PARENS
 | 
RE_NO_BK_REFS
 \

263 | 
RE_NO_BK_VBAR
 | 
RE_UNMATCHED_RIGHT_PAREN_ORD
)

	)

269 #ifde‡
RE_DUP_MAX


270 #unde‡
RE_DUP_MAX


273 
	#RE_DUP_MAX
 (0x7fff)

	)

281 
	#REG_EXTENDED
 1

	)

285 
	#REG_ICASE
 (
REG_EXTENDED
 << 1)

	)

290 
	#REG_NEWLINE
 (
REG_ICASE
 << 1)

	)

294 
	#REG_NOSUB
 (
REG_NEWLINE
 << 1)

	)

304 
	#REG_NOTBOL
 1

	)

307 
	#REG_NOTEOL
 (1 << 1)

	)

309 #ifde‡
__OPTION_POSIX_REGEXP_GLIBC


312 
	#REG_STARTEND
 (1 << 2)

	)

320 #i‡
deföed
 
_XOPEN_SOURCE
 || deföed 
__USE_XOPEN2K


321 
	gREG_ENOSYS
 = -1,

324 
	gREG_NOERROR
 = 0,

325 
	gREG_NOMATCH
,

329 
	gREG_BADPAT
,

330 
	gREG_ECOLLATE
,

331 
	gREG_ECTYPE
,

332 
	gREG_EESCAPE
,

333 
	gREG_ESUBREG
,

334 
	gREG_EBRACK
,

335 
	gREG_EPAREN
,

336 
	gREG_EBRACE
,

337 
	gREG_BADBR
,

338 
	gREG_ERANGE
,

339 
	gREG_ESPACE
,

340 
	gREG_BADRPT
,

343 
	gREG_EEND
,

344 
	gREG_ESIZE
,

345 
	gREG_ERPAREN


346 } 
	tªg_îrcode_t
;

354 #i‚de‡
RE_TRANSLATE_TYPE


355 
	#__RE_TRANSLATE_TYPE
 *

	)

356 #ifde‡
__USE_GNU


357 
	#RE_TRANSLATE_TYPE
 
__RE_TRANSLATE_TYPE


	)

361 #ifde‡
__USE_GNU


362 
	#__REPB_PREFIX
(
«me
Ë
	)
name

364 
	#__REPB_PREFIX
(
«me
Ë
__
##
	)
name

367 
	sª_∑âîn_buf„r


372 *
__REPB_PREFIX
(
buf„r
);

375 
__REPB_PREFIX
(
Æloˇãd
);

378 
__REPB_PREFIX
(
u£d
);

381 
ªg_sy¡ax_t
 
__REPB_PREFIX
(
sy¡ax
);

386 *
__REPB_PREFIX
(
Á°m≠
);

392 
__RE_TRANSLATE_TYPE
 
__REPB_PREFIX
(
å™¶©e
);

395 
size_t
 
	gª_nsub
;

401 
__REPB_PREFIX
(
ˇn_be_nuŒ
) : 1;

407 #ifde‡
__USE_GNU


408 
	#REGS_UNALLOCATED
 0

	)

409 
	#REGS_REALLOCATE
 1

	)

410 
	#REGS_FIXED
 2

	)

412 
__REPB_PREFIX
(
ªgs_Æloˇãd
) : 2;

416 
__REPB_PREFIX
(
Á°m≠_accuøã
) : 1;

420 
__REPB_PREFIX
(
no_sub
) : 1;

424 
__REPB_PREFIX
(
nŸ_bﬁ
) : 1;

427 
__REPB_PREFIX
(
nŸ_eﬁ
) : 1;

430 
__REPB_PREFIX
(
√wlöe_™ch‹
) : 1;

433 
ª_∑âîn_buf„r
 
	tªgex_t
;

436 
	tªgoff_t
;

439 #ifde‡
__USE_GNU


442 
	sª_ªgi°îs


444 
	gnum_ªgs
;

445 
ªgoff_t
 *
	g°¨t
;

446 
ªgoff_t
 *
	gíd
;

453 #i‚de‡
RE_NREGS


454 
	#RE_NREGS
 30

	)

464 
ªgoff_t
 
	grm_so
;

465 
ªgoff_t
 
	grm_eo
;

466 } 
	tªgm©ch_t
;

470 #ifde‡
__USE_GNU


473 
ªg_sy¡ax_t
 
ª_£t_sy¡ax
 (ªg_sy¡ax_à
__sy¡ax
);

478 c⁄° *
ª_compûe_∑âîn
 (c⁄° *
__∑âîn
, 
size_t
 
__Àngth
,

479 
ª_∑âîn_buf„r
 *
__buf„r
);

485 
ª_compûe_Á°m≠
 (
ª_∑âîn_buf„r
 *
__buf„r
);

493 
ª_£¨ch
 (
ª_∑âîn_buf„r
 *
__buf„r
, c⁄° *
__°rög
,

494 
__Àngth
, 
__°¨t
, 
__ønge
,

495 
ª_ªgi°îs
 *
__ªgs
);

500 
ª_£¨ch_2
 (
ª_∑âîn_buf„r
 *
__buf„r
,

501 c⁄° *
__°rög1
, 
__Àngth1
,

502 c⁄° *
__°rög2
, 
__Àngth2
, 
__°¨t
,

503 
__ønge
, 
ª_ªgi°îs
 *
__ªgs
, 
__°›
);

508 
ª_m©ch
 (
ª_∑âîn_buf„r
 *
__buf„r
, c⁄° *
__°rög
,

509 
__Àngth
, 
__°¨t
, 
ª_ªgi°îs
 *
__ªgs
);

513 
ª_m©ch_2
 (
ª_∑âîn_buf„r
 *
__buf„r
,

514 c⁄° *
__°rög1
, 
__Àngth1
,

515 c⁄° *
__°rög2
, 
__Àngth2
, 
__°¨t
,

516 
ª_ªgi°îs
 *
__ªgs
, 
__°›
);

531 
ª_£t_ªgi°îs
 (
ª_∑âîn_buf„r
 *
__buf„r
,

532 
ª_ªgi°îs
 *
__ªgs
,

533 
__num_ªgs
,

534 
ªgoff_t
 *
__°¨ts
,Ñegoff_à*
__íds
);

537 #i‡
deföed
 
_REGEX_RE_COMP
 || (deföed 
_LIBC
 && deföed 
__USE_BSD
)

538 #i‚de‡
_CRAY


540 *
ª_comp
 (const *);

541 
ª_exec
 (const *);

547 #i‚de‡
__ª°ri˘


548 #i‡! (2 < 
__GNUC__
 || (2 =__GNUC__ && 95 <
__GNUC_MINOR__
))

549 #i‡
deföed
 
ª°ri˘
 || 199901L <
__STDC_VERSION__


550 
	#__ª°ri˘
 
ª°ri˘


	)

552 
	#__ª°ri˘


	)

557 #i‚de‡
__ª°ri˘_¨r


558 #i‡(
__GNUC__
 > 3 || (__GNUC__ =3 && 
__GNUC_MINOR__
 >= 1)) \

559 && !
deföed
 
	g__GNUG__


560 
	#__ª°ri˘_¨r
 
__ª°ri˘


	)

562 
	#__ª°ri˘_¨r


	)

567 
ªgcomp
 (
ªgex_t
 *
__ª°ri˘
 
__¥eg
,

568 c⁄° *
__ª°ri˘
 
__∑âîn
,

569 
__cÊags
);

571 
ªgexec
 (c⁄° 
ªgex_t
 *
__ª°ri˘
 
__¥eg
,

572 c⁄° *
__ª°ri˘
 
__°rög
, 
size_t
 
__nm©ch
,

573 
ªgm©ch_t
 
__pm©ch
[
__ª°ri˘_¨r
],

574 
__eÊags
);

576 
size_t
 
ªgîr‹
 (
__îrcode
, c⁄° 
ªgex_t
 *
__ª°ri˘
 
__¥eg
,

577 *
__ª°ri˘
 
__îrbuf
, 
size_t
 
__îrbuf_size
);

579 
ªg‰ì
 (
ªgex_t
 *
__¥eg
);

582 #ifde‡
__˝lu•lus


	@/usr/include/rpc/auth.h

38 #i‚de‡
_RPC_AUTH_H


40 
	#_RPC_AUTH_H
 1

	)

41 
	~<„©uªs.h
>

42 
	~<Ωc/xdr.h
>

44 
	g__BEGIN_DECLS


46 
	#MAX_AUTH_BYTES
 400

	)

47 
	#MAXNETNAMELEN
 255

	)

52 
	eauth_°©
 {

53 
	mAUTH_OK
=0,

57 
	mAUTH_BADCRED
=1,

58 
	mAUTH_REJECTEDCRED
=2,

59 
	mAUTH_BADVERF
=3,

60 
	mAUTH_REJECTEDVERF
=4,

61 
	mAUTH_TOOWEAK
=5,

65 
	mAUTH_INVALIDRESP
=6,

66 
	mAUTH_FAILED
=7

69 
	udes_block
 {

71 
u_öt32_t
 
	mhigh
;

72 
u_öt32_t
 
	mlow
;

73 } 
	mkey
;

74 
	mc
[8];

76 
des_block
 
	tdes_block
;

77 
boﬁ_t
 
	$xdr_des_block
 (
XDR
 *
__xdrs
, 
des_block
 *
__blkp
Ë
__THROW
;

82 
	s›aque_auth
 {

83 
íum_t
 
ﬂ_Êav‹
;

84 
ˇddr_t
 
ﬂ_ba£
;

85 
u_öt
 
ﬂ_Àngth
;

91 
AUTH
 
	tAUTH
;

92 
	sAUTH
 {

93 
›aque_auth
 
ah_¸ed
;

94 
›aque_auth
 
ah_vîf
;

95 
des_block
 
ah_key
;

96 
	sauth_›s
 {

97 (*
ah_√xtvîf
Ë(
AUTH
 *);

98 (*
ah_m¨shÆ
Ë(
AUTH
 *, 
XDR
 *);

99 (*
ah_vÆid©e
Ë(
AUTH
 *, 
›aque_auth
 *);

101 (*
ah_ª‰esh
Ë(
AUTH
 *);

102 (*
ah_de°roy
Ë(
AUTH
 *);

103 } *
ah_›s
;

104 
ˇddr_t
 
ah_¥iv©e
;

116 
	#AUTH_NEXTVERF
(
auth
) \

117 ((*((
auth
)->
ah_›s
->
ah_√xtvîf
))◊uth))

	)

118 
	#auth_√xtvîf
(
auth
) \

119 ((*((
auth
)->
ah_›s
->
ah_√xtvîf
))◊uth))

	)

121 
	#AUTH_MARSHALL
(
auth
, 
xdrs
) \

122 ((*((
auth
)->
ah_›s
->
ah_m¨shÆ
))◊uth, 
xdrs
))

	)

123 
	#auth_m¨shÆl
(
auth
, 
xdrs
) \

124 ((*((
auth
)->
ah_›s
->
ah_m¨shÆ
))◊uth, 
xdrs
))

	)

126 
	#AUTH_VALIDATE
(
auth
, 
vîÂ
) \

127 ((*((
auth
)->
ah_›s
->
ah_vÆid©e
))(◊uth), 
vîÂ
))

	)

128 
	#auth_vÆid©e
(
auth
, 
vîÂ
) \

129 ((*((
auth
)->
ah_›s
->
ah_vÆid©e
))(◊uth), 
vîÂ
))

	)

131 
	#AUTH_REFRESH
(
auth
) \

132 ((*((
auth
)->
ah_›s
->
ah_ª‰esh
))◊uth))

	)

133 
	#auth_ª‰esh
(
auth
) \

134 ((*((
auth
)->
ah_›s
->
ah_ª‰esh
))◊uth))

	)

136 
	#AUTH_DESTROY
(
auth
) \

137 ((*((
auth
)->
ah_›s
->
ah_de°roy
))◊uth))

	)

138 
	#auth_de°roy
(
auth
) \

139 ((*((
auth
)->
ah_›s
->
ah_de°roy
))◊uth))

	)

142 
›aque_auth
 
_nuŒ_auth
;

158 
AUTH
 *
	`authunix_¸óã
 (*
__mach«me
, 
__uid_t
 
__uid
, 
__gid_t
 
__gid
,

159 
__Àn
, 
__gid_t
 *
__aup_gids
);

160 
AUTH
 *
	`authunix_¸óã_deÁu…
 ();

161 
AUTH
 *
	$authn⁄e_¸óã
 (Ë
__THROW
;

162 
AUTH
 *
	$authdes_¸óã
 (c⁄° *
__£rvî«me
, 
u_öt
 
__wödow
,

163 
sockaddr
 *
__synˇddr
, 
des_block
 *
__ckey
)

164 
__THROW
;

165 
AUTH
 *
	$authdes_pk_¸óã
 (c⁄° *, 
√tobj
 *, 
u_öt
,

166 
sockaddr
 *, 
des_block
 *Ë
__THROW
;

169 
	#AUTH_NONE
 0

	)

170 
	#AUTH_NULL
 0

	)

171 
	#AUTH_SYS
 1

	)

172 
	#AUTH_UNIX
 
AUTH_SYS


	)

173 
	#AUTH_SHORT
 2

	)

174 
	#AUTH_DES
 3

	)

175 
	#AUTH_DH
 
AUTH_DES


	)

176 
	#AUTH_KERB
 4

	)

182 
	$gë√äame
 (*Ë
__THROW
;

183 
	$ho°2√äame
 (*, 
__c⁄°
 *, __c⁄° *Ë
__THROW
;

184 
	$u£r2√äame
 (*, 
__c⁄°
 
uid_t
, __c⁄° *Ë
__THROW
;

185 
	$√äame2u£r
 (
__c⁄°
 *, 
uid_t
 *, 
gid_t
 *, *, gid_t *)

186 
__THROW
;

187 
	$√äame2ho°
 (
__c⁄°
 *, *, __c⁄° Ë
__THROW
;

194 
	`key_de¸y±£ssi⁄
 (*, 
des_block
 *);

195 
	`key_de¸y±£ssi⁄_pk
 (*, 
√tobj
 *, 
des_block
 *);

196 
	`key_í¸y±£ssi⁄
 (*, 
des_block
 *);

197 
	`key_í¸y±£ssi⁄_pk
 (*, 
√tobj
 *, 
des_block
 *);

198 
	`key_gídes
 (
des_block
 *);

199 
	`key_£t£¸ë
 (*);

200 
	`key_£¸ëkey_is_£t
 ();

201 
	`key_gë_c⁄v
 (*, 
des_block
 *);

206 
boﬁ_t
 
	$xdr_›aque_auth
 (
XDR
 *, 
›aque_auth
 *Ë
__THROW
;

208 
__END_DECLS


	@/usr/include/rpc/rpc.h

35 #i‚de‡
_RPC_RPC_H


36 
	#_RPC_RPC_H
 1

	)

38 
	~<Ωc/ty≥s.h
>

39 
	~<√töë/ö.h
>

42 
	~<Ωc/xdr.h
>

45 
	~<Ωc/auth.h
>

48 
	~<Ωc/˛¡.h
>

51 
	~<Ωc/Ωc_msg.h
>

52 
	~<Ωc/auth_unix.h
>

53 
	~<Ωc/auth_des.h
>

56 
	~<Ωc/svc.h
>

57 
	~<Ωc/svc_auth.h
>

65 
	~<Ωc/√tdb.h
>

67 
__BEGIN_DECLS


70 
fd_£t
 *
	$__Ωc_thªad_svc_fd£t
 (Ë
	`__©åibuã__
 ((
__c⁄°__
));

71 
	#svc_fd£t
 (*
	`__Ωc_thªad_svc_fd£t
 ())

	)

73 
Ωc_¸óãîr
 *
	$__Ωc_thªad_¸óãîr
 ()

74 
	`__©åibuã__
 ((
__c⁄°__
));

75 
	#gë_Ωc_¸óãîr
(Ë(*
	`__Ωc_thªad_¸óãîr
 ())

	)

81 #ifde‡
_RPC_MT_VARS


82 
	#Ωc_¸óãîr
 (*
	`__Ωc_thªad_¸óãîr
 ())

	)

85 
pﬁlfd
 **
	$__Ωc_thªad_svc_pﬁlfd
 ()

86 
	`__©åibuã__
 ((
__c⁄°__
));

87 
	#svc_pﬁlfd
 (*
	`__Ωc_thªad_svc_pﬁlfd
 ())

	)

89 *
	$__Ωc_thªad_svc_max_pﬁlfd
 (Ë
	`__©åibuã__
 ((
__c⁄°__
));

90 
	#svc_max_pﬁlfd
 (*
	`__Ωc_thªad_svc_max_pﬁlfd
 ())

	)

92 
__END_DECLS


	@/usr/include/rpc/rpc_msg.h

35 #i‚de‡
_RPC_MSG_H


36 
	#_RPC_MSG_H
 1

	)

38 
	~<sys/cdefs.h
>

40 
	~<Ωc/xdr.h
>

41 
	~<Ωc/˛¡.h
>

43 
	#RPC_MSG_VERSION
 ((
u_l⁄g
Ë2)

	)

44 
	#RPC_SERVICE_PORT
 ((
u_sh‹t
Ë2048)

	)

46 
__BEGIN_DECLS


54 
	emsg_ty≥
 {

55 
	mCALL
=0,

56 
	mREPLY
=1

59 
	eª∂y_°©
 {

60 
	mMSG_ACCEPTED
=0,

61 
	mMSG_DENIED
=1

64 
	eac˚±_°©
 {

65 
	mSUCCESS
=0,

66 
	mPROG_UNAVAIL
=1,

67 
	mPROG_MISMATCH
=2,

68 
	mPROC_UNAVAIL
=3,

69 
	mGARBAGE_ARGS
=4,

70 
	mSYSTEM_ERR
=5

73 
	eªje˘_°©
 {

74 
	mRPC_MISMATCH
=0,

75 
	mAUTH_ERROR
=1

87 
	sac˚±ed_ª∂y
 {

88 
›aque_auth
 
	m¨_vîf
;

89 
ac˚±_°©
 
	m¨_°©
;

92 
u_l⁄g
 
	mlow
;

93 
u_l⁄g
 
	mhigh
;

94 } 
	mAR_vîsi⁄s
;

96 
ˇddr_t
 
	mwhîe
;

97 
xdΩroc_t
 
	m¥oc
;

98 } 
	mAR_ªsu…s
;

100 } 
	mru
;

101 
	#¨_ªsu…s
 
ru
.
AR_ªsu…s


	)

102 
	#¨_vîs
 
ru
.
AR_vîsi⁄s


	)

108 
	sªje˘ed_ª∂y
 {

109 
ªje˘_°©
 
	mrj_°©
;

112 
u_l⁄g
 
	mlow
;

113 
u_l⁄g
 
	mhigh
;

114 } 
	mRJ_vîsi⁄s
;

115 
auth_°©
 
	mRJ_why
;

116 } 
	mru
;

117 
	#rj_vîs
 
ru
.
RJ_vîsi⁄s


	)

118 
	#rj_why
 
ru
.
RJ_why


	)

124 
	sª∂y_body
 {

125 
ª∂y_°©
 
	mΩ_°©
;

127 
ac˚±ed_ª∂y
 
	mRP_¨
;

128 
ªje˘ed_ª∂y
 
	mRP_dr
;

129 } 
	mru
;

130 
	#Ω_a˝t
 
ru
.
RP_¨


	)

131 
	#Ω_rj˘
 
ru
.
RP_dr


	)

137 
	sˇŒ_body
 {

138 
u_l⁄g
 
	mcb_Ωcvîs
;

139 
u_l⁄g
 
	mcb_¥og
;

140 
u_l⁄g
 
	mcb_vîs
;

141 
u_l⁄g
 
	mcb_¥oc
;

142 
›aque_auth
 
	mcb_¸ed
;

143 
›aque_auth
 
	mcb_vîf
;

149 
	sΩc_msg
 {

150 
u_l⁄g
 
	mrm_xid
;

151 
msg_ty≥
 
	mrm_dúe˘i⁄
;

153 
ˇŒ_body
 
	mRM_cmb
;

154 
ª∂y_body
 
	mRM_rmb
;

155 } 
	mru
;

156 
	#rm_ˇŒ
 
ru
.
RM_cmb


	)

157 
	#rm_ª∂y
 
ru
.
RM_rmb


	)

159 
	#a˝ãd_Ωly
 
ru
.
RM_rmb
.ru.
RP_¨


	)

160 
	#rj˘ed_Ωly
 
ru
.
RM_rmb
.ru.
RP_dr


	)

169 
boﬁ_t
 
	$xdr_ˇŒmsg
 (
XDR
 *
__xdrs
, 
Ωc_msg
 *
__cmsg
Ë
__THROW
;

177 
boﬁ_t
 
	$xdr_ˇŒhdr
 (
XDR
 *
__xdrs
, 
Ωc_msg
 *
__cmsg
Ë
__THROW
;

185 
boﬁ_t
 
	$xdr_ª∂ymsg
 (
XDR
 *
__xdrs
, 
Ωc_msg
 *
__rmsg
Ë
__THROW
;

193 
	$_£ãº_ª∂y
 (
Ωc_msg
 *
__msg
, 
Ωc_îr
 *
__îr‹
)

194 
__THROW
;

196 
__END_DECLS


	@/usr/include/rpc/xdr.h

34 #i‚de‡
_RPC_XDR_H


35 
	#_RPC_XDR_H
 1

	)

37 
	~<„©uªs.h
>

38 
	~<sys/ty≥s.h
>

39 
	~<Ωc/ty≥s.h
>

42 
	~<°dio.h
>

44 
__BEGIN_DECLS


81 
	exdr_›
 {

82 
	mXDR_ENCODE
 = 0,

83 
	mXDR_DECODE
 = 1,

84 
	mXDR_FREE
 = 2

90 
	#BYTES_PER_XDR_UNIT
 (4)

	)

97 
	#RNDUP
(
x
Ë(((xË+ 
BYTES_PER_XDR_UNIT
 - 1Ë& ~(BYTES_PER_XDR_UNIT - 1))

	)

99 
	#RNDUP
(
x
Ë((((xË+ 
BYTES_PER_XDR_UNIT
 - 1) / BYTES_PER_XDR_UNIT) \

100 * 
BYTES_PER_XDR_UNIT
)

	)

109 
XDR
 
	tXDR
;

110 
	sXDR


112 
xdr_›
 
	mx_›
;

113 
	sxdr_›s


115 
boﬁ_t
 (*
x_gël⁄g
Ë(
XDR
 *
	m__xdrs
, *
	m__Õ
);

117 
boﬁ_t
 (*
x_pué⁄g
Ë(
XDR
 *
	m__xdrs
, 
__c⁄°
 *
	m__Õ
);

119 
boﬁ_t
 (*
x_gëbyãs
Ë(
XDR
 *
	m__xdrs
, 
ˇddr_t
 
	m__addr
, 
u_öt
 
	m__Àn
);

121 
boﬁ_t
 (*
x_putbyãs
Ë(
XDR
 *
	m__xdrs
, 
__c⁄°
 *
	m__addr
, 
u_öt
 
	m__Àn
);

123 
u_öt
 (*
x_gëpo°n
Ë(
__c⁄°
 
XDR
 *
	m__xdrs
);

125 
boﬁ_t
 (*
x_£ço°n
Ë(
XDR
 *
	m__xdrs
, 
u_öt
 
	m__pos
);

127 
	möt32_t
 *(*
	mx_ölöe
Ë(
XDR
 *
	m__xdrs
, 
u_öt
 
	m__Àn
);

129 (*
	mx_de°roy
Ë(
XDR
 *
	m__xdrs
);

131 
boﬁ_t
 (*
x_gëöt32
Ë(
XDR
 *
	m__xdrs
, 
öt32_t
 *
	m__ù
);

133 
boﬁ_t
 (*
x_putöt32
Ë(
XDR
 *
	m__xdrs
, 
__c⁄°
 
öt32_t
 *
	m__ù
);

136 *
	mx_›s
;

137 
ˇddr_t
 
	mx_public
;

138 
ˇddr_t
 
	mx_¥iv©e
;

139 
ˇddr_t
 
	mx_ba£
;

140 
u_öt
 
	mx_h™dy
;

152 
	$boﬁ_t
 (*
	txdΩroc_t
Ë(
	tXDR
 *, *,...);

165 
	#XDR_GETINT32
(
xdrs
, 
öt32p
) \

166 (*(
xdrs
)->
x_›s
->
x_gëöt32
)(xdrs, 
öt32p
)

	)

167 
	#xdr_gëöt32
(
xdrs
, 
öt32p
) \

168 (*(
xdrs
)->
x_›s
->
x_gëöt32
)(xdrs, 
öt32p
)

	)

170 
	#XDR_PUTINT32
(
xdrs
, 
öt32p
) \

171 (*(
xdrs
)->
x_›s
->
x_putöt32
)(xdrs, 
öt32p
)

	)

172 
	#xdr_putöt32
(
xdrs
, 
öt32p
) \

173 (*(
xdrs
)->
x_›s
->
x_putöt32
)(xdrs, 
öt32p
)

	)

175 
	#XDR_GETLONG
(
xdrs
, 
l⁄gp
) \

176 (*(
xdrs
)->
x_›s
->
x_gël⁄g
)(xdrs, 
l⁄gp
)

	)

177 
	#xdr_gël⁄g
(
xdrs
, 
l⁄gp
) \

178 (*(
xdrs
)->
x_›s
->
x_gël⁄g
)(xdrs, 
l⁄gp
)

	)

180 
	#XDR_PUTLONG
(
xdrs
, 
l⁄gp
) \

181 (*(
xdrs
)->
x_›s
->
x_pué⁄g
)(xdrs, 
l⁄gp
)

	)

182 
	#xdr_pué⁄g
(
xdrs
, 
l⁄gp
) \

183 (*(
xdrs
)->
x_›s
->
x_pué⁄g
)(xdrs, 
l⁄gp
)

	)

185 
	#XDR_GETBYTES
(
xdrs
, 
addr
, 
Àn
) \

186 (*(
xdrs
)->
x_›s
->
x_gëbyãs
)(xdrs, 
addr
, 
Àn
)

	)

187 
	#xdr_gëbyãs
(
xdrs
, 
addr
, 
Àn
) \

188 (*(
xdrs
)->
x_›s
->
x_gëbyãs
)(xdrs, 
addr
, 
Àn
)

	)

190 
	#XDR_PUTBYTES
(
xdrs
, 
addr
, 
Àn
) \

191 (*(
xdrs
)->
x_›s
->
x_putbyãs
)(xdrs, 
addr
, 
Àn
)

	)

192 
	#xdr_putbyãs
(
xdrs
, 
addr
, 
Àn
) \

193 (*(
xdrs
)->
x_›s
->
x_putbyãs
)(xdrs, 
addr
, 
Àn
)

	)

195 
	#XDR_GETPOS
(
xdrs
) \

196 (*(
xdrs
)->
x_›s
->
x_gëpo°n
)(xdrs)

	)

197 
	#xdr_gëpos
(
xdrs
) \

198 (*(
xdrs
)->
x_›s
->
x_gëpo°n
)(xdrs)

	)

200 
	#XDR_SETPOS
(
xdrs
, 
pos
) \

201 (*(
xdrs
)->
x_›s
->
x_£ço°n
)(xdrs, 
pos
)

	)

202 
	#xdr_£ços
(
xdrs
, 
pos
) \

203 (*(
xdrs
)->
x_›s
->
x_£ço°n
)(xdrs, 
pos
)

	)

205 
	#XDR_INLINE
(
xdrs
, 
Àn
) \

206 (*(
xdrs
)->
x_›s
->
x_ölöe
)(xdrs, 
Àn
)

	)

207 
	#xdr_ölöe
(
xdrs
, 
Àn
) \

208 (*(
xdrs
)->
x_›s
->
x_ölöe
)(xdrs, 
Àn
)

	)

210 
	#XDR_DESTROY
(
xdrs
) \

212 i‡((
xdrs
)->
x_›s
->
x_de°roy
) \

213 (*(
xdrs
)->
x_›s
->
x_de°roy
)(xdrs); \

214 
	}
} 0)

	)

215 
	#xdr_de°roy
(
xdrs
) \

217 i‡((
xdrs
)->
x_›s
->
x_de°roy
) \

218 (*(
xdrs
)->
x_›s
->
x_de°roy
)(xdrs); \

219 } 0)

	)

231 
	#NULL_xdΩroc_t
 ((
xdΩroc_t
)0)

	)

232 
	sxdr_dis¸im


234 
	mvÆue
;

235 
xdΩroc_t
 
	m¥oc
;

254 
	#IXDR_GET_INT32
(
buf
Ë((
öt32_t
)
	`¡ohl
((
uöt32_t
)*(buf)++))

	)

255 
	#IXDR_PUT_INT32
(
buf
, 
v
Ë(*(buf)++ = (
öt32_t
)
	`ht⁄l
((
uöt32_t
)(v)))

	)

256 
	#IXDR_GET_U_INT32
(
buf
Ë((
uöt32_t
)
	`IXDR_GET_INT32
(buf))

	)

257 
	#IXDR_PUT_U_INT32
(
buf
, 
v
Ë
	`IXDR_PUT_INT32
(buf, (
öt32_t
)(v))

	)

263 
	#IXDR_GET_LONG
(
buf
Ë(()
	`IXDR_GET_U_INT32
(buf))

	)

264 
	#IXDR_PUT_LONG
(
buf
, 
v
Ë(()
	`IXDR_PUT_INT32
(buf, ()(v)))

	)

265 
	#IXDR_GET_U_LONG
(
buf
Ë((
u_l⁄g
)
	`IXDR_GET_LONG
(buf))

	)

266 
	#IXDR_PUT_U_LONG
(
buf
, 
v
Ë
	`IXDR_PUT_LONG
(buf, ()(v))

	)

269 
	#IXDR_GET_BOOL
(
buf
Ë((
boﬁ_t
)
	`IXDR_GET_LONG
(buf))

	)

270 
	#IXDR_GET_ENUM
(
buf
, 
t
Ë(—)
	`IXDR_GET_LONG
(buf))

	)

271 
	#IXDR_GET_SHORT
(
buf
Ë(()
	`IXDR_GET_LONG
(buf))

	)

272 
	#IXDR_GET_U_SHORT
(
buf
Ë((
u_sh‹t
)
	`IXDR_GET_LONG
(buf))

	)

274 
	#IXDR_PUT_BOOL
(
buf
, 
v
Ë
	`IXDR_PUT_LONG
(buf, ()(v))

	)

275 
	#IXDR_PUT_ENUM
(
buf
, 
v
Ë
	`IXDR_PUT_LONG
(buf, ()(v))

	)

276 
	#IXDR_PUT_SHORT
(
buf
, 
v
Ë
	`IXDR_PUT_LONG
(buf, ()(v))

	)

277 
	#IXDR_PUT_U_SHORT
(
buf
, 
v
Ë
	`IXDR_PUT_LONG
(buf, ()(v))

	)

285 
boﬁ_t
 
	$xdr_void
 (Ë
__THROW
;

286 
boﬁ_t
 
	$xdr_sh‹t
 (
XDR
 *
__xdrs
, *
__•
Ë
__THROW
;

287 
boﬁ_t
 
	$xdr_u_sh‹t
 (
XDR
 *
__xdrs
, 
u_sh‹t
 *
__u•
Ë
__THROW
;

288 
boﬁ_t
 
	$xdr_öt
 (
XDR
 *
__xdrs
, *
__ù
Ë
__THROW
;

289 
boﬁ_t
 
	$xdr_u_öt
 (
XDR
 *
__xdrs
, 
u_öt
 *
__up
Ë
__THROW
;

290 
boﬁ_t
 
	$xdr_l⁄g
 (
XDR
 *
__xdrs
, *
__Õ
Ë
__THROW
;

291 
boﬁ_t
 
	$xdr_u_l⁄g
 (
XDR
 *
__xdrs
, 
u_l⁄g
 *
__uÕ
Ë
__THROW
;

292 
boﬁ_t
 
	$xdr_hy≥r
 (
XDR
 *
__xdrs
, 
quad_t
 *
__Œp
Ë
__THROW
;

293 
boﬁ_t
 
	$xdr_u_hy≥r
 (
XDR
 *
__xdrs
, 
u_quad_t
 *
__uŒp
Ë
__THROW
;

294 
boﬁ_t
 
	$xdr_l⁄gl⁄g_t
 (
XDR
 *
__xdrs
, 
quad_t
 *
__Œp
Ë
__THROW
;

295 
boﬁ_t
 
	$xdr_u_l⁄gl⁄g_t
 (
XDR
 *
__xdrs
, 
u_quad_t
 *
__uŒp
Ë
__THROW
;

296 
boﬁ_t
 
	$xdr_öt8_t
 (
XDR
 *
__xdrs
, 
öt8_t
 *
__ù
Ë
__THROW
;

297 
boﬁ_t
 
	$xdr_uöt8_t
 (
XDR
 *
__xdrs
, 
uöt8_t
 *
__up
Ë
__THROW
;

298 
boﬁ_t
 
	$xdr_öt16_t
 (
XDR
 *
__xdrs
, 
öt16_t
 *
__ù
Ë
__THROW
;

299 
boﬁ_t
 
	$xdr_uöt16_t
 (
XDR
 *
__xdrs
, 
uöt16_t
 *
__up
Ë
__THROW
;

300 
boﬁ_t
 
	$xdr_öt32_t
 (
XDR
 *
__xdrs
, 
öt32_t
 *
__ù
Ë
__THROW
;

301 
boﬁ_t
 
	$xdr_uöt32_t
 (
XDR
 *
__xdrs
, 
uöt32_t
 *
__up
Ë
__THROW
;

302 
boﬁ_t
 
	$xdr_öt64_t
 (
XDR
 *
__xdrs
, 
öt64_t
 *
__ù
Ë
__THROW
;

303 
boﬁ_t
 
	$xdr_uöt64_t
 (
XDR
 *
__xdrs
, 
uöt64_t
 *
__up
Ë
__THROW
;

304 
boﬁ_t
 
	$xdr_quad_t
 (
XDR
 *
__xdrs
, 
quad_t
 *
__ù
Ë
__THROW
;

305 
boﬁ_t
 
	$xdr_u_quad_t
 (
XDR
 *
__xdrs
, 
u_quad_t
 *
__up
Ë
__THROW
;

306 
boﬁ_t
 
	$xdr_boﬁ
 (
XDR
 *
__xdrs
, 
boﬁ_t
 *
__bp
Ë
__THROW
;

307 
boﬁ_t
 
	$xdr_íum
 (
XDR
 *
__xdrs
, 
íum_t
 *
__ï
Ë
__THROW
;

308 
boﬁ_t
 
	$xdr_¨øy
 (
XDR
 * 
_xdrs
, 
ˇddr_t
 *
__addΩ
, 
u_öt
 *
__sizï
,

309 
u_öt
 
__maxsize
, u_öà
__ñsize
, 
xdΩroc_t
 
__ñ¥oc
)

310 
__THROW
;

311 
boﬁ_t
 
	$xdr_byãs
 (
XDR
 *
__xdrs
, **
__˝p
, 
u_öt
 *
__sizï
,

312 
u_öt
 
__maxsize
Ë
__THROW
;

313 
boﬁ_t
 
	$xdr_›aque
 (
XDR
 *
__xdrs
, 
ˇddr_t
 
__˝
, 
u_öt
 
__˙t
Ë
__THROW
;

314 
boﬁ_t
 
	$xdr_°rög
 (
XDR
 *
__xdrs
, **
__˝p
, 
u_öt
 
__maxsize
Ë
__THROW
;

315 
boﬁ_t
 
	$xdr_uni⁄
 (
XDR
 *
__xdrs
, 
íum_t
 *
__dscmp
, *
__u≈
,

316 
__c⁄°
 
xdr_dis¸im
 *
__choi˚s
,

317 
xdΩroc_t
 
__dÁu…
Ë
__THROW
;

318 
boﬁ_t
 
	$xdr_ch¨
 (
XDR
 *
__xdrs
, *
__˝
Ë
__THROW
;

319 
boﬁ_t
 
	$xdr_u_ch¨
 (
XDR
 *
__xdrs
, 
u_ch¨
 *
__˝
Ë
__THROW
;

320 
boﬁ_t
 
	$xdr_ve˘‹
 (
XDR
 *
__xdrs
, *
__ba£p
, 
u_öt
 
__√Àm
,

321 
u_öt
 
__ñemsize
, 
xdΩroc_t
 
__xdr_ñem
Ë
__THROW
;

322 
boﬁ_t
 
	$xdr_Êﬂt
 (
XDR
 *
__xdrs
, *
__Â
Ë
__THROW
;

323 
boﬁ_t
 
	$xdr_doubÀ
 (
XDR
 *
__xdrs
, *
__dp
Ë
__THROW
;

324 
boﬁ_t
 
	$xdr_ª„ªn˚
 (
XDR
 *
__xdrs
, 
ˇddr_t
 *
__xµ
, 
u_öt
 
__size
,

325 
xdΩroc_t
 
__¥oc
Ë
__THROW
;

326 
boﬁ_t
 
	$xdr_poöãr
 (
XDR
 *
__xdrs
, **
__objµ
,

327 
u_öt
 
__obj_size
, 
xdΩroc_t
 
__xdr_obj
Ë
__THROW
;

328 
boﬁ_t
 
	$xdr_wøp°rög
 (
XDR
 *
__xdrs
, **
__˝p
Ë
__THROW
;

329 
u_l⁄g
 
	$xdr_sizeof
 (
xdΩroc_t
, *Ë
__THROW
;

335 
	#MAX_NETOBJ_SZ
 1024

	)

336 
	s√tobj


338 
u_öt
 
n_Àn
;

339 *
n_byãs
;

341 
√tobj
 
	t√tobj
;

342 
boﬁ_t
 
	$xdr_√tobj
 (
XDR
 *
__xdrs
, 
√tobj
 *
__≈
Ë
__THROW
;

350 
	$xdrmem_¸óã
 (
XDR
 *
__xdrs
, 
__c⁄°
 
ˇddr_t
 
__addr
,

351 
u_öt
 
__size
, 
xdr_›
 
__x›
Ë
__THROW
;

354 
	$xdr°dio_¸óã
 (
XDR
 *
__xdrs
, 
FILE
 *
__fûe
, 
xdr_›
 
__x›
)

355 
__THROW
;

358 
	`xdºec_¸óã
 (
XDR
 *
__xdrs
, 
u_öt
 
__£ndsize
,

359 
u_öt
 
__ªcvsize
, 
ˇddr_t
 
__t˝_h™dÀ
,

360 (*
__ªadô
) (*, *, ),

361 (*
__wrôeô
Ë(*, *, )Ë
__THROW
;

364 
boﬁ_t
 
	$xdºec_ído‰ec‹d
 (
XDR
 *
__xdrs
, 
boﬁ_t
 
__£ndnow
Ë
__THROW
;

367 
boﬁ_t
 
	$xdºec_skùªc‹d
 (
XDR
 *
__xdrs
Ë
__THROW
;

370 
boﬁ_t
 
	$xdºec_eof
 (
XDR
 *
__xdrs
Ë
__THROW
;

373 
	$xdr_‰ì
 (
xdΩroc_t
 
__¥oc
, *
__objp
Ë
__THROW
;

375 
__END_DECLS


	@/usr/include/search.h

20 #i‚de‡
_SEARCH_H


21 
	#_SEARCH_H
 1

	)

23 
	~<„©uªs.h
>

25 
	#__√ed_size_t


	)

26 
	~<°ddef.h
>

28 
	g__BEGIN_DECLS


30 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


34 #ifde‡
__USE_GNU


35 
	sqñem


37 
qñem
 *
	mq_f‹w
;

38 
qñem
 *
	mq_back
;

39 
	mq_d©a
[1];

45 
	$ösque
 (*
__ñem
, *
__¥ev
Ë
__THROW
;

48 
	$ªmque
 (*
__ñem
Ë
__THROW
;

53 #i‚de‡
__COMPAR_FN_T


54 
	#__COMPAR_FN_T


	)

55 (*
	t__com∑r_‚_t
Ë(
	t__c⁄°
 *, __const *);

57 #ifdef 
__USE_GNU


58 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

65 
FIND
,

66 
ENTER


68 
	tACTION
;

70 
	síåy


72 *
key
;

73 *
d©a
;

75 
	tENTRY
;

78 
_ENTRY
;

88 
ENTRY
 *
	$h£¨ch
 (
ENTRY
 
__ôem
, 
ACTION
 
__a˘i⁄
Ë
__THROW
;

91 
	$h¸óã
 (
size_t
 
__√l
Ë
__THROW
;

94 
	$hde°roy
 (Ë
__THROW
;

96 #ifde‡
__USE_GNU


98 
	sh£¨ch_d©a


100 
_ENTRY
 *
èbÀ
;

101 
size
;

102 
fûÀd
;

107 
	$h£¨ch_r
 (
ENTRY
 
__ôem
, 
ACTION
 
__a˘i⁄
, ENTRY **
__ªtvÆ
,

108 
h£¨ch_d©a
 *
__hèb
Ë
__THROW
;

109 
	$h¸óã_r
 (
size_t
 
__√l
, 
h£¨ch_d©a
 *
__hèb
Ë
__THROW
;

110 
	$hde°roy_r
 (
h£¨ch_d©a
 *
__hèb
Ë
__THROW
;

121 
¥e‹dî
,

122 
po°‹dî
,

123 
íd‹dî
,

124 
Àaf


126 
	tVISIT
;

130 *
	`t£¨ch
 (
__c⁄°
 *
__key
, **
__roŸp
,

131 
__com∑r_‚_t
 
__com∑r
);

135 *
	`tföd
 (
__c⁄°
 *
__key
, *__c⁄° *
__roŸp
,

136 
__com∑r_‚_t
 
__com∑r
);

139 *
	`tdñëe
 (
__c⁄°
 *
__ª°ri˘
 
__key
,

140 **
__ª°ri˘
 
__roŸp
,

141 
__com∑r_‚_t
 
__com∑r
);

143 #i‚de‡
__ACTION_FN_T


144 
	#__ACTION_FN_T


	)

145 (*
	t__a˘i⁄_‚_t
Ë(
	t__c⁄°
 *
	t__nodï
, 
	tVISIT
 
	t__vÆue
,

146 
	t__Àvñ
);

151 
	`twÆk
 (
__c⁄°
 *
__roŸ
, 
__a˘i⁄_‚_t
 
__a˘i⁄
);

153 #ifde‡
__USE_GNU


156 (*
	t__‰ì_‚_t
Ë(*
	t__nodï
);

159 
	`tde°roy
 (*
__roŸ
, 
__‰ì_‚_t
 
__‰ìf˘
);

165 *
	`lföd
 (
__c⁄°
 *
__key
, __c⁄° *
__ba£
,

166 
size_t
 *
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
);

170 *
	`l£¨ch
 (
__c⁄°
 *
__key
, *
__ba£
,

171 
size_t
 *
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
);

173 
__END_DECLS


	@/usr/include/setjmp.h

23 #i‚def 
_SETJMP_H


24 
	#_SETJMP_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


30 
	~<bôs/£tjmp.h
>

31 
	~<bôs/sig£t.h
>

35 
	s__jmp_buf_èg


41 
__jmp_buf
 
	m__jmpbuf
;

42 
	m__mask_was_ßved
;

43 
__sig£t_t
 
	m__ßved_mask
;

47 
__BEGIN_NAMESPACE_STD


49 
__jmp_buf_èg
 
	tjmp_buf
[1];

53 
	$£tjmp
 (
jmp_buf
 
__ív
Ë
__THROW
;

55 
__END_NAMESPACE_STD


60 
	$__sig£tjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__ßvemask
Ë
__THROW
;

62 #i‚def 
__FAVOR_BSD


65 
	$_£tjmp
 (
__jmp_buf_èg
 
__ív
[1]Ë
__THROW
;

69 
	#£tjmp
(
ív
Ë
	`_£tjmp
 (ív)

	)

74 
	#£tjmp
(
ív
Ë
	`£tjmp
 (ív)

	)

78 
__BEGIN_NAMESPACE_STD


82 
	$l⁄gjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__vÆ
)

83 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

85 
__END_NAMESPACE_STD


87 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


91 
	$_l⁄gjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__vÆ
)

92 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

96 #ifdef 
__USE_POSIX


100 
__jmp_buf_èg
 
	tsigjmp_buf
[1];

104 
	#sig£tjmp
(
ív
, 
ßvemask
Ë
	`__sig£tjmp
 (ív, savemask)

	)

110 
	$sigl⁄gjmp
 (
sigjmp_buf
 
__ív
, 
__vÆ
)

111 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

116 #i‡
__USE_FORTIFY_LEVEL
 > 0

117 
	~<bôs/£tjmp2.h
>

120 
__END_DECLS


	@/usr/include/signal.h

23 #i‚def 
_SIGNAL_H


25 #i‡!
deföed
 
__√ed_sig_©omic_t
 && !deföed 
__√ed_sig£t_t


26 
	#_SIGNAL_H


	)

29 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


33 
	~<bôs/sig£t.h
>

37 #i‡
deföed
 
__√ed_sig_©omic_t
 || deföed 
_SIGNAL_H


38 #i‚de‡
__sig_©omic_t_deföed


39 
	#__sig_©omic_t_deföed


	)

40 
__BEGIN_NAMESPACE_STD


41 
__sig_©omic_t
 
	tsig_©omic_t
;

42 
	g__END_NAMESPACE_STD


44 #unde‡
__√ed_sig_©omic_t


47 #i‡
deföed
 
__√ed_sig£t_t
 || (deföed 
_SIGNAL_H
 && deföed 
__USE_POSIX
)

48 #i‚de‡
__sig£t_t_deföed


49 
	#__sig£t_t_deföed


	)

50 
__sig£t_t
 
	tsig£t_t
;

52 #unde‡
__√ed_sig£t_t


55 #ifde‡
_SIGNAL_H


57 
	~<bôs/ty≥s.h
>

58 
	~<bôs/signum.h
>

60 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


61 #i‚de‡
__pid_t_deföed


62 
__pid_t
 
	tpid_t
;

63 
	#__pid_t_deföed


	)

65 #ifde‡
__USE_XOPEN


67 #i‚de‡
__uid_t_deföed


68 
__uid_t
 
	tuid_t
;

69 
	#__uid_t_deföed


	)

73 #ifde‡
__USE_POSIX199309


75 
	#__√ed_time•ec


	)

76 
	~<time.h
>

79 
	~<bôs/sigöfo.h
>

84 (*
	t__sigh™dÀr_t
) ();

89 
__sigh™dÀr_t
 
	$__sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

90 
__THROW
;

91 #ifde‡
__USE_GNU


92 
__sigh™dÀr_t
 
	$sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

93 
__THROW
;

99 
__BEGIN_NAMESPACE_STD


100 #ifde‡
__USE_BSD


101 
__sigh™dÀr_t
 
	$sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

102 
__THROW
;

105 #ifde‡
__REDIRECT_NTH


106 
__sigh™dÀr_t
 
	`__REDIRECT_NTH
 (
sig«l
,

107 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
),

108 
__sysv_sig«l
);

110 
	#sig«l
 
__sysv_sig«l


	)

113 
__END_NAMESPACE_STD


115 #ifde‡
__USE_XOPEN


118 
__sigh™dÀr_t
 
	$bsd_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

119 
__THROW
;

125 #ifde‡
__USE_POSIX


126 
	$kûl
 (
__pid_t
 
__pid
, 
__sig
Ë
__THROW
;

129 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


133 
	$kûÕg
 (
__pid_t
 
__pgΩ
, 
__sig
Ë
__THROW
;

136 
__BEGIN_NAMESPACE_STD


138 
	$øi£
 (
__sig
Ë
__THROW
;

139 
__END_NAMESPACE_STD


141 #ifde‡
__USE_SVID


143 
__sigh™dÀr_t
 
	$ssig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

144 
__THROW
;

145 
	$gsig«l
 (
__sig
Ë
__THROW
;

148 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN2K


150 
	`psig«l
 (
__sig
, 
__c⁄°
 *
__s
);

153 #ifde‡
__USE_XOPEN2K


155 
	`psigöfo
 (
__c⁄°
 
sigöfo_t
 *
__pöfo
, __c⁄° *
__s
);

168 
	`__sig∑u£
 (
__sig_‹_mask
, 
__is_sig
);

170 #ifde‡
__FAVOR_BSD


173 
	$sig∑u£
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

175 #ifde‡
__USE_XOPEN


176 #ifde‡
__GNUC__


177 
	$sig∑u£
 (
__sig
Ë
	`__asm__
 ("__xpg_sigpause");

180 
	#sig∑u£
(
sig
Ë
	`__sig∑u£
 ((sig), 1)

	)

186 #ifde‡
__USE_BSD


193 
	#sigmask
(
sig
Ë
	`__sigmask
(sig)

	)

196 
	$sigblock
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

199 
	$sig£tmask
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

202 
	$siggëmask
 (Ë
__THROW
 
__©åibuã_dïªˇãd__
;

206 #ifde‡
__USE_MISC


207 
	#NSIG
 
_NSIG


	)

210 #ifde‡
__USE_GNU


211 
__sigh™dÀr_t
 
	tsigh™dÀr_t
;

215 #ifde‡
__USE_BSD


216 
__sigh™dÀr_t
 
	tsig_t
;

219 #ifde‡
__USE_POSIX


222 
	$sigem±y£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

225 
	$sigfûl£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

228 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

231 
	$sigdñ£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

234 
	$sigismembî
 (
__c⁄°
 
sig£t_t
 *
__£t
, 
__signo
)

235 
__THROW
 
	`__n⁄nuŒ
 ((1));

237 #ifde‡
__USE_GNU


239 
	$sigi£m±y£t
 (
__c⁄°
 
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

242 
	$sig™d£t
 (
sig£t_t
 *
__£t
, 
__c⁄°
 sig£t_à*
__À·
,

243 
__c⁄°
 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

246 
	$sig‹£t
 (
sig£t_t
 *
__£t
, 
__c⁄°
 sig£t_à*
__À·
,

247 
__c⁄°
 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

252 
	~<bôs/siga˘i⁄.h
>

255 
	$sig¥ocmask
 (
__how
, 
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
,

256 
sig£t_t
 *
__ª°ri˘
 
__o£t
Ë
__THROW
;

263 
	$sigsu•íd
 (
__c⁄°
 
sig£t_t
 *
__£t
Ë
	`__n⁄nuŒ
 ((1));

266 
	$siga˘i⁄
 (
__sig
, 
__c⁄°
 
siga˘i⁄
 *
__ª°ri˘
 
__a˘
,

267 
siga˘i⁄
 *
__ª°ri˘
 
__ﬂ˘
Ë
__THROW
;

270 
	$sig≥ndög
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

277 
	$sigwaô
 (
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
, *__ª°ri˘ 
__sig
)

278 
	`__n⁄nuŒ
 ((1, 2));

280 #ifde‡
__USE_POSIX199309


285 
	$sigwaôöfo
 (
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
,

286 
sigöfo_t
 *
__ª°ri˘
 
__öfo
Ë
	`__n⁄nuŒ
 ((1));

293 
	$sigtimedwaô
 (
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
,

294 
sigöfo_t
 *
__ª°ri˘
 
__öfo
,

295 
__c⁄°
 
time•ec
 *
__ª°ri˘
 
__timeout
)

296 
	`__n⁄nuŒ
 ((1));

300 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, 
__c⁄°
 
sigvÆ
 
__vÆ
)

301 
__THROW
;

306 #ifde‡
__USE_BSD


310 
__c⁄°
 *__c⁄° 
_sys_sigli°
[
_NSIG
];

311 
__c⁄°
 *__c⁄° 
sys_sigli°
[
_NSIG
];

314 
	ssigvec


316 
__sigh™dÀr_t
 
sv_h™dÀr
;

317 
sv_mask
;

319 
sv_Êags
;

320 
	#sv_⁄°ack
 
sv_Êags


	)

324 
	#SV_ONSTACK
 (1 << 0)

	)

325 
	#SV_INTERRUPT
 (1 << 1)

	)

326 
	#SV_RESETHAND
 (1 << 2)

	)

334 
	$sigvec
 (
__sig
, 
__c⁄°
 
sigvec
 *
__vec
,

335 
sigvec
 *
__ovec
Ë
__THROW
;

339 
	~<bôs/sigc⁄ãxt.h
>

342 
	$sigªtu∫
 (
sigc⁄ãxt
 *
__s˝
Ë
__THROW
;

347 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


348 
	#__√ed_size_t


	)

349 
	~<°ddef.h
>

354 
	$sigöãºu±
 (
__sig
, 
__öãºu±
Ë
__THROW
;

356 
	~<bôs/sig°ack.h
>

357 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


359 
	~<sys/uc⁄ãxt.h
>

365 
	$sig°ack
 (
sig°ack
 *
__ss
, sig°ack *
__oss
)

366 
__THROW
 
__©åibuã_dïªˇãd__
;

370 
	$sigÆt°ack
 (
__c⁄°
 
sigÆt°ack
 *
__ª°ri˘
 
__ss
,

371 
sigÆt°ack
 *
__ª°ri˘
 
__oss
Ë
__THROW
;

375 #ifde‡
__USE_XOPEN_EXTENDED


379 
	$sighﬁd
 (
__sig
Ë
__THROW
;

382 
	$sigªl£
 (
__sig
Ë
__THROW
;

385 
	$sigign‹e
 (
__sig
Ë
__THROW
;

388 
__sigh™dÀr_t
 
	$sig£t
 (
__sig
, 
__sigh™dÀr_t
 
__di•
Ë
__THROW
;

391 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


394 
	~<bôs/±hªadty≥s.h
>

395 
	~<bôs/sigthªad.h
>

402 
	$__libc_cuºít_sigπmö
 (Ë
__THROW
;

404 
	$__libc_cuºít_sigπmax
 (Ë
__THROW
;

408 
__END_DECLS


	@/usr/include/stdint.h

23 #i‚de‡
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<„©uªs.h
>

27 
	~<bôs/wch¨.h
>

28 
	~<bôs/w‹dsize.h
>

35 #i‚de‡
__öt8_t_deföed


36 
	#__öt8_t_deföed


	)

37 sig√d 
	töt8_t
;

38 
	töt16_t
;

39 
	töt32_t
;

40 #i‡
__WORDSIZE
 == 64

41 
	töt64_t
;

43 
__exãnsi⁄__


44 
	töt64_t
;

49 
	tuöt8_t
;

50 
	tuöt16_t
;

51 #i‚de‡
__uöt32_t_deföed


52 
	tuöt32_t
;

53 
	#__uöt32_t_deföed


	)

55 #i‡
__WORDSIZE
 == 64

56 
	tuöt64_t
;

58 
__exãnsi⁄__


59 
	tuöt64_t
;

66 sig√d 
	töt_Àa°8_t
;

67 
	töt_Àa°16_t
;

68 
	töt_Àa°32_t
;

69 #i‡
__WORDSIZE
 == 64

70 
	töt_Àa°64_t
;

72 
__exãnsi⁄__


73 
	töt_Àa°64_t
;

77 
	tuöt_Àa°8_t
;

78 
	tuöt_Àa°16_t
;

79 
	tuöt_Àa°32_t
;

80 #i‡
__WORDSIZE
 == 64

81 
	tuöt_Àa°64_t
;

83 
__exãnsi⁄__


84 
	tuöt_Àa°64_t
;

91 sig√d 
	töt_Á°8_t
;

92 #i‡
__WORDSIZE
 == 64

93 
	töt_Á°16_t
;

94 
	töt_Á°32_t
;

95 
	töt_Á°64_t
;

97 
	töt_Á°16_t
;

98 
	töt_Á°32_t
;

99 
__exãnsi⁄__


100 
	töt_Á°64_t
;

104 
	tuöt_Á°8_t
;

105 #i‡
__WORDSIZE
 == 64

106 
	tuöt_Á°16_t
;

107 
	tuöt_Á°32_t
;

108 
	tuöt_Á°64_t
;

110 
	tuöt_Á°16_t
;

111 
	tuöt_Á°32_t
;

112 
__exãnsi⁄__


113 
	tuöt_Á°64_t
;

118 #i‡
__WORDSIZE
 == 64

119 #i‚de‡
__öçå_t_deföed


120 
	töçå_t
;

121 
	#__öçå_t_deföed


	)

123 
	tuöçå_t
;

125 #i‚de‡
__öçå_t_deföed


126 
	töçå_t
;

127 
	#__öçå_t_deföed


	)

129 
	tuöçå_t
;

134 #i‡
__WORDSIZE
 == 64

135 
	tötmax_t
;

136 
	tuötmax_t
;

138 
__exãnsi⁄__


139 
	tötmax_t
;

140 
__exãnsi⁄__


141 
	tuötmax_t
;

147 #i‡!
deföed
 
__˝lu•lus
 || deföed 
__STDC_LIMIT_MACROS


149 #i‡
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
Ë¯## 
L


	)

151 
	#__UINT64_C
(
c
Ë¯## 
UL


	)

153 
	#__INT64_C
(
c
Ë¯## 
LL


	)

154 
	#__UINT64_C
(
c
Ë¯## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #i‡
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #i‡
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #i‡
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #i‡
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #i‡
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #i‡
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #i‚de‡
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #i‡!
deföed
 
__˝lu•lus
 || deföed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
Ë
	)
c

291 
	#INT16_C
(
c
Ë
	)
c

292 
	#INT32_C
(
c
Ë
	)
c

293 #i‡
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
Ë¯## 
L


	)

296 
	#INT64_C
(
c
Ë¯## 
LL


	)

300 
	#UINT8_C
(
c
Ë
	)
c

301 
	#UINT16_C
(
c
Ë
	)
c

302 
	#UINT32_C
(
c
Ë¯## 
U


	)

303 #i‡
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
Ë¯## 
UL


	)

306 
	#UINT64_C
(
c
Ë¯## 
ULL


	)

310 #i‡
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
Ë¯## 
L


	)

312 
	#UINTMAX_C
(
c
Ë¯## 
UL


	)

314 
	#INTMAX_C
(
c
Ë¯## 
LL


	)

315 
	#UINTMAX_C
(
c
Ë¯## 
ULL


	)

	@/usr/include/stdio.h

24 #i‚de‡
_STDIO_H


26 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


32 
	#__√ed_size_t


	)

33 
	#__√ed_NULL


	)

34 
	~<°ddef.h
>

36 
	~<bôs/ty≥s.h
>

37 
	#__√ed_FILE


	)

38 
	#__√ed___FILE


	)

42 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_SVID
 || deföed 
__USE_POSIX
 \

52 || 
deföed
 
	g__USE_BSD
 || deföed 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

53 || 
deföed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_deföed
 1

	)

59 #unde‡
__√ed_FILE


62 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_deföed
 1

	)

69 #unde‡
__√ed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


78 #ifde‡
__GNUC__


79 #i‚de‡
_VA_LIST_DEFINED


80 
_G_va_li°
 
	tva_li°
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<°d¨g.h
>

88 #ifde‡
__USE_XOPEN2K8


89 #i‚de‡
__off_t_deföed


90 #i‚de‡
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_deföed


	)

97 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_deföed


	)

102 #i‚de‡
__ssize_t_deföed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_deföed


	)

109 
__BEGIN_NAMESPACE_STD


110 #i‚de‡
__USE_FILE_OFFSET64


111 
_G_Âos_t
 
	tÂos_t
;

113 
_G_Âos64_t
 
	tÂos_t
;

115 
__END_NAMESPACE_STD


116 #ifde‡
__USE_LARGEFILE64


117 
_G_Âos64_t
 
	tÂos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #i‚de‡
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #i‚de‡
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

146 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


148 
	#P_tmpdú
 "/tmp"

	)

161 
	~<bôs/°dio_lim.h
>

165 
_IO_FILE
 *
°dö
;

166 
_IO_FILE
 *
°dout
;

167 
_IO_FILE
 *
°dîr
;

169 
	#°dö
 
°dö


	)

170 
	#°dout
 
°dout


	)

171 
	#°dîr
 
°dîr


	)

173 
__BEGIN_NAMESPACE_STD


175 
	$ªmove
 (
__c⁄°
 *
__fûíame
Ë
__THROW
;

177 
	$ª«me
 (
__c⁄°
 *
__ﬁd
, __c⁄° *
__√w
Ë
__THROW
;

178 
__END_NAMESPACE_STD


180 #ifde‡
__USE_ATFILE


182 
	$ª«mót
 (
__ﬁdfd
, 
__c⁄°
 *
__ﬁd
, 
__√wfd
,

183 
__c⁄°
 *
__√w
Ë
__THROW
;

186 
__BEGIN_NAMESPACE_STD


191 #i‚de‡
__USE_FILE_OFFSET64


192 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

194 #ifde‡
__REDIRECT


195 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

197 
	#tmpfûe
 
tmpfûe64


	)

201 #ifde‡
__USE_LARGEFILE64


202 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

206 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

207 
__END_NAMESPACE_STD


209 #ifde‡
__USE_MISC


212 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

216 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


224 *
	$ãm≤am
 (
__c⁄°
 *
__dú
, __c⁄° *
__pfx
)

225 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

229 
__BEGIN_NAMESPACE_STD


234 
	`f˛o£
 (
FILE
 *
__°ªam
);

239 
	`fÊush
 (
FILE
 *
__°ªam
);

240 
__END_NAMESPACE_STD


242 #ifde‡
__USE_MISC


249 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

252 #ifde‡
__USE_GNU


259 
	`f˛o£Æl
 ();

263 
__BEGIN_NAMESPACE_STD


264 #i‚de‡
__USE_FILE_OFFSET64


269 
FILE
 *
	$f›í
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

270 
__c⁄°
 *
__ª°ri˘
 
__modes
Ë
__wur
;

275 
FILE
 *
	$‰e›í
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

276 
__c⁄°
 *
__ª°ri˘
 
__modes
,

277 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

279 #ifde‡
__REDIRECT


280 
FILE
 *
	`__REDIRECT
 (
f›í
, (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

281 
__c⁄°
 *
__ª°ri˘
 
__modes
), 
f›í64
)

282 
__wur
;

283 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

284 
__c⁄°
 *
__ª°ri˘
 
__modes
,

285 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

286 
__wur
;

288 
	#f›í
 
f›í64


	)

289 
	#‰e›í
 
‰e›í64


	)

292 
__END_NAMESPACE_STD


293 #ifde‡
__USE_LARGEFILE64


294 
FILE
 *
	$f›í64
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

295 
__c⁄°
 *
__ª°ri˘
 
__modes
Ë
__wur
;

296 
FILE
 *
	$‰e›í64
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

297 
__c⁄°
 *
__ª°ri˘
 
__modes
,

298 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

301 #ifdef 
__USE_POSIX


303 
FILE
 *
	$fd›í
 (
__fd
, 
__c⁄°
 *
__modes
Ë
__THROW
 
__wur
;

306 #ifdef 
__USE_GNU


309 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

310 
__c⁄°
 *
__ª°ri˘
 
__modes
,

311 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

314 #ifde‡
__USE_XOPEN2K8


316 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, 
__c⁄°
 *
__modes
)

317 
__THROW
 
__wur
;

322 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

326 
__BEGIN_NAMESPACE_STD


329 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

333 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

334 
__modes
, 
size_t
 
__n
Ë
__THROW
;

335 
__END_NAMESPACE_STD


337 #ifdef 
__USE_BSD


340 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

341 
size_t
 
__size
Ë
__THROW
;

344 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

348 
__BEGIN_NAMESPACE_STD


353 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

354 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...);

359 
	`¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...);

361 
	$•rötf
 (*
__ª°ri˘
 
__s
,

362 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

368 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__f‹m©
,

369 
_G_va_li°
 
__¨g
);

374 
	`v¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

376 
	$v•rötf
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__f‹m©
,

377 
_G_va_li°
 
__¨g
Ë
__THROW
;

378 
__END_NAMESPACE_STD


380 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_ISOC99
 || deföed 
__USE_UNIX98


381 
__BEGIN_NAMESPACE_C99


383 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

384 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...)

385 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

387 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

388 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

389 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

390 
__END_NAMESPACE_C99


393 #ifde‡
__USE_GNU


396 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, 
__c⁄°
 *__ª°ri˘ 
__f
,

397 
_G_va_li°
 
__¨g
)

398 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

399 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

400 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

401 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

402 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

403 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

404 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

407 #ifde‡
__USE_XOPEN2K8


414 
	$vd¥ötf
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
,

415 
_G_va_li°
 
__¨g
)

416 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

417 
	$d¥ötf
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

418 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

422 
__BEGIN_NAMESPACE_STD


427 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

428 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

433 
	$sˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

435 
	$ssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

436 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

438 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

439 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

440 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

441 #ifde‡
__REDIRECT


445 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

446 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...),

447 
__isoc99_fsˇnf
Ë
__wur
;

448 
	`__REDIRECT
 (
sˇnf
, (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...),

449 
__isoc99_sˇnf
Ë
__wur
;

450 
	`__REDIRECT_NTH
 (
ssˇnf
, (
__c⁄°
 *
__ª°ri˘
 
__s
,

451 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...),

452 
__isoc99_ssˇnf
);

454 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

455 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

456 
	$__isoc99_sˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

457 
	$__isoc99_ssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

458 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

459 
	#fsˇnf
 
__isoc99_fsˇnf


	)

460 
	#sˇnf
 
__isoc99_sˇnf


	)

461 
	#ssˇnf
 
__isoc99_ssˇnf


	)

465 
__END_NAMESPACE_STD


467 #ifdef 
__USE_ISOC99


468 
__BEGIN_NAMESPACE_C99


473 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__f‹m©
,

474 
_G_va_li°
 
__¨g
)

475 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

481 
	$vsˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

482 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

485 
	$vssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

486 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

487 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

489 #i‡!
deföed
 
__USE_GNU
 \

490 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

491 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

492 #ifde‡
__REDIRECT


496 
	`__REDIRECT
 (
vfsˇnf
,

497 (
FILE
 *
__ª°ri˘
 
__s
,

498 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

499 
__isoc99_vfsˇnf
)

500 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

501 
	`__REDIRECT
 (
vsˇnf
, (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

502 
_G_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

503 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

504 
	`__REDIRECT_NTH
 (
vssˇnf
,

505 (
__c⁄°
 *
__ª°ri˘
 
__s
,

506 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

507 
_G_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

508 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

510 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

511 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

512 
_G_va_li°
 
__¨g
Ë
__wur
;

513 
	$__isoc99_vsˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

514 
_G_va_li°
 
__¨g
Ë
__wur
;

515 
	$__isoc99_vssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

516 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

517 
_G_va_li°
 
__¨g
Ë
__THROW
;

518 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

519 
	#vsˇnf
 
__isoc99_vsˇnf


	)

520 
	#vssˇnf
 
__isoc99_vssˇnf


	)

524 
__END_NAMESPACE_C99


528 
__BEGIN_NAMESPACE_STD


533 
	`fgëc
 (
FILE
 *
__°ªam
);

534 
	`gëc
 (
FILE
 *
__°ªam
);

540 
	`gëch¨
 ();

541 
__END_NAMESPACE_STD


545 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

547 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


552 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

553 
	`gëch¨_u∆ocked
 ();

556 #ifde‡
__USE_MISC


563 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

567 
__BEGIN_NAMESPACE_STD


575 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

576 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

582 
	`putch¨
 (
__c
);

583 
__END_NAMESPACE_STD


587 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

589 #ifde‡
__USE_MISC


596 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

599 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


604 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

605 
	`putch¨_u∆ocked
 (
__c
);

609 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 \

610 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

612 
	`gëw
 (
FILE
 *
__°ªam
);

615 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

619 
__BEGIN_NAMESPACE_STD


624 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

625 
__wur
;

632 *
	$gës
 (*
__s
Ë
__wur
;

633 
__END_NAMESPACE_STD


635 #ifde‡
__USE_GNU


642 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

643 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

647 #ifdef 
__USE_XOPEN2K8


658 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

659 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

660 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

661 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

662 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

663 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

671 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

672 
size_t
 *
__ª°ri˘
 
__n
,

673 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

677 
__BEGIN_NAMESPACE_STD


682 
	`Âuts
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

688 
	`puts
 (
__c⁄°
 *
__s
);

695 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

702 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

703 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

708 
size_t
 
	`fwrôe
 (
__c⁄°
 *
__ª°ri˘
 
__±r
, size_à
__size
,

709 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

710 
__END_NAMESPACE_STD


712 #ifde‡
__USE_GNU


719 
	`Âuts_u∆ocked
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

720 
FILE
 *
__ª°ri˘
 
__°ªam
);

723 #ifde‡
__USE_MISC


730 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

731 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

732 
size_t
 
	`fwrôe_u∆ocked
 (
__c⁄°
 *
__ª°ri˘
 
__±r
, size_à
__size
,

733 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

737 
__BEGIN_NAMESPACE_STD


742 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

747 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

752 
	`ªwöd
 (
FILE
 *
__°ªam
);

753 
__END_NAMESPACE_STD


760 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


761 #i‚de‡
__USE_FILE_OFFSET64


766 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

771 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

773 #ifde‡
__REDIRECT


774 
	`__REDIRECT
 (
f£eko
,

775 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

776 
f£eko64
);

777 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

779 
	#f£eko
 
f£eko64


	)

780 
	#·ñlo
 
·ñlo64


	)

785 
__BEGIN_NAMESPACE_STD


786 #i‚de‡
__USE_FILE_OFFSET64


791 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

796 
	`f£ços
 (
FILE
 *
__°ªam
, 
__c⁄°
 
Âos_t
 *
__pos
);

798 #ifde‡
__REDIRECT


799 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

800 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

801 
	`__REDIRECT
 (
f£ços
,

802 (
FILE
 *
__°ªam
, 
__c⁄°
 
Âos_t
 *
__pos
), 
f£ços64
);

804 
	#fgëpos
 
fgëpos64


	)

805 
	#f£ços
 
f£ços64


	)

808 
__END_NAMESPACE_STD


810 #ifde‡
__USE_LARGEFILE64


811 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

812 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

813 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

814 
	`f£ços64
 (
FILE
 *
__°ªam
, 
__c⁄°
 
Âos64_t
 *
__pos
);

817 
__BEGIN_NAMESPACE_STD


819 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

821 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

823 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

824 
__END_NAMESPACE_STD


826 #ifde‡
__USE_MISC


828 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

829 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

830 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

834 
__BEGIN_NAMESPACE_STD


839 
	`≥º‹
 (
__c⁄°
 *
__s
);

840 
__END_NAMESPACE_STD


846 
	~<bôs/sys_îæi°.h
>

849 #ifdef 
__USE_POSIX


851 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

854 #ifde‡
__USE_MISC


856 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

860 #i‡(
deföed
 
__USE_POSIX2
 || deföed 
__USE_SVID
 || deföed 
__USE_BSD
 || \

861 
deföed
 
__USE_MISC
)

866 
FILE
 *
	$p›í
 (
__c⁄°
 *
__comm™d
, __c⁄° *
__modes
Ë
__wur
;

872 
	`p˛o£
 (
FILE
 *
__°ªam
);

876 #ifdef 
__USE_POSIX


878 *
	$˘îmid
 (*
__s
Ë
__THROW
;

882 #ifde‡
__USE_XOPEN


884 *
	`cu£rid
 (*
__s
);

888 #ifdef 
__USE_GNU


889 
ob°ack
;

892 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

893 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...)

894 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

895 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

896 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

897 
_G_va_li°
 
__¨gs
)

898 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

902 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


906 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

910 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

913 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

916 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


920 
	#__√ed_gë›t


	)

921 
	~<gë›t.h
>

926 #ifde‡
__USE_EXTERN_INLINES


927 
	~<bôs/°dio.h
>

929 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


930 
	~<bôs/°dio2.h
>

932 #ifde‡
__LDBL_COMPAT


933 
	~<bôs/°dio-ldbl.h
>

936 
__END_DECLS


	@/usr/include/stdlib.h

23 #i‚def 
_STDLIB_H


25 
	~<„©uªs.h
>

28 
	#__√ed_size_t


	)

29 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


30 
	#__√ed_wch¨_t


	)

31 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	g__BEGIN_DECLS


37 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


38 
	#_STDLIB_H
 1

	)

40 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


42 
	~<bôs/waôÊags.h
>

43 
	~<bôs/waô°©us.h
>

45 #ifde‡
__USE_BSD


50 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


51 
	#__WAIT_INT
(
°©us
) \

52 (
	`__exãnsi⁄__
 (((uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; }) \

53 { .
__ö
 = (
°©us
Ë}).
__i
))

	)

55 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

63 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
waô
 *
	m__u±r
;

71 *
	m__ùå
;

72 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (°©us))

	)

86 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (
	`__WAIT_INT
 (°©us))

	)

87 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (
	`__WAIT_INT
 (°©us))

	)

88 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (
	`__WAIT_INT
 (°©us))

	)

89 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (°©us))

	)

90 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (°©us))

	)

91 #ifde‡
__WIFCONTINUED


92 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (°©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquŸ
;

101 
	mªm
;

102 } 
	tdiv_t
;

105 #i‚de‡
__ldiv_t_deföed


108 
	mquŸ
;

109 
	mªm
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_deföed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


116 
__BEGIN_NAMESPACE_C99


118 
__exãnsi⁄__
 struct

120 
	mquŸ
;

121 
	mªm
;

122 } 
	tŒdiv_t
;

123 
	#__Œdiv_t_deföed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

140 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__c⁄°
 *
__≈å
)

146 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

148 
	$©oi
 (
__c⁄°
 *
__≈å
)

149 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

151 
	$©ﬁ
 (
__c⁄°
 *
__≈å
)

152 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

153 
__END_NAMESPACE_STD


155 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__exãnsi⁄__
 
	$©ﬁl
 (
__c⁄°
 *
__≈å
)

159 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$°πod
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

166 **
__ª°ri˘
 
__íd±r
)

167 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$°πof
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

174 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

176 
	$°πﬁd
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

177 **
__ª°ri˘
 
__íd±r
)

178 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$°πﬁ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

185 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

186 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

188 
	$°πoul
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

189 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

190 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

191 
__END_NAMESPACE_STD


193 #i‡
deföed
 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_BSD


195 
__exãnsi⁄__


196 
	$°πoq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

197 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

198 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

200 
__exãnsi⁄__


201 
	$°πouq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

202 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

203 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

206 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__exãnsi⁄__


210 
	$°πﬁl
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

211 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

212 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

214 
__exãnsi⁄__


215 
	$°πouŒ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

216 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

217 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

218 
__END_NAMESPACE_C99


222 #ifde‡
__USE_GNU


236 
	~<xloˇÀ.h
>

240 
	$°πﬁ_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

241 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

242 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

244 
	$°πoul_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

245 **
__ª°ri˘
 
__íd±r
,

246 
__ba£
, 
__loˇÀ_t
 
__loc
)

247 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

249 
__exãnsi⁄__


250 
	$°πﬁl_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

251 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

252 
__loˇÀ_t
 
__loc
)

253 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

255 
__exãnsi⁄__


256 
	$°πouŒ_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

257 **
__ª°ri˘
 
__íd±r
,

258 
__ba£
, 
__loˇÀ_t
 
__loc
)

259 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

261 
	$°πod_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

262 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

263 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

265 
	$°πof_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

266 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

267 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

269 
	$°πﬁd_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

270 **
__ª°ri˘
 
__íd±r
,

271 
__loˇÀ_t
 
__loc
)

272 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

276 #ifde‡
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__exã∫_ölöe
 

279 
	`__NTH
 (
	$©of
 (
__c⁄°
 *
__≈å
))

281  
	`°πod
 (
__≈å
, (**Ë
NULL
);

282 
	}
}

283 
__exã∫_ölöe
 

284 
__NTH
 (
	$©oi
 (
__c⁄°
 *
__≈å
))

286  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

287 
	}
}

288 
__exã∫_ölöe
 

289 
__NTH
 (
	$©ﬁ
 (
__c⁄°
 *
__≈å
))

291  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__exãnsi⁄__
 
__exã∫_ölöe
 

298 
__NTH
 (
	$©ﬁl
 (
__c⁄°
 *
__≈å
))

300  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

314 
	$a64l
 (
__c⁄°
 *
__s
)

315 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

319 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_BSD


320 
	~<sys/ty≥s.h
>

327 
	$øndom
 (Ë
__THROW
;

330 
	$§™dom
 (
__£ed
Ë
__THROW
;

336 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

337 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

341 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

344 #ifde‡
__USE_MISC


349 
	søndom_d©a


351 
öt32_t
 *
Âå
;

352 
öt32_t
 *
Ωå
;

353 
öt32_t
 *
°©e
;

354 
ønd_ty≥
;

355 
ønd_deg
;

356 
ønd_£p
;

357 
öt32_t
 *
íd_±r
;

360 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

361 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

363 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

364 
__THROW
 
	`__n⁄nuŒ
 ((2));

366 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

367 
size_t
 
__°©ñí
,

368 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

369 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

371 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

372 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

373 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$ønd
 (Ë
__THROW
;

382 
	$§™d
 (
__£ed
Ë
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifde‡
__USE_POSIX


387 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

391 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


395 
	$dønd48
 (Ë
__THROW
;

396 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

399 
	$Ã™d48
 (Ë
__THROW
;

400 
	$ƒ™d48
 (
__xsubi
[3])

401 
__THROW
 
	`__n⁄nuŒ
 ((1));

404 
	$mønd48
 (Ë
__THROW
;

405 
	$jønd48
 (
__xsubi
[3])

406 
__THROW
 
	`__n⁄nuŒ
 ((1));

409 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__n⁄nuŒ
 ((1));

412 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

414 #ifde‡
__USE_MISC


418 
	sdønd48_d©a


420 
__x
[3];

421 
__ﬁd_x
[3];

422 
__c
;

423 
__öô
;

424 
__a
;

428 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

429 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

430 
	$î™d48_r
 (
__xsubi
[3],

431 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

432 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

435 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

436 *
__ª°ri˘
 
__ªsu…
)

437 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

438 
	$ƒ™d48_r
 (
__xsubi
[3],

439 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

440 *
__ª°ri˘
 
__ªsu…
)

441 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

444 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

445 *
__ª°ri˘
 
__ªsu…
)

446 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

447 
	$jønd48_r
 (
__xsubi
[3],

448 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

449 *
__ª°ri˘
 
__ªsu…
)

450 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

453 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

454 
__THROW
 
	`__n⁄nuŒ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

459 
	$lc⁄g48_r
 (
__∑øm
[7],

460 
dønd48_d©a
 *
__buf„r
)

461 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

467 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


468 
	#__mÆloc_™d_ˇŒoc_deföed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

473 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

474 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

488 
	$‰ì
 (*
__±r
Ë
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$c‰ì
 (*
__±r
Ë
__THROW
;

496 #i‡
deföed
 
__USE_GNU
 || deföed 
__USE_BSD
 || deföed 
__USE_MISC


497 
	~<Æloˇ.h
>

500 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

501 || 
deföed
 
__USE_BSD


503 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

506 #ifde‡
__USE_XOPEN2K


508 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

509 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

518 
	`©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

520 #ifde‡
__USE_GNU


524 #ifde‡
__˝lu•lus


525 "C++" 
	`©_quick_exô
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

528 
	`©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

537 
__THROW
 
	`__n⁄nuŒ
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

546 #ifde‡
__USE_GNU


552 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

554 
__END_NAMESPACE_STD


556 #ifde‡
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$gëív
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__£cuª_gëív
 (
__c⁄°
 *
__«me
)

573 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

575 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


579 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

582 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


585 
	$£ãnv
 (
__c⁄°
 *
__«me
, __c⁄° *
__vÆue
, 
__ª∂a˚
)

586 
__THROW
 
	`__n⁄nuŒ
 ((2));

589 
	$un£ãnv
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

592 #ifdef 
__USE_MISC


596 
	$˛óªnv
 (Ë
__THROW
;

600 #i‡
deföed
 
__USE_MISC
 \

601 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
)

606 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

609 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 \

610 || 
deföed
 
__USE_XOPEN2K8


619 #i‚de‡
__USE_FILE_OFFSET64


620 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

622 #ifde‡
__REDIRECT


623 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

624 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

626 
	#mk°emp
 
mk°emp64


	)

629 #ifde‡
__USE_LARGEFILE64


630 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

634 #ifde‡
__USE_MISC


641 #i‚de‡
__USE_FILE_OFFSET64


642 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

644 #ifde‡
__REDIRECT


645 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

646 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

648 
	#mk°emps
 
mk°emps64


	)

651 #ifde‡
__USE_LARGEFILE64


652 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

653 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

657 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K8


663 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

666 #ifde‡
__USE_GNU


673 #i‚de‡
__USE_FILE_OFFSET64


674 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

676 #ifde‡
__REDIRECT


677 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

678 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

680 
	#mko°emp
 
mko°emp64


	)

683 #ifde‡
__USE_LARGEFILE64


684 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

693 #i‚de‡
__USE_FILE_OFFSET64


694 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

695 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

697 #ifde‡
__REDIRECT


698 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

699 
__Êags
), 
mko°emps64
)

700 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

702 
	#mko°emps
 
mko°emps64


	)

705 #ifde‡
__USE_LARGEFILE64


706 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

707 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy°em
 (
__c⁄°
 *
__comm™d
Ë
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ˇn⁄iˇlize_fûe_«me
 (
__c⁄°
 *
__«me
)

725 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

728 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


734 *
	$ªÆ∑th
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

735 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

740 #i‚de‡
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com∑r_‚_t
Ë(
	t__c⁄°
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

748 #ifde‡
__USE_GNU


749 (*
	t__com∑r_d_‚_t
Ë(
	t__c⁄°
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¨ch
 (
__c⁄°
 *
__key
, __c⁄° *
__ba£
,

756 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

757 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

761 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

762 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

763 #ifde‡
__USE_GNU


764 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

765 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

766 
	`__n⁄nuŒ
 ((1, 4));

771 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

772 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

773 
__END_NAMESPACE_STD


775 #ifde‡
__USE_ISOC99


776 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

777 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__numî
, 
__díom
)

786 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

788 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

789 
__END_NAMESPACE_STD


791 #ifde‡
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

794 
__díom
)

795 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

796 
__END_NAMESPACE_C99


800 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

801 || 
deföed
 
__USE_SVID


808 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

809 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

814 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

815 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

820 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

821 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

824 #ifde‡
__USE_MISC


826 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

827 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

828 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

829 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

830 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

831 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

832 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

833 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

838 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

839 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

840 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

841 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

842 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

843 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

845 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

846 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

847 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

848 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

850 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

851 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

852 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbÀn
 (
__c⁄°
 *
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

863 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

864 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

867 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
 
__wur
;

871 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

872 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

874 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

875 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifde‡
__USE_SVID


885 
	$Ωm©ch
 (
__c⁄°
 *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

889 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


896 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

897 *
__c⁄°
 *
__ª°ri˘
 
__tokís
,

898 **
__ª°ri˘
 
__vÆuï
)

899 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

903 #ifde‡
__USE_XOPEN


905 
	$£tkey
 (
__c⁄°
 *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

911 #ifde‡
__USE_XOPEN2KXSI


913 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

916 #ifde‡
__USE_XOPEN


921 
	$gø¡±
 (
__fd
Ë
__THROW
;

925 
	$u∆ock±
 (
__fd
Ë
__THROW
;

930 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

933 #ifde‡
__USE_GNU


937 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

938 
__THROW
 
	`__n⁄nuŒ
 ((2));

941 
	`gë±
 ();

944 #ifde‡
__USE_BSD


948 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

949 
__THROW
 
	`__n⁄nuŒ
 ((1));

954 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


955 
	~<bôs/°dlib.h
>

957 #ifde‡
__LDBL_COMPAT


958 
	~<bôs/°dlib-ldbl.h
>

962 #unde‡
__√ed_mÆloc_™d_ˇŒoc


964 
__END_DECLS


	@/usr/include/string.h

24 #i‚def 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


32 
	#__√ed_size_t


	)

33 
	#__√ed_NULL


	)

34 
	~<°ddef.h
>

37 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
,

45 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

46 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

49 *
	$memmove
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

50 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN


57 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

68 
	$memcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

72 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 
__c⁄°
 *
	`memchr
 (__c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

80 #ifde‡
__OPTIMIZE__


81 
__exã∫_Æways_ölöe
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


84  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

87 
__exã∫_Æways_ölöe
 
__c⁄°
 *

88 
	`memchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


90  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifde‡
__USE_GNU


103 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

106 "C++" 
__c⁄°
 *
	$øwmemchr
 (
__c⁄°
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

109 *
	$øwmemchr
 (
__c⁄°
 *
__s
, 
__c
)

110 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

114 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

117 "C++" 
__c⁄°
 *
	$memrchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

120 *
	$memrchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

129 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

131 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

132 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

133 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

136 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

137 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

139 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

140 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

143 
	$°rcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

144 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

146 
	$°∫cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

150 
	$°rcﬁl
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

151 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

153 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

154 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

155 
__THROW
 
	`__n⁄nuŒ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifde‡
__USE_XOPEN2K8


162 
	~<xloˇÀ.h
>

165 
	$°rcﬁl_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

166 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

168 
size_t
 
	$°rx‰m_l
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
,

169 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

172 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 \

173 || 
deföed
 
__USE_XOPEN2K8


175 *
	$°rdup
 (
__c⁄°
 *
__s
)

176 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

182 #i‡
deföed
 
__USE_XOPEN2K8


183 *
	$°∫dup
 (
__c⁄°
 *
__°rög
, 
size_t
 
__n
)

184 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

187 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


189 
	#°rdu∑
(
s
) \

190 (
__exãnsi⁄__
 \

192 
__c⁄°
 *
__ﬁd
 = (
s
); \

193 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

194 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

195 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

196 
	}
}))

	)

199 
	#°∫du∑
(
s
, 
n
) \

200 (
__exãnsi⁄__
 \

202 
__c⁄°
 *
__ﬁd
 = (
s
); \

203 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

204 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

205 
__√w
[
__Àn
] = '\0'; \

206 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
°rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

217 
__c⁄°
 *
°rchr
 (__c⁄° *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

220 #ifde‡
__OPTIMIZE__


221 
__exã∫_Æways_ölöe
 *

222 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


224  
__buûtö_°rchr
 (
__s
, 
__c
);

227 
__exã∫_Æways_ölöe
 
__c⁄°
 *

228 
°rchr
 (
__c⁄°
 *
__s
, 
__c
Ë
	g__THROW


230  
__buûtö_°rchr
 (
__s
, 
__c
);

235 *
	$°rchr
 (
__c⁄°
 *
__s
, 
__c
)

236 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

239 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`°ºchr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

244 
__c⁄°
 *
	`°ºchr
 (__c⁄° *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

247 #ifde‡
__OPTIMIZE__


248 
__exã∫_Æways_ölöe
 *

249 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


251  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

254 
__exã∫_Æways_ölöe
 
__c⁄°
 *

255 
	`°ºchr
 (
__c⁄°
 *
__s
, 
__c
Ë
__THROW


257  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$°ºchr
 (
__c⁄°
 *
__s
, 
__c
)

263 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifde‡
__USE_GNU


270 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

273 "C++" 
__c⁄°
 *
	$°rch∫ul
 (
__c⁄°
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

276 *
	$°rch∫ul
 (
__c⁄°
 *
__s
, 
__c
)

277 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$°rc•n
 (
__c⁄°
 *
__s
, __c⁄° *
__ªje˘
)

285 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

288 
size_t
 
	$°r•n
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

289 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

291 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`°Ωbrk
 (*
__s
, 
__c⁄°
 *
__ac˚±
)

295 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

296 
__c⁄°
 *
	`°Ωbrk
 (__c⁄° *
__s
, __c⁄° *
__ac˚±
)

297 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

299 #ifde‡
__OPTIMIZE__


300 
__exã∫_Æways_ölöe
 *

301 
	`°Ωbrk
 (*
__s
, 
__c⁄°
 *
__ac˚±
Ë
__THROW


303  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

306 
__exã∫_Æways_ölöe
 
__c⁄°
 *

307 
	`°Ωbrk
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
Ë
__THROW


309  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

312 
	}
}

314 *
	$°Ωbrk
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

315 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

318 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`°r°r
 (*
__hay°ack
, 
__c⁄°
 *
__√edÀ
)

322 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

323 
__c⁄°
 *
	`°r°r
 (__c⁄° *
__hay°ack
,

324 
__c⁄°
 *
__√edÀ
)

325 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

327 #ifde‡
__OPTIMIZE__


328 
__exã∫_Æways_ölöe
 *

329 
	`°r°r
 (*
__hay°ack
, 
__c⁄°
 *
__√edÀ
Ë
__THROW


331  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

334 
__exã∫_Æways_ölöe
 
__c⁄°
 *

335 
	`°r°r
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
Ë
__THROW


337  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

340 
	}
}

342 *
	$°r°r
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
)

343 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

348 *
	$°πok
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__dñim
)

349 
__THROW
 
	`__n⁄nuŒ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

355 
__c⁄°
 *
__ª°ri˘
 
__dñim
,

356 **
__ª°ri˘
 
__ßve_±r
)

357 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

358 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


359 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__dñim
,

360 **
__ª°ri˘
 
__ßve_±r
)

361 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

364 #ifde‡
__USE_GNU


366 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, 
__c⁄°
 *
__√edÀ
)

368 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

369 "C++" 
__c⁄°
 *
	$°rˇ£°r
 (
__c⁄°
 *
__hay°ack
,

370 
__c⁄°
 *
__√edÀ
)

371 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

373 *
	$°rˇ£°r
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
)

374 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

378 #ifde‡
__USE_GNU


382 *
	$memmem
 (
__c⁄°
 *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

383 
__c⁄°
 *
__√edÀ
, 
size_t
 
__√edÀÀn
)

384 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

388 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

389 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

390 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

391 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

392 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

393 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$°æí
 (
__c⁄°
 *
__s
)

400 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$°∫Àn
 (
__c⁄°
 *
__°rög
, 
size_t
 
__maxÀn
)

407 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

414 
__END_NAMESPACE_STD


415 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_MISC


423 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


426 #ifde‡
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

428 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

429 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

431 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

432 
__THROW
 
	`__n⁄nuŒ
 ((2));

433 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

438 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

439 
__THROW
 
	`__n⁄nuŒ
 ((2));

443 #ifde‡
__USE_XOPEN2K8


445 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

451 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

453 #ifde‡
__USE_BSD


455 
	$bc›y
 (
__c⁄°
 *
__§c
, *
__de°
, 
size_t
 
__n
)

456 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

459 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

462 
	$bcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

466 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`ödex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

471 
__c⁄°
 *
	`ödex
 (__c⁄° *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

474 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__exã∫_Æways_ölöe
 *

476 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


478  
	`__buûtö_ödex
 (
__s
, 
__c
);

481 
__exã∫_Æways_ölöe
 
__c⁄°
 *

482 
	`ödex
 (
__c⁄°
 *
__s
, 
__c
Ë
__THROW


484  
	`__buûtö_ödex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$ödex
 (
__c⁄°
 *
__s
, 
__c
)

490 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

494 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`rödex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

499 
__c⁄°
 *
	`rödex
 (__c⁄° *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

502 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__exã∫_Æways_ölöe
 *

504 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


506  
	`__buûtö_rödex
 (
__s
, 
__c
);

509 
__exã∫_Æways_ölöe
 
__c⁄°
 *

510 
	`rödex
 (
__c⁄°
 *
__s
, 
__c
Ë
__THROW


512  
	`__buûtö_rödex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$rödex
 (
__c⁄°
 *
__s
, 
__c
)

518 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

523 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

527 #ifdef 
__USE_GNU


528 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

529 #ifde‡
__GNUC__


530 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

531 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

536 
	$°rˇ£cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

537 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

540 
	$°∫ˇ£cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$°rˇ£cmp_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

548 
__loˇÀ_t
 
__loc
)

549 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

551 
	$°∫ˇ£cmp_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

552 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

553 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

560 
__c⁄°
 *
__ª°ri˘
 
__dñim
)

561 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

569 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

570 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

571 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

572 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

576 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

577 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

578 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

579 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

580 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

581 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$°rvîscmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

587 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

590 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

593 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

595 #i‚de‡
ba£«me


600 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£«me
 (*
__fûíame
)

602 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

603 "C++" 
__c⁄°
 *
	$ba£«me
 (
__c⁄°
 *
__fûíame
)

604 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

606 *
	$ba£«me
 (
__c⁄°
 *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

612 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

613 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

614 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


634 
	~<bôs/°rög.h
>

637 
	~<bôs/°rög2.h
>

640 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


642 
	~<bôs/°rög3.h
>

646 
__END_DECLS


	@/usr/include/strings.h

20 #i‚def 
_STRINGS_H


21 
	#_STRINGS_H
 1

	)

26 #i‡!
deföed
 
_STRING_H
 || !deföed 
__USE_BSD


28 
	~<„©uªs.h
>

29 
	#__√ed_size_t


	)

30 
	~<°ddef.h
>

33 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

34 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

37 
	g__BEGIN_DECLS


39 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


41 
	$bcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

42 
__THROW
 
__©åibuã_puª__
;

45 
	$bc›y
 (
__c⁄°
 *
__§c
, *
__de°
, 
size_t
 
__n
Ë
__THROW
;

48 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
;

51 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


54 *
	`ödex
 (*
__s
, 
__c
)

55 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

56 
__c⁄°
 *
	`ödex
 (__c⁄° *
__s
, 
__c
)

57 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

59 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRING_H_PROTO


60 
__exã∫_Æways_ölöe
 *

61 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


63  
	`__buûtö_ödex
 (
__s
, 
__c
);

66 
__exã∫_Æways_ölöe
 
__c⁄°
 *

67 
	`ödex
 (
__c⁄°
 *
__s
, 
__c
Ë
__THROW


69  
	`__buûtö_ödex
 (
__s
, 
__c
);

72 
	}
}

74 *
	$ödex
 (
__c⁄°
 *
__s
, 
__c
)

75 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

79 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


82 *
	`rödex
 (*
__s
, 
__c
)

83 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

84 
__c⁄°
 *
	`rödex
 (__c⁄° *
__s
, 
__c
)

85 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

87 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRING_H_PROTO


88 
__exã∫_Æways_ölöe
 *

89 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


91  
	`__buûtö_rödex
 (
__s
, 
__c
);

94 
__exã∫_Æways_ölöe
 
__c⁄°
 *

95 
	`rödex
 (
__c⁄°
 *
__s
, 
__c
Ë
__THROW


97  
	`__buûtö_rödex
 (
__s
, 
__c
);

100 
	}
}

102 *
	$rödex
 (
__c⁄°
 *
__s
, 
__c
)

103 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

107 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8
 || deföed 
__USE_XOPEN2K8XSI


110 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((const));

114 
	$°rˇ£cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

115 
__THROW
 
__©åibuã_puª__
;

118 
	$°∫ˇ£cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

119 
__THROW
 
__©åibuã_puª__
;

121 #ifdef 
__USE_XOPEN2K8


125 
	~<xloˇÀ.h
>

129 
	$°rˇ£cmp_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

130 
__loˇÀ_t
 
__loc
)

131 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

133 
	$°∫ˇ£cmp_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

134 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

135 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

138 
__END_DECLS


	@/usr/include/termios.h

23 #i‚def 
_TERMIOS_H


24 
	#_TERMIOS_H
 1

	)

26 
	~<„©uªs.h
>

27 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


29 
	~<bôs/ty≥s.h
>

30 #i‚de‡
__pid_t_deföed


31 
__pid_t
 
	tpid_t
;

32 
	#__pid_t_deföed


	)

36 
	g__BEGIN_DECLS


40 
	~<bôs/ãrmios.h
>

42 #ifde‡
__USE_BSD


45 
	#CCEQ
(
vÆ
, 
c
Ë((cË=(vÆË&& (vÆË!
_POSIX_VDISABLE
)

	)

49 
•ìd_t
 
	$cfgëo•ìd
 (
__c⁄°
 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

52 
•ìd_t
 
	$cfgëi•ìd
 (
__c⁄°
 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

55 
	$cf£to•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

58 
	$cf£ti•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

60 #ifdef 
__USE_BSD


62 
	$cf£t•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

67 
	$tcgë©å
 (
__fd
, 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

71 
	$tc£èâr
 (
__fd
, 
__›ti⁄Æ_a˘i⁄s
,

72 
__c⁄°
 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

75 #ifdef 
__USE_BSD


77 
	$cfmakîaw
 (
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

81 
	$tc£ndbªak
 (
__fd
, 
__duøti⁄
Ë
__THROW
;

87 
	`tcdøö
 (
__fd
);

91 
	$tcÊush
 (
__fd
, 
__queue_£À˘‹
Ë
__THROW
;

95 
	$tcÊow
 (
__fd
, 
__a˘i⁄
Ë
__THROW
;

98 #ifde‡
__USE_UNIX98


100 
__pid_t
 
	$tcgësid
 (
__fd
Ë
__THROW
;

104 #ifde‡
__USE_BSD


105 
	~<sys/âydeÁu…s.h
>

108 
__END_DECLS


	@/usr/include/time.h

23 #i‚def 
_TIME_H


25 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

26 ! 
deföed
 
	g__√ed_time•ec
)

27 
	#_TIME_H
 1

	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__√ed_size_t


	)

37 
	#__√ed_NULL


	)

38 
	~<°ddef.h
>

42 
	~<bôs/time.h
>

45 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


46 #i‚de‡
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

54 
	#__˛ock_t_deföed
 1

	)

56 
	~<bôs/ty≥s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__˛ock_t
 
	t˛ock_t
;

61 
	g__END_NAMESPACE_STD


62 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

67 #unde‡
__√ed_˛ock_t


69 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

70 
	#__time_t_deföed
 1

	)

72 
	~<bôs/ty≥s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC
 || deföed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #unde‡
__√ed_time_t


85 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

86 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

87 
	#__˛ockid_t_deföed
 1

	)

89 
	~<bôs/ty≥s.h
>

92 
__˛ockid_t
 
	t˛ockid_t
;

95 #unde‡
__˛ockid_time_t


97 #i‡!
deföed
 
__timî_t_deföed
 && \

98 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

99 
	#__timî_t_deföed
 1

	)

101 
	~<bôs/ty≥s.h
>

104 
__timî_t
 
	ttimî_t
;

107 #unde‡
__√ed_timî_t


110 #i‡!
deföed
 
__time•ec_deföed
 && \

111 ((
deföed
 
_TIME_H
 && \

112 (
deföed
 
__USE_POSIX199309
 || deföed 
__USE_MISC
)) || \

113 
deföed
 
__√ed_time•ec
)

114 
	#__time•ec_deföed
 1

	)

116 
	~<bôs/ty≥s.h
>

120 
	stime•ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #unde‡
__√ed_time•ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mö
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m⁄
;

140 
tm_yór
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd°
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__c⁄°
 *
tm_z⁄e
;

149 
__tm_gmtoff
;

150 
__c⁄°
 *
__tm_z⁄e
;

153 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde‡
__USE_POSIX199309


161 
	sôimî•ec


163 
time•ec
 
ô_öãrvÆ
;

164 
time•ec
 
ô_vÆue
;

168 
sigevít
;

172 #ifde‡
__USE_XOPEN2K


173 #i‚de‡
__pid_t_deföed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_deföed


	)

180 
__BEGIN_NAMESPACE_STD


183 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

189 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

190 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

193 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

199 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

200 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

201 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifde‡
__USE_XOPEN


207 *
	$°Ωtime
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

208 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

209 
__THROW
;

212 #ifde‡
__USE_XOPEN2K8


215 
	~<xloˇÀ.h
>

217 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

218 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

219 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

220 
__loˇÀ_t
 
__loc
Ë
__THROW
;

223 #ifde‡
__USE_GNU


224 *
	$°Ωtime_l
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

225 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

226 
__loˇÀ_t
 
__loc
Ë
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

237 
tm
 *
	$loˇ…ime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

238 
__END_NAMESPACE_STD


240 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

244 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

248 
tm
 *
	$loˇ…ime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

249 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$as˘ime
 (
__c⁄°
 
tm
 *
__ç
Ë
__THROW
;

258 *
	$˘ime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

259 
__END_NAMESPACE_STD


261 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


266 *
	$as˘ime_r
 (
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

267 *
__ª°ri˘
 
__buf
Ë
__THROW
;

270 *
	$˘ime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

271 *
__ª°ri˘
 
__buf
Ë
__THROW
;

276 *
__tz«me
[2];

277 
__daylight
;

278 
__timez⁄e
;

281 #ifdef 
__USE_POSIX


283 *
tz«me
[2];

287 
	$tz£t
 (Ë
__THROW
;

290 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


291 
daylight
;

292 
timez⁄e
;

295 #ifde‡
__USE_SVID


298 
	$°ime
 (
__c⁄°
 
time_t
 *
__whí
Ë
__THROW
;

304 
	#__i¶óp
(
yór
) \

305 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

308 #ifde‡
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

316 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

319 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

323 #ifde‡
__USE_POSIX199309


328 
	`«no¶ìp
 (
__c⁄°
 
time•ec
 *
__ªque°ed_time
,

329 
time•ec
 *
__ªmaöög
);

333 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

336 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

339 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, 
__c⁄°
 
time•ec
 *
__ç
)

340 
__THROW
;

342 #ifde‡
__USE_XOPEN2K


347 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

348 
__c⁄°
 
time•ec
 *
__ªq
,

349 
time•ec
 *
__ªm
);

352 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

357 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

358 
sigevít
 *
__ª°ri˘
 
__evp
,

359 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

362 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

365 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

366 
__c⁄°
 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

367 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

370 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

371 
__THROW
;

374 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

378 #ifde‡
__USE_XOPEN_EXTENDED


390 
gëd©e_îr
;

399 
tm
 *
	`gëd©e
 (
__c⁄°
 *
__°rög
);

402 #ifde‡
__USE_GNU


413 
	`gëd©e_r
 (
__c⁄°
 *
__ª°ri˘
 
__°rög
,

414 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

417 
__END_DECLS


	@/usr/include/unistd.h

23 #i‚def 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


33 #ifde‡
__USE_XOPEN2K8


35 
	#_POSIX_VERSION
 200809L

	)

36 #ñi‡
deföed
 
__USE_XOPEN2K


38 
	#_POSIX_VERSION
 200112L

	)

39 #ñi‡
deföed
 
__USE_POSIX199506


41 
	#_POSIX_VERSION
 199506L

	)

42 #ñi‡
deföed
 
__USE_POSIX199309


44 
	#_POSIX_VERSION
 199309L

	)

47 
	#_POSIX_VERSION
 199009L

	)

53 #ifde‡
__USE_XOPEN2K8


54 
	#__POSIX2_THIS_VERSION
 200809L

	)

56 #ñi‡
deföed
 
__USE_XOPEN2K


58 
	#__POSIX2_THIS_VERSION
 200112L

	)

59 #ñi‡
deföed
 
__USE_POSIX199506


61 
	#__POSIX2_THIS_VERSION
 199506L

	)

64 
	#__POSIX2_THIS_VERSION
 199209L

	)

68 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

72 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

76 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

80 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

84 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

87 #ifde‡
__USE_XOPEN2K8


88 
	#_XOPEN_VERSION
 700

	)

89 #ñi‡
deföed
 
__USE_XOPEN2K


90 
	#_XOPEN_VERSION
 600

	)

91 #ñi‡
deföed
 
__USE_UNIX98


92 
	#_XOPEN_VERSION
 500

	)

94 
	#_XOPEN_VERSION
 4

	)

98 
	#_XOPEN_XCU_VERSION
 4

	)

101 
	#_XOPEN_XPG2
 1

	)

102 
	#_XOPEN_XPG3
 1

	)

103 
	#_XOPEN_XPG4
 1

	)

106 
	#_XOPEN_UNIX
 1

	)

109 
	#_XOPEN_CRYPT
 1

	)

113 
	#_XOPEN_ENH_I18N
 1

	)

116 
	#_XOPEN_LEGACY
 1

	)

203 
	~<bôs/posix_›t.h
>

206 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


207 
	~<bôs/ívú⁄míts.h
>

211 
	#STDIN_FILENO
 0

	)

212 
	#STDOUT_FILENO
 1

	)

213 
	#STDERR_FILENO
 2

	)

218 
	~<bôs/ty≥s.h
>

220 #i‚def 
__ssize_t_deföed


221 
__ssize_t
 
	tssize_t
;

222 
	#__ssize_t_deföed


	)

225 
	#__√ed_size_t


	)

226 
	#__√ed_NULL


	)

227 
	~<°ddef.h
>

229 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


232 #i‚de‡
__gid_t_deföed


233 
__gid_t
 
	tgid_t
;

234 
	#__gid_t_deföed


	)

237 #i‚de‡
__uid_t_deföed


238 
__uid_t
 
	tuid_t
;

239 
	#__uid_t_deföed


	)

242 #i‚de‡
__off_t_deföed


243 #i‚de‡
__USE_FILE_OFFSET64


244 
__off_t
 
	toff_t
;

246 
__off64_t
 
	toff_t
;

248 
	#__off_t_deföed


	)

250 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


251 
__off64_t
 
	toff64_t
;

252 
	#__off64_t_deföed


	)

255 #i‚de‡
__u£c⁄ds_t_deföed


256 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

257 
	#__u£c⁄ds_t_deföed


	)

260 #i‚de‡
__pid_t_deföed


261 
__pid_t
 
	tpid_t
;

262 
	#__pid_t_deföed


	)

266 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


267 #i‚de‡
__öçå_t_deföed


268 
__öçå_t
 
	töçå_t
;

269 
	#__öçå_t_deföed


	)

273 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


274 #i‚de‡
__sockÀn_t_deföed


275 
__sockÀn_t
 
	tsockÀn_t
;

276 
	#__sockÀn_t_deföed


	)

282 
	#R_OK
 4

	)

283 
	#W_OK
 2

	)

284 
	#X_OK
 1

	)

285 
	#F_OK
 0

	)

288 
	$ac˚ss
 (
__c⁄°
 *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

290 #ifde‡
__USE_GNU


293 
	$euidac˚ss
 (
__c⁄°
 *
__«me
, 
__ty≥
)

294 
__THROW
 
	`__n⁄nuŒ
 ((1));

297 
	$óc˚ss
 (
__c⁄°
 *
__«me
, 
__ty≥
)

298 
__THROW
 
	`__n⁄nuŒ
 ((1));

301 #ifde‡
__USE_ATFILE


305 
	$Ác˚sßt
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__ty≥
, 
__Êag
)

306 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

311 #i‚def 
_STDIO_H


312 
	#SEEK_SET
 0

	)

313 
	#SEEK_CUR
 1

	)

314 
	#SEEK_END
 2

	)

317 #i‡
deföed
 
__USE_BSD
 && !deföed 
L_SET


319 
	#L_SET
 
SEEK_SET


	)

320 
	#L_INCR
 
SEEK_CUR


	)

321 
	#L_XTND
 
SEEK_END


	)

330 #i‚de‡
__USE_FILE_OFFSET64


331 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

333 #ifde‡
__REDIRECT_NTH


334 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

335 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

336 
l£ek64
);

338 
	#l£ek
 
l£ek64


	)

341 #ifde‡
__USE_LARGEFILE64


342 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

343 
__THROW
;

350 
	`˛o£
 (
__fd
);

357 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

363 
ssize_t
 
	$wrôe
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
Ë
__wur
;

365 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


366 #i‚de‡
__USE_FILE_OFFSET64


373 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

374 
__off_t
 
__off£t
Ë
__wur
;

381 
ssize_t
 
	$pwrôe
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
,

382 
__off_t
 
__off£t
Ë
__wur
;

384 #ifde‡
__REDIRECT


385 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

386 
__off64_t
 
__off£t
),

387 
¥ód64
Ë
__wur
;

388 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, 
__c⁄°
 *
__buf
,

389 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

390 
pwrôe64
Ë
__wur
;

392 
	#¥ód
 
¥ód64


	)

393 
	#pwrôe
 
pwrôe64


	)

397 #ifde‡
__USE_LARGEFILE64


401 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

402 
__off64_t
 
__off£t
Ë
__wur
;

405 
ssize_t
 
	$pwrôe64
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
,

406 
__off64_t
 
__off£t
Ë
__wur
;

414 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

416 #ifde‡
__USE_GNU


419 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

429 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

441 
	`¶ìp
 (
__£c⁄ds
);

443 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

444 || 
deföed
 
__USE_BSD


449 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

450 
__THROW
;

457 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

466 
	`∑u£
 ();

470 
	$chown
 (
__c⁄°
 *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

471 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

473 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


475 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

480 
	$lchown
 (
__c⁄°
 *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

481 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

485 #ifde‡
__USE_ATFILE


488 
	$fchow«t
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__uid_t
 
__ow√r
,

489 
__gid_t
 
__group
, 
__Êag
)

490 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

494 
	$chdú
 (
__c⁄°
 *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

496 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


498 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

508 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

510 #ifdef 
__USE_GNU


514 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

517 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

518 || 
deföed
 
__USE_BSD


522 *
	$gëwd
 (*
__buf
)

523 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

528 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

531 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

533 #ifde‡
__USE_GNU


536 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

540 **
__ívú⁄
;

541 #ifde‡
__USE_GNU


542 **
ívú⁄
;

548 
	$execve
 (
__c⁄°
 *
__∑th
, *__c⁄° 
__¨gv
[],

549 *
__c⁄°
 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

551 #ifde‡
__USE_XOPEN2K8


554 
	$„xecve
 (
__fd
, *
__c⁄°
 
__¨gv
[], *__c⁄° 
__ívp
[])

555 
__THROW
 
	`__n⁄nuŒ
 ((2));

560 
	$execv
 (
__c⁄°
 *
__∑th
, *__c⁄° 
__¨gv
[])

561 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

565 
	$exe˛e
 (
__c⁄°
 *
__∑th
, __c⁄° *
__¨g
, ...)

566 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

570 
	$exe˛
 (
__c⁄°
 *
__∑th
, __c⁄° *
__¨g
, ...)

571 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

575 
	$execvp
 (
__c⁄°
 *
__fûe
, *__c⁄° 
__¨gv
[])

576 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

581 
	$exe˛p
 (
__c⁄°
 *
__fûe
, __c⁄° *
__¨g
, ...)

582 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

584 #ifde‡
__USE_GNU


587 
	$execv≥
 (
__c⁄°
 *
__fûe
, *__c⁄° 
__¨gv
[],

588 *
__c⁄°
 
__ívp
[])

589 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

593 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


595 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

600 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

606 
	~<bôs/c⁄‚ame.h
>

609 
	$∑thc⁄f
 (
__c⁄°
 *
__∑th
, 
__«me
)

610 
__THROW
 
	`__n⁄nuŒ
 ((1));

613 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

616 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

618 #ifdef 
__USE_POSIX2


620 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

625 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

628 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

632 #i‚de‡
__FAVOR_BSD


633 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

635 #ifde‡
__REDIRECT_NTH


636 
__pid_t
 
	`__REDIRECT_NTH
 (
gëpgΩ
, (__pid_à
__pid
), 
__gëpgid
);

638 
	#gëpgΩ
 
__gëpgid


	)

643 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

644 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


645 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

652 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

654 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


665 #i‚de‡
__FAVOR_BSD


669 
	$£çgΩ
 (Ë
__THROW
;

674 #ifde‡
__REDIRECT_NTH


675 
	`__REDIRECT_NTH
 (
£çgΩ
, (
__pid_t
 
__pid
, __pid_à
__pgΩ
), 
£çgid
);

677 
	#£çgΩ
 
£çgid


	)

686 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

688 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


690 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

694 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

697 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

700 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

703 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

708 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

710 #ifdef 
__USE_GNU


712 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

719 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
;

721 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


724 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
;

727 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


729 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
;

736 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
;

738 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


741 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
;

744 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


746 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
;

749 #ifde‡
__USE_GNU


752 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

753 
__THROW
;

757 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

758 
__THROW
;

762 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

763 
__THROW
;

767 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

768 
__THROW
;

775 
__pid_t
 
	$f‹k
 (Ë
__THROW
;

777 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

778 || 
deföed
 
__USE_BSD


783 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

789 *
	$ây«me
 (
__fd
Ë
__THROW
;

793 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

794 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

798 
	$ißây
 (
__fd
Ë
__THROW
;

800 #i‡
deföed
 
__USE_BSD
 \

801 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

804 
	$ây¶Ÿ
 (Ë
__THROW
;

809 
	$lök
 (
__c⁄°
 *
__‰om
, __c⁄° *
__to
)

810 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

812 #ifde‡
__USE_ATFILE


815 
	$lök©
 (
__‰omfd
, 
__c⁄°
 *
__‰om
, 
__tofd
,

816 
__c⁄°
 *
__to
, 
__Êags
)

817 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

820 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


822 
	$symlök
 (
__c⁄°
 *
__‰om
, __c⁄° *
__to
)

823 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

828 
ssize_t
 
	$ªadlök
 (
__c⁄°
 *
__ª°ri˘
 
__∑th
,

829 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

830 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

833 #ifde‡
__USE_ATFILE


835 
	$symlök©
 (
__c⁄°
 *
__‰om
, 
__tofd
,

836 
__c⁄°
 *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

839 
ssize_t
 
	$ªadlök©
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__∑th
,

840 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

841 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

845 
	$u∆ök
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

847 #ifde‡
__USE_ATFILE


849 
	$u∆ök©
 (
__fd
, 
__c⁄°
 *
__«me
, 
__Êag
)

850 
__THROW
 
	`__n⁄nuŒ
 ((2));

854 
	$rmdú
 (
__c⁄°
 *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

858 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

861 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

868 *
	`gëlogö
 ();

869 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


876 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

879 #ifdef 
__USE_BSD


881 
	$£éogö
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

885 #ifdef 
__USE_POSIX2


889 
	#__√ed_gë›t


	)

890 
	~<gë›t.h
>

894 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


898 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

902 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_UNIX98
)

905 
	$£tho°«me
 (
__c⁄°
 *
__«me
, 
size_t
 
__Àn
)

906 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

910 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

916 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

917 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

918 
	$£tdomaö«me
 (
__c⁄°
 *
__«me
, 
size_t
 
__Àn
)

919 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

925 
	$vh™gup
 (Ë
__THROW
;

928 
	$ªvoke
 (
__c⁄°
 *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

936 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

937 
size_t
 
__off£t
, 
__sˇÀ
)

938 
__THROW
 
	`__n⁄nuŒ
 ((1));

944 
	$ac˘
 (
__c⁄°
 *
__«me
Ë
__THROW
;

948 *
	$gëu£rshñl
 (Ë
__THROW
;

949 
	$ídu£rshñl
 (Ë
__THROW
;

950 
	$£tu£rshñl
 (Ë
__THROW
;

956 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

960 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

963 
	$chroŸ
 (
__c⁄°
 *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

967 *
	$gë∑ss
 (
__c⁄°
 *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

971 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


976 
	`fsync
 (
__fd
);

980 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


983 
	`gëho°id
 ();

986 
	$sync
 (Ë
__THROW
;

989 #i‡
deföed
 
__USE_BSD
 || !deföed 
__USE_XOPEN2K


992 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

997 
	$gëdèbÀsize
 (Ë
__THROW
;

1003 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


1006 #i‚de‡
__USE_FILE_OFFSET64


1007 
	$åunˇã
 (
__c⁄°
 *
__fûe
, 
__off_t
 
__Àngth
)

1008 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1010 #ifde‡
__REDIRECT_NTH


1011 
	`__REDIRECT_NTH
 (
åunˇã
,

1012 (
__c⁄°
 *
__fûe
, 
__off64_t
 
__Àngth
),

1013 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1015 
	#åunˇã
 
åunˇã64


	)

1018 #ifde‡
__USE_LARGEFILE64


1019 
	$åunˇã64
 (
__c⁄°
 *
__fûe
, 
__off64_t
 
__Àngth
)

1020 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1025 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1028 #i‚de‡
__USE_FILE_OFFSET64


1029 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1031 #ifde‡
__REDIRECT_NTH


1032 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1033 
·runˇã64
Ë
__wur
;

1035 
	#·runˇã
 
·runˇã64


	)

1038 #ifde‡
__USE_LARGEFILE64


1039 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1045 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1046 || 
deföed
 
__USE_MISC


1050 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1056 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1060 #ifde‡
__USE_MISC


1071 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1076 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1088 
	#F_ULOCK
 0

	)

1089 
	#F_LOCK
 1

	)

1090 
	#F_TLOCK
 2

	)

1091 
	#F_TEST
 3

	)

1093 #i‚de‡
__USE_FILE_OFFSET64


1094 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1096 #ifde‡
__REDIRECT


1097 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1098 
lockf64
Ë
__wur
;

1100 
	#lockf
 
lockf64


	)

1103 #ifde‡
__USE_LARGEFILE64


1104 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1109 #ifde‡
__USE_GNU


1114 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1115 (
__exãnsi⁄__
 \

1116 ({ 
__ªsu…
; \

1117 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1118 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1119 
__ªsu…
; 
	}
}))

	)

1122 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1125 
fd©async
 (
__fûdes
);

1131 #ifdef 
__USE_XOPEN


1133 *
	$¸y±
 (
__c⁄°
 *
__key
, __c⁄° *
__ß…
)

1134 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1138 
	$í¸y±
 (*
__libc_block
, 
__edÊag
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1145 
	$swab
 (
__c⁄°
 *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1146 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1152 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


1154 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1159 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


1160 
	~<bôs/uni°d.h
>

1163 
__END_DECLS


	@/usr/include/utime.h

23 #i‚def 
_UTIME_H


24 
	#_UTIME_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


30 
	~<bôs/ty≥s.h
>

32 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


33 
	#__√ed_time_t


	)

34 
	~<time.h
>

38 
	sutimbuf


40 
__time_t
 
	ma˘ime
;

41 
__time_t
 
	mmodtime
;

46 
	$utime
 (
__c⁄°
 *
__fûe
,

47 
__c⁄°
 
utimbuf
 *
__fûe_times
)

48 
__THROW
 
	`__n⁄nuŒ
 ((1));

50 
__END_DECLS


	@/usr/include/vorbis/vorbisfile.h

18 #i‚de‡
_OV_FILE_H_


19 
	#_OV_FILE_H_


	)

21 #ifde‡
__˝lu•lus


26 
	~<°dio.h
>

27 
	~"codec.h
"

40 
size_t
 (*
ªad_func
Ë(*
±r
, size_à
size
, size_à
nmemb
, *
d©asour˚
);

41 (*
£ek_func
Ë(*
d©asour˚
, 
ogg_öt64_t
 
off£t
, 
whí˚
);

42 (*
˛o£_func
Ë(*
d©asour˚
);

43 (*
ãŒ_func
Ë(*
d©asour˚
);

44 } 
	tov_ˇŒbacks
;

46 #i‚de‡
OV_EXCLUDE_STATIC_CALLBACKS


53 
_ov_hódî_f£ek_wøp
(
FILE
 *
f
,
ogg_öt64_t
 
off
,
whí˚
){

54 if(
f
==
NULL
)(-1);

56 #ifde‡
__MINGW32__


57  
f£eko64
(
f
,
off
,
whí˚
);

58 #ñi‡
deföed
 (
_WIN32
)

59  
_f£eki64
(
f
,
off
,
whí˚
);

61  
f£ek
(
f
,
off
,
whí˚
);

75 
ov_ˇŒbacks
 
OV_CALLBACKS_DEFAULT
 = {

76 (
size_t
 (*)(*, size_t, size_t, *)Ë
‰ód
,

77 ((*)(*, 
ogg_öt64_t
, )Ë
_ov_hódî_f£ek_wøp
,

78 ((*)(*)Ë
f˛o£
,

79 ((*)(*)Ë
·ñl


82 
ov_ˇŒbacks
 
OV_CALLBACKS_NOCLOSE
 = {

83 (
size_t
 (*)(*, size_t, size_t, *)Ë
‰ód
,

84 ((*)(*, 
ogg_öt64_t
, )Ë
_ov_hódî_f£ek_wøp
,

85 ((*)(*)Ë
NULL
,

86 ((*)(*)Ë
·ñl


89 
ov_ˇŒbacks
 
OV_CALLBACKS_STREAMONLY
 = {

90 (
size_t
 (*)(*, size_t, size_t, *)Ë
‰ód
,

91 ((*)(*, 
ogg_öt64_t
, )Ë
NULL
,

92 ((*)(*)Ë
f˛o£
,

93 ((*)(*)Ë
NULL


96 
ov_ˇŒbacks
 
OV_CALLBACKS_STREAMONLY_NOCLOSE
 = {

97 (
size_t
 (*)(*, size_t, size_t, *)Ë
‰ód
,

98 ((*)(*, 
ogg_öt64_t
, )Ë
NULL
,

99 ((*)(*)Ë
NULL
,

100 ((*)(*)Ë
NULL


105 
	#NOTOPEN
 0

	)

106 
	#PARTOPEN
 1

	)

107 
	#OPENED
 2

	)

108 
	#STREAMSET
 3

	)

109 
	#INITSET
 4

	)

111 
	sOggV‹bis_Fûe
 {

112 *
d©asour˚
;

113 
£ekabÀ
;

114 
ogg_öt64_t
 
off£t
;

115 
ogg_öt64_t
 
íd
;

116 
ogg_sync_°©e
 
oy
;

120 
löks
;

121 
ogg_öt64_t
 *
off£ts
;

122 
ogg_öt64_t
 *
d©aoff£ts
;

123 *
£rü os
;

124 
ogg_öt64_t
 *
pcmÀngths
;

127 
v‹bis_öfo
 *
vi
;

128 
v‹bis_commít
 *
vc
;

131 
ogg_öt64_t
 
pcm_off£t
;

132 
ªady_°©e
;

133 
cuºít_£rü o
;

134 
cuºít_lök
;

136 
bôåack
;

137 
ßm±øck
;

139 
ogg_°ªam_°©e
 
os
;

141 
v‹bis_d•_°©e
 
vd
;

142 
v‹bis_block
 
vb
;

144 
ov_ˇŒbacks
 
ˇŒbacks
;

146 } 
	tOggV‹bis_Fûe
;

149 
ov_˛ór
(
OggV‹bis_Fûe
 *
vf
);

150 
ov_f›í
(c⁄° *
∑th
,
OggV‹bis_Fûe
 *
vf
);

151 
ov_›í
(
FILE
 *
f
,
OggV‹bis_Fûe
 *
vf
,c⁄° *
öôül
,
ibyãs
);

152 
ov_›í_ˇŒbacks
(*
d©asour˚
, 
OggV‹bis_Fûe
 *
vf
,

153 c⁄° *
öôül
, 
ibyãs
, 
ov_ˇŒbacks
 
ˇŒbacks
);

155 
ov_ã°
(
FILE
 *
f
,
OggV‹bis_Fûe
 *
vf
,c⁄° *
öôül
,
ibyãs
);

156 
ov_ã°_ˇŒbacks
(*
d©asour˚
, 
OggV‹bis_Fûe
 *
vf
,

157 c⁄° *
öôül
, 
ibyãs
, 
ov_ˇŒbacks
 
ˇŒbacks
);

158 
ov_ã°_›í
(
OggV‹bis_Fûe
 *
vf
);

160 
ov_bôøã
(
OggV‹bis_Fûe
 *
vf
,
i
);

161 
ov_bôøã_ö°™t
(
OggV‹bis_Fûe
 *
vf
);

162 
ov_°ªams
(
OggV‹bis_Fûe
 *
vf
);

163 
ov_£ekabÀ
(
OggV‹bis_Fûe
 *
vf
);

164 
ov_£rü umbî
(
OggV‹bis_Fûe
 *
vf
,
i
);

166 
ogg_öt64_t
 
ov_øw_tŸÆ
(
OggV‹bis_Fûe
 *
vf
,
i
);

167 
ogg_öt64_t
 
ov_pcm_tŸÆ
(
OggV‹bis_Fûe
 *
vf
,
i
);

168 
ov_time_tŸÆ
(
OggV‹bis_Fûe
 *
vf
,
i
);

170 
ov_øw_£ek
(
OggV‹bis_Fûe
 *
vf
,
ogg_öt64_t
 
pos
);

171 
ov_pcm_£ek
(
OggV‹bis_Fûe
 *
vf
,
ogg_öt64_t
 
pos
);

172 
ov_pcm_£ek_∑ge
(
OggV‹bis_Fûe
 *
vf
,
ogg_öt64_t
 
pos
);

173 
ov_time_£ek
(
OggV‹bis_Fûe
 *
vf
,
pos
);

174 
ov_time_£ek_∑ge
(
OggV‹bis_Fûe
 *
vf
,
pos
);

176 
ov_øw_£ek_œp
(
OggV‹bis_Fûe
 *
vf
,
ogg_öt64_t
 
pos
);

177 
ov_pcm_£ek_œp
(
OggV‹bis_Fûe
 *
vf
,
ogg_öt64_t
 
pos
);

178 
ov_pcm_£ek_∑ge_œp
(
OggV‹bis_Fûe
 *
vf
,
ogg_öt64_t
 
pos
);

179 
ov_time_£ek_œp
(
OggV‹bis_Fûe
 *
vf
,
pos
);

180 
ov_time_£ek_∑ge_œp
(
OggV‹bis_Fûe
 *
vf
,
pos
);

182 
ogg_öt64_t
 
ov_øw_ãŒ
(
OggV‹bis_Fûe
 *
vf
);

183 
ogg_öt64_t
 
ov_pcm_ãŒ
(
OggV‹bis_Fûe
 *
vf
);

184 
ov_time_ãŒ
(
OggV‹bis_Fûe
 *
vf
);

186 
v‹bis_öfo
 *
ov_öfo
(
OggV‹bis_Fûe
 *
vf
,
lök
);

187 
v‹bis_commít
 *
ov_commít
(
OggV‹bis_Fûe
 *
vf
,
lök
);

189 
ov_ªad_Êﬂt
(
OggV‹bis_Fûe
 *
vf
,***
pcm_ch™√ls
,
ßm∂es
,

190 *
bô°ªam
);

191 
ov_ªad_fûãr
(
OggV‹bis_Fûe
 *
vf
,*
buf„r
,
Àngth
,

192 
bigídü≈
,
w‹d
,
sg√d
,*
bô°ªam
,

193 (*
fûãr
)(**
pcm
,
ch™√ls
,
ßm∂es
,*
fûãr_∑øm
),*filter_param);

194 
ov_ªad
(
OggV‹bis_Fûe
 *
vf
,*
buf„r
,
Àngth
,

195 
bigídü≈
,
w‹d
,
sg√d
,*
bô°ªam
);

196 
ov_¸os¶≠
(
OggV‹bis_Fûe
 *
vf1
,OggV‹bis_Fûê*
vf2
);

198 
ov_hÆ‰©e
(
OggV‹bis_Fûe
 *
vf
,
Êag
);

199 
ov_hÆ‰©e_p
(
OggV‹bis_Fûe
 *
vf
);

201 #ifde‡
__˝lu•lus


	@/usr/include/alloca.h

19 #i‚def 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<„©uªs.h
>

24 
	#__√ed_size_t


	)

25 
	~<°ddef.h
>

27 
	g__BEGIN_DECLS


30 #unde‡
Æloˇ


33 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

35 #ifdef 
__GNUC__


36 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

39 
__END_DECLS


	@/usr/include/features.h

20 #i‚def 
_FEATURES_H


21 
	#_FEATURES_H
 1

	)

97 #unde‡
__USE_ISOC99


98 #unde‡
__USE_ISOC95


99 #unde‡
__USE_POSIX


100 #unde‡
__USE_POSIX2


101 #unde‡
__USE_POSIX199309


102 #unde‡
__USE_POSIX199506


103 #unde‡
__USE_XOPEN


104 #unde‡
__USE_XOPEN_EXTENDED


105 #unde‡
__USE_UNIX98


106 #unde‡
__USE_XOPEN2K


107 #unde‡
__USE_XOPEN2KXSI


108 #unde‡
__USE_XOPEN2K8


109 #unde‡
__USE_XOPEN2K8XSI


110 #unde‡
__USE_LARGEFILE


111 #unde‡
__USE_LARGEFILE64


112 #unde‡
__USE_FILE_OFFSET64


113 #unde‡
__USE_BSD


114 #unde‡
__USE_SVID


115 #unde‡
__USE_MISC


116 #unde‡
__USE_ATFILE


117 #unde‡
__USE_GNU


118 #unde‡
__USE_REENTRANT


119 #unde‡
__USE_FORTIFY_LEVEL


120 #unde‡
__FAVOR_BSD


121 #unde‡
__KERNEL_STRICT_NAMES


125 #i‚de‡
_LOOSE_KERNEL_NAMES


126 
	#__KERNEL_STRICT_NAMES


	)

130 
	#__USE_ANSI
 1

	)

139 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


140 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

141 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

143 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

148 #i‡
deföed
 
_BSD_SOURCE
 && \

149 !(
deföed
 
	g_POSIX_SOURCE
 || deföed 
	g_POSIX_C_SOURCE
 || \

150 
deföed
 
	g_XOPEN_SOURCE
 || deföed 
	g_GNU_SOURCE
 || deföed 
	g_SVID_SOURCE
)

151 
	#__FAVOR_BSD
 1

	)

155 #ifde‡
_GNU_SOURCE


156 #unde‡
_ISOC95_SOURCE


157 
	#_ISOC95_SOURCE
 1

	)

158 #unde‡
_ISOC99_SOURCE


159 
	#_ISOC99_SOURCE
 1

	)

160 #unde‡
_POSIX_SOURCE


161 
	#_POSIX_SOURCE
 1

	)

162 #unde‡
_POSIX_C_SOURCE


163 
	#_POSIX_C_SOURCE
 200809L

	)

164 #unde‡
_XOPEN_SOURCE


165 
	#_XOPEN_SOURCE
 700

	)

166 #unde‡
_XOPEN_SOURCE_EXTENDED


167 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

168 #unde‡
_LARGEFILE64_SOURCE


169 
	#_LARGEFILE64_SOURCE
 1

	)

170 #unde‡
_BSD_SOURCE


171 
	#_BSD_SOURCE
 1

	)

172 #unde‡
_SVID_SOURCE


173 
	#_SVID_SOURCE
 1

	)

174 #unde‡
_ATFILE_SOURCE


175 
	#_ATFILE_SOURCE
 1

	)

180 #i‡(!
deföed
 
__STRICT_ANSI__
 && !deföed 
_ISOC99_SOURCE
 && \

181 !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 && \

182 !
deföed
 
	g_XOPEN_SOURCE
 && !deföed 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
)

183 
	#_BSD_SOURCE
 1

	)

184 
	#_SVID_SOURCE
 1

	)

191 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC9X_SOURCE
 \

192 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

193 
	#__USE_ISOC99
 1

	)

197 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC9X_SOURCE
 \

198 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

199 
	#__USE_ISOC95
 1

	)

204 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

205 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

206 
	#_POSIX_SOURCE
 1

	)

207 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

208 
	#_POSIX_C_SOURCE
 2

	)

209 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

210 
	#_POSIX_C_SOURCE
 199506L

	)

211 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

212 
	#_POSIX_C_SOURCE
 200112L

	)

214 
	#_POSIX_C_SOURCE
 200809L

	)

216 
	#__USE_POSIX_IMPLICITLY
 1

	)

219 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


220 
	#__USE_POSIX
 1

	)

223 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


224 
	#__USE_POSIX2
 1

	)

227 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

228 
	#__USE_POSIX199309
 1

	)

231 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

232 
	#__USE_POSIX199506
 1

	)

235 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

236 
	#__USE_XOPEN2K
 1

	)

237 #unde‡
__USE_ISOC95


238 
	#__USE_ISOC95
 1

	)

239 #unde‡
__USE_ISOC99


240 
	#__USE_ISOC99
 1

	)

243 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200809L

244 
	#__USE_XOPEN2K8
 1

	)

245 #unde‡
_ATFILE_SOURCE


246 
	#_ATFILE_SOURCE
 1

	)

249 #ifdef 
_XOPEN_SOURCE


250 
	#__USE_XOPEN
 1

	)

251 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

252 
	#__USE_XOPEN_EXTENDED
 1

	)

253 
	#__USE_UNIX98
 1

	)

254 #unde‡
_LARGEFILE_SOURCE


255 
	#_LARGEFILE_SOURCE
 1

	)

256 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

257 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

258 
	#__USE_XOPEN2K8
 1

	)

259 
	#__USE_XOPEN2K8XSI
 1

	)

261 
	#__USE_XOPEN2K
 1

	)

262 
	#__USE_XOPEN2KXSI
 1

	)

263 #unde‡
__USE_ISOC95


264 
	#__USE_ISOC95
 1

	)

265 #unde‡
__USE_ISOC99


266 
	#__USE_ISOC99
 1

	)

269 #ifde‡
_XOPEN_SOURCE_EXTENDED


270 
	#__USE_XOPEN_EXTENDED
 1

	)

275 #ifde‡
_LARGEFILE_SOURCE


276 
	#__USE_LARGEFILE
 1

	)

279 #ifde‡
_LARGEFILE64_SOURCE


280 
	#__USE_LARGEFILE64
 1

	)

283 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

284 
	#__USE_FILE_OFFSET64
 1

	)

287 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


288 
	#__USE_MISC
 1

	)

291 #ifdef 
_BSD_SOURCE


292 
	#__USE_BSD
 1

	)

295 #ifdef 
_SVID_SOURCE


296 
	#__USE_SVID
 1

	)

299 #ifdef 
_ATFILE_SOURCE


300 
	#__USE_ATFILE
 1

	)

303 #ifdef 
_GNU_SOURCE


304 
	#__USE_GNU
 1

	)

307 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


308 
	#__USE_REENTRANT
 1

	)

311 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

312 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

313 #i‡
_FORTIFY_SOURCE
 > 1

314 
	#__USE_FORTIFY_LEVEL
 2

	)

316 
	#__USE_FORTIFY_LEVEL
 1

	)

319 
	#__USE_FORTIFY_LEVEL
 0

	)

323 
	~<bôs/¥edefs.h
>

326 
	#__STDC_ISO_10646__
 200009L

	)

334 #unde‡
__GNU_LIBRARY__


335 
	#__GNU_LIBRARY__
 6

	)

339 
	#__GLIBC__
 2

	)

340 
	#__GLIBC_MINOR__
 13

	)

342 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

343 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

346 #i‡
deföed
 
__GNUC__
 \

347 || (
deföed
 
	g__PGI
 && deföed 
	g__i386__
 ) \

348 || (
deföed
 
	g__INTEL_COMPILER
 && (deföed 
	g__i386__
 || deföed 
	g__ü64__
)) \

349 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

350 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

354 #i‚de‡
__ASSEMBLER__


355 #i‚de‡
_SYS_CDEFS_H


356 
	~<sys/cdefs.h
>

361 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


362 
	#__USE_LARGEFILE
 1

	)

363 
	#__USE_LARGEFILE64
 1

	)

369 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

370 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

371 && 
deföed
 
	g__exã∫_ölöe


372 
	#__USE_EXTERN_INLINES
 1

	)

377 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

378 && (
deföed
 
	g_LIBC
 || !deföed 
	g__OPTIMIZE_SIZE__
Ë&& !deföed 
	g__NO_INLINE__
 \

379 && 
deföed
 
	g__exã∫_ölöe


380 
	#__USE_EXTERN_INLINES_IN_LIBC
 1

	)

388 
	~<gnu/°ubs.h
>

	@/usr/include/libio.h

29 #i‚de‡
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_c⁄fig.h
>

34 
	#_IO_pos_t
 
_G_Âos_t


	)

35 
	#_IO_Âos_t
 
_G_Âos_t


	)

36 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li°
 
_G_va_li°


	)

48 
	#_IO_wöt_t
 
_G_wöt_t


	)

50 #ifde‡
_G_NEED_STDARG_H


52 
	#__√ed___va_li°


	)

53 
	~<°d¨g.h
>

54 #ifde‡
__GNUC_VA_LIST


55 #unde‡
_IO_va_li°


56 
	#_IO_va_li°
 
__gnuc_va_li°


	)

60 #i‚de‡
__P


61 #i‡
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifde‡
__STDC__


65 
	#__P
(
p
Ë
	)
p

66 
	#__PMT
(
p
Ë
	)
p

68 
	#__P
(
p
Ë()

	)

69 
	#__PMT
(
p
Ë()

	)

75 #i‚de‡
_PARAMS


76 
	#_PARAMS
(
¥Ÿos
Ë
	`__P
’rŸos)

	)

79 #i‚de‡
__STDC__


81 c⁄°

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #i‚de‡
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #i‚de‡
EOF


90 
	#EOF
 (-1)

	)

92 #i‚de‡
NULL


93 #i‡
deföed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuŒ
)

	)

97 #i‡!
deföed
(
__˝lu•lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifde‡
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifde‡
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

151 
	#_IO_SKIPWS
 01

	)

152 
	#_IO_LEFT
 02

	)

153 
	#_IO_RIGHT
 04

	)

154 
	#_IO_INTERNAL
 010

	)

155 
	#_IO_DEC
 020

	)

156 
	#_IO_OCT
 040

	)

157 
	#_IO_HEX
 0100

	)

158 
	#_IO_SHOWBASE
 0200

	)

159 
	#_IO_SHOWPOINT
 0400

	)

160 
	#_IO_UPPERCASE
 01000

	)

161 
	#_IO_SHOWPOS
 02000

	)

162 
	#_IO_SCIENTIFIC
 04000

	)

163 
	#_IO_FIXED
 010000

	)

164 
	#_IO_UNITBUF
 020000

	)

165 
	#_IO_STDIO
 040000

	)

166 
	#_IO_DONT_CLOSE
 0100000

	)

167 
	#_IO_BOOLALPHA
 0200000

	)

170 
_IO_jump_t
; 
	g_IO_FILE
;

173 #ifde‡
_IO_MTSAFE_IO


174 #i‡
deföed
 
__GLIBC__
 && __GLIBC__ >= 2

175 
	~<bôs/°dio-lock.h
>

180 
	t_IO_lock_t
;

186 
	s_IO_m¨kî
 {

187 
_IO_m¨kî
 *
	m_√xt
;

188 
_IO_FILE
 *
	m_sbuf
;

192 
	m_pos
;

194 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

195 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

196 
	mpublic
:

197 
°ªamm¨kî
(
°ªambuf
 *
sb
);

198 ~
°ªamm¨kî
();

199 
ßvög
(Ë{  
	m_•os
 == -2; }

200 
dñè
(
°ªamm¨kî
&);

201 
dñè
();

206 
	e__codecvt_ªsu…


208 
	m__codecvt_ok
,

209 
	m__codecvt_∑πül
,

210 
	m__codecvt_îr‹
,

211 
	m__codecvt_noc⁄v


214 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


217 
	s_IO_codecvt


219 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

220 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

221 
	m__mb°©e_t
 *,

222 c⁄° 
	mwch¨_t
 *,

223 c⁄° 
	mwch¨_t
 *,

224 c⁄° 
	mwch¨_t
 **, *,

226 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

227 
	m__mb°©e_t
 *, *,

229 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

230 
	m__mb°©e_t
 *,

232 c⁄° **, 
	mwch¨_t
 *,

233 
	mwch¨_t
 *, wchar_t **);

234 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

235 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

236 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

237 c⁄° *, c⁄° *, 
	m_IO_size_t
);

238 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

240 
_IO_ic⁄v_t
 
	m__cd_ö
;

241 
_IO_ic⁄v_t
 
	m__cd_out
;

245 
	s_IO_wide_d©a


247 
wch¨_t
 *
	m_IO_ªad_±r
;

248 
wch¨_t
 *
	m_IO_ªad_íd
;

249 
wch¨_t
 *
	m_IO_ªad_ba£
;

250 
wch¨_t
 *
	m_IO_wrôe_ba£
;

251 
wch¨_t
 *
	m_IO_wrôe_±r
;

252 
wch¨_t
 *
	m_IO_wrôe_íd
;

253 
wch¨_t
 *
	m_IO_buf_ba£
;

254 
wch¨_t
 *
	m_IO_buf_íd
;

256 
wch¨_t
 *
	m_IO_ßve_ba£
;

257 
wch¨_t
 *
	m_IO_backup_ba£
;

259 
wch¨_t
 *
	m_IO_ßve_íd
;

261 
__mb°©e_t
 
	m_IO_°©e
;

262 
__mb°©e_t
 
	m_IO_œ°_°©e
;

263 
_IO_codecvt
 
	m_codecvt
;

265 
wch¨_t
 
	m_sh‹tbuf
[1];

267 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

271 
	s_IO_FILE
 {

272 
	m_Êags
;

273 
	#_IO_fûe_Êags
 
_Êags


	)

277 * 
	m_IO_ªad_±r
;

278 * 
	m_IO_ªad_íd
;

279 * 
	m_IO_ªad_ba£
;

280 * 
	m_IO_wrôe_ba£
;

281 * 
	m_IO_wrôe_±r
;

282 * 
	m_IO_wrôe_íd
;

283 * 
	m_IO_buf_ba£
;

284 * 
	m_IO_buf_íd
;

286 *
	m_IO_ßve_ba£
;

287 *
	m_IO_backup_ba£
;

288 *
	m_IO_ßve_íd
;

290 
_IO_m¨kî
 *
	m_m¨kîs
;

292 
_IO_FILE
 *
	m_chaö
;

294 
	m_fûío
;

296 
	m_blksize
;

298 
	m_Êags2
;

300 
_IO_off_t
 
	m_ﬁd_off£t
;

302 
	#__HAVE_COLUMN


	)

304 
	m_cur_cﬁumn
;

305 sig√d 
	m_vèbÀ_off£t
;

306 
	m_sh‹tbuf
[1];

310 
_IO_lock_t
 *
	m_lock
;

311 #ifde‡
_IO_USE_OLD_IO_FILE


314 
	s_IO_FILE_com∂ëe


316 
_IO_FILE
 
	m_fûe
;

318 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

319 
_IO_off64_t
 
	m_off£t
;

320 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


322 
_IO_codecvt
 *
	m_codecvt
;

323 
_IO_wide_d©a
 *
	m_wide_d©a
;

324 
_IO_FILE
 *
	m_‰ìªs_li°
;

325 *
	m_‰ìªs_buf
;

326 
size_t
 
	m_‰ìªs_size
;

328 *
	m__∑d1
;

329 *
	m__∑d2
;

330 *
	m__∑d3
;

331 *
	m__∑d4
;

332 
size_t
 
	m__∑d5
;

334 
	m_mode
;

336 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

340 #i‚de‡
__˝lu•lus


341 
_IO_FILE
 
	t_IO_FILE
;

344 
	g_IO_FILE_∂us
;

346 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

347 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

348 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

349 #i‚de‡
_LIBC


350 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

351 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

352 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

354 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

355 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

356 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

364 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

372 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, 
	t__c⁄°
 *
	t__buf
,

373 
	tsize_t
 
	t__n
);

381 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

384 
	t__io_˛o£_‚
 (*
	t__cookõ
);

387 #ifde‡
_GNU_SOURCE


389 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

390 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

391 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

392 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

397 
__io_ªad_‚
 *
	mªad
;

398 
__io_wrôe_‚
 *
	mwrôe
;

399 
__io_£ek_‚
 *
	m£ek
;

400 
__io_˛o£_‚
 *
	m˛o£
;

401 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

402 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

404 
	g_IO_cookõ_fûe
;

407 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

408 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

412 #ifde‡
__˝lu•lus


416 
__undîÊow
 (
_IO_FILE
 *);

417 
__uÊow
 (
_IO_FILE
 *);

418 
__ovîÊow
 (
_IO_FILE
 *, );

419 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


420 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

421 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

422 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

425 #i‡ 
__GNUC__
 >= 3

426 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

428 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

431 
	#_IO_gëc_u∆ocked
(
_Â
) \

432 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

433 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

434 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

435 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

436 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

437 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

438 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

439 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

440 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

441 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

443 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


444 
	#_IO_gëwc_u∆ocked
(
_Â
) \

445 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

446 || ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 \

447 >(
_Â
)->
_wide_d©a
->
_IO_ªad_íd
), 0) \

448 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

449 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

450 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

451 || ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

452 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
), 0) \

453 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

454 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

457 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

458 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

460 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

461 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

462 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

463 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

465 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

468 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

469 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

471 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

472 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

473 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

475 #ifde‡
_IO_MTSAFE_IO


476 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

477 
	#_IO_Êockfûe
(
_Â
) \

478 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

479 
	#_IO_fu∆ockfûe
(
_Â
) \

480 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

482 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

483 
	#_IO_Êockfûe
(
_Â
Ë

	)

484 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

485 
	#_IO_·rylockfûe
(
_Â
Ë

	)

486 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

487 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

490 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

491 
_IO_va_li°
, *
__ª°ri˘
);

492 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

493 
_IO_va_li°
);

494 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

495 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

497 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

498 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

500 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

502 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


503 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

504 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

505 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

506 #i‡
__GNUC__
 >= 2

509 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


510 
	~<shlib-com∑t.h
>

511 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

512 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

513 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

514 c⁄° 
_IO_°dö_u£d
;

515 
wók_exã∫
 (
_IO_°dö_u£d
);

518 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


519 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

523 
	#_IO_fwide
(
__Â
, 
__mode
) \

524 ({ 
__ªsu…
 = (
__mode
); \

525 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

527 i‡((
__Â
)->
_mode
 == 0) \

529 (
__Â
)->
_mode
 = -1; \

530 
__ªsu…
 = (
__Â
)->
_mode
; \

532 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

533 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

535 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

536 
__ªsu…
; })

	)

539 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

540 
_IO_va_li°
, *
__ª°ri˘
);

541 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

542 
_IO_va_li°
);

543 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

544 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

547 #ifde‡
__LDBL_COMPAT


548 
	~<bôs/libio-ldbl.h
>

551 #ifde‡
__˝lu•lus


	@/usr/include/linux/if_ether.h

21 #i‚de‡
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<löux/ty≥s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_IP
 0x0800

	)

46 
	#ETH_P_X25
 0x0805

	)

47 
	#ETH_P_ARP
 0x0806

	)

48 
	#ETH_P_BPQ
 0x08FF

	)

49 
	#ETH_P_IEEEPUP
 0x0a00

	)

50 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

51 
	#ETH_P_DEC
 0x6000

	)

52 
	#ETH_P_DNA_DL
 0x6001

	)

53 
	#ETH_P_DNA_RC
 0x6002

	)

54 
	#ETH_P_DNA_RT
 0x6003

	)

55 
	#ETH_P_LAT
 0x6004

	)

56 
	#ETH_P_DIAG
 0x6005

	)

57 
	#ETH_P_CUST
 0x6006

	)

58 
	#ETH_P_SCA
 0x6007

	)

59 
	#ETH_P_TEB
 0x6558

	)

60 
	#ETH_P_RARP
 0x8035

	)

61 
	#ETH_P_ATALK
 0x809B

	)

62 
	#ETH_P_AARP
 0x80F3

	)

63 
	#ETH_P_8021Q
 0x8100

	)

64 
	#ETH_P_IPX
 0x8137

	)

65 
	#ETH_P_IPV6
 0x86DD

	)

66 
	#ETH_P_PAUSE
 0x8808

	)

67 
	#ETH_P_SLOW
 0x8809

	)

68 
	#ETH_P_WCCP
 0x883E

	)

70 
	#ETH_P_PPP_DISC
 0x8863

	)

71 
	#ETH_P_PPP_SES
 0x8864

	)

72 
	#ETH_P_MPLS_UC
 0x8847

	)

73 
	#ETH_P_MPLS_MC
 0x8848

	)

74 
	#ETH_P_ATMMPOA
 0x884¯

	)

75 
	#ETH_P_LINK_CTL
 0x886¯

	)

76 
	#ETH_P_ATMFATE
 0x8884

	)

79 
	#ETH_P_PAE
 0x888E

	)

80 
	#ETH_P_AOE
 0x88A2

	)

81 
	#ETH_P_8021AD
 0x88A8

	)

82 
	#ETH_P_TIPC
 0x88CA

	)

83 
	#ETH_P_8021AH
 0x88E7

	)

84 
	#ETH_P_1588
 0x88F7

	)

85 
	#ETH_P_FCOE
 0x8906

	)

86 
	#ETH_P_TDLS
 0x890D

	)

87 
	#ETH_P_FIP
 0x8914

	)

88 
	#ETH_P_QINQ1
 0x9100

	)

89 
	#ETH_P_QINQ2
 0x9200

	)

90 
	#ETH_P_QINQ3
 0x9300

	)

91 
	#ETH_P_EDSA
 0xDADA

	)

92 
	#ETH_P_AF_IUCV
 0xFBFB

	)

98 
	#ETH_P_802_3
 0x0001

	)

99 
	#ETH_P_AX25
 0x0002

	)

100 
	#ETH_P_ALL
 0x0003

	)

101 
	#ETH_P_802_2
 0x0004

	)

102 
	#ETH_P_SNAP
 0x0005

	)

103 
	#ETH_P_DDCMP
 0x0006

	)

104 
	#ETH_P_WAN_PPP
 0x0007

	)

105 
	#ETH_P_PPP_MP
 0x0008

	)

106 
	#ETH_P_LOCALTALK
 0x0009

	)

107 
	#ETH_P_CAN
 0x000C

	)

108 
	#ETH_P_PPPTALK
 0x0010

	)

109 
	#ETH_P_TR_802_2
 0x0011

	)

110 
	#ETH_P_MOBITEX
 0x0015

	)

111 
	#ETH_P_CONTROL
 0x0016

	)

112 
	#ETH_P_IRDA
 0x0017

	)

113 
	#ETH_P_ECONET
 0x0018

	)

114 
	#ETH_P_HDLC
 0x0019

	)

115 
	#ETH_P_ARCNET
 0x001A

	)

116 
	#ETH_P_DSA
 0x001B

	)

117 
	#ETH_P_TRAILER
 0x001C

	)

118 
	#ETH_P_PHONET
 0x00F5

	)

119 
	#ETH_P_IEEE802154
 0x00F6

	)

120 
	#ETH_P_CAIF
 0x00F7

	)

126 
	sëhhdr
 {

127 
	mh_de°
[
ETH_ALEN
];

128 
	mh_sour˚
[
ETH_ALEN
];

129 
__be16
 
	mh_¥Ÿo
;

130 } 
__©åibuã__
((
∑cked
));

	@/usr/include/net/ethernet.h

22 #i‚de‡
__NET_ETHERNET_H


23 
	#__NET_ETHERNET_H
 1

	)

25 
	~<sys/cdefs.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<löux/if_ëhî.h
>

29 
__BEGIN_DECLS


33 
	sëhî_addr


35 
u_öt8_t
 
	mëhî_addr_o˘ë
[
ETH_ALEN
];

36 } 
__©åibuã__
 ((
__∑cked__
));

39 
	sëhî_hódî


41 
u_öt8_t
 
	mëhî_dho°
[
ETH_ALEN
];

42 
u_öt8_t
 
	mëhî_sho°
[
ETH_ALEN
];

43 
u_öt16_t
 
	mëhî_ty≥
;

44 } 
__©åibuã__
 ((
__∑cked__
));

47 
	#ETHERTYPE_PUP
 0x0200

	)

48 
	#ETHERTYPE_SPRITE
 0x0500

	)

49 
	#ETHERTYPE_IP
 0x0800

	)

50 
	#ETHERTYPE_ARP
 0x0806

	)

51 
	#ETHERTYPE_REVARP
 0x8035

	)

52 
	#ETHERTYPE_AT
 0x809B

	)

53 
	#ETHERTYPE_AARP
 0x80F3

	)

54 
	#ETHERTYPE_VLAN
 0x8100

	)

55 
	#ETHERTYPE_IPX
 0x8137

	)

56 
	#ETHERTYPE_IPV6
 0x86dd

	)

57 
	#ETHERTYPE_LOOPBACK
 0x9000

	)

60 
	#ETHER_ADDR_LEN
 
ETH_ALEN


	)

61 
	#ETHER_TYPE_LEN
 2

	)

62 
	#ETHER_CRC_LEN
 4

	)

63 
	#ETHER_HDR_LEN
 
ETH_HLEN


	)

64 
	#ETHER_MIN_LEN
 (
ETH_ZLEN
 + 
ETHER_CRC_LEN
Ë

	)

65 
	#ETHER_MAX_LEN
 (
ETH_FRAME_LEN
 + 
ETHER_CRC_LEN
Ë

	)

68 
	#ETHER_IS_VALID_LEN
(
foo
) \

69 ((
foo
Ë>
ETHER_MIN_LEN
 && (fooË<
ETHER_MAX_LEN
)

	)

76 
	#ETHERTYPE_TRAIL
 0x1000

	)

77 
	#ETHERTYPE_NTRAILER
 16

	)

79 
	#ETHERMTU
 
ETH_DATA_LEN


	)

80 
	#ETHERMIN
 (
ETHER_MIN_LEN
 - 
ETHER_HDR_LEN
 - 
ETHER_CRC_LEN
)

	)

82 
	g__END_DECLS


	@/usr/include/net/if_arp.h

23 #i‚de‡
_NET_IF_ARP_H


25 
	#_NET_IF_ARP_H
 1

	)

26 
	~<sys/cdefs.h
>

28 
	~<sys/ty≥s.h
>

29 
	~<sys/sockë.h
>

31 
	g__BEGIN_DECLS


34 
	#MAX_ADDR_LEN
 7

	)

40 
	#ARPOP_REQUEST
 1

	)

41 
	#ARPOP_REPLY
 2

	)

42 
	#ARPOP_RREQUEST
 3

	)

43 
	#ARPOP_RREPLY
 4

	)

44 
	#ARPOP_InREQUEST
 8

	)

45 
	#ARPOP_InREPLY
 9

	)

46 
	#ARPOP_NAK
 10

	)

55 
	s¨phdr


57 
	m¨_hrd
;

58 
	m¨_¥o
;

59 
	m¨_h 
;

60 
	m¨_∂n
;

61 
	m¨_›
;

65 
	m__¨_sha
[
ETH_ALEN
];

66 
	m__¨_sù
[4];

67 
	m__¨_tha
[
ETH_ALEN
];

68 
	m__¨_tù
[4];

74 
	#ARPHRD_NETROM
 0

	)

75 
	#ARPHRD_ETHER
 1

	)

76 
	#ARPHRD_EETHER
 2

	)

77 
	#ARPHRD_AX25
 3

	)

78 
	#ARPHRD_PRONET
 4

	)

79 
	#ARPHRD_CHAOS
 5

	)

80 
	#ARPHRD_IEEE802
 6

	)

81 
	#ARPHRD_ARCNET
 7

	)

82 
	#ARPHRD_APPLETLK
 8

	)

83 
	#ARPHRD_DLCI
 15

	)

84 
	#ARPHRD_ATM
 19

	)

85 
	#ARPHRD_METRICOM
 23

	)

86 
	#ARPHRD_IEEE1394
 24

	)

87 
	#ARPHRD_EUI64
 27

	)

88 
	#ARPHRD_INFINIBAND
 32

	)

91 
	#ARPHRD_SLIP
 256

	)

92 
	#ARPHRD_CSLIP
 257

	)

93 
	#ARPHRD_SLIP6
 258

	)

94 
	#ARPHRD_CSLIP6
 259

	)

95 
	#ARPHRD_RSRVD
 260

	)

96 
	#ARPHRD_ADAPT
 264

	)

97 
	#ARPHRD_ROSE
 270

	)

98 
	#ARPHRD_X25
 271

	)

99 
	#ARPHRD_HWX25
 272

	)

100 
	#ARPHRD_PPP
 512

	)

101 
	#ARPHRD_CISCO
 513

	)

102 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

103 
	#ARPHRD_LAPB
 516

	)

104 
	#ARPHRD_DDCMP
 517

	)

105 
	#ARPHRD_RAWHDLC
 518

	)

107 
	#ARPHRD_TUNNEL
 768

	)

108 
	#ARPHRD_TUNNEL6
 769

	)

109 
	#ARPHRD_FRAD
 770

	)

110 
	#ARPHRD_SKIP
 771

	)

111 
	#ARPHRD_LOOPBACK
 772

	)

112 
	#ARPHRD_LOCALTLK
 773

	)

113 
	#ARPHRD_FDDI
 774

	)

114 
	#ARPHRD_BIF
 775

	)

115 
	#ARPHRD_SIT
 776

	)

116 
	#ARPHRD_IPDDP
 777

	)

117 
	#ARPHRD_IPGRE
 778

	)

118 
	#ARPHRD_PIMREG
 779

	)

119 
	#ARPHRD_HIPPI
 780

	)

120 
	#ARPHRD_ASH
 781

	)

121 
	#ARPHRD_ECONET
 782

	)

122 
	#ARPHRD_IRDA
 783

	)

123 
	#ARPHRD_FCPP
 784

	)

124 
	#ARPHRD_FCAL
 785

	)

125 
	#ARPHRD_FCPL
 786

	)

126 
	#ARPHRD_FCFABRIC
 787

	)

127 
	#ARPHRD_IEEE802_TR
 800

	)

128 
	#ARPHRD_IEEE80211
 801

	)

129 
	#ARPHRD_IEEE80211_PRISM
 802

	)

130 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

131 
	#ARPHRD_IEEE802154
 804

	)

132 
	#ARPHRD_IEEE802154_PHY
 805

	)

134 
	#ARPHRD_VOID
 0xFFFF

	)

135 
	#ARPHRD_NONE
 0xFFFE

	)

139 
	s¨¥eq


141 
sockaddr
 
	m¨p_∑
;

142 
sockaddr
 
	m¨p_ha
;

143 
	m¨p_Êags
;

144 
sockaddr
 
	m¨p_√tmask
;

145 
	m¨p_dev
[16];

148 
	s¨¥eq_ﬁd


150 
sockaddr
 
	m¨p_∑
;

151 
sockaddr
 
	m¨p_ha
;

152 
	m¨p_Êags
;

153 
sockaddr
 
	m¨p_√tmask
;

157 
	#ATF_COM
 0x02

	)

158 
	#ATF_PERM
 0x04

	)

159 
	#ATF_PUBL
 0x08

	)

160 
	#ATF_USETRAILERS
 0x10

	)

161 
	#ATF_NETMASK
 0x20

	)

163 
	#ATF_DONTPUB
 0x40

	)

164 
	#ATF_MAGIC
 0x80

	)

168 
	#ARPD_UPDATE
 0x01

	)

169 
	#ARPD_LOOKUP
 0x02

	)

170 
	#ARPD_FLUSH
 0x03

	)

172 
	s¨pd_ªque°


174 
	mªq
;

175 
u_öt32_t
 
	mù
;

176 
	mdev
;

177 
	m°amp
;

178 
	mupd©ed
;

179 
	mha
[
MAX_ADDR_LEN
];

182 
	g__END_DECLS


	@/usr/include/rpc/auth_des.h

19 #i‚de‡
_RPC_AUTH_DES_H


20 
	#_RPC_AUTH_DES_H
 1

	)

22 
	~<sys/cdefs.h
>

23 
	~<Ωc/auth.h
>

25 
__BEGIN_DECLS


28 
	eauthdes_«meköd


30 
	mADN_FULLNAME
,

31 
	mADN_NICKNAME


36 
	sauthdes_fuŒ«me


38 *
	m«me
;

39 
des_block
 
	mkey
;

40 
uöt32_t
 
	mwödow
;

44 
	sauthdes_¸ed


46 
authdes_«meköd
 
	madc_«meköd
;

47 
authdes_fuŒ«me
 
	madc_fuŒ«me
;

48 
uöt32_t
 
	madc_nick«me
;

52 
	sΩc_timevÆ


54 
uöt32_t
 
	mtv_£c
;

55 
uöt32_t
 
	mtv_u£c
;

59 
	sauthdes_vîf


63 
Ωc_timevÆ
 
	madv_˘ime
;

64 
des_block
 
	madv_xtime
;

66 
	madv_time_u
;

67 
uöt32_t
 
	madv_öt_u
;

75 
	#adv_time°amp
 
adv_time_u
.
adv_˘ime


	)

76 
	#adv_xtime°amp
 
adv_time_u
.
adv_xtime


	)

77 
	#adv_wövîf
 
adv_öt_u


	)

84 
	#adv_timevîf
 
adv_time_u
.
adv_˘ime


	)

85 
	#adv_xtimevîf
 
adv_time_u
.
adv_xtime


	)

86 
	#adv_nick«me
 
adv_öt_u


	)

89 
	$authdes_gëu¸ed
 (
__c⁄°
 
authdes_¸ed
 * 
__adc
,

90 
uid_t
 * 
__uid
, 
gid_t
 * 
__gid
,

91 *
__grou∂í
, 
gid_t
 * 
__groups
Ë
__THROW
;

96 
	$gëpublickey
 (
__c⁄°
 *
__«me
, *
__key
Ë
__THROW
;

103 
	$gë£¸ëkey
 (
__c⁄°
 *
__«me
, *
__key
,

104 
__c⁄°
 *
__∑sswd
Ë
__THROW
;

106 
	$πime
 (
sockaddr_ö
 *
__addΩ
, 
Ωc_timevÆ
 *
__timï
,

107 
Ωc_timevÆ
 *
__timeout
Ë
__THROW
;

109 
__END_DECLS


	@/usr/include/rpc/auth_unix.h

41 #i‚de‡
_RPC_AUTH_UNIX_H


42 
	#_RPC_AUTH_UNIX_H
 1

	)

44 
	~<„©uªs.h
>

45 
	~<sys/ty≥s.h
>

46 
	~<Ωc/ty≥s.h
>

47 
	~<Ωc/auth.h
>

48 
	~<Ωc/xdr.h
>

50 
	g__BEGIN_DECLS


53 
	#MAX_MACHINE_NAME
 255

	)

56 
	#NGRPS
 16

	)

61 
	sauthunix_∑rms


63 
u_l⁄g
 
	maup_time
;

64 *
	maup_mach«me
;

65 
__uid_t
 
	maup_uid
;

66 
__gid_t
 
	maup_gid
;

67 
u_öt
 
	maup_Àn
;

68 
__gid_t
 *
	maup_gids
;

71 
boﬁ_t
 
	$xdr_authunix_∑rms
 (
XDR
 *
__xdrs
, 
authunix_∑rms
 *
__p
)

72 
__THROW
;

79 
	ssh‹t_h™d_vîf


81 
›aque_auth
 
√w_¸ed
;

84 
__END_DECLS


	@/usr/include/rpc/clnt.h

34 #i‚de‡
_RPC_CLNT_H


35 
	#_RPC_CLNT_H
 1

	)

37 
	~<„©uªs.h
>

38 
	~<sys/ty≥s.h
>

39 
	~<Ωc/ty≥s.h
>

40 
	~<Ωc/auth.h
>

41 
	~<sys/un.h
>

43 
__BEGIN_DECLS


50 
	e˛¡_°©
 {

51 
	mRPC_SUCCESS
=0,

55 
	mRPC_CANTENCODEARGS
=1,

56 
	mRPC_CANTDECODERES
=2,

57 
	mRPC_CANTSEND
=3,

58 
	mRPC_CANTRECV
=4,

59 
	mRPC_TIMEDOUT
=5,

63 
	mRPC_VERSMISMATCH
=6,

64 
	mRPC_AUTHERROR
=7,

65 
	mRPC_PROGUNAVAIL
=8,

66 
	mRPC_PROGVERSMISMATCH
=9,

67 
	mRPC_PROCUNAVAIL
=10,

68 
	mRPC_CANTDECODEARGS
=11,

69 
	mRPC_SYSTEMERROR
=12,

70 
	mRPC_NOBROADCAST
 = 21,

74 
	mRPC_UNKNOWNHOST
=13,

75 
	mRPC_UNKNOWNPROTO
=17,

76 
	mRPC_UNKNOWNADDR
 = 19,

81 
	mRPC_RPCBFAILURE
=14,

82 
	#RPC_PMAPFAILURE
 
RPC_RPCBFAILURE


	)

83 
	mRPC_PROGNOTREGISTERED
=15,

84 
	mRPC_N2AXLATEFAILURE
 = 22,

88 
	mRPC_FAILED
=16,

89 
	mRPC_INTR
=18,

90 
	mRPC_TLIERROR
=20,

91 
	mRPC_UDERROR
=23,

95 
	mRPC_INPROGRESS
 = 24,

96 
	mRPC_STALERACHANDLE
 = 25

103 
	sΩc_îr
 {

104 
˛¡_°©
 
	mª_°©us
;

106 
	mRE_î∫o
;

107 
auth_°©
 
	mRE_why
;

109 
u_l⁄g
 
	mlow
;

110 
u_l⁄g
 
	mhigh
;

111 } 
	mRE_vîs
;

113 
	ms1
;

114 
	ms2
;

115 } 
	mRE_lb
;

116 } 
	mru
;

117 
	#ª_î∫o
 
ru
.
RE_î∫o


	)

118 
	#ª_why
 
ru
.
RE_why


	)

119 
	#ª_vîs
 
ru
.
RE_vîs


	)

120 
	#ª_lb
 
ru
.
RE_lb


	)

129 
CLIENT
 
	tCLIENT
;

130 
	sCLIENT
 {

131 
AUTH
 *
	m˛_auth
;

132 
	s˛¡_›s
 {

133 
˛¡_°©
 (*
˛_ˇŒ
Ë(
	mCLIENT
 *, 
	mu_l⁄g
, 
	mxdΩroc_t
, 
	mˇddr_t
, xdrproc_t,

134 
	mˇddr_t
, 
	mtimevÆ
);

136 (*
	m˛_ab‹t
) ();

137 (*
	m˛_gëîr
Ë(
	mCLIENT
 *, 
	mΩc_îr
 *);

139 
boﬁ_t
 (*
˛_‰ìªs
Ë(
	mCLIENT
 *, 
	mxdΩroc_t
, 
	mˇddr_t
);

141 (*
	m˛_de°roy
Ë(
	mCLIENT
 *);

142 
boﬁ_t
 (*
˛_c⁄åﬁ
Ë(
	mCLIENT
 *, , *);

144 } *
	m˛_›s
;

145 
ˇddr_t
 
	m˛_¥iv©e
;

167 
	#CLNT_CALL
(
rh
, 
¥oc
, 
x¨gs
, 
¨g•
, 
xªs
, 
ª•
, 
£cs
) \

168 ((*(
rh
)->
˛_›s
->
˛_ˇŒ
)‘h, 
¥oc
, 
x¨gs
, 
¨g•
, 
xªs
, 
ª•
, 
£cs
))

	)

169 
	#˛¡_ˇŒ
(
rh
, 
¥oc
, 
x¨gs
, 
¨g•
, 
xªs
, 
ª•
, 
£cs
) \

170 ((*(
rh
)->
˛_›s
->
˛_ˇŒ
)‘h, 
¥oc
, 
x¨gs
, 
¨g•
, 
xªs
, 
ª•
, 
£cs
))

	)

177 
	#CLNT_ABORT
(
rh
Ë((*‘h)->
˛_›s
->
˛_ab‹t
)‘h))

	)

178 
	#˛¡_ab‹t
(
rh
Ë((*‘h)->
˛_›s
->
˛_ab‹t
)‘h))

	)

185 
	#CLNT_GETERR
(
rh
,
îΩ
Ë((*‘h)->
˛_›s
->
˛_gëîr
)‘h,Éºp))

	)

186 
	#˛¡_gëîr
(
rh
,
îΩ
Ë((*‘h)->
˛_›s
->
˛_gëîr
)‘h,Éºp))

	)

196 
	#CLNT_FREERES
(
rh
,
xªs
,
ª•
Ë((*‘h)->
˛_›s
->
˛_‰ìªs
)‘h,xªs,ª•))

	)

197 
	#˛¡_‰ìªs
(
rh
,
xªs
,
ª•
Ë((*‘h)->
˛_›s
->
˛_‰ìªs
)‘h,xªs,ª•))

	)

206 
	#CLNT_CONTROL
(
˛
,
rq
,
ö
Ë((*(˛)->
˛_›s
->
˛_c⁄åﬁ
)(˛,rq,ö))

	)

207 
	#˛¡_c⁄åﬁ
(
˛
,
rq
,
ö
Ë((*(˛)->
˛_›s
->
˛_c⁄åﬁ
)(˛,rq,ö))

	)

216 
	#CLSET_TIMEOUT
 1

	)

217 
	#CLGET_TIMEOUT
 2

	)

218 
	#CLGET_SERVER_ADDR
 3

	)

219 
	#CLGET_FD
 6

	)

220 
	#CLGET_SVC_ADDR
 7

	)

221 
	#CLSET_FD_CLOSE
 8

	)

222 
	#CLSET_FD_NCLOSE
 9

	)

223 
	#CLGET_XID
 10

	)

224 
	#CLSET_XID
 11

	)

225 
	#CLGET_VERS
 12

	)

226 
	#CLSET_VERS
 13

	)

227 
	#CLGET_PROG
 14

	)

228 
	#CLSET_PROG
 15

	)

229 
	#CLSET_SVC_ADDR
 16

	)

230 
	#CLSET_PUSH_TIMOD
 17

	)

231 
	#CLSET_POP_TIMOD
 18

	)

235 
	#CLSET_RETRY_TIMEOUT
 4

	)

236 
	#CLGET_RETRY_TIMEOUT
 5

	)

243 
	#CLNT_DESTROY
(
rh
Ë((*‘h)->
˛_›s
->
˛_de°roy
)‘h))

	)

244 
	#˛¡_de°roy
(
rh
Ë((*‘h)->
˛_›s
->
˛_de°roy
)‘h))

	)

253 
	#RPCTEST_PROGRAM
 ((
u_l⁄g
)1)

	)

254 
	#RPCTEST_VERSION
 ((
u_l⁄g
)1)

	)

255 
	#RPCTEST_NULL_PROC
 ((
u_l⁄g
)2)

	)

256 
	#RPCTEST_NULL_BATCH_PROC
 ((
u_l⁄g
)3)

	)

262 
	#NULLPROC
 ((
u_l⁄g
)0)

	)

277 
CLIENT
 *
	$˛¡øw_¸óã
 (
__c⁄°
 
u_l⁄g
 
__¥og
, __c⁄° u_l⁄g 
__vîs
)

278 
__THROW
;

291 
CLIENT
 *
	$˛¡_¸óã
 (
__c⁄°
 *
__ho°
, __c⁄° 
u_l⁄g
 
__¥og
,

292 
__c⁄°
 
u_l⁄g
 
__vîs
, __c⁄° *
__¥Ÿ
)

293 
__THROW
;

307 
CLIENT
 *
	$˛¡t˝_¸óã
 (
sockaddr_ö
 *
__øddr
, 
u_l⁄g
 
__¥og
,

308 
u_l⁄g
 
__vîsi⁄
, *
__sockp
, 
u_öt
 
__£ndsz
,

309 
u_öt
 
__ªcvsz
Ë
__THROW
;

332 
CLIENT
 *
	$˛¡udp_¸óã
 (
sockaddr_ö
 *
__øddr
, 
u_l⁄g
 
__¥ogøm
,

333 
u_l⁄g
 
__vîsi⁄
, 
timevÆ
 
__waô_ª£nd
,

334 *
__sockp
Ë
__THROW
;

335 
CLIENT
 *
	$˛¡udp_buf¸óã
 (
sockaddr_ö
 *
__øddr
,

336 
u_l⁄g
 
__¥ogøm
, u_l⁄g 
__vîsi⁄
,

337 
timevÆ
 
__waô_ª£nd
, *
__sockp
,

338 
u_öt
 
__£ndsz
, u_öà
__ªcvsz
Ë
__THROW
;

354 
CLIENT
 *
	$˛¡unix_¸óã
 (
sockaddr_un
 *
__øddr
, 
u_l⁄g
 
__¥ogøm
,

355 
u_l⁄g
 
__vîsi⁄
, *
__sockp
,

356 
u_öt
 
__£ndsz
, u_öà
__ªcvsz
Ë
__THROW
;

359 
	$ˇŒΩc
 (
__c⁄°
 *
__ho°
, __c⁄° 
u_l⁄g
 
__¥ognum
,

360 
__c⁄°
 
u_l⁄g
 
__vî¢um
, __c⁄° u_l⁄g 
__¥o˙um
,

361 
__c⁄°
 
xdΩroc_t
 
__ö¥oc
, __c⁄° *
__ö
,

362 
__c⁄°
 
xdΩroc_t
 
__ouçroc
, *
__out
Ë
__THROW
;

363 
	$_Ωc_dèbÀsize
 (Ë
__THROW
;

368 
	`˛¡_p¸óãîr‹
 (
__c⁄°
 *
__msg
);

369 *
	$˛¡_•¸óãîr‹
(
__c⁄°
 *
__msg
Ë
__THROW
;

374 
	`˛¡_≥ºno
 (
˛¡_°©
 
__num
);

379 
	`˛¡_≥º‹
 (
CLIENT
 *
__˛¡
, 
__c⁄°
 *
__msg
);

381 *
	$˛¡_•îr‹
 (
CLIENT
 *
__˛¡
, 
__c⁄°
 *
__msg
Ë
__THROW
;

387 
	sΩc_¸óãîr
 {

388 
˛¡_°©
 
cf_°©
;

389 
Ωc_îr
 
cf_îr‹
;

392 
Ωc_¸óãîr
Ñpc_createerr;

399 *
	$˛¡_•î∫o
 (
˛¡_°©
 
__num
Ë
__THROW
;

404 
	$gëΩ˝‹t
 (
__c⁄°
 * 
__ho°
, 
u_l⁄g
 
__¥ognum
,

405 
u_l⁄g
 
__vî¢um
, 
u_öt
 
__¥Ÿo
Ë
__THROW
;

411 
	$gë_myaddªss
 (
sockaddr_ö
 *Ë
__THROW
;

413 
	#UDPMSGSIZE
 8800

	)

414 
	#RPCSMALLMSGSIZE
 400

	)

416 
__END_DECLS


	@/usr/include/rpc/netdb.h

36 #i‚de‡
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<„©uªs.h
>

41 
	#__√ed_size_t


	)

42 
	~<°ddef.h
>

44 
__BEGIN_DECLS


46 
	sΩ˚¡


48 *
	mr_«me
;

49 **
	mr_Æü£s
;

50 
	mr_numbî
;

53 
	$£åp˚¡
 (
__°ay›í
Ë
__THROW
;

54 
	$ídΩ˚¡
 (Ë
__THROW
;

55 
Ω˚¡
 *
	$gëΩcby«me
 (
__c⁄°
 *
__«me
Ë
__THROW
;

56 
Ω˚¡
 *
	$gëΩcbynumbî
 (
__numbî
Ë
__THROW
;

57 
Ω˚¡
 *
	$gëΩ˚¡
 (Ë
__THROW
;

59 #ifde‡
__USE_MISC


60 
	$gëΩcby«me_r
 (
__c⁄°
 *
__«me
, 
Ω˚¡
 *
__ªsu…_buf
,

61 *
__buf„r
, 
size_t
 
__buÊí
,

62 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

64 
	$gëΩcbynumbî_r
 (
__numbî
, 
Ω˚¡
 *
__ªsu…_buf
,

65 *
__buf„r
, 
size_t
 
__buÊí
,

66 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

68 
	$gëΩ˚¡_r
 (
Ω˚¡
 *
__ªsu…_buf
, *
__buf„r
,

69 
size_t
 
__buÊí
, 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

72 
__END_DECLS


	@/usr/include/rpc/svc.h

34 #i‚de‡
_RPC_SVC_H


35 
	#_RPC_SVC_H
 1

	)

37 
	~<„©uªs.h
>

38 
	~<Ωc/Ωc_msg.h
>

40 
__BEGIN_DECLS


64 
	ex¥t_°©
 {

65 
	mXPRT_DIED
,

66 
	mXPRT_MOREREQS
,

67 
	mXPRT_IDLE


73 
SVCXPRT
 
	tSVCXPRT
;

74 
	sSVCXPRT
 {

75 
	mxp_sock
;

76 
u_sh‹t
 
	mxp_p‹t
;

77 c⁄° 
	sxp_›s
 {

78 
boﬁ_t
 (*
xp_ªcv
Ë(
SVCXPRT
 *
	m__x¥t
, 
Ωc_msg
 *
	m__msg
);

80 
x¥t_°©
 (*
xp_°©
Ë(
SVCXPRT
 *
	m__x¥t
);

82 
boﬁ_t
 (*
xp_gë¨gs
Ë(
SVCXPRT
 *
	m__x¥t
, 
xdΩroc_t
 
	m__xdr_¨gs
,

83 
ˇddr_t
 
	m__¨gs_±r
);

84 
boﬁ_t
 (*
xp_ª∂y
Ë(
SVCXPRT
 *
	m__x¥t
, 
Ωc_msg
 *
	m__msg
);

86 
boﬁ_t
 (*
xp_‰ì¨gs
Ë(
SVCXPRT
 *
	m__x¥t
, 
xdΩroc_t
 
	m__xdr_¨gs
,

87 
ˇddr_t
 
	m__¨gs_±r
);

89 (*
	mxp_de°roy
Ë(
SVCXPRT
 *
	m__x¥t
);

91 } *
	mxp_›s
;

92 
	mxp_addæí
;

93 
sockaddr_ö
 
	mxp_øddr
;

94 
›aque_auth
 
	mxp_vîf
;

95 
ˇddr_t
 
	mxp_p1
;

96 
ˇddr_t
 
	mxp_p2
;

97 
	mxp_∑d
 [256];

103 
	#svc_gëˇŒî
(
x
Ë(&(x)->
xp_øddr
)

	)

113 
	#SVC_RECV
(
x¥t
, 
msg
) \

114 (*(
x¥t
)->
xp_›s
->
xp_ªcv
)((x¥t), (
msg
))

	)

115 
	#svc_ªcv
(
x¥t
, 
msg
) \

116 (*(
x¥t
)->
xp_›s
->
xp_ªcv
)((x¥t), (
msg
))

	)

118 
	#SVC_STAT
(
x¥t
) \

119 (*(
x¥t
)->
xp_›s
->
xp_°©
)(x¥t)

	)

120 
	#svc_°©
(
x¥t
) \

121 (*(
x¥t
)->
xp_›s
->
xp_°©
)(x¥t)

	)

123 
	#SVC_GETARGS
(
x¥t
, 
x¨gs
, 
¨g•
) \

124 (*(
x¥t
)->
xp_›s
->
xp_gë¨gs
)((x¥t), (
x¨gs
), (
¨g•
))

	)

125 
	#svc_gë¨gs
(
x¥t
, 
x¨gs
, 
¨g•
) \

126 (*(
x¥t
)->
xp_›s
->
xp_gë¨gs
)((x¥t), (
x¨gs
), (
¨g•
))

	)

128 
	#SVC_REPLY
(
x¥t
, 
msg
) \

129 (*(
x¥t
)->
xp_›s
->
xp_ª∂y
Ë((x¥t), (
msg
))

	)

130 
	#svc_ª∂y
(
x¥t
, 
msg
) \

131 (*(
x¥t
)->
xp_›s
->
xp_ª∂y
Ë((x¥t), (
msg
))

	)

133 
	#SVC_FREEARGS
(
x¥t
, 
x¨gs
, 
¨g•
) \

134 (*(
x¥t
)->
xp_›s
->
xp_‰ì¨gs
)((x¥t), (
x¨gs
), (
¨g•
))

	)

135 
	#svc_‰ì¨gs
(
x¥t
, 
x¨gs
, 
¨g•
) \

136 (*(
x¥t
)->
xp_›s
->
xp_‰ì¨gs
)((x¥t), (
x¨gs
), (
¨g•
))

	)

138 
	#SVC_DESTROY
(
x¥t
) \

139 (*(
x¥t
)->
xp_›s
->
xp_de°roy
)(x¥t)

	)

140 
	#svc_de°roy
(
x¥t
) \

141 (*(
x¥t
)->
xp_›s
->
xp_de°roy
)(x¥t)

	)

147 
	ssvc_ªq
 {

148 
Ω˝rog_t
 
	mrq_¥og
;

149 
Ωcvîs_t
 
	mrq_vîs
;

150 
Ω˝roc_t
 
	mrq_¥oc
;

151 
›aque_auth
 
	mrq_¸ed
;

152 
ˇddr_t
 
	mrq_˛¡¸ed
;

153 
SVCXPRT
 *
	mrq_x¥t
;

156 #i‚de‡
__DISPATCH_FN_T


157 
	#__DISPATCH_FN_T


	)

158 (*
	t__di•©ch_‚_t
Ë(
	tsvc_ªq
*, 
	tSVCXPRT
*);

171 
boﬁ_t
 
	$svc_ªgi°î
 (
SVCXPRT
 *
__x¥t
, 
Ω˝rog_t
 
__¥og
,

172 
Ωcvîs_t
 
__vîs
, 
__di•©ch_‚_t
 
__di•©ch
,

173 
Ω˝rŸ_t
 
__¥Ÿocﬁ
Ë
__THROW
;

182 
	$svc_uƒegi°î
 (
Ω˝rog_t
 
__¥og
, 
Ωcvîs_t
 
__vîs
Ë
__THROW
;

190 
	$x¥t_ªgi°î
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

198 
	$x¥t_uƒegi°î
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

227 
boﬁ_t
 
	$svc_£ndª∂y
 (
SVCXPRT
 *
__x¥t
, 
xdΩroc_t
 
__xdr_ªsu…s
,

228 
ˇddr_t
 
__xdr_loˇti⁄
Ë
__THROW
;

230 
	$sv˚º_decode
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

232 
	$sv˚º_wókauth
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

234 
	$sv˚º_n›roc
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

236 
	$sv˚º_¥ogvîs
 (
SVCXPRT
 *
__x¥t
, 
Ωcvîs_t
 
__low_vîs
,

237 
Ωcvîs_t
 
__high_vîs
Ë
__THROW
;

239 
	$sv˚º_auth
 (
SVCXPRT
 *
__x¥t
, 
auth_°©
 
__why
Ë
__THROW
;

241 
	$sv˚º_n›rog
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

243 
	$sv˚º_sy°emîr
 (
SVCXPRT
 *
__x¥t
Ë
__THROW
;

261 
pﬁlfd
 *
svc_pﬁlfd
;

262 
svc_max_pﬁlfd
;

263 
fd_£t
 
svc_fd£t
;

264 
	#svc_fds
 
svc_fd£t
.
fds_bôs
[0]

	)

270 
	$svc_gëªq
 (
__rdfds
Ë
__THROW
;

271 
	$svc_gëªq_comm⁄
 (c⁄° 
__fd
Ë
__THROW
;

272 
	$svc_gëªq£t
 (
fd_£t
 *
__ªadfds
Ë
__THROW
;

273 
	$svc_gëªq_pﬁl
 (
pﬁlfd
 *, c⁄° Ë
__THROW
;

274 
	$svc_exô
 (Ë
__THROW
;

275 
	$svc_run
 (Ë
__THROW
;

280 
	#RPC_ANYSOCK
 -1

	)

289 
SVCXPRT
 *
	$sv¸aw_¸óã
 (Ë
__THROW
;

294 
SVCXPRT
 *
	$svcudp_¸óã
 (
__sock
Ë
__THROW
;

295 
SVCXPRT
 *
	$svcudp_buf¸óã
 (
__sock
, 
u_öt
 
__£ndsz
, u_öà
__ªcvsz
)

296 
__THROW
;

301 
SVCXPRT
 *
	$sv˘˝_¸óã
 (
__sock
, 
u_öt
 
__£ndsize
, u_öà
__ªcvsize
)

302 
__THROW
;

307 
SVCXPRT
 *
	$svcfd_¸óã
 (
__sock
, 
u_öt
 
__£ndsize
, u_öà
__ªcvsize
)

308 
__THROW
;

313 
SVCXPRT
 *
	$svcunix_¸óã
 (
__sock
, 
u_öt
 
__£ndsize
, u_öà
__ªcvsize
,

314 *
__∑th
Ë
__THROW
;

317 
__END_DECLS


	@/usr/include/rpc/svc_auth.h

34 #i‚de‡
_RPC_SVC_AUTH_H


35 
	#_RPC_SVC_AUTH_H
 1

	)

37 
	~<„©uªs.h
>

38 
	~<Ωc/svc.h
>

40 
__BEGIN_DECLS


45 
auth_°©
 
	$_authítiˇã
 (
svc_ªq
 *
__rq°
,

46 
Ωc_msg
 *
__msg
Ë
__THROW
;

48 
__END_DECLS


	@/usr/include/rpc/types.h

34 #i‚de‡
_RPC_TYPES_H


35 
	#_RPC_TYPES_H
 1

	)

37 
	tboﬁ_t
;

38 
	tíum_t
;

40 
	tΩ˝rog_t
;

41 
	tΩcvîs_t
;

42 
	tΩ˝roc_t
;

43 
	tΩ˝rŸ_t
;

44 
	tΩ˝‹t_t
;

46 
	#__d⁄tˇª__
 -1

	)

48 #i‚de‡
FALSE


49 
	#FALSE
 (0)

	)

52 #i‚de‡
TRUE


53 
	#TRUE
 (1)

	)

56 #i‚de‡
NULL


57 
	#NULL
 0

	)

60 
	~<°dlib.h
>

61 
	#mem_Æloc
(
bsize
Ë
	`mÆloc
(bsize)

	)

66 
	#mem_‰ì
(
±r
, 
bsize
Ë
	`‰ì
’å)

	)

68 #i‚de‡
makedev


69 
	~<sys/ty≥s.h
>

72 #i‚de‡
__u_ch¨_deföed


73 
__u_ch¨
 
	tu_ch¨
;

74 
__u_sh‹t
 
	tu_sh‹t
;

75 
__u_öt
 
	tu_öt
;

76 
__u_l⁄g
 
	tu_l⁄g
;

77 
__quad_t
 
	tquad_t
;

78 
__u_quad_t
 
	tu_quad_t
;

79 
__fsid_t
 
	tfsid_t
;

80 
	#__u_ch¨_deföed


	)

82 #i‚de‡
__daddr_t_deföed


83 
__daddr_t
 
	tdaddr_t
;

84 
__ˇddr_t
 
	tˇddr_t
;

85 
	#__daddr_t_deföed


	)

88 
	~<sys/time.h
>

89 
	~<sys/∑øm.h
>

91 
	~<√töë/ö.h
>

93 #i‚de‡
INADDR_LOOPBACK


94 
	#INADDR_LOOPBACK
 (
u_l⁄g
)0x7F000001

	)

96 #i‚de‡
MAXHOSTNAMELEN


97 
	#MAXHOSTNAMELEN
 64

	)

	@/usr/include/sched.h

21 #i‚def 
_SCHED_H


22 
	#_SCHED_H
 1

	)

24 
	~<„©uªs.h
>

27 
	~<bôs/ty≥s.h
>

29 
	#__√ed_size_t


	)

30 
	~<°ddef.h
>

32 
	#__√ed_time_t


	)

33 
	#__√ed_time•ec


	)

34 
	~<time.h
>

36 #i‚de‡
__pid_t_deföed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_deföed


	)

43 
	~<bôs/sched.h
>

45 
	#sched_¥i‹ôy
 
__sched_¥i‹ôy


	)

48 
__BEGIN_DECLS


51 
	$sched_£ç¨am
 (
__pid_t
 
__pid
, 
__c⁄°
 
sched_∑øm
 *
__∑øm
)

52 
__THROW
;

55 
	$sched_gë∑øm
 (
__pid_t
 
__pid
, 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

58 
	$sched_£tscheduÀr
 (
__pid_t
 
__pid
, 
__pﬁicy
,

59 
__c⁄°
 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

62 
	$sched_gëscheduÀr
 (
__pid_t
 
__pid
Ë
__THROW
;

65 
	$sched_yõld
 (Ë
__THROW
;

68 
	$sched_gë_¥i‹ôy_max
 (
__Æg‹ôhm
Ë
__THROW
;

71 
	$sched_gë_¥i‹ôy_mö
 (
__Æg‹ôhm
Ë
__THROW
;

74 
	$sched_º_gë_öãrvÆ
 (
__pid_t
 
__pid
, 
time•ec
 *
__t
Ë
__THROW
;

77 #ifde‡
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
˝u
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

81 
	#CPU_CLR
(
˝u
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

82 
	#CPU_ISSET
(
˝u
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (˝u,  (
˝u_£t_t
), \

83 
˝u£ç
)

	)

84 
	#CPU_ZERO
(
˝u£ç
Ë
	`__CPU_ZERO_S
 ( (
˝u_£t_t
), cpu£ç)

	)

85 
	#CPU_COUNT
(
˝u£ç
Ë
	`__CPU_COUNT_S
 ( (
˝u_£t_t
), cpu£ç)

	)

87 
	#CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u, sësize, cpu£ç)

	)

88 
	#CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u, sësize, cpu£ç)

	)

89 
	#CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
˝u£ç
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_ZERO_S
 (£tsize, cpu£ç)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_COUNT_S
 (£tsize, cpu£ç)

	)

94 
	#CPU_EQUAL
(
˝u£ç1
, 
˝u£ç2
) \

95 
	`__CPU_EQUAL_S
 ( (
˝u_£t_t
), 
˝u£ç1
, 
˝u£ç2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
˝u£ç1
, 
˝u£ç2
)

	)

99 
	#CPU_AND
(
de°£t
, 
§c£t1
, 
§c£t2
) \

100 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

101 
	#CPU_OR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

102 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

103 
	#CPU_XOR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

104 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
cou¡
Ë
	`__CPU_ALLOC_SIZE
 (cou¡)

	)

113 
	#CPU_ALLOC
(
cou¡
Ë
	`__CPU_ALLOC
 (cou¡)

	)

114 
	#CPU_FREE
(
˝u£t
Ë
	`__CPU_FREE
 (˝u£t)

	)

118 
	$sched_£èfföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

119 
__c⁄°
 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

122 
	$sched_gëafföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

123 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

126 
__END_DECLS


	@/usr/include/xlocale.h

21 #i‚de‡
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loˇÀ_°ru˘


31 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

34 c⁄° *
	m__˘y≥_b
;

35 c⁄° *
	m__˘y≥_tﬁowî
;

36 c⁄° *
	m__˘y≥_touµî
;

39 c⁄° *
	m__«mes
[13];

40 } *
	t__loˇÀ_t
;

43 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb°©e_t
 
	m__°©e
;

26 } 
	t_G_Âos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb°©e_t
 
	m__°©e
;

31 } 
	t_G_Âos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¨_t
 
wch¨_t


	)

38 
	#_G_wöt_t
 
wöt_t


	)

39 
	#_G_°©64
 
°©64


	)

40 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gc⁄v.h
>

44 
__gc⁄v_öfo
 
	m__cd
;

47 
__gc⁄v_öfo
 
	m__cd
;

48 
__gc⁄v_°ï_d©a
 
	m__d©a
;

49 } 
	m__comböed
;

50 } 
	t_G_ic⁄v_t
;

53 
	t_G_öt16_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_öt32_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_uöt16_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_uöt32_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li°
 
__gnuc_va_li°


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__›í64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm≠64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
Ë
	`__fx°©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #i‡
deföed
 
__˝lu•lus
 || deföed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
Ë
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
Ë()

	)

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/gconv.h

23 #i‚de‡
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<„©uªs.h
>

27 
	#__√ed_mb°©e_t


	)

28 
	#__√ed_wöt_t


	)

29 
	~<wch¨.h
>

30 
	#__√ed_size_t


	)

31 
	#__√ed_wch¨_t


	)

32 
	~<°ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002

64 
	g__gc⁄v_°ï
;

65 
	g__gc⁄v_°ï_d©a
;

66 
	g__gc⁄v_lﬂded_obje˘
;

67 
	g__gc⁄v_å™s_d©a
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

72 
	t__c⁄°
 **, __const *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 (*
	t__gc⁄v_å™s_f˘
Ë(
	t__gc⁄v_°ï
 *,

85 
	t__gc⁄v_°ï_d©a
 *, *,

86 
	t__c⁄°
 *,

87 
	t__c⁄°
 **,

88 
	t__c⁄°
 *, **,

89 
	tsize_t
 *);

92 (*
	t__gc⁄v_å™s_c⁄ãxt_f˘
Ë(*, 
	t__c⁄°
 *,

93 
	t__c⁄°
 *,

97 (*
	t__gc⁄v_å™s_quîy_f˘
Ë(
	t__c⁄°
 *, __const ***,

98 
	tsize_t
 *);

101 (*
	t__gc⁄v_å™s_öô_f˘
) (**, const *);

102 (*
	t__gc⁄v_å™s_íd_f˘
) (*);

104 
	s__gc⁄v_å™s_d©a


107 
__gc⁄v_å™s_f˘
 
__å™s_f˘
;

108 
__gc⁄v_å™s_c⁄ãxt_f˘
 
__å™s_c⁄ãxt_f˘
;

109 
__gc⁄v_å™s_íd_f˘
 
__å™s_íd_f˘
;

110 *
__d©a
;

111 
__gc⁄v_å™s_d©a
 *
__√xt
;

116 
	s__gc⁄v_°ï


118 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

119 
__c⁄°
 *
__mod«me
;

121 
__cou¡î
;

123 *
__‰om_«me
;

124 *
__to_«me
;

126 
__gc⁄v_f˘
 
__f˘
;

127 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

128 
__gc⁄v_öô_f˘
 
__öô_f˘
;

129 
__gc⁄v_íd_f˘
 
__íd_f˘
;

133 
__mö_√eded_‰om
;

134 
__max_√eded_‰om
;

135 
__mö_√eded_to
;

136 
__max_√eded_to
;

139 
__°©eful
;

141 *
__d©a
;

146 
	s__gc⁄v_°ï_d©a


148 *
__outbuf
;

149 *
__outbu„nd
;

153 
__Êags
;

157 
__övoˇti⁄_cou¡î
;

161 
__öã∫Æ_u£
;

163 
__mb°©e_t
 *
__°©ï
;

164 
__mb°©e_t
 
__°©e
;

168 
__gc⁄v_å™s_d©a
 *
__å™s
;

173 
	s__gc⁄v_öfo


175 
size_t
 
__n°ïs
;

176 
__gc⁄v_°ï
 *
__°ïs
;

177 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

178 } *
	t__gc⁄v_t
;

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__NFDBITS


22 
	#__NFDBITS
 (8 * ())

	)

24 #unde‡
__FD_SETSIZE


25 
	#__FD_SETSIZE
 1024

	)

27 #unde‡
__FDSET_LONGS


28 
	#__FDSET_LONGS
 (
__FD_SETSIZE
/
__NFDBITS
)

	)

30 #unde‡
__FDELT


31 
	#__FDELT
(
d
Ë((dË/ 
__NFDBITS
)

	)

33 #unde‡
__FDMASK


34 
	#__FDMASK
(
d
Ë(1UL << ((dË% 
__NFDBITS
))

	)

37 
	mfds_bôs
 [
__FDSET_LONGS
];

38 } 
	t__kî√l_fd_£t
;

41 (*
	t__kî√l_sigh™dÀr_t
)();

44 
	t__kî√l_key_t
;

45 
	t__kî√l_mqd_t
;

47 
	~<asm/posix_ty≥s.h
>

	@/usr/include/wchar.h

24 #i‚de‡
_WCHAR_H


26 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<„©uªs.h
>

31 #ifde‡
_WCHAR_H


33 
	#__√ed___FILE


	)

34 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


35 
	#__√ed_FILE


	)

37 
	~<°dio.h
>

39 
	#__√ed___va_li°


	)

40 
	~<°d¨g.h
>

42 
	~<bôs/wch¨.h
>

45 
	#__√ed_size_t


	)

46 
	#__√ed_wch¨_t


	)

47 
	#__√ed_NULL


	)

49 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


50 #unde‡
__√ed_wöt_t


51 
	#__√ed_wöt_t


	)

52 
	~<°ddef.h
>

56 #i‚de‡
_WINT_T


61 
	#_WINT_T


	)

62 
	twöt_t
;

66 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
deföed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twöt_t
;

70 
	g__END_NAMESPACE_STD


75 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
__mb°©e_t_deföed


81 
	#__mb°©e_t_deföed
 1

	)

85 
	m__cou¡
;

88 #ifde‡
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wöt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__vÆue
;

95 } 
	t__mb°©e_t
;

97 #unde‡
__√ed_mb°©e_t


102 #ifde‡
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mb°©e_t
 
	tmb°©e_t
;

107 
	g__END_NAMESPACE_C99


108 #ifde‡
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

112 #i‚de‡
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #i‚de‡
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


125 
	~<w˘y≥.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

145 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

147 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

153 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

155 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

156 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
)

161 
__THROW
 
__©åibuã_puª__
;

163 
	$wc¢cmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__©åibuã_puª__
;

165 
__END_NAMESPACE_STD


167 #ifde‡
__USE_XOPEN2K8


169 
	$wcsˇ£cmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
Ë
__THROW
;

172 
	$wc¢ˇ£cmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

173 
size_t
 
__n
Ë
__THROW
;

177 
	~<xloˇÀ.h
>

179 
	$wcsˇ£cmp_l
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

180 
__loˇÀ_t
 
__loc
Ë
__THROW
;

182 
	$wc¢ˇ£cmp_l
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

183 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscﬁl
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
Ë
__THROW
;

193 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

194 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

195 
__END_NAMESPACE_STD


197 #ifde‡
__USE_XOPEN2K8


203 
	$wcscﬁl_l
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

204 
__loˇÀ_t
 
__loc
Ë
__THROW
;

209 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, 
__c⁄°
 wch¨_à*
__s2
,

210 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

213 
wch¨_t
 *
	$wcsdup
 (
__c⁄°
 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch¨_t
 *
	$wcschr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

221 "C++" 
__c⁄°
 
wch¨_t
 *
	$wcschr
 (
__c⁄°
 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

224 
wch¨_t
 *
	$wcschr
 (
__c⁄°
 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

225 
__THROW
 
__©åibuã_puª__
;

228 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch¨_t
 *
	$wc§chr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

230 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

231 "C++" 
__c⁄°
 
wch¨_t
 *
	$wc§chr
 (
__c⁄°
 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

232 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

234 
wch¨_t
 *
	$wc§chr
 (
__c⁄°
 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

235 
__THROW
 
__©åibuã_puª__
;

237 
__END_NAMESPACE_STD


239 #ifde‡
__USE_GNU


242 
wch¨_t
 *
	$wcsch∫ul
 (
__c⁄°
 
wch¨_t
 *
__s
, wch¨_à
__wc
)

243 
__THROW
 
__©åibuã_puª__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcsc•n
 (
__c⁄°
 
wch¨_t
 *
__wcs
, __c⁄° wch¨_à*
__ªje˘
)

250 
__THROW
 
__©åibuã_puª__
;

253 
size_t
 
	$wcs•n
 (
__c⁄°
 
wch¨_t
 *
__wcs
, __c⁄° wch¨_à*
__ac˚±
)

254 
__THROW
 
__©åibuã_puª__
;

256 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch¨_t
 *
	$wc•brk
 (
wch¨_t
 *
__wcs
, 
__c⁄°
 wch¨_à*
__ac˚±
)

258 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

259 "C++" 
__c⁄°
 
wch¨_t
 *
	$wc•brk
 (
__c⁄°
 
wch¨_t
 *
__wcs
,

260 
__c⁄°
 
wch¨_t
 *
__ac˚±
)

261 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

263 
wch¨_t
 *
	$wc•brk
 (
__c⁄°
 
wch¨_t
 *
__wcs
, __c⁄° wch¨_à*
__ac˚±
)

264 
__THROW
 
__©åibuã_puª__
;

267 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch¨_t
 *
	$wcs°r
 (
wch¨_t
 *
__hay°ack
, 
__c⁄°
 wch¨_à*
__√edÀ
)

269 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

270 "C++" 
__c⁄°
 
wch¨_t
 *
	$wcs°r
 (
__c⁄°
 
wch¨_t
 *
__hay°ack
,

271 
__c⁄°
 
wch¨_t
 *
__√edÀ
)

272 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

274 
wch¨_t
 *
	$wcs°r
 (
__c⁄°
 
wch¨_t
 *
__hay°ack
, __c⁄° wch¨_à*
__√edÀ
)

275 
__THROW
 
__©åibuã_puª__
;

279 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

280 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

281 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

284 
size_t
 
	$wc¶í
 (
__c⁄°
 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

285 
__END_NAMESPACE_STD


287 #ifde‡
__USE_XOPEN


289 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch¨_t
 *
	$wcswcs
 (
wch¨_t
 *
__hay°ack
, 
__c⁄°
 wch¨_à*
__√edÀ
)

291 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

292 "C++" 
__c⁄°
 
wch¨_t
 *
	$wcswcs
 (
__c⁄°
 
wch¨_t
 *
__hay°ack
,

293 
__c⁄°
 
wch¨_t
 *
__√edÀ
)

294 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

296 
wch¨_t
 *
	$wcswcs
 (
__c⁄°
 
wch¨_t
 *
__hay°ack
, __c⁄° wch¨_à*
__√edÀ
)

297 
__THROW
 
__©åibuã_puª__
;

301 #ifde‡
__USE_XOPEN2K8


303 
size_t
 
	$wc¢Àn
 (
__c⁄°
 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

304 
__THROW
 
__©åibuã_puª__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch¨_t
 *
	$wmemchr
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

313 "C++" 
__c⁄°
 
wch¨_t
 *
	$wmemchr
 (
__c⁄°
 
wch¨_t
 *
__s
, wch¨_à
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

317 
wch¨_t
 *
	$wmemchr
 (
__c⁄°
 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

318 
__THROW
 
__©åibuã_puª__
;

322 
	$wmemcmp
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s1
,

323 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

324 
__THROW
 
__©åibuã_puª__
;

327 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

328 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

332 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, 
__c⁄°
 wch¨_à*
__s2
, 
size_t
 
__n
)

333 
__THROW
;

336 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

337 
__END_NAMESPACE_STD


339 #ifde‡
__USE_GNU


342 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

343 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

344 
__THROW
;

348 
__BEGIN_NAMESPACE_STD


351 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

355 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

359 
	$mbsöô
 (
__c⁄°
 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

363 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

364 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

365 
mb°©e_t
 *
__p
Ë
__THROW
;

368 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

369 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

372 
size_t
 
	$__mbæí
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

373 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

374 
size_t
 
	$mbæí
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

375 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

376 
__END_NAMESPACE_STD


378 #ifde‡
__USE_EXTERN_INLINES


384 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

385 
__exã∫_ölöe
 
wöt_t


386 
	`__NTH
 (
	$btowc
 (
__c
))

387 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

388 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

390 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

391 
__exã∫_ölöe
 

392 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

393 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

394 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

396 
__exã∫_ölöe
 
size_t


397 
__NTH
 (
	$mbæí
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

398 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

399 {  (
__ps
 !
NULL


400 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

403 
__BEGIN_NAMESPACE_STD


406 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

407 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

408 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

412 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

413 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

414 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

415 
__END_NAMESPACE_STD


418 #ifdef 
__USE_XOPEN2K8


421 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

422 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

423 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

427 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

428 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

429 
size_t
 
__nwc
, size_à
__Àn
,

430 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

435 #ifde‡
__USE_XOPEN


437 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

441 
	$wcswidth
 (
__c⁄°
 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

445 
__BEGIN_NAMESPACE_STD


448 
	$wc°od
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

449 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

450 
__END_NAMESPACE_STD


452 #ifde‡
__USE_ISOC99


453 
__BEGIN_NAMESPACE_C99


455 
	$wc°of
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

456 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

457 
	$wc°ﬁd
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

458 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

459 
__END_NAMESPACE_C99


463 
__BEGIN_NAMESPACE_STD


466 
	$wc°ﬁ
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

467 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

471 
	$wc°oul
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

472 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

473 
__THROW
;

474 
__END_NAMESPACE_STD


476 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GNUC__
 && deföed 
__USE_GNU
)

477 
__BEGIN_NAMESPACE_C99


480 
__exãnsi⁄__


481 
	$wc°ﬁl
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

482 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

483 
__THROW
;

487 
__exãnsi⁄__


488 
	$wc°ouŒ
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

489 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

490 
__ba£
Ë
__THROW
;

491 
__END_NAMESPACE_C99


494 #i‡
deföed
 
__GNUC__
 && deföed 
__USE_GNU


497 
__exãnsi⁄__


498 
	$wc°oq
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

499 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

500 
__THROW
;

504 
__exãnsi⁄__


505 
	$wc°ouq
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

506 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

507 
__ba£
Ë
__THROW
;

510 #ifde‡
__USE_GNU


524 
	~<xloˇÀ.h
>

528 
	$wc°ﬁ_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

529 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

530 
__loˇÀ_t
 
__loc
Ë
__THROW
;

532 
	$wc°oul_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

533 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

534 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

536 
__exãnsi⁄__


537 
	$wc°ﬁl_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

538 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

539 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

541 
__exãnsi⁄__


542 
	$wc°ouŒ_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

543 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

544 
__ba£
, 
__loˇÀ_t
 
__loc
)

545 
__THROW
;

547 
	$wc°od_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

548 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

549 
__THROW
;

551 
	$wc°of_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

552 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

553 
__THROW
;

555 
	$wc°ﬁd_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

556 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

557 
__loˇÀ_t
 
__loc
Ë
__THROW
;

562 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

563 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

567 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

568 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

569 
__THROW
;

575 #ifdef 
__USE_XOPEN2K8


578 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

581 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


582 
__BEGIN_NAMESPACE_STD


585 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

592 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

593 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

599 
	`w¥ötf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

602 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

603 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

604 
__THROW
 ;

610 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

611 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

612 
__gnuc_va_li°
 
__¨g
)

618 
	`vw¥ötf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

619 
__gnuc_va_li°
 
__¨g
)

623 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

624 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

625 
__gnuc_va_li°
 
__¨g
)

626 
__THROW
 ;

633 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

634 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

640 
	`wsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

643 
	$swsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

644 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

645 
__THROW
 ;

647 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

648 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

649 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

650 #ifde‡
__REDIRECT


654 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

655 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

656 
__isoc99_fwsˇnf
)

658 
	`__REDIRECT
 (
wsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

659 
__isoc99_wsˇnf
)

661 
	`__REDIRECT_NTH
 (
swsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

662 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

663 ...), 
__isoc99_swsˇnf
)

666 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

667 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

668 
	`__isoc99_wsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

669 
	$__isoc99_swsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

670 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

671 
__THROW
;

672 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

673 
	#wsˇnf
 
__isoc99_wsˇnf


	)

674 
	#swsˇnf
 
__isoc99_swsˇnf


	)

678 
__END_NAMESPACE_STD


681 #ifde‡
__USE_ISOC99


682 
__BEGIN_NAMESPACE_C99


687 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

688 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

689 
__gnuc_va_li°
 
__¨g
)

695 
	`vwsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

696 
__gnuc_va_li°
 
__¨g
)

699 
	$vswsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

700 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

701 
__gnuc_va_li°
 
__¨g
)

702 
__THROW
 ;

704 #i‡!
deföed
 
__USE_GNU
 \

705 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

706 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

707 #ifde‡
__REDIRECT


708 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

709 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

710 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

712 
	`__REDIRECT
 (
vwsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

713 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

715 
	`__REDIRECT_NTH
 (
vswsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

716 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

717 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

720 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

721 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

722 
__gnuc_va_li°
 
__¨g
);

723 
	`__isoc99_vwsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

724 
__gnuc_va_li°
 
__¨g
);

725 
	$__isoc99_vswsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

726 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

727 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

728 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

729 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

730 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

734 
__END_NAMESPACE_C99


738 
__BEGIN_NAMESPACE_STD


743 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

744 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

750 
wöt_t
 
	`gëwch¨
 ();

757 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

758 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

764 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

772 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

773 
__FILE
 *
__ª°ri˘
 
__°ªam
);

779 
	`Âutws
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__ws
,

780 
__FILE
 *
__ª°ri˘
 
__°ªam
);

787 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

788 
__END_NAMESPACE_STD


791 #ifde‡
__USE_GNU


799 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

800 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

808 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

816 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

825 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

826 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

835 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

836 
__FILE
 *
__ª°ri˘
 
__°ªam
);

844 
	`Âutws_u∆ocked
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__ws
,

845 
__FILE
 *
__ª°ri˘
 
__°ªam
);

849 
__BEGIN_NAMESPACE_C99


853 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

854 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

855 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

856 
__END_NAMESPACE_C99


858 #ifde‡
__USE_GNU


859 
	~<xloˇÀ.h
>

863 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

864 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

865 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

866 
__loˇÀ_t
 
__loc
Ë
__THROW
;

875 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


876 
	#__√ed_iswxxx


	)

877 
	~<w˘y≥.h
>

881 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


882 
	~<bôs/wch¨2.h
>

885 #ifde‡
__LDBL_COMPAT


886 
	~<bôs/wch¨-ldbl.h
>

889 
__END_DECLS


897 #unde‡
__√ed_mb°©e_t


898 #unde‡
__√ed_wöt_t


	@/usr/include/linux/stddef.h

1 #i‚de‡
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

6 #unde‡
NULL


7 #i‡
deföed
(
__˝lu•lus
)

8 
	#NULL
 0

	)

10 
	#NULL
 ((*)0)

	)

	@/usr/include/wctype.h

24 #i‚de‡
_WCTYPE_H


26 
	~<„©uªs.h
>

27 
	~<bôs/ty≥s.h
>

29 #i‚de‡
__√ed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__√ed_wöt_t


	)

34 
	~<wch¨.h
>

38 #i‚de‡
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #unde‡
__√ed_iswxxx


47 #i‚de‡
__iswxxx_deföed


48 
	#__iswxxx_deföed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	tw˘y≥_t
;

54 
	g__END_NAMESPACE_C99


56 #i‚de‡
_ISwbô


61 
	~<ídün.h
>

62 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


63 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

65 
	#_ISwbô
(
bô
) \

66 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

74 
	m__ISwuµî
 = 0,

75 
	m__ISwlowî
 = 1,

76 
	m__ISwÆpha
 = 2,

77 
	m__ISwdigô
 = 3,

78 
	m__ISwxdigô
 = 4,

79 
	m__ISw•a˚
 = 5,

80 
	m__ISw¥öt
 = 6,

81 
	m__ISwgøph
 = 7,

82 
	m__ISwbœnk
 = 8,

83 
	m__ISw˙ål
 = 9,

84 
	m__ISwpun˘
 = 10,

85 
	m__ISwÆnum
 = 11,

87 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

88 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

89 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

90 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

91 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

92 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

93 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

94 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

95 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

96 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

97 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

98 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

118 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

121 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

125 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

129 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

134 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

137 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

142 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

147 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

152 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

157 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

162 #ifde‡
__USE_ISOC99


163 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

172 
w˘y≥_t
 
	$w˘y≥
 (
__c⁄°
 *
__¥›îty
Ë
__THROW
;

176 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__c⁄°
 
	t__öt32_t
 *
	tw˘øns_t
;

188 
__END_NAMESPACE_C99


189 #ifde‡
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifde‡
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
w˘øns_t
 
	$w˘øns
 (
__c⁄°
 *
__¥›îty
Ë
__THROW
;

222 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifde‡
__USE_XOPEN2K8


227 
	~<xloˇÀ.h
>

231 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

237 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

240 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

244 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

248 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

253 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

256 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

261 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

266 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

271 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

276 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

281 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

285 
w˘y≥_t
 
	$w˘y≥_l
 (
__c⁄°
 *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

286 
__THROW
;

290 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

291 
__THROW
;

299 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

302 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

306 
w˘øns_t
 
	$w˘øns_l
 (
__c⁄°
 *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

307 
__THROW
;

310 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

311 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

315 
__END_DECLS


	@
1
.
1
/usr/include
788
27789
ccan/ccan/alignof/alignof.h
ccan/ccan/alignof/test/run.c
ccan/ccan/antithread/alloc/alloc.c
ccan/ccan/antithread/alloc/alloc.h
ccan/ccan/antithread/alloc/bitops.c
ccan/ccan/antithread/alloc/bitops.h
ccan/ccan/antithread/alloc/test/run-corrupt.c
ccan/ccan/antithread/alloc/test/run-testsize.c
ccan/ccan/antithread/alloc/test/run-tiny-encode.c
ccan/ccan/antithread/alloc/test/run.c
ccan/ccan/antithread/alloc/tiny.c
ccan/ccan/antithread/alloc/tiny.h
ccan/ccan/antithread/antithread.c
ccan/ccan/antithread/antithread.h
ccan/ccan/antithread/examples/arabella.c
ccan/ccan/antithread/examples/dns_lookup.c
ccan/ccan/antithread/examples/md5_finder.h
ccan/ccan/antithread/test/run-lock.c
ccan/ccan/antithread/test/run-simple.c
ccan/ccan/antithread/test/run-spawn-NULL.c
ccan/ccan/antithread/test/run-spawn.c
ccan/ccan/antithread/test/run-tell.c
ccan/ccan/antithread/test/run-tell_parent.c
ccan/ccan/array_size/array_size.h
ccan/ccan/array_size/test/compile_fail-function-param.c
ccan/ccan/array_size/test/compile_fail.c
ccan/ccan/array_size/test/run.c
ccan/ccan/asearch/asearch.h
ccan/ccan/asearch/test/compile_fail-return-value-const.c
ccan/ccan/asearch/test/compile_fail-return-value.c
ccan/ccan/asearch/test/run-strings.c
ccan/ccan/asearch/test/run.c
ccan/ccan/asort/asort.c
ccan/ccan/asort/asort.h
ccan/ccan/asort/test/compile_fail-context-type.c
ccan/ccan/asort/test/run.c
ccan/ccan/asprintf/asprintf.c
ccan/ccan/asprintf/asprintf.h
ccan/ccan/asprintf/test/run.c
ccan/ccan/autodata/autodata.c
ccan/ccan/autodata/autodata.h
ccan/ccan/autodata/test/helper.c
ccan/ccan/autodata/test/run-fools.c
ccan/ccan/autodata/test/run.c
ccan/ccan/avl/avl.c
ccan/ccan/avl/avl.h
ccan/ccan/avl/test/run.c
ccan/ccan/bdelta/bdelta.c
ccan/ccan/bdelta/bdelta.h
ccan/ccan/bdelta/test/common.h
ccan/ccan/bdelta/test/run-medium.c
ccan/ccan/bdelta/test/run-myers.c
ccan/ccan/bdelta/test/run-trivial.c
ccan/ccan/bitmap/bitmap.h
ccan/ccan/bitmap/test/run.c
ccan/ccan/block_pool/block_pool.c
ccan/ccan/block_pool/block_pool.h
ccan/ccan/block_pool/test/run.c
ccan/ccan/breakpoint/breakpoint.c
ccan/ccan/breakpoint/breakpoint.h
ccan/ccan/breakpoint/test/run.c
ccan/ccan/btree/btree.c
ccan/ccan/btree/btree.h
ccan/ccan/btree/test/run-benchmark.c
ccan/ccan/btree/test/run-random-access.c
ccan/ccan/btree/test/run-search-implement.c
ccan/ccan/btree/test/run-trivial.c
ccan/ccan/build_assert/build_assert.h
ccan/ccan/build_assert/test/compile_fail-expr.c
ccan/ccan/build_assert/test/compile_fail.c
ccan/ccan/build_assert/test/compile_ok.c
ccan/ccan/build_assert/test/run-BUILD_ASSERT_OR_ZERO.c
ccan/ccan/bytestring/bytestring.h
ccan/ccan/bytestring/test/compile_fail-BYTESTRING-2.c
ccan/ccan/bytestring/test/compile_fail-BYTESTRING.c
ccan/ccan/bytestring/test/run.c
ccan/ccan/cast/cast.h
ccan/ccan/cast/test/compile_fail-cast_const.c
ccan/ccan/cast/test/compile_fail-cast_const2.c
ccan/ccan/cast/test/compile_fail-cast_const3.c
ccan/ccan/cast/test/compile_fail-cast_signed-const.c
ccan/ccan/cast/test/compile_fail-cast_signed-sizesame.c
ccan/ccan/cast/test/compile_fail-cast_signed.c
ccan/ccan/cast/test/compile_fail-cast_static-2.c
ccan/ccan/cast/test/compile_fail-cast_static-3.c
ccan/ccan/cast/test/compile_fail-cast_static.c
ccan/ccan/cast/test/compile_ok-cast_void.c
ccan/ccan/cast/test/compile_ok-static.c
ccan/ccan/ccan_tokenizer/ccan_tokenizer.c
ccan/ccan/ccan_tokenizer/ccan_tokenizer.h
ccan/ccan/ccan_tokenizer/charflag.c
ccan/ccan/ccan_tokenizer/charflag.h
ccan/ccan/ccan_tokenizer/dict.c
ccan/ccan/ccan_tokenizer/dict.h
ccan/ccan/ccan_tokenizer/queue.c
ccan/ccan/ccan_tokenizer/queue.h
ccan/ccan/ccan_tokenizer/read_cnumber.c
ccan/ccan/ccan_tokenizer/read_cstring.c
ccan/ccan/ccan_tokenizer/test/run-simple-token.c
ccan/ccan/ccan_tokenizer/test/run.c
ccan/ccan/charset/charset.c
ccan/ccan/charset/charset.h
ccan/ccan/charset/test/common.h
ccan/ccan/charset/test/run-surrogate-pair.c
ccan/ccan/charset/test/run-utf8-read-write.c
ccan/ccan/charset/test/run-utf8_validate.c
ccan/ccan/check_type/check_type.h
ccan/ccan/check_type/test/compile_fail-check_type.c
ccan/ccan/check_type/test/compile_fail-check_type_unsigned.c
ccan/ccan/check_type/test/compile_fail-check_types_match.c
ccan/ccan/check_type/test/run.c
ccan/ccan/ciniparser/ciniparser.c
ccan/ccan/ciniparser/ciniparser.h
ccan/ccan/ciniparser/dictionary.c
ccan/ccan/ciniparser/dictionary.h
ccan/ccan/ciniparser/test/run-dictionary.c
ccan/ccan/ciniparser/test/run.c
ccan/ccan/compiler/compiler.h
ccan/ccan/compiler/test/compile_fail-printf.c
ccan/ccan/compiler/test/run-is_compile_constant.c
ccan/ccan/container_of/container_of.h
ccan/ccan/container_of/test/compile_fail-bad-type.c
ccan/ccan/container_of/test/compile_fail-types.c
ccan/ccan/container_of/test/compile_fail-var-types.c
ccan/ccan/container_of/test/run.c
ccan/ccan/cpuid/cpuid.c
ccan/ccan/cpuid/cpuid.h
ccan/ccan/cpuid/test/run.c
ccan/ccan/crc/crc.c
ccan/ccan/crc/crc.h
ccan/ccan/crc/test/api.c
ccan/ccan/crcsync/crcsync.c
ccan/ccan/crcsync/crcsync.h
ccan/ccan/crcsync/test/run-crash.c
ccan/ccan/crcsync/test/run-crc.c
ccan/ccan/crcsync/test/run-roll.c
ccan/ccan/crcsync/test/run.c
ccan/ccan/daemon_with_notify/daemon_with_notify.c
ccan/ccan/daemon_with_notify/daemon_with_notify.h
ccan/ccan/daemon_with_notify/test/run.c
ccan/ccan/daemonize/daemonize.c
ccan/ccan/daemonize/daemonize.h
ccan/ccan/daemonize/test/run.c
ccan/ccan/darray/darray.h
ccan/ccan/darray/test/lotsOfNumbers.h
ccan/ccan/darray/test/lotsOfStrings.h
ccan/ccan/darray/test/run.c
ccan/ccan/darray/test/testLits.h
ccan/ccan/dgraph/dgraph.c
ccan/ccan/dgraph/dgraph.h
ccan/ccan/dgraph/test/run-debug.c
ccan/ccan/dgraph/test/run.c
ccan/ccan/endian/endian.h
ccan/ccan/endian/test/compile_ok-constant.c
ccan/ccan/endian/test/run.c
ccan/ccan/err/err.c
ccan/ccan/err/err.h
ccan/ccan/err/test/run.c
ccan/ccan/failtest/failtest.c
ccan/ccan/failtest/failtest.h
ccan/ccan/failtest/failtest_override.h
ccan/ccan/failtest/failtest_proto.h
ccan/ccan/failtest/failtest_undo.h
ccan/ccan/failtest/test/run-failpath.c
ccan/ccan/failtest/test/run-history.c
ccan/ccan/failtest/test/run-locking.c
ccan/ccan/failtest/test/run-malloc.c
ccan/ccan/failtest/test/run-open.c
ccan/ccan/failtest/test/run-with-fdlimit.c
ccan/ccan/failtest/test/run-write.c
ccan/ccan/foreach/foreach.c
ccan/ccan/foreach/foreach.h
ccan/ccan/foreach/test/compile_ok-const.c
ccan/ccan/foreach/test/compile_ok-nonconst.c
ccan/ccan/foreach/test/run-break.c
ccan/ccan/foreach/test/run-nested.c
ccan/ccan/foreach/test/run-not-on-stack.c
ccan/ccan/foreach/test/run-single-arg.c
ccan/ccan/foreach/test/run.c
ccan/ccan/grab_file/grab_file.c
ccan/ccan/grab_file/grab_file.h
ccan/ccan/grab_file/test/run-grab.c
ccan/ccan/hash/hash.c
ccan/ccan/hash/hash.h
ccan/ccan/hash/test/api-hash_stable.c
ccan/ccan/hash/test/run.c
ccan/ccan/heap/heap.c
ccan/ccan/heap/heap.h
ccan/ccan/heap/test/run.c
ccan/ccan/htable/htable.c
ccan/ccan/htable/htable.h
ccan/ccan/htable/htable_type.h
ccan/ccan/htable/test/run-size.c
ccan/ccan/htable/test/run-type.c
ccan/ccan/htable/test/run-zero-hash-first-entry.c
ccan/ccan/htable/test/run.c
ccan/ccan/htable/tools/hsearchspeed.c
ccan/ccan/htable/tools/speed.c
ccan/ccan/htable/tools/stringspeed.c
ccan/ccan/idtree/idtree.c
ccan/ccan/idtree/idtree.h
ccan/ccan/idtree/test/run-wrap.c
ccan/ccan/idtree/test/run.c
ccan/ccan/ilog/ilog.c
ccan/ccan/ilog/ilog.h
ccan/ccan/ilog/test/run-out-of-line.c
ccan/ccan/ilog/test/run.c
ccan/ccan/io/backend.h
ccan/ccan/io/benchmarks/run-different-speed.c
ccan/ccan/io/benchmarks/run-length-prefix.c
ccan/ccan/io/benchmarks/run-loop.c
ccan/ccan/io/io.c
ccan/ccan/io/io.h
ccan/ccan/io/io_plan.h
ccan/ccan/io/poll.c
ccan/ccan/io/test/run-01-start-finish-DEBUG.c
ccan/ccan/io/test/run-01-start-finish.c
ccan/ccan/io/test/run-02-read-DEBUG.c
ccan/ccan/io/test/run-02-read.c
ccan/ccan/io/test/run-03-readpartial-DEBUG.c
ccan/ccan/io/test/run-03-readpartial.c
ccan/ccan/io/test/run-04-writepartial-DEBUG.c
ccan/ccan/io/test/run-04-writepartial.c
ccan/ccan/io/test/run-05-write-DEBUG.c
ccan/ccan/io/test/run-05-write.c
ccan/ccan/io/test/run-06-idle-DEBUG.c
ccan/ccan/io/test/run-06-idle.c
ccan/ccan/io/test/run-07-break-DEBUG.c
ccan/ccan/io/test/run-07-break.c
ccan/ccan/io/test/run-08-hangup-on-idle-DEBUG.c
ccan/ccan/io/test/run-08-hangup-on-idle.c
ccan/ccan/io/test/run-08-read-after-hangup-DEBUG.c
ccan/ccan/io/test/run-08-read-after-hangup.c
ccan/ccan/io/test/run-09-connect-DEBUG.c
ccan/ccan/io/test/run-09-connect.c
ccan/ccan/io/test/run-10-many-DEBUG.c
ccan/ccan/io/test/run-10-many.c
ccan/ccan/io/test/run-12-bidir-DEBUG.c
ccan/ccan/io/test/run-12-bidir.c
ccan/ccan/io/test/run-13-all-idle-DEBUG.c
ccan/ccan/io/test/run-13-all-idle.c
ccan/ccan/io/test/run-15-timeout-DEBUG.c
ccan/ccan/io/test/run-15-timeout.c
ccan/ccan/io/test/run-17-homemade-io-DEBUG.c
ccan/ccan/io/test/run-17-homemade-io.c
ccan/ccan/io/test/run-18-errno-DEBUG.c
ccan/ccan/io/test/run-18-errno.c
ccan/ccan/io/test/run-set_alloc.c
ccan/ccan/isaac/isaac.c
ccan/ccan/isaac/isaac.h
ccan/ccan/isaac/isaac64.c
ccan/ccan/isaac/isaac64.h
ccan/ccan/isaac/test/run.c
ccan/ccan/isaac/test/run64.c
ccan/ccan/iscsi/discovery.c
ccan/ccan/iscsi/dlinklist.h
ccan/ccan/iscsi/init.c
ccan/ccan/iscsi/iscsi-private.h
ccan/ccan/iscsi/iscsi.h
ccan/ccan/iscsi/login.c
ccan/ccan/iscsi/nop.c
ccan/ccan/iscsi/pdu.c
ccan/ccan/iscsi/scsi-command.c
ccan/ccan/iscsi/scsi-lowlevel.c
ccan/ccan/iscsi/scsi-lowlevel.h
ccan/ccan/iscsi/socket.c
ccan/ccan/iscsi/test/run.c
ccan/ccan/iscsi/tools/iscsiclient.c
ccan/ccan/jmap/jmap.c
ccan/ccan/jmap/jmap.h
ccan/ccan/jmap/test/run-access-count.c
ccan/ccan/jmap/test/run-ptridx-int.c
ccan/ccan/jmap/test/run-ptridx-type.c
ccan/ccan/jmap/test/run-uintidx-type.c
ccan/ccan/jmap/test/run.c
ccan/ccan/jmap/tools/speed.c
ccan/ccan/jset/jset.c
ccan/ccan/jset/jset.h
ccan/ccan/jset/test/run-pointer-type.c
ccan/ccan/jset/test/run.c
ccan/ccan/json/json.c
ccan/ccan/json/json.h
ccan/ccan/json/test/common.h
ccan/ccan/json/test/run-construction.c
ccan/ccan/json/test/run-decode-encode.c
ccan/ccan/json/test/run-stringify.c
ccan/ccan/json/test/run-validate.c
ccan/ccan/lbalance/lbalance.c
ccan/ccan/lbalance/lbalance.h
ccan/ccan/lbalance/test/run.c
ccan/ccan/lbalance/tools/lbalance.c
ccan/ccan/likely/likely.c
ccan/ccan/likely/likely.h
ccan/ccan/likely/test/run-debug.c
ccan/ccan/likely/test/run.c
ccan/ccan/list/list.c
ccan/ccan/list/list.h
ccan/ccan/list/test/compile_ok-constant.c
ccan/ccan/list/test/helper.c
ccan/ccan/list/test/helper.h
ccan/ccan/list/test/run-check-corrupt.c
ccan/ccan/list/test/run-list_del_from-assert.c
ccan/ccan/list/test/run-list_prev-list_next.c
ccan/ccan/list/test/run-prepend_list.c
ccan/ccan/list/test/run-single-eval.c
ccan/ccan/list/test/run-with-debug.c
ccan/ccan/list/test/run.c
ccan/ccan/md4/md4.c
ccan/ccan/md4/md4.h
ccan/ccan/md4/test/api.c
ccan/ccan/net/net.c
ccan/ccan/net/net.h
ccan/ccan/net/test/run-bind.c
ccan/ccan/net/test/run.c
ccan/ccan/net/tools/test-net.c
ccan/ccan/nfs/dlinklist.h
ccan/ccan/nfs/init.c
ccan/ccan/nfs/libnfs-private.h
ccan/ccan/nfs/libnfs-raw-mount.c
ccan/ccan/nfs/libnfs-raw-nfs.c
ccan/ccan/nfs/libnfs-raw-nfsacl.c
ccan/ccan/nfs/libnfs-raw-portmap.c
ccan/ccan/nfs/libnfs-raw.h
ccan/ccan/nfs/libnfs-sync.c
ccan/ccan/nfs/libnfs.c
ccan/ccan/nfs/mount.c
ccan/ccan/nfs/nfs.c
ccan/ccan/nfs/nfs.h
ccan/ccan/nfs/nfsacl.c
ccan/ccan/nfs/pdu.c
ccan/ccan/nfs/portmap.c
ccan/ccan/nfs/rpc/mount.h
ccan/ccan/nfs/rpc/nfs.h
ccan/ccan/nfs/rpc/nfsacl.h
ccan/ccan/nfs/rpc/portmap.h
ccan/ccan/nfs/socket.c
ccan/ccan/nfs/tools/nfsclient-async.c
ccan/ccan/nfs/tools/nfsclient-raw.c
ccan/ccan/nfs/tools/nfsclient-sync.c
ccan/ccan/noerr/noerr.c
ccan/ccan/noerr/noerr.h
ccan/ccan/noerr/test/run.c
ccan/ccan/objset/objset.h
ccan/ccan/objset/test/run.c
ccan/ccan/ogg_to_pcm/ogg_to_pcm.c
ccan/ccan/ogg_to_pcm/ogg_to_pcm.h
ccan/ccan/opt/helpers.c
ccan/ccan/opt/opt.c
ccan/ccan/opt/opt.h
ccan/ccan/opt/parse.c
ccan/ccan/opt/private.h
ccan/ccan/opt/test/compile_ok-const-arg.c
ccan/ccan/opt/test/run-add_desc.c
ccan/ccan/opt/test/run-checkopt.c
ccan/ccan/opt/test/run-consume_words.c
ccan/ccan/opt/test/run-correct-reporting.c
ccan/ccan/opt/test/run-early.c
ccan/ccan/opt/test/run-helpers.c
ccan/ccan/opt/test/run-iter.c
ccan/ccan/opt/test/run-no-options.c
ccan/ccan/opt/test/run-set_alloc.c
ccan/ccan/opt/test/run-usage.c
ccan/ccan/opt/test/run.c
ccan/ccan/opt/test/utils.c
ccan/ccan/opt/test/utils.h
ccan/ccan/opt/usage.c
ccan/ccan/ptr_valid/ptr_valid.c
ccan/ccan/ptr_valid/ptr_valid.h
ccan/ccan/ptr_valid/test/run-string.c
ccan/ccan/ptr_valid/test/run.c
ccan/ccan/rbtree/rbtree.c
ccan/ccan/rbtree/rbtree.h
ccan/ccan/rbtree/test/run-many.c
ccan/ccan/rbtree/test/run.c
ccan/ccan/rbuf/rbuf.c
ccan/ccan/rbuf/rbuf.h
ccan/ccan/rbuf/test/run-all.c
ccan/ccan/rbuf/test/run-open.c
ccan/ccan/rbuf/test/run-partial-read.c
ccan/ccan/rbuf/test/run-term-eof.c
ccan/ccan/rbuf/test/run.c
ccan/ccan/read_write_all/read_write_all.c
ccan/ccan/read_write_all/read_write_all.h
ccan/ccan/read_write_all/test/run-read_all.c
ccan/ccan/read_write_all/test/run-write_all.c
ccan/ccan/rfc822/examples/headernames.c
ccan/ccan/rfc822/rfc822.c
ccan/ccan/rfc822/rfc822.h
ccan/ccan/rfc822/test/helper.c
ccan/ccan/rfc822/test/helper.h
ccan/ccan/rfc822/test/run-bad-header-name-chars.c
ccan/ccan/rfc822/test/run-check-check.c
ccan/ccan/rfc822/test/run-default-alloc-failure.c
ccan/ccan/rfc822/test/run-hdr-and-body.c
ccan/ccan/rfc822/test/run-hdr-no-colon.c
ccan/ccan/rfc822/test/run-hdr-of-name.c
ccan/ccan/rfc822/test/run-no-body.c
ccan/ccan/rfc822/test/run-testdata.c
ccan/ccan/rfc822/test/run-unfold.c
ccan/ccan/rfc822/test/testdata.h
ccan/ccan/short_types/short_types.h
ccan/ccan/short_types/test/run-endian.c
ccan/ccan/short_types/test/run.c
ccan/ccan/siphash/siphash.c
ccan/ccan/siphash/siphash.h
ccan/ccan/siphash/test/api.c
ccan/ccan/sparse_bsearch/sparse_bsearch.c
ccan/ccan/sparse_bsearch/sparse_bsearch.h
ccan/ccan/sparse_bsearch/test/run.c
ccan/ccan/str/debug.c
ccan/ccan/str/str.c
ccan/ccan/str/str.h
ccan/ccan/str/str_debug.h
ccan/ccan/str/test/compile_fail-STR_MAX_CHARS.c
ccan/ccan/str/test/compile_fail-isalnum.c
ccan/ccan/str/test/compile_fail-isalpha.c
ccan/ccan/str/test/compile_fail-isascii.c
ccan/ccan/str/test/compile_fail-isblank.c
ccan/ccan/str/test/compile_fail-iscntrl.c
ccan/ccan/str/test/compile_fail-isdigit.c
ccan/ccan/str/test/compile_fail-islower.c
ccan/ccan/str/test/compile_fail-isprint.c
ccan/ccan/str/test/compile_fail-ispunct.c
ccan/ccan/str/test/compile_fail-isspace.c
ccan/ccan/str/test/compile_fail-isupper.c
ccan/ccan/str/test/compile_fail-isxdigit.c
ccan/ccan/str/test/compile_fail-strchr.c
ccan/ccan/str/test/compile_fail-strrchr.c
ccan/ccan/str/test/compile_fail-strstr.c
ccan/ccan/str/test/debug.c
ccan/ccan/str/test/run-STR_MAX_CHARS.c
ccan/ccan/str/test/run.c
ccan/ccan/str_talloc/str_talloc.c
ccan/ccan/str_talloc/str_talloc.h
ccan/ccan/str_talloc/test/run-strreg.c
ccan/ccan/str_talloc/test/run.c
ccan/ccan/stringmap/stringmap.c
ccan/ccan/stringmap/stringmap.h
ccan/ccan/stringmap/test/run.c
ccan/ccan/strmap/strmap.c
ccan/ccan/strmap/strmap.h
ccan/ccan/strmap/test/run-iterate-const.c
ccan/ccan/strmap/test/run-order.c
ccan/ccan/strmap/test/run-prefix.c
ccan/ccan/strmap/test/run.c
ccan/ccan/strset/strset.c
ccan/ccan/strset/strset.h
ccan/ccan/strset/test/run-hibit.c
ccan/ccan/strset/test/run-iterate-const.c
ccan/ccan/strset/test/run-order.c
ccan/ccan/strset/test/run-prefix.c
ccan/ccan/strset/test/run.c
ccan/ccan/strset/tools/cbspeed.c
ccan/ccan/strset/tools/speed.c
ccan/ccan/take/take.c
ccan/ccan/take/take.h
ccan/ccan/take/test/run.c
ccan/ccan/tal/benchmark/samba-allocs.c
ccan/ccan/tal/benchmark/speed.c
ccan/ccan/tal/link/link.c
ccan/ccan/tal/link/link.h
ccan/ccan/tal/link/test/run.c
ccan/ccan/tal/path/path.c
ccan/ccan/tal/path/path.h
ccan/ccan/tal/path/test/run-basename.c
ccan/ccan/tal/path/test/run-canon.c
ccan/ccan/tal/path/test/run-cwd.c
ccan/ccan/tal/path/test/run-dirname.c
ccan/ccan/tal/path/test/run-ext_off.c
ccan/ccan/tal/path/test/run-is_abs.c
ccan/ccan/tal/path/test/run-is_dir.c
ccan/ccan/tal/path/test/run-is_file.c
ccan/ccan/tal/path/test/run-join.c
ccan/ccan/tal/path/test/run-pushd.c
ccan/ccan/tal/path/test/run-readlink.c
ccan/ccan/tal/path/test/run-rel.c
ccan/ccan/tal/path/test/run-simplify.c
ccan/ccan/tal/path/test/run-split.c
ccan/ccan/tal/str/str.c
ccan/ccan/tal/str/str.h
ccan/ccan/tal/str/test/helper.h
ccan/ccan/tal/str/test/run-string.c
ccan/ccan/tal/str/test/run-strreg.c
ccan/ccan/tal/str/test/run-take.c
ccan/ccan/tal/str/test/run.c
ccan/ccan/tal/tal.c
ccan/ccan/tal/tal.h
ccan/ccan/tal/talloc/talloc.c
ccan/ccan/tal/talloc/talloc.h
ccan/ccan/tal/talloc/test/run-array.c
ccan/ccan/tal/talloc/test/run-count.c
ccan/ccan/tal/talloc/test/run-destructor.c
ccan/ccan/tal/talloc/test/run-expand.c
ccan/ccan/tal/talloc/test/run-free.c
ccan/ccan/tal/talloc/test/run-named-debug.c
ccan/ccan/tal/talloc/test/run-named-nolabels.c
ccan/ccan/tal/talloc/test/run-named.c
ccan/ccan/tal/talloc/test/run-overflow.c
ccan/ccan/tal/talloc/test/run-steal.c
ccan/ccan/tal/talloc/test/run-take.c
ccan/ccan/tal/talloc/test/run.c
ccan/ccan/tal/test/run-allocfail.c
ccan/ccan/tal/test/run-array.c
ccan/ccan/tal/test/run-count.c
ccan/ccan/tal/test/run-destructor.c
ccan/ccan/tal/test/run-expand.c
ccan/ccan/tal/test/run-free.c
ccan/ccan/tal/test/run-groups-grow.c
ccan/ccan/tal/test/run-iter.c
ccan/ccan/tal/test/run-named-debug.c
ccan/ccan/tal/test/run-named-nolabels.c
ccan/ccan/tal/test/run-named.c
ccan/ccan/tal/test/run-notifier.c
ccan/ccan/tal/test/run-overflow.c
ccan/ccan/tal/test/run-resizez.c
ccan/ccan/tal/test/run-steal.c
ccan/ccan/tal/test/run-take.c
ccan/ccan/tal/test/run-test-backend.c
ccan/ccan/tal/test/run.c
ccan/ccan/talloc/talloc.c
ccan/ccan/talloc/talloc.h
ccan/ccan/talloc/test/compile_fail-talloc_set.c
ccan/ccan/talloc/test/run-corruption1.c
ccan/ccan/talloc/test/run-external-alloc.c
ccan/ccan/talloc/test/run-set_allocator.c
ccan/ccan/talloc/test/run-talloc_set.c
ccan/ccan/talloc/test/run-test_autofree.c
ccan/ccan/talloc/test/run-test_free_in_destructor.c
ccan/ccan/talloc/test/run-test_free_parent_deny_child.c
ccan/ccan/talloc/test/run-test_loop.c
ccan/ccan/talloc/test/run-test_misc.c
ccan/ccan/talloc/test/run-test_move.c
ccan/ccan/talloc/test/run-test_realloc.c
ccan/ccan/talloc/test/run-test_realloc_fn.c
ccan/ccan/talloc/test/run-test_ref.c
ccan/ccan/talloc/test/run-test_steal.c
ccan/ccan/talloc/test/run-test_talloc_ptrtype.c
ccan/ccan/talloc/test/run-test_type.c
ccan/ccan/talloc/test/run-test_unlink.c
ccan/ccan/talloc/test/run-test_unref_reparent.c
ccan/ccan/talloc/test/run.c
ccan/ccan/talloc_link/talloc_link.c
ccan/ccan/talloc_link/talloc_link.h
ccan/ccan/talloc_link/test/run.c
ccan/ccan/tally/tally.c
ccan/ccan/tally/tally.h
ccan/ccan/tally/test/run-bucket_of.c
ccan/ccan/tally/test/run-divlu64.c
ccan/ccan/tally/test/run-histogram.c
ccan/ccan/tally/test/run-mean.c
ccan/ccan/tally/test/run-median.c
ccan/ccan/tally/test/run-min-max.c
ccan/ccan/tally/test/run-mode.c
ccan/ccan/tally/test/run-renormalize.c
ccan/ccan/tally/test/run-total.c
ccan/ccan/tap/tap.c
ccan/ccan/tap/tap.h
ccan/ccan/tap/test/run.c
ccan/ccan/tcon/tcon.h
ccan/ccan/tcon/test/compile_fail-tcon_cast.c
ccan/ccan/tcon/test/compile_fail.c
ccan/ccan/tcon/test/compile_ok-void.c
ccan/ccan/tcon/test/compile_ok.c
ccan/ccan/time/test/run-check.c
ccan/ccan/time/test/run.c
ccan/ccan/time/time.c
ccan/ccan/time/time.h
ccan/ccan/timer/benchmarks/benchmark.c
ccan/ccan/timer/benchmarks/expected-usage.c
ccan/ccan/timer/test/run-add.c
ccan/ccan/timer/test/run-expiry.c
ccan/ccan/timer/test/run-ff.c
ccan/ccan/timer/test/run.c
ccan/ccan/timer/timer.c
ccan/ccan/timer/timer.h
ccan/ccan/tlist/test/compile_fail-tlist_add.c
ccan/ccan/tlist/test/compile_fail-tlist_add_tail.c
ccan/ccan/tlist/test/compile_fail-tlist_del_from.c
ccan/ccan/tlist/test/compile_fail-tlist_for_each.c
ccan/ccan/tlist/test/compile_fail-tlist_for_each_safe.c
ccan/ccan/tlist/test/compile_fail-tlist_tail.c
ccan/ccan/tlist/test/compile_fail-tlist_top.c
ccan/ccan/tlist/test/run.c
ccan/ccan/tlist/tlist.h
ccan/ccan/ttxml/test/run.c
ccan/ccan/ttxml/ttxml.c
ccan/ccan/ttxml/ttxml.h
ccan/ccan/typesafe_cb/test/compile_fail-cast_if_type-promotable.c
ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb-int.c
ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb.c
ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_cast-multi.c
ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_cast.c
ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_postargs.c
ccan/ccan/typesafe_cb/test/compile_fail-typesafe_cb_preargs.c
ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb-NULL.c
ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb-undefined.c
ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb-vars.c
ccan/ccan/typesafe_cb/test/compile_ok-typesafe_cb_cast.c
ccan/ccan/typesafe_cb/test/run.c
ccan/ccan/typesafe_cb/typesafe_cb.h
ccan/ccan/version/test/compile_fail.c
ccan/ccan/version/test/run.c
ccan/ccan/version/version.h
ccan/ccan/wwviaudio/wwviaudio.c
ccan/ccan/wwviaudio/wwviaudio.h
ccan/junkcode/codedr@gmail.com-grok/grok.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_array.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_deque.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_errors.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_heap.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_lib.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_map.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_rb.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_set.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_slist.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/inc/c_stack.h
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_array.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_deque.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_heap.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_map.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_rb.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_set.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_slist.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_stack.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/src/c_util.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_array.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_deque.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_heap.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_map.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_rb.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_set.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_slist.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_c_stack.c
ccan/junkcode/dongre.avinash@gmail.com-clibutils/test/t_clibutils.c
ccan/junkcode/fork0@users.sf.net-bitmaps/bitmaps.h
ccan/junkcode/fork0@users.sf.net-pathexpand/pathexpand.c
ccan/junkcode/fork0@users.sf.net-timeout/timeout.c
ccan/junkcode/guerrilla_thought@gmx.de-bst/bst.h
ccan/junkcode/henryeshbaugh@gmail.com-log/log.c
ccan/junkcode/henryeshbaugh@gmail.com-log/log.h
ccan/junkcode/iasoule32@gmail.com-polynomial/_info.c
ccan/junkcode/iasoule32@gmail.com-polynomial/polynomial_adt.c
ccan/junkcode/iasoule32@gmail.com-polynomial/polynomial_adt.h
ccan/junkcode/iasoule32@gmail.com-polynomial/test/run.c
ccan/junkcode/mansourmoufid@gmail.com-endianness/endianness.c
ccan/junkcode/swehack@gmail.com-snifstat/snifstat.c
ccan/junkcode/tinkertim@gmail.com-grawk/grawk.c
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/choose.c
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/choose.h
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/crt.c
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/crt.h
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/egcd.c
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/egcd.h
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/gcd.c
ccan/junkcode/tterribe@email.unc.edu-nmbrthry/gcd.h
ccan/tools/ccan_depends.c
ccan/tools/ccan_dir.c
ccan/tools/ccanlint/async.c
ccan/tools/ccanlint/ccanlint.c
ccan/tools/ccanlint/ccanlint.h
ccan/tools/ccanlint/file_analysis.c
ccan/tools/ccanlint/licenses.c
ccan/tools/ccanlint/licenses.h
ccan/tools/ccanlint/test/run-file_analysis.c
ccan/tools/ccanlint/tests/avoids_cpp_reserved.c
ccan/tools/ccanlint/tests/build.h
ccan/tools/ccanlint/tests/depends_accurate.c
ccan/tools/ccanlint/tests/depends_build.c
ccan/tools/ccanlint/tests/depends_build_without_features.c
ccan/tools/ccanlint/tests/depends_exist.c
ccan/tools/ccanlint/tests/examples_compile.c
ccan/tools/ccanlint/tests/examples_exist.c
ccan/tools/ccanlint/tests/examples_relevant.c
ccan/tools/ccanlint/tests/examples_run.c
ccan/tools/ccanlint/tests/hash_if.c
ccan/tools/ccanlint/tests/headers_idempotent.c
ccan/tools/ccanlint/tests/info_documentation_exists.c
ccan/tools/ccanlint/tests/info_exists.c
ccan/tools/ccanlint/tests/info_summary_single_line.c
ccan/tools/ccanlint/tests/license_comment.c
ccan/tools/ccanlint/tests/license_depends_compat.c
ccan/tools/ccanlint/tests/license_exists.c
ccan/tools/ccanlint/tests/license_file_compat.c
ccan/tools/ccanlint/tests/main_header_compiles.c
ccan/tools/ccanlint/tests/main_header_exists.c
ccan/tools/ccanlint/tests/module_builds.c
ccan/tools/ccanlint/tests/module_links.c
ccan/tools/ccanlint/tests/no_trailing_whitespace.c
ccan/tools/ccanlint/tests/objects_build.c
ccan/tools/ccanlint/tests/objects_build_with_stringchecks.c
ccan/tools/ccanlint/tests/objects_build_without_features.c
ccan/tools/ccanlint/tests/reduce_features.c
ccan/tools/ccanlint/tests/reduce_features.h
ccan/tools/ccanlint/tests/tests_compile.c
ccan/tools/ccanlint/tests/tests_compile.h
ccan/tools/ccanlint/tests/tests_compile_coverage.c
ccan/tools/ccanlint/tests/tests_coverage.c
ccan/tools/ccanlint/tests/tests_exist.c
ccan/tools/ccanlint/tests/tests_helpers_compile.c
ccan/tools/ccanlint/tests/tests_pass.c
ccan/tools/ccanlint/tests/tests_pass.h
ccan/tools/ccanlint/tests/tests_pass_valgrind.c
ccan/tools/ccanlint/tests/tests_pass_without_features.c
ccan/tools/compile.c
ccan/tools/configurator/configurator.c
ccan/tools/depends.c
ccan/tools/doc_extract-core.c
ccan/tools/doc_extract.c
ccan/tools/doc_extract.h
ccan/tools/manifest.c
ccan/tools/manifest.h
ccan/tools/namespacize.c
ccan/tools/read_config_header.c
ccan/tools/read_config_header.h
ccan/tools/tools.c
ccan/tools/tools.h
ccan/web/uploader.php.cpp
d2im.c
d2im.h
d2lib/d2scene/d2scene.h
ex_blit.c
ex_drawpixels.c
main.c
main.h
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/byteswap.h
/usr/include/ctype.h
/usr/include/dirent.h
/usr/include/endian.h
/usr/include/err.h
/usr/include/errno.h
/usr/include/execinfo.h
/usr/include/fcntl.h
/usr/include/fnmatch.h
/usr/include/getopt.h
/usr/include/ifaddrs.h
/usr/include/inttypes.h
/usr/include/limits.h
/usr/include/malloc.h
/usr/include/math.h
/usr/include/net/if.h
/usr/include/net/route.h
/usr/include/netdb.h
/usr/include/netinet/if_ether.h
/usr/include/netinet/in.h
/usr/include/poll.h
/usr/include/pthread.h
/usr/include/regex.h
/usr/include/rpc/auth.h
/usr/include/rpc/rpc.h
/usr/include/rpc/rpc_msg.h
/usr/include/rpc/xdr.h
/usr/include/search.h
/usr/include/setjmp.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/utime.h
/usr/include/vorbis/vorbisfile.h
/usr/include/alloca.h
/usr/include/features.h
/usr/include/libio.h
/usr/include/linux/if_ether.h
/usr/include/net/ethernet.h
/usr/include/net/if_arp.h
/usr/include/rpc/auth_des.h
/usr/include/rpc/auth_unix.h
/usr/include/rpc/clnt.h
/usr/include/rpc/netdb.h
/usr/include/rpc/svc.h
/usr/include/rpc/svc_auth.h
/usr/include/rpc/types.h
/usr/include/sched.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/linux/types.h
/usr/include/gconv.h
/usr/include/linux/posix_types.h
/usr/include/wchar.h
/usr/include/linux/stddef.h
/usr/include/wctype.h
